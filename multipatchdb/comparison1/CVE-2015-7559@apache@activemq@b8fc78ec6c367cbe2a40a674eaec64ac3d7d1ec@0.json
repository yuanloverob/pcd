{
  "cve_id": "CVE-2015-7559",
  "cve_desc": "It was found that the Apache ActiveMQ client before 5.14.5 exposed a remote shutdown command in the ActiveMQConnection class. An attacker logged into a compromised broker could use this flaw to achieve denial of service on a connected client.",
  "repo": "apache/activemq",
  "patch_hash": "b8fc78ec6c367cbe2a40a674eaec64ac3d7d1ecb",
  "patch_info": {
    "commit_hash": "b8fc78ec6c367cbe2a40a674eaec64ac3d7d1ecb",
    "repo": "apache/activemq",
    "commit_url": "https://github.com/apache/activemq/commit/b8fc78ec6c367cbe2a40a674eaec64ac3d7d1ec",
    "files": [
      "activemq-client/src/main/java/org/apache/activemq/ActiveMQConnection.java"
    ],
    "message": "https://issues.apache.org/jira/browse/AMQ-6470 - Remove unused ControlCommand handling in client\n\n(cherry picked from commit 338a74dfa42a7b19d39adecacfa5f626a050e807)",
    "before_after_code_files": [
      "activemq-client/src/main/java/org/apache/activemq/ActiveMQConnection.java||activemq-client/src/main/java/org/apache/activemq/ActiveMQConnection.java"
    ]
  },
  "patch_diff": {
    "activemq-client/src/main/java/org/apache/activemq/ActiveMQConnection.java||activemq-client/src/main/java/org/apache/activemq/ActiveMQConnection.java": [
      "File: activemq-client/src/main/java/org/apache/activemq/ActiveMQConnection.java -> activemq-client/src/main/java/org/apache/activemq/ActiveMQConnection.java",
      "--- Hunk 1 ---",
      "[Context before]",
      "1874:                     @Override",
      "1875:                     public Response processControlCommand(ControlCommand command) throws Exception {",
      "1877:                         return null;",
      "1878:                     }",
      "",
      "[Removed Lines]",
      "1876:                         onControlCommand(command);",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "2221:         }",
      "2222:     }",
      "2243:     protected void onConnectionControl(ConnectionControl command) {",
      "2244:         if (command.isFaultTolerant()) {",
      "2245:             this.optimizeAcknowledge = false;",
      "",
      "[Removed Lines]",
      "2224:     protected void onControlCommand(ControlCommand command) {",
      "2225:         String text = command.getCommand();",
      "2226:         if (text != null) {",
      "2227:             if (\"shutdown\".equals(text)) {",
      "2228:                 LOG.info(\"JVM told to shutdown\");",
      "2229:                 System.exit(0);",
      "2230:             }",
      "2240:         }",
      "2241:     }",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "338a74dfa42a7b19d39adecacfa5f626a050e807",
      "candidate_info": {
        "commit_hash": "338a74dfa42a7b19d39adecacfa5f626a050e807",
        "repo": "apache/activemq",
        "commit_url": "https://github.com/apache/activemq/commit/338a74dfa42a7b19d39adecacfa5f626a050e807",
        "files": [
          "activemq-client/src/main/java/org/apache/activemq/ActiveMQConnection.java"
        ],
        "message": "https://issues.apache.org/jira/browse/AMQ-6470 - Remove unused ControlCommand handling in client",
        "before_after_code_files": [
          "activemq-client/src/main/java/org/apache/activemq/ActiveMQConnection.java||activemq-client/src/main/java/org/apache/activemq/ActiveMQConnection.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "activemq-client/src/main/java/org/apache/activemq/ActiveMQConnection.java||activemq-client/src/main/java/org/apache/activemq/ActiveMQConnection.java"
          ],
          "candidate": [
            "activemq-client/src/main/java/org/apache/activemq/ActiveMQConnection.java||activemq-client/src/main/java/org/apache/activemq/ActiveMQConnection.java"
          ]
        }
      },
      "candidate_diff": {
        "activemq-client/src/main/java/org/apache/activemq/ActiveMQConnection.java||activemq-client/src/main/java/org/apache/activemq/ActiveMQConnection.java": [
          "File: activemq-client/src/main/java/org/apache/activemq/ActiveMQConnection.java -> activemq-client/src/main/java/org/apache/activemq/ActiveMQConnection.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "1874:                     @Override",
          "1875:                     public Response processControlCommand(ControlCommand command) throws Exception {",
          "1877:                         return null;",
          "1878:                     }",
          "",
          "[Removed Lines]",
          "1876:                         onControlCommand(command);",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2221:         }",
          "2222:     }",
          "2243:     protected void onConnectionControl(ConnectionControl command) {",
          "2244:         if (command.isFaultTolerant()) {",
          "2245:             this.optimizeAcknowledge = false;",
          "",
          "[Removed Lines]",
          "2224:     protected void onControlCommand(ControlCommand command) {",
          "2225:         String text = command.getCommand();",
          "2226:         if (text != null) {",
          "2227:             if (\"shutdown\".equals(text)) {",
          "2228:                 LOG.info(\"JVM told to shutdown\");",
          "2229:                 System.exit(0);",
          "2230:             }",
          "2240:         }",
          "2241:     }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    }
  ]
}