{
  "cve_id": "CVE-2022-4690",
  "cve_desc": "Cross-site Scripting (XSS) - Stored in GitHub repository usememos/memos prior to 0.9.0.",
  "repo": "usememos/memos",
  "patch_hash": "c07b4a57caa89905e54b800f4d8fb720bbf5bf82",
  "patch_info": {
    "commit_hash": "c07b4a57caa89905e54b800f4d8fb720bbf5bf82",
    "repo": "usememos/memos",
    "commit_url": "https://github.com/usememos/memos/commit/c07b4a57caa89905e54b800f4d8fb720bbf5bf82",
    "files": [
      "server/resource.go",
      "server/server.go"
    ],
    "message": "feat: add secure middleware (#832)",
    "before_after_code_files": [
      "server/resource.go||server/resource.go",
      "server/server.go||server/server.go"
    ]
  },
  "patch_diff": {
    "server/resource.go||server/resource.go": [
      "File: server/resource.go -> server/resource.go",
      "--- Hunk 1 ---",
      "[Context before]",
      "7:  \"net/http\"",
      "8:  \"net/url\"",
      "9:  \"strconv\"",
      "11:  \"time\"",
      "13:  \"github.com/usememos/memos/api\"",
      "",
      "[Removed Lines]",
      "10:  \"strings\"",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "263:    return echo.NewHTTPError(http.StatusInternalServerError, fmt.Sprintf(\"Failed to fetch resource ID: %v\", resourceID)).SetInternal(err)",
      "264:   }",
      "271:   c.Response().Writer.WriteHeader(http.StatusOK)",
      "272:   c.Response().Writer.Header().Set(echo.HeaderCacheControl, \"max-age=31536000, immutable\")",
      "273:   if _, err := c.Response().Writer.Write(resource.Blob); err != nil {",
      "",
      "[Removed Lines]",
      "266:   if strings.HasPrefix(resource.Type, echo.MIMETextHTML) {",
      "267:    c.Response().Writer.Header().Set(\"Content-Type\", echo.MIMETextPlain)",
      "268:   } else {",
      "269:    c.Response().Writer.Header().Set(\"Content-Type\", resource.Type)",
      "270:   }",
      "",
      "[Added Lines]",
      "265:   c.Response().Writer.Header().Set(\"Content-Type\", resource.Type)",
      "",
      "---------------"
    ],
    "server/server.go||server/server.go": [
      "File: server/server.go -> server/server.go",
      "--- Hunk 1 ---",
      "[Context before]",
      "44:   Timeout:      30 * time.Second,",
      "45:  }))",
      "47:  embedFrontend(e)",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "47:  e.Use(middleware.SecureWithConfig(middleware.SecureConfig{",
      "48:   ContentSecurityPolicy: \"default-src 'self'\",",
      "49:  }))",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "e85d368f87e636ec969a7fc461f1f14fbd5e9564",
      "candidate_info": {
        "commit_hash": "e85d368f87e636ec969a7fc461f1f14fbd5e9564",
        "repo": "usememos/memos",
        "commit_url": "https://github.com/usememos/memos/commit/e85d368f87e636ec969a7fc461f1f14fbd5e9564",
        "files": [
          "api/resource.go",
          "server/resource.go",
          "store/resource.go",
          "web/src/components/ChangeResourceFilenameDialog.tsx",
          "web/src/components/ResourcesDialog.tsx",
          "web/src/helpers/api.ts",
          "web/src/less/change-resource-filename-dialog.less",
          "web/src/less/resources-dialog.less",
          "web/src/locales/en.json",
          "web/src/locales/vi.json",
          "web/src/locales/zh.json",
          "web/src/services/resourceService.ts",
          "web/src/store/index.ts",
          "web/src/store/modules/resource.ts",
          "web/src/types/modules/resource.d.ts"
        ],
        "message": "feat: patch resource filename (#360)\n\n* feat: resource filename rename\n\n* update: resource filename rename\n\n* update: resource filename rename\n\n* update: validation about the filename\n\nCo-authored-by: boojack <stevenlgtm@gmail.com>",
        "before_after_code_files": [
          "api/resource.go||api/resource.go",
          "server/resource.go||server/resource.go",
          "store/resource.go||store/resource.go",
          "web/src/components/ChangeResourceFilenameDialog.tsx||web/src/components/ChangeResourceFilenameDialog.tsx",
          "web/src/components/ResourcesDialog.tsx||web/src/components/ResourcesDialog.tsx",
          "web/src/helpers/api.ts||web/src/helpers/api.ts",
          "web/src/less/change-resource-filename-dialog.less||web/src/less/change-resource-filename-dialog.less",
          "web/src/less/resources-dialog.less||web/src/less/resources-dialog.less",
          "web/src/services/resourceService.ts||web/src/services/resourceService.ts",
          "web/src/store/index.ts||web/src/store/index.ts",
          "web/src/store/modules/resource.ts||web/src/store/modules/resource.ts",
          "web/src/types/modules/resource.d.ts||web/src/types/modules/resource.d.ts"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "server/resource.go||server/resource.go"
          ],
          "candidate": [
            "server/resource.go||server/resource.go"
          ]
        }
      },
      "candidate_diff": {
        "api/resource.go||api/resource.go": [
          "File: api/resource.go -> api/resource.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "47:  CreatorID int",
          "48: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "50: type ResourcePatch struct {",
          "51:  ID int",
          "54:  UpdatedTs *int64",
          "56:  Filename *string `json:\"filename\"`",
          "57: }",
          "",
          "---------------"
        ],
        "server/resource.go||server/resource.go": [
          "File: server/resource.go -> server/resource.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "7:  \"io\"",
          "8:  \"net/http\"",
          "9:  \"strconv\"",
          "11:  \"github.com/usememos/memos/api\"",
          "12:  \"github.com/usememos/memos/common\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "10:  \"time\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "183:   return c.JSON(http.StatusOK, true)",
          "184:  })",
          "185: }",
          "187: func (s *Server) registerResourcePublicRoutes(g *echo.Group) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "187:  g.PATCH(\"/resource/:resourceId\", func(c echo.Context) error {",
          "188:   ctx := c.Request().Context()",
          "189:   userID, ok := c.Get(getUserIDContextKey()).(int)",
          "190:   if !ok {",
          "191:    return echo.NewHTTPError(http.StatusUnauthorized, \"Missing user in session\")",
          "192:   }",
          "194:   resourceID, err := strconv.Atoi(c.Param(\"resourceId\"))",
          "195:   if err != nil {",
          "196:    return echo.NewHTTPError(http.StatusBadRequest, fmt.Sprintf(\"ID is not a number: %s\", c.Param(\"resourceId\"))).SetInternal(err)",
          "197:   }",
          "199:   resourceFind := &api.ResourceFind{",
          "200:    ID:        &resourceID,",
          "201:    CreatorID: &userID,",
          "202:   }",
          "203:   if _, err := s.Store.FindResource(ctx, resourceFind); err != nil {",
          "204:    return echo.NewHTTPError(http.StatusInternalServerError, \"Failed to find resource\").SetInternal(err)",
          "205:   }",
          "207:   currentTs := time.Now().Unix()",
          "208:   resourcePatch := &api.ResourcePatch{",
          "209:    ID:        resourceID,",
          "210:    UpdatedTs: &currentTs,",
          "211:   }",
          "212:   if err := json.NewDecoder(c.Request().Body).Decode(resourcePatch); err != nil {",
          "213:    return echo.NewHTTPError(http.StatusBadRequest, \"Malformatted patch resource request\").SetInternal(err)",
          "214:   }",
          "216:   resource, err := s.Store.PatchResource(ctx, resourcePatch)",
          "217:   if err != nil {",
          "218:    return echo.NewHTTPError(http.StatusInternalServerError, \"Failed to patch resource\").SetInternal(err)",
          "219:   }",
          "221:   c.Response().Header().Set(echo.HeaderContentType, echo.MIMEApplicationJSONCharsetUTF8)",
          "222:   if err := json.NewEncoder(c.Response().Writer).Encode(composeResponse(resource)); err != nil {",
          "223:    return echo.NewHTTPError(http.StatusInternalServerError, \"Failed to encode resource response\").SetInternal(err)",
          "224:   }",
          "225:   return nil",
          "226:  })",
          "",
          "---------------"
        ],
        "store/resource.go||store/resource.go": [
          "File: store/resource.go -> store/resource.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "188:  return nil",
          "189: }",
          "191: func createResource(ctx context.Context, tx *sql.Tx, create *api.ResourceCreate) (*resourceRaw, error) {",
          "192:  query := `",
          "193:   INSERT INTO resource (",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "191: func (s *Store) PatchResource(ctx context.Context, patch *api.ResourcePatch) (*api.Resource, error) {",
          "192:  tx, err := s.db.BeginTx(ctx, nil)",
          "193:  if err != nil {",
          "194:   return nil, FormatError(err)",
          "195:  }",
          "196:  defer tx.Rollback()",
          "198:  resourceRaw, err := patchResource(ctx, tx, patch)",
          "199:  if err != nil {",
          "200:   return nil, err",
          "201:  }",
          "203:  if err := tx.Commit(); err != nil {",
          "204:   return nil, FormatError(err)",
          "205:  }",
          "207:  if err := s.cache.UpsertCache(api.ResourceCache, resourceRaw.ID, resourceRaw); err != nil {",
          "208:   return nil, err",
          "209:  }",
          "211:  resource := resourceRaw.toResource()",
          "213:  return resource, nil",
          "214: }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "217:  return &resourceRaw, nil",
          "218: }",
          "220: func findResourceList(ctx context.Context, tx *sql.Tx, find *api.ResourceFind) ([]*resourceRaw, error) {",
          "221:  where, args := []string{\"1 = 1\"}, []interface{}{}",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "242:  return &resourceRaw, nil",
          "243: }",
          "245: func patchResource(ctx context.Context, tx *sql.Tx, patch *api.ResourcePatch) (*resourceRaw, error) {",
          "246:  set, args := []string{}, []interface{}{}",
          "248:  if v := patch.UpdatedTs; v != nil {",
          "249:   set, args = append(set, \"updated_ts = ?\"), append(args, *v)",
          "250:  }",
          "251:  if v := patch.Filename; v != nil {",
          "252:   set, args = append(set, \"filename = ?\"), append(args, *v)",
          "253:  }",
          "255:  args = append(args, patch.ID)",
          "257:  query := `",
          "258:   UPDATE resource",
          "259:   SET ` + strings.Join(set, \", \") + `",
          "260:   WHERE id = ?",
          "261:   RETURNING id, filename, blob, type, size, creator_id, created_ts, updated_ts",
          "262:  `",
          "263:  var resourceRaw resourceRaw",
          "264:  if err := tx.QueryRowContext(ctx, query, args...).Scan(",
          "265:   &resourceRaw.ID,",
          "266:   &resourceRaw.Filename,",
          "267:   &resourceRaw.Blob,",
          "268:   &resourceRaw.Type,",
          "269:   &resourceRaw.Size,",
          "",
          "---------------"
        ],
        "web/src/components/ChangeResourceFilenameDialog.tsx||web/src/components/ChangeResourceFilenameDialog.tsx": [
          "File: web/src/components/ChangeResourceFilenameDialog.tsx -> web/src/components/ChangeResourceFilenameDialog.tsx",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: import { useState } from \"react\";",
          "2: import { useTranslation } from \"react-i18next\";",
          "3: import { resourceService } from \"../services\";",
          "4: import Icon from \"./Icon\";",
          "5: import { generateDialog } from \"./Dialog\";",
          "6: import toastHelper from \"./Toast\";",
          "7: import \"../less/change-resource-filename-dialog.less\";",
          "9: interface Props extends DialogProps {",
          "10:   resourceId: ResourceId;",
          "11:   resourceFilename: string;",
          "12: }",
          "14: const validateFilename = (filename: string): boolean => {",
          "15:   if (filename.length === 0 || filename.length >= 128) {",
          "16:     return false;",
          "17:   }",
          "18:   const startReg = /^([+\\-.]).*/;",
          "19:   const illegalReg = /[/@#$%^&*()[\\]]/;",
          "20:   if (startReg.test(filename) || illegalReg.test(filename)) {",
          "21:     return false;",
          "22:   }",
          "23:   return true;",
          "24: };",
          "26: const ChangeResourceFilenameDialog: React.FC<Props> = (props: Props) => {",
          "27:   const { t } = useTranslation();",
          "28:   const { destroy, resourceId, resourceFilename } = props;",
          "29:   const [filename, setFilename] = useState<string>(resourceFilename);",
          "31:   const handleFilenameChanged = (e: React.ChangeEvent<HTMLInputElement>) => {",
          "32:     const nextUsername = e.target.value as string;",
          "33:     setFilename(nextUsername);",
          "34:   };",
          "36:   const handleCloseBtnClick = () => {",
          "37:     destroy();",
          "38:   };",
          "40:   const handleSaveBtnClick = async () => {",
          "41:     if (filename === resourceFilename) {",
          "42:       handleCloseBtnClick();",
          "43:       return;",
          "44:     }",
          "45:     if (!validateFilename(filename)) {",
          "46:       toastHelper.error(t(\"message.invalid-resource-filename\"));",
          "47:       return;",
          "48:     }",
          "49:     try {",
          "50:       await resourceService.patchResource({",
          "51:         id: resourceId,",
          "52:         filename: filename,",
          "53:       });",
          "54:       toastHelper.info(t(\"message.resource-filename-updated\"));",
          "55:       handleCloseBtnClick();",
          "56:     } catch (error: any) {",
          "57:       console.error(error);",
          "58:       toastHelper.error(error.response.data.message);",
          "59:     }",
          "60:   };",
          "62:   return (",
          "63:     <>",
          "64:       <div className=\"dialog-header-container\">",
          "65:         <p className=\"title-text\">{t(\"message.change-resource-filename\")}</p>",
          "66:         <button className=\"btn close-btn\" onClick={handleCloseBtnClick}>",
          "67:           <Icon.X />",
          "68:         </button>",
          "69:       </div>",
          "70:       <div className=\"dialog-content-container\">",
          "71:         <label className=\"form-label input-form-label\">",
          "72:           <input type=\"text\" value={filename} onChange={handleFilenameChanged} />",
          "73:         </label>",
          "74:         <div className=\"btns-container\">",
          "75:           <span className=\"btn cancel-btn\" onClick={handleCloseBtnClick}>",
          "76:             {t(\"common.cancel\")}",
          "77:           </span>",
          "78:           <span className=\"btn confirm-btn\" onClick={handleSaveBtnClick}>",
          "79:             {t(\"common.save\")}",
          "80:           </span>",
          "81:         </div>",
          "82:       </div>",
          "83:     </>",
          "84:   );",
          "85: };",
          "87: function showChangeResourceFilenameDialog(resourceId: ResourceId, resourceFilename: string) {",
          "88:   generateDialog(",
          "89:     {",
          "90:       className: \"change-resource-filename-dialog\",",
          "91:     },",
          "92:     ChangeResourceFilenameDialog,",
          "93:     {",
          "94:       resourceId,",
          "95:       resourceFilename,",
          "96:     }",
          "97:   );",
          "98: }",
          "100: export default showChangeResourceFilenameDialog;",
          "",
          "---------------"
        ],
        "web/src/components/ResourcesDialog.tsx||web/src/components/ResourcesDialog.tsx": [
          "File: web/src/components/ResourcesDialog.tsx -> web/src/components/ResourcesDialog.tsx",
          "--- Hunk 1 ---",
          "[Context before]",
          "11: import toastHelper from \"./Toast\";",
          "12: import \"../less/resources-dialog.less\";",
          "13: import * as utils from \"../helpers/utils\";",
          "15: type Props = DialogProps;",
          "17: interface State {",
          "19:   isUploadingResource: boolean;",
          "20: }",
          "",
          "[Removed Lines]",
          "18:   resources: Resource[];",
          "",
          "[Added Lines]",
          "14: import showChangeResourceFilenameDialog from \"./ChangeResourceFilenameDialog\";",
          "15: import { useAppSelector } from \"../store\";",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "23:   const { destroy } = props;",
          "24:   const { t } = useTranslation();",
          "25:   const loadingState = useLoading();",
          "26:   const [state, setState] = useState<State>({",
          "28:     isUploadingResource: false,",
          "29:   });",
          "31:   useEffect(() => {",
          "32:     fetchResources()",
          "33:       .catch((error) => {",
          "",
          "[Removed Lines]",
          "27:     resources: [],",
          "",
          "[Added Lines]",
          "27:   const { resources } = useAppSelector((state) => state.resource);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "42:   const fetchResources = async () => {",
          "43:     const data = await resourceService.getResourceList();",
          "48:   };",
          "50:   const handleUploadFileBtnClick = async () => {",
          "",
          "[Removed Lines]",
          "44:     setState({",
          "45:       ...state,",
          "46:       resources: data,",
          "47:     });",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "99:     }",
          "100:   };",
          "102:   const handleCopyResourceLinkBtnClick = (resource: Resource) => {",
          "103:     copy(`${window.location.origin}/o/r/${resource.id}/${resource.filename}`);",
          "104:     toastHelper.success(\"Succeed to copy resource link to clipboard\");",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "98:   const handleRenameBtnClick = (resource: Resource) => {",
          "99:     showChangeResourceFilenameDialog(resource.id, resource.filename);",
          "100:   };",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "165:               <span className=\"field-text type-text\">TYPE</span>",
          "166:               <span></span>",
          "167:             </div>",
          "169:               <p className=\"tip-text\">{t(\"resources.no-resources\")}</p>",
          "170:             ) : (",
          "172:                 <div key={resource.id} className=\"resource-container\">",
          "173:                   <span className=\"field-text id-text\">{resource.id}</span>",
          "174:                   <span className=\"field-text name-text\">",
          "",
          "[Removed Lines]",
          "168:             {state.resources.length === 0 ? (",
          "171:               state.resources.map((resource) => (",
          "",
          "[Added Lines]",
          "168:             {resources.length === 0 ? (",
          "171:               resources.map((resource) => (",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "198:                           >",
          "199:                             {t(\"resources.preview\")}",
          "200:                           </button>",
          "201:                           <button",
          "202:                             className=\"w-full text-left text-sm leading-6 py-1 px-3 cursor-pointer rounded hover:bg-gray-100\"",
          "203:                             onClick={() => handleCopyResourceLinkBtnClick(resource)}",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "203:                             onClick={() => handleRenameBtnClick(resource)}",
          "204:                           >",
          "205:                             {t(\"resources.rename\")}",
          "206:                           </button>",
          "207:                           <button",
          "208:                             className=\"w-full text-left text-sm leading-6 py-1 px-3 cursor-pointer rounded hover:bg-gray-100\"",
          "",
          "---------------"
        ],
        "web/src/helpers/api.ts||web/src/helpers/api.ts": [
          "File: web/src/helpers/api.ts -> web/src/helpers/api.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "154:   return axios.delete(`/api/resource/${id}`);",
          "155: }",
          "157: export function getMemoResourceList(memoId: MemoId) {",
          "158:   return axios.get<ResponseObject<Resource[]>>(`/api/memo/${memoId}/resource`);",
          "159: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "157: export function patchResource(resourcePatch: ResourcePatch) {",
          "158:   return axios.patch<ResponseObject<Resource>>(`/api/resource/${resourcePatch.id}`, resourcePatch);",
          "159: }",
          "",
          "---------------"
        ],
        "web/src/less/change-resource-filename-dialog.less||web/src/less/change-resource-filename-dialog.less": [
          "File: web/src/less/change-resource-filename-dialog.less -> web/src/less/change-resource-filename-dialog.less",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: @import \"./mixin.less\";",
          "3: .change-resource-filename-dialog {",
          "4:   > .dialog-container {",
          "5:     @apply w-72;",
          "7:     > .dialog-content-container {",
          "8:       .flex(column, flex-start, flex-start);",
          "10:       > .tip-text {",
          "11:         @apply bg-gray-400 text-xs p-2 rounded-lg;",
          "12:       }",
          "14:       > .form-label {",
          "15:         @apply flex flex-col justify-start items-start relative w-full leading-relaxed;",
          "17:         &.input-form-label {",
          "18:           @apply py-3 pb-1;",
          "20:           > input {",
          "21:             @apply w-full p-2 text-sm leading-6 rounded border border-gray-400 bg-transparent;",
          "22:           }",
          "23:         }",
          "24:       }",
          "26:       > .btns-container {",
          "27:         @apply flex flex-row justify-end items-center mt-2 w-full;",
          "29:         > .btn {",
          "30:           @apply text-sm px-4 py-2 rounded ml-2 bg-gray-400;",
          "32:           &:hover {",
          "33:             @apply opacity-80;",
          "34:           }",
          "36:           &.confirm-btn {",
          "37:             @apply bg-green-600 text-white shadow-inner;",
          "38:           }",
          "40:           &.cancel-btn {",
          "41:             background-color: unset;",
          "42:           }",
          "43:         }",
          "44:       }",
          "45:     }",
          "46:   }",
          "47: }",
          "",
          "---------------"
        ],
        "web/src/less/resources-dialog.less||web/src/less/resources-dialog.less": [
          "File: web/src/less/resources-dialog.less -> web/src/less/resources-dialog.less",
          "--- Hunk 1 ---",
          "[Context before]",
          "62:           &.type-text {",
          "63:             @apply col-span-3;",
          "64:           }",
          "65:         }",
          "66:       }",
          "67:     }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "66:           > .form-label {",
          "67:             min-height: 28px;",
          "69:             &.filename-label {",
          "70:             @apply w-full flex flex-row justify-between;",
          "72:               > input {",
          "73:               @apply grow-0 w-40 shadow-inner px-2 mr-2 border rounded leading-7 bg-transparent focus:border-black;",
          "74:               }",
          "76:               > .btns-container {",
          "77:               @apply shrink-0 grow flex flex-row justify-end items-center;",
          "79:                 > .btn {",
          "80:                 @apply text-sm shadow px-2 leading-7 rounded border hover:opacity-80 bg-gray-50;",
          "82:                   &.cancel-btn {",
          "83:                   @apply shadow-none border-none bg-transparent;",
          "84:                   }",
          "86:                   &.confirm-btn {",
          "87:                   @apply bg-green-600 border-green-600 text-white;",
          "88:                   }",
          "89:                 }",
          "90:               }",
          "91:             }",
          "92:           }",
          "",
          "---------------"
        ],
        "web/src/services/resourceService.ts||web/src/services/resourceService.ts": [
          "File: web/src/services/resourceService.ts -> web/src/services/resourceService.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: import * as api from \"../helpers/api\";",
          "3: const convertResponseModelResource = (resource: Resource): Resource => {",
          "4:   return {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2: import store from \"../store\";",
          "3: import { patchResource, setResources } from \"../store/modules/resource\";",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "12:   async getResourceList(): Promise<Resource[]> {",
          "13:     const { data } = (await api.getResourceList()).data;",
          "14:     const resourceList = data.map((m) => convertResponseModelResource(m));",
          "15:     return resourceList;",
          "16:   },",
          "17:   async upload(file: File): Promise<Resource> {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "17:     store.dispatch(setResources(resourceList));",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "30:   async deleteResourceById(id: ResourceId) {",
          "31:     return api.deleteResourceById(id);",
          "32:   },",
          "33: };",
          "35: export default resourceService;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "37:   async patchResource(resourcePatch: ResourcePatch): Promise<Resource> {",
          "38:     const { data } = (await api.patchResource(resourcePatch)).data;",
          "39:     const resource = convertResponseModelResource(data);",
          "40:     store.dispatch(patchResource(resource));",
          "41:     return resource;",
          "42:   },",
          "",
          "---------------"
        ],
        "web/src/store/index.ts||web/src/store/index.ts": [
          "File: web/src/store/index.ts -> web/src/store/index.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "6: import editorReducer from \"./modules/editor\";",
          "7: import shortcutReducer from \"./modules/shortcut\";",
          "8: import locationReducer from \"./modules/location\";",
          "10: const store = configureStore({",
          "11:   reducer: {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "9: import resourceReducer from \"./modules/resource\";",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "15:     editor: editorReducer,",
          "16:     shortcut: shortcutReducer,",
          "17:     location: locationReducer,",
          "18:   },",
          "19: });",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "19:     resource: resourceReducer,",
          "",
          "---------------"
        ],
        "web/src/store/modules/resource.ts||web/src/store/modules/resource.ts": [
          "File: web/src/store/modules/resource.ts -> web/src/store/modules/resource.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: import { createSlice, PayloadAction } from \"@reduxjs/toolkit\";",
          "3: interface State {",
          "4:   resources: Resource[];",
          "5: }",
          "7: const resourceSlice = createSlice({",
          "8:   name: \"resource\",",
          "9:   initialState: {",
          "10:     resources: [],",
          "11:   } as State,",
          "12:   reducers: {",
          "13:     setResources: (state, action: PayloadAction<Resource[]>) => {",
          "14:       return {",
          "15:         ...state,",
          "16:         resources: action.payload,",
          "17:       };",
          "18:     },",
          "19:     patchResource: (state, action: PayloadAction<Partial<Resource>>) => {",
          "20:       return {",
          "21:         ...state,",
          "22:         resources: state.resources.map((resource) => {",
          "23:           if (resource.id === action.payload.id) {",
          "24:             return {",
          "25:               ...resource,",
          "26:               ...action.payload,",
          "27:             };",
          "28:           } else {",
          "29:             return resource;",
          "30:           }",
          "31:         }),",
          "32:       };",
          "33:     },",
          "34:   },",
          "35: });",
          "37: export const { setResources, patchResource } = resourceSlice.actions;",
          "39: export default resourceSlice.reducer;",
          "",
          "---------------"
        ],
        "web/src/types/modules/resource.d.ts||web/src/types/modules/resource.d.ts": [
          "File: web/src/types/modules/resource.d.ts -> web/src/types/modules/resource.d.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "13:   linkedMemoAmount: number;",
          "14: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "16: interface ResourcePatch {",
          "17:   id: ResourceId;",
          "18:   filename?: string;",
          "19: }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "46c13a4b7f675b92d297df6dabb4441f13c7cd9c",
      "candidate_info": {
        "commit_hash": "46c13a4b7f675b92d297df6dabb4441f13c7cd9c",
        "repo": "usememos/memos",
        "commit_url": "https://github.com/usememos/memos/commit/46c13a4b7f675b92d297df6dabb4441f13c7cd9c",
        "files": [
          "server/common.go",
          "server/resource.go",
          "server/server.go",
          "server/version/version.go",
          "server/version/version_test.go",
          "store/db/migration/prod/0.10/00__activity.sql",
          "store/db/migration/prod/LATEST__SCHEMA.sql",
          "web/src/components/EmbedMemoDialog.tsx"
        ],
        "message": "chore: add skipper for secure (#913)",
        "before_after_code_files": [
          "server/common.go||server/common.go",
          "server/resource.go||server/resource.go",
          "server/server.go||server/server.go",
          "server/version/version.go||server/version/version.go",
          "server/version/version_test.go||server/version/version_test.go",
          "store/db/migration/prod/0.10/00__activity.sql||store/db/migration/prod/0.10/00__activity.sql",
          "store/db/migration/prod/LATEST__SCHEMA.sql||store/db/migration/prod/LATEST__SCHEMA.sql",
          "web/src/components/EmbedMemoDialog.tsx||web/src/components/EmbedMemoDialog.tsx"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "server/resource.go||server/resource.go",
            "server/server.go||server/server.go"
          ],
          "candidate": [
            "server/resource.go||server/resource.go",
            "server/server.go||server/server.go"
          ]
        }
      },
      "candidate_diff": {
        "server/common.go||server/common.go": [
          "File: server/common.go -> server/common.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: package server",
          "3: import (",
          "4:  \"github.com/labstack/echo/v4\"",
          "5:  \"github.com/usememos/memos/api\"",
          "6:  \"github.com/usememos/memos/common\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "4:  \"net/http\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "16:  }",
          "17: }",
          "19: func (server *Server) DefaultAuthSkipper(c echo.Context) bool {",
          "20:  ctx := c.Request().Context()",
          "21:  path := c.Path()",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "21: func DefaultGetRequestSkipper(c echo.Context) bool {",
          "22:  return c.Request().Method == http.MethodGet",
          "23: }",
          "",
          "---------------"
        ],
        "server/resource.go||server/resource.go": [
          "File: server/resource.go -> server/resource.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "7:  \"net/http\"",
          "8:  \"net/url\"",
          "9:  \"strconv\"",
          "10:  \"time\"",
          "12:  \"github.com/pkg/errors\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "10:  \"strings\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "266:    return echo.NewHTTPError(http.StatusInternalServerError, fmt.Sprintf(\"Failed to fetch resource ID: %v\", resourceID)).SetInternal(err)",
          "267:   }",
          "270:   c.Response().Writer.WriteHeader(http.StatusOK)",
          "271:   c.Response().Writer.Header().Set(echo.HeaderCacheControl, \"max-age=31536000, immutable\")",
          "272:   c.Response().Writer.Header().Set(echo.HeaderContentSecurityPolicy, \"default-src 'self'\")",
          "",
          "[Removed Lines]",
          "269:   c.Response().Writer.Header().Set(\"Content-Type\", resource.Type)",
          "",
          "[Added Lines]",
          "270:   if strings.HasPrefix(resource.Type, \"text\") || strings.HasPrefix(resource.Type, \"application\") {",
          "271:    c.Response().Writer.Header().Set(\"Content-Type\", echo.MIMETextPlain)",
          "272:   } else {",
          "273:    c.Response().Writer.Header().Set(\"Content-Type\", resource.Type)",
          "274:   }",
          "",
          "---------------"
        ],
        "server/server.go||server/server.go": [
          "File: server/server.go -> server/server.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "65:  e.Use(middleware.CORS())",
          "69:  e.Use(middleware.TimeoutWithConfig(middleware.TimeoutConfig{",
          "70:   Skipper:      middleware.DefaultSkipper,",
          "",
          "[Removed Lines]",
          "67:  e.Use(middleware.Secure())",
          "",
          "[Added Lines]",
          "67:  e.Use(middleware.SecureWithConfig(middleware.SecureConfig{",
          "68:   Skipper:            DefaultGetRequestSkipper,",
          "69:   XSSProtection:      \"1; mode=block\",",
          "70:   ContentTypeNosniff: \"nosniff\",",
          "71:   XFrameOptions:      \"SAMEORIGIN\",",
          "72:   HSTSPreloadEnabled: false,",
          "73:  }))",
          "",
          "---------------"
        ],
        "server/version/version.go||server/version/version.go": [
          "File: server/version/version.go -> server/version/version.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "15: func GetCurrentVersion(mode string) string {",
          "16:  if mode == \"dev\" {",
          "",
          "[Removed Lines]",
          "10: var Version = \"0.9.1\"",
          "13: var DevVersion = \"0.9.1\"",
          "",
          "[Added Lines]",
          "10: var Version = \"0.10.0\"",
          "13: var DevVersion = \"0.10.0\"",
          "",
          "---------------"
        ],
        "server/version/version_test.go||server/version/version_test.go": [
          "File: server/version/version_test.go -> server/version/version_test.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: package version",
          "3: import \"testing\"",
          "5: func TestIsVersionGreaterOrEqualThan(t *testing.T) {",
          "6:  tests := []struct {",
          "7:   version string",
          "8:   target  string",
          "9:   want    bool",
          "10:  }{",
          "11:   {",
          "12:    version: \"0.9.1\",",
          "13:    target:  \"0.9.1\",",
          "14:    want:    true,",
          "15:   },",
          "16:   {",
          "17:    version: \"0.10.0\",",
          "18:    target:  \"0.9.1\",",
          "19:    want:    true,",
          "20:   },",
          "21:   {",
          "22:    version: \"0.9.0\",",
          "23:    target:  \"0.9.1\",",
          "24:    want:    false,",
          "25:   },",
          "26:  }",
          "27:  for _, test := range tests {",
          "28:   result := IsVersionGreaterOrEqualThan(test.version, test.target)",
          "29:   if result != test.want {",
          "30:    t.Errorf(\"got result %v, want %v.\", result, test.want)",
          "31:   }",
          "32:  }",
          "33: }",
          "",
          "---------------"
        ],
        "store/db/migration/prod/0.10/00__activity.sql||store/db/migration/prod/0.10/00__activity.sql": [
          "File: store/db/migration/prod/0.10/00__activity.sql -> store/db/migration/prod/0.10/00__activity.sql",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: -- activity",
          "2: CREATE TABLE activity (",
          "3:   id INTEGER PRIMARY KEY AUTOINCREMENT,",
          "4:   creator_id INTEGER NOT NULL,",
          "5:   created_ts BIGINT NOT NULL DEFAULT (strftime('%s', 'now')),",
          "6:   type TEXT NOT NULL DEFAULT '',",
          "7:   level TEXT NOT NULL CHECK (level IN ('INFO', 'WARN', 'ERROR')) DEFAULT 'INFO',",
          "8:   payload TEXT NOT NULL DEFAULT '{}'",
          "9: );",
          "",
          "---------------"
        ],
        "store/db/migration/prod/LATEST__SCHEMA.sql||store/db/migration/prod/LATEST__SCHEMA.sql": [
          "File: store/db/migration/prod/LATEST__SCHEMA.sql -> store/db/migration/prod/LATEST__SCHEMA.sql",
          "--- Hunk 1 ---",
          "[Context before]",
          "93:   creator_id INTEGER NOT NULL,",
          "94:   UNIQUE(name, creator_id)",
          "95: );",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "97: -- activity",
          "98: CREATE TABLE activity (",
          "99:   id INTEGER PRIMARY KEY AUTOINCREMENT,",
          "100:   creator_id INTEGER NOT NULL,",
          "101:   created_ts BIGINT NOT NULL DEFAULT (strftime('%s', 'now')),",
          "102:   type TEXT NOT NULL DEFAULT '',",
          "103:   level TEXT NOT NULL CHECK (level IN ('INFO', 'WARN', 'ERROR')) DEFAULT 'INFO',",
          "104:   payload TEXT NOT NULL DEFAULT '{}'",
          "105: );",
          "",
          "---------------"
        ],
        "web/src/components/EmbedMemoDialog.tsx||web/src/components/EmbedMemoDialog.tsx": [
          "File: web/src/components/EmbedMemoDialog.tsx -> web/src/components/EmbedMemoDialog.tsx",
          "--- Hunk 1 ---",
          "[Context before]",
          "34:           <code className=\"w-full break-all whitespace-pre-wrap\">{memoEmbeddedCode()}</code>",
          "35:         </pre>",
          "36:         <p className=\"w-full text-sm leading-6 flex flex-row justify-between items-center mt-2\">",
          "38:           <span className=\"btn-primary\" onClick={handleCopyCode}>",
          "39:             Copy",
          "40:           </span>",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "37:           <span className=\"italic opacity-80\">* Only the public memo supports.</span>",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "8c146aed68edcc23d551836ae22602f2a641eeb7",
      "candidate_info": {
        "commit_hash": "8c146aed68edcc23d551836ae22602f2a641eeb7",
        "repo": "usememos/memos",
        "commit_url": "https://github.com/usememos/memos/commit/8c146aed68edcc23d551836ae22602f2a641eeb7",
        "files": [
          "server/resource.go",
          "web/src/components/DailyMemo.tsx",
          "web/src/components/MemoResources.tsx",
          "web/src/components/ShareMemoDialog.tsx",
          "web/src/components/common/SquareDiv.tsx",
          "web/src/less/daily-memo.less",
          "web/src/less/explore.less",
          "web/src/less/home.less",
          "web/src/less/memo-resources.less",
          "web/src/less/share-memo-dialog.less"
        ],
        "message": "feat: update memo resources style (#933)\n\n* feat: update memo resources style\n\n* chore: update",
        "before_after_code_files": [
          "server/resource.go||server/resource.go",
          "web/src/components/DailyMemo.tsx||web/src/components/DailyMemo.tsx",
          "web/src/components/MemoResources.tsx||web/src/components/MemoResources.tsx",
          "web/src/components/ShareMemoDialog.tsx||web/src/components/ShareMemoDialog.tsx",
          "web/src/components/common/SquareDiv.tsx||web/src/components/common/SquareDiv.tsx",
          "web/src/less/daily-memo.less||web/src/less/daily-memo.less",
          "web/src/less/explore.less||web/src/less/explore.less",
          "web/src/less/home.less||web/src/less/home.less",
          "web/src/less/memo-resources.less||web/src/less/memo-resources.less",
          "web/src/less/share-memo-dialog.less||web/src/less/share-memo-dialog.less"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "server/resource.go||server/resource.go"
          ],
          "candidate": [
            "server/resource.go||server/resource.go"
          ]
        }
      },
      "candidate_diff": {
        "server/resource.go||server/resource.go": [
          "File: server/resource.go -> server/resource.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: package server",
          "3: import (",
          "4:  \"encoding/json\"",
          "5:  \"fmt\"",
          "6:  \"io\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "4:  \"bytes\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "267:    return echo.NewHTTPError(http.StatusInternalServerError, fmt.Sprintf(\"Failed to fetch resource ID: %v\", resourceID)).SetInternal(err)",
          "268:   }",
          "270:   if strings.HasPrefix(resource.Type, \"text\") || strings.HasPrefix(resource.Type, \"application\") {",
          "274:   }",
          "276:   c.Response().Writer.Header().Set(echo.HeaderCacheControl, \"max-age=31536000, immutable\")",
          "277:   c.Response().Writer.Header().Set(echo.HeaderContentSecurityPolicy, \"default-src 'self'\")",
          "282:  })",
          "283: }",
          "",
          "[Removed Lines]",
          "271:    c.Response().Writer.Header().Set(\"Content-Type\", echo.MIMETextPlain)",
          "272:   } else {",
          "273:    c.Response().Writer.Header().Set(\"Content-Type\", resource.Type)",
          "275:   c.Response().Writer.WriteHeader(http.StatusOK)",
          "278:   if _, err := c.Response().Writer.Write(resource.Blob); err != nil {",
          "279:    return echo.NewHTTPError(http.StatusInternalServerError, \"Failed to write response\").SetInternal(err)",
          "280:   }",
          "281:   return nil",
          "",
          "[Added Lines]",
          "271:   resourceType := resource.Type",
          "273:    resourceType = echo.MIMETextPlain",
          "277:   return c.Stream(http.StatusOK, resourceType, bytes.NewReader(resource.Blob))",
          "",
          "---------------"
        ],
        "web/src/components/DailyMemo.tsx||web/src/components/DailyMemo.tsx": [
          "File: web/src/components/DailyMemo.tsx -> web/src/components/DailyMemo.tsx",
          "--- Hunk 1 ---",
          "[Context before]",
          "21:       </div>",
          "22:       <div className=\"memo-container\">",
          "23:         <MemoContent content={memo.content} displayConfig={displayConfig} />",
          "25:       </div>",
          "26:       <div className=\"split-line\"></div>",
          "27:     </div>",
          "",
          "[Removed Lines]",
          "24:         <MemoResources resourceList={memo.resourceList} style=\"col\" />",
          "",
          "[Added Lines]",
          "24:         <MemoResources resourceList={memo.resourceList} />",
          "",
          "---------------"
        ],
        "web/src/components/MemoResources.tsx||web/src/components/MemoResources.tsx": [
          "File: web/src/components/MemoResources.tsx -> web/src/components/MemoResources.tsx",
          "--- Hunk 1 ---",
          "[Context before]",
          "2: import Icon from \"./Icon\";",
          "3: import \"../less/memo-resources.less\";",
          "5: interface Props {",
          "6:   resourceList: Resource[];",
          "7:   className?: string;",
          "9: }",
          "11: const getDefaultProps = (): Props => {",
          "12:   return {",
          "13:     className: \"\",",
          "15:     resourceList: [],",
          "16:   };",
          "17: };",
          "19: const MemoResources: React.FC<Props> = (props: Props) => {",
          "21:     ...getDefaultProps(),",
          "22:     ...props,",
          "23:   };",
          "",
          "[Removed Lines]",
          "1: import Image from \"./Image\";",
          "8:   style?: \"row\" | \"col\";",
          "14:     style: \"row\",",
          "20:   const { className, style, resourceList } = {",
          "",
          "[Added Lines]",
          "1: import { absolutifyLink } from \"../helpers/utils\";",
          "3: import SquareDiv from \"./common/SquareDiv\";",
          "4: import showPreviewImageDialog from \"./PreviewImageDialog\";",
          "20:   const { className, resourceList } = {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "35:       return `/o/r/${resource.id}/${resource.filename}`;",
          "36:     });",
          "38:   return (",
          "56:       <div className=\"other-resource-wrapper\">",
          "57:         {otherResourceList.map((resource) => {",
          "58:           return (",
          "",
          "[Removed Lines]",
          "39:     <div className={`resource-wrapper ${className || \"\"}`}>",
          "40:       {availableResourceList.length > 0 && (",
          "41:         <div className={`images-wrapper ${style}`}>",
          "42:           {availableResourceList.map((resource) => {",
          "43:             const url = `/o/r/${resource.id}/${resource.filename}`;",
          "44:             if (resource.type.startsWith(\"image\")) {",
          "45:               return (",
          "46:                 <Image className=\"memo-resource\" key={resource.id} imgUrls={imgUrls} index={imgUrls.findIndex((item) => item === url)} />",
          "47:               );",
          "48:             } else if (resource.type.startsWith(\"video\")) {",
          "49:               return <video className=\"memo-resource\" controls key={resource.id} src={url} />;",
          "50:             } else {",
          "51:               return null;",
          "52:             }",
          "53:           })}",
          "54:         </div>",
          "55:       )}",
          "",
          "[Added Lines]",
          "38:   const handleImageClick = (imgUrl: string) => {",
          "39:     const index = imgUrls.findIndex((url) => url === imgUrl);",
          "40:     showPreviewImageDialog(imgUrls, index);",
          "41:   };",
          "44:     <>",
          "45:       <div className={`resource-wrapper ${className || \"\"}`}>",
          "46:         {availableResourceList.length > 0 && (",
          "47:           <div className=\"images-wrapper\">",
          "48:             {availableResourceList.map((resource) => {",
          "49:               const url = `/o/r/${resource.id}/${resource.filename}`;",
          "50:               if (resource.type.startsWith(\"image\")) {",
          "51:                 return (",
          "52:                   <SquareDiv key={resource.id} className=\"memo-resource\">",
          "53:                     <img src={absolutifyLink(url)} onClick={() => handleImageClick(url)} decoding=\"async\" loading=\"lazy\" />",
          "54:                   </SquareDiv>",
          "55:                 );",
          "56:               } else if (resource.type.startsWith(\"video\")) {",
          "57:                 return (",
          "58:                   <SquareDiv key={resource.id} className=\"memo-resource\">",
          "59:                     <video preload=\"metadata\" controls key={resource.id}>",
          "60:                       <source src={absolutifyLink(url)} type={resource.type} />",
          "61:                     </video>",
          "62:                   </SquareDiv>",
          "63:                 );",
          "64:               } else {",
          "65:                 return null;",
          "66:               }",
          "67:             })}",
          "68:           </div>",
          "69:         )}",
          "70:       </div>",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "63:           );",
          "64:         })}",
          "65:       </div>",
          "67:   );",
          "68: };",
          "",
          "[Removed Lines]",
          "66:     </div>",
          "",
          "[Added Lines]",
          "81:     </>",
          "",
          "---------------"
        ],
        "web/src/components/ShareMemoDialog.tsx||web/src/components/ShareMemoDialog.tsx": [
          "File: web/src/components/ShareMemoDialog.tsx -> web/src/components/ShareMemoDialog.tsx",
          "--- Hunk 1 ---",
          "[Context before]",
          "135:           <span className=\"time-text\">{memo.createdAtStr}</span>",
          "136:           <div className=\"memo-content-wrapper\">",
          "137:             <MemoContent content={memo.content} displayConfig={{ enableExpand: false }} />",
          "139:           </div>",
          "140:           <div className=\"watermark-container\">",
          "141:             <div className=\"userinfo-container\">",
          "",
          "[Removed Lines]",
          "138:             <MemoResources style=\"col\" resourceList={memo.resourceList} />",
          "",
          "[Added Lines]",
          "138:             <MemoResources resourceList={memo.resourceList} />",
          "",
          "---------------"
        ],
        "web/src/components/common/SquareDiv.tsx||web/src/components/common/SquareDiv.tsx": [
          "File: web/src/components/common/SquareDiv.tsx -> web/src/components/common/SquareDiv.tsx",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: import { useEffect, useRef } from \"react\";",
          "3: interface Props {",
          "4:   children: React.ReactNode;",
          "5:   baseSide?: \"width\" | \"height\";",
          "6:   className?: string;",
          "7: }",
          "9: const SquareDiv: React.FC<Props> = (props: Props) => {",
          "10:   const { children, className } = props;",
          "11:   const baseSide = props.baseSide || \"width\";",
          "12:   const squareDivRef = useRef<HTMLDivElement>(null);",
          "14:   useEffect(() => {",
          "15:     const adjustSquareSize = () => {",
          "16:       if (!squareDivRef.current) {",
          "17:         return;",
          "18:       }",
          "20:       if (baseSide === \"width\") {",
          "21:         const width = squareDivRef.current.clientWidth;",
          "22:         squareDivRef.current.style.height = width + \"px\";",
          "23:       } else {",
          "24:         const height = squareDivRef.current.clientHeight;",
          "25:         squareDivRef.current.style.width = height + \"px\";",
          "26:       }",
          "27:     };",
          "29:     adjustSquareSize();",
          "31:     window.addEventListener(\"resize\", adjustSquareSize);",
          "33:     return () => {",
          "34:       window.removeEventListener(\"resize\", adjustSquareSize);",
          "35:     };",
          "36:   }, []);",
          "38:   return (",
          "39:     <div ref={squareDivRef} className={`${[baseSide === \"width\" ? \"w-full\" : \"h-full\", className ?? \"\"].join(\" \")}`}>",
          "40:       {children}",
          "41:     </div>",
          "42:   );",
          "43: };",
          "45: export default SquareDiv;",
          "",
          "---------------"
        ],
        "web/src/less/daily-memo.less||web/src/less/daily-memo.less": [
          "File: web/src/less/daily-memo.less -> web/src/less/daily-memo.less",
          "--- Hunk 1 ---",
          "[Context before]",
          "21:     .memo-content-text {",
          "22:       @apply mt-1;",
          "23:     }",
          "24:   }",
          "25: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "25:     > .resource-wrapper {",
          "26:       > .images-wrapper {",
          "27:         @apply !grid-cols-2;",
          "28:       }",
          "29:     }",
          "",
          "---------------"
        ],
        "web/src/less/explore.less||web/src/less/explore.less": [
          "File: web/src/less/explore.less -> web/src/less/explore.less",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: .page-wrapper.explore {",
          "4:   > .page-container {",
          "5:     @apply relative w-full min-h-full mx-auto flex flex-col justify-start items-center pb-8;",
          "7:     > .page-header {",
          "10:       > .title-container {",
          "11:         @apply flex flex-row justify-start items-center;",
          "",
          "[Removed Lines]",
          "2:   @apply relative top-0 w-full h-full overflow-y-auto overflow-x-hidden bg-zinc-100 dark:bg-zinc-800;",
          "8:       @apply sticky top-0 z-10 max-w-2xl w-full min-h-full flex flex-row justify-between backdrop-blur-sm items-center px-4 sm:pr-6 pt-6 mb-2 ml-calc;",
          "",
          "[Added Lines]",
          "2:   @apply w-full h-full overflow-y-auto overflow-x-hidden bg-zinc-100 dark:bg-zinc-800;",
          "8:       @apply sticky top-0 z-10 max-w-2xl w-full h-auto flex flex-row justify-between backdrop-blur-sm items-center px-4 sm:pr-6 pt-6 mb-2 ml-calc;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "27:     }",
          "29:     > .memos-wrapper {",
          "32:       > .memo-container {",
          "33:         @apply flex flex-col justify-start items-start w-full p-4 mt-2 bg-white dark:bg-zinc-700 rounded-lg border border-white dark:border-zinc-800 hover:border-gray-200 dark:hover:border-zinc-600;",
          "",
          "[Removed Lines]",
          "30:       @apply relative flex-grow max-w-2xl w-full min-h-full flex flex-col justify-start items-start px-4 sm:pr-6 ml-calc;",
          "",
          "[Added Lines]",
          "30:       @apply relative flex-grow max-w-2xl w-full h-auto flex flex-col justify-start items-start px-4 sm:pr-6 ml-calc;",
          "",
          "---------------"
        ],
        "web/src/less/home.less||web/src/less/home.less": [
          "File: web/src/less/home.less -> web/src/less/home.less",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: .page-wrapper.home {",
          "4:   > .banner-wrapper {",
          "5:     @apply w-full flex flex-col justify-start items-center;",
          "",
          "[Removed Lines]",
          "2:   @apply relative top-0 w-full h-full overflow-y-auto overflow-x-hidden bg-zinc-100 dark:bg-zinc-800;",
          "",
          "[Added Lines]",
          "2:   @apply w-full h-full overflow-y-auto overflow-x-hidden bg-zinc-100 dark:bg-zinc-800;",
          "",
          "---------------"
        ],
        "web/src/less/memo-resources.less||web/src/less/memo-resources.less": [
          "File: web/src/less/memo-resources.less -> web/src/less/memo-resources.less",
          "--- Hunk 1 ---",
          "[Context before]",
          "2:   @apply w-full flex flex-col justify-start items-start;",
          "4:   > .images-wrapper {",
          "7:     > .memo-resource {",
          "10:       > img {",
          "12:       }",
          "36:       }",
          "37:     }",
          "38:   }",
          "53:     }",
          "54:   }",
          "55: }",
          "",
          "[Removed Lines]",
          "5:     @apply w-full flex mt-2 pb-1;",
          "8:       @apply w-auto h-auto shrink-0 grow-0 cursor-pointer rounded;",
          "11:         @apply rounded hover:shadow;",
          "13:     }",
          "15:     &.row {",
          "16:       @apply flex-row justify-start items-start overflow-x-auto overflow-y-hidden;",
          "18:       > .memo-resource {",
          "19:         @apply max-w-xs h-auto max-h-40 mr-2 last:mr-0;",
          "21:         > img {",
          "22:           @apply w-auto max-h-40;",
          "23:         }",
          "24:       }",
          "25:     }",
          "27:     &.col {",
          "28:       @apply flex-col justify-start items-start;",
          "30:       > .memo-resource {",
          "31:         @apply w-full h-auto mb-2 last:mb-0;",
          "33:         > img {",
          "34:           @apply w-full h-auto shadow;",
          "35:         }",
          "40:   > .other-resource-wrapper {",
          "41:     @apply w-full flex flex-row justify-start flex-wrap;",
          "43:     > .other-resource-container {",
          "44:       @apply mt-1 mr-1 max-w-full flex flex-row justify-start items-center flex-nowrap bg-gray-100 px-2 py-1 rounded cursor-pointer hover:bg-gray-200;",
          "46:       > .icon-img {",
          "47:         @apply w-4 h-auto mr-1 text-gray-500;",
          "48:       }",
          "50:       > .name-text {",
          "51:         @apply text-gray-500 text-sm max-w-xs truncate font-mono;",
          "52:       }",
          "",
          "[Added Lines]",
          "5:     @apply w-full grid grid-cols-2 sm:grid-cols-3 gap-2 mt-2;",
          "8:       @apply shadow overflow-auto hide-scrollbar;",
          "11:         @apply cursor-pointer rounded min-h-full w-auto min-w-full object-cover;",
          "14:       > video {",
          "15:         @apply cursor-pointer rounded w-full h-full object-contain bg-zinc-100 dark:bg-zinc-800;",
          "19: }",
          "21: .other-resource-wrapper {",
          "22:   @apply w-full flex flex-row justify-start flex-wrap;",
          "24:   > .other-resource-container {",
          "25:     @apply mt-1 mr-1 max-w-full flex flex-row justify-start items-center flex-nowrap bg-gray-100 px-2 py-1 rounded cursor-pointer hover:bg-gray-200;",
          "27:     > .icon-img {",
          "28:       @apply w-4 h-auto mr-1 text-gray-500;",
          "29:     }",
          "31:     > .name-text {",
          "32:       @apply text-gray-500 text-sm max-w-xs truncate font-mono;",
          "",
          "---------------"
        ],
        "web/src/less/share-memo-dialog.less||web/src/less/share-memo-dialog.less": [
          "File: web/src/less/share-memo-dialog.less -> web/src/less/share-memo-dialog.less",
          "--- Hunk 1 ---",
          "[Context before]",
          "48:         > .memo-content-wrapper {",
          "49:           @apply w-full px-6 text-base pb-4;",
          "57:           }",
          "58:         }",
          "",
          "[Removed Lines]",
          "50:         }",
          "52:         > .images-container {",
          "53:           @apply w-full h-auto flex flex-col justify-start items-start px-6 pb-2;",
          "55:           > img {",
          "56:             @apply w-full h-auto mb-2 rounded;",
          "",
          "[Added Lines]",
          "51:           > .resource-wrapper {",
          "52:             > .images-wrapper {",
          "53:               @apply !grid-cols-2;",
          "54:             }",
          "",
          "---------------"
        ]
      }
    }
  ]
}