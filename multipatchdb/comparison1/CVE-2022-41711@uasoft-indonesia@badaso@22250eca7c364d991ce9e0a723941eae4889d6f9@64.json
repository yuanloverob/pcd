{
  "cve_id": "CVE-2022-41711",
  "cve_desc": "Badaso version 2.6.0 allows an unauthenticated remote attacker to execute arbitrary code remotely on the server. This is possible because the application does not properly validate the data uploaded by users.",
  "repo": "uasoft-indonesia/badaso",
  "patch_hash": "22250eca7c364d991ce9e0a723941eae4889d6f9",
  "patch_info": {
    "commit_hash": "22250eca7c364d991ce9e0a723941eae4889d6f9",
    "repo": "uasoft-indonesia/badaso",
    "commit_url": "https://github.com/uasoft-indonesia/badaso/commit/22250eca7c364d991ce9e0a723941eae4889d6f9",
    "files": [
      "src/resources/js/components/BadasoUploadFile.vue",
      "src/resources/js/components/BadasoUploadFileMultiple.vue",
      "src/resources/js/components/BadasoUploadImage.vue",
      "src/resources/js/components/BadasoUploadImageMultiple.vue"
    ],
    "message": "Merge pull request #807 from uasoft-indonesia/bugfix/v2/filter-mimeType\n\nBugfix[v2] add filter mimeType",
    "before_after_code_files": [
      "src/resources/js/components/BadasoUploadFile.vue||src/resources/js/components/BadasoUploadFile.vue",
      "src/resources/js/components/BadasoUploadFileMultiple.vue||src/resources/js/components/BadasoUploadFileMultiple.vue",
      "src/resources/js/components/BadasoUploadImage.vue||src/resources/js/components/BadasoUploadImage.vue",
      "src/resources/js/components/BadasoUploadImageMultiple.vue||src/resources/js/components/BadasoUploadImageMultiple.vue"
    ]
  },
  "patch_diff": {
    "src/resources/js/components/BadasoUploadFile.vue||src/resources/js/components/BadasoUploadFile.vue": [
      "File: src/resources/js/components/BadasoUploadFile.vue -> src/resources/js/components/BadasoUploadFile.vue",
      "--- Hunk 1 ---",
      "[Context before]",
      "336:           });",
      "337:           return;",
      "338:         }",
      "340:         this.uploadFile(files[0]);",
      "341:       }",
      "342:     },",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "339:         if (!this.availableMimetypes.file.validMime.includes(files[0].type)) {",
      "340:           this.$vs.notify({",
      "341:             title: this.$t(\"alert.danger\"),",
      "342:             text: \"File type not allowed\",",
      "343:             color: \"danger\",",
      "344:           });",
      "345:           return;",
      "346:         }",
      "",
      "---------------"
    ],
    "src/resources/js/components/BadasoUploadFileMultiple.vue||src/resources/js/components/BadasoUploadFileMultiple.vue": [
      "File: src/resources/js/components/BadasoUploadFileMultiple.vue -> src/resources/js/components/BadasoUploadFileMultiple.vue",
      "--- Hunk 1 ---",
      "[Context before]",
      "367:             });",
      "368:             return;",
      "369:           }",
      "371:           this.uploadFile(file);",
      "372:         }",
      "373:       }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "370:           if (!this.availableMimetypes.file.validMime.includes(file.type)) {",
      "371:             this.$vs.notify({",
      "372:               title: this.$t(\"alert.danger\"),",
      "373:               text: \"File type not allowed\",",
      "374:               color: \"danger\",",
      "375:             });",
      "376:             return;",
      "377:           }",
      "",
      "---------------"
    ],
    "src/resources/js/components/BadasoUploadImage.vue||src/resources/js/components/BadasoUploadImage.vue": [
      "File: src/resources/js/components/BadasoUploadImage.vue -> src/resources/js/components/BadasoUploadImage.vue",
      "--- Hunk 1 ---",
      "[Context before]",
      "380:           });",
      "381:           return;",
      "382:         }",
      "384:         this.uploadImage(files[0]);",
      "385:       }",
      "386:     },",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "383:         if (!this.availableMimetypes.image.validMime.includes(files[0].type)){",
      "384:           this.$vs.notify({",
      "385:             title: this.$t(\"alert.danger\"),",
      "386:             text: \"File type not allowed\",",
      "387:             color: \"danger\",",
      "388:           });",
      "389:           return;",
      "390:         }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "421:     uploadImage(file) {",
      "422:       const files = new FormData();",
      "423:       files.append(\"upload\", file);",
      "425:       files.append(\"working_dir\", this.getActiveFolder);",
      "426:       this.$api.badasoFile",
      "427:         .uploadUsingLfm(files)",
      "",
      "[Removed Lines]",
      "424:       files.append(\"type\", \"image\");",
      "",
      "[Added Lines]",
      "431:       files.append(\"type\", file.type);",
      "",
      "---------------"
    ],
    "src/resources/js/components/BadasoUploadImageMultiple.vue||src/resources/js/components/BadasoUploadImageMultiple.vue": [
      "File: src/resources/js/components/BadasoUploadImageMultiple.vue -> src/resources/js/components/BadasoUploadImageMultiple.vue",
      "--- Hunk 1 ---",
      "[Context before]",
      "395:             });",
      "396:             return;",
      "397:           }",
      "399:           this.uploadImage(file);",
      "400:         }",
      "401:       }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "398:           if (!this.availableMimetypes.image.validMime.includes(file.type)) {",
      "399:             this.$vs.notify({",
      "400:               title: this.$t(\"alert.danger\"),",
      "401:               text: \"File type not allowed\",",
      "402:               color: \"danger\",",
      "403:             });",
      "404:             return;",
      "405:           }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "73d88dca620d1a67b76d3fb9dc7017bed764d621",
      "candidate_info": {
        "commit_hash": "73d88dca620d1a67b76d3fb9dc7017bed764d621",
        "repo": "uasoft-indonesia/badaso",
        "commit_url": "https://github.com/uasoft-indonesia/badaso/commit/73d88dca620d1a67b76d3fb9dc7017bed764d621",
        "files": [
          "src/resources/js/pages/crud-generated/browse.vue"
        ],
        "message": "delete comment",
        "before_after_code_files": [
          "src/resources/js/pages/crud-generated/browse.vue||src/resources/js/pages/crud-generated/browse.vue"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/uasoft-indonesia/badaso/pull/1086"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/resources/js/pages/crud-generated/browse.vue||src/resources/js/pages/crud-generated/browse.vue": [
          "File: src/resources/js/pages/crud-generated/browse.vue -> src/resources/js/pages/crud-generated/browse.vue",
          "--- Hunk 1 ---",
          "[Context before]",
          "867:         });",
          "868:         this.$closeLoader();",
          "869:         this.data = response.data;",
          "871:         this.records = response.data.data;",
          "872:         this.records.map((record) => {",
          "873:           if (record.createdAt || record.updatedAt) {",
          "",
          "[Removed Lines]",
          "870:         console.log(this.data,'data')",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "39d7ade1c656b69d68db7070420d1b91a312397f",
      "candidate_info": {
        "commit_hash": "39d7ade1c656b69d68db7070420d1b91a312397f",
        "repo": "uasoft-indonesia/badaso",
        "commit_url": "https://github.com/uasoft-indonesia/badaso/commit/39d7ade1c656b69d68db7070420d1b91a312397f",
        "files": [
          "src/Controllers/BadasoDatabaseController.php"
        ],
        "message": "Update BadasoDatabaseController.php",
        "before_after_code_files": [
          "src/Controllers/BadasoDatabaseController.php||src/Controllers/BadasoDatabaseController.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/uasoft-indonesia/badaso/pull/1086"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/Controllers/BadasoDatabaseController.php||src/Controllers/BadasoDatabaseController.php": [
          "File: src/Controllers/BadasoDatabaseController.php -> src/Controllers/BadasoDatabaseController.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "190:                     return ApiResponse::failed(__('badaso::validation.database.migration_failed'));",
          "191:             }",
          "193:         } catch (Exception $e) {",
          "194:             if (isset($this->file_name)) {",
          "195:                 foreach ($this->file_name as $name) {",
          "",
          "[Removed Lines]",
          "192:             dd($exitCode);",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "8f8ff9aa28f19eb885251562869880dee1c79231",
      "candidate_info": {
        "commit_hash": "8f8ff9aa28f19eb885251562869880dee1c79231",
        "repo": "uasoft-indonesia/badaso",
        "commit_url": "https://github.com/uasoft-indonesia/badaso/commit/8f8ff9aa28f19eb885251562869880dee1c79231",
        "files": [
          "tests/Feature/BadasoApiCrudManagementTest.php"
        ],
        "message": "wip",
        "before_after_code_files": [
          "tests/Feature/BadasoApiCrudManagementTest.php||tests/Feature/BadasoApiCrudManagementTest.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/uasoft-indonesia/badaso/pull/1086"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "tests/Feature/BadasoApiCrudManagementTest.php||tests/Feature/BadasoApiCrudManagementTest.php": [
          "File: tests/Feature/BadasoApiCrudManagementTest.php -> tests/Feature/BadasoApiCrudManagementTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "430:             $model = '';",
          "431:             $model_data = [];",
          "434:                 $fillable = join(',', $const_fillable);",
          "435:                 $model_name = str_replace([' ', '_'], '', ucwords($table_name));",
          "",
          "[Removed Lines]",
          "432:             if (rand(0, 1)) {",
          "",
          "[Added Lines]",
          "432:             if (rand(0, 1) || $table_names[0]) {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "041f7296b77c105c29172ec6c43de007c91616cf",
      "candidate_info": {
        "commit_hash": "041f7296b77c105c29172ec6c43de007c91616cf",
        "repo": "uasoft-indonesia/badaso",
        "commit_url": "https://github.com/uasoft-indonesia/badaso/commit/041f7296b77c105c29172ec6c43de007c91616cf",
        "files": [
          "src/Controllers/BadasoDatabaseController.php"
        ],
        "message": "Fix prod artisan command",
        "before_after_code_files": [
          "src/Controllers/BadasoDatabaseController.php||src/Controllers/BadasoDatabaseController.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/uasoft-indonesia/badaso/pull/1086"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/Controllers/BadasoDatabaseController.php||src/Controllers/BadasoDatabaseController.php": [
          "File: src/Controllers/BadasoDatabaseController.php -> src/Controllers/BadasoDatabaseController.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "157:             }",
          "159:             $exitCode = Artisan::call('migrate', [",
          "161:             ]);",
          "163:             switch ($exitCode) {",
          "",
          "[Removed Lines]",
          "160:                 '--path' => 'database/migrations/badaso/',",
          "",
          "[Added Lines]",
          "160:                 '--path' => 'database/migrations/badaso/', '--force' => true,",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "216:             $this->file_name = $this->file_generator->generateBDOMigrationFile($request->table, 'drop', $rows);",
          "218:             $exitCode = Artisan::call('migrate', [",
          "220:             ]);",
          "222:             switch ($exitCode) {",
          "",
          "[Removed Lines]",
          "219:                 '--path' => 'database/migrations/badaso/',",
          "",
          "[Added Lines]",
          "219:                 '--path' => 'database/migrations/badaso/', '--force' => true,",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "252:             $exitCode = Artisan::call('migrate:rollback', [",
          "253:                 '--path' => 'database/migrations/badaso/',",
          "254:                 '--step' => $request->step,",
          "255:             ]);",
          "257:             switch ($exitCode) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "255:                 '--force' => true,",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "3dcadcdd11ace1dad3d5237a380a4f1d021b3327",
      "candidate_info": {
        "commit_hash": "3dcadcdd11ace1dad3d5237a380a4f1d021b3327",
        "repo": "uasoft-indonesia/badaso",
        "commit_url": "https://github.com/uasoft-indonesia/badaso/commit/3dcadcdd11ace1dad3d5237a380a4f1d021b3327",
        "files": [
          "src/ContentManager/FileGenerator.php"
        ],
        "message": "bugfix [v2] drop-new-foreign-key",
        "before_after_code_files": [
          "src/ContentManager/FileGenerator.php||src/ContentManager/FileGenerator.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/uasoft-indonesia/badaso/pull/1086"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/ContentManager/FileGenerator.php||src/ContentManager/FileGenerator.php": [
          "File: src/ContentManager/FileGenerator.php -> src/ContentManager/FileGenerator.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "355:             $schema_down .= $this->migration_parser->getAlterMigrationRelationshipSchemaDown($table, $relations).PHP_EOL;",
          "356:         }",
          "357:         if (array_key_exists('modified_relations', $relations) && count($relations['modified_relations']) > 0) {",
          "360:         }",
          "362:         $schema_down .= $this->migration_parser->getAlterMigrationSchemaDown($table, $rows, $prefix, $relations);",
          "",
          "[Removed Lines]",
          "358:             $schema_up .= $this->migration_parser->getAlterMigrationRelationshipSchemaUp($table, $relations);",
          "359:             $schema_down .= $this->migration_parser->getAlterMigrationRelationshipSchemaDown($table, $relations).PHP_EOL;",
          "",
          "[Added Lines]",
          "358:             if($schema_up != $this->migration_parser->getAlterMigrationRelationshipSchemaUp($table, $relations) && $schema_down != $this->migration_parser->getAlterMigrationRelationshipSchemaDown($table, $relations).PHP_EOL){",
          "359:                 $schema_up .= $this->migration_parser->getAlterMigrationRelationshipSchemaUp($table, $relations);",
          "360:                 $schema_down .= $this->migration_parser->getAlterMigrationRelationshipSchemaDown($table, $relations).PHP_EOL;",
          "361:             };",
          "",
          "---------------"
        ]
      }
    }
  ]
}