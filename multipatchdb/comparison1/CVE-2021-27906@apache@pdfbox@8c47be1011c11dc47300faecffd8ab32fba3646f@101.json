{
  "cve_id": "CVE-2021-27906",
  "cve_desc": "A carefully crafted PDF file can trigger an OutOfMemory-Exception while loading the file. This issue affects Apache PDFBox version 2.0.22 and prior 2.0.x versions.",
  "repo": "apache/pdfbox",
  "patch_hash": "8c47be1011c11dc47300faecffd8ab32fba3646f",
  "patch_info": {
    "commit_hash": "8c47be1011c11dc47300faecffd8ab32fba3646f",
    "repo": "apache/pdfbox",
    "commit_url": "https://github.com/apache/pdfbox/commit/8c47be1011c11dc47300faecffd8ab32fba3646f",
    "files": [
      "pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java"
    ],
    "message": "PDFBOX-5112: SonarCube fix, throw NoSuchElementException if no more elements are available\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1887295 13f79535-47bb-0310-9956-ffa450edef68",
    "before_after_code_files": [
      "pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java||pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java"
    ]
  },
  "patch_diff": {
    "pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java||pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java": [
      "File: pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java -> pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java",
      "--- Hunk 1 ---",
      "[Context before]",
      "19: import java.io.IOException;",
      "20: import java.util.Arrays;",
      "21: import java.util.Iterator;",
      "23: import org.apache.pdfbox.cos.COSArray;",
      "24: import org.apache.pdfbox.cos.COSBase;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "22: import java.util.NoSuchElementException;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "212:         @Override",
      "213:         public Long next()",
      "214:         {",
      "215:             if (currentNumber < currentEnd)",
      "216:             {",
      "217:                 return currentNumber++;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "216:             if (currentNumber >= maxValue)",
      "217:             {",
      "218:                 throw new NoSuchElementException();",
      "219:             }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "90edd89c0962dd2ea5bfe5dac0883b0da2ed7eb0",
      "candidate_info": {
        "commit_hash": "90edd89c0962dd2ea5bfe5dac0883b0da2ed7eb0",
        "repo": "apache/pdfbox",
        "commit_url": "https://github.com/apache/pdfbox/commit/90edd89c0962dd2ea5bfe5dac0883b0da2ed7eb0",
        "files": [
          "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/PDTriangleBasedShadingType.java"
        ],
        "message": "PDFBOX-5134: speed up by returning empty bounding box instead of null if no triangles\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1888291 13f79535-47bb-0310-9956-ffa450edef68",
        "before_after_code_files": [
          "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/PDTriangleBasedShadingType.java||pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/PDTriangleBasedShadingType.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/pdfbox/pull/104"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/PDTriangleBasedShadingType.java||pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/PDTriangleBasedShadingType.java": [
          "File: pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/PDTriangleBasedShadingType.java -> pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/PDTriangleBasedShadingType.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "241:             bounds.add(shadedTriangle.corner[1]);",
          "242:             bounds.add(shadedTriangle.corner[2]);",
          "243:         }",
          "244:         return bounds;",
          "245:     }",
          "246: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "244:         if (bounds == null)",
          "245:         {",
          "247:             return new Rectangle2D.Float();",
          "248:         }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "e261c37d25eeed53e74c34bed32046a0d61c1808",
      "candidate_info": {
        "commit_hash": "e261c37d25eeed53e74c34bed32046a0d61c1808",
        "repo": "apache/pdfbox",
        "commit_url": "https://github.com/apache/pdfbox/commit/e261c37d25eeed53e74c34bed32046a0d61c1808",
        "files": [
          "preflight/src/main/java/org/apache/pdfbox/preflight/xobject/XObjFormValidator.java"
        ],
        "message": "PDFBOX-4892: use constant\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1890705 13f79535-47bb-0310-9956-ffa450edef68",
        "before_after_code_files": [
          "preflight/src/main/java/org/apache/pdfbox/preflight/xobject/XObjFormValidator.java||preflight/src/main/java/org/apache/pdfbox/preflight/xobject/XObjFormValidator.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/pdfbox/pull/104"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "preflight/src/main/java/org/apache/pdfbox/preflight/xobject/XObjFormValidator.java||preflight/src/main/java/org/apache/pdfbox/preflight/xobject/XObjFormValidator.java": [
          "File: preflight/src/main/java/org/apache/pdfbox/preflight/xobject/XObjFormValidator.java -> preflight/src/main/java/org/apache/pdfbox/preflight/xobject/XObjFormValidator.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "85:     protected void checkMandatoryFields()",
          "86:     {",
          "87:         boolean lastMod = this.xobject.getItem(COSName.LAST_MODIFIED) != null;",
          "90:         if (lastMod ^ pieceInfo)",
          "91:         {",
          "",
          "[Removed Lines]",
          "88:         boolean pieceInfo = this.xobject.getItem(\"PieceInfo\") != null;",
          "",
          "[Added Lines]",
          "88:         boolean pieceInfo = this.xobject.getItem(COSName.PIECE_INFO) != null;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "dcd36e97ea375a6e6425e88a2ac6b94dfa99e9dc",
      "candidate_info": {
        "commit_hash": "dcd36e97ea375a6e6425e88a2ac6b94dfa99e9dc",
        "repo": "apache/pdfbox",
        "commit_url": "https://github.com/apache/pdfbox/commit/dcd36e97ea375a6e6425e88a2ac6b94dfa99e9dc",
        "files": [
          "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/blend/BlendComposite.java"
        ],
        "message": "PDFBOX-4892: remove unneeded code, as suggested by valerybokov\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1889730 13f79535-47bb-0310-9956-ffa450edef68",
        "before_after_code_files": [
          "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/blend/BlendComposite.java||pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/blend/BlendComposite.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/pdfbox/pull/104"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/blend/BlendComposite.java||pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/blend/BlendComposite.java": [
          "File: pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/blend/BlendComposite.java -> pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/blend/BlendComposite.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "75:     private BlendComposite(BlendMode blendMode, float constantAlpha)",
          "76:     {",
          "78:         this.blendMode = blendMode;",
          "79:         this.constantAlpha = constantAlpha;",
          "80:     }",
          "",
          "[Removed Lines]",
          "77:         super();",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "83:     public CompositeContext createContext(ColorModel srcColorModel, ColorModel dstColorModel,",
          "84:             RenderingHints hints)",
          "85:     {",
          "87:     }",
          "89:     class BlendCompositeContext implements CompositeContext",
          "90:     {",
          "91:         private final ColorModel srcColorModel;",
          "92:         private final ColorModel dstColorModel;",
          "97:         {",
          "98:             this.srcColorModel = srcColorModel;",
          "99:             this.dstColorModel = dstColorModel;",
          "101:         }",
          "103:         @Override",
          "",
          "[Removed Lines]",
          "86:         return new BlendCompositeContext(srcColorModel, dstColorModel, hints);",
          "93:         private final RenderingHints hints;",
          "95:         BlendCompositeContext(ColorModel srcColorModel, ColorModel dstColorModel,",
          "96:                 RenderingHints hints)",
          "100:             this.hints = hints;",
          "",
          "[Added Lines]",
          "85:         return new BlendCompositeContext(srcColorModel, dstColorModel);",
          "93:         BlendCompositeContext(ColorModel srcColorModel, ColorModel dstColorModel)",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "1b414d40c69c4d8006b9bb1b4968eb0b79dcf021",
      "candidate_info": {
        "commit_hash": "1b414d40c69c4d8006b9bb1b4968eb0b79dcf021",
        "repo": "apache/pdfbox",
        "commit_url": "https://github.com/apache/pdfbox/commit/1b414d40c69c4d8006b9bb1b4968eb0b79dcf021",
        "files": [
          "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/interactive/form/AppearanceGeneratorHelper.java"
        ],
        "message": "PDFBOX-5060: use formatted value for line replacement as suggested by Laurent Berteau\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1885472 13f79535-47bb-0310-9956-ffa450edef68",
        "before_after_code_files": [
          "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/interactive/form/AppearanceGeneratorHelper.java||pdfbox/src/main/java/org/apache/pdfbox/pdmodel/interactive/form/AppearanceGeneratorHelper.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/pdfbox/pull/104"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/interactive/form/AppearanceGeneratorHelper.java||pdfbox/src/main/java/org/apache/pdfbox/pdmodel/interactive/form/AppearanceGeneratorHelper.java": [
          "File: pdfbox/src/main/java/org/apache/pdfbox/pdmodel/interactive/form/AppearanceGeneratorHelper.java -> pdfbox/src/main/java/org/apache/pdfbox/pdmodel/interactive/form/AppearanceGeneratorHelper.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "168:         if (field instanceof PDTextField && !((PDTextField) field).isMultiline()) {",
          "170:         }",
          "172:         for (PDAnnotationWidget widget : field.getWidgets()) {",
          "",
          "[Removed Lines]",
          "169:             value = apValue.replaceAll(\"\\\\u000D\\\\u000A|[\\\\u000A\\\\u000B\\\\u000C\\\\u000D\\\\u0085\\\\u2028\\\\u2029]\", \" \");",
          "",
          "[Added Lines]",
          "169:             value = value.replaceAll(\"\\\\u000D\\\\u000A|[\\\\u000A\\\\u000B\\\\u000C\\\\u000D\\\\u0085\\\\u2028\\\\u2029]\", \" \");",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "4f7f1112e394acd2808ed2092f4d492bf649fdc2",
      "candidate_info": {
        "commit_hash": "4f7f1112e394acd2808ed2092f4d492bf649fdc2",
        "repo": "apache/pdfbox",
        "commit_url": "https://github.com/apache/pdfbox/commit/4f7f1112e394acd2808ed2092f4d492bf649fdc2",
        "files": [
          "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/PageLayout.java"
        ],
        "message": "PDFBOX-4892: fix javadoc\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1891612 13f79535-47bb-0310-9956-ffa450edef68",
        "before_after_code_files": [
          "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/PageLayout.java||pdfbox/src/main/java/org/apache/pdfbox/pdmodel/PageLayout.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/pdfbox/pull/104"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/PageLayout.java||pdfbox/src/main/java/org/apache/pdfbox/pdmodel/PageLayout.java": [
          "File: pdfbox/src/main/java/org/apache/pdfbox/pdmodel/PageLayout.java -> pdfbox/src/main/java/org/apache/pdfbox/pdmodel/PageLayout.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "18: package org.apache.pdfbox.pdmodel;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "20: import org.apache.pdfbox.pdmodel.interactive.viewerpreferences.PDViewerPreferences;",
          "",
          "---------------"
        ]
      }
    }
  ]
}