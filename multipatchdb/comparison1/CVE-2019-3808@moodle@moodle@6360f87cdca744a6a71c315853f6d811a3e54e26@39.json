{
  "cve_id": "CVE-2019-3808",
  "cve_desc": "A flaw was found in Moodle versions 3.6 to 3.6.1, 3.5 to 3.5.3, 3.4 to 3.4.6, 3.1 to 3.1.15 and earlier unsupported versions. The 'manage groups' capability did not have the 'XSS risk' flag assigned to it, but does have that access in certain places. Note that the capability is intended for use by trusted users, and is only assigned to teachers and managers by default.",
  "repo": "moodle/moodle",
  "patch_hash": "6360f87cdca744a6a71c315853f6d811a3e54e26",
  "patch_info": {
    "commit_hash": "6360f87cdca744a6a71c315853f6d811a3e54e26",
    "repo": "moodle/moodle",
    "commit_url": "https://github.com/moodle/moodle/commit/6360f87cdca744a6a71c315853f6d811a3e54e26",
    "files": [
      "lib/db/access.php",
      "version.php"
    ],
    "message": "MDL-64395 groups: Added XSS Risk to the manage groups capability",
    "before_after_code_files": [
      "lib/db/access.php||lib/db/access.php",
      "version.php||version.php"
    ]
  },
  "patch_diff": {
    "lib/db/access.php||lib/db/access.php": [
      "File: lib/db/access.php -> lib/db/access.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "1123:     ),",
      "1125:     'moodle/course:managegroups' => array(",
      "1127:         'captype' => 'write',",
      "1128:         'contextlevel' => CONTEXT_COURSE,",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1126:         'riskbitmask' => RISK_XSS,",
      "",
      "---------------"
    ],
    "version.php||version.php": [
      "File: version.php -> version.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "30: defined('MOODLE_INTERNAL') || die();",
      "",
      "[Removed Lines]",
      "32: $version  = 2018122000.01;              // YYYYMMDD      = weekly release date of this DEV branch.",
      "",
      "[Added Lines]",
      "32: $version  = 2018122000.02;              // YYYYMMDD      = weekly release date of this DEV branch.",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "adc5449399f87d4f32c706f0f3791dd4b02f2b80",
      "candidate_info": {
        "commit_hash": "adc5449399f87d4f32c706f0f3791dd4b02f2b80",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/adc5449399f87d4f32c706f0f3791dd4b02f2b80",
        "files": [
          "version.php"
        ],
        "message": "MDL-67199 versions: main version bump",
        "before_after_code_files": [
          "version.php||version.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.php||version.php"
          ],
          "candidate": [
            "version.php||version.php"
          ]
        }
      },
      "candidate_diff": {
        "version.php||version.php": [
          "File: version.php -> version.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "30: defined('MOODLE_INTERNAL') || die();",
          "35: $release  = '3.8beta (Build: 20191112)'; // Human-friendly version name",
          "",
          "[Removed Lines]",
          "32: $version  = 2019111200.00;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "",
          "[Added Lines]",
          "32: $version  = 2019111300.00;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "8b019fb70930c48cda037968d3257edc222f8143",
      "candidate_info": {
        "commit_hash": "8b019fb70930c48cda037968d3257edc222f8143",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/8b019fb70930c48cda037968d3257edc222f8143",
        "files": [
          "version.php"
        ],
        "message": "on-demand release 3.6dev+",
        "before_after_code_files": [
          "version.php||version.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.php||version.php"
          ],
          "candidate": [
            "version.php||version.php"
          ]
        }
      },
      "candidate_diff": {
        "version.php||version.php": [
          "File: version.php -> version.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "30: defined('MOODLE_INTERNAL') || die();",
          "38: $branch   = '36';                       // This version's branch.",
          "39: $maturity = MATURITY_ALPHA;             // This version's maturity level.",
          "",
          "[Removed Lines]",
          "32: $version  = 2018103000.00;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "36: $release  = '3.6dev+ (Build: 20181027)'; // Human-friendly version name",
          "",
          "[Added Lines]",
          "32: $version  = 2018103100.00;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "36: $release  = '3.6dev+ (Build: 20181031)'; // Human-friendly version name",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "6e8eb9c0b22b39252013422c8ce451cbf8f88b2c",
      "candidate_info": {
        "commit_hash": "6e8eb9c0b22b39252013422c8ce451cbf8f88b2c",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/6e8eb9c0b22b39252013422c8ce451cbf8f88b2c",
        "files": [
          "version.php"
        ],
        "message": "weekly release 3.7.3+",
        "before_after_code_files": [
          "version.php||version.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.php||version.php"
          ],
          "candidate": [
            "version.php||version.php"
          ]
        }
      },
      "candidate_diff": {
        "version.php||version.php": [
          "File: version.php -> version.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "30: defined('MOODLE_INTERNAL') || die();",
          "38: $branch   = '37';                       // This version's branch.",
          "39: $maturity = MATURITY_STABLE;             // This version's maturity level.",
          "",
          "[Removed Lines]",
          "32: $version  = 2019052003.06;              // 20190520      = branching date YYYYMMDD - do not modify!",
          "36: $release  = '3.7.3+ (Build: 20191212)'; // Human-friendly version name",
          "",
          "[Added Lines]",
          "32: $version  = 2019052003.07;              // 20190520      = branching date YYYYMMDD - do not modify!",
          "36: $release  = '3.7.3+ (Build: 20191220)'; // Human-friendly version name",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "a12f9f93c4317acf1c1e94c625e37ae1b7a65fcf",
      "candidate_info": {
        "commit_hash": "a12f9f93c4317acf1c1e94c625e37ae1b7a65fcf",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/a12f9f93c4317acf1c1e94c625e37ae1b7a65fcf",
        "files": [
          "admin/cli/install.php",
          "admin/tool/mobile/tests/externallib_test.php",
          "install.php",
          "lib/db/upgrade.php",
          "lib/pagelib.php",
          "lib/phpunit/tests/basic_test.php",
          "lib/setup.php",
          "lib/tests/outputcomponents_test.php",
          "lib/upgrade.txt",
          "version.php"
        ],
        "message": "Merge branch 'MDL-46267-master' of git://github.com/junpataleta/moodle",
        "before_after_code_files": [
          "admin/cli/install.php||admin/cli/install.php",
          "admin/tool/mobile/tests/externallib_test.php||admin/tool/mobile/tests/externallib_test.php",
          "install.php||install.php",
          "lib/db/upgrade.php||lib/db/upgrade.php",
          "lib/pagelib.php||lib/pagelib.php",
          "lib/phpunit/tests/basic_test.php||lib/phpunit/tests/basic_test.php",
          "lib/setup.php||lib/setup.php",
          "lib/tests/outputcomponents_test.php||lib/tests/outputcomponents_test.php",
          "version.php||version.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.php||version.php"
          ],
          "candidate": [
            "version.php||version.php"
          ]
        }
      },
      "candidate_diff": {
        "admin/cli/install.php||admin/cli/install.php": [
          "File: admin/cli/install.php -> admin/cli/install.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "157: $CFG->dirroot              = dirname(dirname(__DIR__));",
          "158: $CFG->libdir               = \"$CFG->dirroot/lib\";",
          "159: $CFG->wwwroot              = \"http://localhost\";",
          "161: $CFG->docroot              = 'http://docs.moodle.org';",
          "162: $CFG->running_installer    = true;",
          "163: $CFG->early_install_lang   = true;",
          "",
          "[Removed Lines]",
          "160: $CFG->httpswwwroot         = $CFG->wwwroot;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "389:     }",
          "390: }",
          "391: $CFG->wwwroot       = $wwwroot;",
          "396: $CFG->dataroot = $options['dataroot'];",
          "",
          "[Removed Lines]",
          "392: $CFG->httpswwwroot  = $CFG->wwwroot;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "admin/tool/mobile/tests/externallib_test.php||admin/tool/mobile/tests/externallib_test.php": [
          "File: admin/tool/mobile/tests/externallib_test.php -> admin/tool/mobile/tests/externallib_test.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "72:         $expected = array(",
          "73:             'wwwroot' => $CFG->wwwroot,",
          "75:             'sitename' => external_format_string($SITE->fullname, $context->id, true),",
          "76:             'guestlogin' => $CFG->guestloginbutton,",
          "77:             'rememberusername' => $CFG->rememberusername,",
          "",
          "[Removed Lines]",
          "74:             'httpswwwroot' => $CFG->httpswwwroot,",
          "",
          "[Added Lines]",
          "74:             'httpswwwroot' => $CFG->wwwroot,",
          "",
          "---------------"
        ],
        "install.php||install.php": [
          "File: install.php -> install.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "160: $CFG->dirroot              = __DIR__;",
          "161: $CFG->libdir               = \"$CFG->dirroot/lib\";",
          "162: $CFG->wwwroot              = install_guess_wwwroot(); // can not be changed - ppl must use the real address when installing",
          "164: $CFG->dataroot             = $config->dataroot;",
          "165: $CFG->tempdir              = $CFG->dataroot.'/temp';",
          "166: $CFG->backuptempdir        = $CFG->tempdir.'/backup';",
          "",
          "[Removed Lines]",
          "163: $CFG->httpswwwroot         = $CFG->wwwroot;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "lib/db/upgrade.php||lib/db/upgrade.php": [
          "File: lib/db/upgrade.php -> lib/db/upgrade.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "3447:         upgrade_main_savepoint(true, 2019072500.01);",
          "3448:     }",
          "3450:     return true;",
          "3451: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3450:     if ($oldversion < 2019072500.03) {",
          "3451:         unset_config('httpswwwroot');",
          "3453:         upgrade_main_savepoint(true, 2019072500.03);",
          "3454:     }",
          "",
          "---------------"
        ],
        "lib/pagelib.php||lib/pagelib.php": [
          "File: lib/pagelib.php -> lib/pagelib.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "1460:     }",
          "1471:     public function https_required() {",
          "1473:     }",
          "1484:     public function verify_https_required() {",
          "1486:     }",
          "",
          "[Removed Lines]",
          "1472:         debugging('https_required() has been deprecated. It no longer needs to be called.', DEBUG_DEVELOPER);",
          "1485:         debugging('verify_https_required() has been deprecated. It no longer needs to be called.', DEBUG_DEVELOPER);",
          "",
          "[Added Lines]",
          "1466:         throw new coding_exception('https_required() cannot be used anymore.');",
          "1473:         throw new coding_exception('verify_https_required() cannot be used anymore.');",
          "",
          "---------------"
        ],
        "lib/phpunit/tests/basic_test.php||lib/phpunit/tests/basic_test.php": [
          "File: lib/phpunit/tests/basic_test.php -> lib/phpunit/tests/basic_test.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "53:     public function test_bootstrap() {",
          "54:         global $CFG;",
          "58:         $this->assertEquals($CFG->prefix, $CFG->phpunit_prefix);",
          "59:     }",
          "",
          "[Removed Lines]",
          "56:         $this->assertTrue(isset($CFG->httpswwwroot));",
          "57:         $this->assertEquals($CFG->httpswwwroot, $CFG->wwwroot);",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "lib/setup.php||lib/setup.php": [
          "File: lib/setup.php -> lib/setup.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "535: global $SCRIPT;",
          "541: require_once($CFG->libdir .'/setuplib.php');        // Functions that MUST be loaded first",
          "543: if (NO_OUTPUT_BUFFERING) {",
          "",
          "[Removed Lines]",
          "539: $CFG->httpswwwroot = $CFG->wwwroot;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "lib/tests/outputcomponents_test.php||lib/tests/outputcomponents_test.php": [
          "File: lib/tests/outputcomponents_test.php -> lib/tests/outputcomponents_test.php"
        ],
        "version.php||version.php": [
          "File: version.php -> version.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "30: defined('MOODLE_INTERNAL') || die();",
          "",
          "[Removed Lines]",
          "32: $version  = 2019072500.02;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "",
          "[Added Lines]",
          "32: $version  = 2019072500.03;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "69f2118621d46f88b4c9436baea2db51a306ce37",
      "candidate_info": {
        "commit_hash": "69f2118621d46f88b4c9436baea2db51a306ce37",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/69f2118621d46f88b4c9436baea2db51a306ce37",
        "files": [
          "version.php"
        ],
        "message": "on-demand release 3.6beta+",
        "before_after_code_files": [
          "version.php||version.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.php||version.php"
          ],
          "candidate": [
            "version.php||version.php"
          ]
        }
      },
      "candidate_diff": {
        "version.php||version.php": [
          "File: version.php -> version.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "30: defined('MOODLE_INTERNAL') || die();",
          "38: $branch   = '36';                       // This version's branch.",
          "39: $maturity = MATURITY_BETA;             // This version's maturity level.",
          "",
          "[Removed Lines]",
          "32: $version  = 2018112000.02;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "36: $release  = '3.6beta+ (Build: 20181120)'; // Human-friendly version name",
          "",
          "[Added Lines]",
          "32: $version  = 2018112300.00;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "36: $release  = '3.6beta+ (Build: 20181123)'; // Human-friendly version name",
          "",
          "---------------"
        ]
      }
    }
  ]
}