{
  "cve_id": "CVE-2021-27906",
  "cve_desc": "A carefully crafted PDF file can trigger an OutOfMemory-Exception while loading the file. This issue affects Apache PDFBox version 2.0.22 and prior 2.0.x versions.",
  "repo": "apache/pdfbox",
  "patch_hash": "8c47be1011c11dc47300faecffd8ab32fba3646f",
  "patch_info": {
    "commit_hash": "8c47be1011c11dc47300faecffd8ab32fba3646f",
    "repo": "apache/pdfbox",
    "commit_url": "https://github.com/apache/pdfbox/commit/8c47be1011c11dc47300faecffd8ab32fba3646f",
    "files": [
      "pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java"
    ],
    "message": "PDFBOX-5112: SonarCube fix, throw NoSuchElementException if no more elements are available\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1887295 13f79535-47bb-0310-9956-ffa450edef68",
    "before_after_code_files": [
      "pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java||pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java"
    ]
  },
  "patch_diff": {
    "pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java||pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java": [
      "File: pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java -> pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java",
      "--- Hunk 1 ---",
      "[Context before]",
      "19: import java.io.IOException;",
      "20: import java.util.Arrays;",
      "21: import java.util.Iterator;",
      "23: import org.apache.pdfbox.cos.COSArray;",
      "24: import org.apache.pdfbox.cos.COSBase;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "22: import java.util.NoSuchElementException;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "212:         @Override",
      "213:         public Long next()",
      "214:         {",
      "215:             if (currentNumber < currentEnd)",
      "216:             {",
      "217:                 return currentNumber++;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "216:             if (currentNumber >= maxValue)",
      "217:             {",
      "218:                 throw new NoSuchElementException();",
      "219:             }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "2c2a088cbb4c83c1bd175ab829496b3d89fa7b4c",
      "candidate_info": {
        "commit_hash": "2c2a088cbb4c83c1bd175ab829496b3d89fa7b4c",
        "repo": "apache/pdfbox",
        "commit_url": "https://github.com/apache/pdfbox/commit/2c2a088cbb4c83c1bd175ab829496b3d89fa7b4c",
        "files": [
          "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDFont.java"
        ],
        "message": "PDFBOX-4892: avoid ClassCastException\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1884396 13f79535-47bb-0310-9956-ffa450edef68",
        "before_after_code_files": [
          "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDFont.java||pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDFont.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/pdfbox/pull/104"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDFont.java||pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDFont.java": [
          "File: pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDFont.java -> pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDFont.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "118:     private PDFontDescriptor loadFontDescriptor()",
          "119:     {",
          "121:         if (fd != null)",
          "122:         {",
          "123:             return new PDFontDescriptor(fd);",
          "",
          "[Removed Lines]",
          "120:         COSDictionary fd = (COSDictionary) dict.getDictionaryObject(COSName.FONT_DESC);",
          "",
          "[Added Lines]",
          "120:         COSDictionary fd = dict.getCOSDictionary(COSName.FONT_DESC);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "f37bb7adfe390c78c7b8926929d9a130311ce6a9",
      "candidate_info": {
        "commit_hash": "f37bb7adfe390c78c7b8926929d9a130311ce6a9",
        "repo": "apache/pdfbox",
        "commit_url": "https://github.com/apache/pdfbox/commit/f37bb7adfe390c78c7b8926929d9a130311ce6a9",
        "files": [
          "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/color/PDLab.java"
        ],
        "message": "PDFBOX-4892: optimize, as suggested by valerybokov\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1889572 13f79535-47bb-0310-9956-ffa450edef68",
        "before_after_code_files": [
          "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/color/PDLab.java||pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/color/PDLab.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/pdfbox/pull/104"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/color/PDLab.java||pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/color/PDLab.java": [
          "File: pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/color/PDLab.java -> pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/color/PDLab.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "76:         float maxA = aRange.getMax();",
          "77:         float minB = bRange.getMin();",
          "78:         float maxB = bRange.getMax();",
          "81:         float[] abc = new float[3];",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "79:         float deltaA = maxA - minA;",
          "80:         float deltaB = maxB - minB;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "94:                 abc[0] *= 100;",
          "98:                 float[] rgb = toRGB(abc);",
          "",
          "[Removed Lines]",
          "95:                 abc[1] = minA + (abc[1] * (maxA - minA));",
          "96:                 abc[2] = minB + (abc[2] * (maxB - minB));",
          "",
          "[Added Lines]",
          "97:                 abc[1] = minA + abc[1] * deltaA;",
          "98:                 abc[2] = minB + abc[2] * deltaB;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "27da4f1a559b8710360963f74629348657c9947f",
      "candidate_info": {
        "commit_hash": "27da4f1a559b8710360963f74629348657c9947f",
        "repo": "apache/pdfbox",
        "commit_url": "https://github.com/apache/pdfbox/commit/27da4f1a559b8710360963f74629348657c9947f",
        "files": [
          "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/PDPage.java"
        ],
        "message": "PDFBOX-4892: set individual initial ArrayList size, as suggested by valerybokov\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1887109 13f79535-47bb-0310-9956-ffa450edef68",
        "before_after_code_files": [
          "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/PDPage.java||pdfbox/src/main/java/org/apache/pdfbox/pdmodel/PDPage.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/pdfbox/pull/104"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/PDPage.java||pdfbox/src/main/java/org/apache/pdfbox/pdmodel/PDPage.java": [
          "File: pdfbox/src/main/java/org/apache/pdfbox/pdmodel/PDPage.java -> pdfbox/src/main/java/org/apache/pdfbox/pdmodel/PDPage.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "537:         {",
          "538:             beads = new COSArray();",
          "539:         }",
          "541:         for (int i = 0; i < beads.size(); i++)",
          "542:         {",
          "543:             COSBase base = beads.getObject(i);",
          "",
          "[Removed Lines]",
          "540:         List<PDThreadBead> pdObjects = new ArrayList<PDThreadBead>();",
          "",
          "[Added Lines]",
          "540:         List<PDThreadBead> pdObjects = new ArrayList<PDThreadBead>(beads.size());",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "dbebb1c449039ea2e866438544827d5c206aaf31",
      "candidate_info": {
        "commit_hash": "dbebb1c449039ea2e866438544827d5c206aaf31",
        "repo": "apache/pdfbox",
        "commit_url": "https://github.com/apache/pdfbox/commit/dbebb1c449039ea2e866438544827d5c206aaf31",
        "files": [
          "examples/src/main/java/org/apache/pdfbox/examples/signature/ShowSignature.java",
          "examples/src/main/java/org/apache/pdfbox/examples/signature/SigUtils.java",
          "examples/src/main/java/org/apache/pdfbox/examples/signature/validation/CertInformationCollector.java"
        ],
        "message": "PDFBOX-4892: remove unused import\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1890728 13f79535-47bb-0310-9956-ffa450edef68",
        "before_after_code_files": [
          "examples/src/main/java/org/apache/pdfbox/examples/signature/ShowSignature.java||examples/src/main/java/org/apache/pdfbox/examples/signature/ShowSignature.java",
          "examples/src/main/java/org/apache/pdfbox/examples/signature/SigUtils.java||examples/src/main/java/org/apache/pdfbox/examples/signature/SigUtils.java",
          "examples/src/main/java/org/apache/pdfbox/examples/signature/validation/CertInformationCollector.java||examples/src/main/java/org/apache/pdfbox/examples/signature/validation/CertInformationCollector.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/pdfbox/pull/104"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "examples/src/main/java/org/apache/pdfbox/examples/signature/ShowSignature.java||examples/src/main/java/org/apache/pdfbox/examples/signature/ShowSignature.java": [
          "File: examples/src/main/java/org/apache/pdfbox/examples/signature/ShowSignature.java -> examples/src/main/java/org/apache/pdfbox/examples/signature/ShowSignature.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "70: import org.bouncycastle.tsp.TimeStampToken;",
          "71: import org.bouncycastle.tsp.TimeStampTokenInfo;",
          "72: import org.bouncycastle.util.CollectionStore;",
          "74: import org.bouncycastle.util.Store;",
          "",
          "[Removed Lines]",
          "73: import org.bouncycastle.util.Selector;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "examples/src/main/java/org/apache/pdfbox/examples/signature/SigUtils.java||examples/src/main/java/org/apache/pdfbox/examples/signature/SigUtils.java": [
          "File: examples/src/main/java/org/apache/pdfbox/examples/signature/SigUtils.java -> examples/src/main/java/org/apache/pdfbox/examples/signature/SigUtils.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "53: import org.bouncycastle.operator.OperatorCreationException;",
          "54: import org.bouncycastle.tsp.TSPException;",
          "55: import org.bouncycastle.tsp.TimeStampToken;",
          "57: import org.bouncycastle.util.Store;",
          "",
          "[Removed Lines]",
          "56: import org.bouncycastle.util.Selector;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "examples/src/main/java/org/apache/pdfbox/examples/signature/validation/CertInformationCollector.java||examples/src/main/java/org/apache/pdfbox/examples/signature/validation/CertInformationCollector.java": [
          "File: examples/src/main/java/org/apache/pdfbox/examples/signature/validation/CertInformationCollector.java -> examples/src/main/java/org/apache/pdfbox/examples/signature/validation/CertInformationCollector.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "47: import org.bouncycastle.cms.CMSException;",
          "48: import org.bouncycastle.cms.CMSSignedData;",
          "49: import org.bouncycastle.cms.SignerInformation;",
          "51: import org.bouncycastle.util.Store;",
          "",
          "[Removed Lines]",
          "50: import org.bouncycastle.util.Selector;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "95602905111b858b5b1e3d20864cf51d941c98c7",
      "candidate_info": {
        "commit_hash": "95602905111b858b5b1e3d20864cf51d941c98c7",
        "repo": "apache/pdfbox",
        "commit_url": "https://github.com/apache/pdfbox/commit/95602905111b858b5b1e3d20864cf51d941c98c7",
        "files": [
          "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/PDDocument.java"
        ],
        "message": "PDFBOX-4398: access AcroForm for signature creation without applying fixes\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1885497 13f79535-47bb-0310-9956-ffa450edef68",
        "before_after_code_files": [
          "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/PDDocument.java||pdfbox/src/main/java/org/apache/pdfbox/pdmodel/PDDocument.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/pdfbox/pull/104"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/PDDocument.java||pdfbox/src/main/java/org/apache/pdfbox/pdmodel/PDDocument.java": [
          "File: pdfbox/src/main/java/org/apache/pdfbox/pdmodel/PDDocument.java -> pdfbox/src/main/java/org/apache/pdfbox/pdmodel/PDDocument.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "380:         PDDocumentCatalog catalog = getDocumentCatalog();",
          "382:         catalog.getCOSObject().setNeedToBeUpdated(true);",
          "384:         if (acroForm == null)",
          "",
          "[Removed Lines]",
          "381:         PDAcroForm acroForm = catalog.getAcroForm();",
          "",
          "[Added Lines]",
          "381:         PDAcroForm acroForm = catalog.getAcroForm(null);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "673:         PDDocumentCatalog catalog = getDocumentCatalog();",
          "674:         catalog.getCOSObject().setNeedToBeUpdated(true);",
          "677:         if (acroForm == null)",
          "678:         {",
          "679:             acroForm = new PDAcroForm(this);",
          "",
          "[Removed Lines]",
          "676:         PDAcroForm acroForm = catalog.getAcroForm();",
          "",
          "[Added Lines]",
          "676:         PDAcroForm acroForm = catalog.getAcroForm(null);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "920:     public List<PDSignatureField> getSignatureFields() throws IOException",
          "921:     {",
          "922:         List<PDSignatureField> fields = new ArrayList<PDSignatureField>();",
          "924:         if (acroForm != null)",
          "925:         {",
          "926:             for (PDField field : acroForm.getFieldTree())",
          "",
          "[Removed Lines]",
          "923:         PDAcroForm acroForm = getDocumentCatalog().getAcroForm();",
          "",
          "[Added Lines]",
          "923:         PDAcroForm acroForm = getDocumentCatalog().getAcroForm(null);",
          "",
          "---------------"
        ]
      }
    }
  ]
}