{
  "cve_id": "CVE-2022-41711",
  "cve_desc": "Badaso version 2.6.0 allows an unauthenticated remote attacker to execute arbitrary code remotely on the server. This is possible because the application does not properly validate the data uploaded by users.",
  "repo": "uasoft-indonesia/badaso",
  "patch_hash": "22250eca7c364d991ce9e0a723941eae4889d6f9",
  "patch_info": {
    "commit_hash": "22250eca7c364d991ce9e0a723941eae4889d6f9",
    "repo": "uasoft-indonesia/badaso",
    "commit_url": "https://github.com/uasoft-indonesia/badaso/commit/22250eca7c364d991ce9e0a723941eae4889d6f9",
    "files": [
      "src/resources/js/components/BadasoUploadFile.vue",
      "src/resources/js/components/BadasoUploadFileMultiple.vue",
      "src/resources/js/components/BadasoUploadImage.vue",
      "src/resources/js/components/BadasoUploadImageMultiple.vue"
    ],
    "message": "Merge pull request #807 from uasoft-indonesia/bugfix/v2/filter-mimeType\n\nBugfix[v2] add filter mimeType",
    "before_after_code_files": [
      "src/resources/js/components/BadasoUploadFile.vue||src/resources/js/components/BadasoUploadFile.vue",
      "src/resources/js/components/BadasoUploadFileMultiple.vue||src/resources/js/components/BadasoUploadFileMultiple.vue",
      "src/resources/js/components/BadasoUploadImage.vue||src/resources/js/components/BadasoUploadImage.vue",
      "src/resources/js/components/BadasoUploadImageMultiple.vue||src/resources/js/components/BadasoUploadImageMultiple.vue"
    ]
  },
  "patch_diff": {
    "src/resources/js/components/BadasoUploadFile.vue||src/resources/js/components/BadasoUploadFile.vue": [
      "File: src/resources/js/components/BadasoUploadFile.vue -> src/resources/js/components/BadasoUploadFile.vue",
      "--- Hunk 1 ---",
      "[Context before]",
      "336:           });",
      "337:           return;",
      "338:         }",
      "340:         this.uploadFile(files[0]);",
      "341:       }",
      "342:     },",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "339:         if (!this.availableMimetypes.file.validMime.includes(files[0].type)) {",
      "340:           this.$vs.notify({",
      "341:             title: this.$t(\"alert.danger\"),",
      "342:             text: \"File type not allowed\",",
      "343:             color: \"danger\",",
      "344:           });",
      "345:           return;",
      "346:         }",
      "",
      "---------------"
    ],
    "src/resources/js/components/BadasoUploadFileMultiple.vue||src/resources/js/components/BadasoUploadFileMultiple.vue": [
      "File: src/resources/js/components/BadasoUploadFileMultiple.vue -> src/resources/js/components/BadasoUploadFileMultiple.vue",
      "--- Hunk 1 ---",
      "[Context before]",
      "367:             });",
      "368:             return;",
      "369:           }",
      "371:           this.uploadFile(file);",
      "372:         }",
      "373:       }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "370:           if (!this.availableMimetypes.file.validMime.includes(file.type)) {",
      "371:             this.$vs.notify({",
      "372:               title: this.$t(\"alert.danger\"),",
      "373:               text: \"File type not allowed\",",
      "374:               color: \"danger\",",
      "375:             });",
      "376:             return;",
      "377:           }",
      "",
      "---------------"
    ],
    "src/resources/js/components/BadasoUploadImage.vue||src/resources/js/components/BadasoUploadImage.vue": [
      "File: src/resources/js/components/BadasoUploadImage.vue -> src/resources/js/components/BadasoUploadImage.vue",
      "--- Hunk 1 ---",
      "[Context before]",
      "380:           });",
      "381:           return;",
      "382:         }",
      "384:         this.uploadImage(files[0]);",
      "385:       }",
      "386:     },",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "383:         if (!this.availableMimetypes.image.validMime.includes(files[0].type)){",
      "384:           this.$vs.notify({",
      "385:             title: this.$t(\"alert.danger\"),",
      "386:             text: \"File type not allowed\",",
      "387:             color: \"danger\",",
      "388:           });",
      "389:           return;",
      "390:         }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "421:     uploadImage(file) {",
      "422:       const files = new FormData();",
      "423:       files.append(\"upload\", file);",
      "425:       files.append(\"working_dir\", this.getActiveFolder);",
      "426:       this.$api.badasoFile",
      "427:         .uploadUsingLfm(files)",
      "",
      "[Removed Lines]",
      "424:       files.append(\"type\", \"image\");",
      "",
      "[Added Lines]",
      "431:       files.append(\"type\", file.type);",
      "",
      "---------------"
    ],
    "src/resources/js/components/BadasoUploadImageMultiple.vue||src/resources/js/components/BadasoUploadImageMultiple.vue": [
      "File: src/resources/js/components/BadasoUploadImageMultiple.vue -> src/resources/js/components/BadasoUploadImageMultiple.vue",
      "--- Hunk 1 ---",
      "[Context before]",
      "395:             });",
      "396:             return;",
      "397:           }",
      "399:           this.uploadImage(file);",
      "400:         }",
      "401:       }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "398:           if (!this.availableMimetypes.image.validMime.includes(file.type)) {",
      "399:             this.$vs.notify({",
      "400:               title: this.$t(\"alert.danger\"),",
      "401:               text: \"File type not allowed\",",
      "402:               color: \"danger\",",
      "403:             });",
      "404:             return;",
      "405:           }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "c7653e853ffed6390b1e891b3ad3a69677dd1acb",
      "candidate_info": {
        "commit_hash": "c7653e853ffed6390b1e891b3ad3a69677dd1acb",
        "repo": "uasoft-indonesia/badaso",
        "commit_url": "https://github.com/uasoft-indonesia/badaso/commit/c7653e853ffed6390b1e891b3ad3a69677dd1acb",
        "files": [
          "src/Config/badaso.php"
        ],
        "message": "Update badaso.php",
        "before_after_code_files": [
          "src/Config/badaso.php||src/Config/badaso.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/uasoft-indonesia/badaso/pull/1086"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/Config/badaso.php||src/Config/badaso.php": [
          "File: src/Config/badaso.php -> src/Config/badaso.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: return [",
          "4:     'db_name' => env('DB_DATABASE'),",
          "5:     'admin_panel_route_prefix' => env('MIX_ADMIN_PANEL_ROUTE_PREFIX', 'badaso-dashboard'),",
          "7:     'api_route_prefix' => env('MIX_API_ROUTE_PREFIX', 'badaso-api'),",
          "8:     'license_key' => env('BADASO_LICENSE_KEY'),",
          "9:     'database' => [",
          "",
          "[Removed Lines]",
          "6:     'default_menu' => env('MIX_DEFAULT_MENU', 'admin'),",
          "",
          "[Added Lines]",
          "6:     'default_menu' => env('MIX_DEFAULT_MENU', 'general'),",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "89a097aba08db73a82775cbb394387b9effba669",
      "candidate_info": {
        "commit_hash": "89a097aba08db73a82775cbb394387b9effba669",
        "repo": "uasoft-indonesia/badaso",
        "commit_url": "https://github.com/uasoft-indonesia/badaso/commit/89a097aba08db73a82775cbb394387b9effba669",
        "files": [
          "src/Controllers/BadasoBaseController.php"
        ],
        "message": "commit",
        "before_after_code_files": [
          "src/Controllers/BadasoBaseController.php||src/Controllers/BadasoBaseController.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/uasoft-indonesia/badaso/pull/1086"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/Controllers/BadasoBaseController.php||src/Controllers/BadasoBaseController.php": [
          "File: src/Controllers/BadasoBaseController.php -> src/Controllers/BadasoBaseController.php"
        ]
      }
    },
    {
      "candidate_hash": "d07498ce6d3bd4226f5f65579f84ec5d92694c96",
      "candidate_info": {
        "commit_hash": "d07498ce6d3bd4226f5f65579f84ec5d92694c96",
        "repo": "uasoft-indonesia/badaso",
        "commit_url": "https://github.com/uasoft-indonesia/badaso/commit/d07498ce6d3bd4226f5f65579f84ec5d92694c96",
        "files": [
          "src/Helpers/ApiDocs.php",
          "src/Swagger/swagger_models/auth.php"
        ],
        "message": "update",
        "before_after_code_files": [
          "src/Helpers/ApiDocs.php||src/Helpers/ApiDocs.php",
          "src/Swagger/swagger_models/auth.php||src/Swagger/swagger_models/auth.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/uasoft-indonesia/badaso/pull/1086"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/Helpers/ApiDocs.php||src/Helpers/ApiDocs.php": [
          "File: src/Helpers/ApiDocs.php -> src/Helpers/ApiDocs.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "438:         $items = [];",
          "439:         foreach ($rows as $key => $row) {",
          "440:             $items[] = sprintf(",
          "442:                 CaseConvert::camel($row['field']),",
          "443:                 self::getColumnExample($row['type']),",
          "444:             );",
          "",
          "[Removed Lines]",
          "441:                 self::ITEMS,",
          "",
          "[Added Lines]",
          "441:                 self::ITEM,",
          "",
          "---------------"
        ],
        "src/Swagger/swagger_models/auth.php||src/Swagger/swagger_models/auth.php": [
          "File: src/Swagger/swagger_models/auth.php -> src/Swagger/swagger_models/auth.php"
        ]
      }
    },
    {
      "candidate_hash": "97c41a2a037e86325b7e9f91fd27b1ead7ce3655",
      "candidate_info": {
        "commit_hash": "97c41a2a037e86325b7e9f91fd27b1ead7ce3655",
        "repo": "uasoft-indonesia/badaso",
        "commit_url": "https://github.com/uasoft-indonesia/badaso/commit/97c41a2a037e86325b7e9f91fd27b1ead7ce3655",
        "files": [
          "src/Controllers/BadasoMaintenanceController.php",
          "src/Controllers/BadasoRolePermissionController.php",
          "tests/Feature/BadasoApiMenuItemTest.php"
        ],
        "message": "comment",
        "before_after_code_files": [
          "src/Controllers/BadasoMaintenanceController.php||src/Controllers/BadasoMaintenanceController.php",
          "src/Controllers/BadasoRolePermissionController.php||src/Controllers/BadasoRolePermissionController.php",
          "tests/Feature/BadasoApiMenuItemTest.php||tests/Feature/BadasoApiMenuItemTest.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/uasoft-indonesia/badaso/pull/1086"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/Controllers/BadasoMaintenanceController.php||src/Controllers/BadasoMaintenanceController.php": [
          "File: src/Controllers/BadasoMaintenanceController.php -> src/Controllers/BadasoMaintenanceController.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "7: use Illuminate\\Http\\Request;",
          "8: use Uasoft\\Badaso\\Helpers\\ApiResponse;",
          "9: use Uasoft\\Badaso\\Helpers\\Redis\\ConfigurationRedis;",
          "11: class BadasoMaintenanceController extends Controller",
          "12: {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "10: use Uasoft\\Badaso\\Models\\Configuration;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "82:     private function isUnderMaintenance()",
          "83:     {",
          "88:     }",
          "90:     private function getRolesByToken(Request $request)",
          "",
          "[Removed Lines]",
          "84:         $configuration_model = ConfigurationRedis::get();",
          "85:         $maintenance = $configuration_model->where('key', 'maintenance')->firstOrFail();",
          "87:         return $maintenance->value === '1' ? true : false;",
          "",
          "[Added Lines]",
          "85:         try {",
          "86:             $configuration_model = ConfigurationRedis::get();",
          "87:             $maintenance = $configuration_model->where('key', 'maintenance')->firstOrFail();",
          "88:             return $maintenance->value == '1' ? true : false;",
          "89:         } catch (\\Exception $e) {",
          "90:             $maintenance = Configuration::where('key', 'maintenance')->firstOrFail();",
          "91:             return $maintenance->value == '1' ? true : false;",
          "92:         }",
          "",
          "---------------"
        ],
        "src/Controllers/BadasoRolePermissionController.php||src/Controllers/BadasoRolePermissionController.php": [
          "File: src/Controllers/BadasoRolePermissionController.php -> src/Controllers/BadasoRolePermissionController.php"
        ],
        "tests/Feature/BadasoApiMenuItemTest.php||tests/Feature/BadasoApiMenuItemTest.php": [
          "File: tests/Feature/BadasoApiMenuItemTest.php -> tests/Feature/BadasoApiMenuItemTest.php"
        ]
      }
    },
    {
      "candidate_hash": "7f6fb37cd9fc79f478f772fe527fc2d29a6819c4",
      "candidate_info": {
        "commit_hash": "7f6fb37cd9fc79f478f772fe527fc2d29a6819c4",
        "repo": "uasoft-indonesia/badaso",
        "commit_url": "https://github.com/uasoft-indonesia/badaso/commit/7f6fb37cd9fc79f478f772fe527fc2d29a6819c4",
        "files": [
          "src/Models/MenuItem.php"
        ],
        "message": "Apply fixes from StyleCI",
        "before_after_code_files": [
          "src/Models/MenuItem.php||src/Models/MenuItem.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/uasoft-indonesia/badaso/pull/1086"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/Models/MenuItem.php||src/Models/MenuItem.php": [
          "File: src/Models/MenuItem.php -> src/Models/MenuItem.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "17:     public function __construct(array $attributes = [])",
          "18:     {",
          "19:         $prefix = config('badaso.database.prefix');",
          "21:         parent::__construct($attributes);",
          "22:     }",
          "",
          "[Removed Lines]",
          "20:         $this->table = $prefix . 'menu_items';",
          "",
          "[Added Lines]",
          "20:         $this->table = $prefix.'menu_items';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "47:         $item = $item->orderBy('order', 'DESC')",
          "48:             ->first();",
          "51:             $order = intval($item->order) + 1;",
          "52:         }",
          "",
          "[Removed Lines]",
          "50:         if (!is_null($item)) {",
          "",
          "[Added Lines]",
          "50:         if (! is_null($item)) {",
          "",
          "---------------"
        ]
      }
    }
  ]
}