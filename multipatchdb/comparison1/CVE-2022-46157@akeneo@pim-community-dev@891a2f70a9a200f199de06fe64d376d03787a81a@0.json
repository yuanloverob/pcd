{
  "cve_id": "CVE-2022-46157",
  "cve_desc": "Akeneo PIM is an open source Product Information Management (PIM). Akeneo PIM Community Edition versions before v5.0.119 and v6.0.53 allows remote authenticated users to execute arbitrary PHP code on the server by uploading a crafted image. Akeneo PIM Community Edition after the versions aforementioned provides patched Apache HTTP server configuration file, for docker setup and in documentation sample, to fix this vulnerability.   Community Edition users must change their Apache HTTP server configuration accordingly to be protected. The patch for Cloud Based Akeneo PIM Services customers has been applied since 30th October 2022. Users are advised to upgrade. Users unable to upgrade may  Replace any reference to `<FilesMatch \\.php$>` in their apache httpd configurations with: `<Location \"/index.php\">`.",
  "repo": "akeneo/pim-community-dev",
  "patch_hash": "891a2f70a9a200f199de06fe64d376d03787a81a",
  "patch_info": {
    "commit_hash": "891a2f70a9a200f199de06fe64d376d03787a81a",
    "repo": "akeneo/pim-community-dev",
    "commit_url": "https://github.com/akeneo/pim-community-dev/commit/891a2f70a9a200f199de06fe64d376d03787a81a",
    "files": [
      "docker/httpd.conf"
    ],
    "message": "Update httpd.conf (#18391)",
    "before_after_code_files": [
      "docker/httpd.conf||docker/httpd.conf"
    ]
  },
  "patch_diff": {
    "docker/httpd.conf||docker/httpd.conf": [
      "File: docker/httpd.conf -> docker/httpd.conf",
      "--- Hunk 1 ---",
      "[Context before]",
      "37: TypesConfig conf/mime.types",
      "40:     SetHandler \"proxy:fcgi://fpm:9000\"",
      "43: SetEnvIf Authorization .+ HTTP_AUTHORIZATION=$0",
      "",
      "[Removed Lines]",
      "39: <FilesMatch \\.php$>",
      "41: </FilesMatch>",
      "",
      "[Added Lines]",
      "39: <Location \"/index.php\">",
      "41: </Location>",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "3281da9e987641b2559fa7f8c4d508c11ac5a585",
      "candidate_info": {
        "commit_hash": "3281da9e987641b2559fa7f8c4d508c11ac5a585",
        "repo": "akeneo/pim-community-dev",
        "commit_url": "https://github.com/akeneo/pim-community-dev/commit/3281da9e987641b2559fa7f8c4d508c11ac5a585",
        "files": [
          "CHANGELOG-5.0.md",
          "CHANGELOG-6.0.md",
          "src/Akeneo/Platform/Bundle/UIBundle/Resources/config/form_extensions/associations/product.yml",
          "src/Akeneo/UserManagement/Component/Normalizer/Standard/UserNormalizer.php",
          "tests/back/UserManagement/Integration/Bundle/Export/ExportUserIntegration.php"
        ],
        "message": "PIM-10719: Pull-up 6.0 => master (#18397)\n\n* PIM-10671: Fix slowness on product association page with a lot of categories\n\n* Preparing version 5.0.116 (#18353)\n\nPreparing version 5.0.116\n\n\nCo-authored-by: mmetayer <mathias.metayer@akeneo.com>\n\n* Preparing version 6.0.52 (#18361)\n\nPreparing version 6.0.52\n\n\nCo-authored-by: BryanS29-akeneo <bryan.stephan@akeneo.com>\n\n* Update httpd.conf (#18391)\n\n* PIM-10699: [SLA] \"All\" is exported allong with the user groups on the user export (#18385)\n\n* PIM-10699: [SLA] \"All\" is exported allong with the user groups on the user export\n\n* PIM-10699: Fix tests\n\n* Preparing version 6.0.53 (#18396)\n\nPreparing version 6.0.53\n\n\nCo-authored-by: BryanS29-akeneo <bryan.stephan@akeneo.com>\n\nCo-authored-by: Mathias M\u00e9tayer <mathias.metayer@akeneo.com>\nCo-authored-by: Mathias M\u00e9tayer <mmetayer@users.noreply.github.com>\nCo-authored-by: Michel Tag <micheltag@akeneo.com>\nCo-authored-by: Florian Klein <florian.klein@free.fr>",
        "before_after_code_files": [
          "src/Akeneo/UserManagement/Component/Normalizer/Standard/UserNormalizer.php||src/Akeneo/UserManagement/Component/Normalizer/Standard/UserNormalizer.php",
          "tests/back/UserManagement/Integration/Bundle/Export/ExportUserIntegration.php||tests/back/UserManagement/Integration/Bundle/Export/ExportUserIntegration.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_issue": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/Akeneo/UserManagement/Component/Normalizer/Standard/UserNormalizer.php||src/Akeneo/UserManagement/Component/Normalizer/Standard/UserNormalizer.php": [
          "File: src/Akeneo/UserManagement/Component/Normalizer/Standard/UserNormalizer.php -> src/Akeneo/UserManagement/Component/Normalizer/Standard/UserNormalizer.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: namespace Akeneo\\UserManagement\\Component\\Normalizer\\Standard;",
          "7: use Akeneo\\UserManagement\\Component\\Model\\RoleInterface;",
          "8: use Akeneo\\UserManagement\\Component\\Model\\UserInterface;",
          "9: use Symfony\\Component\\Serializer\\Normalizer\\CacheableSupportsMethodInterface;",
          "10: use Symfony\\Component\\Serializer\\Normalizer\\NormalizerInterface;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "8: use Akeneo\\UserManagement\\Component\\Model\\User;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "45:             'default_category_tree' => $user->getDefaultTree()->getCode(),",
          "46:             'user_default_locale' => $user->getUiLocale()->getCode(),",
          "47:             'timezone' => $user->getTimezone(),",
          "49:             'roles' => $user->getRolesCollection()->map(",
          "50:                 fn (RoleInterface $role): string => $role->getRole()",
          "51:             )->getValues(),",
          "",
          "[Removed Lines]",
          "48:             'groups' => $user->getGroupNames(),",
          "",
          "[Added Lines]",
          "49:             'groups' => array_filter($user->getGroupNames(), function (string $groupName) {",
          "50:                 return $groupName !== User::GROUP_DEFAULT;",
          "51:             }),",
          "",
          "---------------"
        ],
        "tests/back/UserManagement/Integration/Bundle/Export/ExportUserIntegration.php||tests/back/UserManagement/Integration/Bundle/Export/ExportUserIntegration.php": [
          "File: tests/back/UserManagement/Integration/Bundle/Export/ExportUserIntegration.php -> tests/back/UserManagement/Integration/Bundle/Export/ExportUserIntegration.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "54:     {",
          "55:         $expectedCsv = <<<CSV",
          "56: username;email;avatar;catalog_default_locale;catalog_default_scope;default_category_tree;default_product_grid_view;enabled;first_name;groups;last_name;middle_name;name_prefix;name_suffix;phone;product_grid_filters;roles;timezone;user_default_locale",
          "62: CSV;",
          "63:         $csv = $this->jobLauncher->launchExport(self::CSV_EXPORT_JOB_CODE, null, []);",
          "",
          "[Removed Lines]",
          "57: admin;admin@example.com;;en_US;ecommerce;master;;1;John;\"IT support,All\";Doe;;;;;;ROLE_ADMINISTRATOR;UTC;en_US",
          "58: julia;julia@example.com;;en_US;ecommerce;master;;1;Julia;Manager,All;Stark;;;;;;ROLE_CATALOG_MANAGER;UTC;en_US",
          "59: mary;mary@example.com;;en_US;ecommerce;master;;1;Mary;Redactor,All;Smith;;;;;;ROLE_USER;UTC;en_US",
          "60: kevin;kevin@example.com;;en_US;ecommerce;master;;1;Kevin;Redactor,All;Michel;;;;;;ROLE_TRAINEE;UTC;en_US",
          "",
          "[Added Lines]",
          "57: admin;admin@example.com;;en_US;ecommerce;master;;1;John;\"IT support\";Doe;;;;;;ROLE_ADMINISTRATOR;UTC;en_US",
          "58: julia;julia@example.com;;en_US;ecommerce;master;;1;Julia;Manager;Stark;;;;;;ROLE_CATALOG_MANAGER;UTC;en_US",
          "59: mary;mary@example.com;;en_US;ecommerce;master;;1;Mary;Redactor;Smith;;;;;;ROLE_USER;UTC;en_US",
          "60: kevin;kevin@example.com;;en_US;ecommerce;master;;1;Kevin;Redactor;Michel;;;;;;ROLE_TRAINEE;UTC;en_US",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "a53e16c8ee686641d8f69ca8ba68df7893828070",
      "candidate_info": {
        "commit_hash": "a53e16c8ee686641d8f69ca8ba68df7893828070",
        "repo": "akeneo/pim-community-dev",
        "commit_url": "https://github.com/akeneo/pim-community-dev/commit/a53e16c8ee686641d8f69ca8ba68df7893828070",
        "files": [
          "docker/httpd.conf"
        ],
        "message": "Update httpd.conf (#18392)",
        "before_after_code_files": [
          "docker/httpd.conf||docker/httpd.conf"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_olp_changes": 1,
        "olp_code_files": {
          "patch": [
            "docker/httpd.conf||docker/httpd.conf"
          ],
          "candidate": [
            "docker/httpd.conf||docker/httpd.conf"
          ]
        }
      },
      "candidate_diff": {
        "docker/httpd.conf||docker/httpd.conf": [
          "File: docker/httpd.conf -> docker/httpd.conf",
          "--- Hunk 1 ---",
          "[Context before]",
          "37: TypesConfig conf/mime.types",
          "40:     SetHandler \"proxy:fcgi://fpm:9000\"",
          "43: SetEnvIf Authorization .+ HTTP_AUTHORIZATION=$0",
          "",
          "[Removed Lines]",
          "39: <FilesMatch \\.php$>",
          "41: </FilesMatch>",
          "",
          "[Added Lines]",
          "39: <Location \"/index.php\">",
          "41: </Location>",
          "",
          "---------------"
        ]
      }
    }
  ]
}