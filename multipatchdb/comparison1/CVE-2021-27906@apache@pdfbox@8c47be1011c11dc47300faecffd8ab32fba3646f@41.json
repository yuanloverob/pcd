{
  "cve_id": "CVE-2021-27906",
  "cve_desc": "A carefully crafted PDF file can trigger an OutOfMemory-Exception while loading the file. This issue affects Apache PDFBox version 2.0.22 and prior 2.0.x versions.",
  "repo": "apache/pdfbox",
  "patch_hash": "8c47be1011c11dc47300faecffd8ab32fba3646f",
  "patch_info": {
    "commit_hash": "8c47be1011c11dc47300faecffd8ab32fba3646f",
    "repo": "apache/pdfbox",
    "commit_url": "https://github.com/apache/pdfbox/commit/8c47be1011c11dc47300faecffd8ab32fba3646f",
    "files": [
      "pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java"
    ],
    "message": "PDFBOX-5112: SonarCube fix, throw NoSuchElementException if no more elements are available\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1887295 13f79535-47bb-0310-9956-ffa450edef68",
    "before_after_code_files": [
      "pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java||pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java"
    ]
  },
  "patch_diff": {
    "pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java||pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java": [
      "File: pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java -> pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java",
      "--- Hunk 1 ---",
      "[Context before]",
      "19: import java.io.IOException;",
      "20: import java.util.Arrays;",
      "21: import java.util.Iterator;",
      "23: import org.apache.pdfbox.cos.COSArray;",
      "24: import org.apache.pdfbox.cos.COSBase;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "22: import java.util.NoSuchElementException;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "212:         @Override",
      "213:         public Long next()",
      "214:         {",
      "215:             if (currentNumber < currentEnd)",
      "216:             {",
      "217:                 return currentNumber++;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "216:             if (currentNumber >= maxValue)",
      "217:             {",
      "218:                 throw new NoSuchElementException();",
      "219:             }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "8445e147ec90a05b7834ea7f2a5dd101a35ac6ff",
      "candidate_info": {
        "commit_hash": "8445e147ec90a05b7834ea7f2a5dd101a35ac6ff",
        "repo": "apache/pdfbox",
        "commit_url": "https://github.com/apache/pdfbox/commit/8445e147ec90a05b7834ea7f2a5dd101a35ac6ff",
        "files": [
          "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/fixup/processor/AcroFormGenerateAppearancesProcessor.java",
          "pdfbox/src/test/java/org/apache/pdfbox/pdmodel/interactive/form/PDAcroFormGenerateAppearancesTest.java"
        ],
        "message": "PDFBOX-5042: avoid IllegalArgumentException in AcroFormGenerateAppearancesProcessor\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1884337 13f79535-47bb-0310-9956-ffa450edef68",
        "before_after_code_files": [
          "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/fixup/processor/AcroFormGenerateAppearancesProcessor.java||pdfbox/src/main/java/org/apache/pdfbox/pdmodel/fixup/processor/AcroFormGenerateAppearancesProcessor.java",
          "pdfbox/src/test/java/org/apache/pdfbox/pdmodel/interactive/form/PDAcroFormGenerateAppearancesTest.java||pdfbox/src/test/java/org/apache/pdfbox/pdmodel/interactive/form/PDAcroFormGenerateAppearancesTest.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/pdfbox/pull/104"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/fixup/processor/AcroFormGenerateAppearancesProcessor.java||pdfbox/src/main/java/org/apache/pdfbox/pdmodel/fixup/processor/AcroFormGenerateAppearancesProcessor.java": [
          "File: pdfbox/src/main/java/org/apache/pdfbox/pdmodel/fixup/processor/AcroFormGenerateAppearancesProcessor.java -> pdfbox/src/main/java/org/apache/pdfbox/pdmodel/fixup/processor/AcroFormGenerateAppearancesProcessor.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "59:                 LOG.debug(\"couldn't generate appearance stream for some fields - check output\");",
          "60:                 LOG.debug(ioe.getMessage());",
          "61:             }",
          "62:         }",
          "63:     }",
          "64: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "62:             catch (IllegalArgumentException iae)",
          "63:             {",
          "64:                 LOG.debug(\"couldn't generate appearance stream for some fields - check output\");",
          "65:                 LOG.debug(iae.getMessage());",
          "66:             }",
          "",
          "---------------"
        ],
        "pdfbox/src/test/java/org/apache/pdfbox/pdmodel/interactive/form/PDAcroFormGenerateAppearancesTest.java||pdfbox/src/test/java/org/apache/pdfbox/pdmodel/interactive/form/PDAcroFormGenerateAppearancesTest.java": [
          "File: pdfbox/src/test/java/org/apache/pdfbox/pdmodel/interactive/form/PDAcroFormGenerateAppearancesTest.java -> pdfbox/src/test/java/org/apache/pdfbox/pdmodel/interactive/form/PDAcroFormGenerateAppearancesTest.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "60:         {",
          "61:             IOUtils.closeQuietly(testPdf);",
          "62:         }",
          "64: }",
          "",
          "[Removed Lines]",
          "63:     }",
          "",
          "[Added Lines]",
          "63:     }",
          "69:     @Test",
          "70:     public void test4086CharNotEncodable() throws IOException",
          "71:     {",
          "73:         String sourceUrl = \"https://issues.apache.org/jira/secure/attachment/12908175/AML1.PDF\";",
          "75:         PDDocument testPdf = null;",
          "76:         try",
          "77:         {",
          "78:             testPdf = PDDocument.load(new URL(sourceUrl).openStream());",
          "79:             PDDocumentCatalog catalog = testPdf.getDocumentCatalog();",
          "80:             boolean thrown = false;",
          "81:             try",
          "82:             {",
          "83:                 catalog.getAcroForm();",
          "84:             }",
          "85:             catch (Exception e)",
          "86:             {",
          "87:                 thrown = true;",
          "88:             }",
          "89:             assertFalse(\"There shall be no exception when getting the AcroForm\", thrown);",
          "90:         }",
          "91:         finally",
          "92:         {",
          "93:             IOUtils.closeQuietly(testPdf);",
          "94:         }",
          "95:     }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "00ee27113294f3b8eac6d12cb732e75e951a9602",
      "candidate_info": {
        "commit_hash": "00ee27113294f3b8eac6d12cb732e75e951a9602",
        "repo": "apache/pdfbox",
        "commit_url": "https://github.com/apache/pdfbox/commit/00ee27113294f3b8eac6d12cb732e75e951a9602",
        "files": [
          "pdfbox/src/main/java/org/apache/pdfbox/pdfparser/BaseParser.java"
        ],
        "message": "PDFBOX-5156: add % as name delimiter\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1888496 13f79535-47bb-0310-9956-ffa450edef68",
        "before_after_code_files": [
          "pdfbox/src/main/java/org/apache/pdfbox/pdfparser/BaseParser.java||pdfbox/src/main/java/org/apache/pdfbox/pdfparser/BaseParser.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/pdfbox/pull/104"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "pdfbox/src/main/java/org/apache/pdfbox/pdfparser/BaseParser.java||pdfbox/src/main/java/org/apache/pdfbox/pdfparser/BaseParser.java": [
          "File: pdfbox/src/main/java/org/apache/pdfbox/pdfparser/BaseParser.java -> pdfbox/src/main/java/org/apache/pdfbox/pdfparser/BaseParser.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "690:     {",
          "691:         return ch == ASCII_SPACE || ch == ASCII_CR || ch == ASCII_LF || ch == 9 || ch == '>' ||",
          "692:                ch == '<' || ch == '[' || ch =='/' || ch ==']' || ch ==')' || ch =='(' ||",
          "694:     }",
          "",
          "[Removed Lines]",
          "693:                ch == 0 || ch == '\\f';",
          "",
          "[Added Lines]",
          "693:                ch == 0 || ch == '\\f' || ch == '%';",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "faca1050700e095fa075784453348dee7304f620",
      "candidate_info": {
        "commit_hash": "faca1050700e095fa075784453348dee7304f620",
        "repo": "apache/pdfbox",
        "commit_url": "https://github.com/apache/pdfbox/commit/faca1050700e095fa075784453348dee7304f620",
        "files": [
          "pdfbox/src/main/java/org/apache/pdfbox/cos/COSStream.java"
        ],
        "message": "PDFBOX-4892: remove unused import\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1888045 13f79535-47bb-0310-9956-ffa450edef68",
        "before_after_code_files": [
          "pdfbox/src/main/java/org/apache/pdfbox/cos/COSStream.java||pdfbox/src/main/java/org/apache/pdfbox/cos/COSStream.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/pdfbox/pull/104"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "pdfbox/src/main/java/org/apache/pdfbox/cos/COSStream.java||pdfbox/src/main/java/org/apache/pdfbox/cos/COSStream.java": [
          "File: pdfbox/src/main/java/org/apache/pdfbox/cos/COSStream.java -> pdfbox/src/main/java/org/apache/pdfbox/cos/COSStream.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "17: package org.apache.pdfbox.cos;",
          "20: import java.io.Closeable;",
          "21: import java.io.FilterOutputStream;",
          "22: import java.io.IOException;",
          "",
          "[Removed Lines]",
          "19: import java.io.ByteArrayOutputStream;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "4b0b49c6a5da43605caf53a0bfc0bd4b19901926",
      "candidate_info": {
        "commit_hash": "4b0b49c6a5da43605caf53a0bfc0bd4b19901926",
        "repo": "apache/pdfbox",
        "commit_url": "https://github.com/apache/pdfbox/commit/4b0b49c6a5da43605caf53a0bfc0bd4b19901926",
        "files": [
          "examples/src/main/java/org/apache/pdfbox/examples/pdmodel/AddAnnotations.java"
        ],
        "message": "PDFBOX-4892: add comment related to post from Anze Germovsek\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1884547 13f79535-47bb-0310-9956-ffa450edef68",
        "before_after_code_files": [
          "examples/src/main/java/org/apache/pdfbox/examples/pdmodel/AddAnnotations.java||examples/src/main/java/org/apache/pdfbox/examples/pdmodel/AddAnnotations.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/pdfbox/pull/104"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "examples/src/main/java/org/apache/pdfbox/examples/pdmodel/AddAnnotations.java||examples/src/main/java/org/apache/pdfbox/examples/pdmodel/AddAnnotations.java": [
          "File: examples/src/main/java/org/apache/pdfbox/examples/pdmodel/AddAnnotations.java -> examples/src/main/java/org/apache/pdfbox/examples/pdmodel/AddAnnotations.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "109:             PDAnnotationTextMarkup txtMark = new PDAnnotationTextMarkup(",
          "110:                     PDAnnotationTextMarkup.SUB_TYPE_HIGHLIGHT);",
          "111:             txtMark.setColor(blue);",
          "115:             float textWidth = font.getStringWidth(\"PDFBox\") / 1000 * 18;",
          "",
          "[Removed Lines]",
          "112:             txtMark.setConstantOpacity((float)0.2); // 20% transparent",
          "",
          "[Added Lines]",
          "115:             txtMark.setConstantOpacity((float) 0.2); // 20% transparent",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "6bd7fdda969edafc23d6544083d85d8a025d2f50",
      "candidate_info": {
        "commit_hash": "6bd7fdda969edafc23d6544083d85d8a025d2f50",
        "repo": "apache/pdfbox",
        "commit_url": "https://github.com/apache/pdfbox/commit/6bd7fdda969edafc23d6544083d85d8a025d2f50",
        "files": [
          "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/common/PDStream.java"
        ],
        "message": "PDFBOX-4892: null check not needed (would fail earlier)\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1890142 13f79535-47bb-0310-9956-ffa450edef68",
        "before_after_code_files": [
          "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/common/PDStream.java||pdfbox/src/main/java/org/apache/pdfbox/pdmodel/common/PDStream.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/pdfbox/pull/104"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/common/PDStream.java||pdfbox/src/main/java/org/apache/pdfbox/pdmodel/common/PDStream.java": [
          "File: pdfbox/src/main/java/org/apache/pdfbox/pdmodel/common/PDStream.java -> pdfbox/src/main/java/org/apache/pdfbox/pdmodel/common/PDStream.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "143:             {",
          "144:                 output.close();",
          "145:             }",
          "150:         }",
          "151:     }",
          "",
          "[Removed Lines]",
          "146:             if (input != null)",
          "147:             {",
          "148:                 input.close();",
          "149:             }",
          "",
          "[Added Lines]",
          "146:             input.close();",
          "",
          "---------------"
        ]
      }
    }
  ]
}