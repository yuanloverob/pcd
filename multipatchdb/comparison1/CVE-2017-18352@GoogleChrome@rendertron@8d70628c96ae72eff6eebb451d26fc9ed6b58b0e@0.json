{
  "cve_id": "CVE-2017-18352",
  "cve_desc": "Error reporting within Rendertron 1.0.0 allows reflected Cross Site Scripting (XSS) from invalid URLs.",
  "repo": "GoogleChrome/rendertron",
  "patch_hash": "8d70628c96ae72eff6eebb451d26fc9ed6b58b0e",
  "patch_info": {
    "commit_hash": "8d70628c96ae72eff6eebb451d26fc9ed6b58b0e",
    "repo": "GoogleChrome/rendertron",
    "commit_url": "https://github.com/GoogleChrome/rendertron/commit/8d70628c96ae72eff6eebb451d26fc9ed6b58b0e",
    "files": [
      "middleware/src/middleware.js",
      "middleware/test/middleware-test.js",
      "src/cache.js",
      "src/index.html",
      "src/main.js",
      "src/renderer.js",
      "test/app-test.js",
      "test/cache-test.js",
      "test/resources/basic-script.html",
      "test/resources/custom-element.html",
      "test/resources/explicit-render-event.html",
      "test/resources/http-meta-status-code-multiple.html",
      "test/resources/http-meta-status-code.html",
      "test/resources/include-script.html",
      "test/resources/inject-element-after-load.js",
      "test/resources/inject-element.js",
      "test/resources/script-after-load.html",
      "test/resources/shadow-dom-no-polyfill.html",
      "test/resources/shadow-dom-polyfill-all.html",
      "test/resources/shadow-dom-polyfill-loader.html"
    ],
    "message": "copyright headers (#72)",
    "before_after_code_files": [
      "middleware/src/middleware.js||middleware/src/middleware.js",
      "middleware/test/middleware-test.js||middleware/test/middleware-test.js",
      "src/cache.js||src/cache.js",
      "src/index.html||src/index.html",
      "src/main.js||src/main.js",
      "src/renderer.js||src/renderer.js",
      "test/app-test.js||test/app-test.js",
      "test/cache-test.js||test/cache-test.js",
      "test/resources/basic-script.html||test/resources/basic-script.html",
      "test/resources/custom-element.html||test/resources/custom-element.html",
      "test/resources/explicit-render-event.html||test/resources/explicit-render-event.html",
      "test/resources/http-meta-status-code-multiple.html||test/resources/http-meta-status-code-multiple.html",
      "test/resources/http-meta-status-code.html||test/resources/http-meta-status-code.html",
      "test/resources/include-script.html||test/resources/include-script.html",
      "test/resources/inject-element-after-load.js||test/resources/inject-element-after-load.js",
      "test/resources/inject-element.js||test/resources/inject-element.js",
      "test/resources/script-after-load.html||test/resources/script-after-load.html",
      "test/resources/shadow-dom-no-polyfill.html||test/resources/shadow-dom-no-polyfill.html",
      "test/resources/shadow-dom-polyfill-all.html||test/resources/shadow-dom-polyfill-all.html",
      "test/resources/shadow-dom-polyfill-loader.html||test/resources/shadow-dom-polyfill-loader.html"
    ]
  },
  "patch_diff": {
    "middleware/src/middleware.js||middleware/src/middleware.js": [
      "File: middleware/src/middleware.js -> middleware/src/middleware.js"
    ],
    "middleware/test/middleware-test.js||middleware/test/middleware-test.js": [
      "File: middleware/test/middleware-test.js -> middleware/test/middleware-test.js"
    ],
    "src/cache.js||src/cache.js": [
      "File: src/cache.js -> src/cache.js"
    ],
    "src/index.html||src/index.html": [
      "File: src/index.html -> src/index.html",
      "--- Hunk 1 ---",
      "[Context before]",
      "1: <!doctype html>",
      "2: <html lang=\"en\">",
      "3:   <head>",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: <!--",
      "2: Copyright 2017 Google Inc. All rights reserved.",
      "4: Licensed under the Apache License, Version 2.0 (the \"License\"); you may not",
      "5: use this file except in compliance with the License. You may obtain a copy of",
      "6: the License at",
      "8:     http://www.apache.org/licenses/LICENSE-2.0",
      "10: Unless required by applicable law or agreed to in writing, software",
      "11: distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT",
      "12: WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the",
      "13: License for the specific language governing permissions and limitations under",
      "14: the License.",
      "15: -->",
      "",
      "---------------"
    ],
    "src/main.js||src/main.js": [
      "File: src/main.js -> src/main.js"
    ],
    "src/renderer.js||src/renderer.js": [
      "File: src/renderer.js -> src/renderer.js"
    ],
    "test/app-test.js||test/app-test.js": [
      "File: test/app-test.js -> test/app-test.js"
    ],
    "test/cache-test.js||test/cache-test.js": [
      "File: test/cache-test.js -> test/cache-test.js"
    ],
    "test/resources/basic-script.html||test/resources/basic-script.html": [
      "File: test/resources/basic-script.html -> test/resources/basic-script.html",
      "--- Hunk 1 ---",
      "[Context before]",
      "1: <script>",
      "2:   var element = document.createElement('title');",
      "3:   element.textContent = 'document' + '-title';",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: <!--",
      "2: Copyright 2017 Google Inc. All rights reserved.",
      "4: Licensed under the Apache License, Version 2.0 (the \"License\"); you may not",
      "5: use this file except in compliance with the License. You may obtain a copy of",
      "6: the License at",
      "8:     http://www.apache.org/licenses/LICENSE-2.0",
      "10: Unless required by applicable law or agreed to in writing, software",
      "11: distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT",
      "12: WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the",
      "13: License for the specific language governing permissions and limitations under",
      "14: the License.",
      "15: -->",
      "",
      "---------------"
    ],
    "test/resources/custom-element.html||test/resources/custom-element.html": [
      "File: test/resources/custom-element.html -> test/resources/custom-element.html",
      "--- Hunk 1 ---",
      "[Context before]",
      "1: <script>",
      "2:   class MyElement extends HTMLElement {",
      "3:     constructor() {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: <!--",
      "2: Copyright 2017 Google Inc. All rights reserved.",
      "4: Licensed under the Apache License, Version 2.0 (the \"License\"); you may not",
      "5: use this file except in compliance with the License. You may obtain a copy of",
      "6: the License at",
      "8:     http://www.apache.org/licenses/LICENSE-2.0",
      "10: Unless required by applicable law or agreed to in writing, software",
      "11: distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT",
      "12: WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the",
      "13: License for the specific language governing permissions and limitations under",
      "14: the License.",
      "15: -->",
      "",
      "---------------"
    ],
    "test/resources/explicit-render-event.html||test/resources/explicit-render-event.html": [
      "File: test/resources/explicit-render-event.html -> test/resources/explicit-render-event.html",
      "--- Hunk 1 ---",
      "[Context before]",
      "1: <script>",
      "2:   setTimeout(() => {",
      "3:     document.body.textContent = 'async loaded';",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: <!--",
      "2: Copyright 2017 Google Inc. All rights reserved.",
      "4: Licensed under the Apache License, Version 2.0 (the \"License\"); you may not",
      "5: use this file except in compliance with the License. You may obtain a copy of",
      "6: the License at",
      "8:     http://www.apache.org/licenses/LICENSE-2.0",
      "10: Unless required by applicable law or agreed to in writing, software",
      "11: distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT",
      "12: WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the",
      "13: License for the specific language governing permissions and limitations under",
      "14: the License.",
      "15: -->",
      "",
      "---------------"
    ],
    "test/resources/http-meta-status-code-multiple.html||test/resources/http-meta-status-code-multiple.html": [
      "File: test/resources/http-meta-status-code-multiple.html -> test/resources/http-meta-status-code-multiple.html",
      "--- Hunk 1 ---",
      "[Context before]",
      "1: <meta name=\"render:status_code\" content=\"401\">",
      "2: <meta name=\"render:status_code\" content=\"402\">",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: <!--",
      "2: Copyright 2017 Google Inc. All rights reserved.",
      "4: Licensed under the Apache License, Version 2.0 (the \"License\"); you may not",
      "5: use this file except in compliance with the License. You may obtain a copy of",
      "6: the License at",
      "8:     http://www.apache.org/licenses/LICENSE-2.0",
      "10: Unless required by applicable law or agreed to in writing, software",
      "11: distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT",
      "12: WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the",
      "13: License for the specific language governing permissions and limitations under",
      "14: the License.",
      "15: -->",
      "",
      "---------------"
    ],
    "test/resources/http-meta-status-code.html||test/resources/http-meta-status-code.html": [
      "File: test/resources/http-meta-status-code.html -> test/resources/http-meta-status-code.html",
      "--- Hunk 1 ---",
      "[Context before]",
      "1: <meta name=\"render:status_code\" content=\"400\">",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: <!--",
      "2: Copyright 2017 Google Inc. All rights reserved.",
      "4: Licensed under the Apache License, Version 2.0 (the \"License\"); you may not",
      "5: use this file except in compliance with the License. You may obtain a copy of",
      "6: the License at",
      "8:     http://www.apache.org/licenses/LICENSE-2.0",
      "10: Unless required by applicable law or agreed to in writing, software",
      "11: distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT",
      "12: WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the",
      "13: License for the specific language governing permissions and limitations under",
      "14: the License.",
      "15: -->",
      "",
      "---------------"
    ],
    "test/resources/include-script.html||test/resources/include-script.html": [
      "File: test/resources/include-script.html -> test/resources/include-script.html",
      "--- Hunk 1 ---",
      "[Context before]",
      "1: <script src=\"inject-element-after-load.js\"></script>",
      "2: <link rel=\"import\" href=\"custom-element.html\">",
      "3: <custom-element></custom-element>",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: <!--",
      "2: Copyright 2017 Google Inc. All rights reserved.",
      "4: Licensed under the Apache License, Version 2.0 (the \"License\"); you may not",
      "5: use this file except in compliance with the License. You may obtain a copy of",
      "6: the License at",
      "8:     http://www.apache.org/licenses/LICENSE-2.0",
      "10: Unless required by applicable law or agreed to in writing, software",
      "11: distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT",
      "12: WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the",
      "13: License for the specific language governing permissions and limitations under",
      "14: the License.",
      "15: -->",
      "",
      "---------------"
    ],
    "test/resources/inject-element-after-load.js||test/resources/inject-element-after-load.js": [
      "File: test/resources/inject-element-after-load.js -> test/resources/inject-element-after-load.js"
    ],
    "test/resources/inject-element.js||test/resources/inject-element.js": [
      "File: test/resources/inject-element.js -> test/resources/inject-element.js"
    ],
    "test/resources/script-after-load.html||test/resources/script-after-load.html": [
      "File: test/resources/script-after-load.html -> test/resources/script-after-load.html",
      "--- Hunk 1 ---",
      "[Context before]",
      "1: <script>",
      "2: window.onload = function() {",
      "3:   var script = document.createElement('script');",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: <!--",
      "2: Copyright 2017 Google Inc. All rights reserved.",
      "4: Licensed under the Apache License, Version 2.0 (the \"License\"); you may not",
      "5: use this file except in compliance with the License. You may obtain a copy of",
      "6: the License at",
      "8:     http://www.apache.org/licenses/LICENSE-2.0",
      "10: Unless required by applicable law or agreed to in writing, software",
      "11: distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT",
      "12: WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the",
      "13: License for the specific language governing permissions and limitations under",
      "14: the License.",
      "15: -->",
      "",
      "---------------"
    ],
    "test/resources/shadow-dom-no-polyfill.html||test/resources/shadow-dom-no-polyfill.html": [
      "File: test/resources/shadow-dom-no-polyfill.html -> test/resources/shadow-dom-no-polyfill.html",
      "--- Hunk 1 ---",
      "[Context before]",
      "1: <my-element></my-element>",
      "2: <script>",
      "3:   class MyElement extends HTMLElement {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: <!--",
      "2: Copyright 2017 Google Inc. All rights reserved.",
      "4: Licensed under the Apache License, Version 2.0 (the \"License\"); you may not",
      "5: use this file except in compliance with the License. You may obtain a copy of",
      "6: the License at",
      "8:     http://www.apache.org/licenses/LICENSE-2.0",
      "10: Unless required by applicable law or agreed to in writing, software",
      "11: distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT",
      "12: WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the",
      "13: License for the specific language governing permissions and limitations under",
      "14: the License.",
      "15: -->",
      "",
      "---------------"
    ],
    "test/resources/shadow-dom-polyfill-all.html||test/resources/shadow-dom-polyfill-all.html": [
      "File: test/resources/shadow-dom-polyfill-all.html -> test/resources/shadow-dom-polyfill-all.html",
      "--- Hunk 1 ---",
      "[Context before]",
      "1: <script src=\"node_modules/@webcomponents/webcomponentsjs/webcomponents-lite.js\"></script>",
      "2: <my-element></my-element>",
      "3: <script>",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: <!--",
      "2: Copyright 2017 Google Inc. All rights reserved.",
      "4: Licensed under the Apache License, Version 2.0 (the \"License\"); you may not",
      "5: use this file except in compliance with the License. You may obtain a copy of",
      "6: the License at",
      "8:     http://www.apache.org/licenses/LICENSE-2.0",
      "10: Unless required by applicable law or agreed to in writing, software",
      "11: distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT",
      "12: WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the",
      "13: License for the specific language governing permissions and limitations under",
      "14: the License.",
      "15: -->",
      "",
      "---------------"
    ],
    "test/resources/shadow-dom-polyfill-loader.html||test/resources/shadow-dom-polyfill-loader.html": [
      "File: test/resources/shadow-dom-polyfill-loader.html -> test/resources/shadow-dom-polyfill-loader.html",
      "--- Hunk 1 ---",
      "[Context before]",
      "1: <script src=\"node_modules/@webcomponents/webcomponentsjs/webcomponents-loader.js\"></script>",
      "2: <my-element></my-element>",
      "3: <script>",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: <!--",
      "2: Copyright 2017 Google Inc. All rights reserved.",
      "4: Licensed under the Apache License, Version 2.0 (the \"License\"); you may not",
      "5: use this file except in compliance with the License. You may obtain a copy of",
      "6: the License at",
      "8:     http://www.apache.org/licenses/LICENSE-2.0",
      "10: Unless required by applicable law or agreed to in writing, software",
      "11: distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT",
      "12: WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the",
      "13: License for the specific language governing permissions and limitations under",
      "14: the License.",
      "15: -->",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "f18019575ed058783bdd920aeca4f791cec3ca32",
      "candidate_info": {
        "commit_hash": "f18019575ed058783bdd920aeca4f791cec3ca32",
        "repo": "GoogleChrome/rendertron",
        "commit_url": "https://github.com/GoogleChrome/rendertron/commit/f18019575ed058783bdd920aeca4f791cec3ca32",
        "files": [
          "README.md",
          "package-lock.json",
          "package.json",
          "src/index.html",
          "src/renderer.ts",
          "src/rendertron.ts"
        ],
        "message": "Serve updated index, added viewport dimension support, improved <base> support (#197)",
        "before_after_code_files": [
          "src/index.html||src/index.html",
          "src/renderer.ts||src/renderer.ts",
          "src/rendertron.ts||src/rendertron.ts"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/index.html||src/index.html"
          ],
          "candidate": [
            "src/index.html||src/index.html"
          ]
        }
      },
      "candidate_diff": {
        "src/index.html||src/index.html": [
          "File: src/index.html -> src/index.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: <!--",
          "4: Licensed under the Apache License, Version 2.0 (the \"License\"); you may not",
          "5: use this file except in compliance with the License. You may obtain a copy of",
          "",
          "[Removed Lines]",
          "2: Copyright 2017 Google Inc. All rights reserved.",
          "",
          "[Added Lines]",
          "2: Copyright 2018 Google Inc. All rights reserved.",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "15: -->",
          "16: <!doctype html>",
          "17: <html lang=\"en\">",
          "138:       }",
          "144:       }",
          "196:       if (!url.value) {",
          "197:         onEmptyUrl();",
          "198:         return;",
          "",
          "[Removed Lines]",
          "18:   <head>",
          "19:     <meta charset=\"utf-8\">",
          "20:     <meta name=\"viewport\" content=\"width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes\">",
          "22:     <title>Rendertron</title>",
          "23:     <meta name=\"description\" content=\"Rendertron - headless rendering service\">",
          "25:     <link href=\"https://fonts.googleapis.com/css?family=Orbitron\" rel=\"stylesheet\">",
          "26:     <link href=\"https://fonts.googleapis.com/icon?family=Material+Icons\" rel=\"stylesheet\">",
          "28:     <script>",
          "29:       (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){",
          "30:       (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),",
          "31:       m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)",
          "32:       })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');",
          "34:       ga('create', 'UA-104508854-1', 'auto');",
          "35:       ga('send', 'pageview');",
          "36:     </script>",
          "38:     <style>",
          "39:       body {",
          "40:         background: black;",
          "41:         display: flex;",
          "42:         flex-direction: column;",
          "43:         align-items: center;",
          "44:         justify-content: center;",
          "45:         font-family: 'Orbitron', sans-serif;",
          "46:         margin: 0;",
          "47:         min-height: calc(100vh - 40px);",
          "48:         padding: 20px 0;",
          "49:       }",
          "51:       h1 {",
          "52:         font-size: 60px;",
          "53:         color: white;",
          "54:         border-bottom: 1px solid #99f3ff;",
          "55:         margin: 64px 32px;",
          "56:       }",
          "58:       #search-bar {",
          "59:         min-width: 300px;",
          "60:         width: calc(100% - 40px);",
          "61:         max-width: 664px;",
          "62:         position: relative;",
          "63:         box-sizing: border-box;",
          "64:       }",
          "66:       input[type=url] {",
          "67:         width: 100%;",
          "68:         padding: 30px;",
          "69:         box-sizing: border-box;",
          "70:         border: none;",
          "71:         font-size: 24px;",
          "72:         background: black;",
          "73:         border-radius: 10px;",
          "74:         border: 2px solid #99f3ff;",
          "75:         color: white;",
          "76:         font-family: 'Orbitron', sans-serif;",
          "77:         text-align: center;",
          "78:       }",
          "80:       progress-bar {",
          "81:         --progress-bar-color: #99f3ff;",
          "82:         height: 10px;",
          "83:         position: absolute;",
          "84:         margin-top: -10px;",
          "85:         border-radius: 0 0 10px 10px;",
          "86:       }",
          "88:       #options {",
          "89:         margin-top: 32px;",
          "90:         display: flex;",
          "91:         flex-wrap: wrap;",
          "92:         max-width: 800px;",
          "93:         justify-content: center;",
          "94:       }",
          "96:       #options > * {",
          "97:         margin: 32px;",
          "98:       }",
          "100:       #options button {",
          "101:         display: block;",
          "102:         width: 300px;",
          "103:         height: 300px;",
          "104:         border: 1px solid #99f3ff;",
          "105:         color: white;",
          "106:         background: none;",
          "107:         display: flex;",
          "108:         flex-direction: column;",
          "109:         font-size: 18px;",
          "110:         font-family: 'Orbitron', sans-serif;",
          "111:         align-items: center;",
          "112:         justify-content: center;",
          "113:         cursor: pointer;",
          "114:       }",
          "116:       .loading {",
          "117:         box-shadow: #99f3ff 0px 0px 7px 4px;",
          "118:         animation: pulse 1s infinite alternate cubic-bezier(0.4, 0, 0.2, 1)",
          "119:       }",
          "121:       .error {",
          "122:         border-color: #FF9999 !important;",
          "123:       }",
          "125:       @keyframes pulse {",
          "126:         from {",
          "127:           filter: blur(0px);",
          "128:           transform: none;",
          "129:         }",
          "130:         to {",
          "131:           filter: blur(1px);",
          "132:           transform: scale(1.05);",
          "133:         }",
          "134:       }",
          "136:       #options button i {",
          "137:         font-size: 96px;",
          "140:       #options button span {",
          "141:         margin-top: 24px;",
          "142:         max-width: 200px;",
          "143:         line-height: 24px;",
          "146:       a {",
          "147:         text-decoration: none;",
          "148:         color: inherit;",
          "149:       }",
          "151:       :focus, #url:focus, #options button:hover {",
          "152:         transition: 100ms box-shadow cubic-bezier(0, 0, 0.2, 1);",
          "153:         box-shadow: #99f3ff 0px 0px 7px 4px;",
          "154:       }",
          "156:       @media (max-width: 500px) {",
          "157:         h1 {",
          "158:           font-size: 40px;",
          "159:         }",
          "160:       }",
          "161:     </style>",
          "162:   </head>",
          "163:   <body>",
          "164:     <h1>Rendertron</h1>",
          "166:     <div id=\"search-bar\">",
          "167:       <input id=\"url\" type=\"url\" placeholder=\"Enter a URL\" autocapitalize=\"off\" spellcheck=\"false\">",
          "168:       <progress-bar hidden></progress-bar>",
          "169:     </div>",
          "171:     <div id=\"options\">",
          "172:       <button onclick=\"takeScreenshot(this)\">",
          "173:         <i class=\"material-icons\">photo_camera</i>",
          "174:         <span>Take screenshot</span>",
          "175:       </button>",
          "176:       <button onclick=\"render(this, false)\">",
          "177:         <i class=\"material-icons\">cloud_upload</i>",
          "178:         <span>Render &amp; serialize</span>",
          "179:       </button>",
          "180:       <button onclick=\"render(this, true)\">",
          "181:         <i class=\"material-icons\">code</i>",
          "182:         <span>Render &amp; serialize with web components v1</span>",
          "183:       </button>",
          "184:       <a href=\"https://github.com/GoogleChrome/rendertron\" target=\"_blank\">",
          "185:         <button tabindex=\"-1\">",
          "186:           <i class=\"material-icons\">insert_drive_file</i>",
          "187:           <span>View documentation</span>",
          "188:         </button>",
          "189:       </a>",
          "190:     </div>",
          "194:     <script>",
          "195:     function render(element, webcomponents) {",
          "",
          "[Added Lines]",
          "19: <head>",
          "20:   <meta charset=\"utf-8\">",
          "21:   <meta name=\"viewport\" content=\"width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes\">",
          "23:   <title>Rendertron</title>",
          "24:   <meta name=\"description\" content=\"Rendertron - headless rendering service\">",
          "26:   <link href=\"https://fonts.googleapis.com/css?family=Orbitron\" rel=\"stylesheet\">",
          "27:   <link href=\"https://fonts.googleapis.com/icon?family=Material+Icons\" rel=\"stylesheet\">",
          "29:   <script>",
          "30:     (function (i, s, o, g, r, a, m) {",
          "31:       i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {",
          "32:         (i[r].q = i[r].q || []).push(arguments)",
          "33:       }, i[r].l = 1 * new Date(); a = s.createElement(o),",
          "34:         m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)",
          "35:     })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');",
          "37:     ga('create', 'UA-104508854-1', 'auto');",
          "38:     ga('send', 'pageview');",
          "39:   </script>",
          "41:   <style>",
          "42:     body {",
          "43:       background: black;",
          "44:       display: flex;",
          "45:       flex-direction: column;",
          "46:       align-items: center;",
          "47:       justify-content: center;",
          "48:       font-family: 'Orbitron', sans-serif;",
          "49:       margin: 0;",
          "50:       min-height: calc(100vh - 40px);",
          "51:       padding: 20px 0;",
          "52:     }",
          "54:     h1 {",
          "55:       font-size: 60px;",
          "56:       color: white;",
          "57:       border-bottom: 1px solid #99f3ff;",
          "58:       margin: 64px 32px;",
          "59:     }",
          "61:     #search-bar {",
          "62:       min-width: 300px;",
          "63:       width: calc(100% - 40px);",
          "64:       max-width: 664px;",
          "65:       position: relative;",
          "66:       box-sizing: border-box;",
          "67:     }",
          "69:     input[type=url] {",
          "70:       width: 100%;",
          "71:       padding: 30px;",
          "72:       box-sizing: border-box;",
          "73:       border: none;",
          "74:       font-size: 24px;",
          "75:       background: black;",
          "76:       border-radius: 10px;",
          "77:       border: 2px solid #99f3ff;",
          "78:       color: white;",
          "79:       font-family: 'Orbitron', sans-serif;",
          "80:       text-align: center;",
          "81:     }",
          "83:     progress-bar {",
          "84:       --progress-bar-color: #99f3ff;",
          "85:       height: 10px;",
          "86:       position: absolute;",
          "87:       margin-top: -10px;",
          "88:       border-radius: 0 0 10px 10px;",
          "89:     }",
          "91:     #options {",
          "92:       margin-top: 32px;",
          "93:       display: flex;",
          "94:       flex-wrap: wrap;",
          "95:       max-width: 800px;",
          "96:       justify-content: center;",
          "97:     }",
          "99:     #options>* {",
          "100:       margin: 32px;",
          "101:     }",
          "103:     #options button {",
          "104:       display: block;",
          "105:       width: 300px;",
          "106:       height: 300px;",
          "107:       border: 1px solid #99f3ff;",
          "108:       color: white;",
          "109:       background: none;",
          "110:       display: flex;",
          "111:       flex-direction: column;",
          "112:       font-size: 18px;",
          "113:       font-family: 'Orbitron', sans-serif;",
          "114:       align-items: center;",
          "115:       justify-content: center;",
          "116:       cursor: pointer;",
          "117:     }",
          "119:     .loading {",
          "120:       box-shadow: #99f3ff 0px 0px 7px 4px;",
          "121:       animation: pulse 1s infinite alternate cubic-bezier(0.4, 0, 0.2, 1)",
          "122:     }",
          "124:     .error {",
          "125:       border-color: #FF9999 !important;",
          "126:     }",
          "128:     @keyframes pulse {",
          "129:       from {",
          "130:         filter: blur(0px);",
          "131:         transform: none;",
          "133:       to {",
          "134:         filter: blur(1px);",
          "135:         transform: scale(1.05);",
          "137:     }",
          "139:     #options button i {",
          "140:       font-size: 96px;",
          "141:     }",
          "143:     #options button span {",
          "144:       margin-top: 24px;",
          "145:       max-width: 200px;",
          "146:       line-height: 24px;",
          "147:     }",
          "149:     a {",
          "150:       text-decoration: none;",
          "151:       color: inherit;",
          "152:     }",
          "154:     :focus,",
          "155:     #url:focus,",
          "156:     #options button:hover {",
          "157:       transition: 100ms box-shadow cubic-bezier(0, 0, 0.2, 1);",
          "158:       box-shadow: #99f3ff 0px 0px 7px 4px;",
          "159:     }",
          "161:     @media (max-width: 500px) {",
          "162:       h1 {",
          "163:         font-size: 40px;",
          "164:       }",
          "165:     }",
          "166:   </style>",
          "167: </head>",
          "169: <body>",
          "170:   <h1>Rendertron</h1>",
          "172:   <div id=\"search-bar\">",
          "173:     <input id=\"url\" type=\"url\" placeholder=\"Enter a URL\" autocapitalize=\"off\" spellcheck=\"false\">",
          "174:     <progress-bar hidden></progress-bar>",
          "175:   </div>",
          "177:   <div id=\"options\">",
          "178:     <button onclick=\"takeScreenshot(this)\">",
          "179:       <i class=\"material-icons\">photo_camera</i>",
          "180:       <span>Take screenshot</span>",
          "181:     </button>",
          "182:     <button onclick=\"render(this)\">",
          "183:       <i class=\"material-icons\">cloud_upload</i>",
          "184:       <span>Render &amp; serialize</span>",
          "185:     </button>",
          "186:     <a href=\"https://github.com/GoogleChrome/rendertron\" target=\"_blank\">",
          "187:       <button tabindex=\"-1\">",
          "188:         <i class=\"material-icons\">insert_drive_file</i>",
          "189:         <span>View documentation</span>",
          "190:       </button>",
          "191:     </a>",
          "192:   </div>",
          "194:   <script>",
          "195:     function render(element) {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "201:       element.classList.add('loading');",
          "202:       document.querySelector('progress-bar').removeAttribute('hidden');",
          "205:     }",
          "207:     function takeScreenshot(element) {",
          "",
          "[Removed Lines]",
          "203:       var queryParams = webcomponents ? '?wc-inject-shadydom=true' : '';",
          "204:       window.location.href += `render/${url.value.replace('?', '%3F')}${queryParams}`;",
          "",
          "[Added Lines]",
          "203:       window.location.href += `render/${url.value.replace('?', '%3F')}`;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "213:       var httpRegex = /(http(s?))\\:\\/\\//gi;",
          "216:         url.value = 'https://' + url.value;",
          "217:       }",
          "",
          "[Removed Lines]",
          "215:       if(!httpRegex.test(url.value)) {",
          "",
          "[Added Lines]",
          "214:       if (!httpRegex.test(url.value)) {",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "224:     function onEmptyUrl() {",
          "225:       url.classList.add('error');",
          "226:     }",
          "231: </html>",
          "",
          "[Removed Lines]",
          "227:     </script>",
          "229:     <link rel=\"import\" href=\"progress-bar.html\">",
          "230:   </body>",
          "",
          "[Added Lines]",
          "226:   </script>",
          "228:   <link rel=\"import\" href=\"progress-bar.html\">",
          "229: </body>",
          "",
          "---------------"
        ],
        "src/renderer.ts||src/renderer.ts": [
          "File: src/renderer.ts -> src/renderer.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: import * as puppeteer from 'puppeteer';",
          "3: type SerializedResponse = {",
          "4:   status: number; content: string;",
          "5: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2: import * as url from 'url';",
          "8: type ViewportDimensions = {",
          "9:   width: number; height: number;",
          "10: };",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "15:     this.browser = browser;",
          "16:   }",
          "",
          "[Removed Lines]",
          "18:   async serialize(url: string): Promise<SerializedResponse> {",
          "",
          "[Added Lines]",
          "23:   async serialize(requestUrl: string): Promise<SerializedResponse> {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "36:       const base = document.createElement('base');",
          "39:     }",
          "41:     const page = await this.browser.newPage();",
          "43:     page.evaluateOnNewDocument('customElements.forcePolyfill = true');",
          "44:     page.evaluateOnNewDocument('ShadyDOM = {force: true}');",
          "45:     page.evaluateOnNewDocument('ShadyCSS = {shimcssproperties: true}');",
          "48:     const response =",
          "50:             .catch(() => {",
          "52:               return undefined;",
          "",
          "[Removed Lines]",
          "35:     function injectBaseHref(url: string) {",
          "37:       base.setAttribute('href', url);",
          "38:       document.head.appendChild(base);",
          "49:         await page.goto(url, {timeout: 10000, waitUntil: 'networkidle0'})",
          "",
          "[Added Lines]",
          "40:     function injectBaseHref(origin: string) {",
          "42:       base.setAttribute('href', origin);",
          "44:       const bases = document.head.querySelectorAll('base');",
          "45:       if (bases.length) {",
          "47:         const existingBase = bases[0].getAttribute('href') || '';",
          "48:         if (existingBase.startsWith('/')) {",
          "49:           bases[0].setAttribute('href', origin + existingBase);",
          "50:         }",
          "51:       } else {",
          "53:         document.head.insertAdjacentElement('afterbegin', base);",
          "54:       }",
          "59:     page.setViewport({width: 1000, height: 1000});",
          "67:         await page.goto(requestUrl, {timeout: 10000, waitUntil: 'networkidle0'})",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "82:     await page.evaluate(stripPage);",
          "87:     const result = await page.evaluate('document.firstElementChild.outerHTML');",
          "",
          "[Removed Lines]",
          "84:     await page.evaluate(injectBaseHref);",
          "",
          "[Added Lines]",
          "102:     const parsedUrl = url.parse(requestUrl);",
          "103:     await page.evaluate(",
          "104:         injectBaseHref, `${parsedUrl.protocol}//${parsedUrl.host}`);",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "90:     return {status: statusCode, content: result};",
          "91:   }",
          "94:     const page = await this.browser.newPage();",
          "98:     await page.goto(url, {timeout: 10000, waitUntil: 'networkidle0'});",
          "",
          "[Removed Lines]",
          "93:   async screenshot(url: string, options?: object): Promise<Buffer> {",
          "96:     page.setViewport({width: 1000, height: 1000});",
          "",
          "[Added Lines]",
          "113:   async screenshot(",
          "114:       url: string,",
          "115:       dimensions: ViewportDimensions,",
          "116:       options?: object): Promise<Buffer> {",
          "119:     page.setViewport({width: dimensions.width, height: dimensions.height});",
          "",
          "---------------"
        ],
        "src/rendertron.ts||src/rendertron.ts": [
          "File: src/rendertron.ts -> src/rendertron.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: import * as bodyParser from 'koa-bodyparser';",
          "4: import * as koaCompress from 'koa-compress';",
          "5: import * as route from 'koa-route';",
          "6: import * as path from 'path';",
          "7: import * as puppeteer from 'puppeteer';",
          "8: import * as url from 'url';",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "6: import * as koaSend from 'koa-send';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "43:       this.app.use(new DatastoreCache().middleware());",
          "44:     }",
          "46:     this.app.use(",
          "47:         route.get('/_ah/health', (ctx: Koa.Context) => ctx.body = 'OK'));",
          "48:     this.app.use(",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "47:     this.app.use(route.get('/', async (ctx: Koa.Context) => {",
          "48:       await koaSend(",
          "49:           ctx, 'index.html', {root: path.resolve(__dirname, '../src')});",
          "50:     }));",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "98:       options = ctx.request.body;",
          "99:     }",
          "102:     ctx.set('Content-Type', 'image/jpeg');",
          "103:     ctx.set('Content-Length', img.length.toString());",
          "104:     ctx.body = img;",
          "",
          "[Removed Lines]",
          "101:     const img = await this.renderer.screenshot(url, options);",
          "",
          "[Added Lines]",
          "106:     const dimensions = {",
          "107:       width: Number(ctx.query['width']) || 1000,",
          "108:       height: Number(ctx.query['height']) || 1000",
          "109:     };",
          "111:     const img = await this.renderer.screenshot(url, dimensions, options);",
          "",
          "---------------"
        ]
      }
    }
  ]
}