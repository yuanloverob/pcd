{
  "cve_id": "CVE-2023-41881",
  "cve_desc": "vantage6 is privacy preserving federated learning infrastructure. When a collaboration is deleted, the linked resources (such as tasks from that collaboration) should be deleted. This is partly to manage data properly, but also to prevent a potential (but unlikely) side-effect that affects versions prior to 4.0.0, where if a collaboration with id=10 is deleted, and subsequently a new collaboration is created with id=10, the authenticated users in that collaboration could potentially see results of the deleted collaboration in some cases. Version 4.0.0 contains a patch for this issue. There are no known workarounds.",
  "repo": "vantage6/vantage6",
  "patch_hash": "cce9538f8b70e814c080dd0ae43b297f3af8a732",
  "patch_info": {
    "commit_hash": "cce9538f8b70e814c080dd0ae43b297f3af8a732",
    "repo": "vantage6/vantage6",
    "commit_url": "https://github.com/vantage6/vantage6/commit/cce9538f8b70e814c080dd0ae43b297f3af8a732",
    "files": [
      "vantage6-server/vantage6/server/resource/collaboration.py",
      "vantage6-server/vantage6/server/resource/role.py",
      "vantage6-server/vantage6/server/resource/task.py",
      "vantage6-server/vantage6/server/resource/user.py"
    ],
    "message": "Merge pull request #748 from vantage6/feature/delete-child-resources-by-flag\n\nAdd flag whether linked resources should be deleted in delete endpoin\u2026",
    "before_after_code_files": [
      "vantage6-server/vantage6/server/resource/collaboration.py||vantage6-server/vantage6/server/resource/collaboration.py",
      "vantage6-server/vantage6/server/resource/role.py||vantage6-server/vantage6/server/resource/role.py",
      "vantage6-server/vantage6/server/resource/task.py||vantage6-server/vantage6/server/resource/task.py",
      "vantage6-server/vantage6/server/resource/user.py||vantage6-server/vantage6/server/resource/user.py"
    ]
  },
  "patch_diff": {
    "vantage6-server/vantage6/server/resource/collaboration.py||vantage6-server/vantage6/server/resource/collaboration.py": [
      "File: vantage6-server/vantage6/server/resource/collaboration.py -> vantage6-server/vantage6/server/resource/collaboration.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "515:               type: integer",
      "516:             description: Collaboration id",
      "517:             required: true",
      "519:         responses:",
      "520:           200:",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "518:           - in: query",
      "519:             name: delete_dependents",
      "520:             schema:",
      "521:               type: boolean",
      "522:             description: If set to true, the collaboratio will be deleted along",
      "523:               with all its tasks and nodes (default=False)",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "540:             return {'msg': 'You lack the permission to do that!'}, \\",
      "541:                 HTTPStatus.UNAUTHORIZED",
      "543:         collaboration.delete()",
      "544:         return {\"msg\": f\"Collaboration id={id} successfully deleted\"}, \\",
      "545:             HTTPStatus.OK",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "549:         if collaboration.tasks or collaboration.nodes:",
      "550:             delete_dependents = request.args.get('delete_dependents', False)",
      "551:             if not delete_dependents:",
      "552:                 return {",
      "553:                     \"msg\": f\"Collaboration id={id} has \"",
      "554:                     f\"{len(collaboration.tasks)} tasks and \"",
      "555:                     f\"{len(collaboration.nodes)} nodes. Please delete them \"",
      "556:                     \"separately or set delete_dependents=True\"",
      "557:                 }, HTTPStatus.BAD_REQUEST",
      "558:             else:",
      "559:                 log.warn(f\"Deleting collaboration id={id} along with \"",
      "560:                          f\"{len(collaboration.tasks)} tasks and \"",
      "561:                          f\"{len(collaboration.nodes)} nodes\")",
      "562:                 for task in collaboration.tasks:",
      "563:                     task.delete()",
      "564:                 for node in collaboration.nodes:",
      "565:                     node.delete()",
      "",
      "---------------"
    ],
    "vantage6-server/vantage6/server/resource/role.py||vantage6-server/vantage6/server/resource/role.py": [
      "File: vantage6-server/vantage6/server/resource/role.py -> vantage6-server/vantage6/server/resource/role.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "564:               minimum: 1",
      "565:             description: Role id",
      "566:             required: true",
      "568:         responses:",
      "569:           200:",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "567:           - in: query",
      "568:             name: delete_dependents",
      "569:             schema:",
      "570:               type: boolean",
      "571:             description: If set to true, the role is deleted even though users",
      "572:                with this role may lose permissions (default=False)",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "591:                 return {'msg': 'You can\\'t delete a role from another '",
      "592:                         'organization'}, HTTPStatus.UNAUTHORIZED",
      "594:         role.delete()",
      "596:         return {\"msg\": \"Role removed from the database.\"}, HTTPStatus.OK",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "600:         # check if role is assigned to users",
      "601:         if role.users:",
      "602:             params = request.args",
      "603:             if not params.get('delete_dependents', False):",
      "604:                 return {",
      "605:                     'msg': \"Role is assigned to users. Please remove the role \"",
      "606:                     \"from the users first, or set the 'delete_dependents' \"",
      "607:                     \"parameter to delete the role anyway.\"",
      "608:                 }, HTTPStatus.BAD_REQUEST",
      "609:             else:",
      "610:                 log.warn(f\"Role {id} deleted even though it was assigned to \"",
      "611:                          \"users. This may result in missing permissions.\")",
      "612:                 # Note that the role is removed from the users automatically",
      "613:                 # due to the relationship between the role and the user.",
      "",
      "---------------"
    ],
    "vantage6-server/vantage6/server/resource/task.py||vantage6-server/vantage6/server/resource/task.py": [
      "File: vantage6-server/vantage6/server/resource/task.py -> vantage6-server/vantage6/server/resource/task.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "735:             log.info(f\" Removing run id={run.id}\")",
      "736:             run.delete()",
      "738:         # permissions ok, delete...",
      "739:         task.delete()",
      "741:         return {\"msg\": f\"task id={id} and its algorithm run data have been \"",
      "742:                        \"successfully deleted\"}, HTTPStatus.OK",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "738:         # delete child/grandchild/... tasks",
      "739:         Task._delete_subtasks(task)",
      "747:     @staticmethod",
      "748:     def _delete_subtasks(task: db.Task) -> None:",
      "749:         \"\"\"",
      "750:         Delete subtasks recursively.",
      "752:         Parameters",
      "753:         ----------",
      "754:         task : db.Task",
      "755:             Task to delete.",
      "756:         \"\"\"",
      "757:         for child_task in task.children:",
      "758:             Task._delete_subtasks(child_task)",
      "759:             log.info(f\" Removing child task id={child_task.id}\")",
      "760:             child_task.delete()",
      "",
      "---------------"
    ],
    "vantage6-server/vantage6/server/resource/user.py||vantage6-server/vantage6/server/resource/user.py": [
      "File: vantage6-server/vantage6/server/resource/user.py -> vantage6-server/vantage6/server/resource/user.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "702:               type: integer",
      "703:             description: User id",
      "704:             required: true",
      "706:         responses:",
      "707:           200:",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "705:           - in: query",
      "706:             name: delete_dependents",
      "707:             schema:",
      "708:               type: boolean",
      "709:             description: If set to true, the user will be deleted along with",
      "710:               all tasks they created (default=False)",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "728:                     return {'msg': 'You lack the permission to do that!'}, \\",
      "729:                         HTTPStatus.UNAUTHORIZED",
      "731:         user.delete()",
      "732:         log.info(f\"user id={id} is removed from the database\")",
      "733:         return {\"msg\": f\"user id={id} is removed from the database\"}, \\",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "737:         # check if user created any tasks",
      "738:         if user.created_tasks:",
      "739:             params = request.args",
      "740:             if not params.get('delete_dependents', False):",
      "741:                 return {",
      "742:                     \"msg\": f\"User has created {len(user.created_tasks)} tasks.\"",
      "743:                     \" Please delete those first, or set the \"",
      "744:                     \"`delete_dependents` parameter to true to delete them \"",
      "745:                     \"automatically together with this user.\"",
      "746:                 }, HTTPStatus.BAD_REQUEST",
      "747:             else:",
      "748:                 log.warn(f\"Deleting {len(user.created_tasks)} tasks created by\"",
      "749:                          f\" user id={id}\")",
      "750:                 for task in user.created_tasks:",
      "751:                     task.delete()",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "0759236df85ad097a80235b58420a3d306d54baa",
      "candidate_info": {
        "commit_hash": "0759236df85ad097a80235b58420a3d306d54baa",
        "repo": "vantage6/vantage6",
        "commit_url": "https://github.com/vantage6/vantage6/commit/0759236df85ad097a80235b58420a3d306d54baa",
        "files": [
          "vantage6-server/vantage6/server/resource/user.py"
        ],
        "message": "Corrected formatting error in OAS docstring",
        "before_after_code_files": [
          "vantage6-server/vantage6/server/resource/user.py||vantage6-server/vantage6/server/resource/user.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/vantage6/vantage6/pull/748"
        ],
        "olp_code_files": {
          "patch": [
            "vantage6-server/vantage6/server/resource/user.py||vantage6-server/vantage6/server/resource/user.py"
          ],
          "candidate": [
            "vantage6-server/vantage6/server/resource/user.py||vantage6-server/vantage6/server/resource/user.py"
          ]
        }
      },
      "candidate_diff": {
        "vantage6-server/vantage6/server/resource/user.py||vantage6-server/vantage6/server/resource/user.py": [
          "File: vantage6-server/vantage6/server/resource/user.py -> vantage6-server/vantage6/server/resource/user.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "722:               type: integer",
          "723:             description: User id",
          "724:             required: true",
          "726:             name: delete_dependents",
          "727:             schema:",
          "728:               type: boolean",
          "",
          "[Removed Lines]",
          "725:          - in: query",
          "",
          "[Added Lines]",
          "725:           - in: query",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "8ae351027ac035a46a0d9aece4f5d235d4965154",
      "candidate_info": {
        "commit_hash": "8ae351027ac035a46a0d9aece4f5d235d4965154",
        "repo": "vantage6/vantage6",
        "commit_url": "https://github.com/vantage6/vantage6/commit/8ae351027ac035a46a0d9aece4f5d235d4965154",
        "files": [
          "vantage6-server/vantage6/server/resource/task.py"
        ],
        "message": "Address review comments for deleting subtasks",
        "before_after_code_files": [
          "vantage6-server/vantage6/server/resource/task.py||vantage6-server/vantage6/server/resource/task.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/vantage6/vantage6/pull/748"
        ],
        "olp_code_files": {
          "patch": [
            "vantage6-server/vantage6/server/resource/task.py||vantage6-server/vantage6/server/resource/task.py"
          ],
          "candidate": [
            "vantage6-server/vantage6/server/resource/task.py||vantage6-server/vantage6/server/resource/task.py"
          ]
        }
      },
      "candidate_diff": {
        "vantage6-server/vantage6/server/resource/task.py||vantage6-server/vantage6/server/resource/task.py": [
          "File: vantage6-server/vantage6/server/resource/task.py -> vantage6-server/vantage6/server/resource/task.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "728:             log.info(f\" Removing run id={run.id}\")",
          "729:             run.delete()",
          "734:         # permissions ok, delete...",
          "735:         task.delete()",
          "",
          "[Removed Lines]",
          "731:         # delete child tasks",
          "732:         Task._delete_child_tasks(task)",
          "",
          "[Added Lines]",
          "731:         # delete child/grandchild/... tasks",
          "732:         Task._delete_subtasks(task)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "738:                        \"successfully deleted\"}, HTTPStatus.OK",
          "740:     @staticmethod",
          "742:         \"\"\"",
          "745:         Parameters",
          "746:         ----------",
          "",
          "[Removed Lines]",
          "741:     def _delete_child_tasks(task: db.Task):",
          "743:         Delete child tasks recursively.",
          "",
          "[Added Lines]",
          "741:     def _delete_subtasks(task: db.Task) -> None:",
          "743:         Delete subtasks recursively.",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "748:             Task to delete.",
          "749:         \"\"\"",
          "750:         for child_task in task.children:",
          "752:             log.info(f\" Removing child task id={child_task.id}\")",
          "753:             child_task.delete()",
          "",
          "[Removed Lines]",
          "751:             Task._delete_child_tasks(child_task)",
          "",
          "[Added Lines]",
          "751:             Task._delete_subtasks(child_task)",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "904eff489ddc304872fd7fe2453d811999052088",
      "candidate_info": {
        "commit_hash": "904eff489ddc304872fd7fe2453d811999052088",
        "repo": "vantage6/vantage6",
        "commit_url": "https://github.com/vantage6/vantage6/commit/904eff489ddc304872fd7fe2453d811999052088",
        "files": [
          "vantage6-server/vantage6/server/resource/collaboration.py"
        ],
        "message": "Fix print statement about dependent resources when deleting collaboration",
        "before_after_code_files": [
          "vantage6-server/vantage6/server/resource/collaboration.py||vantage6-server/vantage6/server/resource/collaboration.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/vantage6/vantage6/pull/748"
        ],
        "olp_code_files": {
          "patch": [
            "vantage6-server/vantage6/server/resource/collaboration.py||vantage6-server/vantage6/server/resource/collaboration.py"
          ],
          "candidate": [
            "vantage6-server/vantage6/server/resource/collaboration.py||vantage6-server/vantage6/server/resource/collaboration.py"
          ]
        }
      },
      "candidate_diff": {
        "vantage6-server/vantage6/server/resource/collaboration.py||vantage6-server/vantage6/server/resource/collaboration.py": [
          "File: vantage6-server/vantage6/server/resource/collaboration.py -> vantage6-server/vantage6/server/resource/collaboration.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "539:                 return {",
          "540:                     \"msg\": f\"Collaboration id={id} has \"",
          "541:                     f\"{len(collaboration.tasks)} tasks and \"",
          "543:                     \"separately or set delete_dependents=True\"",
          "544:                 }, HTTPStatus.BAD_REQUEST",
          "545:             else:",
          "",
          "[Removed Lines]",
          "542:                     \"{len(collaboration.nodes)} nodes. Please delete them \"",
          "",
          "[Added Lines]",
          "542:                     f\"{len(collaboration.nodes)} nodes. Please delete them \"",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "b560fc3d2fcbb9b60cd7ef484ab47efc0348f65c",
      "candidate_info": {
        "commit_hash": "b560fc3d2fcbb9b60cd7ef484ab47efc0348f65c",
        "repo": "vantage6/vantage6",
        "commit_url": "https://github.com/vantage6/vantage6/commit/b560fc3d2fcbb9b60cd7ef484ab47efc0348f65c",
        "files": [
          "vantage6-server/vantage6/server/resource/task.py"
        ],
        "message": "Delete child tasks recursively",
        "before_after_code_files": [
          "vantage6-server/vantage6/server/resource/task.py||vantage6-server/vantage6/server/resource/task.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/vantage6/vantage6/pull/748"
        ],
        "olp_code_files": {
          "patch": [
            "vantage6-server/vantage6/server/resource/task.py||vantage6-server/vantage6/server/resource/task.py"
          ],
          "candidate": [
            "vantage6-server/vantage6/server/resource/task.py||vantage6-server/vantage6/server/resource/task.py"
          ]
        }
      },
      "candidate_diff": {
        "vantage6-server/vantage6/server/resource/task.py||vantage6-server/vantage6/server/resource/task.py": [
          "File: vantage6-server/vantage6/server/resource/task.py -> vantage6-server/vantage6/server/resource/task.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "729:             run.delete()",
          "731:         # delete child tasks",
          "736:         # permissions ok, delete...",
          "737:         task.delete()",
          "739:         return {\"msg\": f\"task id={id} and its algorithm run data have been \"",
          "740:                        \"successfully deleted\"}, HTTPStatus.OK",
          "",
          "[Removed Lines]",
          "732:         for child_task in task.children:",
          "733:             log.info(f\" Removing child task id={child_task.id}\")",
          "734:             child_task.delete()",
          "",
          "[Added Lines]",
          "732:         Task._delete_child_tasks(task)",
          "740:     @staticmethod",
          "741:     def _delete_child_tasks(task: db.Task):",
          "742:         \"\"\"",
          "743:         Delete child tasks recursively.",
          "745:         Parameters",
          "746:         ----------",
          "747:         task : db.Task",
          "748:             Task to delete.",
          "749:         \"\"\"",
          "750:         for child_task in task.children:",
          "751:             Task._delete_child_tasks(child_task)",
          "752:             log.info(f\" Removing child task id={child_task.id}\")",
          "753:             child_task.delete()",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "c2099d976552daca1a8be79c5cad1402ad6e1124",
      "candidate_info": {
        "commit_hash": "c2099d976552daca1a8be79c5cad1402ad6e1124",
        "repo": "vantage6/vantage6",
        "commit_url": "https://github.com/vantage6/vantage6/commit/c2099d976552daca1a8be79c5cad1402ad6e1124",
        "files": [
          "vantage6-server/vantage6/server/resource/collaboration.py",
          "vantage6-server/vantage6/server/resource/role.py",
          "vantage6-server/vantage6/server/resource/task.py",
          "vantage6-server/vantage6/server/resource/user.py"
        ],
        "message": "Add flag whether linked resources should be deleted in delete endpoints that affect other resources",
        "before_after_code_files": [
          "vantage6-server/vantage6/server/resource/collaboration.py||vantage6-server/vantage6/server/resource/collaboration.py",
          "vantage6-server/vantage6/server/resource/role.py||vantage6-server/vantage6/server/resource/role.py",
          "vantage6-server/vantage6/server/resource/task.py||vantage6-server/vantage6/server/resource/task.py",
          "vantage6-server/vantage6/server/resource/user.py||vantage6-server/vantage6/server/resource/user.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/vantage6/vantage6/pull/748"
        ],
        "olp_code_files": {
          "patch": [
            "vantage6-server/vantage6/server/resource/collaboration.py||vantage6-server/vantage6/server/resource/collaboration.py",
            "vantage6-server/vantage6/server/resource/role.py||vantage6-server/vantage6/server/resource/role.py",
            "vantage6-server/vantage6/server/resource/task.py||vantage6-server/vantage6/server/resource/task.py",
            "vantage6-server/vantage6/server/resource/user.py||vantage6-server/vantage6/server/resource/user.py"
          ],
          "candidate": [
            "vantage6-server/vantage6/server/resource/collaboration.py||vantage6-server/vantage6/server/resource/collaboration.py",
            "vantage6-server/vantage6/server/resource/role.py||vantage6-server/vantage6/server/resource/role.py",
            "vantage6-server/vantage6/server/resource/task.py||vantage6-server/vantage6/server/resource/task.py",
            "vantage6-server/vantage6/server/resource/user.py||vantage6-server/vantage6/server/resource/user.py"
          ]
        }
      },
      "candidate_diff": {
        "vantage6-server/vantage6/server/resource/collaboration.py||vantage6-server/vantage6/server/resource/collaboration.py": [
          "File: vantage6-server/vantage6/server/resource/collaboration.py -> vantage6-server/vantage6/server/resource/collaboration.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "502:               type: integer",
          "503:             description: Collaboration id",
          "504:             required: true",
          "506:         responses:",
          "507:           200:",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "505:           - in: query",
          "506:             name: delete_dependents",
          "507:             schema:",
          "508:               type: boolean",
          "509:             description: If set to true, the collaboratio will be deleted along",
          "510:               with all its tasks and nodes (default=False)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "527:             return {'msg': 'You lack the permission to do that!'}, \\",
          "528:                 HTTPStatus.UNAUTHORIZED",
          "530:         collaboration.delete()",
          "531:         return {\"msg\": f\"Collaboration id={id} successfully deleted\"}, \\",
          "532:             HTTPStatus.OK",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "536:         if collaboration.tasks or collaboration.nodes:",
          "537:             delete_dependents = request.args.get('delete_dependents', False)",
          "538:             if not delete_dependents:",
          "539:                 return {",
          "540:                     \"msg\": f\"Collaboration id={id} has \"",
          "541:                     f\"{len(collaboration.tasks)} tasks and \"",
          "542:                     \"{len(collaboration.nodes)} nodes. Please delete them \"",
          "543:                     \"separately or set delete_dependents=True\"",
          "544:                 }, HTTPStatus.BAD_REQUEST",
          "545:             else:",
          "546:                 log.warn(f\"Deleting collaboration id={id} along with \"",
          "547:                          f\"{len(collaboration.tasks)} tasks and \"",
          "548:                          f\"{len(collaboration.nodes)} nodes\")",
          "549:                 for task in collaboration.tasks:",
          "550:                     task.delete()",
          "551:                 for node in collaboration.nodes:",
          "552:                     node.delete()",
          "",
          "---------------"
        ],
        "vantage6-server/vantage6/server/resource/role.py||vantage6-server/vantage6/server/resource/role.py": [
          "File: vantage6-server/vantage6/server/resource/role.py -> vantage6-server/vantage6/server/resource/role.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "563:               minimum: 1",
          "564:             description: Role id",
          "565:             required: true",
          "567:         responses:",
          "568:           200:",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "566:           - in: query",
          "567:             name: delete_dependents",
          "568:             schema:",
          "569:               type: boolean",
          "570:             description: If set to true, the role is deleted even though users",
          "571:                with this role may lose permissions (default=False)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "590:                 return {'msg': 'You can\\'t delete a role from another '",
          "591:                         'organization'}, HTTPStatus.UNAUTHORIZED",
          "593:         role.delete()",
          "595:         return {\"msg\": \"Role removed from the database.\"}, HTTPStatus.OK",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "599:         # check if role is assigned to users",
          "600:         if role.users:",
          "601:             params = request.args",
          "602:             if not params.get('delete_dependents', False):",
          "603:                 return {",
          "604:                     'msg': \"Role is assigned to users. Please remove the role \"",
          "605:                     \"from the users first, or set the 'delete_dependents' \"",
          "606:                     \"parameter to delete the role anyway.\"",
          "607:                 }, HTTPStatus.BAD_REQUEST",
          "608:             else:",
          "609:                 log.warn(f\"Role {id} deleted even though it was assigned to \"",
          "610:                          \"users. This may result in missing permissions.\")",
          "611:                 # Note that the role is removed from the users automatically",
          "612:                 # due to the relationship between the role and the user.",
          "",
          "---------------"
        ],
        "vantage6-server/vantage6/server/resource/task.py||vantage6-server/vantage6/server/resource/task.py": [
          "File: vantage6-server/vantage6/server/resource/task.py -> vantage6-server/vantage6/server/resource/task.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "728:             log.info(f\" Removing run id={run.id}\")",
          "729:             run.delete()",
          "731:         # permissions ok, delete...",
          "732:         task.delete()",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "731:         # delete child tasks",
          "732:         for child_task in task.children:",
          "733:             log.info(f\" Removing child task id={child_task.id}\")",
          "734:             child_task.delete()",
          "",
          "---------------"
        ],
        "vantage6-server/vantage6/server/resource/user.py||vantage6-server/vantage6/server/resource/user.py": [
          "File: vantage6-server/vantage6/server/resource/user.py -> vantage6-server/vantage6/server/resource/user.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "722:               type: integer",
          "723:             description: User id",
          "724:             required: true",
          "726:         responses:",
          "727:           200:",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "725:          - in: query",
          "726:             name: delete_dependents",
          "727:             schema:",
          "728:               type: boolean",
          "729:             description: If set to true, the user will be deleted along with",
          "730:               all tasks they created (default=False)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "748:                     return {'msg': 'You lack the permission to do that!'}, \\",
          "749:                         HTTPStatus.UNAUTHORIZED",
          "751:         user.delete()",
          "752:         log.info(f\"user id={id} is removed from the database\")",
          "753:         return {\"msg\": f\"user id={id} is removed from the database\"}, \\",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "757:         # check if user created any tasks",
          "758:         if user.created_tasks:",
          "759:             params = request.args",
          "760:             if not params.get('delete_dependents', False):",
          "761:                 return {",
          "762:                     \"msg\": f\"User has created {len(user.created_tasks)} tasks.\"",
          "763:                     \" Please delete those first, or set the \"",
          "764:                     \"`delete_dependents` parameter to true to delete them \"",
          "765:                     \"automatically together with this user.\"",
          "766:                 }, HTTPStatus.BAD_REQUEST",
          "767:             else:",
          "768:                 log.warn(f\"Deleting {len(user.created_tasks)} tasks created by\"",
          "769:                          f\" user id={id}\")",
          "770:                 for task in user.created_tasks:",
          "771:                     task.delete()",
          "",
          "---------------"
        ]
      }
    }
  ]
}