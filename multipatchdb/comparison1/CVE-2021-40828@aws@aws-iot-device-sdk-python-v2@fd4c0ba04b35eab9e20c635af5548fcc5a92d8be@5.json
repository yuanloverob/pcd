{
  "cve_id": "CVE-2021-40828",
  "cve_desc": "Connections initialized by the AWS IoT Device SDK v2 for Java (versions prior to 1.3.3), Python (versions prior to 1.5.18), C++ (versions prior to 1.12.7) and Node.js (versions prior to 1.5.1) did not verify server certificate hostname during TLS handshake when overriding Certificate Authorities (CA) in their trust stores on Windows. This issue has been addressed in aws-c-io submodule versions 0.9.13 onward. This issue affects: Amazon Web Services AWS IoT Device SDK v2 for Java versions prior to 1.3.3 on Microsoft Windows. Amazon Web Services AWS IoT Device SDK v2 for Python versions prior to 1.5.18 on Microsoft Windows. Amazon Web Services AWS IoT Device SDK v2 for C++ versions prior to 1.12.7 on Microsoft Windows. Amazon Web Services AWS IoT Device SDK v2 for Node.js versions prior to 1.5.3 on Microsoft Windows.",
  "repo": "aws/aws-iot-device-sdk-python-v2",
  "patch_hash": "fd4c0ba04b35eab9e20c635af5548fcc5a92d8be",
  "patch_info": {
    "commit_hash": "fd4c0ba04b35eab9e20c635af5548fcc5a92d8be",
    "repo": "aws/aws-iot-device-sdk-python-v2",
    "commit_url": "https://github.com/aws/aws-iot-device-sdk-python-v2/commit/fd4c0ba04b35eab9e20c635af5548fcc5a92d8be",
    "files": [
      "setup.py"
    ],
    "message": "Update to latest CRT (#208)\n\n* On Windows, always perform an SNI check even with an overridden root CA\n* On Windows, properly honor the verify_peer = false option\n* Fix instability with raspberry PI and input stream seeking by doing a better job of modeling file seek offset type and size.",
    "before_after_code_files": [
      "setup.py||setup.py"
    ]
  },
  "patch_diff": {
    "setup.py||setup.py": [
      "File: setup.py -> setup.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "40:         \"Operating System :: OS Independent\",",
      "41:     ],",
      "42:     install_requires=[",
      "44:     ],",
      "45:     python_requires='>=3.6',",
      "46: )",
      "",
      "[Removed Lines]",
      "43:         'awscrt==0.11.20',",
      "",
      "[Added Lines]",
      "43:         'awscrt==0.11.22',",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "8b16659bda760a8589c654b342df7cdf5618d6d1",
      "candidate_info": {
        "commit_hash": "8b16659bda760a8589c654b342df7cdf5618d6d1",
        "repo": "aws/aws-iot-device-sdk-python-v2",
        "commit_url": "https://github.com/aws/aws-iot-device-sdk-python-v2/commit/8b16659bda760a8589c654b342df7cdf5618d6d1",
        "files": [
          "setup.py"
        ],
        "message": "update awscrt for raspberry pi fix (#192)\n\nIssue: wheels were unavailable for the previous awscrt on piwheels.org",
        "before_after_code_files": [
          "setup.py||setup.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "setup.py||setup.py"
          ],
          "candidate": [
            "setup.py||setup.py"
          ]
        }
      },
      "candidate_diff": {
        "setup.py||setup.py": [
          "File: setup.py -> setup.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "19:         \"Operating System :: OS Independent\",",
          "20:     ],",
          "21:     install_requires=[",
          "23:     ],",
          "24:     python_requires='>=3.5',",
          "25: )",
          "",
          "[Removed Lines]",
          "22:         'awscrt==0.11.14',",
          "",
          "[Added Lines]",
          "22:         'awscrt==0.11.17',",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "26563a4e8f63586bad30d44d55c0fa73705b5672",
      "candidate_info": {
        "commit_hash": "26563a4e8f63586bad30d44d55c0fa73705b5672",
        "repo": "aws/aws-iot-device-sdk-python-v2",
        "commit_url": "https://github.com/aws/aws-iot-device-sdk-python-v2/commit/26563a4e8f63586bad30d44d55c0fa73705b5672",
        "files": [
          "setup.py"
        ],
        "message": "Ecs fix (#274)\n\n* Update CRT to pull in ECS credentials provider fix",
        "before_after_code_files": [
          "setup.py||setup.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "setup.py||setup.py"
          ],
          "candidate": [
            "setup.py||setup.py"
          ]
        }
      },
      "candidate_diff": {
        "setup.py||setup.py": [
          "File: setup.py -> setup.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "40:         \"Operating System :: OS Independent\",",
          "41:     ],",
          "42:     install_requires=[",
          "44:     ],",
          "45:     python_requires='>=3.6',",
          "46: )",
          "",
          "[Removed Lines]",
          "43:         'awscrt==0.13.2',",
          "",
          "[Added Lines]",
          "43:         'awscrt==0.13.3',",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "7bd47b56226352ce815d82c8f8f0fd3ab8006fae",
      "candidate_info": {
        "commit_hash": "7bd47b56226352ce815d82c8f8f0fd3ab8006fae",
        "repo": "aws/aws-iot-device-sdk-python-v2",
        "commit_url": "https://github.com/aws/aws-iot-device-sdk-python-v2/commit/7bd47b56226352ce815d82c8f8f0fd3ab8006fae",
        "files": [
          "setup.py"
        ],
        "message": "Updating aws-crt-python submodule for bug fixes. (#190)",
        "before_after_code_files": [
          "setup.py||setup.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "setup.py||setup.py"
          ],
          "candidate": [
            "setup.py||setup.py"
          ]
        }
      },
      "candidate_diff": {
        "setup.py||setup.py": [
          "File: setup.py -> setup.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "19:         \"Operating System :: OS Independent\",",
          "20:     ],",
          "21:     install_requires=[",
          "23:     ],",
          "24:     python_requires='>=3.5',",
          "25: )",
          "",
          "[Removed Lines]",
          "22:         'awscrt==0.11.12',",
          "",
          "[Added Lines]",
          "22:         'awscrt==0.11.14',",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "fb4eac9d248fa330a294ee314aef6fda59e4904b",
      "candidate_info": {
        "commit_hash": "fb4eac9d248fa330a294ee314aef6fda59e4904b",
        "repo": "aws/aws-iot-device-sdk-python-v2",
        "commit_url": "https://github.com/aws/aws-iot-device-sdk-python-v2/commit/fb4eac9d248fa330a294ee314aef6fda59e4904b",
        "files": [
          "awsiot/__init__.py",
          "samples/basic_discovery.py",
          "samples/pubsub.py",
          "setup.py"
        ],
        "message": "adapt to awscrt.mqtt on-message callbacks taking additional args (#156)\n\nAlso update awscrt version",
        "before_after_code_files": [
          "awsiot/__init__.py||awsiot/__init__.py",
          "samples/basic_discovery.py||samples/basic_discovery.py",
          "samples/pubsub.py||samples/pubsub.py",
          "setup.py||setup.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "setup.py||setup.py"
          ],
          "candidate": [
            "setup.py||setup.py"
          ]
        }
      },
      "candidate_diff": {
        "awsiot/__init__.py||awsiot/__init__.py": [
          "File: awsiot/__init__.py -> awsiot/__init__.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "132:                 except Exception as e:",
          "133:                     future.set_exception(e)",
          "136:                 try:",
          "137:                     payload_obj = json.loads(payload.decode())",
          "138:                     event = payload_to_class_fn(payload_obj)",
          "",
          "[Removed Lines]",
          "135:             def callback_wrapper(topic, payload, **kwargs):",
          "",
          "[Added Lines]",
          "135:             def callback_wrapper(topic, payload, dup, qos, retain, **kwargs):",
          "",
          "---------------"
        ],
        "samples/basic_discovery.py||samples/basic_discovery.py": [
          "File: samples/basic_discovery.py -> samples/basic_discovery.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "99: if args.mode == 'both' or args.mode == 'subscribe':",
          "102:         print('Publish received on topic {}'.format(topic))",
          "103:         print(payload)",
          "",
          "[Removed Lines]",
          "101:     def on_publish(topic, payload, **kwargs):",
          "",
          "[Added Lines]",
          "101:     def on_publish(topic, payload, dup, qos, retain, **kwargs):",
          "",
          "---------------"
        ],
        "samples/pubsub.py||samples/pubsub.py": [
          "File: samples/pubsub.py -> samples/pubsub.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "78: # Callback when the subscribed topic receives a message",
          "80:     print(\"Received message from topic '{}': {}\".format(topic, payload))",
          "81:     global received_count",
          "82:     received_count += 1",
          "",
          "[Removed Lines]",
          "79: def on_message_received(topic, payload, **kwargs):",
          "",
          "[Added Lines]",
          "79: def on_message_received(topic, payload, dup, qos, retain, **kwargs):",
          "",
          "---------------"
        ],
        "setup.py||setup.py": [
          "File: setup.py -> setup.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "19:         \"Operating System :: OS Independent\",",
          "20:     ],",
          "21:     install_requires=[",
          "23:     ],",
          "24:     python_requires='>=3.5',",
          "25: )",
          "",
          "[Removed Lines]",
          "22:         'awscrt==0.9.15',",
          "",
          "[Added Lines]",
          "22:         'awscrt==0.10.6',",
          "",
          "---------------"
        ]
      }
    }
  ]
}