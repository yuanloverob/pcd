{
  "cve_id": "CVE-2024-3408",
  "cve_desc": "man-group/dtale version 3.10.0 is vulnerable to an authentication bypass and remote code execution (RCE) due to improper input validation. The vulnerability arises from a hardcoded `SECRET_KEY` in the flask configuration, allowing attackers to forge a session cookie if authentication is enabled. Additionally, the application fails to properly restrict custom filter queries, enabling attackers to execute arbitrary code on the server by bypassing the restriction on the `/update-settings` endpoint, even when `enable_custom_filters` is not enabled. This vulnerability allows attackers to bypass authentication mechanisms and execute remote code on the server.",
  "repo": "man-group/dtale",
  "patch_hash": "32bd6fb4a63de779ff1e51823a456865ea3cbd13",
  "patch_info": {
    "commit_hash": "32bd6fb4a63de779ff1e51823a456865ea3cbd13",
    "repo": "man-group/dtale",
    "commit_url": "https://github.com/man-group/dtale/commit/32bd6fb4a63de779ff1e51823a456865ea3cbd13",
    "files": [
      "dtale/app.py"
    ],
    "message": "https://github.com/man-group/dtale/issues/870: update Flask's SECRET_KEY to be a random string",
    "before_after_code_files": [
      "dtale/app.py||dtale/app.py"
    ]
  },
  "patch_diff": {
    "dtale/app.py||dtale/app.py": [
      "File: dtale/app.py -> dtale/app.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "4: import jinja2",
      "5: import logging",
      "6: import os",
      "7: import pandas as pd",
      "8: import random",
      "9: import socket",
      "10: import sys",
      "11: import time",
      "12: import traceback",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "7: import numpy as np",
      "11: import string",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "292:         return super(DtaleFlask, self).get_send_file_max_age(name)",
      "295: def build_app(",
      "296:     url=None, reaper_on=True, app_root=None, additional_templates=None, **kwargs",
      "297: ):",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "297: def build_secret_key():",
      "298:     \"\"\"",
      "299:     Builds a string of 10 randomly chosen characters to be used as the Flask app's SECRET_KEY",
      "300:     \"\"\"",
      "302:     return \"\".join(np.random.choice(list(string.ascii_uppercase + string.digits), 10))",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "320:         instance_relative_config=False,",
      "321:         app_root=app_root,",
      "322:     )",
      "325:     app.jinja_env.trim_blocks = True",
      "326:     app.jinja_env.lstrip_blocks = True",
      "",
      "[Removed Lines]",
      "323:     app.config[\"SECRET_KEY\"] = \"Dtale\"",
      "",
      "[Added Lines]",
      "333:     app.config[\"SECRET_KEY\"] = build_secret_key()",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "4f4a9ee97dc80af8e242dcecef54b41c04fd92ed",
      "candidate_info": {
        "commit_hash": "4f4a9ee97dc80af8e242dcecef54b41c04fd92ed",
        "repo": "man-group/dtale",
        "commit_url": "https://github.com/man-group/dtale/commit/4f4a9ee97dc80af8e242dcecef54b41c04fd92ed",
        "files": [
          ".circleci/config.yml",
          "CHANGES.md",
          "docker/dtale.env",
          "docs/source/conf.py",
          "frontend/package.json",
          "setup.py"
        ],
        "message": "Bumped version numbers to 3.13.1",
        "before_after_code_files": [
          "docker/dtale.env||docker/dtale.env",
          "setup.py||setup.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/man-group/dtale/pull/871"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "docker/dtale.env||docker/dtale.env": [
          "File: docker/dtale.env -> docker/dtale.env",
          "--- Hunk 1 ---",
          "[Context before]",
          "2: TZ=America/New_York",
          "",
          "[Removed Lines]",
          "1: VERSION=3.13.0",
          "",
          "[Added Lines]",
          "1: VERSION=3.13.1",
          "",
          "---------------"
        ],
        "setup.py||setup.py": [
          "File: setup.py -> setup.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "73: setup(",
          "74:     name=\"dtale\",",
          "76:     author=\"MAN Alpha Technology\",",
          "77:     author_email=\"ManAlphaTech@man.com\",",
          "78:     description=\"Web Client for Visualizing Pandas Objects\",",
          "",
          "[Removed Lines]",
          "75:     version=\"3.13.0\",",
          "",
          "[Added Lines]",
          "75:     version=\"3.13.1\",",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "8b37b46beed6aa20512028006747e3e08753a275",
      "candidate_info": {
        "commit_hash": "8b37b46beed6aa20512028006747e3e08753a275",
        "repo": "man-group/dtale",
        "commit_url": "https://github.com/man-group/dtale/commit/8b37b46beed6aa20512028006747e3e08753a275",
        "files": [
          ".circleci/config.yml",
          "CHANGES.md",
          "docker/dtale.env",
          "docs/source/conf.py",
          "frontend/package.json",
          "setup.py"
        ],
        "message": "Bumped version numbers to 3.13.1",
        "before_after_code_files": [
          "docker/dtale.env||docker/dtale.env",
          "setup.py||setup.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/man-group/dtale/pull/871"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "docker/dtale.env||docker/dtale.env": [
          "File: docker/dtale.env -> docker/dtale.env",
          "--- Hunk 1 ---",
          "[Context before]",
          "2: TZ=America/New_York",
          "",
          "[Removed Lines]",
          "1: VERSION=3.13.0",
          "",
          "[Added Lines]",
          "1: VERSION=3.13.1",
          "",
          "---------------"
        ],
        "setup.py||setup.py": [
          "File: setup.py -> setup.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "73: setup(",
          "74:     name=\"dtale\",",
          "76:     author=\"MAN Alpha Technology\",",
          "77:     author_email=\"ManAlphaTech@man.com\",",
          "78:     description=\"Web Client for Visualizing Pandas Objects\",",
          "",
          "[Removed Lines]",
          "75:     version=\"3.13.0\",",
          "",
          "[Added Lines]",
          "75:     version=\"3.13.1\",",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "cccf5cb5388a389558c8fb46eed43d16552873fc",
      "candidate_info": {
        "commit_hash": "cccf5cb5388a389558c8fb46eed43d16552873fc",
        "repo": "man-group/dtale",
        "commit_url": "https://github.com/man-group/dtale/commit/cccf5cb5388a389558c8fb46eed43d16552873fc",
        "files": [
          "dtale/app.py"
        ],
        "message": "https://github.com/man-group/dtale/issues/870: update Flask's SECRET_KEY to be a random string",
        "before_after_code_files": [
          "dtale/app.py||dtale/app.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "dtale/app.py||dtale/app.py"
          ],
          "candidate": [
            "dtale/app.py||dtale/app.py"
          ]
        }
      },
      "candidate_diff": {
        "dtale/app.py||dtale/app.py": [
          "File: dtale/app.py -> dtale/app.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "4: import jinja2",
          "5: import logging",
          "6: import os",
          "7: import pandas as pd",
          "8: import random",
          "9: import socket",
          "10: import sys",
          "11: import time",
          "12: import traceback",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "7: import numpy as np",
          "11: import string",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "292:         return super(DtaleFlask, self).get_send_file_max_age(name)",
          "295: def build_app(",
          "296:     url=None, reaper_on=True, app_root=None, additional_templates=None, **kwargs",
          "297: ):",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "297: def build_secret_key():",
          "298:     \"\"\"",
          "299:     Builds a string of 10 randomly chosen characters to be used as the Flask app's SECRET_KEY",
          "300:     \"\"\"",
          "302:     return \"\".join(np.random.choice(list(string.ascii_uppercase + string.digits), 10))",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "320:         instance_relative_config=False,",
          "321:         app_root=app_root,",
          "322:     )",
          "325:     app.jinja_env.trim_blocks = True",
          "326:     app.jinja_env.lstrip_blocks = True",
          "",
          "[Removed Lines]",
          "323:     app.config[\"SECRET_KEY\"] = \"Dtale\"",
          "",
          "[Added Lines]",
          "333:     app.config[\"SECRET_KEY\"] = build_secret_key()",
          "",
          "---------------"
        ]
      }
    }
  ]
}