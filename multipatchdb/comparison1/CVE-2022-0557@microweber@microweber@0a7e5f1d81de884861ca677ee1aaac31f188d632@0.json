{
  "cve_id": "CVE-2022-0557",
  "cve_desc": "OS Command Injection in Packagist microweber/microweber prior to 1.2.11.",
  "repo": "microweber/microweber",
  "patch_hash": "0a7e5f1d81de884861ca677ee1aaac31f188d632",
  "patch_info": {
    "commit_hash": "0a7e5f1d81de884861ca677ee1aaac31f188d632",
    "repo": "microweber/microweber",
    "commit_url": "https://github.com/microweber/microweber/commit/0a7e5f1d81de884861ca677ee1aaac31f188d632",
    "files": [
      "src/MicroweberPackages/App/functions/plupload.php"
    ],
    "message": "Update plupload.php",
    "before_after_code_files": [
      "src/MicroweberPackages/App/functions/plupload.php||src/MicroweberPackages/App/functions/plupload.php"
    ]
  },
  "patch_diff": {
    "src/MicroweberPackages/App/functions/plupload.php||src/MicroweberPackages/App/functions/plupload.php": [
      "File: src/MicroweberPackages/App/functions/plupload.php -> src/MicroweberPackages/App/functions/plupload.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "149:                             $is_ext = strtolower($is_ext);",
      "151:                             switch ($is_ext) {",
      "153:                                 case 'php12':",
      "154:                                 case 'php11':",
      "155:                                 case 'php10':",
      "156:                                 case 'php9':",
      "157:                                 case 'php8':",
      "158:                                 case 'php7':",
      "160:                                 case 'php5':",
      "161:                                 case 'php4':",
      "162:                                 case 'php3':",
      "",
      "[Removed Lines]",
      "152:                                 case 'php':",
      "159:                                 case 'php6':",
      "",
      "[Added Lines]",
      "152:                                 case 'php':",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "bfb86241bbb8cffe8291822091c6411498ac2a3e",
      "candidate_info": {
        "commit_hash": "bfb86241bbb8cffe8291822091c6411498ac2a3e",
        "repo": "microweber/microweber",
        "commit_url": "https://github.com/microweber/microweber/commit/bfb86241bbb8cffe8291822091c6411498ac2a3e",
        "files": [
          "src/MicroweberPackages/App/functions/plupload.php",
          "src/MicroweberPackages/Media/helpers/media.php"
        ],
        "message": "remove exif data when upload picture",
        "before_after_code_files": [
          "src/MicroweberPackages/App/functions/plupload.php||src/MicroweberPackages/App/functions/plupload.php",
          "src/MicroweberPackages/Medihelpers/media.php||src/MicroweberPackages/Media/helpers/media.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/MicroweberPackages/App/functions/plupload.php||src/MicroweberPackages/App/functions/plupload.php"
          ],
          "candidate": [
            "src/MicroweberPackages/App/functions/plupload.php||src/MicroweberPackages/App/functions/plupload.php"
          ]
        }
      },
      "candidate_diff": {
        "src/MicroweberPackages/App/functions/plupload.php||src/MicroweberPackages/App/functions/plupload.php": [
          "File: src/MicroweberPackages/App/functions/plupload.php -> src/MicroweberPackages/App/functions/plupload.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "149:                             $is_ext = strtolower($is_ext);",
          "151:                             switch ($is_ext) {",
          "153:                                 case 'php12':",
          "154:                                 case 'php11':",
          "155:                                 case 'php10':",
          "",
          "[Removed Lines]",
          "152:                                 case 'php':",
          "",
          "[Added Lines]",
          "152:                                 case 'php':",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "519:             $valid = false;",
          "520:             if ($ext === 'jpg' || $ext === 'jpeg' || $ext === 'jpe') {",
          "522:                     $valid = true;",
          "523:                 }",
          "524:             } else if ($ext === 'png') {",
          "526:                     $valid = true;",
          "527:                 }",
          "528:             } else if ($ext === 'gif') {",
          "530:                     $valid = true;",
          "531:                 }",
          "534:                 if (is_file($filePath)) {",
          "535:                     $sanitizer = new \\enshrined\\svgSanitize\\Sanitizer();",
          "",
          "[Removed Lines]",
          "521:                 if (@imagecreatefromjpeg($filePath)) {",
          "525:                 if (@imagecreatefrompng($filePath)) {",
          "529:                 if (@imagecreatefromgif($filePath)) {",
          "532:             }else if ($ext === 'svg') {",
          "",
          "[Added Lines]",
          "523:                 $imgCreatedFromJpeg = @imagecreatefromjpeg($filePath);",
          "524:                 if ($imgCreatedFromJpeg) {",
          "525:                     imagejpeg($imgCreatedFromJpeg, $filePath,100);",
          "530:                 $imgCreatedFromPng = @imagecreatefrompng($filePath);",
          "531:                 if ($imgCreatedFromPng) {",
          "532:                     imagepng($imgCreatedFromPng, $filePath,100);",
          "538:                 $imgCreatedFromGif = @imagecreatefromgif($filePath);",
          "539:                 if ($imgCreatedFromGif) {",
          "540:                     imagegif($imgCreatedFromGif, $filePath,100);",
          "544:             } else if ($ext === 'svg') {",
          "",
          "---------------"
        ],
        "src/MicroweberPackages/Medihelpers/media.php||src/MicroweberPackages/Media/helpers/media.php": [
          "File: src/MicroweberPackages/Medihelpers/media.php -> src/MicroweberPackages/Media/helpers/media.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "141: function remove_exif_data($old, $new)",
          "142: {",
          "144:     $f1 = fopen($old, 'rb');",
          "146:     $f2 = fopen($new, 'wb');",
          "149:     while (($s = fread($f1, 2))) {",
          "150:         $word = unpack('ni', $s)['i'];",
          "151:         if ($word == 0xFFE1) {",
          "153:             $s = fread($f1, 2);",
          "154:             $len = unpack('ni', $s)['i'];",
          "156:             fread($f1, $len - 2);",
          "157:             break;",
          "158:         } else {",
          "159:             fwrite($f2, $s, 2);",
          "160:         }",
          "161:     }",
          "164:     while (($s = fread($f1, 4096))) {",
          "165:         fwrite($f2, $s, strlen($s));",
          "166:     }",
          "168:     fclose($f1);",
          "169:     fclose($f2);",
          "170: }",
          "",
          "---------------"
        ]
      }
    }
  ]
}