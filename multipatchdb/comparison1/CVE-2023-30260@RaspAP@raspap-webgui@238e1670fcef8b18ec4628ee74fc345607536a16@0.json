{
  "cve_id": "CVE-2023-30260",
  "cve_desc": "Command injection vulnerability in RaspAP raspap-webgui 2.8.8 and earlier allows remote attackers to run arbitrary commands via crafted POST request to hostapd settings form.",
  "repo": "RaspAP/raspap-webgui",
  "patch_hash": "238e1670fcef8b18ec4628ee74fc345607536a16",
  "patch_info": {
    "commit_hash": "238e1670fcef8b18ec4628ee74fc345607536a16",
    "repo": "RaspAP/raspap-webgui",
    "commit_url": "https://github.com/RaspAP/raspap-webgui/commit/238e1670fcef8b18ec4628ee74fc345607536a16",
    "files": [
      "includes/hostapd.php"
    ],
    "message": "Merge pull request #1322 from RaspAP/maint/security\n\nSanitize hostapd input",
    "before_after_code_files": [
      "includes/hostapd.php||includes/hostapd.php"
    ]
  },
  "patch_diff": {
    "includes/hostapd.php||includes/hostapd.php": [
      "File: includes/hostapd.php -> includes/hostapd.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "99:     }",
      "101:     if (isset($_POST['txpower']) && ($_POST['txpower'] != 'auto')) {",
      "104:         $status->addMessage('Setting transmit power to '.$_POST['txpower'].' dBm.', 'success');",
      "105:         $txpower = $_POST['txpower'];",
      "106:     } elseif ($_POST['txpower'] == 'auto') {",
      "108:         $status->addMessage('Setting transmit power to '.$_POST['txpower'].'.', 'success');",
      "109:         $txpower = $_POST['txpower'];",
      "110:     }",
      "",
      "[Removed Lines]",
      "102:         $sdBm = $_POST['txpower'] * 100;",
      "103:         exec('sudo /sbin/iw dev '.$_POST['interface'].' set txpower fixed '.$sdBm, $return);",
      "107:         exec('sudo /sbin/iw dev '.$_POST['interface'].' set txpower auto', $return);",
      "",
      "[Added Lines]",
      "102:         $txpower = intval($_POST['txpower']);",
      "103:         $sdBm = $txpower * 100;",
      "104:         exec('sudo /sbin/iw dev '.escapeshellarg($_POST['interface']).' set txpower fixed '.$sdBm, $return);",
      "108:         exec('sudo /sbin/iw dev '.escapeshellarg($_POST['interface']).' set txpower auto', $return);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "7760a1d7cb391a2e0cef2b5c861b75ba818f4634",
      "candidate_info": {
        "commit_hash": "7760a1d7cb391a2e0cef2b5c861b75ba818f4634",
        "repo": "RaspAP/raspap-webgui",
        "commit_url": "https://github.com/RaspAP/raspap-webgui/commit/7760a1d7cb391a2e0cef2b5c861b75ba818f4634",
        "files": [
          "includes/hostapd.php"
        ],
        "message": "Update sanitize var method",
        "before_after_code_files": [
          "includes/hostapd.php||includes/hostapd.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/RaspAP/raspap-webgui/pull/1322"
        ],
        "olp_code_files": {
          "patch": [
            "includes/hostapd.php||includes/hostapd.php"
          ],
          "candidate": [
            "includes/hostapd.php||includes/hostapd.php"
          ]
        }
      },
      "candidate_diff": {
        "includes/hostapd.php||includes/hostapd.php": [
          "File: includes/hostapd.php -> includes/hostapd.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "98:         $arrConfig['country_code'] = $country_code[0];",
          "99:     }",
          "110:     }",
          "112:     $countries_5Ghz_max48ch = RASPI_5GHZ_ISO_ALPHA2;",
          "",
          "[Removed Lines]",
          "101:     $txpower = escapeshellarg($_POST['txpower']);",
          "102:     $interface = escapeshellarg($_POST['interface']);",
          "103:     if ($txpower) && ($txpower != 'auto')) {",
          "104:        $sdBm = $txpower * 100;",
          "105:         exec('sudo /sbin/iw dev '.$interface.' set txpower fixed '.$sdBm, $return);",
          "106:         $status->addMessage('Setting transmit power to '.$txpower.' dBm.', 'success');",
          "107:     } elseif ($txpower == 'auto') {",
          "108:         exec('sudo /sbin/iw dev '.$interface.' set txpower auto', $return);",
          "109:         $status->addMessage('Setting transmit power to '.$txpower.'.', 'success');",
          "",
          "[Added Lines]",
          "101:     if (isset($_POST['txpower']) && ($_POST['txpower'] != 'auto')) {",
          "102:         $txpower = intval($_POST['txpower']);",
          "103:         $sdBm = $txpower * 100;",
          "104:         exec('sudo /sbin/iw dev '.escapeshellarg($_POST['interface']).' set txpower fixed '.$sdBm, $return);",
          "105:         $status->addMessage('Setting transmit power to '.$_POST['txpower'].' dBm.', 'success');",
          "106:         $txpower = $_POST['txpower'];",
          "107:     } elseif ($_POST['txpower'] == 'auto') {",
          "108:         exec('sudo /sbin/iw dev '.escapeshellarg($_POST['interface']).' set txpower auto', $return);",
          "109:         $status->addMessage('Setting transmit power to '.$_POST['txpower'].'.', 'success');",
          "110:         $txpower = $_POST['txpower'];",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "1e52ff598b023679119d50a3003ccdebd36fb5f4",
      "candidate_info": {
        "commit_hash": "1e52ff598b023679119d50a3003ccdebd36fb5f4",
        "repo": "RaspAP/raspap-webgui",
        "commit_url": "https://github.com/RaspAP/raspap-webgui/commit/1e52ff598b023679119d50a3003ccdebd36fb5f4",
        "files": [
          "includes/hostapd.php"
        ],
        "message": "Sanitize input with escapeshellarg()",
        "before_after_code_files": [
          "includes/hostapd.php||includes/hostapd.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/RaspAP/raspap-webgui/pull/1322"
        ],
        "olp_code_files": {
          "patch": [
            "includes/hostapd.php||includes/hostapd.php"
          ],
          "candidate": [
            "includes/hostapd.php||includes/hostapd.php"
          ]
        }
      },
      "candidate_diff": {
        "includes/hostapd.php||includes/hostapd.php": [
          "File: includes/hostapd.php -> includes/hostapd.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "98:         $arrConfig['country_code'] = $country_code[0];",
          "99:     }",
          "110:     }",
          "112:     $countries_5Ghz_max48ch = RASPI_5GHZ_ISO_ALPHA2;",
          "",
          "[Removed Lines]",
          "101:     if (isset($_POST['txpower']) && ($_POST['txpower'] != 'auto')) {",
          "102:         $sdBm = $_POST['txpower'] * 100;",
          "103:         exec('sudo /sbin/iw dev '.$_POST['interface'].' set txpower fixed '.$sdBm, $return);",
          "104:         $status->addMessage('Setting transmit power to '.$_POST['txpower'].' dBm.', 'success');",
          "105:         $txpower = $_POST['txpower'];",
          "106:     } elseif ($_POST['txpower'] == 'auto') {",
          "107:         exec('sudo /sbin/iw dev '.$_POST['interface'].' set txpower auto', $return);",
          "108:         $status->addMessage('Setting transmit power to '.$_POST['txpower'].'.', 'success');",
          "109:         $txpower = $_POST['txpower'];",
          "",
          "[Added Lines]",
          "101:     $txpower = escapeshellarg($_POST['txpower']);",
          "102:     $interface = escapeshellarg($_POST['interface']);",
          "103:     if ($txpower) && ($txpower != 'auto')) {",
          "104:        $sdBm = $txpower * 100;",
          "105:         exec('sudo /sbin/iw dev '.$interface.' set txpower fixed '.$sdBm, $return);",
          "106:         $status->addMessage('Setting transmit power to '.$txpower.' dBm.', 'success');",
          "107:     } elseif ($txpower == 'auto') {",
          "108:         exec('sudo /sbin/iw dev '.$interface.' set txpower auto', $return);",
          "109:         $status->addMessage('Setting transmit power to '.$txpower.'.', 'success');",
          "",
          "---------------"
        ]
      }
    }
  ]
}