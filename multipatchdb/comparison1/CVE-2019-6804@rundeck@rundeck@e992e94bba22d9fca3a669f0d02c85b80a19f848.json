{
  "cve_id": "CVE-2019-6804",
  "cve_desc": "An XSS issue was discovered on the Job Edit page in Rundeck Community Edition before 3.0.13, related to assets/javascripts/workflowStepEditorKO.js and views/execution/_wfitemEdit.gsp.",
  "repo": "rundeck/rundeck",
  "patch_hash": "e992e94bba22d9fca3a669f0d02c85b80a19f848",
  "patch_info": {
    "commit_hash": "e992e94bba22d9fca3a669f0d02c85b80a19f848",
    "repo": "rundeck/rundeck",
    "commit_url": "https://github.com/rundeck/rundeck/commit/e992e94bba22d9fca3a669f0d02c85b80a19f848",
    "files": [
      "rundeckapp/grails-app/assets/javascripts/workflowStepEditorKO.js",
      "rundeckapp/grails-app/views/execution/_wfitemEdit.gsp",
      "packaging/common/etc/rundeck/profile",
      "rundeckapp/grails-app/controllers/rundeck/controllers/ScheduledExecutionController.groovy",
      "rundeckapp/grails-app/controllers/rundeck/controllers/WorkflowController.groovy",
      "rundeckapp/grails-app/controllers/rundeck/interceptors/ControllerBaseInterceptor.groovy",
      "rundeckapp/grails-app/domain/rundeck/Notification.groovy",
      "rundeckapp/grails-app/domain/rundeck/ScheduledExecution.groovy",
      "rundeckapp/grails-app/i18n/messages.properties",
      "rundeckapp/grails-app/i18n/messages_es_419.properties",
      "rundeckapp/grails-app/i18n/messages_fr_FR.properties",
      "rundeckapp/grails-app/i18n/messages_ja.properties",
      "rundeckapp/grails-app/i18n/messages_zh_cn.properties",
      "rundeckapp/grails-app/init/rundeckapp/cli/CommandLineSetup.groovy",
      "rundeckapp/grails-app/init/rundeckapp/init/RundeckInitializer.groovy",
      "rundeckapp/grails-app/services/rundeck/services/NotificationService.groovy",
      "rundeckapp/grails-app/services/rundeck/services/ScheduledExecutionService.groovy",
      "rundeckapp/grails-app/views/execution/_wfitemEdit.gsp",
      "rundeckapp/grails-app/views/execution/mailNotification/status.gsp",
      "rundeckapp/grails-app/views/scheduledExecution/_editNotificationsForm.gsp",
      "rundeckapp/grails-app/views/scheduledExecution/_editNotificationsTriggerForm.gsp",
      "rundeckapp/src/test/groovy/JobsXMLCodecTests.groovy",
      "rundeckapp/src/test/groovy/ScheduledExecutionServiceTests.groovy",
      "rundeckapp/src/test/groovy/rundeck/controllers/WorkflowControllerSpec.groovy",
      "rundeckapp/src/test/groovy/rundeck/services/ScheduledExecutionServiceSpec.groovy",
      "rundeckapp/src/test/groovy/rundeckapp/init/RundeckInitializerTest.groovy",
      "rundeckapp/src/test/resources/template-partial-test/rundeck-config.properties._1.template",
      "rundeckapp/src/test/resources/template-partial-test/rundeck-config.properties._2.template",
      "rundeckapp/src/test/resources/template-partial-test/rundeck-config.properties.template"
    ],
    "message": "Merge pull request #4407 from rundeck/issue/4406-stored-xss\n\nFix #4406: stored xss vulnerability",
    "before_after_code_files": [
      "rundeckapp/grails-app/assets/javascripts/workflowStepEditorKO.js||rundeckapp/grails-app/assets/javascripts/workflowStepEditorKO.js",
      "rundeckapp/grails-app/views/execution/_wfitemEdit.gsp||rundeckapp/grails-app/views/execution/_wfitemEdit.gsp"
    ]
  },
  "patch_diff": {
    "rundeckapp/grails-app/assets/javascripts/workflowStepEditorKO.js||rundeckapp/grails-app/assets/javascripts/workflowStepEditorKO.js": [
      "File: rundeckapp/grails-app/assets/javascripts/workflowStepEditorKO.js -> rundeckapp/grails-app/assets/javascripts/workflowStepEditorKO.js",
      "--- Hunk 1 ---",
      "[Context before]",
      "388:     self.argStringAsQuotedWithScriptfile = ko.computed(function () {",
      "389:         var isq = self.argsQuoted() ? '\"' : '';",
      "390:         return isq",
      "392:             + self.args()",
      "393:             + isq;",
      "394:     });",
      "",
      "[Removed Lines]",
      "391:             + '<em>' + self.scriptfileText() +'</em> '",
      "",
      "[Added Lines]",
      "391:             + self.scriptfileText() + ' '",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "410:     self.invocationPreviewHtml = ko.computed(function () {",
      "411:         var text = '';",
      "412:         if (self.invocationString() && self.invocationString().indexOf('${scriptfile}') >= 0) {",
      "414:         } else if (self.invocationString()) {",
      "415:             text += self.invocationString() + ' ' + self.argStringAsQuotedWithScriptfile();",
      "416:         } else {",
      "",
      "[Removed Lines]",
      "413:             text += self.invocationString().split('\\$\\{scriptfile\\}').join('<em>' + self.scriptfileText() +'</em>') + ' ' + self.argStringAsQuoted();",
      "",
      "[Added Lines]",
      "413:             text += self.invocationString().split('\\$\\{scriptfile\\}').join(  self.scriptfileText() ) + ' ' + self.argStringAsQuoted();",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "527:         },",
      "528:         ignore: ['editor']",
      "529:     }, this);",
      "",
      "[Removed Lines]",
      "530: }",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ],
    "rundeckapp/grails-app/views/execution/_wfitemEdit.gsp||rundeckapp/grails-app/views/execution/_wfitemEdit.gsp": [
      "File: rundeckapp/grails-app/views/execution/_wfitemEdit.gsp -> rundeckapp/grails-app/views/execution/_wfitemEdit.gsp",
      "--- Hunk 1 ---",
      "[Context before]",
      "564:                             <div class=\"col-sm-2 control-label\"><g:message code=\"Workflow.step.script.execution.preview.label\" /></div>",
      "566:                             <div id='interpreterArgsQuotedHelp${rkey}_preview' class=\"col-sm-10 form-control-static\">",
      "568:                             </div>",
      "570:                             <g:embedJSON id=\"scriptStepData_${rkey}\" data=\"${[invocationString: item?.scriptInterpreter?:'',fileExtension: item?.fileExtension?:'',args: item?.argString?:'',argsQuoted: item?.interpreterArgsQuoted?true:false]}\"/>",
      "",
      "[Removed Lines]",
      "567:                                 <code>$ <span data-bind=\"html: invocationPreviewHtml\"></span></code>",
      "",
      "[Added Lines]",
      "567:                                 <code>$ <span data-bind=\"text: invocationPreviewHtml\"></span></code>",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "f62e44de286f29d6845c2d0927ffb31d676a5c8f",
      "candidate_info": {
        "commit_hash": "f62e44de286f29d6845c2d0927ffb31d676a5c8f",
        "repo": "rundeck/rundeck",
        "commit_url": "https://github.com/rundeck/rundeck/commit/f62e44de286f29d6845c2d0927ffb31d676a5c8f",
        "files": [
          "rundeckapp/grails-app/assets/javascripts/workflowStepEditorKO.js",
          "rundeckapp/grails-app/views/execution/_wfitemEdit.gsp"
        ],
        "message": "Fix #4406: stored xss vulnerability",
        "before_after_code_files": [
          "rundeckapp/grails-app/assets/javascripts/workflowStepEditorKO.js||rundeckapp/grails-app/assets/javascripts/workflowStepEditorKO.js",
          "rundeckapp/grails-app/views/execution/_wfitemEdit.gsp||rundeckapp/grails-app/views/execution/_wfitemEdit.gsp"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/rundeck/rundeck/pull/4407"
        ],
        "olp_code_files": {
          "patch": [
            "rundeckapp/grails-app/assets/javascripts/workflowStepEditorKO.js||rundeckapp/grails-app/assets/javascripts/workflowStepEditorKO.js",
            "rundeckapp/grails-app/views/execution/_wfitemEdit.gsp||rundeckapp/grails-app/views/execution/_wfitemEdit.gsp"
          ],
          "candidate": [
            "rundeckapp/grails-app/assets/javascripts/workflowStepEditorKO.js||rundeckapp/grails-app/assets/javascripts/workflowStepEditorKO.js",
            "rundeckapp/grails-app/views/execution/_wfitemEdit.gsp||rundeckapp/grails-app/views/execution/_wfitemEdit.gsp"
          ]
        }
      },
      "candidate_diff": {
        "rundeckapp/grails-app/assets/javascripts/workflowStepEditorKO.js||rundeckapp/grails-app/assets/javascripts/workflowStepEditorKO.js": [
          "File: rundeckapp/grails-app/assets/javascripts/workflowStepEditorKO.js -> rundeckapp/grails-app/assets/javascripts/workflowStepEditorKO.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "388:     self.argStringAsQuotedWithScriptfile = ko.computed(function () {",
          "389:         var isq = self.argsQuoted() ? '\"' : '';",
          "390:         return isq",
          "392:             + self.args()",
          "393:             + isq;",
          "394:     });",
          "",
          "[Removed Lines]",
          "391:             + '<em>' + self.scriptfileText() +'</em> '",
          "",
          "[Added Lines]",
          "391:             + self.scriptfileText() + ' '",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "410:     self.invocationPreviewHtml = ko.computed(function () {",
          "411:         var text = '';",
          "412:         if (self.invocationString() && self.invocationString().indexOf('${scriptfile}') >= 0) {",
          "414:         } else if (self.invocationString()) {",
          "415:             text += self.invocationString() + ' ' + self.argStringAsQuotedWithScriptfile();",
          "416:         } else {",
          "",
          "[Removed Lines]",
          "413:             text += self.invocationString().split('\\$\\{scriptfile\\}').join('<em>' + self.scriptfileText() +'</em>') + ' ' + self.argStringAsQuoted();",
          "",
          "[Added Lines]",
          "413:             text += self.invocationString().split('\\$\\{scriptfile\\}').join(  self.scriptfileText() ) + ' ' + self.argStringAsQuoted();",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "527:         },",
          "528:         ignore: ['editor']",
          "529:     }, this);",
          "",
          "[Removed Lines]",
          "530: }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "rundeckapp/grails-app/views/execution/_wfitemEdit.gsp||rundeckapp/grails-app/views/execution/_wfitemEdit.gsp": [
          "File: rundeckapp/grails-app/views/execution/_wfitemEdit.gsp -> rundeckapp/grails-app/views/execution/_wfitemEdit.gsp",
          "--- Hunk 1 ---",
          "[Context before]",
          "557:                             <div class=\"col-sm-2 control-label\"><g:message code=\"Workflow.step.script.execution.preview.label\" /></div>",
          "559:                             <div id='interpreterArgsQuotedHelp${rkey}_preview' class=\"col-sm-10 form-control-static\">",
          "561:                             </div>",
          "563:                             <g:embedJSON id=\"scriptStepData_${rkey}\" data=\"${[invocationString: item?.scriptInterpreter?:'',fileExtension: item?.fileExtension?:'',args: item?.argString?:'',argsQuoted: item?.interpreterArgsQuoted?true:false]}\"/>",
          "",
          "[Removed Lines]",
          "560:                                 <code>$ <span data-bind=\"html: invocationPreviewHtml\"></span></code>",
          "",
          "[Added Lines]",
          "560:                                 <code>$ <span data-bind=\"text: invocationPreviewHtml\"></span></code>",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "e546d349bcc6b9cdf0222b631f22d62af4227759",
      "candidate_info": {
        "commit_hash": "e546d349bcc6b9cdf0222b631f22d62af4227759",
        "repo": "rundeck/rundeck",
        "commit_url": "https://github.com/rundeck/rundeck/commit/e546d349bcc6b9cdf0222b631f22d62af4227759",
        "files": [
          "rundeckapp/grails-app/assets/javascripts/workflowStepEditorKO.js",
          "rundeckapp/grails-app/views/execution/_wfitemEdit.gsp"
        ],
        "message": "Fix #4406: stored xss vulnerability",
        "before_after_code_files": [
          "rundeckapp/grails-app/assets/javascripts/workflowStepEditorKO.js||rundeckapp/grails-app/assets/javascripts/workflowStepEditorKO.js",
          "rundeckapp/grails-app/views/execution/_wfitemEdit.gsp||rundeckapp/grails-app/views/execution/_wfitemEdit.gsp"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_olp_changes": 1,
        "olp_code_files": {
          "patch": [
            "rundeckapp/grails-app/assets/javascripts/workflowStepEditorKO.js||rundeckapp/grails-app/assets/javascripts/workflowStepEditorKO.js",
            "rundeckapp/grails-app/views/execution/_wfitemEdit.gsp||rundeckapp/grails-app/views/execution/_wfitemEdit.gsp"
          ],
          "candidate": [
            "rundeckapp/grails-app/assets/javascripts/workflowStepEditorKO.js||rundeckapp/grails-app/assets/javascripts/workflowStepEditorKO.js",
            "rundeckapp/grails-app/views/execution/_wfitemEdit.gsp||rundeckapp/grails-app/views/execution/_wfitemEdit.gsp"
          ]
        }
      },
      "candidate_diff": {
        "rundeckapp/grails-app/assets/javascripts/workflowStepEditorKO.js||rundeckapp/grails-app/assets/javascripts/workflowStepEditorKO.js": [
          "File: rundeckapp/grails-app/assets/javascripts/workflowStepEditorKO.js -> rundeckapp/grails-app/assets/javascripts/workflowStepEditorKO.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "388:     self.argStringAsQuotedWithScriptfile = ko.computed(function () {",
          "389:         var isq = self.argsQuoted() ? '\"' : '';",
          "390:         return isq",
          "392:             + self.args()",
          "393:             + isq;",
          "394:     });",
          "",
          "[Removed Lines]",
          "391:             + '<em>' + self.scriptfileText() +'</em> '",
          "",
          "[Added Lines]",
          "391:             + self.scriptfileText() + ' '",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "410:     self.invocationPreviewHtml = ko.computed(function () {",
          "411:         var text = '';",
          "412:         if (self.invocationString() && self.invocationString().indexOf('${scriptfile}') >= 0) {",
          "414:         } else if (self.invocationString()) {",
          "415:             text += self.invocationString() + ' ' + self.argStringAsQuotedWithScriptfile();",
          "416:         } else {",
          "",
          "[Removed Lines]",
          "413:             text += self.invocationString().split('\\$\\{scriptfile\\}').join('<em>' + self.scriptfileText() +'</em>') + ' ' + self.argStringAsQuoted();",
          "",
          "[Added Lines]",
          "413:             text += self.invocationString().split('\\$\\{scriptfile\\}').join(  self.scriptfileText() ) + ' ' + self.argStringAsQuoted();",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "527:         },",
          "528:         ignore: ['editor']",
          "529:     }, this);",
          "",
          "[Removed Lines]",
          "530: }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "rundeckapp/grails-app/views/execution/_wfitemEdit.gsp||rundeckapp/grails-app/views/execution/_wfitemEdit.gsp": [
          "File: rundeckapp/grails-app/views/execution/_wfitemEdit.gsp -> rundeckapp/grails-app/views/execution/_wfitemEdit.gsp",
          "--- Hunk 1 ---",
          "[Context before]",
          "560:                             <div class=\"col-sm-2 control-label\"><g:message code=\"Workflow.step.script.execution.preview.label\" /></div>",
          "562:                             <div id='interpreterArgsQuotedHelp${rkey}_preview' class=\"col-sm-10 form-control-static\">",
          "564:                             </div>",
          "566:                             <g:embedJSON id=\"scriptStepData_${rkey}\" data=\"${[invocationString: item?.scriptInterpreter?:'',fileExtension: item?.fileExtension?:'',args: item?.argString?:'',argsQuoted: item?.interpreterArgsQuoted?true:false]}\"/>",
          "",
          "[Removed Lines]",
          "563:                                 <code>$ <span data-bind=\"html: invocationPreviewHtml\"></span></code>",
          "",
          "[Added Lines]",
          "563:                                 <code>$ <span data-bind=\"text: invocationPreviewHtml\"></span></code>",
          "",
          "---------------"
        ]
      }
    }
  ]
}