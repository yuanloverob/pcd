{
  "cve_id": "CVE-2020-22452",
  "cve_desc": "SQL Injection vulnerability in function getTableCreationQuery in CreateAddField.php in phpMyAdmin 5.x before 5.2.0 via the tbl_storage_engine or tbl_collation parameters to tbl_create.php.",
  "repo": "phpmyadmin/phpmyadmin",
  "patch_hash": "bc982466f08ddccad4804ba928f84ff8e25107cb",
  "patch_info": {
    "commit_hash": "bc982466f08ddccad4804ba928f84ff8e25107cb",
    "repo": "phpmyadmin/phpmyadmin",
    "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/bc982466f08ddccad4804ba928f84ff8e25107cb",
    "files": [
      "ChangeLog"
    ],
    "message": "Add ChangeLog entry for #15898\n\nRef: e1f5dfcd167488a3a72706cb3ebb792a62452e38\nSigned-off-by: William Desportes <williamdes@wdes.fr>",
    "before_after_code_files": []
  },
  "patch_diff": {},
  "candidates": [
    {
      "candidate_hash": "ca42395ee4b2936d3702524f8fb8bec1e9502bc7",
      "candidate_info": {
        "commit_hash": "ca42395ee4b2936d3702524f8fb8bec1e9502bc7",
        "repo": "phpmyadmin/phpmyadmin",
        "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/ca42395ee4b2936d3702524f8fb8bec1e9502bc7",
        "files": [
          "libraries/classes/CreateAddField.php"
        ],
        "message": "Fix #15898 - escape tbl_storage_engine argument\n\nSigned-off-by: William Desportes <williamdes@wdes.fr>",
        "before_after_code_files": [
          "libraries/classes/CreateAddField.php||libraries/classes/CreateAddField.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_issue": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "libraries/classes/CreateAddField.php||libraries/classes/CreateAddField.php": [
          "File: libraries/classes/CreateAddField.php -> libraries/classes/CreateAddField.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "467:         if (! empty($_POST['tbl_storage_engine'])",
          "468:             && ($_POST['tbl_storage_engine'] != 'Default')",
          "469:         ) {",
          "471:         }",
          "472:         if (! empty($_POST['tbl_collation'])) {",
          "473:             $sqlQuery .= Util::getCharsetQueryPart($_POST['tbl_collation']);",
          "",
          "[Removed Lines]",
          "470:             $sqlQuery .= ' ENGINE = ' . $_POST['tbl_storage_engine'];",
          "",
          "[Added Lines]",
          "470:             $sqlQuery .= ' ENGINE = ' . $this->dbi->escapeString($_POST['tbl_storage_engine']);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "f6af795eb380aef11a2924b8be91dfbb4a7562b6",
      "candidate_info": {
        "commit_hash": "f6af795eb380aef11a2924b8be91dfbb4a7562b6",
        "repo": "phpmyadmin/phpmyadmin",
        "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/f6af795eb380aef11a2924b8be91dfbb4a7562b6",
        "files": [
          "test/classes/CreateAddFieldTest.php"
        ],
        "message": "Add test case for #15898\n\nDepends on 20e3d2fa9f5dc55fd25209963b5f26705d3e8020\n\nSigned-off-by: William Desportes <williamdes@wdes.fr>",
        "before_after_code_files": [
          "test/classes/CreateAddFieldTest.php||test/classes/CreateAddFieldTest.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_issue": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "test/classes/CreateAddFieldTest.php||test/classes/CreateAddFieldTest.php": [
          "File: test/classes/CreateAddFieldTest.php -> test/classes/CreateAddFieldTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "114:                     'spatial_indexes' => '{}',",
          "115:                 ],",
          "116:             ],",
          "117:         ];",
          "118:     }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "117:             [",
          "118:                 'CREATE TABLE `db`.`table` () ENGINE = Inno\\\\\\'DB CHARSET=armscii8 COMMENT = \\'my \\\\\\'table\\';',",
          "119:                 'db',",
          "120:                 'table',",
          "121:                 [",
          "122:                     'field_name' => [],",
          "123:                     'primary_indexes' => '{}',",
          "124:                     'indexes' => '{}',",
          "125:                     'unique_indexes' => '{}',",
          "126:                     'fulltext_indexes' => '{}',",
          "127:                     'spatial_indexes' => '{}',",
          "128:                     'tbl_storage_engine' => 'Inno\\'DB',",
          "129:                     'tbl_collation' => 'armscii8',",
          "130:                     'connection' => 'aaaa',",
          "131:                     'comment' => 'my \\'table',",
          "132:                 ],",
          "133:             ],",
          "",
          "---------------"
        ]
      }
    }
  ]
}