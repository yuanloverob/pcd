{
  "cve_id": "CVE-2021-45456",
  "cve_desc": "Apache kylin checks the legitimacy of the project before executing some commands with the project name passed in by the user. There is a mismatch between what is being checked and what is being used as the shell command argument in DiagnosisService. This may cause an illegal project name to pass the check and perform the following steps, resulting in a command injection vulnerability. This issue affects Apache Kylin 4.0.0.",
  "repo": "apache/kylin",
  "patch_hash": "f4daf14dde99b934c92ce2c832509f24342bc845",
  "patch_info": {
    "commit_hash": "f4daf14dde99b934c92ce2c832509f24342bc845",
    "repo": "apache/kylin",
    "commit_url": "https://github.com/apache/kylin/commit/f4daf14dde99b934c92ce2c832509f24342bc845",
    "files": [
      "core-common/src/main/java/org/apache/kylin/common/KylinConfigBase.java",
      "core-common/src/main/java/org/apache/kylin/common/util/EncryptUtil.java",
      "core-common/src/test/java/org/apache/kylin/common/util/EncryptUtilTest.java",
      "server-base/src/main/java/org/apache/kylin/rest/service/DiagnosisService.java",
      "server/src/main/webapp/WEB-INF/web.xml"
    ],
    "message": "test fix",
    "before_after_code_files": [
      "core-common/src/main/java/org/apache/kylin/common/KylinConfigBase.java||core-common/src/main/java/org/apache/kylin/common/KylinConfigBase.java",
      "core-common/src/main/java/org/apache/kylin/common/util/EncryptUtil.java||core-common/src/main/java/org/apache/kylin/common/util/EncryptUtil.java",
      "core-common/src/test/java/org/apache/kylin/common/util/EncryptUtilTest.java||core-common/src/test/java/org/apache/kylin/common/util/EncryptUtilTest.java",
      "server-base/src/main/java/org/apache/kylin/rest/service/DiagnosisService.java||server-base/src/main/java/org/apache/kylin/rest/service/DiagnosisService.java"
    ]
  },
  "patch_diff": {
    "core-common/src/main/java/org/apache/kylin/common/KylinConfigBase.java||core-common/src/main/java/org/apache/kylin/common/KylinConfigBase.java": [
      "File: core-common/src/main/java/org/apache/kylin/common/KylinConfigBase.java -> core-common/src/main/java/org/apache/kylin/common/KylinConfigBase.java",
      "--- Hunk 1 ---",
      "[Context before]",
      "3403:     public String getKerberosPrincipal() {",
      "3404:         return getOptional(\"kylin.kerberos.principal\");",
      "3405:     }",
      "3406: }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "3407:     public String getEncryptCipherIvSpec() {",
      "3408:         return getOptional(\"kylin.security.encrypt.cipher.ivSpec\", \"AAAAAAAAAAAAAAAA\");",
      "3409:     }",
      "",
      "---------------"
    ],
    "core-common/src/main/java/org/apache/kylin/common/util/EncryptUtil.java||core-common/src/main/java/org/apache/kylin/common/util/EncryptUtil.java": [
      "File: core-common/src/main/java/org/apache/kylin/common/util/EncryptUtil.java -> core-common/src/main/java/org/apache/kylin/common/util/EncryptUtil.java",
      "--- Hunk 1 ---",
      "[Context before]",
      "25: import java.security.NoSuchAlgorithmException;",
      "27: import org.apache.commons.codec.binary.Base64;",
      "29: import javax.crypto.Cipher;",
      "30: import javax.crypto.NoSuchPaddingException;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "28: import org.apache.kylin.common.KylinConfig;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "42:             InvalidKeyException, NoSuchPaddingException, NoSuchAlgorithmException, UnsupportedEncodingException {",
      "43:         Cipher cipher = Cipher.getInstance(\"AES/CFB/PKCS5Padding\");",
      "44:         final SecretKeySpec secretKey = new SecretKeySpec(key, \"AES\");",
      "46:         cipher.init(cipherMode, secretKey, ivSpec);",
      "47:         return cipher;",
      "48:     }",
      "",
      "[Removed Lines]",
      "45:         IvParameterSpec ivSpec = new IvParameterSpec(\"AAAAAAAAAAAAAAAA\".getBytes(\"UTF-8\"));",
      "",
      "[Added Lines]",
      "46:         IvParameterSpec ivSpec = new IvParameterSpec(KylinConfig.getInstanceFromEnv().getEncryptCipherIvSpec().getBytes(\"UTF-8\"));",
      "",
      "---------------"
    ],
    "core-common/src/test/java/org/apache/kylin/common/util/EncryptUtilTest.java||core-common/src/test/java/org/apache/kylin/common/util/EncryptUtilTest.java": [
      "File: core-common/src/test/java/org/apache/kylin/common/util/EncryptUtilTest.java -> core-common/src/test/java/org/apache/kylin/common/util/EncryptUtilTest.java",
      "--- Hunk 1 ---",
      "[Context before]",
      "19: package org.apache.kylin.common.util;",
      "21: import org.junit.Assert;",
      "22: import org.junit.Test;",
      "26:     @Test",
      "27:     public void testAESEncrypt(){",
      "",
      "[Removed Lines]",
      "24: public class EncryptUtilTest {",
      "",
      "[Added Lines]",
      "21: import org.junit.After;",
      "23: import org.junit.Before;",
      "26: public class EncryptUtilTest extends LocalFileMetadataTestCase {",
      "27:     @Before",
      "28:     public void setUp() throws Exception {",
      "29:         this.createTestMetadata();",
      "30:     }",
      "32:     @After",
      "33:     public void after() throws Exception {",
      "34:         this.cleanupTestMetadata();",
      "35:     }",
      "",
      "---------------"
    ],
    "server-base/src/main/java/org/apache/kylin/rest/service/DiagnosisService.java||server-base/src/main/java/org/apache/kylin/rest/service/DiagnosisService.java": [
      "File: server-base/src/main/java/org/apache/kylin/rest/service/DiagnosisService.java -> server-base/src/main/java/org/apache/kylin/rest/service/DiagnosisService.java",
      "--- Hunk 1 ---",
      "[Context before]",
      "87:     public String dumpProjectDiagnosisInfo(String project, File exportPath) throws IOException {",
      "88:         Message msg = MsgPicker.getMsg();",
      "89:         ProjectInstance projectInstance =",
      "90:                 ProjectManager.getInstance(KylinConfig.getInstanceFromEnv())",
      "92:         if (null == projectInstance) {",
      "93:             throw new BadRequestException(",
      "95:         }",
      "96:         aclEvaluate.checkProjectOperationPermission(projectInstance);",
      "98:         runDiagnosisCLI(args);",
      "99:         return getDiagnosisPackageName(exportPath);",
      "100:     }",
      "",
      "[Removed Lines]",
      "91:                         .getProject(ValidateUtil.convertStringToBeAlphanumericUnderscore(project));",
      "94:                     String.format(Locale.ROOT, msg.getDIAG_PROJECT_NOT_FOUND(), project));",
      "97:         String[] args = { project, exportPath.getAbsolutePath() };",
      "",
      "[Added Lines]",
      "89:         String projectName = ValidateUtil.convertStringToBeAlphanumericUnderscore(project);",
      "92:                         .getProject(projectName);",
      "95:                     String.format(Locale.ROOT, msg.getDIAG_PROJECT_NOT_FOUND(), projectName));",
      "98:         String[] args = { projectName, exportPath.getAbsolutePath() };",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "e42cc235153f7e8302dabd3207beb945b510d628",
      "candidate_info": {
        "commit_hash": "e42cc235153f7e8302dabd3207beb945b510d628",
        "repo": "apache/kylin",
        "commit_url": "https://github.com/apache/kylin/commit/e42cc235153f7e8302dabd3207beb945b510d628",
        "files": [
          "core-common/src/main/java/org/apache/kylin/common/util/EncryptUtil.java",
          "core-common/src/test/java/org/apache/kylin/common/util/EncryptUtilTest.java"
        ],
        "message": "KYLIN-4438 fix bug: null password may cause RuntimeException when starting up\n\n(cherry picked from commit bd6c891dfc5f962630d2a2ae51d66880f1ef8037)",
        "before_after_code_files": [
          "core-common/src/main/java/org/apache/kylin/common/util/EncryptUtil.java||core-common/src/main/java/org/apache/kylin/common/util/EncryptUtil.java",
          "core-common/src/test/java/org/apache/kylin/common/util/EncryptUtilTest.java||core-common/src/test/java/org/apache/kylin/common/util/EncryptUtilTest.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/kylin/pull/1893",
          "https://github.com/apache/kylin/pull/2018",
          "https://github.com/apache/kylin/pull/2125",
          "https://github.com/apache/kylin/pull/2033",
          "https://github.com/apache/kylin/pull/2112",
          "https://github.com/apache/kylin/pull/2115",
          "https://github.com/apache/kylin/pull/1865",
          "https://github.com/apache/kylin/pull/1913",
          "https://github.com/apache/kylin/pull/2135"
        ],
        "olp_code_files": {
          "patch": [
            "core-common/src/main/java/org/apache/kylin/common/util/EncryptUtil.java||core-common/src/main/java/org/apache/kylin/common/util/EncryptUtil.java",
            "core-common/src/test/java/org/apache/kylin/common/util/EncryptUtilTest.java||core-common/src/test/java/org/apache/kylin/common/util/EncryptUtilTest.java"
          ],
          "candidate": [
            "core-common/src/main/java/org/apache/kylin/common/util/EncryptUtil.java||core-common/src/main/java/org/apache/kylin/common/util/EncryptUtil.java",
            "core-common/src/test/java/org/apache/kylin/common/util/EncryptUtilTest.java||core-common/src/test/java/org/apache/kylin/common/util/EncryptUtilTest.java"
          ]
        }
      },
      "candidate_diff": {
        "core-common/src/main/java/org/apache/kylin/common/util/EncryptUtil.java||core-common/src/main/java/org/apache/kylin/common/util/EncryptUtil.java": [
          "File: core-common/src/main/java/org/apache/kylin/common/util/EncryptUtil.java -> core-common/src/main/java/org/apache/kylin/common/util/EncryptUtil.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "32:             0x65, 0x79 };",
          "34:     public static String encrypt(String strToEncrypt) {",
          "35:         try {",
          "36:             Cipher cipher = Cipher.getInstance(\"AES/ECB/PKCS5Padding\");",
          "37:             final SecretKeySpec secretKey = new SecretKeySpec(key, \"AES\");",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "35:         if (strToEncrypt == null) {",
          "36:             return null;",
          "37:         }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "45:     }",
          "47:     public static String decrypt(String strToDecrypt) {",
          "48:         try {",
          "49:             Cipher cipher = Cipher.getInstance(\"AES/ECB/PKCS5PADDING\");",
          "50:             final SecretKeySpec secretKey = new SecretKeySpec(key, \"AES\");",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "51:         if (strToDecrypt == null) {",
          "52:             return null;",
          "53:         }",
          "",
          "---------------"
        ],
        "core-common/src/test/java/org/apache/kylin/common/util/EncryptUtilTest.java||core-common/src/test/java/org/apache/kylin/common/util/EncryptUtilTest.java": [
          "File: core-common/src/test/java/org/apache/kylin/common/util/EncryptUtilTest.java -> core-common/src/test/java/org/apache/kylin/common/util/EncryptUtilTest.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "30:         Assert.assertEquals(\"4stv/RRleOtvie/8SLHmXA==\", result);",
          "31:     }",
          "33: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "33:     @Test",
          "34:     public void testNullInput() {",
          "35:         Assert.assertNull(EncryptUtil.encrypt(null));",
          "36:         Assert.assertNull(EncryptUtil.decrypt(null));",
          "37:     }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "32f8d66cc368a157fb27acf41e8dac8bf73375f1",
      "candidate_info": {
        "commit_hash": "32f8d66cc368a157fb27acf41e8dac8bf73375f1",
        "repo": "apache/kylin",
        "commit_url": "https://github.com/apache/kylin/commit/32f8d66cc368a157fb27acf41e8dac8bf73375f1",
        "files": [
          "core-common/src/main/java/org/apache/kylin/common/KylinConfigExt.java",
          "core-common/src/test/java/org/apache/kylin/common/KylinConfigTest.java"
        ],
        "message": "fix KYLIN-4850, merge Cube's override kylin_properties into building job's configuration",
        "before_after_code_files": [
          "core-common/src/main/java/org/apache/kylin/common/KylinConfigExt.java||core-common/src/main/java/org/apache/kylin/common/KylinConfigExt.java",
          "core-common/src/test/java/org/apache/kylin/common/KylinConfigTest.java||core-common/src/test/java/org/apache/kylin/common/KylinConfigTest.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/kylin/pull/1893",
          "https://github.com/apache/kylin/pull/2018",
          "https://github.com/apache/kylin/pull/2125",
          "https://github.com/apache/kylin/pull/2033",
          "https://github.com/apache/kylin/pull/2112",
          "https://github.com/apache/kylin/pull/2115",
          "https://github.com/apache/kylin/pull/1865",
          "https://github.com/apache/kylin/pull/1913",
          "https://github.com/apache/kylin/pull/2135"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "core-common/src/main/java/org/apache/kylin/common/KylinConfigExt.java||core-common/src/main/java/org/apache/kylin/common/KylinConfigExt.java": [
          "File: core-common/src/main/java/org/apache/kylin/common/KylinConfigExt.java -> core-common/src/main/java/org/apache/kylin/common/KylinConfigExt.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "21: import org.apache.commons.lang.text.StrSubstitutor;",
          "22: import org.apache.kylin.shaded.com.google.common.collect.Maps;",
          "24: import java.util.Map;",
          "25: import java.util.Properties;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "24: import java.util.HashMap;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "53:     private KylinConfigExt(KylinConfigExt ext, Map<String, String> overrides) {",
          "54:         super(ext.base.getRawAllProperties(), true);",
          "55:         this.base = ext.base;",
          "57:     }",
          "59:     @Override",
          "",
          "[Removed Lines]",
          "56:         this.overrides = BCC.check(overrides);",
          "",
          "[Added Lines]",
          "57:         this.overrides = new HashMap<>();",
          "58:         this.overrides.putAll(ext.overrides);",
          "59:         this.overrides.putAll(BCC.check(overrides));",
          "",
          "---------------"
        ],
        "core-common/src/test/java/org/apache/kylin/common/KylinConfigTest.java||core-common/src/test/java/org/apache/kylin/common/KylinConfigTest.java": [
          "File: core-common/src/test/java/org/apache/kylin/common/KylinConfigTest.java -> core-common/src/test/java/org/apache/kylin/common/KylinConfigTest.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "19: package org.apache.kylin.common;",
          "21: import java.util.Map;",
          "22: import java.util.Properties;",
          "24: import org.apache.kylin.common.KylinConfig.SetAndUnsetThreadLocalConfig;",
          "25: import org.junit.Test;",
          "27: import org.apache.kylin.shaded.com.google.common.collect.Maps;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "21: import java.util.HashMap;",
          "26: import org.junit.Assert;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "198:       KylinConfig.createInstanceFromUri(\"dHy3K~m\");",
          "199:   }",
          "201: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "203:   @Test",
          "204:   public void testKylinConfigExt(){",
          "205:       KylinConfig conf = KylinConfig.getInstanceFromEnv();",
          "206:       Map<String, String> overrideConf1 = new HashMap<>();",
          "207:       overrideConf1.put(\"foo\", \"fooValue\");",
          "208:       overrideConf1.put(\"bar\", \"\");",
          "209:       KylinConfigExt ext1 = KylinConfigExt.createInstance(conf, overrideConf1);",
          "211:       Map<String, String> overrideConf2 = new HashMap<>();",
          "212:       overrideConf2.put(\"bar\", \"barValue\");",
          "213:       KylinConfigExt ext2 = KylinConfigExt.createInstance(ext1, overrideConf2);",
          "216:       Assert.assertEquals(ext2.getOptional(\"foo\"), \"fooValue\");",
          "218:       Assert.assertEquals(ext2.getOptional(\"bar\"), \"barValue\");",
          "219:   }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "a6ac84e37b959efef3dbe7324268f50fba5b7ecc",
      "candidate_info": {
        "commit_hash": "a6ac84e37b959efef3dbe7324268f50fba5b7ecc",
        "repo": "apache/kylin",
        "commit_url": "https://github.com/apache/kylin/commit/a6ac84e37b959efef3dbe7324268f50fba5b7ecc",
        "files": [
          "kylin-spark-project/kylin-spark-engine/src/main/java/org/apache/kylin/engine/spark/job/OptimizeBuildJob.java"
        ],
        "message": "commit",
        "before_after_code_files": [
          "kylin-spark-project/kylin-spark-engine/src/main/java/org/apache/kylin/engine/spark/job/OptimizeBuildJob.java||kylin-spark-project/kylin-spark-engine/src/main/java/org/apache/kylin/engine/spark/job/OptimizeBuildJob.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/kylin/pull/1893",
          "https://github.com/apache/kylin/pull/2018",
          "https://github.com/apache/kylin/pull/2125",
          "https://github.com/apache/kylin/pull/2033",
          "https://github.com/apache/kylin/pull/2112",
          "https://github.com/apache/kylin/pull/2115",
          "https://github.com/apache/kylin/pull/1865",
          "https://github.com/apache/kylin/pull/1913",
          "https://github.com/apache/kylin/pull/2135"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "kylin-spark-project/kylin-spark-engine/src/main/java/org/apache/kylin/engine/spark/job/OptimizeBuildJob.java||kylin-spark-project/kylin-spark-engine/src/main/java/org/apache/kylin/engine/spark/job/OptimizeBuildJob.java": [
          "File: kylin-spark-project/kylin-spark-engine/src/main/java/org/apache/kylin/engine/spark/job/OptimizeBuildJob.java -> kylin-spark-project/kylin-spark-engine/src/main/java/org/apache/kylin/engine/spark/job/OptimizeBuildJob.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "272:                         @Override",
          "273:                         public NBuildSourceInfo getBuildSourceInfo() {",
          "275:                         }",
          "276:                     }, config);",
          "277:                 } else {",
          "",
          "[Removed Lines]",
          "274:                             return info;",
          "",
          "[Added Lines]",
          "274:                             return null;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "25db0b67e09f56fc646cbaaa8e05d0370275a539",
      "candidate_info": {
        "commit_hash": "25db0b67e09f56fc646cbaaa8e05d0370275a539",
        "repo": "apache/kylin",
        "commit_url": "https://github.com/apache/kylin/commit/25db0b67e09f56fc646cbaaa8e05d0370275a539",
        "files": [
          "build-engine/src/main/java/org/apache/kylin/engine/mr/common/JobInfoConverter.java",
          "core-job/src/main/java/org/apache/kylin/job/execution/DefaultChainedExecutable.java"
        ],
        "message": "Fix mvn install error",
        "before_after_code_files": [
          "build-engine/src/main/java/org/apache/kylin/engine/mr/common/JobInfoConverter.java||build-engine/src/main/java/org/apache/kylin/engine/mr/common/JobInfoConverter.java",
          "core-job/src/main/java/org/apache/kylin/job/execution/DefaultChainedExecutable.java||core-job/src/main/java/org/apache/kylin/job/execution/DefaultChainedExecutable.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/kylin/pull/1893",
          "https://github.com/apache/kylin/pull/2018",
          "https://github.com/apache/kylin/pull/2125",
          "https://github.com/apache/kylin/pull/2033",
          "https://github.com/apache/kylin/pull/2112",
          "https://github.com/apache/kylin/pull/2115",
          "https://github.com/apache/kylin/pull/1865",
          "https://github.com/apache/kylin/pull/1913",
          "https://github.com/apache/kylin/pull/2135"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "build-engine/src/main/java/org/apache/kylin/engine/mr/common/JobInfoConverter.java||build-engine/src/main/java/org/apache/kylin/engine/mr/common/JobInfoConverter.java": [
          "File: build-engine/src/main/java/org/apache/kylin/engine/mr/common/JobInfoConverter.java -> build-engine/src/main/java/org/apache/kylin/engine/mr/common/JobInfoConverter.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "43: public class JobInfoConverter {",
          "44:     private static final Logger logger = LoggerFactory.getLogger(JobInfoConverter.class);",
          "47:         try {",
          "49:         } catch (Exception e) {",
          "50:             logger.error(\"Failed to parse job instance: uuid={}\", job, e);",
          "51:             return null;",
          "",
          "[Removed Lines]",
          "46:     public static JobInstance parseToJobInstanceQuietly(CubingJob job, Map<String, Output> outputs) {",
          "48:             return parseToJobInstance(job, outputs);",
          "",
          "[Added Lines]",
          "46:     public static JobInstance parseToJobInstanceQuietly(AbstractExecutable job, Map<String, Output> outputs) {",
          "48:             if (job instanceof CheckpointExecutable) {",
          "49:                 return parseToJobInstance((CheckpointExecutable)job, outputs);",
          "50:             } else if (job instanceof CubingJob) {",
          "51:                 return parseToJobInstance((CubingJob)job, outputs);",
          "52:             } else {",
          "53:                 return null;",
          "54:             }",
          "",
          "---------------"
        ],
        "core-job/src/main/java/org/apache/kylin/job/execution/DefaultChainedExecutable.java||core-job/src/main/java/org/apache/kylin/job/execution/DefaultChainedExecutable.java": [
          "File: core-job/src/main/java/org/apache/kylin/job/execution/DefaultChainedExecutable.java -> core-job/src/main/java/org/apache/kylin/job/execution/DefaultChainedExecutable.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "53:         }",
          "54:     }",
          "64:     public long getMapReduceWaitTime() {",
          "65:         return getExtraInfoAsLong(MetadataConstants.MAP_REDUCE_WAIT_TIME, 0L);",
          "66:     }",
          "",
          "[Removed Lines]",
          "56:     protected void setProjectName(String name) {",
          "57:         setParam(MetadataConstants.P_PROJECT_NAME, name);",
          "58:     }",
          "60:     public String getProjectName() {",
          "61:         return getParam(MetadataConstants.P_PROJECT_NAME);",
          "62:     }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "b207ca1666213807177a4a6ae711efecb4ac9cbc",
      "candidate_info": {
        "commit_hash": "b207ca1666213807177a4a6ae711efecb4ac9cbc",
        "repo": "apache/kylin",
        "commit_url": "https://github.com/apache/kylin/commit/b207ca1666213807177a4a6ae711efecb4ac9cbc",
        "files": [
          "core-common/src/main/resources/kylin-defaults.properties",
          "kylin-spark-project/kylin-spark-common/src/main/java/org/apache/kylin/engine/spark/common/logging/SparkExecutorHdfsAppender.java"
        ],
        "message": "HOTFIX fix slf4j jar version conflict",
        "before_after_code_files": [
          "core-common/src/main/resources/kylin-defaults.properties||core-common/src/main/resources/kylin-defaults.properties",
          "kylin-spark-project/kylin-spark-common/src/main/java/org/apache/kylin/engine/spark/common/logging/SparkExecutorHdfsAppender.java||kylin-spark-project/kylin-spark-common/src/main/java/org/apache/kylin/engine/spark/common/logging/SparkExecutorHdfsAppender.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/kylin/pull/1893",
          "https://github.com/apache/kylin/pull/2018",
          "https://github.com/apache/kylin/pull/2125",
          "https://github.com/apache/kylin/pull/2033",
          "https://github.com/apache/kylin/pull/2112",
          "https://github.com/apache/kylin/pull/2115",
          "https://github.com/apache/kylin/pull/1865",
          "https://github.com/apache/kylin/pull/1913",
          "https://github.com/apache/kylin/pull/2135"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "core-common/src/main/resources/kylin-defaults.properties||core-common/src/main/resources/kylin-defaults.properties": [
          "File: core-common/src/main/resources/kylin-defaults.properties -> core-common/src/main/resources/kylin-defaults.properties",
          "--- Hunk 1 ---",
          "[Context before]",
          "286: #kylin.query.spark-conf.spark.yarn.jars=hdfs://localhost:9000/spark2_jars/*",
          "287: kylin.query.spark-conf.spark.hadoop.yarn.timeline-service.enabled=false",
          "290: # uncomment for HDP",
          "291: #kylin.query.spark-conf.spark.driver.extraJavaOptions=-Dhdp.version=current",
          "292: #kylin.query.spark-conf.spark.yarn.am.extraJavaOptions=-Dhdp.version=current",
          "",
          "[Removed Lines]",
          "289: kylin.query.spark-conf.spark.executor.extraJavaOptions=-Dhdp.version=current -Dlog4j.configuration=spark-executor-log4j.properties -Dlog4j.debug -Dkylin.hdfs.working.dir=${kylin.env.hdfs-working-dir} -Dkylin.metadata.identifier=${kylin.metadata.url.identifier} -Dkylin.spark.category=sparder",
          "",
          "[Added Lines]",
          "289: kylin.query.spark-conf.spark.executor.extraJavaOptions=-Dhdp.version=current -Dlog4j.configuration=spark-executor-log4j.properties -Dlog4j.debug -Dkylin.hdfs.working.dir=${kylin.env.hdfs-working-dir} -Dkylin.metadata.identifier=${kylin.metadata.url.identifier} -Dkylin.spark.category=sparder -Dkylin.spark.identifier={{APP_ID}}",
          "",
          "---------------"
        ],
        "kylin-spark-project/kylin-spark-common/src/main/java/org/apache/kylin/engine/spark/common/logging/SparkExecutorHdfsAppender.java||kylin-spark-project/kylin-spark-common/src/main/java/org/apache/kylin/engine/spark/common/logging/SparkExecutorHdfsAppender.java": [
          "File: kylin-spark-project/kylin-spark-common/src/main/java/org/apache/kylin/engine/spark/common/logging/SparkExecutorHdfsAppender.java -> kylin-spark-project/kylin-spark-common/src/main/java/org/apache/kylin/engine/spark/common/logging/SparkExecutorHdfsAppender.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "30: import org.apache.log4j.spi.LoggingEvent;",
          "31: import org.apache.spark.SparkEnv;",
          "32: import org.apache.spark.deploy.SparkHadoopUtil;",
          "34: import scala.runtime.BoxedUnit;",
          "36: import java.io.File;",
          "",
          "[Removed Lines]",
          "33: import org.apache.spark.deploy.yarn.YarnSparkHadoopUtil;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "113:     @Override",
          "114:     void init() {",
          "120:         LogLog.warn(\"metadataIdentifier -> \" + getMetadataIdentifier());",
          "121:         LogLog.warn(\"category -> \" + getCategory());",
          "122:         LogLog.warn(\"identifier -> \" + getIdentifier());",
          "",
          "[Removed Lines]",
          "115:         if (StringUtils.isBlank(this.identifier)) {",
          "116:             this.identifier = YarnSparkHadoopUtil.getContainerId().getApplicationAttemptId().getApplicationId()",
          "117:                     .toString();",
          "118:         }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    }
  ]
}