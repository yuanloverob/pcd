{
  "cve_id": "CVE-2023-49922",
  "cve_desc": "An issue was discovered by Elastic whereby Beats and Elastic Agent would log a raw event in its own logs at the WARN or ERROR level if ingesting that event to Elasticsearch failed with any 4xx HTTP status code except 409 or 429. Depending on the nature of the event that Beats or Elastic Agent attempted to ingest, this could lead to the insertion of sensitive or private information in the Beats or Elastic Agent logs. Elastic has released 8.11.3 and 7.17.16 that prevents this issue by limiting these types of logs to DEBUG level logging, which is disabled by default.",
  "repo": "elastic/beats",
  "patch_hash": "9bd7de84ab9c31bb4e1c0a348a7b7c26817a0996",
  "patch_info": {
    "commit_hash": "9bd7de84ab9c31bb4e1c0a348a7b7c26817a0996",
    "repo": "elastic/beats",
    "commit_url": "https://github.com/elastic/beats/commit/9bd7de84ab9c31bb4e1c0a348a7b7c26817a0996",
    "files": [
      "libbeat/processors/script/javascript/session.go"
    ],
    "message": "Remove event fields from error log. (#37330) (#37348)\n\nRemove event fields from error log when the script processor\npanics. This is an unlikely situation to happen as the Javascript\nruntime we use should not panic on any error while executing\nJavascript code, hence the event fields are just removed.\n\n(cherry picked from commit 3a504dd1e1e9d6f0c1f5e099e87728f0fba7551b)\n\nCo-authored-by: Tiago Queiroz <tiago.queiroz@elastic.co>",
    "before_after_code_files": [
      "libbeat/processors/script/javascript/session.go||libbeat/processors/script/javascript/session.go"
    ]
  },
  "patch_diff": {
    "libbeat/processors/script/javascript/session.go||libbeat/processors/script/javascript/session.go": [
      "File: libbeat/processors/script/javascript/session.go -> libbeat/processors/script/javascript/session.go",
      "--- Hunk 1 ---",
      "[Context before]",
      "210:   if r := recover(); r != nil {",
      "211:    s.log.Errorw(\"The javascript processor caused an unexpected panic \"+",
      "212:     \"while processing an event. Recovering, but please report this.\",",
      "214:     \"panic\", r,",
      "215:     zap.Stack(\"stack\"))",
      "216:    if !s.evt.IsCancelled() {",
      "",
      "[Removed Lines]",
      "213:     \"event\", mapstr.M{\"original\": b.Fields.String()},",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "331c7b1e39ca213ba7f6a7e5a92ed6398a330b30",
      "candidate_info": {
        "commit_hash": "331c7b1e39ca213ba7f6a7e5a92ed6398a330b30",
        "repo": "elastic/beats",
        "commit_url": "https://github.com/elastic/beats/commit/331c7b1e39ca213ba7f6a7e5a92ed6398a330b30",
        "files": [
          "libbeat/processors/script/javascript/session.go"
        ],
        "message": "Remove event fields from error log. (#37330) (#37349)\n\nRemove event fields from error log when the script processor\npanics. This is an unlikely situation to happen as the Javascript\nruntime we use should not panic on any error while executing\nJavascript code, hence the event fields are just removed.\n\n(cherry picked from commit 3a504dd1e1e9d6f0c1f5e099e87728f0fba7551b)\n\nCo-authored-by: Tiago Queiroz <tiago.queiroz@elastic.co>\nCo-authored-by: Craig MacKenzie <craig.mackenzie@elastic.co>",
        "before_after_code_files": [
          "libbeat/processors/script/javascript/session.go||libbeat/processors/script/javascript/session.go"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "olp_code_files": {
          "patch": [
            "libbeat/processors/script/javascript/session.go||libbeat/processors/script/javascript/session.go"
          ],
          "candidate": [
            "libbeat/processors/script/javascript/session.go||libbeat/processors/script/javascript/session.go"
          ]
        }
      },
      "candidate_diff": {
        "libbeat/processors/script/javascript/session.go||libbeat/processors/script/javascript/session.go": [
          "File: libbeat/processors/script/javascript/session.go -> libbeat/processors/script/javascript/session.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "210:   if r := recover(); r != nil {",
          "211:    s.log.Errorw(\"The javascript processor caused an unexpected panic \"+",
          "212:     \"while processing an event. Recovering, but please report this.\",",
          "214:     \"panic\", r,",
          "215:     zap.Stack(\"stack\"))",
          "216:    if !s.evt.IsCancelled() {",
          "",
          "[Removed Lines]",
          "213:     \"event\", mapstr.M{\"original\": b.Fields.String()},",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "3a504dd1e1e9d6f0c1f5e099e87728f0fba7551b",
      "candidate_info": {
        "commit_hash": "3a504dd1e1e9d6f0c1f5e099e87728f0fba7551b",
        "repo": "elastic/beats",
        "commit_url": "https://github.com/elastic/beats/commit/3a504dd1e1e9d6f0c1f5e099e87728f0fba7551b",
        "files": [
          "libbeat/processors/script/javascript/session.go"
        ],
        "message": "Remove event fields from error log. (#37330)\n\nRemove event fields from error log when the script processor\npanics. This is an unlikely situation to happen as the Javascript\nruntime we use should not panic on any error while executing\nJavascript code, hence the event fields are just removed.",
        "before_after_code_files": [
          "libbeat/processors/script/javascript/session.go||libbeat/processors/script/javascript/session.go"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_cherry_pick": 1,
        "olp_code_files": {
          "patch": [
            "libbeat/processors/script/javascript/session.go||libbeat/processors/script/javascript/session.go"
          ],
          "candidate": [
            "libbeat/processors/script/javascript/session.go||libbeat/processors/script/javascript/session.go"
          ]
        }
      },
      "candidate_diff": {
        "libbeat/processors/script/javascript/session.go||libbeat/processors/script/javascript/session.go": [
          "File: libbeat/processors/script/javascript/session.go -> libbeat/processors/script/javascript/session.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "210:   if r := recover(); r != nil {",
          "211:    s.log.Errorw(\"The javascript processor caused an unexpected panic \"+",
          "212:     \"while processing an event. Recovering, but please report this.\",",
          "214:     \"panic\", r,",
          "215:     zap.Stack(\"stack\"))",
          "216:    if !s.evt.IsCancelled() {",
          "",
          "[Removed Lines]",
          "213:     \"event\", mapstr.M{\"original\": b.Fields.String()},",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "d1f692dc62a7ba1a03ab89f56db6b7de2edc1b20",
      "candidate_info": {
        "commit_hash": "d1f692dc62a7ba1a03ab89f56db6b7de2edc1b20",
        "repo": "elastic/beats",
        "commit_url": "https://github.com/elastic/beats/commit/d1f692dc62a7ba1a03ab89f56db6b7de2edc1b20",
        "files": [
          "libbeat/processors/script/javascript/session.go"
        ],
        "message": "[7.17](backport #37330) Remove event fields from error log. (#37347)\n\n* Remove event fields from error log. (#37330)\n\nRemove event fields from error log when the script processor\npanics. This is an unlikely situation to happen as the Javascript\nruntime we use should not panic on any error while executing\nJavascript code, hence the event fields are just removed.\n\n(cherry picked from commit 3a504dd1e1e9d6f0c1f5e099e87728f0fba7551b)\n\n# Conflicts:\n#\tlibbeat/processors/script/javascript/session.go\n\n* Fix conflict in libbeat/processors/script/javascript/session.go\n\n---------\n\nCo-authored-by: Tiago Queiroz <tiago.queiroz@elastic.co>\nCo-authored-by: Craig MacKenzie <craig.mackenzie@elastic.co>",
        "before_after_code_files": [
          "libbeat/processors/script/javascript/session.go||libbeat/processors/script/javascript/session.go"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "olp_code_files": {
          "patch": [
            "libbeat/processors/script/javascript/session.go||libbeat/processors/script/javascript/session.go"
          ],
          "candidate": [
            "libbeat/processors/script/javascript/session.go||libbeat/processors/script/javascript/session.go"
          ]
        }
      },
      "candidate_diff": {
        "libbeat/processors/script/javascript/session.go||libbeat/processors/script/javascript/session.go": [
          "File: libbeat/processors/script/javascript/session.go -> libbeat/processors/script/javascript/session.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "209:   if r := recover(); r != nil {",
          "210:    s.log.Errorw(\"The javascript processor caused an unexpected panic \"+",
          "211:     \"while processing an event. Recovering, but please report this.\",",
          "213:     \"panic\", r,",
          "214:     zap.Stack(\"stack\"))",
          "215:    if !s.evt.IsCancelled() {",
          "",
          "[Removed Lines]",
          "212:     \"event\", common.MapStr{\"original\": b.Fields.String()},",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    }
  ]
}