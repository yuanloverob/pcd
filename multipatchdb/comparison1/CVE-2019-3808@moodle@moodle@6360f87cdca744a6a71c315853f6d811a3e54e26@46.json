{
  "cve_id": "CVE-2019-3808",
  "cve_desc": "A flaw was found in Moodle versions 3.6 to 3.6.1, 3.5 to 3.5.3, 3.4 to 3.4.6, 3.1 to 3.1.15 and earlier unsupported versions. The 'manage groups' capability did not have the 'XSS risk' flag assigned to it, but does have that access in certain places. Note that the capability is intended for use by trusted users, and is only assigned to teachers and managers by default.",
  "repo": "moodle/moodle",
  "patch_hash": "6360f87cdca744a6a71c315853f6d811a3e54e26",
  "patch_info": {
    "commit_hash": "6360f87cdca744a6a71c315853f6d811a3e54e26",
    "repo": "moodle/moodle",
    "commit_url": "https://github.com/moodle/moodle/commit/6360f87cdca744a6a71c315853f6d811a3e54e26",
    "files": [
      "lib/db/access.php",
      "version.php"
    ],
    "message": "MDL-64395 groups: Added XSS Risk to the manage groups capability",
    "before_after_code_files": [
      "lib/db/access.php||lib/db/access.php",
      "version.php||version.php"
    ]
  },
  "patch_diff": {
    "lib/db/access.php||lib/db/access.php": [
      "File: lib/db/access.php -> lib/db/access.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "1123:     ),",
      "1125:     'moodle/course:managegroups' => array(",
      "1127:         'captype' => 'write',",
      "1128:         'contextlevel' => CONTEXT_COURSE,",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1126:         'riskbitmask' => RISK_XSS,",
      "",
      "---------------"
    ],
    "version.php||version.php": [
      "File: version.php -> version.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "30: defined('MOODLE_INTERNAL') || die();",
      "",
      "[Removed Lines]",
      "32: $version  = 2018122000.01;              // YYYYMMDD      = weekly release date of this DEV branch.",
      "",
      "[Added Lines]",
      "32: $version  = 2018122000.02;              // YYYYMMDD      = weekly release date of this DEV branch.",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "1f23f1412e900e97be661bc1522c34a391f38f42",
      "candidate_info": {
        "commit_hash": "1f23f1412e900e97be661bc1522c34a391f38f42",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/1f23f1412e900e97be661bc1522c34a391f38f42",
        "files": [
          "lang/en/course.php",
          "lang/en/moodle.php",
          "lib/classes/analytics/target/course_gradetopass.php",
          "lib/tests/targets_test.php",
          "version.php"
        ],
        "message": "MDL-65176 analytics: target for students who don't get the minimum grade\n\nAdded new target to predict which students are at risk of not getting\nthe minimum grade to pass a course.",
        "before_after_code_files": [
          "lang/en/course.php||lang/en/course.php",
          "lang/en/moodle.php||lang/en/moodle.php",
          "lib/classes/analytics/target/course_gradetopass.php||lib/classes/analytics/target/course_gradetopass.php",
          "lib/tests/targets_test.php||lib/tests/targets_test.php",
          "version.php||version.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.php||version.php"
          ],
          "candidate": [
            "version.php||version.php"
          ]
        }
      },
      "candidate_diff": {
        "lang/en/course.php||lang/en/course.php": [
          "File: lang/en/course.php -> lang/en/course.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "36: $string['customfield_visibletoteachers'] = 'Teachers';",
          "37: $string['customfieldsettings'] = 'Settings for course custom fields';",
          "38: $string['favourite'] = 'Starred course';",
          "39: $string['privacy:perpage'] = 'The number of courses to show per page.';",
          "40: $string['privacy:completionpath'] = 'Course completion';",
          "41: $string['privacy:favouritespath'] = 'Course starred information';",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "39: $string['gradetopassnotset'] = 'This course does not have a grade to pass set. It may be set in the grade item of the course (Gradebook setup).';",
          "",
          "---------------"
        ],
        "lang/en/moodle.php||lang/en/moodle.php": [
          "File: lang/en/moodle.php -> lang/en/moodle.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "1976: $string['target:coursecompetencies_help'] = 'This target describes whether a student is at risk of not achieving the competencies assigned to a course. This target considers that all competencies assigned to the course must be achieved by the end of the course.';",
          "1977: $string['target:coursedropout'] = 'Students at risk of dropping out';",
          "1978: $string['target:coursedropout_help'] = 'This target describes whether the student is considered at risk of dropping out.';",
          "1979: $string['target:noteachingactivity'] = 'No teaching';",
          "1980: $string['target:noteachingactivity_help'] = 'This target describes whether courses due to start in the coming week will have teaching activity.';",
          "1981: $string['targetlabelstudentcompletionno'] = 'Student who is likely to meet the course completion conditions';",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1979: $string['target:coursegradetopass'] = 'Students at risk of not getting the minimum grade to pass the course.';",
          "1980: $string['target:coursegradetopass_help'] = 'This target describes whether the student is at risk of not getting the minimum grade to pass the course.';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1984: $string['targetlabelstudentcompetenciesyes'] = 'Student at risk of not achieving the competencies assigned to a course';",
          "1985: $string['targetlabelstudentdropoutyes'] = 'Student at risk of dropping out';",
          "1986: $string['targetlabelstudentdropoutno'] = 'Not at risk';",
          "1987: $string['targetlabelteachingyes'] = 'Users with teaching capabilities have access to the course';",
          "1988: $string['targetlabelteachingno'] = 'No teaching';",
          "1989: $string['targetrole'] = 'Target role';",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1989: $string['targetlabelstudentgradetopassno'] = 'Student who is likely to meet the minimum grade to pass the course.';",
          "1990: $string['targetlabelstudentgradetopassyes'] = 'Student at risk of not meeting the minimum grade to pass the course.';",
          "",
          "---------------"
        ],
        "lib/classes/analytics/target/course_gradetopass.php||lib/classes/analytics/target/course_gradetopass.php": [
          "File: lib/classes/analytics/target/course_gradetopass.php -> lib/classes/analytics/target/course_gradetopass.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: <?php",
          "25: namespace core\\analytics\\target;",
          "27: defined('MOODLE_INTERNAL') || die();",
          "37: class course_gradetopass extends \\core\\analytics\\target\\course_enrolments {",
          "43:     protected $coursesgradetopass = array();",
          "49:     protected $coursesgrades = array();",
          "59:     protected function get_course_gradetopass($courseid) {",
          "60:         if (!isset($this->coursesgradetopass[$courseid])) {",
          "62:             $courseitem = \\grade_item::fetch_course_item($courseid);",
          "64:             $ci = array();",
          "65:             $ci['courseitemid'] = $courseitem->id;",
          "67:             if ($courseitem->gradetype == GRADE_TYPE_VALUE && grade_floats_different($courseitem->gradepass, 0.0)) {",
          "68:                 $ci['gradetopass'] = $courseitem->gradepass;",
          "69:             } else {",
          "70:                 $ci['gradetopass'] = null;",
          "71:             }",
          "72:             $this->coursesgradetopass[$courseid] = $ci;",
          "73:         }",
          "75:         return $this->coursesgradetopass[$courseid];",
          "76:     }",
          "87:     protected function get_user_grade($courseitemid, $userid) {",
          "89:         if (!isset($this->coursesgrades[$courseitemid])) {",
          "91:             unset($this->coursesgrades);",
          "92:             $gg = new \\grade_grade(null, false);",
          "93:             $usersgrades = $gg->fetch_all(array('itemid' => $courseitemid));",
          "95:             if ($usersgrades) {",
          "96:                 foreach ($usersgrades as $ug) {",
          "97:                     $this->coursesgrades[$courseitemid][$ug->userid] = $ug->finalgrade;",
          "98:                 }",
          "99:             }",
          "100:         }",
          "102:         if (!isset($this->coursesgrades[$courseitemid][$userid])) {",
          "103:             $this->coursesgrades[$courseitemid][$userid] = null;",
          "104:         }",
          "106:         return $this->coursesgrades[$courseitemid][$userid];",
          "107:     }",
          "116:     public static function get_name() : \\lang_string {",
          "117:         return new \\lang_string('target:coursegradetopass');",
          "118:     }",
          "125:     protected static function classes_description() {",
          "126:         return array(",
          "127:             get_string('targetlabelstudentgradetopassno'),",
          "128:             get_string('targetlabelstudentgradetopassyes')",
          "129:         );",
          "130:     }",
          "141:     public function is_valid_analysable(\\core_analytics\\analysable $course, $fortraining = true) {",
          "142:         $isvalid = parent::is_valid_analysable($course, $fortraining);",
          "144:         if (is_string($isvalid)) {",
          "145:             return $isvalid;",
          "146:         }",
          "148:         $courseitem = $this->get_course_gradetopass ($course->get_id());",
          "149:         if (is_null($courseitem['gradetopass'])) {",
          "150:             return get_string('gradetopassnotset', 'course');",
          "151:         }",
          "153:         return true;",
          "154:     }",
          "165:     protected function calculate_sample($sampleid, \\core_analytics\\analysable $course, $starttime = false, $endtime = false) {",
          "167:         $userenrol = $this->retrieve('user_enrolments', $sampleid);",
          "170:         $courseitem = $this->get_course_gradetopass($course->get_id());",
          "173:         $usergrade = $this->get_user_grade($courseitem['courseitemid'], $userenrol->userid);",
          "175:         if ($usergrade >= $courseitem['gradetopass']) {",
          "176:             return 0;",
          "177:         }",
          "179:         return 1;",
          "180:     }",
          "181: }",
          "",
          "---------------"
        ],
        "lib/tests/targets_test.php||lib/tests/targets_test.php": [
          "File: lib/tests/targets_test.php -> lib/tests/targets_test.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "29: require_once($CFG->dirroot . '/completion/criteria/completion_criteria.php');",
          "30: require_once($CFG->dirroot . '/completion/criteria/completion_criteria_activity.php');",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "31: require_once($CFG->dirroot . '/lib/grade/grade_item.php');",
          "32: require_once($CFG->dirroot . '/lib/grade/grade_grade.php');",
          "33: require_once($CFG->dirroot . '/lib/grade/grade_category.php');",
          "34: require_once($CFG->dirroot . '/lib/grade/constants.php');",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "342:         $this->assertEquals(0, $method->invoke($target, $sampleid, $analysable));",
          "343:     }",
          "344: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "352:     public function test_core_target_course_gradetopass_analysable() {",
          "353:         global $DB;",
          "355:         $this->resetAfterTest(true);",
          "356:         $now = time();",
          "358:         $dg = $this->getDataGenerator();",
          "361:         $course1 = $dg->create_course(array('startdate' => $now - WEEKSECS, 'enddate' => $now - DAYSECS));",
          "362:         $student1 = $dg->create_user();",
          "363:         $studentrole = $DB->get_record('role', array('shortname' => 'student'));",
          "364:         $dg->enrol_user($student1->id, $course1->id, $studentrole->id);",
          "366:         $analysable = new \\core_analytics\\course($course1);",
          "367:         $target = new \\core\\analytics\\target\\course_gradetopass();",
          "368:         $this->assertEquals(get_string('gradetopassnotset', 'course'), $target->is_valid_analysable($analysable));",
          "371:         $courseitem = grade_item::fetch_course_item($course1->id);",
          "372:         $courseitem->gradepass = 50;",
          "373:         $DB->update_record('grade_items', $courseitem);",
          "375:         $target = new \\core\\analytics\\target\\course_gradetopass();",
          "376:         $this->assertTrue($target->is_valid_analysable($analysable));",
          "378:     }",
          "383:     public function test_core_target_course_gradetopass_calculate() {",
          "384:         global $DB;",
          "386:         $this->resetAfterTest(true);",
          "388:         $dg = $this->getDataGenerator();",
          "389:         $course1 = $dg->create_course();",
          "391:         $student1 = $dg->create_user();",
          "392:         $student2 = $dg->create_user();",
          "393:         $student3 = $dg->create_user();",
          "394:         $studentrole = $DB->get_record('role', array('shortname' => 'student'));",
          "395:         $dg->enrol_user($student1->id, $course1->id, $studentrole->id);",
          "396:         $dg->enrol_user($student2->id, $course1->id, $studentrole->id);",
          "397:         $dg->enrol_user($student3->id, $course1->id, $studentrole->id);",
          "399:         $courseitem = grade_item::fetch_course_item($course1->id);",
          "401:         $courseitem->update_final_grade($student1->id, 30);",
          "403:         $courseitem->update_final_grade($student2->id, 60);",
          "406:         $courseitem->gradepass = 50;",
          "407:         $DB->update_record('grade_items', $courseitem);",
          "409:         $target = new \\core\\analytics\\target\\course_gradetopass();",
          "410:         $analyser = new \\core\\analytics\\analyser\\student_enrolments(1, $target, [], [], []);",
          "411:         $analysable = new \\core_analytics\\course($course1);",
          "413:         $class = new ReflectionClass('\\core\\analytics\\analyser\\student_enrolments');",
          "414:         $method = $class->getMethod('get_all_samples');",
          "415:         $method->setAccessible(true);",
          "417:         list($sampleids, $samplesdata) = $method->invoke($analyser, $analysable);",
          "418:         $target->add_sample_data($samplesdata);",
          "421:         $sampleid = reset($sampleids);",
          "423:         $class = new ReflectionClass('\\core\\analytics\\target\\course_gradetopass');",
          "424:         $method = $class->getMethod('calculate_sample');",
          "425:         $method->setAccessible(true);",
          "428:         $this->assertEquals(1, $method->invoke($target, $sampleid, $analysable));",
          "431:         $sampleid = next($sampleids);",
          "434:         $this->assertEquals(0, $method->invoke($target, $sampleid, $analysable));",
          "437:         $sampleid = next($sampleids);",
          "440:         $this->assertEquals(1, $method->invoke($target, $sampleid, $analysable));",
          "441:     }",
          "",
          "---------------"
        ],
        "version.php||version.php": [
          "File: version.php -> version.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "30: defined('MOODLE_INTERNAL') || die();",
          "",
          "[Removed Lines]",
          "32: $version  = 2019040600.00;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "",
          "[Added Lines]",
          "32: $version  = 2019040600.01;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "d31b5c431d3397dcddfe83f5fa3df05e878e8f54",
      "candidate_info": {
        "commit_hash": "d31b5c431d3397dcddfe83f5fa3df05e878e8f54",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/d31b5c431d3397dcddfe83f5fa3df05e878e8f54",
        "files": [
          "backup/cc/cc2moodle.php",
          "blocks/participants/block_participants.php",
          "blocks/participants/classes/privacy/provider.php",
          "blocks/participants/db/access.php",
          "blocks/participants/lang/en/block_participants.php",
          "blocks/participants/tests/behat/block_participants_course.feature",
          "blocks/participants/tests/behat/block_participants_frontpage.feature",
          "blocks/participants/version.php",
          "blocks/tests/externallib_test.php",
          "blocks/upgrade.txt",
          "config-dist.php",
          "lib/classes/plugin_manager.php",
          "lib/db/upgrade.php",
          "version.php"
        ],
        "message": "Merge branch 'MDL-66753-master' of git://github.com/abias/moodle",
        "before_after_code_files": [
          "backup/cc/cc2moodle.php||backup/cc/cc2moodle.php",
          "blocks/participants/block_participants.php||blocks/participants/block_participants.php",
          "blocks/participants/classes/privacy/provider.php||blocks/participants/classes/privacy/provider.php",
          "blocks/participants/db/access.php||blocks/participants/db/access.php",
          "blocks/participants/lang/en/block_participants.php||blocks/participants/lang/en/block_participants.php",
          "blocks/participants/tests/behat/block_participants_course.feature||blocks/participants/tests/behat/block_participants_course.feature",
          "blocks/participants/tests/behat/block_participants_frontpage.feature||blocks/participants/tests/behat/block_participants_frontpage.feature",
          "blocks/participants/version.php||blocks/participants/version.php",
          "blocks/tests/externallib_test.php||blocks/tests/externallib_test.php",
          "config-dist.php||config-dist.php",
          "lib/classes/plugin_manager.php||lib/classes/plugin_manager.php",
          "lib/db/upgrade.php||lib/db/upgrade.php",
          "version.php||version.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.php||version.php"
          ],
          "candidate": [
            "version.php||version.php"
          ]
        }
      },
      "candidate_diff": {
        "backup/cc/cc2moodle.php||backup/cc/cc2moodle.php": [
          "File: backup/cc/cc2moodle.php -> backup/cc/cc2moodle.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "384:             if (isset($CFG->defaultblocks)) {",
          "385:                 $blocknames = $CFG->defaultblocks;",
          "386:             } else {",
          "388:             }",
          "389:         }",
          "",
          "[Removed Lines]",
          "387:                 $blocknames = 'participants,activity_modules,search_forums,course_list:news_items,calendar_upcoming,recent_activity';",
          "",
          "[Added Lines]",
          "387:                 $blocknames = 'activity_modules,search_forums,course_list:news_items,calendar_upcoming,recent_activity';",
          "",
          "---------------"
        ],
        "blocks/participants/block_participants.php||blocks/participants/block_participants.php": [
          "File: blocks/participants/block_participants.php -> blocks/participants/block_participants.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "blocks/participants/classes/privacy/provider.php||blocks/participants/classes/privacy/provider.php": [
          "File: blocks/participants/classes/privacy/provider.php -> blocks/participants/classes/privacy/provider.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "blocks/participants/db/access.php||blocks/participants/db/access.php": [
          "File: blocks/participants/db/access.php -> blocks/participants/db/access.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "blocks/participants/lang/en/block_participants.php||blocks/participants/lang/en/block_participants.php": [
          "File: blocks/participants/lang/en/block_participants.php -> blocks/participants/lang/en/block_participants.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "blocks/participants/tests/behat/block_participants_course.feature||blocks/participants/tests/behat/block_participants_course.feature": [
          "File: blocks/participants/tests/behat/block_participants_course.feature -> blocks/participants/tests/behat/block_participants_course.feature",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "blocks/participants/tests/behat/block_participants_frontpage.feature||blocks/participants/tests/behat/block_participants_frontpage.feature": [
          "File: blocks/participants/tests/behat/block_participants_frontpage.feature -> blocks/participants/tests/behat/block_participants_frontpage.feature",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "blocks/participants/version.php||blocks/participants/version.php": [
          "File: blocks/participants/version.php -> blocks/participants/version.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "blocks/tests/externallib_test.php||blocks/tests/externallib_test.php": [
          "File: blocks/tests/externallib_test.php -> blocks/tests/externallib_test.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "113:         $this->resetAfterTest(true);",
          "117:         $user = $this->getDataGenerator()->create_user();",
          "118:         $course = $this->getDataGenerator()->create_course();",
          "",
          "[Removed Lines]",
          "115:         $CFG->defaultblocks_override = 'participants,search_forums,course_list:calendar_upcoming,recent_activity';",
          "",
          "[Added Lines]",
          "115:         $CFG->defaultblocks_override = 'search_forums,course_list:calendar_upcoming,recent_activity';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "127:         $result = external_api::clean_returnvalue(core_block_external::get_course_blocks_returns(), $result);",
          "133:                                 'calendar_upcoming', 'recent_activity');",
          "134:         foreach ($result['blocks'] as $block) {",
          "135:             if (!in_array($block['name'], $expectedblocks)) {",
          "",
          "[Removed Lines]",
          "130:         $this->assertCount(5, $result['blocks']);",
          "132:         $expectedblocks = array('navigation', 'settings', 'participants', 'search_forums', 'course_list',",
          "",
          "[Added Lines]",
          "130:         $this->assertCount(4, $result['blocks']);",
          "132:         $expectedblocks = array('navigation', 'settings', 'search_forums', 'course_list',",
          "",
          "---------------"
        ],
        "config-dist.php||config-dist.php": [
          "File: config-dist.php -> config-dist.php"
        ],
        "lib/classes/plugin_manager.php||lib/classes/plugin_manager.php": [
          "File: lib/classes/plugin_manager.php -> lib/classes/plugin_manager.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "1647:         $plugins = array(",
          "1648:             'qformat' => array('blackboard', 'learnwise'),",
          "1649:             'auth' => array('radius', 'fc', 'nntp', 'pam', 'pop3', 'imap'),",
          "1651:             'cachestore' => array('memcache'),",
          "1652:             'enrol' => array('authorize'),",
          "1653:             'report' => array('search'),",
          "",
          "[Removed Lines]",
          "1650:             'block' => array('course_overview', 'messages', 'community'),",
          "",
          "[Added Lines]",
          "1650:             'block' => array('course_overview', 'messages', 'community', 'participants'),",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1718:                 'completionstatus', 'course_list', 'course_summary',",
          "1719:                 'feedback', 'globalsearch', 'glossary_random', 'html',",
          "1720:                 'login', 'lp', 'mentees', 'mnet_hosts', 'myoverview', 'myprofile',",
          "1722:                 'private_files', 'quiz_results', 'recent_activity', 'recentlyaccesseditems',",
          "1723:                 'recentlyaccessedcourses', 'rss_client', 'search_forums', 'section_links',",
          "1724:                 'selfcompletion', 'settings', 'site_main_menu',",
          "",
          "[Removed Lines]",
          "1721:                 'navigation', 'news_items', 'online_users', 'participants',",
          "",
          "[Added Lines]",
          "1721:                 'navigation', 'news_items', 'online_users',",
          "",
          "---------------"
        ],
        "lib/db/upgrade.php||lib/db/upgrade.php": [
          "File: lib/db/upgrade.php -> lib/db/upgrade.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "3574:         upgrade_main_savepoint(true, 2019100800.02);",
          "3575:     }",
          "3577:     return true;",
          "3578: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3577:     if ($oldversion < 2019100900.00) {",
          "3579:         if (!file_exists($CFG->dirroot . '/blocks/participants/block_participants.php')) {",
          "3581:             $instances = $DB->get_records_list('block_instances', 'blockname', ['participants']);",
          "3582:             $instanceids = array_keys($instances);",
          "3584:             if (!empty($instanceids)) {",
          "3585:                 $DB->delete_records_list('block_positions', 'blockinstanceid', $instanceids);",
          "3586:                 $DB->delete_records_list('block_instances', 'id', $instanceids);",
          "3587:                 list($sql, $params) = $DB->get_in_or_equal($instanceids, SQL_PARAMS_NAMED);",
          "3588:                 $params['contextlevel'] = CONTEXT_BLOCK;",
          "3589:                 $DB->delete_records_select('context', \"contextlevel=:contextlevel AND instanceid \" . $sql, $params);",
          "3591:                 $preferences = array();",
          "3592:                 foreach ($instances as $instanceid => $instance) {",
          "3593:                     $preferences[] = 'block' . $instanceid . 'hidden';",
          "3594:                     $preferences[] = 'docked_block_instance_' . $instanceid;",
          "3595:                 }",
          "3596:                 $DB->delete_records_list('user_preferences', 'name', $preferences);",
          "3597:             }",
          "3600:             $DB->delete_records('block', array('name' => 'participants'));",
          "3603:             capabilities_cleanup('block_participants');",
          "3606:             unset_all_config_for_plugin('block_participants');",
          "3607:         }",
          "3609:         upgrade_main_savepoint(true, 2019100900.00);",
          "3610:     }",
          "",
          "---------------"
        ],
        "version.php||version.php": [
          "File: version.php -> version.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "30: defined('MOODLE_INTERNAL') || die();",
          "",
          "[Removed Lines]",
          "32: $version  = 2019100800.02;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "",
          "[Added Lines]",
          "32: $version  = 2019100900.00;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "b7c307f33d1f1eba6568aab7484d3f0c07e9b6b4",
      "candidate_info": {
        "commit_hash": "b7c307f33d1f1eba6568aab7484d3f0c07e9b6b4",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/b7c307f33d1f1eba6568aab7484d3f0c07e9b6b4",
        "files": [
          "h5p/classes/core.php",
          "h5p/classes/framework.php",
          "h5p/tests/generator/lib.php",
          "h5p/tests/generator_test.php",
          "h5p/tests/h5p_core_test.php",
          "lib/db/install.xml",
          "lib/db/upgrade.php",
          "version.php"
        ],
        "message": "MDL-67194 core_h5p: save core API version that content types require",
        "before_after_code_files": [
          "h5p/classes/core.php||h5p/classes/core.php",
          "h5p/classes/framework.php||h5p/classes/framework.php",
          "h5p/tests/generator/lib.php||h5p/tests/generator/lib.php",
          "h5p/tests/generator_test.php||h5p/tests/generator_test.php",
          "h5p/tests/h5p_core_test.php||h5p/tests/h5p_core_test.php",
          "lib/db/upgrade.php||lib/db/upgrade.php",
          "version.php||version.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.php||version.php"
          ],
          "candidate": [
            "version.php||version.php"
          ]
        }
      },
      "candidate_diff": {
        "h5p/classes/core.php||h5p/classes/core.php": [
          "File: h5p/classes/core.php -> h5p/classes/core.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "171:         $typesinstalled = [];",
          "173:         foreach ($contenttypes->contentTypes as $type) {",
          "174:             $library = [",
          "175:                 'machineName' => $type->id,",
          "176:                 'majorVersion' => $type->version->major,",
          "177:                 'minorVersion' => $type->version->minor,",
          "179:             ];",
          "181:             $factory = new \\core_h5p\\factory();",
          "",
          "[Removed Lines]",
          "178:                 'patchVersion' => $type->version->patch,",
          "",
          "[Added Lines]",
          "175:             if (!$this->is_required_core_api($type->coreApiVersionNeeded)) {",
          "176:                 continue;",
          "177:             }",
          "183:                 'patchVersion' => $type->version->patch",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "285:         return $contenttypes;",
          "286:     }",
          "287: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "299:     public function is_required_core_api($coreapi): bool {",
          "300:         if (isset($coreapi) && !empty($coreapi)) {",
          "301:             if (($coreapi->major > H5PCore::$coreApi['majorVersion']) ||",
          "302:                 (($coreapi->major == H5PCore::$coreApi['majorVersion']) && ($coreapi->minor > H5PCore::$coreApi['minorVersion']))) {",
          "303:                 return false;",
          "304:             }",
          "305:         }",
          "306:         return true;",
          "307:     }",
          "",
          "---------------"
        ],
        "h5p/classes/framework.php||h5p/classes/framework.php": [
          "File: h5p/classes/framework.php -> h5p/classes/framework.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "720:             'droplibrarycss' => $droplibrarycss,",
          "721:             'semantics' => $librarydata['semantics'],",
          "722:             'addto' => isset($librarydata['addTo']) ? json_encode($librarydata['addTo']) : null,",
          "723:         );",
          "725:         if ($new) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "723:             'coremajor' => isset($librarydata['coreApi']['majorVersion']) ? $librarydata['coreApi']['majorVersion'] : null,",
          "724:             'coreminor' => isset($librarydata['coreApi']['majorVersion']) ? $librarydata['coreApi']['minorVersion'] : null,",
          "",
          "---------------"
        ],
        "h5p/tests/generator/lib.php||h5p/tests/generator/lib.php": [
          "File: h5p/tests/generator/lib.php -> h5p/tests/generator/lib.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "372:                 'majorversion' => $contenttype->version->major,",
          "373:                 'minorversion' => $contenttype->version->minor,",
          "374:                 'patchversion' => $contenttype->version->patch,",
          "376:             ];",
          "377:             $DB->insert_record('h5p_libraries', (object) $library);",
          "378:         }",
          "",
          "[Removed Lines]",
          "375:                 'runnable' => 1",
          "",
          "[Added Lines]",
          "375:                 'runnable' => 1,",
          "376:                 'coremajor' => $contenttype->coreApiVersionNeeded->major,",
          "377:                 'coreminor' => $contenttype->coreApiVersionNeeded->minor",
          "",
          "---------------"
        ],
        "h5p/tests/generator_test.php||h5p/tests/generator_test.php": [
          "File: h5p/tests/generator_test.php -> h5p/tests/generator_test.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "231:             'preloadedcss' => 'css/example.css',",
          "232:             'droplibrarycss' => '',",
          "233:             'semantics' => 'Semantics example',",
          "235:         ];",
          "237:         $this->assertEquals($expected, $data);",
          "",
          "[Removed Lines]",
          "234:             'addto' => '/regex11/'",
          "",
          "[Added Lines]",
          "234:             'addto' => '/regex11/',",
          "235:             'coremajor' => null,",
          "236:             'coreminor' => null,",
          "",
          "---------------"
        ],
        "h5p/tests/h5p_core_test.php||h5p/tests/h5p_core_test.php": [
          "File: h5p/tests/h5p_core_test.php -> h5p/tests/h5p_core_test.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "60:             $this->markTestSkipped('PHPUNIT_LONGTEST is not defined');",
          "61:         }",
          "63:         $library = [",
          "68:         ];",
          "79:         $this->core->fetch_content_type($library);",
          "83:     }",
          "",
          "[Removed Lines]",
          "64:                 'machineName' => 'H5P.Accordion',",
          "65:                 'majorVersion' => 1,",
          "66:                 'minorVersion' => 0,",
          "67:                 'patchVersion' => 0,",
          "70:         $sql = 'SELECT count(id)",
          "71:                   FROM {files}",
          "72:                  WHERE ' . $DB->sql_like('filepath', ':filepath');",
          "73:         $params['filepath'] = \"/{$library['machineName']}-%\";",
          "75:         $contentfiles = $DB->count_records_sql($sql, $params);",
          "77:         $this->assertEquals(0, $contentfiles);",
          "81:         $contentfiles = $DB->count_records_sql($sql, $params);",
          "82:         $this->assertGreaterThan(0, $contentfiles);",
          "",
          "[Added Lines]",
          "64:         $contenttypes = $this->core->get_latest_content_types()->contentTypes;",
          "66:         $librarydata = $contenttypes[0];",
          "69:                 'machineName' => $librarydata->id,",
          "70:                 'majorVersion' => $librarydata->version->major,",
          "71:                 'minorVersion' => $librarydata->version->minor,",
          "72:                 'patchVersion' => $librarydata->version->patch,",
          "76:         $conditions['machinename'] = $library['machineName'];",
          "77:         $typeinstalled = $DB->count_records('h5p_libraries', $conditions);",
          "79:         $this->assertEquals(0, $typeinstalled);",
          "85:         $typeinstalled = $DB->get_record('h5p_libraries', $conditions);",
          "86:         $this->assertEquals($librarydata->id, $typeinstalled->machinename);",
          "87:         $this->assertEquals($librarydata->coreApiVersionNeeded->major, $typeinstalled->coremajor);",
          "88:         $this->assertEquals($librarydata->coreApiVersionNeeded->minor, $typeinstalled->coreminor);",
          "",
          "---------------"
        ],
        "lib/db/upgrade.php||lib/db/upgrade.php": [
          "File: lib/db/upgrade.php -> lib/db/upgrade.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "3763:         upgrade_main_savepoint(true, 2019103000.13);",
          "3764:     }",
          "3766:     return true;",
          "3767: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3766:     if ($oldversion < 2019110800.01) {",
          "3769:         $table = new xmldb_table('h5p_libraries');",
          "3770:         $field = new xmldb_field('coremajor', XMLDB_TYPE_INTEGER, '4', null, null, null, null, 'addto');",
          "3773:         if (!$dbman->field_exists($table, $field)) {",
          "3774:             $dbman->add_field($table, $field);",
          "3775:         }",
          "3777:         $field = new xmldb_field('coreminor', XMLDB_TYPE_INTEGER, '4', null, null, null, null, 'coremajor');",
          "3780:         if (!$dbman->field_exists($table, $field)) {",
          "3781:             $dbman->add_field($table, $field);",
          "3782:         }",
          "3785:         upgrade_main_savepoint(true, 2019110800.01);",
          "3786:     }",
          "",
          "---------------"
        ],
        "version.php||version.php": [
          "File: version.php -> version.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "30: defined('MOODLE_INTERNAL') || die();",
          "",
          "[Removed Lines]",
          "32: $version  = 2019110800.00;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "",
          "[Added Lines]",
          "32: $version  = 2019110800.01;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "645beae25f39d50a4111ee74acf29ff80632391d",
      "candidate_info": {
        "commit_hash": "645beae25f39d50a4111ee74acf29ff80632391d",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/645beae25f39d50a4111ee74acf29ff80632391d",
        "files": [
          "admin/settings/subsystems.php",
          "backup/util/checks/backup_check.class.php",
          "backup/util/checks/restore_check.class.php",
          "course/lib.php",
          "course/publish/backup.php",
          "course/publish/forms.php",
          "course/publish/hubselector.php",
          "course/publish/index.php",
          "course/publish/lib.php",
          "course/publish/metadata.php",
          "course/tests/courselib_test.php",
          "course/tests/externallib_test.php",
          "lib/db/access.php",
          "lib/db/upgrade.php",
          "lib/navigationlib.php",
          "version.php"
        ],
        "message": "MDL-66072 core: Remove course sharing and related capabilities",
        "before_after_code_files": [
          "admin/settings/subsystems.php||admin/settings/subsystems.php",
          "backup/util/checks/backup_check.class.php||backup/util/checks/backup_check.class.php",
          "backup/util/checks/restore_check.class.php||backup/util/checks/restore_check.class.php",
          "course/lib.php||course/lib.php",
          "course/publish/backup.php||course/publish/backup.php",
          "course/publish/forms.php||course/publish/forms.php",
          "course/publish/hubselector.php||course/publish/hubselector.php",
          "course/publish/index.php||course/publish/index.php",
          "course/publish/lib.php||course/publish/lib.php",
          "course/publish/metadata.php||course/publish/metadata.php",
          "course/tests/courselib_test.php||course/tests/courselib_test.php",
          "course/tests/externallib_test.php||course/tests/externallib_test.php",
          "lib/db/access.php||lib/db/access.php",
          "lib/db/upgrade.php||lib/db/upgrade.php",
          "lib/navigationlib.php||lib/navigationlib.php",
          "version.php||version.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "lib/db/access.php||lib/db/access.php",
            "version.php||version.php"
          ],
          "candidate": [
            "lib/db/access.php||lib/db/access.php",
            "version.php||version.php"
          ]
        }
      },
      "candidate_diff": {
        "admin/settings/subsystems.php||admin/settings/subsystems.php": [
          "File: admin/settings/subsystems.php -> admin/settings/subsystems.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "49:     $optionalsubsystems->add(new admin_setting_configcheckbox('allowstealth', new lang_string('allowstealthmodules'),",
          "50:         new lang_string('allowstealthmodules_help'), 0, 1, 0));",
          "54: }",
          "",
          "[Removed Lines]",
          "52:     $optionalsubsystems->add(new admin_setting_configcheckbox('enablecoursepublishing',",
          "53:         new lang_string('enablecoursepublishing', 'hub'), new lang_string('enablecoursepublishing_help', 'hub'), 0));",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "backup/util/checks/backup_check.class.php||backup/util/checks/backup_check.class.php": [
          "File: backup/util/checks/backup_check.class.php -> backup/util/checks/backup_check.class.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "130:         switch ($mode) {",
          "140:             case backup::MODE_IMPORT:",
          "141:                 if (!has_capability('moodle/backup:backuptargetimport', $coursectx, $userid)) {",
          "142:                     $a = new stdclass();",
          "",
          "[Removed Lines]",
          "131:             case backup::MODE_HUB:",
          "132:                 if (!has_capability('moodle/backup:backuptargethub', $coursectx, $userid)) {",
          "133:                     $a = new stdclass();",
          "134:                     $a->userid = $userid;",
          "135:                     $a->courseid = $courseid;",
          "136:                     $a->capability = 'moodle/backup:backuptargethub';",
          "137:                     throw new backup_controller_exception('backup_user_missing_capability', $a);",
          "138:                 }",
          "139:                 break;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "backup/util/checks/restore_check.class.php||backup/util/checks/restore_check.class.php": [
          "File: backup/util/checks/restore_check.class.php -> backup/util/checks/restore_check.class.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "92:         switch ($mode) {",
          "102:             case backup::MODE_IMPORT:",
          "103:                 if (!has_capability('moodle/restore:restoretargetimport', $coursectx, $userid)) {",
          "104:                     $a = new stdclass();",
          "",
          "[Removed Lines]",
          "93:             case backup::MODE_HUB:",
          "94:                 if (!has_capability('moodle/restore:restoretargethub', $coursectx, $userid)) {",
          "95:                     $a = new stdclass();",
          "96:                     $a->userid = $userid;",
          "97:                     $a->courseid = $courseid;",
          "98:                     $a->capability = 'moodle/restore:restoretargethub';",
          "99:                     throw new restore_controller_exception('restore_user_missing_capability', $a);",
          "100:                 }",
          "101:                 break;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "course/lib.php||course/lib.php": [
          "File: course/lib.php -> course/lib.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "4014:         $options->outcomes = !empty($CFG->enableoutcomes) && has_capability('moodle/course:update', $context);",
          "4015:         $options->badges = !empty($CFG->enablebadges);",
          "4016:         $options->import = has_capability('moodle/restore:restoretargetimport', $context);",
          "4018:         $options->reset = has_capability('moodle/course:reset', $context);",
          "4019:         $options->roles = has_capability('moodle/role:switchroles', $context);",
          "4020:     } else {",
          "",
          "[Removed Lines]",
          "4017:         $options->publish = !empty($CFG->enablecoursepublishing) && has_capability('moodle/course:publish', $context);",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "course/publish/backup.php||course/publish/backup.php": [
          "File: course/publish/backup.php -> course/publish/backup.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "course/publish/forms.php||course/publish/forms.php": [
          "File: course/publish/forms.php -> course/publish/forms.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "course/publish/hubselector.php||course/publish/hubselector.php": [
          "File: course/publish/hubselector.php -> course/publish/hubselector.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "course/publish/index.php||course/publish/index.php": [
          "File: course/publish/index.php -> course/publish/index.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "course/publish/lib.php||course/publish/lib.php": [
          "File: course/publish/lib.php -> course/publish/lib.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "course/publish/metadata.php||course/publish/metadata.php": [
          "File: course/publish/metadata.php -> course/publish/metadata.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "course/tests/courselib_test.php||course/tests/courselib_test.php": [
          "File: course/tests/courselib_test.php -> course/tests/courselib_test.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "3193:         $this->assertFalse($adminoptions->outcomes);",
          "3194:         $this->assertTrue($adminoptions->badges);",
          "3195:         $this->assertTrue($adminoptions->import);",
          "3197:         $this->assertTrue($adminoptions->reset);",
          "3198:         $this->assertTrue($adminoptions->roles);",
          "3199:     }",
          "",
          "[Removed Lines]",
          "3196:         $this->assertFalse($adminoptions->publish);",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "3225:         $this->assertFalse($adminoptions->outcomes);",
          "3226:         $this->assertTrue($adminoptions->badges);",
          "3227:         $this->assertFalse($adminoptions->import);",
          "3229:         $this->assertFalse($adminoptions->reset);",
          "3230:         $this->assertFalse($adminoptions->roles);",
          "",
          "[Removed Lines]",
          "3228:         $this->assertFalse($adminoptions->publish);",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "course/tests/externallib_test.php||course/tests/externallib_test.php": [
          "File: course/tests/externallib_test.php -> course/tests/externallib_test.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "2334:                 $this->assertFalse($adminoptions->outcomes);",
          "2335:                 $this->assertFalse($adminoptions->badges);",
          "2336:                 $this->assertFalse($adminoptions->import);",
          "2338:                 $this->assertFalse($adminoptions->reset);",
          "2339:                 $this->assertFalse($adminoptions->roles);",
          "2340:                 $this->assertFalse($adminoptions->editcompletion);",
          "2341:             } else {",
          "2343:                 $this->assertFalse($adminoptions->update);",
          "2344:                 $this->assertFalse($adminoptions->filters);",
          "2345:                 $this->assertFalse($adminoptions->reports);",
          "",
          "[Removed Lines]",
          "2337:                 $this->assertFalse($adminoptions->publish);",
          "2342:                 $this->assertCount(15, $course['options']);",
          "",
          "[Added Lines]",
          "2341:                 $this->assertCount(14, $course['options']);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2351:                 $this->assertFalse($adminoptions->outcomes);",
          "2352:                 $this->assertTrue($adminoptions->badges);",
          "2353:                 $this->assertFalse($adminoptions->import);",
          "2355:                 $this->assertFalse($adminoptions->reset);",
          "2356:                 $this->assertFalse($adminoptions->roles);",
          "2357:                 $this->assertFalse($adminoptions->editcompletion);",
          "",
          "[Removed Lines]",
          "2354:                 $this->assertFalse($adminoptions->publish);",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "lib/db/access.php||lib/db/access.php": [
          "File: lib/db/access.php -> lib/db/access.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "181:         'clonepermissionsfrom' =>  'moodle/backup:backupcourse'",
          "182:     ),",
          "198:     'moodle/backup:backuptargetimport' => array(",
          "200:         'riskbitmask' => RISK_SPAM | RISK_PERSONAL | RISK_XSS,",
          "",
          "[Removed Lines]",
          "184:     'moodle/backup:backuptargethub' => array(",
          "186:         'riskbitmask' => RISK_SPAM | RISK_PERSONAL | RISK_XSS,",
          "188:         'captype' => 'write',",
          "189:         'contextlevel' => CONTEXT_COURSE,",
          "190:         'archetypes' => array(",
          "191:             'editingteacher' => CAP_ALLOW,",
          "192:             'manager' => CAP_ALLOW",
          "193:         ),",
          "195:         'clonepermissionsfrom' =>  'moodle/backup:backupcourse'",
          "196:     ),",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "311:         ),",
          "312:     ),",
          "328:     'moodle/restore:restoretargetimport' => array(",
          "330:         'riskbitmask' => RISK_SPAM | RISK_PERSONAL | RISK_XSS,",
          "",
          "[Removed Lines]",
          "314:     'moodle/restore:restoretargethub' => array(",
          "316:         'riskbitmask' => RISK_SPAM | RISK_PERSONAL | RISK_XSS,",
          "318:         'captype' => 'write',",
          "319:         'contextlevel' => CONTEXT_COURSE,",
          "320:         'archetypes' => array(",
          "321:             'editingteacher' => CAP_ALLOW,",
          "322:             'manager' => CAP_ALLOW",
          "323:         ),",
          "325:         'clonepermissionsfrom' =>  'moodle/restore:restorecourse'",
          "326:     ),",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1987:             'editingteacher' => CAP_ALLOW,",
          "1988:             'manager' => CAP_ALLOW",
          "1989:         )",
          "1999:     ),",
          "2000:     'moodle/course:markcomplete' => array(",
          "2001:         'captype' => 'write',",
          "",
          "[Removed Lines]",
          "1990:     ),",
          "1991:      'moodle/course:publish' => array(",
          "1993:         'captype' => 'write',",
          "1994:         'riskbitmask' => RISK_SPAM | RISK_PERSONAL,",
          "1995:         'contextlevel' => CONTEXT_SYSTEM,",
          "1996:         'archetypes' => array(",
          "1997:             'manager' => CAP_ALLOW",
          "1998:         )",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "lib/db/upgrade.php||lib/db/upgrade.php": [
          "File: lib/db/upgrade.php -> lib/db/upgrade.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "3390:         upgrade_main_savepoint(true, 2019052001.04);",
          "3391:     }",
          "3393:     return true;",
          "3394: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3393:     if ($oldversion < 2019052001.12) {",
          "3395:         unset_config('enablecoursepublishing');",
          "3396:         upgrade_main_savepoint(true, 2019052001.12);",
          "3397:     }",
          "",
          "---------------"
        ],
        "lib/navigationlib.php||lib/navigationlib.php": [
          "File: lib/navigationlib.php -> lib/navigationlib.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "4530:             $coursenode->add(get_string('import'), $url, self::TYPE_SETTING, null, 'import', new pix_icon('i/import', ''));",
          "4531:         }",
          "4541:         if ($adminoptions->reset) {",
          "4542:             $url = new moodle_url('/course/reset.php', array('id'=>$course->id));",
          "",
          "[Removed Lines]",
          "4534:         if ($adminoptions->publish) {",
          "4535:             $url = new moodle_url('/course/publish/index.php', array('id'=>$course->id));",
          "4536:             $coursenode->add(get_string('publish', 'core_hub'), $url, self::TYPE_SETTING, null, 'publish',",
          "4537:                 new pix_icon('i/publish', ''));",
          "4538:         }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "version.php||version.php": [
          "File: version.php -> version.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "30: defined('MOODLE_INTERNAL') || die();",
          "",
          "[Removed Lines]",
          "32: $version  = 2019052001.11;              // 20190520      = branching date YYYYMMDD - do not modify!",
          "",
          "[Added Lines]",
          "32: $version  = 2019052001.12;              // 20190520      = branching date YYYYMMDD - do not modify!",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "3ec5c7701c8f9129f70721293a4859d4b6bbf845",
      "candidate_info": {
        "commit_hash": "3ec5c7701c8f9129f70721293a4859d4b6bbf845",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/3ec5c7701c8f9129f70721293a4859d4b6bbf845",
        "files": [
          "lib/db/upgrade.php",
          "version.php"
        ],
        "message": "MDL-63211 core: upgrade to remove non-mutual contacts",
        "before_after_code_files": [
          "lib/db/upgrade.php||lib/db/upgrade.php",
          "version.php||version.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.php||version.php"
          ],
          "candidate": [
            "version.php||version.php"
          ]
        }
      },
      "candidate_diff": {
        "lib/db/upgrade.php||lib/db/upgrade.php": [
          "File: lib/db/upgrade.php -> lib/db/upgrade.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "2489:         upgrade_main_savepoint(true, 2018092800.01);",
          "2490:     }",
          "2492:     return true;",
          "2493: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2492:     if ($oldversion < 2018092800.02) {",
          "2494:         $sql = \"SELECT c1.id",
          "2495:                   FROM {message_contacts} c1",
          "2496:              LEFT JOIN {message_contacts} c2",
          "2497:                     ON c1.userid = c2.contactid",
          "2498:                    AND c1.contactid = c2.userid",
          "2499:                  WHERE c2.id IS NULL\";",
          "2500:         if ($contacts = $DB->get_records_sql($sql)) {",
          "2501:             list($insql, $inparams) = $DB->get_in_or_equal(array_keys($contacts));",
          "2502:             $DB->delete_records_select('message_contacts', \"id $insql\", $inparams);",
          "2503:         }",
          "2505:         upgrade_main_savepoint(true, 2018092800.02);",
          "2506:     }",
          "",
          "---------------"
        ],
        "version.php||version.php": [
          "File: version.php -> version.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "30: defined('MOODLE_INTERNAL') || die();",
          "",
          "[Removed Lines]",
          "32: $version  = 2018092800.01;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "",
          "[Added Lines]",
          "32: $version  = 2018092800.02;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "",
          "---------------"
        ]
      }
    }
  ]
}