{
  "cve_id": "CVE-2022-0560",
  "cve_desc": "Open Redirect in Packagist microweber/microweber prior to 1.2.11.",
  "repo": "microweber/microweber",
  "patch_hash": "72d4b12cc487f56a859a8570ada4efb77b4b8c63",
  "patch_info": {
    "commit_hash": "72d4b12cc487f56a859a8570ada4efb77b4b8c63",
    "repo": "microweber/microweber",
    "commit_url": "https://github.com/microweber/microweber/commit/72d4b12cc487f56a859a8570ada4efb77b4b8c63",
    "files": [
      "src/MicroweberPackages/Page/routes/web.php",
      "tests/Browser/AdminXssTest.php"
    ],
    "message": "update",
    "before_after_code_files": [
      "src/MicroweberPackages/Page/routes/web.php||src/MicroweberPackages/Page/routes/web.php",
      "tests/Browser/AdminXssTest.php||tests/Browser/AdminXssTest.php"
    ]
  },
  "patch_diff": {
    "src/MicroweberPackages/Page/routes/web.php||src/MicroweberPackages/Page/routes/web.php": [
      "File: src/MicroweberPackages/Page/routes/web.php -> src/MicroweberPackages/Page/routes/web.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "11:     ->middleware(['admin'])",
      "12:     ->namespace('\\MicroweberPackages\\Page\\Http\\Controllers\\Admin')",
      "13:     ->group(function () {",
      "15:     });",
      "",
      "[Removed Lines]",
      "14:         Route::resource('page', 'PageController');",
      "",
      "[Added Lines]",
      "14:         Route::resource('page', 'PageController', ['except' => ['show']]);",
      "",
      "---------------"
    ],
    "tests/Browser/AdminXssTest.php||tests/Browser/AdminXssTest.php": [
      "File: tests/Browser/AdminXssTest.php -> tests/Browser/AdminXssTest.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "33:                         $browser->validate();",
      "34:                     });",
      "37:                 }",
      "38:             }",
      "",
      "[Removed Lines]",
      "36:                     $browser->pause(2000);",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "77b21da99339fa0b548f5391279e6280f896ac96",
      "candidate_info": {
        "commit_hash": "77b21da99339fa0b548f5391279e6280f896ac96",
        "repo": "microweber/microweber",
        "commit_url": "https://github.com/microweber/microweber/commit/77b21da99339fa0b548f5391279e6280f896ac96",
        "files": [
          "tests/Browser/AdminXssTest.php"
        ],
        "message": "Update AdminXssTest.php",
        "before_after_code_files": [
          "tests/Browser/AdminXssTest.php||tests/Browser/AdminXssTest.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "tests/Browser/AdminXssTest.php||tests/Browser/AdminXssTest.php"
          ],
          "candidate": [
            "tests/Browser/AdminXssTest.php||tests/Browser/AdminXssTest.php"
          ]
        }
      },
      "candidate_diff": {
        "tests/Browser/AdminXssTest.php||tests/Browser/AdminXssTest.php": [
          "File: tests/Browser/AdminXssTest.php -> tests/Browser/AdminXssTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "35:                         $browser->validate();",
          "36:                     });",
          "39:                 }",
          "40:             }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "38:                     $browser->pause(1000);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "4d1ff933c817c6a6cc5528fc904bf1d816ad80f3",
      "candidate_info": {
        "commit_hash": "4d1ff933c817c6a6cc5528fc904bf1d816ad80f3",
        "repo": "microweber/microweber",
        "commit_url": "https://github.com/microweber/microweber/commit/4d1ff933c817c6a6cc5528fc904bf1d816ad80f3",
        "files": [
          "tests/Browser/AdminXssTest.php"
        ],
        "message": "Update AdminXssTest.php",
        "before_after_code_files": [
          "tests/Browser/AdminXssTest.php||tests/Browser/AdminXssTest.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "tests/Browser/AdminXssTest.php||tests/Browser/AdminXssTest.php"
          ],
          "candidate": [
            "tests/Browser/AdminXssTest.php||tests/Browser/AdminXssTest.php"
          ]
        }
      },
      "candidate_diff": {
        "tests/Browser/AdminXssTest.php||tests/Browser/AdminXssTest.php": [
          "File: tests/Browser/AdminXssTest.php -> tests/Browser/AdminXssTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "21:                 $browser->fillForm();",
          "22:             });",
          "25:             $routeCollection = Route::getRoutes();",
          "26:             foreach ($routeCollection as $value) {",
          "29:                 }",
          "39:         });",
          "",
          "[Removed Lines]",
          "24:             $adminUrls = [];",
          "27:                 if (strpos($value->uri(), 'admin') !== false) {",
          "28:                     $adminUrls[] = $value->uri();",
          "30:             }",
          "32:             dd($adminUrls);",
          "34:             $browser->within(new ChekForJavascriptErrors(), function ($browser) {",
          "35:                 $browser->validate();",
          "36:             });",
          "",
          "[Added Lines]",
          "26:                 if ($value->getActionMethod() == 'GET') {",
          "27:                     continue;",
          "29:                 if (strpos($value->uri(), 'admin') !== false) {",
          "30:                     $browser->visit($value->uri());",
          "32:                     $browser->within(new ChekForJavascriptErrors(), function ($browser) {",
          "33:                         $browser->validate();",
          "34:                     });",
          "36:                     $browser->pause(2000);",
          "37:                 }",
          "38:             }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "f3ec5485c00e973be1ab0b70d9171754e9994a29",
      "candidate_info": {
        "commit_hash": "f3ec5485c00e973be1ab0b70d9171754e9994a29",
        "repo": "microweber/microweber",
        "commit_url": "https://github.com/microweber/microweber/commit/f3ec5485c00e973be1ab0b70d9171754e9994a29",
        "files": [
          "tests/Browser/AdminXssTest.php",
          "userfiles/modules/tags/manage_tagging_tagged.php"
        ],
        "message": "update",
        "before_after_code_files": [
          "tests/Browser/AdminXssTest.php||tests/Browser/AdminXssTest.php",
          "userfiles/modules/tags/manage_tagging_tagged.php||userfiles/modules/tags/manage_tagging_tagged.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "tests/Browser/AdminXssTest.php||tests/Browser/AdminXssTest.php"
          ],
          "candidate": [
            "tests/Browser/AdminXssTest.php||tests/Browser/AdminXssTest.php"
          ]
        }
      },
      "candidate_diff": {
        "tests/Browser/AdminXssTest.php||tests/Browser/AdminXssTest.php": [
          "File: tests/Browser/AdminXssTest.php -> tests/Browser/AdminXssTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: <?php",
          "3: namespace Tests\\Browser;",
          "6: use Laravel\\Dusk\\Browser;",
          "7: use Tests\\Browser\\Components\\AdminLogin;",
          "8: use Tests\\Browser\\Components\\ChekForJavascriptErrors;",
          "10: class AdminXssTest extends DuskTestCase",
          "11: {",
          "13:     public function testPages()",
          "14:     {",
          "15:         \\MicroweberPackages\\Multilanguage\\MultilanguageHelpers::setMultilanguageEnabled(false);",
          "17:         $this->browse(function (Browser $browser) {",
          "19:             $browser->within(new AdminLogin(), function ($browser) {",
          "20:                 $browser->fillForm();",
          "21:             });",
          "24:             $browser->within(new ChekForJavascriptErrors(), function ($browser) {",
          "25:                 $browser->validate();",
          "26:             });",
          "32:         });",
          "34:     }",
          "35: }",
          "",
          "---------------"
        ],
        "userfiles/modules/tags/manage_tagging_tagged.php||userfiles/modules/tags/manage_tagging_tagged.php": [
          "File: userfiles/modules/tags/manage_tagging_tagged.php -> userfiles/modules/tags/manage_tagging_tagged.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "180:         var tags = '';",
          "181:         var keyword = $('.js-search-tags-keyword').val();",
          "183:         $('.js-all-tags').html('Searching for: ' + keyword);",
          "185:         $.get(mw.settings.api_url + 'tagging_tag/get', {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "183:         keyword = String(keyword).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;');",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "212:         var keyword = $('.js-search-posts-keyword').val();",
          "213:         var filter = $('.js-posts-filter-by').val();",
          "215:         $('.js-select-posts').html('Searching for: ' + keyword);",
          "217:         var content_type = '[neq]page';",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "217:         keyword = String(keyword).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;');",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "1adcbfe761923dbba57bd1f84e054d3d106ad992",
      "candidate_info": {
        "commit_hash": "1adcbfe761923dbba57bd1f84e054d3d106ad992",
        "repo": "microweber/microweber",
        "commit_url": "https://github.com/microweber/microweber/commit/1adcbfe761923dbba57bd1f84e054d3d106ad992",
        "files": [
          "tests/Browser/AdminXssTest.php"
        ],
        "message": "Update AdminXssTest.php",
        "before_after_code_files": [
          "tests/Browser/AdminXssTest.php||tests/Browser/AdminXssTest.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "tests/Browser/AdminXssTest.php||tests/Browser/AdminXssTest.php"
          ],
          "candidate": [
            "tests/Browser/AdminXssTest.php||tests/Browser/AdminXssTest.php"
          ]
        }
      },
      "candidate_diff": {
        "tests/Browser/AdminXssTest.php||tests/Browser/AdminXssTest.php": [
          "File: tests/Browser/AdminXssTest.php -> tests/Browser/AdminXssTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "84:                     }",
          "86:                     $browser->visit($visitPage);",
          "89:                     $browser->within(new ChekForJavascriptErrors(), function ($browser) {",
          "90:                         $browser->validate();",
          "91:                     });",
          "94:                 }",
          "95:             }",
          "",
          "[Removed Lines]",
          "87:                     $browser->assertStatus(200);",
          "93:                     $browser->pause(1000);",
          "",
          "[Added Lines]",
          "92:                     $browser->assertDontSee('There is some error');",
          "93:                     $browser->pause(700);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "0b1104454ea4da8e00f7709b0930bad4164f0e6b",
      "candidate_info": {
        "commit_hash": "0b1104454ea4da8e00f7709b0930bad4164f0e6b",
        "repo": "microweber/microweber",
        "commit_url": "https://github.com/microweber/microweber/commit/0b1104454ea4da8e00f7709b0930bad4164f0e6b",
        "files": [
          "src/MicroweberPackages/App/Http/Controllers/AdminController.php",
          "src/MicroweberPackages/Page/Http/Controllers/Admin/PageController.php",
          "src/MicroweberPackages/Page/PageServiceProvider.php",
          "src/MicroweberPackages/Page/routes/web.php",
          "src/MicroweberPackages/Post/Http/Controllers/Admin/PostController.php",
          "src/MicroweberPackages/Post/PostServiceProvider.php",
          "src/MicroweberPackages/Post/resources/views/admin/posts/edit.blade.php",
          "src/MicroweberPackages/Post/routes/web.php",
          "userfiles/modules/content/views/manager_content.php"
        ],
        "message": "update",
        "before_after_code_files": [
          "src/MicroweberPackages/App/Http/Controllers/AdminController.php||src/MicroweberPackages/App/Http/Controllers/AdminController.php",
          "src/MicroweberPackages/Page/Http/Controllers/Admin/PageController.php||src/MicroweberPackages/Page/Http/Controllers/Admin/PageController.php",
          "src/MicroweberPackages/Page/PageServiceProvider.php||src/MicroweberPackages/Page/PageServiceProvider.php",
          "src/MicroweberPackages/Page/routes/web.php||src/MicroweberPackages/Page/routes/web.php",
          "src/MicroweberPackages/Post/Http/Controllers/Admin/PostController.php||src/MicroweberPackages/Post/Http/Controllers/Admin/PostController.php",
          "src/MicroweberPackages/Post/PostServiceProvider.php||src/MicroweberPackages/Post/PostServiceProvider.php",
          "src/MicroweberPackages/Post/resources/views/admin/posts/edit.blade.php||src/MicroweberPackages/Post/resources/views/admin/posts/edit.blade.php",
          "src/MicroweberPackages/Post/routes/web.php||src/MicroweberPackages/Post/routes/web.php",
          "userfiles/modules/content/views/manager_content.php||userfiles/modules/content/views/manager_content.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/MicroweberPackages/Page/routes/web.php||src/MicroweberPackages/Page/routes/web.php"
          ],
          "candidate": [
            "src/MicroweberPackages/Page/routes/web.php||src/MicroweberPackages/Page/routes/web.php"
          ]
        }
      },
      "candidate_diff": {
        "src/MicroweberPackages/App/Http/Controllers/AdminController.php||src/MicroweberPackages/App/Http/Controllers/AdminController.php": [
          "File: src/MicroweberPackages/App/Http/Controllers/AdminController.php -> src/MicroweberPackages/App/Http/Controllers/AdminController.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "31:     public $app;",
          "32:     private $render_content;",
          "35:     {",
          "42:         event_trigger('mw.init');",
          "43:     }",
          "",
          "[Removed Lines]",
          "34:     public function __construct($app = null)",
          "36:         if (is_object($app)) {",
          "37:             $this->app = $app;",
          "38:         } else {",
          "39:             $this->app = mw();",
          "40:         }",
          "",
          "[Added Lines]",
          "34:     public function __construct()",
          "36:         $this->app = mw();",
          "",
          "---------------"
        ],
        "src/MicroweberPackages/Page/Http/Controllers/Admin/PageController.php||src/MicroweberPackages/Page/Http/Controllers/Admin/PageController.php": [
          "File: src/MicroweberPackages/Page/Http/Controllers/Admin/PageController.php -> src/MicroweberPackages/Page/Http/Controllers/Admin/PageController.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: <?php",
          "8: namespace MicroweberPackages\\Page\\Http\\Controllers\\Admin;",
          "10: use Illuminate\\Http\\Request;",
          "11: use MicroweberPackages\\App\\Http\\Controllers\\AdminController;",
          "12: use MicroweberPackages\\Page\\Repositories\\PageRepository;",
          "14: class PageController extends AdminController",
          "15: {",
          "16:     public $repository;",
          "18:     public function __construct(PageRepository $repository)",
          "19:     {",
          "20:         parent::__construct();",
          "22:         $this->repository = $repository;",
          "23:     }",
          "25:     public function edit(Request $request, $id) {",
          "27:         return $this->view('post::admin.posts.edit', [",
          "28:             'content_id'=>$id",
          "29:         ]);",
          "30:     }",
          "31: }",
          "",
          "---------------"
        ],
        "src/MicroweberPackages/Page/PageServiceProvider.php||src/MicroweberPackages/Page/PageServiceProvider.php": [
          "File: src/MicroweberPackages/Page/PageServiceProvider.php -> src/MicroweberPackages/Page/PageServiceProvider.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "20:         Page::observe(PageObserver::class);",
          "22:         $this->loadRoutesFrom(__DIR__ . '/routes/api.php');",
          "23:     }",
          "25: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "23:         $this->loadRoutesFrom(__DIR__ . '/routes/web.php');",
          "",
          "---------------"
        ],
        "src/MicroweberPackages/Page/routes/web.php||src/MicroweberPackages/Page/routes/web.php": [
          "File: src/MicroweberPackages/Page/routes/web.php -> src/MicroweberPackages/Page/routes/web.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: <?php",
          "9: Route::name('admin.')",
          "10:     ->prefix('admin')",
          "11:     ->middleware(['admin'])",
          "12:     ->namespace('\\MicroweberPackages\\Page\\Http\\Controllers\\Admin')",
          "13:     ->group(function () {",
          "14:         Route::resource('page', 'PageController');",
          "15:     });",
          "",
          "---------------"
        ],
        "src/MicroweberPackages/Post/Http/Controllers/Admin/PostController.php||src/MicroweberPackages/Post/Http/Controllers/Admin/PostController.php": [
          "File: src/MicroweberPackages/Post/Http/Controllers/Admin/PostController.php -> src/MicroweberPackages/Post/Http/Controllers/Admin/PostController.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: <?php",
          "8: namespace MicroweberPackages\\Post\\Http\\Controllers\\Admin;",
          "10: use Illuminate\\Http\\Request;",
          "11: use Illuminate\\Http\\Resources\\Json\\JsonResource;",
          "12: use MicroweberPackages\\App\\Http\\Controllers\\AdminController;",
          "13: use MicroweberPackages\\Post\\Http\\Requests\\PostRequest;",
          "14: use MicroweberPackages\\Post\\Repositories\\PostRepository;",
          "16: class PostController extends AdminController",
          "17: {",
          "18:     public $repository;",
          "20:     public function __construct(PostRepository $repository)",
          "21:     {",
          "22:         parent::__construct();",
          "24:         $this->repository = $repository;",
          "25:     }",
          "27:     public function edit(Request $request, $id) {",
          "29:         return $this->view('post::admin.posts.edit', [",
          "30:             'content_id'=>$id",
          "31:         ]);",
          "32:     }",
          "33: }",
          "",
          "---------------"
        ],
        "src/MicroweberPackages/Post/PostServiceProvider.php||src/MicroweberPackages/Post/PostServiceProvider.php": [
          "File: src/MicroweberPackages/Post/PostServiceProvider.php -> src/MicroweberPackages/Post/PostServiceProvider.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: namespace MicroweberPackages\\Post;",
          "5: use Illuminate\\Support\\ServiceProvider;",
          "6: use MicroweberPackages\\Database\\Observers\\BaseModelObserver;",
          "7: use MicroweberPackages\\Post\\Models\\Post;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "5: use Illuminate\\Support\\Facades\\View;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "19:         Post::observe(BaseModelObserver::class);",
          "20:         Post::observe(PostObserver::class);",
          "22:         $this->loadRoutesFrom(__DIR__ . '/routes/api.php');",
          "23:     }",
          "25: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "23:         View::addNamespace('post', __DIR__ . '/resources/views');",
          "26:         $this->loadRoutesFrom(__DIR__ . '/routes/web.php');",
          "",
          "---------------"
        ],
        "src/MicroweberPackages/Post/resources/views/admin/posts/edit.blade.php||src/MicroweberPackages/Post/resources/views/admin/posts/edit.blade.php": [
          "File: src/MicroweberPackages/Post/resources/views/admin/posts/edit.blade.php -> src/MicroweberPackages/Post/resources/views/admin/posts/edit.blade.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: <module type=\"content/edit\" content-id=\"{{$content_id}}\" />",
          "",
          "---------------"
        ],
        "src/MicroweberPackages/Post/routes/web.php||src/MicroweberPackages/Post/routes/web.php": [
          "File: src/MicroweberPackages/Post/routes/web.php -> src/MicroweberPackages/Post/routes/web.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: <?php",
          "3: Route::name('admin.')",
          "4:     ->prefix('admin')",
          "5:     ->middleware(['admin'])",
          "6:     ->namespace('\\MicroweberPackages\\Post\\Http\\Controllers\\Admin')",
          "7:     ->group(function () {",
          "8:         Route::resource('post', 'PostController');",
          "9:     });",
          "",
          "---------------"
        ],
        "userfiles/modules/content/views/manager_content.php||userfiles/modules/content/views/manager_content.php": [
          "File: userfiles/modules/content/views/manager_content.php -> userfiles/modules/content/views/manager_content.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "79:                                                 </a>",
          "80:                                             <?php endif; ?>",
          "81:                                         </div>",
          "83:                                         <?php $edit_link_front = $content_link . '?editmode:y'; ?>",
          "84:                                     </div>",
          "",
          "[Removed Lines]",
          "82:                                         <?php $edit_link = admin_url('view:content#action=editpage:' . $item['id']); ?>",
          "",
          "[Added Lines]",
          "83:                                         <?php",
          "84:                                         $edit_link = '';",
          "85:                                         if (Route::has('admin.'.$item['content_type'].'.edit')) {",
          "86:                                             $edit_link = route('admin.' . $item['content_type'] . '.edit', $item['id']);",
          "87:                                         }",
          "88:                                         ?>",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "117:                                             <?php",
          "118:                                             if (user_can_access('module.content.edit')):",
          "119:                                                 ?>",
          "121:                                                     <?php echo $edit_text; ?>",
          "122:                                                 </a>",
          "",
          "[Removed Lines]",
          "120:                                                 <a target=\"<?php echo $target; ?>\" class=\"btn btn-outline-success btn-sm mw-js-edit-content-admin-list-link\" href=\"<?php print $edit_link ?>\">",
          "",
          "[Added Lines]",
          "126:                                                 <a href=\"<?php echo $edit_link; ?>\" class=\"btn btn-outline-success btn-sm\">",
          "",
          "---------------"
        ]
      }
    }
  ]
}