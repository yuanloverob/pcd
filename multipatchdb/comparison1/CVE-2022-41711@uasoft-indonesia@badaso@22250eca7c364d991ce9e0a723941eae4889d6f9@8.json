{
  "cve_id": "CVE-2022-41711",
  "cve_desc": "Badaso version 2.6.0 allows an unauthenticated remote attacker to execute arbitrary code remotely on the server. This is possible because the application does not properly validate the data uploaded by users.",
  "repo": "uasoft-indonesia/badaso",
  "patch_hash": "22250eca7c364d991ce9e0a723941eae4889d6f9",
  "patch_info": {
    "commit_hash": "22250eca7c364d991ce9e0a723941eae4889d6f9",
    "repo": "uasoft-indonesia/badaso",
    "commit_url": "https://github.com/uasoft-indonesia/badaso/commit/22250eca7c364d991ce9e0a723941eae4889d6f9",
    "files": [
      "src/resources/js/components/BadasoUploadFile.vue",
      "src/resources/js/components/BadasoUploadFileMultiple.vue",
      "src/resources/js/components/BadasoUploadImage.vue",
      "src/resources/js/components/BadasoUploadImageMultiple.vue"
    ],
    "message": "Merge pull request #807 from uasoft-indonesia/bugfix/v2/filter-mimeType\n\nBugfix[v2] add filter mimeType",
    "before_after_code_files": [
      "src/resources/js/components/BadasoUploadFile.vue||src/resources/js/components/BadasoUploadFile.vue",
      "src/resources/js/components/BadasoUploadFileMultiple.vue||src/resources/js/components/BadasoUploadFileMultiple.vue",
      "src/resources/js/components/BadasoUploadImage.vue||src/resources/js/components/BadasoUploadImage.vue",
      "src/resources/js/components/BadasoUploadImageMultiple.vue||src/resources/js/components/BadasoUploadImageMultiple.vue"
    ]
  },
  "patch_diff": {
    "src/resources/js/components/BadasoUploadFile.vue||src/resources/js/components/BadasoUploadFile.vue": [
      "File: src/resources/js/components/BadasoUploadFile.vue -> src/resources/js/components/BadasoUploadFile.vue",
      "--- Hunk 1 ---",
      "[Context before]",
      "336:           });",
      "337:           return;",
      "338:         }",
      "340:         this.uploadFile(files[0]);",
      "341:       }",
      "342:     },",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "339:         if (!this.availableMimetypes.file.validMime.includes(files[0].type)) {",
      "340:           this.$vs.notify({",
      "341:             title: this.$t(\"alert.danger\"),",
      "342:             text: \"File type not allowed\",",
      "343:             color: \"danger\",",
      "344:           });",
      "345:           return;",
      "346:         }",
      "",
      "---------------"
    ],
    "src/resources/js/components/BadasoUploadFileMultiple.vue||src/resources/js/components/BadasoUploadFileMultiple.vue": [
      "File: src/resources/js/components/BadasoUploadFileMultiple.vue -> src/resources/js/components/BadasoUploadFileMultiple.vue",
      "--- Hunk 1 ---",
      "[Context before]",
      "367:             });",
      "368:             return;",
      "369:           }",
      "371:           this.uploadFile(file);",
      "372:         }",
      "373:       }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "370:           if (!this.availableMimetypes.file.validMime.includes(file.type)) {",
      "371:             this.$vs.notify({",
      "372:               title: this.$t(\"alert.danger\"),",
      "373:               text: \"File type not allowed\",",
      "374:               color: \"danger\",",
      "375:             });",
      "376:             return;",
      "377:           }",
      "",
      "---------------"
    ],
    "src/resources/js/components/BadasoUploadImage.vue||src/resources/js/components/BadasoUploadImage.vue": [
      "File: src/resources/js/components/BadasoUploadImage.vue -> src/resources/js/components/BadasoUploadImage.vue",
      "--- Hunk 1 ---",
      "[Context before]",
      "380:           });",
      "381:           return;",
      "382:         }",
      "384:         this.uploadImage(files[0]);",
      "385:       }",
      "386:     },",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "383:         if (!this.availableMimetypes.image.validMime.includes(files[0].type)){",
      "384:           this.$vs.notify({",
      "385:             title: this.$t(\"alert.danger\"),",
      "386:             text: \"File type not allowed\",",
      "387:             color: \"danger\",",
      "388:           });",
      "389:           return;",
      "390:         }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "421:     uploadImage(file) {",
      "422:       const files = new FormData();",
      "423:       files.append(\"upload\", file);",
      "425:       files.append(\"working_dir\", this.getActiveFolder);",
      "426:       this.$api.badasoFile",
      "427:         .uploadUsingLfm(files)",
      "",
      "[Removed Lines]",
      "424:       files.append(\"type\", \"image\");",
      "",
      "[Added Lines]",
      "431:       files.append(\"type\", file.type);",
      "",
      "---------------"
    ],
    "src/resources/js/components/BadasoUploadImageMultiple.vue||src/resources/js/components/BadasoUploadImageMultiple.vue": [
      "File: src/resources/js/components/BadasoUploadImageMultiple.vue -> src/resources/js/components/BadasoUploadImageMultiple.vue",
      "--- Hunk 1 ---",
      "[Context before]",
      "395:             });",
      "396:             return;",
      "397:           }",
      "399:           this.uploadImage(file);",
      "400:         }",
      "401:       }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "398:           if (!this.availableMimetypes.image.validMime.includes(file.type)) {",
      "399:             this.$vs.notify({",
      "400:               title: this.$t(\"alert.danger\"),",
      "401:               text: \"File type not allowed\",",
      "402:               color: \"danger\",",
      "403:             });",
      "404:             return;",
      "405:           }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "e0e1b7675c0c807f9409c0801e2d4ccd8f361381",
      "candidate_info": {
        "commit_hash": "e0e1b7675c0c807f9409c0801e2d4ccd8f361381",
        "repo": "uasoft-indonesia/badaso",
        "commit_url": "https://github.com/uasoft-indonesia/badaso/commit/e0e1b7675c0c807f9409c0801e2d4ccd8f361381",
        "files": [
          "src/Controllers/BadasoAuthController.php"
        ],
        "message": "Apply fixes from StyleCI",
        "before_after_code_files": [
          "src/Controllers/BadasoAuthController.php||src/Controllers/BadasoAuthController.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/uasoft-indonesia/badaso/pull/1086"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/Controllers/BadasoAuthController.php||src/Controllers/BadasoAuthController.php": [
          "File: src/Controllers/BadasoAuthController.php -> src/Controllers/BadasoAuthController.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "175:                 'username' => 'required|string|max:255|alpha_num',",
          "176:                 'phone'    => 'required|numeric|min:6',",
          "177:                 'email'    => 'required|string|email|max:255|unique:Uasoft\\Badaso\\Models\\User',",
          "179:             ]);",
          "181:             $user = User::create([",
          "182:                 'name'     => $request->get('name'),",
          "183:                 'username' => $request->get('username'),",
          "",
          "[Removed Lines]",
          "178:                 'password' => 'required|string|min:6|confirmed'",
          "",
          "[Added Lines]",
          "178:                 'password' => 'required|string|min:6|confirmed',",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "213:                 return $this->createNewToken($token, auth()->user());",
          "214:             } else {",
          "215:                 User::where('email', $request->get('email'))->update([",
          "217:                 ]);",
          "218:                 $token = rand(111111, 999999);",
          "219:                 $token_lifetime = env('VERIFICATION_TOKEN_LIFETIME', 5);",
          "",
          "[Removed Lines]",
          "216:                     'last_sent_token_at' => date('Y-m-d H:i:s')",
          "",
          "[Added Lines]",
          "216:                     'last_sent_token_at' => date('Y-m-d H:i:s'),",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "469:             $request->validate([",
          "470:                 'email' => 'required|string|email|max:255',",
          "471:             ]);",
          "473:             $user = User::where('email', $request->email)->first();",
          "474:             $time_wait_to_resend_token = Configuration::where('key', 'timeWaitEmailVerify')->first();",
          "475:             $date_now = date('Y-m-d H:i:s');",
          "477:             $user_verification = UserVerification::where('user_id', $user->id)",
          "478:                 ->first();",
          "480:             if ($date_now < $time_out_token) {",
          "481:                 throw new SingleException(__('badaso::validation.verification.time_wait_loading'));",
          "482:             }",
          "484:             User::where('email', $request->get('email'))->update([",
          "486:             ]);",
          "488:             if (! $user_verification) {",
          "489:                 throw new SingleException(__('badaso::validation.verification.verification_not_found'));",
          "490:             }",
          "",
          "[Removed Lines]",
          "476:             $time_out_token = date('Y-m-d H:i:s', strtotime($user->last_sent_token_at . ' +  '. $time_wait_to_resend_token->value .' second'));",
          "485:                 'last_sent_token_at' => date('Y-m-d H:i:s')",
          "",
          "[Added Lines]",
          "476:             $time_out_token = date('Y-m-d H:i:s', strtotime($user->last_sent_token_at.' +  '.$time_wait_to_resend_token->value.' second'));",
          "485:                 'last_sent_token_at' => date('Y-m-d H:i:s'),",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "cc5de522beb201133aadd4ae6792a1ae49a67722",
      "candidate_info": {
        "commit_hash": "cc5de522beb201133aadd4ae6792a1ae49a67722",
        "repo": "uasoft-indonesia/badaso",
        "commit_url": "https://github.com/uasoft-indonesia/badaso/commit/cc5de522beb201133aadd4ae6792a1ae49a67722",
        "files": [
          "src/stubs/migration.stub"
        ],
        "message": "update crud management",
        "before_after_code_files": [
          "src/stubs/migration.stub||src/stubs/migration.stub"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/uasoft-indonesia/badaso/pull/1086"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/stubs/migration.stub||src/stubs/migration.stub": [
          "File: src/stubs/migration.stub -> src/stubs/migration.stub",
          "--- Hunk 1 ---",
          "[Context before]",
          "14:     public function up()",
          "15:     {",
          "16:         try {",
          "22:         } catch (PDOException $ex) {",
          "24:             throw $ex;",
          "25:         }",
          "26:     }",
          "",
          "[Removed Lines]",
          "17:             DB::beginTransaction();",
          "19: {{schema_up}}",
          "21:             DB::commit();",
          "23:             DB::rollBack();",
          "",
          "[Added Lines]",
          "18:             {{schema_up}}",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "5188d73392dad771f3ab7a452a88510d28f059e9",
      "candidate_info": {
        "commit_hash": "5188d73392dad771f3ab7a452a88510d28f059e9",
        "repo": "uasoft-indonesia/badaso",
        "commit_url": "https://github.com/uasoft-indonesia/badaso/commit/5188d73392dad771f3ab7a452a88510d28f059e9",
        "files": [
          "src/Controllers/Controller.php"
        ],
        "message": "Apply fixes from StyleCI",
        "before_after_code_files": [
          "src/Controllers/Controller.php||src/Controllers/Controller.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/uasoft-indonesia/badaso/pull/1086"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/Controllers/Controller.php||src/Controllers/Controller.php": [
          "File: src/Controllers/Controller.php -> src/Controllers/Controller.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "75:         $data_rows = collect($data_type->dataRows)->where('add', 1)->all();",
          "76:         $rules = [];",
          "77:         foreach ($data_rows as $row) {",
          "79:                 $row->required = 0;",
          "80:             }",
          "81:             if ($row->required == 1) {",
          "83:                 $rules[$row->field][] = 'required';",
          "84:                 if ($row->type == 'relation') {",
          "85:                     $relation_detail = [];",
          "",
          "[Removed Lines]",
          "78:             if($row->edit == 1){",
          "",
          "[Added Lines]",
          "78:             if ($row->edit == 1) {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "c68a83e4c52b5c727eb3789846729332f03a2692",
      "candidate_info": {
        "commit_hash": "c68a83e4c52b5c727eb3789846729332f03a2692",
        "repo": "uasoft-indonesia/badaso",
        "commit_url": "https://github.com/uasoft-indonesia/badaso/commit/c68a83e4c52b5c727eb3789846729332f03a2692",
        "files": [
          "src/Helpers/CallHelperTest.php",
          "src/resources/js/components/BadasoSidebarItem.vue",
          "src/resources/js/components/BadasoSidebarMenu.vue",
          "src/resources/js/store/modules/badaso.js"
        ],
        "message": "bugfix external link menu management item",
        "before_after_code_files": [
          "src/Helpers/CallHelperTest.php||src/Helpers/CallHelperTest.php",
          "src/resources/js/components/BadasoSidebarItem.vue||src/resources/js/components/BadasoSidebarItem.vue",
          "src/resources/js/components/BadasoSidebarMenu.vue||src/resources/js/components/BadasoSidebarMenu.vue",
          "src/resources/js/store/modules/badaso.js||src/resources/js/store/modules/badaso.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/uasoft-indonesia/badaso/pull/1086"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/Helpers/CallHelperTest.php||src/Helpers/CallHelperTest.php": [
          "File: src/Helpers/CallHelperTest.php -> src/Helpers/CallHelperTest.php"
        ],
        "src/resources/js/components/BadasoSidebarItem.vue||src/resources/js/components/BadasoSidebarItem.vue": [
          "File: src/resources/js/components/BadasoSidebarItem.vue -> src/resources/js/components/BadasoSidebarItem.vue",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: <template>",
          "2:   <div",
          "3:     :class=\"{ 'vs-sidebar-item-active': getActive }\"",
          "5:     @click=\"setIndexActive\"",
          "6:   >",
          "7:     <router-link v-if=\"to && target === '_self'\" :to=\"to\">",
          "",
          "[Removed Lines]",
          "4:     class=\"vs-sidebar--item\"",
          "",
          "[Added Lines]",
          "4:     class=\"vs-sidebar--item \"",
          "",
          "---------------"
        ],
        "src/resources/js/components/BadasoSidebarMenu.vue||src/resources/js/components/BadasoSidebarMenu.vue": [
          "File: src/resources/js/components/BadasoSidebarMenu.vue -> src/resources/js/components/BadasoSidebarMenu.vue",
          "--- Hunk 1 ---",
          "[Context before]",
          "25:         />",
          "26:       </a>",
          "27:       <!-- for route link -->",
          "28:       <router-link",
          "29:         :to=\"url\"",
          "30:         aria-current=\"page\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "28:       <template v-else>",
          "29:         <a v-if=\"url.substring(0, 4) == 'http'\"",
          "30:         :href=\"url\"",
          "31:         aria-current=\"page\"",
          "32:         :class=\"getItemActive().vsAlinkActive\"",
          "33:         >",
          "34:        <vs-icon :icon=\"icon ? icon : 'remove'\" />",
          "35:         <span class=\"hide-in-minisidebar\"> {{ title }}</span>",
          "36:         </a>",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "34:         <vs-icon :icon=\"icon ? icon : 'remove'\" />",
          "35:         <span class=\"hide-in-minisidebar\"> {{ title }}</span>",
          "36:       </router-link>",
          "37:     </div>",
          "38:     <!-- vs-sidebar--group-items -->",
          "39:     <ul",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "46:       </template>",
          "",
          "---------------"
        ],
        "src/resources/js/store/modules/badaso.js||src/resources/js/store/modules/badaso.js": [
          "File: src/resources/js/store/modules/badaso.js -> src/resources/js/store/modules/badaso.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "52:       const menuItemAddPrefix = (arrayMenuChild, callbackMenuItemAddPrefix) => {",
          "53:         arrayMenuChild = arrayMenuChild.map((menuItem) => {",
          "55:           menuItem.icon = menuItem.iconClass;",
          "57:           if (menuItem.children) {",
          "",
          "[Removed Lines]",
          "54:           menuItem.url = \"/\" + prefix + menuItem.url;",
          "",
          "[Added Lines]",
          "55:           menuItem.url = menuItem.url.substring(0,4) == 'http' ? menuItem.url: \"/\" + prefix + menuItem.url;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "f19c246c59b6d1a81bd08fef6f235e60437bd46f",
      "candidate_info": {
        "commit_hash": "f19c246c59b6d1a81bd08fef6f235e60437bd46f",
        "repo": "uasoft-indonesia/badaso",
        "commit_url": "https://github.com/uasoft-indonesia/badaso/commit/f19c246c59b6d1a81bd08fef6f235e60437bd46f",
        "files": [
          "src/resources/js/components/BadasoWidget.vue",
          "src/resources/js/pages/home.vue"
        ],
        "message": "update component widget",
        "before_after_code_files": [
          "src/resources/js/components/BadasoWidget.vue||src/resources/js/components/BadasoWidget.vue",
          "src/resources/js/pages/home.vue||src/resources/js/pages/home.vue"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/uasoft-indonesia/badaso/pull/1086"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/resources/js/components/BadasoWidget.vue||src/resources/js/components/BadasoWidget.vue": [
          "File: src/resources/js/components/BadasoWidget.vue -> src/resources/js/components/BadasoWidget.vue",
          "--- Hunk 1 ---",
          "[Context before]",
          "2:   <vs-col class=\"badaso-widget__container\">",
          "3:     <vs-row>",
          "4:       <vs-col",
          "6:         :key=\"index\"",
          "7:         :vs-lg=\"col\"",
          "8:         vs-xs=\"12\"",
          "",
          "[Removed Lines]",
          "5:         v-for=\"(data, index) in widgets\"",
          "",
          "[Added Lines]",
          "5:         v-for=\"(data, index) in datas\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "37:     return {};",
          "38:   },",
          "39:   props: {",
          "41:       type: Array,",
          "42:       default: [],",
          "43:     },",
          "",
          "[Removed Lines]",
          "40:     widgets: {",
          "",
          "[Added Lines]",
          "40:     datas: {",
          "",
          "---------------"
        ],
        "src/resources/js/pages/home.vue||src/resources/js/pages/home.vue": [
          "File: src/resources/js/pages/home.vue -> src/resources/js/pages/home.vue",
          "--- Hunk 1 ---",
          "[Context before]",
          "71:         });",
          "72:       }",
          "73:     },",
          "96:   },",
          "97: };",
          "98: </script>",
          "",
          "[Removed Lines]",
          "75:     setDelimiterComa(price) {",
          "76:       const pieces = parseFloat(price).toFixed(2).split(\"\");",
          "78:       let ii = pieces.length - 3;",
          "80:       while ((ii -= 3) > 0) {",
          "81:         pieces.splice(ii, 0, \",\");",
          "82:       }",
          "83:       return pieces.join(\"\").replace(/\\.00/g, \"\");",
          "84:     },",
          "86:     setDelimiterPoint(price) {",
          "87:       const pieces = parseFloat(price).toFixed(2).split(\"\");",
          "89:       let ii = pieces.length - 3;",
          "91:       while ((ii -= 3) > 0) {",
          "92:         pieces.splice(ii, 0, \",\");",
          "93:       }",
          "94:       return pieces.join(\"\").replace(/\\.00/g, \"\").replace(/,/g, \".\");",
          "95:     },",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    }
  ]
}