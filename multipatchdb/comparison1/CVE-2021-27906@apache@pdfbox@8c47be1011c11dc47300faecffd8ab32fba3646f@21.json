{
  "cve_id": "CVE-2021-27906",
  "cve_desc": "A carefully crafted PDF file can trigger an OutOfMemory-Exception while loading the file. This issue affects Apache PDFBox version 2.0.22 and prior 2.0.x versions.",
  "repo": "apache/pdfbox",
  "patch_hash": "8c47be1011c11dc47300faecffd8ab32fba3646f",
  "patch_info": {
    "commit_hash": "8c47be1011c11dc47300faecffd8ab32fba3646f",
    "repo": "apache/pdfbox",
    "commit_url": "https://github.com/apache/pdfbox/commit/8c47be1011c11dc47300faecffd8ab32fba3646f",
    "files": [
      "pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java"
    ],
    "message": "PDFBOX-5112: SonarCube fix, throw NoSuchElementException if no more elements are available\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1887295 13f79535-47bb-0310-9956-ffa450edef68",
    "before_after_code_files": [
      "pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java||pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java"
    ]
  },
  "patch_diff": {
    "pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java||pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java": [
      "File: pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java -> pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java",
      "--- Hunk 1 ---",
      "[Context before]",
      "19: import java.io.IOException;",
      "20: import java.util.Arrays;",
      "21: import java.util.Iterator;",
      "23: import org.apache.pdfbox.cos.COSArray;",
      "24: import org.apache.pdfbox.cos.COSBase;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "22: import java.util.NoSuchElementException;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "212:         @Override",
      "213:         public Long next()",
      "214:         {",
      "215:             if (currentNumber < currentEnd)",
      "216:             {",
      "217:                 return currentNumber++;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "216:             if (currentNumber >= maxValue)",
      "217:             {",
      "218:                 throw new NoSuchElementException();",
      "219:             }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "01f80815259c70601c41c19b01455bbe04ca137a",
      "candidate_info": {
        "commit_hash": "01f80815259c70601c41c19b01455bbe04ca137a",
        "repo": "apache/pdfbox",
        "commit_url": "https://github.com/apache/pdfbox/commit/01f80815259c70601c41c19b01455bbe04ca137a",
        "files": [
          "pdfbox/src/main/java/org/apache/pdfbox/cos/COSArray.java"
        ],
        "message": "PDFBOX-4892: simplify code, as suggested by valerybokov\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1888077 13f79535-47bb-0310-9956-ffa450edef68",
        "before_after_code_files": [
          "pdfbox/src/main/java/org/apache/pdfbox/cos/COSArray.java||pdfbox/src/main/java/org/apache/pdfbox/cos/COSArray.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/pdfbox/pull/104"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "pdfbox/src/main/java/org/apache/pdfbox/cos/COSArray.java||pdfbox/src/main/java/org/apache/pdfbox/cos/COSArray.java": [
          "File: pdfbox/src/main/java/org/apache/pdfbox/cos/COSArray.java -> pdfbox/src/main/java/org/apache/pdfbox/cos/COSArray.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "571:     public List<? extends COSBase> toList()",
          "572:     {",
          "579:     }",
          "580: }",
          "",
          "[Removed Lines]",
          "573:         List<COSBase> retList = new ArrayList<COSBase>(size());",
          "574:         for (int i = 0; i < size(); i++)",
          "575:         {",
          "576:             retList.add(get(i));",
          "577:         }",
          "578:         return retList;",
          "",
          "[Added Lines]",
          "573:         return new ArrayList<COSBase>(objects);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "2a948e7bc49993fe422e1d9bb3b382c8357a75f1",
      "candidate_info": {
        "commit_hash": "2a948e7bc49993fe422e1d9bb3b382c8357a75f1",
        "repo": "apache/pdfbox",
        "commit_url": "https://github.com/apache/pdfbox/commit/2a948e7bc49993fe422e1d9bb3b382c8357a75f1",
        "files": [
          "pdfbox/src/test/java/org/apache/pdfbox/cos/TestCOSName.java"
        ],
        "message": "PDFBOX-5190: add test\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1889672 13f79535-47bb-0310-9956-ffa450edef68",
        "before_after_code_files": [
          "pdfbox/src/test/java/org/apache/pdfbox/cos/TestCOSName.java||pdfbox/src/test/java/org/apache/pdfbox/cos/TestCOSName.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/pdfbox/pull/104"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "pdfbox/src/test/java/org/apache/pdfbox/cos/TestCOSName.java||pdfbox/src/test/java/org/apache/pdfbox/cos/TestCOSName.java": [
          "File: pdfbox/src/test/java/org/apache/pdfbox/cos/TestCOSName.java -> pdfbox/src/test/java/org/apache/pdfbox/cos/TestCOSName.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "17: package org.apache.pdfbox.cos;",
          "19: import java.io.ByteArrayOutputStream;",
          "20: import java.io.IOException;",
          "21: import org.apache.pdfbox.pdmodel.PDDocument;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "19: import static org.junit.Assert.assertNull;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "47:         Assert.assertEquals(special, catalogDict.getString(special));",
          "48:         document.close();",
          "49:     }",
          "50: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "53:     @Test",
          "54:     public void testEmptyName()",
          "55:     {",
          "56:         assertNull(null);",
          "57:         assertNull(COSName.getPDFName(\"\"));",
          "58:     }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "a92d03978a84a1a2fb60eb4a2c715805dfd69a01",
      "candidate_info": {
        "commit_hash": "a92d03978a84a1a2fb60eb4a2c715805dfd69a01",
        "repo": "apache/pdfbox",
        "commit_url": "https://github.com/apache/pdfbox/commit/a92d03978a84a1a2fb60eb4a2c715805dfd69a01",
        "files": [
          "preflight/src/main/java/org/apache/pdfbox/preflight/graphic/ColorSpaceHelperFactory.java"
        ],
        "message": "PDFBOX-5055: remove unneeded semicolon, as suggested by Arturo Bernal\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1884701 13f79535-47bb-0310-9956-ffa450edef68",
        "before_after_code_files": [
          "preflight/src/main/java/org/apache/pdfbox/preflight/graphic/ColorSpaceHelperFactory.java||preflight/src/main/java/org/apache/pdfbox/preflight/graphic/ColorSpaceHelperFactory.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/pdfbox/pull/104"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "preflight/src/main/java/org/apache/pdfbox/preflight/graphic/ColorSpaceHelperFactory.java||preflight/src/main/java/org/apache/pdfbox/preflight/graphic/ColorSpaceHelperFactory.java": [
          "File: preflight/src/main/java/org/apache/pdfbox/preflight/graphic/ColorSpaceHelperFactory.java -> preflight/src/main/java/org/apache/pdfbox/preflight/graphic/ColorSpaceHelperFactory.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "65:     public enum ColorSpaceRestriction",
          "66:     {",
          "68:     }",
          "69: }",
          "",
          "[Removed Lines]",
          "67:         NO_RESTRICTION, NO_PATTERN, ONLY_DEVICE;",
          "",
          "[Added Lines]",
          "67:         NO_RESTRICTION, NO_PATTERN, ONLY_DEVICE",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "dc5350d8e9970f95984521a58b8b9fddf5f28358",
      "candidate_info": {
        "commit_hash": "dc5350d8e9970f95984521a58b8b9fddf5f28358",
        "repo": "apache/pdfbox",
        "commit_url": "https://github.com/apache/pdfbox/commit/dc5350d8e9970f95984521a58b8b9fddf5f28358",
        "files": [
          "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/PDDocument.java"
        ],
        "message": "PDFBOX-4892: optimize search, as suggested by valerybokov\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1887047 13f79535-47bb-0310-9956-ffa450edef68",
        "before_after_code_files": [
          "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/PDDocument.java||pdfbox/src/main/java/org/apache/pdfbox/pdmodel/PDDocument.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/pdfbox/pull/104"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/PDDocument.java||pdfbox/src/main/java/org/apache/pdfbox/pdmodel/PDDocument.java": [
          "File: pdfbox/src/main/java/org/apache/pdfbox/pdmodel/PDDocument.java -> pdfbox/src/main/java/org/apache/pdfbox/pdmodel/PDDocument.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "503:                 if (signature != null && signature.getCOSObject().equals(sigObject.getCOSObject()))",
          "504:                 {",
          "505:                     signatureField = (PDSignatureField) pdField;",
          "506:                 }",
          "507:             }",
          "508:         }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "506:                     break;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "7c47a75a8692d134394494bbc6a8990fd97f1e98",
      "candidate_info": {
        "commit_hash": "7c47a75a8692d134394494bbc6a8990fd97f1e98",
        "repo": "apache/pdfbox",
        "commit_url": "https://github.com/apache/pdfbox/commit/7c47a75a8692d134394494bbc6a8990fd97f1e98",
        "files": [
          "pdfbox/src/main/java/org/apache/pdfbox/pdfparser/BaseParser.java"
        ],
        "message": "PDFBOX-4892: simplify\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1889698 13f79535-47bb-0310-9956-ffa450edef68",
        "before_after_code_files": [
          "pdfbox/src/main/java/org/apache/pdfbox/pdfparser/BaseParser.java||pdfbox/src/main/java/org/apache/pdfbox/pdfparser/BaseParser.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/pdfbox/pull/104"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "pdfbox/src/main/java/org/apache/pdfbox/pdfparser/BaseParser.java||pdfbox/src/main/java/org/apache/pdfbox/pdfparser/BaseParser.java": [
          "File: pdfbox/src/main/java/org/apache/pdfbox/pdfparser/BaseParser.java -> pdfbox/src/main/java/org/apache/pdfbox/pdfparser/BaseParser.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "851:             c = (char) seqSource.peek();",
          "852:             seqSource.unread(leftBracket);",
          "864:         case '[':",
          "866:             return parseCOSArray();",
          "",
          "[Removed Lines]",
          "853:             if(c == '<')",
          "854:             {",
          "856:                 COSDictionary retval = parseCOSDictionary();",
          "857:                 skipSpaces();",
          "858:                 return retval;",
          "859:             }",
          "860:             else",
          "861:             {",
          "862:                 return parseCOSString();",
          "863:             }",
          "",
          "[Added Lines]",
          "853:             return c == '<' ? parseCOSDictionary() : parseCOSString();",
          "",
          "---------------"
        ]
      }
    }
  ]
}