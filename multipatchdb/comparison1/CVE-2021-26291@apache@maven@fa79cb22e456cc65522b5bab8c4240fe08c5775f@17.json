{
  "cve_id": "CVE-2021-26291",
  "cve_desc": "Apache Maven will follow repositories that are defined in a dependency\u2019s Project Object Model (pom) which may be surprising to some users, resulting in potential risk if a malicious actor takes over that repository or is able to insert themselves into a position to pretend to be that repository. Maven is changing the default behavior in 3.8.1+ to no longer follow http (non-SSL) repository references by default. More details available in the referenced urls. If you are currently using a repository manager to govern the repositories used by your builds, you are unaffected by the risks present in the legacy behavior, and are unaffected by this vulnerability and change to default behavior. See this link for more information about repository management: https://maven.apache.org/repository-management.html",
  "repo": "apache/maven",
  "patch_hash": "fa79cb22e456cc65522b5bab8c4240fe08c5775f",
  "patch_info": {
    "commit_hash": "fa79cb22e456cc65522b5bab8c4240fe08c5775f",
    "repo": "apache/maven",
    "commit_url": "https://github.com/apache/maven/commit/fa79cb22e456cc65522b5bab8c4240fe08c5775f",
    "files": [
      "maven-compat/src/main/java/org/apache/maven/repository/DefaultMirrorSelector.java",
      "maven-core/src/main/java/org/apache/maven/bridge/MavenRepositorySystem.java"
    ],
    "message": "[MNG-7116] add support for mirrorOf external:http:*",
    "before_after_code_files": [
      "maven-compat/src/main/java/org/apache/maven/repository/DefaultMirrorSelector.java||maven-compat/src/main/java/org/apache/maven/repository/DefaultMirrorSelector.java",
      "maven-core/src/main/java/org/apache/maven/bridge/MavenRepositorySystem.java||maven-core/src/main/java/org/apache/maven/bridge/MavenRepositorySystem.java"
    ]
  },
  "patch_diff": {
    "maven-compat/src/main/java/org/apache/maven/repository/DefaultMirrorSelector.java||maven-compat/src/main/java/org/apache/maven/repository/DefaultMirrorSelector.java": [
      "File: maven-compat/src/main/java/org/apache/maven/repository/DefaultMirrorSelector.java -> maven-compat/src/main/java/org/apache/maven/repository/DefaultMirrorSelector.java",
      "--- Hunk 1 ---",
      "[Context before]",
      "42:     private static final String EXTERNAL_WILDCARD = \"external:*\";",
      "44:     public Mirror getMirror( ArtifactRepository repository, List<Mirror> mirrors )",
      "45:     {",
      "46:         String repoId = repository.getId();",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "44:     private static final String EXTERNAL_HTTP_WILDCARD = \"external:http:*\";",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "115:                     result = true;",
      "117:                 }",
      "118:                 else if ( WILDCARD.equals( repo ) )",
      "119:                 {",
      "120:                     result = true;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "126:                 else if ( EXTERNAL_HTTP_WILDCARD.equals( repo ) && isExternalHttpRepo( originalRepository ) )",
      "127:                 {",
      "128:                     result = true;",
      "130:                 }",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "136:         try",
      "137:         {",
      "138:             URL url = new URL( originalRepository.getUrl() );",
      "141:         }",
      "142:         catch ( MalformedURLException e )",
      "143:         {",
      "",
      "[Removed Lines]",
      "139:             return !( url.getHost().equals( \"localhost\" ) || url.getHost().equals( \"127.0.0.1\" )",
      "140:                             || url.getProtocol().equals( \"file\" ) );",
      "",
      "[Added Lines]",
      "152:             return !( isLocal( url.getHost() ) || url.getProtocol().equals( \"file\" ) );",
      "153:         }",
      "154:         catch ( MalformedURLException e )",
      "155:         {",
      "157:             return false;",
      "158:         }",
      "159:     }",
      "161:     private static boolean isLocal( String host )",
      "162:     {",
      "163:         return \"localhost\".equals( host ) || \"127.0.0.1\".equals( host );",
      "164:     }",
      "172:     static boolean isExternalHttpRepo( ArtifactRepository originalRepository )",
      "173:     {",
      "174:         try",
      "175:         {",
      "176:             URL url = new URL( originalRepository.getUrl() );",
      "177:             return ( \"http\".equalsIgnoreCase( url.getProtocol() ) || \"dav\".equalsIgnoreCase( url.getProtocol() )",
      "178:                 || \"dav:http\".equalsIgnoreCase( url.getProtocol() )",
      "179:                 || \"dav+http\".equalsIgnoreCase( url.getProtocol() ) ) && !isLocal( url.getHost() );",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "146:         }",
      "147:     }",
      "150:     {",
      "151:         return matchesLayout( RepositoryUtils.getLayout( repository ), mirror.getMirrorOfLayouts() );",
      "152:     }",
      "",
      "[Removed Lines]",
      "149:     static boolean matchesLayout( ArtifactRepository repository, Mirror mirror )",
      "",
      "[Added Lines]",
      "188:    static boolean matchesLayout( ArtifactRepository repository, Mirror mirror )",
      "",
      "---------------"
    ],
    "maven-core/src/main/java/org/apache/maven/bridge/MavenRepositorySystem.java||maven-core/src/main/java/org/apache/maven/bridge/MavenRepositorySystem.java": [
      "File: maven-core/src/main/java/org/apache/maven/bridge/MavenRepositorySystem.java -> maven-core/src/main/java/org/apache/maven/bridge/MavenRepositorySystem.java",
      "--- Hunk 1 ---",
      "[Context before]",
      "711:     private static final String EXTERNAL_WILDCARD = \"external:*\";",
      "713:     public static Mirror getMirror( ArtifactRepository repository, List<Mirror> mirrors )",
      "714:     {",
      "715:         String repoId = repository.getId();",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "713:     private static final String EXTERNAL_HTTP_WILDCARD = \"external:http:*\";",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "782:                     result = true;",
      "784:                 }",
      "785:                 else if ( WILDCARD.equals( repo ) )",
      "786:                 {",
      "787:                     result = true;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "794:                 else if ( EXTERNAL_HTTP_WILDCARD.equals( repo ) && isExternalHttpRepo( originalRepository ) )",
      "795:                 {",
      "796:                     result = true;",
      "798:                 }",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "803:         try",
      "804:         {",
      "805:             URL url = new URL( originalRepository.getUrl() );",
      "808:         }",
      "809:         catch ( MalformedURLException e )",
      "810:         {",
      "",
      "[Removed Lines]",
      "806:             return !( url.getHost().equals( \"localhost\" ) || url.getHost().equals( \"127.0.0.1\" )",
      "807:                             || url.getProtocol().equals( \"file\" ) );",
      "",
      "[Added Lines]",
      "820:             return !( isLocal( url.getHost() ) || url.getProtocol().equals( \"file\" ) );",
      "821:         }",
      "822:         catch ( MalformedURLException e )",
      "823:         {",
      "825:             return false;",
      "826:         }",
      "827:     }",
      "829:     private static boolean isLocal( String host )",
      "830:     {",
      "831:         return \"localhost\".equals( host ) || \"127.0.0.1\".equals( host );",
      "832:     }",
      "840:     static boolean isExternalHttpRepo( ArtifactRepository originalRepository )",
      "841:     {",
      "842:         try",
      "843:         {",
      "844:             URL url = new URL( originalRepository.getUrl() );",
      "845:             return ( \"http\".equalsIgnoreCase( url.getProtocol() ) || \"dav\".equalsIgnoreCase( url.getProtocol() )",
      "846:                 || \"dav:http\".equalsIgnoreCase( url.getProtocol() )",
      "847:                 || \"dav+http\".equalsIgnoreCase( url.getProtocol() ) ) && !isLocal( url.getHost() );",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "1954d51ff2841045b4af8a515ad0719805269d8d",
      "candidate_info": {
        "commit_hash": "1954d51ff2841045b4af8a515ad0719805269d8d",
        "repo": "apache/maven",
        "commit_url": "https://github.com/apache/maven/commit/1954d51ff2841045b4af8a515ad0719805269d8d",
        "files": [
          "maven-core/src/main/java/org/apache/maven/lifecycle/DefaultLifecycles.java",
          "maven-core/src/main/java/org/apache/maven/lifecycle/internal/DefaultLifecyclePluginAnalyzer.java",
          "maven-core/src/main/java/org/apache/maven/lifecycle/internal/MojoExecutor.java",
          "maven-core/src/main/java/org/apache/maven/plugin/DefaultMojosExecutionStrategy.java",
          "maven-core/src/main/java/org/apache/maven/plugin/MojoExecutionRunner.java",
          "maven-core/src/main/java/org/apache/maven/plugin/MojosExecutionStrategy.java",
          "maven-core/src/main/java/org/apache/maven/plugin/internal/DefaultMavenPluginManager.java",
          "maven-core/src/test/java/org/apache/maven/lifecycle/DefaultLifecyclesTest.java",
          "maven-core/src/test/java/org/apache/maven/lifecycle/internal/stub/MojoExecutorStub.java"
        ],
        "message": "[MNG-7391] add execution strategy+runner required by Maven Build Cache",
        "before_after_code_files": [
          "maven-core/src/main/java/org/apache/maven/lifecycle/DefaultLifecycles.java||maven-core/src/main/java/org/apache/maven/lifecycle/DefaultLifecycles.java",
          "maven-core/src/main/java/org/apache/maven/lifecycle/internal/DefaultLifecyclePluginAnalyzer.java||maven-core/src/main/java/org/apache/maven/lifecycle/internal/DefaultLifecyclePluginAnalyzer.java",
          "maven-core/src/main/java/org/apache/maven/lifecycle/internal/MojoExecutor.java||maven-core/src/main/java/org/apache/maven/lifecycle/internal/MojoExecutor.java",
          "maven-core/src/main/java/org/apache/maven/plugin/DefaultMojosExecutionStrategy.java||maven-core/src/main/java/org/apache/maven/plugin/DefaultMojosExecutionStrategy.java",
          "maven-core/src/main/java/org/apache/maven/plugin/MojoExecutionRunner.java||maven-core/src/main/java/org/apache/maven/plugin/MojoExecutionRunner.java",
          "maven-core/src/main/java/org/apache/maven/plugin/MojosExecutionStrategy.java||maven-core/src/main/java/org/apache/maven/plugin/MojosExecutionStrategy.java",
          "maven-core/src/main/java/org/apache/maven/plugin/internal/DefaultMavenPluginManager.java||maven-core/src/main/java/org/apache/maven/plugin/internal/DefaultMavenPluginManager.java",
          "maven-core/src/test/java/org/apache/maven/lifecycle/DefaultLifecyclesTest.java||maven-core/src/test/java/org/apache/maven/lifecycle/DefaultLifecyclesTest.java",
          "maven-core/src/test/java/org/apache/maven/lifecycle/internal/stub/MojoExecutorStub.java||maven-core/src/test/java/org/apache/maven/lifecycle/internal/stub/MojoExecutorStub.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/maven/pull/762"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "maven-core/src/main/java/org/apache/maven/lifecycle/DefaultLifecycles.java||maven-core/src/main/java/org/apache/maven/lifecycle/DefaultLifecycles.java": [
          "File: maven-core/src/main/java/org/apache/maven/lifecycle/DefaultLifecycles.java -> maven-core/src/main/java/org/apache/maven/lifecycle/DefaultLifecycles.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "43: @Component( role = DefaultLifecycles.class )",
          "44: public class DefaultLifecycles",
          "45: {",
          "",
          "[Removed Lines]",
          "46:     public static final String[] STANDARD_LIFECYCLES = { \"default\", \"clean\", \"site\" };",
          "",
          "[Added Lines]",
          "46:     public static final String[] STANDARD_LIFECYCLES = { \"clean\", \"default\", \"site\" };",
          "",
          "---------------"
        ],
        "maven-core/src/main/java/org/apache/maven/lifecycle/internal/DefaultLifecyclePluginAnalyzer.java||maven-core/src/main/java/org/apache/maven/lifecycle/internal/DefaultLifecyclePluginAnalyzer.java": [
          "File: maven-core/src/main/java/org/apache/maven/lifecycle/internal/DefaultLifecyclePluginAnalyzer.java -> maven-core/src/main/java/org/apache/maven/lifecycle/internal/DefaultLifecyclePluginAnalyzer.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "35: import org.codehaus.plexus.util.StringUtils;",
          "36: import org.codehaus.plexus.util.xml.Xpp3Dom;",
          "41: import java.util.HashSet;",
          "42: import java.util.LinkedHashMap;",
          "43: import java.util.List;",
          "",
          "[Removed Lines]",
          "38: import java.util.ArrayList;",
          "39: import java.util.Collections;",
          "40: import java.util.Comparator;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "99:         Map<Plugin, Plugin> plugins = new LinkedHashMap<>();",
          "102:         {",
          "103:             org.apache.maven.lifecycle.mapping.Lifecycle lifecycleConfiguration =",
          "104:                 lifecycleMappingForPackaging.getLifecycles().get( lifecycle.getId() );",
          "",
          "[Removed Lines]",
          "101:         for ( Lifecycle lifecycle : getOrderedLifecycles() )",
          "",
          "[Added Lines]",
          "98:         for ( Lifecycle lifecycle : defaultLifeCycles.getLifeCycles() )",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "131:         return plugins.keySet();",
          "132:     }",
          "153:     private void parseLifecyclePhaseDefinitions( Map<Plugin, Plugin> plugins, String phase, LifecyclePhase goals )",
          "154:     {",
          "155:         String modelId = \"org.apache.maven:maven-core:\" + this.getClass().getPackage().getImplementationVersion()",
          "",
          "[Removed Lines]",
          "134:     private List<Lifecycle> getOrderedLifecycles()",
          "135:     {",
          "138:         List<Lifecycle> lifecycles = new ArrayList<>( defaultLifeCycles.getLifeCycles() );",
          "140:         Collections.sort( lifecycles, new Comparator<Lifecycle>()",
          "141:         {",
          "143:             public int compare( Lifecycle l1, Lifecycle l2 )",
          "144:             {",
          "145:                 return l1.getId().compareTo( l2.getId() );",
          "146:             }",
          "148:         } );",
          "150:         return lifecycles;",
          "151:     }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "maven-core/src/main/java/org/apache/maven/lifecycle/internal/MojoExecutor.java||maven-core/src/main/java/org/apache/maven/lifecycle/internal/MojoExecutor.java": [
          "File: maven-core/src/main/java/org/apache/maven/lifecycle/internal/MojoExecutor.java -> maven-core/src/main/java/org/apache/maven/lifecycle/internal/MojoExecutor.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "30: import org.apache.maven.plugin.MavenPluginManager;",
          "31: import org.apache.maven.plugin.MojoExecution;",
          "32: import org.apache.maven.plugin.MojoExecutionException;",
          "33: import org.apache.maven.plugin.MojoFailureException;",
          "34: import org.apache.maven.plugin.PluginConfigurationException;",
          "35: import org.apache.maven.plugin.PluginIncompatibleException;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "33: import org.apache.maven.plugin.MojoExecutionRunner;",
          "34: import org.apache.maven.plugin.MojosExecutionStrategy;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "86:     private final ReadWriteLock aggregatorLock = new ReentrantReadWriteLock();",
          "88:     public MojoExecutor()",
          "89:     {",
          "90:     }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "90:     @Requirement",
          "91:     private MojosExecutionStrategy mojosExecutionStrategy;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "144:         return Collections.unmodifiableCollection( scopes );",
          "145:     }",
          "148:         throws LifecycleExecutionException",
          "150:     {",
          "156:         {",
          "159:     }",
          "162:                          DependencyContext dependencyContext, PhaseRecorder phaseRecorder )",
          "163:         throws LifecycleExecutionException",
          "164:     {",
          "",
          "[Removed Lines]",
          "147:     public void execute( MavenSession session, List<MojoExecution> mojoExecutions, ProjectIndex projectIndex )",
          "151:         DependencyContext dependencyContext = newDependencyContext( session, mojoExecutions );",
          "153:         PhaseRecorder phaseRecorder = new PhaseRecorder( session.getCurrentProject() );",
          "155:         for ( MojoExecution mojoExecution : mojoExecutions )",
          "157:             execute( session, mojoExecution, projectIndex, dependencyContext, phaseRecorder );",
          "158:         }",
          "161:     public void execute( MavenSession session, MojoExecution mojoExecution, ProjectIndex projectIndex,",
          "",
          "[Added Lines]",
          "152:     public void execute( final MavenSession session,",
          "153:                          final List<MojoExecution> mojoExecutions,",
          "154:                          final ProjectIndex projectIndex )",
          "158:         final DependencyContext dependencyContext = newDependencyContext( session, mojoExecutions );",
          "160:         final PhaseRecorder phaseRecorder = new PhaseRecorder( session.getCurrentProject() );",
          "162:         mojosExecutionStrategy.execute( mojoExecutions, session, new MojoExecutionRunner()",
          "164:             @Override",
          "165:             public void run( MojoExecution mojoExecution ) throws LifecycleExecutionException",
          "166:             {",
          "167:                 MojoExecutor.this.execute( session, mojoExecution, projectIndex, dependencyContext, phaseRecorder );",
          "168:             }",
          "169:         } );",
          "172:     private void execute( MavenSession session, MojoExecution mojoExecution, ProjectIndex projectIndex,",
          "",
          "---------------"
        ],
        "maven-core/src/main/java/org/apache/maven/plugin/DefaultMojosExecutionStrategy.java||maven-core/src/main/java/org/apache/maven/plugin/DefaultMojosExecutionStrategy.java": [
          "File: maven-core/src/main/java/org/apache/maven/plugin/DefaultMojosExecutionStrategy.java -> maven-core/src/main/java/org/apache/maven/plugin/DefaultMojosExecutionStrategy.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: package org.apache.maven.plugin;",
          "22: import org.apache.maven.execution.MavenSession;",
          "23: import org.apache.maven.lifecycle.LifecycleExecutionException;",
          "25: import javax.inject.Named;",
          "26: import javax.inject.Singleton;",
          "27: import java.util.List;",
          "32: @Named",
          "33: @Singleton",
          "34: public class DefaultMojosExecutionStrategy implements MojosExecutionStrategy",
          "35: {",
          "36:     @Override",
          "37:     public void execute( List<MojoExecution> mojos, MavenSession session, MojoExecutionRunner mojoRunner )",
          "38:             throws LifecycleExecutionException",
          "39:     {",
          "40:         for ( MojoExecution mojoExecution : mojos )",
          "41:         {",
          "42:             mojoRunner.run( mojoExecution );",
          "43:         }",
          "45:     }",
          "46: }",
          "",
          "---------------"
        ],
        "maven-core/src/main/java/org/apache/maven/plugin/MojoExecutionRunner.java||maven-core/src/main/java/org/apache/maven/plugin/MojoExecutionRunner.java": [
          "File: maven-core/src/main/java/org/apache/maven/plugin/MojoExecutionRunner.java -> maven-core/src/main/java/org/apache/maven/plugin/MojoExecutionRunner.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: package org.apache.maven.plugin;",
          "22: import org.apache.maven.lifecycle.LifecycleExecutionException;",
          "27: public interface MojoExecutionRunner",
          "28: {",
          "35:     void run( MojoExecution execution ) throws LifecycleExecutionException;",
          "36: }",
          "",
          "---------------"
        ],
        "maven-core/src/main/java/org/apache/maven/plugin/MojosExecutionStrategy.java||maven-core/src/main/java/org/apache/maven/plugin/MojosExecutionStrategy.java": [
          "File: maven-core/src/main/java/org/apache/maven/plugin/MojosExecutionStrategy.java -> maven-core/src/main/java/org/apache/maven/plugin/MojosExecutionStrategy.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: package org.apache.maven.plugin;",
          "22: import org.apache.maven.execution.MavenSession;",
          "23: import org.apache.maven.lifecycle.LifecycleExecutionException;",
          "25: import java.util.List;",
          "31: public interface MojosExecutionStrategy",
          "32: {",
          "42:     void execute( List<MojoExecution> mojos, MavenSession session, MojoExecutionRunner mojoExecutionRunner )",
          "43:             throws LifecycleExecutionException;",
          "45: }",
          "",
          "---------------"
        ],
        "maven-core/src/main/java/org/apache/maven/plugin/internal/DefaultMavenPluginManager.java||maven-core/src/main/java/org/apache/maven/plugin/internal/DefaultMavenPluginManager.java": [
          "File: maven-core/src/main/java/org/apache/maven/plugin/internal/DefaultMavenPluginManager.java -> maven-core/src/main/java/org/apache/maven/plugin/internal/DefaultMavenPluginManager.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "499:         ClassRealm pluginRealm = pluginDescriptor.getClassRealm();",
          "501:         if ( logger.isDebugEnabled() )",
          "502:         {",
          "503:             logger.debug( \"Configuring mojo \" + mojoDescriptor.getId() + \" from plugin realm \" + pluginRealm );",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "501:         if ( pluginRealm == null )",
          "502:         {",
          "503:             try",
          "504:             {",
          "505:                 setupPluginRealm( pluginDescriptor, session, null, null, null );",
          "506:             }",
          "507:             catch ( PluginResolutionException e )",
          "508:             {",
          "509:                 String msg = \"Cannot setup plugin realm [mojoDescriptor=\" + mojoDescriptor.getId()",
          "510:                         + \", pluginDescriptor=\" + pluginDescriptor.getId() + \"]\";",
          "511:                 throw new PluginConfigurationException( pluginDescriptor, msg, e );",
          "512:             }",
          "513:             pluginRealm = pluginDescriptor.getClassRealm();",
          "514:         }",
          "",
          "---------------"
        ],
        "maven-core/src/test/java/org/apache/maven/lifecycle/DefaultLifecyclesTest.java||maven-core/src/test/java/org/apache/maven/lifecycle/DefaultLifecyclesTest.java": [
          "File: maven-core/src/test/java/org/apache/maven/lifecycle/DefaultLifecyclesTest.java -> maven-core/src/test/java/org/apache/maven/lifecycle/DefaultLifecyclesTest.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "50:     {",
          "51:         final List<Lifecycle> cycles = defaultLifeCycles.getLifeCycles();",
          "52:         assertNotNull( cycles );",
          "57:     }",
          "",
          "[Removed Lines]",
          "53:         final Lifecycle lifecycle = cycles.get( 0 );",
          "54:         assertEquals( \"default\", lifecycle.getId() );",
          "55:         assertEquals( 23, lifecycle.getPhases().size() );",
          "",
          "[Added Lines]",
          "53:         final Lifecycle lifecycle0 = cycles.get( 0 );",
          "54:         assertEquals( \"clean\", lifecycle0.getId() );",
          "55:         final Lifecycle lifecycle1 = cycles.get( 1 );",
          "56:         assertEquals( \"default\", lifecycle1.getId() );",
          "57:         assertEquals( 23, lifecycle1.getPhases().size() );",
          "",
          "---------------"
        ],
        "maven-core/src/test/java/org/apache/maven/lifecycle/internal/stub/MojoExecutorStub.java||maven-core/src/test/java/org/apache/maven/lifecycle/internal/stub/MojoExecutorStub.java": [
          "File: maven-core/src/test/java/org/apache/maven/lifecycle/internal/stub/MojoExecutorStub.java -> maven-core/src/test/java/org/apache/maven/lifecycle/internal/stub/MojoExecutorStub.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "18: import org.apache.maven.execution.MavenSession;",
          "19: import org.apache.maven.lifecycle.LifecycleExecutionException;",
          "21: import org.apache.maven.lifecycle.internal.MojoExecutor;",
          "23: import org.apache.maven.lifecycle.internal.ProjectIndex;",
          "24: import org.apache.maven.model.Plugin;",
          "25: import org.apache.maven.plugin.MojoExecution;",
          "26: import org.apache.maven.plugin.descriptor.MojoDescriptor;",
          "27: import org.apache.maven.plugin.descriptor.PluginDescriptor;",
          "29: import java.util.ArrayList;",
          "30: import java.util.Collections;",
          "",
          "[Removed Lines]",
          "20: import org.apache.maven.lifecycle.internal.DependencyContext;",
          "22: import org.apache.maven.lifecycle.internal.PhaseRecorder;",
          "",
          "[Added Lines]",
          "26: import org.apache.maven.project.MavenProject;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "40:     public List<MojoExecution> executions = Collections.synchronizedList( new ArrayList<MojoExecution>() );",
          "42:     @Override",
          "45:         throws LifecycleExecutionException",
          "46:     {",
          "48:     }",
          "50:     @Override",
          "53:     {",
          "55:     }",
          "",
          "[Removed Lines]",
          "43:     public void execute( MavenSession session, MojoExecution mojoExecution, ProjectIndex projectIndex,",
          "44:                          DependencyContext dependencyContext, PhaseRecorder phaseRecorder )",
          "47:         executions.add( mojoExecution );",
          "51:     public void execute( MavenSession session, List<MojoExecution> mojoExecutions, ProjectIndex projectIndex )",
          "52:         throws LifecycleExecutionException",
          "54:         executions.addAll(mojoExecutions);",
          "",
          "[Added Lines]",
          "42:     public void execute( MavenSession session, List<MojoExecution> mojoExecutions, ProjectIndex projectIndex )",
          "45:         executions.addAll( mojoExecutions );",
          "49:     public List<MavenProject> executeForkedExecutions( MojoExecution mojoExecution, MavenSession session, ProjectIndex projectIndex ) throws LifecycleExecutionException",
          "51:         return null;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "3b21386c3f1ab85060f6c950fb2fb17123df8647",
      "candidate_info": {
        "commit_hash": "3b21386c3f1ab85060f6c950fb2fb17123df8647",
        "repo": "apache/maven",
        "commit_url": "https://github.com/apache/maven/commit/3b21386c3f1ab85060f6c950fb2fb17123df8647",
        "files": [
          "maven-compat/src/main/java/org/apache/maven/repository/DefaultMirrorSelector.java",
          "maven-core/src/main/java/org/apache/maven/bridge/MavenRepositorySystem.java"
        ],
        "message": "[MNG-7116] add support for mirrorOf external:http:*",
        "before_after_code_files": [
          "maven-compat/src/main/java/org/apache/maven/repository/DefaultMirrorSelector.java||maven-compat/src/main/java/org/apache/maven/repository/DefaultMirrorSelector.java",
          "maven-core/src/main/java/org/apache/maven/bridge/MavenRepositorySystem.java||maven-core/src/main/java/org/apache/maven/bridge/MavenRepositorySystem.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "maven-compat/src/main/java/org/apache/maven/repository/DefaultMirrorSelector.java||maven-compat/src/main/java/org/apache/maven/repository/DefaultMirrorSelector.java",
            "maven-core/src/main/java/org/apache/maven/bridge/MavenRepositorySystem.java||maven-core/src/main/java/org/apache/maven/bridge/MavenRepositorySystem.java"
          ],
          "candidate": [
            "maven-compat/src/main/java/org/apache/maven/repository/DefaultMirrorSelector.java||maven-compat/src/main/java/org/apache/maven/repository/DefaultMirrorSelector.java",
            "maven-core/src/main/java/org/apache/maven/bridge/MavenRepositorySystem.java||maven-core/src/main/java/org/apache/maven/bridge/MavenRepositorySystem.java"
          ]
        }
      },
      "candidate_diff": {
        "maven-compat/src/main/java/org/apache/maven/repository/DefaultMirrorSelector.java||maven-compat/src/main/java/org/apache/maven/repository/DefaultMirrorSelector.java": [
          "File: maven-compat/src/main/java/org/apache/maven/repository/DefaultMirrorSelector.java -> maven-compat/src/main/java/org/apache/maven/repository/DefaultMirrorSelector.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "42:     private static final String EXTERNAL_WILDCARD = \"external:*\";",
          "44:     public Mirror getMirror( ArtifactRepository repository, List<Mirror> mirrors )",
          "45:     {",
          "46:         String repoId = repository.getId();",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "44:     private static final String EXTERNAL_HTTP_WILDCARD = \"external:http:*\";",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "119:                     result = true;",
          "121:                 }",
          "122:                 else if ( WILDCARD.equals( repo ) )",
          "123:                 {",
          "124:                     result = true;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "126:                 else if ( EXTERNAL_HTTP_WILDCARD.equals( repo ) && isExternalHttpRepo( originalRepository ) )",
          "127:                 {",
          "128:                     result = true;",
          "130:                 }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "140:         try",
          "141:         {",
          "142:             URL url = new URL( originalRepository.getUrl() );",
          "145:         }",
          "146:         catch ( MalformedURLException e )",
          "147:         {",
          "",
          "[Removed Lines]",
          "143:             return !( url.getHost().equals( \"localhost\" ) || url.getHost().equals( \"127.0.0.1\" )",
          "144:                             || url.getProtocol().equals( \"file\" ) );",
          "",
          "[Added Lines]",
          "152:             return !( isLocal( url.getHost() ) || url.getProtocol().equals( \"file\" ) );",
          "153:         }",
          "154:         catch ( MalformedURLException e )",
          "155:         {",
          "157:             return false;",
          "158:         }",
          "159:     }",
          "161:     private static boolean isLocal( String host )",
          "162:     {",
          "163:         return \"localhost\".equals( host ) || \"127.0.0.1\".equals( host );",
          "164:     }",
          "172:     static boolean isExternalHttpRepo( ArtifactRepository originalRepository )",
          "173:     {",
          "174:         try",
          "175:         {",
          "176:             URL url = new URL( originalRepository.getUrl() );",
          "177:             return ( \"http\".equalsIgnoreCase( url.getProtocol() ) || \"dav\".equalsIgnoreCase( url.getProtocol() )",
          "178:                 || \"dav:http\".equalsIgnoreCase( url.getProtocol() )",
          "179:                 || \"dav+http\".equalsIgnoreCase( url.getProtocol() ) ) && !isLocal( url.getHost() );",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "150:         }",
          "151:     }",
          "154:     {",
          "155:         return matchesLayout( RepositoryUtils.getLayout( repository ), mirror.getMirrorOfLayouts() );",
          "156:     }",
          "",
          "[Removed Lines]",
          "153:     static boolean matchesLayout( ArtifactRepository repository, Mirror mirror )",
          "",
          "[Added Lines]",
          "188:    static boolean matchesLayout( ArtifactRepository repository, Mirror mirror )",
          "",
          "---------------"
        ],
        "maven-core/src/main/java/org/apache/maven/bridge/MavenRepositorySystem.java||maven-core/src/main/java/org/apache/maven/bridge/MavenRepositorySystem.java": [
          "File: maven-core/src/main/java/org/apache/maven/bridge/MavenRepositorySystem.java -> maven-core/src/main/java/org/apache/maven/bridge/MavenRepositorySystem.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "714:     private static final String EXTERNAL_WILDCARD = \"external:*\";",
          "716:     public static Mirror getMirror( ArtifactRepository repository, List<Mirror> mirrors )",
          "717:     {",
          "718:         String repoId = repository.getId();",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "716:     private static final String EXTERNAL_HTTP_WILDCARD = \"external:http:*\";",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "790:                     result = true;",
          "792:                 }",
          "793:                 else if ( WILDCARD.equals( repo ) )",
          "794:                 {",
          "795:                     result = true;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "797:                 else if ( EXTERNAL_HTTP_WILDCARD.equals( repo ) && isExternalHttpRepo( originalRepository ) )",
          "798:                 {",
          "799:                     result = true;",
          "801:                 }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "811:         try",
          "812:         {",
          "813:             URL url = new URL( originalRepository.getUrl() );",
          "816:         }",
          "817:         catch ( MalformedURLException e )",
          "818:         {",
          "",
          "[Removed Lines]",
          "814:             return !( url.getHost().equals( \"localhost\" ) || url.getHost().equals( \"127.0.0.1\" )",
          "815:                             || url.getProtocol().equals( \"file\" ) );",
          "",
          "[Added Lines]",
          "823:             return !( isLocal( url.getHost() ) || url.getProtocol().equals( \"file\" ) );",
          "824:         }",
          "825:         catch ( MalformedURLException e )",
          "826:         {",
          "828:             return false;",
          "829:         }",
          "830:     }",
          "832:     private static boolean isLocal( String host )",
          "833:     {",
          "834:         return \"localhost\".equals( host ) || \"127.0.0.1\".equals( host );",
          "835:     }",
          "843:     static boolean isExternalHttpRepo( ArtifactRepository originalRepository )",
          "844:     {",
          "845:         try",
          "846:         {",
          "847:             URL url = new URL( originalRepository.getUrl() );",
          "848:             return ( \"http\".equalsIgnoreCase( url.getProtocol() ) || \"dav\".equalsIgnoreCase( url.getProtocol() )",
          "849:                 || \"dav:http\".equalsIgnoreCase( url.getProtocol() )",
          "850:                 || \"dav+http\".equalsIgnoreCase( url.getProtocol() ) ) && !isLocal( url.getHost() );",
          "",
          "---------------"
        ]
      }
    }
  ]
}