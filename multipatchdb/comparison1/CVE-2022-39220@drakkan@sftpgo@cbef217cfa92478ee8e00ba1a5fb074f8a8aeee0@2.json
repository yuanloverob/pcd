{
  "cve_id": "CVE-2022-39220",
  "cve_desc": "SFTPGo is an SFTP server written in Go. Versions prior to 2.3.5 are subject to Cross-site scripting (XSS) vulnerabilities in the SFTPGo WebClient, allowing remote attackers to inject malicious code. This issue is patched in version 2.3.5. No known workarounds exist.",
  "repo": "drakkan/sftpgo",
  "patch_hash": "cbef217cfa92478ee8e00ba1a5fb074f8a8aeee0",
  "patch_info": {
    "commit_hash": "cbef217cfa92478ee8e00ba1a5fb074f8a8aeee0",
    "repo": "drakkan/sftpgo",
    "commit_url": "https://github.com/drakkan/sftpgo/commit/cbef217cfa92478ee8e00ba1a5fb074f8a8aeee0",
    "files": [
      "templates/webadmin/base.html",
      "templates/webclient/base.html",
      "templates/webclient/files.html",
      "templates/webclient/sharefiles.html",
      "templates/webclient/shareupload.html"
    ],
    "message": "WebClient: improve HTML escaping\n\nSigned-off-by: Nicola Murino <nicola.murino@gmail.com>",
    "before_after_code_files": [
      "templates/webadmin/base.html||templates/webadmin/base.html",
      "templates/webclient/base.html||templates/webclient/base.html",
      "templates/webclient/files.html||templates/webclient/files.html",
      "templates/webclient/sharefiles.html||templates/webclient/sharefiles.html",
      "templates/webclient/shareupload.html||templates/webclient/shareupload.html"
    ]
  },
  "patch_diff": {
    "templates/webadmin/base.html||templates/webadmin/base.html": [
      "File: templates/webadmin/base.html -> templates/webadmin/base.html",
      "--- Hunk 1 ---",
      "[Context before]",
      "265:     <script src=\"{{.StaticURL}}/js/sb-admin-2.min.js\"></script>",
      "267:     <script type=\"text/javascript\">",
      "268:         function fixedEncodeURIComponent(str) {",
      "270:                 return '%' + c.charCodeAt(0).toString(16);",
      "271:             });",
      "272:         }",
      "",
      "[Removed Lines]",
      "269:             return encodeURIComponent(str).replace(/[!'()*]/g, function (c) {",
      "",
      "[Added Lines]",
      "268:         function escapeHTML(str) {",
      "269:             var div = document.createElement('div');",
      "270:             div.appendChild(document.createTextNode(str));",
      "271:             return div.innerHTML;",
      "272:         }",
      "274:         function unescapeHTML(escapedStr) {",
      "275:             var div = document.createElement('div');",
      "276:             div.innerHTML = escapedStr;",
      "277:             var child = div.childNodes[0];",
      "278:             return child ? child.nodeValue : '';",
      "279:         }",
      "282:             return encodeURIComponent(unescapeHTML(str)).replace(/[!'()*]/g, function (c) {",
      "",
      "---------------"
    ],
    "templates/webclient/base.html||templates/webclient/base.html": [
      "File: templates/webclient/base.html -> templates/webclient/base.html",
      "--- Hunk 1 ---",
      "[Context before]",
      "219:     <script src=\"{{.StaticURL}}/js/sb-admin-2.min.js\"></script>",
      "221:     <script type=\"text/javascript\">",
      "222:         function fixedEncodeURIComponent(str) {",
      "224:                 return '%' + c.charCodeAt(0).toString(16);",
      "225:             });",
      "226:         }",
      "",
      "[Removed Lines]",
      "223:             return encodeURIComponent(str).replace(/[!'()*]/g, function (c) {",
      "",
      "[Added Lines]",
      "222:         function escapeHTML(str) {",
      "223:             var div = document.createElement('div');",
      "224:             div.appendChild(document.createTextNode(str));",
      "225:             return div.innerHTML;",
      "226:         }",
      "228:         function unescapeHTML(escapedStr) {",
      "229:             var div = document.createElement('div');",
      "230:             div.innerHTML = escapedStr;",
      "231:             var child = div.childNodes[0];",
      "232:             return child ? child.nodeValue : '';",
      "233:         }",
      "235:         function escapeHTMLForceSafe(str) {",
      "236:             return str",
      "237:                 .replace(/&/g, '_')",
      "238:                 .replace(/</g, '_')",
      "239:                 .replace(/>/g, '_')",
      "240:                 .replace(/\\\"/g, '_')",
      "241:                 .replace(/\\'/g, '_');",
      "242:         }",
      "245:             return encodeURIComponent(unescapeHTML(str)).replace(/[!'()*]/g, function (c) {",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "229:             return str.replace(/\\//g,'\\u2215');",
      "230:         }",
      "239:     </script>",
      "241:     <!-- Page level plugins -->",
      "",
      "[Removed Lines]",
      "232:         var escapeHTML = function ( t ) {",
      "233:       return t",
      "234:        .replace( /&/g, '&amp;' )",
      "235:        .replace( /</g, '&lt;' )",
      "236:        .replace( />/g, '&gt;' )",
      "237:        .replace( /\"/g, '&quot;' );",
      "238:          };",
      "",
      "[Added Lines]",
      "254:         function b64EncodeUnicode(str) {",
      "255:             return btoa(encodeURIComponent(str));",
      "256:         }",
      "258:         function UnicodeDecodeB64(str) {",
      "259:             return decodeURIComponent(atob(str));",
      "260:         }",
      "",
      "---------------"
    ],
    "templates/webclient/files.html||templates/webclient/files.html": [
      "File: templates/webclient/files.html -> templates/webclient/files.html",
      "--- Hunk 1 ---",
      "[Context before]",
      "239:         if (childReference == null || childReference.closed) {",
      "240:             childProps.set('link', fileLink);",
      "241:             childProps.set('url', url);",
      "243:             childReference = window.open(url, '_blank');",
      "244:             if (!checkerStarted){",
      "245:                 keepAlive();",
      "",
      "[Removed Lines]",
      "242:             childProps.set('file_name', fileName);",
      "",
      "[Added Lines]",
      "242:             childProps.set('file_name', UnicodeDecodeB64(fileName));",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "367:                 async function saveBlob() {",
      "368:                     var errorMessage = \"Error saving external file\";",
      "370:                     let response;",
      "371:                     try {",
      "372:                         response = await fetch(uploadPath, {",
      "",
      "[Removed Lines]",
      "369:                     var uploadPath = '{{.FileURL}}?path={{.CurrentDir}}'+encodeURIComponent(\"/\"+childProps.get('file_name'));",
      "",
      "[Added Lines]",
      "369:                     var uploadPath = '{{.FileURL}}?path={{.CurrentDir}}'+encodeURIComponent(\"/\"+unescapeHTML(childProps.get('file_name')));",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "447:     }",
      "449:     function openVideoPlayer(name, url, videoType){",
      "451:         $('#videoModal').modal('show');",
      "452:         player.src({",
      "453:             type: videoType,",
      "",
      "[Removed Lines]",
      "450:         $(\"#video_title\").text(name);",
      "",
      "[Added Lines]",
      "450:         $(\"#video_title\").text(UnicodeDecodeB64(name));",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "995:                             var title = \"\";",
      "996:                             var cssClass = \"\";",
      "997:                             var shortened = shortenData(data, 70);",
      "998:                             if (shortened != data){",
      "1000:                                 cssClass = \"ellipsis\";",
      "1001:                             }",
      "",
      "[Removed Lines]",
      "999:                                 title = escapeHTML(data);",
      "",
      "[Added Lines]",
      "998:                             data = escapeHTML(data);",
      "1000:                                 title = data;",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "1017:                 { \"data\": \"edit_url\",",
      "1018:                     \"render\": function (data, type, row) {",
      "1019:                         if (type === 'display') {",
      "1021:                             var extension = filename.slice((filename.lastIndexOf(\".\") - 1 >>> 0) + 2).toLowerCase();",
      "1022:                             if (data){",
      "1023:                                 if (extension == \"csv\" || extension == \"bat\" || CodeMirror.findModeByExtension(extension) != null){",
      "",
      "[Removed Lines]",
      "1020:                             var filename = row[\"name\"];",
      "",
      "[Added Lines]",
      "1021:                             var filename = escapeHTML(row[\"name\"]);",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "1039:                                     case \"svg\":",
      "1040:                                     case \"ico\":",
      "1041:                                         var view_url = row['url']+\"&inline=1\";",
      "1043:                                     case \"mp4\":",
      "1044:                                     case \"mov\":",
      "1046:                                     case \"webm\":",
      "1048:                                     case \"ogv\":",
      "1049:                                     case \"ogg\":",
      "1051:                                     case \"pdf\":",
      "1052:                                         if (PDFObject.supportsPDFs){",
      "1053:                                             var view_url = row['url'];",
      "",
      "[Removed Lines]",
      "1042:                                         return `<a href=\"${view_url}\" data-lightbox=\"image-gallery\" data-title=\"${filename}\"><i class=\"fas fa-eye\"></i></a>`;",
      "1045:                                         return `<a href=\"#\" onclick=\"openVideoPlayer('${row[\"name\"]}', '${row['url']}', 'video/mp4');\"><i class=\"fas fa-eye\"></i></a>`;",
      "1047:                                         return `<a href=\"#\" onclick=\"openVideoPlayer('${row[\"name\"]}', '${row['url']}', 'video/webm');\"><i class=\"fas fa-eye\"></i></a>`;",
      "1050:                                         return `<a href=\"#\" onclick=\"openVideoPlayer('${row[\"name\"]}', '${row['url']}', 'video/ogg');\"><i class=\"fas fa-eye\"></i></a>`;",
      "",
      "[Added Lines]",
      "1043:                                         var title = escapeHTMLForceSafe(row[\"name\"])",
      "1044:                                         return `<a href=\"${view_url}\" data-lightbox=\"image-gallery\" data-title=\"${title}\"><i class=\"fas fa-eye\"></i></a>`;",
      "1047:                                         var name = b64EncodeUnicode(row[\"name\"]);",
      "1048:                                         return `<a href=\"#\" onclick=\"openVideoPlayer('${name}', '${row['url']}', 'video/mp4');\"><i class=\"fas fa-eye\"></i></a>`;",
      "1050:                                         var name = b64EncodeUnicode(row[\"name\"]);",
      "1051:                                         return `<a href=\"#\" onclick=\"openVideoPlayer('${name}', '${row['url']}', 'video/webm');\"><i class=\"fas fa-eye\"></i></a>`;",
      "1054:                                         var name = b64EncodeUnicode(row[\"name\"]);",
      "1055:                                         return `<a href=\"#\" onclick=\"openVideoPlayer('${name}}', '${row['url']}', 'video/ogg');\"><i class=\"fas fa-eye\"></i></a>`;",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "1065:                         {{if .HasIntegrations}}",
      "1066:                         if (type === 'display') {",
      "1067:                             if (data){",
      "1069:                             }",
      "1070:                         }",
      "1071:                         {{end}}",
      "",
      "[Removed Lines]",
      "1068:                                 return `<a href=\"#\" onclick=\"openExternalURL('${data}', '${row[\"ext_link\"]}', '${row[\"name\"]}');\"><i class=\"fas fa-external-link-alt\"></i></a>`;",
      "",
      "[Added Lines]",
      "1073:                                 var name = b64EncodeUnicode(escapeHTML(row[\"name\"]));",
      "1074:                                 return `<a href=\"#\" onclick=\"openExternalURL('${data}', '${row[\"ext_link\"]}', '${name}');\"><i class=\"fas fa-external-link-alt\"></i></a>`;",
      "",
      "---------------"
    ],
    "templates/webclient/sharefiles.html||templates/webclient/sharefiles.html": [
      "File: templates/webclient/sharefiles.html -> templates/webclient/sharefiles.html",
      "--- Hunk 1 ---",
      "[Context before]",
      "94: <script src=\"{{.StaticURL}}/vendor/datatables/dataTables.responsive.min.js\"></script>",
      "95: <script src=\"{{.StaticURL}}/vendor/datatables/responsive.bootstrap4.min.js\"></script>",
      "96: <script type=\"text/javascript\">",
      "106:     function shortenData(d, cutoff) {",
      "107:         if ( typeof d !== 'string' ) {",
      "108:    return d;",
      "109:   }",
      "111:   if ( d.length <= cutoff ) {",
      "113:   }",
      "115:         var shortened = d.substr(0, cutoff-1);",
      "117:     }",
      "119:     function getIconForFile(filename) {",
      "",
      "[Removed Lines]",
      "98:     var escapeHTML = function ( t ) {",
      "99:   return t",
      "100:    .replace( /&/g, '&amp;' )",
      "101:    .replace( /</g, '&lt;' )",
      "102:    .replace( />/g, '&gt;' )",
      "103:    .replace( /\"/g, '&quot;' );",
      "104:  };",
      "112:    return d;",
      "116:         return shortened+'&#8230;';",
      "",
      "[Added Lines]",
      "103:    return escapeHTML(d);",
      "107:         return escapeHTML(shortened)+'&#8230;';",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "250:                     let response;",
      "251:                     try {",
      "252:                         var f = files[index];",
      "254:                         var lastModified;",
      "255:                         try {",
      "256:                             lastModified = f.lastModified;",
      "",
      "[Removed Lines]",
      "253:                         var uploadPath = '{{.UploadBaseURL}}'+fixedEncodeURIComponent(\"/\"+f.name);",
      "",
      "[Added Lines]",
      "244:                         var uploadPath = '{{.UploadBaseURL}}'+fixedEncodeURIComponent(\"/\"+escapeHTML(f.name));",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "384:                             var title = \"\";",
      "385:                             var cssClass = \"\";",
      "386:                             var shortened = shortenData(data, 70);",
      "387:                             if (shortened != data){",
      "388:                                 title = escapeHTML(data);",
      "389:                                 cssClass = \"ellipsis\";",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "378:                             data = escapeHTML(data);",
      "",
      "---------------"
    ],
    "templates/webclient/shareupload.html||templates/webclient/shareupload.html": [
      "File: templates/webclient/shareupload.html -> templates/webclient/shareupload.html",
      "--- Hunk 1 ---",
      "[Context before]",
      "99:                     let response;",
      "100:                     try {",
      "101:                         var f = files[index];",
      "103:                         var lastModified;",
      "104:                         try {",
      "105:                             lastModified = f.lastModified;",
      "",
      "[Removed Lines]",
      "102:                         var uploadPath = '{{.UploadBasePath}}/'+fixedEncodeURIComponent(f.name);",
      "",
      "[Added Lines]",
      "102:                         var uploadPath = '{{.UploadBasePath}}/'+fixedEncodeURIComponent(escapeHTML(f.name));",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "f8a19f747dd6ec556e5f5ef2a15e535a00242189",
      "candidate_info": {
        "commit_hash": "f8a19f747dd6ec556e5f5ef2a15e535a00242189",
        "repo": "drakkan/sftpgo",
        "commit_url": "https://github.com/drakkan/sftpgo/commit/f8a19f747dd6ec556e5f5ef2a15e535a00242189",
        "files": [
          "templates/webadmin/base.html",
          "templates/webclient/base.html",
          "templates/webclient/files.html",
          "templates/webclient/sharefiles.html",
          "templates/webclient/shareupload.html"
        ],
        "message": "WebUI: improve HTML escaping\n\nSigned-off-by: Nicola Murino <nicola.murino@gmail.com>",
        "before_after_code_files": [
          "templates/webadmin/base.html||templates/webadmin/base.html",
          "templates/webclient/base.html||templates/webclient/base.html",
          "templates/webclient/files.html||templates/webclient/files.html",
          "templates/webclient/sharefiles.html||templates/webclient/sharefiles.html",
          "templates/webclient/shareupload.html||templates/webclient/shareupload.html"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_olp_changes": 1,
        "olp_code_files": {
          "patch": [
            "templates/webadmin/base.html||templates/webadmin/base.html",
            "templates/webclient/base.html||templates/webclient/base.html",
            "templates/webclient/files.html||templates/webclient/files.html",
            "templates/webclient/sharefiles.html||templates/webclient/sharefiles.html",
            "templates/webclient/shareupload.html||templates/webclient/shareupload.html"
          ],
          "candidate": [
            "templates/webadmin/base.html||templates/webadmin/base.html",
            "templates/webclient/base.html||templates/webclient/base.html",
            "templates/webclient/files.html||templates/webclient/files.html",
            "templates/webclient/sharefiles.html||templates/webclient/sharefiles.html",
            "templates/webclient/shareupload.html||templates/webclient/shareupload.html"
          ]
        }
      },
      "candidate_diff": {
        "templates/webadmin/base.html||templates/webadmin/base.html": [
          "File: templates/webadmin/base.html -> templates/webadmin/base.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "282:     <script src=\"{{.StaticURL}}/js/sb-admin-2.min.js\"></script>",
          "284:     <script type=\"text/javascript\">",
          "285:         function fixedEncodeURIComponent(str) {",
          "287:                 return '%' + c.charCodeAt(0).toString(16);",
          "288:             });",
          "289:         }",
          "",
          "[Removed Lines]",
          "286:             return encodeURIComponent(str).replace(/[!'()*]/g, function (c) {",
          "",
          "[Added Lines]",
          "285:         function escapeHTML(str) {",
          "286:             var div = document.createElement('div');",
          "287:             div.appendChild(document.createTextNode(str));",
          "288:             return div.innerHTML;",
          "289:         }",
          "291:         function unescapeHTML(escapedStr) {",
          "292:             var div = document.createElement('div');",
          "293:             div.innerHTML = escapedStr;",
          "294:             var child = div.childNodes[0];",
          "295:             return child ? child.nodeValue : '';",
          "296:         }",
          "299:             return encodeURIComponent(unescapeHTML(str)).replace(/[!'()*]/g, function (c) {",
          "",
          "---------------"
        ],
        "templates/webclient/base.html||templates/webclient/base.html": [
          "File: templates/webclient/base.html -> templates/webclient/base.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "219:     <script src=\"{{.StaticURL}}/js/sb-admin-2.min.js\"></script>",
          "221:     <script type=\"text/javascript\">",
          "222:         function fixedEncodeURIComponent(str) {",
          "224:                 return '%' + c.charCodeAt(0).toString(16);",
          "225:             });",
          "226:         }",
          "",
          "[Removed Lines]",
          "223:             return encodeURIComponent(str).replace(/[!'()*]/g, function (c) {",
          "",
          "[Added Lines]",
          "222:         function escapeHTML(str) {",
          "223:             var div = document.createElement('div');",
          "224:             div.appendChild(document.createTextNode(str));",
          "225:             return div.innerHTML;",
          "226:         }",
          "228:         function unescapeHTML(escapedStr) {",
          "229:             var div = document.createElement('div');",
          "230:             div.innerHTML = escapedStr;",
          "231:             var child = div.childNodes[0];",
          "232:             return child ? child.nodeValue : '';",
          "233:         }",
          "235:         function escapeHTMLForceSafe(str) {",
          "236:             return str",
          "237:                 .replace(/&/g, '_')",
          "238:                 .replace(/</g, '_')",
          "239:                 .replace(/>/g, '_')",
          "240:                 .replace(/\\\"/g, '_')",
          "241:                 .replace(/\\'/g, '_');",
          "242:         }",
          "245:             return encodeURIComponent(unescapeHTML(str)).replace(/[!'()*]/g, function (c) {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "228:         function replaceSlash(str){",
          "229:             return str.replace(/\\//g,'\\u2215');",
          "230:         }",
          "231:     </script>",
          "233:     <!-- Page level plugins -->",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "254:         function b64EncodeUnicode(str) {",
          "255:             return btoa(encodeURIComponent(str));",
          "256:         }",
          "258:         function UnicodeDecodeB64(str) {",
          "259:             return decodeURIComponent(atob(str));",
          "260:         }",
          "",
          "---------------"
        ],
        "templates/webclient/files.html||templates/webclient/files.html": [
          "File: templates/webclient/files.html -> templates/webclient/files.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "239:         if (childReference == null || childReference.closed) {",
          "240:             childProps.set('link', fileLink);",
          "241:             childProps.set('url', url);",
          "243:             childReference = window.open(url, '_blank');",
          "244:             if (!checkerStarted){",
          "245:                 keepAlive();",
          "",
          "[Removed Lines]",
          "242:             childProps.set('file_name', fileName);",
          "",
          "[Added Lines]",
          "242:             childProps.set('file_name', UnicodeDecodeB64(fileName));",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "367:                 async function saveBlob() {",
          "368:                     var errorMessage = \"Error saving external file\";",
          "370:                     let response;",
          "371:                     try {",
          "372:                         response = await fetch(uploadPath, {",
          "",
          "[Removed Lines]",
          "369:                     var uploadPath = '{{.FileURL}}?path={{.CurrentDir}}'+encodeURIComponent(\"/\"+childProps.get('file_name'));",
          "",
          "[Added Lines]",
          "369:                     var uploadPath = '{{.FileURL}}?path={{.CurrentDir}}'+encodeURIComponent(\"/\"+unescapeHTML(childProps.get('file_name')));",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "433:     var player;",
          "434:     var playerKeepAlive;",
          "444:     function shortenData(d, cutoff) {",
          "445:         if ( typeof d !== 'string' ) {",
          "446:    return d;",
          "447:   }",
          "449:   if ( d.length <= cutoff ) {",
          "451:   }",
          "453:         var shortened = d.substr(0, cutoff-1);",
          "455:     }",
          "457:     function openVideoPlayer(name, url, videoType){",
          "459:         $('#videoModal').modal('show');",
          "460:         player.src({",
          "461:             type: videoType,",
          "",
          "[Removed Lines]",
          "436:     var escapeHTML = function ( t ) {",
          "437:   return t",
          "438:    .replace( /&/g, '&amp;' )",
          "439:    .replace( /</g, '&lt;' )",
          "440:    .replace( />/g, '&gt;' )",
          "441:    .replace( /\"/g, '&quot;' );",
          "442:  };",
          "450:    return d;",
          "454:         return shortened+'&#8230;';",
          "458:         $(\"#video_title\").text(name);",
          "",
          "[Added Lines]",
          "442:    return escapeHTML(d);",
          "446:         return escapeHTML(shortened)+'&#8230;';",
          "450:         $(\"#video_title\").text(UnicodeDecodeB64(name));",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1003:                             var title = \"\";",
          "1004:                             var cssClass = \"\";",
          "1005:                             var shortened = shortenData(data, 70);",
          "1006:                             if (shortened != data){",
          "1008:                                 cssClass = \"ellipsis\";",
          "1009:                             }",
          "",
          "[Removed Lines]",
          "1007:                                 title = escapeHTML(data);",
          "",
          "[Added Lines]",
          "998:                             data = escapeHTML(data);",
          "1000:                                 title = data;",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1025:                 { \"data\": \"edit_url\",",
          "1026:                     \"render\": function (data, type, row) {",
          "1027:                         if (type === 'display') {",
          "1029:                             var extension = filename.slice((filename.lastIndexOf(\".\") - 1 >>> 0) + 2).toLowerCase();",
          "1030:                             if (data){",
          "1031:                                 if (extension == \"csv\" || extension == \"bat\" || CodeMirror.findModeByExtension(extension) != null){",
          "",
          "[Removed Lines]",
          "1028:                             var filename = row[\"name\"];",
          "",
          "[Added Lines]",
          "1021:                             var filename = escapeHTML(row[\"name\"]);",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "1047:                                     case \"svg\":",
          "1048:                                     case \"ico\":",
          "1049:                                         var view_url = row['url']+\"&inline=1\";",
          "1051:                                     case \"mp4\":",
          "1052:                                     case \"mov\":",
          "1054:                                     case \"webm\":",
          "1056:                                     case \"ogv\":",
          "1057:                                     case \"ogg\":",
          "1059:                                     case \"pdf\":",
          "1060:                                         if (PDFObject.supportsPDFs){",
          "1061:                                             var view_url = row['url'];",
          "",
          "[Removed Lines]",
          "1050:                                         return `<a href=\"${view_url}\" data-lightbox=\"image-gallery\" data-title=\"${filename}\"><i class=\"fas fa-eye\"></i></a>`;",
          "1053:                                         return `<a href=\"#\" onclick=\"openVideoPlayer('${row[\"name\"]}', '${row['url']}', 'video/mp4');\"><i class=\"fas fa-eye\"></i></a>`;",
          "1055:                                         return `<a href=\"#\" onclick=\"openVideoPlayer('${row[\"name\"]}', '${row['url']}', 'video/webm');\"><i class=\"fas fa-eye\"></i></a>`;",
          "1058:                                         return `<a href=\"#\" onclick=\"openVideoPlayer('${row[\"name\"]}', '${row['url']}', 'video/ogg');\"><i class=\"fas fa-eye\"></i></a>`;",
          "",
          "[Added Lines]",
          "1043:                                         var title = escapeHTMLForceSafe(row[\"name\"])",
          "1044:                                         return `<a href=\"${view_url}\" data-lightbox=\"image-gallery\" data-title=\"${title}\"><i class=\"fas fa-eye\"></i></a>`;",
          "1047:                                         var name = b64EncodeUnicode(row[\"name\"]);",
          "1048:                                         return `<a href=\"#\" onclick=\"openVideoPlayer('${name}', '${row['url']}', 'video/mp4');\"><i class=\"fas fa-eye\"></i></a>`;",
          "1050:                                         var name = b64EncodeUnicode(row[\"name\"]);",
          "1051:                                         return `<a href=\"#\" onclick=\"openVideoPlayer('${name}', '${row['url']}', 'video/webm');\"><i class=\"fas fa-eye\"></i></a>`;",
          "1054:                                         var name = b64EncodeUnicode(row[\"name\"]);",
          "1055:                                         return `<a href=\"#\" onclick=\"openVideoPlayer('${name}}', '${row['url']}', 'video/ogg');\"><i class=\"fas fa-eye\"></i></a>`;",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "1073:                         {{if .HasIntegrations}}",
          "1074:                         if (type === 'display') {",
          "1075:                             if (data){",
          "1077:                             }",
          "1078:                         }",
          "1079:                         {{end}}",
          "",
          "[Removed Lines]",
          "1076:                                 return `<a href=\"#\" onclick=\"openExternalURL('${data}', '${row[\"ext_link\"]}', '${row[\"name\"]}');\"><i class=\"fas fa-external-link-alt\"></i></a>`;",
          "",
          "[Added Lines]",
          "1073:                                 var name = b64EncodeUnicode(escapeHTML(row[\"name\"]));",
          "1074:                                 return `<a href=\"#\" onclick=\"openExternalURL('${data}', '${row[\"ext_link\"]}', '${name}');\"><i class=\"fas fa-external-link-alt\"></i></a>`;",
          "",
          "---------------"
        ],
        "templates/webclient/sharefiles.html||templates/webclient/sharefiles.html": [
          "File: templates/webclient/sharefiles.html -> templates/webclient/sharefiles.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "94: <script src=\"{{.StaticURL}}/vendor/datatables/dataTables.responsive.min.js\"></script>",
          "95: <script src=\"{{.StaticURL}}/vendor/datatables/responsive.bootstrap4.min.js\"></script>",
          "96: <script type=\"text/javascript\">",
          "106:     function shortenData(d, cutoff) {",
          "107:         if ( typeof d !== 'string' ) {",
          "108:    return d;",
          "109:   }",
          "111:   if ( d.length <= cutoff ) {",
          "113:   }",
          "115:         var shortened = d.substr(0, cutoff-1);",
          "117:     }",
          "119:     function getIconForFile(filename) {",
          "",
          "[Removed Lines]",
          "98:     var escapeHTML = function ( t ) {",
          "99:   return t",
          "100:    .replace( /&/g, '&amp;' )",
          "101:    .replace( /</g, '&lt;' )",
          "102:    .replace( />/g, '&gt;' )",
          "103:    .replace( /\"/g, '&quot;' );",
          "104:  };",
          "112:    return d;",
          "116:         return shortened+'&#8230;';",
          "",
          "[Added Lines]",
          "103:    return escapeHTML(d);",
          "107:         return escapeHTML(shortened)+'&#8230;';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "250:                     let response;",
          "251:                     try {",
          "252:                         var f = files[index];",
          "254:                         var lastModified;",
          "255:                         try {",
          "256:                             lastModified = f.lastModified;",
          "",
          "[Removed Lines]",
          "253:                         var uploadPath = '{{.UploadBaseURL}}'+fixedEncodeURIComponent(\"/\"+f.name);",
          "",
          "[Added Lines]",
          "244:                         var uploadPath = '{{.UploadBaseURL}}'+fixedEncodeURIComponent(\"/\"+escapeHTML(f.name));",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "384:                             var title = \"\";",
          "385:                             var cssClass = \"\";",
          "386:                             var shortened = shortenData(data, 70);",
          "387:                             if (shortened != data){",
          "388:                                 title = escapeHTML(data);",
          "389:                                 cssClass = \"ellipsis\";",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "378:                             data = escapeHTML(data);",
          "",
          "---------------"
        ],
        "templates/webclient/shareupload.html||templates/webclient/shareupload.html": [
          "File: templates/webclient/shareupload.html -> templates/webclient/shareupload.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "99:                     let response;",
          "100:                     try {",
          "101:                         var f = files[index];",
          "103:                         var lastModified;",
          "104:                         try {",
          "105:                             lastModified = f.lastModified;",
          "",
          "[Removed Lines]",
          "102:                         var uploadPath = '{{.UploadBasePath}}/'+fixedEncodeURIComponent(f.name);",
          "",
          "[Added Lines]",
          "102:                         var uploadPath = '{{.UploadBasePath}}/'+fixedEncodeURIComponent(escapeHTML(f.name));",
          "",
          "---------------"
        ]
      }
    }
  ]
}