{
  "cve_id": "CVE-2022-0926",
  "cve_desc": "File upload filter bypass leading to stored XSS in GitHub repository microweber/microweber prior to 1.2.12.",
  "repo": "microweber/microweber",
  "patch_hash": "89200cfcc2cfefe5554721e7fa3cf52f6a2a9120",
  "patch_info": {
    "commit_hash": "89200cfcc2cfefe5554721e7fa3cf52f6a2a9120",
    "repo": "microweber/microweber",
    "commit_url": "https://github.com/microweber/microweber/commit/89200cfcc2cfefe5554721e7fa3cf52f6a2a9120",
    "files": [
      "src/MicroweberPackages/Utils/System/Files.php"
    ],
    "message": "Update Files.php",
    "before_after_code_files": [
      "src/MicroweberPackages/Utils/System/Files.php||src/MicroweberPackages/Utils/System/Files.php"
    ]
  },
  "patch_diff": {
    "src/MicroweberPackages/Utils/System/Files.php||src/MicroweberPackages/Utils/System/Files.php": [
      "File: src/MicroweberPackages/Utils/System/Files.php -> src/MicroweberPackages/Utils/System/Files.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "834:             'xqt',        //    SuperCalc Macro File',",
      "835:             'xys',        //    XYplorer Script File',",
      "836:             'zl9',        //    ZoneAlarm Quarantined EXE File",
      "839:             'swf',        //    Flash File",
      "841:         );",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "839:             'key',",
      "840:             'asax',",
      "841:             'btapp',",
      "842:             'xd',",
      "843:             'fwtemplate',",
      "844:             'crdownload',",
      "845:             'whtt',",
      "846:             'ssp',",
      "847:             'fmp',",
      "848:             'jspa',",
      "849:             'obml16',",
      "850:             'a5w',",
      "851:             'crt',",
      "852:             'vrt',",
      "853:             'website',",
      "854:             'p7c',",
      "855:             'dll',",
      "856:             'php',",
      "857:             'mjs',",
      "858:             'dhtml',",
      "859:             'xul',",
      "860:             'bml',",
      "861:             'download',",
      "862:             'cshtml',",
      "863:             'vsdisco',",
      "864:             'codasite',",
      "865:             'webbookmark',",
      "866:             'rjs',",
      "867:             'wsdl',",
      "868:             'dml',",
      "869:             'aro',",
      "870:             'dcr',",
      "871:             'shtml',",
      "872:             'dochtml',",
      "873:             'dwt',",
      "874:             'spc',",
      "875:             'a4p',",
      "876:             'htaccess',",
      "877:             'ascx',",
      "878:             'pac',",
      "879:             'p7b',",
      "880:             'xhtm',",
      "881:             'oam',",
      "882:             'site',",
      "883:             'kit',",
      "884:             'aspx',",
      "885:             'zul',",
      "886:             'tpl',",
      "887:             'htm',",
      "888:             'seam',",
      "889:             'svr',",
      "890:             'pem',",
      "891:             'url',",
      "892:             'dap',",
      "893:             'appcache',",
      "894:             'chm',",
      "895:             'wbs',",
      "896:             'htc',",
      "897:             'ewp',",
      "898:             'gsp',",
      "899:             'asr',",
      "900:             'der',",
      "901:             'master',",
      "902:             'stc',",
      "903:             'ap',",
      "904:             'html',",
      "905:             'p12',",
      "906:             'xpd',",
      "907:             'fwp',",
      "908:             'epibrw',",
      "909:             'strm',",
      "910:             'xss',",
      "911:             'node',",
      "912:             'disco',",
      "913:             'gsp',",
      "914:             'pro',",
      "915:             'rss',",
      "916:             'gne',",
      "917:             'sdb',",
      "918:             'compressed',",
      "919:             'asp',",
      "920:             'browser',",
      "921:             'php2',",
      "922:             'sites2',",
      "923:             'dothtml',",
      "924:             'bok',",
      "925:             'axd',",
      "926:             'nzb',",
      "927:             'vdw',",
      "928:             'obml',",
      "929:             'mhtml',",
      "930:             'ashx',",
      "931:             'con',",
      "932:             'rhtml',",
      "933:             'alx',",
      "934:             'opml',",
      "935:             'web',",
      "936:             'chat',",
      "937:             'csr',",
      "938:             'do',",
      "939:             'sht',",
      "940:             'asa',",
      "941:             'cha',",
      "942:             'h5p',",
      "943:             'qf',",
      "944:             'olp',",
      "945:             'hyperesources',",
      "946:             'sparkle',",
      "947:             'razor',",
      "948:             'php4',",
      "949:             'cms',",
      "950:             'mml',",
      "951:             'jnlp',",
      "952:             'har',",
      "953:             'br',",
      "954:             'webloc',",
      "955:             'srf',",
      "956:             'cer',",
      "957:             'uhtml',",
      "958:             'pptmhtml',",
      "959:             'phtml',",
      "960:             'xbel',",
      "961:             'cfm',",
      "962:             'fwtemplateb',",
      "963:             'jspx',",
      "964:             'jsp',",
      "965:             'xfdl',",
      "966:             'zhtml',",
      "967:             'stml',",
      "968:             'jsonl',",
      "969:             'maff',",
      "970:             'dbm',",
      "971:             'aex',",
      "972:             'crl',",
      "973:             'mht',",
      "974:             'wml',",
      "975:             'sass',",
      "976:             'xht',",
      "977:             'awm',",
      "978:             'page',",
      "979:             'hdml',",
      "980:             'webmanifest',",
      "981:             'itms',",
      "982:             'sitemap',",
      "983:             'shtm',",
      "984:             'wpp',",
      "985:             'jss',",
      "986:             'oth',",
      "987:             'ucf',",
      "988:             'prf',",
      "989:             'freeway',",
      "990:             'edge',",
      "991:             'iqy',",
      "992:             'vrml',",
      "993:             'mvc',",
      "994:             'wdgt',",
      "995:             'discomap',",
      "996:             'psp',",
      "997:             'hxs',",
      "998:             'adr',",
      "999:             'hype',",
      "1000:             'csp',",
      "1001:             'xhtml',",
      "1002:             'webarchive',",
      "1003:             'qbo',",
      "1004:             'jhtml',",
      "1005:             'svc',",
      "1006:             'phtm',",
      "1007:             'rw3',",
      "1008:             'tpl',",
      "1009:             'stl',",
      "1010:             'wbxml',",
      "1011:             'p7',",
      "1012:             'ndjson',",
      "1013:             'ognc',",
      "1014:             'fwtb',",
      "1015:             'muse',",
      "1016:             'vbd',",
      "1017:             'sites',",
      "1018:             'rt',",
      "1019:             'esproj',",
      "1020:             'private',",
      "1021:             'srl',",
      "1022:             'zhtml',",
      "1023:             'vbhtml',",
      "1024:             'hypetemplate',",
      "1025:             'obml15',",
      "1026:             'hypesymbol',",
      "1027:             'pub',",
      "1028:             'ece',",
      "1029:             'mspx',",
      "1030:             'docmhtml',",
      "1031:             'xws',",
      "1032:             'wgp',",
      "1033:             'tvpi',",
      "1034:             'woa',",
      "1035:             'asmx',",
      "1036:             'xbl',",
      "1037:             'webhistory',",
      "1038:             'idc',",
      "1039:             'jws',",
      "1040:             'lbc',",
      "1041:             'att',",
      "1042:             'tvvi',",
      "1043:             'zvz',",
      "1044:             'php3',",
      "1045:             'webarchivexml',",
      "1046:             'widget',",
      "1047:             'swz',",
      "1048:             'qrm',",
      "1049:             'bwp',",
      "1050:             'atom',",
      "1051:             'cdf',",
      "1052:             'map',",
      "1053:             'hdm',",
      "1054:             'php5',",
      "1055:             'rwsw',",
      "1056:             'wgt',",
      "1057:             'nod',",
      "1058:             'rflw',",
      "1059:             'htx',",
      "1060:             'mvr',",
      "1061:             'an',",
      "1062:             'rwp',",
      "1063:             'lasso',",
      "1064:             'vlp',",
      "1065:             'stp',",
      "1066:             'nxg',",
      "1067:             'faces',",
      "1068:             'kcmsf',",
      "1069:             'ptw',",
      "1070:             'less',",
      "1071:             'saveddeck',",
      "1072:             'ccbjs',",
      "1073:             'wn',",
      "1074:             'ppthtml',",
      "1075:             'jcz',",
      "1076:             'jvs',",
      "1077:             'rwtheme',",
      "1078:             'jst',",
      "1079:             'mapx',",
      "1080:             'cpg',",
      "1081:             'wpx',",
      "1082:             'qbx',",
      "1083:             'suck',",
      "1084:             'iwdgt',",
      "1085:             'public',",
      "1086:             'cphd',",
      "1087:             'moz',",
      "1088:             'zfo',",
      "1089:             'stm',",
      "1090:             'fcgi',",
      "1091:             'itpc',",
      "1092:             'cfml'",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "33eb4cc0f80c1f86388c1862a8aee1061fa5d72e",
      "candidate_info": {
        "commit_hash": "33eb4cc0f80c1f86388c1862a8aee1061fa5d72e",
        "repo": "microweber/microweber",
        "commit_url": "https://github.com/microweber/microweber/commit/33eb4cc0f80c1f86388c1862a8aee1061fa5d72e",
        "files": [
          "src/MicroweberPackages/App/functions/plupload.php",
          "src/MicroweberPackages/Utils/System/Files.php"
        ],
        "message": "make plupload only allowed files",
        "before_after_code_files": [
          "src/MicroweberPackages/App/functions/plupload.php||src/MicroweberPackages/App/functions/plupload.php",
          "src/MicroweberPackages/Utils/System/Files.php||src/MicroweberPackages/Utils/System/Files.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/MicroweberPackages/Utils/System/Files.php||src/MicroweberPackages/Utils/System/Files.php"
          ],
          "candidate": [
            "src/MicroweberPackages/Utils/System/Files.php||src/MicroweberPackages/Utils/System/Files.php"
          ]
        }
      },
      "candidate_diff": {
        "src/MicroweberPackages/App/functions/plupload.php||src/MicroweberPackages/App/functions/plupload.php": [
          "File: src/MicroweberPackages/App/functions/plupload.php -> src/MicroweberPackages/App/functions/plupload.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "56: $is_ext = get_file_extension($fileName_ext);",
          "57: $is_ext = strtolower($is_ext);",
          "62:     header(\"HTTP/1.1 401 Unauthorized\");",
          "64:     die('{\"jsonrpc\" : \"2.0\", \"error\" : {\"code\":100, \"message\": \"You cannot upload scripts or executable files\"}}');",
          "",
          "[Removed Lines]",
          "59: $is_dangerous_file = $files_utils->is_dangerous_file($fileName_ext);",
          "61: if ($is_dangerous_file) {",
          "",
          "[Added Lines]",
          "59: $is_allowed_file = $files_utils->is_allowed_file($fileName_ext);",
          "61: if ($is_allowed_file == false) {",
          "",
          "---------------"
        ],
        "src/MicroweberPackages/Utils/System/Files.php||src/MicroweberPackages/Utils/System/Files.php": [
          "File: src/MicroweberPackages/Utils/System/Files.php -> src/MicroweberPackages/Utils/System/Files.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "1020:             'private',",
          "1021:             'srl',",
          "1022:             'zhtml',",
          "1024:             'hypetemplate',",
          "1025:             'obml15',",
          "1026:             'hypesymbol',",
          "",
          "[Removed Lines]",
          "1023:             'vbhtml',",
          "",
          "[Added Lines]",
          "1023:             'vbhtml',",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1110:     }",
          "1113:     function get_allowed_files_extensions_for_upload($fileTypes = 'images')",
          "1114:     {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1112:     public function is_allowed_file($fileName)",
          "1113:     {",
          "1114:         $allowedImages = $this->get_allowed_files_extensions_for_upload('images');",
          "1115:         $allowedVideos = $this->get_allowed_files_extensions_for_upload('videos');",
          "1116:         $allowedAudios = $this->get_allowed_files_extensions_for_upload('audios');",
          "1117:         $allowedFiles = $this->get_allowed_files_extensions_for_upload('files');",
          "1118:         $allowedDocuments = $this->get_allowed_files_extensions_for_upload('documents');",
          "1119:         $allowedArchives = $this->get_allowed_files_extensions_for_upload('archives');",
          "1121:         $allowed = array_merge_recursive($allowedImages,$allowedVideos,$allowedAudios,$allowedFiles,$allowedDocuments,$allowedArchives);",
          "1123:         $isExt = get_file_extension($fileName);",
          "1124:         $isExt = strtolower($isExt);",
          "1126:         if (in_array($isExt, $allowed)) {",
          "1127:             return true;",
          "1128:         }",
          "1130:         return false;",
          "1131:     }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1119:             case 'img':",
          "1120:             case 'image':",
          "1121:             case 'images':",
          "1123:                 break;",
          "1124:             case 'video':",
          "1125:             case 'videos':",
          "1127:                 break;",
          "1128:             case 'file':",
          "1129:             case 'files':",
          "",
          "[Removed Lines]",
          "1122:                 $are_allowed .= ',png,gif,jpg,jpeg,tiff,bmp,svg';",
          "1126:                 $are_allowed .= ',avi,asf,mpg,mpeg,mp4,flv,mkv,webm,ogg,wma,mov,wmv';",
          "",
          "[Added Lines]",
          "1144:                 $are_allowed .= ',png,gif,jpg,jpeg,tiff,bmp,svg,webp,ico';",
          "1145:                 break;",
          "1146:             case 'audio':",
          "1147:             case 'audios':",
          "1148:                 $are_allowed .= ',mp3,mp4,ogg,wav,flac';",
          "1152:                 $are_allowed .= ',avi,asf,mpg,mpeg,mp4,flv,mkv,webm,ogg,ogv,3gp,3g2,wma,mov,wmv';",
          "",
          "---------------"
        ]
      }
    }
  ]
}