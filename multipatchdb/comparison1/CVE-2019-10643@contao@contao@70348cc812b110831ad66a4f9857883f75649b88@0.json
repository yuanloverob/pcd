{
  "cve_id": "CVE-2019-10643",
  "cve_desc": "Contao 4.7 allows Use of a Key Past its Expiration Date.",
  "repo": "contao/contao",
  "patch_hash": "70348cc812b110831ad66a4f9857883f75649b88",
  "patch_info": {
    "commit_hash": "70348cc812b110831ad66a4f9857883f75649b88",
    "repo": "contao/contao",
    "commit_url": "https://github.com/contao/contao/commit/70348cc812b110831ad66a4f9857883f75649b88",
    "files": [
      "CHANGELOG.md",
      "comments-bundle/src/Resources/contao/classes/Comments.php",
      "core-bundle/src/OptIn/OptIn.php",
      "core-bundle/src/OptIn/OptInToken.php",
      "core-bundle/src/Resources/contao/controllers/BackendConfirm.php",
      "core-bundle/src/Resources/contao/dca/tl_opt_in.php",
      "core-bundle/src/Resources/contao/languages/en/default.xlf",
      "core-bundle/src/Resources/contao/languages/en/tl_opt_in.xlf",
      "core-bundle/src/Resources/contao/models/OptInModel.php",
      "core-bundle/src/Resources/contao/modules/ModulePassword.php",
      "core-bundle/src/Resources/contao/modules/ModuleRegistration.php",
      "core-bundle/tests/OptIn/OptInTest.php",
      "core-bundle/tests/OptIn/OptInTokenTest.php",
      "newsletter-bundle/src/Resources/contao/modules/ModuleSubscribe.php"
    ],
    "message": "Invalidate old opt-in tokens when a token is confirmed (see CVE-2019-10643)",
    "before_after_code_files": [
      "comments-bundle/src/Resources/contao/classes/Comments.php||comments-bundle/src/Resources/contao/classes/Comments.php",
      "core-bundle/src/OptIn/OptIn.php||core-bundle/src/OptIn/OptIn.php",
      "core-bundle/src/OptIn/OptInToken.php||core-bundle/src/OptIn/OptInToken.php",
      "core-bundle/src/Resources/contao/controllers/BackendConfirm.php||core-bundle/src/Resources/contao/controllers/BackendConfirm.php",
      "core-bundle/src/Resources/contao/dca/tl_opt_in.php||core-bundle/src/Resources/contao/dca/tl_opt_in.php",
      "core-bundle/src/Resources/contao/languages/en/default.xlf||core-bundle/src/Resources/contao/languages/en/default.xlf",
      "core-bundle/src/Resources/contao/languages/en/tl_opt_in.xlf||core-bundle/src/Resources/contao/languages/en/tl_opt_in.xlf",
      "core-bundle/src/Resources/contao/models/OptInModel.php||core-bundle/src/Resources/contao/models/OptInModel.php",
      "core-bundle/src/Resources/contao/modules/ModulePassword.php||core-bundle/src/Resources/contao/modules/ModulePassword.php",
      "core-bundle/src/Resources/contao/modules/ModuleRegistration.php||core-bundle/src/Resources/contao/modules/ModuleRegistration.php",
      "core-bundle/tests/OptIn/OptInTest.php||core-bundle/tests/OptIn/OptInTest.php",
      "core-bundle/tests/OptIn/OptInTokenTest.php||core-bundle/tests/OptIn/OptInTokenTest.php",
      "newsletter-bundle/src/Resources/contao/modules/ModuleSubscribe.php||newsletter-bundle/src/Resources/contao/modules/ModuleSubscribe.php"
    ]
  },
  "patch_diff": {
    "comments-bundle/src/Resources/contao/classes/Comments.php||comments-bundle/src/Resources/contao/classes/Comments.php": [
      "File: comments-bundle/src/Resources/contao/classes/Comments.php -> comments-bundle/src/Resources/contao/classes/Comments.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "586:   $optIn = System::getContainer()->get('contao.opt-in');",
      "590:   $optInToken->send(sprintf($GLOBALS['TL_LANG']['MSC']['com_optInSubject'], Idna::decode(Environment::get('host'))), sprintf($GLOBALS['TL_LANG']['MSC']['com_optInMessage'], $objComment->name, $strUrl, $strUrl . $strConnector . 'token=' . $optInToken->getIdentifier(), $strUrl . $strConnector . 'token=' . $objNotify->tokenRemove));",
      "",
      "[Removed Lines]",
      "587:   $optInToken = $optIn->create('com-', $objComment->email, array('tl_comments_notify'=>array($objNotify->id)));",
      "",
      "[Added Lines]",
      "587:   $optInToken = $optIn->create('com', $objComment->email, array('tl_comments_notify'=>array($objNotify->id)));",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "603:    $optIn = System::getContainer()->get('contao.opt-in');",
      "607:    {",
      "610:     return;",
      "611:    }",
      "",
      "[Removed Lines]",
      "606:    if ((!$optInToken = $optIn->find(Input::get('token'))) || $optInToken->isConfirmed() || \\count($arrRelated = $optInToken->getRelatedRecords()) != 1 || key($arrRelated) != 'tl_comments_notify' || \\count($arrIds = current($arrRelated)) != 1 || (!$objNotify = CommentsNotifyModel::findByPk($arrIds[0])))",
      "608:     $objTemplate->confirm = $GLOBALS['TL_LANG']['MSC']['invalidTokenUrl'];",
      "",
      "[Added Lines]",
      "606:    if ((!$optInToken = $optIn->find(Input::get('token'))) || !$optInToken->isValid() || \\count($arrRelated = $optInToken->getRelatedRecords()) != 1 || key($arrRelated) != 'tl_comments_notify' || \\count($arrIds = current($arrRelated)) != 1 || (!$objNotify = CommentsNotifyModel::findByPk($arrIds[0])))",
      "608:     $objTemplate->confirm = $GLOBALS['TL_LANG']['MSC']['invalidToken'];",
      "610:     return;",
      "611:    }",
      "613:    if ($optInToken->isConfirmed())",
      "614:    {",
      "615:     $objTemplate->confirm = $GLOBALS['TL_LANG']['MSC']['tokenConfirmed'];",
      "617:     return;",
      "618:    }",
      "620:    if ($optInToken->getEmail() != $objNotify->email)",
      "621:    {",
      "622:     $objTemplate->confirm = $GLOBALS['TL_LANG']['MSC']['tokenEmailMismatch'];",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "624:    if ($objNotify === null)",
      "625:    {",
      "628:     return;",
      "629:    }",
      "",
      "[Removed Lines]",
      "626:     $objTemplate->confirm = $GLOBALS['TL_LANG']['MSC']['invalidTokenUrl'];",
      "",
      "[Added Lines]",
      "640:     $objTemplate->confirm = $GLOBALS['TL_LANG']['MSC']['invalidToken'];",
      "",
      "---------------"
    ],
    "core-bundle/src/OptIn/OptIn.php||core-bundle/src/OptIn/OptIn.php": [
      "File: core-bundle/src/OptIn/OptIn.php -> core-bundle/src/OptIn/OptIn.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "34:     public function create(string $prefix, string $email, array $related): OptInTokenInterface",
      "35:     {",
      "36:         if (\\strlen($prefix) > 6) {",
      "37:             throw new \\InvalidArgumentException('The token prefix must not be longer than 6 characters');",
      "38:         }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "36:         if ($prefix) {",
      "37:             $prefix = rtrim($prefix, '-');",
      "38:         }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "40:         $token = bin2hex(random_bytes(12));",
      "42:         if ($prefix) {",
      "44:         }",
      "",
      "[Removed Lines]",
      "43:             $token = $prefix.substr($token, \\strlen($prefix));",
      "",
      "[Added Lines]",
      "47:             $token = $prefix.'-'.substr($token, \\strlen($prefix) + 1);",
      "",
      "---------------"
    ],
    "core-bundle/src/OptIn/OptInToken.php||core-bundle/src/OptIn/OptInToken.php": [
      "File: core-bundle/src/OptIn/OptInToken.php -> core-bundle/src/OptIn/OptInToken.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "56:     public function isValid(): bool",
      "57:     {",
      "59:     }",
      "",
      "[Removed Lines]",
      "58:         return $this->model->createdOn > strtotime('-24 hours');",
      "",
      "[Added Lines]",
      "58:         return !$this->model->invalidatedThrough && $this->model->createdOn > strtotime('-24 hours');",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "75:         $this->model->confirmedOn = time();",
      "76:         $this->model->removeOn = strtotime('+3 years');",
      "77:         $this->model->save();",
      "78:     }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "79:         $related = $this->model->getRelatedRecords();",
      "81:         if (empty($related)) {",
      "82:             return;",
      "83:         }",
      "86:         $adapter = $this->framework->getAdapter(OptInModel::class);",
      "87:         $prefix = strtok($this->getIdentifier(), '-');",
      "90:         foreach ($related as $table => $ids) {",
      "91:             if (!$models = $adapter->findByRelatedTableAndIds($table, $ids)) {",
      "92:                 continue;",
      "93:             }",
      "95:             foreach ($models as $model) {",
      "96:                 if (",
      "97:                     $model->confirmedOn > 0",
      "98:                     || $model->invalidatedThrough",
      "99:                     || $model->token === $this->getIdentifier()",
      "100:                     || 0 !== strncmp($model->token, $prefix.'-', \\strlen($prefix) + 1)",
      "101:                 ) {",
      "102:                     continue;",
      "103:                 }",
      "105:                 $token = new OptInToken($model, $this->framework);",
      "108:                 if ($token->getRelatedRecords() !== $related) {",
      "109:                     continue;",
      "110:                 }",
      "112:                 $model->invalidatedThrough = $this->model->token;",
      "113:                 $model->save();",
      "114:             }",
      "115:         }",
      "",
      "---------------"
    ],
    "core-bundle/src/Resources/contao/controllers/BackendConfirm.php||core-bundle/src/Resources/contao/controllers/BackendConfirm.php": [
      "File: core-bundle/src/Resources/contao/controllers/BackendConfirm.php -> core-bundle/src/Resources/contao/controllers/BackendConfirm.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "145:   $objTemplate->link = StringUtil::specialchars($url);",
      "146:   $objTemplate->info = $arrInfo;",
      "147:   $objTemplate->labels = $GLOBALS['TL_LANG']['CONFIRM'];",
      "149:   $objTemplate->cancel = $GLOBALS['TL_LANG']['MSC']['cancelBT'];",
      "150:   $objTemplate->continue = $GLOBALS['TL_LANG']['MSC']['continue'];",
      "151:   $objTemplate->theme = Backend::getTheme();",
      "152:   $objTemplate->base = Environment::get('base');",
      "153:   $objTemplate->language = $GLOBALS['TL_LANGUAGE'];",
      "156:   $objTemplate->host = Environment::get('host');",
      "157:   $objTemplate->charset = Config::get('characterSet');",
      "",
      "[Removed Lines]",
      "148:   $objTemplate->explain = $GLOBALS['TL_LANG']['ERR']['invalidTokenUrl'];",
      "154:   $objTemplate->h1 = $GLOBALS['TL_LANG']['MSC']['invalidTokenUrl'];",
      "155:   $objTemplate->title = StringUtil::specialchars($GLOBALS['TL_LANG']['MSC']['invalidTokenUrl']);",
      "",
      "[Added Lines]",
      "148:   $objTemplate->explain = $GLOBALS['TL_LANG']['MSC']['invalidTokenUrl'];",
      "154:   $objTemplate->h1 = $GLOBALS['TL_LANG']['MSC']['invalidToken'];",
      "155:   $objTemplate->title = StringUtil::specialchars($GLOBALS['TL_LANG']['MSC']['invalidToken']);",
      "",
      "---------------"
    ],
    "core-bundle/src/Resources/contao/dca/tl_opt_in.php||core-bundle/src/Resources/contao/dca/tl_opt_in.php": [
      "File: core-bundle/src/Resources/contao/dca/tl_opt_in.php -> core-bundle/src/Resources/contao/dca/tl_opt_in.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "110:    'eval'                    => array('rgxp'=>'datim'),",
      "111:    'sql'                     => \"int(10) unsigned NOT NULL default '0'\"",
      "112:   ),",
      "113:   'email' => array",
      "114:   (",
      "115:    'label'                   => &$GLOBALS['TL_LANG']['MSC']['emailAddress'],",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "113:   'invalidatedThrough' => array",
      "114:   (",
      "115:    'label'                   => &$GLOBALS['TL_LANG']['tl_opt_in']['invalidatedThrough'],",
      "116:    'search'                  => true,",
      "117:    'sql'                     => \"varchar(24) NOT NULL default ''\"",
      "118:   ),",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "202:  public function resendButton($row, $href, $label, $title, $icon, $attributes)",
      "203:  {",
      "205:  }",
      "206: }",
      "",
      "[Removed Lines]",
      "204:   return (!$row['confirmedOn'] && $row['emailSubject'] && $row['emailText'] && $row['createdOn'] > strtotime('-24 hours')) ? '<a href=\"'.$this->addToUrl($href.'&amp;id='.$row['id']).'\" title=\"'.Contao\\StringUtil::specialchars($title).'\"'.$attributes.'>'.Contao\\Image::getHtml($icon, $label).'</a> ' : '';",
      "",
      "[Added Lines]",
      "210:   return (!$row['confirmedOn'] &&!$row['invalidatedThrough'] && $row['emailSubject'] && $row['emailText'] && $row['createdOn'] > strtotime('-24 hours')) ? '<a href=\"'.$this->addToUrl($href.'&amp;id='.$row['id']).'\" title=\"'.Contao\\StringUtil::specialchars($title).'\"'.$attributes.'>'.Contao\\Image::getHtml($icon, $label).'</a> ' : '';",
      "",
      "---------------"
    ],
    "core-bundle/src/Resources/contao/languages/en/default.xlf||core-bundle/src/Resources/contao/languages/en/default.xlf": [
      "File: core-bundle/src/Resources/contao/languages/en/default.xlf -> core-bundle/src/Resources/contao/languages/en/default.xlf",
      "--- Hunk 1 ---",
      "[Context before]",
      "188:       <trans-unit id=\"ERR.topLevelRegular\">",
      "189:         <source>There are top-level pages in the site structure which are not website root pages.</source>",
      "190:       </trans-unit>",
      "194:       <trans-unit id=\"ERR.form\">",
      "195:         <source>The form could not be sent</source>",
      "196:       </trans-unit>",
      "",
      "[Removed Lines]",
      "191:       <trans-unit id=\"ERR.invalidTokenUrl\">",
      "192:         <source>The link you were trying to open could not be verified. If you have clicked the link yourself or have received it by a trustworthy person, you can confirm the process below.</source>",
      "193:       </trans-unit>",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "1736:       <trans-unit id=\"MSC.relevance\">",
      "1737:         <source>%s relevance</source>",
      "1738:       </trans-unit>",
      "1740:         <source>Invalid token</source>",
      "1741:       </trans-unit>",
      "1742:       <trans-unit id=\"MSC.resendToken\">",
      "1743:         <source>The token has been re-sent to %s.</source>",
      "1744:       </trans-unit>",
      "1745:       <trans-unit id=\"MSC.versionConflict\">",
      "1746:         <source>Version conflict</source>",
      "1747:       </trans-unit>",
      "",
      "[Removed Lines]",
      "1739:       <trans-unit id=\"MSC.invalidTokenUrl\">",
      "",
      "[Added Lines]",
      "1736:       <trans-unit id=\"MSC.invalidToken\">",
      "1739:       <trans-unit id=\"MSC.tokenConfirmed\">",
      "1740:         <source>This token has already been confirmed</source>",
      "1741:       </trans-unit>",
      "1742:       <trans-unit id=\"MSC.tokenEmailMismatch\">",
      "1743:         <source>The e-mail address of the token does not match</source>",
      "1744:       </trans-unit>",
      "1748:       <trans-unit id=\"MSC.invalidTokenUrl\">",
      "1749:         <source>The link you were trying to open could not be verified. If you have clicked the link yourself or have received it by a trustworthy person, you can confirm the process below.</source>",
      "1750:       </trans-unit>",
      "",
      "---------------"
    ],
    "core-bundle/src/Resources/contao/languages/en/tl_opt_in.xlf||core-bundle/src/Resources/contao/languages/en/tl_opt_in.xlf": [
      "File: core-bundle/src/Resources/contao/languages/en/tl_opt_in.xlf -> core-bundle/src/Resources/contao/languages/en/tl_opt_in.xlf",
      "--- Hunk 1 ---",
      "[Context before]",
      "11:       <trans-unit id=\"tl_opt_in.removeOn\">",
      "12:         <source>Remove on</source>",
      "13:       </trans-unit>",
      "14:       <trans-unit id=\"tl_opt_in.emailSubject\">",
      "15:         <source>E-mail subject</source>",
      "16:       </trans-unit>",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "14:       <trans-unit id=\"tl_opt_in.invalidatedThrough\">",
      "15:         <source>Invalidated through</source>",
      "16:       </trans-unit>",
      "",
      "---------------"
    ],
    "core-bundle/src/Resources/contao/models/OptInModel.php||core-bundle/src/Resources/contao/models/OptInModel.php": [
      "File: core-bundle/src/Resources/contao/models/OptInModel.php -> core-bundle/src/Resources/contao/models/OptInModel.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "98:  public static function findOneByRelatedTableAndId($strTable, $intId, array $arrOptions=array())",
      "99:  {",
      "100:   $t = static::$strTable;",
      "101:   $objDatabase = Database::getInstance();",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "107:   @trigger_error('Using the Contao\\OptInModel::findOneByRelatedTableAndIds() method has been deprecated and will no longer work in Contao 5.0. Use the Contao\\OptInModel::findByRelatedTableAndIds() method instead.', E_USER_DEPRECATED);",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "119:   return new static($objResult);",
      "120:  }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "140:  public static function findByRelatedTableAndIds($strTable, array $arrIds, array $arrOptions=array())",
      "141:  {",
      "142:   $t = static::$strTable;",
      "143:   $objDatabase = Database::getInstance();",
      "145:   $objResult = $objDatabase->prepare(\"SELECT * FROM $t WHERE $t.id IN (SELECT pid FROM tl_opt_in_related WHERE relTable=? AND relId IN(\" . implode(',', array_map('\\intval', $arrIds)) . \")) ORDER BY $t.createdOn DESC\")",
      "146:          ->execute($strTable, $arrIds);",
      "148:   if ($objResult->numRows < 1)",
      "149:   {",
      "150:    return null;",
      "151:   }",
      "153:   $arrModels = array();",
      "154:   $objRegistry = Registry::getInstance();",
      "156:   while ($objResult->next())",
      "157:   {",
      "159:    if ($objOptIn = $objRegistry->fetch($t, $objResult->id))",
      "160:    {",
      "161:     $arrModels[] = $objOptIn;",
      "162:    }",
      "163:    else",
      "164:    {",
      "165:     $arrModels[] = new static($objResult->row());",
      "166:    }",
      "167:   }",
      "169:   return static::createCollection($arrModels, $t);",
      "170:  }",
      "",
      "---------------"
    ],
    "core-bundle/src/Resources/contao/modules/ModulePassword.php||core-bundle/src/Resources/contao/modules/ModulePassword.php": [
      "File: core-bundle/src/Resources/contao/modules/ModulePassword.php -> core-bundle/src/Resources/contao/modules/ModulePassword.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "177:   $optIn = System::getContainer()->get('contao.opt-in');",
      "181:   {",
      "182:    $this->strTemplate = 'mod_message';",
      "184:    $this->Template = new FrontendTemplate($this->strTemplate);",
      "185:    $this->Template->type = 'error';",
      "188:    return;",
      "189:   }",
      "",
      "[Removed Lines]",
      "180:   if ((!$optInToken = $optIn->find(Input::get('token'))) || $optInToken->isConfirmed() || \\count($arrRelated = $optInToken->getRelatedRecords()) != 1 || key($arrRelated) != 'tl_member' || \\count($arrIds = current($arrRelated)) != 1 || (!$objMember = MemberModel::findByPk($arrIds[0])))",
      "186:    $this->Template->message = $GLOBALS['TL_LANG']['MSC']['accountError'];",
      "",
      "[Added Lines]",
      "180:   if ((!$optInToken = $optIn->find(Input::get('token'))) || !$optInToken->isValid() || \\count($arrRelated = $optInToken->getRelatedRecords()) != 1 || key($arrRelated) != 'tl_member' || \\count($arrIds = current($arrRelated)) != 1 || (!$objMember = MemberModel::findByPk($arrIds[0])))",
      "186:    $this->Template->message = $GLOBALS['TL_LANG']['MSC']['invalidToken'];",
      "188:    return;",
      "189:   }",
      "191:   if ($optInToken->isConfirmed())",
      "192:   {",
      "193:    $this->strTemplate = 'mod_message';",
      "195:    $this->Template = new FrontendTemplate($this->strTemplate);",
      "196:    $this->Template->type = 'error';",
      "197:    $this->Template->message = $GLOBALS['TL_LANG']['MSC']['tokenConfirmed'];",
      "199:    return;",
      "200:   }",
      "202:   if ($optInToken->getEmail() != $objMember->email)",
      "203:   {",
      "204:    $this->strTemplate = 'mod_message';",
      "206:    $this->Template = new FrontendTemplate($this->strTemplate);",
      "207:    $this->Template->type = 'error';",
      "208:    $this->Template->message = $GLOBALS['TL_LANG']['MSC']['tokenEmailMismatch'];",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "287:  {",
      "289:   $optIn = System::getContainer()->get('contao.opt-in');",
      "293:   $arrData = $objMember->row();",
      "",
      "[Removed Lines]",
      "290:   $optInToken = $optIn->create('pw-', $objMember->email, array('tl_member'=>array($objMember->id)));",
      "",
      "[Added Lines]",
      "312:   $optInToken = $optIn->create('pw', $objMember->email, array('tl_member'=>array($objMember->id)));",
      "",
      "---------------"
    ],
    "core-bundle/src/Resources/contao/modules/ModuleRegistration.php||core-bundle/src/Resources/contao/modules/ModuleRegistration.php": [
      "File: core-bundle/src/Resources/contao/modules/ModuleRegistration.php -> core-bundle/src/Resources/contao/modules/ModuleRegistration.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "464:  {",
      "466:   $optIn = System::getContainer()->get('contao.opt-in');",
      "470:   $arrTokenData = $arrData;",
      "",
      "[Removed Lines]",
      "467:   $optInToken = $optIn->create('reg-', $arrData['email'], array('tl_member'=>array($arrData['id'])));",
      "",
      "[Added Lines]",
      "467:   $optInToken = $optIn->create('reg', $arrData['email'], array('tl_member'=>array($arrData['id'])));",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "521:   $optIn = System::getContainer()->get('contao.opt-in');",
      "525:   {",
      "526:    $this->Template->type = 'error';",
      "529:    return;",
      "530:   }",
      "",
      "[Removed Lines]",
      "524:   if ((!$optInToken = $optIn->find(Input::get('token'))) || $optInToken->isConfirmed() || \\count($arrRelated = $optInToken->getRelatedRecords()) != 1 || key($arrRelated) != 'tl_member' || \\count($arrIds = current($arrRelated)) != 1 || (!$objMember = MemberModel::findByPk($arrIds[0])))",
      "527:    $this->Template->message = $GLOBALS['TL_LANG']['MSC']['accountError'];",
      "",
      "[Added Lines]",
      "524:   if ((!$optInToken = $optIn->find(Input::get('token'))) || !$optInToken->isValid() || \\count($arrRelated = $optInToken->getRelatedRecords()) != 1 || key($arrRelated) != 'tl_member' || \\count($arrIds = current($arrRelated)) != 1 || (!$objMember = MemberModel::findByPk($arrIds[0])))",
      "527:    $this->Template->message = $GLOBALS['TL_LANG']['MSC']['invalidToken'];",
      "529:    return;",
      "530:   }",
      "532:   if ($optInToken->isConfirmed())",
      "533:   {",
      "534:    $this->Template->type = 'error';",
      "535:    $this->Template->message = $GLOBALS['TL_LANG']['MSC']['tokenConfirmed'];",
      "537:    return;",
      "538:   }",
      "540:   if ($optInToken->getEmail() != $objMember->email)",
      "541:   {",
      "542:    $this->Template->type = 'error';",
      "543:    $this->Template->message = $GLOBALS['TL_LANG']['MSC']['tokenEmailMismatch'];",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "578:   $optIn = System::getContainer()->get('contao.opt-in');",
      "582:   {",
      "583:    return;",
      "584:   }",
      "",
      "[Removed Lines]",
      "581:   if ((!$model = OptInModel::findOneByRelatedTableAndId('tl_member', $objMember->id)) || (!$optInToken = $optIn->find($model->token)))",
      "",
      "[Added Lines]",
      "595:   $optInToken = null;",
      "596:   $models = OptInModel::findByRelatedTableAndIds('tl_member', array($objMember->id));",
      "598:   foreach ($models as $model)",
      "599:   {",
      "601:    if (($token = $optIn->find($model->token)) && $token->isValid() && !$token->isConfirmed())",
      "602:    {",
      "603:     $optInToken = $token;",
      "604:     break;",
      "605:    }",
      "606:   }",
      "608:   if ($optInToken === null)",
      "",
      "---------------"
    ],
    "core-bundle/tests/OptIn/OptInTest.php||core-bundle/tests/OptIn/OptInTest.php": [
      "File: core-bundle/tests/OptIn/OptInTest.php -> core-bundle/tests/OptIn/OptInTest.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "43:             ->willReturn($model)",
      "44:         ;",
      "48:         $this->assertStringMatchesFormat('reg-%x', $token->getIdentifier());",
      "49:         $this->assertTrue($token->isValid());",
      "",
      "[Removed Lines]",
      "46:         $token = (new OptIn($framework))->create('reg-', 'foo@bar.com', ['tl_member' => 1]);",
      "",
      "[Added Lines]",
      "46:         $token = (new OptIn($framework))->create('reg', 'foo@bar.com', ['tl_member' => 1]);",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "62:         $this->expectException('InvalidArgumentException');",
      "63:         $this->expectExceptionMessage('The token prefix must not be longer than 6 characters');",
      "66:     }",
      "68:     public function testFindsAToken(): void",
      "",
      "[Removed Lines]",
      "65:         (new OptIn($framework))->create('registration-', 'foo@bar.com', ['tl_member' => 1]);",
      "",
      "[Added Lines]",
      "65:         (new OptIn($framework))->create('registration', 'foo@bar.com', ['tl_member' => 1]);",
      "",
      "---------------"
    ],
    "core-bundle/tests/OptIn/OptInTokenTest.php||core-bundle/tests/OptIn/OptInTokenTest.php": [
      "File: core-bundle/tests/OptIn/OptInTokenTest.php -> core-bundle/tests/OptIn/OptInTokenTest.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "42:         $this->assertSame('foo@bar.com', $token->getEmail());",
      "43:     }",
      "45:     public function testConfirmsAToken(): void",
      "46:     {",
      "47:         $properties = [",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "45:     public function testInvalidatesAToken(): void",
      "46:     {",
      "48:         $model = $this->mockClassWithGetterSetter(OptInModel::class, ['invalidatedThrough' => 'foo']);",
      "49:         $token = $this->getToken($model);",
      "51:         $this->assertFalse($token->isValid());",
      "52:     }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "53:         $model = $this->mockClassWithGetterSetter(OptInModel::class, $properties);",
      "55:         $token = $this->getToken($model);",
      "56:         $token->confirm();",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "63:         $model",
      "64:             ->expects($this->once())",
      "65:             ->method('getRelatedRecords')",
      "66:             ->willReturn([])",
      "67:         ;",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "58:         $this->assertTrue($token->isConfirmed());",
      "59:     }",
      "61:     public function testDoesNotConfirmAConfirmedToken(): void",
      "62:     {",
      "63:         $properties = [",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "75:     public function testInvalidatesRelatedTokens(): void",
      "76:     {",
      "77:         $properties = [",
      "78:             'token' => 'reg-first',",
      "79:             'createdOn' => time(),",
      "80:             'confirmedOn' => 0,",
      "81:         ];",
      "84:         $related = $this->mockClassWithGetterSetter(OptInModel::class, $properties);",
      "85:         $related",
      "86:             ->expects($this->once())",
      "87:             ->method('save')",
      "88:         ;",
      "90:         $related",
      "91:             ->expects($this->once())",
      "92:             ->method('getRelatedRecords')",
      "93:             ->willReturn(['tl_user' => [2]])",
      "94:         ;",
      "96:         $adapter = $this->mockAdapter(['findByRelatedTableAndIds']);",
      "97:         $adapter",
      "98:             ->expects($this->once())",
      "99:             ->method('findByRelatedTableAndIds')",
      "100:             ->with('tl_user', [2])",
      "101:             ->willReturn([$related])",
      "102:         ;",
      "104:         $framework = $this->mockContaoFramework([OptInModel::class => $adapter]);",
      "106:         $properties = [",
      "107:             'token' => 'reg-second',",
      "108:             'createdOn' => time(),",
      "109:             'confirmedOn' => 0,",
      "110:         ];",
      "113:         $model = $this->mockClassWithGetterSetter(OptInModel::class, $properties);",
      "114:         $model",
      "115:             ->expects($this->once())",
      "116:             ->method('getRelatedRecords')",
      "117:             ->willReturn(['tl_user' => [2]])",
      "118:         ;",
      "120:         $token = $this->getToken($model, $framework);",
      "121:         $token->confirm();",
      "123:         $this->assertTrue($token->isConfirmed());",
      "124:         $this->assertSame('reg-second', $related->invalidatedThrough);",
      "125:     }",
      "127:     public function testDoesNotInvalidateRelatedTokensIfTheRelatedRecordsDoNotMatch(): void",
      "128:     {",
      "129:         $properties = [",
      "130:             'token' => 'reg-first',",
      "131:             'createdOn' => time(),",
      "132:             'confirmedOn' => 0,",
      "133:         ];",
      "136:         $related = $this->mockClassWithGetterSetter(OptInModel::class, $properties);",
      "137:         $related",
      "138:             ->expects($this->never())",
      "139:             ->method('save')",
      "140:         ;",
      "142:         $related",
      "143:             ->expects($this->once())",
      "144:             ->method('getRelatedRecords')",
      "145:             ->willReturn(['tl_user' => [2, 3]])",
      "146:         ;",
      "148:         $adapter = $this->mockAdapter(['findByRelatedTableAndIds']);",
      "149:         $adapter",
      "150:             ->expects($this->once())",
      "151:             ->method('findByRelatedTableAndIds')",
      "152:             ->with('tl_user', [2])",
      "153:             ->willReturn([$related])",
      "154:         ;",
      "156:         $framework = $this->mockContaoFramework([OptInModel::class => $adapter]);",
      "158:         $properties = [",
      "159:             'token' => 'reg-second',",
      "160:             'createdOn' => time(),",
      "161:             'confirmedOn' => 0,",
      "162:         ];",
      "165:         $model = $this->mockClassWithGetterSetter(OptInModel::class, $properties);",
      "166:         $model",
      "167:             ->expects($this->once())",
      "168:             ->method('getRelatedRecords')",
      "169:             ->willReturn(['tl_user' => [2]])",
      "170:         ;",
      "172:         $token = $this->getToken($model, $framework);",
      "173:         $token->confirm();",
      "175:         $this->assertTrue($token->isConfirmed());",
      "176:         $this->assertNull($related->invalidatedThrough);",
      "177:     }",
      "",
      "---------------"
    ],
    "newsletter-bundle/src/Resources/contao/modules/ModuleSubscribe.php||newsletter-bundle/src/Resources/contao/modules/ModuleSubscribe.php": [
      "File: newsletter-bundle/src/Resources/contao/modules/ModuleSubscribe.php -> newsletter-bundle/src/Resources/contao/modules/ModuleSubscribe.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "169:   $optIn = System::getContainer()->get('contao.opt-in');",
      "173:   {",
      "174:    $this->Template->type = 'error';",
      "177:    return;",
      "178:   }",
      "185:   foreach ($arrIds as $intId)",
      "186:   {",
      "187:    if (!$objRecipient = NewsletterRecipientsModel::findByPk($intId))",
      "188:    {",
      "190:    }",
      "192:    $arrAdd[] = $objRecipient->id;",
      "193:    $arrCids[] = $objRecipient->pid;",
      "",
      "[Removed Lines]",
      "172:   if ((!$optInToken = $optIn->find(Input::get('token'))) || $optInToken->isConfirmed() || \\count($arrRelated = $optInToken->getRelatedRecords()) < 1 || key($arrRelated) != 'tl_newsletter_recipients' || \\count($arrIds = current($arrRelated)) < 1)",
      "175:    $this->Template->message = $GLOBALS['TL_LANG']['MSC']['accountError'];",
      "180:   $time = time();",
      "181:   $arrAdd = array();",
      "182:   $arrCids = array();",
      "189:     continue;",
      "",
      "[Added Lines]",
      "172:   if ((!$optInToken = $optIn->find(Input::get('token'))) || !$optInToken->isValid() || \\count($arrRelated = $optInToken->getRelatedRecords()) < 1 || key($arrRelated) != 'tl_newsletter_recipients' || \\count($arrIds = current($arrRelated)) < 1)",
      "175:    $this->Template->message = $GLOBALS['TL_LANG']['MSC']['invalidToken'];",
      "180:   if ($optInToken->isConfirmed())",
      "181:   {",
      "182:    $this->Template->type = 'error';",
      "183:    $this->Template->message = $GLOBALS['TL_LANG']['MSC']['tokenConfirmed'];",
      "185:    return;",
      "186:   }",
      "188:   $arrRecipients = array();",
      "195:     $this->Template->type = 'error';",
      "196:     $this->Template->message = $GLOBALS['TL_LANG']['MSC']['invalidToken'];",
      "198:     return;",
      "201:    if ($optInToken->getEmail() != $objRecipient->email)",
      "202:    {",
      "203:     $this->Template->type = 'error';",
      "204:     $this->Template->message = $GLOBALS['TL_LANG']['MSC']['tokenEmailMismatch'];",
      "206:     return;",
      "207:    }",
      "209:    $arrRecipients[] = $objRecipient;",
      "210:   }",
      "212:   $time = time();",
      "213:   $arrAdd = array();",
      "214:   $arrCids = array();",
      "217:   foreach ($arrRecipients as $objRecipient)",
      "218:   {",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "335:   $optIn = System::getContainer()->get('contao.opt-in');",
      "339:   $objChannel = NewsletterChannelModel::findByIds($arrNew);",
      "",
      "[Removed Lines]",
      "336:   $optInToken = $optIn->create('nl-', $strEmail, $arrRelated);",
      "",
      "[Added Lines]",
      "363:   $optInToken = $optIn->create('nl', $strEmail, $arrRelated);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "d7516b307071238a0de7afd7b5cb3f8ea0c18e84",
      "candidate_info": {
        "commit_hash": "d7516b307071238a0de7afd7b5cb3f8ea0c18e84",
        "repo": "contao/contao",
        "commit_url": "https://github.com/contao/contao/commit/d7516b307071238a0de7afd7b5cb3f8ea0c18e84",
        "files": [
          "calendar-bundle/composer.json",
          "calendar-bundle/tests/EventListener/GeneratePageListenerTest.php",
          "calendar-bundle/tests/EventListener/InsertTagsListenerTest.php",
          "calendar-bundle/tests/EventListener/PreviewUrlCreateListenerTest.php",
          "calendar-bundle/tests/Picker/EventPickerProviderTest.php",
          "composer.json",
          "core-bundle/composer.json",
          "core-bundle/tests/Contao/RoutingTest.php",
          "core-bundle/tests/Controller/BackendCsvImportControllerTest.php",
          "core-bundle/tests/DataCollector/ContaoDataCollectorTest.php",
          "core-bundle/tests/EventListener/BackendLocaleListenerTest.php",
          "core-bundle/tests/EventListener/UserSessionListenerTest.php",
          "core-bundle/tests/Image/ImageFactoryTest.php",
          "core-bundle/tests/Image/ImageSizesTest.php",
          "core-bundle/tests/Image/PictureFactoryTest.php",
          "core-bundle/tests/OptIn/OptInTest.php",
          "core-bundle/tests/OptIn/OptInTokenTest.php",
          "core-bundle/tests/Picker/FilePickerProviderTest.php",
          "core-bundle/tests/Routing/Matcher/LegacyMatcherTest.php",
          "core-bundle/tests/Routing/RouteProviderTest.php",
          "core-bundle/tests/Security/Authentication/FrontendPreviewAuthenticatorTest.php",
          "core-bundle/tests/Security/Logout/LogoutHandlerTest.php",
          "core-bundle/tests/Security/TwoFactor/AuthenticatorTest.php",
          "core-bundle/tests/Security/TwoFactor/ProviderTest.php",
          "core-bundle/tests/Security/User/ContaoUserProviderTest.php",
          "core-bundle/tests/Security/User/UserCheckerTest.php",
          "faq-bundle/composer.json",
          "faq-bundle/tests/EventListener/InsertTagsListenerTest.php",
          "faq-bundle/tests/Picker/FaqPickerProviderTest.php",
          "manager-bundle/composer.json",
          "manager-bundle/tests/EventListener/BackendMenuListenerTest.php",
          "news-bundle/composer.json",
          "news-bundle/tests/EventListener/GeneratePageListenerTest.php",
          "news-bundle/tests/EventListener/InsertTagsListenerTest.php",
          "news-bundle/tests/EventListener/PreviewUrlCreateListenerTest.php",
          "news-bundle/tests/Picker/NewsPickerProviderTest.php"
        ],
        "message": "Use class properties in unit tests where possible\n\nThis allows for autocompletion in PhpStorm and type checking in PhpStan.",
        "before_after_code_files": [
          "calendar-bundle/tests/EventListener/GeneratePageListenerTest.php||calendar-bundle/tests/EventListener/GeneratePageListenerTest.php",
          "calendar-bundle/tests/EventListener/InsertTagsListenerTest.php||calendar-bundle/tests/EventListener/InsertTagsListenerTest.php",
          "calendar-bundle/tests/EventListener/PreviewUrlCreateListenerTest.php||calendar-bundle/tests/EventListener/PreviewUrlCreateListenerTest.php",
          "calendar-bundle/tests/Picker/EventPickerProviderTest.php||calendar-bundle/tests/Picker/EventPickerProviderTest.php",
          "core-bundle/tests/Contao/RoutingTest.php||core-bundle/tests/Contao/RoutingTest.php",
          "core-bundle/tests/Controller/BackendCsvImportControllerTest.php||core-bundle/tests/Controller/BackendCsvImportControllerTest.php",
          "core-bundle/tests/DataCollector/ContaoDataCollectorTest.php||core-bundle/tests/DataCollector/ContaoDataCollectorTest.php",
          "core-bundle/tests/EventListener/BackendLocaleListenerTest.php||core-bundle/tests/EventListener/BackendLocaleListenerTest.php",
          "core-bundle/tests/EventListener/UserSessionListenerTest.php||core-bundle/tests/EventListener/UserSessionListenerTest.php",
          "core-bundle/tests/Image/ImageFactoryTest.php||core-bundle/tests/Image/ImageFactoryTest.php",
          "core-bundle/tests/Image/ImageSizesTest.php||core-bundle/tests/Image/ImageSizesTest.php",
          "core-bundle/tests/Image/PictureFactoryTest.php||core-bundle/tests/Image/PictureFactoryTest.php",
          "core-bundle/tests/OptIn/OptInTest.php||core-bundle/tests/OptIn/OptInTest.php",
          "core-bundle/tests/OptIn/OptInTokenTest.php||core-bundle/tests/OptIn/OptInTokenTest.php",
          "core-bundle/tests/Picker/FilePickerProviderTest.php||core-bundle/tests/Picker/FilePickerProviderTest.php",
          "core-bundle/tests/Routing/Matcher/LegacyMatcherTest.php||core-bundle/tests/Routing/Matcher/LegacyMatcherTest.php",
          "core-bundle/tests/Routing/RouteProviderTest.php||core-bundle/tests/Routing/RouteProviderTest.php",
          "core-bundle/tests/Security/Authentication/FrontendPreviewAuthenticatorTest.php||core-bundle/tests/Security/Authentication/FrontendPreviewAuthenticatorTest.php",
          "core-bundle/tests/Security/Logout/LogoutHandlerTest.php||core-bundle/tests/Security/Logout/LogoutHandlerTest.php",
          "core-bundle/tests/Security/TwoFactor/AuthenticatorTest.php||core-bundle/tests/Security/TwoFactor/AuthenticatorTest.php",
          "core-bundle/tests/Security/TwoFactor/ProviderTest.php||core-bundle/tests/Security/TwoFactor/ProviderTest.php",
          "core-bundle/tests/Security/User/ContaoUserProviderTest.php||core-bundle/tests/Security/User/ContaoUserProviderTest.php",
          "core-bundle/tests/Security/User/UserCheckerTest.php||core-bundle/tests/Security/User/UserCheckerTest.php",
          "faq-bundle/tests/EventListener/InsertTagsListenerTest.php||faq-bundle/tests/EventListener/InsertTagsListenerTest.php",
          "faq-bundle/tests/Picker/FaqPickerProviderTest.php||faq-bundle/tests/Picker/FaqPickerProviderTest.php",
          "manager-bundle/tests/EventListener/BackendMenuListenerTest.php||manager-bundle/tests/EventListener/BackendMenuListenerTest.php",
          "news-bundle/tests/EventListener/GeneratePageListenerTest.php||news-bundle/tests/EventListener/GeneratePageListenerTest.php",
          "news-bundle/tests/EventListener/InsertTagsListenerTest.php||news-bundle/tests/EventListener/InsertTagsListenerTest.php",
          "news-bundle/tests/EventListener/PreviewUrlCreateListenerTest.php||news-bundle/tests/EventListener/PreviewUrlCreateListenerTest.php",
          "news-bundle/tests/Picker/NewsPickerProviderTest.php||news-bundle/tests/Picker/NewsPickerProviderTest.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "core-bundle/tests/OptIn/OptInTest.php||core-bundle/tests/OptIn/OptInTest.php",
            "core-bundle/tests/OptIn/OptInTokenTest.php||core-bundle/tests/OptIn/OptInTokenTest.php"
          ],
          "candidate": [
            "core-bundle/tests/OptIn/OptInTest.php||core-bundle/tests/OptIn/OptInTest.php",
            "core-bundle/tests/OptIn/OptInTokenTest.php||core-bundle/tests/OptIn/OptInTokenTest.php"
          ]
        }
      },
      "candidate_diff": {
        "calendar-bundle/tests/EventListener/GeneratePageListenerTest.php||calendar-bundle/tests/EventListener/GeneratePageListenerTest.php": [
          "File: calendar-bundle/tests/EventListener/GeneratePageListenerTest.php -> calendar-bundle/tests/EventListener/GeneratePageListenerTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "29:     {",
          "30:         $GLOBALS['TL_HEAD'] = [];",
          "40:         $collection = new Collection([$calendarFeedModel], 'tl_calendar_feeds');",
          "42:         $adapters = [",
          "",
          "[Removed Lines]",
          "32:         $properties = [",
          "33:             'feedBase' => 'http://localhost/',",
          "34:             'alias' => 'events',",
          "35:             'format' => 'rss',",
          "36:             'title' => 'Upcoming events',",
          "37:         ];",
          "39:         $calendarFeedModel = $this->mockClassWithProperties(CalendarFeedModel::class, $properties);",
          "",
          "[Added Lines]",
          "33:         $calendarFeedModel = $this->mockClassWithProperties(CalendarFeedModel::class);",
          "34:         $calendarFeedModel->feedBase = 'http://localhost/';",
          "35:         $calendarFeedModel->alias = 'events';",
          "36:         $calendarFeedModel->format = 'rss';",
          "37:         $calendarFeedModel->title = 'Upcoming events';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "46:         ];",
          "51:         $listener = new GeneratePageListener($this->mockContaoFramework($adapters));",
          "52:         $listener->onGeneratePage($this->createMock(PageModel::class), $layoutModel);",
          "",
          "[Removed Lines]",
          "49:         $layoutModel = $this->mockClassWithProperties(LayoutModel::class, ['calendarfeeds' => 'a:1:{i:0;i:3;}']);",
          "",
          "[Added Lines]",
          "48:         $layoutModel = $this->mockClassWithProperties(LayoutModel::class);",
          "49:         $layoutModel->calendarfeeds = 'a:1:{i:0;i:3;}';",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "62:         $GLOBALS['TL_HEAD'] = [];",
          "67:         $listener = new GeneratePageListener($this->mockContaoFramework());",
          "68:         $listener->onGeneratePage($this->createMock(PageModel::class), $layoutModel);",
          "",
          "[Removed Lines]",
          "65:         $layoutModel = $this->mockClassWithProperties(LayoutModel::class, ['calendarfeeds' => '']);",
          "",
          "[Added Lines]",
          "65:         $layoutModel = $this->mockClassWithProperties(LayoutModel::class);",
          "66:         $layoutModel->calendarfeeds = '';",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "79:         ];",
          "84:         $listener = new GeneratePageListener($this->mockContaoFramework($adapters));",
          "85:         $listener->onGeneratePage($this->createMock(PageModel::class), $layoutModel);",
          "",
          "[Removed Lines]",
          "82:         $layoutModel = $this->mockClassWithProperties(LayoutModel::class, ['calendarfeeds' => 'a:1:{i:0;i:3;}']);",
          "",
          "[Added Lines]",
          "83:         $layoutModel = $this->mockClassWithProperties(LayoutModel::class);",
          "84:         $layoutModel->calendarfeeds = 'a:1:{i:0;i:3;}';",
          "",
          "---------------"
        ],
        "calendar-bundle/tests/EventListener/InsertTagsListenerTest.php||calendar-bundle/tests/EventListener/InsertTagsListenerTest.php": [
          "File: calendar-bundle/tests/EventListener/InsertTagsListenerTest.php -> calendar-bundle/tests/EventListener/InsertTagsListenerTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "17: use Contao\\CalendarFeedModel;",
          "18: use Contao\\Events;",
          "19: use Contao\\TestCase\\ContaoTestCase;",
          "21: class InsertTagsListenerTest extends ContaoTestCase",
          "22: {",
          "23:     public function testReplacesTheCalendarFeedTag(): void",
          "24:     {",
          "32:         $adapters = [",
          "33:             CalendarFeedModel::class => $this->mockConfiguredAdapter(['findByPk' => $feedModel]),",
          "",
          "[Removed Lines]",
          "25:         $properties = [",
          "26:             'feedBase' => 'http://localhost/',",
          "27:             'alias' => 'events',",
          "28:         ];",
          "30:         $feedModel = $this->mockClassWithProperties(CalendarFeedModel::class, $properties);",
          "",
          "[Added Lines]",
          "20: use PHPUnit\\Framework\\MockObject\\MockObject;",
          "27:         $feedModel = $this->mockClassWithProperties(CalendarFeedModel::class);",
          "28:         $feedModel->feedBase = 'http://localhost/';",
          "29:         $feedModel->alias = 'events';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "44:     public function testReplacesTheEventTags(): void",
          "45:     {",
          "53:         $events = $this->mockAdapter(['generateEventUrl']);",
          "54:         $events",
          "",
          "[Removed Lines]",
          "46:         $properties = [",
          "47:             'title' => 'The \"foobar\" event',",
          "48:             'teaser' => '<p>The annual foobar event.</p>',",
          "49:         ];",
          "51:         $eventModel = $this->mockClassWithProperties(CalendarEventsModel::class, $properties);",
          "",
          "[Added Lines]",
          "46:         $eventModel = $this->mockClassWithProperties(CalendarEventsModel::class);",
          "47:         $eventModel->title = 'The \"foobar\" event';",
          "48:         $eventModel->teaser = '<p>The annual foobar event.</p>';",
          "",
          "---------------"
        ],
        "calendar-bundle/tests/EventListener/PreviewUrlCreateListenerTest.php||calendar-bundle/tests/EventListener/PreviewUrlCreateListenerTest.php": [
          "File: calendar-bundle/tests/EventListener/PreviewUrlCreateListenerTest.php -> calendar-bundle/tests/EventListener/PreviewUrlCreateListenerTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "17: use Contao\\CoreBundle\\Event\\PreviewUrlCreateEvent;",
          "18: use Contao\\CoreBundle\\Framework\\ContaoFramework;",
          "19: use Contao\\TestCase\\ContaoTestCase;",
          "20: use Symfony\\Component\\HttpFoundation\\Request;",
          "21: use Symfony\\Component\\HttpFoundation\\RequestStack;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "20: use PHPUnit\\Framework\\MockObject\\MockObject;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "27:         $requestStack = new RequestStack();",
          "28:         $requestStack->push(new Request());",
          "32:         $adapters = [",
          "33:             CalendarEventsModel::class => $this->mockConfiguredAdapter(['findByPk' => $eventModel]),",
          "",
          "[Removed Lines]",
          "30:         $eventModel = $this->mockClassWithProperties(CalendarEventsModel::class, ['id' => 1]);",
          "",
          "[Added Lines]",
          "32:         $eventModel = $this->mockClassWithProperties(CalendarEventsModel::class);",
          "33:         $eventModel->id = 1;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "96:         $requestStack = new RequestStack();",
          "97:         $requestStack->push($request);",
          "101:         $adapters = [",
          "102:             CalendarEventsModel::class => $this->mockConfiguredAdapter(['findByPk' => $eventModel]),",
          "",
          "[Removed Lines]",
          "99:         $eventModel = $this->mockClassWithProperties(CalendarEventsModel::class, ['id' => 2]);",
          "",
          "[Added Lines]",
          "103:         $eventModel = $this->mockClassWithProperties(CalendarEventsModel::class);",
          "104:         $eventModel->id = 2;",
          "",
          "---------------"
        ],
        "calendar-bundle/tests/Picker/EventPickerProviderTest.php||calendar-bundle/tests/Picker/EventPickerProviderTest.php": [
          "File: calendar-bundle/tests/Picker/EventPickerProviderTest.php -> calendar-bundle/tests/Picker/EventPickerProviderTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "21: use Knp\\Menu\\FactoryInterface;",
          "22: use Knp\\Menu\\ItemInterface;",
          "23: use Knp\\Menu\\MenuItem;",
          "24: use Symfony\\Component\\Routing\\RouterInterface;",
          "25: use Symfony\\Component\\Security\\Core\\Authentication\\Token\\Storage\\TokenStorageInterface;",
          "26: use Symfony\\Component\\Security\\Core\\Authentication\\Token\\TokenInterface;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "24: use PHPUnit\\Framework\\MockObject\\MockObject;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "203:     public function testAddsTableAndIdIfThereIsAValue(): void",
          "204:     {",
          "205:         $calendarEvents = $this->createMock(CalendarEventsModel::class);",
          "206:         $calendarEvents",
          "207:             ->expects($this->once())",
          "208:             ->method('getRelated')",
          "209:             ->with('pid')",
          "211:         ;",
          "213:         $config = new PickerConfig('link', [], '{{event_url::1}}', 'eventPicker');",
          "",
          "[Removed Lines]",
          "210:             ->willReturn($this->mockClassWithProperties(CalendarModel::class, ['id' => 1]))",
          "",
          "[Added Lines]",
          "207:         $calendarModel = $this->mockClassWithProperties(CalendarModel::class);",
          "208:         $calendarModel->id = 1;",
          "215:             ->willReturn($calendarModel)",
          "",
          "---------------"
        ],
        "core-bundle/tests/Contao/RoutingTest.php||core-bundle/tests/Contao/RoutingTest.php": [
          "File: core-bundle/tests/Contao/RoutingTest.php -> core-bundle/tests/Contao/RoutingTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "19: use Contao\\PageModel;",
          "20: use Contao\\System;",
          "21: use Contao\\TestCase\\ContaoTestCase;",
          "22: use Symfony\\Component\\DependencyInjection\\ContainerBuilder;",
          "23: use Symfony\\Component\\HttpFoundation\\Request;",
          "24: use Symfony\\Component\\HttpFoundation\\RequestStack;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "22: use PHPUnit\\Framework\\MockObject\\MockObject;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "463:         $requestStack = new RequestStack();",
          "464:         $requestStack->push($request);",
          "474:         $page",
          "475:             ->method('loadDetails')",
          "476:             ->willReturn($page)",
          "",
          "[Removed Lines]",
          "466:         $properties = [",
          "467:             'domain' => '',",
          "468:             'rootLanguage' => 'en',",
          "469:             'rootIsFallback' => true,",
          "470:             'alias' => 'foo/bar/home',",
          "471:         ];",
          "473:         $page = $this->mockClassWithProperties(PageModel::class, $properties);",
          "",
          "[Added Lines]",
          "468:         $page = $this->mockClassWithProperties(PageModel::class);",
          "469:         $page->domain = '';",
          "470:         $page->rootLanguage = 'en';",
          "471:         $page->rootIsFallback = true;",
          "472:         $page->alias = 'foo/bar/home';",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "524:         $requestStack = new RequestStack();",
          "525:         $requestStack->push($request);",
          "535:         $page",
          "536:             ->method('loadDetails')",
          "537:             ->willReturn($page)",
          "",
          "[Removed Lines]",
          "527:         $properties = [",
          "528:             'domain' => 'domain.com',",
          "529:             'rootLanguage' => 'en',",
          "530:             'rootIsFallback' => true,",
          "531:             'alias' => 'foo/bar/home',",
          "532:         ];",
          "534:         $page = $this->mockClassWithProperties(PageModel::class, $properties);",
          "",
          "[Added Lines]",
          "528:         $page = $this->mockClassWithProperties(PageModel::class);",
          "529:         $page->domain = 'domain.com';",
          "530:         $page->rootLanguage = 'en';",
          "531:         $page->rootIsFallback = true;",
          "532:         $page->alias = 'foo/bar/home';",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "595:         $requestStack = new RequestStack();",
          "596:         $requestStack->push($request);",
          "606:         $page",
          "607:             ->method('loadDetails')",
          "608:             ->willReturn($page)",
          "",
          "[Removed Lines]",
          "598:         $properties = [",
          "599:             'domain' => 'domain.de',",
          "600:             'rootLanguage' => 'de',",
          "601:             'rootIsFallback' => false,",
          "602:             'alias' => 'startseite',",
          "603:         ];",
          "605:         $page = $this->mockClassWithProperties(PageModel::class, $properties);",
          "",
          "[Added Lines]",
          "598:         $page = $this->mockClassWithProperties(PageModel::class);",
          "599:         $page->domain = 'domain.de';",
          "600:         $page->rootLanguage = 'de';",
          "601:         $page->rootIsFallback = false;",
          "602:         $page->alias = 'startseite';",
          "",
          "---------------"
        ],
        "core-bundle/tests/Controller/BackendCsvImportControllerTest.php||core-bundle/tests/Controller/BackendCsvImportControllerTest.php": [
          "File: core-bundle/tests/Controller/BackendCsvImportControllerTest.php -> core-bundle/tests/Controller/BackendCsvImportControllerTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "370:     private function mockDataContainer(): DataContainer",
          "371:     {",
          "378:     }",
          "",
          "[Removed Lines]",
          "372:         $properties = [",
          "373:             'id' => 1,",
          "374:             'table' => 'tl_content',",
          "375:         ];",
          "377:         return $this->mockClassWithProperties(DataContainer::class, $properties);",
          "",
          "[Added Lines]",
          "373:         $mock = $this->mockClassWithProperties(DataContainer::class);",
          "374:         $mock->id = 1;",
          "375:         $mock->table = 'tl_content';",
          "377:         return $mock;",
          "",
          "---------------"
        ],
        "core-bundle/tests/DataCollector/ContaoDataCollectorTest.php||core-bundle/tests/DataCollector/ContaoDataCollectorTest.php": [
          "File: core-bundle/tests/DataCollector/ContaoDataCollectorTest.php -> core-bundle/tests/DataCollector/ContaoDataCollectorTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "20: use Contao\\LayoutModel;",
          "21: use Contao\\PageModel;",
          "22: use Contao\\System;",
          "23: use Symfony\\Component\\HttpFoundation\\Request;",
          "24: use Symfony\\Component\\HttpFoundation\\Response;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "23: use PHPUnit\\Framework\\MockObject\\MockObject;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "66:     public function testCollectsDataInFrontEnd(): void",
          "67:     {",
          "75:         $adapter = $this->mockConfiguredAdapter(['findByPk' => $layout]);",
          "76:         $framework = $this->mockContaoFramework([LayoutModel::class => $adapter]);",
          "80:         $collector = new ContaoDataCollector();",
          "81:         $collector->setFramework($framework);",
          "",
          "[Removed Lines]",
          "68:         $properties = [",
          "69:             'name' => 'Default',",
          "70:             'id' => 2,",
          "71:             'template' => 'fe_page',",
          "72:         ];",
          "74:         $layout = $this->mockClassWithProperties(LayoutModel::class, $properties);",
          "78:         $GLOBALS['objPage'] = $this->mockClassWithProperties(PageModel::class, ['id' => 2]);",
          "",
          "[Added Lines]",
          "70:         $layout = $this->mockClassWithProperties(LayoutModel::class);",
          "71:         $layout->name = 'Default';",
          "72:         $layout->id = 2;",
          "73:         $layout->template = 'fe_page';",
          "79:         $page = $this->mockClassWithProperties(PageModel::class);",
          "80:         $page->id = 2;",
          "82:         $GLOBALS['objPage'] = $page;",
          "",
          "---------------"
        ],
        "core-bundle/tests/EventListener/BackendLocaleListenerTest.php||core-bundle/tests/EventListener/BackendLocaleListenerTest.php": [
          "File: core-bundle/tests/EventListener/BackendLocaleListenerTest.php -> core-bundle/tests/EventListener/BackendLocaleListenerTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "30:     public function testSetsTheLocale(): void",
          "31:     {",
          "35:         $token = $this->createMock(TokenInterface::class);",
          "36:         $token",
          "",
          "[Removed Lines]",
          "33:         $user = $this->mockClassWithProperties(BackendUser::class, ['language' => 'de']);",
          "",
          "[Added Lines]",
          "33:         $user = $this->mockClassWithProperties(BackendUser::class);",
          "34:         $user->language = 'de';",
          "",
          "---------------"
        ],
        "core-bundle/tests/EventListener/UserSessionListenerTest.php||core-bundle/tests/EventListener/UserSessionListenerTest.php": [
          "File: core-bundle/tests/EventListener/UserSessionListenerTest.php -> core-bundle/tests/EventListener/UserSessionListenerTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "48:             'lonesome' => 'looser',",
          "49:         ];",
          "53:         $token = $this->createMock(UsernamePasswordToken::class);",
          "54:         $token",
          "",
          "[Removed Lines]",
          "51:         $user = $this->mockClassWithProperties($userClass, ['session' => $sessionValues]);",
          "",
          "[Added Lines]",
          "52:         $user = $this->mockClassWithProperties($userClass);",
          "53:         $user->session = $sessionValues;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "330:     public function testFailsToReplaceTheSessionIfThereIsNoSession(): void",
          "331:     {",
          "333:         $token = $this->createMock(UsernamePasswordToken::class);",
          "334:         $token",
          "335:             ->method('getUser')",
          "",
          "[Removed Lines]",
          "332:         $user = $this->mockClassWithProperties(BackendUser::class, ['session' => []]);",
          "",
          "[Added Lines]",
          "335:         $user = $this->mockClassWithProperties(BackendUser::class);",
          "336:         $user->session = [];",
          "",
          "---------------"
        ],
        "core-bundle/tests/Image/ImageFactoryTest.php||core-bundle/tests/Image/ImageFactoryTest.php": [
          "File: core-bundle/tests/Image/ImageFactoryTest.php -> core-bundle/tests/Image/ImageFactoryTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "84:             ->willReturn($imageMock)",
          "85:         ;",
          "93:         $filesAdapter = $this->mockConfiguredAdapter(['findByPath' => $filesModel]);",
          "94:         $framework = $this->mockContaoFramework([FilesModel::class => $filesAdapter]);",
          "95:         $imageFactory = $this->mockImageFactory($resizer, null, null, null, $framework);",
          "",
          "[Removed Lines]",
          "87:         $properties = [",
          "88:             'importantPartWidth' => null,",
          "89:             'importantPartHeight' => null,",
          "90:         ];",
          "92:         $filesModel = $this->mockClassWithProperties(FilesModel::class, $properties);",
          "",
          "[Added Lines]",
          "88:         $filesModel = $this->mockClassWithProperties(FilesModel::class);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "167:             ->willReturn($imageMock)",
          "168:         ;",
          "178:         $imageSizeAdapter = $this->mockConfiguredAdapter(['findByPk' => $imageSizeModel]);",
          "188:         $filesAdapter = $this->mockConfiguredAdapter(['findByPath' => $filesModel]);",
          "190:         $adapters = [",
          "",
          "[Removed Lines]",
          "170:         $properties = [",
          "171:             'width' => '100',",
          "172:             'height' => '200',",
          "173:             'resizeMode' => ResizeConfiguration::MODE_BOX,",
          "174:             'zoom' => '50',",
          "175:         ];",
          "177:         $imageSizeModel = $this->mockClassWithProperties(ImageSizeModel::class, $properties);",
          "180:         $properties = [",
          "181:             'importantPartX' => '50',",
          "182:             'importantPartY' => '50',",
          "183:             'importantPartWidth' => '25',",
          "184:             'importantPartHeight' => '25',",
          "185:         ];",
          "187:         $filesModel = $this->mockClassWithProperties(FilesModel::class, $properties);",
          "",
          "[Added Lines]",
          "168:         $imageSizeModel = $this->mockClassWithProperties(ImageSizeModel::class);",
          "169:         $imageSizeModel->width = 100;",
          "170:         $imageSizeModel->height = 200;",
          "171:         $imageSizeModel->resizeMode = ResizeConfiguration::MODE_BOX;",
          "172:         $imageSizeModel->zoom = 50;",
          "177:         $filesModel = $this->mockClassWithProperties(FilesModel::class);",
          "178:         $filesModel->importantPartX = 50;",
          "179:         $filesModel->importantPartY = 50;",
          "180:         $filesModel->importantPartWidth = 25;",
          "181:         $filesModel->importantPartHeight = 25;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "345:             ->willReturn($imagineImageMock)",
          "346:         ;",
          "356:         $filesAdapter = $this->mockConfiguredAdapter(['findByPath' => $filesModel]);",
          "357:         $framework = $this->mockContaoFramework([FilesModel::class => $filesAdapter]);",
          "358:         $imageFactory = $this->mockImageFactory($resizer, $imagine, $imagine, $filesystem, $framework);",
          "",
          "[Removed Lines]",
          "348:         $properties = [",
          "349:             'importantPartX' => '50',",
          "350:             'importantPartY' => '50',",
          "351:             'importantPartWidth' => '25',",
          "352:             'importantPartHeight' => '25',",
          "353:         ];",
          "355:         $filesModel = $this->mockClassWithProperties(FilesModel::class, $properties);",
          "",
          "[Added Lines]",
          "344:         $filesModel = $this->mockClassWithProperties(FilesModel::class);",
          "345:         $filesModel->importantPartX = 50;",
          "346:         $filesModel->importantPartY = 50;",
          "347:         $filesModel->importantPartWidth = 25;",
          "348:         $filesModel->importantPartHeight = 25;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "427:     {",
          "428:         $path = $this->getFixturesDir().'/images/dummy.jpg';",
          "438:         $filesAdapter = $this->mockConfiguredAdapter(['findByPath' => $filesModel]);",
          "439:         $framework = $this->mockContaoFramework([FilesModel::class => $filesAdapter]);",
          "440:         $imageFactory = $this->mockImageFactory(null, null, null, null, $framework);",
          "",
          "[Removed Lines]",
          "430:         $properties = [",
          "431:             'importantPartX' => '50',",
          "432:             'importantPartY' => '50',",
          "433:             'importantPartWidth' => '175',",
          "434:             'importantPartHeight' => '175',",
          "435:         ];",
          "437:         $filesModel = $this->mockClassWithProperties(FilesModel::class, $properties);",
          "",
          "[Added Lines]",
          "424:         $filesModel = $this->mockClassWithProperties(FilesModel::class);",
          "425:         $filesModel->importantPartX = 50;",
          "426:         $filesModel->importantPartY = 50;",
          "427:         $filesModel->importantPartWidth = 175;",
          "428:         $filesModel->importantPartHeight = 175;",
          "",
          "---------------"
        ],
        "core-bundle/tests/Image/ImageSizesTest.php||core-bundle/tests/Image/ImageSizesTest.php": [
          "File: core-bundle/tests/Image/ImageSizesTest.php -> core-bundle/tests/Image/ImageSizesTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "90:         $this->expectEvent(ContaoCoreEvents::IMAGE_SIZES_USER);",
          "91:         $this->expectExampleImageSizes();",
          "100:         $options = $this->imageSizes->getOptionsForUser($user);",
          "",
          "[Removed Lines]",
          "93:         $properties = [",
          "94:             'imageSizes' => ['image_sizes' => '42'],",
          "95:             'isAdmin' => true,",
          "96:         ];",
          "99:         $user = $this->mockClassWithProperties(BackendUser::class, $properties);",
          "",
          "[Added Lines]",
          "94:         $user = $this->mockClassWithProperties(BackendUser::class);",
          "95:         $user->isAdmin = true;",
          "96:         $user->imageSizes = ['image_sizes' => '42'];",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "108:         $this->expectEvent(ContaoCoreEvents::IMAGE_SIZES_USER);",
          "109:         $this->expectExampleImageSizes();",
          "119:         $options = $this->imageSizes->getOptionsForUser($user);",
          "121:         $this->assertArrayNotHasKey('relative', $options);",
          "",
          "[Removed Lines]",
          "112:         $properties = [",
          "113:             'imageSizes' => [42],",
          "114:             'isAdmin' => false,",
          "115:         ];",
          "118:         $user = $this->mockClassWithProperties(BackendUser::class, $properties);",
          "",
          "[Added Lines]",
          "110:         $user = $this->mockClassWithProperties(BackendUser::class);",
          "111:         $user->isAdmin = false;",
          "114:         $user->imageSizes = [42];",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "123:         $this->assertArrayHasKey('image_sizes', $options);",
          "124:         $this->assertArrayHasKey('42', $options['image_sizes']);",
          "134:         $options = $this->imageSizes->getOptionsForUser($user);",
          "136:         $this->assertArrayHasKey('relative', $options);",
          "137:         $this->assertArrayNotHasKey('exact', $options);",
          "138:         $this->assertArrayNotHasKey('image_sizes', $options);",
          "148:         $options = $this->imageSizes->getOptionsForUser($user);",
          "150:         $this->assertSame([], $options);",
          "",
          "[Removed Lines]",
          "127:         $properties = [",
          "128:             'imageSizes' => ['proportional', 'box'],",
          "129:             'isAdmin' => false,",
          "130:         ];",
          "133:         $user = $this->mockClassWithProperties(BackendUser::class, $properties);",
          "141:         $properties = [",
          "142:             'imageSizes' => [],",
          "143:             'isAdmin' => false,",
          "144:         ];",
          "147:         $user = $this->mockClassWithProperties(BackendUser::class, $properties);",
          "",
          "[Added Lines]",
          "124:         $user = $this->mockClassWithProperties(BackendUser::class);",
          "125:         $user->isAdmin = false;",
          "128:         $user->imageSizes = ['proportional', 'box'];",
          "137:         $user = $this->mockClassWithProperties(BackendUser::class);",
          "138:         $user->isAdmin = false;",
          "141:         $user->imageSizes = [];",
          "",
          "---------------"
        ],
        "core-bundle/tests/Image/PictureFactoryTest.php||core-bundle/tests/Image/PictureFactoryTest.php": [
          "File: core-bundle/tests/Image/PictureFactoryTest.php -> core-bundle/tests/Image/PictureFactoryTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "99:             ->willReturn($imageMock)",
          "100:         ;",
          "113:         $imageSizeAdapter = $this->mockConfiguredAdapter(['findByPk' => $imageSizeModel]);",
          "127:         $imageSizeItemModel",
          "128:             ->method('__isset')",
          "129:             ->willReturn(true)",
          "",
          "[Removed Lines]",
          "102:         $properties = [",
          "103:             'width' => '100',",
          "104:             'height' => '200',",
          "105:             'resizeMode' => ResizeConfiguration::MODE_BOX,",
          "106:             'zoom' => '50',",
          "107:             'sizes' => '100vw',",
          "108:             'densities' => '1x, 2x',",
          "109:             'cssClass' => 'my-size',",
          "110:         ];",
          "112:         $imageSizeModel = $this->mockClassWithProperties(ImageSizeModel::class, $properties);",
          "115:         $properties = [",
          "116:             'width' => '50',",
          "117:             'height' => '50',",
          "118:             'resizeMode' => ResizeConfiguration::MODE_CROP,",
          "119:             'zoom' => '100',",
          "120:             'sizes' => '50vw',",
          "121:             'densities' => '0.5x, 2x',",
          "122:             'media' => '(max-width: 900px)',",
          "123:         ];",
          "126:         $imageSizeItemModel = $this->mockClassWithProperties(ImageSizeItemModel::class, $properties);",
          "",
          "[Added Lines]",
          "103:         $imageSizeModel = $this->mockClassWithProperties(ImageSizeModel::class);",
          "104:         $imageSizeModel->width = 100;",
          "105:         $imageSizeModel->height = 200;",
          "106:         $imageSizeModel->resizeMode = ResizeConfiguration::MODE_BOX;",
          "107:         $imageSizeModel->zoom = 50;",
          "108:         $imageSizeModel->sizes = '100vw';",
          "109:         $imageSizeModel->densities = '1x, 2x';",
          "110:         $imageSizeModel->cssClass = 'my-size';",
          "115:         $imageSizeItemModel = $this->mockClassWithProperties(ImageSizeItemModel::class);",
          "116:         $imageSizeItemModel->width = 50;",
          "117:         $imageSizeItemModel->height = 50;",
          "118:         $imageSizeItemModel->resizeMode = ResizeConfiguration::MODE_CROP;",
          "119:         $imageSizeItemModel->zoom = 100;",
          "120:         $imageSizeItemModel->sizes = '50vw';",
          "121:         $imageSizeItemModel->densities = '0.5x, 2x';",
          "122:         $imageSizeItemModel->media = '(max-width: 900px)';",
          "",
          "---------------"
        ],
        "core-bundle/tests/OptIn/OptInTest.php||core-bundle/tests/OptIn/OptInTest.php": [
          "File: core-bundle/tests/OptIn/OptInTest.php -> core-bundle/tests/OptIn/OptInTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "18: use Contao\\Model\\Collection;",
          "19: use Contao\\OptInModel;",
          "20: use Contao\\TestCase\\ContaoTestCase;",
          "22: class OptInTest extends ContaoTestCase",
          "23: {",
          "24:     public function testCreatesAToken(): void",
          "25:     {",
          "27:         $model",
          "28:             ->expects($this->once())",
          "29:             ->method('save')",
          "",
          "[Removed Lines]",
          "26:         $model = $this->mockClassWithGetterSetter(OptInModel::class);",
          "",
          "[Added Lines]",
          "21: use PHPUnit\\Framework\\MockObject\\MockObject;",
          "27:         $model = $this->mockClassWithProperties(OptInModel::class);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "68:     public function testFindsAToken(): void",
          "69:     {",
          "72:         $adapter = $this->mockAdapter(['findByToken']);",
          "73:         $adapter",
          "",
          "[Removed Lines]",
          "70:         $model = $this->mockClassWithProperties(OptInModel::class, ['token' => 'foobar']);",
          "",
          "[Added Lines]",
          "72:         $model = $this->mockClassWithProperties(OptInModel::class);",
          "73:         $model->token = 'foobar';",
          "",
          "---------------"
        ],
        "core-bundle/tests/OptIn/OptInTokenTest.php||core-bundle/tests/OptIn/OptInTokenTest.php": [
          "File: core-bundle/tests/OptIn/OptInTokenTest.php -> core-bundle/tests/OptIn/OptInTokenTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "27:     public function testReturnsTheIdentifier(): void",
          "28:     {",
          "31:         $token = $this->getToken($model);",
          "33:         $this->assertSame('foobar', $token->getIdentifier());",
          "",
          "[Removed Lines]",
          "30:         $model = $this->mockClassWithGetterSetter(OptInModel::class, ['token' => 'foobar']);",
          "",
          "[Added Lines]",
          "30:         $model = $this->mockClassWithProperties(OptInModel::class);",
          "31:         $model->token = 'foobar';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "36:     public function testReturnsTheEmailAddress(): void",
          "37:     {",
          "40:         $token = $this->getToken($model);",
          "42:         $this->assertSame('foo@bar.com', $token->getEmail());",
          "",
          "[Removed Lines]",
          "39:         $model = $this->mockClassWithGetterSetter(OptInModel::class, ['email' => 'foo@bar.com']);",
          "",
          "[Added Lines]",
          "41:         $model = $this->mockClassWithProperties(OptInModel::class);",
          "42:         $model->email = 'foo@bar.com';",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "45:     public function testInvalidatesAToken(): void",
          "46:     {",
          "49:         $token = $this->getToken($model);",
          "51:         $this->assertFalse($token->isValid());",
          "",
          "[Removed Lines]",
          "48:         $model = $this->mockClassWithGetterSetter(OptInModel::class, ['invalidatedThrough' => 'foo']);",
          "",
          "[Added Lines]",
          "52:         $model = $this->mockClassWithProperties(OptInModel::class);",
          "53:         $model->invalidatedThrough = 'foo';",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "54:     public function testConfirmsAToken(): void",
          "55:     {",
          "63:         $model",
          "64:             ->expects($this->once())",
          "65:             ->method('getRelatedRecords')",
          "",
          "[Removed Lines]",
          "56:         $properties = [",
          "57:             'createdOn' => time(),",
          "58:             'confirmedOn' => 0,",
          "59:         ];",
          "62:         $model = $this->mockClassWithGetterSetter(OptInModel::class, $properties);",
          "",
          "[Added Lines]",
          "63:         $model = $this->mockClassWithProperties(OptInModel::class);",
          "64:         $model->createdOn = time();",
          "65:         $model->confirmedOn = 0;",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "75:     public function testInvalidatesRelatedTokens(): void",
          "76:     {",
          "85:         $related",
          "86:             ->expects($this->once())",
          "87:             ->method('save')",
          "",
          "[Removed Lines]",
          "77:         $properties = [",
          "78:             'token' => 'reg-first',",
          "79:             'createdOn' => time(),",
          "80:             'confirmedOn' => 0,",
          "81:         ];",
          "84:         $related = $this->mockClassWithGetterSetter(OptInModel::class, $properties);",
          "",
          "[Added Lines]",
          "82:         $related = $this->mockClassWithProperties(OptInModel::class);",
          "83:         $related->token = 'reg-first';",
          "84:         $related->createdOn = time();",
          "85:         $related->confirmedOn = 0;",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "104:         $framework = $this->mockContaoFramework([OptInModel::class => $adapter]);",
          "114:         $model",
          "115:             ->expects($this->once())",
          "116:             ->method('getRelatedRecords')",
          "",
          "[Removed Lines]",
          "106:         $properties = [",
          "107:             'token' => 'reg-second',",
          "108:             'createdOn' => time(),",
          "109:             'confirmedOn' => 0,",
          "110:         ];",
          "113:         $model = $this->mockClassWithGetterSetter(OptInModel::class, $properties);",
          "",
          "[Added Lines]",
          "109:         $model = $this->mockClassWithProperties(OptInModel::class);",
          "110:         $model->token = 'reg-second';",
          "111:         $model->createdOn = time();",
          "112:         $model->confirmedOn = 0;",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "127:     public function testDoesNotInvalidateRelatedTokensIfTheRelatedRecordsDoNotMatch(): void",
          "128:     {",
          "137:         $related",
          "138:             ->expects($this->never())",
          "139:             ->method('save')",
          "",
          "[Removed Lines]",
          "129:         $properties = [",
          "130:             'token' => 'reg-first',",
          "131:             'createdOn' => time(),",
          "132:             'confirmedOn' => 0,",
          "133:         ];",
          "136:         $related = $this->mockClassWithGetterSetter(OptInModel::class, $properties);",
          "",
          "[Added Lines]",
          "130:         $related = $this->mockClassWithProperties(OptInModel::class);",
          "131:         $related->token = 'reg-first';",
          "132:         $related->createdOn = time();",
          "133:         $related->confirmedOn = 0;",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "156:         $framework = $this->mockContaoFramework([OptInModel::class => $adapter]);",
          "166:         $model",
          "167:             ->expects($this->once())",
          "168:             ->method('getRelatedRecords')",
          "",
          "[Removed Lines]",
          "158:         $properties = [",
          "159:             'token' => 'reg-second',",
          "160:             'createdOn' => time(),",
          "161:             'confirmedOn' => 0,",
          "162:         ];",
          "165:         $model = $this->mockClassWithGetterSetter(OptInModel::class, $properties);",
          "",
          "[Added Lines]",
          "157:         $model = $this->mockClassWithProperties(OptInModel::class);",
          "158:         $model->token = 'reg-second';",
          "159:         $model->createdOn = time();",
          "160:         $model->confirmedOn = 0;",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "179:     public function testDoesNotConfirmAConfirmedToken(): void",
          "180:     {",
          "187:         $token = $this->getToken($model);",
          "189:         $this->expectException(OptInTokenAlreadyConfirmedException::class);",
          "",
          "[Removed Lines]",
          "181:         $properties = [",
          "182:             'confirmedOn' => time(),",
          "183:         ];",
          "186:         $model = $this->mockClassWithGetterSetter(OptInModel::class, $properties);",
          "",
          "[Added Lines]",
          "178:         $model = $this->mockClassWithProperties(OptInModel::class);",
          "179:         $model->confirmedOn = time();",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "195:     public function testDoesNotConfirmAnExpiredToken(): void",
          "196:     {",
          "204:         $token = $this->getToken($model);",
          "206:         $this->expectException(OptInTokenNoLongerValidException::class);",
          "",
          "[Removed Lines]",
          "197:         $properties = [",
          "198:             'createdOn' => strtotime('-1 day'),",
          "199:             'confirmedOn' => 0,",
          "200:         ];",
          "203:         $model = $this->mockClassWithGetterSetter(OptInModel::class, $properties);",
          "",
          "[Added Lines]",
          "192:         $model = $this->mockClassWithProperties(OptInModel::class);",
          "193:         $model->createdOn = strtotime('-1 day');",
          "194:         $model->confirmedOn = 0;",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "212:     public function testSendsATokenViaEmail(): void",
          "213:     {",
          "223:         $model",
          "224:             ->expects($this->once())",
          "225:             ->method('save')",
          "",
          "[Removed Lines]",
          "214:         $properties = [",
          "215:             'createdOn' => time(),",
          "216:             'confirmedOn' => 0,",
          "217:             'emailSubject' => '',",
          "218:             'emailText' => '',",
          "219:         ];",
          "222:         $model = $this->mockClassWithGetterSetter(OptInModel::class, $properties);",
          "",
          "[Added Lines]",
          "207:         $model = $this->mockClassWithProperties(OptInModel::class);",
          "208:         $model->createdOn = time();",
          "209:         $model->confirmedOn = 0;",
          "210:         $model->emailSubject = '';",
          "211:         $model->emailText = '';",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "248:     public function testDoesNotSendAConfirmedTokenViaEmail(): void",
          "249:     {",
          "256:         $token = $this->getToken($model);",
          "258:         $this->expectException(OptInTokenAlreadyConfirmedException::class);",
          "",
          "[Removed Lines]",
          "250:         $properties = [",
          "251:             'confirmedOn' => time(),",
          "252:         ];",
          "255:         $model = $this->mockClassWithGetterSetter(OptInModel::class, $properties);",
          "",
          "[Added Lines]",
          "241:         $model = $this->mockClassWithProperties(OptInModel::class);",
          "242:         $model->confirmedOn = time();",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "264:     public function testDoesNotSendAnExpiredTokenViaEmail(): void",
          "265:     {",
          "273:         $token = $this->getToken($model);",
          "275:         $this->expectException(OptInTokenNoLongerValidException::class);",
          "",
          "[Removed Lines]",
          "266:         $properties = [",
          "267:             'createdOn' => strtotime('-1 day'),",
          "268:             'confirmedOn' => 0,",
          "269:         ];",
          "272:         $model = $this->mockClassWithGetterSetter(OptInModel::class, $properties);",
          "",
          "[Added Lines]",
          "255:         $model = $this->mockClassWithProperties(OptInModel::class);",
          "256:         $model->createdOn = strtotime('-1 day');",
          "257:         $model->confirmedOn = 0;",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "281:     public function testRequiresSubjectAndTextToSendToken(): void",
          "282:     {",
          "292:         $model",
          "293:             ->expects($this->never())",
          "294:             ->method('save')",
          "",
          "[Removed Lines]",
          "283:         $properties = [",
          "284:             'createdOn' => time(),",
          "285:             'confirmedOn' => 0,",
          "286:             'emailSubject' => '',",
          "287:             'emailText' => '',",
          "288:         ];",
          "291:         $model = $this->mockClassWithGetterSetter(OptInModel::class, $properties);",
          "",
          "[Added Lines]",
          "270:         $model = $this->mockClassWithProperties(OptInModel::class);",
          "271:         $model->createdOn = time();",
          "272:         $model->confirmedOn = 0;",
          "273:         $model->emailSubject = '';",
          "274:         $model->emailText = '';",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "305:     public function testDoesNotRequireSubjectAndTextToResendToken(): void",
          "306:     {",
          "316:         $model",
          "317:             ->expects($this->never())",
          "318:             ->method('save')",
          "",
          "[Removed Lines]",
          "307:         $properties = [",
          "308:             'createdOn' => time(),",
          "309:             'confirmedOn' => 0,",
          "310:             'emailSubject' => 'Subject',",
          "311:             'emailText' => 'Text',",
          "312:         ];",
          "315:         $model = $this->mockClassWithGetterSetter(OptInModel::class, $properties);",
          "",
          "[Added Lines]",
          "292:         $model = $this->mockClassWithProperties(OptInModel::class);",
          "293:         $model->createdOn = time();",
          "294:         $model->confirmedOn = 0;",
          "295:         $model->emailSubject = 'Subject';",
          "296:         $model->emailText = 'Text';",
          "",
          "---------------"
        ],
        "core-bundle/tests/Picker/FilePickerProviderTest.php||core-bundle/tests/Picker/FilePickerProviderTest.php": [
          "File: core-bundle/tests/Picker/FilePickerProviderTest.php -> core-bundle/tests/Picker/FilePickerProviderTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "21: use Knp\\Menu\\FactoryInterface;",
          "22: use Knp\\Menu\\ItemInterface;",
          "23: use Knp\\Menu\\MenuItem;",
          "24: use Symfony\\Component\\Routing\\RouterInterface;",
          "25: use Symfony\\Component\\Security\\Core\\Authentication\\Token\\Storage\\TokenStorageInterface;",
          "26: use Symfony\\Component\\Security\\Core\\Authentication\\Token\\TokenInterface;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "24: use PHPUnit\\Framework\\MockObject\\MockObject;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "66:             )",
          "67:         ;",
          "76:         $adapter = $this->mockAdapter(['findByUuid', 'findByPath']);",
          "77:         $adapter",
          "",
          "[Removed Lines]",
          "69:         $properties = [",
          "70:             'path' => '/foobar',",
          "71:             'uuid' => StringUtil::uuidToBin('82243f46-a4c3-11e3-8e29-000c29e44aea'),",
          "72:         ];",
          "74:         $filesModel = $this->mockClassWithProperties(FilesModel::class, $properties);",
          "",
          "[Added Lines]",
          "71:         $filesModel = $this->mockClassWithProperties(FilesModel::class);",
          "72:         $filesModel->path = '/foobar';",
          "73:         $filesModel->uuid = StringUtil::uuidToBin('82243f46-a4c3-11e3-8e29-000c29e44aea');",
          "",
          "---------------"
        ],
        "core-bundle/tests/Routing/Matcher/LegacyMatcherTest.php||core-bundle/tests/Routing/Matcher/LegacyMatcherTest.php": [
          "File: core-bundle/tests/Routing/Matcher/LegacyMatcherTest.php -> core-bundle/tests/Routing/Matcher/LegacyMatcherTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "385:                     if ($folderUrlMatched < 2) {",
          "386:                         $folderUrlMatched = 2;",
          "391:                     }",
          "393:                     return [];",
          "",
          "[Removed Lines]",
          "388:                         return [",
          "389:                             'pageModel' => $this->mockClassWithProperties(PageModel::class, ['alias' => 'bar']),",
          "390:                         ];",
          "",
          "[Added Lines]",
          "389:                         $pageModel = $this->mockClassWithProperties(PageModel::class);",
          "390:                         $pageModel->alias = 'bar';",
          "392:                         return ['pageModel' => $pageModel];",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "442:                     if ($folderUrlMatched < 2) {",
          "443:                         $folderUrlMatched = 2;",
          "445:                         return [",
          "447:                             'parameters' => '/bar/baz',",
          "448:                         ];",
          "449:                     }",
          "",
          "[Removed Lines]",
          "446:                             'pageModel' => $this->mockClassWithProperties(PageModel::class, ['alias' => 'foo']),",
          "",
          "[Added Lines]",
          "448:                         $pageModel = $this->mockClassWithProperties(PageModel::class);",
          "449:                         $pageModel->alias = 'foo';",
          "452:                             'pageModel' => $pageModel,",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "500:                     if ($folderUrlMatched < 2) {",
          "501:                         $folderUrlMatched = 2;",
          "503:                         return [",
          "505:                             'parameters' => '/baz',",
          "506:                         ];",
          "507:                     }",
          "",
          "[Removed Lines]",
          "504:                             'pageModel' => $this->mockClassWithProperties(PageModel::class, ['alias' => 'foo']),",
          "",
          "[Added Lines]",
          "510:                         $pageModel = $this->mockClassWithProperties(PageModel::class);",
          "511:                         $pageModel->alias = 'foo';",
          "514:                             'pageModel' => $pageModel,",
          "",
          "---------------"
        ],
        "core-bundle/tests/Routing/RouteProviderTest.php||core-bundle/tests/Routing/RouteProviderTest.php": [
          "File: core-bundle/tests/Routing/RouteProviderTest.php -> core-bundle/tests/Routing/RouteProviderTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "29: {",
          "30:     public function testGetsARouteByName(): void",
          "31:     {",
          "34:         $pageAdapter = $this->mockAdapter(['findByPk']);",
          "35:         $pageAdapter",
          "",
          "[Removed Lines]",
          "32:         $page = $this->mockClassWithProperties(PageModel::class, ['id' => 17]);",
          "",
          "[Added Lines]",
          "33:         $page = $this->mockClassWithProperties(PageModel::class);",
          "34:         $page->id = 17;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "75:     public function testGetsMultipleRoutesByNames(): void",
          "76:     {",
          "77:         $pageAdapter = $this->mockAdapter(['findBy']);",
          "78:         $pageAdapter",
          "79:             ->expects($this->once())",
          "80:             ->method('findBy')",
          "81:             ->with('tl_page.id IN (17,21)')",
          "91:         ;",
          "93:         $provider = $this->mockRouteProvider($this->mockFramework($pageAdapter));",
          "",
          "[Removed Lines]",
          "82:             ->willReturn(",
          "83:                 new Collection(",
          "84:                     [",
          "85:                         $this->mockClassWithProperties(PageModel::class, ['id' => 17]),",
          "86:                         $this->mockClassWithProperties(PageModel::class, ['id' => 21]),",
          "87:                     ],",
          "88:                     'tl_page'",
          "89:                 )",
          "90:             )",
          "",
          "[Added Lines]",
          "80:         $page1 = $this->mockClassWithProperties(PageModel::class);",
          "81:         $page1->id = 17;",
          "84:         $page2 = $this->mockClassWithProperties(PageModel::class);",
          "85:         $page2->id = 21;",
          "92:             ->willReturn(new Collection([$page1, $page2], 'tl_page'))",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "99:     public function testHandlesRoutesWithDomain(): void",
          "100:     {",
          "103:         $pageAdapter = $this->mockAdapter(['findByPk']);",
          "104:         $pageAdapter",
          "",
          "[Removed Lines]",
          "101:         $page = $this->mockClassWithProperties(PageModel::class, ['id' => 17, 'domain' => 'example.org']);",
          "",
          "[Added Lines]",
          "104:         $page = $this->mockClassWithProperties(PageModel::class);",
          "105:         $page->id = 17;",
          "106:         $page->domain = 'example.org';",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "117:     public function testHandlesRoutesWithDomainAndPort(): void",
          "118:     {",
          "121:         $pageAdapter = $this->mockAdapter(['findByPk']);",
          "122:         $pageAdapter",
          "",
          "[Removed Lines]",
          "119:         $page = $this->mockClassWithProperties(PageModel::class, ['id' => 17, 'domain' => 'example.org:8080']);",
          "",
          "[Added Lines]",
          "125:         $page = $this->mockClassWithProperties(PageModel::class);",
          "126:         $page->id = 17;",
          "127:         $page->domain = 'example.org:8080';",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "547:     private function createPage(string $language, string $alias, bool $fallback = true, string $domain = '', string $scheme = null): PageModel",
          "548:     {",
          "562:     }",
          "",
          "[Removed Lines]",
          "549:         return $this->mockClassWithProperties(",
          "550:             PageModel::class,",
          "551:             [",
          "552:                 'id' => random_int(1, 10000),",
          "553:                 'type' => 'regular',",
          "554:                 'alias' => $alias,",
          "555:                 'domain' => $domain,",
          "556:                 'rootLanguage' => $language,",
          "557:                 'rootIsFallback' => $fallback,",
          "558:                 'rootUseSSL' => 'https' === $scheme,",
          "559:                 'rootSorting' => array_reduce((array) $language, static function ($c, $i) { return $c + \\ord($i); }, 0),",
          "560:             ]",
          "561:         );",
          "",
          "[Added Lines]",
          "558:         $page = $this->mockClassWithProperties(PageModel::class);",
          "559:         $page->id = random_int(1, 10000);",
          "560:         $page->type = 'regular';",
          "561:         $page->alias = $alias;",
          "562:         $page->domain = $domain;",
          "563:         $page->rootLanguage = $language;",
          "564:         $page->rootIsFallback = $fallback;",
          "565:         $page->rootUseSSL = 'https' === $scheme;",
          "566:         $page->rootSorting = array_reduce((array) $language, static function ($c, $i) { return $c + \\ord($i); }, 0);",
          "568:         return $page;",
          "",
          "---------------"
        ],
        "core-bundle/tests/Security/Authentication/FrontendPreviewAuthenticatorTest.php||core-bundle/tests/Security/Authentication/FrontendPreviewAuthenticatorTest.php": [
          "File: core-bundle/tests/Security/Authentication/FrontendPreviewAuthenticatorTest.php -> core-bundle/tests/Security/Authentication/FrontendPreviewAuthenticatorTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "110:     public function testChecksTheBackendUsersAccessPermissions(bool $isAdmin, $amg, bool $isValid): void",
          "111:     {",
          "115:         $token = $this->createMock(TokenInterface::class);",
          "116:         $token",
          "",
          "[Removed Lines]",
          "113:         $user = $this->mockClassWithProperties(BackendUser::class, compact('isAdmin', 'amg'));",
          "",
          "[Added Lines]",
          "113:         $user = $this->mockClassWithProperties(BackendUser::class);",
          "114:         $user->isAdmin = $isAdmin;",
          "115:         $user->amg = $amg;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "156:     public function testDoesNotAuthenticateIfThereIsNotFrontendUser(): void",
          "157:     {",
          "161:         $token = $this->createMock(TokenInterface::class);",
          "162:         $token",
          "",
          "[Removed Lines]",
          "159:         $user = $this->mockClassWithProperties(BackendUser::class, ['isAdmin' => true]);",
          "",
          "[Added Lines]",
          "161:         $user = $this->mockClassWithProperties(BackendUser::class);",
          "162:         $user->isAdmin = true;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "203:     public function testChecksTheBackendUsersFrontendGroupAccess(bool $isAdmin, $amg, $groups, bool $isValid): void",
          "204:     {",
          "210:         $frontendUser",
          "211:             ->method('getRoles')",
          "212:             ->willReturn([])",
          "",
          "[Removed Lines]",
          "206:         $backendUser = $this->mockClassWithProperties(BackendUser::class, compact('isAdmin', 'amg'));",
          "209:         $frontendUser = $this->mockClassWithProperties(FrontendUser::class, compact('groups'));",
          "",
          "[Added Lines]",
          "209:         $backendUser = $this->mockClassWithProperties(BackendUser::class);",
          "210:         $backendUser->isAdmin = $isAdmin;",
          "211:         $backendUser->amg = $amg;",
          "214:         $frontendUser = $this->mockClassWithProperties(FrontendUser::class);",
          "215:         $frontendUser->groups = $groups;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "257:     public function testAuthenticatesAFrontendUserWithUnpublishedElementsHidden(): void",
          "258:     {",
          "262:         $token = $this->createMock(TokenInterface::class);",
          "263:         $token",
          "",
          "[Removed Lines]",
          "260:         $backendUser = $this->mockClassWithProperties(BackendUser::class, ['isAdmin' => true]);",
          "",
          "[Added Lines]",
          "267:         $backendUser = $this->mockClassWithProperties(BackendUser::class);",
          "268:         $backendUser->isAdmin = true;",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "310:     public function testAuthenticatesAFrontendUserWithUnpublishedElementsVisible(): void",
          "311:     {",
          "315:         $token = $this->createMock(TokenInterface::class);",
          "316:         $token",
          "",
          "[Removed Lines]",
          "313:         $backendUser = $this->mockClassWithProperties(BackendUser::class, ['isAdmin' => true]);",
          "",
          "[Added Lines]",
          "321:         $backendUser = $this->mockClassWithProperties(BackendUser::class);",
          "322:         $backendUser->isAdmin = true;",
          "",
          "---------------"
        ],
        "core-bundle/tests/Security/Logout/LogoutHandlerTest.php||core-bundle/tests/Security/Logout/LogoutHandlerTest.php": [
          "File: core-bundle/tests/Security/Logout/LogoutHandlerTest.php -> core-bundle/tests/Security/Logout/LogoutHandlerTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "38:         ;",
          "43:         $token = $this->createMock(TokenInterface::class);",
          "44:         $token",
          "",
          "[Removed Lines]",
          "41:         $user = $this->mockClassWithProperties(BackendUser::class, ['username' => 'foobar']);",
          "",
          "[Added Lines]",
          "41:         $user = $this->mockClassWithProperties(BackendUser::class);",
          "42:         $user->username = 'foobar';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "80:     public function testTriggersThePostLogoutHook(): void",
          "81:     {",
          "85:         $listener = $this->createPartialMock(Controller::class, ['onPostLogout']);",
          "86:         $listener",
          "",
          "[Removed Lines]",
          "83:         $user = $this->mockClassWithProperties(BackendUser::class, ['username' => 'foobar']);",
          "",
          "[Added Lines]",
          "84:         $user = $this->mockClassWithProperties(BackendUser::class);",
          "85:         $user->username = 'foobar';",
          "",
          "---------------"
        ],
        "core-bundle/tests/Security/TwoFactor/AuthenticatorTest.php||core-bundle/tests/Security/TwoFactor/AuthenticatorTest.php": [
          "File: core-bundle/tests/Security/TwoFactor/AuthenticatorTest.php -> core-bundle/tests/Security/TwoFactor/AuthenticatorTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "28:         $totp = TOTP::create(Base32::encodeUpperUnpadded($secret));",
          "33:         $authenticator = new Authenticator();",
          "",
          "[Removed Lines]",
          "31:         $user = $this->mockClassWithProperties(BackendUser::class, ['secret' => $secret]);",
          "",
          "[Added Lines]",
          "31:         $user = $this->mockClassWithProperties(BackendUser::class);",
          "32:         $user->secret = $secret;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "41:         $secret = random_bytes(128);",
          "45:         $user",
          "46:             ->expects($this->exactly(2))",
          "47:             ->method('getUsername')",
          "",
          "[Removed Lines]",
          "44:         $user = $this->mockClassWithProperties(BackendUser::class, ['secret' => $secret]);",
          "",
          "[Added Lines]",
          "45:         $user = $this->mockClassWithProperties(BackendUser::class);",
          "46:         $user->secret = $secret;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "82: SVG;",
          "86:         $user",
          "87:             ->expects($this->once())",
          "88:             ->method('getUsername')",
          "",
          "[Removed Lines]",
          "85:         $user = $this->mockClassWithProperties(BackendUser::class, ['secret' => 'foobar']);",
          "",
          "[Added Lines]",
          "88:         $user = $this->mockClassWithProperties(BackendUser::class);",
          "89:         $user->secret = 'foobar';",
          "",
          "---------------"
        ],
        "core-bundle/tests/Security/TwoFactor/ProviderTest.php||core-bundle/tests/Security/TwoFactor/ProviderTest.php": [
          "File: core-bundle/tests/Security/TwoFactor/ProviderTest.php -> core-bundle/tests/Security/TwoFactor/ProviderTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "45:         $renderer = $this->createMock(BackendFormRenderer::class);",
          "50:         $context = $this->createMock(AuthenticationContextInterface::class);",
          "51:         $context",
          "",
          "[Removed Lines]",
          "48:         $user = $this->mockClassWithProperties(User::class, ['useTwoFactor' => '']);",
          "",
          "[Added Lines]",
          "48:         $user = $this->mockClassWithProperties(User::class);",
          "49:         $user->useTwoFactor = '';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "65:         $renderer = $this->createMock(BackendFormRenderer::class);",
          "70:         $context = $this->createMock(AuthenticationContextInterface::class);",
          "71:         $context",
          "",
          "[Removed Lines]",
          "68:         $user = $this->mockClassWithProperties(User::class, ['useTwoFactor' => '1']);",
          "",
          "[Added Lines]",
          "69:         $user = $this->mockClassWithProperties(User::class);",
          "70:         $user->useTwoFactor = '1';",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "109:     public function testValidatesTheAuthenticationCode(): void",
          "110:     {",
          "114:         $renderer = $this->createMock(BackendFormRenderer::class);",
          "",
          "[Removed Lines]",
          "112:         $user = $this->mockClassWithProperties(User::class, ['useTwoFactor' => '1']);",
          "",
          "[Added Lines]",
          "114:         $user = $this->mockClassWithProperties(User::class);",
          "115:         $user->useTwoFactor = '1';",
          "",
          "---------------"
        ],
        "core-bundle/tests/Security/User/ContaoUserProviderTest.php||core-bundle/tests/Security/User/ContaoUserProviderTest.php": [
          "File: core-bundle/tests/Security/User/ContaoUserProviderTest.php -> core-bundle/tests/Security/User/ContaoUserProviderTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "58:     public function testRefreshesTheUser(): void",
          "59:     {",
          "62:         $adapter = $this->mockConfiguredAdapter(['loadUserByUsername' => $user]);",
          "63:         $framework = $this->mockContaoFramework([BackendUser::class => $adapter]);",
          "",
          "[Removed Lines]",
          "61:         $user = $this->mockClassWithProperties(BackendUser::class, ['username' => 'foobar']);",
          "",
          "[Added Lines]",
          "61:         $user = $this->mockClassWithProperties(BackendUser::class);",
          "62:         $user->username = 'foobar';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "70:     public function testValidatesTheSessionLifetime(): void",
          "71:     {",
          "74:         $userAdapter = $this->mockConfiguredAdapter(['loadUserByUsername' => $user]);",
          "76:         $configAdapter = $this->mockAdapter(['get']);",
          "",
          "[Removed Lines]",
          "73:         $user = $this->mockClassWithProperties(BackendUser::class, ['username' => 'foobar']);",
          "",
          "[Added Lines]",
          "75:         $user = $this->mockClassWithProperties(BackendUser::class);",
          "76:         $user->username = 'foobar';",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "122:     public function testLogsOutUsersWhoHaveBeenInactiveForTooLong(): void",
          "123:     {",
          "126:         $userAdapter = $this->mockConfiguredAdapter(['loadUserByUsername' => $user]);",
          "128:         $configAdapter = $this->mockAdapter(['get']);",
          "",
          "[Removed Lines]",
          "125:         $user = $this->mockClassWithProperties(BackendUser::class, ['username' => 'foobar']);",
          "",
          "[Added Lines]",
          "129:         $user = $this->mockClassWithProperties(BackendUser::class);",
          "130:         $user->username = 'foobar';",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "210:     public function testTriggersThePostAuthenticateHook(): void",
          "211:     {",
          "215:         $listener = $this->createPartialMock(Controller::class, ['onPostAuthenticate']);",
          "216:         $listener",
          "",
          "[Removed Lines]",
          "213:         $user = $this->mockClassWithProperties(BackendUser::class, ['username' => 'foobar']);",
          "",
          "[Added Lines]",
          "219:         $user = $this->mockClassWithProperties(BackendUser::class);",
          "220:         $user->username = 'foobar';",
          "",
          "---------------"
        ],
        "core-bundle/tests/Security/User/UserCheckerTest.php||core-bundle/tests/Security/User/UserCheckerTest.php": [
          "File: core-bundle/tests/Security/User/UserCheckerTest.php -> core-bundle/tests/Security/User/UserCheckerTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "59:     public function testThrowsAnExceptionIfTheAccountIsLocked(): void",
          "60:     {",
          "69:         $userChecker = new UserChecker($this->mockContaoFramework());",
          "",
          "[Removed Lines]",
          "61:         $properties = [",
          "62:             'username' => 'foo',",
          "63:             'locked' => time() + 300,",
          "64:         ];",
          "67:         $user = $this->mockClassWithProperties(BackendUser::class, $properties);",
          "",
          "[Added Lines]",
          "62:         $user = $this->mockClassWithProperties(BackendUser::class);",
          "63:         $user->username = 'foo';",
          "64:         $user->locked = time() + 300;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "77:     public function testThrowsAnExceptionIfTheAccountIsDisabled(): void",
          "78:     {",
          "88:         $userChecker = new UserChecker($this->mockContaoFramework());",
          "",
          "[Removed Lines]",
          "79:         $properties = [",
          "80:             'username' => 'foo',",
          "81:             'locked' => 0,",
          "82:             'disable' => '1',",
          "83:         ];",
          "86:         $user = $this->mockClassWithProperties(BackendUser::class, $properties);",
          "",
          "[Added Lines]",
          "77:         $user = $this->mockClassWithProperties(BackendUser::class);",
          "78:         $user->username = 'foo';",
          "79:         $user->locked = 0;",
          "80:         $user->disable = '1';",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "96:     public function testThrowsAnExceptionIfTheUserIsNotAllowedToLogin(): void",
          "97:     {",
          "108:         $userChecker = new UserChecker($this->mockContaoFramework());",
          "",
          "[Removed Lines]",
          "98:         $properties = [",
          "99:             'username' => 'foo',",
          "100:             'locked' => 0,",
          "101:             'disable' => '',",
          "102:             'login' => '',",
          "103:         ];",
          "106:         $user = $this->mockClassWithProperties(FrontendUser::class, $properties);",
          "",
          "[Added Lines]",
          "93:         $user = $this->mockClassWithProperties(FrontendUser::class);",
          "94:         $user->username = 'foo';",
          "95:         $user->locked = 0;",
          "96:         $user->disable = '';",
          "97:         $user->login = '';",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "117:     {",
          "118:         $time = strtotime('tomorrow');",
          "131:         $userChecker = new UserChecker($this->mockContaoFramework());",
          "132:         $message = sprintf('The account is not active yet (activation date: %s)', date('Y-m-d', $time));",
          "",
          "[Removed Lines]",
          "120:         $properties = [",
          "121:             'username' => 'foo',",
          "122:             'locked' => 0,",
          "123:             'disable' => '',",
          "124:             'login' => '1',",
          "125:             'start' => (string) $time,",
          "126:         ];",
          "129:         $user = $this->mockClassWithProperties(FrontendUser::class, $properties);",
          "",
          "[Added Lines]",
          "112:         $user = $this->mockClassWithProperties(FrontendUser::class);",
          "113:         $user->username = 'foo';",
          "114:         $user->locked = 0;",
          "115:         $user->disable = '';",
          "116:         $user->login = '1';",
          "117:         $user->start = (string) $time;",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "141:     {",
          "142:         $time = strtotime('yesterday');",
          "156:         $userChecker = new UserChecker($this->mockContaoFramework());",
          "157:         $message = sprintf('The account is not active anymore (deactivation date: %s)', date('Y-m-d', $time));",
          "",
          "[Removed Lines]",
          "144:         $properties = [",
          "145:             'username' => 'foo',",
          "146:             'locked' => 0,",
          "147:             'disable' => '',",
          "148:             'login' => '1',",
          "149:             'start' => '',",
          "150:             'stop' => (string) $time,",
          "151:         ];",
          "154:         $user = $this->mockClassWithProperties(FrontendUser::class, $properties);",
          "",
          "[Added Lines]",
          "133:         $user = $this->mockClassWithProperties(FrontendUser::class);",
          "134:         $user->username = 'foo';",
          "135:         $user->locked = 0;",
          "136:         $user->disable = '';",
          "137:         $user->login = '1';",
          "138:         $user->start = '';",
          "139:         $user->stop = (string) $time;",
          "",
          "---------------"
        ],
        "faq-bundle/tests/EventListener/InsertTagsListenerTest.php||faq-bundle/tests/EventListener/InsertTagsListenerTest.php": [
          "File: faq-bundle/tests/EventListener/InsertTagsListenerTest.php -> faq-bundle/tests/EventListener/InsertTagsListenerTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "17: use Contao\\FaqModel;",
          "18: use Contao\\PageModel;",
          "19: use Contao\\TestCase\\ContaoTestCase;",
          "21: class InsertTagsListenerTest extends ContaoTestCase",
          "22: {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "20: use PHPUnit\\Framework\\MockObject\\MockObject;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "39:             ->willReturn($page)",
          "40:         ;",
          "48:         $faqModel",
          "49:             ->method('getRelated')",
          "50:             ->willReturn($categoryModel)",
          "",
          "[Removed Lines]",
          "42:         $properties = [",
          "43:             'alias' => 'what-does-foobar-mean',",
          "44:             'question' => 'What does \"foobar\" mean?',",
          "45:         ];",
          "47:         $faqModel = $this->mockClassWithProperties(FaqModel::class, $properties);",
          "",
          "[Added Lines]",
          "44:         $faqModel = $this->mockClassWithProperties(FaqModel::class);",
          "45:         $faqModel->alias = 'what-does-foobar-mean';",
          "46:         $faqModel->question = 'What does \"foobar\" mean?';",
          "",
          "---------------"
        ],
        "faq-bundle/tests/Picker/FaqPickerProviderTest.php||faq-bundle/tests/Picker/FaqPickerProviderTest.php": [
          "File: faq-bundle/tests/Picker/FaqPickerProviderTest.php -> faq-bundle/tests/Picker/FaqPickerProviderTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "21: use Knp\\Menu\\FactoryInterface;",
          "22: use Knp\\Menu\\ItemInterface;",
          "23: use Knp\\Menu\\MenuItem;",
          "24: use Symfony\\Component\\Routing\\RouterInterface;",
          "25: use Symfony\\Component\\Security\\Core\\Authentication\\Token\\Storage\\TokenStorageInterface;",
          "26: use Symfony\\Component\\Security\\Core\\Authentication\\Token\\TokenInterface;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "24: use PHPUnit\\Framework\\MockObject\\MockObject;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "203:     public function testAddsTableAndIdIfThereIsAValue(): void",
          "204:     {",
          "205:         $faq = $this->createMock(FaqModel::class);",
          "206:         $faq",
          "207:             ->expects($this->once())",
          "208:             ->method('getRelated')",
          "209:             ->with('pid')",
          "211:         ;",
          "213:         $config = new PickerConfig('link', [], '{{faq_url::1}}', 'faqPicker');",
          "",
          "[Removed Lines]",
          "210:             ->willReturn($this->mockClassWithProperties(FaqCategoryModel::class, ['id' => 1]))",
          "",
          "[Added Lines]",
          "207:         $model = $this->mockClassWithProperties(FaqCategoryModel::class);",
          "208:         $model->id = 1;",
          "215:             ->willReturn($model)",
          "",
          "---------------"
        ],
        "manager-bundle/tests/EventListener/BackendMenuListenerTest.php||manager-bundle/tests/EventListener/BackendMenuListenerTest.php": [
          "File: manager-bundle/tests/EventListener/BackendMenuListenerTest.php -> manager-bundle/tests/EventListener/BackendMenuListenerTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "18: use Contao\\TestCase\\ContaoTestCase;",
          "19: use Knp\\Menu\\FactoryInterface;",
          "20: use Knp\\Menu\\MenuItem;",
          "21: use Symfony\\Component\\Security\\Core\\Authentication\\Token\\Storage\\TokenStorageInterface;",
          "22: use Symfony\\Component\\Security\\Core\\Authentication\\Token\\TokenInterface;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "21: use PHPUnit\\Framework\\MockObject\\MockObject;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "65:     private function mockBackendMenuListener(bool $isAdmin, string $path = null): BackendMenuListener",
          "66:     {",
          "67:         $token = $this->createMock(TokenInterface::class);",
          "68:         $token",
          "69:             ->method('getUser')",
          "71:         ;",
          "73:         $tokenStorage = $this->createMock(TokenStorageInterface::class);",
          "",
          "[Removed Lines]",
          "70:             ->willReturn($this->mockClassWithProperties(BackendUser::class, compact('isAdmin')))",
          "",
          "[Added Lines]",
          "69:         $model = $this->mockClassWithProperties(BackendUser::class);",
          "70:         $model->isAdmin = $isAdmin;",
          "75:             ->willReturn($model)",
          "",
          "---------------"
        ],
        "news-bundle/tests/EventListener/GeneratePageListenerTest.php||news-bundle/tests/EventListener/GeneratePageListenerTest.php": [
          "File: news-bundle/tests/EventListener/GeneratePageListenerTest.php -> news-bundle/tests/EventListener/GeneratePageListenerTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "29:     {",
          "30:         $GLOBALS['TL_HEAD'] = [];",
          "40:         $collection = new Collection([$newsFeedModel], 'tl_news_feeds');",
          "42:         $adapters = [",
          "",
          "[Removed Lines]",
          "32:         $properties = [",
          "33:             'feedBase' => 'http://localhost/',",
          "34:             'alias' => 'news',",
          "35:             'format' => 'rss',",
          "36:             'title' => 'Latest news',",
          "37:         ];",
          "39:         $newsFeedModel = $this->mockClassWithProperties(NewsFeedModel::class, $properties);",
          "",
          "[Added Lines]",
          "33:         $newsFeedModel = $this->mockClassWithProperties(NewsFeedModel::class);",
          "34:         $newsFeedModel->feedBase = 'http://localhost/';",
          "35:         $newsFeedModel->alias = 'news';",
          "36:         $newsFeedModel->format = 'rss';",
          "37:         $newsFeedModel->title = 'Latest news';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "46:         ];",
          "51:         $listener = new GeneratePageListener($this->mockContaoFramework($adapters));",
          "52:         $listener->onGeneratePage($this->createMock(PageModel::class), $layoutModel);",
          "",
          "[Removed Lines]",
          "49:         $layoutModel = $this->mockClassWithProperties(LayoutModel::class, ['newsfeeds' => 'a:1:{i:0;i:3;}']);",
          "",
          "[Added Lines]",
          "48:         $layoutModel = $this->mockClassWithProperties(LayoutModel::class);",
          "49:         $layoutModel->newsfeeds = 'a:1:{i:0;i:3;}';",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "62:         $GLOBALS['TL_HEAD'] = [];",
          "67:         $listener = new GeneratePageListener($this->mockContaoFramework());",
          "68:         $listener->onGeneratePage($this->createMock(PageModel::class), $layoutModel);",
          "",
          "[Removed Lines]",
          "65:         $layoutModel = $this->mockClassWithProperties(LayoutModel::class, ['newsfeeds' => '']);",
          "",
          "[Added Lines]",
          "65:         $layoutModel = $this->mockClassWithProperties(LayoutModel::class);",
          "66:         $layoutModel->newsfeeds = '';",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "79:         ];",
          "84:         $listener = new GeneratePageListener($this->mockContaoFramework($adapters));",
          "85:         $listener->onGeneratePage($this->createMock(PageModel::class), $layoutModel);",
          "",
          "[Removed Lines]",
          "82:         $layoutModel = $this->mockClassWithProperties(LayoutModel::class, ['newsfeeds' => 'a:1:{i:0;i:3;}']);",
          "",
          "[Added Lines]",
          "83:         $layoutModel = $this->mockClassWithProperties(LayoutModel::class);",
          "84:         $layoutModel->newsfeeds = 'a:1:{i:0;i:3;}';",
          "",
          "---------------"
        ],
        "news-bundle/tests/EventListener/InsertTagsListenerTest.php||news-bundle/tests/EventListener/InsertTagsListenerTest.php": [
          "File: news-bundle/tests/EventListener/InsertTagsListenerTest.php -> news-bundle/tests/EventListener/InsertTagsListenerTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "17: use Contao\\NewsFeedModel;",
          "18: use Contao\\NewsModel;",
          "19: use Contao\\TestCase\\ContaoTestCase;",
          "21: class InsertTagsListenerTest extends ContaoTestCase",
          "22: {",
          "23:     public function testReplacesTheNewsFeedTag(): void",
          "24:     {",
          "32:         $adapters = [",
          "33:             NewsFeedModel::class => $this->mockConfiguredAdapter(['findByPk' => $feedModel]),",
          "",
          "[Removed Lines]",
          "25:         $properties = [",
          "26:             'feedBase' => 'http://localhost/',",
          "27:             'alias' => 'news',",
          "28:         ];",
          "30:         $feedModel = $this->mockClassWithProperties(NewsFeedModel::class, $properties);",
          "",
          "[Added Lines]",
          "20: use PHPUnit\\Framework\\MockObject\\MockObject;",
          "27:         $feedModel = $this->mockClassWithProperties(NewsFeedModel::class);",
          "28:         $feedModel->feedBase = 'http://localhost/';",
          "29:         $feedModel->alias = 'news';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "44:     public function testReplacesTheNewsTags(): void",
          "45:     {",
          "53:         $news = $this->mockAdapter(['generateNewsUrl']);",
          "54:         $news",
          "",
          "[Removed Lines]",
          "46:         $properties = [",
          "47:             'headline' => '\"Foo\" is not \"bar\"',",
          "48:             'teaser' => '<p>Foo does not equal bar.</p>',",
          "49:         ];",
          "51:         $newsModel = $this->mockClassWithProperties(NewsModel::class, $properties);",
          "",
          "[Added Lines]",
          "46:         $newsModel = $this->mockClassWithProperties(NewsModel::class);",
          "47:         $newsModel->headline = '\"Foo\" is not \"bar\"';",
          "48:         $newsModel->teaser = '<p>Foo does not equal bar.</p>';",
          "",
          "---------------"
        ],
        "news-bundle/tests/EventListener/PreviewUrlCreateListenerTest.php||news-bundle/tests/EventListener/PreviewUrlCreateListenerTest.php": [
          "File: news-bundle/tests/EventListener/PreviewUrlCreateListenerTest.php -> news-bundle/tests/EventListener/PreviewUrlCreateListenerTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "17: use Contao\\NewsBundle\\EventListener\\PreviewUrlCreateListener;",
          "18: use Contao\\NewsModel;",
          "19: use Contao\\TestCase\\ContaoTestCase;",
          "20: use Symfony\\Component\\HttpFoundation\\Request;",
          "21: use Symfony\\Component\\HttpFoundation\\RequestStack;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "20: use PHPUnit\\Framework\\MockObject\\MockObject;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "28:         $requestStack->push(new Request());",
          "30:         $event = new PreviewUrlCreateEvent('news', 1);",
          "33:         $adapters = [",
          "34:             NewsModel::class => $this->mockConfiguredAdapter(['findByPk' => $newsModel]),",
          "",
          "[Removed Lines]",
          "31:         $newsModel = $this->mockClassWithProperties(NewsModel::class, ['id' => 1]);",
          "",
          "[Added Lines]",
          "34:         $newsModel = $this->mockClassWithProperties(NewsModel::class);",
          "35:         $newsModel->id = 1;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "95:         $requestStack = new RequestStack();",
          "96:         $requestStack->push($request);",
          "100:         $adapters = [",
          "101:             NewsModel::class => $this->mockConfiguredAdapter(['findByPk' => $newsModel]),",
          "",
          "[Removed Lines]",
          "98:         $newsModel = $this->mockClassWithProperties(NewsModel::class, ['id' => 2]);",
          "",
          "[Added Lines]",
          "103:         $newsModel = $this->mockClassWithProperties(NewsModel::class);",
          "104:         $newsModel->id = 2;",
          "",
          "---------------"
        ],
        "news-bundle/tests/Picker/NewsPickerProviderTest.php||news-bundle/tests/Picker/NewsPickerProviderTest.php": [
          "File: news-bundle/tests/Picker/NewsPickerProviderTest.php -> news-bundle/tests/Picker/NewsPickerProviderTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "21: use Knp\\Menu\\FactoryInterface;",
          "22: use Knp\\Menu\\ItemInterface;",
          "23: use Knp\\Menu\\MenuItem;",
          "24: use Symfony\\Component\\Routing\\RouterInterface;",
          "25: use Symfony\\Component\\Security\\Core\\Authentication\\Token\\Storage\\TokenStorageInterface;",
          "26: use Symfony\\Component\\Security\\Core\\Authentication\\Token\\TokenInterface;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "24: use PHPUnit\\Framework\\MockObject\\MockObject;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "203:     public function testAddsTableAndIdIfThereIsAValue(): void",
          "204:     {",
          "205:         $news = $this->createMock(NewsModel::class);",
          "206:         $news",
          "207:             ->expects($this->once())",
          "208:             ->method('getRelated')",
          "209:             ->with('pid')",
          "211:         ;",
          "213:         $config = new PickerConfig('link', [], '{{news_url::1}}', 'newsPicker');",
          "",
          "[Removed Lines]",
          "210:             ->willReturn($this->mockClassWithProperties(NewsArchiveModel::class, ['id' => 1]))",
          "",
          "[Added Lines]",
          "207:         $model = $this->mockClassWithProperties(NewsArchiveModel::class);",
          "208:         $model->id = 1;",
          "215:             ->willReturn($model)",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "467e31cc8e1e6e6c74f12e5fe8c06a685c8d7384",
      "candidate_info": {
        "commit_hash": "467e31cc8e1e6e6c74f12e5fe8c06a685c8d7384",
        "repo": "contao/contao",
        "commit_url": "https://github.com/contao/contao/commit/467e31cc8e1e6e6c74f12e5fe8c06a685c8d7384",
        "files": [
          "CHANGELOG.md",
          "comments-bundle/src/Resources/contao/classes/Comments.php",
          "core-bundle/src/OptIn/OptInInterface.php",
          "core-bundle/src/Resources/contao/dca/tl_opt_in.php",
          "core-bundle/src/Resources/contao/forms/Form.php",
          "core-bundle/src/Resources/contao/models/OptInModel.php",
          "core-bundle/src/Resources/contao/modules/ModulePassword.php",
          "core-bundle/src/Resources/contao/modules/ModuleRegistration.php",
          "core-bundle/tests/DependencyInjection/ContaoCoreExtensionTest.php",
          "newsletter-bundle/src/Resources/contao/modules/ModuleSubscribe.php"
        ],
        "message": "Revert some BC breaks, update the change log and run the CS fixer",
        "before_after_code_files": [
          "comments-bundle/src/Resources/contao/classes/Comments.php||comments-bundle/src/Resources/contao/classes/Comments.php",
          "core-bundle/src/OptIn/OptInInterface.php||core-bundle/src/OptIn/OptInInterface.php",
          "core-bundle/src/Resources/contao/dca/tl_opt_in.php||core-bundle/src/Resources/contao/dca/tl_opt_in.php",
          "core-bundle/src/Resources/contao/forms/Form.php||core-bundle/src/Resources/contao/forms/Form.php",
          "core-bundle/src/Resources/contao/models/OptInModel.php||core-bundle/src/Resources/contao/models/OptInModel.php",
          "core-bundle/src/Resources/contao/modules/ModulePassword.php||core-bundle/src/Resources/contao/modules/ModulePassword.php",
          "core-bundle/src/Resources/contao/modules/ModuleRegistration.php||core-bundle/src/Resources/contao/modules/ModuleRegistration.php",
          "core-bundle/tests/DependencyInjection/ContaoCoreExtensionTest.php||core-bundle/tests/DependencyInjection/ContaoCoreExtensionTest.php",
          "newsletter-bundle/src/Resources/contao/modules/ModuleSubscribe.php||newsletter-bundle/src/Resources/contao/modules/ModuleSubscribe.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "comments-bundle/src/Resources/contao/classes/Comments.php||comments-bundle/src/Resources/contao/classes/Comments.php",
            "core-bundle/src/Resources/contao/dca/tl_opt_in.php||core-bundle/src/Resources/contao/dca/tl_opt_in.php",
            "core-bundle/src/Resources/contao/models/OptInModel.php||core-bundle/src/Resources/contao/models/OptInModel.php",
            "core-bundle/src/Resources/contao/modules/ModulePassword.php||core-bundle/src/Resources/contao/modules/ModulePassword.php",
            "core-bundle/src/Resources/contao/modules/ModuleRegistration.php||core-bundle/src/Resources/contao/modules/ModuleRegistration.php",
            "newsletter-bundle/src/Resources/contao/modules/ModuleSubscribe.php||newsletter-bundle/src/Resources/contao/modules/ModuleSubscribe.php"
          ],
          "candidate": [
            "comments-bundle/src/Resources/contao/classes/Comments.php||comments-bundle/src/Resources/contao/classes/Comments.php",
            "core-bundle/src/Resources/contao/dca/tl_opt_in.php||core-bundle/src/Resources/contao/dca/tl_opt_in.php",
            "core-bundle/src/Resources/contao/models/OptInModel.php||core-bundle/src/Resources/contao/models/OptInModel.php",
            "core-bundle/src/Resources/contao/modules/ModulePassword.php||core-bundle/src/Resources/contao/modules/ModulePassword.php",
            "core-bundle/src/Resources/contao/modules/ModuleRegistration.php||core-bundle/src/Resources/contao/modules/ModuleRegistration.php",
            "newsletter-bundle/src/Resources/contao/modules/ModuleSubscribe.php||newsletter-bundle/src/Resources/contao/modules/ModuleSubscribe.php"
          ]
        }
      },
      "candidate_diff": {
        "comments-bundle/src/Resources/contao/classes/Comments.php||comments-bundle/src/Resources/contao/classes/Comments.php": [
          "File: comments-bundle/src/Resources/contao/classes/Comments.php -> comments-bundle/src/Resources/contao/classes/Comments.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "173:    return;",
          "174:   }",
          "186:   {",
          "189:    return;",
          "190:   }",
          "",
          "[Removed Lines]",
          "177:   if (strncmp(\\Input::get('token'), 'com-', 4) === 0)",
          "178:   {",
          "179:    static::confirmSubscription(\\Input::get('token'), $objTemplate);",
          "181:    return;",
          "182:   }",
          "185:   if (strncmp(\\Input::get('token'), 'cor-', 4) === 0)",
          "187:    static::removeSubscription(\\Input::get('token'), $objTemplate);",
          "",
          "[Added Lines]",
          "177:   if (strncmp(\\Input::get('token'), 'com-', 4) === 0 || strncmp(\\Input::get('token'), 'cor-', 4) === 0)",
          "179:    static::changeSubscriptionStatus($objTemplate);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "585:   $optIn = \\System::getContainer()->get('contao.opt-in');",
          "594:  }",
          "603:  {",
          "609:   {",
          "634:   {",
          "642:  }",
          "",
          "[Removed Lines]",
          "586:   $optInToken = $optIn->create('com-', $objComment->email, array('tl_comments_notify'=>$objNotify->id));",
          "589:   $optInToken->send",
          "590:   (",
          "591:    sprintf($GLOBALS['TL_LANG']['MSC']['com_optInSubject'], \\Idna::decode(\\Environment::get('host'))),",
          "592:    sprintf($GLOBALS['TL_LANG']['MSC']['com_optInMessage'], $objComment->name, $strUrl, $strUrl . $strConnector . 'token=' . $optInToken->getIdentifier(), $strUrl . $strConnector . 'token=' . $objNotify->tokenRemove)",
          "593:   );",
          "602:  public static function confirmSubscription($token, FrontendTemplate $objTemplate)",
          "605:   $optIn = \\System::getContainer()->get('contao.opt-in');",
          "608:   if (!($optInToken = $optIn->find($token)) || $optInToken->isConfirmed() || \\count($arrRelated = $optInToken->getRelatedRecords()) != 1 || key($arrRelated) != 'tl_comments_notify' || (!$objNotify = \\CommentsNotifyModel::findByPk(current($arrRelated))))",
          "610:    $objTemplate->confirm = $GLOBALS['TL_LANG']['MSC']['invalidTokenUrl'];",
          "612:    return;",
          "613:   }",
          "615:   $objNotify->active = '1';",
          "616:   $objNotify->save();",
          "618:   $optInToken->confirm();",
          "620:   $objTemplate->confirm = $GLOBALS['TL_LANG']['MSC']['com_optInConfirm'];",
          "621:  }",
          "629:  public static function removeSubscription($token, FrontendTemplate $objTemplate)",
          "630:  {",
          "631:   $objNotify = \\CommentsNotifyModel::findOneByTokenRemove($token);",
          "633:   if ($objNotify === null)",
          "635:    $objTemplate->confirm = $GLOBALS['TL_LANG']['MSC']['invalidTokenUrl'];",
          "637:    return;",
          "638:   }",
          "640:   $objNotify->delete();",
          "641:   $objTemplate->confirm = $GLOBALS['TL_LANG']['MSC']['com_optInCancel'];",
          "",
          "[Added Lines]",
          "578:   $optInToken = $optIn->create('com-', $objComment->email, array('tl_comments_notify'=>array($objNotify->id)));",
          "581:   $optInToken->send(sprintf($GLOBALS['TL_LANG']['MSC']['com_optInSubject'], \\Idna::decode(\\Environment::get('host'))), sprintf($GLOBALS['TL_LANG']['MSC']['com_optInMessage'], $objComment->name, $strUrl, $strUrl . $strConnector . 'token=' . $optInToken->getIdentifier(), $strUrl . $strConnector . 'token=' . $objNotify->tokenRemove));",
          "589:  public static function changeSubscriptionStatus(FrontendTemplate $objTemplate)",
          "591:   if (strncmp(\\Input::get('token'), 'com-', 4) === 0)",
          "594:    $optIn = \\System::getContainer()->get('contao.opt-in');",
          "597:    if ((!$optInToken = $optIn->find(\\Input::get('token'))) || $optInToken->isConfirmed() || \\count($arrRelated = $optInToken->getRelatedRecords()) != 1 || key($arrRelated) != 'tl_comments_notify' || \\count($arrIds = current($arrRelated)) != 1 || (!$objNotify = \\CommentsNotifyModel::findByPk($arrIds[0])))",
          "598:    {",
          "599:     $objTemplate->confirm = $GLOBALS['TL_LANG']['MSC']['invalidTokenUrl'];",
          "601:     return;",
          "602:    }",
          "604:    $objNotify->active = '1';",
          "605:    $objNotify->save();",
          "607:    $optInToken->confirm();",
          "609:    $objTemplate->confirm = $GLOBALS['TL_LANG']['MSC']['com_optInConfirm'];",
          "610:   }",
          "611:   elseif (strncmp(\\Input::get('token'), 'cor-', 4) === 0)",
          "613:    $objNotify = \\CommentsNotifyModel::findOneByTokenRemove(\\Input::get('token'));",
          "615:    if ($objNotify === null)",
          "616:    {",
          "617:     $objTemplate->confirm = $GLOBALS['TL_LANG']['MSC']['invalidTokenUrl'];",
          "619:     return;",
          "620:    }",
          "622:    $objNotify->delete();",
          "623:    $objTemplate->confirm = $GLOBALS['TL_LANG']['MSC']['com_optInCancel'];",
          "624:   }",
          "",
          "---------------"
        ],
        "core-bundle/src/OptIn/OptInInterface.php||core-bundle/src/OptIn/OptInInterface.php": [
          "File: core-bundle/src/OptIn/OptInInterface.php -> core-bundle/src/OptIn/OptInInterface.php"
        ],
        "core-bundle/src/Resources/contao/dca/tl_opt_in.php||core-bundle/src/Resources/contao/dca/tl_opt_in.php": [
          "File: core-bundle/src/Resources/contao/dca/tl_opt_in.php -> core-bundle/src/Resources/contao/dca/tl_opt_in.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "163:    foreach ($arrRow as $k=>$v)",
          "164:    {",
          "167:     $arrAdd[$label] = $v;",
          "168:    }",
          "",
          "[Removed Lines]",
          "165:     $label = is_array($GLOBALS['TL_DCA']['tl_opt_in_related']['fields'][$k]['label']) ? $GLOBALS['TL_DCA']['tl_opt_in_related']['fields'][$k]['label'][0] : $GLOBALS['TL_DCA']['tl_opt_in_related']['fields'][$k]['label'];",
          "",
          "[Added Lines]",
          "165:     $label = \\is_array($GLOBALS['TL_DCA']['tl_opt_in_related']['fields'][$k]['label']) ? $GLOBALS['TL_DCA']['tl_opt_in_related']['fields'][$k]['label'][0] : $GLOBALS['TL_DCA']['tl_opt_in_related']['fields'][$k]['label'];",
          "",
          "---------------"
        ],
        "core-bundle/src/Resources/contao/forms/Form.php||core-bundle/src/Resources/contao/forms/Form.php": [
          "File: core-bundle/src/Resources/contao/forms/Form.php -> core-bundle/src/Resources/contao/forms/Form.php"
        ],
        "core-bundle/src/Resources/contao/models/OptInModel.php||core-bundle/src/Resources/contao/models/OptInModel.php": [
          "File: core-bundle/src/Resources/contao/models/OptInModel.php -> core-bundle/src/Resources/contao/models/OptInModel.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "147:   while ($objRelated->next())",
          "148:   {",
          "150:   }",
          "152:   return $arrRelated;",
          "",
          "[Removed Lines]",
          "149:    $arrRelated[$objRelated->relTable] = $objRelated->relId;",
          "",
          "[Added Lines]",
          "149:    $arrRelated[$objRelated->relTable][] = $objRelated->relId;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "171:    throw new \\LogicException(sprintf('Token \"%s\" already contains related records', $this->token));",
          "172:   }",
          "175:   {",
          "178:   }",
          "179:  }",
          "180: }",
          "",
          "[Removed Lines]",
          "174:   foreach ($arrRelated as $strTable=>$intId)",
          "176:    $objDatabase->prepare(\"INSERT INTO tl_opt_in_related (pid, relTable, relId) VALUES (?, ?, ?)\")",
          "177:       ->execute($this->id, $strTable, $intId);",
          "",
          "[Added Lines]",
          "174:   foreach ($arrRelated as $strTable=>$arrIds)",
          "176:    foreach ($arrIds as $intId)",
          "177:    {",
          "178:     $objDatabase->prepare(\"INSERT INTO tl_opt_in_related (pid, relTable, relId) VALUES (?, ?, ?)\")",
          "179:        ->execute($this->id, $strTable, $intId);",
          "180:    }",
          "",
          "---------------"
        ],
        "core-bundle/src/Resources/contao/modules/ModulePassword.php||core-bundle/src/Resources/contao/modules/ModulePassword.php": [
          "File: core-bundle/src/Resources/contao/modules/ModulePassword.php -> core-bundle/src/Resources/contao/modules/ModulePassword.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "67:   if (strncmp(\\Input::get('token'), 'pw-', 3) === 0)",
          "68:   {",
          "71:    return;",
          "72:   }",
          "",
          "[Removed Lines]",
          "69:    $this->setNewPassword(\\Input::get('token'));",
          "",
          "[Added Lines]",
          "69:    $this->setNewPassword();",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "177:  {",
          "179:   $optIn = \\System::getContainer()->get('contao.opt-in');",
          "183:   {",
          "184:    $this->strTemplate = 'mod_message';",
          "",
          "[Removed Lines]",
          "176:  protected function setNewPassword($token)",
          "182:   if (!($optInToken = $optIn->find($token)) || $optInToken->isConfirmed() || \\count($arrRelated = $optInToken->getRelatedRecords()) != 1 || key($arrRelated) != 'tl_member' || (!$objMember = \\MemberModel::findByPk(current($arrRelated))) || !$objMember->login)",
          "",
          "[Added Lines]",
          "174:  protected function setNewPassword()",
          "180:   if ((!$optInToken = $optIn->find(\\Input::get('token'))) || $optInToken->isConfirmed() || \\count($arrRelated = $optInToken->getRelatedRecords()) != 1 || key($arrRelated) != 'tl_member' || \\count($arrIds = current($arrRelated)) != 1 || (!$objMember = \\MemberModel::findByPk($arrIds[0])))",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "289:  {",
          "291:   $optIn = \\System::getContainer()->get('contao.opt-in');",
          "295:   $arrData = $objMember->row();",
          "",
          "[Removed Lines]",
          "292:   $optInToken = $optIn->create('pw-', $objMember->email, array('tl_member'=>$objMember->id));",
          "",
          "[Added Lines]",
          "290:   $optInToken = $optIn->create('pw-', $objMember->email, array('tl_member'=>array($objMember->id)));",
          "",
          "---------------"
        ],
        "core-bundle/src/Resources/contao/modules/ModuleRegistration.php||core-bundle/src/Resources/contao/modules/ModuleRegistration.php": [
          "File: core-bundle/src/Resources/contao/modules/ModuleRegistration.php -> core-bundle/src/Resources/contao/modules/ModuleRegistration.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "91:   if (strncmp(\\Input::get('token'), 'reg-', 4) === 0)",
          "92:   {",
          "95:    return;",
          "96:   }",
          "",
          "[Removed Lines]",
          "93:    $this->activateAcount(\\Input::get('token'));",
          "",
          "[Added Lines]",
          "93:    $this->activateAcount();",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "386:   $objNewUser->setRow($arrData);",
          "387:   $objNewUser->save();",
          "390:   if ($this->reg_activate)",
          "391:   {",
          "393:   }",
          "",
          "[Removed Lines]",
          "392:    $this->sendActivationMail($objNewUser->id, $arrData);",
          "",
          "[Added Lines]",
          "390:   $arrData['id'] = $objNewUser->id;",
          "395:    $this->sendActivationMail($arrData);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "462:  {",
          "464:   $optIn = \\System::getContainer()->get('contao.opt-in');",
          "468:   $arrTokenData = $arrData;",
          "",
          "[Removed Lines]",
          "461:  protected function sendActivationMail($intId, $arrData)",
          "465:   $optInToken = $optIn->create('reg-', $arrData['email'], array('tl_member'=>$intId));",
          "",
          "[Added Lines]",
          "463:  protected function sendActivationMail($arrData)",
          "467:   $optInToken = $optIn->create('reg-', $arrData['email'], array('tl_member'=>array($arrData['id'])));",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "516:  {",
          "517:   $this->strTemplate = 'mod_message';",
          "518:   $this->Template = new \\FrontendTemplate($this->strTemplate);",
          "",
          "[Removed Lines]",
          "515:  protected function activateAcount($token)",
          "",
          "[Added Lines]",
          "515:  protected function activateAcount()",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "521:   $optIn = \\System::getContainer()->get('contao.opt-in');",
          "525:   {",
          "526:    $this->Template->type = 'error';",
          "527:    $this->Template->message = $GLOBALS['TL_LANG']['MSC']['accountError'];",
          "",
          "[Removed Lines]",
          "524:   if (!($optInToken = $optIn->find($token)) || $optInToken->isConfirmed() || \\count($arrRelated = $optInToken->getRelatedRecords()) != 1 || key($arrRelated) != 'tl_member' || (!$objMember = \\MemberModel::findByPk(current($arrRelated))))",
          "",
          "[Added Lines]",
          "524:   if ((!$optInToken = $optIn->find(\\Input::get('token'))) || $optInToken->isConfirmed() || \\count($arrRelated = $optInToken->getRelatedRecords()) != 1 || key($arrRelated) != 'tl_member' || \\count($arrIds = current($arrRelated)) != 1 || (!$objMember = \\MemberModel::findByPk($arrIds[0])))",
          "",
          "---------------"
        ],
        "core-bundle/tests/DependencyInjection/ContaoCoreExtensionTest.php||core-bundle/tests/DependencyInjection/ContaoCoreExtensionTest.php": [
          "File: core-bundle/tests/DependencyInjection/ContaoCoreExtensionTest.php -> core-bundle/tests/DependencyInjection/ContaoCoreExtensionTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "102: use Contao\\Image\\PictureGenerator;",
          "103: use Contao\\Image\\ResizeCalculator;",
          "104: use Contao\\ImagineSvg\\Imagine as ImagineSvg;",
          "106: use Knp\\Menu\\Matcher\\Matcher;",
          "107: use Knp\\Menu\\Renderer\\ListRenderer;",
          "108: use Symfony\\Component\\Config\\FileLocator;",
          "",
          "[Removed Lines]",
          "105: use Doctrine\\Common\\Cache\\FilesystemCache;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "newsletter-bundle/src/Resources/contao/modules/ModuleSubscribe.php||newsletter-bundle/src/Resources/contao/modules/ModuleSubscribe.php": [
          "File: newsletter-bundle/src/Resources/contao/modules/ModuleSubscribe.php -> newsletter-bundle/src/Resources/contao/modules/ModuleSubscribe.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "82:   if (strncmp(\\Input::get('token'), 'nl-', 3) === 0)",
          "83:   {",
          "86:    return;",
          "87:   }",
          "",
          "[Removed Lines]",
          "84:    $this->activateRecipient(\\Input::get('token'));",
          "",
          "[Added Lines]",
          "84:    $this->activateRecipient();",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "167:  {",
          "168:   $this->Template = new \\FrontendTemplate('mod_newsletter');",
          "",
          "[Removed Lines]",
          "166:  protected function activateRecipient($token)",
          "",
          "[Added Lines]",
          "164:  protected function activateRecipient()",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "171:   $optIn = \\System::getContainer()->get('contao.opt-in');",
          "175:   {",
          "176:    $this->Template->type = 'error';",
          "177:    $this->Template->message = $GLOBALS['TL_LANG']['MSC']['accountError'];",
          "",
          "[Removed Lines]",
          "174:   if (!($optInToken = $optIn->find($token)) || $optInToken->isConfirmed() || \\count($arrRelated = $optInToken->getRelatedRecords()) < 1)",
          "",
          "[Added Lines]",
          "172:   if ((!$optInToken = $optIn->find(\\Input::get('token'))) || $optInToken->isConfirmed() || \\count($arrRelated = $optInToken->getRelatedRecords()) < 1 || key($arrRelated) != 'tl_newsletter_recipients' || \\count($arrIds = current($arrRelated)) < 1)",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "184:   $arrCids = array();",
          "188:   {",
          "190:    {",
          "197:    }",
          "198:   }",
          "200:   $optInToken->confirm();",
          "",
          "[Removed Lines]",
          "187:   foreach ($arrRelated as $strTable=>$intId)",
          "189:    if ($strTable == 'tl_newsletter_recipients' && ($objRecipient = \\NewsletterRecipientsModel::findByPk($intId)))",
          "191:     $arrAdd[] = $objRecipient->id;",
          "192:     $arrCids[] = $objRecipient->pid;",
          "194:     $objRecipient->tstamp = $time;",
          "195:     $objRecipient->active = '1';",
          "196:     $objRecipient->save();",
          "",
          "[Added Lines]",
          "185:   foreach ($arrIds as $intId)",
          "187:    if (!$objRecipient = \\NewsletterRecipientsModel::findByPk($intId))",
          "189:     continue;",
          "192:    $arrAdd[] = $objRecipient->id;",
          "193:    $arrCids[] = $objRecipient->pid;",
          "195:    $objRecipient->tstamp = $time;",
          "196:    $objRecipient->active = '1';",
          "197:    $objRecipient->save();",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "328:     $objBlacklist->delete();",
          "329:    }",
          "332:   }",
          "",
          "[Removed Lines]",
          "331:    $arrRelated['tl_newsletter_recipients'] = $objRecipient->id;",
          "",
          "[Added Lines]",
          "331:    $arrRelated['tl_newsletter_recipients'][] = $objRecipient->id;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "347e61e54ed0d9c7a4439d342c57fc88c8bceedd",
      "candidate_info": {
        "commit_hash": "347e61e54ed0d9c7a4439d342c57fc88c8bceedd",
        "repo": "contao/contao",
        "commit_url": "https://github.com/contao/contao/commit/347e61e54ed0d9c7a4439d342c57fc88c8bceedd",
        "files": [
          "core-bundle/src/Command/AbstractLockedCommand.php",
          "core-bundle/src/DependencyInjection/ContaoCoreExtension.php",
          "core-bundle/src/EventListener/UserAwareTrait.php",
          "core-bundle/src/Exception/PaletteNotFoundException.php",
          "core-bundle/src/Exception/PalettePositionException.php",
          "core-bundle/src/Exception/ServiceUnavailableException.php",
          "core-bundle/src/Framework/ContaoFramework.php",
          "core-bundle/src/Framework/ScopeAwareTrait.php",
          "core-bundle/src/Image/LegacyResizer.php",
          "core-bundle/src/Monolog/ContaoTableHandler.php",
          "core-bundle/src/Resources/contao/classes/StyleSheets.php",
          "core-bundle/src/Resources/contao/classes/Versions.php",
          "core-bundle/src/Resources/contao/drivers/DC_Folder.php",
          "core-bundle/src/Resources/contao/drivers/DC_Table.php",
          "core-bundle/src/Resources/contao/library/Contao/Database/Installer.php",
          "core-bundle/src/Resources/contao/library/Contao/Database/Updater.php",
          "core-bundle/src/Resources/contao/library/Contao/DcaLoader.php",
          "core-bundle/src/Resources/contao/library/Contao/Encryption.php",
          "core-bundle/src/Resources/contao/library/Contao/GdImage.php",
          "core-bundle/src/Resources/contao/library/Contao/Picture.php",
          "core-bundle/src/Resources/contao/library/Contao/RequestToken.php",
          "core-bundle/src/Resources/contao/library/Contao/Session.php",
          "core-bundle/src/Resources/contao/library/Contao/System.php",
          "core-bundle/src/Resources/contao/library/Contao/User.php",
          "core-bundle/src/Resources/contao/models/OptInModel.php",
          "core-bundle/src/Security/Authentication/Provider/AuthenticationProvider.php",
          "manager-bundle/src/Resources/skeleton/app/config.yml"
        ],
        "message": "Improve the deprecation messages",
        "before_after_code_files": [
          "core-bundle/src/Command/AbstractLockedCommand.php||core-bundle/src/Command/AbstractLockedCommand.php",
          "core-bundle/src/DependencyInjection/ContaoCoreExtension.php||core-bundle/src/DependencyInjection/ContaoCoreExtension.php",
          "core-bundle/src/EventListener/UserAwareTrait.php||core-bundle/src/EventListener/UserAwareTrait.php",
          "core-bundle/src/Exception/PaletteNotFoundException.php||core-bundle/src/Exception/PaletteNotFoundException.php",
          "core-bundle/src/Exception/PalettePositionException.php||core-bundle/src/Exception/PalettePositionException.php",
          "core-bundle/src/Exception/ServiceUnavailableException.php||core-bundle/src/Exception/ServiceUnavailableException.php",
          "core-bundle/src/Framework/ContaoFramework.php||core-bundle/src/Framework/ContaoFramework.php",
          "core-bundle/src/Framework/ScopeAwareTrait.php||core-bundle/src/Framework/ScopeAwareTrait.php",
          "core-bundle/src/Image/LegacyResizer.php||core-bundle/src/Image/LegacyResizer.php",
          "core-bundle/src/Monolog/ContaoTableHandler.php||core-bundle/src/Monolog/ContaoTableHandler.php",
          "core-bundle/src/Resources/contao/classes/StyleSheets.php||core-bundle/src/Resources/contao/classes/StyleSheets.php",
          "core-bundle/src/Resources/contao/classes/Versions.php||core-bundle/src/Resources/contao/classes/Versions.php",
          "core-bundle/src/Resources/contao/drivers/DC_Folder.php||core-bundle/src/Resources/contao/drivers/DC_Folder.php",
          "core-bundle/src/Resources/contao/drivers/DC_Table.php||core-bundle/src/Resources/contao/drivers/DC_Table.php",
          "core-bundle/src/Resources/contao/library/Contao/Database/Installer.php||core-bundle/src/Resources/contao/library/Contao/Database/Installer.php",
          "core-bundle/src/Resources/contao/library/Contao/Database/Updater.php||core-bundle/src/Resources/contao/library/Contao/Database/Updater.php",
          "core-bundle/src/Resources/contao/library/Contao/DcaLoader.php||core-bundle/src/Resources/contao/library/Contao/DcaLoader.php",
          "core-bundle/src/Resources/contao/library/Contao/Encryption.php||core-bundle/src/Resources/contao/library/Contao/Encryption.php",
          "core-bundle/src/Resources/contao/library/Contao/GdImage.php||core-bundle/src/Resources/contao/library/Contao/GdImage.php",
          "core-bundle/src/Resources/contao/library/Contao/Picture.php||core-bundle/src/Resources/contao/library/Contao/Picture.php",
          "core-bundle/src/Resources/contao/library/Contao/RequestToken.php||core-bundle/src/Resources/contao/library/Contao/RequestToken.php",
          "core-bundle/src/Resources/contao/library/Contao/Session.php||core-bundle/src/Resources/contao/library/Contao/Session.php",
          "core-bundle/src/Resources/contao/library/Contao/System.php||core-bundle/src/Resources/contao/library/Contao/System.php",
          "core-bundle/src/Resources/contao/library/Contao/User.php||core-bundle/src/Resources/contao/library/Contao/User.php",
          "core-bundle/src/Resources/contao/models/OptInModel.php||core-bundle/src/Resources/contao/models/OptInModel.php",
          "core-bundle/src/Security/Authentication/Provider/AuthenticationProvider.php||core-bundle/src/Security/Authentication/Provider/AuthenticationProvider.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "core-bundle/src/Resources/contao/models/OptInModel.php||core-bundle/src/Resources/contao/models/OptInModel.php"
          ],
          "candidate": [
            "core-bundle/src/Resources/contao/models/OptInModel.php||core-bundle/src/Resources/contao/models/OptInModel.php"
          ]
        }
      },
      "candidate_diff": {
        "core-bundle/src/Command/AbstractLockedCommand.php||core-bundle/src/Command/AbstractLockedCommand.php": [
          "File: core-bundle/src/Command/AbstractLockedCommand.php -> core-bundle/src/Command/AbstractLockedCommand.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "30:     final protected function execute(InputInterface $input, OutputInterface $output): int",
          "31:     {",
          "34:         $store = new FlockStore($this->getTempDir());",
          "35:         $factory = new Factory($store);",
          "",
          "[Removed Lines]",
          "32:         @trigger_error('Using the AbstractLockedCommand has been deprecated and will no longer work in Contao 5.0. Use the lock service instead.', E_USER_DEPRECATED);",
          "",
          "[Added Lines]",
          "32:         @trigger_error('Using the \"AbstractLockedCommand\" has been deprecated and will no longer work in Contao 5.0. Use the lock service instead.', E_USER_DEPRECATED);",
          "",
          "---------------"
        ],
        "core-bundle/src/DependencyInjection/ContaoCoreExtension.php||core-bundle/src/DependencyInjection/ContaoCoreExtension.php": [
          "File: core-bundle/src/DependencyInjection/ContaoCoreExtension.php -> core-bundle/src/DependencyInjection/ContaoCoreExtension.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "176:             $container->getParameter('kernel.project_dir').'/'.$config['image']['target_path']",
          "177:         );",
          "180:     }",
          "181: }",
          "",
          "[Removed Lines]",
          "179:         @trigger_error('Using the contao.image.target_path parameter has been deprecated and will no longer work in Contao 5.0. Use the contao.image.target_dir parameter instead.', E_USER_DEPRECATED);",
          "",
          "[Added Lines]",
          "179:         @trigger_error('Using the \"contao.image.target_path\" parameter has been deprecated and will no longer work in Contao 5.0. Use the \"contao.image.target_dir\" parameter instead.', E_USER_DEPRECATED);",
          "",
          "---------------"
        ],
        "core-bundle/src/EventListener/UserAwareTrait.php||core-bundle/src/EventListener/UserAwareTrait.php": [
          "File: core-bundle/src/EventListener/UserAwareTrait.php -> core-bundle/src/EventListener/UserAwareTrait.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "15: use Symfony\\Component\\Security\\Core\\Authentication\\Token\\AnonymousToken;",
          "16: use Symfony\\Component\\Security\\Core\\Authentication\\Token\\Storage\\TokenStorageInterface;",
          "",
          "[Removed Lines]",
          "18: @trigger_error('Using the UserAwareTrait has been deprecated and will no longer work in Contao 5.0.', E_USER_DEPRECATED);",
          "",
          "[Added Lines]",
          "18: @trigger_error('Using the \"UserAwareTrait\" has been deprecated and will no longer work in Contao 5.0.', E_USER_DEPRECATED);",
          "",
          "---------------"
        ],
        "core-bundle/src/Exception/PaletteNotFoundException.php||core-bundle/src/Exception/PaletteNotFoundException.php": [
          "File: core-bundle/src/Exception/PaletteNotFoundException.php -> core-bundle/src/Exception/PaletteNotFoundException.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "13: namespace Contao\\CoreBundle\\Exception;",
          "",
          "[Removed Lines]",
          "15: @trigger_error('Using the Contao\\CoreBundle\\Exception\\PaletteNotFoundException class has been deprecated and will no longer work in Contao 5.0. Use the Contao\\CoreBundle\\DataContainer\\PaletteNotFoundException class instead.', E_USER_DEPRECATED);",
          "",
          "[Added Lines]",
          "15: @trigger_error('Using the \"Contao\\CoreBundle\\Exception\\PaletteNotFoundException\" class has been deprecated and will no longer work in Contao 5.0. Use the \"Contao\\CoreBundle\\DataContainer\\PaletteNotFoundException\" class instead.', E_USER_DEPRECATED);",
          "",
          "---------------"
        ],
        "core-bundle/src/Exception/PalettePositionException.php||core-bundle/src/Exception/PalettePositionException.php": [
          "File: core-bundle/src/Exception/PalettePositionException.php -> core-bundle/src/Exception/PalettePositionException.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "13: namespace Contao\\CoreBundle\\Exception;",
          "",
          "[Removed Lines]",
          "15: @trigger_error('Using the Contao\\CoreBundle\\Exception\\PalettePositionException class has been deprecated and will no longer work in Contao 5.0. Use the Contao\\CoreBundle\\DataContainer\\PalettePositionException class instead.', E_USER_DEPRECATED);",
          "",
          "[Added Lines]",
          "15: @trigger_error('Using the \"Contao\\CoreBundle\\Exception\\PalettePositionException\" class has been deprecated and will no longer work in Contao 5.0. Use the \"Contao\\CoreBundle\\DataContainer\\PalettePositionException\" class instead.', E_USER_DEPRECATED);",
          "",
          "---------------"
        ],
        "core-bundle/src/Exception/ServiceUnavailableException.php||core-bundle/src/Exception/ServiceUnavailableException.php": [
          "File: core-bundle/src/Exception/ServiceUnavailableException.php -> core-bundle/src/Exception/ServiceUnavailableException.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "13: namespace Contao\\CoreBundle\\Exception;",
          "",
          "[Removed Lines]",
          "15: @trigger_error('Using the ServiceUnavailableException class has been deprecated and will no longer work in Contao 5.0. Use the Lexik\\Bundle\\MaintenanceBundle\\Exception\\ServiceUnavailableException class instead.', E_USER_DEPRECATED);",
          "",
          "[Added Lines]",
          "15: @trigger_error('Using the \"ServiceUnavailableException\" class has been deprecated and will no longer work in Contao 5.0. Use the \"Lexik\\Bundle\\MaintenanceBundle\\Exception\\ServiceUnavailableException\" class instead.', E_USER_DEPRECATED);",
          "",
          "---------------"
        ],
        "core-bundle/src/Framework/ContaoFramework.php||core-bundle/src/Framework/ContaoFramework.php": [
          "File: core-bundle/src/Framework/ContaoFramework.php -> core-bundle/src/Framework/ContaoFramework.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "377:         }",
          "379:         if (file_exists($this->rootDir.'/system/config/initconfig.php')) {",
          "381:             include $this->rootDir.'/system/config/initconfig.php';",
          "382:         }",
          "383:     }",
          "",
          "[Removed Lines]",
          "380:             @trigger_error('Using the initconfig.php file has been deprecated and will no longer work in Contao 5.0.', E_USER_DEPRECATED);",
          "",
          "[Added Lines]",
          "380:             @trigger_error('Using the \"initconfig.php\" file has been deprecated and will no longer work in Contao 5.0.', E_USER_DEPRECATED);",
          "",
          "---------------"
        ],
        "core-bundle/src/Framework/ScopeAwareTrait.php||core-bundle/src/Framework/ScopeAwareTrait.php": [
          "File: core-bundle/src/Framework/ScopeAwareTrait.php -> core-bundle/src/Framework/ScopeAwareTrait.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "16: use Symfony\\Component\\DependencyInjection\\ContainerAwareTrait;",
          "17: use Symfony\\Component\\HttpKernel\\Event\\KernelEvent;",
          "",
          "[Removed Lines]",
          "19: @trigger_error('Using the Contao\\CoreBundle\\Framework\\ScopeAwareTrait trait has been deprecated and will no longer work in Contao 5.0. Use the contao.routing.scope_matcher service instead.', E_USER_DEPRECATED);",
          "",
          "[Added Lines]",
          "19: @trigger_error('Using the \"Contao\\CoreBundle\\Framework\\ScopeAwareTrait\" trait has been deprecated and will no longer work in Contao 5.0. Use the \"contao.routing.scope_matcher\" service instead.', E_USER_DEPRECATED);",
          "",
          "---------------"
        ],
        "core-bundle/src/Image/LegacyResizer.php||core-bundle/src/Image/LegacyResizer.php": [
          "File: core-bundle/src/Image/LegacyResizer.php -> core-bundle/src/Image/LegacyResizer.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "47:         $rootDir = System::getContainer()->getParameter('kernel.project_dir');",
          "49:         if ($this->hasExecuteResizeHook() || $this->hasGetImageHook()) {",
          "52:             $this->legacyImage = null;",
          "53:             $legacyPath = $image->getPath();",
          "",
          "[Removed Lines]",
          "50:             @trigger_error('Using the executeResize and getImage hooks has been deprecated and will no longer work in Contao 5.0. Replace the contao.image.resizer service instead.', E_USER_DEPRECATED);",
          "",
          "[Added Lines]",
          "50:             @trigger_error('Using the \"executeResize\" and \"getImage\" hooks has been deprecated and will no longer work in Contao 5.0. Replace the \"contao.image.resizer\" service instead.', E_USER_DEPRECATED);",
          "",
          "---------------"
        ],
        "core-bundle/src/Monolog/ContaoTableHandler.php||core-bundle/src/Monolog/ContaoTableHandler.php": [
          "File: core-bundle/src/Monolog/ContaoTableHandler.php -> core-bundle/src/Monolog/ContaoTableHandler.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "146:             return;",
          "147:         }",
          "152:         $system = $framework->getAdapter(System::class);",
          "",
          "[Removed Lines]",
          "149:         @trigger_error('Using the addLogEntry hook has been deprecated and will no longer work in Contao 5.0.', E_USER_DEPRECATED);",
          "",
          "[Added Lines]",
          "149:         @trigger_error('Using the \"addLogEntry\" hook has been deprecated and will no longer work in Contao 5.0.', E_USER_DEPRECATED);",
          "",
          "---------------"
        ],
        "core-bundle/src/Resources/contao/classes/StyleSheets.php||core-bundle/src/Resources/contao/classes/StyleSheets.php": [
          "File: core-bundle/src/Resources/contao/classes/StyleSheets.php -> core-bundle/src/Resources/contao/classes/StyleSheets.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "76:   if (file_exists($this->strRootDir . '/system/config/dcaconfig.php'))",
          "77:   {",
          "79:    include $this->strRootDir . '/system/config/dcaconfig.php';",
          "80:   }",
          "",
          "[Removed Lines]",
          "78:    @trigger_error('Using the dcaconfig.php file has been deprecated and will no longer work in Contao 5.0. Create one or more DCA files in contao/dca instead.', E_USER_DEPRECATED);",
          "",
          "[Added Lines]",
          "78:    @trigger_error('Using the \"dcaconfig.php\" file has been deprecated and will no longer work in Contao 5.0. Create custom DCA files in the \"contao/dca\" folder instead.', E_USER_DEPRECATED);",
          "",
          "---------------"
        ],
        "core-bundle/src/Resources/contao/classes/Versions.php||core-bundle/src/Resources/contao/classes/Versions.php": [
          "File: core-bundle/src/Resources/contao/classes/Versions.php -> core-bundle/src/Resources/contao/classes/Versions.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "353:   if (\\is_array($GLOBALS['TL_DCA'][$this->strTable]['config']['onrestore_callback']))",
          "354:   {",
          "357:    foreach ($GLOBALS['TL_DCA'][$this->strTable]['config']['onrestore_callback'] as $callback)",
          "358:    {",
          "",
          "[Removed Lines]",
          "355:    @trigger_error('Using the onrestore_callback has been deprecated and will no longer work in Contao 5.0. Use the onrestore_version_callback instead.', E_USER_DEPRECATED);",
          "",
          "[Added Lines]",
          "355:    @trigger_error('Using the \"onrestore_callback\" has been deprecated and will no longer work in Contao 5.0. Use the \"onrestore_version_callback\" instead.', E_USER_DEPRECATED);",
          "",
          "---------------"
        ],
        "core-bundle/src/Resources/contao/drivers/DC_Folder.php||core-bundle/src/Resources/contao/drivers/DC_Folder.php": [
          "File: core-bundle/src/Resources/contao/drivers/DC_Folder.php -> core-bundle/src/Resources/contao/drivers/DC_Folder.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "1532:     if (\\is_array($GLOBALS['TL_DCA'][$this->strTable]['config']['onversion_callback']))",
          "1533:     {",
          "1536:      foreach ($GLOBALS['TL_DCA'][$this->strTable]['config']['onversion_callback'] as $callback)",
          "1537:      {",
          "",
          "[Removed Lines]",
          "1534:      @trigger_error('Using the onversion_callback has been deprecated and will no longer work in Contao 5.0. Use the oncreate_version_callback instead.', E_USER_DEPRECATED);",
          "",
          "[Added Lines]",
          "1534:      @trigger_error('Using the \"onversion_callback\" has been deprecated and will no longer work in Contao 5.0. Use the \"oncreate_version_callback\" instead.', E_USER_DEPRECATED);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1761:       if (\\is_array($GLOBALS['TL_DCA'][$this->strTable]['config']['onversion_callback']))",
          "1762:       {",
          "1765:        foreach ($GLOBALS['TL_DCA'][$this->strTable]['config']['onversion_callback'] as $callback)",
          "1766:        {",
          "",
          "[Removed Lines]",
          "1763:        @trigger_error('Using the onversion_callback has been deprecated and will no longer work in Contao 5.0. Use the oncreate_version_callback instead.', E_USER_DEPRECATED);",
          "",
          "[Added Lines]",
          "1763:        @trigger_error('Using the \"onversion_callback\" has been deprecated and will no longer work in Contao 5.0. Use the \"oncreate_version_callback\" instead.', E_USER_DEPRECATED);",
          "",
          "---------------"
        ],
        "core-bundle/src/Resources/contao/drivers/DC_Table.php||core-bundle/src/Resources/contao/drivers/DC_Table.php": [
          "File: core-bundle/src/Resources/contao/drivers/DC_Table.php -> core-bundle/src/Resources/contao/drivers/DC_Table.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "2129:     if (\\is_array($GLOBALS['TL_DCA'][$this->strTable]['config']['onversion_callback']))",
          "2130:     {",
          "2133:      foreach ($GLOBALS['TL_DCA'][$this->strTable]['config']['onversion_callback'] as $callback)",
          "2134:      {",
          "",
          "[Removed Lines]",
          "2131:      @trigger_error('Using the onversion_callback has been deprecated and will no longer work in Contao 5.0. Use the oncreate_version_callback instead.', E_USER_DEPRECATED);",
          "",
          "[Added Lines]",
          "2131:      @trigger_error('Using the \"onversion_callback\" has been deprecated and will no longer work in Contao 5.0. Use the \"oncreate_version_callback\" instead.', E_USER_DEPRECATED);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2520:       if (\\is_array($GLOBALS['TL_DCA'][$this->strTable]['config']['onversion_callback']))",
          "2521:       {",
          "2524:        foreach ($GLOBALS['TL_DCA'][$this->strTable]['config']['onversion_callback'] as $callback)",
          "2525:        {",
          "",
          "[Removed Lines]",
          "2522:        @trigger_error('Using the onversion_callback has been deprecated and will no longer work in Contao 5.0. Use the oncreate_version_callback instead.', E_USER_DEPRECATED);",
          "",
          "[Added Lines]",
          "2522:        @trigger_error('Using the \"onversion_callback\" has been deprecated and will no longer work in Contao 5.0. Use the \"oncreate_version_callback\" instead.', E_USER_DEPRECATED);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "2813:        if (\\is_array($GLOBALS['TL_DCA'][$this->strTable]['config']['onversion_callback']))",
          "2814:        {",
          "2817:         foreach ($GLOBALS['TL_DCA'][$this->strTable]['config']['onversion_callback'] as $callback)",
          "2818:         {",
          "",
          "[Removed Lines]",
          "2815:         @trigger_error('Using the onversion_callback has been deprecated and will no longer work in Contao 5.0. Use the oncreate_version_callback instead.', E_USER_DEPRECATED);",
          "",
          "[Added Lines]",
          "2815:         @trigger_error('Using the \"onversion_callback\" has been deprecated and will no longer work in Contao 5.0. Use the \"oncreate_version_callback\" instead.', E_USER_DEPRECATED);",
          "",
          "---------------"
        ],
        "core-bundle/src/Resources/contao/library/Contao/Database/Installer.php||core-bundle/src/Resources/contao/library/Contao/Database/Installer.php": [
          "File: core-bundle/src/Resources/contao/library/Contao/Database/Installer.php -> core-bundle/src/Resources/contao/library/Contao/Database/Installer.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "45:  public function generateSqlForm()",
          "46:  {",
          "49:   $count = 0;",
          "50:   $return = '';",
          "",
          "[Removed Lines]",
          "47:   @trigger_error('Using the Installer::generateSqlForm() method has been deprecated and will no longer work in Contao 5.0.', E_USER_DEPRECATED);",
          "",
          "[Added Lines]",
          "47:   @trigger_error('Using the \"Installer::generateSqlForm()\" method has been deprecated and will no longer work in Contao 5.0.', E_USER_DEPRECATED);",
          "",
          "---------------"
        ],
        "core-bundle/src/Resources/contao/library/Contao/Database/Updater.php||core-bundle/src/Resources/contao/library/Contao/Database/Updater.php": [
          "File: core-bundle/src/Resources/contao/library/Contao/Database/Updater.php -> core-bundle/src/Resources/contao/library/Contao/Database/Updater.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "21: use Contao\\System;",
          "22: use Symfony\\Component\\Finder\\SplFileInfo;",
          "",
          "[Removed Lines]",
          "24: @trigger_error('Using the Contao\\Database\\Updater class has been deprecated and will no longer work in Contao 5.0.', E_USER_DEPRECATED);",
          "",
          "[Added Lines]",
          "24: @trigger_error('Using the \"Contao\\Database\\Updater\" class has been deprecated and will no longer work in Contao 5.0.', E_USER_DEPRECATED);",
          "",
          "---------------"
        ],
        "core-bundle/src/Resources/contao/library/Contao/DcaLoader.php||core-bundle/src/Resources/contao/library/Contao/DcaLoader.php": [
          "File: core-bundle/src/Resources/contao/library/Contao/DcaLoader.php -> core-bundle/src/Resources/contao/library/Contao/DcaLoader.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "113:   if (file_exists($rootDir . '/system/config/dcaconfig.php'))",
          "114:   {",
          "116:    include $rootDir . '/system/config/dcaconfig.php';",
          "117:   }",
          "118:  }",
          "",
          "[Removed Lines]",
          "115:    @trigger_error('Using the dcaconfig.php file has been deprecated and will no longer work in Contao 5.0. Create one or more DCA files in contao/dca instead.', E_USER_DEPRECATED);",
          "",
          "[Added Lines]",
          "115:    @trigger_error('Using the \"dcaconfig.php\" file has been deprecated and will no longer work in Contao 5.0. Create custom DCA files in the \"contao/dca\" folder instead.', E_USER_DEPRECATED);",
          "",
          "---------------"
        ],
        "core-bundle/src/Resources/contao/library/Contao/Encryption.php||core-bundle/src/Resources/contao/library/Contao/Encryption.php": [
          "File: core-bundle/src/Resources/contao/library/Contao/Encryption.php -> core-bundle/src/Resources/contao/library/Contao/Encryption.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "11: namespace Contao;",
          "",
          "[Removed Lines]",
          "13: @trigger_error('Using the Contao\\Encryption class has been deprecated and will no longer work in Contao 5.0. Use the PHP password_* functions and a third-party library such as OpenSSL or phpseclib instead.', E_USER_DEPRECATED);",
          "",
          "[Added Lines]",
          "13: @trigger_error('Using the \"Contao\\Encryption\" class has been deprecated and will no longer work in Contao 5.0. Use the PHP password_* functions and a third-party library such as OpenSSL or phpseclib instead.', E_USER_DEPRECATED);",
          "",
          "---------------"
        ],
        "core-bundle/src/Resources/contao/library/Contao/GdImage.php||core-bundle/src/Resources/contao/library/Contao/GdImage.php": [
          "File: core-bundle/src/Resources/contao/library/Contao/GdImage.php -> core-bundle/src/Resources/contao/library/Contao/GdImage.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "11: namespace Contao;",
          "",
          "[Removed Lines]",
          "13: @trigger_error('Using the Contao\\GdImage class has been deprecated and will no longer work in Contao 5.0. Use the Imagine library instead.', E_USER_DEPRECATED);",
          "",
          "[Added Lines]",
          "13: @trigger_error('Using the \"Contao\\GdImage\" class has been deprecated and will no longer work in Contao 5.0. Use the Imagine library instead.', E_USER_DEPRECATED);",
          "",
          "---------------"
        ],
        "core-bundle/src/Resources/contao/library/Contao/Picture.php||core-bundle/src/Resources/contao/library/Contao/Picture.php": [
          "File: core-bundle/src/Resources/contao/library/Contao/Picture.php -> core-bundle/src/Resources/contao/library/Contao/Picture.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "17: use Contao\\Image\\ResizeOptions;",
          "18: use Contao\\Model\\Collection;",
          "",
          "[Removed Lines]",
          "20: @trigger_error('Using the Contao\\Picture class has been deprecated and will no longer work in Contao 5.0. Use the contao.image.picture_factory service instead.', E_USER_DEPRECATED);",
          "",
          "[Added Lines]",
          "20: @trigger_error('Using the \"Contao\\Picture\" class has been deprecated and will no longer work in Contao 5.0. Use the \"contao.image.picture_factory\" service instead.', E_USER_DEPRECATED);",
          "",
          "---------------"
        ],
        "core-bundle/src/Resources/contao/library/Contao/RequestToken.php||core-bundle/src/Resources/contao/library/Contao/RequestToken.php": [
          "File: core-bundle/src/Resources/contao/library/Contao/RequestToken.php -> core-bundle/src/Resources/contao/library/Contao/RequestToken.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "13: use Symfony\\Component\\Security\\Csrf\\CsrfToken;",
          "",
          "[Removed Lines]",
          "15: @trigger_error('Using the Contao\\RequestToken class has been deprecated and will no longer work in Contao 5.0. Use the Symfony CSRF service via the container instead.', E_USER_DEPRECATED);",
          "",
          "[Added Lines]",
          "15: @trigger_error('Using the \"Contao\\RequestToken\" class has been deprecated and will no longer work in Contao 5.0. Use the Symfony CSRF service via the container instead.', E_USER_DEPRECATED);",
          "",
          "---------------"
        ],
        "core-bundle/src/Resources/contao/library/Contao/Session.php||core-bundle/src/Resources/contao/library/Contao/Session.php": [
          "File: core-bundle/src/Resources/contao/library/Contao/Session.php -> core-bundle/src/Resources/contao/library/Contao/Session.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "14: use Symfony\\Component\\HttpFoundation\\Session\\Session as SymfonySession;",
          "15: use Symfony\\Component\\HttpFoundation\\Session\\Storage\\MockArraySessionStorage;",
          "",
          "[Removed Lines]",
          "17: @trigger_error('Using the Contao\\Session class has been deprecated and will no longer work in Contao 5.0. Use the session service instead.', E_USER_DEPRECATED);",
          "",
          "[Added Lines]",
          "17: @trigger_error('Using the \"Contao\\Session\" class has been deprecated and will no longer work in Contao 5.0. Use the session service instead.', E_USER_DEPRECATED);",
          "",
          "---------------"
        ],
        "core-bundle/src/Resources/contao/library/Contao/System.php||core-bundle/src/Resources/contao/library/Contao/System.php": [
          "File: core-bundle/src/Resources/contao/library/Contao/System.php -> core-bundle/src/Resources/contao/library/Contao/System.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "456:   if (file_exists($rootDir . '/system/config/langconfig.php'))",
          "457:   {",
          "459:    include $rootDir . '/system/config/langconfig.php';",
          "460:   }",
          "461:  }",
          "",
          "[Removed Lines]",
          "458:    @trigger_error('Using the langconfig.php file has been deprecated and will no longer work in Contao 5.0. Create one or more language files in contao/languages instead.', E_USER_DEPRECATED);",
          "",
          "[Added Lines]",
          "458:    @trigger_error('Using the \"langconfig.php\" file has been deprecated and will no longer work in Contao 5.0. Create custom language files in the \"contao/languages\" folder instead.', E_USER_DEPRECATED);",
          "",
          "---------------"
        ],
        "core-bundle/src/Resources/contao/library/Contao/User.php||core-bundle/src/Resources/contao/library/Contao/User.php": [
          "File: core-bundle/src/Resources/contao/library/Contao/User.php -> core-bundle/src/Resources/contao/library/Contao/User.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "656:    return false;",
          "657:   }",
          "661:   foreach ($GLOBALS['TL_HOOKS']['importUser'] as $callback)",
          "662:   {",
          "",
          "[Removed Lines]",
          "659:   @trigger_error('Using the \"importUser\" hook has been deprecated and will no longer work in Contao 5.0. Use the contao.import_user event instead.', E_USER_DEPRECATED);",
          "",
          "[Added Lines]",
          "659:   @trigger_error('Using the \"importUser\" hook has been deprecated and will no longer work in Contao 5.0. Use the \"contao.import_user\" event instead.', E_USER_DEPRECATED);",
          "",
          "---------------"
        ],
        "core-bundle/src/Resources/contao/models/OptInModel.php||core-bundle/src/Resources/contao/models/OptInModel.php": [
          "File: core-bundle/src/Resources/contao/models/OptInModel.php -> core-bundle/src/Resources/contao/models/OptInModel.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "105:  public static function findOneByRelatedTableAndId($strTable, $intId, array $arrOptions=array())",
          "106:  {",
          "109:   $t = static::$strTable;",
          "110:   $objDatabase = Database::getInstance();",
          "",
          "[Removed Lines]",
          "107:   @trigger_error('Using the Contao\\OptInModel::findOneByRelatedTableAndIds() method has been deprecated and will no longer work in Contao 5.0. Use the Contao\\OptInModel::findByRelatedTableAndIds() method instead.', E_USER_DEPRECATED);",
          "",
          "[Added Lines]",
          "107:   @trigger_error('Using the \"Contao\\OptInModel::findOneByRelatedTableAndIds()\" method has been deprecated and will no longer work in Contao 5.0. Use the \"Contao\\OptInModel::findByRelatedTableAndIds()\" method instead.', E_USER_DEPRECATED);",
          "",
          "---------------"
        ],
        "core-bundle/src/Security/Authentication/Provider/AuthenticationProvider.php||core-bundle/src/Security/Authentication/Provider/AuthenticationProvider.php": [
          "File: core-bundle/src/Security/Authentication/Provider/AuthenticationProvider.php -> core-bundle/src/Security/Authentication/Provider/AuthenticationProvider.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "116:             return false;",
          "117:         }",
          "122:         $system = $this->framework->getAdapter(System::class);",
          "",
          "[Removed Lines]",
          "119:         @trigger_error('Using the checkCredentials hook has been deprecated and will no longer work in Contao 5.0.', E_USER_DEPRECATED);",
          "",
          "[Added Lines]",
          "119:         @trigger_error('Using the \"checkCredentials\" hook has been deprecated and will no longer work in Contao 5.0.', E_USER_DEPRECATED);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "d7e55c9b0c3e17507761976072246392c7a91337",
      "candidate_info": {
        "commit_hash": "d7e55c9b0c3e17507761976072246392c7a91337",
        "repo": "contao/contao",
        "commit_url": "https://github.com/contao/contao/commit/d7e55c9b0c3e17507761976072246392c7a91337",
        "files": [
          "calendar-bundle/composer.json",
          "composer.json",
          "core-bundle/composer.json",
          "core-bundle/src/Resources/contao/controllers/BackendPassword.php",
          "core-bundle/tests/OptIn/OptInTest.php",
          "core-bundle/tests/OptIn/OptInTokenTest.php",
          "faq-bundle/composer.json",
          "manager-bundle/composer.json",
          "news-bundle/composer.json"
        ],
        "message": "Fix the coding style",
        "before_after_code_files": [
          "core-bundle/src/Resources/contao/controllers/BackendPassword.php||core-bundle/src/Resources/contao/controllers/BackendPassword.php",
          "core-bundle/tests/OptIn/OptInTest.php||core-bundle/tests/OptIn/OptInTest.php",
          "core-bundle/tests/OptIn/OptInTokenTest.php||core-bundle/tests/OptIn/OptInTokenTest.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "core-bundle/tests/OptIn/OptInTest.php||core-bundle/tests/OptIn/OptInTest.php",
            "core-bundle/tests/OptIn/OptInTokenTest.php||core-bundle/tests/OptIn/OptInTokenTest.php"
          ],
          "candidate": [
            "core-bundle/tests/OptIn/OptInTest.php||core-bundle/tests/OptIn/OptInTest.php",
            "core-bundle/tests/OptIn/OptInTokenTest.php||core-bundle/tests/OptIn/OptInTokenTest.php"
          ]
        }
      },
      "candidate_diff": {
        "core-bundle/src/Resources/contao/controllers/BackendPassword.php||core-bundle/src/Resources/contao/controllers/BackendPassword.php": [
          "File: core-bundle/src/Resources/contao/controllers/BackendPassword.php -> core-bundle/src/Resources/contao/controllers/BackendPassword.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "94:      if (\\is_array($GLOBALS['TL_DCA']['tl_user']['fields']['password']['save_callback']))",
          "95:      {",
          "97:       $dc->id = $this->User->id;",
          "99:       foreach ($GLOBALS['TL_DCA']['tl_user']['fields']['password']['save_callback'] as $callback)",
          "",
          "[Removed Lines]",
          "96:       $dc = new \\DC_Table('tl_user');",
          "",
          "[Added Lines]",
          "96:       $dc = new DC_Table('tl_user');",
          "",
          "---------------"
        ],
        "core-bundle/tests/OptIn/OptInTest.php||core-bundle/tests/OptIn/OptInTest.php": [
          "File: core-bundle/tests/OptIn/OptInTest.php -> core-bundle/tests/OptIn/OptInTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "23: {",
          "24:     public function testCreatesAToken(): void",
          "25:     {",
          "27:         $model",
          "28:             ->expects($this->once())",
          "29:             ->method('save')",
          "",
          "[Removed Lines]",
          "26:         $model = $this->mockClassWithGetterSetter(OptInModel::class);",
          "",
          "[Added Lines]",
          "26:         $model = $this->mockClassWithProperties(OptInModel::class);",
          "",
          "---------------"
        ],
        "core-bundle/tests/OptIn/OptInTokenTest.php||core-bundle/tests/OptIn/OptInTokenTest.php": [
          "File: core-bundle/tests/OptIn/OptInTokenTest.php -> core-bundle/tests/OptIn/OptInTokenTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "27:     public function testReturnsTheIdentifier(): void",
          "28:     {",
          "31:         $token = $this->getToken($model);",
          "33:         $this->assertSame('foobar', $token->getIdentifier());",
          "",
          "[Removed Lines]",
          "30:         $model = $this->mockClassWithGetterSetter(OptInModel::class, ['token' => 'foobar']);",
          "",
          "[Added Lines]",
          "30:         $model = $this->mockClassWithProperties(OptInModel::class, ['token' => 'foobar']);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "36:     public function testReturnsTheEmailAddress(): void",
          "37:     {",
          "40:         $token = $this->getToken($model);",
          "42:         $this->assertSame('foo@bar.com', $token->getEmail());",
          "",
          "[Removed Lines]",
          "39:         $model = $this->mockClassWithGetterSetter(OptInModel::class, ['email' => 'foo@bar.com']);",
          "",
          "[Added Lines]",
          "39:         $model = $this->mockClassWithProperties(OptInModel::class, ['email' => 'foo@bar.com']);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "45:     public function testInvalidatesAToken(): void",
          "46:     {",
          "49:         $token = $this->getToken($model);",
          "51:         $this->assertFalse($token->isValid());",
          "",
          "[Removed Lines]",
          "48:         $model = $this->mockClassWithGetterSetter(OptInModel::class, ['invalidatedThrough' => 'foo']);",
          "",
          "[Added Lines]",
          "48:         $model = $this->mockClassWithProperties(OptInModel::class, ['invalidatedThrough' => 'foo']);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "59:         ];",
          "63:         $model",
          "64:             ->expects($this->once())",
          "65:             ->method('getRelatedRecords')",
          "",
          "[Removed Lines]",
          "62:         $model = $this->mockClassWithGetterSetter(OptInModel::class, $properties);",
          "",
          "[Added Lines]",
          "62:         $model = $this->mockClassWithProperties(OptInModel::class, $properties);",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "81:         ];",
          "85:         $related",
          "86:             ->expects($this->once())",
          "87:             ->method('save')",
          "",
          "[Removed Lines]",
          "84:         $related = $this->mockClassWithGetterSetter(OptInModel::class, $properties);",
          "",
          "[Added Lines]",
          "84:         $related = $this->mockClassWithProperties(OptInModel::class, $properties);",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "110:         ];",
          "114:         $model",
          "115:             ->expects($this->once())",
          "116:             ->method('getRelatedRecords')",
          "",
          "[Removed Lines]",
          "113:         $model = $this->mockClassWithGetterSetter(OptInModel::class, $properties);",
          "",
          "[Added Lines]",
          "113:         $model = $this->mockClassWithProperties(OptInModel::class, $properties);",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "133:         ];",
          "137:         $related",
          "138:             ->expects($this->never())",
          "139:             ->method('save')",
          "",
          "[Removed Lines]",
          "136:         $related = $this->mockClassWithGetterSetter(OptInModel::class, $properties);",
          "",
          "[Added Lines]",
          "136:         $related = $this->mockClassWithProperties(OptInModel::class, $properties);",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "162:         ];",
          "166:         $model",
          "167:             ->expects($this->once())",
          "168:             ->method('getRelatedRecords')",
          "",
          "[Removed Lines]",
          "165:         $model = $this->mockClassWithGetterSetter(OptInModel::class, $properties);",
          "",
          "[Added Lines]",
          "165:         $model = $this->mockClassWithProperties(OptInModel::class, $properties);",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "183:         ];",
          "187:         $token = $this->getToken($model);",
          "189:         $this->expectException(OptInTokenAlreadyConfirmedException::class);",
          "",
          "[Removed Lines]",
          "186:         $model = $this->mockClassWithGetterSetter(OptInModel::class, $properties);",
          "",
          "[Added Lines]",
          "186:         $model = $this->mockClassWithProperties(OptInModel::class, $properties);",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "200:         ];",
          "204:         $token = $this->getToken($model);",
          "206:         $this->expectException(OptInTokenNoLongerValidException::class);",
          "",
          "[Removed Lines]",
          "203:         $model = $this->mockClassWithGetterSetter(OptInModel::class, $properties);",
          "",
          "[Added Lines]",
          "203:         $model = $this->mockClassWithProperties(OptInModel::class, $properties);",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "219:         ];",
          "223:         $model",
          "224:             ->expects($this->once())",
          "225:             ->method('save')",
          "",
          "[Removed Lines]",
          "222:         $model = $this->mockClassWithGetterSetter(OptInModel::class, $properties);",
          "",
          "[Added Lines]",
          "222:         $model = $this->mockClassWithProperties(OptInModel::class, $properties);",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "252:         ];",
          "256:         $token = $this->getToken($model);",
          "258:         $this->expectException(OptInTokenAlreadyConfirmedException::class);",
          "",
          "[Removed Lines]",
          "255:         $model = $this->mockClassWithGetterSetter(OptInModel::class, $properties);",
          "",
          "[Added Lines]",
          "255:         $model = $this->mockClassWithProperties(OptInModel::class, $properties);",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "269:         ];",
          "273:         $token = $this->getToken($model);",
          "275:         $this->expectException(OptInTokenNoLongerValidException::class);",
          "",
          "[Removed Lines]",
          "272:         $model = $this->mockClassWithGetterSetter(OptInModel::class, $properties);",
          "",
          "[Added Lines]",
          "272:         $model = $this->mockClassWithProperties(OptInModel::class, $properties);",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "288:         ];",
          "292:         $model",
          "293:             ->expects($this->never())",
          "294:             ->method('save')",
          "",
          "[Removed Lines]",
          "291:         $model = $this->mockClassWithGetterSetter(OptInModel::class, $properties);",
          "",
          "[Added Lines]",
          "291:         $model = $this->mockClassWithProperties(OptInModel::class, $properties);",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "312:         ];",
          "316:         $model",
          "317:             ->expects($this->never())",
          "318:             ->method('save')",
          "",
          "[Removed Lines]",
          "315:         $model = $this->mockClassWithGetterSetter(OptInModel::class, $properties);",
          "",
          "[Added Lines]",
          "315:         $model = $this->mockClassWithProperties(OptInModel::class, $properties);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "199743eb4f7c2fd095f52d52b0da018bd2558ac1",
      "candidate_info": {
        "commit_hash": "199743eb4f7c2fd095f52d52b0da018bd2558ac1",
        "repo": "contao/contao",
        "commit_url": "https://github.com/contao/contao/commit/199743eb4f7c2fd095f52d52b0da018bd2558ac1",
        "files": [
          "core-bundle/src/Monolog/ContaoContext.php",
          "core-bundle/src/Resources/contao/themes/flexible/icons/loading.svg",
          "core-bundle/src/Resources/contao/themes/flexible/icons/theme_export.svg",
          "core-bundle/src/Resources/contao/themes/flexible/icons/theme_import.svg",
          "core-bundle/src/Resources/contao/themes/flexible/icons/themes.svg",
          "core-bundle/tests/Cors/WebsiteRootsConfigProviderTest.php",
          "core-bundle/tests/EventListener/SessionListenerTest.php",
          "installation-bundle/src/Controller/InstallationController.php",
          "installation-bundle/src/Database/AbstractVersionUpdate.php",
          "newsletter-bundle/src/Resources/contao/modules/ModuleSubscribe.php"
        ],
        "message": "Run the code inspector and CS fixer",
        "before_after_code_files": [
          "core-bundle/src/Monolog/ContaoContext.php||core-bundle/src/Monolog/ContaoContext.php",
          "core-bundle/tests/Cors/WebsiteRootsConfigProviderTest.php||core-bundle/tests/Cors/WebsiteRootsConfigProviderTest.php",
          "core-bundle/tests/EventListener/SessionListenerTest.php||core-bundle/tests/EventListener/SessionListenerTest.php",
          "installation-bundle/src/Controller/InstallationController.php||installation-bundle/src/Controller/InstallationController.php",
          "installation-bundle/src/Database/AbstractVersionUpdate.php||installation-bundle/src/Database/AbstractVersionUpdate.php",
          "newsletter-bundle/src/Resources/contao/modules/ModuleSubscribe.php||newsletter-bundle/src/Resources/contao/modules/ModuleSubscribe.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "newsletter-bundle/src/Resources/contao/modules/ModuleSubscribe.php||newsletter-bundle/src/Resources/contao/modules/ModuleSubscribe.php"
          ],
          "candidate": [
            "newsletter-bundle/src/Resources/contao/modules/ModuleSubscribe.php||newsletter-bundle/src/Resources/contao/modules/ModuleSubscribe.php"
          ]
        }
      },
      "candidate_diff": {
        "core-bundle/src/Monolog/ContaoContext.php||core-bundle/src/Monolog/ContaoContext.php": [
          "File: core-bundle/src/Monolog/ContaoContext.php -> core-bundle/src/Monolog/ContaoContext.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "90:     public function __toString()",
          "91:     {",
          "93:             'func' => $this->func,",
          "94:             'action' => $this->action,",
          "95:             'username' => $this->username,",
          "",
          "[Removed Lines]",
          "92:         return json_encode([",
          "",
          "[Added Lines]",
          "92:         return (string) json_encode([",
          "",
          "---------------"
        ],
        "core-bundle/tests/Cors/WebsiteRootsConfigProviderTest.php||core-bundle/tests/Cors/WebsiteRootsConfigProviderTest.php": [
          "File: core-bundle/tests/Cors/WebsiteRootsConfigProviderTest.php -> core-bundle/tests/Cors/WebsiteRootsConfigProviderTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "13: use Contao\\CoreBundle\\Cors\\WebsiteRootsConfigProvider;",
          "14: use Doctrine\\DBAL\\Connection;",
          "16: use Doctrine\\DBAL\\Driver\\Statement;",
          "18: use Doctrine\\DBAL\\Schema\\MySqlSchemaManager;",
          "19: use PHPUnit\\Framework\\TestCase;",
          "20: use Symfony\\Component\\HttpFoundation\\Request;",
          "",
          "[Removed Lines]",
          "15: use Doctrine\\DBAL\\Driver\\Mysqli\\MysqliException;",
          "17: use Doctrine\\DBAL\\Exception\\DriverException;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "core-bundle/tests/EventListener/SessionListenerTest.php||core-bundle/tests/EventListener/SessionListenerTest.php": [
          "File: core-bundle/tests/EventListener/SessionListenerTest.php -> core-bundle/tests/EventListener/SessionListenerTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "13: use Contao\\CoreBundle\\EventListener\\SessionListener;",
          "14: use Contao\\CoreBundle\\Framework\\ContaoFrameworkInterface;",
          "17: use Contao\\CoreBundle\\Routing\\ScopeMatcher;",
          "18: use Contao\\CoreBundle\\Tests\\TestCase;",
          "19: use Symfony\\Component\\HttpFoundation\\Request;",
          "",
          "[Removed Lines]",
          "15: use Contao\\CoreBundle\\HttpKernel\\Header\\HeaderStorageInterface;",
          "16: use Contao\\CoreBundle\\HttpKernel\\Header\\MemoryHeaderStorage;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "48:     private $scopeMatcher;",
          "",
          "[Removed Lines]",
          "53:     private $headerStorage;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "64:         $this->inner = $this->createMock(BaseSessionListener::class);",
          "65:         $this->framework = $this->createMock(ContaoFrameworkInterface::class);",
          "66:         $this->scopeMatcher = $this->createMock(ScopeMatcher::class);",
          "75:     }",
          "",
          "[Removed Lines]",
          "67:         $this->headerStorage = new MemoryHeaderStorage();",
          "69:         $this->listener = new SessionListener(",
          "70:             $this->inner,",
          "71:             $this->framework,",
          "72:             $this->scopeMatcher,",
          "73:             $this->headerStorage",
          "74:         );",
          "",
          "[Added Lines]",
          "60:         $this->listener = new SessionListener($this->inner, $this->framework, $this->scopeMatcher);",
          "",
          "---------------"
        ],
        "installation-bundle/src/Controller/InstallationController.php||installation-bundle/src/Controller/InstallationController.php": [
          "File: installation-bundle/src/Controller/InstallationController.php -> installation-bundle/src/Controller/InstallationController.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "384:             }",
          "385:         }",
          "388:     }",
          "",
          "[Removed Lines]",
          "387:         $this->context['sql_message'] = implode($messages);",
          "",
          "[Added Lines]",
          "387:         $this->context['sql_message'] = implode('', $messages);",
          "",
          "---------------"
        ],
        "installation-bundle/src/Database/AbstractVersionUpdate.php||installation-bundle/src/Database/AbstractVersionUpdate.php": [
          "File: installation-bundle/src/Database/AbstractVersionUpdate.php -> installation-bundle/src/Database/AbstractVersionUpdate.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "61:     public function getMessage()",
          "62:     {",
          "64:     }",
          "",
          "[Removed Lines]",
          "63:         return implode($this->messages);",
          "",
          "[Added Lines]",
          "63:         return implode('', $this->messages);",
          "",
          "---------------"
        ],
        "newsletter-bundle/src/Resources/contao/modules/ModuleSubscribe.php||newsletter-bundle/src/Resources/contao/modules/ModuleSubscribe.php": [
          "File: newsletter-bundle/src/Resources/contao/modules/ModuleSubscribe.php -> newsletter-bundle/src/Resources/contao/modules/ModuleSubscribe.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "184:   $time = time();",
          "185:   $arrAdd = array();",
          "187:   $arrCids = array();",
          "",
          "[Removed Lines]",
          "186:   $arrChannels = array();",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "193:    $objChannel = $objRecipient->getRelated('pid');",
          "195:    $arrAdd[] = $objRecipient->id;",
          "197:    $arrCids[] = $objChannel->id;",
          "199:    $objRecipient->active = 1;",
          "",
          "[Removed Lines]",
          "196:    $arrChannels[] = $objChannel->title;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    }
  ]
}