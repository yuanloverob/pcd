{
  "cve_id": "CVE-2019-3808",
  "cve_desc": "A flaw was found in Moodle versions 3.6 to 3.6.1, 3.5 to 3.5.3, 3.4 to 3.4.6, 3.1 to 3.1.15 and earlier unsupported versions. The 'manage groups' capability did not have the 'XSS risk' flag assigned to it, but does have that access in certain places. Note that the capability is intended for use by trusted users, and is only assigned to teachers and managers by default.",
  "repo": "moodle/moodle",
  "patch_hash": "6360f87cdca744a6a71c315853f6d811a3e54e26",
  "patch_info": {
    "commit_hash": "6360f87cdca744a6a71c315853f6d811a3e54e26",
    "repo": "moodle/moodle",
    "commit_url": "https://github.com/moodle/moodle/commit/6360f87cdca744a6a71c315853f6d811a3e54e26",
    "files": [
      "lib/db/access.php",
      "version.php"
    ],
    "message": "MDL-64395 groups: Added XSS Risk to the manage groups capability",
    "before_after_code_files": [
      "lib/db/access.php||lib/db/access.php",
      "version.php||version.php"
    ]
  },
  "patch_diff": {
    "lib/db/access.php||lib/db/access.php": [
      "File: lib/db/access.php -> lib/db/access.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "1123:     ),",
      "1125:     'moodle/course:managegroups' => array(",
      "1127:         'captype' => 'write',",
      "1128:         'contextlevel' => CONTEXT_COURSE,",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1126:         'riskbitmask' => RISK_XSS,",
      "",
      "---------------"
    ],
    "version.php||version.php": [
      "File: version.php -> version.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "30: defined('MOODLE_INTERNAL') || die();",
      "",
      "[Removed Lines]",
      "32: $version  = 2018122000.01;              // YYYYMMDD      = weekly release date of this DEV branch.",
      "",
      "[Added Lines]",
      "32: $version  = 2018122000.02;              // YYYYMMDD      = weekly release date of this DEV branch.",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "1d6f041a2e012b0d129ddd4ee9b601b8133395b5",
      "candidate_info": {
        "commit_hash": "1d6f041a2e012b0d129ddd4ee9b601b8133395b5",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/1d6f041a2e012b0d129ddd4ee9b601b8133395b5",
        "files": [
          "admin/tool/behat/tests/behat/edit_permissions.feature",
          "backup/util/ui/tests/behat/restore_moodle2_courses.feature",
          "blocks/community/block_community.php",
          "blocks/community/classes/privacy/provider.php",
          "blocks/community/communitycourse.php",
          "blocks/community/db/access.php",
          "blocks/community/db/install.xml",
          "blocks/community/db/upgrade.php",
          "blocks/community/forms.php",
          "blocks/community/lang/en/block_community.php",
          "blocks/community/locallib.php",
          "blocks/community/renderer.php",
          "blocks/community/styles.css",
          "blocks/community/tests/privacy_test.php",
          "blocks/community/version.php",
          "blocks/community/yui/comments/comments.js",
          "blocks/community/yui/imagegallery/imagegallery.js",
          "blocks/upgrade.txt",
          "lang/en/error.php",
          "lib/classes/plugin_manager.php",
          "lib/db/access.php",
          "lib/db/upgrade.php",
          "lib/upgrade.txt",
          "version.php"
        ],
        "message": "MDL-66120 block_community: Remove community block and related caps\n\nWith the sunsetting of moodle.net, the community block will no longer\nbe functional, so removing the block and related caps",
        "before_after_code_files": [
          "admin/tool/behat/tests/behat/edit_permissions.feature||admin/tool/behat/tests/behat/edit_permissions.feature",
          "backup/util/ui/tests/behat/restore_moodle2_courses.feature||backup/util/ui/tests/behat/restore_moodle2_courses.feature",
          "blocks/community/block_community.php||blocks/community/block_community.php",
          "blocks/community/classes/privacy/provider.php||blocks/community/classes/privacy/provider.php",
          "blocks/community/communitycourse.php||blocks/community/communitycourse.php",
          "blocks/community/db/access.php||blocks/community/db/access.php",
          "blocks/community/db/upgrade.php||blocks/community/db/upgrade.php",
          "blocks/community/forms.php||blocks/community/forms.php",
          "blocks/community/lang/en/block_community.php||blocks/community/lang/en/block_community.php",
          "blocks/community/locallib.php||blocks/community/locallib.php",
          "blocks/community/renderer.php||blocks/community/renderer.php",
          "blocks/community/styles.css||blocks/community/styles.css",
          "blocks/community/tests/privacy_test.php||blocks/community/tests/privacy_test.php",
          "blocks/community/version.php||blocks/community/version.php",
          "blocks/community/yui/comments/comments.js||blocks/community/yui/comments/comments.js",
          "blocks/community/yui/imagegallery/imagegallery.js||blocks/community/yui/imagegallery/imagegallery.js",
          "lang/en/error.php||lang/en/error.php",
          "lib/classes/plugin_manager.php||lib/classes/plugin_manager.php",
          "lib/db/access.php||lib/db/access.php",
          "lib/db/upgrade.php||lib/db/upgrade.php",
          "version.php||version.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "lib/db/access.php||lib/db/access.php",
            "version.php||version.php"
          ],
          "candidate": [
            "lib/db/access.php||lib/db/access.php",
            "version.php||version.php"
          ]
        }
      },
      "candidate_diff": {
        "admin/tool/behat/tests/behat/edit_permissions.feature||admin/tool/behat/tests/behat/edit_permissions.feature": [
          "File: admin/tool/behat/tests/behat/edit_permissions.feature -> admin/tool/behat/tests/behat/edit_permissions.feature",
          "--- Hunk 1 ---",
          "[Context before]",
          "20:     And I set the following system permissions of \"Teacher\" role:",
          "21:       | capability | permission |",
          "22:       | block/mnet_hosts:myaddinstance | Allow |",
          "24:       | moodle/grade:managesharedforms | Prevent |",
          "25:       | moodle/course:request | Prohibit |",
          "26:     When I follow \"Edit Teacher role\"",
          "27:     Then \"block/mnet_hosts:myaddinstance\" capability has \"Allow\" permission",
          "29:     And \"moodle/grade:managesharedforms\" capability has \"Prevent\" permission",
          "30:     And \"moodle/course:request\" capability has \"Prohibit\" permission",
          "",
          "[Removed Lines]",
          "23:       | moodle/community:add | Inherit |",
          "28:     And \"moodle/community:add\" capability has \"Not set\" permission",
          "",
          "[Added Lines]",
          "23:       | moodle/site:messageanyuser | Inherit |",
          "28:     And \"moodle/site:messageanyuser\" capability has \"Not set\" permission",
          "",
          "---------------"
        ],
        "backup/util/ui/tests/behat/restore_moodle2_courses.feature||backup/util/ui/tests/behat/restore_moodle2_courses.feature": [
          "File: backup/util/ui/tests/behat/restore_moodle2_courses.feature -> backup/util/ui/tests/behat/restore_moodle2_courses.feature",
          "--- Hunk 1 ---",
          "[Context before]",
          "20:     And I add a \"Forum\" to section \"1\" and I fill the form with:",
          "21:       | Forum name | Test forum name |",
          "22:       | Description | Test forum description |",
          "25:   @javascript",
          "26:   Scenario: Restore a course in another existing course",
          "",
          "[Removed Lines]",
          "23:     And I add the \"Community finder\" block",
          "",
          "[Added Lines]",
          "23:     And I add the \"Activities\" block",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "28:       | Confirmation | Filename | test_backup.mbz |",
          "29:     And I restore \"test_backup.mbz\" backup into \"Course 2\" course using this options:",
          "30:     Then I should see \"Course 2\"",
          "32:     And I should see \"Test forum name\"",
          "34:   @javascript",
          "",
          "[Removed Lines]",
          "31:     And I should see \"Community finder\" in the \"Community finder\" \"block\"",
          "",
          "[Added Lines]",
          "31:     And I should see \"Activities\" in the \"Activities\" \"block\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "38:     And I restore \"test_backup.mbz\" backup into a new course using this options:",
          "39:       | Schema | Course name | Course 1 restored in a new course |",
          "40:     Then I should see \"Course 1 restored in a new course\"",
          "42:     And I should see \"Test forum name\"",
          "43:     And I should see \"Topic 15\"",
          "44:     And I should not see \"Topic 16\"",
          "",
          "[Removed Lines]",
          "41:     And I should see \"Community finder\" in the \"Community finder\" \"block\"",
          "",
          "[Added Lines]",
          "41:     And I should see \"Activities\" in the \"Activities\" \"block\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "72:     Then I should see \"Course 1\"",
          "73:     And I should not see \"Section 3\"",
          "74:     And I should not see \"Test forum post backup name\"",
          "76:     And I should see \"Test forum name\"",
          "78:   @javascript",
          "",
          "[Removed Lines]",
          "75:     And I should see \"Community finder\" in the \"Community finder\" \"block\"",
          "",
          "[Added Lines]",
          "75:     And I should see \"Activities\" in the \"Activities\" \"block\"",
          "",
          "---------------"
        ],
        "blocks/community/block_community.php||blocks/community/block_community.php": [
          "File: blocks/community/block_community.php -> blocks/community/block_community.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "blocks/community/classes/privacy/provider.php||blocks/community/classes/privacy/provider.php": [
          "File: blocks/community/classes/privacy/provider.php -> blocks/community/classes/privacy/provider.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "blocks/community/communitycourse.php||blocks/community/communitycourse.php": [
          "File: blocks/community/communitycourse.php -> blocks/community/communitycourse.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "blocks/community/db/access.php||blocks/community/db/access.php": [
          "File: blocks/community/db/access.php -> blocks/community/db/access.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "blocks/community/db/upgrade.php||blocks/community/db/upgrade.php": [
          "File: blocks/community/db/upgrade.php -> blocks/community/db/upgrade.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "blocks/community/forms.php||blocks/community/forms.php": [
          "File: blocks/community/forms.php -> blocks/community/forms.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "blocks/community/lang/en/block_community.php||blocks/community/lang/en/block_community.php": [
          "File: blocks/community/lang/en/block_community.php -> blocks/community/lang/en/block_community.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "blocks/community/locallib.php||blocks/community/locallib.php": [
          "File: blocks/community/locallib.php -> blocks/community/locallib.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "blocks/community/renderer.php||blocks/community/renderer.php": [
          "File: blocks/community/renderer.php -> blocks/community/renderer.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "blocks/community/styles.css||blocks/community/styles.css": [
          "File: blocks/community/styles.css -> blocks/community/styles.css",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "blocks/community/tests/privacy_test.php||blocks/community/tests/privacy_test.php": [
          "File: blocks/community/tests/privacy_test.php -> blocks/community/tests/privacy_test.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "blocks/community/version.php||blocks/community/version.php": [
          "File: blocks/community/version.php -> blocks/community/version.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "blocks/community/yui/comments/comments.js||blocks/community/yui/comments/comments.js": [
          "File: blocks/community/yui/comments/comments.js -> blocks/community/yui/comments/comments.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "blocks/community/yui/imagegallery/imagegallery.js||blocks/community/yui/imagegallery/imagegallery.js": [
          "File: blocks/community/yui/imagegallery/imagegallery.js -> blocks/community/yui/imagegallery/imagegallery.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "lang/en/error.php||lang/en/error.php": [
          "File: lang/en/error.php -> lang/en/error.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "263: $string['filternotenabled'] = 'Filter not enabled!';",
          "264: $string['filternotinstalled'] = 'Filter {$a} is not currently installed';",
          "265: $string['forumblockingtoomanyposts'] = 'You have exceeded the posting threshold set for this forum';",
          "266: $string['generalexceptionmessage'] = 'Exception - {$a}';",
          "267: $string['gradepubdisable'] = 'Grade publishing disabled';",
          "268: $string['gradesneedregrading'] = 'The course grades need to be recalculated';",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "266: $string['functionalityremoved'] = 'You are trying to access functionality that has been removed.';",
          "",
          "---------------"
        ],
        "lib/classes/plugin_manager.php||lib/classes/plugin_manager.php": [
          "File: lib/classes/plugin_manager.php -> lib/classes/plugin_manager.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "1647:         $plugins = array(",
          "1648:             'qformat' => array('blackboard', 'learnwise'),",
          "1649:             'auth' => array('radius', 'fc', 'nntp', 'pam', 'pop3', 'imap'),",
          "1651:             'cachestore' => array('memcache'),",
          "1652:             'enrol' => array('authorize'),",
          "1653:             'report' => array('search'),",
          "",
          "[Removed Lines]",
          "1650:             'block' => array('course_overview', 'messages'),",
          "",
          "[Added Lines]",
          "1650:             'block' => array('course_overview', 'messages', 'community'),",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1714:             'block' => array(",
          "1715:                 'activity_modules', 'activity_results', 'admin_bookmarks', 'badges',",
          "1716:                 'blog_menu', 'blog_recent', 'blog_tags', 'calendar_month',",
          "1718:                 'completionstatus', 'course_list', 'course_summary',",
          "1719:                 'feedback', 'globalsearch', 'glossary_random', 'html',",
          "1720:                 'login', 'lp', 'mentees', 'mnet_hosts', 'myoverview', 'myprofile',",
          "",
          "[Removed Lines]",
          "1717:                 'calendar_upcoming', 'comments', 'community',",
          "",
          "[Added Lines]",
          "1717:                 'calendar_upcoming', 'comments',",
          "",
          "---------------"
        ],
        "lib/db/access.php||lib/db/access.php": [
          "File: lib/db/access.php -> lib/db/access.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "2015:             'manager' => CAP_ALLOW",
          "2016:         )",
          "2017:     ),",
          "2037:     'moodle/badges:manageglobalsettings' => array(",
          "",
          "[Removed Lines]",
          "2018:     'moodle/community:add' => array(",
          "2019:         'captype' => 'write',",
          "2020:         'contextlevel' => CONTEXT_SYSTEM,",
          "2021:         'archetypes' => array(",
          "2022:             'manager' => CAP_ALLOW,",
          "2023:             'teacher' => CAP_ALLOW,",
          "2024:             'editingteacher' => CAP_ALLOW,",
          "2025:         )",
          "2026:     ),",
          "2027:     'moodle/community:download' => array(",
          "2028:         'captype' => 'write',",
          "2029:         'contextlevel' => CONTEXT_SYSTEM,",
          "2030:         'archetypes' => array(",
          "2031:             'manager' => CAP_ALLOW,",
          "2032:             'editingteacher' => CAP_ALLOW,",
          "2033:         )",
          "2034:     ),",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "lib/db/upgrade.php||lib/db/upgrade.php": [
          "File: lib/db/upgrade.php -> lib/db/upgrade.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "3465:         upgrade_main_savepoint(true, 2019073100.00);",
          "3466:     }",
          "3467:     return true;",
          "3468: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3468:     if ($oldversion < 2019082400.01) {",
          "3471:         if (!file_exists($CFG->dirroot . '/blocks/community/communitycourse.php')) {",
          "3473:             $table = new xmldb_table('block_community');",
          "3474:             if ($dbman->table_exists($table)) {",
          "3475:                 $dbman->drop_table($table);",
          "3476:             }",
          "3479:             $instances = $DB->get_records_list('block_instances', 'blockname', ['community']);",
          "3480:             $instanceids = array_keys($instances);",
          "3482:             if (!empty($instanceids)) {",
          "3483:                 $DB->delete_records_list('block_positions', 'blockinstanceid', $instanceids);",
          "3484:                 $DB->delete_records_list('block_instances', 'id', $instanceids);",
          "3485:                 list($sql, $params) = $DB->get_in_or_equal($instanceids, SQL_PARAMS_NAMED);",
          "3486:                 $params['contextlevel'] = CONTEXT_BLOCK;",
          "3487:                 $DB->delete_records_select('context', \"contextlevel=:contextlevel AND instanceid \" . $sql, $params);",
          "3489:                 $preferences = array();",
          "3490:                 foreach ($instances as $instanceid => $instance) {",
          "3491:                     $preferences[] = 'block' . $instanceid . 'hidden';",
          "3492:                     $preferences[] = 'docked_block_instance_' . $instanceid;",
          "3493:                 }",
          "3494:                 $DB->delete_records_list('user_preferences', 'name', $preferences);",
          "3495:             }",
          "3498:             $DB->delete_records('block', array('name' => 'community'));",
          "3501:             capabilities_cleanup('block_community');",
          "3503:             unset_all_config_for_plugin('block_community');",
          "3506:             $capabilitiestoberemoved = ['block/community:addinstance', 'block/community:myaddinstance'];",
          "3508:             $DB->delete_records_list('role_capabilities', 'capability', $capabilitiestoberemoved);",
          "3510:             $DB->delete_records_list('capabilities', 'name', $capabilitiestoberemoved);",
          "3511:         }",
          "3513:         upgrade_main_savepoint(true, 2019082400.01);",
          "3514:     }",
          "",
          "---------------"
        ],
        "version.php||version.php": [
          "File: version.php -> version.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "30: defined('MOODLE_INTERNAL') || die();",
          "",
          "[Removed Lines]",
          "32: $version  = 2019083000.00;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "",
          "[Added Lines]",
          "32: $version  = 2019083000.01;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "329f1f23ff028ed5a45ca861ef0108720aea52b2",
      "candidate_info": {
        "commit_hash": "329f1f23ff028ed5a45ca861ef0108720aea52b2",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/329f1f23ff028ed5a45ca861ef0108720aea52b2",
        "files": [
          "course/externallib.php",
          "lib/db/upgrade.php",
          "version.php"
        ],
        "message": "MDL-63969 core_course: Store favourite courses in the course context\n\nThe course favourites were previously set in the system context which\nis not right as they should be stored in the course context.",
        "before_after_code_files": [
          "course/externallib.php||course/externallib.php",
          "lib/db/upgrade.php||lib/db/upgrade.php",
          "version.php||version.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.php||version.php"
          ],
          "candidate": [
            "version.php||version.php"
          ]
        }
      },
      "candidate_diff": {
        "course/externallib.php||course/externallib.php": [
          "File: course/externallib.php -> course/externallib.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "3824:             $warning = [];",
          "3828:             if ($course['favourite']) {",
          "3829:                 if (!$favouriteexists) {",
          "3830:                     try {",
          "3832:                     } catch (Exception $e) {",
          "3833:                         $warning['courseid'] = $course['id'];",
          "3834:                         if ($e instanceof moodle_exception) {",
          "",
          "[Removed Lines]",
          "3826:             $favouriteexists = $ufservice->favourite_exists('core_course', 'courses', $course['id'], \\context_system::instance());",
          "3831:                         $ufservice->create_favourite('core_course', 'courses', $course['id'], \\context_system::instance());",
          "",
          "[Added Lines]",
          "3826:             $favouriteexists = $ufservice->favourite_exists('core_course', 'courses', $course['id'],",
          "3827:                     \\context_course::instance($course['id']));",
          "3832:                         $ufservice->create_favourite('core_course', 'courses', $course['id'],",
          "3833:                                 \\context_course::instance($course['id']));",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "3849:             } else {",
          "3850:                 if ($favouriteexists) {",
          "3851:                     try {",
          "3853:                     } catch (Exception $e) {",
          "3854:                         $warning['courseid'] = $course['id'];",
          "3855:                         if ($e instanceof moodle_exception) {",
          "",
          "[Removed Lines]",
          "3852:                         $ufservice->delete_favourite('core_course', 'courses', $course['id'], \\context_system::instance());",
          "",
          "[Added Lines]",
          "3854:                         $ufservice->delete_favourite('core_course', 'courses', $course['id'],",
          "3855:                                 \\context_course::instance($course['id']));",
          "",
          "---------------"
        ],
        "lib/db/upgrade.php||lib/db/upgrade.php": [
          "File: lib/db/upgrade.php -> lib/db/upgrade.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "2771:         upgrade_main_savepoint(true, 2018110700.01);",
          "2772:     }",
          "2774:     return true;",
          "2775: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2774:     if ($oldversion < 2018111300.01) {",
          "2776:         $favouritedcourses = $DB->get_records('favourite', ['component' => 'core_course', 'itemtype' => 'courses']);",
          "2778:         foreach ($favouritedcourses as $fc) {",
          "2779:             $coursecontext = \\context_course::instance($fc->itemid);",
          "2780:             $fc->contextid = $coursecontext->id;",
          "2781:             $DB->update_record('favourite', $fc);",
          "2782:         }",
          "2784:         upgrade_main_savepoint(true, 2018111300.01);",
          "2785:     }",
          "",
          "---------------"
        ],
        "version.php||version.php": [
          "File: version.php -> version.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "30: defined('MOODLE_INTERNAL') || die();",
          "",
          "[Removed Lines]",
          "32: $version  = 2018111300.00;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "",
          "[Added Lines]",
          "32: $version  = 2018111300.01;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "1470cfc2fd179722711587463a5f1d636dbc22db",
      "candidate_info": {
        "commit_hash": "1470cfc2fd179722711587463a5f1d636dbc22db",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/1470cfc2fd179722711587463a5f1d636dbc22db",
        "files": [
          "course/classes/category.php",
          "course/tests/behat/course_browsing.feature",
          "lang/en/deprecated.txt",
          "lang/en/role.php",
          "lib/db/access.php",
          "lib/db/upgrade.php",
          "lib/upgrade.txt",
          "version.php"
        ],
        "message": "Merge branch 'MDL-65354-master' of git://github.com/lameze/moodle",
        "before_after_code_files": [
          "course/classes/category.php||course/classes/category.php",
          "course/tests/behat/course_browsing.feature||course/tests/behat/course_browsing.feature",
          "lang/en/role.php||lang/en/role.php",
          "lib/db/access.php||lib/db/access.php",
          "lib/db/upgrade.php||lib/db/upgrade.php",
          "version.php||version.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "lib/db/access.php||lib/db/access.php",
            "version.php||version.php"
          ],
          "candidate": [
            "lib/db/access.php||lib/db/access.php",
            "version.php||version.php"
          ]
        }
      },
      "candidate_diff": {
        "course/classes/category.php||course/classes/category.php": [
          "File: course/classes/category.php -> course/classes/category.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "654:     public static function can_view_category($category, $user = null) {",
          "655:         if (!$category->id) {",
          "657:         }",
          "658:         $context = context_coursecat::instance($category->id);",
          "659:         if (!$category->visible && !has_capability('moodle/category:viewhiddencategories', $context, $user)) {",
          "660:             return false;",
          "661:         }",
          "663:     }",
          "",
          "[Removed Lines]",
          "656:             return has_capability('moodle/course:browse', context_system::instance(), $user);",
          "662:         return has_capability('moodle/course:browse', $context, $user);",
          "",
          "[Added Lines]",
          "656:             return has_capability('moodle/category:viewcourselist', context_system::instance(), $user);",
          "662:         return has_capability('moodle/category:viewcourselist', $context, $user);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "682:         }",
          "683:         $categorycontext = isset($course->category) ? context_coursecat::instance($course->category) :",
          "684:             context_course::instance($course->id)->get_parent_context();",
          "686:     }",
          "",
          "[Removed Lines]",
          "685:         return has_capability('moodle/course:browse', $categorycontext, $user);",
          "",
          "[Added Lines]",
          "685:         return has_capability('moodle/category:viewcourselist', $categorycontext, $user);",
          "",
          "---------------"
        ],
        "course/tests/behat/course_browsing.feature||course/tests/behat/course_browsing.feature": [
          "File: course/tests/behat/course_browsing.feature -> course/tests/behat/course_browsing.feature",
          "--- Hunk 1 ---",
          "[Context before]",
          "28:     Given I log in as \"admin\"",
          "29:     And I set the following system permissions of \"Authenticated user\" role:",
          "30:       | capability | permission |",
          "32:     And I set the following system permissions of \"Guest\" role:",
          "33:       | capability | permission |",
          "35:     And I set the following system permissions of \"Category viewer\" role:",
          "36:       | capability | permission |",
          "38:     And I am on site homepage",
          "39:     And I turn editing mode on",
          "40:     And I add the \"Navigation\" block if not present",
          "",
          "[Removed Lines]",
          "31:       | moodle/course:browse | Prevent |",
          "34:       | moodle/course:browse | Prevent |",
          "37:       | moodle/course:browse | Allow |",
          "",
          "[Added Lines]",
          "31:       | moodle/category:viewcourselist | Prevent |",
          "34:       | moodle/category:viewcourselist | Prevent |",
          "37:       | moodle/category:viewcourselist | Allow |",
          "",
          "---------------"
        ],
        "lang/en/role.php||lang/en/role.php": [
          "File: lang/en/role.php -> lang/en/role.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "98: $string['calendar:manageownentries'] = 'Manage own calendar entries';",
          "99: $string['capabilities'] = 'Capabilities';",
          "100: $string['capability'] = 'Capability';",
          "101: $string['category:create'] = 'Create categories';",
          "102: $string['category:delete'] = 'Delete categories';",
          "103: $string['category:manage'] = 'Manage categories';",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "101: $string['category:viewcourselist'] = 'View list of courses you are not enrolled in';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "154: $string['confirmunassignno'] = 'Cancel';",
          "155: $string['context'] = 'Context';",
          "156: $string['course:activityvisibility'] = 'Hide/show activities';",
          "158: $string['course:bulkmessaging'] = 'Send a message to many people';",
          "159: $string['course:create'] = 'Create courses';",
          "160: $string['course:creategroupconversations'] = 'Create group conversations';",
          "",
          "[Removed Lines]",
          "157: $string['course:browse'] = 'View list of courses where user is not enrolled';",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "495: $string['privacy:metadata:role_capabilities:timemodified'] = 'The date when the capability was created or modified.';",
          "496: $string['privacy:metadata:role_cohortroles'] = 'Roles to cohort';",
          "497: $string['course:togglecompletion'] = 'Manually mark activities as complete';",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "500: $string['course:browse'] = 'View list of courses where user is not enrolled';",
          "",
          "---------------"
        ],
        "lib/db/access.php||lib/db/access.php": [
          "File: lib/db/access.php -> lib/db/access.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "733:         'clonepermissionsfrom' => 'moodle/category:update'",
          "734:     ),",
          "738:         'captype' => 'read',",
          "740:         'archetypes' => array(",
          "741:             'guest' => CAP_ALLOW,",
          "742:             'user' => CAP_ALLOW,",
          "",
          "[Removed Lines]",
          "736:     'moodle/course:browse' => array(",
          "739:         'contextlevel' => CONTEXT_COURSE,",
          "",
          "[Added Lines]",
          "736:     'moodle/category:viewcourselist' => array(",
          "739:         'contextlevel' => CONTEXT_COURSECAT,",
          "",
          "---------------"
        ],
        "lib/db/upgrade.php||lib/db/upgrade.php": [
          "File: lib/db/upgrade.php -> lib/db/upgrade.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "3217:         upgrade_main_savepoint(true, 2019042200.02);",
          "3218:     }",
          "3220:     return true;",
          "3221: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3220:     if ($oldversion < 2019042300.01) {",
          "3221:         $sql = \"UPDATE {capabilities}",
          "3222:                    SET name = ?,",
          "3223:                        contextlevel = ?",
          "3224:                  WHERE name = ?\";",
          "3225:         $DB->execute($sql, ['moodle/category:viewcourselist', CONTEXT_COURSECAT, 'moodle/course:browse']);",
          "3227:         $sql = \"UPDATE {role_capabilities}",
          "3228:                    SET capability = ?",
          "3229:                  WHERE capability = ?\";",
          "3230:         $DB->execute($sql, ['moodle/category:viewcourselist', 'moodle/course:browse']);",
          "3233:         upgrade_main_savepoint(true, 2019042300.01);",
          "3234:     }",
          "",
          "---------------"
        ],
        "version.php||version.php": [
          "File: version.php -> version.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "30: defined('MOODLE_INTERNAL') || die();",
          "",
          "[Removed Lines]",
          "32: $version  = 2019042300.00;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "",
          "[Added Lines]",
          "32: $version  = 2019042300.01;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "9c0edd12126b159f9045b012e85205d69a267835",
      "candidate_info": {
        "commit_hash": "9c0edd12126b159f9045b012e85205d69a267835",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/9c0edd12126b159f9045b012e85205d69a267835",
        "files": [
          "lib/db/upgrade.php",
          "version.php"
        ],
        "message": "MDL-65248 analytics: Replace upgrade script to apply for all moves\n\nWhile strictly we don't nedd to provide an upgrade path for master,\nany dev/integration site already using some of the 3.7 new tagets\nin models will break (class rename/move) if we don't perform the\nupdate of all them.\n\nThis commit takes rid of the previous upgrade step, only performing\nthe update of a couple of targets and now supports all the (5) targets:\n\n- course_dropout\n- course_competencies\n- course_completion\n- course_gradetopass\n- no_teaching",
        "before_after_code_files": [
          "lib/db/upgrade.php||lib/db/upgrade.php",
          "version.php||version.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.php||version.php"
          ],
          "candidate": [
            "version.php||version.php"
          ]
        }
      },
      "candidate_diff": {
        "lib/db/upgrade.php||lib/db/upgrade.php": [
          "File: lib/db/upgrade.php -> lib/db/upgrade.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "3184:         upgrade_main_savepoint(true, 2019041800.01);",
          "3185:     }",
          "3191:         ];",
          "3205:         }",
          "3209:     }",
          "3211:     return true;",
          "",
          "[Removed Lines]",
          "3187:     if ($oldversion < 2019041900.00) {",
          "3189:         $params = [",
          "3190:             'target' => '\\core\\analytics\\target\\no_teaching',",
          "3192:         $models = $DB->get_records('analytics_models', $params);",
          "3193:         foreach ($models as $model) {",
          "3194:             $model->target = '\\core_course\\analytics\\target\\no_teaching';",
          "3195:             $DB->update_record('analytics_models', $model);",
          "3196:         }",
          "3198:         $params = [",
          "3199:             'target' => '\\core\\analytics\\target\\course_dropout',",
          "3200:         ];",
          "3201:         $models = $DB->get_records('analytics_models', $params);",
          "3202:         foreach ($models as $model) {",
          "3203:             $model->target = '\\core_course\\analytics\\target\\course_dropout';",
          "3204:             $DB->update_record('analytics_models', $model);",
          "3208:         upgrade_main_savepoint(true, 2019041900.00);",
          "",
          "[Added Lines]",
          "3187:     if ($oldversion < 2019042000.00) {",
          "3190:         $targets = [",
          "3191:             '\\core\\analytics\\target\\course_competencies' => '\\core_course\\analytics\\target\\course_competencies',",
          "3192:             '\\core\\analytics\\target\\course_completion' => '\\core_course\\analytics\\target\\course_completion',",
          "3193:             '\\core\\analytics\\target\\course_dropout' => '\\core_course\\analytics\\target\\course_dropout',",
          "3194:             '\\core\\analytics\\target\\course_gradetopass' => '\\core_course\\analytics\\target\\course_gradetopass',",
          "3195:             '\\core\\analytics\\target\\no_teaching' => '\\core_course\\analytics\\target\\no_teaching',",
          "3198:         foreach ($targets as $oldclass => $newclass) {",
          "3199:             $DB->set_field('analytics_models', 'target', $newclass, ['target' => $oldclass]);",
          "3203:         upgrade_main_savepoint(true, 2019042000.00);",
          "",
          "---------------"
        ],
        "version.php||version.php": [
          "File: version.php -> version.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "30: defined('MOODLE_INTERNAL') || die();",
          "",
          "[Removed Lines]",
          "32: $version  = 2019041900.00;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "",
          "[Added Lines]",
          "32: $version  = 2019042000.00;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "019004dcc794f3e615fd10bd0bc374d2d7834ab2",
      "candidate_info": {
        "commit_hash": "019004dcc794f3e615fd10bd0bc374d2d7834ab2",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/019004dcc794f3e615fd10bd0bc374d2d7834ab2",
        "files": [
          "version.php"
        ],
        "message": "on-demand release 3.7dev+",
        "before_after_code_files": [
          "version.php||version.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.php||version.php"
          ],
          "candidate": [
            "version.php||version.php"
          ]
        }
      },
      "candidate_diff": {
        "version.php||version.php": [
          "File: version.php -> version.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "30: defined('MOODLE_INTERNAL') || die();",
          "38: $branch   = '37';                       // This version's branch.",
          "39: $maturity = MATURITY_ALPHA;             // This version's maturity level.",
          "",
          "[Removed Lines]",
          "32: $version  = 2019041300.01;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "36: $release  = '3.7dev+ (Build: 20190413)'; // Human-friendly version name",
          "",
          "[Added Lines]",
          "32: $version  = 2019041800.00;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "36: $release  = '3.7dev+ (Build: 20190418)'; // Human-friendly version name",
          "",
          "---------------"
        ]
      }
    }
  ]
}