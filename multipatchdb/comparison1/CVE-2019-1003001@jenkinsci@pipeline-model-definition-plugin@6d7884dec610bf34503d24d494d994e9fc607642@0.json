{
  "cve_id": "CVE-2019-1003001",
  "cve_desc": "A sandbox bypass vulnerability exists in Pipeline: Groovy Plugin 2.61 and earlier in src/main/java/org/jenkinsci/plugins/workflow/cps/CpsFlowDefinition.java, src/main/java/org/jenkinsci/plugins/workflow/cps/CpsGroovyShellFactory.java that allows attackers with Overall/Read permission to provide a pipeline script to an HTTP endpoint that can result in arbitrary code execution on the Jenkins master JVM.",
  "repo": "jenkinsci/pipeline-model-definition-plugin",
  "patch_hash": "6d7884dec610bf34503d24d494d994e9fc607642",
  "patch_info": {
    "commit_hash": "6d7884dec610bf34503d24d494d994e9fc607642",
    "repo": "jenkinsci/pipeline-model-definition-plugin",
    "commit_url": "https://github.com/jenkinsci/pipeline-model-definition-plugin/commit/6d7884dec610bf34503d24d494d994e9fc607642",
    "files": [
      "pipeline-model-definition/src/main/groovy/org/jenkinsci/plugins/pipeline/modeldefinition/parser/Converter.groovy",
      "pipeline-model-definition/src/test/java/org/jenkinsci/plugins/pipeline/modeldefinition/endpoints/ModelConverterActionTest.java",
      "pipeline-model-definition/src/test/resources/localASTTransformInCompilation.groovy",
      "pom.xml"
    ],
    "message": "[SECURITY-1266] Don't execute AST transforms in validate/translate",
    "before_after_code_files": [
      "pipeline-model-definition/src/main/groovy/org/jenkinsci/plugins/pipeline/modeldefinition/parser/Converter.groovy||pipeline-model-definition/src/main/groovy/org/jenkinsci/plugins/pipeline/modeldefinition/parser/Converter.groovy",
      "pipeline-model-definition/src/test/java/org/jenkinsci/plugins/pipeline/modeldefinition/endpoints/ModelConverterActionTest.java||pipeline-model-definition/src/test/java/org/jenkinsci/plugins/pipeline/modeldefinition/endpoints/ModelConverterActionTest.java",
      "pipeline-model-definition/src/test/resources/localASTTransformInCompilation.groovy||pipeline-model-definition/src/test/resources/localASTTransformInCompilation.groovy"
    ]
  },
  "patch_diff": {
    "pipeline-model-definition/src/main/groovy/org/jenkinsci/plugins/pipeline/modeldefinition/parser/Converter.groovy||pipeline-model-definition/src/main/groovy/org/jenkinsci/plugins/pipeline/modeldefinition/parser/Converter.groovy": [
      "File: pipeline-model-definition/src/main/groovy/org/jenkinsci/plugins/pipeline/modeldefinition/parser/Converter.groovy -> pipeline-model-definition/src/main/groovy/org/jenkinsci/plugins/pipeline/modeldefinition/parser/Converter.groovy",
      "--- Hunk 1 ---",
      "[Context before]",
      "42: import org.jenkinsci.plugins.pipeline.modeldefinition.ast.ModelASTPipelineDef",
      "43: import org.jenkinsci.plugins.pipeline.modeldefinition.ast.ModelASTStep",
      "44: import org.jenkinsci.plugins.pipeline.modeldefinition.validator.DeclarativeValidatorContributor",
      "45: import org.jenkinsci.plugins.workflow.cps.CpsThread",
      "46: import org.jenkinsci.plugins.workflow.cps.GroovyShellDecorator",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "45: import org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.GroovySandbox",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "49: import java.security.cert.Certificate",
      "51: import static groovy.lang.GroovyShell.DEFAULT_CODE_BASE",
      "",
      "[Removed Lines]",
      "52: import static org.codehaus.groovy.control.Phases.CANONICALIZATION",
      "",
      "[Added Lines]",
      "53: import static org.codehaus.groovy.control.Phases.CONVERSION",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "133:     }",
      "135:     private static CompilerConfiguration makeCompilerConfiguration() {",
      "138:         ImportCustomizer ic = new ImportCustomizer()",
      "139:         ic.addStarImports(NonCPS.class.getPackage().getName())",
      "",
      "[Removed Lines]",
      "136:         CompilerConfiguration cc = new CompilerConfiguration()",
      "",
      "[Added Lines]",
      "137:         CompilerConfiguration cc = GroovySandbox.createBaseCompilerConfiguration()",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "166:                     model[0] = new ModelParser(source, enabledOptionalValidators).parse(true)",
      "167:                 }",
      "168:             }",
      "173:         return model[0]",
      "174:     }",
      "",
      "[Removed Lines]",
      "169:         }, CANONICALIZATION)",
      "171:         cu.compile(CANONICALIZATION)",
      "",
      "[Added Lines]",
      "170:         }, CONVERSION)",
      "172:         cu.compile(CONVERSION)",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "195:                     model[0] = new ModelParser(source, enabledOptionalValidators).parsePlainSteps(source.AST)",
      "196:                 }",
      "197:             }",
      "202:         return model[0]",
      "203:     }",
      "",
      "[Removed Lines]",
      "198:         }, CANONICALIZATION)",
      "200:         cu.compile(CANONICALIZATION)",
      "",
      "[Added Lines]",
      "199:         }, CONVERSION)",
      "201:         cu.compile(CONVERSION)",
      "",
      "---------------"
    ],
    "pipeline-model-definition/src/test/java/org/jenkinsci/plugins/pipeline/modeldefinition/endpoints/ModelConverterActionTest.java||pipeline-model-definition/src/test/java/org/jenkinsci/plugins/pipeline/modeldefinition/endpoints/ModelConverterActionTest.java": [
      "File: pipeline-model-definition/src/test/java/org/jenkinsci/plugins/pipeline/modeldefinition/endpoints/ModelConverterActionTest.java -> pipeline-model-definition/src/test/java/org/jenkinsci/plugins/pipeline/modeldefinition/endpoints/ModelConverterActionTest.java",
      "--- Hunk 1 ---",
      "[Context before]",
      "33: import org.jenkinsci.plugins.pipeline.modeldefinition.model.BuildCondition;",
      "34: import org.jenkinsci.plugins.pipeline.modeldefinition.model.Tools;",
      "35: import org.junit.Test;",
      "36: import org.jvnet.hudson.test.JenkinsRule;",
      "38: import java.net.URL;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "36: import org.jvnet.hudson.test.Issue;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "41: import static org.junit.Assert.assertEquals;",
      "42: import static org.junit.Assert.assertNotNull;",
      "43: import static org.junit.Assert.assertTrue;",
      "45: public class ModelConverterActionTest extends AbstractModelDefTest {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "44: import static org.junit.Assert.assertNull;",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "243:         assertTrue(\"Errors array (\" + topErrors.toString(2) + \") didn't contain expected error '\" + expectedError + \"'\",",
      "244:                 foundExpectedErrorInJSON(topErrors, expectedError));",
      "245:     }",
      "246: }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "249:     @Issue(\"SECURITY-1266\")",
      "250:     @Test",
      "251:     public void testLocalASTTransformInCompilation() throws Exception {",
      "252:         final String rawJenkinsfile = fileContentsFromResources(\"localASTTransformInCompilation.groovy\", true);",
      "254:         if (rawJenkinsfile != null) {",
      "256:             JenkinsRule.WebClient wc = j.createWebClient();",
      "257:             WebRequest req = new WebRequest(new URL(wc.getContextPath() + ModelConverterAction.PIPELINE_CONVERTER_URL + \"/validateJenkinsfile\"), HttpMethod.POST);",
      "259:             assertNotNull(rawJenkinsfile);",
      "261:             NameValuePair pair = new NameValuePair(\"jenkinsfile\", rawJenkinsfile);",
      "262:             req.setRequestParameters(Collections.singletonList(pair));",
      "264:             String rawResult = wc.getPage(req).getWebResponse().getContentAsString();",
      "265:             assertNotNull(rawResult);",
      "267:             JSONObject result = JSONObject.fromObject(rawResult);",
      "269:             assertEquals(\"Full result doesn't include status - \" + result.toString(2), \"ok\", result.getString(\"status\"));",
      "270:             JSONObject resultData = result.getJSONObject(\"data\");",
      "271:             assertNotNull(resultData);",
      "272:             assertEquals(\"Result wasn't a failure - \" + result.toString(2), \"failure\", resultData.getString(\"result\"));",
      "274:             assertNull(j.jenkins.getItem(\"should-not-exist\"));",
      "275:         }",
      "276:     }",
      "",
      "---------------"
    ],
    "pipeline-model-definition/src/test/resources/localASTTransformInCompilation.groovy||pipeline-model-definition/src/test/resources/localASTTransformInCompilation.groovy": [
      "File: pipeline-model-definition/src/test/resources/localASTTransformInCompilation.groovy -> pipeline-model-definition/src/test/resources/localASTTransformInCompilation.groovy",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "25: import groovy.transform.*",
      "26: import jenkins.model.Jenkins",
      "27: import org.jenkinsci.plugins.workflow.job.WorkflowJob",
      "29: @ASTTest(value={ assert Jenkins.get().createProject(WorkflowJob.class, \"should-not-exist\") })",
      "30: @Field int x",
      "32: pipeline {",
      "33:     agent none",
      "34:     stages {",
      "35:         stage(\"foo\") {",
      "36:             steps {",
      "37:                 echo \"hello\"",
      "38:             }",
      "39:         }",
      "40:     }",
      "41: }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "6d7884dec610bf34503d24d494d994e9fc607642",
      "candidate_info": {
        "commit_hash": "6d7884dec610bf34503d24d494d994e9fc607642",
        "repo": "jenkinsci/pipeline-model-definition-plugin",
        "commit_url": "https://github.com/jenkinsci/pipeline-model-definition-plugin/commit/6d7884dec610bf34503d24d494d994e9fc607642",
        "files": [
          "pipeline-model-definition/src/main/groovy/org/jenkinsci/plugins/pipeline/modeldefinition/parser/Converter.groovy",
          "pipeline-model-definition/src/test/java/org/jenkinsci/plugins/pipeline/modeldefinition/endpoints/ModelConverterActionTest.java",
          "pipeline-model-definition/src/test/resources/localASTTransformInCompilation.groovy",
          "pom.xml"
        ],
        "message": "[SECURITY-1266] Don't execute AST transforms in validate/translate",
        "before_after_code_files": [
          "pipeline-model-definition/src/main/groovy/org/jenkinsci/plugins/pipeline/modeldefinition/parser/Converter.groovy||pipeline-model-definition/src/main/groovy/org/jenkinsci/plugins/pipeline/modeldefinition/parser/Converter.groovy",
          "pipeline-model-definition/src/test/java/org/jenkinsci/plugins/pipeline/modeldefinition/endpoints/ModelConverterActionTest.java||pipeline-model-definition/src/test/java/org/jenkinsci/plugins/pipeline/modeldefinition/endpoints/ModelConverterActionTest.java",
          "pipeline-model-definition/src/test/resources/localASTTransformInCompilation.groovy||pipeline-model-definition/src/test/resources/localASTTransformInCompilation.groovy"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "pipeline-model-definition/src/main/groovy/org/jenkinsci/plugins/pipeline/modeldefinition/parser/Converter.groovy||pipeline-model-definition/src/main/groovy/org/jenkinsci/plugins/pipeline/modeldefinition/parser/Converter.groovy",
            "pipeline-model-definition/src/test/java/org/jenkinsci/plugins/pipeline/modeldefinition/endpoints/ModelConverterActionTest.java||pipeline-model-definition/src/test/java/org/jenkinsci/plugins/pipeline/modeldefinition/endpoints/ModelConverterActionTest.java",
            "pipeline-model-definition/src/test/resources/localASTTransformInCompilation.groovy||pipeline-model-definition/src/test/resources/localASTTransformInCompilation.groovy"
          ],
          "candidate": [
            "pipeline-model-definition/src/main/groovy/org/jenkinsci/plugins/pipeline/modeldefinition/parser/Converter.groovy||pipeline-model-definition/src/main/groovy/org/jenkinsci/plugins/pipeline/modeldefinition/parser/Converter.groovy",
            "pipeline-model-definition/src/test/java/org/jenkinsci/plugins/pipeline/modeldefinition/endpoints/ModelConverterActionTest.java||pipeline-model-definition/src/test/java/org/jenkinsci/plugins/pipeline/modeldefinition/endpoints/ModelConverterActionTest.java",
            "pipeline-model-definition/src/test/resources/localASTTransformInCompilation.groovy||pipeline-model-definition/src/test/resources/localASTTransformInCompilation.groovy"
          ]
        }
      },
      "candidate_diff": {
        "pipeline-model-definition/src/main/groovy/org/jenkinsci/plugins/pipeline/modeldefinition/parser/Converter.groovy||pipeline-model-definition/src/main/groovy/org/jenkinsci/plugins/pipeline/modeldefinition/parser/Converter.groovy": [
          "File: pipeline-model-definition/src/main/groovy/org/jenkinsci/plugins/pipeline/modeldefinition/parser/Converter.groovy -> pipeline-model-definition/src/main/groovy/org/jenkinsci/plugins/pipeline/modeldefinition/parser/Converter.groovy",
          "--- Hunk 1 ---",
          "[Context before]",
          "42: import org.jenkinsci.plugins.pipeline.modeldefinition.ast.ModelASTPipelineDef",
          "43: import org.jenkinsci.plugins.pipeline.modeldefinition.ast.ModelASTStep",
          "44: import org.jenkinsci.plugins.pipeline.modeldefinition.validator.DeclarativeValidatorContributor",
          "45: import org.jenkinsci.plugins.workflow.cps.CpsThread",
          "46: import org.jenkinsci.plugins.workflow.cps.GroovyShellDecorator",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "45: import org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.GroovySandbox",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "49: import java.security.cert.Certificate",
          "51: import static groovy.lang.GroovyShell.DEFAULT_CODE_BASE",
          "",
          "[Removed Lines]",
          "52: import static org.codehaus.groovy.control.Phases.CANONICALIZATION",
          "",
          "[Added Lines]",
          "53: import static org.codehaus.groovy.control.Phases.CONVERSION",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "133:     }",
          "135:     private static CompilerConfiguration makeCompilerConfiguration() {",
          "138:         ImportCustomizer ic = new ImportCustomizer()",
          "139:         ic.addStarImports(NonCPS.class.getPackage().getName())",
          "",
          "[Removed Lines]",
          "136:         CompilerConfiguration cc = new CompilerConfiguration()",
          "",
          "[Added Lines]",
          "137:         CompilerConfiguration cc = GroovySandbox.createBaseCompilerConfiguration()",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "166:                     model[0] = new ModelParser(source, enabledOptionalValidators).parse(true)",
          "167:                 }",
          "168:             }",
          "173:         return model[0]",
          "174:     }",
          "",
          "[Removed Lines]",
          "169:         }, CANONICALIZATION)",
          "171:         cu.compile(CANONICALIZATION)",
          "",
          "[Added Lines]",
          "170:         }, CONVERSION)",
          "172:         cu.compile(CONVERSION)",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "195:                     model[0] = new ModelParser(source, enabledOptionalValidators).parsePlainSteps(source.AST)",
          "196:                 }",
          "197:             }",
          "202:         return model[0]",
          "203:     }",
          "",
          "[Removed Lines]",
          "198:         }, CANONICALIZATION)",
          "200:         cu.compile(CANONICALIZATION)",
          "",
          "[Added Lines]",
          "199:         }, CONVERSION)",
          "201:         cu.compile(CONVERSION)",
          "",
          "---------------"
        ],
        "pipeline-model-definition/src/test/java/org/jenkinsci/plugins/pipeline/modeldefinition/endpoints/ModelConverterActionTest.java||pipeline-model-definition/src/test/java/org/jenkinsci/plugins/pipeline/modeldefinition/endpoints/ModelConverterActionTest.java": [
          "File: pipeline-model-definition/src/test/java/org/jenkinsci/plugins/pipeline/modeldefinition/endpoints/ModelConverterActionTest.java -> pipeline-model-definition/src/test/java/org/jenkinsci/plugins/pipeline/modeldefinition/endpoints/ModelConverterActionTest.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "33: import org.jenkinsci.plugins.pipeline.modeldefinition.model.BuildCondition;",
          "34: import org.jenkinsci.plugins.pipeline.modeldefinition.model.Tools;",
          "35: import org.junit.Test;",
          "36: import org.jvnet.hudson.test.JenkinsRule;",
          "38: import java.net.URL;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "36: import org.jvnet.hudson.test.Issue;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "41: import static org.junit.Assert.assertEquals;",
          "42: import static org.junit.Assert.assertNotNull;",
          "43: import static org.junit.Assert.assertTrue;",
          "45: public class ModelConverterActionTest extends AbstractModelDefTest {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "44: import static org.junit.Assert.assertNull;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "243:         assertTrue(\"Errors array (\" + topErrors.toString(2) + \") didn't contain expected error '\" + expectedError + \"'\",",
          "244:                 foundExpectedErrorInJSON(topErrors, expectedError));",
          "245:     }",
          "246: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "249:     @Issue(\"SECURITY-1266\")",
          "250:     @Test",
          "251:     public void testLocalASTTransformInCompilation() throws Exception {",
          "252:         final String rawJenkinsfile = fileContentsFromResources(\"localASTTransformInCompilation.groovy\", true);",
          "254:         if (rawJenkinsfile != null) {",
          "256:             JenkinsRule.WebClient wc = j.createWebClient();",
          "257:             WebRequest req = new WebRequest(new URL(wc.getContextPath() + ModelConverterAction.PIPELINE_CONVERTER_URL + \"/validateJenkinsfile\"), HttpMethod.POST);",
          "259:             assertNotNull(rawJenkinsfile);",
          "261:             NameValuePair pair = new NameValuePair(\"jenkinsfile\", rawJenkinsfile);",
          "262:             req.setRequestParameters(Collections.singletonList(pair));",
          "264:             String rawResult = wc.getPage(req).getWebResponse().getContentAsString();",
          "265:             assertNotNull(rawResult);",
          "267:             JSONObject result = JSONObject.fromObject(rawResult);",
          "269:             assertEquals(\"Full result doesn't include status - \" + result.toString(2), \"ok\", result.getString(\"status\"));",
          "270:             JSONObject resultData = result.getJSONObject(\"data\");",
          "271:             assertNotNull(resultData);",
          "272:             assertEquals(\"Result wasn't a failure - \" + result.toString(2), \"failure\", resultData.getString(\"result\"));",
          "274:             assertNull(j.jenkins.getItem(\"should-not-exist\"));",
          "275:         }",
          "276:     }",
          "",
          "---------------"
        ],
        "pipeline-model-definition/src/test/resources/localASTTransformInCompilation.groovy||pipeline-model-definition/src/test/resources/localASTTransformInCompilation.groovy": [
          "File: pipeline-model-definition/src/test/resources/localASTTransformInCompilation.groovy -> pipeline-model-definition/src/test/resources/localASTTransformInCompilation.groovy",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "25: import groovy.transform.*",
          "26: import jenkins.model.Jenkins",
          "27: import org.jenkinsci.plugins.workflow.job.WorkflowJob",
          "29: @ASTTest(value={ assert Jenkins.get().createProject(WorkflowJob.class, \"should-not-exist\") })",
          "30: @Field int x",
          "32: pipeline {",
          "33:     agent none",
          "34:     stages {",
          "35:         stage(\"foo\") {",
          "36:             steps {",
          "37:                 echo \"hello\"",
          "38:             }",
          "39:         }",
          "40:     }",
          "41: }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "7181dc7b9bb35e6bba49aac1e27518f92bc5e196",
      "candidate_info": {
        "commit_hash": "7181dc7b9bb35e6bba49aac1e27518f92bc5e196",
        "repo": "jenkinsci/pipeline-model-definition-plugin",
        "commit_url": "https://github.com/jenkinsci/pipeline-model-definition-plugin/commit/7181dc7b9bb35e6bba49aac1e27518f92bc5e196",
        "files": [
          "pipeline-model-api/pom.xml",
          "pipeline-model-definition/pom.xml",
          "pipeline-model-definition/src/main/groovy/org/jenkinsci/plugins/pipeline/modeldefinition/parser/Converter.groovy",
          "pipeline-model-definition/src/test/java/org/jenkinsci/plugins/pipeline/modeldefinition/endpoints/ModelConverterActionTest.java",
          "pipeline-model-definition/src/test/resources/localASTTransformInCompilation.groovy",
          "pipeline-model-extensions/pom.xml",
          "pipeline-stage-tags-metadata/pom.xml",
          "pom.xml"
        ],
        "message": "[SECURITY-1266] Don't execute AST transforms in validate/translate",
        "before_after_code_files": [
          "pipeline-model-definition/src/main/groovy/org/jenkinsci/plugins/pipeline/modeldefinition/parser/Converter.groovy||pipeline-model-definition/src/main/groovy/org/jenkinsci/plugins/pipeline/modeldefinition/parser/Converter.groovy",
          "pipeline-model-definition/src/test/java/org/jenkinsci/plugins/pipeline/modeldefinition/endpoints/ModelConverterActionTest.java||pipeline-model-definition/src/test/java/org/jenkinsci/plugins/pipeline/modeldefinition/endpoints/ModelConverterActionTest.java",
          "pipeline-model-definition/src/test/resources/localASTTransformInCompilation.groovy||pipeline-model-definition/src/test/resources/localASTTransformInCompilation.groovy"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_olp_changes": 1,
        "olp_code_files": {
          "patch": [
            "pipeline-model-definition/src/main/groovy/org/jenkinsci/plugins/pipeline/modeldefinition/parser/Converter.groovy||pipeline-model-definition/src/main/groovy/org/jenkinsci/plugins/pipeline/modeldefinition/parser/Converter.groovy",
            "pipeline-model-definition/src/test/java/org/jenkinsci/plugins/pipeline/modeldefinition/endpoints/ModelConverterActionTest.java||pipeline-model-definition/src/test/java/org/jenkinsci/plugins/pipeline/modeldefinition/endpoints/ModelConverterActionTest.java",
            "pipeline-model-definition/src/test/resources/localASTTransformInCompilation.groovy||pipeline-model-definition/src/test/resources/localASTTransformInCompilation.groovy"
          ],
          "candidate": [
            "pipeline-model-definition/src/main/groovy/org/jenkinsci/plugins/pipeline/modeldefinition/parser/Converter.groovy||pipeline-model-definition/src/main/groovy/org/jenkinsci/plugins/pipeline/modeldefinition/parser/Converter.groovy",
            "pipeline-model-definition/src/test/java/org/jenkinsci/plugins/pipeline/modeldefinition/endpoints/ModelConverterActionTest.java||pipeline-model-definition/src/test/java/org/jenkinsci/plugins/pipeline/modeldefinition/endpoints/ModelConverterActionTest.java",
            "pipeline-model-definition/src/test/resources/localASTTransformInCompilation.groovy||pipeline-model-definition/src/test/resources/localASTTransformInCompilation.groovy"
          ]
        }
      },
      "candidate_diff": {
        "pipeline-model-definition/src/main/groovy/org/jenkinsci/plugins/pipeline/modeldefinition/parser/Converter.groovy||pipeline-model-definition/src/main/groovy/org/jenkinsci/plugins/pipeline/modeldefinition/parser/Converter.groovy": [
          "File: pipeline-model-definition/src/main/groovy/org/jenkinsci/plugins/pipeline/modeldefinition/parser/Converter.groovy -> pipeline-model-definition/src/main/groovy/org/jenkinsci/plugins/pipeline/modeldefinition/parser/Converter.groovy",
          "--- Hunk 1 ---",
          "[Context before]",
          "42: import org.jenkinsci.plugins.pipeline.modeldefinition.ast.ModelASTPipelineDef",
          "43: import org.jenkinsci.plugins.pipeline.modeldefinition.ast.ModelASTStep",
          "44: import org.jenkinsci.plugins.pipeline.modeldefinition.validator.DeclarativeValidatorContributor",
          "45: import org.jenkinsci.plugins.workflow.cps.CpsThread",
          "46: import org.jenkinsci.plugins.workflow.cps.GroovyShellDecorator",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "45: import org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.GroovySandbox",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "49: import java.security.cert.Certificate",
          "51: import static groovy.lang.GroovyShell.DEFAULT_CODE_BASE",
          "",
          "[Removed Lines]",
          "52: import static org.codehaus.groovy.control.Phases.CANONICALIZATION",
          "",
          "[Added Lines]",
          "53: import static org.codehaus.groovy.control.Phases.CONVERSION",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "133:     }",
          "135:     private static CompilerConfiguration makeCompilerConfiguration() {",
          "138:         ImportCustomizer ic = new ImportCustomizer()",
          "139:         ic.addStarImports(NonCPS.class.getPackage().getName())",
          "",
          "[Removed Lines]",
          "136:         CompilerConfiguration cc = new CompilerConfiguration()",
          "",
          "[Added Lines]",
          "137:         CompilerConfiguration cc = GroovySandbox.createBaseCompilerConfiguration()",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "166:                     model[0] = new ModelParser(source, enabledOptionalValidators).parse(true)",
          "167:                 }",
          "168:             }",
          "173:         return model[0]",
          "174:     }",
          "",
          "[Removed Lines]",
          "169:         }, CANONICALIZATION)",
          "171:         cu.compile(CANONICALIZATION)",
          "",
          "[Added Lines]",
          "170:         }, CONVERSION)",
          "172:         cu.compile(CONVERSION)",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "195:                     model[0] = new ModelParser(source, enabledOptionalValidators).parsePlainSteps(source.AST)",
          "196:                 }",
          "197:             }",
          "202:         return model[0]",
          "203:     }",
          "",
          "[Removed Lines]",
          "198:         }, CANONICALIZATION)",
          "200:         cu.compile(CANONICALIZATION)",
          "",
          "[Added Lines]",
          "199:         }, CONVERSION)",
          "201:         cu.compile(CONVERSION)",
          "",
          "---------------"
        ],
        "pipeline-model-definition/src/test/java/org/jenkinsci/plugins/pipeline/modeldefinition/endpoints/ModelConverterActionTest.java||pipeline-model-definition/src/test/java/org/jenkinsci/plugins/pipeline/modeldefinition/endpoints/ModelConverterActionTest.java": [
          "File: pipeline-model-definition/src/test/java/org/jenkinsci/plugins/pipeline/modeldefinition/endpoints/ModelConverterActionTest.java -> pipeline-model-definition/src/test/java/org/jenkinsci/plugins/pipeline/modeldefinition/endpoints/ModelConverterActionTest.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "33: import org.jenkinsci.plugins.pipeline.modeldefinition.model.BuildCondition;",
          "34: import org.jenkinsci.plugins.pipeline.modeldefinition.model.Tools;",
          "35: import org.junit.Test;",
          "36: import org.jvnet.hudson.test.JenkinsRule;",
          "38: import java.net.URL;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "36: import org.jvnet.hudson.test.Issue;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "41: import static org.junit.Assert.assertEquals;",
          "42: import static org.junit.Assert.assertNotNull;",
          "43: import static org.junit.Assert.assertTrue;",
          "45: public class ModelConverterActionTest extends AbstractModelDefTest {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "44: import static org.junit.Assert.assertNull;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "243:         assertTrue(\"Errors array (\" + topErrors.toString(2) + \") didn't contain expected error '\" + expectedError + \"'\",",
          "244:                 foundExpectedErrorInJSON(topErrors, expectedError));",
          "245:     }",
          "246: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "249:     @Issue(\"SECURITY-1266\")",
          "250:     @Test",
          "251:     public void testLocalASTTransformInCompilation() throws Exception {",
          "252:         final String rawJenkinsfile = fileContentsFromResources(\"localASTTransformInCompilation.groovy\", true);",
          "254:         if (rawJenkinsfile != null) {",
          "256:             JenkinsRule.WebClient wc = j.createWebClient();",
          "257:             WebRequest req = new WebRequest(new URL(wc.getContextPath() + ModelConverterAction.PIPELINE_CONVERTER_URL + \"/validateJenkinsfile\"), HttpMethod.POST);",
          "259:             assertNotNull(rawJenkinsfile);",
          "261:             NameValuePair pair = new NameValuePair(\"jenkinsfile\", rawJenkinsfile);",
          "262:             req.setRequestParameters(Collections.singletonList(pair));",
          "264:             String rawResult = wc.getPage(req).getWebResponse().getContentAsString();",
          "265:             assertNotNull(rawResult);",
          "267:             JSONObject result = JSONObject.fromObject(rawResult);",
          "269:             assertEquals(\"Full result doesn't include status - \" + result.toString(2), \"ok\", result.getString(\"status\"));",
          "270:             JSONObject resultData = result.getJSONObject(\"data\");",
          "271:             assertNotNull(resultData);",
          "272:             assertEquals(\"Result wasn't a failure - \" + result.toString(2), \"failure\", resultData.getString(\"result\"));",
          "274:             assertNull(j.jenkins.getItem(\"should-not-exist\"));",
          "275:         }",
          "276:     }",
          "",
          "---------------"
        ],
        "pipeline-model-definition/src/test/resources/localASTTransformInCompilation.groovy||pipeline-model-definition/src/test/resources/localASTTransformInCompilation.groovy": [
          "File: pipeline-model-definition/src/test/resources/localASTTransformInCompilation.groovy -> pipeline-model-definition/src/test/resources/localASTTransformInCompilation.groovy",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "25: import groovy.transform.*",
          "26: import jenkins.model.Jenkins",
          "27: import org.jenkinsci.plugins.workflow.job.WorkflowJob",
          "29: @ASTTest(value={ assert Jenkins.get().createProject(WorkflowJob.class, \"should-not-exist\") })",
          "30: @Field int x",
          "32: pipeline {",
          "33:     agent none",
          "34:     stages {",
          "35:         stage(\"foo\") {",
          "36:             steps {",
          "37:                 echo \"hello\"",
          "38:             }",
          "39:         }",
          "40:     }",
          "41: }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "083abd96e68fd89f556a0cd53db5f878dbf09b92",
      "candidate_info": {
        "commit_hash": "083abd96e68fd89f556a0cd53db5f878dbf09b92",
        "repo": "jenkinsci/pipeline-model-definition-plugin",
        "commit_url": "https://github.com/jenkinsci/pipeline-model-definition-plugin/commit/083abd96e68fd89f556a0cd53db5f878dbf09b92",
        "files": [
          "pipeline-model-definition/src/main/groovy/org/jenkinsci/plugins/pipeline/modeldefinition/parser/Converter.groovy",
          "pipeline-model-definition/src/test/java/org/jenkinsci/plugins/pipeline/modeldefinition/endpoints/ModelConverterActionTest.java",
          "pipeline-model-definition/src/test/resources/localASTTransformInCompilation.groovy",
          "pom.xml"
        ],
        "message": "[SECURITY-1266] Don't execute AST transforms in validate/translate",
        "before_after_code_files": [
          "pipeline-model-definition/src/main/groovy/org/jenkinsci/plugins/pipeline/modeldefinition/parser/Converter.groovy||pipeline-model-definition/src/main/groovy/org/jenkinsci/plugins/pipeline/modeldefinition/parser/Converter.groovy",
          "pipeline-model-definition/src/test/java/org/jenkinsci/plugins/pipeline/modeldefinition/endpoints/ModelConverterActionTest.java||pipeline-model-definition/src/test/java/org/jenkinsci/plugins/pipeline/modeldefinition/endpoints/ModelConverterActionTest.java",
          "pipeline-model-definition/src/test/resources/localASTTransformInCompilation.groovy||pipeline-model-definition/src/test/resources/localASTTransformInCompilation.groovy"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_olp_changes": 1,
        "olp_code_files": {
          "patch": [
            "pipeline-model-definition/src/main/groovy/org/jenkinsci/plugins/pipeline/modeldefinition/parser/Converter.groovy||pipeline-model-definition/src/main/groovy/org/jenkinsci/plugins/pipeline/modeldefinition/parser/Converter.groovy",
            "pipeline-model-definition/src/test/java/org/jenkinsci/plugins/pipeline/modeldefinition/endpoints/ModelConverterActionTest.java||pipeline-model-definition/src/test/java/org/jenkinsci/plugins/pipeline/modeldefinition/endpoints/ModelConverterActionTest.java",
            "pipeline-model-definition/src/test/resources/localASTTransformInCompilation.groovy||pipeline-model-definition/src/test/resources/localASTTransformInCompilation.groovy"
          ],
          "candidate": [
            "pipeline-model-definition/src/main/groovy/org/jenkinsci/plugins/pipeline/modeldefinition/parser/Converter.groovy||pipeline-model-definition/src/main/groovy/org/jenkinsci/plugins/pipeline/modeldefinition/parser/Converter.groovy",
            "pipeline-model-definition/src/test/java/org/jenkinsci/plugins/pipeline/modeldefinition/endpoints/ModelConverterActionTest.java||pipeline-model-definition/src/test/java/org/jenkinsci/plugins/pipeline/modeldefinition/endpoints/ModelConverterActionTest.java",
            "pipeline-model-definition/src/test/resources/localASTTransformInCompilation.groovy||pipeline-model-definition/src/test/resources/localASTTransformInCompilation.groovy"
          ]
        }
      },
      "candidate_diff": {
        "pipeline-model-definition/src/main/groovy/org/jenkinsci/plugins/pipeline/modeldefinition/parser/Converter.groovy||pipeline-model-definition/src/main/groovy/org/jenkinsci/plugins/pipeline/modeldefinition/parser/Converter.groovy": [
          "File: pipeline-model-definition/src/main/groovy/org/jenkinsci/plugins/pipeline/modeldefinition/parser/Converter.groovy -> pipeline-model-definition/src/main/groovy/org/jenkinsci/plugins/pipeline/modeldefinition/parser/Converter.groovy",
          "--- Hunk 1 ---",
          "[Context before]",
          "42: import org.jenkinsci.plugins.pipeline.modeldefinition.ast.ModelASTPipelineDef",
          "43: import org.jenkinsci.plugins.pipeline.modeldefinition.ast.ModelASTStep",
          "44: import org.jenkinsci.plugins.pipeline.modeldefinition.validator.DeclarativeValidatorContributor",
          "45: import org.jenkinsci.plugins.workflow.cps.CpsThread",
          "46: import org.jenkinsci.plugins.workflow.cps.GroovyShellDecorator",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "45: import org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.GroovySandbox",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "49: import java.security.cert.Certificate",
          "51: import static groovy.lang.GroovyShell.DEFAULT_CODE_BASE",
          "",
          "[Removed Lines]",
          "52: import static org.codehaus.groovy.control.Phases.CANONICALIZATION",
          "",
          "[Added Lines]",
          "53: import static org.codehaus.groovy.control.Phases.CONVERSION",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "133:     }",
          "135:     private static CompilerConfiguration makeCompilerConfiguration() {",
          "138:         ImportCustomizer ic = new ImportCustomizer()",
          "139:         ic.addStarImports(NonCPS.class.getPackage().getName())",
          "",
          "[Removed Lines]",
          "136:         CompilerConfiguration cc = new CompilerConfiguration()",
          "",
          "[Added Lines]",
          "137:         CompilerConfiguration cc = GroovySandbox.createBaseCompilerConfiguration()",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "166:                     model[0] = new ModelParser(source, enabledOptionalValidators).parse(true)",
          "167:                 }",
          "168:             }",
          "173:         return model[0]",
          "174:     }",
          "",
          "[Removed Lines]",
          "169:         }, CANONICALIZATION)",
          "171:         cu.compile(CANONICALIZATION)",
          "",
          "[Added Lines]",
          "170:         }, CONVERSION)",
          "172:         cu.compile(CONVERSION)",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "195:                     model[0] = new ModelParser(source, enabledOptionalValidators).parsePlainSteps(source.AST)",
          "196:                 }",
          "197:             }",
          "202:         return model[0]",
          "203:     }",
          "",
          "[Removed Lines]",
          "198:         }, CANONICALIZATION)",
          "200:         cu.compile(CANONICALIZATION)",
          "",
          "[Added Lines]",
          "199:         }, CONVERSION)",
          "201:         cu.compile(CONVERSION)",
          "",
          "---------------"
        ],
        "pipeline-model-definition/src/test/java/org/jenkinsci/plugins/pipeline/modeldefinition/endpoints/ModelConverterActionTest.java||pipeline-model-definition/src/test/java/org/jenkinsci/plugins/pipeline/modeldefinition/endpoints/ModelConverterActionTest.java": [
          "File: pipeline-model-definition/src/test/java/org/jenkinsci/plugins/pipeline/modeldefinition/endpoints/ModelConverterActionTest.java -> pipeline-model-definition/src/test/java/org/jenkinsci/plugins/pipeline/modeldefinition/endpoints/ModelConverterActionTest.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "33: import org.jenkinsci.plugins.pipeline.modeldefinition.model.BuildCondition;",
          "34: import org.jenkinsci.plugins.pipeline.modeldefinition.model.Tools;",
          "35: import org.junit.Test;",
          "36: import org.jvnet.hudson.test.JenkinsRule;",
          "38: import java.net.URL;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "36: import org.jvnet.hudson.test.Issue;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "41: import static org.junit.Assert.assertEquals;",
          "42: import static org.junit.Assert.assertNotNull;",
          "43: import static org.junit.Assert.assertTrue;",
          "45: public class ModelConverterActionTest extends AbstractModelDefTest {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "44: import static org.junit.Assert.assertNull;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "243:         assertTrue(\"Errors array (\" + topErrors.toString(2) + \") didn't contain expected error '\" + expectedError + \"'\",",
          "244:                 foundExpectedErrorInJSON(topErrors, expectedError));",
          "245:     }",
          "246: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "249:     @Issue(\"SECURITY-1266\")",
          "250:     @Test",
          "251:     public void testLocalASTTransformInCompilation() throws Exception {",
          "252:         final String rawJenkinsfile = fileContentsFromResources(\"localASTTransformInCompilation.groovy\", true);",
          "254:         if (rawJenkinsfile != null) {",
          "256:             JenkinsRule.WebClient wc = j.createWebClient();",
          "257:             WebRequest req = new WebRequest(new URL(wc.getContextPath() + ModelConverterAction.PIPELINE_CONVERTER_URL + \"/validateJenkinsfile\"), HttpMethod.POST);",
          "259:             assertNotNull(rawJenkinsfile);",
          "261:             NameValuePair pair = new NameValuePair(\"jenkinsfile\", rawJenkinsfile);",
          "262:             req.setRequestParameters(Collections.singletonList(pair));",
          "264:             String rawResult = wc.getPage(req).getWebResponse().getContentAsString();",
          "265:             assertNotNull(rawResult);",
          "267:             JSONObject result = JSONObject.fromObject(rawResult);",
          "269:             assertEquals(\"Full result doesn't include status - \" + result.toString(2), \"ok\", result.getString(\"status\"));",
          "270:             JSONObject resultData = result.getJSONObject(\"data\");",
          "271:             assertNotNull(resultData);",
          "272:             assertEquals(\"Result wasn't a failure - \" + result.toString(2), \"failure\", resultData.getString(\"result\"));",
          "274:             assertNull(j.jenkins.getItem(\"should-not-exist\"));",
          "275:         }",
          "276:     }",
          "",
          "---------------"
        ],
        "pipeline-model-definition/src/test/resources/localASTTransformInCompilation.groovy||pipeline-model-definition/src/test/resources/localASTTransformInCompilation.groovy": [
          "File: pipeline-model-definition/src/test/resources/localASTTransformInCompilation.groovy -> pipeline-model-definition/src/test/resources/localASTTransformInCompilation.groovy",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "25: import groovy.transform.*",
          "26: import jenkins.model.Jenkins",
          "27: import org.jenkinsci.plugins.workflow.job.WorkflowJob",
          "29: @ASTTest(value={ assert Jenkins.get().createProject(WorkflowJob.class, \"should-not-exist\") })",
          "30: @Field int x",
          "32: pipeline {",
          "33:     agent none",
          "34:     stages {",
          "35:         stage(\"foo\") {",
          "36:             steps {",
          "37:                 echo \"hello\"",
          "38:             }",
          "39:         }",
          "40:     }",
          "41: }",
          "",
          "---------------"
        ]
      }
    }
  ]
}