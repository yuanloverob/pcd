{
  "cve_id": "CVE-2024-12678",
  "cve_desc": "Nomad Community and Nomad Enterprise (\"Nomad\") allocations are vulnerable to privilege escalation within a namespace through unredacted workload identity tokens. This vulnerability, identified as CVE-2024-12678, is fixed in Nomad Community Edition 1.9.4 and Nomad Enterprise 1.9.4, 1.8.8, and 1.7.16.",
  "repo": "hashicorp/nomad",
  "patch_hash": "359a71861ef044cb5d749a36ff0e44b172c8f1a6",
  "patch_info": {
    "commit_hash": "359a71861ef044cb5d749a36ff0e44b172c8f1a6",
    "repo": "hashicorp/nomad",
    "commit_url": "https://github.com/hashicorp/nomad/commit/359a71861ef044cb5d749a36ff0e44b172c8f1a6",
    "files": [
      ".changelog/24683.txt",
      "command/agent/node_endpoint.go",
      "nomad/alloc_endpoint.go",
      "nomad/structs/structs.go"
    ],
    "message": "Backport of sec: fix alloc workload identity namespace permission into release/1.9.x (#24685)\n\nCo-authored-by: Deniz Onur Duzgun <59659739+dduzgun-security@users.noreply.github.com>",
    "before_after_code_files": [
      "command/agent/node_endpoint.go||command/agent/node_endpoint.go",
      "nomad/alloc_endpoint.go||nomad/alloc_endpoint.go",
      "nomad/structs/structs.go||nomad/structs/structs.go"
    ]
  },
  "patch_diff": {
    "command/agent/node_endpoint.go||command/agent/node_endpoint.go": [
      "File: command/agent/node_endpoint.go -> command/agent/node_endpoint.go",
      "--- Hunk 1 ---",
      "[Context before]",
      "105:   out.Allocs = make([]*structs.Allocation, 0)",
      "106:  }",
      "107:  for _, alloc := range out.Allocs {",
      "108:   alloc.SetEventDisplayMessages()",
      "109:  }",
      "110:  return out.Allocs, nil",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "108:   alloc = alloc.Sanitize()",
      "",
      "---------------"
    ],
    "nomad/alloc_endpoint.go||nomad/alloc_endpoint.go": [
      "File: nomad/alloc_endpoint.go -> nomad/alloc_endpoint.go",
      "--- Hunk 1 ---",
      "[Context before]",
      "172:    }",
      "176:    if out != nil {",
      "178:     if !aclObj.AllowClientOp() && !allowNsOp(aclObj, out.Namespace) {",
      "179:      return structs.NewErrUnknownAllocation(args.AllocID)",
      "",
      "[Removed Lines]",
      "175:    reply.Alloc = out",
      "",
      "[Added Lines]",
      "176:     out = out.Sanitize()",
      "177:     reply.Alloc = out",
      "",
      "---------------"
    ],
    "nomad/structs/structs.go||nomad/structs/structs.go": [
      "File: nomad/structs/structs.go -> nomad/structs/structs.go",
      "--- Hunk 1 ---",
      "[Context before]",
      "11199:  return a.ID",
      "11200: }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "11205: func (a *Allocation) Sanitize() *Allocation {",
      "11206:  if a == nil {",
      "11207:   return nil",
      "11208:  }",
      "11210:  if a.SignedIdentities == nil {",
      "11211:   return a",
      "11212:  }",
      "11214:  clean := a.Copy()",
      "11215:  clean.SignedIdentities = nil",
      "11216:  return clean",
      "11217: }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "c703cb8628f5a12d8a0cee31e095723627d1478b",
      "candidate_info": {
        "commit_hash": "c703cb8628f5a12d8a0cee31e095723627d1478b",
        "repo": "hashicorp/nomad",
        "commit_url": "https://github.com/hashicorp/nomad/commit/c703cb8628f5a12d8a0cee31e095723627d1478b",
        "files": [
          ".changelog/24162.txt",
          "ui/app/styles/components/variables.scss"
        ],
        "message": "backport of commit 1f9b92f07941e2896270e40cbe3da401ad8c5084 (#24253)\n\nCo-authored-by: Phil Renaud <phil.renaud@hashicorp.com>",
        "before_after_code_files": [
          "ui/app/styles/components/variables.scss||ui/app/styles/components/variables.scss"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/hashicorp/nomad/pull/25471"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "ui/app/styles/components/variables.scss||ui/app/styles/components/variables.scss": [
          "File: ui/app/styles/components/variables.scss -> ui/app/styles/components/variables.scss",
          "--- Hunk 1 ---",
          "[Context before]",
          "13: .variable-title {",
          "14:   margin-bottom: 2rem;",
          "15:   .hds-page-header__main {",
          "16:     flex-direction: unset;",
          "17:   }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "15:   z-index: $z-base;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "214d1886ebffecb8ce52e370cc8168f8e42cb53c",
      "candidate_info": {
        "commit_hash": "214d1886ebffecb8ce52e370cc8168f8e42cb53c",
        "repo": "hashicorp/nomad",
        "commit_url": "https://github.com/hashicorp/nomad/commit/214d1886ebffecb8ce52e370cc8168f8e42cb53c",
        "files": [
          "go.mod",
          "go.sum"
        ],
        "message": "backport of commit 13657e02dae2e536d2b510e62efdd26dc2d8f3df (#24460)\n\nCo-authored-by: Seth Hoenig <shoenig@duck.com>",
        "before_after_code_files": [
          "go.mod||go.mod",
          "go.sum||go.sum"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/hashicorp/nomad/pull/25471"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "go.mod||go.mod": [
          "File: go.mod -> go.mod",
          "--- Hunk 1 ---",
          "[Context before]",
          "120:  github.com/ryanuber/columnize v2.1.2+incompatible",
          "121:  github.com/ryanuber/go-glob v1.0.0",
          "122:  github.com/shirou/gopsutil/v3 v3.24.5",
          "124:  github.com/shoenig/go-m1cpu v0.1.6",
          "125:  github.com/shoenig/test v1.11.0",
          "126:  github.com/stretchr/testify v1.9.0",
          "",
          "[Removed Lines]",
          "123:  github.com/shoenig/go-landlock v1.2.1",
          "",
          "[Added Lines]",
          "123:  github.com/shoenig/go-landlock v1.2.2",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "131:  golang.org/x/crypto v0.27.0",
          "132:  golang.org/x/mod v0.21.0",
          "133:  golang.org/x/sync v0.8.0",
          "135:  golang.org/x/time v0.3.0",
          "136:  google.golang.org/grpc v1.59.0",
          "137:  google.golang.org/protobuf v1.34.2",
          "",
          "[Removed Lines]",
          "134:  golang.org/x/sys v0.26.0",
          "",
          "[Added Lines]",
          "134:  golang.org/x/sys v0.27.0",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "313:  gopkg.in/yaml.v2 v2.4.0 // indirect",
          "314:  gopkg.in/yaml.v3 v3.0.1 // indirect",
          "315:  gotest.tools/v3 v3.5.1 // indirect",
          "317: )",
          "",
          "[Removed Lines]",
          "316:  kernel.org/pub/linux/libs/security/libcap/psx v1.2.69 // indirect",
          "",
          "[Added Lines]",
          "316:  kernel.org/pub/linux/libs/security/libcap/psx v1.2.71 // indirect",
          "",
          "---------------"
        ],
        "go.sum||go.sum": [
          "File: go.sum -> go.sum",
          "--- Hunk 1 ---",
          "[Context before]",
          "1018: github.com/seccomp/libseccomp-golang v0.10.0/go.mod h1:JA8cRccbGaA1s33RQf7Y1+q9gHmZX1yB/z9WDN1C6fg=",
          "1019: github.com/shirou/gopsutil/v3 v3.24.5 h1:i0t8kL+kQTvpAYToeuiVk3TgDeKOFioZO3Ztz/iZ9pI=",
          "1020: github.com/shirou/gopsutil/v3 v3.24.5/go.mod h1:bsoOS1aStSs9ErQ1WWfxllSeS1K5D+U30r2NfcubMVk=",
          "1023: github.com/shoenig/go-m1cpu v0.1.6 h1:nxdKQNcEB6vzgA2E2bvzKIYRuNj7XNJ4S/aRSwKzFtM=",
          "1024: github.com/shoenig/go-m1cpu v0.1.6/go.mod h1:1JJMcUBvfNwpq05QDQVAnx3gUHr9IYF7GNg9SUEw2VQ=",
          "1025: github.com/shoenig/test v1.11.0 h1:NoPa5GIoBwuqzIviCrnUJa+t5Xb4xi5Z+zODJnIDsEQ=",
          "",
          "[Removed Lines]",
          "1021: github.com/shoenig/go-landlock v1.2.1 h1:3s88osJQX1AWpQ2DE2A0EWuQTzoeIF95uOC2oTDymn8=",
          "1022: github.com/shoenig/go-landlock v1.2.1/go.mod h1:p7huQuJHejPeOKTpjPCCV83+jiQMezZWZ0oqsM7Wb88=",
          "",
          "[Added Lines]",
          "1021: github.com/shoenig/go-landlock v1.2.2 h1:cIEdRXuHkzapHJGMBM+GpWdDlZU5MSJWaxxCri7hiI8=",
          "1022: github.com/shoenig/go-landlock v1.2.2/go.mod h1:MLSBZBAUvZh/4flRg+LysngJvz/0OdtpWTEAWuJViSY=",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1407: golang.org/x/sys v0.8.0/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=",
          "1408: golang.org/x/sys v0.11.0/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=",
          "1409: golang.org/x/sys v0.17.0/go.mod h1:/VUhepiaJMQUp4+oa/7Zr1D23ma6VTLIYjOOTFZPUcA=",
          "1412: golang.org/x/term v0.0.0-20201126162022-7de9c90e9dd1/go.mod h1:bj7SfCRtBDWHUb9snDiAeCFNEtKQo2Wmx5Cou7ajbmo=",
          "1413: golang.org/x/term v0.0.0-20210927222741-03fcf44c2211/go.mod h1:jbD1KX2456YbFQfuXm/mYQcufACuNUgVhRMnK/tPxf8=",
          "1414: golang.org/x/term v0.1.0/go.mod h1:jbD1KX2456YbFQfuXm/mYQcufACuNUgVhRMnK/tPxf8=",
          "",
          "[Removed Lines]",
          "1410: golang.org/x/sys v0.26.0 h1:KHjCJyddX0LoSTb3J+vWpupP9p0oznkqVk/IfjymZbo=",
          "1411: golang.org/x/sys v0.26.0/go.mod h1:/VUhepiaJMQUp4+oa/7Zr1D23ma6VTLIYjOOTFZPUcA=",
          "",
          "[Added Lines]",
          "1410: golang.org/x/sys v0.27.0 h1:wBqf8DvsY9Y/2P8gAfPDEYNuS30J4lPHJxXSb/nJZ+s=",
          "1411: golang.org/x/sys v0.27.0/go.mod h1:/VUhepiaJMQUp4+oa/7Zr1D23ma6VTLIYjOOTFZPUcA=",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1786: k8s.io/klog v1.0.0/go.mod h1:4Bi6QPql/J/LkTDqv7R/cd3hPo4k2DG6Ptcz060Ez5I=",
          "1787: k8s.io/kube-openapi v0.0.0-20200121204235-bf4fb3bd569c/go.mod h1:GRQhZsXIAJ1xR0C9bd8UpWHZ5plfAS9fzPjJuQ6JL3E=",
          "1788: k8s.io/utils v0.0.0-20200324210504-a9aa75ae1b89/go.mod h1:sZAwmy6armz5eXlNoLmJcl4F1QuKu7sr+mFQ0byX7Ew=",
          "1791: oss.indeed.com/go/libtime v1.6.0 h1:XQyczJihse/wQGo59OfPF3f4f+Sywv4R8vdGB3S9BfU=",
          "1792: oss.indeed.com/go/libtime v1.6.0/go.mod h1:B2sdEcuzB0zhTKkAuHy4JInKRc7Al3tME4qWam6R7mA=",
          "1793: rsc.io/binaryregexp v0.2.0/go.mod h1:qTv7/COck+e2FymRvadv62gMdZztPaShugOCi3I+8D8=",
          "",
          "[Removed Lines]",
          "1789: kernel.org/pub/linux/libs/security/libcap/psx v1.2.69 h1:IdrOs1ZgwGw5CI+BH6GgVVlOt+LAXoPyh7enr8lfaXs=",
          "1790: kernel.org/pub/linux/libs/security/libcap/psx v1.2.69/go.mod h1:+l6Ee2F59XiJ2I6WR5ObpC1utCQJZ/VLsEbQCD8RG24=",
          "",
          "[Added Lines]",
          "1789: kernel.org/pub/linux/libs/security/libcap/psx v1.2.71 h1:i19+O6oaKRqgflRO4o7WKdU8LJ7vKNSFLDDqHB6CvQ8=",
          "1790: kernel.org/pub/linux/libs/security/libcap/psx v1.2.71/go.mod h1:+l6Ee2F59XiJ2I6WR5ObpC1utCQJZ/VLsEbQCD8RG24=",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "4535d212c01a2042ea62ef34c1e49a4ac34ec71a",
      "candidate_info": {
        "commit_hash": "4535d212c01a2042ea62ef34c1e49a4ac34ec71a",
        "repo": "hashicorp/nomad",
        "commit_url": "https://github.com/hashicorp/nomad/commit/4535d212c01a2042ea62ef34c1e49a4ac34ec71a",
        "files": [
          "website/content/docs/devices/index.mdx",
          "website/content/docs/drivers/docker.mdx",
          "website/content/docs/drivers/exec.mdx",
          "website/content/docs/drivers/index.mdx",
          "website/content/docs/drivers/java.mdx",
          "website/content/docs/drivers/qemu.mdx",
          "website/content/docs/drivers/raw_exec.mdx",
          "website/content/docs/job-specification/device.mdx",
          "website/content/docs/partnerships.mdx",
          "website/content/docs/release-notes/nomad/v1_9_x.mdx",
          "website/content/intro/index.mdx",
          "website/content/partials/task-driver-intro.mdx",
          "website/content/plugins/devices/community/index.mdx",
          "website/content/plugins/devices/index.mdx",
          "website/content/plugins/devices/nvidia.mdx",
          "website/content/plugins/devices/usb.mdx",
          "website/content/plugins/drivers/community/containerd.mdx",
          "website/content/plugins/drivers/community/firecracker-task-driver.mdx",
          "website/content/plugins/drivers/community/iis.mdx",
          "website/content/plugins/drivers/community/index.mdx",
          "website/content/plugins/drivers/community/jail-task-driver.mdx",
          "website/content/plugins/drivers/community/lightrun.mdx",
          "website/content/plugins/drivers/community/nomad-iis.mdx",
          "website/content/plugins/drivers/community/nspawn.mdx",
          "website/content/plugins/drivers/community/pledge.mdx",
          "website/content/plugins/drivers/community/pot.mdx",
          "website/content/plugins/drivers/community/rookout.mdx",
          "website/content/plugins/drivers/community/singularity.mdx",
          "website/content/plugins/drivers/exec2.mdx",
          "website/content/plugins/drivers/index.mdx",
          "website/content/plugins/drivers/podman.mdx",
          "website/content/plugins/drivers/virt/client.mdx",
          "website/content/plugins/drivers/virt/index.mdx",
          "website/content/plugins/drivers/virt/install.mdx",
          "website/content/plugins/drivers/virt/installation.mdx",
          "website/content/plugins/drivers/virt/task-config.mdx",
          "website/content/plugins/index.mdx",
          "website/data/docs-nav-data.json",
          "website/data/plugins-nav-data.json",
          "website/redirects.js"
        ],
        "message": "backport of commit 8a597a172d8081ee386d81d1c15a9095f09cc584 (#25087)\n\nCo-authored-by: Aimee Ukasick <aimee.ukasick@hashicorp.com>",
        "before_after_code_files": [
          "website/content/intro/index.mdx||website/content/intro/index.mdx",
          "website/content/partials/task-driver-intro.mdx||website/content/partials/task-driver-intro.mdx",
          "website/content/plugins/devices/community/index.mdx||website/content/plugins/devices/community/index.mdx",
          "website/content/plugins/devices/index.mdx||website/content/plugins/devices/index.mdx",
          "website/content/plugins/devices/nvidia.mdx||website/content/plugins/devices/nvidia.mdx",
          "website/content/plugins/devices/community/usb.mdx||website/content/plugins/devices/usb.mdx",
          "website/content/plugins/drivers/community/containerd.mdx||website/content/plugins/drivers/community/containerd.mdx",
          "website/content/plugins/drivers/community/firecracker-task-driver.mdx||website/content/plugins/drivers/community/firecracker-task-driver.mdx",
          "website/content/plugins/drivers/community/iis.mdx||website/content/plugins/drivers/community/iis.mdx",
          "website/content/plugins/drivers/community/index.mdx||website/content/plugins/drivers/community/index.mdx",
          "website/content/plugins/drivers/community/jail-task-driver.mdx||website/content/plugins/drivers/community/jail-task-driver.mdx",
          "website/content/plugins/drivers/community/lightrun.mdx||website/content/plugins/drivers/community/lightrun.mdx",
          "website/content/plugins/drivers/community/nomad-iis.mdx||website/content/plugins/drivers/community/nomad-iis.mdx",
          "website/content/plugins/drivers/community/nspawn.mdx||website/content/plugins/drivers/community/nspawn.mdx",
          "website/content/plugins/drivers/community/pledge.mdx||website/content/plugins/drivers/community/pledge.mdx",
          "website/content/plugins/drivers/community/pot.mdx||website/content/plugins/drivers/community/pot.mdx",
          "website/content/plugins/drivers/community/rookout.mdx||website/content/plugins/drivers/community/rookout.mdx",
          "website/content/plugins/drivers/community/singularity.mdx||website/content/plugins/drivers/community/singularity.mdx",
          "website/content/plugins/drivers/exec2.mdx||website/content/plugins/drivers/exec2.mdx",
          "website/content/plugins/drivers/index.mdx||website/content/plugins/drivers/index.mdx",
          "website/content/plugins/drivers/podman.mdx||website/content/plugins/drivers/podman.mdx",
          "website/content/plugins/drivers/virt/client.mdx||website/content/plugins/drivers/virt/client.mdx",
          "website/content/plugins/drivers/virt/index.mdx||website/content/plugins/drivers/virt/index.mdx",
          "website/content/plugins/drivers/virt/install.mdx||website/content/plugins/drivers/virt/install.mdx",
          "website/content/plugins/drivers/virt/installation.mdx||website/content/plugins/drivers/virt/installation.mdx",
          "website/content/plugins/drivers/virt/task-config.mdx||website/content/plugins/drivers/virt/task-config.mdx",
          "website/content/plugins/index.mdx||website/content/plugins/index.mdx",
          "website/redirects.js||website/redirects.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/hashicorp/nomad/pull/25471"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "website/content/intro/index.mdx||website/content/intro/index.mdx": [
          "File: website/content/intro/index.mdx -> website/content/intro/index.mdx"
        ],
        "website/content/partials/task-driver-intro.mdx||website/content/partials/task-driver-intro.mdx": [
          "File: website/content/partials/task-driver-intro.mdx -> website/content/partials/task-driver-intro.mdx",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: ## Introduction",
          "3: Nomad clients use task drivers to execute a task and provide resource isolation.",
          "4: Extensible task drivers provide Nomad the flexibility to support a broad",
          "5: set of workloads across all major operating systems.",
          "7: Task driver resource isolation provides a degree of separation for Nomad's client",
          "8: CPU, memory, and storage between tasks. Resource isolation effectiveness depends",
          "9: upon individual task driver implementations and underlying client operating",
          "10: systems. Task drivers include various security-related controls, but do not",
          "11: use the Nomad client-to-task interface as a security boundary.",
          "12: Refer to the [access control guide][acl_guide] for more information on how to",
          "13: protect Nomad cluster operations.",
          "15: ## Configuration",
          "17: Refer to the [plugin block documentation][plugin] for examples on how to use the",
          "18: plugin block in Nomad's client configuration. Review the [Docker driver's client",
          "19: requirements section][docker_plugin] for a detailed example.",
          "21: ## Nomad task drivers",
          "23: The Nomad binary contains several bundled task drivers. We also support",
          "24: additional task driver plugins that you may install separately.",
          "26: | Bundled with Nomad   | Plugins               |",
          "27: |----------------------|-----------------------|",
          "28: | [Docker]             | [Exec2]               |",
          "29: | [Isolated Fork/Exec] | [Podman]              |",
          "30: | [Java]               | [Virt]                |",
          "31: | [QEMU]               |                       |",
          "32: | [Raw Fork/Exec]      |                       |",
          "34: Each task driver page documents the configuration available in a [job",
          "35: specification](/nomad/docs/job-specification), the environments you can use the",
          "36: task driver in, and the resource isolation mechanisms available.",
          "38: ## Community task drivers",
          "40: You may also use [community-supported task driver",
          "41: plugins](/nomad/plugins/drivers/community/).",
          "43: ## Create task drivers",
          "45: Nomad's task driver architecture is pluggable, which gives you the flexibility",
          "46: to create your own drivers without having to recompile Nomad. Refer to the",
          "47: [plugin authoring guide][plugin_guide] for details.",
          "50: [plugin]: /nomad/docs/configuration/plugin",
          "51: [docker_plugin]: /nomad/docs/drivers/docker#client-requirements",
          "52: [plugin_guide]: /nomad/docs/concepts/plugins/task-drivers",
          "53: [acl_guide]: /nomad/tutorials/access-control",
          "54: [Docker]: /nomad/docs/drivers/docker",
          "55: [Exec2]: /nomad/plugins/drivers/exec2",
          "56: [Isolated Fork/Exec]: /nomad/docs/drivers/exec",
          "57: [Podman]: /nomad/plugins/drivers/podman",
          "58: [Java]: /nomad/docs/drivers/java",
          "59: [Virt]: /nomad/plugins/drivers/virt/index",
          "60: [QEMU]: /nomad/docs/drivers/qemu",
          "61: [Raw Fork/Exec]: /nomad/docs/drivers/raw_exec",
          "",
          "---------------"
        ],
        "website/content/plugins/devices/community/index.mdx||website/content/plugins/devices/community/index.mdx": [
          "File: website/content/plugins/devices/community/index.mdx -> website/content/plugins/devices/community/index.mdx",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "website/content/plugins/devices/index.mdx||website/content/plugins/devices/index.mdx": [
          "File: website/content/plugins/devices/index.mdx -> website/content/plugins/devices/index.mdx",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: ---",
          "2: layout: docs",
          "5: ---",
          "",
          "[Removed Lines]",
          "3: page_title: 'Device Plugins: External'",
          "4: description: 'A list of external Device Plugins.'",
          "7: # External Device Plugins",
          "9: Nomad has a plugin system for defining task drivers. External device driver",
          "10: plugins will have the same user experience as built in devices.",
          "12: Below is a list of official external task drivers you can use with Nomad:",
          "14: - [Nvidia][nvidia]",
          "16: [plugin_guide]: /nomad/docs/concepts/plugins",
          "17: [nvidia]: /nomad/plugins/devices/nvidia",
          "",
          "[Added Lines]",
          "3: page_title: Nomad device driver plugins",
          "4: description: |-",
          "5:   Use device driver plugins to detect your Nomad client's physical hardware devices, such as graph processing units (GPUs), field programmable gate arrays (FPGAs), tensor processing units (TPUs), and universal serial buses (USBs). You can then use those devices in your Nomad workloads. Review conceptual, installation, usage, and reference information for the NVIDIA and USB device driver plugins.",
          "8: # Nomad device driver plugins",
          "10: Use device driver plugins to detect physical hardware devices, such as graph",
          "11: processing units (GPUs), a field-programmable gate arrays (FPGAs), and universal",
          "12: serial buses (USBs), on your Nomad clients. You can then use those devices in",
          "13: your Nomad workloads.",
          "15: By having extensible device plugins, Nomad has the flexibility",
          "16: to support a broad set of devices and allows the community to build additional",
          "17: device plugins as needed.",
          "19: ## Nomad device drivers",
          "21: We support the [NVIDIA] device driver plugin, which you must install",
          "22: separately. Refer to the [NVIDIA] documentation for instructions.",
          "24: ## Community Device Drivers",
          "26: The community supports the [USB] device driver plugin.",
          "28: ## Create device drivers",
          "30: Nomad's device driver architecture is pluggable, which gives you the flexibility",
          "31: to create your own drivers without having to recompile Nomad. Refer to the",
          "32: [plugin authoring guide][plugin_guide] for details.",
          "35: [NVIDIA]: /nomad/plugins/devices/nvidia",
          "36: [USB]: /nomad/plugins/devices/usb",
          "37: [plugin_guide]: /nomad/docs/concepts/plugins/devices",
          "",
          "---------------"
        ],
        "website/content/plugins/devices/nvidia.mdx||website/content/plugins/devices/nvidia.mdx": [
          "File: website/content/plugins/devices/nvidia.mdx -> website/content/plugins/devices/nvidia.mdx",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: ---",
          "2: layout: docs",
          "5: ---",
          "9: Name: `nomad-device-nvidia`",
          "14: The NVIDIA device plugin uses [NVML] bindings to get data regarding available",
          "15: NVIDIA devices and then exposes them via [Fingerprint RPC]. The plugin detects",
          "",
          "[Removed Lines]",
          "3: page_title: 'Device Plugins: Nvidia'",
          "4: description: The Nvidia Device Plugin detects and makes Nvidia devices available to tasks.",
          "7: # Nvidia GPU Device Plugin",
          "11: Use the NVIDIA device plugin to expose NVIDIA GPUs to Nomad. The driver",
          "12: automatically supports [Multi-Instance GPU (MIG)][mig].",
          "",
          "[Added Lines]",
          "3: page_title: NVIDIA GPU device plugin",
          "4: description: The NVIDIA GPU device plugin exposes NVIDIA GPUs to Nomad so you can run workloads on GPU hardware. Install and configure the plugin on your Nomad clients. Configure job tasks to use GPUs",
          "7: # NVIDIA GPU device plugin",
          "11: Use the NVIDIA device plugin to expose NVIDIA graphical processing units (GPUs)",
          "12: to Nomad. The driver automatically supports [Multi-Instance GPU (MIG)][mig].",
          "",
          "---------------"
        ],
        "website/content/plugins/devices/community/usb.mdx||website/content/plugins/devices/usb.mdx": [
          "File: website/content/plugins/devices/community/usb.mdx -> website/content/plugins/devices/usb.mdx",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: ---",
          "2: layout: docs",
          "5: ---",
          "9: Name: `usb`",
          "",
          "[Removed Lines]",
          "3: page_title: 'Devices: USB'",
          "4: description: The USB Device Plugin detects and makes USB devices available to tasks",
          "7: # USB Device Plugin",
          "",
          "[Added Lines]",
          "3: page_title: USB device plugin",
          "4: description: |-",
          "5:   The USB Device Plugin detects USB devices so you can use them in your Nomad workloads. Learn how to configure and install the plugin. Review the plugin's fingerprinted attributes and exposed runtime environment variables.",
          "8: # USB device plugin",
          "",
          "---------------"
        ],
        "website/content/plugins/drivers/community/containerd.mdx||website/content/plugins/drivers/community/containerd.mdx": [
          "File: website/content/plugins/drivers/community/containerd.mdx -> website/content/plugins/drivers/community/containerd.mdx",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: ---",
          "2: layout: docs",
          "4: description: >-",
          "7: ---",
          "11: Name: `containerd-driver`",
          "",
          "[Removed Lines]",
          "3: page_title: 'Drivers: nomad-driver-containerd'",
          "5:   The containerd driver is used",
          "6:   for launching containers using containerd.",
          "9: # containerd Task Driver",
          "",
          "[Added Lines]",
          "3: page_title: Task driver plugin for containerd",
          "5:   Use the community-supported containerd task driver to launch containerd containers in your Nomad job.",
          "8: # containerd Task Driver Plugin",
          "",
          "---------------"
        ],
        "website/content/plugins/drivers/community/firecracker-task-driver.mdx||website/content/plugins/drivers/community/firecracker-task-driver.mdx": [
          "File: website/content/plugins/drivers/community/firecracker-task-driver.mdx -> website/content/plugins/drivers/community/firecracker-task-driver.mdx",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: ---",
          "2: layout: docs",
          "4: description: >-",
          "7: ---",
          "11: Name: `firecracker-task-driver`",
          "14: For more detailed instructions on how to set up and use this driver, please",
          "15: refer to the [documentation][firecracker-task-guide].",
          "",
          "[Removed Lines]",
          "3: page_title: 'Drivers: firecracker-task-driver'",
          "5:   The Firecracker task driver is used to run",
          "6:   firecracker(https://firecracker-microvm.github.io/) microvms.",
          "9: # Firecracker task Driver",
          "13: The Firecracker task driver provides an interface for creating Linux microvms.",
          "",
          "[Added Lines]",
          "3: page_title: Firecracker task driver plugin",
          "5:   Use the community-supported Firecracker task driver to run Firecracker micro virtual machines in your Nomad job.",
          "8: # Firecracker task driver plugin",
          "12: The Firecracker task driver provides an interface for creating Linux microVMs.",
          "",
          "---------------"
        ],
        "website/content/plugins/drivers/community/iis.mdx||website/content/plugins/drivers/community/iis.mdx": [
          "File: website/content/plugins/drivers/community/iis.mdx -> website/content/plugins/drivers/community/iis.mdx",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: ---",
          "2: layout: docs",
          "4: description: >-",
          "7: ---",
          "11: Name: `win_iis`",
          "14: A \"website\" is a combination of an application pool and a site (app, vdir, etc.).",
          "15: Each allocation will create an application pool and site with the name being the allocation ID (guid).",
          "",
          "[Removed Lines]",
          "3: page_title: 'Drivers: nomad-driver-iis'",
          "5:   The IIS driver is used for running",
          "6:   Windows IIS services.",
          "9: # Windows IIS Driver",
          "13: The Nomad IIS driver provides an interface for running Windows IIS website tasks.",
          "",
          "[Added Lines]",
          "3: page_title: Windows IIS task driver plugin",
          "5:   Use the community-supported Windows IIS task driver (nomad-driver-iis) to run Windows IIS services in Nomad jobs.",
          "8: # Windows IIS task driver plugin",
          "12: The Nomad `win_iis` task driver provides an interface for running Windows IIS website tasks.",
          "",
          "---------------"
        ],
        "website/content/plugins/drivers/community/index.mdx||website/content/plugins/drivers/community/index.mdx": [
          "File: website/content/plugins/drivers/community/index.mdx -> website/content/plugins/drivers/community/index.mdx",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: ---",
          "2: layout: docs",
          "5: ---",
          "9: If you have authored a task driver plugin that you believe will be useful to the",
          "10: broader Nomad community and you are committed to maintaining the plugin, please",
          "",
          "[Removed Lines]",
          "3: page_title: 'Task Driver Plugins: Community Supported'",
          "4: description: A list of community supported Task Driver Plugins.",
          "7: # Community Supported",
          "",
          "[Added Lines]",
          "3: page_title: Community task driver plugins",
          "4: description: Learn about the community-supported task driver plugins that extend Nomad job features. Review installation, usage, and reference information for containerd, Firecracker, Jail, Pledge, Pot, Rookout, Singularity, system-nspawn, and Windows IIS task driver plugins.",
          "7: # Community task driver plugins",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "18: Nomad has a plugin system for defining task drivers. External task driver",
          "19: plugins will have the same user experience as built in drivers.",
          "23: - [containerd][nomad-driver-containerd]",
          "24: - [Firecracker][firecracker-task-driver]",
          "",
          "[Removed Lines]",
          "21: Below is a list of community-supported task drivers you can use with Nomad:",
          "",
          "[Added Lines]",
          "21: The following is a list of community-supported task drivers you can use with Nomad:",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "29: - [Rookout][rookout]",
          "30: - [Singularity][singularity]",
          "31: - [systemd-nspawn][nspawn-driver]",
          "35: [rookout]: /nomad/plugins/drivers/community/rookout",
          "36: [plugin_guide]: /nomad/docs/concepts/plugins",
          "",
          "[Removed Lines]",
          "32: - [Windows IIS][nomad-driver-iis]",
          "33: - [Windows IIS][nomad-iis]",
          "",
          "[Added Lines]",
          "32: - [Windows IIS (nomad-driver-iis)][nomad-driver-iis]",
          "33: - [Windows IIS (nomad-iis)][nomad-iis]",
          "",
          "---------------"
        ],
        "website/content/plugins/drivers/community/jail-task-driver.mdx||website/content/plugins/drivers/community/jail-task-driver.mdx": [
          "File: website/content/plugins/drivers/community/jail-task-driver.mdx -> website/content/plugins/drivers/community/jail-task-driver.mdx",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: ---",
          "2: layout: docs",
          "4: description: >-",
          "7: ---",
          "11: Name: `jail-task-driver`",
          "",
          "[Removed Lines]",
          "3: page_title: 'Drivers: jail-task-driver'",
          "5:   The Jail task driver is used to run application containers using FreeBSD",
          "6:   jails.",
          "9: # Jail task Driver",
          "",
          "[Added Lines]",
          "3: page_title: Jail task driver plugin",
          "5:   Use the community-supported Jail task driver to run application containers using FreeBSD jails in your Nomad jobs.",
          "8: # Jail task driver plugin",
          "",
          "---------------"
        ],
        "website/content/plugins/drivers/community/lightrun.mdx||website/content/plugins/drivers/community/lightrun.mdx": [
          "File: website/content/plugins/drivers/community/lightrun.mdx -> website/content/plugins/drivers/community/lightrun.mdx",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: ---",
          "2: layout: docs",
          "5: ---",
          "9: Name: `lightrun-java`",
          "",
          "[Removed Lines]",
          "3: page_title: 'Drivers: Lightrun'",
          "4: description: The Lightrun driver is used to run your Java application with Lightrun.",
          "7: # Lightrun Driver",
          "",
          "[Added Lines]",
          "3: page_title: Lightrun task driver plugin",
          "4: description: Use the community-supported Lightrun task driver to run your Java application with Lightrun in your Nomad jobs.",
          "7: # Lightrun task driver plugin",
          "",
          "---------------"
        ],
        "website/content/plugins/drivers/community/nomad-iis.mdx||website/content/plugins/drivers/community/nomad-iis.mdx": [
          "File: website/content/plugins/drivers/community/nomad-iis.mdx -> website/content/plugins/drivers/community/nomad-iis.mdx",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: ---",
          "2: layout: docs",
          "4: description: >-",
          "7: ---",
          "11: Name: `nomad_iis`",
          "14: For a full documentation please refer to the project's [Readme](https://github.com/sevensolutions/nomad-iis/blob/main/README.md).",
          "16: Unlike most other Nomad task drivers, this one is written in the C# language using ASP.NET. It uses the Microsoft.Web.Administration-API to communicate with IIS.",
          "",
          "[Removed Lines]",
          "3: page_title: 'Drivers: nomad-iis'",
          "5:   The IIS driver is used for running",
          "6:   Windows IIS services.",
          "9: # Windows IIS Driver",
          "13: This plugin is a task driver to run IIS Web Applications on Windows Servers. Each allocation will create an AppPool and a Website.",
          "",
          "[Added Lines]",
          "3: page_title: Nomad IIS task driver plugin",
          "5:   Use the community-supported Nomad IIS driver to run Windows IIS services in Nomad jobs.",
          "8: # Nomad IIS task driver plugin",
          "12: The `nomad_iis` plugin is a task driver to run IIS Web Applications on Windows Servers. Each allocation will create an AppPool and a Website.",
          "",
          "---------------"
        ],
        "website/content/plugins/drivers/community/nspawn.mdx||website/content/plugins/drivers/community/nspawn.mdx": [
          "File: website/content/plugins/drivers/community/nspawn.mdx -> website/content/plugins/drivers/community/nspawn.mdx",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: ---",
          "2: layout: docs",
          "5: ---",
          "9: Name: `nspawn`",
          "11: The `nspawn` driver provides an interface for using systemd-nspawn for running",
          "16: ## Task Configuration",
          "",
          "[Removed Lines]",
          "3: page_title: 'Drivers: systemd-nspawn'",
          "4: description: The nspawn task driver is used to run application containers using systemd-nspawn.",
          "7: # nspawn Driver",
          "12: application containers. You can download the external systemd-nspawn driver",
          "13: [here][nspawn-driver]. For more detailed instructions on how to set up and use",
          "14: this driver, please refer to the [guide][nspawn-guide].",
          "",
          "[Added Lines]",
          "3: page_title: Task driver plugin for nspawn",
          "4: description: Use the community-supported nspawn task driver to run application containers using systemd-nspawn in Nomad jobs.",
          "7: # nspawn Task Driver Plugin",
          "12: application containers. You can download the external nspawn driver from the",
          "13: [nomad-driver-nspawn releases page][nspawn-driver]. For more detailed instructions on how to set up and use",
          "14: this driver, please refer to the [examples in the nomad-driver-nspawn repository][nspawn-guide].",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "195: - `driver.nspawn.version` - Version of `systemd-nspawn` e.g.: `244`.",
          "197: [nspawn-driver]: https://github.com/JanMa/nomad-driver-nspawn/releases",
          "199: [plugin]: /nomad/docs/configuration/plugin",
          "200: [plugin_dir]: /nomad/docs/configuration#plugin_dir",
          "201: [plugin-options]: #plugin-options",
          "",
          "[Removed Lines]",
          "198: [nspawn-guide]: https://github.com/JanMa/nomad-driver-nspawn",
          "",
          "[Added Lines]",
          "198: [nspawn-guide]: https://github.com/JanMa/nomad-driver-nspawn/tree/master/example",
          "",
          "---------------"
        ],
        "website/content/plugins/drivers/community/pledge.mdx||website/content/plugins/drivers/community/pledge.mdx": [
          "File: website/content/plugins/drivers/community/pledge.mdx -> website/content/plugins/drivers/community/pledge.mdx",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: ---",
          "2: layout: docs",
          "5: ---",
          "9: Name: `pledge`",
          "",
          "[Removed Lines]",
          "3: page_title: 'Drivers: Pledge'",
          "4: description: The Pledge task driver is capable of blocking unwanted syscall and filesystem access.",
          "7: # Pledge Driver",
          "",
          "[Added Lines]",
          "3: page_title: Pledge task driver plugin",
          "4: description: Use the community-supported Pledge task driver to block unwanted syscall and filesystem access in Nomad jobs.",
          "7: # Pledge task driver plugin",
          "",
          "---------------"
        ],
        "website/content/plugins/drivers/community/pot.mdx||website/content/plugins/drivers/community/pot.mdx": [
          "File: website/content/plugins/drivers/community/pot.mdx -> website/content/plugins/drivers/community/pot.mdx",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: ---",
          "2: layout: docs",
          "4: description: >-",
          "7: ---",
          "11: Name: `pot`",
          "13: The Pot task driver provides an interface for using [pot][pot-github-repo] for dynamically running applications inside a FreeBSD Jail.",
          "16: ## Task Configuration",
          "",
          "[Removed Lines]",
          "3: page_title: 'Drivers: pot'",
          "5:   The Pot task driver is used to run pot (https://github.com/pizzamig/pot)",
          "6:   containers using FreeBSD jails.",
          "9: # Pot Task Driver",
          "14: You can download the external nomad-pot-driver [here][nomad-pot-driver].",
          "",
          "[Added Lines]",
          "3: page_title: Pot task driver plugin",
          "5:   Use the community-supported Pot task driver to run pot containers inside a  FreeBSD Jail in Nomad jobs.",
          "8: # Pot task driver plugin",
          "13: Download the external nomad-pot-driver from its [releases page][nomad-pot-driver].",
          "",
          "---------------"
        ],
        "website/content/plugins/drivers/community/rookout.mdx||website/content/plugins/drivers/community/rookout.mdx": [
          "File: website/content/plugins/drivers/community/rookout.mdx -> website/content/plugins/drivers/community/rookout.mdx",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: ---",
          "2: layout: docs",
          "5: ---",
          "9: Name: `java-rookout`",
          "",
          "[Removed Lines]",
          "3: page_title: 'Drivers: Rookout'",
          "4: description: The Rookout driver is used to run your Java app with Rookout.",
          "7: # Rookout Driver",
          "",
          "[Added Lines]",
          "3: page_title: Rookout task driver plugin",
          "4: description: Use the community-supported Rookout task driver to run your Java application with Rookout in Nomad jobs.",
          "7: # Rookout task driver plugin",
          "",
          "---------------"
        ],
        "website/content/plugins/drivers/community/singularity.mdx||website/content/plugins/drivers/community/singularity.mdx": [
          "File: website/content/plugins/drivers/community/singularity.mdx -> website/content/plugins/drivers/community/singularity.mdx",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: ---",
          "2: layout: docs",
          "4: description: >-",
          "7: ---",
          "11: Name: `Singularity`",
          "13: The `Singularity` driver provides an interface for using Singularity for running application",
          "16: ## Task Configuration",
          "",
          "[Removed Lines]",
          "3: page_title: 'Drivers: Singularity'",
          "5:   The Singularity task driver is used to run application containers using",
          "6:   Singularity.",
          "9: # Singularity Driver",
          "14: containers. You can download the external Singularity driver [here][singularity-driver].",
          "",
          "[Added Lines]",
          "3: page_title: Singularity task driver plugin",
          "5:   Use the community-supported Singularity task driver to run application containers using Singularity in Nomad jobs.",
          "8: # Singularity task driver plugin",
          "13: containers. Download the external Singularity driver from its [releases page][singularity-driver].",
          "",
          "---------------"
        ],
        "website/content/plugins/drivers/exec2.mdx||website/content/plugins/drivers/exec2.mdx": [
          "File: website/content/plugins/drivers/exec2.mdx -> website/content/plugins/drivers/exec2.mdx",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: ---",
          "2: layout: docs",
          "4: description: >-",
          "6: ---",
          "10: Name: `exec2`",
          "",
          "[Removed Lines]",
          "3: page_title: 'Drivers: exec2'",
          "5:   The exec2 task driver leverages modern kernel features for constraining tasks.",
          "8: # Exec2 Task Driver",
          "",
          "[Added Lines]",
          "3: page_title: Exec2 task driver plugin",
          "5:   The Exec2 task driver executes a command for a job task and leverages Linux kernel features such as Landlock LSM, cgroups v2, and the `unshare` system utility. Learn how to configure and install the Exec2 task driver plugin. Review capabilities, client requirements, and concepts such as filesystem and resource isolation. Learn how to use the Exec2 task driver in your Nomad job. Configure command, command args, paths, memory, CPU resources, and out-of-memory (OOM) behavior.",
          "8: # Exec2 task driver plugin",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "15: driver leverages kernel features such as the [Landlock LSM][landlock], cgroups",
          "16: v2, and the [`unshare`][unshare] system utility.",
          "20: ## Installation",
          "",
          "[Removed Lines]",
          "18: Source is on [GitHub][github]",
          "",
          "[Added Lines]",
          "18: Review the source on [GitHub][github].",
          "",
          "---------------"
        ],
        "website/content/plugins/drivers/index.mdx||website/content/plugins/drivers/index.mdx": [
          "File: website/content/plugins/drivers/index.mdx -> website/content/plugins/drivers/index.mdx",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: ---",
          "2: layout: docs",
          "5: ---",
          "",
          "[Removed Lines]",
          "3: page_title: Task Drivers",
          "4: description: Task Drivers are used to integrate with the host OS to run tasks in Nomad.",
          "7: # Task Drivers",
          "9: Task drivers are used by Nomad clients to execute a task and provide resource",
          "10: isolation. By having extensible task drivers, Nomad has the flexibility to",
          "11: support a broad set of workloads across all major operating systems.",
          "13: Task drivers are pluggable. This gives you the flexibility to introduce your",
          "14: own drivers without having to recompile Nomad. You can view the",
          "15: [plugin block][plugin] documentation for examples on how to use the plugin",
          "16: block in Nomad's client configuration. See the Docker driver's",
          "17: [Client Requirements][docker_plugin] for a more detailed and specific example.",
          "19: The Nomad binary includes the default task drivers, so you do not have to",
          "20: download them separately.",
          "22: The list of supported task drivers is provided on the left of this page. Each",
          "23: task driver documents the configuration available in a [job",
          "24: specification](/nomad/docs/job-specification), the environments it can be",
          "25: used in, and the resource isolation mechanisms available.",
          "27: For details on authoring a task driver plugin, please refer to the [plugin",
          "28: authoring guide][plugin_guide].",
          "30: Task driver resource isolation is intended to provide a degree of separation of",
          "31: Nomad client CPU / memory / storage between tasks. Resource isolation",
          "32: effectiveness is dependent upon individual task driver implementations and",
          "33: underlying client operating systems. Task drivers do include various",
          "34: security-related controls, but the Nomad client to task interface should not be",
          "35: considered a security boundary. See the [access control guide][acl_guide] for",
          "36: more information on how to protect Nomad cluster operations.",
          "38: [plugin]: /nomad/docs/configuration/plugin",
          "39: [docker_plugin]: /nomad/docs/drivers/docker#client-requirements",
          "40: [plugin_guide]: /nomad/docs/concepts/plugins",
          "41: [acl_guide]: /nomad/tutorials/access-control",
          "",
          "[Added Lines]",
          "3: page_title: Task driver plugins",
          "4: description: Task driver plugins extend Nomad functionality to provide resource isolation when executing job tasks. Review the Exec2, Podman, and Virt task driver reference. Explore plugins developed by the Nomad user community.",
          "7: # Task driver plugins",
          "9: This section provides reference information for task driver plugins.",
          "11: @include 'task-driver-intro.mdx'",
          "",
          "---------------"
        ],
        "website/content/plugins/drivers/podman.mdx||website/content/plugins/drivers/podman.mdx": [
          "File: website/content/plugins/drivers/podman.mdx -> website/content/plugins/drivers/podman.mdx",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: ---",
          "2: layout: docs",
          "4: description: >-",
          "7: ---",
          "11: Name: `podman`",
          "",
          "[Removed Lines]",
          "3: page_title: 'Drivers: podman'",
          "5:   The Podman task driver uses podman (https://podman.io/) for containerizing",
          "6:   tasks.",
          "9: # Podman Task Driver",
          "",
          "[Added Lines]",
          "3: page_title: Podman task driver plugin",
          "5:   The Podman task driver plugin uses the Pod Manager daemonless container runtime to execute Nomad workload tasks. Learn how to configure and install the Podman task driver plugin. Review capabilities, client requirements, plugin options, and network configuration. Learn how to use the Podman task driver in your Nomad job. Configure image registry authentication, Linux capabilities, host devices, entrypoint, paths, image, labels, logging, memory, network mode, ports, volumes, working directory, and container privileges.",
          "8: # Podman task driver plugin",
          "",
          "---------------"
        ],
        "website/content/plugins/drivers/virt/client.mdx||website/content/plugins/drivers/virt/client.mdx": [
          "File: website/content/plugins/drivers/virt/client.mdx -> website/content/plugins/drivers/virt/client.mdx",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "website/content/plugins/drivers/virt/index.mdx||website/content/plugins/drivers/virt/index.mdx": [
          "File: website/content/plugins/drivers/virt/index.mdx -> website/content/plugins/drivers/virt/index.mdx",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: ---",
          "2: layout: docs",
          "4: description: >-",
          "7: ---",
          "11: @include 'virt-beta-callout.mdx'",
          "13: Name: `virt`",
          "20: [libvirt]: https://libvirt.org/",
          "",
          "[Removed Lines]",
          "3: page_title: 'Drivers: virt'",
          "5:   The virt task driver leverages Linux capabilities and libvirt to run virtual",
          "6:   machines.",
          "9: # Virt task driver",
          "15: The `virt` driver utilises the [libvirt][] API to run and manage virtual machines (VMs) via",
          "16: hypervisors such as [QEMU][]. It supports a wide variety of Nomad features including",
          "17: [workload identity][], [task templates][], and [service discovery][].",
          "",
          "[Added Lines]",
          "3: page_title: Virt task driver plugin",
          "5:   The Virt task driver leverages Linux capabilities and runs virtual machines using the libvirt API and hypervisors such as QEMU. Learn about Nomad client requirements, installation, capabilities, and Nomad client node attributes.",
          "8: # Virt task driver plugin",
          "14: The Virt task driver utilizes the [libvirt][] API to run and manage virtual",
          "15: machines using hypervisors such as [QEMU][]. The task driver supports a wide",
          "16: variety of Nomad features including [workload identity][], [task templates][],",
          "17: and [service discovery][].",
          "19: ## Driver Capabilities",
          "21: The Virt task driver implements these driver [capabilities][capabilities].",
          "23: | Feature              | Implementation |",
          "24: |----------------------|----------------|",
          "25: | `nomad alloc signal` | false          |",
          "26: | `nomad alloc exec`   | false          |",
          "27: | filesystem isolation | image          |",
          "28: | network isolation    | host           |",
          "29: | volume mounting      | false          |",
          "31: ## Nomad Client Node Attributes",
          "33: The Virt task driver provides these node attributes that you can use as",
          "34: constraints when authoring jobs.",
          "36: ```",
          "37: driver.virt                              = true",
          "38: driver.virt.active                       = 0",
          "39: driver.virt.emulator.version             = 8002002",
          "40: driver.virt.inactive                     = 0bytes",
          "41: driver.virt.libvirt.version              = 10000000",
          "42: driver.virt.network.default.bridge_name  = virbr0",
          "43: driver.virt.network.default.state        = active",
          "44: ```",
          "46: ## Reference",
          "48: - [Install and configure the Virt task driver][install].",
          "49: - [Configure a virt task in your job specification][task-config].",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "23: [task templates]: https://developer.hashicorp.com/nomad/docs/job-specification/template",
          "24: [service discovery]: https://developer.hashicorp.com/nomad/docs/networking/service-discovery",
          "25: [github]: https://github.com/hashicorp/nomad-driver-virt",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "58: [capabilities]: /nomad/docs/concepts/plugins/task-drivers#task-driver-plugin-api",
          "59: [install]: /nomad/plugins/drivers/virt/install",
          "60: [task-config]: /nomad/plugins/drivers/virt/task-config",
          "",
          "---------------"
        ],
        "website/content/plugins/drivers/virt/install.mdx||website/content/plugins/drivers/virt/install.mdx": [
          "File: website/content/plugins/drivers/virt/install.mdx -> website/content/plugins/drivers/virt/install.mdx",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: ---",
          "2: layout: docs",
          "3: page_title: Install the Virt task driver plugin",
          "4: description: >-",
          "5:   Install and configure the Virt task driver plugin on your Nomad clients. Review manual instructions and those for Ubuntu, Debian, CentOS, and RHEL. Add the Virt task driver plugin to Nomad.",
          "6: ---",
          "8: # Install the Virt task driver plugin",
          "10: @include 'virt-beta-callout.mdx'",
          "12: The Virt task driver plugin for Linux operating systems is not bundled with",
          "13: Nomad. You must install the driver into each Nomad client's [configured plugin",
          "14: directory][plugin_dir].",
          "16: ## Prerequisites",
          "18: Your Nomad client must meet these requirements:",
          "20: - Run as root.",
          "21: - Able to run hardware-accelerated KVM virtual machines. Run the [kvm-ok][]",
          "22:   command to verify your client capabilities.",
          "24: The Virt driver requires the following packages:",
          "26: - bridge-utils",
          "27: - cloudinit",
          "28: - dnsmasq",
          "29: - iptables",
          "30: - [libvirt daemon][]",
          "31: - [QEMU][]",
          "33: ## Install the Virt task driver plugin",
          "35: <Tabs>",
          "36: <Tab heading=\"Manual installation\" group=\"manual\">",
          "38: Download a [precompiled binary][releases] and verify the binary using the",
          "39: available SHA-256 sums. Unzip the package. Make sure that the",
          "40: `nomad-driver-virt` binary is on your",
          "41: [plugin_dir] path, specified by the",
          "42: client's config file, before continuing with the other guides.",
          "44: </Tab>",
          "45: <Tab heading=\"Ubuntu/Debian\" group=\"manual\">",
          "47: Install the required packages.",
          "49: ```shell-session",
          "50: $ sudo apt-get update && \\",
          "51:   sudo apt-get install -y \\",
          "52:   wget \\",
          "53:   gpg \\",
          "54:   coreutils \\",
          "55:   bridge-utils \\",
          "56:   cloud-init \\",
          "57:   dnsmasq \\",
          "58:   iptables \\",
          "59:   libvirt-daemon-system \\",
          "60:   qemu-system \\",
          "61:   qemu-system-x86 \\",
          "62:   qemu-utils",
          "63: ```",
          "65: Add the HashiCorp [GPG key][gpg-key].",
          "67: ```shell-session",
          "68: $ wget -O- https://apt.releases.hashicorp.com/gpg | sudo gpg --dearmor -o /usr/share/keyrings/hashicorp-archive-keyring.gpg",
          "69: ```",
          "71: Add the official HashiCorp Linux test repository.",
          "73: ```shell-session",
          "74: $ echo \"deb [signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] https://apt.releases.hashicorp.com $(lsb_release -cs) test\" | sudo tee /etc/apt/sources.list.d/hashicorp.list",
          "75: ```",
          "77: Update and install.",
          "79: ```shell-session",
          "80: $ sudo apt-get update && sudo apt-get install nomad-driver-virt",
          "81: ```",
          "83: </Tab>",
          "84: <Tab heading=\"CentOS/RHEL\" group=\"linux\">",
          "86: Install `yum-config-manager` to manage your repositories.",
          "88: ```shell-session",
          "89: $ sudo yum install -y yum-utils",
          "90: ```",
          "92: Use `yum-config-manager` to add the official HashiCorp Linux repository.",
          "94: ```shell-session",
          "95: $ sudo yum-config-manager --add-repo https://rpm.releases.hashicorp.com/RHEL/hashicorp.repo",
          "96: ```",
          "98: Edit the repo file at `/etc/yum.repos.d/hashicorp.repo` and set `enabled=1` for `[hashicorp-test]`.",
          "100: Install.",
          "102: ```shell-session",
          "103: $ sudo yum -y install nomad-driver-virt",
          "104: ```",
          "106: </Tab>",
          "107: </Tabs>",
          "109: ## Add the Virt task driver plugin to Nomad",
          "111: This example shows the default plugin configuration.",
          "113: ```hcl",
          "114: plugin \"nomad-driver-driver\" {",
          "115:   config {",
          "116:     data_dir     = \"/var/lib/virt\"",
          "117:     image_paths  = [\"/var/lib/virt\", \"${ALLOC_DIR}\"]",
          "119:     emulator {",
          "120:       uri      = \"qemu:///system\"",
          "121:       user     = \"\"",
          "122:       password = \"\"",
          "123:     }",
          "124:   }",
          "125: }",
          "126: ```",
          "128: - `data_dir` - (default: `\"/var/lib/virt\"`) - the directory for storing VM configuration files and",
          "129:   intermediate files.",
          "131: - `image_paths` - (default: `[\"/var/lib/virt\", \"${ALLOC_DIR}\"]`) - an allow-list of paths the driver",
          "132:   is allowed to load an image from.",
          "134: - `emulator` - (block)",
          "135:   - `uri` - (default: `\"qemu:///system\"`) - The `uri` specifies which hypervisor to connect to.",
          "136:   - `user` - (default: `\"\"`) - the username to use for authentication.",
          "137:   - `password` - (default: `\"\"`) - the password to use for authentication.",
          "139: ## Next steps",
          "141: [Learn how to use the Virt task driver in your Nomad job specification][task-config].",
          "143: [releases]: https://releases.hashicorp.com/nomad-driver-virt",
          "144: [kvm-ok]: https://manpages.ubuntu.com/manpages/bionic/man1/kvm-ok.1.html",
          "145: [libvirt daemon]: https://libvirt.org/daemons.html",
          "146: [QEMU]: https://www.qemu.org/",
          "147: [task-config]: /nomad/plugins/drivers/virt/task-config",
          "148: [plugin_dir]: /nomad/docs/configuration#plugin_dir",
          "",
          "---------------"
        ],
        "website/content/plugins/drivers/virt/installation.mdx||website/content/plugins/drivers/virt/installation.mdx": [
          "File: website/content/plugins/drivers/virt/installation.mdx -> website/content/plugins/drivers/virt/installation.mdx",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "website/content/plugins/drivers/virt/task-config.mdx||website/content/plugins/drivers/virt/task-config.mdx": [
          "File: website/content/plugins/drivers/virt/task-config.mdx -> website/content/plugins/drivers/virt/task-config.mdx",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: ---",
          "2: layout: docs",
          "5: ---",
          "9: @include 'virt-beta-callout.mdx'",
          "12: well as other parameters required for bootstrapping a VM instance.",
          "14: - `image` - (string: required) - Path to an `.img` cloud image to base the VM disk on. The image should",
          "",
          "[Removed Lines]",
          "3: page_title: Task Config",
          "4: description: Configure the virt task driver job specification parameters.",
          "7: # Task configuration",
          "11: Task configuration for an virt task includes setting an `image` to provide the base VM image as",
          "",
          "[Added Lines]",
          "3: page_title: Configure a Virt job task",
          "4: description: Learn how to use the Virt task driver in your Nomad job specification. Configure a base virtual machine (VM) image, network interface,  and parameters for bootstrapping the VM instance.",
          "7: # Configure a Virt job task",
          "11: ## Parameters",
          "13: Task configuration for a virt task includes setting an `image` to provide the base VM image as",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "50: }",
          "51: ```",
          "55: The VM architecture and machine can be different from the client host. When this is the case, you must set the",
          "56: `os` block. By default, this information matches the client host where the driver",
          "",
          "[Removed Lines]",
          "53: ##### os",
          "",
          "[Added Lines]",
          "55: ### os",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "70: }",
          "71: ```",
          "75: You need to attach tasks to a libvirt network in order to access the internet and route",
          "76: from the local network. The `network_interface` block enables this as a list of network interfaces",
          "",
          "[Removed Lines]",
          "73: ##### network_interface",
          "",
          "[Added Lines]",
          "75: ### network_interface",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "97: }",
          "98: ```",
          "102: The following job specification displays use of all the configuration options, as well as other",
          "103: blocks that are useful when deploying tasks via the virt driver. You need to modify parameters, such as the",
          "",
          "[Removed Lines]",
          "100: ### Full example",
          "",
          "[Added Lines]",
          "102: ## Example configuration",
          "",
          "---------------"
        ],
        "website/content/plugins/index.mdx||website/content/plugins/index.mdx": [
          "File: website/content/plugins/index.mdx -> website/content/plugins/index.mdx",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: ---",
          "2: layout: docs",
          "5: ---",
          "9: Nomad implements a plugin framework which allows users to extend the",
          "10: functionality of some components within Nomad. The design of the plugin system",
          "",
          "[Removed Lines]",
          "3: page_title: Plugins",
          "4: description: Learn about task driver and device plugins for Nomad.",
          "7: # Plugins",
          "",
          "[Added Lines]",
          "3: page_title: Nomad plugins",
          "4: description: Plugins extend Nomad's functionality. Device plugins detect hardware such as USBs and NVIDIA GPU. Task driver plugins provide specific resource isolation when executing workloads. Review configuration, installation, usage, and reference information for the NVIDIA GPU and USB device plugins, and the Exec2, Podman, and Virt task drivers.",
          "7: # Nomad plugins",
          "",
          "---------------"
        ],
        "website/redirects.js||website/redirects.js": [
          "File: website/redirects.js -> website/redirects.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "65:   },",
          "66:   {",
          "67:     source: '/nomad/tools/autoscaling/concepts/node-selector-strategy',",
          "69:     permanent: true,",
          "70:   },",
          "72:   {",
          "73:     source: '/nomad/docs/integrations/vault-integration',",
          "74:     destination: '/nomad/docs/integrations/vault',",
          "",
          "[Removed Lines]",
          "68:     destination: '/nomad/tools/autoscaling/concepts/policy-eval/node-selector-strategy',",
          "",
          "[Added Lines]",
          "67:     destination:",
          "68:       '/nomad/tools/autoscaling/concepts/policy-eval/node-selector-strategy',",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "89:     destination: '/nomad/tools/autoscaling/agent/policy',",
          "90:     permanent: true,",
          "91:   },",
          "93:   {",
          "94:     source: '/nomad/plugins/drivers/remote/:slug*',",
          "95:     destination: 'nomad/plugins/drivers/',",
          "96:     permanent: true,",
          "97:   },",
          "99:   {",
          "100:     source: '/nomad/plugins/drivers/community/lxc',",
          "101:     destination: '/nomad/plugins/drivers/community/',",
          "102:     permanent: true,",
          "103:   },",
          "104: ]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "101:   {",
          "102:     source: '/nomad/plugins/drivers/virt/client',",
          "103:     destination: '/nomad/plugins/drivers/virt/install',",
          "104:     permanent: true,",
          "105:   },",
          "106:   {",
          "107:     source: '/nomad/plugins/drivers/virt/installation',",
          "108:     destination: '/nomad/plugins/drivers/virt/install',",
          "109:     permanent: true,",
          "110:   },",
          "111:   {",
          "112:     source: '/nomad/docs/devices',",
          "113:     destination: '/nomad/plugins/devices/',",
          "114:     permanent: true,",
          "115:   },",
          "116:   {",
          "117:     source: '/nomad/plugins/devices/community',",
          "118:     destination: '/nomad/plugins/devices/',",
          "119:     permanent: true,",
          "120:   },",
          "121:   {",
          "122:     source: '/nomad/plugins/devices/community/usb',",
          "123:     destination: '/nomad/plugins/devices/usb',",
          "124:     permanent: true,",
          "125:   },",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "14dd9e9fda7a81d47acb207a7fff0f10619f9e22",
      "candidate_info": {
        "commit_hash": "14dd9e9fda7a81d47acb207a7fff0f10619f9e22",
        "repo": "hashicorp/nomad",
        "commit_url": "https://github.com/hashicorp/nomad/commit/14dd9e9fda7a81d47acb207a7fff0f10619f9e22",
        "files": [
          "nomad/acl_endpoint.go",
          "website/content/api-docs/task-api.mdx",
          "website/content/docs/concepts/acl/auth-methods/jwt.mdx",
          "website/content/docs/concepts/acl/auth-methods/oidc.mdx",
          "website/content/docs/concepts/acl/index.mdx",
          "website/content/docs/concepts/architecture/federation.mdx",
          "website/content/partials/jwt_claim_mapping_details.mdx",
          "website/data/docs-nav-data.json"
        ],
        "message": "backport of commit ae21ae54a767f3f51486a50ce8bf4e44748c779a (#25150)\n\nCo-authored-by: Michael Smithhisler <michael.smithhisler@hashicorp.com>",
        "before_after_code_files": [
          "nomad/acl_endpoint.go||nomad/acl_endpoint.go",
          "website/content/api-docs/task-api.mdx||website/content/api-docs/task-api.mdx",
          "website/content/partials/jwt_claim_mapping_details.mdx||website/content/partials/jwt_claim_mapping_details.mdx"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/hashicorp/nomad/pull/25471"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "nomad/acl_endpoint.go||nomad/acl_endpoint.go": [
          "File: nomad/acl_endpoint.go -> nomad/acl_endpoint.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "2793:   internalClaimBytes, err := json.MarshalIndent(oidcInternalClaims.List, \"\", \" \")",
          "2794:   if err != nil {",
          "2796:   }",
          "2798:  }",
          "",
          "[Removed Lines]",
          "2795:    vlog.Debug(\"failed to marshal OIDC internal claims list\")",
          "2797:   vlog.Debug(\"claims after mapping to nomad identity attributes\", \"internal_claims\", string(internalClaimBytes))",
          "",
          "[Added Lines]",
          "2795:    vlog.Debug(\"failed to marshal OIDC internal list claims\")",
          "2797:   vlog.Debug(\"list claims after mapping to nomad identity attributes\", \"internal_claims\", string(internalClaimBytes))",
          "2799:   internalClaimBytes, err = json.MarshalIndent(oidcInternalClaims.Value, \"\", \" \")",
          "2800:   if err != nil {",
          "2801:    vlog.Debug(\"failed to marshal OIDC internal value claims\")",
          "2802:   }",
          "2803:   vlog.Debug(\"value claims after mapping to nomad identity attributes\", \"internal_claims\", string(internalClaimBytes))",
          "",
          "---------------"
        ],
        "website/content/api-docs/task-api.mdx||website/content/api-docs/task-api.mdx": [
          "File: website/content/api-docs/task-api.mdx -> website/content/api-docs/task-api.mdx",
          "--- Hunk 1 ---",
          "[Context before]",
          "97: - Using the Task API Unix Domain Socket on Windows [requires][windows] Windows",
          "98: build 17063 or later.",
          "102: [alloc-exec]: /nomad/docs/commands/alloc/exec",
          "103: [anon]: /nomad/tutorials/access-control/access-control#acl-policies",
          "104: [bind_addr]: /nomad/docs/configuration",
          "",
          "[Removed Lines]",
          "100: [acl]: /nomad/docs/concepts/acl",
          "101: [acl-tokens]: /nomad/docs/concepts/acl#token",
          "",
          "[Added Lines]",
          "100: [acl]: /nomad/docs/concepts/acl/",
          "101: [acl-tokens]: /nomad/docs/concepts/acl/#token",
          "",
          "---------------"
        ],
        "website/content/partials/jwt_claim_mapping_details.mdx||website/content/partials/jwt_claim_mapping_details.mdx": [
          "File: website/content/partials/jwt_claim_mapping_details.mdx -> website/content/partials/jwt_claim_mapping_details.mdx",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: ## Trusted Identity Attributes via Claim Mappings",
          "3: The authentication step can return data from JWT claims as trusted",
          "4: identity attributes for use in binding rule selectors and bind name",
          "5: interpolation.",
          "7: The `ClaimMappings` and `ListClaimMappings` attributes control how Nomad maps claims",
          "8: to identity attributes. Both are maps of items to copy,",
          "9: with elements of the form `\"<JWT claim>\":\"<attribute suffix>\"`.",
          "11: Use `ClaimMappings` to map singular values and `ListClaimMappings` to map lists of values.",
          "13: This examples contains `ClaimMappings` and `ListClaimMappings`. The configuration",
          "14: instructs Nomad to copy the values in the JWT claims `\"givenName\"` and `\"surname\"`",
          "15: to attributes named `\"value.first_name\"` and `\"value.last_name\"` respectively.",
          "16: Additionally, Nomad should copy the list of values in the JWT",
          "17: claim `\"groups\"`  to an attribute named `\"list.roles\"`.",
          "19: ```json",
          "20: {",
          "21:   \"Name\": \"example-auth-method\",",
          "22:   \"Type\": \"<jwt|oidc>\",",
          "23:   \"Description\": \"Example auth method\",",
          "24:   \"Config\": {",
          "25:     \"ClaimMappings\": {",
          "26:       \"givenName\": \"first_name\",",
          "27:       \"surname\": \"last_name\"",
          "28:     },",
          "29:     \"ListClaimMappings\": {",
          "30:       \"groups\": \"roles\"",
          "31:     }",
          "32:   }",
          "33: }",
          "34: ```",
          "36: The following table shows the resulting attributes and",
          "37: the ways they may be used in rule bindings:",
          "39: | Attributes         | Supported selector operations                      | Can be interpolated |",
          "40: | ------------------ | -------------------------------------------------- | ------------------- |",
          "41: | `value.first_name` | Equal, Not Equal, In, Not In, Matches, Not Matches | yes                 |",
          "42: | `value.last_name`  | Equal, Not Equal, In, Not In, Matches, Not Matches | yes                 |",
          "43: | `list.groups`      | In, Not In, Is Empty, Is Not Empty                 | no                  |",
          "45: Refer to the [binding-rule] documentation for more examples on using selectors.",
          "47: ### Claim Specifications and JSON Pointer",
          "49: Use the `ClaimMappings` and `ListClaimMappings` fields to point to data",
          "50: within the JWT. If the desired key is at the top of level of the JWT, you may",
          "51: provide the name directly. If it is nested at a lower level, you may use a JSON",
          "52: Pointer.",
          "54: This example shows decoded JWT claims.",
          "56: ```json",
          "57: {",
          "58:   \"division\": \"North America\",",
          "59:   \"groups\": {",
          "60:     \"primary\": \"Engineering\",",
          "61:     \"secondary\": \"Software\"",
          "62:   },",
          "63:   \"iss\": \"https://my-corp-app-name.auth0.com/\",",
          "64:   \"sub\": \"auth0|eiw7OWoh5ieSh7ieyahC3ief0uyuraphaengae9d\",",
          "65:   \"aud\": \"V1RPi2MYptMV1RPi2MYptMV1RPi2MYpt\",",
          "66:   \"iat\": 1589224148,",
          "67:   \"exp\": 1589260148,",
          "68:   \"nonce\": \"eKiihooH3Fah8Ieshah4leeti6ien3\"",
          "69: }",
          "70: ```",
          "72: Use the following syntax to reference data:",
          "74: - Top-level key: Use direct reference. For example, `\"division\"` refers to `\"North America\"`.",
          "75: - Nested key: Use JSON Pointer syntax. For example, `\"/groups/primary\"` refers to `\"Engineering\"`.",
          "77: You may use any valid JSON Pointer as a selector. Refer to the [JSON Pointer",
          "78: RFC](https://tools.ietf.org/html/rfc6901) for a full description of the syntax.",
          "80: [binding-rule]: /nomad/docs/commands/acl/binding-rule/create#examples",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "999de69be8f56bce8d70aab1020ea43b66ee24c8",
      "candidate_info": {
        "commit_hash": "999de69be8f56bce8d70aab1020ea43b66ee24c8",
        "repo": "hashicorp/nomad",
        "commit_url": "https://github.com/hashicorp/nomad/commit/999de69be8f56bce8d70aab1020ea43b66ee24c8",
        "files": [
          "nomad/state/state_store.go",
          "nomad/state/state_store_test.go"
        ],
        "message": "Backport of state store: remove reschedulable check when getting job status into release/1.9.x (#25082)\n\n* backport of commit b5c157df29061498fadab852a274837e45629068\n\n* backport of: test: add eval to state store periodic job test (#25083)\n\n---------\n\nCo-authored-by: Michael Smithhisler <michael.smithhisler@hashicorp.com>",
        "before_after_code_files": [
          "nomad/state/state_store.go||nomad/state/state_store.go",
          "nomad/state/state_store_test.go||nomad/state/state_store_test.go"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/hashicorp/nomad/pull/25471"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "nomad/state/state_store.go||nomad/state/state_store.go": [
          "File: nomad/state/state_store.go -> nomad/state/state_store.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "5630:  hasAlloc := false",
          "5631:  for alloc := allocs.Next(); alloc != nil; alloc = allocs.Next() {",
          "5634:    return structs.JobStatusRunning, nil",
          "5635:   }",
          "5641:  }",
          "5643:  evals, err := txn.Get(\"evals\", \"job_prefix\", job.Namespace, job.ID)",
          "",
          "[Removed Lines]",
          "5632:   a := alloc.(*structs.Allocation)",
          "5633:   if !a.TerminalStatus() {",
          "5638:   if !isReschedulable(a) {",
          "5639:    hasAlloc = true",
          "5640:   }",
          "",
          "[Added Lines]",
          "5632:   if !alloc.(*structs.Allocation).TerminalStatus() {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "5648:  hasEval := false",
          "5649:  for raw := evals.Next(); raw != nil; raw = evals.Next() {",
          "5660:   hasEval = true",
          "5662:    return structs.JobStatusPending, nil",
          "5663:   }",
          "5664:  }",
          "",
          "[Removed Lines]",
          "5650:   e := raw.(*structs.Evaluation)",
          "5656:   if e.JobModifyIndex < job.ModifyIndex {",
          "5657:    continue",
          "5658:   }",
          "5661:   if !e.TerminalStatus() {",
          "",
          "[Added Lines]",
          "5645:   if !raw.(*structs.Evaluation).TerminalStatus() {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "7371:  return iter, nil",
          "7372: }",
          "7383: func scalingPolicyNamespaceFilter(namespace string) func(interface{}) bool {",
          "",
          "[Removed Lines]",
          "7374: func isReschedulable(a *structs.Allocation) bool {",
          "7375:  if a.Job.Type != structs.JobTypeService {",
          "7376:   return false",
          "7377:  }",
          "7378:  return a.RescheduleTracker.RescheduleEligible(a.ReschedulePolicy(), time.Now())",
          "7379: }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "nomad/state/state_store_test.go||nomad/state/state_store_test.go": [
          "File: nomad/state/state_store_test.go -> nomad/state/state_store_test.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "5808:  alloc.Job = child",
          "5809:  must.NoError(t, state.UpsertAllocs(structs.MsgTypeTestSetup, 1000, []*structs.Allocation{alloc}))",
          "5811:  ws := memdb.NewWatchSet()",
          "5812:  summary, err := state.JobSummaryByID(ws, parent.Namespace, parent.ID)",
          "5813:  must.NoError(t, err)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "5811:  eval := mock.Eval()",
          "5812:  eval.Status = structs.EvalStatusComplete",
          "5813:  eval.JobID = child.ID",
          "5814:  must.NoError(t, state.UpsertEvals(structs.MsgTypeTestSetup, 1001, []*structs.Evaluation{eval}))",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "5833:   JobID:        alloc.JobID,",
          "5834:   TaskGroup:    alloc.TaskGroup,",
          "5835:  }",
          "5837:  must.NoError(t, err)",
          "5839:  must.True(t, watchFired(ws))",
          "",
          "[Removed Lines]",
          "5836:  err = state.UpdateAllocsFromClient(structs.MsgTypeTestSetup, 1001, []*structs.Allocation{update})",
          "",
          "[Added Lines]",
          "5841:  err = state.UpdateAllocsFromClient(structs.MsgTypeTestSetup, 1002, []*structs.Allocation{update})",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "7794:    exp: structs.JobStatusPending,",
          "7795:   },",
          "7796:   {",
          "7798:    setup: func(t *testing.T, txn *txn) *structs.Job {",
          "7799:     j := mock.Job()",
          "7800:     j.Type = structs.JobTypeBatch",
          "",
          "[Removed Lines]",
          "7797:    name: \"batch job has all terminal allocs, with no evals\",",
          "",
          "[Added Lines]",
          "7802:    name: \"batch job has all terminal allocs and terminal evals\",",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "7807:     err := txn.Insert(\"allocs\", a)",
          "7808:     must.NoError(t, err)",
          "7809:     return j",
          "7810:    },",
          "7811:    exp: structs.JobStatusDead,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "7815:     e := mock.Eval()",
          "7816:     e.JobID = j.ID",
          "7817:     e.Status = structs.EvalStatusComplete",
          "7818:     err = txn.Insert(\"evals\", e)",
          "7819:     must.NoError(t, err)",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "7883:     err = txn.Insert(\"allocs\", a2)",
          "7884:     must.NoError(t, err)",
          "7885:     return j",
          "7886:    },",
          "7887:    exp: structs.JobStatusDead,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "7897:     e := mock.Eval()",
          "7898:     e.JobID = j.ID",
          "7899:     e.Status = structs.EvalStatusComplete",
          "7900:     err = txn.Insert(\"evals\", e)",
          "7901:     must.NoError(t, err)",
          "",
          "---------------"
        ]
      }
    }
  ]
}