{
  "cve_id": "CVE-2017-14683",
  "cve_desc": "geminabox (aka Gem in a Box) before 0.13.7 has CSRF, as demonstrated by an unintended gem upload.",
  "repo": "geminabox/geminabox",
  "patch_hash": "a01c4e8b3403624109499dec75eb6ee30bd01a55",
  "patch_info": {
    "commit_hash": "a01c4e8b3403624109499dec75eb6ee30bd01a55",
    "repo": "geminabox/geminabox",
    "commit_url": "https://github.com/geminabox/geminabox/commit/a01c4e8b3403624109499dec75eb6ee30bd01a55",
    "files": [
      "lib/geminabox.rb",
      "lib/geminabox/server.rb"
    ],
    "message": "Fix CSRF vulnerability",
    "before_after_code_files": [
      "lib/geminabox.rb||lib/geminabox.rb",
      "lib/geminabox/server.rb||lib/geminabox/server.rb"
    ]
  },
  "patch_diff": {
    "lib/geminabox.rb||lib/geminabox.rb": [
      "File: lib/geminabox.rb -> lib/geminabox.rb",
      "--- Hunk 1 ---",
      "[Context before]",
      "9: require 'tempfile'",
      "10: require 'json'",
      "11: require 'tilt/erb'",
      "13: module Geminabox",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "12: require 'rack/protection'",
      "",
      "---------------"
    ],
    "lib/geminabox/server.rb||lib/geminabox/server.rb": [
      "File: lib/geminabox/server.rb -> lib/geminabox/server.rb",
      "--- Hunk 1 ---",
      "[Context before]",
      "3:   class Server < Sinatra::Base",
      "4:     enable :static, :methodoverride",
      "6:     def self.delegate_to_geminabox(*delegate_methods)",
      "7:       delegate_methods.each{|m| set m, Geminabox.send(m)}",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "5:     use Rack::Session::Pool, :expire_after => 2592000",
      "6:     use Rack::Protection",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "2491f1fda2d733b9912d4ca7c1e4234478318706",
      "candidate_info": {
        "commit_hash": "2491f1fda2d733b9912d4ca7c1e4234478318706",
        "repo": "geminabox/geminabox",
        "commit_url": "https://github.com/geminabox/geminabox/commit/2491f1fda2d733b9912d4ca7c1e4234478318706",
        "files": [
          "lib/geminabox.rb",
          "lib/geminabox/server.rb"
        ],
        "message": "Merge pull request #296 from geminabox/save_session_memory\n\nMake Rack::Session::Pool's expire_after be smaller to save memory",
        "before_after_code_files": [
          "lib/geminabox.rb||lib/geminabox.rb",
          "lib/geminabox/server.rb||lib/geminabox/server.rb"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "lib/geminabox.rb||lib/geminabox.rb",
            "lib/geminabox/server.rb||lib/geminabox/server.rb"
          ],
          "candidate": [
            "lib/geminabox.rb||lib/geminabox.rb",
            "lib/geminabox/server.rb||lib/geminabox/server.rb"
          ]
        }
      },
      "candidate_diff": {
        "lib/geminabox.rb||lib/geminabox.rb": [
          "File: lib/geminabox.rb -> lib/geminabox.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "52:       :allow_remote_failure,",
          "53:       :ruby_gems_url,",
          "54:       :bundler_ruby_gems_url,",
          "56:     )",
          "58:     def set_defaults(defaults)",
          "",
          "[Removed Lines]",
          "55:       :allow_upload",
          "",
          "[Added Lines]",
          "55:       :allow_upload,",
          "56:       :session_expire_after,",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "87:     allow_remote_failure:  false,",
          "88:     ruby_gems_url:         'https://rubygems.org/',",
          "89:     bundler_ruby_gems_url: 'https://bundler.rubygems.org/',",
          "91:   )",
          "93: end",
          "",
          "[Removed Lines]",
          "90:     allow_upload:          true",
          "",
          "[Added Lines]",
          "91:     allow_upload:          true,",
          "92:     session_expire_after:  1000, # sec",
          "",
          "---------------"
        ],
        "lib/geminabox/server.rb||lib/geminabox/server.rb": [
          "File: lib/geminabox/server.rb -> lib/geminabox/server.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "5:   class Server < Sinatra::Base",
          "6:     enable :static, :methodoverride",
          "8:     use Rack::Protection",
          "10:     def self.delegate_to_geminabox(*delegate_methods)",
          "",
          "[Removed Lines]",
          "7:     use Rack::Session::Pool, :expire_after => 2592000",
          "",
          "[Added Lines]",
          "7:     use Rack::Session::Pool, :expire_after => Geminabox.session_expire_after",
          "",
          "---------------"
        ]
      }
    }
  ]
}