{
  "cve_id": "CVE-2017-4995",
  "cve_desc": "An issue was discovered in Pivotal Spring Security 4.2.0.RELEASE through 4.2.2.RELEASE, and Spring Security 5.0.0.M1. When configured to enable default typing, Jackson contained a deserialization vulnerability that could lead to arbitrary code execution. Jackson fixed this vulnerability by blacklisting known \"deserialization gadgets.\" Spring Security configures Jackson with global default typing enabled, which means that (through the previous exploit) arbitrary code could be executed if all of the following is true: (1) Spring Security's Jackson support is being leveraged by invoking SecurityJackson2Modules.getModules(ClassLoader) or SecurityJackson2Modules.enableDefaultTyping(ObjectMapper); (2) Jackson is used to deserialize data that is not trusted (Spring Security does not perform deserialization using Jackson, so this is an explicit choice of the user); and (3) there is an unknown (Jackson is not blacklisting it already) \"deserialization gadget\" that allows code execution present on the classpath. Jackson provides a blacklisting approach to protecting against this type of attack, but Spring Security should be proactive against blocking unknown \"deserialization gadgets\" when Spring Security enables default typing.",
  "repo": "FasterXML/jackson-databind",
  "patch_hash": "6ce32ffd18facac6abdbbf559c817b47fcb622c1",
  "patch_info": {
    "commit_hash": "6ce32ffd18facac6abdbbf559c817b47fcb622c1",
    "repo": "FasterXML/jackson-databind",
    "commit_url": "https://github.com/FasterXML/jackson-databind/commit/6ce32ffd18facac6abdbbf559c817b47fcb622c",
    "files": [
      "release-notes/VERSION",
      "src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java",
      "src/test/java/com/fasterxml/jackson/databind/interop/IllegalTypesCheckTest.java"
    ],
    "message": "Fix #1599 for 2.7(.10)",
    "before_after_code_files": [
      "src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java||src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java",
      "src/test/java/com/fasterxml/jackson/databind/interop/IllegalTypesCheckTest.java||src/test/java/com/fasterxml/jackson/databind/interop/IllegalTypesCheckTest.java"
    ]
  },
  "patch_diff": {
    "src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java||src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java": [
      "File: src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java -> src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java",
      "--- Hunk 1 ---",
      "[Context before]",
      "139:         if (!isPotentialBeanType(type.getRawClass())) {",
      "140:             return null;",
      "141:         }",
      "143:         return buildBeanDeserializer(ctxt, type, beanDesc);",
      "144:     }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "143:         checkIllegalTypes(ctxt, type, beanDesc);",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "835:         return (status == null) ? false : status.booleanValue();",
      "836:     }",
      "837: }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "843:     protected void checkIllegalTypes(DeserializationContext ctxt, JavaType type,",
      "844:             BeanDescription beanDesc)",
      "845:         throws JsonMappingException",
      "846:     {",
      "849:         Class<?> raw = type.getRawClass();",
      "850:         String name = raw.getSimpleName();",
      "852:         if (\"TemplatesImpl\".equals(name)) { // [databind#1599]",
      "853:             if (raw.getName().startsWith(\"com.sun.org.apache.xalan\")) {",
      "854:                 throw JsonMappingException.from(ctxt,",
      "855:                         String.format(\"Illegal type (%s) to deserialize: prevented for security reasons\",",
      "856:                                 name));",
      "857:             }",
      "858:         }",
      "859:     }",
      "",
      "---------------"
    ],
    "src/test/java/com/fasterxml/jackson/databind/interop/IllegalTypesCheckTest.java||src/test/java/com/fasterxml/jackson/databind/interop/IllegalTypesCheckTest.java": [
      "File: src/test/java/com/fasterxml/jackson/databind/interop/IllegalTypesCheckTest.java -> src/test/java/com/fasterxml/jackson/databind/interop/IllegalTypesCheckTest.java",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: package com.fasterxml.jackson.databind.interop;",
      "3: import com.fasterxml.jackson.databind.*;",
      "9: public class IllegalTypesCheckTest extends BaseMapTest",
      "10: {",
      "11:     static class Bean1599 {",
      "12:         public int id;",
      "13:         public Object obj;",
      "14:     }",
      "16:     public void testIssue1599() throws Exception",
      "17:     {",
      "18:         final String JSON = aposToQuotes(",
      "19:  \"{'id': 124,\\n\"",
      "20: +\" 'obj':[ 'com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl',\\n\"",
      "21: +\"  {\\n\"",
      "22: +\"    'transletBytecodes' : [ 'AAIAZQ==' ],\\n\"",
      "23: +\"    'transletName' : 'a.b',\\n\"",
      "24: +\"    'outputProperties' : { }\\n\"",
      "25: +\"  }\\n\"",
      "26: +\" ]\\n\"",
      "27: +\"}\"",
      "28:         );",
      "29:         ObjectMapper mapper = new ObjectMapper();",
      "30:         mapper.enableDefaultTyping();",
      "31:         try {",
      "32:             mapper.readValue(JSON, Bean1599.class);",
      "33:             fail(\"Should not pass\");",
      "34:         } catch (JsonMappingException e) {",
      "35:             verifyException(e, \"Illegal type\");",
      "36:             verifyException(e, \"to deserialize\");",
      "37:             verifyException(e, \"prevented for security reasons\");",
      "38:         }",
      "39:     }",
      "40: }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "fa87c1ddbe803ebb7295f5c2ebfe38e12f6e6162",
      "candidate_info": {
        "commit_hash": "fa87c1ddbe803ebb7295f5c2ebfe38e12f6e6162",
        "repo": "FasterXML/jackson-databind",
        "commit_url": "https://github.com/FasterXML/jackson-databind/commit/fa87c1ddbe803ebb7295f5c2ebfe38e12f6e6162",
        "files": [
          "pom.xml",
          "release-notes/VERSION",
          "src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java",
          "src/test/java/com/fasterxml/jackson/databind/interop/IllegalTypesCheckTest.java"
        ],
        "message": "Backport #1599 in 2.6.x",
        "before_after_code_files": [
          "src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java||src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java",
          "src/test/java/com/fasterxml/jackson/databind/interop/IllegalTypesCheckTest.java||src/test/java/com/fasterxml/jackson/databind/interop/IllegalTypesCheckTest.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_issue": 1,
        "olp_code_files": {
          "patch": [
            "src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java||src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java",
            "src/test/java/com/fasterxml/jackson/databind/interop/IllegalTypesCheckTest.java||src/test/java/com/fasterxml/jackson/databind/interop/IllegalTypesCheckTest.java"
          ],
          "candidate": [
            "src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java||src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java",
            "src/test/java/com/fasterxml/jackson/databind/interop/IllegalTypesCheckTest.java||src/test/java/com/fasterxml/jackson/databind/interop/IllegalTypesCheckTest.java"
          ]
        }
      },
      "candidate_diff": {
        "src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java||src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java": [
          "File: src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java -> src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "40:     private final static Class<?>[] INIT_CAUSE_PARAMS = new Class<?>[] { Throwable.class };",
          "42:     private final static Class<?>[] NO_VIEWS = new Class<?>[0];",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "48:     private final static Set<String> DEFAULT_NO_DESER_CLASS_NAMES;",
          "49:     static {",
          "50:         Set<String> s = new HashSet<String>();",
          "53:         s.add(\"org.apache.commons.collections.functors.InvokerTransformer\");",
          "54:         s.add(\"org.apache.commons.collections.functors.InstantiateTransformer\");",
          "55:         s.add(\"org.apache.commons.collections4.functors.InvokerTransformer\");",
          "56:         s.add(\"org.apache.commons.collections4.functors.InstantiateTransformer\");",
          "57:         s.add(\"org.codehaus.groovy.runtime.ConvertedClosure\");",
          "58:         s.add(\"org.codehaus.groovy.runtime.MethodClosure\");",
          "59:         s.add(\"org.springframework.beans.factory.ObjectFactory\");",
          "60:         s.add(\"com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl\");",
          "61:         DEFAULT_NO_DESER_CLASS_NAMES = Collections.unmodifiableSet(s);",
          "62:     }",
          "67:     private Set<String> _cfgIllegalClassNames = DEFAULT_NO_DESER_CLASS_NAMES;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "138:         if (!isPotentialBeanType(type.getRawClass())) {",
          "139:             return null;",
          "140:         }",
          "142:         return buildBeanDeserializer(ctxt, type, beanDesc);",
          "143:     }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "167:         checkIllegalTypes(ctxt, type, beanDesc);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "837:         return (status == null) ? false : status.booleanValue();",
          "838:     }",
          "839: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "867:     private void checkIllegalTypes(DeserializationContext ctxt, JavaType type,",
          "868:             BeanDescription beanDesc)",
          "869:         throws JsonMappingException",
          "870:     {",
          "873:         String full = type.getRawClass().getName();",
          "875:         if (_cfgIllegalClassNames.contains(full)) {",
          "876:             String message = String.format(\"Illegal type (%s) to deserialize: prevented for security reasons\",",
          "877:                     full);",
          "878:             throw ctxt.mappingException(\"Invalid type definition for type %s: %s\",",
          "879:                     beanDesc, message);",
          "880:         }",
          "881:     }",
          "",
          "---------------"
        ],
        "src/test/java/com/fasterxml/jackson/databind/interop/IllegalTypesCheckTest.java||src/test/java/com/fasterxml/jackson/databind/interop/IllegalTypesCheckTest.java": [
          "File: src/test/java/com/fasterxml/jackson/databind/interop/IllegalTypesCheckTest.java -> src/test/java/com/fasterxml/jackson/databind/interop/IllegalTypesCheckTest.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: package com.fasterxml.jackson.databind.interop;",
          "3: import com.fasterxml.jackson.databind.*;",
          "9: public class IllegalTypesCheckTest extends BaseMapTest",
          "10: {",
          "11:     static class Bean1599 {",
          "12:         public int id;",
          "13:         public Object obj;",
          "14:     }",
          "16:     public void testIssue1599() throws Exception",
          "17:     {",
          "18:         final String JSON = aposToQuotes(",
          "19:  \"{'id': 124,\\n\"",
          "20: +\" 'obj':[ 'com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl',\\n\"",
          "21: +\"  {\\n\"",
          "22: +\"    'transletBytecodes' : [ 'AAIAZQ==' ],\\n\"",
          "23: +\"    'transletName' : 'a.b',\\n\"",
          "24: +\"    'outputProperties' : { }\\n\"",
          "25: +\"  }\\n\"",
          "26: +\" ]\\n\"",
          "27: +\"}\"",
          "28:         );",
          "29:         ObjectMapper mapper = new ObjectMapper();",
          "30:         mapper.enableDefaultTyping();",
          "31:         try {",
          "32:             mapper.readValue(JSON, Bean1599.class);",
          "33:             fail(\"Should not pass\");",
          "34:         } catch (JsonMappingException e) {",
          "35:             verifyException(e, \"Illegal type\");",
          "36:             verifyException(e, \"to deserialize\");",
          "37:             verifyException(e, \"prevented for security reasons\");",
          "38:         }",
          "39:     }",
          "40: }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "3bfbb835e530055c1941ddf87fde0b08d08dcd38",
      "candidate_info": {
        "commit_hash": "3bfbb835e530055c1941ddf87fde0b08d08dcd38",
        "repo": "FasterXML/jackson-databind",
        "commit_url": "https://github.com/FasterXML/jackson-databind/commit/3bfbb835e530055c1941ddf87fde0b08d08dcd38",
        "files": [
          "src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java"
        ],
        "message": "Minor improvement wrt #1599 (also cover vanilla xalan impl)",
        "before_after_code_files": [
          "src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java||src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_issue": 1,
        "olp_code_files": {
          "patch": [
            "src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java||src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java"
          ],
          "candidate": [
            "src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java||src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java"
          ]
        }
      },
      "candidate_diff": {
        "src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java||src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java": [
          "File: src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java -> src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "57:         s.add(\"org.codehaus.groovy.runtime.MethodClosure\");",
          "58:         s.add(\"org.springframework.beans.factory.ObjectFactory\");",
          "59:         s.add(\"com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl\");",
          "60:         DEFAULT_NO_DESER_CLASS_NAMES = Collections.unmodifiableSet(s);",
          "61:     }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "60:         s.add(\"org.apache.xalan.xsltc.trax.TemplatesImpl\");",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "ddfddfba6414adbecaff99684ef66eebd3a92e92",
      "candidate_info": {
        "commit_hash": "ddfddfba6414adbecaff99684ef66eebd3a92e92",
        "repo": "FasterXML/jackson-databind",
        "commit_url": "https://github.com/FasterXML/jackson-databind/commit/ddfddfba6414adbecaff99684ef66eebd3a92e92",
        "files": [
          "release-notes/VERSION",
          "src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java",
          "src/test/java/com/fasterxml/jackson/databind/interop/IllegalTypesCheckTest.java"
        ],
        "message": "Fix #1737",
        "before_after_code_files": [
          "src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java||src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java",
          "src/test/java/com/fasterxml/jackson/databind/interop/IllegalTypesCheckTest.java||src/test/java/com/fasterxml/jackson/databind/interop/IllegalTypesCheckTest.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java||src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java",
            "src/test/java/com/fasterxml/jackson/databind/interop/IllegalTypesCheckTest.java||src/test/java/com/fasterxml/jackson/databind/interop/IllegalTypesCheckTest.java"
          ],
          "candidate": [
            "src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java||src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java",
            "src/test/java/com/fasterxml/jackson/databind/interop/IllegalTypesCheckTest.java||src/test/java/com/fasterxml/jackson/databind/interop/IllegalTypesCheckTest.java"
          ]
        }
      },
      "candidate_diff": {
        "src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java||src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java": [
          "File: src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java -> src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "61:         s.add(\"org.apache.xalan.xsltc.trax.TemplatesImpl\");",
          "63:         s.add(\"com.sun.rowset.JdbcRowSetImpl\");",
          "64:         DEFAULT_NO_DESER_CLASS_NAMES = Collections.unmodifiableSet(s);",
          "65:     }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "65:         s.add(\"java.util.logging.FileHandler\");",
          "66:         s.add(\"java.rmi.server.UnicastRemoteObject\");",
          "68:         s.add(\"org.springframework.aop.support.AbstractBeanFactoryPointcutAdvisor\");",
          "69:         s.add(\"org.springframework.beans.factory.config.PropertyPathFactoryBean\");",
          "70:         s.add(\"com.mchange.v2.c3p0.JndiRefForwardingDataSource\");",
          "71:         s.add(\"com.mchange.v2.c3p0.WrapperConnectionPoolDataSource\");",
          "",
          "---------------"
        ],
        "src/test/java/com/fasterxml/jackson/databind/interop/IllegalTypesCheckTest.java||src/test/java/com/fasterxml/jackson/databind/interop/IllegalTypesCheckTest.java": [
          "File: src/test/java/com/fasterxml/jackson/databind/interop/IllegalTypesCheckTest.java -> src/test/java/com/fasterxml/jackson/databind/interop/IllegalTypesCheckTest.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: package com.fasterxml.jackson.databind.interop;",
          "3: import com.fasterxml.jackson.databind.*;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3: import com.fasterxml.jackson.annotation.JsonTypeInfo;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "12:         public int id;",
          "13:         public Object obj;",
          "14:     }",
          "17:     {",
          "18:         final String JSON = aposToQuotes(",
          "19:  \"{'id': 124,\\n\"",
          "21: +\"  {\\n\"",
          "22: +\"    'transletBytecodes' : [ 'AAIAZQ==' ],\\n\"",
          "23: +\"    'transletName' : 'a.b',\\n\"",
          "",
          "[Removed Lines]",
          "16:     public void testIssue1599() throws Exception",
          "20: +\" 'obj':[ 'com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl',\\n\"",
          "",
          "[Added Lines]",
          "17:     static class PolyWrapper {",
          "18:         @JsonTypeInfo(use = JsonTypeInfo.Id.CLASS,",
          "19:                 include = JsonTypeInfo.As.WRAPPER_ARRAY)",
          "20:         public Object v;",
          "21:     }",
          "29:     private final ObjectMapper MAPPER = objectMapper();",
          "33:     public void testXalanTypes1599() throws Exception",
          "35:         final String clsName = \"com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl\";",
          "38: +\" 'obj':[ '\"+clsName+\"',\\n\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "32:             mapper.readValue(JSON, Bean1599.class);",
          "33:             fail(\"Should not pass\");",
          "34:         } catch (JsonMappingException e) {",
          "38:         }",
          "39:     }",
          "40: }",
          "",
          "[Removed Lines]",
          "35:             verifyException(e, \"Illegal type\");",
          "36:             verifyException(e, \"to deserialize\");",
          "37:             verifyException(e, \"prevented for security reasons\");",
          "",
          "[Added Lines]",
          "53:             _verifySecurityException(e, clsName);",
          "54:         }",
          "55:     }",
          "59:     public void testJDKTypes1737() throws Exception",
          "60:     {",
          "61:         _testTypes1737(java.util.logging.FileHandler.class);",
          "62:         _testTypes1737(java.rmi.server.UnicastRemoteObject.class);",
          "63:     }",
          "70:     public void testSpringTypes1737() throws Exception",
          "71:     {",
          "72:         _testTypes1737(\"org.springframework.aop.support.AbstractBeanFactoryPointcutAdvisor\");",
          "73:         _testTypes1737(\"org.springframework.beans.factory.config.PropertyPathFactoryBean\");",
          "74:     }",
          "76:     public void testC3P0Types1737() throws Exception",
          "77:     {",
          "78:         _testTypes1737(\"com.mchange.v2.c3p0.JndiRefForwardingDataSource\");",
          "79:         _testTypes1737(\"com.mchange.v2.c3p0.WrapperConnectionPoolDataSource\");",
          "80:     }",
          "83:     private void _testTypes1737(Class<?> nasty) throws Exception {",
          "84:         _testTypes1737(nasty.getName());",
          "85:     }",
          "87:     private void _testTypes1737(String clsName) throws Exception",
          "88:     {",
          "91:         String json = aposToQuotes(",
          "92:                 \"{'v':['\"+clsName+\"','/tmp/foobar.txt']}\"",
          "93:                 );",
          "94:         try {",
          "95:             MAPPER.readValue(json, PolyWrapper.class);",
          "96:             fail(\"Should not pass\");",
          "97:         } catch (JsonMappingException e) {",
          "98:             _verifySecurityException(e, clsName);",
          "99:         }",
          "100:     }",
          "102:     protected void _verifySecurityException(Throwable t, String clsName) throws Exception",
          "103:     {",
          "105:         _verifyException(t, JsonMappingException.class,",
          "106:             \"Illegal type\",",
          "107:             \"to deserialize\",",
          "108:             \"prevented for security reasons\");",
          "109:         verifyException(t, clsName);",
          "110:     }",
          "112:     protected void _verifyException(Throwable t, Class<?> expExcType,",
          "113:             String... patterns) throws Exception",
          "114:     {",
          "115:         Class<?> actExc = t.getClass();",
          "116:         if (!expExcType.isAssignableFrom(actExc)) {",
          "117:             fail(\"Expected Exception of type '\"+expExcType.getName()+\"', got '\"",
          "118:                     +actExc.getName()+\"', message: \"+t.getMessage());",
          "119:         }",
          "120:         for (String pattern : patterns) {",
          "121:             verifyException(t, pattern);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "755e3bc0cbea30de0102f6a88519a0c34d571bbd",
      "candidate_info": {
        "commit_hash": "755e3bc0cbea30de0102f6a88519a0c34d571bbd",
        "repo": "FasterXML/jackson-databind",
        "commit_url": "https://github.com/FasterXML/jackson-databind/commit/755e3bc0cbea30de0102f6a88519a0c34d571bbd",
        "files": [
          "pom.xml",
          "release-notes/VERSION",
          "src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java",
          "src/main/java/com/fasterxml/jackson/databind/jsontype/impl/SubTypeValidator.java",
          "src/test/java/com/fasterxml/jackson/databind/interop/IllegalTypesCheckTest.java",
          "src/test/java/org/springframework/jacksontest/GrantedAuthority.java"
        ],
        "message": "Fix #1872",
        "before_after_code_files": [
          "src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java||src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java",
          "src/main/java/com/fasterxml/jackson/databind/jsontype/impl/SubTypeValidator.java||src/main/java/com/fasterxml/jackson/databind/jsontype/impl/SubTypeValidator.java",
          "src/test/java/com/fasterxml/jackson/databind/interop/IllegalTypesCheckTest.java||src/test/java/com/fasterxml/jackson/databind/interop/IllegalTypesCheckTest.java",
          "src/test/java/org/springframework/jacksontest/GrantedAuthority.java||src/test/java/org/springframework/jacksontest/GrantedAuthority.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java||src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java",
            "src/test/java/com/fasterxml/jackson/databind/interop/IllegalTypesCheckTest.java||src/test/java/com/fasterxml/jackson/databind/interop/IllegalTypesCheckTest.java"
          ],
          "candidate": [
            "src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java||src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java",
            "src/test/java/com/fasterxml/jackson/databind/interop/IllegalTypesCheckTest.java||src/test/java/com/fasterxml/jackson/databind/interop/IllegalTypesCheckTest.java"
          ]
        }
      },
      "candidate_diff": {
        "src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java||src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java": [
          "File: src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java -> src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "13: import com.fasterxml.jackson.databind.introspect.*;",
          "14: import com.fasterxml.jackson.databind.jsontype.TypeDeserializer;",
          "15: import com.fasterxml.jackson.databind.jsontype.impl.SubTypeValidator;",
          "17: import com.fasterxml.jackson.databind.util.ClassUtil;",
          "18: import com.fasterxml.jackson.databind.util.SimpleBeanPropertyDefinition;",
          "",
          "[Removed Lines]",
          "16: import com.fasterxml.jackson.databind.util.ArrayBuilders;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/main/java/com/fasterxml/jackson/databind/jsontype/impl/SubTypeValidator.java||src/main/java/com/fasterxml/jackson/databind/jsontype/impl/SubTypeValidator.java": [
          "File: src/main/java/com/fasterxml/jackson/databind/jsontype/impl/SubTypeValidator.java -> src/main/java/com/fasterxml/jackson/databind/jsontype/impl/SubTypeValidator.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "84:                     String name = cls.getSimpleName();",
          "86:                     if (\"AbstractPointcutAdvisor\".equals(name)",
          "",
          "[Removed Lines]",
          "82:             if (full.startsWith(PREFIX_STRING)) {",
          "83:                 for (Class<?> cls = raw; cls != Object.class; cls = cls.getSuperclass()) {",
          "",
          "[Added Lines]",
          "83:             if (!raw.isInterface() && full.startsWith(PREFIX_STRING)) {",
          "84:                 for (Class<?> cls = raw; (cls != null) && (cls != Object.class); cls = cls.getSuperclass()) {",
          "",
          "---------------"
        ],
        "src/test/java/com/fasterxml/jackson/databind/interop/IllegalTypesCheckTest.java||src/test/java/com/fasterxml/jackson/databind/interop/IllegalTypesCheckTest.java": [
          "File: src/test/java/com/fasterxml/jackson/databind/interop/IllegalTypesCheckTest.java -> src/test/java/com/fasterxml/jackson/databind/interop/IllegalTypesCheckTest.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: package com.fasterxml.jackson.databind.interop;",
          "3: import org.springframework.jacksontest.BogusApplicationContext;",
          "4: import org.springframework.jacksontest.BogusPointcutAdvisor;",
          "6: import com.fasterxml.jackson.annotation.JsonTypeInfo;",
          "7: import com.fasterxml.jackson.databind.*;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3: import java.util.*;",
          "7: import org.springframework.jacksontest.GrantedAuthority;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "22:                 include = JsonTypeInfo.As.WRAPPER_ARRAY)",
          "23:         public Object v;",
          "24:     }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "29:     static class Authentication1872 {",
          "30:          public List<GrantedAuthority> authorities = new ArrayList<GrantedAuthority>();",
          "31:     }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "94:     }",
          "97:     private void _testIllegalType(Class<?> nasty) throws Exception {",
          "98:         _testIllegalType(nasty.getName());",
          "99:     }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "105:     public void testJDKTypes1872() throws Exception",
          "106:     {",
          "107:         ObjectMapper mapper = new ObjectMapper();",
          "108:         mapper.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL, JsonTypeInfo.As.PROPERTY);",
          "110:         String json = aposToQuotes(String.format(\"{'@class':'%s','authorities':['java.util.ArrayList',[]]}\",",
          "111:                 Authentication1872.class.getName()));",
          "112:         Authentication1872 result = mapper.readValue(json, Authentication1872.class);",
          "113:         assertNotNull(result);",
          "114:     }",
          "",
          "---------------"
        ],
        "src/test/java/org/springframework/jacksontest/GrantedAuthority.java||src/test/java/org/springframework/jacksontest/GrantedAuthority.java": [
          "File: src/test/java/org/springframework/jacksontest/GrantedAuthority.java -> src/test/java/org/springframework/jacksontest/GrantedAuthority.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: package org.springframework.jacksontest;",
          "3: public interface GrantedAuthority {",
          "5: }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "f4e8de59a4739273d5692d029f15986bb57dd273",
      "candidate_info": {
        "commit_hash": "f4e8de59a4739273d5692d029f15986bb57dd273",
        "repo": "FasterXML/jackson-databind",
        "commit_url": "https://github.com/FasterXML/jackson-databind/commit/f4e8de59a4739273d5692d029f15986bb57dd273",
        "files": [
          "pom.xml",
          "release-notes/VERSION",
          "src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java"
        ],
        "message": "Prepare for 2.7.9.1",
        "before_after_code_files": [
          "src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java||src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java||src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java"
          ],
          "candidate": [
            "src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java||src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java"
          ]
        }
      },
      "candidate_diff": {
        "src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java||src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java": [
          "File: src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java -> src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "39:     private final static Class<?>[] INIT_CAUSE_PARAMS = new Class<?>[] { Throwable.class };",
          "41:     private final static Class<?>[] NO_VIEWS = new Class<?>[0];",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "47:     protected final static Set<String> DEFAULT_NO_DESER_CLASS_NAMES;",
          "48:     static {",
          "49:         Set<String> s = new HashSet<String>();",
          "52:         s.add(\"org.apache.commons.collections.functors.InvokerTransformer\");",
          "53:         s.add(\"org.apache.commons.collections.functors.InstantiateTransformer\");",
          "54:         s.add(\"org.apache.commons.collections4.functors.InvokerTransformer\");",
          "55:         s.add(\"org.apache.commons.collections4.functors.InstantiateTransformer\");",
          "56:         s.add(\"org.codehaus.groovy.runtime.ConvertedClosure\");",
          "57:         s.add(\"org.codehaus.groovy.runtime.MethodClosure\");",
          "58:         s.add(\"org.springframework.beans.factory.ObjectFactory\");",
          "59:         s.add(\"com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl\");",
          "60:         DEFAULT_NO_DESER_CLASS_NAMES = Collections.unmodifiableSet(s);",
          "61:     }",
          "66:     protected Set<String> _cfgIllegalClassNames = DEFAULT_NO_DESER_CLASS_NAMES;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "846:     {",
          "858:         }",
          "859:     }",
          "860: }",
          "",
          "[Removed Lines]",
          "849:         Class<?> raw = type.getRawClass();",
          "850:         String name = raw.getSimpleName();",
          "852:         if (\"TemplatesImpl\".equals(name)) { // [databind#1599]",
          "853:             if (raw.getName().startsWith(\"com.sun.org.apache.xalan\")) {",
          "854:                 throw JsonMappingException.from(ctxt,",
          "855:                         String.format(\"Illegal type (%s) to deserialize: prevented for security reasons\",",
          "856:                                 name));",
          "857:             }",
          "",
          "[Added Lines]",
          "874:         String full = type.getRawClass().getName();",
          "876:         if (_cfgIllegalClassNames.contains(full)) {",
          "877:             throw JsonMappingException.from(ctxt,",
          "878:                     String.format(\"Illegal type (%s) to deserialize: prevented for security reasons\", full));",
          "",
          "---------------"
        ]
      }
    }
  ]
}