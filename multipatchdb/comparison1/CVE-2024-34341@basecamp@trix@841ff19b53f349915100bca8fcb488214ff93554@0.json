{
  "cve_id": "CVE-2024-34341",
  "cve_desc": "Trix is a rich text editor. The Trix editor, versions prior to 2.1.1, is vulnerable to arbitrary code execution when copying and pasting content from the web or other documents with markup into the editor. The vulnerability stems from improper sanitization of pasted content, allowing an attacker to embed malicious scripts which are executed within the context of the application. Users should upgrade to Trix editor version 2.1.1 or later, which incorporates proper sanitization of input from copied content.",
  "repo": "basecamp/trix",
  "patch_hash": "841ff19b53f349915100bca8fcb488214ff93554",
  "patch_info": {
    "commit_hash": "841ff19b53f349915100bca8fcb488214ff93554",
    "repo": "basecamp/trix",
    "commit_url": "https://github.com/basecamp/trix/commit/841ff19b53f349915100bca8fcb488214ff93554",
    "files": [
      "src/test/system/pasting_test.js",
      "src/trix/models/html_sanitizer.js"
    ],
    "message": "Merge pull request #1147 from basecamp/sanitize-noscript\n\nSanitize noscript to prevent copy and paste XSS",
    "before_after_code_files": [
      "src/test/system/pasting_test.js||src/test/system/pasting_test.js",
      "src/trix/models/html_sanitizer.js||src/trix/models/html_sanitizer.js"
    ]
  },
  "patch_diff": {
    "src/test/system/pasting_test.js||src/test/system/pasting_test.js": [
      "File: src/test/system/pasting_test.js -> src/test/system/pasting_test.js",
      "--- Hunk 1 ---",
      "[Context before]",
      "89:     delete window.unsanitized",
      "90:   })",
      "92:   test(\"prefers plain text when html lacks formatting\", async () => {",
      "93:     const pasteData = {",
      "94:       \"text/html\": \"<meta charset='utf-8'>a\\nb\",",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "92:   test(\"paste unsafe html with noscript\", async () => {",
      "93:     window.unsanitized = []",
      "94:     const pasteData = {",
      "95:       \"text/plain\": \"x\",",
      "96:       \"text/html\": `\\",
      "97:         <div><noscript><div class=\"123</noscript>456<img src=1 onerror=window.unsanitized.push(1)//\"></div></noscript></div>",
      "98:       `",
      "99:     }",
      "101:     await pasteContent(pasteData)",
      "102:     await delay(20)",
      "103:     assert.deepEqual(window.unsanitized, [])",
      "104:     delete window.unsanitized",
      "105:   })",
      "",
      "---------------"
    ],
    "src/trix/models/html_sanitizer.js||src/trix/models/html_sanitizer.js": [
      "File: src/trix/models/html_sanitizer.js -> src/trix/models/html_sanitizer.js",
      "--- Hunk 1 ---",
      "[Context before]",
      "5: const DEFAULT_ALLOWED_ATTRIBUTES = \"style href src width height language class\".split(\" \")",
      "6: const DEFAULT_FORBIDDEN_PROTOCOLS = \"javascript:\".split(\" \")",
      "9: export default class HTMLSanitizer extends BasicObject {",
      "10:   static sanitize(html, options) {",
      "",
      "[Removed Lines]",
      "7: const DEFAULT_FORBIDDEN_ELEMENTS = \"script iframe form\".split(\" \")",
      "",
      "[Added Lines]",
      "7: const DEFAULT_FORBIDDEN_ELEMENTS = \"script iframe form noscript\".split(\" \")",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "5e03f4a7dd5a53969f6b67e0a4c3765cb0b5220d",
      "candidate_info": {
        "commit_hash": "5e03f4a7dd5a53969f6b67e0a4c3765cb0b5220d",
        "repo": "basecamp/trix",
        "commit_url": "https://github.com/basecamp/trix/commit/5e03f4a7dd5a53969f6b67e0a4c3765cb0b5220d",
        "files": [
          "src/test/system/pasting_test.js",
          "src/trix/models/html_sanitizer.js"
        ],
        "message": "Sanitize noscript to prevent copy and paste XSS",
        "before_after_code_files": [
          "src/test/system/pasting_test.js||src/test/system/pasting_test.js",
          "src/trix/models/html_sanitizer.js||src/trix/models/html_sanitizer.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/basecamp/trix/pull/1147"
        ],
        "olp_code_files": {
          "patch": [
            "src/test/system/pasting_test.js||src/test/system/pasting_test.js",
            "src/trix/models/html_sanitizer.js||src/trix/models/html_sanitizer.js"
          ],
          "candidate": [
            "src/test/system/pasting_test.js||src/test/system/pasting_test.js",
            "src/trix/models/html_sanitizer.js||src/trix/models/html_sanitizer.js"
          ]
        }
      },
      "candidate_diff": {
        "src/test/system/pasting_test.js||src/test/system/pasting_test.js": [
          "File: src/test/system/pasting_test.js -> src/test/system/pasting_test.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "89:     delete window.unsanitized",
          "90:   })",
          "92:   test(\"prefers plain text when html lacks formatting\", async () => {",
          "93:     const pasteData = {",
          "94:       \"text/html\": \"<meta charset='utf-8'>a\\nb\",",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "92:   test(\"paste unsafe html with noscript\", async () => {",
          "93:     window.unsanitized = []",
          "94:     const pasteData = {",
          "95:       \"text/plain\": \"x\",",
          "96:       \"text/html\": `\\",
          "97:         <div><noscript><div class=\"123</noscript>456<img src=1 onerror=window.unsanitized.push(1)//\"></div></noscript></div>",
          "98:       `",
          "99:     }",
          "101:     await pasteContent(pasteData)",
          "102:     await delay(20)",
          "103:     assert.deepEqual(window.unsanitized, [])",
          "104:     delete window.unsanitized",
          "105:   })",
          "",
          "---------------"
        ],
        "src/trix/models/html_sanitizer.js||src/trix/models/html_sanitizer.js": [
          "File: src/trix/models/html_sanitizer.js -> src/trix/models/html_sanitizer.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: const DEFAULT_ALLOWED_ATTRIBUTES = \"style href src width height language class\".split(\" \")",
          "6: const DEFAULT_FORBIDDEN_PROTOCOLS = \"javascript:\".split(\" \")",
          "9: export default class HTMLSanitizer extends BasicObject {",
          "10:   static sanitize(html, options) {",
          "",
          "[Removed Lines]",
          "7: const DEFAULT_FORBIDDEN_ELEMENTS = \"script iframe form\".split(\" \")",
          "",
          "[Added Lines]",
          "7: const DEFAULT_FORBIDDEN_ELEMENTS = \"script iframe form noscript\".split(\" \")",
          "",
          "---------------"
        ]
      }
    }
  ]
}