{
  "cve_id": "CVE-2024-22232",
  "cve_desc": "A specially crafted url can be created which leads to a directory traversal in the salt file server.\nA malicious user can read an arbitrary file from a Salt master\u2019s filesystem.",
  "repo": "saltstack/salt",
  "patch_hash": "e0cdb80b55123f4a024759ffcf2b3f0e0788e7ab",
  "patch_info": {
    "commit_hash": "e0cdb80b55123f4a024759ffcf2b3f0e0788e7ab",
    "repo": "saltstack/salt",
    "commit_url": "https://github.com/saltstack/salt/commit/e0cdb80b55123f4a024759ffcf2b3f0e0788e7ab",
    "files": [
      "salt/fileserver/__init__.py",
      "salt/fileserver/roots.py",
      "salt/master.py",
      "tests/pytests/unit/fileserver/test_roots.py",
      "tests/pytests/unit/test_fileserver.py",
      "tests/pytests/unit/test_master.py",
      "tests/unit/test_fileserver.py"
    ],
    "message": "CVE fix",
    "before_after_code_files": [
      "salt/fileserver/__init__.py||salt/fileserver/__init__.py",
      "salt/fileserver/roots.py||salt/fileserver/roots.py",
      "salt/master.py||salt/master.py",
      "tests/pytests/unit/fileserver/test_roots.py||tests/pytests/unit/fileserver/test_roots.py",
      "tests/pytests/unit/test_fileserver.py||tests/pytests/unit/test_fileserver.py",
      "tests/pytests/unit/test_master.py||tests/pytests/unit/test_master.py",
      "tests/unit/test_fileserver.py||tests/unit/test_fileserver.py"
    ]
  },
  "patch_diff": {
    "salt/fileserver/__init__.py||salt/fileserver/__init__.py": [
      "File: salt/fileserver/__init__.py -> salt/fileserver/__init__.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "568:         saltenv = salt.utils.stringutils.to_unicode(saltenv)",
      "569:         back = self.backends(back)",
      "570:         kwargs = {}",
      "576:         if salt.utils.url.is_escaped(path):",
      "577:             # don't attempt to find URL query arguments in the path",
      "578:             path = salt.utils.url.unescape(path)",
      "",
      "[Removed Lines]",
      "571:         fnd = {\"path\": \"\", \"rel\": \"\"}",
      "572:         if os.path.isabs(path):",
      "573:             return fnd",
      "574:         if \"../\" in path:",
      "575:             return fnd",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "588:                     args = comp.split(\"=\", 1)",
      "589:                     kwargs[args[0]] = args[1]",
      "591:         if \"env\" in kwargs:",
      "592:             # \"env\" is not supported; Use \"saltenv\".",
      "593:             kwargs.pop(\"env\")",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "586:         fnd = {\"path\": \"\", \"rel\": \"\"}",
      "587:         if os.path.isabs(path) or \"../\" in path:",
      "588:             return fnd",
      "",
      "---------------"
    ],
    "salt/fileserver/roots.py||salt/fileserver/roots.py": [
      "File: salt/fileserver/roots.py -> salt/fileserver/roots.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "27: import salt.utils.path",
      "28: import salt.utils.platform",
      "29: import salt.utils.stringutils",
      "30: import salt.utils.versions",
      "32: log = logging.getLogger(__name__)",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "30: import salt.utils.verify",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "98:         if saltenv == \"__env__\":",
      "99:             root = root.replace(\"__env__\", actual_saltenv)",
      "100:         full = os.path.join(root, path)",
      "101:         if os.path.isfile(full) and not salt.fileserver.is_file_ignored(__opts__, full):",
      "102:             fnd[\"path\"] = full",
      "103:             fnd[\"rel\"] = path",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "103:         # Refuse to serve file that is not under the root.",
      "104:         if not salt.utils.verify.clean_path(root, full, subdir=True):",
      "105:             continue",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "128:     ret[\"dest\"] = fnd[\"rel\"]",
      "129:     gzip = load.get(\"gzip\", None)",
      "130:     fpath = os.path.normpath(fnd[\"path\"])",
      "131:     with salt.utils.files.fopen(fpath, \"rb\") as fp_:",
      "132:         fp_.seek(load[\"loc\"])",
      "133:         data = fp_.read(__opts__[\"file_buffer_size\"])",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "138:     actual_saltenv = saltenv = load[\"saltenv\"]",
      "139:     if saltenv not in __opts__[\"file_roots\"]:",
      "140:         if \"__env__\" in __opts__[\"file_roots\"]:",
      "141:             log.debug(",
      "142:                 \"salt environment '%s' maps to __env__ file_roots directory\", saltenv",
      "143:             )",
      "144:             saltenv = \"__env__\"",
      "145:         else:",
      "146:             return fnd",
      "147:     file_in_root = False",
      "148:     for root in __opts__[\"file_roots\"][saltenv]:",
      "149:         if saltenv == \"__env__\":",
      "150:             root = root.replace(\"__env__\", actual_saltenv)",
      "151:         # Refuse to serve file that is not under the root.",
      "152:         if salt.utils.verify.clean_path(root, fpath, subdir=True):",
      "153:             file_in_root = True",
      "154:     if not file_in_root:",
      "155:         return ret",
      "",
      "---------------"
    ],
    "salt/master.py||salt/master.py": [
      "File: salt/master.py -> salt/master.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "1036:         \"\"\"",
      "1037:         key = payload[\"enc\"]",
      "1038:         load = payload[\"load\"]",
      "1040:         raise salt.ext.tornado.gen.Return(ret)",
      "1042:     def _post_stats(self, start, cmd):",
      "",
      "[Removed Lines]",
      "1039:         ret = {\"aes\": self._handle_aes, \"clear\": self._handle_clear}[key](load)",
      "",
      "[Added Lines]",
      "1039:         if key == \"aes\":",
      "1040:             ret = self.handle_aes(load)",
      "1041:         else:",
      "1042:             ret = self.handle_clear(load)",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "1738:                 self.mminion.returners[fstr](load[\"jid\"], load[\"load\"])",
      "1740:             # Register the syndic",
      "1741:             syndic_cache_path = os.path.join(",
      "1742:                 self.opts[\"cachedir\"], \"syndics\", load[\"id\"]",
      "1743:             )",
      "1745:                 path_name = os.path.split(syndic_cache_path)[0]",
      "1746:                 if not os.path.exists(path_name):",
      "1747:                     os.makedirs(path_name)",
      "",
      "[Removed Lines]",
      "1744:             if not os.path.exists(syndic_cache_path):",
      "",
      "[Added Lines]",
      "1745:             # We are creating a path using user suplied input. Use the",
      "1746:             # clean_path to prevent a directory traversal.",
      "1747:             root = os.path.join(self.opts[\"cachedir\"], \"syndics\")",
      "1751:             if salt.utils.verify.clean_path(",
      "1752:                 root, syndic_cache_path",
      "1753:             ) and not os.path.exists(syndic_cache_path):",
      "",
      "---------------"
    ],
    "tests/pytests/unit/fileserver/test_roots.py||tests/pytests/unit/fileserver/test_roots.py": [
      "File: tests/pytests/unit/fileserver/test_roots.py -> tests/pytests/unit/fileserver/test_roots.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "53:     return dirname",
      "56: @pytest.fixture",
      "57: def configure_loader_modules(tmp_state_tree, temp_salt_master):",
      "58:     opts = temp_salt_master.config.copy()",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "56: @pytest.fixture(autouse=True)",
      "57: def testfilepath(tmp_state_tree, testfile):",
      "58:     return tmp_state_tree / testfile.name",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "75:     assert full_path_to_file == ret[\"path\"]",
      "79:     with patch.dict(roots.__opts__, {\"file_buffer_size\": 262144}):",
      "80:         load = {",
      "81:             \"saltenv\": \"base\",",
      "83:             \"loc\": 0,",
      "84:         }",
      "86:         ret = roots.serve_file(load, fnd)",
      "89:             data = fp_.read()",
      "91:         assert ret == {\"data\": data, \"dest\": \"testfile\"}",
      "",
      "[Removed Lines]",
      "78: def test_serve_file(testfile):",
      "82:             \"path\": str(testfile),",
      "85:         fnd = {\"path\": str(testfile), \"rel\": \"testfile\"}",
      "88:         with salt.utils.files.fopen(str(testfile), \"rb\") as fp_:",
      "",
      "[Added Lines]",
      "83: def test_serve_file(testfilepath):",
      "87:             \"path\": str(testfilepath),",
      "90:         fnd = {\"path\": str(testfilepath), \"rel\": \"testfile\"}",
      "93:         with salt.utils.files.fopen(str(testfilepath), \"rb\") as fp_:",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "236:     # between Python releases.",
      "237:     lines_written = sorted(mtime_map_mock.write_calls())",
      "238:     expected = sorted(",
      "240:         for key, val in new_mtime_map.items()",
      "241:     )",
      "242:     assert lines_written == expected, lines_written",
      "",
      "[Removed Lines]",
      "239:         salt.utils.stringutils.to_bytes(\"{key}:{val}\\n\".format(key=key, val=val))",
      "",
      "[Added Lines]",
      "244:         salt.utils.stringutils.to_bytes(f\"{key}:{val}\\n\")",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "277:         },",
      "278:         \"backend\": \"roots\",",
      "279:     }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "287: def test_find_file_not_in_root(tmp_state_tree):",
      "288:     \"\"\"",
      "289:     Fileroots should never 'find' a file that is outside of it's root.",
      "290:     \"\"\"",
      "291:     badfile = pathlib.Path(tmp_state_tree).parent / \"bar\"",
      "292:     badfile.write_text(\"Bad file\")",
      "293:     badpath = f\"../bar\"",
      "294:     ret = roots.find_file(badpath)",
      "295:     assert ret == {\"path\": \"\", \"rel\": \"\"}",
      "296:     badpath = f\"{tmp_state_tree / '..' / 'bar'}\"",
      "297:     ret = roots.find_file(badpath)",
      "298:     assert ret == {\"path\": \"\", \"rel\": \"\"}",
      "301: def test_serve_file_not_in_root(tmp_state_tree):",
      "302:     \"\"\"",
      "303:     Fileroots should never 'serve' a file that is outside of it's root.",
      "304:     \"\"\"",
      "305:     badfile = pathlib.Path(tmp_state_tree).parent / \"bar\"",
      "306:     badfile.write_text(\"Bad file\")",
      "307:     badpath = f\"../bar\"",
      "308:     load = {\"path\": \"salt://|..\\\\bar\", \"saltenv\": \"base\", \"loc\": 0}",
      "309:     fnd = {",
      "310:         \"path\": f\"{tmp_state_tree / '..' / 'bar'}\",",
      "311:         \"rel\": f\"{pathlib.Path('..') / 'bar'}\",",
      "312:     }",
      "313:     ret = roots.serve_file(load, fnd)",
      "314:     assert ret == {\"data\": \"\", \"dest\": \"../bar\"}",
      "",
      "---------------"
    ],
    "tests/pytests/unit/test_fileserver.py||tests/pytests/unit/test_fileserver.py": [
      "File: tests/pytests/unit/test_fileserver.py -> tests/pytests/unit/test_fileserver.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: \"\"\"",
      "2: \"\"\"",
      "5: import datetime",
      "6: import os",
      "7: import time",
      "9: import salt.fileserver",
      "10: import salt.utils.files",
      "13: def test_diff_with_diffent_keys():",
      "14:     \"\"\"",
      "15:     Test that different maps are indeed reported different",
      "16:     \"\"\"",
      "17:     map1 = {\"file1\": 1234}",
      "18:     map2 = {\"file2\": 1234}",
      "19:     assert salt.fileserver.diff_mtime_map(map1, map2) is True",
      "22: def test_diff_with_diffent_values():",
      "23:     \"\"\"",
      "24:     Test that different maps are indeed reported different",
      "25:     \"\"\"",
      "26:     map1 = {\"file1\": 12345}",
      "27:     map2 = {\"file1\": 1234}",
      "28:     assert salt.fileserver.diff_mtime_map(map1, map2) is True",
      "31: def test_whitelist():",
      "32:     opts = {",
      "33:         \"fileserver_backend\": [\"roots\", \"git\", \"s3fs\", \"hgfs\", \"svn\"],",
      "34:         \"extension_modules\": \"\",",
      "35:     }",
      "36:     fs = salt.fileserver.Fileserver(opts)",
      "37:     assert sorted(fs.servers.whitelist) == sorted(",
      "38:         [\"git\", \"gitfs\", \"hg\", \"hgfs\", \"svn\", \"svnfs\", \"roots\", \"s3fs\"]",
      "39:     ), fs.servers.whitelist",
      "42: def test_future_file_list_cache_file_ignored(tmp_path):",
      "43:     opts = {",
      "44:         \"fileserver_backend\": [\"roots\"],",
      "45:         \"cachedir\": tmp_path,",
      "46:         \"extension_modules\": \"\",",
      "47:     }",
      "49:     back_cachedir = os.path.join(tmp_path, \"file_lists/roots\")",
      "50:     os.makedirs(os.path.join(back_cachedir))",
      "52:     # Touch a couple files",
      "53:     for filename in (\"base.p\", \"foo.txt\"):",
      "54:         with salt.utils.files.fopen(os.path.join(back_cachedir, filename), \"wb\") as _f:",
      "55:             if filename == \"base.p\":",
      "56:                 _f.write(b\"\\x80\")",
      "58:     # Set modification time to file list cache file to 1 year in the future",
      "59:     now = datetime.datetime.utcnow()",
      "60:     future = now + datetime.timedelta(days=365)",
      "61:     mod_time = time.mktime(future.timetuple())",
      "62:     os.utime(os.path.join(back_cachedir, \"base.p\"), (mod_time, mod_time))",
      "64:     list_cache = os.path.join(back_cachedir, \"base.p\")",
      "65:     w_lock = os.path.join(back_cachedir, \".base.w\")",
      "66:     ret = salt.fileserver.check_file_list_cache(opts, \"files\", list_cache, w_lock)",
      "67:     assert (",
      "68:         ret[1] is True",
      "69:     ), \"Cache file list cache file is not refreshed when future modification time\"",
      "72: def test_file_server_url_escape(tmp_path):",
      "73:     (tmp_path / \"srv\").mkdir()",
      "74:     (tmp_path / \"srv\" / \"salt\").mkdir()",
      "75:     (tmp_path / \"foo\").mkdir()",
      "76:     (tmp_path / \"foo\" / \"bar\").write_text(\"Bad file\")",
      "77:     fileroot = str(tmp_path / \"srv\" / \"salt\")",
      "78:     badfile = str(tmp_path / \"foo\" / \"bar\")",
      "79:     opts = {",
      "80:         \"fileserver_backend\": [\"roots\"],",
      "81:         \"extension_modules\": \"\",",
      "82:         \"optimization_order\": [",
      "83:             0,",
      "84:         ],",
      "85:         \"file_roots\": {",
      "86:             \"base\": [fileroot],",
      "87:         },",
      "88:         \"file_ignore_regex\": \"\",",
      "89:         \"file_ignore_glob\": \"\",",
      "90:     }",
      "91:     fs = salt.fileserver.Fileserver(opts)",
      "92:     ret = fs.find_file(",
      "93:         \"salt://|..\\\\..\\\\..\\\\foo/bar\",",
      "94:         \"base\",",
      "95:     )",
      "96:     assert ret == {\"path\": \"\", \"rel\": \"\"}",
      "99: def test_file_server_serve_url_escape(tmp_path):",
      "100:     (tmp_path / \"srv\").mkdir()",
      "101:     (tmp_path / \"srv\" / \"salt\").mkdir()",
      "102:     (tmp_path / \"foo\").mkdir()",
      "103:     (tmp_path / \"foo\" / \"bar\").write_text(\"Bad file\")",
      "104:     fileroot = str(tmp_path / \"srv\" / \"salt\")",
      "105:     badfile = str(tmp_path / \"foo\" / \"bar\")",
      "106:     opts = {",
      "107:         \"fileserver_backend\": [\"roots\"],",
      "108:         \"extension_modules\": \"\",",
      "109:         \"optimization_order\": [",
      "110:             0,",
      "111:         ],",
      "112:         \"file_roots\": {",
      "113:             \"base\": [fileroot],",
      "114:         },",
      "115:         \"file_ignore_regex\": \"\",",
      "116:         \"file_ignore_glob\": \"\",",
      "117:         \"file_buffer_size\": 2048,",
      "118:     }",
      "119:     fs = salt.fileserver.Fileserver(opts)",
      "120:     ret = fs.serve_file(",
      "121:         {",
      "122:             \"path\": \"salt://|..\\\\..\\\\..\\\\foo/bar\",",
      "123:             \"saltenv\": \"base\",",
      "124:             \"loc\": 0,",
      "125:         }",
      "126:     )",
      "127:     assert ret == {\"data\": \"\", \"dest\": \"\"}",
      "",
      "---------------"
    ],
    "tests/pytests/unit/test_master.py||tests/pytests/unit/test_master.py": [
      "File: tests/pytests/unit/test_master.py -> tests/pytests/unit/test_master.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "1: import time",
      "3: import pytest",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: import pathlib",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "160:     with patch.object(encrypted_requests, \"_return\", autospec=True) as fake_return:",
      "161:         encrypted_requests._syndic_return(payload)",
      "162:         fake_return.assert_called_with(expected_return)",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "166: def test_syndic_return_cache_dir_creation(encrypted_requests):",
      "167:     \"\"\"master's cachedir for a syndic will be created by AESFuncs._syndic_return method\"\"\"",
      "168:     cachedir = pathlib.Path(encrypted_requests.opts[\"cachedir\"])",
      "169:     assert not (cachedir / \"syndics\").exists()",
      "170:     encrypted_requests._syndic_return(",
      "171:         {",
      "172:             \"id\": \"mamajama\",",
      "173:             \"jid\": \"\",",
      "174:             \"return\": {},",
      "175:         }",
      "176:     )",
      "177:     assert (cachedir / \"syndics\").exists()",
      "178:     assert (cachedir / \"syndics\" / \"mamajama\").exists()",
      "181: def test_syndic_return_cache_dir_creation_traversal(encrypted_requests):",
      "182:     \"\"\"",
      "183:     master's  AESFuncs._syndic_return method cachdir creation is not vulnerable to a directory traversal",
      "184:     \"\"\"",
      "185:     cachedir = pathlib.Path(encrypted_requests.opts[\"cachedir\"])",
      "186:     assert not (cachedir / \"syndics\").exists()",
      "187:     encrypted_requests._syndic_return(",
      "188:         {",
      "189:             \"id\": \"../mamajama\",",
      "190:             \"jid\": \"\",",
      "191:             \"return\": {},",
      "192:         }",
      "193:     )",
      "194:     assert not (cachedir / \"syndics\").exists()",
      "195:     assert not (cachedir / \"mamajama\").exists()",
      "",
      "---------------"
    ],
    "tests/unit/test_fileserver.py||tests/unit/test_fileserver.py": [
      "File: tests/unit/test_fileserver.py -> tests/unit/test_fileserver.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "ab6a77fcbd6256888ff8a5a617f23c133b9496c5",
      "candidate_info": {
        "commit_hash": "ab6a77fcbd6256888ff8a5a617f23c133b9496c5",
        "repo": "saltstack/salt",
        "commit_url": "https://github.com/saltstack/salt/commit/ab6a77fcbd6256888ff8a5a617f23c133b9496c5",
        "files": [
          ".github/workflows/build-deps-ci-action-linux.yml",
          ".github/workflows/build-deps-ci-action-macos.yml",
          ".github/workflows/build-deps-ci-action-windows.yml",
          ".github/workflows/build-deps-ci-action.yml",
          ".github/workflows/ci.yml",
          ".github/workflows/nightly.yml",
          ".github/workflows/release.yml",
          ".github/workflows/scheduled.yml",
          ".github/workflows/staging.yml",
          ".github/workflows/templates/build-ci-deps.yml.jinja",
          ".github/workflows/templates/test-package-downloads-action.yml.jinja",
          ".github/workflows/templates/test-salt-pkg.yml.jinja",
          ".github/workflows/templates/test-salt.yml.jinja",
          ".github/workflows/test-action-linux.yml",
          ".github/workflows/test-action-macos.yml",
          ".github/workflows/test-action-windows.yml",
          ".github/workflows/test-action.yml",
          ".github/workflows/test-package-downloads-action.yml",
          ".github/workflows/test-packages-action-linux.yml",
          ".github/workflows/test-packages-action-macos.yml",
          ".github/workflows/test-packages-action-windows.yml",
          ".github/workflows/test-packages-action.yml",
          "noxfile.py",
          "tools/precommit/workflows.py",
          "tools/utils/__init__.py",
          "tools/vm.py"
        ],
        "message": "Reduce GitHub Actions cache usage\n\nSigned-off-by: Pedro Algarvio <palgarvio@vmware.com>",
        "before_after_code_files": [
          ".github/workflows/templates/build-ci-deps.yml.jinja||.githuworkflows/templates/build-ci-deps.yml.jinja",
          ".github/workflows/templates/test-package-downloads-action.yml.jinja||.githuworkflows/templates/test-package-downloads-action.yml.jinja",
          ".github/workflows/templates/test-salt-pkg.yml.jinja||.githuworkflows/templates/test-salt-pkg.yml.jinja",
          ".github/workflows/templates/test-salt.yml.jinja||.githuworkflows/templates/test-salt.yml.jinja",
          "noxfile.py||noxfile.py",
          "tools/precommit/workflows.py||tools/precommit/workflows.py",
          "tools/utils/__init__.py||tools/utils/__init__.py",
          "tools/vm.py||tools/vm.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/saltstack/salt/pull/65969"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        ".github/workflows/templates/build-ci-deps.yml.jinja||.githuworkflows/templates/build-ci-deps.yml.jinja": [
          "File: .github/workflows/templates/build-ci-deps.yml.jinja -> .githuworkflows/templates/build-ci-deps.yml.jinja",
          "--- Hunk 1 ---",
          "[Context before]",
          "7:     <%- if workflow_slug != 'release' %>",
          "8:     if: ${{ fromJSON(needs.prepare-workflow.outputs.jobs)['build-deps-ci'] && fromJSON(needs.prepare-workflow.outputs.runners)['self-hosted'] }}",
          "9:     <%- endif %>",
          "",
          "[Removed Lines]",
          "2:   <%- for slug, display_name, arch in build_ci_deps_listing[\"windows\"] %>",
          "4:   <{ slug.replace(\".\", \"\") }>-ci-deps:",
          "5:     <%- do test_salt_needs.append(slug.replace(\".\", \"\") + \"-ci-deps\") %>",
          "6:     name: <{ display_name }> Deps",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "14:     <%- else %>",
          "15:       - download-onedir-artifact",
          "16:     <%- endif %>",
          "18:     with:",
          "20:       nox-session: ci-test-onedir",
          "21:       platform: windows",
          "23:       nox-version: <{ nox_version  }>",
          "24:       python-version: \"<{ gh_actions_workflows_python_version }>\"",
          "25:       salt-version: \"${{ needs.prepare-workflow.outputs.salt-version }}\"",
          "",
          "[Removed Lines]",
          "17:     uses: ./.github/workflows/build-deps-ci-action.yml",
          "19:       distro-slug: <{ slug }>",
          "22:       arch: amd64",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "28:   <%- endfor %>",
          "36:     <%- if workflow_slug != 'release' %>",
          "37:     if: ${{ fromJSON(needs.prepare-workflow.outputs.jobs)['build-deps-ci'] && fromJSON(needs.prepare-workflow.outputs.runners)['github-hosted'] }}",
          "38:     <%- endif %>",
          "",
          "[Removed Lines]",
          "31:   <%- for slug, display_name, arch in build_ci_deps_listing[\"macos\"] %>",
          "33:   <{ slug.replace(\".\", \"\") }>-ci-deps:",
          "34:     <%- do test_salt_needs.append(slug.replace(\".\", \"\") + \"-ci-deps\") %>",
          "35:     name: <{ display_name }> Deps",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "45:     <%- endif %>",
          "46:     uses: ./.github/workflows/build-deps-ci-action-macos.yml",
          "47:     with:",
          "49:       nox-session: ci-test-onedir",
          "50:       platform: darwin",
          "51:       arch: <{ arch }>",
          "",
          "[Removed Lines]",
          "48:       distro-slug: <{ slug }>",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "57:   <%- endfor %>",
          "65:     <%- if workflow_slug != 'release' %>",
          "66:     if: ${{ fromJSON(needs.prepare-workflow.outputs.jobs)['build-deps-ci'] && fromJSON(needs.prepare-workflow.outputs.runners)['self-hosted'] }}",
          "67:     <%- endif %>",
          "",
          "[Removed Lines]",
          "60:   <%- for slug, display_name, arch in build_ci_deps_listing[\"linux\"] %>",
          "62:   <{ slug.replace(\".\", \"\") }>-ci-deps:",
          "63:     <%- do test_salt_needs.append(slug.replace(\".\", \"\") + \"-ci-deps\") %>",
          "64:     name: <{ display_name }> Deps",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "72:     <%- else %>",
          "73:       - download-onedir-artifact",
          "74:     <%- endif %>",
          "76:     with:",
          "78:       nox-session: ci-test-onedir",
          "79:       platform: linux",
          "80:       arch: <{ arch }>",
          "",
          "[Removed Lines]",
          "75:     uses: ./.github/workflows/build-deps-ci-action.yml",
          "77:       distro-slug: <{ slug }>",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        ".github/workflows/templates/test-package-downloads-action.yml.jinja||.githuworkflows/templates/test-package-downloads-action.yml.jinja": [
          "File: .github/workflows/templates/test-package-downloads-action.yml.jinja -> .githuworkflows/templates/test-package-downloads-action.yml.jinja",
          "--- Hunk 1 ---",
          "[Context before]",
          "94:           cd artifacts",
          "95:           tar xvf ${{ inputs.package-name }}-${{ inputs.salt-version }}-onedir-linux-${{ matrix.arch == 'arm64' && 'aarch64' || matrix.arch }}.tar.xz",
          "98:         uses: actions/cache@v3.3.1",
          "99:         with:",
          "102:               hashFiles('requirements/**/*.txt', 'cicd/golden-images.json', 'noxfile.py')",
          "103:             }}",
          "104:           # If we get a cache miss here it means the dependencies step failed to save the cache",
          "",
          "[Removed Lines]",
          "97:       - name: Download cached nox.${{ matrix.distro-slug }}.tar.* for session ${{ inputs.nox-session }}",
          "100:           path: nox.${{ matrix.distro-slug }}.tar.*",
          "101:           key: ${{ inputs.cache-prefix }}|testrun-deps|${{ matrix.arch == 'arm64' && 'aarch64' || matrix.arch }}|${{ matrix.distro-slug }}|${{ inputs.nox-session }}|${{ inputs.python-version }}|${{",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "342:         run: |",
          "343:           python3 -m pip install 'nox==${{ inputs.nox-version }}'",
          "346:         uses: actions/cache@v3.3.1",
          "347:         with:",
          "350:               hashFiles('requirements/**/*.txt', 'cicd/golden-images.json', 'noxfile.py')",
          "351:             }}",
          "352:           # If we get a cache miss here it means the dependencies step failed to save the cache",
          "",
          "[Removed Lines]",
          "345:       - name: Download cached nox.${{ matrix.distro-slug }}.tar.* for session ${{ inputs.nox-session }}",
          "348:           path: nox.${{ matrix.distro-slug }}.tar.*",
          "349:           key: ${{ inputs.cache-prefix }}|testrun-deps|${{ matrix.arch == 'arm64' && 'aarch64' || matrix.arch }}|${{ matrix.distro-slug }}|${{ inputs.nox-session }}|${{ inputs.python-version }}|${{",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "355:       - name: Decompress .nox Directory",
          "356:         run: |",
          "359:       - name: Show System Info & Test Plan",
          "360:         env:",
          "",
          "[Removed Lines]",
          "357:           nox --force-color -e decompress-dependencies -- ${{ matrix.distro-slug }}",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "545:           cd artifacts",
          "546:           tar xvf ${{ inputs.package-name }}-${{ inputs.salt-version }}-onedir-windows-${{ matrix.arch }}.tar.xz",
          "549:         uses: actions/cache@v3.3.1",
          "550:         with:",
          "553:               hashFiles('requirements/**/*.txt', 'cicd/golden-images.json', 'noxfile.py')",
          "554:             }}",
          "555:           # If we get a cache miss here it means the dependencies step failed to save the cache",
          "",
          "[Removed Lines]",
          "548:       - name: Download cached nox.${{ matrix.distro-slug }}.tar.* for session ${{ inputs.nox-session }}",
          "551:           path: nox.${{ matrix.distro-slug }}.tar.*",
          "552:           key: ${{ inputs.cache-prefix }}|testrun-deps|${{ matrix.arch }}|${{ matrix.distro-slug }}|${{ inputs.nox-session }}|${{ inputs.python-version }}|${{",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        ".github/workflows/templates/test-salt-pkg.yml.jinja||.githuworkflows/templates/test-salt-pkg.yml.jinja": [
          "File: .github/workflows/templates/test-salt-pkg.yml.jinja -> .githuworkflows/templates/test-salt-pkg.yml.jinja",
          "--- Hunk 1 ---",
          "[Context before]",
          "8:     needs:",
          "9:       - prepare-workflow",
          "10:       - build-<{ pkg_type }>-pkgs-onedir",
          "13:     with:",
          "14:       distro-slug: <{ slug }>",
          "15:       nox-session: ci-test-onedir",
          "",
          "[Removed Lines]",
          "11:       - <{ slug.replace(\".\", \"\") }>-ci-deps",
          "12:     uses: ./.github/workflows/test-packages-action.yml",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "41:     needs:",
          "42:       - prepare-workflow",
          "43:       - build-macos-pkgs-onedir",
          "45:     uses: ./.github/workflows/test-packages-action-macos.yml",
          "46:     with:",
          "47:       distro-slug: <{ slug }>",
          "",
          "[Removed Lines]",
          "44:       - <{ slug.replace(\".\", \"\") }>-ci-deps",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "71:     needs:",
          "72:       - prepare-workflow",
          "73:       - build-windows-pkgs-onedir",
          "76:     with:",
          "77:       distro-slug: <{ slug }>",
          "78:       nox-session: ci-test-onedir",
          "",
          "[Removed Lines]",
          "74:       - <{ slug.replace(\".\", \"\") }>-ci-deps",
          "75:     uses: ./.github/workflows/test-packages-action.yml",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        ".github/workflows/templates/test-salt.yml.jinja||.githuworkflows/templates/test-salt.yml.jinja": [
          "File: .github/workflows/templates/test-salt.yml.jinja -> .githuworkflows/templates/test-salt.yml.jinja",
          "--- Hunk 1 ---",
          "[Context before]",
          "12:     if: ${{ fromJSON(needs.prepare-workflow.outputs.jobs)['test'] && fromJSON(needs.prepare-workflow.outputs.runners)['self-hosted'] }}",
          "13:     needs:",
          "14:       - prepare-workflow",
          "17:     with:",
          "18:       distro-slug: <{ slug }>",
          "19:       nox-session: ci-test-onedir",
          "",
          "[Removed Lines]",
          "15:       - <{ slug.replace(\".\", \"\") }>-ci-deps",
          "16:     uses: ./.github/workflows/test-action.yml",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "40:     if: ${{ fromJSON(needs.prepare-workflow.outputs.jobs)['test'] && fromJSON(needs.prepare-workflow.outputs.runners)['github-hosted'] }}",
          "41:     needs:",
          "42:       - prepare-workflow",
          "44:     uses: ./.github/workflows/test-action-macos.yml",
          "45:     with:",
          "46:       distro-slug: <{ slug }>",
          "",
          "[Removed Lines]",
          "43:       - <{ slug.replace(\".\", \"\") }>-ci-deps",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "67:     if: ${{ fromJSON(needs.prepare-workflow.outputs.jobs)['test'] && fromJSON(needs.prepare-workflow.outputs.runners)['self-hosted'] }}",
          "68:     needs:",
          "69:       - prepare-workflow",
          "72:     with:",
          "73:       distro-slug: <{ slug }>",
          "74:       nox-session: ci-test-onedir",
          "",
          "[Removed Lines]",
          "70:       - <{ slug.replace(\".\", \"\") }>-ci-deps",
          "71:     uses: ./.github/workflows/test-action.yml",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "noxfile.py||noxfile.py": [
          "File: noxfile.py -> noxfile.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "1218: def decompress_dependencies(session):",
          "1219:     if not session.posargs:",
          "1220:         session.error(",
          "1223:         )",
          "1227:     else:",
          "1229:     nox_dependencies_tarball_path = REPO_ROOT / nox_dependencies_tarball",
          "1230:     if not nox_dependencies_tarball_path.exists():",
          "1231:         session.error(",
          "",
          "[Removed Lines]",
          "1221:             \"Please pass the distro-slug to run tests against. \"",
          "1222:             \"Check cicd/images.yml for what's available.\"",
          "1224:     distro_slug = session.posargs.pop(0)",
          "1225:     if \"windows\" in distro_slug:",
          "1226:         nox_dependencies_tarball = f\"nox.{distro_slug}.tar.gz\"",
          "1228:         nox_dependencies_tarball = f\"nox.{distro_slug}.tar.xz\"",
          "",
          "[Added Lines]",
          "1221:             \"The 'decompress-dependencies' session target needs \"",
          "1222:             \"two arguments, '<platform> <arch>'.\"",
          "1224:     try:",
          "1225:         platform = session.posargs.pop(0)",
          "1226:         arch = session.posargs.pop(0)",
          "1227:         if session.posargs:",
          "1228:             session.error(",
          "1229:                 \"The 'decompress-dependencies' session target only accepts \"",
          "1230:                 \"two arguments, '<platform> <arch>'.\"",
          "1231:             )",
          "1232:     except IndexError:",
          "1233:         session.error(",
          "1234:             \"The 'decompress-dependencies' session target needs \"",
          "1235:             \"two arguments, '<platform> <arch>'.\"",
          "1236:         )",
          "1237:     if platform == \"windows\":",
          "1238:         extension = \"tar.gz\"",
          "1239:         scripts_dir_name = \"Scripts\"",
          "1241:         extension = \"tar.xz\"",
          "1242:         scripts_dir_name = \"bin\"",
          "1243:     nox_dependencies_tarball = f\"nox.{platform}.{arch}.{extension}\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1240:     session.log(\"Finding broken 'python' symlinks under '.nox/' ...\")",
          "1241:     for dirname in os.scandir(REPO_ROOT / \".nox\"):",
          "1246:         script_paths = {str(p): p for p in os.scandir(scan_path)}",
          "1247:         fixed_shebang = f\"#!{scan_path / 'python'}\"",
          "1248:         for key in sorted(script_paths):",
          "",
          "[Removed Lines]",
          "1242:         if \"windows\" not in distro_slug:",
          "1243:             scan_path = REPO_ROOT.joinpath(\".nox\", dirname, \"bin\")",
          "1244:         else:",
          "1245:             scan_path = REPO_ROOT.joinpath(\".nox\", dirname, \"Scripts\")",
          "",
          "[Added Lines]",
          "1257:         scan_path = REPO_ROOT.joinpath(\".nox\", dirname, scripts_dir_name)",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1273:                 continue",
          "1274:             if not path.is_file():",
          "1275:                 continue",
          "1277:                 # Let's try to fix shebang's",
          "1278:                 try:",
          "1279:                     fpath = pathlib.Path(path)",
          "",
          "[Removed Lines]",
          "1276:             if \"windows\" not in distro_slug:",
          "",
          "[Added Lines]",
          "1288:             if platform != \"windows\":",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1296: def compress_dependencies(session):",
          "1297:     if not session.posargs:",
          "1298:         session.error(",
          "1301:         )",
          "1305:     else:",
          "1307:     nox_dependencies_tarball_path = REPO_ROOT / nox_dependencies_tarball",
          "1308:     if nox_dependencies_tarball_path.exists():",
          "1309:         session_warn(",
          "",
          "[Removed Lines]",
          "1299:             \"Please pass the distro-slug to run tests against. \"",
          "1300:             \"Check cicd/images.yml for what's available.\"",
          "1302:     distro_slug = session.posargs.pop(0)",
          "1303:     if IS_WINDOWS:",
          "1304:         nox_dependencies_tarball = f\"nox.{distro_slug}.tar.gz\"",
          "1306:         nox_dependencies_tarball = f\"nox.{distro_slug}.tar.xz\"",
          "",
          "[Added Lines]",
          "1311:             \"The 'compress-dependencies' session target needs \"",
          "1312:             \"two arguments, '<platform> <arch>'.\"",
          "1314:     try:",
          "1315:         platform = session.posargs.pop(0)",
          "1316:         arch = session.posargs.pop(0)",
          "1317:         if session.posargs:",
          "1318:             session.error(",
          "1319:                 \"The 'compress-dependencies' session target only accepts \"",
          "1320:                 \"two arguments, '<platform> <arch>'.\"",
          "1321:             )",
          "1322:     except IndexError:",
          "1323:         session.error(",
          "1324:             \"The 'compress-dependencies' session target needs \"",
          "1325:             \"two arguments, '<platform> <arch>'.\"",
          "1326:         )",
          "1327:     if platform == \"windows\":",
          "1328:         extension = \"tar.gz\"",
          "1330:         extension = \"tar.xz\"",
          "1331:     nox_dependencies_tarball = f\"nox.{platform}.{arch}.{extension}\"",
          "",
          "---------------"
        ],
        "tools/precommit/workflows.py||tools/precommit/workflows.py": [
          "File: tools/precommit/workflows.py -> tools/precommit/workflows.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "88:             \"template\": \"test-package-downloads-action.yml\",",
          "89:         },",
          "90:     }",
          "92:         \"linux\": [",
          "93:             (\"almalinux-8\", \"Alma Linux 8\", \"x86_64\", \"no-fips\"),",
          "94:             (\"almalinux-9\", \"Alma Linux 9\", \"x86_64\", \"no-fips\"),",
          "95:             (\"amazonlinux-2\", \"Amazon Linux 2\", \"x86_64\", \"no-fips\"),",
          "97:             (\"amazonlinux-2023\", \"Amazon Linux 2023\", \"x86_64\", \"no-fips\"),",
          "99:             (\"archlinux-lts\", \"Arch Linux LTS\", \"x86_64\", \"no-fips\"),",
          "100:             (\"centos-7\", \"CentOS 7\", \"x86_64\", \"no-fips\"),",
          "101:             (\"centosstream-8\", \"CentOS Stream 8\", \"x86_64\", \"no-fips\"),",
          "102:             (\"centosstream-9\", \"CentOS Stream 9\", \"x86_64\", \"no-fips\"),",
          "103:             (\"debian-10\", \"Debian 10\", \"x86_64\", \"no-fips\"),",
          "104:             (\"debian-11\", \"Debian 11\", \"x86_64\", \"no-fips\"),",
          "106:             (\"debian-12\", \"Debian 12\", \"x86_64\", \"no-fips\"),",
          "108:             (\"fedora-37\", \"Fedora 37\", \"x86_64\", \"no-fips\"),",
          "109:             (\"fedora-38\", \"Fedora 38\", \"x86_64\", \"no-fips\"),",
          "110:             (\"opensuse-15\", \"Opensuse 15\", \"x86_64\", \"no-fips\"),",
          "111:             (\"photonos-3\", \"Photon OS 3\", \"x86_64\", \"no-fips\"),",
          "113:             (\"photonos-4\", \"Photon OS 4\", \"x86_64\", \"fips\"),",
          "115:             (\"photonos-5\", \"Photon OS 5\", \"x86_64\", \"fips\"),",
          "117:             (\"ubuntu-20.04\", \"Ubuntu 20.04\", \"x86_64\", \"no-fips\"),",
          "119:             (\"ubuntu-22.04\", \"Ubuntu 22.04\", \"x86_64\", \"no-fips\"),",
          "121:         ],",
          "122:         \"macos\": [",
          "123:             (\"macos-12\", \"macOS 12\", \"x86_64\"),",
          "124:             (\"macos-13\", \"macOS 13\", \"x86_64\"),",
          "126:         ],",
          "127:         \"windows\": [",
          "128:             (\"windows-2016\", \"Windows 2016\", \"amd64\"),",
          "",
          "[Removed Lines]",
          "91:     test_salt_listing = {",
          "96:             (\"amazonlinux-2-arm64\", \"Amazon Linux 2 Arm64\", \"aarch64\", \"no-fips\"),",
          "98:             (\"amazonlinux-2023-arm64\", \"Amazon Linux 2023 Arm64\", \"aarch64\", \"no-fips\"),",
          "105:             (\"debian-11-arm64\", \"Debian 11 Arm64\", \"aarch64\", \"no-fips\"),",
          "107:             (\"debian-12-arm64\", \"Debian 12 Arm64\", \"aarch64\", \"no-fips\"),",
          "112:             (\"photonos-3-arm64\", \"Photon OS 3 Arm64\", \"aarch64\", \"no-fips\"),",
          "114:             (\"photonos-4-arm64\", \"Photon OS 4 Arm64\", \"aarch64\", \"fips\"),",
          "116:             (\"photonos-5-arm64\", \"Photon OS 5 Arm64\", \"aarch64\", \"fips\"),",
          "118:             (\"ubuntu-20.04-arm64\", \"Ubuntu 20.04 Arm64\", \"aarch64\", \"no-fips\"),",
          "120:             (\"ubuntu-22.04-arm64\", \"Ubuntu 22.04 Arm64\", \"aarch64\", \"no-fips\"),",
          "125:             (\"macos-13-xlarge\", \"macOS 13 Arm64\", \"aarch64\"),",
          "",
          "[Added Lines]",
          "91:     test_salt_listing: dict[str, list[tuple[str, ...]]] = {",
          "96:             (\"amazonlinux-2-arm64\", \"Amazon Linux 2 Arm64\", \"arm64\", \"no-fips\"),",
          "98:             (\"amazonlinux-2023-arm64\", \"Amazon Linux 2023 Arm64\", \"arm64\", \"no-fips\"),",
          "105:             (\"debian-11-arm64\", \"Debian 11 Arm64\", \"arm64\", \"no-fips\"),",
          "107:             (\"debian-12-arm64\", \"Debian 12 Arm64\", \"arm64\", \"no-fips\"),",
          "112:             (\"photonos-3-arm64\", \"Photon OS 3 Arm64\", \"arm64\", \"no-fips\"),",
          "114:             (\"photonos-4-arm64\", \"Photon OS 4 Arm64\", \"arm64\", \"fips\"),",
          "116:             (\"photonos-5-arm64\", \"Photon OS 5 Arm64\", \"arm64\", \"fips\"),",
          "118:             (\"ubuntu-20.04-arm64\", \"Ubuntu 20.04 Arm64\", \"arm64\", \"no-fips\"),",
          "120:             (\"ubuntu-22.04-arm64\", \"Ubuntu 22.04 Arm64\", \"arm64\", \"no-fips\"),",
          "125:             (\"macos-13-xlarge\", \"macOS 13 Arm64\", \"arm64\"),",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "137:             (",
          "138:                 \"amazonlinux-2-arm64\",",
          "139:                 \"Amazon Linux 2 Arm64\",",
          "141:                 \"rpm\",",
          "142:                 \"no-fips\",",
          "143:             ),",
          "",
          "[Removed Lines]",
          "140:                 \"aarch64\",",
          "",
          "[Added Lines]",
          "140:                 \"arm64\",",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "145:             (",
          "146:                 \"amazonlinux-2023-arm64\",",
          "147:                 \"Amazon Linux 2023 Arm64\",",
          "149:                 \"rpm\",",
          "150:                 \"no-fips\",",
          "151:             ),",
          "",
          "[Removed Lines]",
          "148:                 \"aarch64\",",
          "",
          "[Added Lines]",
          "148:                 \"arm64\",",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "155:             (",
          "156:                 \"centosstream-9-arm64\",",
          "157:                 \"CentOS Stream 9 Arm64\",",
          "159:                 \"rpm\",",
          "160:                 \"no-fips\",",
          "161:             ),",
          "162:             (\"debian-10\", \"Debian 10\", \"x86_64\", \"deb\", \"no-fips\"),",
          "163:             (\"debian-11\", \"Debian 11\", \"x86_64\", \"deb\", \"no-fips\"),",
          "165:             (\"debian-12\", \"Debian 12\", \"x86_64\", \"deb\", \"no-fips\"),",
          "167:             (\"photonos-3\", \"Photon OS 3\", \"x86_64\", \"rpm\", \"no-fips\"),",
          "169:             (\"photonos-4\", \"Photon OS 4\", \"x86_64\", \"rpm\", \"fips\"),",
          "171:             (\"photonos-5\", \"Photon OS 5\", \"x86_64\", \"rpm\", \"fips\"),",
          "173:             (\"ubuntu-20.04\", \"Ubuntu 20.04\", \"x86_64\", \"deb\", \"no-fips\"),",
          "175:             (\"ubuntu-22.04\", \"Ubuntu 22.04\", \"x86_64\", \"deb\", \"no-fips\"),",
          "177:         ],",
          "178:         \"macos\": [",
          "179:             (\"macos-12\", \"macOS 12\", \"x86_64\"),",
          "180:             (\"macos-13\", \"macOS 13\", \"x86_64\"),",
          "182:         ],",
          "183:         \"windows\": [",
          "184:             (\"windows-2016\", \"Windows 2016\", \"amd64\"),",
          "",
          "[Removed Lines]",
          "158:                 \"aarch64\",",
          "164:             (\"debian-11-arm64\", \"Debian 11 Arm64\", \"aarch64\", \"deb\", \"no-fips\"),",
          "166:             (\"debian-12-arm64\", \"Debian 12 Arm64\", \"aarch64\", \"deb\", \"no-fips\"),",
          "168:             (\"photonos-3-arm64\", \"Photon OS 3 Arm64\", \"aarch64\", \"rpm\", \"no-fips\"),",
          "170:             (\"photonos-4-arm64\", \"Photon OS 4 Arm64\", \"aarch64\", \"rpm\", \"fips\"),",
          "172:             (\"photonos-5-arm64\", \"Photon OS 5 Arm64\", \"aarch64\", \"rpm\", \"fips\"),",
          "174:             (\"ubuntu-20.04-arm64\", \"Ubuntu 20.04 Arm64\", \"aarch64\", \"deb\", \"no-fips\"),",
          "176:             (\"ubuntu-22.04-arm64\", \"Ubuntu 22.04 Arm64\", \"aarch64\", \"deb\", \"no-fips\"),",
          "181:             (\"macos-13-xlarge\", \"macOS 13 Arm64\", \"aarch64\"),",
          "",
          "[Added Lines]",
          "158:                 \"arm64\",",
          "164:             (\"debian-11-arm64\", \"Debian 11 Arm64\", \"arm64\", \"deb\", \"no-fips\"),",
          "166:             (\"debian-12-arm64\", \"Debian 12 Arm64\", \"arm64\", \"deb\", \"no-fips\"),",
          "168:             (\"photonos-3-arm64\", \"Photon OS 3 Arm64\", \"arm64\", \"rpm\", \"no-fips\"),",
          "170:             (\"photonos-4-arm64\", \"Photon OS 4 Arm64\", \"arm64\", \"rpm\", \"fips\"),",
          "172:             (\"photonos-5-arm64\", \"Photon OS 5 Arm64\", \"arm64\", \"rpm\", \"fips\"),",
          "174:             (\"ubuntu-20.04-arm64\", \"Ubuntu 20.04 Arm64\", \"arm64\", \"deb\", \"no-fips\"),",
          "176:             (\"ubuntu-22.04-arm64\", \"Ubuntu 22.04 Arm64\", \"arm64\", \"deb\", \"no-fips\"),",
          "181:             (\"macos-13-xlarge\", \"macOS 13 Arm64\", \"arm64\"),",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "190:     build_ci_deps_listing = {",
          "191:         \"linux\": [",
          "227:         ],",
          "228:         \"macos\": [",
          "232:         ],",
          "233:         \"windows\": [",
          "237:         ],",
          "238:     }",
          "239:     test_salt_pkg_downloads_listing: dict[str, list[tuple[str, str, str]]] = {",
          "",
          "[Removed Lines]",
          "192:             (\"almalinux-8\", \"Alma Linux 8\", \"x86_64\"),",
          "193:             (\"almalinux-8-arm64\", \"Alma Linux 8 Arm64\", \"aarch64\"),",
          "194:             (\"almalinux-9\", \"Alma Linux 9\", \"x86_64\"),",
          "195:             (\"almalinux-9-arm64\", \"Alma Linux 9 Arm64\", \"aarch64\"),",
          "196:             (\"amazonlinux-2\", \"Amazon Linux 2\", \"x86_64\"),",
          "197:             (\"amazonlinux-2-arm64\", \"Amazon Linux 2 Arm64\", \"aarch64\"),",
          "198:             (\"amazonlinux-2023\", \"Amazon Linux 2023\", \"x86_64\"),",
          "199:             (\"amazonlinux-2023-arm64\", \"Amazon Linux 2023 Arm64\", \"aarch64\"),",
          "200:             (\"archlinux-lts\", \"Arch Linux LTS\", \"x86_64\"),",
          "201:             (\"centos-7\", \"CentOS 7\", \"x86_64\"),",
          "202:             (\"centos-7-arm64\", \"CentOS 7 Arm64\", \"aarch64\"),",
          "203:             (\"centosstream-8\", \"CentOS Stream 8\", \"x86_64\"),",
          "204:             (\"centosstream-8-arm64\", \"CentOS Stream 8 Arm64\", \"aarch64\"),",
          "205:             (\"centosstream-9\", \"CentOS Stream 9\", \"x86_64\"),",
          "206:             (\"centosstream-9-arm64\", \"CentOS Stream 9 Arm64\", \"aarch64\"),",
          "207:             (\"debian-10\", \"Debian 10\", \"x86_64\"),",
          "208:             (\"debian-11\", \"Debian 11\", \"x86_64\"),",
          "209:             (\"debian-11-arm64\", \"Debian 11 Arm64\", \"aarch64\"),",
          "210:             (\"debian-12\", \"Debian 12\", \"x86_64\"),",
          "211:             (\"debian-12-arm64\", \"Debian 12 Arm64\", \"aarch64\"),",
          "212:             (\"fedora-37\", \"Fedora 37\", \"x86_64\"),",
          "213:             (\"fedora-37-arm64\", \"Fedora 37 Arm64\", \"aarch64\"),",
          "214:             (\"fedora-38\", \"Fedora 38\", \"x86_64\"),",
          "215:             (\"fedora-38-arm64\", \"Fedora 38 Arm64\", \"aarch64\"),",
          "216:             (\"opensuse-15\", \"Opensuse 15\", \"x86_64\"),",
          "217:             (\"photonos-3\", \"Photon OS 3\", \"x86_64\"),",
          "218:             (\"photonos-3-arm64\", \"Photon OS 3 Arm64\", \"aarch64\"),",
          "219:             (\"photonos-4\", \"Photon OS 4\", \"x86_64\"),",
          "220:             (\"photonos-4-arm64\", \"Photon OS 4 Arm64\", \"aarch64\"),",
          "221:             (\"photonos-5\", \"Photon OS 5\", \"x86_64\"),",
          "222:             (\"photonos-5-arm64\", \"Photon OS 5 Arm64\", \"aarch64\"),",
          "223:             (\"ubuntu-20.04\", \"Ubuntu 20.04\", \"x86_64\"),",
          "224:             (\"ubuntu-20.04-arm64\", \"Ubuntu 20.04 Arm64\", \"aarch64\"),",
          "225:             (\"ubuntu-22.04\", \"Ubuntu 22.04\", \"x86_64\"),",
          "226:             (\"ubuntu-22.04-arm64\", \"Ubuntu 22.04 Arm64\", \"aarch64\"),",
          "229:             (\"macos-12\", \"macOS 12\", \"x86_64\"),",
          "230:             (\"macos-13\", \"macOS 13\", \"x86_64\"),",
          "231:             (\"macos-13-xlarge\", \"macOS 13 Arm64\", \"aarch64\"),",
          "234:             (\"windows-2016\", \"Windows 2016\", \"amd64\"),",
          "235:             (\"windows-2019\", \"Windows 2019\", \"amd64\"),",
          "236:             (\"windows-2022\", \"Windows 2022\", \"amd64\"),",
          "",
          "[Added Lines]",
          "192:             (\"x86_64\", \"centos-7\"),",
          "193:             (\"arm64\", \"centos-7-arm64\"),",
          "196:             (\"x86_64\", \"macos-12\"),",
          "197:             (\"arm64\", \"macos-13-xlarge\"),",
          "200:             (\"amd64\", \"windows-2022\"),",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "249:         \"fedora\",",
          "250:         \"photon\",",
          "251:     ]",
          "253:         if slug in (\"archlinux-lts\", \"opensuse-15\"):",
          "254:             continue",
          "255:         test_salt_pkg_downloads_listing[\"linux\"].append((slug, arch, \"package\"))",
          "265:         if slug in (\"archlinux-lts\", \"opensuse-15\"):",
          "266:             continue",
          "267:         test_salt_pkg_downloads_listing[\"linux\"].append((slug, arch, \"onedir\"))",
          "271:         test_salt_pkg_downloads_listing[\"macos\"].append((slug, arch, \"package\"))",
          "273:         test_salt_pkg_downloads_listing[\"macos\"].append((slug, arch, \"onedir\"))",
          "275:         for pkg_type in (\"nsis\", \"msi\", \"onedir\"):",
          "276:             test_salt_pkg_downloads_listing[\"windows\"].append((slug, arch, pkg_type))",
          "278:     test_salt_pkg_downloads_needs_slugs = set()",
          "279:     for platform in test_salt_pkg_downloads_listing:",
          "283:     env = Environment(",
          "284:         block_start_string=\"<%\",",
          "",
          "[Removed Lines]",
          "252:     for slug, display_name, arch in build_ci_deps_listing[\"linux\"]:",
          "256:         # Account for old arm64 repo paths",
          "257:         if arch == \"aarch64\":",
          "258:             for test_slug in rpm_slugs:",
          "259:                 if slug.startswith(test_slug):",
          "260:                     test_salt_pkg_downloads_listing[\"linux\"].append(",
          "261:                         (slug, \"arm64\", \"package\")",
          "262:                     )",
          "263:                     break",
          "264:     for slug, display_name, arch in build_ci_deps_listing[\"linux\"][-2:]:",
          "268:     for slug, display_name, arch in build_ci_deps_listing[\"macos\"]:",
          "269:         if arch == \"aarch64\":",
          "270:             arch = \"arm64\"",
          "272:     for slug, display_name, arch in build_ci_deps_listing[\"macos\"][-1:]:",
          "274:     for slug, display_name, arch in build_ci_deps_listing[\"windows\"][-1:]:",
          "280:         for slug, _, _ in test_salt_pkg_downloads_listing[platform]:",
          "281:             test_salt_pkg_downloads_needs_slugs.add(f\"{slug.replace('.', '')}-ci-deps\")",
          "",
          "[Added Lines]",
          "216:     for slug, display_name, arch, fips in test_salt_listing[\"linux\"]:",
          "220:     for slug, display_name, arch, fips in test_salt_listing[\"linux\"][-2:]:",
          "224:     for slug, display_name, arch in test_salt_listing[\"macos\"]:",
          "226:     for slug, display_name, arch in test_salt_listing[\"macos\"][-1:]:",
          "228:     for slug, display_name, arch in test_salt_listing[\"windows\"][-1:]:",
          "234:         for _, arch, _ in test_salt_pkg_downloads_listing[platform]:",
          "235:             test_salt_pkg_downloads_needs_slugs.add(f\"{platform}-{arch}-ci-deps\")",
          "",
          "---------------"
        ],
        "tools/utils/__init__.py||tools/utils/__init__.py": [
          "File: tools/utils/__init__.py -> tools/utils/__init__.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "259:                     if chunk:",
          "260:                         f.write(chunk)",
          "261:     return dest",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "264: def get_platform_and_arch_from_slug(slug: str) -> tuple[str, str]:",
          "265:     if \"windows\" in slug:",
          "266:         platform = \"windows\"",
          "267:         arch = \"amd64\"",
          "268:     elif \"macos\" in slug:",
          "269:         platform = \"macos\"",
          "270:         if \"macos-13\" in slug and \"xlarge\" in slug:",
          "271:             arch = \"arm64\"",
          "272:         else:",
          "273:             arch = \"x86_64\"",
          "274:     else:",
          "275:         platform = \"linux\"",
          "276:         if \"arm64\" in slug:",
          "277:             arch = \"arm64\"",
          "278:         elif \"aarch64\" in slug:",
          "279:             arch = \"arm64\"",
          "280:         else:",
          "281:             arch = \"x86_64\"",
          "282:     return platform, arch",
          "",
          "---------------"
        ],
        "tools/vm.py||tools/vm.py": [
          "File: tools/vm.py -> tools/vm.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "1468:         \"\"\"",
          "1469:         Compress .nox/ into nox.<vm-name>.tar.* in the VM",
          "1470:         \"\"\"",
          "1473:     def decompress_dependencies(self):",
          "1474:         \"\"\"",
          "1475:         Decompress nox.<vm-name>.tar.* if it exists in the VM",
          "1476:         \"\"\"",
          "1477:         env = {\"DELETE_NOX_ARCHIVE\": \"1\"}",
          "1478:         return self.run_nox(",
          "1480:         )",
          "1482:     def download_dependencies(self):",
          "",
          "[Removed Lines]",
          "1471:         return self.run_nox(\"compress-dependencies\", session_args=[self.name])",
          "1479:             \"decompress-dependencies\", session_args=[self.name], env=env",
          "",
          "[Added Lines]",
          "1471:         platform, arch = tools.utils.get_platform_and_arch_from_slug(self.name)",
          "1472:         return self.run_nox(\"compress-dependencies\", session_args=[platform, arch])",
          "1479:         platform, arch = tools.utils.get_platform_and_arch_from_slug(self.name)",
          "1481:             \"decompress-dependencies\", session_args=[platform, arch], env=env",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1484:         Download nox.<vm-name>.tar.* from VM",
          "1485:         \"\"\"",
          "1486:         if self.is_windows:",
          "1488:         else:",
          "1490:         remote_path = self.upload_path.joinpath(dependencies_filename).as_posix()",
          "1491:         if self.is_windows:",
          "1492:             for drive in (\"c:\", \"C:\"):",
          "",
          "[Removed Lines]",
          "1487:             dependencies_filename = f\"nox.{self.name}.tar.gz\"",
          "1489:             dependencies_filename = f\"nox.{self.name}.tar.xz\"",
          "",
          "[Added Lines]",
          "1489:             extension = \"tar.gz\"",
          "1491:             extension = \"tar.xz\"",
          "1492:         platform, arch = tools.utils.get_platform_and_arch_from_slug(self.name)",
          "1493:         dependencies_filename = f\"nox.{platform}.{arch}.{extension}\"",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "a50f99a159bac9e57efb025c0d254a2df73d4c14",
      "candidate_info": {
        "commit_hash": "a50f99a159bac9e57efb025c0d254a2df73d4c14",
        "repo": "saltstack/salt",
        "commit_url": "https://github.com/saltstack/salt/commit/a50f99a159bac9e57efb025c0d254a2df73d4c14",
        "files": [
          ".github/workflows/ci.yml",
          ".github/workflows/lint-action.yml",
          ".github/workflows/nightly.yml",
          ".github/workflows/pre-commit-action.yml",
          ".github/workflows/release-tag.yml",
          ".github/workflows/release-update-winrepo.yml",
          ".github/workflows/release.yml",
          ".github/workflows/scheduled.yml",
          ".github/workflows/staging.yml",
          ".github/workflows/templates/ci.yml.jinja",
          ".github/workflows/templates/layout.yml.jinja",
          ".github/workflows/templates/nightly.yml.jinja",
          ".github/workflows/templates/release.yml.jinja",
          ".github/workflows/templates/staging.yml.jinja",
          ".github/workflows/templates/trigger-branch-workflows.yml.jinja",
          ".github/workflows/templates/workflow-requirements-check.yml.jinja",
          ".github/workflows/test-action-macos.yml",
          ".github/workflows/test-packages-action-macos.yml",
          ".github/workflows/triage.yml"
        ],
        "message": "Prefer GitHub hosted actions runners\n\nSigned-off-by: Pedro Algarvio <palgarvio@vmware.com>",
        "before_after_code_files": [
          ".github/workflows/templates/ci.yml.jinja||.githuworkflows/templates/ci.yml.jinja",
          ".github/workflows/templates/layout.yml.jinja||.githuworkflows/templates/layout.yml.jinja",
          ".github/workflows/templates/nightly.yml.jinja||.githuworkflows/templates/nightly.yml.jinja",
          ".github/workflows/templates/release.yml.jinja||.githuworkflows/templates/release.yml.jinja",
          ".github/workflows/templates/staging.yml.jinja||.githuworkflows/templates/staging.yml.jinja",
          ".github/workflows/templates/trigger-branch-workflows.yml.jinja||.githuworkflows/templates/trigger-branch-workflows.yml.jinja",
          ".github/workflows/templates/workflow-requirements-check.yml.jinja||.githuworkflows/templates/workflow-requirements-check.yml.jinja"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/saltstack/salt/pull/65969"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        ".github/workflows/templates/ci.yml.jinja||.githuworkflows/templates/ci.yml.jinja": [
          "File: .github/workflows/templates/ci.yml.jinja -> .githuworkflows/templates/ci.yml.jinja",
          "--- Hunk 1 ---",
          "[Context before]",
          "52:       - x86_64",
          "53:     <%- else %>",
          "54:     if: ${{ fromJSON(needs.prepare-workflow.outputs.jobs)['<{ job_name }>'] && fromJSON(needs.prepare-workflow.outputs.runners)['github-hosted'] }}",
          "56:     <%- endif %>",
          "57:     needs:",
          "58:       - prepare-workflow",
          "",
          "[Removed Lines]",
          "55:     runs-on: ${{ github.event.repository.private && fromJSON('[\"self-hosted\", \"linux\", \"medium\", \"x86_64\"]') || 'ubuntu-latest' }}",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "205:     needs:",
          "206:       - prepare-workflow",
          "207:       - prepare-release",
          "209:     steps:",
          "210:       - uses: actions/checkout@v4",
          "",
          "[Removed Lines]",
          "208:     runs-on: ${{ github.event.repository.private && fromJSON('[\"self-hosted\", \"linux\", \"medium\", \"x86_64\"]') || 'ubuntu-latest' }}",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "309:     <%- do conclusion_needs.append(\"combine-all-code-coverage\") %>",
          "310:     name: Combine Code Coverage",
          "311:     if: ${{ fromJSON(needs.prepare-workflow.outputs.testrun)['skip_code_coverage'] == false }}",
          "313:     needs:",
          "314:       - prepare-workflow",
          "315:       <%- for need in test_salt_needs.iter(consume=False) %>",
          "",
          "[Removed Lines]",
          "312:     runs-on: ${{ github.event.repository.private && fromJSON('[\"self-hosted\", \"linux\", \"x86_64\"]') || 'ubuntu-latest' }}",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "319:       - uses: actions/checkout@v4",
          "321:       - name: Set up Python 3.10",
          "323:         uses: actions/setup-python@v4",
          "324:         with:",
          "325:           python-version: \"3.10\"",
          "",
          "[Removed Lines]",
          "322:         if: ${{ github.event.repository.private == false }}",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        ".github/workflows/templates/layout.yml.jinja||.githuworkflows/templates/layout.yml.jinja": [
          "File: .github/workflows/templates/layout.yml.jinja -> .githuworkflows/templates/layout.yml.jinja",
          "--- Hunk 1 ---",
          "[Context before]",
          "76:   prepare-workflow:",
          "77:     name: Prepare Workflow Run",
          "79:     <%- if prepare_workflow_if_check %>",
          "80:     if: <{ prepare_workflow_if_check }>",
          "81:     <%- endif %>",
          "",
          "[Removed Lines]",
          "78:     runs-on: ${{ github.event.repository.private && fromJSON('[\"self-hosted\", \"linux\", \"x86_64\"]') || 'ubuntu-latest' }}",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "337:     # on a pull request instead of requiring all",
          "338:     name: Set the ${{ github.workflow }} Pipeline Exit Status",
          "339:     if: always()",
          "341:     <%- if workflow_slug == \"nightly\" %>",
          "342:     environment: <{ workflow_slug }>",
          "343:     <%- endif %>",
          "",
          "[Removed Lines]",
          "340:     runs-on: ${{ github.event.repository.private && fromJSON('[\"self-hosted\", \"linux\", \"x86_64\"]') || 'ubuntu-latest' }}",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        ".github/workflows/templates/nightly.yml.jinja||.githuworkflows/templates/nightly.yml.jinja": [
          "File: .github/workflows/templates/nightly.yml.jinja -> .githuworkflows/templates/nightly.yml.jinja",
          "--- Hunk 1 ---",
          "[Context before]",
          "58:   <%- do conclusion_needs.append('notify-slack') %>",
          "59:   notify-slack:",
          "60:     name: Notify Slack",
          "62:     environment: <{ gh_environment }>",
          "63:     needs:",
          "64:       <%- for need in prepare_workflow_needs.iter(consume=False) %>",
          "",
          "[Removed Lines]",
          "61:     runs-on: ${{ github.event.repository.private && fromJSON('[\"self-hosted\", \"linux\", \"x86_64\"]') || 'ubuntu-latest' }}",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        ".github/workflows/templates/release.yml.jinja||.githuworkflows/templates/release.yml.jinja": [
          "File: .github/workflows/templates/release.yml.jinja -> .githuworkflows/templates/release.yml.jinja",
          "--- Hunk 1 ---",
          "[Context before]",
          "52:   <{ job_name }>:",
          "53:   <%- do prepare_workflow_needs.append(job_name) %>",
          "54:     name: Check Requirements",
          "56:     environment: <{ gh_environment }>-check",
          "57:     steps:",
          "58:       - name: Check For Admin Permission",
          "",
          "[Removed Lines]",
          "55:     runs-on: ${{ github.event.repository.private && fromJSON('[\"self-hosted\", \"linux\", \"x86_64\"]') || 'ubuntu-latest' }}",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        ".github/workflows/templates/staging.yml.jinja||.githuworkflows/templates/staging.yml.jinja": [
          "File: .github/workflows/templates/staging.yml.jinja -> .githuworkflows/templates/staging.yml.jinja",
          "--- Hunk 1 ---",
          "[Context before]",
          "66:   <{ job_name }>:",
          "67:   <%- do prepare_workflow_needs.append(job_name) %>",
          "68:     name: Check Requirements",
          "70:     environment: <{ gh_environment }>-check",
          "71:     steps:",
          "72:       - name: Check For Admin Permission",
          "",
          "[Removed Lines]",
          "69:     runs-on: ${{ github.event.repository.private && fromJSON('[\"self-hosted\", \"linux\", \"x86_64\"]') || 'ubuntu-latest' }}",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        ".github/workflows/templates/trigger-branch-workflows.yml.jinja||.githuworkflows/templates/trigger-branch-workflows.yml.jinja": [
          "File: .github/workflows/templates/trigger-branch-workflows.yml.jinja -> .githuworkflows/templates/trigger-branch-workflows.yml.jinja",
          "--- Hunk 1 ---",
          "[Context before]",
          "7:   <%- do conclusion_needs.append(job_name) %>",
          "8:     name: Trigger Branch Workflows",
          "9:     if: ${{ github.event_name == 'schedule' && fromJSON(needs.workflow-requirements.outputs.requirements-met) }}",
          "11:     needs:",
          "12:       - workflow-requirements",
          "13:     steps:",
          "",
          "[Removed Lines]",
          "10:     runs-on: ${{ github.event.repository.private && fromJSON('[\"self-hosted\", \"linux\", \"x86_64\"]') || 'ubuntu-latest' }}",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        ".github/workflows/templates/workflow-requirements-check.yml.jinja||.githuworkflows/templates/workflow-requirements-check.yml.jinja": [
          "File: .github/workflows/templates/workflow-requirements-check.yml.jinja -> .githuworkflows/templates/workflow-requirements-check.yml.jinja",
          "--- Hunk 1 ---",
          "[Context before]",
          "4:   <{ job_name }>:",
          "5:   <%- do prepare_workflow_needs.append(job_name) %>",
          "6:     name: Check Workflow Requirements",
          "8:     outputs:",
          "9:       requirements-met: ${{ steps.check-requirements.outputs.requirements-met }}",
          "10:     steps:",
          "",
          "[Removed Lines]",
          "7:     runs-on: ${{ github.event.repository.private && fromJSON('[\"self-hosted\", \"linux\", \"x86_64\"]') || 'ubuntu-latest' }}",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "535c7de7c7ca42ad01b33e69baca2050806ac9bb",
      "candidate_info": {
        "commit_hash": "535c7de7c7ca42ad01b33e69baca2050806ac9bb",
        "repo": "saltstack/salt",
        "commit_url": "https://github.com/saltstack/salt/commit/535c7de7c7ca42ad01b33e69baca2050806ac9bb",
        "files": [
          "tests/pytests/pkg/download/test_pkg_download.py",
          "tools/pkg/repo/create.py"
        ],
        "message": "update photon paths to use their $releasever string",
        "before_after_code_files": [
          "tests/pytests/pkg/download/test_pkg_download.py||tests/pytests/pkg/download/test_pkg_download.py",
          "tools/pkg/repo/create.py||tools/pkg/repo/create.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/saltstack/salt/pull/65969"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "tests/pytests/pkg/download/test_pkg_download.py||tests/pytests/pkg/download/test_pkg_download.py": [
          "File: tests/pytests/pkg/download/test_pkg_download.py -> tests/pytests/pkg/download/test_pkg_download.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "256: ):",
          "257:     arch = os.environ.get(\"SALT_REPO_ARCH\") or \"x86_64\"",
          "259:     if repo_subpath == \"minor\":",
          "260:         repo_url_base = (",
          "261:             f\"{root_url}/{os_name}/{os_version}/{arch}/{repo_subpath}/{salt_release}\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "259:     if os_name == \"photon\":",
          "260:         os_version = f\"{os_version}.0\"",
          "",
          "---------------"
        ],
        "tools/pkg/repo/create.py||tools/pkg/repo/create.py": [
          "File: tools/pkg/repo/create.py -> tools/pkg/repo/create.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "380:         assert incoming is not None",
          "381:         assert repo_path is not None",
          "382:         assert key_id is not None",
          "383:     display_name = f\"{distro.capitalize()} {distro_version}\"",
          "384:     if distro_version not in _rpm_distro_info[distro]:",
          "385:         ctx.error(f\"Support for {display_name} is missing.\")",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "384:     if distro == \"photon\":",
          "385:         distro_version = f\"{distro_version}.0\"",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "64024c52f8a12f10e1a64a82a0f60f6ea2d47d52",
      "candidate_info": {
        "commit_hash": "64024c52f8a12f10e1a64a82a0f60f6ea2d47d52",
        "repo": "saltstack/salt",
        "commit_url": "https://github.com/saltstack/salt/commit/64024c52f8a12f10e1a64a82a0f60f6ea2d47d52",
        "files": [
          "tools/pkg/repo/create.py"
        ],
        "message": "Allow creating the packages repository for Ubuntu 23.04\n\nSigned-off-by: Pedro Algarvio <palgarvio@vmware.com>",
        "before_after_code_files": [
          "tools/pkg/repo/create.py||tools/pkg/repo/create.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/saltstack/salt/pull/65969"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "tools/pkg/repo/create.py||tools/pkg/repo/create.py": [
          "File: tools/pkg/repo/create.py -> tools/pkg/repo/create.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "62:             \"label\": \"salt_ubuntu2204\",",
          "63:             \"codename\": \"jammy\",",
          "64:         },",
          "65:     },",
          "66: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "65:         \"23.04\": {",
          "66:             \"label\": \"salt_ubuntu2304\",",
          "67:             \"codename\": \"mantic\",",
          "68:         },",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "a21a5adc381d37aa0152e24730e8d013a526823f",
      "candidate_info": {
        "commit_hash": "a21a5adc381d37aa0152e24730e8d013a526823f",
        "repo": "saltstack/salt",
        "commit_url": "https://github.com/saltstack/salt/commit/a21a5adc381d37aa0152e24730e8d013a526823f",
        "files": [
          "changelog/65759.fixed.md",
          "salt/netapi/rest_tornado/saltnado.py"
        ],
        "message": "Fix un-closed tranport in tornado netapi",
        "before_after_code_files": [
          "salt/netapi/rest_tornado/saltnado.py||salt/netapi/rest_tornado/saltnado.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/saltstack/salt/pull/65969"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "salt/netapi/rest_tornado/saltnado.py||salt/netapi/rest_tornado/saltnado.py": [
          "File: salt/netapi/rest_tornado/saltnado.py -> salt/netapi/rest_tornado/saltnado.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "396:                     )",
          "397:                     del self.timeout_map[future]",
          "400: class BaseSaltAPIHandler(salt.ext.tornado.web.RequestHandler):  # pylint: disable=W0223",
          "401:     ct_out_map = (",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "399:     def destroy(self):",
          "400:         self.event.destroy()",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "510:         self.timeout_futures()",
          "511:         # clear local_client objects to disconnect event publisher's IOStream connections",
          "512:         del self.saltclients",
          "514:     def on_connection_close(self):",
          "515:         \"\"\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "516:         self.application.event_listener.destroy()",
          "",
          "---------------"
        ]
      }
    }
  ]
}