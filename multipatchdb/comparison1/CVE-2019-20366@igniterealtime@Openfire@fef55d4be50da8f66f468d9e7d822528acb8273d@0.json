{
  "cve_id": "CVE-2019-20366",
  "cve_desc": "An XSS issue was discovered in Ignite Realtime Openfire 4.4.4 via isTrustStore to Manage Store Contents.",
  "repo": "igniterealtime/Openfire",
  "patch_hash": "fef55d4be50da8f66f468d9e7d822528acb8273d",
  "patch_info": {
    "commit_hash": "fef55d4be50da8f66f468d9e7d822528acb8273d",
    "repo": "igniterealtime/Openfire",
    "commit_url": "https://github.com/igniterealtime/Openfire/commit/fef55d4be50da8f66f468d9e7d822528acb8273d",
    "files": [
      "xmppserver/src/main/java/org/jivesoftware/admin/servlet/SystemCacheDetailsServlet.java",
      "xmppserver/src/main/webapp/import-truststore-certificate.jsp",
      "xmppserver/src/main/webapp/security-certificate-details.jsp",
      "xmppserver/src/main/webapp/system-cache-details.jsp",
      "xmppserver/src/main/webapp/user-groups.jsp"
    ],
    "message": "Fix issues identified by CSW (#1561)",
    "before_after_code_files": [
      "xmppserver/src/main/java/org/jivesoftware/admin/servlet/SystemCacheDetailsServlet.java||xmppserver/src/main/java/org/jivesoftware/admin/servlet/SystemCacheDetailsServlet.java",
      "xmppserver/src/main/webapp/import-truststore-certificate.jsp||xmppserver/src/main/webapp/import-truststore-certificate.jsp",
      "xmppserver/src/main/webapp/security-certificate-details.jsp||xmppserver/src/main/webapp/security-certificate-details.jsp",
      "xmppserver/src/main/webapp/system-cache-details.jsp||xmppserver/src/main/webapp/system-cache-details.jsp",
      "xmppserver/src/main/webapp/user-groups.jsp||xmppserver/src/main/webapp/user-groups.jsp"
    ]
  },
  "patch_diff": {
    "xmppserver/src/main/java/org/jivesoftware/admin/servlet/SystemCacheDetailsServlet.java||xmppserver/src/main/java/org/jivesoftware/admin/servlet/SystemCacheDetailsServlet.java": [
      "File: xmppserver/src/main/java/org/jivesoftware/admin/servlet/SystemCacheDetailsServlet.java -> xmppserver/src/main/java/org/jivesoftware/admin/servlet/SystemCacheDetailsServlet.java",
      "--- Hunk 1 ---",
      "[Context before]",
      "45:             .map(cache -> (Cache<?, ?>) cache);",
      "47:         if (!optionalCache.isPresent()) {",
      "49:         }",
      "51:         final boolean secretKey = optionalCache.map(Cache::isKeySecret).orElse(Boolean.FALSE);",
      "",
      "[Removed Lines]",
      "48:             request.setAttribute(\"warningMessage\", LocaleUtils.getLocalizedString(\"system.cache-details.cache_not_found\", Collections.singletonList(cacheName)));",
      "",
      "[Added Lines]",
      "48:             request.setAttribute(\"warningMessage\", LocaleUtils.getLocalizedString(\"system.cache-details.cache_not_found\", Collections.singletonList(StringUtils.escapeHTMLTags(cacheName))));",
      "",
      "---------------"
    ],
    "xmppserver/src/main/webapp/import-truststore-certificate.jsp||xmppserver/src/main/webapp/import-truststore-certificate.jsp": [
      "File: xmppserver/src/main/webapp/import-truststore-certificate.jsp -> xmppserver/src/main/webapp/import-truststore-certificate.jsp",
      "--- Hunk 1 ---",
      "[Context before]",
      "150:                         <label for=\"alias\"><fmt:message key=\"ssl.signing-request.alias\"/></label>",
      "151:                     </td>",
      "152:                     <td width=\"99%\">",
      "154:                     </td>",
      "155:                 </tr>",
      "156:                 <tr valign=\"top\">",
      "",
      "[Removed Lines]",
      "153:                         <input type=\"text\" size=\"30\" maxlength=\"100\" name=\"alias\" id=\"alias\" value=\"${param.alias}\">",
      "",
      "[Added Lines]",
      "153:                         <input type=\"text\" size=\"30\" maxlength=\"100\" name=\"alias\" id=\"alias\" value=\"<c:out value='${param.alias}'/>\"\">",
      "",
      "---------------"
    ],
    "xmppserver/src/main/webapp/security-certificate-details.jsp||xmppserver/src/main/webapp/security-certificate-details.jsp": [
      "File: xmppserver/src/main/webapp/security-certificate-details.jsp -> xmppserver/src/main/webapp/security-certificate-details.jsp",
      "--- Hunk 1 ---",
      "[Context before]",
      "491:     <form action=\"security-certificate-details.jsp\">",
      "492:         <input type=\"hidden\" name=\"connectionType\" value=\"${connectionType}\"/>",
      "494:         <div style=\"text-align: center;\">",
      "495:             <input type=\"submit\" name=\"back\" value=\"<fmt:message key=\"session.details.back_button\"/>\">",
      "496:         </div>",
      "",
      "[Removed Lines]",
      "493:         <input type=\"hidden\" name=\"isTrustStore\" value=\"${param.isTrustStore}\"/>",
      "",
      "[Added Lines]",
      "493:         <input type=\"hidden\" name=\"isTrustStore\" value=\"<c:out value='${param.isTrustStore}'/>\"/>",
      "",
      "---------------"
    ],
    "xmppserver/src/main/webapp/system-cache-details.jsp||xmppserver/src/main/webapp/system-cache-details.jsp": [
      "File: xmppserver/src/main/webapp/system-cache-details.jsp -> xmppserver/src/main/webapp/system-cache-details.jsp",
      "--- Hunk 1 ---",
      "[Context before]",
      "9: <jsp:useBean scope=\"request\" id=\"search\" type=\"org.jivesoftware.admin.servlet.SystemCacheDetailsServlet.Search\"/>",
      "10: <%@ page contentType=\"text/html; charset=UTF-8\" %>",
      "11: <head>",
      "13:     <meta name=\"pageID\" content=\"system-cache\"/>",
      "14:     <style type=\"text/css\">",
      "15:         img.clickable {",
      "",
      "[Removed Lines]",
      "12:     <title><fmt:message key=\"system.cache-details.title\"><fmt:param value=\"${cacheName}\"/></fmt:message></title>",
      "",
      "[Added Lines]",
      "12:     <fmt:message key=\"system.cache-details.title\" var=\"title\"><fmt:param value=\"${cacheName}\"/></fmt:message>",
      "13:     <title><c:out value=\"${title}\"/></title>",
      "",
      "---------------"
    ],
    "xmppserver/src/main/webapp/user-groups.jsp||xmppserver/src/main/webapp/user-groups.jsp": [
      "File: xmppserver/src/main/webapp/user-groups.jsp -> xmppserver/src/main/webapp/user-groups.jsp",
      "--- Hunk 1 ---",
      "[Context before]",
      "235:                 <td align=\"right\" valign=\"bottom\"><fmt:message",
      "236:                         key=\"group.summary.search\" />: <input type=\"text\" size=\"30\"",
      "237:                     maxlength=\"150\" name=\"search\"",
      "239:             </tr>",
      "240:         </table>",
      "241:         <input type=\"hidden\" name=\"username\"",
      "",
      "[Removed Lines]",
      "238:                     value=\"<%=((search!=null) ? search : \"\")%>\"></td>",
      "",
      "[Added Lines]",
      "238:                     value=\"<c:out value='${param.search}'/>\"></td>",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "0d42b4a18727eb821330e0f43e7c9bbdee770031",
      "candidate_info": {
        "commit_hash": "0d42b4a18727eb821330e0f43e7c9bbdee770031",
        "repo": "igniterealtime/Openfire",
        "commit_url": "https://github.com/igniterealtime/Openfire/commit/0d42b4a18727eb821330e0f43e7c9bbdee770031",
        "files": [
          "i18n/src/main/resources/openfire_i18n.properties",
          "xmppserver/src/main/java/org/jivesoftware/admin/servlet/SystemCacheDetailsServlet.java",
          "xmppserver/src/main/webapp/WEB-INF/web.xml",
          "xmppserver/src/main/webapp/system-cache-details.jsp",
          "xmppserver/src/main/webapp/system-cache.jsp"
        ],
        "message": "OF-1728: Add the ability to view/delete the contents of caches",
        "before_after_code_files": [
          "i18n/src/main/resources/openfire_i18n.properties||i18n/src/main/resources/openfire_i18n.properties",
          "xmppserver/src/main/java/org/jivesoftware/admin/servlet/SystemCacheDetailsServlet.java||xmppserver/src/main/java/org/jivesoftware/admin/servlet/SystemCacheDetailsServlet.java",
          "xmppserver/src/main/webapp/system-cache-details.jsp||xmppserver/src/main/webapp/system-cache-details.jsp",
          "xmppserver/src/main/webapp/system-cache.jsp||xmppserver/src/main/webapp/system-cache.jsp"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "xmppserver/src/main/java/org/jivesoftware/admin/servlet/SystemCacheDetailsServlet.java||xmppserver/src/main/java/org/jivesoftware/admin/servlet/SystemCacheDetailsServlet.java",
            "xmppserver/src/main/webapp/system-cache-details.jsp||xmppserver/src/main/webapp/system-cache-details.jsp"
          ],
          "candidate": [
            "xmppserver/src/main/java/org/jivesoftware/admin/servlet/SystemCacheDetailsServlet.java||xmppserver/src/main/java/org/jivesoftware/admin/servlet/SystemCacheDetailsServlet.java",
            "xmppserver/src/main/webapp/system-cache-details.jsp||xmppserver/src/main/webapp/system-cache-details.jsp"
          ]
        }
      },
      "candidate_diff": {
        "i18n/src/main/resources/openfire_i18n.properties||i18n/src/main/resources/openfire_i18n.properties": [
          "File: i18n/src/main/resources/openfire_i18n.properties -> i18n/src/main/resources/openfire_i18n.properties",
          "--- Hunk 1 ---",
          "[Context before]",
          "868: global.csrf.failed=CSRF Error: No changes made, you'll need to retry.",
          "869: global.update=Update",
          "870: global.remove=Remove",
          "872: # Group Chat Service Properties Page",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "871: global.request-error-no-such-action=Unexpected request action {0}",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "3551: # vcard settings.",
          "3552: vcard.read_only=The VCard provider is read-only.",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3555: system.cache-details.title=Contents of cache {0}",
          "3556: system.cache-details.cache_not_found=The cache with name {0} could not be found.",
          "3557: system.cache-details.key=Cache key",
          "3558: system.cache-details.value=Cache value",
          "3559: system.cache-details.total=Total number of cache entrie",
          "3560: system.cache-details.filtered=Filtered cache entries",
          "3561: system.cache-details.per-page=Entries per page",
          "3562: system.cache-details.alt_delete=Delete cache entry",
          "3563: system.cache-details.delete_confirm=Are you sure you want to delete this cache entry?\\\\nThis may have adverse affects on the running of the system.",
          "3564: system.cache-details.deleted=The cache entry with key {0} was deleted.",
          "3565: system.cache-details.key_not_found=The cache entry with key {0} could not be deleted - it may have already expired.",
          "3566: system.cache-details.cancelled=The request was cancelled and no changes were made to the cache.",
          "",
          "---------------"
        ],
        "xmppserver/src/main/java/org/jivesoftware/admin/servlet/SystemCacheDetailsServlet.java||xmppserver/src/main/java/org/jivesoftware/admin/servlet/SystemCacheDetailsServlet.java": [
          "File: xmppserver/src/main/java/org/jivesoftware/admin/servlet/SystemCacheDetailsServlet.java -> xmppserver/src/main/java/org/jivesoftware/admin/servlet/SystemCacheDetailsServlet.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: package org.jivesoftware.admin.servlet;",
          "3: import java.io.IOException;",
          "4: import java.util.AbstractMap;",
          "5: import java.util.Arrays;",
          "6: import java.util.Collection;",
          "7: import java.util.Collections;",
          "8: import java.util.Comparator;",
          "9: import java.util.List;",
          "10: import java.util.Optional;",
          "11: import java.util.stream.Collectors;",
          "12: import java.util.stream.Stream;",
          "14: import javax.servlet.ServletException;",
          "15: import javax.servlet.http.Cookie;",
          "16: import javax.servlet.http.HttpServlet;",
          "17: import javax.servlet.http.HttpServletRequest;",
          "18: import javax.servlet.http.HttpServletResponse;",
          "19: import javax.servlet.http.HttpSession;",
          "21: import org.jivesoftware.util.CookieUtils;",
          "22: import org.jivesoftware.util.ListPager;",
          "23: import org.jivesoftware.util.LocaleUtils;",
          "24: import org.jivesoftware.util.ParamUtils;",
          "25: import org.jivesoftware.util.StringUtils;",
          "26: import org.jivesoftware.util.WebManager;",
          "27: import org.jivesoftware.util.cache.Cache;",
          "28: import org.jivesoftware.util.cache.CacheFactory;",
          "30: public class SystemCacheDetailsServlet extends HttpServlet {",
          "32:     private static final String[] SEARCH_FIELDS = {\"cacheName\", \"searchKey\", \"searchValue\"};",
          "34:     @Override",
          "35:     protected void doGet(final HttpServletRequest request, final HttpServletResponse response) throws ServletException, IOException {",
          "37:         final String cacheName = ParamUtils.getStringParameter(request, \"cacheName\", \"\").trim();",
          "38:         final Optional<Cache<?, ?>> optionalCache = Arrays.stream(CacheFactory.getAllCaches())",
          "39:             .filter(cache -> cacheName.equals(cache.getName()))",
          "40:             .findAny()",
          "41:             .map(cache -> (Cache<?, ?>) cache);",
          "43:         if (!optionalCache.isPresent()) {",
          "44:             request.setAttribute(\"warningMessage\", LocaleUtils.getLocalizedString(\"system.cache-details.cache_not_found\", Collections.singletonList(cacheName)));",
          "45:         }",
          "47:         final List<AbstractMap.SimpleEntry<String, String>> cacheEntries = optionalCache.map(Cache::entrySet)",
          "48:             .map(Collection::stream)",
          "49:             .orElseGet(Stream::empty)",
          "50:             .map(entry -> new AbstractMap.SimpleEntry<>(entry.getKey().toString(), entry.getValue().toString()))",
          "51:             .sorted(Comparator.comparing(AbstractMap.SimpleEntry::getKey))",
          "52:             .collect(Collectors.toList());",
          "55:         final Search search = new Search(request);",
          "57:         final ListPager<AbstractMap.SimpleEntry<String, String>> listPager = new ListPager<>(request, response, cacheEntries, SEARCH_FIELDS);",
          "59:         final String csrf = StringUtils.randomString(16);",
          "60:         CookieUtils.setCookie(request, response, \"csrf\", csrf, -1);",
          "61:         addSessionFlashes(request, \"errorMessage\", \"warningMessage\", \"successMessage\");",
          "62:         request.setAttribute(\"csrf\", csrf);",
          "63:         request.setAttribute(\"cacheName\", cacheName);",
          "64:         request.setAttribute(\"listPager\", listPager);",
          "65:         request.setAttribute(\"search\", search);",
          "66:         request.getRequestDispatcher(\"system-cache-details.jsp\").forward(request, response);",
          "67:     }",
          "69:     @Override",
          "70:     protected void doPost(final HttpServletRequest request, final HttpServletResponse response) throws IOException {",
          "71:         final HttpSession session = request.getSession();",
          "72:         final Cookie csrfCookie = CookieUtils.getCookie(request, \"csrf\");",
          "73:         if (csrfCookie == null || !csrfCookie.getValue().equals(request.getParameter(\"csrf\"))) {",
          "74:             session.setAttribute(\"errorMessage\", LocaleUtils.getLocalizedString(\"global.csrf.failed\"));",
          "75:         } else {",
          "76:             final WebManager webManager = new WebManager();",
          "77:             webManager.init(request, response, session, session.getServletContext());",
          "78:             final String action = ParamUtils.getStringParameter(request, \"action\", \"\");",
          "79:             switch (action) {",
          "80:                 case \"delete\":",
          "81:                     deleteProperty(request, session);",
          "82:                     break;",
          "83:                 case \"cancel\":",
          "84:                     session.setAttribute(\"warningMessage\", LocaleUtils.getLocalizedString(\"system.cache-details.cancelled\"));",
          "85:                     break;",
          "86:                 default:",
          "87:                     session.setAttribute(\"warningMessage\", LocaleUtils.getLocalizedString(\"global.request-error-no-such-action\", Collections.singletonList(action)));",
          "88:                     break;",
          "89:             }",
          "90:         }",
          "91:         response.sendRedirect(request.getRequestURI() + ListPager.getQueryString(request, '?', SEARCH_FIELDS));",
          "93:     }",
          "95:     private void deleteProperty(final HttpServletRequest request, final HttpSession session) {",
          "96:         final String cacheName = ParamUtils.getStringParameter(request, \"cacheName\", \"\").trim();",
          "97:         final String key = ParamUtils.getStringParameter(request, \"key\", \"\");",
          "98:         final Optional<Cache<?, ?>> optionalCache = Arrays.stream(CacheFactory.getAllCaches())",
          "99:             .filter(cache -> cacheName.equals(cache.getName()))",
          "100:             .findAny()",
          "101:             .map(cache -> (Cache<?, ?>) cache);",
          "102:         if(optionalCache.isPresent()) {",
          "103:             if(optionalCache.get().remove(key) != null ) {",
          "104:                 session.setAttribute(\"successMessage\", LocaleUtils.getLocalizedString(\"system.cache-details.deleted\", Collections.singletonList(key)) );",
          "105:             } else {",
          "106:                 session.setAttribute(\"errorMessage\", LocaleUtils.getLocalizedString(\"system.cache-details.key_not_found\", Collections.singletonList(key)) );",
          "107:             }",
          "108:         } else {",
          "109:             request.setAttribute(\"warningMessage\", LocaleUtils.getLocalizedString(\"system.cache-details.cache_not_found\", Collections.singletonList(cacheName)));",
          "110:         }",
          "111:     }",
          "113:     private static void addSessionFlashes(final HttpServletRequest request, final String... flashes) {",
          "114:         final HttpSession session = request.getSession();",
          "115:         for (final String flash : flashes) {",
          "116:             final Object flashValue = session.getAttribute(flash);",
          "117:             if (flashValue != null) {",
          "118:                 request.setAttribute(flash, flashValue);",
          "119:                 session.setAttribute(flash, null);",
          "120:             }",
          "121:         }",
          "122:     }",
          "127:     public static final class Search {",
          "129:         private final String key;",
          "130:         private final String value;",
          "132:         public Search(final HttpServletRequest request) {",
          "133:             this.key = ParamUtils.getStringParameter(request, \"searchKey\", \"\").trim();",
          "134:             this.value = ParamUtils.getStringParameter(request, \"searchValue\", \"\").trim();",
          "135:         }",
          "137:         public String getKey() {",
          "138:             return key;",
          "139:         }",
          "141:         public String getValue() {",
          "142:             return value;",
          "143:         }",
          "145:     }",
          "146: }",
          "",
          "---------------"
        ],
        "xmppserver/src/main/webapp/system-cache-details.jsp||xmppserver/src/main/webapp/system-cache-details.jsp": [
          "File: xmppserver/src/main/webapp/system-cache-details.jsp -> xmppserver/src/main/webapp/system-cache-details.jsp",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: <%@ taglib prefix=\"fmt\" uri=\"http://java.sun.com/jsp/jstl/fmt\" %>",
          "2: <%@ taglib prefix=\"c\" uri=\"http://java.sun.com/jsp/jstl/core\" %>",
          "3: <jsp:useBean scope=\"request\" id=\"errorMessage\" class=\"java.lang.String\"/>",
          "4: <jsp:useBean scope=\"request\" id=\"warningMessage\" class=\"java.lang.String\"/>",
          "5: <jsp:useBean scope=\"request\" id=\"successMessage\" class=\"java.lang.String\"/>",
          "6: <jsp:useBean scope=\"request\" id=\"csrf\" type=\"java.lang.String\"/>",
          "7: <jsp:useBean scope=\"request\" id=\"cacheName\" type=\"java.lang.String\"/>",
          "8: <jsp:useBean scope=\"request\" id=\"listPager\" type=\"org.jivesoftware.util.ListPager\"/>",
          "9: <jsp:useBean scope=\"request\" id=\"search\" type=\"org.jivesoftware.admin.servlet.SystemCacheDetailsServlet.Search\"/>",
          "10: <%@ page contentType=\"text/html; charset=UTF-8\" %>",
          "11: <head>",
          "12:     <title><fmt:message key=\"system.cache-details.title\"><fmt:param value=\"${cacheName}\"/></fmt:message></title>",
          "13:     <meta name=\"pageID\" content=\"system-cache\"/>",
          "14:     <style type=\"text/css\">",
          "15:         img.clickable {",
          "16:             cursor: pointer;",
          "17:         }",
          "18:     </style>",
          "19: </head>",
          "20: <body>",
          "21: <c:if test=\"${not empty errorMessage}\">",
          "22:     <div class=\"error\">${errorMessage}</div>",
          "23: </c:if>",
          "25: <c:if test=\"${not empty warningMessage}\">",
          "26:     <div class=\"warning\">${warningMessage}</div>",
          "27: </c:if>",
          "29: <c:if test=\"${not empty successMessage}\">",
          "30:     <div class=\"success\">${successMessage}</div>",
          "31: </c:if>",
          "33: <p>",
          "34:     <fmt:message key=\"system.cache-details.total\"/>: <c:out value=\"${listPager.totalItemCount}\"/>",
          "35:     <c:if test=\"${listPager.filtered}\">",
          "36:         <fmt:message key=\"system.cache-details.filtered\"/>: <c:out value=\"${listPager.filteredItemCount}\"/>",
          "37:     </c:if>",
          "39:     <c:if test=\"${listPager.totalPages > 1}\">",
          "40:         <fmt:message key=\"global.showing\"/> <c:out value=\"${listPager.firstItemNumberOnPage}\"/>-<c:out",
          "41:         value=\"${listPager.lastItemNumberOnPage}\"/>",
          "42:     </c:if>",
          "43:     -- <fmt:message key=\"system.cache-details.per-page\"/>: ${listPager.pageSizeSelection}",
          "45: </p>",
          "47: <p><fmt:message key=\"global.pages\"/>: [ ${listPager.pageLinks} ]</p>",
          "48: <div class=\"jive-table\">",
          "49:     <table style=\"padding:0; border-spacing:0; width: 100%\">",
          "50:         <thead>",
          "51:         <tr>",
          "52:             <th nowrap><label for=\"searchKey\"><fmt:message key=\"system.cache-details.key\"/></label></th>",
          "53:             <th nowrap><label for=\"searchValue\"><fmt:message key=\"system.cache-details.value\"/></label></th>",
          "54:             <th style=\"text-align:center;\"><fmt:message key=\"global.delete\"/></th>",
          "55:         </tr>",
          "56:         <tr>",
          "57:             <td nowrap>",
          "58:                 <input type=\"search\"",
          "59:                        id=\"searchKey\"",
          "60:                        size=\"40\"",
          "61:                        value=\"<c:out value=\"${search.key}\"/>\"/>",
          "62:                 <img src=\"images/search-16x16.png\"",
          "63:                      width=\"16\" height=\"16\"",
          "64:                      class=\"clickable\"",
          "65:                      alt=\"Search\" title=\"Search\"",
          "66:                      style=\"vertical-align: middle;\"",
          "67:                      onclick=\"submitForm();\"",
          "68:                 >",
          "69:             </td>",
          "70:             <td nowrap>",
          "71:                 <input type=\"search\"",
          "72:                        id=\"searchValue\"",
          "73:                        size=\"40\"",
          "74:                        value=\"<c:out value=\"${search.value}\"/>\"/>",
          "75:                 <img src=\"images/search-16x16.png\"",
          "76:                      width=\"16\" height=\"16\"",
          "77:                      class=\"clickable\"",
          "78:                      alt=\"Search\" title=\"Search\"",
          "79:                      style=\"vertical-align: middle;\"",
          "80:                      onclick=\"submitForm();\"",
          "81:                 >",
          "82:             </td>",
          "83:             <td nowrap>",
          "84:             </td>",
          "85:         </tr>",
          "86:         </thead>",
          "87:         <tbody>",
          "88:         <c:set var=\"rowClass\" value=\"jive-even\"/>",
          "89:         <c:forEach var=\"entry\" items=\"${listPager.itemsOnCurrentPage}\">",
          "90:             <%--@elvariable id=\"entry\" type=\"java.util.Map.Entry\"--%>",
          "91:             <c:choose>",
          "92:                 <c:when test=\"${rowClass == 'jive-even'}\"><c:set var=\"rowClass\" value=\"jive-odd\"/></c:when>",
          "93:                 <c:otherwise><c:set var=\"rowClass\" value=\"jive-even\"/></c:otherwise>",
          "94:             </c:choose>",
          "95:             <tr class=\"${rowClass}\">",
          "96:                 <td>",
          "97:                     <%--",
          "98:                     Note; wrap the property key (and value) in a span so it's easy to extract it in JavaScript",
          "99:                     without any extra whitespace",
          "100:                     --%>",
          "101:                     <span><c:out value=\"${entry.key}\"/></span>",
          "102:                 </td>",
          "103:                 <td>",
          "104:                     <c:out value=\"${entry.value}\"/>",
          "105:                 </td>",
          "106:                 <td style=\"text-align:center\">",
          "107:                     <img class=\"clickable\"",
          "108:                          src=\"images/delete-16x16.gif\"",
          "109:                          width=\"16\" height=\"16\"",
          "110:                          onclick=\"doDelete(this);\"",
          "111:                          alt=\"<fmt:message key=\"system.cache-details.alt_delete\"/>\"",
          "112:                          title=\"<fmt:message key=\"system.cache-details.alt_delete\"/>\"",
          "113:                         >",
          "114:                 </td>",
          "115:             </tr>",
          "116:         </c:forEach>",
          "117:         </tbody>",
          "118:     </table>",
          "119: </div>",
          "120: <p><fmt:message key=\"global.pages\"/>: [ ${listPager.pageLinks} ]</p>",
          "121: ${listPager.jumpToPageForm}",
          "124: <form method=\"post\" id=\"actionForm\">",
          "125:     <%=listPager.getHiddenFields()%>",
          "126:     <input type=\"hidden\" name=\"csrf\" value=\"<c:out value='${csrf}'/>\">",
          "127:     <input type=\"hidden\" name=\"action\">",
          "128:     <input type=\"hidden\" name=\"key\">",
          "129: </form>",
          "131: <script type=\"text/javascript\">",
          "132:     ${listPager.pageFunctions}",
          "134:     function doDelete(imgObject) {",
          "135:         var key = imgObject.parentNode.parentNode.childNodes[1].childNodes[1].textContent;",
          "136:         var action;",
          "137:         if (confirm('<fmt:message key=\"system.cache-details.delete_confirm\"/>')) {",
          "138:             action = 'delete'",
          "139:         } else {",
          "140:             action = 'cancel'",
          "141:         }",
          "142:         var form = document.getElementById(\"actionForm\");",
          "143:         form[\"action\"].value = action;",
          "144:         form[\"key\"].value = key;",
          "145:         form.submit();",
          "146:     }",
          "147: </script>",
          "148: </body>",
          "",
          "---------------"
        ],
        "xmppserver/src/main/webapp/system-cache.jsp||xmppserver/src/main/webapp/system-cache.jsp": [
          "File: xmppserver/src/main/webapp/system-cache.jsp -> xmppserver/src/main/webapp/system-cache.jsp",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: <%@ page contentType=\"text/html; charset=UTF-8\" %>",
          "2: <%@ page import=\"org.jivesoftware.util.CookieUtils\"%>",
          "3: <%@ page import=\"org.jivesoftware.util.ParamUtils\"%>",
          "4: <%@ page import=\"org.jivesoftware.util.StringUtils\"%>",
          "12: <%--",
          "13:   -",
          "14:   - Copyright (C) 2005-2008 Jive Software. All rights reserved.",
          "",
          "[Removed Lines]",
          "5: <%@ page import=\"org.jivesoftware.util.cache.Cache\"%>",
          "6: <%@ page import=\"org.jivesoftware.util.cache.CacheWrapper\"%>",
          "7: <%@ page import=\"org.jivesoftware.util.cache.DefaultCache\"%>",
          "8: <%@ page import=\"java.text.DecimalFormat\"%>",
          "9: <%@ page import=\"java.text.NumberFormat\" %>",
          "10: <%@ page import=\"org.jivesoftware.util.JiveGlobals\" %>",
          "11: <%@ page import=\"java.time.Duration\" %>",
          "",
          "[Added Lines]",
          "2: <%@ page import=\"java.text.DecimalFormat\"%>",
          "3: <%@ page import=\"java.text.NumberFormat\"%>",
          "4: <%@ page import=\"java.time.Duration\"%>",
          "6: <%@ page import=\"org.jivesoftware.util.JiveGlobals\"%>",
          "9: <%@ page import=\"org.jivesoftware.util.cache.Cache\" %>",
          "10: <%@ page import=\"org.jivesoftware.util.cache.CacheWrapper\" %>",
          "11: <%@ page import=\"org.jivesoftware.util.cache.DefaultCache\" %>",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "227:             <table cellpadding=\"0\" cellspacing=\"0\" border=\"0\">",
          "228:             <tr>",
          "229:                 <td class=\"icon\"><img src=\"images/cache-16x16.gif\" width=\"16\" height=\"16\" alt=\"\" border=\"0\"></td>",
          "231:             </tr>",
          "232:             </table>",
          "233:         </td>",
          "",
          "[Removed Lines]",
          "230:                 <td><%= StringUtils.escapeHTMLTags(cache.getName()) %></td>",
          "",
          "[Added Lines]",
          "230:                 <td><a href=\"SystemCacheDetails.jsp?cacheName=<%=java.net.URLEncoder.encode(cache.getName(), \"UTF-8\")%>\"><%= StringUtils.escapeHTMLTags(cache.getName()) %></a></td>",
          "",
          "---------------"
        ]
      }
    }
  ]
}