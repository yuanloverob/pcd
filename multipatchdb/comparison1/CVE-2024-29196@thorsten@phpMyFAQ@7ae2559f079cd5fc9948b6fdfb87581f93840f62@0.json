{
  "cve_id": "CVE-2024-29196",
  "cve_desc": "phpMyFAQ is an open source FAQ web application for PHP 8.1+ and MySQL, PostgreSQL and other databases. There is a Path Traversal vulnerability in Attachments that allows attackers with admin rights to upload malicious files to other locations of the web root. This vulnerability is fixed in 3.2.6.",
  "repo": "thorsten/phpMyFAQ",
  "patch_hash": "7ae2559f079cd5fc9948b6fdfb87581f93840f62",
  "patch_info": {
    "commit_hash": "7ae2559f079cd5fc9948b6fdfb87581f93840f62",
    "repo": "thorsten/phpMyFAQ",
    "commit_url": "https://github.com/thorsten/phpMyFAQ/commit/7ae2559f079cd5fc9948b6fdfb87581f93840f62",
    "files": [
      "phpmyfaq/admin/configuration.php"
    ],
    "message": "fix: improved check on path",
    "before_after_code_files": [
      "phpmyfaq/admin/configuration.php||phpmyfaq/admin/configuration.php"
    ]
  },
  "patch_diff": {
    "phpmyfaq/admin/configuration.php||phpmyfaq/admin/configuration.php": [
      "File: phpmyfaq/admin/configuration.php -> phpmyfaq/admin/configuration.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "19: use phpMyFAQ\\Session\\Token;",
      "20: use phpMyFAQ\\Strings;",
      "21: use phpMyFAQ\\Translation;",
      "23: if (!defined('IS_VALID_PHPMYFAQ')) {",
      "24:     http_response_code(400);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "22: use Symfony\\Component\\HttpFoundation\\Request;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "59:             unset($editData['edit']['main.currentVersion']); // don't update the version number",
      "60:         }",
      "61:         if (isset($editData['edit']['records.attachmentsPath'])) {",
      "67:         }",
      "69:         if (",
      "",
      "[Removed Lines]",
      "62:             $editData['edit']['records.attachmentsPath'] = str_replace(",
      "63:                 '../',",
      "64:                 '',",
      "65:                 $editData['edit']['records.attachmentsPath']",
      "66:             );",
      "",
      "[Added Lines]",
      "63:             if (false !== realpath($editData['edit']['records.attachmentsPath'])) {",
      "64:                 $editData['edit']['records.attachmentsPath'] = str_replace(",
      "65:                     Request::createFromGlobals()->server->get('DOCUMENT_ROOT') . DIRECTORY_SEPARATOR,",
      "66:                     '',",
      "67:                     realpath($editData['edit']['records.attachmentsPath'])",
      "68:                 );",
      "69:             } else {",
      "70:                 unset($editData['edit']['records.attachmentsPath']);",
      "71:             }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "75fbeb063af08249959a98950fa4e0e996c7fa3e",
      "candidate_info": {
        "commit_hash": "75fbeb063af08249959a98950fa4e0e996c7fa3e",
        "repo": "thorsten/phpMyFAQ",
        "commit_url": "https://github.com/thorsten/phpMyFAQ/commit/75fbeb063af08249959a98950fa4e0e996c7fa3e",
        "files": [
          "phpmyfaq/admin/configuration.php"
        ],
        "message": "fix: avoid possible path traversal",
        "before_after_code_files": [
          "phpmyfaq/admin/configuration.php||phpmyfaq/admin/configuration.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "phpmyfaq/admin/configuration.php||phpmyfaq/admin/configuration.php"
          ],
          "candidate": [
            "phpmyfaq/admin/configuration.php||phpmyfaq/admin/configuration.php"
          ]
        }
      },
      "candidate_diff": {
        "phpmyfaq/admin/configuration.php||phpmyfaq/admin/configuration.php": [
          "File: phpmyfaq/admin/configuration.php -> phpmyfaq/admin/configuration.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "58:         if (isset($editData['edit']['main.currentVersion'])) {",
          "59:             unset($editData['edit']['main.currentVersion']); // don't update the version number",
          "60:         }",
          "62:         if (",
          "63:             isset($editData['edit']['main.referenceURL']) &&",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "61:         if (isset($editData['edit']['records.attachmentsPath'])) {",
          "62:             $editData['edit']['records.attachmentsPath'] = str_replace(",
          "63:                 '../',",
          "64:                 '',",
          "65:                 $editData['edit']['records.attachmentsPath']",
          "66:             );",
          "67:         }",
          "",
          "---------------"
        ]
      }
    }
  ]
}