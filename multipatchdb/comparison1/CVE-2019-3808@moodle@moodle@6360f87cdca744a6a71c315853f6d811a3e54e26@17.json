{
  "cve_id": "CVE-2019-3808",
  "cve_desc": "A flaw was found in Moodle versions 3.6 to 3.6.1, 3.5 to 3.5.3, 3.4 to 3.4.6, 3.1 to 3.1.15 and earlier unsupported versions. The 'manage groups' capability did not have the 'XSS risk' flag assigned to it, but does have that access in certain places. Note that the capability is intended for use by trusted users, and is only assigned to teachers and managers by default.",
  "repo": "moodle/moodle",
  "patch_hash": "6360f87cdca744a6a71c315853f6d811a3e54e26",
  "patch_info": {
    "commit_hash": "6360f87cdca744a6a71c315853f6d811a3e54e26",
    "repo": "moodle/moodle",
    "commit_url": "https://github.com/moodle/moodle/commit/6360f87cdca744a6a71c315853f6d811a3e54e26",
    "files": [
      "lib/db/access.php",
      "version.php"
    ],
    "message": "MDL-64395 groups: Added XSS Risk to the manage groups capability",
    "before_after_code_files": [
      "lib/db/access.php||lib/db/access.php",
      "version.php||version.php"
    ]
  },
  "patch_diff": {
    "lib/db/access.php||lib/db/access.php": [
      "File: lib/db/access.php -> lib/db/access.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "1123:     ),",
      "1125:     'moodle/course:managegroups' => array(",
      "1127:         'captype' => 'write',",
      "1128:         'contextlevel' => CONTEXT_COURSE,",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1126:         'riskbitmask' => RISK_XSS,",
      "",
      "---------------"
    ],
    "version.php||version.php": [
      "File: version.php -> version.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "30: defined('MOODLE_INTERNAL') || die();",
      "",
      "[Removed Lines]",
      "32: $version  = 2018122000.01;              // YYYYMMDD      = weekly release date of this DEV branch.",
      "",
      "[Added Lines]",
      "32: $version  = 2018122000.02;              // YYYYMMDD      = weekly release date of this DEV branch.",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "d26749b74c676bb96885017b19f45cf51d0b3fda",
      "candidate_info": {
        "commit_hash": "d26749b74c676bb96885017b19f45cf51d0b3fda",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/d26749b74c676bb96885017b19f45cf51d0b3fda",
        "files": [
          "lang/en/deprecated.txt",
          "lang/en/role.php",
          "lib/db/access.php",
          "lib/db/upgrade.php",
          "lib/upgrade.txt",
          "version.php"
        ],
        "message": "MDL-65354 core: rename course:browse cap to category:browsecourses",
        "before_after_code_files": [
          "lang/en/role.php||lang/en/role.php",
          "lib/db/access.php||lib/db/access.php",
          "lib/db/upgrade.php||lib/db/upgrade.php",
          "version.php||version.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "lib/db/access.php||lib/db/access.php",
            "version.php||version.php"
          ],
          "candidate": [
            "lib/db/access.php||lib/db/access.php",
            "version.php||version.php"
          ]
        }
      },
      "candidate_diff": {
        "lang/en/role.php||lang/en/role.php": [
          "File: lang/en/role.php -> lang/en/role.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "98: $string['calendar:manageownentries'] = 'Manage own calendar entries';",
          "99: $string['capabilities'] = 'Capabilities';",
          "100: $string['capability'] = 'Capability';",
          "101: $string['category:create'] = 'Create categories';",
          "102: $string['category:delete'] = 'Delete categories';",
          "103: $string['category:manage'] = 'Manage categories';",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "101: $string['category:viewcourselist'] = 'View list of courses you are not enrolled in';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "154: $string['confirmunassignno'] = 'Cancel';",
          "155: $string['context'] = 'Context';",
          "156: $string['course:activityvisibility'] = 'Hide/show activities';",
          "158: $string['course:bulkmessaging'] = 'Send a message to many people';",
          "159: $string['course:create'] = 'Create courses';",
          "160: $string['course:creategroupconversations'] = 'Create group conversations';",
          "",
          "[Removed Lines]",
          "157: $string['course:browse'] = 'View list of courses where user is not enrolled';",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "495: $string['privacy:metadata:role_capabilities:timemodified'] = 'The date when the capability was created or modified.';",
          "496: $string['privacy:metadata:role_cohortroles'] = 'Roles to cohort';",
          "497: $string['course:togglecompletion'] = 'Manually mark activities as complete';",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "500: $string['course:browse'] = 'View list of courses where user is not enrolled';",
          "",
          "---------------"
        ],
        "lib/db/access.php||lib/db/access.php": [
          "File: lib/db/access.php -> lib/db/access.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "733:         'clonepermissionsfrom' => 'moodle/category:update'",
          "734:     ),",
          "738:         'captype' => 'read',",
          "740:         'archetypes' => array(",
          "741:             'guest' => CAP_ALLOW,",
          "742:             'user' => CAP_ALLOW,",
          "",
          "[Removed Lines]",
          "736:     'moodle/course:browse' => array(",
          "739:         'contextlevel' => CONTEXT_COURSE,",
          "",
          "[Added Lines]",
          "736:     'moodle/category:viewcourselist' => array(",
          "739:         'contextlevel' => CONTEXT_COURSECAT,",
          "",
          "---------------"
        ],
        "lib/db/upgrade.php||lib/db/upgrade.php": [
          "File: lib/db/upgrade.php -> lib/db/upgrade.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "2988:         upgrade_main_savepoint(true, 2019041000.02);",
          "2989:     }",
          "2991:     return true;",
          "2992: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2991:     if ($oldversion < 2019041300.01) {",
          "2992:         $sql = \"UPDATE {capabilities}",
          "2993:                    SET name = ?,",
          "2994:                        contextlevel = ?",
          "2995:                  WHERE name = ?\";",
          "2996:         $DB->execute($sql, ['moodle/category:viewcourselist', CONTEXT_COURSECAT, 'moodle/course:browse']);",
          "2998:         $sql = \"UPDATE {role_capabilities}",
          "2999:                    SET capability = ?",
          "3000:                  WHERE capability = ?\";",
          "3001:         $DB->execute($sql, ['moodle/category:viewcourselist', 'moodle/course:browse']);",
          "3004:         upgrade_main_savepoint(true, 2019041300.01);",
          "3005:     }",
          "",
          "---------------"
        ],
        "version.php||version.php": [
          "File: version.php -> version.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "30: defined('MOODLE_INTERNAL') || die();",
          "",
          "[Removed Lines]",
          "32: $version  = 2019041300.00;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "",
          "[Added Lines]",
          "32: $version  = 2019041300.01;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "8c5162684144853a8ee3abd0862489e88421ab83",
      "candidate_info": {
        "commit_hash": "8c5162684144853a8ee3abd0862489e88421ab83",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/8c5162684144853a8ee3abd0862489e88421ab83",
        "files": [
          "version.php"
        ],
        "message": "weekly release 3.6dev",
        "before_after_code_files": [
          "version.php||version.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.php||version.php"
          ],
          "candidate": [
            "version.php||version.php"
          ]
        }
      },
      "candidate_diff": {
        "version.php||version.php": [
          "File: version.php -> version.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "30: defined('MOODLE_INTERNAL') || die();",
          "38: $branch   = '36';                       // This version's branch.",
          "39: $maturity = MATURITY_ALPHA;             // This version's maturity level.",
          "",
          "[Removed Lines]",
          "32: $version  = 2018070600.00;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "36: $release  = '3.6dev (Build: 20180706)'; // Human-friendly version name",
          "",
          "[Added Lines]",
          "32: $version  = 2018071300.00;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "36: $release  = '3.6dev (Build: 20180713)'; // Human-friendly version name",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "30d432776975f6fcfbcff853a860bed8c2dce30b",
      "candidate_info": {
        "commit_hash": "30d432776975f6fcfbcff853a860bed8c2dce30b",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/30d432776975f6fcfbcff853a860bed8c2dce30b",
        "files": [
          "version.php"
        ],
        "message": "weekly release 3.7+",
        "before_after_code_files": [
          "version.php||version.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.php||version.php"
          ],
          "candidate": [
            "version.php||version.php"
          ]
        }
      },
      "candidate_diff": {
        "version.php||version.php": [
          "File: version.php -> version.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "30: defined('MOODLE_INTERNAL') || die();",
          "38: $branch   = '37';                       // This version's branch.",
          "39: $maturity = MATURITY_STABLE;             // This version's maturity level.",
          "",
          "[Removed Lines]",
          "32: $version  = 2019052000.04;              // 20190520      = branching date YYYYMMDD - do not modify!",
          "36: $release  = '3.7+ (Build: 20190614)'; // Human-friendly version name",
          "",
          "[Added Lines]",
          "32: $version  = 2019052000.05;              // 20190520      = branching date YYYYMMDD - do not modify!",
          "36: $release  = '3.7+ (Build: 20190620)'; // Human-friendly version name",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "f622ee97e346568cd1f664d961937db8251ef74d",
      "candidate_info": {
        "commit_hash": "f622ee97e346568cd1f664d961937db8251ef74d",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/f622ee97e346568cd1f664d961937db8251ef74d",
        "files": [
          "version.php"
        ],
        "message": "weekly release 3.8dev",
        "before_after_code_files": [
          "version.php||version.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.php||version.php"
          ],
          "candidate": [
            "version.php||version.php"
          ]
        }
      },
      "candidate_diff": {
        "version.php||version.php": [
          "File: version.php -> version.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "30: defined('MOODLE_INTERNAL') || die();",
          "38: $branch   = '38';                       // This version's branch.",
          "39: $maturity = MATURITY_ALPHA;             // This version's maturity level.",
          "",
          "[Removed Lines]",
          "32: $version  = 2019072200.02;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "36: $release  = '3.8dev (Build: 20190718)'; // Human-friendly version name",
          "",
          "[Added Lines]",
          "32: $version  = 2019072500.00;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "36: $release  = '3.8dev (Build: 20190725)'; // Human-friendly version name",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "f5b956679ea5e5c77894a8ff2b9c44fe33520ad5",
      "candidate_info": {
        "commit_hash": "f5b956679ea5e5c77894a8ff2b9c44fe33520ad5",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/f5b956679ea5e5c77894a8ff2b9c44fe33520ad5",
        "files": [
          "version.php"
        ],
        "message": "weekly release 3.5dev",
        "before_after_code_files": [
          "version.php||version.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.php||version.php"
          ],
          "candidate": [
            "version.php||version.php"
          ]
        }
      },
      "candidate_diff": {
        "version.php||version.php": [
          "File: version.php -> version.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "30: defined('MOODLE_INTERNAL') || die();",
          "38: $branch   = '35';                       // This version's branch.",
          "39: $maturity = MATURITY_ALPHA;             // This version's maturity level.",
          "",
          "[Removed Lines]",
          "32: $version  = 2018010400.00;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "36: $release  = '3.5dev (Build: 20180104)'; // Human-friendly version name",
          "",
          "[Added Lines]",
          "32: $version  = 2018011200.00;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "36: $release  = '3.5dev (Build: 20180112)'; // Human-friendly version name",
          "",
          "---------------"
        ]
      }
    }
  ]
}