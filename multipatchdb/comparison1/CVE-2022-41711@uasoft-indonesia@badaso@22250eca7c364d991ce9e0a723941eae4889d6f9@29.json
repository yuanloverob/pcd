{
  "cve_id": "CVE-2022-41711",
  "cve_desc": "Badaso version 2.6.0 allows an unauthenticated remote attacker to execute arbitrary code remotely on the server. This is possible because the application does not properly validate the data uploaded by users.",
  "repo": "uasoft-indonesia/badaso",
  "patch_hash": "22250eca7c364d991ce9e0a723941eae4889d6f9",
  "patch_info": {
    "commit_hash": "22250eca7c364d991ce9e0a723941eae4889d6f9",
    "repo": "uasoft-indonesia/badaso",
    "commit_url": "https://github.com/uasoft-indonesia/badaso/commit/22250eca7c364d991ce9e0a723941eae4889d6f9",
    "files": [
      "src/resources/js/components/BadasoUploadFile.vue",
      "src/resources/js/components/BadasoUploadFileMultiple.vue",
      "src/resources/js/components/BadasoUploadImage.vue",
      "src/resources/js/components/BadasoUploadImageMultiple.vue"
    ],
    "message": "Merge pull request #807 from uasoft-indonesia/bugfix/v2/filter-mimeType\n\nBugfix[v2] add filter mimeType",
    "before_after_code_files": [
      "src/resources/js/components/BadasoUploadFile.vue||src/resources/js/components/BadasoUploadFile.vue",
      "src/resources/js/components/BadasoUploadFileMultiple.vue||src/resources/js/components/BadasoUploadFileMultiple.vue",
      "src/resources/js/components/BadasoUploadImage.vue||src/resources/js/components/BadasoUploadImage.vue",
      "src/resources/js/components/BadasoUploadImageMultiple.vue||src/resources/js/components/BadasoUploadImageMultiple.vue"
    ]
  },
  "patch_diff": {
    "src/resources/js/components/BadasoUploadFile.vue||src/resources/js/components/BadasoUploadFile.vue": [
      "File: src/resources/js/components/BadasoUploadFile.vue -> src/resources/js/components/BadasoUploadFile.vue",
      "--- Hunk 1 ---",
      "[Context before]",
      "336:           });",
      "337:           return;",
      "338:         }",
      "340:         this.uploadFile(files[0]);",
      "341:       }",
      "342:     },",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "339:         if (!this.availableMimetypes.file.validMime.includes(files[0].type)) {",
      "340:           this.$vs.notify({",
      "341:             title: this.$t(\"alert.danger\"),",
      "342:             text: \"File type not allowed\",",
      "343:             color: \"danger\",",
      "344:           });",
      "345:           return;",
      "346:         }",
      "",
      "---------------"
    ],
    "src/resources/js/components/BadasoUploadFileMultiple.vue||src/resources/js/components/BadasoUploadFileMultiple.vue": [
      "File: src/resources/js/components/BadasoUploadFileMultiple.vue -> src/resources/js/components/BadasoUploadFileMultiple.vue",
      "--- Hunk 1 ---",
      "[Context before]",
      "367:             });",
      "368:             return;",
      "369:           }",
      "371:           this.uploadFile(file);",
      "372:         }",
      "373:       }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "370:           if (!this.availableMimetypes.file.validMime.includes(file.type)) {",
      "371:             this.$vs.notify({",
      "372:               title: this.$t(\"alert.danger\"),",
      "373:               text: \"File type not allowed\",",
      "374:               color: \"danger\",",
      "375:             });",
      "376:             return;",
      "377:           }",
      "",
      "---------------"
    ],
    "src/resources/js/components/BadasoUploadImage.vue||src/resources/js/components/BadasoUploadImage.vue": [
      "File: src/resources/js/components/BadasoUploadImage.vue -> src/resources/js/components/BadasoUploadImage.vue",
      "--- Hunk 1 ---",
      "[Context before]",
      "380:           });",
      "381:           return;",
      "382:         }",
      "384:         this.uploadImage(files[0]);",
      "385:       }",
      "386:     },",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "383:         if (!this.availableMimetypes.image.validMime.includes(files[0].type)){",
      "384:           this.$vs.notify({",
      "385:             title: this.$t(\"alert.danger\"),",
      "386:             text: \"File type not allowed\",",
      "387:             color: \"danger\",",
      "388:           });",
      "389:           return;",
      "390:         }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "421:     uploadImage(file) {",
      "422:       const files = new FormData();",
      "423:       files.append(\"upload\", file);",
      "425:       files.append(\"working_dir\", this.getActiveFolder);",
      "426:       this.$api.badasoFile",
      "427:         .uploadUsingLfm(files)",
      "",
      "[Removed Lines]",
      "424:       files.append(\"type\", \"image\");",
      "",
      "[Added Lines]",
      "431:       files.append(\"type\", file.type);",
      "",
      "---------------"
    ],
    "src/resources/js/components/BadasoUploadImageMultiple.vue||src/resources/js/components/BadasoUploadImageMultiple.vue": [
      "File: src/resources/js/components/BadasoUploadImageMultiple.vue -> src/resources/js/components/BadasoUploadImageMultiple.vue",
      "--- Hunk 1 ---",
      "[Context before]",
      "395:             });",
      "396:             return;",
      "397:           }",
      "399:           this.uploadImage(file);",
      "400:         }",
      "401:       }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "398:           if (!this.availableMimetypes.image.validMime.includes(file.type)) {",
      "399:             this.$vs.notify({",
      "400:               title: this.$t(\"alert.danger\"),",
      "401:               text: \"File type not allowed\",",
      "402:               color: \"danger\",",
      "403:             });",
      "404:             return;",
      "405:           }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "9fe7f50bd43ee7920370a626cecd15fc6805b377",
      "candidate_info": {
        "commit_hash": "9fe7f50bd43ee7920370a626cecd15fc6805b377",
        "repo": "uasoft-indonesia/badaso",
        "commit_url": "https://github.com/uasoft-indonesia/badaso/commit/9fe7f50bd43ee7920370a626cecd15fc6805b377",
        "files": [
          "src/Config/l5-swagger.php",
          "src/resources/js/pages/crud-generated/browse.vue"
        ],
        "message": "query string",
        "before_after_code_files": [
          "src/Config/l5-swagger.php||src/Config/l5-swagger.php",
          "src/resources/js/pages/crud-generated/browse.vue||src/resources/js/pages/crud-generated/browse.vue"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/uasoft-indonesia/badaso/pull/1086"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/Config/l5-swagger.php||src/Config/l5-swagger.php": [
          "File: src/Config/l5-swagger.php -> src/Config/l5-swagger.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "240:         'constants' => [",
          "242:         ],",
          "243:     ],",
          "244: ];",
          "",
          "[Removed Lines]",
          "241:             'L5_SWAGGER_CONST_HOST' => env('APP_URL').'/'.env('MIX_API_ROUTE_PREFIX'),",
          "",
          "[Added Lines]",
          "241:             'L5_SWAGGER_CONST_HOST' => env('APP_URL') . '/' . env('MIX_API_ROUTE_PREFIX'),",
          "",
          "---------------"
        ],
        "src/resources/js/pages/crud-generated/browse.vue||src/resources/js/pages/crud-generated/browse.vue": [
          "File: src/resources/js/pages/crud-generated/browse.vue -> src/resources/js/pages/crud-generated/browse.vue",
          "--- Hunk 1 ---",
          "[Context before]",
          "791:   },",
          "792:   mounted() {",
          "793:     this.getEntity();",
          "794:     this.loadIdsOfflineDelete();",
          "795:   },",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "793:     if (this.$route.query.search || this.$route.query.page) {",
          "794:       this.filter = this.$route.query.search;",
          "795:       this.page = this.$route.query.page;",
          "796:       this.show = this.$route.query.show;",
          "797:     }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1013:     handleSearch(e) {",
          "1014:       this.filter = e.target.value;",
          "1015:       this.page = 1;",
          "1016:       this.getEntity();",
          "1017:     },",
          "1018:     handleChangePage(page) {",
          "1019:       this.page = page;",
          "1020:       this.getEntity();",
          "1021:     },",
          "1022:     handleChangeLimit(limit) {",
          "1023:       this.page = 1;",
          "1024:       this.limit = limit;",
          "1025:       this.getEntity();",
          "1026:     },",
          "1027:     handleSort(field, direction) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1021:       this.$router.replace({",
          "1022:         query: {",
          "1023:           search: this.filter,",
          "1024:           page: this.page,",
          "1025:           show: this.limit",
          "1026:         }",
          "1027:       })",
          "1028:       .catch(err=>{});",
          "1033:       this.$router.replace({",
          "1034:         query: {",
          "1035:           search: this.filter,",
          "1036:           page: this.page,",
          "1037:           show: this.limit",
          "1038:         }",
          "1039:       })",
          "1040:       .catch(err => { });;",
          "1046:       this.$router.replace({",
          "1047:         query: {",
          "1048:           search: this.filter,",
          "1049:           page: this.page,",
          "1050:           show: this.limit",
          "1051:         }",
          "1052:       })",
          "1053:       .catch(err => { });",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "db3f16a712a67df60b7b8dd7f97d03efd0485237",
      "candidate_info": {
        "commit_hash": "db3f16a712a67df60b7b8dd7f97d03efd0485237",
        "repo": "uasoft-indonesia/badaso",
        "commit_url": "https://github.com/uasoft-indonesia/badaso/commit/db3f16a712a67df60b7b8dd7f97d03efd0485237",
        "files": [
          "src/Helpers/GetData.php"
        ],
        "message": "update getdata",
        "before_after_code_files": [
          "src/Helpers/GetData.php||src/Helpers/GetData.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/uasoft-indonesia/badaso/pull/1086"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/Helpers/GetData.php||src/Helpers/GetData.php": [
          "File: src/Helpers/GetData.php -> src/Helpers/GetData.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "33:         $field_identify_related_user = null;",
          "34:         $roles_can_see_all_data = [];",
          "38:         $field_identify_related_user = $permissions ? $permissions['field_identify_related_user'] : null;",
          "40:         $roles_can_see_all_data = json_decode($permissions) ? json_decode($permissions['roles_can_see_all_data']) : [];",
          "43:         foreach ($user_roles as $key => $user_role) {",
          "44:             $is_roles = in_array($user_role->name, $roles_can_see_all_data);",
          "",
          "[Removed Lines]",
          "36:         $permissions = Permission::where('key', 'browse_'.$data_type->name)->where('table_name', $data_type->name)->select('roles_can_see_all_data', 'field_identify_related_user')->first();",
          "41:         $user_roles = auth()->user()->roles;",
          "",
          "[Added Lines]",
          "36:         $permissions = Permission::where('key', 'browse_' . $data_type->name)->where('table_name', $data_type->name)->select('roles_can_see_all_data', 'field_identify_related_user', 'is_public')->first();",
          "40:         $is_public = $permissions ? $permissions['is_public'] : 0;",
          "44:         if ($is_public !== 1) {",
          "45:             $user_roles = auth()->user()->roles;",
          "46:         } else {",
          "47:             $user_roles = User::with('roles')->get();",
          "48:         }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "121:         $field_identify_related_user = null;",
          "122:         $roles_can_see_all_data = [];",
          "126:         $field_identify_related_user = $permissions ? $permissions['field_identify_related_user'] : null;",
          "128:         $roles_can_see_all_data = json_decode($permissions) ? json_decode($permissions['roles_can_see_all_data']) : [];",
          "131:         foreach ($user_roles as $key => $user_role) {",
          "132:             $is_roles = in_array($user_role->name, $roles_can_see_all_data);",
          "",
          "[Removed Lines]",
          "124:         $permissions = Permission::where('key', 'browse_'.$data_type->name)->where('table_name', $data_type->name)->select('roles_can_see_all_data', 'field_identify_related_user')->first();",
          "129:         $user_roles = auth()->user()->roles;",
          "",
          "[Added Lines]",
          "131:         $permissions = Permission::where('key', 'browse_' . $data_type->name)->where('table_name', $data_type->name)->select('roles_can_see_all_data', 'field_identify_related_user', 'is_public')->first();",
          "135:         $is_public = $permissions ? $permissions['is_public'] : 0;",
          "139:         if ($is_public !== 1) {",
          "140:             $user_roles = auth()->user()->roles;",
          "141:         } else {",
          "142:             $user_roles = User::with('roles')->get();",
          "143:         }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "239:         $field_identify_related_user = null;",
          "240:         $roles_can_see_all_data = [];",
          "244:         $field_identify_related_user = $permissions ? $permissions['field_identify_related_user'] : null;",
          "246:         $roles_can_see_all_data = json_decode($permissions) ? json_decode($permissions['roles_can_see_all_data']) : [];",
          "249:         foreach ($user_roles as $key => $user_role) {",
          "250:             $is_roles = in_array($user_role->name, $roles_can_see_all_data);",
          "",
          "[Removed Lines]",
          "242:         $permissions = Permission::where('key', 'browse_'.$data_type->name)->where('table_name', $data_type->name)->select('roles_can_see_all_data', 'field_identify_related_user')->first();",
          "247:         $user_roles = auth()->user()->roles;",
          "",
          "[Added Lines]",
          "256:         $permissions = Permission::where('key', 'browse_' . $data_type->name)->where('table_name', $data_type->name)->select('roles_can_see_all_data', 'field_identify_related_user', 'is_public')->first();",
          "260:         $is_public = $permissions ? $permissions['is_public'] : 0;",
          "264:         if ($is_public !== 1) {",
          "265:             $user_roles = auth()->user()->roles;",
          "266:         } else {",
          "267:             $user_roles = User::with('roles')->get();",
          "268:         }",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "330:         $field_identify_related_user = null;",
          "331:         $roles_can_see_all_data = [];",
          "335:         $field_identify_related_user = $permissions ? $permissions['field_identify_related_user'] : null;",
          "337:         $roles_can_see_all_data = json_decode($permissions) ? json_decode($permissions['roles_can_see_all_data']) : [];",
          "340:         foreach ($user_roles as $key => $user_role) {",
          "341:             $is_roles = in_array($user_role->name, $roles_can_see_all_data);",
          "",
          "[Removed Lines]",
          "333:         $permissions = Permission::where('key', 'browse_'.$data_type->name)->where('table_name', $data_type->name)->select('roles_can_see_all_data', 'field_identify_related_user')->first();",
          "338:         $user_roles = User::with('roles')->get();",
          "",
          "[Added Lines]",
          "354:         $permissions = Permission::where('key', 'browse_'.$data_type->name)->where('table_name', $data_type->name)->select('roles_can_see_all_data', 'field_identify_related_user','is_public')->first();",
          "358:         $is_public = $permissions ? $permissions['is_public'] : 0;",
          "362:         if($is_public !== 1) {",
          "363:             $user_roles = auth()->user()->roles;",
          "364:         } else {",
          "365:             $user_roles = User::with('roles')->get();",
          "366:         }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "111a269bc92732ce19edb9d213c71613600c3d6e",
      "candidate_info": {
        "commit_hash": "111a269bc92732ce19edb9d213c71613600c3d6e",
        "repo": "uasoft-indonesia/badaso",
        "commit_url": "https://github.com/uasoft-indonesia/badaso/commit/111a269bc92732ce19edb9d213c71613600c3d6e",
        "files": [
          "src/Migrations/2022_03_08_090850_change_order_integer_data_type_in_menus_table.php"
        ],
        "message": "Apply fixes from StyleCI",
        "before_after_code_files": [
          "src/Migrations/2022_03_08_090850_change_order_integer_data_type_in_menus_table.php||src/Migrations/2022_03_08_090850_change_order_integer_data_type_in_menus_table.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/uasoft-indonesia/badaso/pull/1086"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/Migrations/2022_03_08_090850_change_order_integer_data_type_in_menus_table.php||src/Migrations/2022_03_08_090850_change_order_integer_data_type_in_menus_table.php": [
          "File: src/Migrations/2022_03_08_090850_change_order_integer_data_type_in_menus_table.php -> src/Migrations/2022_03_08_090850_change_order_integer_data_type_in_menus_table.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "14:     public function up()",
          "15:     {",
          "16:         Schema::table('menus', function (Blueprint $table) {",
          "18:                 $table->integer('order')->change();",
          "19:             }",
          "20:         });",
          "",
          "[Removed Lines]",
          "17:             if (!Schema::hasColumn(config('badaso.database.prefix') . 'menus', 'order')) {",
          "",
          "[Added Lines]",
          "17:             if (! Schema::hasColumn(config('badaso.database.prefix').'menus', 'order')) {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "28:     public function down()",
          "29:     {",
          "30:         Schema::table('menus', function (Blueprint $table) {",
          "32:                 $table->integer('order')->change();",
          "33:             }",
          "34:         });",
          "",
          "[Removed Lines]",
          "31:             if (!Schema::hasColumn(config('badaso.database.prefix') . 'menus', 'order')) {",
          "",
          "[Added Lines]",
          "31:             if (! Schema::hasColumn(config('badaso.database.prefix').'menus', 'order')) {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "fa777840f8f94a2cf80f879a232ee7836ec9b7f0",
      "candidate_info": {
        "commit_hash": "fa777840f8f94a2cf80f879a232ee7836ec9b7f0",
        "repo": "uasoft-indonesia/badaso",
        "commit_url": "https://github.com/uasoft-indonesia/badaso/commit/fa777840f8f94a2cf80f879a232ee7836ec9b7f0",
        "files": [
          "src/Migrations/2021_10_21_054710_add_is_show_header_and_expand_in_menus_table.php"
        ],
        "message": "Update 2021_10_21_054710_add_is_show_header_and_expand_in_menus_table.php",
        "before_after_code_files": [
          "src/Migrations/2021_10_21_054710_add_is_show_header_and_expand_in_menus_table.php||src/Migrations/2021_10_21_054710_add_is_show_header_and_expand_in_menus_table.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/uasoft-indonesia/badaso/pull/1086"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/Migrations/2021_10_21_054710_add_is_show_header_and_expand_in_menus_table.php||src/Migrations/2021_10_21_054710_add_is_show_header_and_expand_in_menus_table.php": [
          "File: src/Migrations/2021_10_21_054710_add_is_show_header_and_expand_in_menus_table.php -> src/Migrations/2021_10_21_054710_add_is_show_header_and_expand_in_menus_table.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "21:                 $table->boolean('is_expand')->default(true)->after('icon');",
          "22:             }",
          "23:             if (! Schema::hasColumn(config('badaso.database.prefix').'menus', 'order')) {",
          "25:             }",
          "26:         });",
          "27:     }",
          "",
          "[Removed Lines]",
          "24:                 $table->integer('order')->nullable()->after('icon');",
          "",
          "[Added Lines]",
          "24:                 $table->boolean('order')->nullable()->after('icon');",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "991fb9f2b17a648be3b68c9f5302feb4407b68f5",
      "candidate_info": {
        "commit_hash": "991fb9f2b17a648be3b68c9f5302feb4407b68f5",
        "repo": "uasoft-indonesia/badaso",
        "commit_url": "https://github.com/uasoft-indonesia/badaso/commit/991fb9f2b17a648be3b68c9f5302feb4407b68f5",
        "files": [
          "src/resources/js/pages/database-management/add.vue"
        ],
        "message": "Update docs link",
        "before_after_code_files": [
          "src/resources/js/pages/database-management/add.vue||src/resources/js/pages/database-management/add.vue"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/uasoft-indonesia/badaso/pull/1086"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/resources/js/pages/database-management/add.vue||src/resources/js/pages/database-management/add.vue": [
          "File: src/resources/js/pages/database-management/add.vue -> src/resources/js/pages/database-management/add.vue",
          "--- Hunk 1 ---",
          "[Context before]",
          "50:               <i18n path=\"database.warning.docs\">",
          "51:                 <a",
          "52:                   target=\"_blank\"",
          "54:                   >docs</a",
          "55:                 >",
          "56:               </i18n>",
          "",
          "[Removed Lines]",
          "53:                   href=\"https://badaso-docs.uatech.co.id/docs/en/core-concept/database-management/\"",
          "",
          "[Added Lines]",
          "53:                   href=\"https://badaso-docs.uatech.co.id/core-concept/database-management\"",
          "",
          "---------------"
        ]
      }
    }
  ]
}