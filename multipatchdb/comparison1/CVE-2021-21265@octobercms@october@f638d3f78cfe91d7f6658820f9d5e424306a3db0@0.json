{
  "cve_id": "CVE-2021-21265",
  "cve_desc": "October is a free, open-source, self-hosted CMS platform based on the Laravel PHP Framework. In October before version 1.1.2, when running on poorly configured servers (i.e. the server routes any request, regardless of the HOST header to an October CMS instance) the potential exists for Host Header Poisoning attacks to succeed. This has been addressed in version 1.1.2 by adding a feature to allow a set of trusted hosts to be specified in the application. As a workaround one may set the configuration setting cms.linkPolicy to force.",
  "repo": "octobercms/october",
  "patch_hash": "f638d3f78cfe91d7f6658820f9d5e424306a3db0",
  "patch_info": {
    "commit_hash": "f638d3f78cfe91d7f6658820f9d5e424306a3db0",
    "repo": "octobercms/october",
    "commit_url": "https://github.com/octobercms/october/commit/f638d3f78cfe91d7f6658820f9d5e424306a3db0",
    "files": [
      "config/app.php",
      "modules/backend/controllers/Auth.php"
    ],
    "message": "Add app.trustedHosts config and force host checks on password reset (#5423)\n\nAdd app.trustedHosts config and force host checks on backend password reset.\n\nRelated: octobercms/library@f29865a\n(cherry picked from commit f555ab6)",
    "before_after_code_files": [
      "config/app.php||config/app.php",
      "modules/backend/controllers/Auth.php||modules/backend/controllers/Auth.php"
    ]
  },
  "patch_diff": {
    "config/app.php||config/app.php": [
      "File: config/app.php -> config/app.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "44:     'url' => 'http://localhost',",
      "47:     |--------------------------------------------------------------------------",
      "48:     | Application Timezone",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "47:     |--------------------------------------------------------------------------",
      "48:     | Trusted hosts",
      "49:     |--------------------------------------------------------------------------",
      "50:     |",
      "51:     | You may specify valid hosts for your application as an array or boolean",
      "52:     | below. This helps prevent host header poisoning attacks.",
      "53:     |",
      "54:     | Possible values:",
      "55:     |  - `true`: Trust the host specified in app.url, as well as the \"www\"",
      "56:     |            subdomain, if applicable.",
      "57:     |  - `false`: Disable the trusted hosts feature.",
      "58:     |  - array: Defines the domains to be trusted hosts. Each item should be",
      "59:     |           a string defining a domain, IP address, or a regex pattern.",
      "60:     |",
      "61:     | Example of array values:",
      "62:     |",
      "63:     |    'trustedHosts' => [",
      "64:     |       'example.com',           // Matches just example.com",
      "65:     |       'www.example.com',       // Matches just www.example.com",
      "66:     |       '^(.+\\.)?example\\.com$', // Matches example.com and all subdomains",
      "67:     |       'https://example.com',   // Matches just example.com",
      "68:     |    ],",
      "69:     |",
      "70:     | NOTE: Even when set to `false`, this functionality is explicitly enabled",
      "71:     | on the Backend password reset flow for security reasons.",
      "74:     'trustedHosts' => true,",
      "",
      "---------------"
    ],
    "modules/backend/controllers/Auth.php||modules/backend/controllers/Auth.php": [
      "File: modules/backend/controllers/Auth.php -> modules/backend/controllers/Auth.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "13: use ValidationException;",
      "14: use Exception;",
      "15: use Config;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "16: use October\\Rain\\Foundation\\Http\\Middleware\\CheckForTrustedHost;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "148:     public function restore_onSubmit()",
      "149:     {",
      "150:         $rules = [",
      "151:             'login' => 'required|between:2,255'",
      "152:         ];",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "153:         $trustedHosts = Config::get('app.trustedHosts', false);",
      "154:         if ($trustedHosts === false) {",
      "155:             $hosts = CheckForTrustedHost::processTrustedHosts(true);",
      "157:             if (count($hosts)) {",
      "158:                 Request::setTrustedHosts($hosts);",
      "161:                 Request::getHost();",
      "162:             }",
      "163:         }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "555ab61f2313f45d7d5d138656420ead536c5d30",
      "candidate_info": {
        "commit_hash": "555ab61f2313f45d7d5d138656420ead536c5d30",
        "repo": "octobercms/october",
        "commit_url": "https://github.com/octobercms/october/commit/555ab61f2313f45d7d5d138656420ead536c5d30",
        "files": [
          "config/app.php",
          "modules/backend/controllers/Auth.php"
        ],
        "message": "Add app.trustedHosts config and force host checks on password reset (#5423)\n\nAdd app.trustedHosts config and force host checks on backend password reset.\n\nRelated: https://github.com/octobercms/library/commit/f29865ae3db7a03be7c49294cd93980ec457f10d",
        "before_after_code_files": [
          "config/app.php||config/app.php",
          "modules/backend/controllers/Auth.php||modules/backend/controllers/Auth.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "config/app.php||config/app.php",
            "modules/backend/controllers/Auth.php||modules/backend/controllers/Auth.php"
          ],
          "candidate": [
            "config/app.php||config/app.php",
            "modules/backend/controllers/Auth.php||modules/backend/controllers/Auth.php"
          ]
        }
      },
      "candidate_diff": {
        "config/app.php||config/app.php": [
          "File: config/app.php -> config/app.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "44:     'url' => 'http://localhost',",
          "47:     |--------------------------------------------------------------------------",
          "48:     | Application Timezone",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "47:     |--------------------------------------------------------------------------",
          "48:     | Trusted hosts",
          "49:     |--------------------------------------------------------------------------",
          "50:     |",
          "51:     | You may specify valid hosts for your application as an array or boolean",
          "52:     | below. This helps prevent host header poisoning attacks.",
          "53:     |",
          "54:     | Possible values:",
          "55:     |  - `true`: Trust the host specified in app.url, as well as the \"www\"",
          "56:     |            subdomain, if applicable.",
          "57:     |  - `false`: Disable the trusted hosts feature.",
          "58:     |  - array: Defines the domains to be trusted hosts. Each item should be",
          "59:     |           a string defining a domain, IP address, or a regex pattern.",
          "60:     |",
          "61:     | Example of array values:",
          "62:     |",
          "63:     |    'trustedHosts' => [",
          "64:     |       'example.com',           // Matches just example.com",
          "65:     |       'www.example.com',       // Matches just www.example.com",
          "66:     |       '^(.+\\.)?example\\.com$', // Matches example.com and all subdomains",
          "67:     |       'https://example.com',   // Matches just example.com",
          "68:     |    ],",
          "69:     |",
          "70:     | NOTE: Even when set to `false`, this functionality is explicitly enabled",
          "71:     | on the Backend password reset flow for security reasons.",
          "74:     'trustedHosts' => true,",
          "",
          "---------------"
        ],
        "modules/backend/controllers/Auth.php||modules/backend/controllers/Auth.php": [
          "File: modules/backend/controllers/Auth.php -> modules/backend/controllers/Auth.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "13: use ValidationException;",
          "14: use Exception;",
          "15: use Config;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "16: use October\\Rain\\Foundation\\Http\\Middleware\\CheckForTrustedHost;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "148:     public function restore_onSubmit()",
          "149:     {",
          "150:         $rules = [",
          "151:             'login' => 'required|between:2,255'",
          "152:         ];",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "153:         $trustedHosts = Config::get('app.trustedHosts', false);",
          "154:         if ($trustedHosts === false) {",
          "155:             $hosts = CheckForTrustedHost::processTrustedHosts(true);",
          "157:             if (count($hosts)) {",
          "158:                 Request::setTrustedHosts($hosts);",
          "161:                 Request::getHost();",
          "162:             }",
          "163:         }",
          "",
          "---------------"
        ]
      }
    }
  ]
}