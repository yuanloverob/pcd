{
  "cve_id": "CVE-2021-27906",
  "cve_desc": "A carefully crafted PDF file can trigger an OutOfMemory-Exception while loading the file. This issue affects Apache PDFBox version 2.0.22 and prior 2.0.x versions.",
  "repo": "apache/pdfbox",
  "patch_hash": "8c47be1011c11dc47300faecffd8ab32fba3646f",
  "patch_info": {
    "commit_hash": "8c47be1011c11dc47300faecffd8ab32fba3646f",
    "repo": "apache/pdfbox",
    "commit_url": "https://github.com/apache/pdfbox/commit/8c47be1011c11dc47300faecffd8ab32fba3646f",
    "files": [
      "pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java"
    ],
    "message": "PDFBOX-5112: SonarCube fix, throw NoSuchElementException if no more elements are available\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1887295 13f79535-47bb-0310-9956-ffa450edef68",
    "before_after_code_files": [
      "pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java||pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java"
    ]
  },
  "patch_diff": {
    "pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java||pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java": [
      "File: pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java -> pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java",
      "--- Hunk 1 ---",
      "[Context before]",
      "19: import java.io.IOException;",
      "20: import java.util.Arrays;",
      "21: import java.util.Iterator;",
      "23: import org.apache.pdfbox.cos.COSArray;",
      "24: import org.apache.pdfbox.cos.COSBase;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "22: import java.util.NoSuchElementException;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "212:         @Override",
      "213:         public Long next()",
      "214:         {",
      "215:             if (currentNumber < currentEnd)",
      "216:             {",
      "217:                 return currentNumber++;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "216:             if (currentNumber >= maxValue)",
      "217:             {",
      "218:                 throw new NoSuchElementException();",
      "219:             }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "2d02d78e0d8e90bfc7bc725b2932442e317ca221",
      "candidate_info": {
        "commit_hash": "2d02d78e0d8e90bfc7bc725b2932442e317ca221",
        "repo": "apache/pdfbox",
        "commit_url": "https://github.com/apache/pdfbox/commit/2d02d78e0d8e90bfc7bc725b2932442e317ca221",
        "files": [
          "examples/src/main/java/org/apache/pdfbox/examples/pdmodel/CreatePortableCollection.java"
        ],
        "message": "PDFBOX-5164: add ASF header\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1889023 13f79535-47bb-0310-9956-ffa450edef68",
        "before_after_code_files": [
          "examples/src/main/java/org/apache/pdfbox/examples/pdmodel/CreatePortableCollection.java||examples/src/main/java/org/apache/pdfbox/examples/pdmodel/CreatePortableCollection.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/pdfbox/pull/104"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "examples/src/main/java/org/apache/pdfbox/examples/pdmodel/CreatePortableCollection.java||examples/src/main/java/org/apache/pdfbox/examples/pdmodel/CreatePortableCollection.java": [
          "File: examples/src/main/java/org/apache/pdfbox/examples/pdmodel/CreatePortableCollection.java -> examples/src/main/java/org/apache/pdfbox/examples/pdmodel/CreatePortableCollection.java"
        ]
      }
    },
    {
      "candidate_hash": "f1e17243ff5ab3a235297818044768602863a32d",
      "candidate_info": {
        "commit_hash": "f1e17243ff5ab3a235297818044768602863a32d",
        "repo": "apache/pdfbox",
        "commit_url": "https://github.com/apache/pdfbox/commit/f1e17243ff5ab3a235297818044768602863a32d",
        "files": [
          "pdfbox/src/main/java/org/apache/pdfbox/rendering/PageDrawer.java"
        ],
        "message": "PDFBOX-5275: ignore empty OCGs\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1892883 13f79535-47bb-0310-9956-ffa450edef68",
        "before_after_code_files": [
          "pdfbox/src/main/java/org/apache/pdfbox/rendering/PageDrawer.java||pdfbox/src/main/java/org/apache/pdfbox/rendering/PageDrawer.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/pdfbox/pull/104"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "pdfbox/src/main/java/org/apache/pdfbox/rendering/PageDrawer.java||pdfbox/src/main/java/org/apache/pdfbox/rendering/PageDrawer.java": [
          "File: pdfbox/src/main/java/org/apache/pdfbox/rendering/PageDrawer.java -> pdfbox/src/main/java/org/apache/pdfbox/rendering/PageDrawer.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "2036:             LOG.info(\"/VE entry ignored in Optional Content Membership Dictionary\");",
          "2037:         }",
          "2038:         List<Boolean> visibles = new ArrayList<Boolean>();",
          "2040:         {",
          "2041:             visibles.add(!isHiddenOCG(prop));",
          "2042:         }",
          "",
          "[Removed Lines]",
          "2039:         for (PDPropertyList prop : ocmd.getOCGs())",
          "",
          "[Added Lines]",
          "2039:         List<PDPropertyList> oCGs = ocmd.getOCGs();",
          "2040:         if (oCGs.isEmpty())",
          "2041:         {",
          "2042:             return false;",
          "2043:         }",
          "2044:         for (PDPropertyList prop : oCGs)",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "77050032fea5f150330c80d78b422c865a745fff",
      "candidate_info": {
        "commit_hash": "77050032fea5f150330c80d78b422c865a745fff",
        "repo": "apache/pdfbox",
        "commit_url": "https://github.com/apache/pdfbox/commit/77050032fea5f150330c80d78b422c865a745fff",
        "files": [
          "tools/src/main/java/org/apache/pdfbox/tools/TextToPDF.java"
        ],
        "message": "PDFBOX-4892: performance improvements, as suggested by valerybokov\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1888314 13f79535-47bb-0310-9956-ffa450edef68",
        "before_after_code_files": [
          "tools/src/main/java/org/apache/pdfbox/tools/TextToPDF.java||tools/src/main/java/org/apache/pdfbox/tools/TextToPDF.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/pdfbox/pull/104"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "tools/src/main/java/org/apache/pdfbox/tools/TextToPDF.java||tools/src/main/java/org/apache/pdfbox/tools/TextToPDF.java": [
          "File: tools/src/main/java/org/apache/pdfbox/tools/TextToPDF.java -> tools/src/main/java/org/apache/pdfbox/tools/TextToPDF.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "134:             boolean textIsEmpty = true;",
          "136:             while( (nextLine = data.readLine()) != null )",
          "137:             {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "136:             StringBuilder nextLineToDraw = new StringBuilder();",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "145:                 int lineIndex = 0;",
          "146:                 while( lineIndex < lineWords.length )",
          "147:                 {",
          "149:                     float lengthIfUsingNextWord = 0;",
          "150:                     boolean ff = false;",
          "151:                     do",
          "152:                     {",
          "153:                         String word1, word2 = \"\";",
          "155:                         if (indexFF == -1)",
          "156:                         {",
          "158:                         }",
          "159:                         else",
          "160:                         {",
          "161:                             ff = true;",
          "164:                             {",
          "166:                             }",
          "167:                         }",
          "",
          "[Removed Lines]",
          "148:                     StringBuilder nextLineToDraw = new StringBuilder();",
          "154:                         int indexFF = lineWords[lineIndex].indexOf('\\f');",
          "157:                             word1 = lineWords[lineIndex];",
          "162:                             word1 = lineWords[lineIndex].substring(0, indexFF);",
          "163:                             if (indexFF < lineWords[lineIndex].length())",
          "165:                                 word2 = lineWords[lineIndex].substring(indexFF + 1);",
          "",
          "[Added Lines]",
          "150:                     nextLineToDraw.setLength(0);",
          "156:                         String word = lineWords[lineIndex];",
          "157:                         int indexFF = word.indexOf('\\f');",
          "160:                             word1 = word;",
          "165:                             word1 = word.substring(0, indexFF);",
          "166:                             if (indexFF < word.length())",
          "168:                                 word2 = word.substring(indexFF + 1);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "95cae9ae1d30499d688ee46061a22a838dd2f990",
      "candidate_info": {
        "commit_hash": "95cae9ae1d30499d688ee46061a22a838dd2f990",
        "repo": "apache/pdfbox",
        "commit_url": "https://github.com/apache/pdfbox/commit/95cae9ae1d30499d688ee46061a22a838dd2f990",
        "files": [
          "pdfbox/src/main/java/org/apache/pdfbox/text/PDFTextStripper.java"
        ],
        "message": "PDFBOX-5055: SonarQube fix: remove unneeded null check\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1884749 13f79535-47bb-0310-9956-ffa450edef68",
        "before_after_code_files": [
          "pdfbox/src/main/java/org/apache/pdfbox/text/PDFTextStripper.java||pdfbox/src/main/java/org/apache/pdfbox/text/PDFTextStripper.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/pdfbox/pull/104"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "pdfbox/src/main/java/org/apache/pdfbox/text/PDFTextStripper.java||pdfbox/src/main/java/org/apache/pdfbox/text/PDFTextStripper.java": [
          "File: pdfbox/src/main/java/org/apache/pdfbox/text/PDFTextStripper.java -> pdfbox/src/main/java/org/apache/pdfbox/text/PDFTextStripper.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "242:         {",
          "243:             charactersByArticle.clear();",
          "244:         }",
          "249:     }",
          "",
          "[Removed Lines]",
          "245:         if (characterListMapping != null)",
          "246:         {",
          "247:             characterListMapping.clear();",
          "248:         }",
          "",
          "[Added Lines]",
          "245:         characterListMapping.clear();",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "814fb3a3e6a1094f0c19b46afb2f1bd9387c59e2",
      "candidate_info": {
        "commit_hash": "814fb3a3e6a1094f0c19b46afb2f1bd9387c59e2",
        "repo": "apache/pdfbox",
        "commit_url": "https://github.com/apache/pdfbox/commit/814fb3a3e6a1094f0c19b46afb2f1bd9387c59e2",
        "files": [
          "fontbox/src/main/java/org/apache/fontbox/ttf/GlyfSimpleDescript.java"
        ],
        "message": "PDFBOX-4892: simplify code\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1891090 13f79535-47bb-0310-9956-ffa450edef68",
        "before_after_code_files": [
          "fontbox/src/main/java/org/apache/fontbox/ttf/GlyfSimpleDescript.java||fontbox/src/main/java/org/apache/fontbox/ttf/GlyfSimpleDescript.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/pdfbox/pull/104"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "fontbox/src/main/java/org/apache/fontbox/ttf/GlyfSimpleDescript.java||fontbox/src/main/java/org/apache/fontbox/ttf/GlyfSimpleDescript.java": [
          "File: fontbox/src/main/java/org/apache/fontbox/ttf/GlyfSimpleDescript.java -> fontbox/src/main/java/org/apache/fontbox/ttf/GlyfSimpleDescript.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "171:             {",
          "172:                 if ((flags[i] & X_SHORT_VECTOR) != 0)",
          "173:                 {",
          "175:                 }",
          "176:                 else",
          "177:                 {",
          "",
          "[Removed Lines]",
          "174:                     x += -(short) bais.readUnsignedByte();",
          "",
          "[Added Lines]",
          "174:                     x -= (short) bais.readUnsignedByte();",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "194:             {",
          "195:                 if ((flags[i] & Y_SHORT_VECTOR) != 0)",
          "196:                 {",
          "198:                 }",
          "199:                 else",
          "200:                 {",
          "",
          "[Removed Lines]",
          "197:                     y += -(short) bais.readUnsignedByte();",
          "",
          "[Added Lines]",
          "197:                     y -= (short) bais.readUnsignedByte();",
          "",
          "---------------"
        ]
      }
    }
  ]
}