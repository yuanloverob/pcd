{
  "cve_id": "CVE-2023-29506",
  "cve_desc": "XWiki Commons are technical libraries common to several other top level XWiki projects. It was possible to inject some code using the URL of authenticated endpoints. This problem has been patched on XWiki 13.10.11, 14.4.7 and 14.10.",
  "repo": "xwiki/xwiki-platform",
  "patch_hash": "1943ea26c967ef868fb5f67c487d98d97cba0380",
  "patch_info": {
    "commit_hash": "1943ea26c967ef868fb5f67c487d98d97cba0380",
    "repo": "xwiki/xwiki-platform",
    "commit_url": "https://github.com/xwiki/xwiki-platform/commit/1943ea26c967ef868fb5f67c487d98d97cba0380",
    "files": [
      "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandler.java",
      "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandlerTest.java"
    ],
    "message": "XWIKI-20335: Wiki existence is not properly checked in authenticate",
    "before_after_code_files": [
      "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandler.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandler.java",
      "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandlerTest.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandlerTest.java"
    ]
  },
  "patch_diff": {
    "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandler.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandler.java": [
      "File: xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandler.java -> xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandler.java",
      "--- Hunk 1 ---",
      "[Context before]",
      "37: import org.xwiki.resource.ResourceReferenceHandlerException;",
      "38: import org.xwiki.resource.ResourceType;",
      "39: import org.xwiki.security.authentication.AuthenticationResourceReference;",
      "41: import com.xpn.xwiki.XWikiContext;",
      "42: import com.xpn.xwiki.XWikiContextInitializer;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "40: import org.xwiki.wiki.descriptor.WikiDescriptorManager;",
      "41: import org.xwiki.wiki.manager.WikiManagerException;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "59:     @Inject",
      "60:     private Execution execution;",
      "62:     @Override",
      "63:     public List<ResourceType> getSupportedResourceReferences()",
      "64:     {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "64:     @Inject",
      "65:     private WikiDescriptorManager wikiDescriptorManager;",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "71:     {",
      "72:         AuthenticationResourceReference authenticationResourceReference = (AuthenticationResourceReference) reference;",
      "74:         switch (authenticationResourceReference.getAction()) {",
      "75:             case RETRIEVE_USERNAME:",
      "76:                 this.handleAction(\"forgotusername\", authenticationResourceReference.getWikiReference());",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "79:         WikiReference wikiReference = authenticationResourceReference.getWikiReference();",
      "80:         try {",
      "81:             if (!this.wikiDescriptorManager.exists(wikiReference.getName())) {",
      "82:                 throw new ResourceReferenceHandlerException(",
      "83:                     String.format(\"The wiki [%s] does not exist.\", wikiReference.getName()));",
      "84:             }",
      "85:         } catch (WikiManagerException e) {",
      "86:             throw new ResourceReferenceHandlerException(",
      "87:                 String.format(\"Error when checking if wiki [%s] exists.\", wikiReference.getName()), e);",
      "88:         }",
      "",
      "---------------"
    ],
    "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandlerTest.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandlerTest.java": [
      "File: xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandlerTest.java -> xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandlerTest.java",
      "--- Hunk 1 ---",
      "[Context before]",
      "31: import org.xwiki.context.ExecutionContext;",
      "32: import org.xwiki.model.reference.WikiReference;",
      "33: import org.xwiki.resource.ResourceReferenceHandlerChain;",
      "34: import org.xwiki.security.authentication.AuthenticationAction;",
      "35: import org.xwiki.security.authentication.AuthenticationResourceReference;",
      "36: import org.xwiki.test.junit5.mockito.ComponentTest;",
      "37: import org.xwiki.test.junit5.mockito.InjectMockComponents;",
      "38: import org.xwiki.test.junit5.mockito.MockComponent;",
      "40: import com.xpn.xwiki.XWiki;",
      "41: import com.xpn.xwiki.XWikiContext;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "34: import org.xwiki.resource.ResourceReferenceHandlerException;",
      "40: import org.xwiki.wiki.descriptor.WikiDescriptorManager;",
      "41: import org.xwiki.wiki.manager.WikiManagerException;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "45: import com.xpn.xwiki.web.XWikiResponse;",
      "47: import static org.junit.jupiter.api.Assertions.assertEquals;",
      "48: import static org.mockito.ArgumentMatchers.any;",
      "49: import static org.mockito.ArgumentMatchers.eq;",
      "50: import static org.mockito.Mockito.mock;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "51: import static org.junit.jupiter.api.Assertions.assertThrows;",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "69:     @MockComponent",
      "70:     private Execution execution;",
      "72:     private XWikiResponse response;",
      "74:     private XWiki xwiki;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "76:     @MockComponent",
      "77:     private WikiDescriptorManager wikiDescriptorManager;",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "112:     void handleResetPassword() throws Exception",
      "113:     {",
      "114:         WikiReference wikiReference = new WikiReference(\"foo\");",
      "115:         AuthenticationResourceReference resourceReference = new AuthenticationResourceReference(",
      "116:             wikiReference,",
      "117:             AuthenticationAction.RESET_PASSWORD);",
      "121:         ResourceReferenceHandlerChain chain = mock(ResourceReferenceHandlerChain.class);",
      "122:         this.resourceReferenceHandler.handle(resourceReference, chain);",
      "124:         verify(response).setContentType(\"text/html; charset=UTF-8\");",
      "",
      "[Removed Lines]",
      "119:         when(this.xwiki.evaluateTemplate(\"resetpassword.vm\", context)).thenReturn(\"Reset password content\");",
      "",
      "[Added Lines]",
      "122:         when(this.wikiDescriptorManager.exists(\"foo\")).thenReturn(false);",
      "128:         ResourceReferenceHandlerException exception =",
      "129:             assertThrows(ResourceReferenceHandlerException.class,",
      "130:                 () -> this.resourceReferenceHandler.handle(resourceReference, chain));",
      "131:         assertEquals(\"The wiki [foo] does not exist.\", exception.getMessage());",
      "133:         when(this.wikiDescriptorManager.exists(\"foo\")).thenReturn(true);",
      "134:         when(this.xwiki.evaluateTemplate(\"resetpassword.vm\", context)).thenReturn(\"Reset password content\");",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "133:     void handleForgotUsername() throws Exception",
      "134:     {",
      "135:         WikiReference wikiReference = new WikiReference(\"bar\");",
      "136:         AuthenticationResourceReference resourceReference = new AuthenticationResourceReference(",
      "137:             wikiReference,",
      "138:             AuthenticationAction.RETRIEVE_USERNAME);",
      "140:         when(this.xwiki.evaluateTemplate(\"forgotusername.vm\", context)).thenReturn(\"Forgot user name content\");",
      "143:         this.resourceReferenceHandler.handle(resourceReference, chain);",
      "145:         verify(response).setContentType(\"text/html; charset=UTF-8\");",
      "146:         verify(this.xWikiContextInitializer).initialize(any(ExecutionContext.class));",
      "147:         verify(servletOutputStream).write(\"Forgot user name content\".getBytes(StandardCharsets.UTF_8));",
      "",
      "[Removed Lines]",
      "142:         ResourceReferenceHandlerChain chain = mock(ResourceReferenceHandlerChain.class);",
      "",
      "[Added Lines]",
      "149:         when(this.wikiDescriptorManager.exists(\"bar\")).thenReturn(false);",
      "154:         ResourceReferenceHandlerChain chain = mock(ResourceReferenceHandlerChain.class);",
      "155:         ResourceReferenceHandlerException exception =",
      "156:             assertThrows(ResourceReferenceHandlerException.class,",
      "157:                 () -> this.resourceReferenceHandler.handle(resourceReference, chain));",
      "158:         assertEquals(\"The wiki [bar] does not exist.\", exception.getMessage());",
      "160:         when(this.wikiDescriptorManager.exists(\"bar\")).thenReturn(true);",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "149:         verify(context).setWikiReference(wikiReference);",
      "150:         verify(context).setWikiReference(currentWiki);",
      "151:     }",
      "152: }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "172:     @Test",
      "173:     void handleForgotUsernameWikiDescriptorError() throws Exception",
      "174:     {",
      "175:         WikiReference wikiReference = new WikiReference(\"bar\");",
      "176:         when(this.wikiDescriptorManager.exists(\"bar\")).thenThrow(new WikiManagerException(\"Cannot access wiki\"));",
      "177:         AuthenticationResourceReference resourceReference = new AuthenticationResourceReference(",
      "178:             wikiReference,",
      "179:             AuthenticationAction.RETRIEVE_USERNAME);",
      "181:         ResourceReferenceHandlerChain chain = mock(ResourceReferenceHandlerChain.class);",
      "182:         ResourceReferenceHandlerException exception =",
      "183:             assertThrows(ResourceReferenceHandlerException.class,",
      "184:                 () -> this.resourceReferenceHandler.handle(resourceReference, chain));",
      "185:         assertEquals(\"Error when checking if wiki [bar] exists.\", exception.getMessage());",
      "186:     }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "d3393dc632773b799f73e0fedb191eb557d64834",
      "candidate_info": {
        "commit_hash": "d3393dc632773b799f73e0fedb191eb557d64834",
        "repo": "xwiki/xwiki-platform",
        "commit_url": "https://github.com/xwiki/xwiki-platform/commit/d3393dc632773b799f73e0fedb191eb557d64834",
        "files": [
          "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandler.java",
          "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandlerTest.java"
        ],
        "message": "XWIKI-20335: Wiki existence is not properly checked in authenticate\n\n(cherry picked from commit 1943ea26c967ef868fb5f67c487d98d97cba0380)",
        "before_after_code_files": [
          "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandler.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandler.java",
          "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandlerTest.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandlerTest.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandler.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandler.java",
            "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandlerTest.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandlerTest.java"
          ],
          "candidate": [
            "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandler.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandler.java",
            "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandlerTest.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandlerTest.java"
          ]
        }
      },
      "candidate_diff": {
        "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandler.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandler.java": [
          "File: xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandler.java -> xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandler.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "37: import org.xwiki.resource.ResourceReferenceHandlerException;",
          "38: import org.xwiki.resource.ResourceType;",
          "39: import org.xwiki.security.authentication.AuthenticationResourceReference;",
          "41: import com.xpn.xwiki.XWikiContext;",
          "42: import com.xpn.xwiki.XWikiContextInitializer;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "40: import org.xwiki.wiki.descriptor.WikiDescriptorManager;",
          "41: import org.xwiki.wiki.manager.WikiManagerException;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "59:     @Inject",
          "60:     private Execution execution;",
          "62:     @Override",
          "63:     public List<ResourceType> getSupportedResourceReferences()",
          "64:     {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "64:     @Inject",
          "65:     private WikiDescriptorManager wikiDescriptorManager;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "71:     {",
          "72:         AuthenticationResourceReference authenticationResourceReference = (AuthenticationResourceReference) reference;",
          "74:         switch (authenticationResourceReference.getAction()) {",
          "75:             case RETRIEVE_USERNAME:",
          "76:                 this.handleAction(\"forgotusername\", authenticationResourceReference.getWikiReference());",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "79:         WikiReference wikiReference = authenticationResourceReference.getWikiReference();",
          "80:         try {",
          "81:             if (!this.wikiDescriptorManager.exists(wikiReference.getName())) {",
          "82:                 throw new ResourceReferenceHandlerException(",
          "83:                     String.format(\"The wiki [%s] does not exist.\", wikiReference.getName()));",
          "84:             }",
          "85:         } catch (WikiManagerException e) {",
          "86:             throw new ResourceReferenceHandlerException(",
          "87:                 String.format(\"Error when checking if wiki [%s] exists.\", wikiReference.getName()), e);",
          "88:         }",
          "",
          "---------------"
        ],
        "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandlerTest.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandlerTest.java": [
          "File: xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandlerTest.java -> xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandlerTest.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "31: import org.xwiki.context.ExecutionContext;",
          "32: import org.xwiki.model.reference.WikiReference;",
          "33: import org.xwiki.resource.ResourceReferenceHandlerChain;",
          "34: import org.xwiki.security.authentication.AuthenticationAction;",
          "35: import org.xwiki.security.authentication.AuthenticationResourceReference;",
          "36: import org.xwiki.test.junit5.mockito.ComponentTest;",
          "37: import org.xwiki.test.junit5.mockito.InjectMockComponents;",
          "38: import org.xwiki.test.junit5.mockito.MockComponent;",
          "40: import com.xpn.xwiki.XWiki;",
          "41: import com.xpn.xwiki.XWikiContext;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "34: import org.xwiki.resource.ResourceReferenceHandlerException;",
          "40: import org.xwiki.wiki.descriptor.WikiDescriptorManager;",
          "41: import org.xwiki.wiki.manager.WikiManagerException;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "45: import com.xpn.xwiki.web.XWikiResponse;",
          "47: import static org.junit.jupiter.api.Assertions.assertEquals;",
          "48: import static org.mockito.ArgumentMatchers.any;",
          "49: import static org.mockito.ArgumentMatchers.eq;",
          "50: import static org.mockito.Mockito.mock;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "51: import static org.junit.jupiter.api.Assertions.assertThrows;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "69:     @MockComponent",
          "70:     private Execution execution;",
          "72:     private XWikiResponse response;",
          "74:     private XWiki xwiki;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "76:     @MockComponent",
          "77:     private WikiDescriptorManager wikiDescriptorManager;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "112:     void handleResetPassword() throws Exception",
          "113:     {",
          "114:         WikiReference wikiReference = new WikiReference(\"foo\");",
          "115:         AuthenticationResourceReference resourceReference = new AuthenticationResourceReference(",
          "116:             wikiReference,",
          "117:             AuthenticationAction.RESET_PASSWORD);",
          "121:         ResourceReferenceHandlerChain chain = mock(ResourceReferenceHandlerChain.class);",
          "122:         this.resourceReferenceHandler.handle(resourceReference, chain);",
          "124:         verify(response).setContentType(\"text/html; charset=UTF-8\");",
          "",
          "[Removed Lines]",
          "119:         when(this.xwiki.evaluateTemplate(\"resetpassword.vm\", context)).thenReturn(\"Reset password content\");",
          "",
          "[Added Lines]",
          "122:         when(this.wikiDescriptorManager.exists(\"foo\")).thenReturn(false);",
          "128:         ResourceReferenceHandlerException exception =",
          "129:             assertThrows(ResourceReferenceHandlerException.class,",
          "130:                 () -> this.resourceReferenceHandler.handle(resourceReference, chain));",
          "131:         assertEquals(\"The wiki [foo] does not exist.\", exception.getMessage());",
          "133:         when(this.wikiDescriptorManager.exists(\"foo\")).thenReturn(true);",
          "134:         when(this.xwiki.evaluateTemplate(\"resetpassword.vm\", context)).thenReturn(\"Reset password content\");",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "133:     void handleForgotUsername() throws Exception",
          "134:     {",
          "135:         WikiReference wikiReference = new WikiReference(\"bar\");",
          "136:         AuthenticationResourceReference resourceReference = new AuthenticationResourceReference(",
          "137:             wikiReference,",
          "138:             AuthenticationAction.RETRIEVE_USERNAME);",
          "140:         when(this.xwiki.evaluateTemplate(\"forgotusername.vm\", context)).thenReturn(\"Forgot user name content\");",
          "143:         this.resourceReferenceHandler.handle(resourceReference, chain);",
          "145:         verify(response).setContentType(\"text/html; charset=UTF-8\");",
          "146:         verify(this.xWikiContextInitializer).initialize(any(ExecutionContext.class));",
          "147:         verify(servletOutputStream).write(\"Forgot user name content\".getBytes(StandardCharsets.UTF_8));",
          "",
          "[Removed Lines]",
          "142:         ResourceReferenceHandlerChain chain = mock(ResourceReferenceHandlerChain.class);",
          "",
          "[Added Lines]",
          "149:         when(this.wikiDescriptorManager.exists(\"bar\")).thenReturn(false);",
          "154:         ResourceReferenceHandlerChain chain = mock(ResourceReferenceHandlerChain.class);",
          "155:         ResourceReferenceHandlerException exception =",
          "156:             assertThrows(ResourceReferenceHandlerException.class,",
          "157:                 () -> this.resourceReferenceHandler.handle(resourceReference, chain));",
          "158:         assertEquals(\"The wiki [bar] does not exist.\", exception.getMessage());",
          "160:         when(this.wikiDescriptorManager.exists(\"bar\")).thenReturn(true);",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "149:         verify(context).setWikiReference(wikiReference);",
          "150:         verify(context).setWikiReference(currentWiki);",
          "151:     }",
          "152: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "172:     @Test",
          "173:     void handleForgotUsernameWikiDescriptorError() throws Exception",
          "174:     {",
          "175:         WikiReference wikiReference = new WikiReference(\"bar\");",
          "176:         when(this.wikiDescriptorManager.exists(\"bar\")).thenThrow(new WikiManagerException(\"Cannot access wiki\"));",
          "177:         AuthenticationResourceReference resourceReference = new AuthenticationResourceReference(",
          "178:             wikiReference,",
          "179:             AuthenticationAction.RETRIEVE_USERNAME);",
          "181:         ResourceReferenceHandlerChain chain = mock(ResourceReferenceHandlerChain.class);",
          "182:         ResourceReferenceHandlerException exception =",
          "183:             assertThrows(ResourceReferenceHandlerException.class,",
          "184:                 () -> this.resourceReferenceHandler.handle(resourceReference, chain));",
          "185:         assertEquals(\"Error when checking if wiki [bar] exists.\", exception.getMessage());",
          "186:     }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "59c6f47d7e12503798e87bd2e1c16a688eb8c748",
      "candidate_info": {
        "commit_hash": "59c6f47d7e12503798e87bd2e1c16a688eb8c748",
        "repo": "xwiki/xwiki-platform",
        "commit_url": "https://github.com/xwiki/xwiki-platform/commit/59c6f47d7e12503798e87bd2e1c16a688eb8c748",
        "files": [
          "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandler.java",
          "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandlerTest.java"
        ],
        "message": "XWIKI-20335: Wiki existence is not properly checked in authenticate\n\n(cherry picked from commit 1943ea26c967ef868fb5f67c487d98d97cba0380)",
        "before_after_code_files": [
          "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandler.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandler.java",
          "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandlerTest.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandlerTest.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandler.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandler.java",
            "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandlerTest.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandlerTest.java"
          ],
          "candidate": [
            "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandler.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandler.java",
            "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandlerTest.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandlerTest.java"
          ]
        }
      },
      "candidate_diff": {
        "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandler.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandler.java": [
          "File: xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandler.java -> xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandler.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "37: import org.xwiki.resource.ResourceReferenceHandlerException;",
          "38: import org.xwiki.resource.ResourceType;",
          "39: import org.xwiki.security.authentication.AuthenticationResourceReference;",
          "41: import com.xpn.xwiki.XWikiContext;",
          "42: import com.xpn.xwiki.XWikiContextInitializer;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "40: import org.xwiki.wiki.descriptor.WikiDescriptorManager;",
          "41: import org.xwiki.wiki.manager.WikiManagerException;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "59:     @Inject",
          "60:     private Execution execution;",
          "62:     @Override",
          "63:     public List<ResourceType> getSupportedResourceReferences()",
          "64:     {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "64:     @Inject",
          "65:     private WikiDescriptorManager wikiDescriptorManager;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "71:     {",
          "72:         AuthenticationResourceReference authenticationResourceReference = (AuthenticationResourceReference) reference;",
          "74:         switch (authenticationResourceReference.getAction()) {",
          "75:             case RETRIEVE_USERNAME:",
          "76:                 this.handleAction(\"forgotusername\", authenticationResourceReference.getWikiReference());",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "79:         WikiReference wikiReference = authenticationResourceReference.getWikiReference();",
          "80:         try {",
          "81:             if (!this.wikiDescriptorManager.exists(wikiReference.getName())) {",
          "82:                 throw new ResourceReferenceHandlerException(",
          "83:                     String.format(\"The wiki [%s] does not exist.\", wikiReference.getName()));",
          "84:             }",
          "85:         } catch (WikiManagerException e) {",
          "86:             throw new ResourceReferenceHandlerException(",
          "87:                 String.format(\"Error when checking if wiki [%s] exists.\", wikiReference.getName()), e);",
          "88:         }",
          "",
          "---------------"
        ],
        "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandlerTest.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandlerTest.java": [
          "File: xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandlerTest.java -> xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandlerTest.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "31: import org.xwiki.context.ExecutionContext;",
          "32: import org.xwiki.model.reference.WikiReference;",
          "33: import org.xwiki.resource.ResourceReferenceHandlerChain;",
          "34: import org.xwiki.security.authentication.AuthenticationAction;",
          "35: import org.xwiki.security.authentication.AuthenticationResourceReference;",
          "36: import org.xwiki.test.junit5.mockito.ComponentTest;",
          "37: import org.xwiki.test.junit5.mockito.InjectMockComponents;",
          "38: import org.xwiki.test.junit5.mockito.MockComponent;",
          "40: import com.xpn.xwiki.XWiki;",
          "41: import com.xpn.xwiki.XWikiContext;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "34: import org.xwiki.resource.ResourceReferenceHandlerException;",
          "40: import org.xwiki.wiki.descriptor.WikiDescriptorManager;",
          "41: import org.xwiki.wiki.manager.WikiManagerException;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "45: import com.xpn.xwiki.web.XWikiResponse;",
          "47: import static org.junit.jupiter.api.Assertions.assertEquals;",
          "48: import static org.mockito.ArgumentMatchers.any;",
          "49: import static org.mockito.ArgumentMatchers.eq;",
          "50: import static org.mockito.Mockito.mock;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "51: import static org.junit.jupiter.api.Assertions.assertThrows;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "69:     @MockComponent",
          "70:     private Execution execution;",
          "72:     private XWikiResponse response;",
          "74:     private XWiki xwiki;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "76:     @MockComponent",
          "77:     private WikiDescriptorManager wikiDescriptorManager;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "112:     void handleResetPassword() throws Exception",
          "113:     {",
          "114:         WikiReference wikiReference = new WikiReference(\"foo\");",
          "115:         AuthenticationResourceReference resourceReference = new AuthenticationResourceReference(",
          "116:             wikiReference,",
          "117:             AuthenticationAction.RESET_PASSWORD);",
          "121:         ResourceReferenceHandlerChain chain = mock(ResourceReferenceHandlerChain.class);",
          "122:         this.resourceReferenceHandler.handle(resourceReference, chain);",
          "124:         verify(response).setContentType(\"text/html; charset=UTF-8\");",
          "",
          "[Removed Lines]",
          "119:         when(this.xwiki.evaluateTemplate(\"resetpassword.vm\", context)).thenReturn(\"Reset password content\");",
          "",
          "[Added Lines]",
          "122:         when(this.wikiDescriptorManager.exists(\"foo\")).thenReturn(false);",
          "128:         ResourceReferenceHandlerException exception =",
          "129:             assertThrows(ResourceReferenceHandlerException.class,",
          "130:                 () -> this.resourceReferenceHandler.handle(resourceReference, chain));",
          "131:         assertEquals(\"The wiki [foo] does not exist.\", exception.getMessage());",
          "133:         when(this.wikiDescriptorManager.exists(\"foo\")).thenReturn(true);",
          "134:         when(this.xwiki.evaluateTemplate(\"resetpassword.vm\", context)).thenReturn(\"Reset password content\");",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "133:     void handleForgotUsername() throws Exception",
          "134:     {",
          "135:         WikiReference wikiReference = new WikiReference(\"bar\");",
          "136:         AuthenticationResourceReference resourceReference = new AuthenticationResourceReference(",
          "137:             wikiReference,",
          "138:             AuthenticationAction.RETRIEVE_USERNAME);",
          "140:         when(this.xwiki.evaluateTemplate(\"forgotusername.vm\", context)).thenReturn(\"Forgot user name content\");",
          "143:         this.resourceReferenceHandler.handle(resourceReference, chain);",
          "145:         verify(response).setContentType(\"text/html; charset=UTF-8\");",
          "146:         verify(this.xWikiContextInitializer).initialize(any(ExecutionContext.class));",
          "147:         verify(servletOutputStream).write(\"Forgot user name content\".getBytes(StandardCharsets.UTF_8));",
          "",
          "[Removed Lines]",
          "142:         ResourceReferenceHandlerChain chain = mock(ResourceReferenceHandlerChain.class);",
          "",
          "[Added Lines]",
          "149:         when(this.wikiDescriptorManager.exists(\"bar\")).thenReturn(false);",
          "154:         ResourceReferenceHandlerChain chain = mock(ResourceReferenceHandlerChain.class);",
          "155:         ResourceReferenceHandlerException exception =",
          "156:             assertThrows(ResourceReferenceHandlerException.class,",
          "157:                 () -> this.resourceReferenceHandler.handle(resourceReference, chain));",
          "158:         assertEquals(\"The wiki [bar] does not exist.\", exception.getMessage());",
          "160:         when(this.wikiDescriptorManager.exists(\"bar\")).thenReturn(true);",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "149:         verify(context).setWikiReference(wikiReference);",
          "150:         verify(context).setWikiReference(currentWiki);",
          "151:     }",
          "152: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "172:     @Test",
          "173:     void handleForgotUsernameWikiDescriptorError() throws Exception",
          "174:     {",
          "175:         WikiReference wikiReference = new WikiReference(\"bar\");",
          "176:         when(this.wikiDescriptorManager.exists(\"bar\")).thenThrow(new WikiManagerException(\"Cannot access wiki\"));",
          "177:         AuthenticationResourceReference resourceReference = new AuthenticationResourceReference(",
          "178:             wikiReference,",
          "179:             AuthenticationAction.RETRIEVE_USERNAME);",
          "181:         ResourceReferenceHandlerChain chain = mock(ResourceReferenceHandlerChain.class);",
          "182:         ResourceReferenceHandlerException exception =",
          "183:             assertThrows(ResourceReferenceHandlerException.class,",
          "184:                 () -> this.resourceReferenceHandler.handle(resourceReference, chain));",
          "185:         assertEquals(\"Error when checking if wiki [bar] exists.\", exception.getMessage());",
          "186:     }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "ba27f91dac80069a1a2e2e29e0f5f9ad68189310",
      "candidate_info": {
        "commit_hash": "ba27f91dac80069a1a2e2e29e0f5f9ad68189310",
        "repo": "xwiki/xwiki-platform",
        "commit_url": "https://github.com/xwiki/xwiki-platform/commit/ba27f91dac80069a1a2e2e29e0f5f9ad68189310",
        "files": [
          "xwiki-platform-core/xwiki-platform-administration/xwiki-platform-administration-test/xwiki-platform-administration-test-pageobjects/src/main/java/org/xwiki/administration/test/po/ForgotUsernamePage.java",
          "xwiki-platform-core/xwiki-platform-administration/xwiki-platform-administration-test/xwiki-platform-administration-test-pageobjects/src/main/java/org/xwiki/administration/test/po/ResetPasswordPage.java",
          "xwiki-platform-core/xwiki-platform-administration/xwiki-platform-administration-ui/src/main/resources/XWiki/ForgotUsername.xml",
          "xwiki-platform-core/xwiki-platform-administration/xwiki-platform-administration-ui/src/main/resources/XWiki/ResetPassword.xml",
          "xwiki-platform-core/xwiki-platform-administration/xwiki-platform-administration-ui/src/main/resources/XWiki/ResetPasswordComplete.xml",
          "xwiki-platform-core/xwiki-platform-flamingo/xwiki-platform-flamingo-skin/xwiki-platform-flamingo-skin-resources/src/main/resources/flamingo/login.vm",
          "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-api/src/main/java/org/xwiki/security/authentication/AuthenticationAction.java",
          "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-api/src/main/java/org/xwiki/security/authentication/AuthenticationResourceReference.java",
          "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/DefaultResetPasswordManager.java",
          "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandler.java",
          "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceResolver.java",
          "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceSerializer.java",
          "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/DefaultResetPasswordManagerTest.java",
          "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandlerTest.java",
          "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceResolverTest.java",
          "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceSerializerTest.java",
          "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-script/src/main/java/org/xwiki/security/authentication/script/AuthenticationScriptService.java",
          "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-script/src/test/java/org/xwiki/security/authentication/script/AuthenticationScriptServiceTest.java",
          "xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/forgotusername.vm",
          "xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/resetpasswordinline.vm",
          "xwiki-platform-distribution/xwiki-platform-distribution-flavor/xwiki-platform-distribution-flavor-test/xwiki-platform-distribution-flavor-test-webstandards/src/test/it/org/xwiki/test/webstandards/framework/DefaultValidationTest.java"
        ],
        "message": "XWIKI-19591: Local users of subwikis can't recover password or username\n\nThis provides two things: the fix of the bug by handling a wiki part in\nthe URLs for authentication resource, and a rename of the authentication\nresource action (forgot becomes retrieveusername and reset becomes\nresetpassword).\nNote that the latter changes are not backward compatible, but they were\nstill unstable (since 13.1RC1).",
        "before_after_code_files": [
          "xwiki-platform-core/xwiki-platform-administration/xwiki-platform-administration-test/xwiki-platform-administration-test-pageobjects/src/main/java/org/xwiki/administration/test/po/ForgotUsernamePage.java||xwiki-platform-core/xwiki-platform-administration/xwiki-platform-administration-test/xwiki-platform-administration-test-pageobjects/src/main/java/org/xwiki/administration/test/po/ForgotUsernamePage.java",
          "xwiki-platform-core/xwiki-platform-administration/xwiki-platform-administration-test/xwiki-platform-administration-test-pageobjects/src/main/java/org/xwiki/administration/test/po/ResetPasswordPage.java||xwiki-platform-core/xwiki-platform-administration/xwiki-platform-administration-test/xwiki-platform-administration-test-pageobjects/src/main/java/org/xwiki/administration/test/po/ResetPasswordPage.java",
          "xwiki-platform-core/xwiki-platform-flamingo/xwiki-platform-flamingo-skin/xwiki-platform-flamingo-skin-resources/src/main/resources/flamingo/login.vm||xwiki-platform-core/xwiki-platform-flamingo/xwiki-platform-flamingo-skin/xwiki-platform-flamingo-skin-resources/src/main/resources/flamingo/login.vm",
          "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-api/src/main/java/org/xwiki/security/authentication/AuthenticationAction.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-api/src/main/java/org/xwiki/security/authentication/AuthenticationAction.java",
          "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-api/src/main/java/org/xwiki/security/authentication/AuthenticationResourceReference.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-api/src/main/java/org/xwiki/security/authentication/AuthenticationResourceReference.java",
          "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/DefaultResetPasswordManager.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/DefaultResetPasswordManager.java",
          "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandler.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandler.java",
          "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceResolver.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceResolver.java",
          "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceSerializer.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceSerializer.java",
          "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/DefaultResetPasswordManagerTest.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/DefaultResetPasswordManagerTest.java",
          "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandlerTest.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandlerTest.java",
          "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceResolverTest.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceResolverTest.java",
          "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceSerializerTest.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceSerializerTest.java",
          "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-script/src/main/java/org/xwiki/security/authentication/script/AuthenticationScriptService.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-script/src/main/java/org/xwiki/security/authentication/script/AuthenticationScriptService.java",
          "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-script/src/test/java/org/xwiki/security/authentication/script/AuthenticationScriptServiceTest.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-script/src/test/java/org/xwiki/security/authentication/script/AuthenticationScriptServiceTest.java",
          "xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/forgotusername.vm||xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/forgotusername.vm",
          "xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/resetpasswordinline.vm||xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/resetpasswordinline.vm",
          "xwiki-platform-distribution/xwiki-platform-distribution-flavor/xwiki-platform-distribution-flavor-test/xwiki-platform-distribution-flavor-test-webstandards/src/test/it/org/xwiki/test/webstandards/framework/DefaultValidationTest.java||xwiki-platform-distribution/xwiki-platform-distribution-flavor/xwiki-platform-distribution-flavor-test/xwiki-platform-distribution-flavor-test-webstandards/src/test/it/org/xwiki/test/webstandards/framework/DefaultValidationTest.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandler.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandler.java",
            "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandlerTest.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandlerTest.java"
          ],
          "candidate": [
            "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandler.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandler.java",
            "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandlerTest.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandlerTest.java"
          ]
        }
      },
      "candidate_diff": {
        "xwiki-platform-core/xwiki-platform-administration/xwiki-platform-administration-test/xwiki-platform-administration-test-pageobjects/src/main/java/org/xwiki/administration/test/po/ForgotUsernamePage.java||xwiki-platform-core/xwiki-platform-administration/xwiki-platform-administration-test/xwiki-platform-administration-test-pageobjects/src/main/java/org/xwiki/administration/test/po/ForgotUsernamePage.java": [
          "File: xwiki-platform-core/xwiki-platform-administration/xwiki-platform-administration-test/xwiki-platform-administration-test-pageobjects/src/main/java/org/xwiki/administration/test/po/ForgotUsernamePage.java -> xwiki-platform-core/xwiki-platform-administration/xwiki-platform-administration-test/xwiki-platform-administration-test-pageobjects/src/main/java/org/xwiki/administration/test/po/ForgotUsernamePage.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "40:     public static ForgotUsernamePage gotoPage()",
          "41:     {",
          "43:         return new ForgotUsernamePage();",
          "44:     }",
          "",
          "[Removed Lines]",
          "42:         getUtil().gotoPage(getUtil().getBaseURL() + \"authenticate/forgot\");",
          "",
          "[Added Lines]",
          "42:         getUtil().gotoPage(getUtil().getBaseURL() + \"authenticate/retrieveusername\");",
          "",
          "---------------"
        ],
        "xwiki-platform-core/xwiki-platform-administration/xwiki-platform-administration-test/xwiki-platform-administration-test-pageobjects/src/main/java/org/xwiki/administration/test/po/ResetPasswordPage.java||xwiki-platform-core/xwiki-platform-administration/xwiki-platform-administration-test/xwiki-platform-administration-test-pageobjects/src/main/java/org/xwiki/administration/test/po/ResetPasswordPage.java": [
          "File: xwiki-platform-core/xwiki-platform-administration/xwiki-platform-administration-test/xwiki-platform-administration-test-pageobjects/src/main/java/org/xwiki/administration/test/po/ResetPasswordPage.java -> xwiki-platform-core/xwiki-platform-administration/xwiki-platform-administration-test/xwiki-platform-administration-test-pageobjects/src/main/java/org/xwiki/administration/test/po/ResetPasswordPage.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "47:     public static ResetPasswordPage gotoPage()",
          "48:     {",
          "51:         return new ResetPasswordPage();",
          "52:     }",
          "",
          "[Removed Lines]",
          "50:         getUtil().gotoPage(getUtil().getBaseURL() + \"authenticate/reset\");",
          "",
          "[Added Lines]",
          "50:         getUtil().gotoPage(getUtil().getBaseURL() + \"authenticate/resetpassword\");",
          "",
          "---------------"
        ],
        "xwiki-platform-core/xwiki-platform-flamingo/xwiki-platform-flamingo-skin/xwiki-platform-flamingo-skin-resources/src/main/resources/flamingo/login.vm||xwiki-platform-core/xwiki-platform-flamingo/xwiki-platform-flamingo-skin/xwiki-platform-flamingo-skin-resources/src/main/resources/flamingo/login.vm": [
          "File: xwiki-platform-core/xwiki-platform-flamingo/xwiki-platform-flamingo-skin/xwiki-platform-flamingo-skin-resources/src/main/resources/flamingo/login.vm -> xwiki-platform-core/xwiki-platform-flamingo/xwiki-platform-flamingo-skin/xwiki-platform-flamingo-skin-resources/src/main/resources/flamingo/login.vm",
          "--- Hunk 1 ---",
          "[Context before]",
          "58: <dl>",
          "59:   <dt>",
          "60:     <label for=\"j_username\">$services.localization.render('username')</label>",
          "62:     #if(\"$!forgotUsernameURL\" != \"\")",
          "63:       <span class=\"xAdditional\"><a href=\"$forgotUsernameURL\" tabindex=\"500\">$services.localization.render('xe.admin.forgotUsername.loginMessage')</a></span>",
          "64:     #end",
          "",
          "[Removed Lines]",
          "61:     #set ($forgotUsernameURL = $services.security.authentication.getAuthenticationURL('forgot', $NULL))",
          "",
          "[Added Lines]",
          "61:     #set ($forgotUsernameURL = $services.security.authentication.getAuthenticationURL('retrieveusername', $NULL))",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "69:   </dd>",
          "70:   <dt>",
          "71:     <label for=\"j_password\">$services.localization.render('password')</label>",
          "73:     #if(\"$!resetPasswordUrl\" != '')",
          "74:       <span class=\"xAdditional\"><a href=\"$resetPasswordUrl\" tabindex=\"600\">$services.localization.render('xe.admin.passwordReset.loginMessage')</a></span>",
          "75:     #end",
          "",
          "[Removed Lines]",
          "72:     #set ($resetPasswordUrl = $services.security.authentication.getAuthenticationURL('reset', $NULL))",
          "",
          "[Added Lines]",
          "72:     #set ($resetPasswordUrl = $services.security.authentication.getAuthenticationURL('resetpassword', $NULL))",
          "",
          "---------------"
        ],
        "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-api/src/main/java/org/xwiki/security/authentication/AuthenticationAction.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-api/src/main/java/org/xwiki/security/authentication/AuthenticationAction.java": [
          "File: xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-api/src/main/java/org/xwiki/security/authentication/AuthenticationAction.java -> xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-api/src/main/java/org/xwiki/security/authentication/AuthenticationAction.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "46:     AuthenticationAction(String requestParameter)",
          "47:     {",
          "",
          "[Removed Lines]",
          "37:     RESET_PASSWORD(\"reset\"),",
          "42:     FORGOT_USERNAME(\"forgot\");",
          "44:     private String requestParameter;",
          "",
          "[Added Lines]",
          "37:     RESET_PASSWORD(\"resetpassword\"),",
          "42:     RETRIEVE_USERNAME(\"retrieveusername\");",
          "44:     private final String requestParameter;",
          "",
          "---------------"
        ],
        "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-api/src/main/java/org/xwiki/security/authentication/AuthenticationResourceReference.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-api/src/main/java/org/xwiki/security/authentication/AuthenticationResourceReference.java": [
          "File: xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-api/src/main/java/org/xwiki/security/authentication/AuthenticationResourceReference.java -> xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-api/src/main/java/org/xwiki/security/authentication/AuthenticationResourceReference.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "22: import org.apache.commons.lang3.builder.EqualsBuilder;",
          "23: import org.apache.commons.lang3.builder.HashCodeBuilder;",
          "24: import org.xwiki.resource.AbstractResourceReference;",
          "25: import org.xwiki.resource.ResourceType;",
          "26: import org.xwiki.stability.Unstable;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "24: import org.apache.commons.lang3.builder.ToStringBuilder;",
          "25: import org.xwiki.model.reference.WikiReference;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "46:     public static final ResourceType TYPE = new ResourceType(RESOURCE_TYPE_ID);",
          "55:     {",
          "56:         setType(TYPE);",
          "57:         this.action = action;",
          "58:     }",
          "",
          "[Removed Lines]",
          "48:     private AuthenticationAction action;",
          "54:     public AuthenticationResourceReference(AuthenticationAction action)",
          "",
          "[Added Lines]",
          "50:     private final WikiReference wikiReference;",
          "52:     private final AuthenticationAction action;",
          "60:     public AuthenticationResourceReference(WikiReference wikiReference, AuthenticationAction action)",
          "63:         this.wikiReference = wikiReference;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "65:         return action;",
          "66:     }",
          "68:     @Override",
          "69:     public boolean equals(Object o)",
          "70:     {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "81:     public WikiReference getWikiReference()",
          "82:     {",
          "83:         return wikiReference;",
          "84:     }",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "79:         AuthenticationResourceReference that = (AuthenticationResourceReference) o;",
          "82:             .isEquals();",
          "83:     }",
          "85:     @Override",
          "86:     public int hashCode()",
          "87:     {",
          "89:     }",
          "90: }",
          "",
          "[Removed Lines]",
          "81:         return new EqualsBuilder().appendSuper(super.equals(o)).append(action, that.action)",
          "88:         return new HashCodeBuilder(17, 37).appendSuper(super.hashCode()).append(action).toHashCode();",
          "",
          "[Added Lines]",
          "99:         return new EqualsBuilder()",
          "100:             .appendSuper(super.equals(o))",
          "101:             .append(action, that.action)",
          "102:             .append(wikiReference, that.wikiReference)",
          "109:         return new HashCodeBuilder(17, 37)",
          "110:             .appendSuper(super.hashCode())",
          "111:             .append(action)",
          "112:             .append(wikiReference)",
          "113:             .toHashCode();",
          "114:     }",
          "116:     @Override",
          "117:     public String toString()",
          "118:     {",
          "119:         return new ToStringBuilder(this)",
          "120:             .appendSuper(super.toString())",
          "121:             .append(\"wikiReference\", wikiReference)",
          "122:             .append(\"action\", action)",
          "123:             .toString();",
          "",
          "---------------"
        ],
        "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/DefaultResetPasswordManager.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/DefaultResetPasswordManager.java": [
          "File: xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/DefaultResetPasswordManager.java -> xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/DefaultResetPasswordManager.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "188:         throws ResetPasswordException",
          "189:     {",
          "190:         if (this.checkUserReference(requestResponse.getUserReference())) {",
          "194:             UserReference userReference = requestResponse.getUserReference();",
          "195:             UserProperties userProperties = this.userPropertiesResolver.resolve(userReference);",
          "",
          "[Removed Lines]",
          "191:             AuthenticationResourceReference resourceReference =",
          "192:                 new AuthenticationResourceReference(AuthenticationAction.RESET_PASSWORD);",
          "",
          "[Added Lines]",
          "191:             AuthenticationResourceReference resourceReference = new AuthenticationResourceReference(",
          "192:                 this.contextProvider.get().getWikiReference(),",
          "193:                 AuthenticationAction.RESET_PASSWORD);",
          "",
          "---------------"
        ],
        "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandler.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandler.java": [
          "File: xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandler.java -> xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandler.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "30: import org.xwiki.component.annotation.Component;",
          "31: import org.xwiki.context.Execution;",
          "32: import org.xwiki.context.ExecutionContext;",
          "33: import org.xwiki.resource.AbstractResourceReferenceHandler;",
          "34: import org.xwiki.resource.ResourceReference;",
          "35: import org.xwiki.resource.ResourceReferenceHandlerChain;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "33: import org.xwiki.model.reference.WikiReference;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "71:         AuthenticationResourceReference authenticationResourceReference = (AuthenticationResourceReference) reference;",
          "73:         switch (authenticationResourceReference.getAction()) {",
          "76:                 break;",
          "78:             case RESET_PASSWORD:",
          "80:                 break;",
          "82:             default:",
          "",
          "[Removed Lines]",
          "74:             case FORGOT_USERNAME:",
          "75:                 this.handleAction(\"forgotusername\");",
          "79:                 this.handleAction(\"resetpassword\");",
          "",
          "[Added Lines]",
          "75:             case RETRIEVE_USERNAME:",
          "76:                 this.handleAction(\"forgotusername\", authenticationResourceReference.getWikiReference());",
          "80:                 this.handleAction(\"resetpassword\", authenticationResourceReference.getWikiReference());",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "88:         chain.handleNext(reference);",
          "89:     }",
          "92:     {",
          "96:         }",
          "97:         try {",
          "102:         } catch (Exception e) {",
          "103:             throw new ResourceReferenceHandlerException(",
          "104:                 String.format(\"Error while rendering template [%s]: [%s].\",",
          "105:                 templateName, ExceptionUtils.getRootCauseMessage(e)), e);",
          "106:         }",
          "107:     }",
          "108: }",
          "",
          "[Removed Lines]",
          "91:     private void handleAction(String templateName) throws ResourceReferenceHandlerException",
          "93:         ExecutionContext context = this.execution.getContext();",
          "94:         if (context == null) {",
          "95:             context = new ExecutionContext();",
          "98:             XWikiContext xWikiContext = this.xWikiContextInitializer.initialize(context);",
          "101:             Utils.parseTemplate(templateName, true, xWikiContext);",
          "",
          "[Added Lines]",
          "92:     private void handleAction(String templateName, WikiReference wikiReference) throws ResourceReferenceHandlerException",
          "94:         ExecutionContext executionContext = this.execution.getContext();",
          "95:         if (executionContext == null) {",
          "96:             executionContext = new ExecutionContext();",
          "98:         WikiReference currentWiki = null;",
          "99:         XWikiContext context = null;",
          "101:             context = this.xWikiContextInitializer.initialize(executionContext);",
          "102:             currentWiki = context.getWikiReference();",
          "103:             context.setWikiReference(wikiReference);",
          "106:             Utils.parseTemplate(templateName, true, context);",
          "111:         } finally {",
          "112:             if (currentWiki != null) {",
          "113:                 context.setWikiReference(currentWiki);",
          "114:             }",
          "",
          "---------------"
        ],
        "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceResolver.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceResolver.java": [
          "File: xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceResolver.java -> xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceResolver.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "22: import java.util.List;",
          "23: import java.util.Map;",
          "25: import javax.inject.Named;",
          "26: import javax.inject.Singleton;",
          "28: import org.xwiki.component.annotation.Component;",
          "29: import org.xwiki.resource.CreateResourceReferenceException;",
          "30: import org.xwiki.resource.ResourceType;",
          "31: import org.xwiki.resource.UnsupportedResourceReferenceException;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "25: import javax.inject.Inject;",
          "27: import javax.inject.Provider;",
          "31: import org.xwiki.model.reference.WikiReference;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "34: import org.xwiki.url.ExtendedURL;",
          "35: import org.xwiki.url.internal.AbstractResourceReferenceResolver;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "40: import com.xpn.xwiki.XWikiContext;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "47: @Singleton",
          "48: public class AuthenticationResourceReferenceResolver extends AbstractResourceReferenceResolver",
          "49: {",
          "50:     @Override",
          "51:     public AuthenticationResourceReference resolve(ExtendedURL representation, ResourceType resourceType,",
          "52:         Map<String, Object> parameters) throws CreateResourceReferenceException, UnsupportedResourceReferenceException",
          "53:     {",
          "54:         AuthenticationResourceReference result;",
          "55:         List<String> segments = representation.getSegments();",
          "56:         if (segments.size() == 1) {",
          "67:         } else {",
          "68:             throw new CreateResourceReferenceException(",
          "69:                 String.format(\"Invalid Authentication URL format: [%s]\", representation.toString()));",
          "70:         }",
          "71:     }",
          "72: }",
          "",
          "[Removed Lines]",
          "57:             String actionName = segments.get(0);",
          "58:             try {",
          "59:                 AuthenticationAction authenticationAction = AuthenticationAction.getFromRequestParameter(actionName);",
          "60:                 result = new AuthenticationResourceReference(authenticationAction);",
          "61:                 copyParameters(representation, result);",
          "62:                 return result;",
          "63:             } catch (IllegalArgumentException e) {",
          "64:                 throw new CreateResourceReferenceException(",
          "65:                     String.format(\"Cannot find an authentication action for name [%s]\", actionName));",
          "66:             }",
          "",
          "[Added Lines]",
          "55:     @Inject",
          "56:     private Provider<XWikiContext> contextProvider;",
          "64:         WikiReference wikiReference = new WikiReference(contextProvider.get().getMainXWiki());",
          "67:             result = new AuthenticationResourceReference(wikiReference, getAuthenticationAction(segments.get(0)));",
          "68:             copyParameters(representation, result);",
          "69:         } else if (segments.size() == 3 && \"wiki\".equals(segments.get(0))) {",
          "70:             wikiReference = new WikiReference(segments.get(1));",
          "71:             result = new AuthenticationResourceReference(wikiReference, getAuthenticationAction(segments.get(2)));",
          "72:             copyParameters(representation, result);",
          "77:         return result;",
          "78:     }",
          "80:     private AuthenticationAction getAuthenticationAction(String actionName) throws CreateResourceReferenceException",
          "81:     {",
          "82:         try {",
          "83:             return AuthenticationAction.getFromRequestParameter(actionName);",
          "84:         } catch (IllegalArgumentException e) {",
          "85:             throw new CreateResourceReferenceException(",
          "86:                 String.format(\"Cannot find an authentication action for name [%s]\", actionName));",
          "87:         }",
          "",
          "---------------"
        ],
        "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceSerializer.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceSerializer.java": [
          "File: xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceSerializer.java -> xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceSerializer.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "47:     {",
          "48:         return new ExtendedURL(Arrays.asList(",
          "49:             AuthenticationResourceReference.TYPE.getId(),",
          "50:             resource.getAction().getRequestParameter()),",
          "51:             resource.getParameters());",
          "52:     }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "50:             \"wiki\",",
          "51:             resource.getWikiReference().getName(),",
          "",
          "---------------"
        ],
        "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/DefaultResetPasswordManagerTest.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/DefaultResetPasswordManagerTest.java": [
          "File: xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/DefaultResetPasswordManagerTest.java -> xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/DefaultResetPasswordManagerTest.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "35: import org.xwiki.configuration.ConfigurationSource;",
          "36: import org.xwiki.localization.ContextualLocalizationManager;",
          "37: import org.xwiki.model.reference.DocumentReference;",
          "38: import org.xwiki.resource.ResourceReference;",
          "39: import org.xwiki.resource.ResourceReferenceSerializer;",
          "40: import org.xwiki.security.authentication.AuthenticationAction;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "38: import org.xwiki.model.reference.WikiReference;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "226:         when(this.referenceSerializer.serialize(this.userReference)).thenReturn(\"user:Foobar\");",
          "227:         when(this.userProperties.getFirstName()).thenReturn(\"Foo\");",
          "228:         when(this.userProperties.getLastName()).thenReturn(\"Bar\");",
          "230:         AuthenticationResourceReference resourceReference =",
          "233:         String verificationCode = \"foobar4242\";",
          "234:         resourceReference.addParameter(\"u\", \"user:Foobar\");",
          "",
          "[Removed Lines]",
          "231:             new AuthenticationResourceReference(AuthenticationAction.RESET_PASSWORD);",
          "",
          "[Added Lines]",
          "230:         WikiReference wikiReference = new WikiReference(\"foo\");",
          "231:         when(this.context.getWikiReference()).thenReturn(wikiReference);",
          "233:             new AuthenticationResourceReference(wikiReference, AuthenticationAction.RESET_PASSWORD);",
          "",
          "---------------"
        ],
        "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandlerTest.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandlerTest.java": [
          "File: xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandlerTest.java -> xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceHandlerTest.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "29: import org.junit.jupiter.api.Test;",
          "30: import org.xwiki.context.Execution;",
          "31: import org.xwiki.context.ExecutionContext;",
          "32: import org.xwiki.resource.ResourceReferenceHandlerChain;",
          "33: import org.xwiki.security.authentication.AuthenticationAction;",
          "34: import org.xwiki.security.authentication.AuthenticationResourceReference;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "32: import org.xwiki.model.reference.WikiReference;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "73:     private XWiki xwiki;",
          "77:     private ServletOutputStream servletOutputStream;",
          "79:     @BeforeEach",
          "80:     void setup() throws XWikiException, IOException",
          "81:     {",
          "82:         ExecutionContext executionContext = mock(ExecutionContext.class);",
          "83:         when(this.execution.getContext()).thenReturn(executionContext);",
          "86:         this.response = mock(XWikiResponse.class);",
          "88:         this.xwiki = mock(XWiki.class);",
          "90:         when(this.xwiki.getEncoding()).thenReturn(\"UTF-8\");",
          "91:         XWikiPluginManager pluginManager = mock(XWikiPluginManager.class);",
          "92:         when(this.xwiki.getPluginManager()).thenReturn(pluginManager);",
          "94:             .then(invocationOnMock -> invocationOnMock.getArgument(0));",
          "95:         this.servletOutputStream = mock(ServletOutputStream.class);",
          "96:         when(this.response.getOutputStream()).thenReturn(servletOutputStream);",
          "97:     }",
          "99:     @Test",
          "",
          "[Removed Lines]",
          "75:     private XWikiContext xWikiContext;",
          "84:         this.xWikiContext = mock(XWikiContext.class);",
          "85:         when(this.xWikiContextInitializer.initialize(executionContext)).thenReturn(xWikiContext);",
          "87:         when(xWikiContext.getResponse()).thenReturn(response);",
          "89:         when(xWikiContext.getWiki()).thenReturn(xwiki);",
          "93:         when(pluginManager.endParsing(any(), eq(xWikiContext)))",
          "",
          "[Added Lines]",
          "76:     private XWikiContext context;",
          "80:     private WikiReference currentWiki;",
          "87:         this.context = mock(XWikiContext.class);",
          "88:         when(this.xWikiContextInitializer.initialize(executionContext)).thenReturn(context);",
          "90:         when(context.getResponse()).thenReturn(response);",
          "92:         when(context.getWiki()).thenReturn(xwiki);",
          "96:         when(pluginManager.endParsing(any(), eq(context)))",
          "100:         currentWiki = new WikiReference(\"currentWiki\");",
          "101:         when(context.getWikiReference()).thenReturn(currentWiki);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "106:     @Test",
          "107:     void handleResetPassword() throws Exception",
          "108:     {",
          "109:         AuthenticationResourceReference resourceReference = new AuthenticationResourceReference(",
          "110:             AuthenticationAction.RESET_PASSWORD);",
          "114:         ResourceReferenceHandlerChain chain = mock(ResourceReferenceHandlerChain.class);",
          "115:         this.resourceReferenceHandler.handle(resourceReference, chain);",
          "",
          "[Removed Lines]",
          "112:         when(this.xwiki.evaluateTemplate(\"resetpassword.vm\", xWikiContext)).thenReturn(\"Reset password content\");",
          "",
          "[Added Lines]",
          "114:         WikiReference wikiReference = new WikiReference(\"foo\");",
          "116:             wikiReference,",
          "119:         when(this.xwiki.evaluateTemplate(\"resetpassword.vm\", context)).thenReturn(\"Reset password content\");",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "118:         verify(this.xWikiContextInitializer).initialize(any(ExecutionContext.class));",
          "119:         verify(servletOutputStream).write(\"Reset password content\".getBytes(StandardCharsets.UTF_8));",
          "120:         verify(chain).handleNext(resourceReference);",
          "121:     }",
          "123:     @Test",
          "124:     void handleForgotUsername() throws Exception",
          "125:     {",
          "126:         AuthenticationResourceReference resourceReference = new AuthenticationResourceReference(",
          "131:         ResourceReferenceHandlerChain chain = mock(ResourceReferenceHandlerChain.class);",
          "132:         this.resourceReferenceHandler.handle(resourceReference, chain);",
          "",
          "[Removed Lines]",
          "127:             AuthenticationAction.FORGOT_USERNAME);",
          "129:         when(this.xwiki.evaluateTemplate(\"forgotusername.vm\", xWikiContext)).thenReturn(\"Forgot user name content\");",
          "",
          "[Added Lines]",
          "128:         verify(context).setWikiReference(wikiReference);",
          "129:         verify(context).setWikiReference(currentWiki);",
          "135:         WikiReference wikiReference = new WikiReference(\"bar\");",
          "137:             wikiReference,",
          "138:             AuthenticationAction.RETRIEVE_USERNAME);",
          "140:         when(this.xwiki.evaluateTemplate(\"forgotusername.vm\", context)).thenReturn(\"Forgot user name content\");",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "135:         verify(this.xWikiContextInitializer).initialize(any(ExecutionContext.class));",
          "136:         verify(servletOutputStream).write(\"Forgot user name content\".getBytes(StandardCharsets.UTF_8));",
          "137:         verify(chain).handleNext(resourceReference);",
          "138:     }",
          "139: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "149:         verify(context).setWikiReference(wikiReference);",
          "150:         verify(context).setWikiReference(currentWiki);",
          "",
          "---------------"
        ],
        "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceResolverTest.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceResolverTest.java": [
          "File: xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceResolverTest.java -> xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceResolverTest.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "24: import java.util.HashMap;",
          "25: import java.util.Map;",
          "27: import org.junit.jupiter.api.Test;",
          "28: import org.xwiki.resource.CreateResourceReferenceException;",
          "29: import org.xwiki.resource.UnsupportedResourceReferenceException;",
          "30: import org.xwiki.security.authentication.AuthenticationAction;",
          "31: import org.xwiki.security.authentication.AuthenticationResourceReference;",
          "32: import org.xwiki.test.junit5.mockito.ComponentTest;",
          "33: import org.xwiki.test.junit5.mockito.InjectMockComponents;",
          "34: import org.xwiki.url.ExtendedURL;",
          "36: import static org.junit.jupiter.api.Assertions.assertEquals;",
          "37: import static org.junit.jupiter.api.Assertions.assertThrows;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "27: import javax.inject.Provider;",
          "29: import org.junit.jupiter.api.BeforeEach;",
          "31: import org.xwiki.model.reference.WikiReference;",
          "38: import org.xwiki.test.junit5.mockito.MockComponent;",
          "41: import com.xpn.xwiki.XWikiContext;",
          "45: import static org.mockito.Mockito.mock;",
          "46: import static org.mockito.Mockito.when;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "47:     @InjectMockComponents",
          "48:     private AuthenticationResourceReferenceResolver resolver;",
          "50:     @Test",
          "51:     void resolve() throws CreateResourceReferenceException, UnsupportedResourceReferenceException",
          "52:     {",
          "53:         Map parameters = new HashMap<>();",
          "54:         parameters.put(\"key1\", Collections.singletonList(\"value1\"));",
          "55:         parameters.put(\"key2\", Arrays.asList(\"value2_a\", \"value2_b\"));",
          "58:         AuthenticationResourceReference resourceReference =",
          "59:             this.resolver.resolve(extendedURL, AuthenticationResourceReference.TYPE, parameters);",
          "61:         AuthenticationResourceReference expectedReference = new AuthenticationResourceReference(",
          "62:             AuthenticationAction.RESET_PASSWORD);",
          "63:         expectedReference.addParameter(\"key1\", Collections.singletonList(\"value1\"));",
          "64:         expectedReference.addParameter(\"key2\", Arrays.asList(\"value2_a\", \"value2_b\"));",
          "66:         assertEquals(expectedReference, resourceReference);",
          "67:     }",
          "69:     @Test",
          "70:     void resolveBadAction()",
          "71:     {",
          "72:         ExtendedURL extendedURL = new ExtendedURL(Collections.singletonList(\"foobar\"), Collections.emptyMap());",
          "73:         CreateResourceReferenceException createResourceReferenceException =",
          "74:             assertThrows(CreateResourceReferenceException.class,",
          "",
          "[Removed Lines]",
          "57:         ExtendedURL extendedURL = new ExtendedURL(Collections.singletonList(\"reset\"), parameters);",
          "",
          "[Added Lines]",
          "59:     @MockComponent",
          "60:     private Provider<XWikiContext> contextProvider;",
          "62:     private XWikiContext context;",
          "64:     @BeforeEach",
          "65:     void setup()",
          "66:     {",
          "67:         this.context = mock(XWikiContext.class);",
          "68:         when(contextProvider.get()).thenReturn(this.context);",
          "69:     }",
          "74:         WikiReference currentWiki = new WikiReference(\"current\");",
          "75:         when(this.context.getMainXWiki()).thenReturn(\"current\");",
          "80:         ExtendedURL extendedURL = new ExtendedURL(Collections.singletonList(\"resetpassword\"), parameters);",
          "85:             currentWiki,",
          "92:         extendedURL = new ExtendedURL(Arrays.asList(\"wiki\", \"foo\", \"retrieveusername\"), parameters);",
          "93:         resourceReference =",
          "94:             this.resolver.resolve(extendedURL, AuthenticationResourceReference.TYPE, parameters);",
          "96:         expectedReference = new AuthenticationResourceReference(",
          "97:             new WikiReference(\"foo\"),",
          "98:             AuthenticationAction.RETRIEVE_USERNAME);",
          "99:         expectedReference.addParameter(\"key1\", Collections.singletonList(\"value1\"));",
          "100:         expectedReference.addParameter(\"key2\", Arrays.asList(\"value2_a\", \"value2_b\"));",
          "102:         assertEquals(expectedReference, resourceReference);",
          "108:         when(this.context.getMainXWiki()).thenReturn(\"current\");",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "77:         assertEquals(\"Cannot find an authentication action for name [foobar]\",",
          "78:             createResourceReferenceException.getMessage());",
          "79:     }",
          "81:     @Test",
          "82:     void resolveBadURL()",
          "83:     {",
          "84:         ExtendedURL extendedURL = new ExtendedURL(Arrays.asList(\"authenticate\", \"foobar\"));",
          "85:         CreateResourceReferenceException createResourceReferenceException =",
          "86:             assertThrows(CreateResourceReferenceException.class,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "117:         ExtendedURL extendedURL2 = new ExtendedURL(Arrays.asList(\"wiki\", \"foo\", \"foobar\"), Collections.emptyMap());",
          "118:         createResourceReferenceException =",
          "119:             assertThrows(CreateResourceReferenceException.class,",
          "120:                 () -> this.resolver.resolve(extendedURL2,",
          "121:                     AuthenticationResourceReference.TYPE, Collections.emptyMap()));",
          "123:         assertEquals(\"Cannot find an authentication action for name [foobar]\",",
          "124:             createResourceReferenceException.getMessage());",
          "130:         when(this.context.getMainXWiki()).thenReturn(\"current\");",
          "",
          "---------------"
        ],
        "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceSerializerTest.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceSerializerTest.java": [
          "File: xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceSerializerTest.java -> xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/resource/AuthenticationResourceReferenceSerializerTest.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "27: import org.apache.commons.collections.map.HashedMap;",
          "28: import org.junit.jupiter.api.Test;",
          "29: import org.xwiki.resource.SerializeResourceReferenceException;",
          "30: import org.xwiki.resource.UnsupportedResourceReferenceException;",
          "31: import org.xwiki.security.authentication.AuthenticationAction;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "29: import org.xwiki.model.reference.WikiReference;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "50:     @Test",
          "51:     void serialize() throws UnsupportedResourceReferenceException, SerializeResourceReferenceException",
          "52:     {",
          "53:         AuthenticationResourceReference resourceReference = new AuthenticationResourceReference(",
          "55:         resourceReference.addParameter(\"key1\", \"value1\");",
          "56:         resourceReference.addParameter(\"key2\", Arrays.asList(\"value2_a\", \"value2_b\"));",
          "",
          "[Removed Lines]",
          "54:             AuthenticationAction.FORGOT_USERNAME);",
          "",
          "[Added Lines]",
          "54:         WikiReference currentWiki = new WikiReference(\"current\");",
          "56:             currentWiki,",
          "57:             AuthenticationAction.RETRIEVE_USERNAME);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "60:         Map<String, List<String>> parameters = new HashedMap();",
          "61:         parameters.put(\"key1\", Collections.singletonList(\"value1\"));",
          "62:         parameters.put(\"key2\", Arrays.asList(\"value2_a\", \"value2_b\"));",
          "65:         assertEquals(expectedURL, serialized);",
          "66:     }",
          "",
          "[Removed Lines]",
          "63:         ExtendedURL expectedURL = new ExtendedURL(Arrays.asList(\"authenticate\", \"forgot\"), parameters);",
          "",
          "[Added Lines]",
          "66:         ExtendedURL expectedURL = new ExtendedURL(",
          "67:             Arrays.asList(\"authenticate\", \"wiki\", \"current\", \"retrieveusername\"), parameters);",
          "",
          "---------------"
        ],
        "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-script/src/main/java/org/xwiki/security/authentication/script/AuthenticationScriptService.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-script/src/main/java/org/xwiki/security/authentication/script/AuthenticationScriptService.java": [
          "File: xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-script/src/main/java/org/xwiki/security/authentication/script/AuthenticationScriptService.java -> xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-script/src/main/java/org/xwiki/security/authentication/script/AuthenticationScriptService.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "166:         try {",
          "167:             AuthenticationAction authenticationAction = AuthenticationAction.getFromRequestParameter(action);",
          "171:             if (params != null) {",
          "172:                 for (Map.Entry<String, Object> entry : params.entrySet()) {",
          "173:                     resourceReference.addParameter(entry.getKey(), entry.getValue());",
          "",
          "[Removed Lines]",
          "169:             AuthenticationResourceReference resourceReference =",
          "170:                 new AuthenticationResourceReference(authenticationAction);",
          "",
          "[Added Lines]",
          "169:             AuthenticationResourceReference resourceReference = new AuthenticationResourceReference(",
          "170:                 this.contextProvider.get().getWikiReference(),",
          "171:                 authenticationAction);",
          "",
          "---------------"
        ],
        "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-script/src/test/java/org/xwiki/security/authentication/script/AuthenticationScriptServiceTest.java||xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-script/src/test/java/org/xwiki/security/authentication/script/AuthenticationScriptServiceTest.java": [
          "File: xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-script/src/test/java/org/xwiki/security/authentication/script/AuthenticationScriptServiceTest.java -> xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-script/src/test/java/org/xwiki/security/authentication/script/AuthenticationScriptServiceTest.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "32: import org.junit.jupiter.api.BeforeEach;",
          "33: import org.junit.jupiter.api.Test;",
          "34: import org.junit.jupiter.api.extension.RegisterExtension;",
          "35: import org.xwiki.resource.ResourceReference;",
          "36: import org.xwiki.resource.ResourceReferenceSerializer;",
          "37: import org.xwiki.security.authentication.AuthenticationAction;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "35: import org.xwiki.model.reference.WikiReference;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "166:     @Test",
          "167:     void getAuthenticationURL() throws Exception",
          "168:     {",
          "170:         Map<String, Object> parameters = new HashMap<>();",
          "171:         parameters.put(\"u\", \"foo\");",
          "172:         parameters.put(\"v\", \"bar\");",
          "174:         AuthenticationResourceReference resourceReference =",
          "176:         resourceReference.addParameter(\"u\", \"foo\");",
          "177:         resourceReference.addParameter(\"v\", \"bar\");",
          "",
          "[Removed Lines]",
          "169:         String action = AuthenticationAction.FORGOT_USERNAME.getRequestParameter();",
          "175:             new AuthenticationResourceReference(AuthenticationAction.FORGOT_USERNAME);",
          "",
          "[Added Lines]",
          "170:         String action = AuthenticationAction.RETRIEVE_USERNAME.getRequestParameter();",
          "175:         WikiReference wikiReference = new WikiReference(\"current\");",
          "176:         when(this.xWikiContext.getWikiReference()).thenReturn(wikiReference);",
          "179:             new AuthenticationResourceReference(wikiReference, AuthenticationAction.RETRIEVE_USERNAME);",
          "",
          "---------------"
        ],
        "xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/forgotusername.vm||xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/forgotusername.vm": [
          "File: xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/forgotusername.vm -> xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/forgotusername.vm",
          "--- Hunk 1 ---",
          "[Context before]",
          "41:       #if($email == '' || !$services.csrf.isTokenValid($request.form_token))",
          "42:         #forgotUsernameBoxStart(\"default\")",
          "43:         $services.localization.render('xe.admin.forgotUsername.instructions')",
          "45:             <dl>",
          "46:                 <dt>",
          "47:                     <label for=\"e\">$services.localization.render('xe.admin.forgotUsername.email.label')</label>",
          "",
          "[Removed Lines]",
          "44:         <form method=\"post\" action=\"$services.security.authentication.getAuthenticationURL('forgot', $NULL)\" id=\"forgotUsernameForm\" class=\"xform\">",
          "",
          "[Added Lines]",
          "44:         <form method=\"post\" action=\"$services.security.authentication.getAuthenticationURL('retrieveusername', $NULL)\" id=\"forgotUsernameForm\" class=\"xform\">",
          "",
          "---------------"
        ],
        "xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/resetpasswordinline.vm||xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/resetpasswordinline.vm": [
          "File: xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/resetpasswordinline.vm -> xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/resetpasswordinline.vm",
          "--- Hunk 1 ---",
          "[Context before]",
          "61: #resetPasswordBoxStart(\"default\")",
          "62: $services.localization.render('xe.admin.passwordReset.instructions')",
          "65:     <input type=\"hidden\" name=\"form_token\" value=\"$!{services.csrf.getToken()}\" />",
          "66:     <dl>",
          "67:       <dt>",
          "",
          "[Removed Lines]",
          "64:   <form method=\"post\" action=\"$services.security.authentication.getAuthenticationURL('reset', $NULL)\" class=\"xform\" id=\"resetPasswordForm\">",
          "",
          "[Added Lines]",
          "64:   <form method=\"post\" action=\"$services.security.authentication.getAuthenticationURL('resetpassword', $NULL)\" class=\"xform\" id=\"resetPasswordForm\">",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "93:         #end",
          "94:     #end",
          "95:   <div class=\"resetpasswordlinks\">",
          "98:     <a href=\"$xwiki.getURL('XWiki.XWikiLogin', 'login')\">$services.localization.render('xe.admin.passwordReset.login')</a>",
          "99:   </div>",
          "100: #else",
          "",
          "[Removed Lines]",
          "96:     <a href=\"$services.security.authentication.getAuthenticationURL('reset', $NULL)\">$services.localization.render('xe.admin.passwordReset.error.retry')</a> |",
          "97:     <a href=\"$services.security.authentication.getAuthenticationURL('forgot', $NULL)\">$services.localization.render('xe.admin.passwordReset.error.recoverUsername')</a> |",
          "",
          "[Added Lines]",
          "96:     <a href=\"$services.security.authentication.getAuthenticationURL('resetpassword', $NULL)\">$services.localization.render('xe.admin.passwordReset.error.retry')</a> |",
          "97:     <a href=\"$services.security.authentication.getAuthenticationURL('retrieveusername', $NULL)\">$services.localization.render('xe.admin.passwordReset.error.recoverUsername')</a> |",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "118:         #set ($passwordFields = [])",
          "119:         #definePasswordFields($passwordFields, 'p', 'p2', $passwordOptions)",
          "122:             <div class=\"hidden\">",
          "123:                 <input type=\"hidden\" name=\"form_token\" value=\"$!{services.csrf.getToken()}\" />",
          "124:                 <input type=\"hidden\" name=\"u\" value=\"$!escapetool.xml($userName)\"/>",
          "",
          "[Removed Lines]",
          "121:         <form action=\"$services.security.authentication.getAuthenticationURL('reset', $NULL)\" method=\"post\" id=\"resetPasswordStep2Form\" class=\"xform\">",
          "",
          "[Added Lines]",
          "121:         <form action=\"$services.security.authentication.getAuthenticationURL('resetpassword', $NULL)\" method=\"post\" id=\"resetPasswordStep2Form\" class=\"xform\">",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "140:         #if (\"$!exception\" != '')",
          "141:             #resetPasswordBoxStart(\"danger\")",
          "142:             #displayResetPasswordException()",
          "144:         #else",
          "145:             #displayForm('' $newValidationString)",
          "146:         #end",
          "",
          "[Removed Lines]",
          "143:             <a href=\"$services.security.authentication.getAuthenticationURL('reset', $NULL)\">$services.localization.render('xe.admin.passwordReset.step2.backToStep1')</a>",
          "",
          "[Added Lines]",
          "143:             <a href=\"$services.security.authentication.getAuthenticationURL('resetpassword', $NULL)\">$services.localization.render('xe.admin.passwordReset.step2.backToStep1')</a>",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "159:                 #resetPasswordBoxStart(\"danger\")",
          "160:                 #displayResetPasswordException()",
          "161:                 <div class=\"resetpasswordlinks\">",
          "163:                 </div>",
          "164:             #else",
          "165:                 #resetPasswordBoxStart(\"success\")",
          "",
          "[Removed Lines]",
          "162:                     <a href=\"$services.security.authentication.getAuthenticationURL('reset', $NULL)\">$services.localization.render('xe.admin.passwordReset.step2.backToStep1')</a>",
          "",
          "[Added Lines]",
          "162:                     <a href=\"$services.security.authentication.getAuthenticationURL('resetpassword', $NULL)\">$services.localization.render('xe.admin.passwordReset.step2.backToStep1')</a>",
          "",
          "---------------"
        ],
        "xwiki-platform-distribution/xwiki-platform-distribution-flavor/xwiki-platform-distribution-flavor-test/xwiki-platform-distribution-flavor-test-webstandards/src/test/it/org/xwiki/test/webstandards/framework/DefaultValidationTest.java||xwiki-platform-distribution/xwiki-platform-distribution-flavor/xwiki-platform-distribution-flavor-test/xwiki-platform-distribution-flavor-test-webstandards/src/test/it/org/xwiki/test/webstandards/framework/DefaultValidationTest.java": [
          "File: xwiki-platform-distribution/xwiki-platform-distribution-flavor/xwiki-platform-distribution-flavor-test/xwiki-platform-distribution-flavor-test-webstandards/src/test/it/org/xwiki/test/webstandards/framework/DefaultValidationTest.java -> xwiki-platform-distribution/xwiki-platform-distribution-flavor/xwiki-platform-distribution-flavor-test/xwiki-platform-distribution-flavor-test-webstandards/src/test/it/org/xwiki/test/webstandards/framework/DefaultValidationTest.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "106:             Locale.ROOT));",
          "107:         if (this.target.equals(resetPassword)) {",
          "108:             this.logCaptureConfiguration.registerExpected(\"[DEPRECATED] The page [XWiki.ResetPassword] \"",
          "110:         }",
          "112:         Target resetPasswordComplete = new DocumentReferenceTarget(",
          "113:             new DocumentReference(\"xwiki\", \"XWiki\", \"ResetPasswordComplete\", Locale.ROOT));",
          "114:         if (this.target.equals(resetPasswordComplete)) {",
          "115:             this.logCaptureConfiguration.registerExpected(\"[DEPRECATED] The page [XWiki.ResetPasswordComplete] \"",
          "117:         }",
          "119:         Target forgotUsername = new DocumentReferenceTarget(",
          "120:             new DocumentReference(\"xwiki\", \"XWiki\", \"ForgotUsername\", Locale.ROOT));",
          "121:         if (this.target.equals(forgotUsername)) {",
          "122:             this.logCaptureConfiguration.registerExpected(\"[DEPRECATED] The page [XWiki.ForgotUsername] \"",
          "124:         }",
          "125:     }",
          "",
          "[Removed Lines]",
          "109:                 + \"should not be used anymore in favor of the new 'authenticate/reset' URL.\");",
          "116:                 + \"should not be used anymore in favor of the new 'authenticate/reset' URL.\");",
          "123:                 + \"should not be used anymore in favor of the new 'authenticate/forgot' URL.\");",
          "",
          "[Added Lines]",
          "109:                 + \"should not be used anymore in favor of the new 'authenticate/resetpassword' URL.\");",
          "116:                 + \"should not be used anymore in favor of the new 'authenticate/resetpassword' URL.\");",
          "123:                 + \"should not be used anymore in favor of the new 'authenticate/retrieveusername' URL.\");",
          "",
          "---------------"
        ]
      }
    }
  ]
}