{
  "cve_id": "CVE-2021-27906",
  "cve_desc": "A carefully crafted PDF file can trigger an OutOfMemory-Exception while loading the file. This issue affects Apache PDFBox version 2.0.22 and prior 2.0.x versions.",
  "repo": "apache/pdfbox",
  "patch_hash": "8c47be1011c11dc47300faecffd8ab32fba3646f",
  "patch_info": {
    "commit_hash": "8c47be1011c11dc47300faecffd8ab32fba3646f",
    "repo": "apache/pdfbox",
    "commit_url": "https://github.com/apache/pdfbox/commit/8c47be1011c11dc47300faecffd8ab32fba3646f",
    "files": [
      "pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java"
    ],
    "message": "PDFBOX-5112: SonarCube fix, throw NoSuchElementException if no more elements are available\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1887295 13f79535-47bb-0310-9956-ffa450edef68",
    "before_after_code_files": [
      "pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java||pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java"
    ]
  },
  "patch_diff": {
    "pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java||pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java": [
      "File: pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java -> pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java",
      "--- Hunk 1 ---",
      "[Context before]",
      "19: import java.io.IOException;",
      "20: import java.util.Arrays;",
      "21: import java.util.Iterator;",
      "23: import org.apache.pdfbox.cos.COSArray;",
      "24: import org.apache.pdfbox.cos.COSBase;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "22: import java.util.NoSuchElementException;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "212:         @Override",
      "213:         public Long next()",
      "214:         {",
      "215:             if (currentNumber < currentEnd)",
      "216:             {",
      "217:                 return currentNumber++;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "216:             if (currentNumber >= maxValue)",
      "217:             {",
      "218:                 throw new NoSuchElementException();",
      "219:             }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "117e970010832ad8232155303c3b1adc58ef9bf6",
      "candidate_info": {
        "commit_hash": "117e970010832ad8232155303c3b1adc58ef9bf6",
        "repo": "apache/pdfbox",
        "commit_url": "https://github.com/apache/pdfbox/commit/117e970010832ad8232155303c3b1adc58ef9bf6",
        "files": [
          "fontbox/src/test/java/org/apache/fontbox/cmap/TestCMapParser.java"
        ],
        "message": "PDFBOX-5090: add more tests\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1886071 13f79535-47bb-0310-9956-ffa450edef68",
        "before_after_code_files": [
          "fontbox/src/test/java/org/apache/fontbox/cmap/TestCMapParser.java||fontbox/src/test/java/org/apache/fontbox/cmap/TestCMapParser.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/pdfbox/pull/104"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "fontbox/src/test/java/org/apache/fontbox/cmap/TestCMapParser.java||fontbox/src/test/java/org/apache/fontbox/cmap/TestCMapParser.java": [
          "File: fontbox/src/test/java/org/apache/fontbox/cmap/TestCMapParser.java -> fontbox/src/test/java/org/apache/fontbox/cmap/TestCMapParser.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "162:         assertNull(cMap.toUnicode(0x2F1));",
          "163:     }",
          "165: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "165:     public void testPredefinedMap() throws IOException",
          "166:     {",
          "167:         CMap cMap = new CMapParser().parsePredefined(\"Adobe-Korea1-UCS2\");",
          "168:         assertNotNull(\"Failed to parse predefined CMap Adobe-Korea1-UCS2\", cMap);",
          "170:         assertEquals(\"wrong CMap name\", \"Adobe-Korea1-UCS2\", cMap.getName());",
          "171:         assertEquals(\"wrong WMode\", 0, cMap.getWMode());",
          "172:         assertFalse(cMap.hasCIDMappings());",
          "173:         assertTrue(cMap.hasUnicodeMappings());",
          "175:         cMap = new CMapParser().parsePredefined(\"Identity-V\");",
          "176:         assertNotNull(\"Failed to parse predefined CMap Identity-V\", cMap);",
          "177:     }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "498cdc12298731100fb27c1e30bbd3edf3211308",
      "candidate_info": {
        "commit_hash": "498cdc12298731100fb27c1e30bbd3edf3211308",
        "repo": "apache/pdfbox",
        "commit_url": "https://github.com/apache/pdfbox/commit/498cdc12298731100fb27c1e30bbd3edf3211308",
        "files": [
          "pdfbox/src/main/java/org/apache/pdfbox/cos/COSName.java"
        ],
        "message": "PDFBOX-5198: add Part constant\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1890252 13f79535-47bb-0310-9956-ffa450edef68",
        "before_after_code_files": [
          "pdfbox/src/main/java/org/apache/pdfbox/cos/COSName.java||pdfbox/src/main/java/org/apache/pdfbox/cos/COSName.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/pdfbox/pull/104"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "pdfbox/src/main/java/org/apache/pdfbox/cos/COSName.java||pdfbox/src/main/java/org/apache/pdfbox/cos/COSName.java": [
          "File: pdfbox/src/main/java/org/apache/pdfbox/cos/COSName.java -> pdfbox/src/main/java/org/apache/pdfbox/cos/COSName.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "443:     public static final COSName PARENT = new COSName(\"Parent\");",
          "444:     public static final COSName PARENT_TREE = new COSName(\"ParentTree\");",
          "445:     public static final COSName PARENT_TREE_NEXT_KEY = new COSName(\"ParentTreeNextKey\");",
          "446:     public static final COSName PATH = new COSName(\"Path\");",
          "447:     public static final COSName PATTERN = new COSName(\"Pattern\");",
          "448:     public static final COSName PATTERN_TYPE = new COSName(\"PatternType\");",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "446:     public static final COSName PART = new COSName(\"Part\");",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "d8b5f2fe75526b3ff8c531be655c71ab5d204a68",
      "candidate_info": {
        "commit_hash": "d8b5f2fe75526b3ff8c531be655c71ab5d204a68",
        "repo": "apache/pdfbox",
        "commit_url": "https://github.com/apache/pdfbox/commit/d8b5f2fe75526b3ff8c531be655c71ab5d204a68",
        "files": [
          "examples/src/main/java/org/apache/pdfbox/examples/signature/validation/AddValidationInformation.java"
        ],
        "message": "PDFBOX-3017: use _LTV instead of _ocsp\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1883017 13f79535-47bb-0310-9956-ffa450edef68",
        "before_after_code_files": [
          "examples/src/main/java/org/apache/pdfbox/examples/signature/validation/AddValidationInformation.java||examples/src/main/java/org/apache/pdfbox/examples/signature/validation/AddValidationInformation.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/pdfbox/pull/104"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "examples/src/main/java/org/apache/pdfbox/examples/signature/validation/AddValidationInformation.java||examples/src/main/java/org/apache/pdfbox/examples/signature/validation/AddValidationInformation.java": [
          "File: examples/src/main/java/org/apache/pdfbox/examples/signature/validation/AddValidationInformation.java -> examples/src/main/java/org/apache/pdfbox/examples/signature/validation/AddValidationInformation.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "652:         String name = inFile.getName();",
          "653:         String substring = name.substring(0, name.lastIndexOf('.'));",
          "656:         addOcspInformation.validateSignature(inFile, outFile);",
          "657:     }",
          "",
          "[Removed Lines]",
          "655:         File outFile = new File(inFile.getParent(), substring + \"_ocsp.pdf\");",
          "",
          "[Added Lines]",
          "655:         File outFile = new File(inFile.getParent(), substring + \"_LTV.pdf\");",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "1bf5e6a0b19beb493b5c7b5d9c451e3d3a4ea1b2",
      "candidate_info": {
        "commit_hash": "1bf5e6a0b19beb493b5c7b5d9c451e3d3a4ea1b2",
        "repo": "apache/pdfbox",
        "commit_url": "https://github.com/apache/pdfbox/commit/1bf5e6a0b19beb493b5c7b5d9c451e3d3a4ea1b2",
        "files": [
          "fontbox/src/main/java/org/apache/fontbox/type1/Type1Font.java"
        ],
        "message": "PDFBOX-4892: sonar fix\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1888392 13f79535-47bb-0310-9956-ffa450edef68",
        "before_after_code_files": [
          "fontbox/src/main/java/org/apache/fontbox/type1/Type1Font.java||fontbox/src/main/java/org/apache/fontbox/type1/Type1Font.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/pdfbox/pull/104"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "fontbox/src/main/java/org/apache/fontbox/type1/Type1Font.java||fontbox/src/main/java/org/apache/fontbox/type1/Type1Font.java": [
          "File: fontbox/src/main/java/org/apache/fontbox/type1/Type1Font.java -> fontbox/src/main/java/org/apache/fontbox/type1/Type1Font.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "113:     List<Number> familyBlues = new ArrayList<Number>();",
          "114:     List<Number> familyOtherBlues = new ArrayList<Number>();",
          "115:     float blueScale;",
          "117:     List<Number> stdHW = new ArrayList<Number>();",
          "118:     List<Number> stdVW = new ArrayList<Number>();",
          "119:     List<Number> stemSnapH = new ArrayList<Number>();",
          "",
          "[Removed Lines]",
          "116:     int blueShift, blueFuzz;",
          "",
          "[Added Lines]",
          "116:     int blueShift;",
          "117:     int blueFuzz;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "130:             new ConcurrentHashMap<String, Type1CharString>();",
          "",
          "[Removed Lines]",
          "133:     private final byte[] segment1, segment2;",
          "",
          "[Added Lines]",
          "134:     private final byte[] segment1;",
          "135:     private final byte[] segment2;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "538981987bae2b280729e0317cbcc919750436b6",
      "candidate_info": {
        "commit_hash": "538981987bae2b280729e0317cbcc919750436b6",
        "repo": "apache/pdfbox",
        "commit_url": "https://github.com/apache/pdfbox/commit/538981987bae2b280729e0317cbcc919750436b6",
        "files": [
          "fontbox/src/main/java/org/apache/fontbox/cff/CFFType1Font.java"
        ],
        "message": "PDFBOX-4892: remove unneeded code, as suggested by valerybokov\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1887872 13f79535-47bb-0310-9956-ffa450edef68",
        "before_after_code_files": [
          "fontbox/src/main/java/org/apache/fontbox/cff/CFFType1Font.java||fontbox/src/main/java/org/apache/fontbox/cff/CFFType1Font.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/pdfbox/pull/104"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "fontbox/src/main/java/org/apache/fontbox/cff/CFFType1Font.java||fontbox/src/main/java/org/apache/fontbox/cff/CFFType1Font.java": [
          "File: fontbox/src/main/java/org/apache/fontbox/cff/CFFType1Font.java -> fontbox/src/main/java/org/apache/fontbox/cff/CFFType1Font.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "205:         {",
          "206:             return topDictValue;",
          "207:         }",
          "214:     }",
          "216:     private int getDefaultWidthX()",
          "",
          "[Removed Lines]",
          "208:         Object privateDictValue = privateDict.get(name);",
          "209:         if (privateDictValue != null)",
          "210:         {",
          "211:             return privateDictValue;",
          "212:         }",
          "213:         return null;",
          "",
          "[Added Lines]",
          "208:         return privateDict.get(name);",
          "",
          "---------------"
        ]
      }
    }
  ]
}