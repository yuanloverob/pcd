{
  "cve_id": "CVE-2021-27906",
  "cve_desc": "A carefully crafted PDF file can trigger an OutOfMemory-Exception while loading the file. This issue affects Apache PDFBox version 2.0.22 and prior 2.0.x versions.",
  "repo": "apache/pdfbox",
  "patch_hash": "8c47be1011c11dc47300faecffd8ab32fba3646f",
  "patch_info": {
    "commit_hash": "8c47be1011c11dc47300faecffd8ab32fba3646f",
    "repo": "apache/pdfbox",
    "commit_url": "https://github.com/apache/pdfbox/commit/8c47be1011c11dc47300faecffd8ab32fba3646f",
    "files": [
      "pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java"
    ],
    "message": "PDFBOX-5112: SonarCube fix, throw NoSuchElementException if no more elements are available\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1887295 13f79535-47bb-0310-9956-ffa450edef68",
    "before_after_code_files": [
      "pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java||pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java"
    ]
  },
  "patch_diff": {
    "pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java||pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java": [
      "File: pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java -> pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java",
      "--- Hunk 1 ---",
      "[Context before]",
      "19: import java.io.IOException;",
      "20: import java.util.Arrays;",
      "21: import java.util.Iterator;",
      "23: import org.apache.pdfbox.cos.COSArray;",
      "24: import org.apache.pdfbox.cos.COSBase;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "22: import java.util.NoSuchElementException;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "212:         @Override",
      "213:         public Long next()",
      "214:         {",
      "215:             if (currentNumber < currentEnd)",
      "216:             {",
      "217:                 return currentNumber++;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "216:             if (currentNumber >= maxValue)",
      "217:             {",
      "218:                 throw new NoSuchElementException();",
      "219:             }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "4de37a9599636bac22bd5feb15cf4c98442f29fa",
      "candidate_info": {
        "commit_hash": "4de37a9599636bac22bd5feb15cf4c98442f29fa",
        "repo": "apache/pdfbox",
        "commit_url": "https://github.com/apache/pdfbox/commit/4de37a9599636bac22bd5feb15cf4c98442f29fa",
        "files": [
          "examples/src/main/java/org/apache/pdfbox/examples/signature/SigUtils.java"
        ],
        "message": "PDFBOX-3017: /Type is optional in signature dictionary\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1882699 13f79535-47bb-0310-9956-ffa450edef68",
        "before_after_code_files": [
          "examples/src/main/java/org/apache/pdfbox/examples/signature/SigUtils.java||examples/src/main/java/org/apache/pdfbox/examples/signature/SigUtils.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/pdfbox/pull/104"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "examples/src/main/java/org/apache/pdfbox/examples/signature/SigUtils.java||examples/src/main/java/org/apache/pdfbox/examples/signature/SigUtils.java": [
          "File: examples/src/main/java/org/apache/pdfbox/examples/signature/SigUtils.java -> examples/src/main/java/org/apache/pdfbox/examples/signature/SigUtils.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "270:         {",
          "271:             PDSignature lastSignature = sortedMap.get(sortedMap.lastKey());",
          "272:             COSBase type = lastSignature.getCOSObject().getItem(COSName.TYPE);",
          "274:             {",
          "275:                 return lastSignature;",
          "276:             }",
          "",
          "[Removed Lines]",
          "273:             if (type.equals(COSName.SIG) || type.equals(COSName.DOC_TIME_STAMP))",
          "",
          "[Added Lines]",
          "273:             if (type == null || COSName.SIG.equals(type) || COSName.DOC_TIME_STAMP.equals(type))",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "2fb9f344940ddf3377ac6518166aa4f0aaee51e1",
      "candidate_info": {
        "commit_hash": "2fb9f344940ddf3377ac6518166aa4f0aaee51e1",
        "repo": "apache/pdfbox",
        "commit_url": "https://github.com/apache/pdfbox/commit/2fb9f344940ddf3377ac6518166aa4f0aaee51e1",
        "files": [
          "preflight/src/main/java/org/apache/pdfbox/preflight/graphic/StandardColorSpaceHelper.java"
        ],
        "message": "PDFBOX-4892: remove unneeded throws\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1891451 13f79535-47bb-0310-9956-ffa450edef68",
        "before_after_code_files": [
          "preflight/src/main/java/org/apache/pdfbox/preflight/graphic/StandardColorSpaceHelper.java||preflight/src/main/java/org/apache/pdfbox/preflight/graphic/StandardColorSpaceHelper.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/pdfbox/pull/104"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "preflight/src/main/java/org/apache/pdfbox/preflight/graphic/StandardColorSpaceHelper.java||preflight/src/main/java/org/apache/pdfbox/preflight/graphic/StandardColorSpaceHelper.java": [
          "File: preflight/src/main/java/org/apache/pdfbox/preflight/graphic/StandardColorSpaceHelper.java -> preflight/src/main/java/org/apache/pdfbox/preflight/graphic/StandardColorSpaceHelper.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "550:         return true;",
          "551:     }",
          "555:     {",
          "556:         if (alternateColorSpace.getNumberOfComponents() != iccBased.getNumberOfComponents())",
          "557:         {",
          "",
          "[Removed Lines]",
          "553:     private void validateICCProfileAlternateEntry(",
          "554:             PDICCBased iccBased, PDColorSpace alternateColorSpace) throws IOException",
          "",
          "[Added Lines]",
          "553:     private void validateICCProfileAlternateEntry(PDICCBased iccBased, PDColorSpace alternateColorSpace)",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "ee3ec5a9300c09116cb192124b9af38a532145ce",
      "candidate_info": {
        "commit_hash": "ee3ec5a9300c09116cb192124b9af38a532145ce",
        "repo": "apache/pdfbox",
        "commit_url": "https://github.com/apache/pdfbox/commit/ee3ec5a9300c09116cb192124b9af38a532145ce",
        "files": [
          "examples/src/main/java/org/apache/pdfbox/examples/signature/TSAClient.java"
        ],
        "message": "PDFBOX-5081: refactor to improve nonce uniqueness\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1885729 13f79535-47bb-0310-9956-ffa450edef68",
        "before_after_code_files": [
          "examples/src/main/java/org/apache/pdfbox/examples/signature/TSAClient.java||examples/src/main/java/org/apache/pdfbox/examples/signature/TSAClient.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/pdfbox/pull/104"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "examples/src/main/java/org/apache/pdfbox/examples/signature/TSAClient.java||examples/src/main/java/org/apache/pdfbox/examples/signature/TSAClient.java": [
          "File: examples/src/main/java/org/apache/pdfbox/examples/signature/TSAClient.java -> examples/src/main/java/org/apache/pdfbox/examples/signature/TSAClient.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "24: import java.net.URLConnection;",
          "25: import java.security.MessageDigest;",
          "26: import java.security.SecureRandom;",
          "28: import org.apache.commons.logging.Log;",
          "29: import org.apache.commons.logging.LogFactory;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "27: import java.util.Random;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "52:     private final String password;",
          "53:     private final MessageDigest digest;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "57:     private static final Random RANDOM = new SecureRandom();",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "80:         byte[] hash = digest.digest(content);",
          "87:         TimeStampRequestGenerator tsaGenerator = new TimeStampRequestGenerator();",
          "",
          "[Removed Lines]",
          "83:         SecureRandom random = new SecureRandom();",
          "84:         int nonce = random.nextInt();",
          "",
          "[Added Lines]",
          "87:         int nonce = RANDOM.nextInt();",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "183b96ac55823269eeb4a6f84132d76c4513168d",
      "candidate_info": {
        "commit_hash": "183b96ac55823269eeb4a6f84132d76c4513168d",
        "repo": "apache/pdfbox",
        "commit_url": "https://github.com/apache/pdfbox/commit/183b96ac55823269eeb4a6f84132d76c4513168d",
        "files": [
          "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/FontMapperImpl.java"
        ],
        "message": "PDFBOX-4990: tell what resource is missing, as suggested by Ralf Hauser\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1882642 13f79535-47bb-0310-9956-ffa450edef68",
        "before_after_code_files": [
          "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/FontMapperImpl.java||pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/FontMapperImpl.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/pdfbox/pull/104"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/FontMapperImpl.java||pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/FontMapperImpl.java": [
          "File: pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/FontMapperImpl.java -> pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/FontMapperImpl.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "119:         try",
          "120:         {",
          "121:             String ttfName = \"/org/apache/pdfbox/resources/ttf/LiberationSans-Regular.ttf\";",
          "124:             TTFParser ttfParser = new TTFParser();",
          "125:             lastResortFont = ttfParser.parse(ttfStream);",
          "126:         }",
          "",
          "[Removed Lines]",
          "122:             InputStream ttfStream =",
          "123:                     new BufferedInputStream(FontMapper.class.getResourceAsStream(ttfName));",
          "",
          "[Added Lines]",
          "122:             InputStream resourceAsStream = FontMapper.class.getResourceAsStream(ttfName);",
          "123:             if (resourceAsStream == null)",
          "124:             {",
          "125:                 throw new IOException(\"resource '\" + ttfName + \"' not found\");",
          "126:             }",
          "127:             InputStream ttfStream = new BufferedInputStream(resourceAsStream);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "01c0b35a263bd80e361bb570ff5f0953ec26d0d2",
      "candidate_info": {
        "commit_hash": "01c0b35a263bd80e361bb570ff5f0953ec26d0d2",
        "repo": "apache/pdfbox",
        "commit_url": "https://github.com/apache/pdfbox/commit/01c0b35a263bd80e361bb570ff5f0953ec26d0d2",
        "files": [
          "debugger/src/main/java/org/apache/pdfbox/debugger/fontencodingpane/Type3Font.java"
        ],
        "message": "PDFBOX-4892: remove unused import\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1890718 13f79535-47bb-0310-9956-ffa450edef68",
        "before_after_code_files": [
          "debugger/src/main/java/org/apache/pdfbox/debugger/fontencodingpane/Type3Font.java||debugger/src/main/java/org/apache/pdfbox/debugger/fontencodingpane/Type3Font.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/pdfbox/pull/104"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "debugger/src/main/java/org/apache/pdfbox/debugger/fontencodingpane/Type3Font.java||debugger/src/main/java/org/apache/pdfbox/debugger/fontencodingpane/Type3Font.java": [
          "File: debugger/src/main/java/org/apache/pdfbox/debugger/fontencodingpane/Type3Font.java -> debugger/src/main/java/org/apache/pdfbox/debugger/fontencodingpane/Type3Font.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "29: import org.apache.pdfbox.pdmodel.PDPageContentStream;",
          "30: import org.apache.pdfbox.pdmodel.PDResources;",
          "31: import org.apache.pdfbox.pdmodel.common.PDRectangle;",
          "33: import org.apache.pdfbox.pdmodel.font.PDType3CharProc;",
          "34: import org.apache.pdfbox.pdmodel.font.PDType3Font;",
          "35: import org.apache.pdfbox.rendering.PDFRenderer;",
          "",
          "[Removed Lines]",
          "32: import org.apache.pdfbox.pdmodel.font.PDSimpleFont;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    }
  ]
}