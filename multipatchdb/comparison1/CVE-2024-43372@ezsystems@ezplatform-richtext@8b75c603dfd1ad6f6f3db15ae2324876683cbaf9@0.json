{
  "cve_id": "CVE-2024-43372",
  "cve_desc": "",
  "repo": "ezsystems/ezplatform-richtext",
  "patch_hash": "8b75c603dfd1ad6f6f3db15ae2324876683cbaf9",
  "patch_info": {
    "commit_hash": "8b75c603dfd1ad6f6f3db15ae2324876683cbaf9",
    "repo": "ezsystems/ezplatform-richtext",
    "commit_url": "https://github.com/ezsystems/ezplatform-richtext/commit/8b75c603dfd1ad6f6f3db15ae2324876683cbaf9",
    "files": [
      "src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch",
      "src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl",
      "tests/lib/eZ/FieldType/RichTextTest.php"
    ],
    "message": "Fixed failing test for ezurl protocol",
    "before_after_code_files": [
      "src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch||src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch",
      "src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl||src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl",
      "tests/lib/eZ/FieldType/RichTextTest.php||tests/lib/eZ/FieldType/RichTextTest.php"
    ]
  },
  "patch_diff": {
    "src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch||src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch": [
      "File: src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch -> src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch",
      "--- Hunk 1 ---",
      "[Context before]",
      "258:                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'mailto:') or",
      "259:                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezcontent://') or",
      "260:                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezlocation://') or",
      "261:                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), '#')\"",
      "263:       <s:assert test=\"not(contains(@*[name()='xlink:href'], '&lt;') or",
      "264:                           contains(@*[name()='xlink:href'], '&gt;') or",
      "265:                           contains(@*[name()='xlink:href'], '&quot;'))\"",
      "",
      "[Removed Lines]",
      "262:                 mode=\"schematron-get-full-path-2\">links must start with one of: http://, https://, mailto:, ezcontent://, ezlocation://, #</s:assert>",
      "",
      "[Added Lines]",
      "261:                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezurl://') or",
      "263:                 mode=\"schematron-get-full-path-2\">links must start with one of: http://, https://, mailto:, ezcontent://, ezlocation://, ezurl://, #</s:assert>",
      "",
      "---------------"
    ],
    "src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl||src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl": [
      "File: src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl -> src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl",
      "--- Hunk 1 ---",
      "[Context before]",
      "79: <axsl:template match=\"db:link\" priority=\"1000\" mode=\"M3\"><svrl:fired-rule xmlns:svrl=\"http://purl.oclc.org/dsdl/svrl\" context=\"db:link\"/>",
      "81:   <!--ASSERT -->",
      "84:   <!--ASSERT -->",
      "85: <axsl:choose><axsl:when test=\"not(contains(@*[name()='xlink:href'], '&lt;') or                           contains(@*[name()='xlink:href'], '&gt;') or                           contains(@*[name()='xlink:href'], '&quot;'))\"/><axsl:otherwise><svrl:failed-assert xmlns:svrl=\"http://purl.oclc.org/dsdl/svrl\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:schold=\"http://www.ascc.net/xml/schematron\" test=\"not(contains(@*[name()='xlink:href'], '&lt;') or contains(@*[name()='xlink:href'], '&gt;') or contains(@*[name()='xlink:href'], '&quot;'))\"><axsl:attribute name=\"location\"><axsl:apply-templates select=\".\" mode=\"schematron-get-full-path-2\"/></axsl:attribute><svrl:text>using characters [&lt; &gt; \"] in links is not allowed</svrl:text></svrl:failed-assert></axsl:otherwise></axsl:choose><axsl:apply-templates select=\"*|comment()|processing-instruction()\" mode=\"M3\"/></axsl:template><axsl:template match=\"text()\" priority=\"-1\" mode=\"M3\"/><axsl:template match=\"@*|node()\" priority=\"-2\" mode=\"M3\"><axsl:apply-templates select=\"*|comment()|processing-instruction()\" mode=\"M3\"/></axsl:template></axsl:stylesheet>",
      "",
      "[Removed Lines]",
      "82: <axsl:choose><axsl:when test=\"starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'http://') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'https://') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'mailto:') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezcontent://') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezlocation://') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), '#')\"/><axsl:otherwise><svrl:failed-assert xmlns:svrl=\"http://purl.oclc.org/dsdl/svrl\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:schold=\"http://www.ascc.net/xml/schematron\" test=\"starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'http://') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'https://') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'mailto:') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezcontent://') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezlocation://') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), '#')\"><axsl:attribute name=\"location\"><axsl:apply-templates select=\".\" mode=\"schematron-get-full-path-2\"/></axsl:attribute><svrl:text>links must start with one of: http://, https://, mailto:, ezcontent://, ezlocation://, #</svrl:text></svrl:failed-assert></axsl:otherwise></axsl:choose>",
      "",
      "[Added Lines]",
      "82: <axsl:choose><axsl:when test=\"starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'http://') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'https://') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'mailto:') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezcontent://') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezlocation://') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezurl://') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), '#')\"/><axsl:otherwise><svrl:failed-assert xmlns:svrl=\"http://purl.oclc.org/dsdl/svrl\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:schold=\"http://www.ascc.net/xml/schematron\" test=\"starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'http://') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'https://') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'mailto:') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezcontent://') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezlocation://') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezurl://') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), '#')\"><axsl:attribute name=\"location\"><axsl:apply-templates select=\".\" mode=\"schematron-get-full-path-2\"/></axsl:attribute><svrl:text>links must start with one of: http://, https://, mailto:, ezcontent://, ezlocation://, ezurl://, #</svrl:text></svrl:failed-assert></axsl:otherwise></axsl:choose>",
      "",
      "---------------"
    ],
    "tests/lib/eZ/FieldType/RichTextTest.php||tests/lib/eZ/FieldType/RichTextTest.php": [
      "File: tests/lib/eZ/FieldType/RichTextTest.php -> tests/lib/eZ/FieldType/RichTextTest.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "224:                 [",
      "225:                     new ValidationError(",
      "226:                         \"Validation of XML content failed:\\n\" .",
      "228:                         null,",
      "229:                         [],",
      "230:                         'xml'",
      "",
      "[Removed Lines]",
      "227:                         '/section/para/link: links must start with one of: http://, https://, mailto:, ezcontent://, ezlocation://, #',",
      "",
      "[Added Lines]",
      "227:                         '/section/para/link: links must start with one of: http://, https://, mailto:, ezcontent://, ezlocation://, ezurl://,#',",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "239:                 [",
      "240:                     new ValidationError(",
      "241:                         \"Validation of XML content failed:\\n\" .",
      "243:                         null,",
      "244:                         [],",
      "245:                         'xml'",
      "",
      "[Removed Lines]",
      "242:                         '/section/para/link: links must start with one of: http://, https://, mailto:, ezcontent://, ezlocation://, #',",
      "",
      "[Added Lines]",
      "242:                         '/section/para/link: links must start with one of: http://, https://, mailto:, ezcontent://, ezlocation://, ezurl://,#',",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "269:                 [",
      "270:                     new ValidationError(",
      "271:                         \"Validation of XML content failed:\\n\" .",
      "273:                         null,",
      "274:                         [],",
      "275:                         'xml'",
      "",
      "[Removed Lines]",
      "272:                         '/section/para/link: links must start with one of: http://, https://, mailto:, ezcontent://, ezlocation://, #',",
      "",
      "[Added Lines]",
      "272:                         '/section/para/link: links must start with one of: http://, https://, mailto:, ezcontent://, ezlocation://, ezurl://,#',",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "6131975108fa9756e17043e7a06a4e72f786f842",
      "candidate_info": {
        "commit_hash": "6131975108fa9756e17043e7a06a4e72f786f842",
        "repo": "ezsystems/ezplatform-richtext",
        "commit_url": "https://github.com/ezsystems/ezplatform-richtext/commit/6131975108fa9756e17043e7a06a4e72f786f842",
        "files": [
          "src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch",
          "src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl",
          "tests/lib/eZ/FieldType/RichTextTest.php"
        ],
        "message": "Merge commit from fork",
        "before_after_code_files": [
          "src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch||src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch",
          "src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl||src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl",
          "tests/lib/eZ/FieldType/RichTextTest.php||tests/lib/eZ/FieldType/RichTextTest.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch||src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch",
            "src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl||src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl",
            "tests/lib/eZ/FieldType/RichTextTest.php||tests/lib/eZ/FieldType/RichTextTest.php"
          ],
          "candidate": [
            "src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch||src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch",
            "src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl||src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl",
            "tests/lib/eZ/FieldType/RichTextTest.php||tests/lib/eZ/FieldType/RichTextTest.php"
          ]
        }
      },
      "candidate_diff": {
        "src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch||src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch": [
          "File: src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch -> src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch",
          "--- Hunk 1 ---",
          "[Context before]",
          "249:     </s:rule>",
          "250:   </s:pattern>",
          "251:   <s:pattern name=\"Element contents validation\">",
          "252:     <s:rule context=\"db:link\">",
          "254:     </s:rule>",
          "255:   </s:pattern>",
          "256: </s:schema>",
          "",
          "[Removed Lines]",
          "253:       <s:assert test=\"not(contains(@*[name()='xlink:href'], 'javascript:') or contains(@*[name()='xlink:href'], 'vbscript:'))\" mode=\"schematron-get-full-path-2\">using scripts in links is not allowed</s:assert>",
          "",
          "[Added Lines]",
          "252:     <s:let name=\"upperCase\" value=\"'ABCDEFGHIJKLMNOPQRSTUVWXYZ'\"/>",
          "253:     <s:let name=\"lowerCase\" value=\"'abcdefghijklmnopqrstuvwxyz'\"/>",
          "255:       <!-- Using translate() because we don't have XPath 2, so we can't use lower-case(). -->",
          "256:       <s:assert test=\"starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'http://') or",
          "257:                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'https://') or",
          "258:                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'mailto:') or",
          "259:                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezcontent://') or",
          "260:                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezlocation://') or",
          "261:                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), '#')\"",
          "262:                 mode=\"schematron-get-full-path-2\">links must start with one of: http://, https://, mailto:, ezcontent://, ezlocation://, #</s:assert>",
          "263:       <s:assert test=\"not(contains(@*[name()='xlink:href'], '&lt;') or",
          "264:                           contains(@*[name()='xlink:href'], '&gt;') or",
          "265:                           contains(@*[name()='xlink:href'], '&quot;'))\"",
          "266:                 mode=\"schematron-get-full-path-2\">using characters [&lt; &gt; &quot;] in links is not allowed</s:assert>",
          "",
          "---------------"
        ],
        "src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl||src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl": [
          "File: src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl -> src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl",
          "--- Hunk 1 ---",
          "[Context before]",
          "73: <axsl:choose><axsl:when test=\"not(.//db:ezlink)\"/><axsl:otherwise><svrl:failed-assert xmlns:svrl=\"http://purl.oclc.org/dsdl/svrl\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:schold=\"http://www.ascc.net/xml/schematron\" test=\"not(.//db:ezlink)\"><axsl:attribute name=\"location\"><axsl:apply-templates select=\".\" mode=\"schematron-get-full-path\"/></axsl:attribute><svrl:text>ezlink must not occur in the descendants of link</svrl:text></svrl:failed-assert></axsl:otherwise></axsl:choose><axsl:apply-templates select=\"*|comment()|processing-instruction()\" mode=\"M2\"/></axsl:template><axsl:template match=\"text()\" priority=\"-1\" mode=\"M2\"/><axsl:template match=\"@*|node()\" priority=\"-2\" mode=\"M2\"><axsl:apply-templates select=\"*|comment()|processing-instruction()\" mode=\"M2\"/></axsl:template>",
          "75: <!--PATTERN -->",
          "78:  <!--RULE -->",
          "79: <axsl:template match=\"db:link\" priority=\"1000\" mode=\"M3\"><svrl:fired-rule xmlns:svrl=\"http://purl.oclc.org/dsdl/svrl\" context=\"db:link\"/>",
          "81:   <!--ASSERT -->",
          "",
          "[Removed Lines]",
          "82: <axsl:choose><axsl:when test=\"not(contains(@*[name()='xlink:href'], 'javascript:') or contains(@*[name()='xlink:href'], 'vbscript:'))\"/><axsl:otherwise><svrl:failed-assert xmlns:svrl=\"http://purl.oclc.org/dsdl/svrl\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:schold=\"http://www.ascc.net/xml/schematron\" test=\"not(contains(@*[name()='xlink:href'], 'javascript:') or contains(@*[name()='xlink:href'], 'vbscript:'))\"><axsl:attribute name=\"location\"><axsl:apply-templates select=\".\" mode=\"schematron-get-full-path-2\"/></axsl:attribute><svrl:text>using scripts in links is not allowed</svrl:text></svrl:failed-assert></axsl:otherwise></axsl:choose><axsl:apply-templates select=\"*|comment()|processing-instruction()\" mode=\"M3\"/></axsl:template><axsl:template match=\"text()\" priority=\"-1\" mode=\"M3\"/><axsl:template match=\"@*|node()\" priority=\"-2\" mode=\"M3\"><axsl:apply-templates select=\"*|comment()|processing-instruction()\" mode=\"M3\"/></axsl:template></axsl:stylesheet>",
          "",
          "[Added Lines]",
          "76: <axsl:variable name=\"upperCase\" select=\"'ABCDEFGHIJKLMNOPQRSTUVWXYZ'\"/><axsl:variable name=\"lowerCase\" select=\"'abcdefghijklmnopqrstuvwxyz'\"/>",
          "82: <axsl:choose><axsl:when test=\"starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'http://') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'https://') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'mailto:') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezcontent://') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezlocation://') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), '#')\"/><axsl:otherwise><svrl:failed-assert xmlns:svrl=\"http://purl.oclc.org/dsdl/svrl\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:schold=\"http://www.ascc.net/xml/schematron\" test=\"starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'http://') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'https://') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'mailto:') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezcontent://') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezlocation://') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), '#')\"><axsl:attribute name=\"location\"><axsl:apply-templates select=\".\" mode=\"schematron-get-full-path-2\"/></axsl:attribute><svrl:text>links must start with one of: http://, https://, mailto:, ezcontent://, ezlocation://, #</svrl:text></svrl:failed-assert></axsl:otherwise></axsl:choose>",
          "84:   <!--ASSERT -->",
          "85: <axsl:choose><axsl:when test=\"not(contains(@*[name()='xlink:href'], '&lt;') or                           contains(@*[name()='xlink:href'], '&gt;') or                           contains(@*[name()='xlink:href'], '&quot;'))\"/><axsl:otherwise><svrl:failed-assert xmlns:svrl=\"http://purl.oclc.org/dsdl/svrl\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:schold=\"http://www.ascc.net/xml/schematron\" test=\"not(contains(@*[name()='xlink:href'], '&lt;') or contains(@*[name()='xlink:href'], '&gt;') or contains(@*[name()='xlink:href'], '&quot;'))\"><axsl:attribute name=\"location\"><axsl:apply-templates select=\".\" mode=\"schematron-get-full-path-2\"/></axsl:attribute><svrl:text>using characters [&lt; &gt; \"] in links is not allowed</svrl:text></svrl:failed-assert></axsl:otherwise></axsl:choose><axsl:apply-templates select=\"*|comment()|processing-instruction()\" mode=\"M3\"/></axsl:template><axsl:template match=\"text()\" priority=\"-1\" mode=\"M3\"/><axsl:template match=\"@*|node()\" priority=\"-2\" mode=\"M3\"><axsl:apply-templates select=\"*|comment()|processing-instruction()\" mode=\"M3\"/></axsl:template></axsl:stylesheet>",
          "",
          "---------------"
        ],
        "tests/lib/eZ/FieldType/RichTextTest.php||tests/lib/eZ/FieldType/RichTextTest.php": [
          "File: tests/lib/eZ/FieldType/RichTextTest.php -> tests/lib/eZ/FieldType/RichTextTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "224:                 [",
          "225:                     new ValidationError(",
          "226:                         \"Validation of XML content failed:\\n\" .",
          "228:                         null,",
          "229:                         [],",
          "230:                         'xml'",
          "",
          "[Removed Lines]",
          "227:                         '/section/para/link: using scripts in links is not allowed',",
          "",
          "[Added Lines]",
          "227:                         '/section/para/link: links must start with one of: http://, https://, mailto:, ezcontent://, ezlocation://, #',",
          "228:                         null,",
          "229:                         [],",
          "230:                         'xml'",
          "231:                     ),",
          "232:                 ],",
          "233:             ],",
          "234:             [",
          "235:                 '<?xml version=\"1.0\" encoding=\"UTF-8\"?>",
          "236: <section xmlns=\"http://docbook.org/ns/docbook\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" xmlns:ezxhtml=\"http://ez.no/xmlns/ezpublish/docbook/xhtml\" xmlns:ezcustom=\"http://ez.no/xmlns/ezpublish/docbook/custom\" version=\"5.0-variant ezpublish-1.0\">",
          "237:   <para><link xlink:href=\"jAvAsCriPt:alert(\\'XSS\\');\">link</link></para>",
          "238: </section>',",
          "239:                 [",
          "240:                     new ValidationError(",
          "241:                         \"Validation of XML content failed:\\n\" .",
          "242:                         '/section/para/link: links must start with one of: http://, https://, mailto:, ezcontent://, ezlocation://, #',",
          "243:                         null,",
          "244:                         [],",
          "245:                         'xml'",
          "246:                     ),",
          "247:                 ],",
          "248:             ],",
          "249:             [",
          "250:                 '<?xml version=\"1.0\" encoding=\"UTF-8\"?>",
          "251: <section xmlns=\"http://docbook.org/ns/docbook\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" xmlns:ezxhtml=\"http://ez.no/xmlns/ezpublish/docbook/xhtml\" xmlns:ezcustom=\"http://ez.no/xmlns/ezpublish/docbook/custom\" version=\"5.0-variant ezpublish-1.0\">",
          "252:   <para><link xlink:href=\"https://example.com/foo&lt;bar\">link</link></para>",
          "253: </section>',",
          "254:                 [",
          "255:                     new ValidationError(",
          "256:                         \"Validation of XML content failed:\\n\" .",
          "257:                         '/section/para/link: using characters [< > \"] in links is not allowed',",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "239:                 [",
          "240:                     new ValidationError(",
          "241:                         \"Validation of XML content failed:\\n\" .",
          "243:                         null,",
          "244:                         [],",
          "245:                         'xml'",
          "",
          "[Removed Lines]",
          "242:                         '/section/para/link: using scripts in links is not allowed',",
          "",
          "[Added Lines]",
          "272:                         '/section/para/link: links must start with one of: http://, https://, mailto:, ezcontent://, ezlocation://, #',",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "2c652915625c47b493a2be06924f4c87d1df7d8e",
      "candidate_info": {
        "commit_hash": "2c652915625c47b493a2be06924f4c87d1df7d8e",
        "repo": "ezsystems/ezplatform-richtext",
        "commit_url": "https://github.com/ezsystems/ezplatform-richtext/commit/2c652915625c47b493a2be06924f4c87d1df7d8e",
        "files": [
          "src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch",
          "src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl",
          "tests/lib/eZ/FieldType/RichTextTest.php"
        ],
        "message": "Fixed failing test for ezremote protocol",
        "before_after_code_files": [
          "src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch||src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch",
          "src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl||src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl",
          "tests/lib/eZ/FieldType/RichTextTest.php||tests/lib/eZ/FieldType/RichTextTest.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch||src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch",
            "src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl||src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl",
            "tests/lib/eZ/FieldType/RichTextTest.php||tests/lib/eZ/FieldType/RichTextTest.php"
          ],
          "candidate": [
            "src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch||src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch",
            "src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl||src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl",
            "tests/lib/eZ/FieldType/RichTextTest.php||tests/lib/eZ/FieldType/RichTextTest.php"
          ]
        }
      },
      "candidate_diff": {
        "src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch||src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch": [
          "File: src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch -> src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch",
          "--- Hunk 1 ---",
          "[Context before]",
          "258:                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'mailto:') or",
          "259:                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezcontent://') or",
          "260:                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezlocation://') or",
          "261:                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezurl://') or",
          "262:                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), '#')\"",
          "264:       <s:assert test=\"not(contains(@*[name()='xlink:href'], '&lt;') or",
          "265:                           contains(@*[name()='xlink:href'], '&gt;') or",
          "266:                           contains(@*[name()='xlink:href'], '&quot;'))\"",
          "",
          "[Removed Lines]",
          "263:                 mode=\"schematron-get-full-path-2\">links must start with one of: http://, https://, mailto:, ezcontent://, ezlocation://, ezurl://, #</s:assert>",
          "",
          "[Added Lines]",
          "261:                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezremote://') or",
          "264:                 mode=\"schematron-get-full-path-2\">links must start with one of: http://, https://, mailto:, ezcontent://, ezlocation://, ezremote://, ezurl://, #</s:assert>",
          "",
          "---------------"
        ],
        "src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl||src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl": [
          "File: src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl -> src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl",
          "--- Hunk 1 ---",
          "[Context before]",
          "79: <axsl:template match=\"db:link\" priority=\"1000\" mode=\"M3\"><svrl:fired-rule xmlns:svrl=\"http://purl.oclc.org/dsdl/svrl\" context=\"db:link\"/>",
          "81:   <!--ASSERT -->",
          "84:   <!--ASSERT -->",
          "85: <axsl:choose><axsl:when test=\"not(contains(@*[name()='xlink:href'], '&lt;') or                           contains(@*[name()='xlink:href'], '&gt;') or                           contains(@*[name()='xlink:href'], '&quot;'))\"/><axsl:otherwise><svrl:failed-assert xmlns:svrl=\"http://purl.oclc.org/dsdl/svrl\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:schold=\"http://www.ascc.net/xml/schematron\" test=\"not(contains(@*[name()='xlink:href'], '&lt;') or contains(@*[name()='xlink:href'], '&gt;') or contains(@*[name()='xlink:href'], '&quot;'))\"><axsl:attribute name=\"location\"><axsl:apply-templates select=\".\" mode=\"schematron-get-full-path-2\"/></axsl:attribute><svrl:text>using characters [&lt; &gt; \"] in links is not allowed</svrl:text></svrl:failed-assert></axsl:otherwise></axsl:choose><axsl:apply-templates select=\"*|comment()|processing-instruction()\" mode=\"M3\"/></axsl:template><axsl:template match=\"text()\" priority=\"-1\" mode=\"M3\"/><axsl:template match=\"@*|node()\" priority=\"-2\" mode=\"M3\"><axsl:apply-templates select=\"*|comment()|processing-instruction()\" mode=\"M3\"/></axsl:template></axsl:stylesheet>",
          "",
          "[Removed Lines]",
          "82: <axsl:choose><axsl:when test=\"starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'http://') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'https://') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'mailto:') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezcontent://') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezlocation://') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezurl://') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), '#')\"/><axsl:otherwise><svrl:failed-assert xmlns:svrl=\"http://purl.oclc.org/dsdl/svrl\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:schold=\"http://www.ascc.net/xml/schematron\" test=\"starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'http://') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'https://') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'mailto:') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezcontent://') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezlocation://') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezurl://') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), '#')\"><axsl:attribute name=\"location\"><axsl:apply-templates select=\".\" mode=\"schematron-get-full-path-2\"/></axsl:attribute><svrl:text>links must start with one of: http://, https://, mailto:, ezcontent://, ezlocation://, ezurl://, #</svrl:text></svrl:failed-assert></axsl:otherwise></axsl:choose>",
          "",
          "[Added Lines]",
          "82: <axsl:choose><axsl:when test=\"starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'http://') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'https://') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'mailto:') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezcontent://') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezlocation://') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezremote://') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezurl://') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), '#')\"/><axsl:otherwise><svrl:failed-assert xmlns:svrl=\"http://purl.oclc.org/dsdl/svrl\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:schold=\"http://www.ascc.net/xml/schematron\" test=\"starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'http://') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'https://') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'mailto:') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezcontent://') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezlocation://') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezremote://') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezurl://') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), '#')\"><axsl:attribute name=\"location\"><axsl:apply-templates select=\".\" mode=\"schematron-get-full-path-2\"/></axsl:attribute><svrl:text>links must start with one of: http://, https://, mailto:, ezcontent://, ezlocation://, ezremote://, ezurl://, #</svrl:text></svrl:failed-assert></axsl:otherwise></axsl:choose>",
          "",
          "---------------"
        ],
        "tests/lib/eZ/FieldType/RichTextTest.php||tests/lib/eZ/FieldType/RichTextTest.php": [
          "File: tests/lib/eZ/FieldType/RichTextTest.php -> tests/lib/eZ/FieldType/RichTextTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "224:                 [",
          "225:                     new ValidationError(",
          "226:                         \"Validation of XML content failed:\\n\" .",
          "228:                         null,",
          "229:                         [],",
          "230:                         'xml'",
          "",
          "[Removed Lines]",
          "227:                         '/section/para/link: links must start with one of: http://, https://, mailto:, ezcontent://, ezlocation://, ezurl://, #',",
          "",
          "[Added Lines]",
          "227:                         '/section/para/link: links must start with one of: http://, https://, mailto:, ezcontent://, ezlocation://, ezremote://, ezurl://, #',",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "239:                 [",
          "240:                     new ValidationError(",
          "241:                         \"Validation of XML content failed:\\n\" .",
          "243:                         null,",
          "244:                         [],",
          "245:                         'xml'",
          "",
          "[Removed Lines]",
          "242:                         '/section/para/link: links must start with one of: http://, https://, mailto:, ezcontent://, ezlocation://, ezurl://, #',",
          "",
          "[Added Lines]",
          "242:                         '/section/para/link: links must start with one of: http://, https://, mailto:, ezcontent://, ezlocation://, ezremote://, ezurl://, #',",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "269:                 [",
          "270:                     new ValidationError(",
          "271:                         \"Validation of XML content failed:\\n\" .",
          "273:                         null,",
          "274:                         [],",
          "275:                         'xml'",
          "",
          "[Removed Lines]",
          "272:                         '/section/para/link: links must start with one of: http://, https://, mailto:, ezcontent://, ezlocation://, ezurl://, #',",
          "",
          "[Added Lines]",
          "272:                         '/section/para/link: links must start with one of: http://, https://, mailto:, ezcontent://, ezlocation://, ezremote://, ezurl://, #',",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "dbe816f3ff4c903cc508dfdcdca8791c8284d292",
      "candidate_info": {
        "commit_hash": "dbe816f3ff4c903cc508dfdcdca8791c8284d292",
        "repo": "ezsystems/ezplatform-richtext",
        "commit_url": "https://github.com/ezsystems/ezplatform-richtext/commit/dbe816f3ff4c903cc508dfdcdca8791c8284d292",
        "files": [
          "src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch",
          "src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl",
          "tests/lib/eZ/FieldType/RichTextTest.php"
        ],
        "message": "Fixed failing test for relative links",
        "before_after_code_files": [
          "src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch||src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch",
          "src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl||src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl",
          "tests/lib/eZ/FieldType/RichTextTest.php||tests/lib/eZ/FieldType/RichTextTest.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch||src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch",
            "src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl||src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl",
            "tests/lib/eZ/FieldType/RichTextTest.php||tests/lib/eZ/FieldType/RichTextTest.php"
          ],
          "candidate": [
            "src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch||src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch",
            "src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl||src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl",
            "tests/lib/eZ/FieldType/RichTextTest.php||tests/lib/eZ/FieldType/RichTextTest.php"
          ]
        }
      },
      "candidate_diff": {
        "src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch||src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch": [
          "File: src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch -> src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch",
          "--- Hunk 1 ---",
          "[Context before]",
          "260:                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezlocation://') or",
          "261:                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezremote://') or",
          "262:                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezurl://') or",
          "263:                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), '#')\"",
          "265:       <s:assert test=\"not(contains(@*[name()='xlink:href'], '&lt;') or",
          "266:                           contains(@*[name()='xlink:href'], '&gt;') or",
          "267:                           contains(@*[name()='xlink:href'], '&quot;'))\"",
          "",
          "[Removed Lines]",
          "264:                 mode=\"schematron-get-full-path-2\">links must start with one of: http://, https://, mailto:, ezcontent://, ezlocation://, ezremote://, ezurl://, #</s:assert>",
          "",
          "[Added Lines]",
          "263:                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), '/') or",
          "265:                 mode=\"schematron-get-full-path-2\">links must start with one of: http://, https://, mailto:, ezcontent://, ezlocation://, ezremote://, ezurl://, /, #</s:assert>",
          "",
          "---------------"
        ],
        "src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl||src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl": [
          "File: src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl -> src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl",
          "--- Hunk 1 ---",
          "[Context before]",
          "79: <axsl:template match=\"db:link\" priority=\"1000\" mode=\"M3\"><svrl:fired-rule xmlns:svrl=\"http://purl.oclc.org/dsdl/svrl\" context=\"db:link\"/>",
          "81:   <!--ASSERT -->",
          "84:   <!--ASSERT -->",
          "85: <axsl:choose><axsl:when test=\"not(contains(@*[name()='xlink:href'], '&lt;') or                           contains(@*[name()='xlink:href'], '&gt;') or                           contains(@*[name()='xlink:href'], '&quot;'))\"/><axsl:otherwise><svrl:failed-assert xmlns:svrl=\"http://purl.oclc.org/dsdl/svrl\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:schold=\"http://www.ascc.net/xml/schematron\" test=\"not(contains(@*[name()='xlink:href'], '&lt;') or contains(@*[name()='xlink:href'], '&gt;') or contains(@*[name()='xlink:href'], '&quot;'))\"><axsl:attribute name=\"location\"><axsl:apply-templates select=\".\" mode=\"schematron-get-full-path-2\"/></axsl:attribute><svrl:text>using characters [&lt; &gt; \"] in links is not allowed</svrl:text></svrl:failed-assert></axsl:otherwise></axsl:choose><axsl:apply-templates select=\"*|comment()|processing-instruction()\" mode=\"M3\"/></axsl:template><axsl:template match=\"text()\" priority=\"-1\" mode=\"M3\"/><axsl:template match=\"@*|node()\" priority=\"-2\" mode=\"M3\"><axsl:apply-templates select=\"*|comment()|processing-instruction()\" mode=\"M3\"/></axsl:template></axsl:stylesheet>",
          "",
          "[Removed Lines]",
          "82: <axsl:choose><axsl:when test=\"starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'http://') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'https://') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'mailto:') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezcontent://') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezlocation://') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezremote://') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezurl://') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), '#')\"/><axsl:otherwise><svrl:failed-assert xmlns:svrl=\"http://purl.oclc.org/dsdl/svrl\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:schold=\"http://www.ascc.net/xml/schematron\" test=\"starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'http://') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'https://') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'mailto:') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezcontent://') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezlocation://') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezremote://') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezurl://') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), '#')\"><axsl:attribute name=\"location\"><axsl:apply-templates select=\".\" mode=\"schematron-get-full-path-2\"/></axsl:attribute><svrl:text>links must start with one of: http://, https://, mailto:, ezcontent://, ezlocation://, ezremote://, ezurl://, #</svrl:text></svrl:failed-assert></axsl:otherwise></axsl:choose>",
          "",
          "[Added Lines]",
          "82: <axsl:choose><axsl:when test=\"starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'http://') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'https://') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'mailto:') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezcontent://') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezlocation://') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezremote://') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezurl://') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), '/') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), '#')\"/><axsl:otherwise><svrl:failed-assert xmlns:svrl=\"http://purl.oclc.org/dsdl/svrl\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:schold=\"http://www.ascc.net/xml/schematron\" test=\"starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'http://') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'https://') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'mailto:') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezcontent://') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezlocation://') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezremote://') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezurl://') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), '/') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), '#')\"><axsl:attribute name=\"location\"><axsl:apply-templates select=\".\" mode=\"schematron-get-full-path-2\"/></axsl:attribute><svrl:text>links must start with one of: http://, https://, mailto:, ezcontent://, ezlocation://, ezremote://, ezurl://, /, #</svrl:text></svrl:failed-assert></axsl:otherwise></axsl:choose>",
          "",
          "---------------"
        ],
        "tests/lib/eZ/FieldType/RichTextTest.php||tests/lib/eZ/FieldType/RichTextTest.php": [
          "File: tests/lib/eZ/FieldType/RichTextTest.php -> tests/lib/eZ/FieldType/RichTextTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "224:                 [",
          "225:                     new ValidationError(",
          "226:                         \"Validation of XML content failed:\\n\" .",
          "228:                         null,",
          "229:                         [],",
          "230:                         'xml'",
          "",
          "[Removed Lines]",
          "227:                         '/section/para/link: links must start with one of: http://, https://, mailto:, ezcontent://, ezlocation://, ezremote://, ezurl://, #',",
          "",
          "[Added Lines]",
          "227:                         '/section/para/link: links must start with one of: http://, https://, mailto:, ezcontent://, ezlocation://, ezremote://, ezurl://, /, #',",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "239:                 [",
          "240:                     new ValidationError(",
          "241:                         \"Validation of XML content failed:\\n\" .",
          "243:                         null,",
          "244:                         [],",
          "245:                         'xml'",
          "",
          "[Removed Lines]",
          "242:                         '/section/para/link: links must start with one of: http://, https://, mailto:, ezcontent://, ezlocation://, ezremote://, ezurl://, #',",
          "",
          "[Added Lines]",
          "242:                         '/section/para/link: links must start with one of: http://, https://, mailto:, ezcontent://, ezlocation://, ezremote://, ezurl://, /, #',",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "269:                 [",
          "270:                     new ValidationError(",
          "271:                         \"Validation of XML content failed:\\n\" .",
          "273:                         null,",
          "274:                         [],",
          "275:                         'xml'",
          "",
          "[Removed Lines]",
          "272:                         '/section/para/link: links must start with one of: http://, https://, mailto:, ezcontent://, ezlocation://, ezremote://, ezurl://, #',",
          "",
          "[Added Lines]",
          "272:                         '/section/para/link: links must start with one of: http://, https://, mailto:, ezcontent://, ezlocation://, ezremote://, ezurl://, /, #',",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "acb0fa0a1dd29f2e3df41f4f7ad5b49c32ba1851",
      "candidate_info": {
        "commit_hash": "acb0fa0a1dd29f2e3df41f4f7ad5b49c32ba1851",
        "repo": "ezsystems/ezplatform-richtext",
        "commit_url": "https://github.com/ezsystems/ezplatform-richtext/commit/acb0fa0a1dd29f2e3df41f4f7ad5b49c32ba1851",
        "files": [
          "phpstan-baseline.neon",
          "src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch",
          "src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl",
          "tests/lib/eZ/FieldType/RichTextTest.php"
        ],
        "message": "IBX-8891: Fixed XML link validation to allow using `tel:` in links (#245)\n\n* IBX-8891: XML link validator in rich-text does not allow to use \"tel: \"\n\n* [PHPStan] Aligned baseline after PHPStan update",
        "before_after_code_files": [
          "phpstan-baseline.neon||phpstan-baseline.neon",
          "src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch||src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch",
          "src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl||src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl",
          "tests/lib/eZ/FieldType/RichTextTest.php||tests/lib/eZ/FieldType/RichTextTest.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch||src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch",
            "src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl||src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl",
            "tests/lib/eZ/FieldType/RichTextTest.php||tests/lib/eZ/FieldType/RichTextTest.php"
          ],
          "candidate": [
            "src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch||src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch",
            "src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl||src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl",
            "tests/lib/eZ/FieldType/RichTextTest.php||tests/lib/eZ/FieldType/RichTextTest.php"
          ]
        }
      },
      "candidate_diff": {
        "phpstan-baseline.neon||phpstan-baseline.neon": [
          "File: phpstan-baseline.neon -> phpstan-baseline.neon",
          "--- Hunk 1 ---",
          "[Context before]",
          "625:    count: 1",
          "626:    path: src/lib/eZ/FieldType/RichText/RichTextStorage.php",
          "628:   -",
          "629:    message: \"#^Parameter \\\\#1 \\\\$source of method DOMDocument\\\\:\\\\:loadXML\\\\(\\\\) expects string, array\\\\|bool\\\\|float\\\\|int\\\\|string\\\\|null given\\\\.$#\"",
          "630:    count: 2",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "628:   -",
          "629:    message: \"#^Offset 1 does not exist on array\\\\{0\\\\?\\\\: string, 1\\\\?\\\\: ''\\\\|'ezremote\\\\://', 2\\\\?\\\\: string, 3\\\\?\\\\: string\\\\}\\\\.$#\"",
          "630:    count: 1",
          "631:    path: src/lib/eZ/FieldType/RichText/RichTextStorage.php",
          "633:   -",
          "634:    message: \"#^Offset 1 does not exist on array\\\\{0\\\\?\\\\: string, 1\\\\?\\\\: string, 2\\\\?\\\\: string\\\\}\\\\.$#\"",
          "635:    count: 1",
          "636:    path: src/lib/eZ/FieldType/RichText/RichTextStorage.php",
          "638:   -",
          "639:    message: \"#^Offset 2 does not exist on array\\\\{0\\\\?\\\\: string, 1\\\\: 'ezremote\\\\://', 2\\\\?\\\\: string, 3\\\\?\\\\: string\\\\}\\\\.$#\"",
          "640:    count: 1",
          "641:    path: src/lib/eZ/FieldType/RichText/RichTextStorage.php",
          "643:   -",
          "644:    message: \"#^Offset 2 does not exist on array\\\\{0\\\\?\\\\: string, 1\\\\?\\\\: ''\\\\|'ezremote\\\\://', 2\\\\?\\\\: string, 3\\\\?\\\\: string\\\\}\\\\.$#\"",
          "645:    count: 2",
          "646:    path: src/lib/eZ/FieldType/RichText/RichTextStorage.php",
          "648:   -",
          "649:    message: \"#^Offset 2 does not exist on array\\\\{0\\\\?\\\\: string, 1\\\\?\\\\: string, 2\\\\?\\\\: string\\\\}\\\\.$#\"",
          "650:    count: 1",
          "651:    path: src/lib/eZ/FieldType/RichText/RichTextStorage.php",
          "653:   -",
          "654:    message: \"#^Offset 3 does not exist on array\\\\{0\\\\?\\\\: string, 1\\\\?\\\\: ''\\\\|'ezremote\\\\://', 2\\\\?\\\\: string, 3\\\\?\\\\: string\\\\}\\\\.$#\"",
          "655:    count: 1",
          "656:    path: src/lib/eZ/FieldType/RichText/RichTextStorage.php",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "770:    count: 4",
          "771:    path: src/lib/eZ/RichText/Converter/Link.php",
          "773:   -",
          "774:    message: \"#^Parameter \\\\#1 \\\\$locationId of method eZ\\\\\\\\Publish\\\\\\\\API\\\\\\\\Repository\\\\\\\\LocationService\\\\:\\\\:loadLocation\\\\(\\\\) expects int, int\\\\|null given\\\\.$#\"",
          "775:    count: 1",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "803:   -",
          "804:    message: \"#^Offset 1 does not exist on array\\\\{0\\\\?\\\\: string, 1\\\\?\\\\: string, 2\\\\?\\\\: string, 3\\\\?\\\\: string\\\\}\\\\.$#\"",
          "805:    count: 1",
          "806:    path: src/lib/eZ/RichText/Converter/Link.php",
          "808:   -",
          "809:    message: \"#^Offset 2 does not exist on array\\\\{0\\\\?\\\\: string, 1\\\\?\\\\: string, 2\\\\?\\\\: string, 3\\\\?\\\\: string\\\\}\\\\.$#\"",
          "810:    count: 1",
          "811:    path: src/lib/eZ/RichText/Converter/Link.php",
          "813:   -",
          "814:    message: \"#^Offset 3 does not exist on array\\\\{0\\\\?\\\\: string, 1\\\\?\\\\: string, 2\\\\?\\\\: string, 3\\\\?\\\\: string\\\\}\\\\.$#\"",
          "815:    count: 1",
          "816:    path: src/lib/eZ/RichText/Converter/Link.php",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "915:    count: 1",
          "916:    path: src/lib/eZ/RichText/Converter/Render/Embed.php",
          "918:   -",
          "919:    message: \"#^PHPDoc tag @var has invalid value \\\\(\\\\$embed \\\\\\\\DOMElement\\\\)\\\\: Unexpected token \\\"\\\\$embed\\\", expected type at offset 9$#\"",
          "920:    count: 1",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "963:   -",
          "964:    message: \"#^Offset 1 does not exist on array\\\\{0\\\\?\\\\: string, 1\\\\?\\\\: 'ezcontent'\\\\|'ezlocation', 2\\\\?\\\\: numeric\\\\-string\\\\}\\\\.$#\"",
          "965:    count: 1",
          "966:    path: src/lib/eZ/RichText/Converter/Render/Embed.php",
          "968:   -",
          "969:    message: \"#^Offset 2 does not exist on array\\\\{0\\\\?\\\\: string, 1\\\\: 'ezcontent', 2\\\\?\\\\: numeric\\\\-string\\\\}\\\\.$#\"",
          "970:    count: 1",
          "971:    path: src/lib/eZ/RichText/Converter/Render/Embed.php",
          "973:   -",
          "974:    message: \"#^Offset 2 does not exist on array\\\\{0\\\\?\\\\: string, 1\\\\: 'ezlocation', 2\\\\?\\\\: numeric\\\\-string\\\\}\\\\.$#\"",
          "975:    count: 1",
          "976:    path: src/lib/eZ/RichText/Converter/Render/Embed.php",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1105:    count: 1",
          "1106:    path: src/lib/eZ/RichText/RelationProcessor.php",
          "1108:   -",
          "1109:    message: \"#^Method EzSystems\\\\\\\\EzPlatformRichText\\\\\\\\eZ\\\\\\\\RichText\\\\\\\\RendererInterface\\\\:\\\\:renderContentEmbed\\\\(\\\\) has parameter \\\\$parameters with no value type specified in iterable type array\\\\.$#\"",
          "1110:    count: 1",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1168:   -",
          "1169:    message: \"#^Offset 1 does not exist on array\\\\{0\\\\?\\\\: string, 1\\\\?\\\\: non\\\\-empty\\\\-string, 2\\\\?\\\\: string, 3\\\\?\\\\: string\\\\}\\\\.$#\"",
          "1170:    count: 1",
          "1171:    path: src/lib/eZ/RichText/RelationProcessor.php",
          "1173:   -",
          "1174:    message: \"#^Offset 2 does not exist on array\\\\{0\\\\?\\\\: string, 1\\\\?\\\\: non\\\\-empty\\\\-string, 2\\\\?\\\\: string, 3\\\\?\\\\: string\\\\}\\\\.$#\"",
          "1175:    count: 1",
          "1176:    path: src/lib/eZ/RichText/RelationProcessor.php",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1150:    count: 1",
          "1151:    path: src/lib/eZ/RichText/Validator/InternalLinkValidator.php",
          "1153:   -",
          "1154:    message: \"#^Parameter \\\\#1 \\\\$locationId of method eZ\\\\\\\\Publish\\\\\\\\SPI\\\\\\\\Persistence\\\\\\\\Content\\\\\\\\Location\\\\\\\\Handler\\\\:\\\\:load\\\\(\\\\) expects int, string given\\\\.$#\"",
          "1155:    count: 1",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1223:   -",
          "1224:    message: \"#^Offset 1 does not exist on array\\\\{0\\\\?\\\\: string, 1\\\\?\\\\: non\\\\-empty\\\\-string, 2\\\\?\\\\: string, 3\\\\?\\\\: string\\\\}\\\\.$#\"",
          "1225:    count: 1",
          "1226:    path: src/lib/eZ/RichText/Validator/InternalLinkValidator.php",
          "1228:   -",
          "1229:    message: \"#^Offset 2 does not exist on array\\\\{0\\\\?\\\\: string, 1\\\\?\\\\: non\\\\-empty\\\\-string, 2\\\\?\\\\: string, 3\\\\?\\\\: string\\\\}\\\\.$#\"",
          "1230:    count: 1",
          "1231:    path: src/lib/eZ/RichText/Validator/InternalLinkValidator.php",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "1629:    message: \"#^Cannot access property \\\\$id on eZ\\\\\\\\Publish\\\\\\\\API\\\\\\\\Repository\\\\\\\\Values\\\\\\\\Content\\\\\\\\Field\\\\|null\\\\.$#\"",
          "1630:    count: 1",
          "1631:    path: tests/integration/eZ/API/RichTextFieldTypeIntegrationTest.php",
          "1636:   -",
          "1637:    message: \"#^Cannot access property \\\\$value on eZ\\\\\\\\Publish\\\\\\\\API\\\\\\\\Repository\\\\\\\\Values\\\\\\\\Content\\\\\\\\Field\\\\|null\\\\.$#\"",
          "1638:    count: 1",
          "",
          "[Removed Lines]",
          "1632:   -",
          "1633:    message: \"#^Cannot call method fetchOne\\\\(\\\\) on Doctrine\\\\\\\\DBAL\\\\\\\\ForwardCompatibility\\\\\\\\Result\\\\|int\\\\|string\\\\.$#\"",
          "1634:    count: 1",
          "1635:    path: tests/integration/eZ/API/RichTextFieldTypeIntegrationTest.php",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "1648:    count: 1",
          "1649:    path: tests/integration/eZ/API/RichTextFieldTypeIntegrationTest.php",
          "1651:   -",
          "1652:    message: \"#^Method EzSystems\\\\\\\\IntegrationTests\\\\\\\\EzPlatformRichText\\\\\\\\eZ\\\\\\\\API\\\\\\\\RichTextFieldTypeIntegrationTest\\\\:\\\\:__construct\\\\(\\\\) has parameter \\\\$data with no value type specified in iterable type array\\\\.$#\"",
          "1653:    count: 1",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1725:    count: 1",
          "1726:    path: tests/integration/eZ/API/RichTextFieldTypeIntegrationTest.php",
          "1728:   -",
          "1729:    message: \"#^Cannot call method fetchOne\\\\(\\\\) on Doctrine\\\\\\\\DBAL\\\\\\\\ForwardCompatibility\\\\\\\\Result\\\\|int\\\\|string\\\\.$#\"",
          "",
          "---------------"
        ],
        "src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch||src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch": [
          "File: src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch -> src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch",
          "--- Hunk 1 ---",
          "[Context before]",
          "253:     <s:let name=\"lowerCase\" value=\"'abcdefghijklmnopqrstuvwxyz'\"/>",
          "254:     <s:rule context=\"db:link\">",
          "255:       <!-- Using translate() because we don't have XPath 2, so we can't use lower-case(). -->",
          "258:                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'mailto:') or",
          "263:                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), '/') or",
          "264:                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), '#')\"",
          "270:     </s:rule>",
          "271:   </s:pattern>",
          "272: </s:schema>",
          "",
          "[Removed Lines]",
          "256:       <s:assert test=\"starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'http://') or",
          "257:                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'https://') or",
          "259:                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezcontent://') or",
          "260:                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezlocation://') or",
          "261:                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezremote://') or",
          "262:                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezurl://') or",
          "265:                 mode=\"schematron-get-full-path-2\">links must start with one of: http://, https://, mailto:, ezcontent://, ezlocation://, ezremote://, ezurl://, /, #</s:assert>",
          "266:       <s:assert test=\"not(contains(@*[name()='xlink:href'], '&lt;') or",
          "267:                           contains(@*[name()='xlink:href'], '&gt;') or",
          "268:                           contains(@*[name()='xlink:href'], '&quot;'))\"",
          "269:                 mode=\"schematron-get-full-path-2\">using characters [&lt; &gt; &quot;] in links is not allowed</s:assert>",
          "",
          "[Added Lines]",
          "256:       <s:assert test=\"starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'http') or",
          "258:                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'tel:') or",
          "259:                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ez') or",
          "262:                 mode=\"schematron-get-full-path-2\">links must start with one of: http://, https://, mailto:, tel:, ezcontent://, ezlocation://, ezremote://, ezurl://, /, #</s:assert>",
          "",
          "---------------"
        ],
        "src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl||src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl": [
          "File: src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl -> src/lib/eZ/RichText/Resources/schemas/docbook/docbook.iso.sch.xsl",
          "--- Hunk 1 ---",
          "[Context before]",
          "79: <axsl:template match=\"db:link\" priority=\"1000\" mode=\"M3\"><svrl:fired-rule xmlns:svrl=\"http://purl.oclc.org/dsdl/svrl\" context=\"db:link\"/>",
          "81:   <!--ASSERT -->",
          "",
          "[Removed Lines]",
          "82: <axsl:choose><axsl:when test=\"starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'http://') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'https://') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'mailto:') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezcontent://') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezlocation://') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezremote://') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezurl://') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), '/') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), '#')\"/><axsl:otherwise><svrl:failed-assert xmlns:svrl=\"http://purl.oclc.org/dsdl/svrl\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:schold=\"http://www.ascc.net/xml/schematron\" test=\"starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'http://') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'https://') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'mailto:') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezcontent://') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezlocation://') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezremote://') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ezurl://') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), '/') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), '#')\"><axsl:attribute name=\"location\"><axsl:apply-templates select=\".\" mode=\"schematron-get-full-path-2\"/></axsl:attribute><svrl:text>links must start with one of: http://, https://, mailto:, ezcontent://, ezlocation://, ezremote://, ezurl://, /, #</svrl:text></svrl:failed-assert></axsl:otherwise></axsl:choose>",
          "84:   <!--ASSERT -->",
          "85: <axsl:choose><axsl:when test=\"not(contains(@*[name()='xlink:href'], '&lt;') or                           contains(@*[name()='xlink:href'], '&gt;') or                           contains(@*[name()='xlink:href'], '&quot;'))\"/><axsl:otherwise><svrl:failed-assert xmlns:svrl=\"http://purl.oclc.org/dsdl/svrl\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:schold=\"http://www.ascc.net/xml/schematron\" test=\"not(contains(@*[name()='xlink:href'], '&lt;') or contains(@*[name()='xlink:href'], '&gt;') or contains(@*[name()='xlink:href'], '&quot;'))\"><axsl:attribute name=\"location\"><axsl:apply-templates select=\".\" mode=\"schematron-get-full-path-2\"/></axsl:attribute><svrl:text>using characters [&lt; &gt; \"] in links is not allowed</svrl:text></svrl:failed-assert></axsl:otherwise></axsl:choose><axsl:apply-templates select=\"*|comment()|processing-instruction()\" mode=\"M3\"/></axsl:template><axsl:template match=\"text()\" priority=\"-1\" mode=\"M3\"/><axsl:template match=\"@*|node()\" priority=\"-2\" mode=\"M3\"><axsl:apply-templates select=\"*|comment()|processing-instruction()\" mode=\"M3\"/></axsl:template></axsl:stylesheet>",
          "",
          "[Added Lines]",
          "82: <axsl:choose><axsl:when test=\"starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'http') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'mailto:') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'tel:') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ez') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), '/') or                       starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), '#')\"/><axsl:otherwise><svrl:failed-assert xmlns:svrl=\"http://purl.oclc.org/dsdl/svrl\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:schold=\"http://www.ascc.net/xml/schematron\" test=\"starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'http') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'mailto:') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'tel:') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), 'ez') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), '/') or starts-with(translate(@*[name()='xlink:href'], $upperCase, $lowerCase), '#')\"><axsl:attribute name=\"location\"><axsl:apply-templates select=\".\" mode=\"schematron-get-full-path-2\"/></axsl:attribute><svrl:text>links must start with one of: http://, https://, mailto:, tel:, ezcontent://, ezlocation://, ezremote://, ezurl://, /, #</svrl:text></svrl:failed-assert></axsl:otherwise></axsl:choose><axsl:apply-templates select=\"*|comment()|processing-instruction()\" mode=\"M3\"/></axsl:template><axsl:template match=\"text()\" priority=\"-1\" mode=\"M3\"/><axsl:template match=\"@*|node()\" priority=\"-2\" mode=\"M3\"><axsl:apply-templates select=\"*|comment()|processing-instruction()\" mode=\"M3\"/></axsl:template></axsl:stylesheet>",
          "",
          "---------------"
        ],
        "tests/lib/eZ/FieldType/RichTextTest.php||tests/lib/eZ/FieldType/RichTextTest.php": [
          "File: tests/lib/eZ/FieldType/RichTextTest.php -> tests/lib/eZ/FieldType/RichTextTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "224:                 [",
          "225:                     new ValidationError(",
          "226:                         \"Validation of XML content failed:\\n\" .",
          "228:                         null,",
          "229:                         [],",
          "230:                         'xml'",
          "",
          "[Removed Lines]",
          "227:                         '/section/para/link: links must start with one of: http://, https://, mailto:, ezcontent://, ezlocation://, ezremote://, ezurl://, /, #',",
          "",
          "[Added Lines]",
          "227:                         '/section/para/link: links must start with one of: http://, https://, mailto:, tel:, ezcontent://, ezlocation://, ezremote://, ezurl://, /, #',",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "239:                 [",
          "240:                     new ValidationError(",
          "241:                         \"Validation of XML content failed:\\n\" .",
          "243:                         null,",
          "244:                         [],",
          "245:                         'xml'",
          "",
          "[Removed Lines]",
          "242:                         '/section/para/link: links must start with one of: http://, https://, mailto:, ezcontent://, ezlocation://, ezremote://, ezurl://, /, #',",
          "",
          "[Added Lines]",
          "242:                         '/section/para/link: links must start with one of: http://, https://, mailto:, tel:, ezcontent://, ezlocation://, ezremote://, ezurl://, /, #',",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "252:   <para><link xlink:href=\"https://example.com/foo&lt;bar\">link</link></para>",
          "253: </section>',",
          "254:                 [",
          "262:                 ],",
          "263:             ],",
          "264:             [",
          "",
          "[Removed Lines]",
          "255:                     new ValidationError(",
          "256:                         \"Validation of XML content failed:\\n\" .",
          "257:                         '/section/para/link: using characters [< > \"] in links is not allowed',",
          "258:                         null,",
          "259:                         [],",
          "260:                         'xml'",
          "261:                     ),",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "269:                 [",
          "270:                     new ValidationError(",
          "271:                         \"Validation of XML content failed:\\n\" .",
          "273:                         null,",
          "274:                         [],",
          "275:                         'xml'",
          "",
          "[Removed Lines]",
          "272:                         '/section/para/link: links must start with one of: http://, https://, mailto:, ezcontent://, ezlocation://, ezremote://, ezurl://, /, #',",
          "",
          "[Added Lines]",
          "265:                         '/section/para/link: links must start with one of: http://, https://, mailto:, tel:, ezcontent://, ezlocation://, ezremote://, ezurl://, /, #',",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "7bbc6d024c6146d1e1ba84d27a3ebffe9459613e",
      "candidate_info": {
        "commit_hash": "7bbc6d024c6146d1e1ba84d27a3ebffe9459613e",
        "repo": "ezsystems/ezplatform-richtext",
        "commit_url": "https://github.com/ezsystems/ezplatform-richtext/commit/7bbc6d024c6146d1e1ba84d27a3ebffe9459613e",
        "files": [
          "tests/lib/eZ/FieldType/RichTextTest.php"
        ],
        "message": "Fixed failing test for ezurl protocol",
        "before_after_code_files": [
          "tests/lib/eZ/FieldType/RichTextTest.php||tests/lib/eZ/FieldType/RichTextTest.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "tests/lib/eZ/FieldType/RichTextTest.php||tests/lib/eZ/FieldType/RichTextTest.php"
          ],
          "candidate": [
            "tests/lib/eZ/FieldType/RichTextTest.php||tests/lib/eZ/FieldType/RichTextTest.php"
          ]
        }
      },
      "candidate_diff": {
        "tests/lib/eZ/FieldType/RichTextTest.php||tests/lib/eZ/FieldType/RichTextTest.php": [
          "File: tests/lib/eZ/FieldType/RichTextTest.php -> tests/lib/eZ/FieldType/RichTextTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "224:                 [",
          "225:                     new ValidationError(",
          "226:                         \"Validation of XML content failed:\\n\" .",
          "228:                         null,",
          "229:                         [],",
          "230:                         'xml'",
          "",
          "[Removed Lines]",
          "227:                         '/section/para/link: links must start with one of: http://, https://, mailto:, ezcontent://, ezlocation://, ezurl://,#',",
          "",
          "[Added Lines]",
          "227:                         '/section/para/link: links must start with one of: http://, https://, mailto:, ezcontent://, ezlocation://, ezurl://, #',",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "239:                 [",
          "240:                     new ValidationError(",
          "241:                         \"Validation of XML content failed:\\n\" .",
          "243:                         null,",
          "244:                         [],",
          "245:                         'xml'",
          "",
          "[Removed Lines]",
          "242:                         '/section/para/link: links must start with one of: http://, https://, mailto:, ezcontent://, ezlocation://, ezurl://,#',",
          "",
          "[Added Lines]",
          "242:                         '/section/para/link: links must start with one of: http://, https://, mailto:, ezcontent://, ezlocation://, ezurl://, #',",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "269:                 [",
          "270:                     new ValidationError(",
          "271:                         \"Validation of XML content failed:\\n\" .",
          "273:                         null,",
          "274:                         [],",
          "275:                         'xml'",
          "",
          "[Removed Lines]",
          "272:                         '/section/para/link: links must start with one of: http://, https://, mailto:, ezcontent://, ezlocation://, ezurl://,#',",
          "",
          "[Added Lines]",
          "272:                         '/section/para/link: links must start with one of: http://, https://, mailto:, ezcontent://, ezlocation://, ezurl://, #',",
          "",
          "---------------"
        ]
      }
    }
  ]
}