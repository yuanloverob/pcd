{
  "cve_id": "CVE-2024-41956",
  "cve_desc": "Soft Serve is a self-hostable Git server for the command line. Prior to 0.7.5, it is possible for a user who can commit files to a repository hosted by Soft Serve to execute arbitrary code via environment manipulation and Git. The issue is that Soft Serve passes all environment variables given by the client to git subprocesses. This includes environment variables that control program execution, such as LD_PRELOAD. This vulnerability is fixed in 0.7.5.",
  "repo": "charmbracelet/soft-serve",
  "patch_hash": "4daebdd422a6ba8c04162d023f8be355a8fe3184",
  "patch_info": {
    "commit_hash": "4daebdd422a6ba8c04162d023f8be355a8fe3184",
    "repo": "charmbracelet/soft-serve",
    "commit_url": "https://github.com/charmbracelet/soft-serve/commit/4daebdd422a6ba8c04162d023f8be355a8fe3184",
    "files": [
      "pkg/ssh/cmd/git.go"
    ],
    "message": "sec: do not append session envs to git run (#544)\n\nSigned-off-by: Carlos Alexandro Becker <caarlos0@users.noreply.github.com>",
    "before_after_code_files": [
      "pkg/ssh/cmd/git.go||pkg/ssh/cmd/git.go"
    ]
  },
  "patch_diff": {
    "pkg/ssh/cmd/git.go||pkg/ssh/cmd/git.go": [
      "File: pkg/ssh/cmd/git.go -> pkg/ssh/cmd/git.go",
      "--- Hunk 1 ---",
      "[Context before]",
      "202:   )",
      "203:  }",
      "208:  envs = append(envs, cfg.Environ()...)",
      "210:  repoPath := filepath.Join(reposDir, repoDir)",
      "",
      "[Removed Lines]",
      "206:  s := sshutils.SessionFromContext(ctx)",
      "207:  envs = append(envs, s.Environ()...)",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "f23ea48c913d6f907f499e0315c4658632d20d29",
      "candidate_info": {
        "commit_hash": "f23ea48c913d6f907f499e0315c4658632d20d29",
        "repo": "charmbracelet/soft-serve",
        "commit_url": "https://github.com/charmbracelet/soft-serve/commit/f23ea48c913d6f907f499e0315c4658632d20d29",
        "files": [
          "pkg/ssh/cmd/git.go"
        ],
        "message": "fix(ssh): pass GIT_PROTOCOL from ssh session down to binary\n\nFixes: 4daebdd422a6 (sec: do not append session envs to git run (#544))",
        "before_after_code_files": [
          "pkg/ssh/cmd/git.go||pkg/ssh/cmd/git.go"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_issue": 1,
        "olp_code_files": {
          "patch": [
            "pkg/ssh/cmd/git.go||pkg/ssh/cmd/git.go"
          ],
          "candidate": [
            "pkg/ssh/cmd/git.go||pkg/ssh/cmd/git.go"
          ]
        }
      },
      "candidate_diff": {
        "pkg/ssh/cmd/git.go||pkg/ssh/cmd/git.go": [
          "File: pkg/ssh/cmd/git.go -> pkg/ssh/cmd/git.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: import (",
          "4:  \"errors\"",
          "5:  \"path/filepath\"",
          "6:  \"time\"",
          "8:  \"github.com/charmbracelet/log\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "6:  \"strings\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "205:  envs = append(envs, cfg.Environ()...)",
          "207:  repoPath := filepath.Join(reposDir, repoDir)",
          "208:  service := git.Service(cmd.Name())",
          "209:  stdin := cmd.InOrStdin()",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "209:  if sess := sshutils.SessionFromContext(ctx); sess != nil {",
          "210:   for _, env := range sess.Environ() {",
          "211:    if strings.HasPrefix(env, \"GIT_PROTOCOL=\") {",
          "212:     envs = append(envs, env)",
          "213:     break",
          "214:    }",
          "215:   }",
          "216:  }",
          "",
          "---------------"
        ]
      }
    }
  ]
}