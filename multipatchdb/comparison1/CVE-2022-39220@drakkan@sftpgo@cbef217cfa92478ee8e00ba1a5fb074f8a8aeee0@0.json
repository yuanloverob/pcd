{
  "cve_id": "CVE-2022-39220",
  "cve_desc": "SFTPGo is an SFTP server written in Go. Versions prior to 2.3.5 are subject to Cross-site scripting (XSS) vulnerabilities in the SFTPGo WebClient, allowing remote attackers to inject malicious code. This issue is patched in version 2.3.5. No known workarounds exist.",
  "repo": "drakkan/sftpgo",
  "patch_hash": "cbef217cfa92478ee8e00ba1a5fb074f8a8aeee0",
  "patch_info": {
    "commit_hash": "cbef217cfa92478ee8e00ba1a5fb074f8a8aeee0",
    "repo": "drakkan/sftpgo",
    "commit_url": "https://github.com/drakkan/sftpgo/commit/cbef217cfa92478ee8e00ba1a5fb074f8a8aeee0",
    "files": [
      "templates/webadmin/base.html",
      "templates/webclient/base.html",
      "templates/webclient/files.html",
      "templates/webclient/sharefiles.html",
      "templates/webclient/shareupload.html"
    ],
    "message": "WebClient: improve HTML escaping\n\nSigned-off-by: Nicola Murino <nicola.murino@gmail.com>",
    "before_after_code_files": [
      "templates/webadmin/base.html||templates/webadmin/base.html",
      "templates/webclient/base.html||templates/webclient/base.html",
      "templates/webclient/files.html||templates/webclient/files.html",
      "templates/webclient/sharefiles.html||templates/webclient/sharefiles.html",
      "templates/webclient/shareupload.html||templates/webclient/shareupload.html"
    ]
  },
  "patch_diff": {
    "templates/webadmin/base.html||templates/webadmin/base.html": [
      "File: templates/webadmin/base.html -> templates/webadmin/base.html",
      "--- Hunk 1 ---",
      "[Context before]",
      "265:     <script src=\"{{.StaticURL}}/js/sb-admin-2.min.js\"></script>",
      "267:     <script type=\"text/javascript\">",
      "268:         function fixedEncodeURIComponent(str) {",
      "270:                 return '%' + c.charCodeAt(0).toString(16);",
      "271:             });",
      "272:         }",
      "",
      "[Removed Lines]",
      "269:             return encodeURIComponent(str).replace(/[!'()*]/g, function (c) {",
      "",
      "[Added Lines]",
      "268:         function escapeHTML(str) {",
      "269:             var div = document.createElement('div');",
      "270:             div.appendChild(document.createTextNode(str));",
      "271:             return div.innerHTML;",
      "272:         }",
      "274:         function unescapeHTML(escapedStr) {",
      "275:             var div = document.createElement('div');",
      "276:             div.innerHTML = escapedStr;",
      "277:             var child = div.childNodes[0];",
      "278:             return child ? child.nodeValue : '';",
      "279:         }",
      "282:             return encodeURIComponent(unescapeHTML(str)).replace(/[!'()*]/g, function (c) {",
      "",
      "---------------"
    ],
    "templates/webclient/base.html||templates/webclient/base.html": [
      "File: templates/webclient/base.html -> templates/webclient/base.html",
      "--- Hunk 1 ---",
      "[Context before]",
      "219:     <script src=\"{{.StaticURL}}/js/sb-admin-2.min.js\"></script>",
      "221:     <script type=\"text/javascript\">",
      "222:         function fixedEncodeURIComponent(str) {",
      "224:                 return '%' + c.charCodeAt(0).toString(16);",
      "225:             });",
      "226:         }",
      "",
      "[Removed Lines]",
      "223:             return encodeURIComponent(str).replace(/[!'()*]/g, function (c) {",
      "",
      "[Added Lines]",
      "222:         function escapeHTML(str) {",
      "223:             var div = document.createElement('div');",
      "224:             div.appendChild(document.createTextNode(str));",
      "225:             return div.innerHTML;",
      "226:         }",
      "228:         function unescapeHTML(escapedStr) {",
      "229:             var div = document.createElement('div');",
      "230:             div.innerHTML = escapedStr;",
      "231:             var child = div.childNodes[0];",
      "232:             return child ? child.nodeValue : '';",
      "233:         }",
      "235:         function escapeHTMLForceSafe(str) {",
      "236:             return str",
      "237:                 .replace(/&/g, '_')",
      "238:                 .replace(/</g, '_')",
      "239:                 .replace(/>/g, '_')",
      "240:                 .replace(/\\\"/g, '_')",
      "241:                 .replace(/\\'/g, '_');",
      "242:         }",
      "245:             return encodeURIComponent(unescapeHTML(str)).replace(/[!'()*]/g, function (c) {",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "229:             return str.replace(/\\//g,'\\u2215');",
      "230:         }",
      "239:     </script>",
      "241:     <!-- Page level plugins -->",
      "",
      "[Removed Lines]",
      "232:         var escapeHTML = function ( t ) {",
      "233:       return t",
      "234:        .replace( /&/g, '&amp;' )",
      "235:        .replace( /</g, '&lt;' )",
      "236:        .replace( />/g, '&gt;' )",
      "237:        .replace( /\"/g, '&quot;' );",
      "238:          };",
      "",
      "[Added Lines]",
      "254:         function b64EncodeUnicode(str) {",
      "255:             return btoa(encodeURIComponent(str));",
      "256:         }",
      "258:         function UnicodeDecodeB64(str) {",
      "259:             return decodeURIComponent(atob(str));",
      "260:         }",
      "",
      "---------------"
    ],
    "templates/webclient/files.html||templates/webclient/files.html": [
      "File: templates/webclient/files.html -> templates/webclient/files.html",
      "--- Hunk 1 ---",
      "[Context before]",
      "239:         if (childReference == null || childReference.closed) {",
      "240:             childProps.set('link', fileLink);",
      "241:             childProps.set('url', url);",
      "243:             childReference = window.open(url, '_blank');",
      "244:             if (!checkerStarted){",
      "245:                 keepAlive();",
      "",
      "[Removed Lines]",
      "242:             childProps.set('file_name', fileName);",
      "",
      "[Added Lines]",
      "242:             childProps.set('file_name', UnicodeDecodeB64(fileName));",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "367:                 async function saveBlob() {",
      "368:                     var errorMessage = \"Error saving external file\";",
      "370:                     let response;",
      "371:                     try {",
      "372:                         response = await fetch(uploadPath, {",
      "",
      "[Removed Lines]",
      "369:                     var uploadPath = '{{.FileURL}}?path={{.CurrentDir}}'+encodeURIComponent(\"/\"+childProps.get('file_name'));",
      "",
      "[Added Lines]",
      "369:                     var uploadPath = '{{.FileURL}}?path={{.CurrentDir}}'+encodeURIComponent(\"/\"+unescapeHTML(childProps.get('file_name')));",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "447:     }",
      "449:     function openVideoPlayer(name, url, videoType){",
      "451:         $('#videoModal').modal('show');",
      "452:         player.src({",
      "453:             type: videoType,",
      "",
      "[Removed Lines]",
      "450:         $(\"#video_title\").text(name);",
      "",
      "[Added Lines]",
      "450:         $(\"#video_title\").text(UnicodeDecodeB64(name));",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "995:                             var title = \"\";",
      "996:                             var cssClass = \"\";",
      "997:                             var shortened = shortenData(data, 70);",
      "998:                             if (shortened != data){",
      "1000:                                 cssClass = \"ellipsis\";",
      "1001:                             }",
      "",
      "[Removed Lines]",
      "999:                                 title = escapeHTML(data);",
      "",
      "[Added Lines]",
      "998:                             data = escapeHTML(data);",
      "1000:                                 title = data;",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "1017:                 { \"data\": \"edit_url\",",
      "1018:                     \"render\": function (data, type, row) {",
      "1019:                         if (type === 'display') {",
      "1021:                             var extension = filename.slice((filename.lastIndexOf(\".\") - 1 >>> 0) + 2).toLowerCase();",
      "1022:                             if (data){",
      "1023:                                 if (extension == \"csv\" || extension == \"bat\" || CodeMirror.findModeByExtension(extension) != null){",
      "",
      "[Removed Lines]",
      "1020:                             var filename = row[\"name\"];",
      "",
      "[Added Lines]",
      "1021:                             var filename = escapeHTML(row[\"name\"]);",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "1039:                                     case \"svg\":",
      "1040:                                     case \"ico\":",
      "1041:                                         var view_url = row['url']+\"&inline=1\";",
      "1043:                                     case \"mp4\":",
      "1044:                                     case \"mov\":",
      "1046:                                     case \"webm\":",
      "1048:                                     case \"ogv\":",
      "1049:                                     case \"ogg\":",
      "1051:                                     case \"pdf\":",
      "1052:                                         if (PDFObject.supportsPDFs){",
      "1053:                                             var view_url = row['url'];",
      "",
      "[Removed Lines]",
      "1042:                                         return `<a href=\"${view_url}\" data-lightbox=\"image-gallery\" data-title=\"${filename}\"><i class=\"fas fa-eye\"></i></a>`;",
      "1045:                                         return `<a href=\"#\" onclick=\"openVideoPlayer('${row[\"name\"]}', '${row['url']}', 'video/mp4');\"><i class=\"fas fa-eye\"></i></a>`;",
      "1047:                                         return `<a href=\"#\" onclick=\"openVideoPlayer('${row[\"name\"]}', '${row['url']}', 'video/webm');\"><i class=\"fas fa-eye\"></i></a>`;",
      "1050:                                         return `<a href=\"#\" onclick=\"openVideoPlayer('${row[\"name\"]}', '${row['url']}', 'video/ogg');\"><i class=\"fas fa-eye\"></i></a>`;",
      "",
      "[Added Lines]",
      "1043:                                         var title = escapeHTMLForceSafe(row[\"name\"])",
      "1044:                                         return `<a href=\"${view_url}\" data-lightbox=\"image-gallery\" data-title=\"${title}\"><i class=\"fas fa-eye\"></i></a>`;",
      "1047:                                         var name = b64EncodeUnicode(row[\"name\"]);",
      "1048:                                         return `<a href=\"#\" onclick=\"openVideoPlayer('${name}', '${row['url']}', 'video/mp4');\"><i class=\"fas fa-eye\"></i></a>`;",
      "1050:                                         var name = b64EncodeUnicode(row[\"name\"]);",
      "1051:                                         return `<a href=\"#\" onclick=\"openVideoPlayer('${name}', '${row['url']}', 'video/webm');\"><i class=\"fas fa-eye\"></i></a>`;",
      "1054:                                         var name = b64EncodeUnicode(row[\"name\"]);",
      "1055:                                         return `<a href=\"#\" onclick=\"openVideoPlayer('${name}}', '${row['url']}', 'video/ogg');\"><i class=\"fas fa-eye\"></i></a>`;",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "1065:                         {{if .HasIntegrations}}",
      "1066:                         if (type === 'display') {",
      "1067:                             if (data){",
      "1069:                             }",
      "1070:                         }",
      "1071:                         {{end}}",
      "",
      "[Removed Lines]",
      "1068:                                 return `<a href=\"#\" onclick=\"openExternalURL('${data}', '${row[\"ext_link\"]}', '${row[\"name\"]}');\"><i class=\"fas fa-external-link-alt\"></i></a>`;",
      "",
      "[Added Lines]",
      "1073:                                 var name = b64EncodeUnicode(escapeHTML(row[\"name\"]));",
      "1074:                                 return `<a href=\"#\" onclick=\"openExternalURL('${data}', '${row[\"ext_link\"]}', '${name}');\"><i class=\"fas fa-external-link-alt\"></i></a>`;",
      "",
      "---------------"
    ],
    "templates/webclient/sharefiles.html||templates/webclient/sharefiles.html": [
      "File: templates/webclient/sharefiles.html -> templates/webclient/sharefiles.html",
      "--- Hunk 1 ---",
      "[Context before]",
      "94: <script src=\"{{.StaticURL}}/vendor/datatables/dataTables.responsive.min.js\"></script>",
      "95: <script src=\"{{.StaticURL}}/vendor/datatables/responsive.bootstrap4.min.js\"></script>",
      "96: <script type=\"text/javascript\">",
      "106:     function shortenData(d, cutoff) {",
      "107:         if ( typeof d !== 'string' ) {",
      "108:    return d;",
      "109:   }",
      "111:   if ( d.length <= cutoff ) {",
      "113:   }",
      "115:         var shortened = d.substr(0, cutoff-1);",
      "117:     }",
      "119:     function getIconForFile(filename) {",
      "",
      "[Removed Lines]",
      "98:     var escapeHTML = function ( t ) {",
      "99:   return t",
      "100:    .replace( /&/g, '&amp;' )",
      "101:    .replace( /</g, '&lt;' )",
      "102:    .replace( />/g, '&gt;' )",
      "103:    .replace( /\"/g, '&quot;' );",
      "104:  };",
      "112:    return d;",
      "116:         return shortened+'&#8230;';",
      "",
      "[Added Lines]",
      "103:    return escapeHTML(d);",
      "107:         return escapeHTML(shortened)+'&#8230;';",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "250:                     let response;",
      "251:                     try {",
      "252:                         var f = files[index];",
      "254:                         var lastModified;",
      "255:                         try {",
      "256:                             lastModified = f.lastModified;",
      "",
      "[Removed Lines]",
      "253:                         var uploadPath = '{{.UploadBaseURL}}'+fixedEncodeURIComponent(\"/\"+f.name);",
      "",
      "[Added Lines]",
      "244:                         var uploadPath = '{{.UploadBaseURL}}'+fixedEncodeURIComponent(\"/\"+escapeHTML(f.name));",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "384:                             var title = \"\";",
      "385:                             var cssClass = \"\";",
      "386:                             var shortened = shortenData(data, 70);",
      "387:                             if (shortened != data){",
      "388:                                 title = escapeHTML(data);",
      "389:                                 cssClass = \"ellipsis\";",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "378:                             data = escapeHTML(data);",
      "",
      "---------------"
    ],
    "templates/webclient/shareupload.html||templates/webclient/shareupload.html": [
      "File: templates/webclient/shareupload.html -> templates/webclient/shareupload.html",
      "--- Hunk 1 ---",
      "[Context before]",
      "99:                     let response;",
      "100:                     try {",
      "101:                         var f = files[index];",
      "103:                         var lastModified;",
      "104:                         try {",
      "105:                             lastModified = f.lastModified;",
      "",
      "[Removed Lines]",
      "102:                         var uploadPath = '{{.UploadBasePath}}/'+fixedEncodeURIComponent(f.name);",
      "",
      "[Added Lines]",
      "102:                         var uploadPath = '{{.UploadBasePath}}/'+fixedEncodeURIComponent(escapeHTML(f.name));",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "3f3591bae0a458f4c66fccb9f239a2e32bba442d",
      "candidate_info": {
        "commit_hash": "3f3591bae0a458f4c66fccb9f239a2e32bba442d",
        "repo": "drakkan/sftpgo",
        "commit_url": "https://github.com/drakkan/sftpgo/commit/3f3591bae0a458f4c66fccb9f239a2e32bba442d",
        "files": [
          "httpd/api_http_user.go",
          "httpd/api_utils.go",
          "httpd/httpd.go",
          "httpd/httpd_test.go",
          "httpd/server.go",
          "httpd/webclient.go",
          "openapi/openapi.yaml",
          "static/vendor/codemirror/addon/search/searchcursor.js",
          "static/vendor/codemirror/codemirror.css",
          "static/vendor/codemirror/codemirror.js",
          "static/vendor/lightbox2/css/lightbox.min.css",
          "static/vendor/lightbox2/images/close.png",
          "static/vendor/lightbox2/images/loading.gif",
          "static/vendor/lightbox2/images/next.png",
          "static/vendor/lightbox2/images/prev.png",
          "static/vendor/lightbox2/js/lightbox.min.js",
          "static/vendor/pdfobject/pdfobject.min.js",
          "templates/webclient/editfile.html",
          "templates/webclient/files.html",
          "templates/webclient/viewpdf.html"
        ],
        "message": "web client: allow to preview images and pdf\n\npdf depends on browser support. It does not work on mobile devices.",
        "before_after_code_files": [
          "httpd/api_http_user.go||httpd/api_http_user.go",
          "httpd/api_utils.go||httpd/api_utils.go",
          "httpd/httpd.go||httpd/httpd.go",
          "httpd/httpd_test.go||httpd/httpd_test.go",
          "httpd/server.go||httpd/server.go",
          "httpd/webclient.go||httpd/webclient.go",
          "static/vendor/codemirror/addon/search/searchcursor.js||static/vendor/codemirror/addon/search/searchcursor.js",
          "static/vendor/codemirror/codemirror.css||static/vendor/codemirror/codemirror.css",
          "static/vendor/codemirror/codemirror.js||static/vendor/codemirror/codemirror.js",
          "static/vendor/lightbox2/css/lightbox.min.css||static/vendor/lightbox2/css/lightbox.min.css",
          "static/vendor/lightbox2/js/lightbox.min.js||static/vendor/lightbox2/js/lightbox.min.js",
          "static/vendor/pdfobject/pdfobject.min.js||static/vendor/pdfobject/pdfobject.min.js",
          "templates/webclient/editfile.html||templates/webclient/editfile.html",
          "templates/webclient/files.html||templates/webclient/files.html",
          "templates/webclient/viewpdf.html||templates/webclient/viewpdf.html"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "templates/webclient/files.html||templates/webclient/files.html"
          ],
          "candidate": [
            "templates/webclient/files.html||templates/webclient/files.html"
          ]
        }
      },
      "candidate_diff": {
        "httpd/api_http_user.go||httpd/api_http_user.go": [
          "File: httpd/api_http_user.go -> httpd/api_http_user.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "155:   return",
          "156:  }",
          "159:   resp := apiResponse{",
          "160:    Error:   err.Error(),",
          "161:    Message: http.StatusText(status),",
          "",
          "[Removed Lines]",
          "158:  if status, err := downloadFile(w, r, connection, name, info); err != nil {",
          "",
          "[Added Lines]",
          "158:  inline := r.URL.Query().Get(\"inline\") != \"\"",
          "159:  if status, err := downloadFile(w, r, connection, name, info, inline); err != nil {",
          "",
          "---------------"
        ],
        "httpd/api_utils.go||httpd/api_utils.go": [
          "File: httpd/api_utils.go -> httpd/api_utils.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "257:  return strings.TrimPrefix(entryPath, \"/\")",
          "258: }",
          "261:  var err error",
          "262:  rangeHeader := r.Header.Get(\"Range\")",
          "263:  if rangeHeader != \"\" && checkIfRange(r, info.ModTime()) == condFalse {",
          "",
          "[Removed Lines]",
          "260: func downloadFile(w http.ResponseWriter, r *http.Request, connection *Connection, name string, info os.FileInfo) (int, error) {",
          "",
          "[Added Lines]",
          "260: func downloadFile(w http.ResponseWriter, r *http.Request, connection *Connection, name string,",
          "261:  info os.FileInfo, inline bool,",
          "262: ) (int, error) {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "295:  }",
          "296:  w.Header().Set(\"Content-Length\", strconv.FormatInt(size, 10))",
          "297:  w.Header().Set(\"Content-Type\", ctype)",
          "299:  w.Header().Set(\"Accept-Ranges\", \"bytes\")",
          "300:  w.WriteHeader(responseStatus)",
          "301:  if r.Method != http.MethodHead {",
          "",
          "[Removed Lines]",
          "298:  w.Header().Set(\"Content-Disposition\", fmt.Sprintf(\"attachment; filename=%#v\", path.Base(name)))",
          "",
          "[Added Lines]",
          "300:  if !inline {",
          "301:   w.Header().Set(\"Content-Disposition\", fmt.Sprintf(\"attachment; filename=%#v\", path.Base(name)))",
          "302:  }",
          "",
          "---------------"
        ],
        "httpd/httpd.go||httpd/httpd.go": [
          "File: httpd/httpd.go -> httpd/httpd.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "136:  webClientPubSharesPathDefault         = \"/web/client/pubshares\"",
          "137:  webClientForgotPwdPathDefault         = \"/web/client/forgot-password\"",
          "138:  webClientResetPwdPathDefault          = \"/web/client/reset-password\"",
          "139:  webStaticFilesPathDefault             = \"/static\"",
          "140:  webOpenAPIPathDefault                 = \"/openapi\"",
          "142:  MaxRestoreSize       = 10485760 // 10 MB",
          "143:  maxRequestSize       = 1048576  // 1MB",
          "144:  maxLoginBodySize     = 262144   // 256 KB",
          "146:  maxMultipartMem      = 8388608  // 8MB",
          "147:  osWindows            = \"windows\"",
          "148:  otpHeaderCode        = \"X-SFTPGO-OTP\"",
          "",
          "[Removed Lines]",
          "145:  httpdMaxEditFileSize = 524288   // 512 KB",
          "",
          "[Added Lines]",
          "139:  webClientViewPDFPathDefault           = \"/web/client/viewpdf\"",
          "146:  httpdMaxEditFileSize = 1048576  // 1 MB",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "210:  webClientLogoutPath            string",
          "211:  webClientForgotPwdPath         string",
          "212:  webClientResetPwdPath          string",
          "213:  webStaticFilesPath             string",
          "214:  webOpenAPIPath                 string",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "214:  webClientViewPDFPath           string",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "570:  webClientRecoveryCodesPath = path.Join(baseURL, webClientRecoveryCodesPathDefault)",
          "571:  webClientForgotPwdPath = path.Join(baseURL, webClientForgotPwdPathDefault)",
          "572:  webClientResetPwdPath = path.Join(baseURL, webClientResetPwdPathDefault)",
          "573: }",
          "575: func updateWebAdminURLs(baseURL string) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "575:  webClientViewPDFPath = path.Join(baseURL, webClientViewPDFPathDefault)",
          "",
          "---------------"
        ],
        "httpd/httpd_test.go||httpd/httpd_test.go": [
          "File: httpd/httpd_test.go -> httpd/httpd_test.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "153:  webClientPubSharesPath          = \"/web/client/pubshares\"",
          "154:  webClientForgotPwdPath          = \"/web/client/forgot-password\"",
          "155:  webClientResetPwdPath           = \"/web/client/reset-password\"",
          "156:  httpBaseURL                     = \"http://127.0.0.1:8081\"",
          "157:  sftpServerAddr                  = \"127.0.0.1:8022\"",
          "158:  smtpServerAddr                  = \"127.0.0.1:3525\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "156:  webClientViewPDFPath            = \"/web/client/viewpdf\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "9320:  assert.NoError(t, err)",
          "9321: }",
          "9323: func TestWebEditFile(t *testing.T) {",
          "9324:  user, _, err := httpdtest.AddUser(getTestUser(), http.StatusCreated)",
          "9325:  assert.NoError(t, err)",
          "9326:  testFile1 := \"testfile1.txt\"",
          "9327:  testFile2 := \"testfile2\"",
          "9328:  file1Size := int64(65536)",
          "9330:  err = createTestFile(filepath.Join(user.GetHomeDir(), testFile1), file1Size)",
          "9331:  assert.NoError(t, err)",
          "9332:  err = createTestFile(filepath.Join(user.GetHomeDir(), testFile2), file2Size)",
          "",
          "[Removed Lines]",
          "9329:  file2Size := int64(655360)",
          "",
          "[Added Lines]",
          "9324: func TestWebClientViewPDF(t *testing.T) {",
          "9325:  user, _, err := httpdtest.AddUser(getTestUser(), http.StatusCreated)",
          "9326:  assert.NoError(t, err)",
          "9328:  webToken, err := getJWTWebClientTokenFromTestServer(defaultUsername, defaultPassword)",
          "9329:  assert.NoError(t, err)",
          "9331:  req, err := http.NewRequest(http.MethodGet, webClientViewPDFPath, nil)",
          "9332:  assert.NoError(t, err)",
          "9333:  setJWTCookieForReq(req, webToken)",
          "9334:  rr := executeRequest(req)",
          "9335:  checkResponseCode(t, http.StatusBadRequest, rr)",
          "9337:  req, err = http.NewRequest(http.MethodGet, webClientViewPDFPath+\"?path=test.pdf\", nil)",
          "9338:  assert.NoError(t, err)",
          "9339:  setJWTCookieForReq(req, webToken)",
          "9340:  rr = executeRequest(req)",
          "9341:  checkResponseCode(t, http.StatusOK, rr)",
          "9343:  _, err = httpdtest.RemoveUser(user, http.StatusOK)",
          "9344:  assert.NoError(t, err)",
          "9345:  err = os.RemoveAll(user.GetHomeDir())",
          "9346:  assert.NoError(t, err)",
          "9347: }",
          "9355:  file2Size := int64(1048576 * 2)",
          "",
          "---------------"
        ],
        "httpd/server.go||httpd/server.go": [
          "File: httpd/server.go -> httpd/server.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "1224:    router.Get(webClientLogoutPath, handleWebClientLogout)",
          "1225:    router.With(s.refreshCookie).Get(webClientFilesPath, handleClientGetFiles)",
          "1226:    router.With(checkHTTPUserPerm(sdk.WebClientWriteDisabled), verifyCSRFHeader).",
          "1227:     Post(webClientFilesPath, uploadUserFiles)",
          "1230:    router.With(checkHTTPUserPerm(sdk.WebClientWriteDisabled), verifyCSRFHeader).",
          "1231:     Patch(webClientFilesPath, renameUserFile)",
          "1232:    router.With(checkHTTPUserPerm(sdk.WebClientWriteDisabled), verifyCSRFHeader).",
          "",
          "[Removed Lines]",
          "1228:    router.With(checkHTTPUserPerm(sdk.WebClientWriteDisabled), s.refreshCookie).",
          "1229:     Get(webClientEditFilePath, handleClientEditFile)",
          "",
          "[Added Lines]",
          "1226:    router.With(s.refreshCookie).Get(webClientViewPDFPath, handleClientViewPDF)",
          "1229:    router.With(s.refreshCookie).Get(webClientEditFilePath, handleClientEditFile)",
          "",
          "---------------"
        ],
        "httpd/webclient.go||httpd/webclient.go": [
          "File: httpd/webclient.go -> httpd/webclient.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "44:  templateClientEditFile          = \"editfile.html\"",
          "45:  templateClientShare             = \"share.html\"",
          "46:  templateClientShares            = \"shares.html\"",
          "47:  pageClientFilesTitle            = \"My Files\"",
          "48:  pageClientSharesTitle           = \"Shares\"",
          "49:  pageClientProfileTitle          = \"My Profile\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "47:  templateClientViewPDF           = \"viewpdf.html\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "99:  Href    string",
          "100: }",
          "102: type editFilePage struct {",
          "103:  baseClientPage",
          "104:  CurrentDir string",
          "105:  Path       string",
          "106:  Name       string",
          "107:  Data       string",
          "108: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "103: type viewPDFPage struct {",
          "104:  Title     string",
          "105:  URL       string",
          "106:  StaticURL string",
          "107: }",
          "114:  ReadOnly   bool",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "112:  CurrentDir    string",
          "113:  DirsURL       string",
          "114:  DownloadURL   string",
          "115:  CanAddFiles   bool",
          "116:  CanCreateDirs bool",
          "117:  CanRename     bool",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "123:  ViewPDFURL    string",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "229:  resetPwdPaths := []string{",
          "230:   filepath.Join(templatesPath, templateCommonDir, templateResetPassword),",
          "231:  }",
          "233:  filesTmpl := util.LoadTemplate(nil, filesPaths...)",
          "234:  profileTmpl := util.LoadTemplate(nil, profilePaths...)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "241:  viewPDFPaths := []string{",
          "242:   filepath.Join(templatesPath, templateClientDir, templateClientViewPDF),",
          "243:  }",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "243:  shareTmpl := util.LoadTemplate(nil, sharePaths...)",
          "244:  forgotPwdTmpl := util.LoadTemplate(nil, forgotPwdPaths...)",
          "245:  resetPwdTmpl := util.LoadTemplate(nil, resetPwdPaths...)",
          "247:  clientTemplates[templateClientFiles] = filesTmpl",
          "248:  clientTemplates[templateClientProfile] = profileTmpl",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "258:  viewPDFTmpl := util.LoadTemplate(nil, viewPDFPaths...)",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "257:  clientTemplates[templateClientShare] = shareTmpl",
          "258:  clientTemplates[templateForgotPassword] = forgotPwdTmpl",
          "259:  clientTemplates[templateResetPassword] = resetPwdTmpl",
          "260: }",
          "262: func getBaseClientPageData(title, currentURL string, r *http.Request) baseClientPage {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "273:  clientTemplates[templateClientViewPDF] = viewPDFTmpl",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "391:  renderClientTemplate(w, templateClientMFA, data)",
          "392: }",
          "395:  data := editFilePage{",
          "396:   baseClientPage: getBaseClientPageData(pageClientEditFileTitle, webClientEditFilePath, r),",
          "397:   Path:           fileName,",
          "398:   Name:           path.Base(fileName),",
          "399:   CurrentDir:     path.Dir(fileName),",
          "400:   Data:           fileData,",
          "401:  }",
          "",
          "[Removed Lines]",
          "394: func renderEditFilePage(w http.ResponseWriter, r *http.Request, fileName, fileData string) {",
          "",
          "[Added Lines]",
          "408: func renderEditFilePage(w http.ResponseWriter, r *http.Request, fileName, fileData string, readOnly bool) {",
          "414:   ReadOnly:       readOnly,",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "427:   Error:          error,",
          "428:   CurrentDir:     url.QueryEscape(dirName),",
          "429:   DownloadURL:    webClientDownloadZipPath,",
          "430:   DirsURL:        webClientDirsPath,",
          "431:   CanAddFiles:    user.CanAddFilesFromWeb(dirName),",
          "432:   CanCreateDirs:  user.CanAddDirsFromWeb(dirName),",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "445:   ViewPDFURL:     webClientViewPDFPath,",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "650:   renderFilesPage(w, r, name, \"\", user)",
          "651:   return",
          "652:  }",
          "654:   if status > 0 {",
          "655:    if status == http.StatusRequestedRangeNotSatisfiable {",
          "656:     renderClientMessagePage(w, r, http.StatusText(status), \"\", status, err, \"\")",
          "",
          "[Removed Lines]",
          "653:  if status, err := downloadFile(w, r, connection, name, info); err != nil && status != 0 {",
          "",
          "[Added Lines]",
          "669:  inline := r.URL.Query().Get(\"inline\") != \"\"",
          "670:  if status, err := downloadFile(w, r, connection, name, info, inline); err != nil && status != 0 {",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "723:   return",
          "724:  }",
          "727: }",
          "729: func handleClientAddShareGet(w http.ResponseWriter, r *http.Request) {",
          "",
          "[Removed Lines]",
          "726:  renderEditFilePage(w, r, name, b.String())",
          "",
          "[Added Lines]",
          "743:  renderEditFilePage(w, r, name, b.String(), util.IsStringInSlice(sdk.WebClientWriteDisabled, user.Filters.WebClient))",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "1035:  }",
          "1036:  renderClientResetPwdPage(w, \"\")",
          "1037: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1056: func handleClientViewPDF(w http.ResponseWriter, r *http.Request) {",
          "1057:  r.Body = http.MaxBytesReader(w, r.Body, maxLoginBodySize)",
          "1058:  name := r.URL.Query().Get(\"path\")",
          "1059:  if name == \"\" {",
          "1060:   renderClientBadRequestPage(w, r, errors.New(\"no file specified\"))",
          "1061:   return",
          "1062:  }",
          "1063:  name = util.CleanPath(name)",
          "1064:  data := viewPDFPage{",
          "1065:   Title:     path.Base(name),",
          "1066:   URL:       fmt.Sprintf(\"%v?path=%v&inline=1\", webClientFilesPath, url.QueryEscape(name)),",
          "1067:   StaticURL: webStaticFilesPath,",
          "1068:  }",
          "1069:  renderClientTemplate(w, templateClientViewPDF, data)",
          "1070: }",
          "",
          "---------------"
        ],
        "static/vendor/codemirror/addon/search/searchcursor.js||static/vendor/codemirror/addon/search/searchcursor.js": [
          "File: static/vendor/codemirror/addon/search/searchcursor.js -> static/vendor/codemirror/addon/search/searchcursor.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "203:   function SearchCursor(doc, query, pos, options) {",
          "204:     this.atOccurrence = false",
          "205:     this.doc = doc",
          "206:     pos = pos ? doc.clipPos(pos) : Pos(0, 0)",
          "207:     this.pos = {from: pos, to: pos}",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "205:     this.afterEmptyMatch = false",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "237:     findPrevious: function() {return this.find(true)},",
          "239:     find: function(reverse) {",
          "245:         if (reverse) {",
          "249:         } else {",
          "253:         }",
          "254:       }",
          "256:       if (result) {",
          "257:         this.pos = result",
          "",
          "[Removed Lines]",
          "240:       var result = this.matches(reverse, this.doc.clipPos(reverse ? this.pos.from : this.pos.to))",
          "244:       while (result && CodeMirror.cmpPos(result.from, result.to) == 0) {",
          "246:           if (result.from.ch) result.from = Pos(result.from.line, result.from.ch - 1)",
          "247:           else if (result.from.line == this.doc.firstLine()) result = null",
          "248:           else result = this.matches(reverse, this.doc.clipPos(Pos(result.from.line - 1)))",
          "250:           if (result.to.ch < this.doc.getLine(result.to.line).length) result.to = Pos(result.to.line, result.to.ch + 1)",
          "251:           else if (result.to.line == this.doc.lastLine()) result = null",
          "252:           else result = this.matches(reverse, Pos(result.to.line + 1, 0))",
          "",
          "[Added Lines]",
          "241:       var head = this.doc.clipPos(reverse ? this.pos.from : this.pos.to);",
          "242:       if (this.afterEmptyMatch && this.atOccurrence) {",
          "244:         head = Pos(head.line, head.ch)",
          "246:           head.ch--;",
          "247:           if (head.ch < 0) {",
          "248:             head.line--;",
          "249:             head.ch = (this.doc.getLine(head.line) || \"\").length;",
          "250:           }",
          "252:           head.ch++;",
          "253:           if (head.ch > (this.doc.getLine(head.line) || \"\").length) {",
          "254:             head.ch = 0;",
          "255:             head.line++;",
          "256:           }",
          "257:         }",
          "258:         if (CodeMirror.cmpPos(head, this.doc.clipPos(head)) != 0) {",
          "259:            return this.atOccurrence = false",
          "262:       var result = this.matches(reverse, head)",
          "263:       this.afterEmptyMatch = result && CodeMirror.cmpPos(result.from, result.to) == 0",
          "",
          "---------------"
        ],
        "static/vendor/codemirror/codemirror.css||static/vendor/codemirror/codemirror.css": [
          "File: static/vendor/codemirror/codemirror.css -> static/vendor/codemirror/codemirror.css",
          "--- Hunk 1 ---",
          "[Context before]",
          "60: .cm-fat-cursor div.CodeMirror-cursors {",
          "61:   z-index: 1;",
          "62: }",
          "76: @-moz-keyframes blink {",
          "77:   0% {}",
          "78:   50% { background-color: transparent; }",
          "",
          "[Removed Lines]",
          "63: .cm-fat-cursor-mark {",
          "64:   background-color: rgba(20, 255, 20, 0.5);",
          "65:   -webkit-animation: blink 1.06s steps(1) infinite;",
          "66:   -moz-animation: blink 1.06s steps(1) infinite;",
          "67:   animation: blink 1.06s steps(1) infinite;",
          "68: }",
          "69: .cm-animate-fat-cursor {",
          "70:   width: auto;",
          "71:   -webkit-animation: blink 1.06s steps(1) infinite;",
          "72:   -moz-animation: blink 1.06s steps(1) infinite;",
          "73:   animation: blink 1.06s steps(1) infinite;",
          "74:   background-color: #7e7;",
          "75: }",
          "",
          "[Added Lines]",
          "63: .cm-fat-cursor .CodeMirror-line::selection,",
          "64: .cm-fat-cursor .CodeMirror-line > span::selection,",
          "65: .cm-fat-cursor .CodeMirror-line > span > span::selection { background: transparent; }",
          "66: .cm-fat-cursor .CodeMirror-line::-moz-selection,",
          "67: .cm-fat-cursor .CodeMirror-line > span::-moz-selection,",
          "68: .cm-fat-cursor .CodeMirror-line > span > span::-moz-selection { background: transparent; }",
          "69: .cm-fat-cursor { caret-color: transparent; }",
          "",
          "---------------"
        ],
        "static/vendor/codemirror/codemirror.js||static/vendor/codemirror/codemirror.js": [
          "File: static/vendor/codemirror/codemirror.js -> static/vendor/codemirror/codemirror.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "2351:   function mapFromLineView(lineView, line, lineN) {",
          "2352:     if (lineView.line == line)",
          "2353:       { return {map: lineView.measure.map, cache: lineView.measure.cache} }",
          "2360:   }",
          "",
          "[Removed Lines]",
          "2354:     for (var i = 0; i < lineView.rest.length; i++)",
          "2355:       { if (lineView.rest[i] == line)",
          "2356:         { return {map: lineView.measure.maps[i], cache: lineView.measure.caches[i]} } }",
          "2357:     for (var i$1 = 0; i$1 < lineView.rest.length; i$1++)",
          "2358:       { if (lineNo(lineView.rest[i$1]) > lineN)",
          "2359:         { return {map: lineView.measure.maps[i$1], cache: lineView.measure.caches[i$1], before: true} } }",
          "",
          "[Added Lines]",
          "2354:     if (lineView.rest) {",
          "2355:       for (var i = 0; i < lineView.rest.length; i++)",
          "2356:         { if (lineView.rest[i] == line)",
          "2357:           { return {map: lineView.measure.maps[i], cache: lineView.measure.caches[i]} } }",
          "2358:       for (var i$1 = 0; i$1 < lineView.rest.length; i$1++)",
          "2359:         { if (lineNo(lineView.rest[i$1]) > lineN)",
          "2360:           { return {map: lineView.measure.maps[i$1], cache: lineView.measure.caches[i$1], before: true} } }",
          "2361:     }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "3150:     var curFragment = result.cursors = document.createDocumentFragment();",
          "3151:     var selFragment = result.selection = document.createDocumentFragment();",
          "3153:     for (var i = 0; i < doc.sel.ranges.length; i++) {",
          "3154:       if (!primary && i == doc.sel.primIndex) { continue }",
          "3155:       var range = doc.sel.ranges[i];",
          "3156:       if (range.from().line >= cm.display.viewTo || range.to().line < cm.display.viewFrom) { continue }",
          "3157:       var collapsed = range.empty();",
          "3160:       if (!collapsed)",
          "3161:         { drawSelectionRange(cm, range, selFragment); }",
          "3162:     }",
          "",
          "[Removed Lines]",
          "3158:       if (collapsed || cm.options.showCursorWhenSelecting)",
          "3159:         { drawSelectionCursor(cm, range.head, curFragment); }",
          "",
          "[Added Lines]",
          "3155:     var customCursor = cm.options.$customCursor;",
          "3156:     if (customCursor) { primary = true; }",
          "3162:       if (customCursor) {",
          "3163:         var head = customCursor(cm, range);",
          "3164:         if (head) { drawSelectionCursor(cm, head, curFragment); }",
          "3165:       } else if (collapsed || cm.options.showCursorWhenSelecting) {",
          "3166:         drawSelectionCursor(cm, range.head, curFragment);",
          "3167:       }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "3175:     if (/\\bcm-fat-cursor\\b/.test(cm.getWrapperElement().className)) {",
          "3176:       var charPos = charCoords(cm, head, \"div\", null, null);",
          "3180:     }",
          "3182:     if (pos.other) {",
          "",
          "[Removed Lines]",
          "3177:       if (charPos.right - charPos.left > 0) {",
          "3178:         cursor.style.width = (charPos.right - charPos.left) + \"px\";",
          "3179:       }",
          "",
          "[Added Lines]",
          "3185:       var width = charPos.right - charPos.left;",
          "3186:       cursor.style.width = (width > 0 ? width : cm.defaultCharWidth()) + \"px\";",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "3649:       this.vert.firstChild.style.height =",
          "3650:         Math.max(0, measure.scrollHeight - measure.clientHeight + totalHeight) + \"px\";",
          "3651:     } else {",
          "3652:       this.vert.style.display = \"\";",
          "3653:       this.vert.firstChild.style.height = \"0\";",
          "3654:     }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3659:       this.vert.scrollTop = 0;",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "4501:   function onScrollWheel(cm, e) {",
          "4502:     var delta = wheelEventDelta(e), dx = delta.x, dy = delta.y;",
          "4503:     var pixelsPerUnit = wheelPixelsPerUnit;",
          "4505:       dx = e.deltaX;",
          "4506:       dy = e.deltaY;",
          "4507:       pixelsPerUnit = 1;",
          "",
          "[Removed Lines]",
          "4504:     if (event.deltaMode === 0) {",
          "",
          "[Added Lines]",
          "4512:     if (e.deltaMode === 0) {",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "8235:   }",
          "8237:   function hiddenTextarea() {",
          "8239:     var div = elt(\"div\", [te], null, \"overflow: hidden; position: relative; width: 3px; height: 0px;\");",
          "",
          "[Removed Lines]",
          "8238:     var te = elt(\"textarea\", null, null, \"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; outline: none\");",
          "",
          "[Added Lines]",
          "8246:     var te = elt(\"textarea\", null, null, \"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; min-height: 1em; outline: none\");",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "9833:   addLegacyProps(CodeMirror);",
          "9837:   return CodeMirror;",
          "",
          "[Removed Lines]",
          "9835:   CodeMirror.version = \"5.63.1\";",
          "",
          "[Added Lines]",
          "9843:   CodeMirror.version = \"5.64.0\";",
          "",
          "---------------"
        ],
        "static/vendor/lightbox2/css/lightbox.min.css||static/vendor/lightbox2/css/lightbox.min.css": [
          "File: static/vendor/lightbox2/css/lightbox.min.css -> static/vendor/lightbox2/css/lightbox.min.css",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: .lb-loader,.lightbox{text-align:center;line-height:0;position:absolute;left:0}body.lb-disable-scrolling{overflow:hidden}.lightboxOverlay{position:absolute;top:0;left:0;z-index:9999;background-color:#000;filter:alpha(Opacity=80);opacity:.8;display:none}.lightbox{width:100%;z-index:10000;font-weight:400;outline:0}.lightbox .lb-image{display:block;height:auto;max-width:inherit;max-height:none;border-radius:3px;border:4px solid #fff}.lightbox a img{border:none}.lb-outerContainer{position:relative;width:250px;height:250px;margin:0 auto;border-radius:4px;background-color:#fff}.lb-outerContainer:after{content:\"\";display:table;clear:both}.lb-loader{top:43%;height:25%;width:100%}.lb-cancel{display:block;width:32px;height:32px;margin:0 auto;background:url(../images/loading.gif) no-repeat}.lb-nav{position:absolute;top:0;left:0;height:100%;width:100%;z-index:10}.lb-container>.nav{left:0}.lb-nav a{outline:0;background-image:url(data:image/gif;base64,R0lGODlhAQABAPAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==)}.lb-next,.lb-prev{height:100%;cursor:pointer;display:block}.lb-nav a.lb-prev{width:34%;left:0;float:left;background:url(../images/prev.png) left 48% no-repeat;filter:alpha(Opacity=0);opacity:0;-webkit-transition:opacity .6s;-moz-transition:opacity .6s;-o-transition:opacity .6s;transition:opacity .6s}.lb-nav a.lb-prev:hover{filter:alpha(Opacity=100);opacity:1}.lb-nav a.lb-next{width:64%;right:0;float:right;background:url(../images/next.png) right 48% no-repeat;filter:alpha(Opacity=0);opacity:0;-webkit-transition:opacity .6s;-moz-transition:opacity .6s;-o-transition:opacity .6s;transition:opacity .6s}.lb-nav a.lb-next:hover{filter:alpha(Opacity=100);opacity:1}.lb-dataContainer{margin:0 auto;padding-top:5px;width:100%;border-bottom-left-radius:4px;border-bottom-right-radius:4px}.lb-dataContainer:after{content:\"\";display:table;clear:both}.lb-data{padding:0 4px;color:#ccc}.lb-data .lb-details{width:85%;float:left;text-align:left;line-height:1.1em}.lb-data .lb-caption{font-size:13px;font-weight:700;line-height:1em}.lb-data .lb-caption a{color:#4ae}.lb-data .lb-number{display:block;clear:left;padding-bottom:1em;font-size:12px;color:#999}.lb-data .lb-close{display:block;float:right;width:30px;height:30px;background:url(../images/close.png) top right no-repeat;text-align:right;outline:0;filter:alpha(Opacity=70);opacity:.7;-webkit-transition:opacity .2s;-moz-transition:opacity .2s;-o-transition:opacity .2s;transition:opacity .2s}.lb-data .lb-close:hover{cursor:pointer;filter:alpha(Opacity=100);opacity:1}",
          "",
          "---------------"
        ],
        "static/vendor/lightbox2/js/lightbox.min.js||static/vendor/lightbox2/js/lightbox.min.js": [
          "File: static/vendor/lightbox2/js/lightbox.min.js -> static/vendor/lightbox2/js/lightbox.min.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "14: !function(a,b){\"function\"==typeof define&&define.amd?define([\"jquery\"],b):\"object\"==typeof exports?module.exports=b(require(\"jquery\")):a.lightbox=b(a.jQuery)}(this,function(a){function b(b){this.album=[],this.currentImageIndex=void 0,this.init(),this.options=a.extend({},this.constructor.defaults),this.option(b)}return b.defaults={albumLabel:\"Image %1 of %2\",alwaysShowNavOnTouchDevices:!1,fadeDuration:600,fitImagesInViewport:!0,imageFadeDuration:600,positionFromTop:50,resizeDuration:700,showImageNumberLabel:!0,wrapAround:!1,disableScrolling:!1,sanitizeTitle:!1},b.prototype.option=function(b){a.extend(this.options,b)},b.prototype.imageCountLabel=function(a,b){return this.options.albumLabel.replace(/%1/g,a).replace(/%2/g,b)},b.prototype.init=function(){var b=this;a(document).ready(function(){b.enable(),b.build()})},b.prototype.enable=function(){var b=this;a(\"body\").on(\"click\",\"a[rel^=lightbox], area[rel^=lightbox], a[data-lightbox], area[data-lightbox]\",function(c){return b.start(a(c.currentTarget)),!1})},b.prototype.build=function(){if(!(a(\"#lightbox\").length>0)){var b=this;a('<div id=\"lightboxOverlay\" tabindex=\"-1\" class=\"lightboxOverlay\"></div><div id=\"lightbox\" tabindex=\"-1\" class=\"lightbox\"><div class=\"lb-outerContainer\"><div class=\"lb-container\"><img class=\"lb-image\" src=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==\" alt=\"\"/><div class=\"lb-nav\"><a class=\"lb-prev\" aria-label=\"Previous image\" href=\"\" ></a><a class=\"lb-next\" aria-label=\"Next image\" href=\"\" ></a></div><div class=\"lb-loader\"><a class=\"lb-cancel\"></a></div></div></div><div class=\"lb-dataContainer\"><div class=\"lb-data\"><div class=\"lb-details\"><span class=\"lb-caption\"></span><span class=\"lb-number\"></span></div><div class=\"lb-closeContainer\"><a class=\"lb-close\"></a></div></div></div></div>').appendTo(a(\"body\")),this.$lightbox=a(\"#lightbox\"),this.$overlay=a(\"#lightboxOverlay\"),this.$outerContainer=this.$lightbox.find(\".lb-outerContainer\"),this.$container=this.$lightbox.find(\".lb-container\"),this.$image=this.$lightbox.find(\".lb-image\"),this.$nav=this.$lightbox.find(\".lb-nav\"),this.containerPadding={top:parseInt(this.$container.css(\"padding-top\"),10),right:parseInt(this.$container.css(\"padding-right\"),10),bottom:parseInt(this.$container.css(\"padding-bottom\"),10),left:parseInt(this.$container.css(\"padding-left\"),10)},this.imageBorderWidth={top:parseInt(this.$image.css(\"border-top-width\"),10),right:parseInt(this.$image.css(\"border-right-width\"),10),bottom:parseInt(this.$image.css(\"border-bottom-width\"),10),left:parseInt(this.$image.css(\"border-left-width\"),10)},this.$overlay.hide().on(\"click\",function(){return b.end(),!1}),this.$lightbox.hide().on(\"click\",function(c){\"lightbox\"===a(c.target).attr(\"id\")&&b.end()}),this.$outerContainer.on(\"click\",function(c){return\"lightbox\"===a(c.target).attr(\"id\")&&b.end(),!1}),this.$lightbox.find(\".lb-prev\").on(\"click\",function(){return 0===b.currentImageIndex?b.changeImage(b.album.length-1):b.changeImage(b.currentImageIndex-1),!1}),this.$lightbox.find(\".lb-next\").on(\"click\",function(){return b.currentImageIndex===b.album.length-1?b.changeImage(0):b.changeImage(b.currentImageIndex+1),!1}),this.$nav.on(\"mousedown\",function(a){3===a.which&&(b.$nav.css(\"pointer-events\",\"none\"),b.$lightbox.one(\"contextmenu\",function(){setTimeout(function(){this.$nav.css(\"pointer-events\",\"auto\")}.bind(b),0)}))}),this.$lightbox.find(\".lb-loader, .lb-close\").on(\"click\",function(){return b.end(),!1})}},b.prototype.start=function(b){function c(a){d.album.push({alt:a.attr(\"data-alt\"),link:a.attr(\"href\"),title:a.attr(\"data-title\")||a.attr(\"title\")})}var d=this,e=a(window);e.on(\"resize\",a.proxy(this.sizeOverlay,this)),this.sizeOverlay(),this.album=[];var f,g=0,h=b.attr(\"data-lightbox\");if(h){f=a(b.prop(\"tagName\")+'[data-lightbox=\"'+h+'\"]');for(var i=0;i<f.length;i=++i)c(a(f[i])),f[i]===b[0]&&(g=i)}else if(\"lightbox\"===b.attr(\"rel\"))c(b);else{f=a(b.prop(\"tagName\")+'[rel=\"'+b.attr(\"rel\")+'\"]');for(var j=0;j<f.length;j=++j)c(a(f[j])),f[j]===b[0]&&(g=j)}var k=e.scrollTop()+this.options.positionFromTop,l=e.scrollLeft();this.$lightbox.css({top:k+\"px\",left:l+\"px\"}).fadeIn(this.options.fadeDuration),this.options.disableScrolling&&a(\"body\").addClass(\"lb-disable-scrolling\"),this.changeImage(g)},b.prototype.changeImage=function(b){var c=this,d=this.album[b].link,e=d.split(\".\").slice(-1)[0],f=this.$lightbox.find(\".lb-image\");this.disableKeyboardNav(),this.$overlay.fadeIn(this.options.fadeDuration),a(\".lb-loader\").fadeIn(\"slow\"),this.$lightbox.find(\".lb-image, .lb-nav, .lb-prev, .lb-next, .lb-dataContainer, .lb-numbers, .lb-caption\").hide(),this.$outerContainer.addClass(\"animating\");var g=new Image;g.onload=function(){var h,i,j,k,l,m;f.attr({alt:c.album[b].alt,src:d}),a(g),f.width(g.width),f.height(g.height),m=a(window).width(),l=a(window).height(),k=m-c.containerPadding.left-c.containerPadding.right-c.imageBorderWidth.left-c.imageBorderWidth.right-20,j=l-c.containerPadding.top-c.containerPadding.bottom-c.imageBorderWidth.top-c.imageBorderWidth.bottom-c.options.positionFromTop-70,\"svg\"===e&&(f.width(k),f.height(j)),c.options.fitImagesInViewport?(c.options.maxWidth&&c.options.maxWidth<k&&(k=c.options.maxWidth),c.options.maxHeight&&c.options.maxHeight<j&&(j=c.options.maxHeight)):(k=c.options.maxWidth||g.width||k,j=c.options.maxHeight||g.height||j),(g.width>k||g.height>j)&&(g.width/k>g.height/j?(i=k,h=parseInt(g.height/(g.width/i),10),f.width(i),f.height(h)):(h=j,i=parseInt(g.width/(g.height/h),10),f.width(i),f.height(h))),c.sizeContainer(f.width(),f.height())},g.src=this.album[b].link,this.currentImageIndex=b},b.prototype.sizeOverlay=function(){var b=this;setTimeout(function(){b.$overlay.width(a(document).width()).height(a(document).height())},0)},b.prototype.sizeContainer=function(a,b){function c(){d.$lightbox.find(\".lb-dataContainer\").width(g),d.$lightbox.find(\".lb-prevLink\").height(h),d.$lightbox.find(\".lb-nextLink\").height(h),d.$overlay.focus(),d.showImage()}var d=this,e=this.$outerContainer.outerWidth(),f=this.$outerContainer.outerHeight(),g=a+this.containerPadding.left+this.containerPadding.right+this.imageBorderWidth.left+this.imageBorderWidth.right,h=b+this.containerPadding.top+this.containerPadding.bottom+this.imageBorderWidth.top+this.imageBorderWidth.bottom;e!==g||f!==h?this.$outerContainer.animate({width:g,height:h},this.options.resizeDuration,\"swing\",function(){c()}):c()},b.prototype.showImage=function(){this.$lightbox.find(\".lb-loader\").stop(!0).hide(),this.$lightbox.find(\".lb-image\").fadeIn(this.options.imageFadeDuration),this.updateNav(),this.updateDetails(),this.preloadNeighboringImages(),this.enableKeyboardNav()},b.prototype.updateNav=function(){var a=!1;try{document.createEvent(\"TouchEvent\"),a=!!this.options.alwaysShowNavOnTouchDevices}catch(a){}this.$lightbox.find(\".lb-nav\").show(),this.album.length>1&&(this.options.wrapAround?(a&&this.$lightbox.find(\".lb-prev, .lb-next\").css(\"opacity\",\"1\"),this.$lightbox.find(\".lb-prev, .lb-next\").show()):(this.currentImageIndex>0&&(this.$lightbox.find(\".lb-prev\").show(),a&&this.$lightbox.find(\".lb-prev\").css(\"opacity\",\"1\")),this.currentImageIndex<this.album.length-1&&(this.$lightbox.find(\".lb-next\").show(),a&&this.$lightbox.find(\".lb-next\").css(\"opacity\",\"1\"))))},b.prototype.updateDetails=function(){var a=this;if(void 0!==this.album[this.currentImageIndex].title&&\"\"!==this.album[this.currentImageIndex].title){var b=this.$lightbox.find(\".lb-caption\");this.options.sanitizeTitle?b.text(this.album[this.currentImageIndex].title):b.html(this.album[this.currentImageIndex].title),b.fadeIn(\"fast\")}if(this.album.length>1&&this.options.showImageNumberLabel){var c=this.imageCountLabel(this.currentImageIndex+1,this.album.length);this.$lightbox.find(\".lb-number\").text(c).fadeIn(\"fast\")}else this.$lightbox.find(\".lb-number\").hide();this.$outerContainer.removeClass(\"animating\"),this.$lightbox.find(\".lb-dataContainer\").fadeIn(this.options.resizeDuration,function(){return a.sizeOverlay()})},b.prototype.preloadNeighboringImages=function(){if(this.album.length>this.currentImageIndex+1){(new Image).src=this.album[this.currentImageIndex+1].link}if(this.currentImageIndex>0){(new Image).src=this.album[this.currentImageIndex-1].link}},b.prototype.enableKeyboardNav=function(){this.$lightbox.on(\"keyup.keyboard\",a.proxy(this.keyboardAction,this)),this.$overlay.on(\"keyup.keyboard\",a.proxy(this.keyboardAction,this))},b.prototype.disableKeyboardNav=function(){this.$lightbox.off(\".keyboard\"),this.$overlay.off(\".keyboard\")},b.prototype.keyboardAction=function(a){var b=a.keyCode;27===b?(a.stopPropagation(),this.end()):37===b?0!==this.currentImageIndex?this.changeImage(this.currentImageIndex-1):this.options.wrapAround&&this.album.length>1&&this.changeImage(this.album.length-1):39===b&&(this.currentImageIndex!==this.album.length-1?this.changeImage(this.currentImageIndex+1):this.options.wrapAround&&this.album.length>1&&this.changeImage(0))},b.prototype.end=function(){this.disableKeyboardNav(),a(window).off(\"resize\",this.sizeOverlay),this.$lightbox.fadeOut(this.options.fadeDuration),this.$overlay.fadeOut(this.options.fadeDuration),this.options.disableScrolling&&a(\"body\").removeClass(\"lb-disable-scrolling\")},new b});",
          "",
          "---------------"
        ],
        "static/vendor/pdfobject/pdfobject.min.js||static/vendor/pdfobject/pdfobject.min.js": [
          "File: static/vendor/pdfobject/pdfobject.min.js -> static/vendor/pdfobject/pdfobject.min.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "9: !function(root,factory){\"function\"==typeof define&&define.amd?define([],factory):\"object\"==typeof module&&module.exports?module.exports=factory():root.PDFObject=factory()}(this,function(){\"use strict\";if(\"undefined\"==typeof window||void 0===window.navigator||void 0===window.navigator.userAgent||void 0===window.navigator.mimeTypes)return!1;let nav=window.navigator,ua=window.navigator.userAgent,isIE=\"ActiveXObject\"in window,isModernBrowser=void 0!==window.Promise,supportsPdfMimeType=void 0!==nav.mimeTypes[\"application/pdf\"],isMobileDevice=void 0!==nav.platform&&\"MacIntel\"===nav.platform&&void 0!==nav.maxTouchPoints&&nav.maxTouchPoints>1||/Mobi|Tablet|Android|iPad|iPhone/.test(ua),isSafariDesktop=!isMobileDevice&&void 0!==nav.vendor&&/Apple/.test(nav.vendor)&&/Safari/.test(ua),isFirefoxWithPDFJS=!!(!isMobileDevice&&/irefox/.test(ua)&&ua.split(\"rv:\").length>1)&&parseInt(ua.split(\"rv:\")[1].split(\".\")[0],10)>18,createAXO=function(type){var ax;try{ax=new ActiveXObject(type)}catch(e){ax=null}return ax},supportsPDFs=!isMobileDevice&&(isModernBrowser||isFirefoxWithPDFJS||supportsPdfMimeType||isIE&&!(!createAXO(\"AcroPDF.PDF\")&&!createAXO(\"PDF.PdfCtrl\"))),embedError=function(msg,suppressConsole){return suppressConsole||console.log(\"[PDFObject] \"+msg),!1},emptyNodeContents=function(node){for(;node.firstChild;)node.removeChild(node.firstChild)},generatePDFJSMarkup=function(targetNode,url,pdfOpenFragment,PDFJS_URL,id,title,omitInlineStyles){emptyNodeContents(targetNode);let fullURL=PDFJS_URL+\"?file=\"+encodeURIComponent(url)+pdfOpenFragment,div=document.createElement(\"div\"),iframe=document.createElement(\"iframe\");return iframe.src=fullURL,iframe.className=\"pdfobject\",iframe.type=\"application/pdf\",iframe.frameborder=\"0\",iframe.allow=\"fullscreen\",iframe.title=title,id&&(iframe.id=id),omitInlineStyles||(div.style.cssText=\"position: absolute; top: 0; right: 0; bottom: 0; left: 0;\",iframe.style.cssText=\"border: none; width: 100%; height: 100%;\",targetNode.style.position=\"relative\",targetNode.style.overflow=\"auto\"),div.appendChild(iframe),targetNode.appendChild(div),targetNode.classList.add(\"pdfobject-container\"),targetNode.getElementsByTagName(\"iframe\")[0]},embed=function(url,targetSelector,options){let selector=targetSelector||!1,opt=options||{},id=\"string\"==typeof opt.id?opt.id:\"\",page=opt.page||!1,pdfOpenParams=opt.pdfOpenParams||{},fallbackLink=opt.fallbackLink||!0,width=opt.width||\"100%\",height=opt.height||\"100%\",title=opt.title||\"Embedded PDF\",assumptionMode=\"boolean\"!=typeof opt.assumptionMode||opt.assumptionMode,forcePDFJS=\"boolean\"==typeof opt.forcePDFJS&&opt.forcePDFJS,supportRedirect=\"boolean\"==typeof opt.supportRedirect&&opt.supportRedirect,omitInlineStyles=\"boolean\"==typeof opt.omitInlineStyles&&opt.omitInlineStyles,suppressConsole=\"boolean\"==typeof opt.suppressConsole&&opt.suppressConsole,forceIframe=\"boolean\"==typeof opt.forceIframe&&opt.forceIframe,PDFJS_URL=opt.PDFJS_URL||!1,targetNode=function(targetSelector){let targetNode=document.body;return\"string\"==typeof targetSelector?targetNode=document.querySelector(targetSelector):void 0!==window.jQuery&&targetSelector instanceof jQuery&&targetSelector.length?targetNode=targetSelector.get(0):void 0!==targetSelector.nodeType&&1===targetSelector.nodeType&&(targetNode=targetSelector),targetNode}(selector),fallbackHTML=\"\",pdfOpenFragment=\"\";if(\"string\"!=typeof url)return embedError(\"URL is not valid\",suppressConsole);if(!targetNode)return embedError(\"Target element cannot be determined\",suppressConsole);if(page&&(pdfOpenParams.page=page),pdfOpenFragment=function(pdfParams){let prop,string=\"\";if(pdfParams){for(prop in pdfParams)pdfParams.hasOwnProperty(prop)&&(string+=encodeURIComponent(prop)+\"=\"+encodeURIComponent(pdfParams[prop])+\"&\");string&&(string=(string=\"#\"+string).slice(0,string.length-1))}return string}(pdfOpenParams),forcePDFJS&&PDFJS_URL)return generatePDFJSMarkup(targetNode,url,pdfOpenFragment,PDFJS_URL,id,title,omitInlineStyles);if(supportsPDFs||assumptionMode&&!isMobileDevice){return function(embedType,targetNode,targetSelector,url,pdfOpenFragment,width,height,id,title,omitInlineStyles){emptyNodeContents(targetNode);let embed=document.createElement(embedType);if(embed.src=url+pdfOpenFragment,embed.className=\"pdfobject\",embed.type=\"application/pdf\",embed.title=title,id&&(embed.id=id),\"iframe\"===embedType&&(embed.allow=\"fullscreen\"),!omitInlineStyles){let style=\"embed\"===embedType?\"overflow: auto;\":\"border: none;\";targetSelector&&targetSelector!==document.body?style+=\"width: \"+width+\"; height: \"+height+\";\":style+=\"position: absolute; top: 0; right: 0; bottom: 0; left: 0; width: 100%; height: 100%;\",embed.style.cssText=style}return targetNode.classList.add(\"pdfobject-container\"),targetNode.appendChild(embed),targetNode.getElementsByTagName(embedType)[0]}(forceIframe||supportRedirect||isSafariDesktop?\"iframe\":\"embed\",targetNode,targetSelector,url,pdfOpenFragment,width,height,id,title,omitInlineStyles)}return PDFJS_URL?generatePDFJSMarkup(targetNode,url,pdfOpenFragment,PDFJS_URL,id,title,omitInlineStyles):(fallbackLink&&(fallbackHTML=\"string\"==typeof fallbackLink?fallbackLink:\"<p>This browser does not support inline PDFs. Please download the PDF to view it: <a href='[url]'>Download PDF</a></p>\",targetNode.innerHTML=fallbackHTML.replace(/\\[url\\]/g,url)),embedError(\"This browser does not support embedded PDFs\",suppressConsole))};return{embed:function(a,b,c){return embed(a,b,c)},pdfobjectversion:\"2.2.7\",supportsPDFs:supportsPDFs}});",
          "",
          "---------------"
        ],
        "templates/webclient/editfile.html||templates/webclient/editfile.html": [
          "File: templates/webclient/editfile.html -> templates/webclient/editfile.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "36:             <span class=\"font-weight-bold text-primary\">Edit file \"{{.Path}}\"</span>",
          "37:             <span class=\"btn-toolbar\">",
          "38:                 <a id=\"idBack\" class=\"btn btn-secondary mx-1 my-1\" href='{{.FilesURL}}?path={{.CurrentDir}}' role=\"button\">Back</a>",
          "39:                 <a id=\"idSave\" class=\"btn btn-primary mx-1 my-1\" href=\"#\" onclick=\"saveFile()\" role=\"button\">Save</a>",
          "40:             </span>",
          "41:         </h6>",
          "42:     </div>",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "39:                 {{if not .ReadOnly}}",
          "41:                 {{end}}",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "107:             lineNumbers: true,",
          "108:             styleActiveLine: true,",
          "109:             extraKeys: {\"Alt-F\": \"findPersistent\"},",
          "110:             autofocus: true",
          "111:         });",
          "112:         var filename = \"{{.Path}}\";",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "112:             {{if .ReadOnly}}",
          "113:             readOnly: true,",
          "114:             {{end}}",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "126:         });",
          "127:     }",
          "129:     function saveFile() {",
          "130:         $('#idSave').addClass(\"disabled\");",
          "131:         cm =  document.querySelector('.CodeMirror').CodeMirror;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "134:     {{if not .ReadOnly}}",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "167:                 }",
          "168:             });",
          "169:     }",
          "170: </script>",
          "171: {{end}}",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "176:     {{end}}",
          "",
          "---------------"
        ],
        "templates/webclient/files.html||templates/webclient/files.html": [
          "File: templates/webclient/files.html -> templates/webclient/files.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "8: <link href=\"{{.StaticURL}}/vendor/datatables/fixedHeader.bootstrap4.min.css\" rel=\"stylesheet\">",
          "9: <link href=\"{{.StaticURL}}/vendor/datatables/responsive.bootstrap4.min.css\" rel=\"stylesheet\">",
          "10: <link href=\"{{.StaticURL}}/vendor/datatables/dataTables.checkboxes.css\" rel=\"stylesheet\">",
          "11: <style>",
          "12:     div.dataTables_wrapper span.selected-info,",
          "13:     div.dataTables_wrapper span.selected-item {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "11: <link href=\"{{.StaticURL}}/vendor/lightbox2/css/lightbox.min.css\" rel=\"stylesheet\">",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "177: <script src=\"{{.StaticURL}}/vendor/datatables/dataTables.responsive.min.js\"></script>",
          "178: <script src=\"{{.StaticURL}}/vendor/datatables/responsive.bootstrap4.min.js\"></script>",
          "179: <script src=\"{{.StaticURL}}/vendor/datatables/dataTables.checkboxes.min.js\"></script>",
          "181: <script src=\"{{.StaticURL}}/vendor/codemirror/codemirror.js\"></script>",
          "182: <script src=\"{{.StaticURL}}/vendor/codemirror/meta.js\"></script>",
          "184: <script type=\"text/javascript\">",
          "186:     function getIconForFile(filename) {",
          "",
          "[Removed Lines]",
          "180: {{if .CanAddFiles}}",
          "183: {{end}}",
          "",
          "[Added Lines]",
          "181: <script src=\"{{.StaticURL}}/vendor/lightbox2/js/lightbox.min.js\"></script>",
          "182: <script src=\"{{.StaticURL}}/vendor/pdfobject/pdfobject.min.js\"></script>",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "613:                 { \"data\": \"edit_url\",",
          "614:                     \"render\": function (data, type, row) {",
          "615:                         if (type === 'display') {",
          "617:                             if (data != \"\"){",
          "620:                                 if (extension == \"csv\" || extension == \"bat\" || CodeMirror.findModeByExtension(extension) != null){",
          "621:                                     return `<a href=\"${data}\"><i class=\"fas fa-edit\"></i></a>`;",
          "622:                                 }",
          "623:                             }",
          "625:                         }",
          "626:                         return \"\";",
          "627:                     }",
          "",
          "[Removed Lines]",
          "616:                             {{if .CanAddFiles}}",
          "618:                                 var filename = row[\"name\"];",
          "619:                                 var extension = filename.slice((filename.lastIndexOf(\".\") - 1 >>> 0) + 2).toLowerCase();",
          "624:                             {{end}}",
          "",
          "[Added Lines]",
          "617:                             var filename = row[\"name\"];",
          "618:                             var extension = filename.slice((filename.lastIndexOf(\".\") - 1 >>> 0) + 2).toLowerCase();",
          "621:                                     {{if .CanAddFiles}}",
          "623:                                     {{else}}",
          "624:                                     return `<a href=\"${data}\"><i class=\"fas fa-eye\"></i></a>`;",
          "625:                                     {{end}}",
          "626:                                 }",
          "627:                             }",
          "628:                             if (row[\"type\"] == \"2\") {",
          "629:                                 switch (extension) {",
          "630:                                     case \"jpeg\":",
          "631:                                     case \"jpg\":",
          "632:                                     case \"png\":",
          "633:                                     case \"gif\":",
          "634:                                     case \"webp\":",
          "635:                                     case \"bmp\":",
          "636:                                     case \"svg\":",
          "637:                                     case \"ico\":",
          "638:                                         var view_url = row['url']+\"&inline=1\";",
          "639:                                         return `<a href=\"${view_url}\" data-lightbox=\"${filename}\" data-title=\"${filename}\"><i class=\"fas fa-eye\"></i></a>`;",
          "640:                                     case \"pdf\":",
          "641:                                         if (PDFObject.supportsPDFs){",
          "642:                                             var view_url = row['url'];",
          "643:                                             view_url = view_url.replace('{{.FilesURL}}','{{.ViewPDFURL}}');",
          "644:                                             return `<a href=\"${view_url}\" target=\"_blank\"><i class=\"fas fa-eye\"></i></a>`;",
          "645:                                         }",
          "",
          "---------------"
        ],
        "templates/webclient/viewpdf.html||templates/webclient/viewpdf.html": [
          "File: templates/webclient/viewpdf.html -> templates/webclient/viewpdf.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: <!DOCTYPE html>",
          "2: <html lang=\"en\">",
          "3:     <head>",
          "4:         <meta charset=\"UTF-8\" />",
          "5:         <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />",
          "6:         <title>{{.Title}}</title>",
          "7:     </head>",
          "9: <body>",
          "10:     <script src=\"{{.StaticURL}}/vendor/pdfobject/pdfobject.min.js\"></script>",
          "11:     <script type=\"text/javascript\">",
          "12:         PDFObject.embed(\"{{.URL}}\", document.body);",
          "13:     </script>",
          "14: </body>",
          "15: </html>",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "9382db751ca227cdd8e8ef7d01e62beb3642bba0",
      "candidate_info": {
        "commit_hash": "9382db751ca227cdd8e8ef7d01e62beb3642bba0",
        "repo": "drakkan/sftpgo",
        "commit_url": "https://github.com/drakkan/sftpgo/commit/9382db751ca227cdd8e8ef7d01e62beb3642bba0",
        "files": [
          "dataprovider/share.go",
          "docker/README.md",
          "go.mod",
          "go.sum",
          "httpd/api_http_user.go",
          "httpd/api_shares.go",
          "httpd/api_utils.go",
          "httpd/httpd_test.go",
          "httpd/internal_test.go",
          "httpd/server.go",
          "httpd/webclient.go",
          "openapi/openapi.yaml",
          "pkgs/build.sh",
          "pkgs/debian/changelog",
          "templates/webclient/files.html",
          "templates/webclient/sharefiles.html",
          "templates/webclient/shares.html",
          "version/version.go"
        ],
        "message": "make HTTP shares browsable\n\nif you share a single folder with read scope, you can now browse the share\nand download single files\n\nFixes #674\nSee #677\n\nSigned-off-by: Nicola Murino <nicola.murino@gmail.com>",
        "before_after_code_files": [
          "dataprovider/share.go||dataprovider/share.go",
          "go.mod||go.mod",
          "go.sum||go.sum",
          "httpd/api_http_user.go||httpd/api_http_user.go",
          "httpd/api_shares.go||httpd/api_shares.go",
          "httpd/api_utils.go||httpd/api_utils.go",
          "httpd/httpd_test.go||httpd/httpd_test.go",
          "httpd/internal_test.go||httpd/internal_test.go",
          "httpd/server.go||httpd/server.go",
          "httpd/webclient.go||httpd/webclient.go",
          "pkgs/build.sh||pkgs/build.sh",
          "templates/webclient/files.html||templates/webclient/files.html",
          "templates/webclient/sharefiles.html||templates/webclient/sharefiles.html",
          "templates/webclient/shares.html||templates/webclient/shares.html",
          "version/version.go||version/version.go"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "templates/webclient/files.html||templates/webclient/files.html",
            "templates/webclient/sharefiles.html||templates/webclient/sharefiles.html"
          ],
          "candidate": [
            "templates/webclient/files.html||templates/webclient/files.html",
            "templates/webclient/sharefiles.html||templates/webclient/sharefiles.html"
          ]
        }
      },
      "candidate_diff": {
        "dataprovider/share.go||dataprovider/share.go": [
          "File: dataprovider/share.go -> dataprovider/share.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "197:  if s.Scope == ShareScopeWrite && len(s.Paths) != 1 {",
          "198:   return util.NewValidationError(\"the write share scope requires exactly one path\")",
          "199:  }",
          "200:  return nil",
          "201: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "201:  if len(s.Paths) > 1 {",
          "202:   for idx := range s.Paths {",
          "203:    for innerIdx := range s.Paths {",
          "204:     if idx == innerIdx {",
          "205:      continue",
          "206:     }",
          "207:     if isVirtualDirOverlapped(s.Paths[idx], s.Paths[innerIdx], true) {",
          "208:      return util.NewGenericError(\"shared paths cannot be nested\")",
          "209:     }",
          "210:    }",
          "211:   }",
          "212:  }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "263:  return match, err",
          "264: }",
          "267: func (s *Share) IsUsable(ip string) (bool, error) {",
          "268:  if s.MaxTokens > 0 && s.UsedTokens >= s.MaxTokens {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "280: func (s *Share) GetRelativePath(name string) string {",
          "281:  if len(s.Paths) == 0 {",
          "282:   return \"\"",
          "283:  }",
          "284:  return util.CleanPath(strings.TrimPrefix(name, s.Paths[0]))",
          "285: }",
          "",
          "---------------"
        ],
        "go.mod||go.mod": [
          "File: go.mod -> go.mod",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: go 1.17",
          "5: require (",
          "7:  github.com/Azure/azure-storage-blob-go v0.14.0",
          "8:  github.com/GehirnInc/crypt v0.0.0-20200316065508-bb7000b8a962",
          "9:  github.com/alexedwards/argon2id v0.0.0-20211130144151-3585854a6387",
          "11:  github.com/cockroachdb/cockroach-go/v2 v2.2.6",
          "12:  github.com/eikenb/pipeat v0.0.0-20210603033007-44fc3ffce52b",
          "13:  github.com/fclairamb/ftpserverlib v0.17.0",
          "",
          "[Removed Lines]",
          "6:  cloud.google.com/go/storage v1.19.0",
          "10:  github.com/aws/aws-sdk-go v1.42.45",
          "",
          "[Added Lines]",
          "6:  cloud.google.com/go/storage v1.20.0",
          "10:  github.com/aws/aws-sdk-go v1.42.47",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "41:  github.com/rs/zerolog v1.26.2-0.20220203140311-fc26014bd4e1",
          "42:  github.com/sftpgo/sdk v0.0.0-20220201111021-563c373f8012",
          "43:  github.com/shirou/gopsutil/v3 v3.22.1",
          "45:  github.com/spf13/cobra v1.3.0",
          "46:  github.com/spf13/viper v1.10.1",
          "47:  github.com/stretchr/testify v1.7.0",
          "",
          "[Removed Lines]",
          "44:  github.com/spf13/afero v1.8.0",
          "",
          "[Added Lines]",
          "44:  github.com/spf13/afero v1.8.1",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "54:  gocloud.dev v0.24.0",
          "55:  golang.org/x/crypto v0.0.0-20220128200615-198e4374d7ed",
          "56:  golang.org/x/net v0.0.0-20220127200216-cd36cc0744dd",
          "58:  golang.org/x/time v0.0.0-20211116232009-f0f3c7e86c11",
          "60:  gopkg.in/natefinch/lumberjack.v2 v2.0.0",
          "61: )",
          "63: require (",
          "64:  cloud.google.com/go v0.100.2 // indirect",
          "66:  cloud.google.com/go/iam v0.1.1 // indirect",
          "67:  github.com/Azure/azure-pipeline-go v0.2.3 // indirect",
          "68:  github.com/beorn7/perks v1.0.1 // indirect",
          "",
          "[Removed Lines]",
          "57:  golang.org/x/sys v0.0.0-20220128215802-99c3d69c2c27",
          "59:  google.golang.org/api v0.66.0",
          "65:  cloud.google.com/go/compute v1.1.0 // indirect",
          "",
          "[Added Lines]",
          "57:  golang.org/x/sys v0.0.0-20220204135822-1c1b9b1eba6a",
          "59:  google.golang.org/api v0.67.0",
          "65:  cloud.google.com/go/compute v1.2.0 // indirect",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "126:  golang.org/x/tools v0.1.9 // indirect",
          "127:  golang.org/x/xerrors v0.0.0-20200804184101-5ec99f83aff1 // indirect",
          "128:  google.golang.org/appengine v1.6.7 // indirect",
          "130:  google.golang.org/grpc v1.44.0 // indirect",
          "131:  google.golang.org/protobuf v1.27.1 // indirect",
          "132:  gopkg.in/ini.v1 v1.66.3 // indirect",
          "",
          "[Removed Lines]",
          "129:  google.golang.org/genproto v0.0.0-20220202230416-2a053f022f0d // indirect",
          "",
          "[Added Lines]",
          "129:  google.golang.org/genproto v0.0.0-20220204002441-d6cc3cc0770e // indirect",
          "",
          "---------------"
        ],
        "go.sum||go.sum": [
          "File: go.sum -> go.sum",
          "--- Hunk 1 ---",
          "[Context before]",
          "46: cloud.google.com/go/bigquery v1.7.0/go.mod h1://okPTzCYNXSlb24MZs83e2Do+h+VXtc4gLoIoXIAPc=",
          "47: cloud.google.com/go/bigquery v1.8.0/go.mod h1:J5hqkt3O0uAFnINi6JXValWIb1v0goeZM77hZzJN/fQ=",
          "48: cloud.google.com/go/compute v0.1.0/go.mod h1:GAesmwr110a34z04OlxYkATPBEfVhkymfTBXtfbBFow=",
          "51: cloud.google.com/go/datastore v1.0.0/go.mod h1:LXYbyblFSglQ5pkeyhO+Qmw7ukd3C+pD7TKLgZqpHYE=",
          "52: cloud.google.com/go/datastore v1.1.0/go.mod h1:umbIZjpQpHh4hmRpGhH4tLFup+FVzqBi1b3c64qFpCk=",
          "53: cloud.google.com/go/firestore v1.5.0/go.mod h1:c4nNYR1qdq7eaZ+jSc5fonrQN2k3M7sWATcYTiakjEo=",
          "",
          "[Removed Lines]",
          "49: cloud.google.com/go/compute v1.1.0 h1:pyPhehLfZ6pVzRgJmXGYvCY4K7WSWRhVw0AwhgVvS84=",
          "50: cloud.google.com/go/compute v1.1.0/go.mod h1:2NIffxgWfORSI7EOYMFatGTfjMLnqrOKBEyYb6NoRgA=",
          "",
          "[Added Lines]",
          "49: cloud.google.com/go/compute v1.2.0 h1:EKki8sSdvDU0OO9mAXGwPXOTOgPz2l08R0/IutDH11I=",
          "50: cloud.google.com/go/compute v1.2.0/go.mod h1:xlogom/6gr8RJGBe7nT2eGsQYAFUbbv8dbC29qE3Xmw=",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "70: cloud.google.com/go/storage v1.10.0/go.mod h1:FLPqc6j+Ki4BU591ie1oL6qBQGu2Bl/tZ9ullr3+Kg0=",
          "71: cloud.google.com/go/storage v1.14.0/go.mod h1:GrKmX003DSIwi9o29oFT7YDnHYwZoctc3fOKtUw0Xmo=",
          "72: cloud.google.com/go/storage v1.16.1/go.mod h1:LaNorbty3ehnU3rEjXSNV/NRgQA0O8Y+uh6bPe5UOk4=",
          "75: cloud.google.com/go/trace v0.1.0/go.mod h1:wxEwsoeRVPbeSkt7ZC9nWCgmoKQRAoySN7XHW2AmI7g=",
          "76: contrib.go.opencensus.io/exporter/aws v0.0.0-20200617204711-c478e41e60e9/go.mod h1:uu1P0UCM/6RbsMrgPa98ll8ZcHM858i/AD06a9aLRCA=",
          "77: contrib.go.opencensus.io/exporter/stackdriver v0.13.8/go.mod h1:huNtlWx75MwO7qMs0KrMxPZXzNNWebav1Sq/pm02JdQ=",
          "",
          "[Removed Lines]",
          "73: cloud.google.com/go/storage v1.19.0 h1:XOQSnPJD8hRtZJ3VdCyK0mBZsGGImrzPAMbSWcHSe6Q=",
          "74: cloud.google.com/go/storage v1.19.0/go.mod h1:6rgiTRjOqI/Zd9YKimub5TIB4d+p3LH33V3ZE1DMuUM=",
          "",
          "[Added Lines]",
          "73: cloud.google.com/go/storage v1.20.0 h1:kv3rQ3clEQdxqokkCCgQo+bxPqcuXiROjxvnKb8Oqdk=",
          "74: cloud.google.com/go/storage v1.20.0/go.mod h1:TiC1o6FxNCG8y5gB7rqCsFZCIYPMPZCO81ppOoEPLGI=",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "141: github.com/aws/aws-sdk-go v1.15.27/go.mod h1:mFuSZ37Z9YOHbQEwBWztmVzqXrEkub65tZoCYDt7FT0=",
          "142: github.com/aws/aws-sdk-go v1.37.0/go.mod h1:hcU610XS61/+aQV88ixoOzUoG7v3b31pl2zKMmprdro=",
          "143: github.com/aws/aws-sdk-go v1.40.34/go.mod h1:585smgzpB/KqRA+K3y/NL/oYRqQvpNJYvLm+LY1U59Q=",
          "146: github.com/aws/aws-sdk-go-v2 v1.9.0/go.mod h1:cK/D0BBs0b/oWPIcX/Z/obahJK1TT7IPVjy53i/mX/4=",
          "147: github.com/aws/aws-sdk-go-v2/config v1.7.0/go.mod h1:w9+nMZ7soXCe5nT46Ri354SNhXDQ6v+V5wqDjnZE+GY=",
          "148: github.com/aws/aws-sdk-go-v2/credentials v1.4.0/go.mod h1:dgGR+Qq7Wjcd4AOAW5Rf5Tnv3+x7ed6kETXyS9WCuAY=",
          "",
          "[Removed Lines]",
          "144: github.com/aws/aws-sdk-go v1.42.45 h1:rzYlmOX2EqdsYKvo0WBBffuff3BuckL1UB2KyzWhXyQ=",
          "145: github.com/aws/aws-sdk-go v1.42.45/go.mod h1:OGr6lGMAKGlG9CVrYnWYDKIyb829c6EVBRjxqjmPepc=",
          "",
          "[Added Lines]",
          "144: github.com/aws/aws-sdk-go v1.42.47 h1:Faabrbp+bOBiZjHje7Hbhvni212aQYQIXZMruwkgmmA=",
          "145: github.com/aws/aws-sdk-go v1.42.47/go.mod h1:OGr6lGMAKGlG9CVrYnWYDKIyb829c6EVBRjxqjmPepc=",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "706: github.com/spaolacci/murmur3 v0.0.0-20180118202830-f09979ecbc72/go.mod h1:JwIasOWyU6f++ZhiEuf87xNszmSA2myDM2Kzu9HwQUA=",
          "707: github.com/spf13/afero v1.3.3/go.mod h1:5KUK8ByomD5Ti5Artl0RtHeI5pTF7MIDuXL3yY520V4=",
          "708: github.com/spf13/afero v1.6.0/go.mod h1:Ai8FlHk4v/PARR026UzYexafAt9roJ7LcLMAmO6Z93I=",
          "710: github.com/spf13/afero v1.8.0/go.mod h1:CtAatgMJh6bJEIs48Ay/FOnkljP3WeGUG0MC1RfAqwo=",
          "711: github.com/spf13/cast v1.4.1 h1:s0hze+J0196ZfEMTs80N7UlFt0BDuQ7Q+JDnHiMWKdA=",
          "712: github.com/spf13/cast v1.4.1/go.mod h1:Qx5cxh0v+4UWYiBimWS+eyWzqEqokIECu5etghLkUJE=",
          "713: github.com/spf13/cobra v1.3.0 h1:R7cSvGu+Vv+qX0gW5R/85dx2kmmJT5z5NM8ifdYjdn0=",
          "",
          "[Removed Lines]",
          "709: github.com/spf13/afero v1.8.0 h1:5MmtuhAgYeU6qpa7w7bP0dv6MBYuup0vekhSpSkoq60=",
          "",
          "[Added Lines]",
          "710: github.com/spf13/afero v1.8.1 h1:izYHOT71f9iZ7iq37Uqjael60/vYC6vMtzedudZ0zEk=",
          "711: github.com/spf13/afero v1.8.1/go.mod h1:CtAatgMJh6bJEIs48Ay/FOnkljP3WeGUG0MC1RfAqwo=",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "947: golang.org/x/sys v0.0.0-20220110181412-a018aaa089fe/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=",
          "948: golang.org/x/sys v0.0.0-20220111092808-5a964db01320/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=",
          "949: golang.org/x/sys v0.0.0-20220114195835-da31bd327af9/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=",
          "951: golang.org/x/sys v0.0.0-20220128215802-99c3d69c2c27/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=",
          "952: golang.org/x/term v0.0.0-20201126162022-7de9c90e9dd1/go.mod h1:bj7SfCRtBDWHUb9snDiAeCFNEtKQo2Wmx5Cou7ajbmo=",
          "953: golang.org/x/term v0.0.0-20210927222741-03fcf44c2211 h1:JGgROgKl9N8DuW20oFS5gxc+lE67/N3FcwmBPMe7ArY=",
          "954: golang.org/x/term v0.0.0-20210927222741-03fcf44c2211/go.mod h1:jbD1KX2456YbFQfuXm/mYQcufACuNUgVhRMnK/tPxf8=",
          "",
          "[Removed Lines]",
          "950: golang.org/x/sys v0.0.0-20220128215802-99c3d69c2c27 h1:XDXtA5hveEEV8JB2l7nhMTp3t3cHp9ZpwcdjqyEWLlo=",
          "",
          "[Added Lines]",
          "952: golang.org/x/sys v0.0.0-20220204135822-1c1b9b1eba6a h1:ppl5mZgokTT8uPkmYOyEUmPTr3ypaKkg5eFOGrAmxxE=",
          "953: golang.org/x/sys v0.0.0-20220204135822-1c1b9b1eba6a/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "1079: google.golang.org/api v0.62.0/go.mod h1:dKmwPCydfsad4qCH08MSdgWjfHOyfpd4VtDGgRFdavw=",
          "1080: google.golang.org/api v0.63.0/go.mod h1:gs4ij2ffTRXwuzzgJl/56BdwJaA194ijkfn++9tDuPo=",
          "1081: google.golang.org/api v0.64.0/go.mod h1:931CdxA8Rm4t6zqTFGSsgwbAEZ2+GMYurbndwSimebM=",
          "1084: google.golang.org/api v0.66.0/go.mod h1:I1dmXYpX7HGwz/ejRxwQp2qj5bFAz93HiCU1C1oYd9M=",
          "1085: google.golang.org/appengine v1.1.0/go.mod h1:EbEs0AVv82hx2wNQdGPgUI5lhzA/G0D9YwlJXL52JkM=",
          "1086: google.golang.org/appengine v1.4.0/go.mod h1:xpcJRLb0r/rnEns0DIKYYv+WjYCduHsrkT7/EB5XEv4=",
          "1087: google.golang.org/appengine v1.5.0/go.mod h1:xpcJRLb0r/rnEns0DIKYYv+WjYCduHsrkT7/EB5XEv4=",
          "",
          "[Removed Lines]",
          "1082: google.golang.org/api v0.65.0/go.mod h1:ArYhxgGadlWmqO1IqVujw6Cs8IdD33bTmzKo2Sh+cbg=",
          "1083: google.golang.org/api v0.66.0 h1:CbGy4LEiXCVCiNEDFgGpWOVwsDT7E2Qej1ZvN1P7KPg=",
          "",
          "[Added Lines]",
          "1085: google.golang.org/api v0.67.0 h1:lYaaLa+x3VVUhtosaK9xihwQ9H9KRa557REHwwZ2orM=",
          "1086: google.golang.org/api v0.67.0/go.mod h1:ShHKP8E60yPsKNw/w8w+VYaj9H6buA5UqDp8dhbQZ6g=",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "1164: google.golang.org/genproto v0.0.0-20211208223120-3a66f561d7aa/go.mod h1:5CzLGKJ67TSI2B9POpiiyGha0AjJvZIUgRMt1dSmuhc=",
          "1165: google.golang.org/genproto v0.0.0-20211221195035-429b39de9b1c/go.mod h1:5CzLGKJ67TSI2B9POpiiyGha0AjJvZIUgRMt1dSmuhc=",
          "1166: google.golang.org/genproto v0.0.0-20211223182754-3ac035c7e7cb/go.mod h1:5CzLGKJ67TSI2B9POpiiyGha0AjJvZIUgRMt1dSmuhc=",
          "1168: google.golang.org/genproto v0.0.0-20220111164026-67b88f271998/go.mod h1:5CzLGKJ67TSI2B9POpiiyGha0AjJvZIUgRMt1dSmuhc=",
          "1169: google.golang.org/genproto v0.0.0-20220114231437-d2e6a121cae0/go.mod h1:5CzLGKJ67TSI2B9POpiiyGha0AjJvZIUgRMt1dSmuhc=",
          "1171: google.golang.org/genproto v0.0.0-20220126215142-9970aeb2e350/go.mod h1:5CzLGKJ67TSI2B9POpiiyGha0AjJvZIUgRMt1dSmuhc=",
          "1174: google.golang.org/grpc v1.8.0/go.mod h1:yo6s7OP7yaDglbqo1J04qKzAhqBH6lvTonzMVmEdcZw=",
          "1175: google.golang.org/grpc v1.19.0/go.mod h1:mqu4LbDTu4XGKhr4mRzUsmM4RtVoemTSY81AxZiDr8c=",
          "1176: google.golang.org/grpc v1.20.1/go.mod h1:10oTOabMzJvdu6/UiuZezV6QK5dSlG84ov/aaiqXj38=",
          "",
          "[Removed Lines]",
          "1167: google.golang.org/genproto v0.0.0-20220107163113-42d7afdf6368/go.mod h1:5CzLGKJ67TSI2B9POpiiyGha0AjJvZIUgRMt1dSmuhc=",
          "1170: google.golang.org/genproto v0.0.0-20220118154757-00ab72f36ad5/go.mod h1:5CzLGKJ67TSI2B9POpiiyGha0AjJvZIUgRMt1dSmuhc=",
          "1172: google.golang.org/genproto v0.0.0-20220202230416-2a053f022f0d h1:My3SknEgMxMbQeOp4Onz8T696iNcOYHJC/E7Dx+RDjc=",
          "1173: google.golang.org/genproto v0.0.0-20220202230416-2a053f022f0d/go.mod h1:5CzLGKJ67TSI2B9POpiiyGha0AjJvZIUgRMt1dSmuhc=",
          "",
          "[Added Lines]",
          "1172: google.golang.org/genproto v0.0.0-20220201184016-50beb8ab5c44/go.mod h1:5CzLGKJ67TSI2B9POpiiyGha0AjJvZIUgRMt1dSmuhc=",
          "1173: google.golang.org/genproto v0.0.0-20220204002441-d6cc3cc0770e h1:hXl9hnyOkeznztYpYxVPAVZfPzcbO6Q0C+nLXodza8k=",
          "1174: google.golang.org/genproto v0.0.0-20220204002441-d6cc3cc0770e/go.mod h1:5CzLGKJ67TSI2B9POpiiyGha0AjJvZIUgRMt1dSmuhc=",
          "",
          "---------------"
        ],
        "httpd/api_http_user.go||httpd/api_http_user.go": [
          "File: httpd/api_http_user.go -> httpd/api_http_user.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "10:  \"os\"",
          "11:  \"path\"",
          "12:  \"strconv\"",
          "15:  \"github.com/go-chi/render\"",
          "16:  \"github.com/rs/xid\"",
          "",
          "[Removed Lines]",
          "13:  \"time\"",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "61:   sendAPIResponse(w, r, err, \"Unable to get directory contents\", getMappedStatusCode(err))",
          "62:   return",
          "63:  }",
          "77: }",
          "79: func createUserDir(w http.ResponseWriter, r *http.Request) {",
          "",
          "[Removed Lines]",
          "64:  results := make([]map[string]interface{}, 0, len(contents))",
          "65:  for _, info := range contents {",
          "66:   res := make(map[string]interface{})",
          "67:   res[\"name\"] = info.Name()",
          "68:   if info.Mode().IsRegular() {",
          "69:    res[\"size\"] = info.Size()",
          "70:   }",
          "71:   res[\"mode\"] = info.Mode()",
          "72:   res[\"last_modified\"] = info.ModTime().UTC().Format(time.RFC3339)",
          "73:   results = append(results, res)",
          "74:  }",
          "76:  render.JSON(w, r, results)",
          "",
          "[Added Lines]",
          "63:  renderAPIDirContents(w, r, contents, false)",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "163:  }",
          "165:  inline := r.URL.Query().Get(\"inline\") != \"\"",
          "167:   resp := apiResponse{",
          "168:    Error:   err.Error(),",
          "169:    Message: http.StatusText(status),",
          "",
          "[Removed Lines]",
          "166:  if status, err := downloadFile(w, r, connection, name, info, inline); err != nil {",
          "",
          "[Added Lines]",
          "153:  if status, err := downloadFile(w, r, connection, name, info, inline, nil); err != nil {",
          "",
          "---------------"
        ],
        "httpd/api_shares.go||httpd/api_shares.go": [
          "File: httpd/api_shares.go -> httpd/api_shares.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "7:  \"net/http\"",
          "8:  \"os\"",
          "9:  \"path\"",
          "11:  \"github.com/go-chi/render\"",
          "12:  \"github.com/rs/xid\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "10:  \"strings\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "135:  sendAPIResponse(w, r, err, \"Share deleted\", http.StatusOK)",
          "136: }",
          "138: func downloadFromShare(w http.ResponseWriter, r *http.Request) {",
          "139:  r.Body = http.MaxBytesReader(w, r.Body, maxRequestSize)",
          "140:  share, connection, err := checkPublicShare(w, r, dataprovider.ShareScopeRead)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "139: func readBrowsableShareContents(w http.ResponseWriter, r *http.Request) {",
          "140:  r.Body = http.MaxBytesReader(w, r.Body, maxRequestSize)",
          "141:  share, connection, err := checkPublicShare(w, r, dataprovider.ShareScopeRead)",
          "142:  if err != nil {",
          "143:   return",
          "144:  }",
          "145:  if err := validateBrowsableShare(share, connection); err != nil {",
          "146:   sendAPIResponse(w, r, err, \"\", getRespStatus(err))",
          "147:   return",
          "148:  }",
          "149:  name, err := getBrowsableSharedPath(share, r)",
          "150:  if err != nil {",
          "151:   sendAPIResponse(w, r, err, \"\", getRespStatus(err))",
          "152:   return",
          "153:  }",
          "155:  common.Connections.Add(connection)",
          "156:  defer common.Connections.Remove(connection.GetID())",
          "158:  contents, err := connection.ReadDir(name)",
          "159:  if err != nil {",
          "160:   sendAPIResponse(w, r, err, \"Unable to get directory contents\", getMappedStatusCode(err))",
          "161:   return",
          "162:  }",
          "163:  renderAPIDirContents(w, r, contents, true)",
          "164: }",
          "166: func downloadBrowsableSharedFile(w http.ResponseWriter, r *http.Request) {",
          "167:  r.Body = http.MaxBytesReader(w, r.Body, maxRequestSize)",
          "168:  share, connection, err := checkPublicShare(w, r, dataprovider.ShareScopeRead)",
          "169:  if err != nil {",
          "170:   return",
          "171:  }",
          "172:  if err := validateBrowsableShare(share, connection); err != nil {",
          "173:   sendAPIResponse(w, r, err, \"\", getRespStatus(err))",
          "174:   return",
          "175:  }",
          "176:  name, err := getBrowsableSharedPath(share, r)",
          "177:  if err != nil {",
          "178:   sendAPIResponse(w, r, err, \"\", getRespStatus(err))",
          "179:   return",
          "180:  }",
          "182:  common.Connections.Add(connection)",
          "183:  defer common.Connections.Remove(connection.GetID())",
          "185:  info, err := connection.Stat(name, 1)",
          "186:  if err != nil {",
          "187:   sendAPIResponse(w, r, err, \"Unable to stat the requested file\", getMappedStatusCode(err))",
          "188:   return",
          "189:  }",
          "190:  if info.IsDir() {",
          "191:   sendAPIResponse(w, r, nil, fmt.Sprintf(\"Please set the path to a valid file, %#v is a directory\", name),",
          "192:    http.StatusBadRequest)",
          "193:   return",
          "194:  }",
          "196:  inline := r.URL.Query().Get(\"inline\") != \"\"",
          "197:  dataprovider.UpdateShareLastUse(&share, 1) //nolint:errcheck",
          "198:  if status, err := downloadFile(w, r, connection, name, info, inline, &share); err != nil {",
          "199:   dataprovider.UpdateShareLastUse(&share, -1) //nolint:errcheck",
          "200:   resp := apiResponse{",
          "201:    Error:   err.Error(),",
          "202:    Message: http.StatusText(status),",
          "203:   }",
          "204:   ctx := r.Context()",
          "205:   if status != 0 {",
          "206:    ctx = context.WithValue(ctx, render.StatusCtxKey, status)",
          "207:   }",
          "208:   render.JSON(w, r.WithContext(ctx), resp)",
          "209:  }",
          "210: }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "148:  compress := true",
          "149:  var info os.FileInfo",
          "152:   if err != nil {",
          "153:    sendAPIResponse(w, r, err, \"\", getRespStatus(err))",
          "154:    return",
          "155:   }",
          "157:    compress = false",
          "158:   }",
          "159:  }",
          "",
          "[Removed Lines]",
          "150:  if len(share.Paths) > 0 && r.URL.Query().Get(\"compress\") == \"false\" {",
          "151:   info, err = connection.Stat(share.Paths[0], 0)",
          "156:   if !info.IsDir() {",
          "",
          "[Added Lines]",
          "224:  if len(share.Paths) == 1 && r.URL.Query().Get(\"compress\") == \"false\" {",
          "225:   info, err = connection.Stat(share.Paths[0], 1)",
          "230:   if info.Mode().IsRegular() {",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "170:   renderCompressedFiles(w, connection, \"/\", share.Paths, &share)",
          "171:   return",
          "172:  }",
          "174:   dataprovider.UpdateShareLastUse(&share, -1) //nolint:errcheck",
          "175:   resp := apiResponse{",
          "176:    Error:   err.Error(),",
          "",
          "[Removed Lines]",
          "173:  if status, err := downloadFile(w, r, connection, share.Paths[0], info, false); err != nil {",
          "",
          "[Added Lines]",
          "247:  if status, err := downloadFile(w, r, connection, share.Paths[0], info, false, &share); err != nil {",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "304:  return share, connection, nil",
          "305: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "381: func validateBrowsableShare(share dataprovider.Share, connection *Connection) error {",
          "382:  if len(share.Paths) != 1 {",
          "383:   return util.NewValidationError(\"A share with multiple paths is not browsable\")",
          "384:  }",
          "385:  basePath := share.Paths[0]",
          "386:  info, err := connection.Stat(basePath, 0)",
          "387:  if err != nil {",
          "388:   return fmt.Errorf(\"unable to check the share directory: %w\", err)",
          "389:  }",
          "390:  if !info.IsDir() {",
          "391:   return util.NewValidationError(\"The shared object is not a directory and so it is not browsable\")",
          "392:  }",
          "393:  return nil",
          "394: }",
          "396: func getBrowsableSharedPath(share dataprovider.Share, r *http.Request) (string, error) {",
          "397:  name := util.CleanPath(path.Join(share.Paths[0], r.URL.Query().Get(\"path\")))",
          "398:  if share.Paths[0] == \"/\" {",
          "399:   return name, nil",
          "400:  }",
          "401:  if name != share.Paths[0] && !strings.HasPrefix(name, share.Paths[0]+\"/\") {",
          "402:   return \"\", util.NewValidationError(fmt.Sprintf(\"Invalid path %#v\", r.URL.Query().Get(\"path\")))",
          "403:  }",
          "404:  return name, nil",
          "405: }",
          "",
          "---------------"
        ],
        "httpd/api_utils.go||httpd/api_utils.go": [
          "File: httpd/api_utils.go -> httpd/api_utils.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "82:  if os.IsNotExist(err) {",
          "83:   return http.StatusBadRequest",
          "84:  }",
          "86:   return http.StatusForbidden",
          "87:  }",
          "88:  if errors.Is(err, plugin.ErrNoSearcher) || errors.Is(err, dataprovider.ErrNotImplemented) {",
          "",
          "[Removed Lines]",
          "85:  if os.IsPermission(err) {",
          "",
          "[Added Lines]",
          "85:  if os.IsPermission(err) || errors.Is(err, dataprovider.ErrLoginNotAllowedFromIP) {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "187:  return limit, offset, order, err",
          "188: }",
          "190: func renderCompressedFiles(w http.ResponseWriter, conn *Connection, baseDir string, files []string,",
          "191:  share *dataprovider.Share,",
          "192: ) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "190: func renderAPIDirContents(w http.ResponseWriter, r *http.Request, contents []os.FileInfo, omitNonRegularFiles bool) {",
          "191:  results := make([]map[string]interface{}, 0, len(contents))",
          "192:  for _, info := range contents {",
          "193:   if omitNonRegularFiles && !info.Mode().IsDir() && !info.Mode().IsRegular() {",
          "194:    continue",
          "195:   }",
          "196:   res := make(map[string]interface{})",
          "197:   res[\"name\"] = info.Name()",
          "198:   if info.Mode().IsRegular() {",
          "199:    res[\"size\"] = info.Size()",
          "200:   }",
          "201:   res[\"mode\"] = info.Mode()",
          "202:   res[\"last_modified\"] = info.ModTime().UTC().Format(time.RFC3339)",
          "203:   results = append(results, res)",
          "204:  }",
          "206:  render.JSON(w, r, results)",
          "207: }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "266:  return strings.TrimPrefix(entryPath, \"/\")",
          "267: }",
          "269: func downloadFile(w http.ResponseWriter, r *http.Request, connection *Connection, name string,",
          "271: ) (int, error) {",
          "273:  rangeHeader := r.Header.Get(\"Range\")",
          "274:  if rangeHeader != \"\" && checkIfRange(r, info.ModTime()) == condFalse {",
          "275:   rangeHeader = \"\"",
          "",
          "[Removed Lines]",
          "270:  info os.FileInfo, inline bool,",
          "272:  var err error",
          "",
          "[Added Lines]",
          "288: func checkDownloadFileFromShare(share *dataprovider.Share, info os.FileInfo) error {",
          "289:  if share != nil && !info.Mode().IsRegular() {",
          "290:   return util.NewValidationError(\"non regular files are not supported for shares\")",
          "291:  }",
          "292:  return nil",
          "293: }",
          "296:  info os.FileInfo, inline bool, share *dataprovider.Share,",
          "298:  err := checkDownloadFileFromShare(share, info)",
          "299:  if err != nil {",
          "300:   return http.StatusBadRequest, err",
          "301:  }",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "314:  if r.Method != http.MethodHead {",
          "315:   _, err = io.CopyN(w, reader, size)",
          "316:   if err != nil {",
          "317:    connection.Log(logger.LevelDebug, \"error reading file to download: %v\", err)",
          "318:    panic(http.ErrAbortHandler)",
          "319:   }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "346:    if share != nil {",
          "347:     dataprovider.UpdateShareLastUse(share, -1) //nolint:errcheck",
          "348:    }",
          "",
          "---------------"
        ],
        "httpd/httpd_test.go||httpd/httpd_test.go": [
          "File: httpd/httpd_test.go -> httpd/httpd_test.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "9558:  assert.NoError(t, err)",
          "9559: }",
          "9561: func TestUserAPIShareErrors(t *testing.T) {",
          "9562:  user, _, err := httpdtest.AddUser(getTestUser(), http.StatusCreated)",
          "9563:  assert.NoError(t, err)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "9561: func TestDownloadFromShareError(t *testing.T) {",
          "9562:  u := getTestUser()",
          "9563:  u.DownloadDataTransfer = 1",
          "9564:  user, _, err := httpdtest.AddUser(u, http.StatusCreated)",
          "9565:  assert.NoError(t, err)",
          "9566:  user.UsedDownloadDataTransfer = 1024*1024 - 32768",
          "9567:  _, err = httpdtest.UpdateTransferQuotaUsage(user, \"add\", http.StatusOK)",
          "9568:  assert.NoError(t, err)",
          "9569:  user, _, err = httpdtest.GetUserByUsername(user.Username, http.StatusOK)",
          "9570:  assert.NoError(t, err)",
          "9571:  assert.Equal(t, int64(1024*1024-32768), user.UsedDownloadDataTransfer)",
          "9572:  testFileName := \"test_share_file.dat\"",
          "9573:  testFileSize := int64(524288)",
          "9574:  testFilePath := filepath.Join(user.GetHomeDir(), testFileName)",
          "9575:  err = createTestFile(testFilePath, testFileSize)",
          "9576:  assert.NoError(t, err)",
          "9578:  token, err := getJWTAPIUserTokenFromTestServer(defaultUsername, defaultPassword)",
          "9579:  assert.NoError(t, err)",
          "9580:  share := dataprovider.Share{",
          "9581:   Name:      \"test share root browse\",",
          "9582:   Scope:     dataprovider.ShareScopeRead,",
          "9583:   Paths:     []string{\"/\"},",
          "9584:   MaxTokens: 2,",
          "9585:  }",
          "9586:  asJSON, err := json.Marshal(share)",
          "9587:  assert.NoError(t, err)",
          "9588:  req, err := http.NewRequest(http.MethodPost, userSharesPath, bytes.NewBuffer(asJSON))",
          "9589:  assert.NoError(t, err)",
          "9590:  setBearerForReq(req, token)",
          "9591:  rr := executeRequest(req)",
          "9592:  checkResponseCode(t, http.StatusCreated, rr)",
          "9593:  objectID := rr.Header().Get(\"X-Object-ID\")",
          "9594:  assert.NotEmpty(t, objectID)",
          "9596:  defer func() {",
          "9597:   rcv := recover()",
          "9598:   assert.Equal(t, http.ErrAbortHandler, rcv)",
          "9600:   share, err = dataprovider.ShareExists(objectID, user.Username)",
          "9601:   assert.NoError(t, err)",
          "9602:   assert.Equal(t, 0, share.UsedTokens)",
          "9604:   _, err = httpdtest.RemoveUser(user, http.StatusOK)",
          "9605:   assert.NoError(t, err)",
          "9606:   err = os.RemoveAll(user.GetHomeDir())",
          "9607:   assert.NoError(t, err)",
          "9608:  }()",
          "9610:  req, err = http.NewRequest(http.MethodGet, path.Join(webClientPubSharesPath, objectID, \"browse?path=\"+testFileName), nil)",
          "9611:  assert.NoError(t, err)",
          "9612:  executeRequest(req)",
          "9613: }",
          "9615: func TestBrowseShares(t *testing.T) {",
          "9616:  user, _, err := httpdtest.AddUser(getTestUser(), http.StatusCreated)",
          "9617:  assert.NoError(t, err)",
          "9619:  testFileName := \"testsharefile.dat\"",
          "9620:  testFileNameLink := \"testsharefile.link\"",
          "9621:  shareDir := \"share\"",
          "9622:  subDir := \"sub\"",
          "9623:  testFileSize := int64(65536)",
          "9624:  testFilePath := filepath.Join(user.GetHomeDir(), shareDir, testFileName)",
          "9625:  testLinkPath := filepath.Join(user.GetHomeDir(), shareDir, testFileNameLink)",
          "9626:  err = createTestFile(testFilePath, testFileSize)",
          "9627:  assert.NoError(t, err)",
          "9628:  err = createTestFile(filepath.Join(user.GetHomeDir(), shareDir, subDir, testFileName), testFileSize)",
          "9629:  assert.NoError(t, err)",
          "9630:  err = os.Symlink(testFilePath, testLinkPath)",
          "9631:  assert.NoError(t, err)",
          "9633:  token, err := getJWTAPIUserTokenFromTestServer(defaultUsername, defaultPassword)",
          "9634:  assert.NoError(t, err)",
          "9636:  share := dataprovider.Share{",
          "9637:   Name:      \"test share browse\",",
          "9638:   Scope:     dataprovider.ShareScopeRead,",
          "9639:   Paths:     []string{shareDir},",
          "9640:   MaxTokens: 0,",
          "9641:  }",
          "9642:  asJSON, err := json.Marshal(share)",
          "9643:  assert.NoError(t, err)",
          "9644:  req, err := http.NewRequest(http.MethodPost, userSharesPath, bytes.NewBuffer(asJSON))",
          "9645:  assert.NoError(t, err)",
          "9646:  setBearerForReq(req, token)",
          "9647:  rr := executeRequest(req)",
          "9648:  checkResponseCode(t, http.StatusCreated, rr)",
          "9649:  objectID := rr.Header().Get(\"X-Object-ID\")",
          "9650:  assert.NotEmpty(t, objectID)",
          "9652:  req, err = http.NewRequest(http.MethodGet, path.Join(webClientPubSharesPath, objectID, \"browse?path=%2F\"), nil)",
          "9653:  assert.NoError(t, err)",
          "9654:  rr = executeRequest(req)",
          "9655:  checkResponseCode(t, http.StatusOK, rr)",
          "9657:  req, err = http.NewRequest(http.MethodGet, path.Join(sharesPath, objectID, \"files?path=%2F\"), nil)",
          "9658:  assert.NoError(t, err)",
          "9659:  rr = executeRequest(req)",
          "9660:  checkResponseCode(t, http.StatusBadRequest, rr)",
          "9661:  assert.Contains(t, rr.Body.String(), \"Please set the path to a valid file\")",
          "9663:  req, err = http.NewRequest(http.MethodGet, path.Join(webClientPubSharesPath, objectID, \"dirs?path=%2F\"), nil)",
          "9664:  assert.NoError(t, err)",
          "9665:  rr = executeRequest(req)",
          "9666:  checkResponseCode(t, http.StatusOK, rr)",
          "9667:  contents := make([]map[string]interface{}, 0)",
          "9668:  err = json.Unmarshal(rr.Body.Bytes(), &contents)",
          "9669:  assert.NoError(t, err)",
          "9670:  assert.Len(t, contents, 2)",
          "9672:  req, err = http.NewRequest(http.MethodGet, path.Join(sharesPath, objectID, \"dirs?path=%2F\"), nil)",
          "9673:  assert.NoError(t, err)",
          "9674:  rr = executeRequest(req)",
          "9675:  checkResponseCode(t, http.StatusOK, rr)",
          "9676:  contents = make([]map[string]interface{}, 0)",
          "9677:  err = json.Unmarshal(rr.Body.Bytes(), &contents)",
          "9678:  assert.NoError(t, err)",
          "9679:  assert.Len(t, contents, 2)",
          "9681:  req, err = http.NewRequest(http.MethodGet, path.Join(sharesPath, objectID, \"dirs?path=%2F\"+subDir), nil)",
          "9682:  assert.NoError(t, err)",
          "9683:  rr = executeRequest(req)",
          "9684:  checkResponseCode(t, http.StatusOK, rr)",
          "9685:  contents = make([]map[string]interface{}, 0)",
          "9686:  err = json.Unmarshal(rr.Body.Bytes(), &contents)",
          "9687:  assert.NoError(t, err)",
          "9688:  assert.Len(t, contents, 1)",
          "9690:  req, err = http.NewRequest(http.MethodGet, path.Join(webClientPubSharesPath, objectID, \"browse?path=%2F..\"), nil)",
          "9691:  assert.NoError(t, err)",
          "9692:  rr = executeRequest(req)",
          "9693:  checkResponseCode(t, http.StatusBadRequest, rr)",
          "9694:  assert.Contains(t, rr.Body.String(), \"Invalid share path\")",
          "9696:  req, err = http.NewRequest(http.MethodGet, path.Join(webClientPubSharesPath, objectID, \"dirs?path=%2F..\"), nil)",
          "9697:  assert.NoError(t, err)",
          "9698:  rr = executeRequest(req)",
          "9699:  checkResponseCode(t, http.StatusBadRequest, rr)",
          "9701:  req, err = http.NewRequest(http.MethodGet, path.Join(sharesPath, objectID, \"dirs?path=%2F..\"), nil)",
          "9702:  assert.NoError(t, err)",
          "9703:  rr = executeRequest(req)",
          "9704:  checkResponseCode(t, http.StatusBadRequest, rr)",
          "9706:  req, err = http.NewRequest(http.MethodGet, path.Join(sharesPath, objectID, \"files?path=%2F..%2F\"+testFileName), nil)",
          "9707:  assert.NoError(t, err)",
          "9708:  rr = executeRequest(req)",
          "9709:  checkResponseCode(t, http.StatusBadRequest, rr)",
          "9711:  req, err = http.NewRequest(http.MethodGet, path.Join(webClientPubSharesPath, objectID, \"browse?path=\"+testFileName), nil)",
          "9712:  assert.NoError(t, err)",
          "9713:  rr = executeRequest(req)",
          "9714:  checkResponseCode(t, http.StatusOK, rr)",
          "9715:  contentDisposition := rr.Header().Get(\"Content-Disposition\")",
          "9716:  assert.NotEmpty(t, contentDisposition)",
          "9718:  req, err = http.NewRequest(http.MethodGet, path.Join(sharesPath, objectID, \"files?path=\"+testFileName), nil)",
          "9719:  assert.NoError(t, err)",
          "9720:  rr = executeRequest(req)",
          "9721:  checkResponseCode(t, http.StatusOK, rr)",
          "9722:  contentDisposition = rr.Header().Get(\"Content-Disposition\")",
          "9723:  assert.NotEmpty(t, contentDisposition)",
          "9725:  req, err = http.NewRequest(http.MethodGet, path.Join(webClientPubSharesPath, objectID, \"browse?path=\"+subDir+\"%2F\"+testFileName), nil)",
          "9726:  assert.NoError(t, err)",
          "9727:  rr = executeRequest(req)",
          "9728:  checkResponseCode(t, http.StatusOK, rr)",
          "9729:  contentDisposition = rr.Header().Get(\"Content-Disposition\")",
          "9730:  assert.NotEmpty(t, contentDisposition)",
          "9732:  req, err = http.NewRequest(http.MethodGet, path.Join(webClientPubSharesPath, objectID, \"browse?path=missing\"), nil)",
          "9733:  assert.NoError(t, err)",
          "9734:  rr = executeRequest(req)",
          "9735:  checkResponseCode(t, http.StatusOK, rr)",
          "9736:  assert.Contains(t, rr.Body.String(), \"file does not exist\")",
          "9738:  req, err = http.NewRequest(http.MethodGet, path.Join(sharesPath, objectID, \"files?path=missing\"), nil)",
          "9739:  assert.NoError(t, err)",
          "9740:  rr = executeRequest(req)",
          "9741:  checkResponseCode(t, http.StatusNotFound, rr)",
          "9743:  req, err = http.NewRequest(http.MethodGet, path.Join(webClientPubSharesPath, objectID, \"dirs?path=missing\"), nil)",
          "9744:  assert.NoError(t, err)",
          "9745:  rr = executeRequest(req)",
          "9746:  checkResponseCode(t, http.StatusNotFound, rr)",
          "9748:  req, err = http.NewRequest(http.MethodGet, path.Join(sharesPath, objectID, \"dirs?path=missing\"), nil)",
          "9749:  assert.NoError(t, err)",
          "9750:  rr = executeRequest(req)",
          "9751:  checkResponseCode(t, http.StatusNotFound, rr)",
          "9753:  req, err = http.NewRequest(http.MethodGet, path.Join(webClientPubSharesPath, objectID, \"browse?path=\"+testFileNameLink), nil)",
          "9754:  assert.NoError(t, err)",
          "9755:  rr = executeRequest(req)",
          "9756:  checkResponseCode(t, http.StatusOK, rr)",
          "9757:  assert.Contains(t, rr.Body.String(), \"non regular files are not supported for shares\")",
          "9759:  req, err = http.NewRequest(http.MethodGet, path.Join(sharesPath, objectID, \"files?path=\"+testFileNameLink), nil)",
          "9760:  assert.NoError(t, err)",
          "9761:  rr = executeRequest(req)",
          "9762:  checkResponseCode(t, http.StatusBadRequest, rr)",
          "9763:  assert.Contains(t, rr.Body.String(), \"non regular files are not supported for shares\")",
          "9766:  share = dataprovider.Share{",
          "9767:   Name:      \"test share browse\",",
          "9768:   Scope:     dataprovider.ShareScopeRead,",
          "9769:   Paths:     []string{path.Join(shareDir, testFileNameLink)},",
          "9770:   MaxTokens: 0,",
          "9771:  }",
          "9772:  asJSON, err = json.Marshal(share)",
          "9773:  assert.NoError(t, err)",
          "9774:  req, err = http.NewRequest(http.MethodPost, userSharesPath, bytes.NewBuffer(asJSON))",
          "9775:  assert.NoError(t, err)",
          "9776:  setBearerForReq(req, token)",
          "9777:  rr = executeRequest(req)",
          "9778:  checkResponseCode(t, http.StatusCreated, rr)",
          "9779:  objectID = rr.Header().Get(\"X-Object-ID\")",
          "9780:  assert.NotEmpty(t, objectID)",
          "9782:  req, err = http.NewRequest(http.MethodGet, webClientPubSharesPath+\"/\"+objectID+\"?compress=false\", nil)",
          "9783:  assert.NoError(t, err)",
          "9784:  rr = executeRequest(req)",
          "9785:  checkResponseCode(t, http.StatusOK, rr)",
          "9786:  assert.Equal(t, \"application/zip\", rr.Header().Get(\"Content-Type\"))",
          "9788:  req, err = http.NewRequest(http.MethodGet, path.Join(sharesPath, objectID, \"dirs\"), nil)",
          "9789:  assert.NoError(t, err)",
          "9790:  rr = executeRequest(req)",
          "9791:  checkResponseCode(t, http.StatusBadRequest, rr)",
          "9793:  req, err = http.NewRequest(http.MethodGet, path.Join(sharesPath, objectID, \"files?path=\"+testFileName), nil)",
          "9794:  assert.NoError(t, err)",
          "9795:  rr = executeRequest(req)",
          "9796:  checkResponseCode(t, http.StatusBadRequest, rr)",
          "9798:  req, err = http.NewRequest(http.MethodGet, path.Join(webClientPubSharesPath, objectID, \"dirs?path=%2F\"), nil)",
          "9799:  assert.NoError(t, err)",
          "9800:  rr = executeRequest(req)",
          "9801:  checkResponseCode(t, http.StatusBadRequest, rr)",
          "9802:  assert.Contains(t, rr.Body.String(), \"The shared object is not a directory and so it is not browsable\")",
          "9804:  req, err = http.NewRequest(http.MethodGet, path.Join(webClientPubSharesPath, objectID, \"browse?path=%2F\"), nil)",
          "9805:  assert.NoError(t, err)",
          "9806:  rr = executeRequest(req)",
          "9807:  checkResponseCode(t, http.StatusBadRequest, rr)",
          "9808:  assert.Contains(t, rr.Body.String(), \"The shared object is not a directory and so it is not browsable\")",
          "9811:  objectID = \"123456\"",
          "9812:  req, err = http.NewRequest(http.MethodGet, path.Join(sharesPath, objectID, \"dirs\"), nil)",
          "9813:  assert.NoError(t, err)",
          "9814:  rr = executeRequest(req)",
          "9815:  checkResponseCode(t, http.StatusNotFound, rr)",
          "9817:  req, err = http.NewRequest(http.MethodGet, path.Join(sharesPath, objectID, \"files?path=\"+testFileName), nil)",
          "9818:  assert.NoError(t, err)",
          "9819:  rr = executeRequest(req)",
          "9820:  checkResponseCode(t, http.StatusNotFound, rr)",
          "9822:  req, err = http.NewRequest(http.MethodGet, path.Join(webClientPubSharesPath, objectID, \"dirs?path=%2F\"), nil)",
          "9823:  assert.NoError(t, err)",
          "9824:  rr = executeRequest(req)",
          "9825:  checkResponseCode(t, http.StatusNotFound, rr)",
          "9827:  req, err = http.NewRequest(http.MethodGet, path.Join(webClientPubSharesPath, objectID, \"browse?path=%2F\"), nil)",
          "9828:  assert.NoError(t, err)",
          "9829:  rr = executeRequest(req)",
          "9830:  checkResponseCode(t, http.StatusNotFound, rr)",
          "9832:  share = dataprovider.Share{",
          "9833:   Name:      \"test share\",",
          "9834:   Scope:     dataprovider.ShareScopeRead,",
          "9835:   Paths:     []string{path.Join(shareDir, \"missingdir\")},",
          "9836:   MaxTokens: 0,",
          "9837:  }",
          "9838:  asJSON, err = json.Marshal(share)",
          "9839:  assert.NoError(t, err)",
          "9840:  req, err = http.NewRequest(http.MethodPost, userSharesPath, bytes.NewBuffer(asJSON))",
          "9841:  assert.NoError(t, err)",
          "9842:  setBearerForReq(req, token)",
          "9843:  rr = executeRequest(req)",
          "9844:  checkResponseCode(t, http.StatusCreated, rr)",
          "9845:  objectID = rr.Header().Get(\"X-Object-ID\")",
          "9846:  assert.NotEmpty(t, objectID)",
          "9848:  req, err = http.NewRequest(http.MethodGet, path.Join(sharesPath, objectID, \"dirs\"), nil)",
          "9849:  assert.NoError(t, err)",
          "9850:  rr = executeRequest(req)",
          "9851:  checkResponseCode(t, http.StatusInternalServerError, rr)",
          "9852:  assert.Contains(t, rr.Body.String(), \"unable to check the share directory\")",
          "9854:  share = dataprovider.Share{",
          "9855:   Name:      \"test share\",",
          "9856:   Scope:     dataprovider.ShareScopeRead,",
          "9857:   Paths:     []string{shareDir, \"/anotherdir\"},",
          "9858:   MaxTokens: 0,",
          "9859:  }",
          "9860:  asJSON, err = json.Marshal(share)",
          "9861:  assert.NoError(t, err)",
          "9862:  req, err = http.NewRequest(http.MethodPost, userSharesPath, bytes.NewBuffer(asJSON))",
          "9863:  assert.NoError(t, err)",
          "9864:  setBearerForReq(req, token)",
          "9865:  rr = executeRequest(req)",
          "9866:  checkResponseCode(t, http.StatusCreated, rr)",
          "9867:  objectID = rr.Header().Get(\"X-Object-ID\")",
          "9868:  assert.NotEmpty(t, objectID)",
          "9869:  req, err = http.NewRequest(http.MethodGet, path.Join(webClientPubSharesPath, objectID, \"browse?path=%2F\"), nil)",
          "9870:  assert.NoError(t, err)",
          "9871:  rr = executeRequest(req)",
          "9872:  checkResponseCode(t, http.StatusBadRequest, rr)",
          "9873:  assert.Contains(t, rr.Body.String(), \"A share with multiple paths is not browsable\")",
          "9875:  share = dataprovider.Share{",
          "9876:   Name:      \"test share root\",",
          "9877:   Scope:     dataprovider.ShareScopeRead,",
          "9878:   Paths:     []string{\"/\"},",
          "9879:   MaxTokens: 0,",
          "9880:  }",
          "9881:  asJSON, err = json.Marshal(share)",
          "9882:  assert.NoError(t, err)",
          "9883:  req, err = http.NewRequest(http.MethodPost, userSharesPath, bytes.NewBuffer(asJSON))",
          "9884:  assert.NoError(t, err)",
          "9885:  setBearerForReq(req, token)",
          "9886:  rr = executeRequest(req)",
          "9887:  checkResponseCode(t, http.StatusCreated, rr)",
          "9888:  objectID = rr.Header().Get(\"X-Object-ID\")",
          "9889:  assert.NotEmpty(t, objectID)",
          "9891:  req, err = http.NewRequest(http.MethodGet, path.Join(webClientPubSharesPath, objectID, \"browse?path=%2F\"), nil)",
          "9892:  assert.NoError(t, err)",
          "9893:  rr = executeRequest(req)",
          "9894:  checkResponseCode(t, http.StatusOK, rr)",
          "9896:  req, err = http.NewRequest(http.MethodGet, path.Join(sharesPath, objectID, \"dirs?path=%2F\"), nil)",
          "9897:  assert.NoError(t, err)",
          "9898:  rr = executeRequest(req)",
          "9899:  checkResponseCode(t, http.StatusOK, rr)",
          "9900:  contents = make([]map[string]interface{}, 0)",
          "9901:  err = json.Unmarshal(rr.Body.Bytes(), &contents)",
          "9902:  assert.NoError(t, err)",
          "9903:  assert.Len(t, contents, 1)",
          "9905:  _, err = httpdtest.RemoveUser(user, http.StatusOK)",
          "9906:  assert.NoError(t, err)",
          "9907:  err = os.RemoveAll(user.GetHomeDir())",
          "9908:  assert.NoError(t, err)",
          "9909: }",
          "",
          "---------------"
        ],
        "httpd/internal_test.go||httpd/internal_test.go": [
          "File: httpd/internal_test.go -> httpd/internal_test.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "2187:  err = doMetadataCheck(user)",
          "2188:  assert.Error(t, err)",
          "2189: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2191: func TestBrowsableSharePaths(t *testing.T) {",
          "2192:  share := dataprovider.Share{",
          "2193:   Paths: []string{\"/\"},",
          "2194:  }",
          "2195:  req, err := http.NewRequest(http.MethodGet, \"/share\", nil)",
          "2196:  require.NoError(t, err)",
          "2197:  name, err := getBrowsableSharedPath(share, req)",
          "2198:  assert.NoError(t, err)",
          "2199:  assert.Equal(t, \"/\", name)",
          "2200:  req, err = http.NewRequest(http.MethodGet, \"/share?path=abc\", nil)",
          "2201:  require.NoError(t, err)",
          "2202:  name, err = getBrowsableSharedPath(share, req)",
          "2203:  assert.NoError(t, err)",
          "2204:  assert.Equal(t, \"/abc\", name)",
          "2206:  share.Paths = []string{\"/a/b/c\"}",
          "2207:  req, err = http.NewRequest(http.MethodGet, \"/share?path=abc\", nil)",
          "2208:  require.NoError(t, err)",
          "2209:  name, err = getBrowsableSharedPath(share, req)",
          "2210:  assert.NoError(t, err)",
          "2211:  assert.Equal(t, \"/a/b/c/abc\", name)",
          "2212:  req, err = http.NewRequest(http.MethodGet, \"/share?path=%2Fabc/d\", nil)",
          "2213:  require.NoError(t, err)",
          "2214:  name, err = getBrowsableSharedPath(share, req)",
          "2215:  assert.NoError(t, err)",
          "2216:  assert.Equal(t, \"/a/b/c/abc/d\", name)",
          "2218:  req, err = http.NewRequest(http.MethodGet, \"/share?path=%2Fabc%2F..%2F..\", nil)",
          "2219:  require.NoError(t, err)",
          "2220:  _, err = getBrowsableSharedPath(share, req)",
          "2221:  assert.Error(t, err)",
          "2223:  req, err = http.NewRequest(http.MethodGet, \"/share?path=%2Fabc%2F..\", nil)",
          "2224:  require.NoError(t, err)",
          "2225:  name, err = getBrowsableSharedPath(share, req)",
          "2226:  assert.NoError(t, err)",
          "2227:  assert.Equal(t, \"/a/b/c\", name)",
          "2229:  share = dataprovider.Share{",
          "2230:   Paths: []string{\"/a\", \"/b\"},",
          "2231:  }",
          "2232: }",
          "",
          "---------------"
        ],
        "httpd/server.go||httpd/server.go": [
          "File: httpd/server.go -> httpd/server.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "1007:  s.router.Get(sharesPath+\"/{id}\", downloadFromShare)",
          "1008:  s.router.Post(sharesPath+\"/{id}\", uploadFilesToShare)",
          "1009:  s.router.Post(sharesPath+\"/{id}/{name}\", uploadFileToShare)",
          "1011:  s.router.Get(tokenPath, s.getToken)",
          "1012:  s.router.Post(adminPath+\"/{username}/forgot-password\", forgotAdminPassword)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1010:  s.router.Get(sharesPath+\"/{id}/dirs\", readBrowsableShareContents)",
          "1011:  s.router.Get(sharesPath+\"/{id}/files\", downloadBrowsableSharedFile)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1226:    Post(webClientTwoFactorRecoveryPath, s.handleWebClientTwoFactorRecoveryPost)",
          "1228:   s.router.Get(webClientPubSharesPath+\"/{id}\", downloadFromShare)",
          "1229:   s.router.Post(webClientPubSharesPath+\"/{id}\", uploadFilesToShare)",
          "1230:   s.router.Post(webClientPubSharesPath+\"/{id}/{name}\", uploadFileToShare)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1231:   s.router.Get(webClientPubSharesPath+\"/{id}/browse\", s.handleShareGetFiles)",
          "1232:   s.router.Get(webClientPubSharesPath+\"/{id}/dirs\", s.handleShareGetDirContents)",
          "",
          "---------------"
        ],
        "httpd/webclient.go||httpd/webclient.go": [
          "File: httpd/webclient.go -> httpd/webclient.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "45:  templateClientShare             = \"share.html\"",
          "46:  templateClientShares            = \"shares.html\"",
          "47:  templateClientViewPDF           = \"viewpdf.html\"",
          "48:  pageClientFilesTitle            = \"My Files\"",
          "49:  pageClientSharesTitle           = \"Shares\"",
          "50:  pageClientProfileTitle          = \"My Profile\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "48:  templateShareFiles              = \"sharefiles.html\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "53:  pageClientEditFileTitle         = \"Edit file\"",
          "54:  pageClientForgotPwdTitle        = \"SFTPGo WebClient - Forgot password\"",
          "55:  pageClientResetPwdTitle         = \"SFTPGo WebClient - Reset password\"",
          "56: )",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "57:  pageExtShareTitle               = \"Shared files\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "134:  HasIntegrations bool",
          "135: }",
          "137: type clientMessagePage struct {",
          "138:  baseClientPage",
          "139:  Error   string",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "139: type shareFilesPage struct {",
          "140:  baseClientPage",
          "141:  CurrentDir  string",
          "142:  DirsURL     string",
          "143:  FilesURL    string",
          "144:  DownloadURL string",
          "145:  Error       string",
          "146:  Paths       []dirMapping",
          "147: }",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "179:  IsAdd bool",
          "180: }",
          "184: }",
          "186: func getFileObjectModTime(t time.Time) string {",
          "",
          "[Removed Lines]",
          "182: func getFileObjectURL(baseDir, name string) string {",
          "183:  return fmt.Sprintf(\"%v?path=%v&_=%v\", webClientFilesPath, url.QueryEscape(path.Join(baseDir, name)), time.Now().UTC().Unix())",
          "",
          "[Added Lines]",
          "194: func getFileObjectURL(baseDir, name, baseWebPath string) string {",
          "195:  return fmt.Sprintf(\"%v?path=%v&_=%v\", baseWebPath, url.QueryEscape(path.Join(baseDir, name)), time.Now().UTC().Unix())",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "244:  viewPDFPaths := []string{",
          "245:   filepath.Join(templatesPath, templateClientDir, templateClientViewPDF),",
          "246:  }",
          "248:  filesTmpl := util.LoadTemplate(nil, filesPaths...)",
          "249:  profileTmpl := util.LoadTemplate(nil, profilePaths...)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "259:  shareFilesPath := []string{",
          "260:   filepath.Join(templatesPath, templateClientDir, templateClientBase),",
          "261:   filepath.Join(templatesPath, templateClientDir, templateShareFiles),",
          "262:  }",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "259:  forgotPwdTmpl := util.LoadTemplate(nil, forgotPwdPaths...)",
          "260:  resetPwdTmpl := util.LoadTemplate(nil, resetPwdPaths...)",
          "261:  viewPDFTmpl := util.LoadTemplate(nil, viewPDFPaths...)",
          "263:  clientTemplates[templateClientFiles] = filesTmpl",
          "264:  clientTemplates[templateClientProfile] = profileTmpl",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "278:  shareFilesTmpl := util.LoadTemplate(nil, shareFilesPath...)",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "274:  clientTemplates[templateForgotPassword] = forgotPwdTmpl",
          "275:  clientTemplates[templateResetPassword] = resetPwdTmpl",
          "276:  clientTemplates[templateClientViewPDF] = viewPDFTmpl",
          "277: }",
          "279: func getBaseClientPageData(title, currentURL string, r *http.Request) baseClientPage {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "294:  clientTemplates[templateShareFiles] = shareFilesTmpl",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "440:  renderClientTemplate(w, templateClientShare, data)",
          "441: }",
          "443: func renderFilesPage(w http.ResponseWriter, r *http.Request, dirName, error string, user dataprovider.User,",
          "444:  hasIntegrations bool,",
          "445: ) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "461: func getDirMapping(dirName, baseWebPath string) []dirMapping {",
          "462:  paths := []dirMapping{}",
          "463:  if dirName != \"/\" {",
          "464:   paths = append(paths, dirMapping{",
          "465:    DirName: path.Base(dirName),",
          "466:    Href:    \"\",",
          "467:   })",
          "468:   for {",
          "469:    dirName = path.Dir(dirName)",
          "470:    if dirName == \"/\" || dirName == \".\" {",
          "471:     break",
          "472:    }",
          "473:    paths = append([]dirMapping{{",
          "474:     DirName: path.Base(dirName),",
          "475:     Href:    getFileObjectURL(\"/\", dirName, baseWebPath)},",
          "476:    }, paths...)",
          "477:   }",
          "478:  }",
          "479:  return paths",
          "480: }",
          "482: func renderSharedFilesPage(w http.ResponseWriter, r *http.Request, dirName, error string, share dataprovider.Share) {",
          "483:  currentURL := path.Join(webClientPubSharesPath, share.ShareID, \"browse\")",
          "484:  data := shareFilesPage{",
          "485:   baseClientPage: getBaseClientPageData(pageExtShareTitle, currentURL, r),",
          "486:   CurrentDir:     url.QueryEscape(dirName),",
          "487:   DirsURL:        path.Join(webClientPubSharesPath, share.ShareID, \"dirs\"),",
          "488:   FilesURL:       currentURL,",
          "489:   DownloadURL:    path.Join(webClientPubSharesPath, share.ShareID),",
          "490:   Error:          error,",
          "491:   Paths:          getDirMapping(dirName, currentURL),",
          "492:  }",
          "493:  renderClientTemplate(w, templateShareFiles, data)",
          "494: }",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "458:   CanDownload:     user.HasPerm(dataprovider.PermDownload, dirName),",
          "459:   CanShare:        user.CanManageShares(),",
          "460:   HasIntegrations: hasIntegrations,",
          "461:  }",
          "480:  renderClientTemplate(w, templateClientFiles, data)",
          "481: }",
          "",
          "[Removed Lines]",
          "462:  paths := []dirMapping{}",
          "463:  if dirName != \"/\" {",
          "464:   paths = append(paths, dirMapping{",
          "465:    DirName: path.Base(dirName),",
          "466:    Href:    \"\",",
          "467:   })",
          "468:   for {",
          "469:    dirName = path.Dir(dirName)",
          "470:    if dirName == \"/\" || dirName == \".\" {",
          "471:     break",
          "472:    }",
          "473:    paths = append([]dirMapping{{",
          "474:     DirName: path.Base(dirName),",
          "475:     Href:    getFileObjectURL(\"/\", dirName)},",
          "476:    }, paths...)",
          "477:   }",
          "478:  }",
          "479:  data.Paths = paths",
          "",
          "[Added Lines]",
          "514:   Paths:           getDirMapping(dirName, webClientFilesPath),",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "560:  renderCompressedFiles(w, connection, name, filesList, nil)",
          "561: }",
          "563: func (s *httpdServer) handleClientGetDirContents(w http.ResponseWriter, r *http.Request) {",
          "564:  r.Body = http.MaxBytesReader(w, r.Body, maxRequestSize)",
          "565:  claims, err := getTokenClaims(r)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "599: func (s *httpdServer) handleShareGetDirContents(w http.ResponseWriter, r *http.Request) {",
          "600:  r.Body = http.MaxBytesReader(w, r.Body, maxRequestSize)",
          "601:  share, connection, err := checkPublicShare(w, r, dataprovider.ShareScopeRead)",
          "602:  if err != nil {",
          "603:   return",
          "604:  }",
          "605:  if err := validateBrowsableShare(share, connection); err != nil {",
          "606:   renderClientMessagePage(w, r, \"Unable to validate share\", \"\", getRespStatus(err), err, \"\")",
          "607:   return",
          "608:  }",
          "609:  name, err := getBrowsableSharedPath(share, r)",
          "610:  if err != nil {",
          "611:   renderClientMessagePage(w, r, \"Invalid share path\", \"\", getRespStatus(err), err, \"\")",
          "612:   return",
          "613:  }",
          "614:  common.Connections.Add(connection)",
          "615:  defer common.Connections.Remove(connection.GetID())",
          "617:  contents, err := connection.ReadDir(name)",
          "618:  if err != nil {",
          "619:   sendAPIResponse(w, r, err, \"Unable to get directory contents\", getMappedStatusCode(err))",
          "620:   return",
          "621:  }",
          "622:  results := make([]map[string]string, 0, len(contents))",
          "623:  for _, info := range contents {",
          "624:   if !info.Mode().IsDir() && !info.Mode().IsRegular() {",
          "625:    continue",
          "626:   }",
          "627:   res := make(map[string]string)",
          "628:   if info.IsDir() {",
          "629:    res[\"type\"] = \"1\"",
          "630:    res[\"size\"] = \"\"",
          "631:   } else {",
          "632:    res[\"type\"] = \"2\"",
          "633:    res[\"size\"] = util.ByteCountIEC(info.Size())",
          "634:   }",
          "635:   res[\"name\"] = info.Name()",
          "636:   res[\"url\"] = getFileObjectURL(share.GetRelativePath(name), info.Name(),",
          "637:    path.Join(webClientPubSharesPath, share.ShareID, \"browse\"))",
          "638:   res[\"last_modified\"] = getFileObjectModTime(info.ModTime())",
          "639:   results = append(results, res)",
          "640:  }",
          "642:  render.JSON(w, r, results)",
          "643: }",
          "645: func (s *httpdServer) handleShareGetFiles(w http.ResponseWriter, r *http.Request) {",
          "646:  r.Body = http.MaxBytesReader(w, r.Body, maxRequestSize)",
          "647:  share, connection, err := checkPublicShare(w, r, dataprovider.ShareScopeRead)",
          "648:  if err != nil {",
          "649:   return",
          "650:  }",
          "651:  if err := validateBrowsableShare(share, connection); err != nil {",
          "652:   renderClientMessagePage(w, r, \"Unable to validate share\", \"\", getRespStatus(err), err, \"\")",
          "653:   return",
          "654:  }",
          "655:  name, err := getBrowsableSharedPath(share, r)",
          "656:  if err != nil {",
          "657:   renderClientMessagePage(w, r, \"Invalid share path\", \"\", getRespStatus(err), err, \"\")",
          "658:   return",
          "659:  }",
          "661:  common.Connections.Add(connection)",
          "662:  defer common.Connections.Remove(connection.GetID())",
          "664:  var info os.FileInfo",
          "665:  if name == \"/\" {",
          "666:   info = vfs.NewFileInfo(name, true, 0, time.Now(), false)",
          "667:  } else {",
          "668:   info, err = connection.Stat(name, 1)",
          "669:  }",
          "670:  if err != nil {",
          "671:   renderSharedFilesPage(w, r, path.Dir(share.GetRelativePath(name)), err.Error(), share)",
          "672:   return",
          "673:  }",
          "674:  if info.IsDir() {",
          "675:   renderSharedFilesPage(w, r, share.GetRelativePath(name), \"\", share)",
          "676:   return",
          "677:  }",
          "678:  inline := r.URL.Query().Get(\"inline\") != \"\"",
          "679:  dataprovider.UpdateShareLastUse(&share, 1) //nolint:errcheck",
          "680:  if status, err := downloadFile(w, r, connection, name, info, inline, &share); err != nil {",
          "681:   dataprovider.UpdateShareLastUse(&share, -1) //nolint:errcheck",
          "682:   if status > 0 {",
          "683:    renderSharedFilesPage(w, r, path.Dir(share.GetRelativePath(name)), err.Error(), share)",
          "684:   }",
          "685:  }",
          "686: }",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "602:  results := make([]map[string]string, 0, len(contents))",
          "603:  for _, info := range contents {",
          "604:   res := make(map[string]string)",
          "606:   if info.IsDir() {",
          "607:    res[\"type\"] = \"1\"",
          "608:    res[\"size\"] = \"\"",
          "",
          "[Removed Lines]",
          "605:   res[\"url\"] = getFileObjectURL(name, info.Name())",
          "",
          "[Added Lines]",
          "730:   res[\"url\"] = getFileObjectURL(name, info.Name(), webClientFilesPath)",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "685:   return",
          "686:  }",
          "687:  inline := r.URL.Query().Get(\"inline\") != \"\"",
          "689:   if status > 0 {",
          "690:    if status == http.StatusRequestedRangeNotSatisfiable {",
          "691:     renderClientMessagePage(w, r, http.StatusText(status), \"\", status, err, \"\")",
          "",
          "[Removed Lines]",
          "688:  if status, err := downloadFile(w, r, connection, name, info, inline); err != nil && status != 0 {",
          "",
          "[Added Lines]",
          "813:  if status, err := downloadFile(w, r, connection, name, info, inline, nil); err != nil && status != 0 {",
          "",
          "---------------"
        ],
        "pkgs/build.sh||pkgs/build.sh": [
          "File: pkgs/build.sh -> pkgs/build.sh",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: #!/bin/bash",
          "4: NFPM_ARCH=${NFPM_ARCH:-amd64}",
          "5: if [ -z ${SFTPGO_VERSION} ]",
          "6: then",
          "",
          "[Removed Lines]",
          "3: NFPM_VERSION=2.11.3",
          "",
          "[Added Lines]",
          "3: NFPM_VERSION=2.12.1",
          "",
          "---------------"
        ],
        "templates/webclient/files.html||templates/webclient/files.html": [
          "File: templates/webclient/files.html -> templates/webclient/files.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "1088:                 table.buttons().container().appendTo('.col-md-6:eq(0)', table.table().container());",
          "1089:             },",
          "1090:             \"orderFixed\": [1, 'asc'],",
          "1092:         });",
          "1094:         new $.fn.dataTable.FixedHeader(table);",
          "",
          "[Removed Lines]",
          "1091:             \"order\": [[2, 'asc']]",
          "",
          "[Added Lines]",
          "1091:             \"order\": [2, 'asc']",
          "",
          "---------------"
        ],
        "templates/webclient/sharefiles.html||templates/webclient/sharefiles.html": [
          "File: templates/webclient/sharefiles.html -> templates/webclient/sharefiles.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: {{template \"base\" .}}",
          "3: {{define \"title\"}}{{.Title}}{{end}}",
          "5: {{define \"extra_css\"}}",
          "6: <link href=\"{{.StaticURL}}/vendor/datatables/dataTables.bootstrap4.min.css\" rel=\"stylesheet\">",
          "7: <link href=\"{{.StaticURL}}/vendor/datatables/buttons.bootstrap4.min.css\" rel=\"stylesheet\">",
          "8: <link href=\"{{.StaticURL}}/vendor/datatables/fixedHeader.bootstrap4.min.css\" rel=\"stylesheet\">",
          "9: <link href=\"{{.StaticURL}}/vendor/datatables/responsive.bootstrap4.min.css\" rel=\"stylesheet\">",
          "10: {{end}}",
          "12: {{define \"page_body\"}}",
          "13: <div class=\"card shadow my-4\">",
          "14:     <div class=\"card-header py-3\">",
          "15:         <h6 class=\"m-0 font-weight-bold\"><a href=\"{{.FilesURL}}?path=%2F\"><i class=\"fas fa-home\"></i>&nbsp;Home</a>&nbsp;{{range .Paths}}{{if eq .Href \"\"}}/{{.DirName}}{{else}}<a href=\"{{.Href}}\">/{{.DirName}}</a>{{end}}{{end}}</h6>",
          "16:     </div>",
          "17:     <div class=\"card-body\">",
          "18:         {{if .Error}}",
          "19:         <div class=\"card mb-4 border-left-warning\">",
          "20:             <div class=\"card-body text-form-error\">{{.Error}}</div>",
          "21:         </div>",
          "22:         {{end}}",
          "23:         <div id=\"errorMsg\" class=\"card mb-4 border-left-warning\" style=\"display: none;\">",
          "24:             <div id=\"errorTxt\" class=\"card-body text-form-error\"></div>",
          "25:         </div>",
          "26:         <div class=\"table-responsive\">",
          "27:             <table class=\"table table-hover nowrap\" id=\"dataTable\" width=\"100%\" cellspacing=\"0\">",
          "28:                 <thead>",
          "29:                     <tr>",
          "30:                         <th>Type</th>",
          "31:                         <th>Name</th>",
          "32:                         <th>Size</th>",
          "33:                         <th>Last modified</th>",
          "34:                     </tr>",
          "35:                 </thead>",
          "36:             </table>",
          "37:         </div>",
          "38:     </div>",
          "39: </div>",
          "40: {{end}}",
          "42: {{define \"extra_js\"}}",
          "43: <script src=\"{{.StaticURL}}/vendor/datatables/jquery.dataTables.min.js\"></script>",
          "44: <script src=\"{{.StaticURL}}/vendor/datatables/dataTables.bootstrap4.min.js\"></script>",
          "45: <script src=\"{{.StaticURL}}/vendor/datatables/dataTables.buttons.min.js\"></script>",
          "46: <script src=\"{{.StaticURL}}/vendor/datatables/buttons.bootstrap4.min.js\"></script>",
          "47: <script src=\"{{.StaticURL}}/vendor/datatables/dataTables.fixedHeader.min.js\"></script>",
          "48: <script src=\"{{.StaticURL}}/vendor/datatables/dataTables.responsive.min.js\"></script>",
          "49: <script src=\"{{.StaticURL}}/vendor/datatables/responsive.bootstrap4.min.js\"></script>",
          "50: <script type=\"text/javascript\">",
          "52:     var escapeHTML = function ( t ) {",
          "53:   return t",
          "54:    .replace( /&/g, '&amp;' )",
          "55:    .replace( /</g, '&lt;' )",
          "56:    .replace( />/g, '&gt;' )",
          "57:    .replace( /\"/g, '&quot;' );",
          "58:  };",
          "60:     function shortenData(d, cutoff) {",
          "61:         if ( typeof d !== 'string' ) {",
          "62:    return d;",
          "63:   }",
          "65:   if ( d.length <= cutoff ) {",
          "66:    return d;",
          "67:   }",
          "69:         var shortened = d.substr(0, cutoff-1);",
          "70:         return shortened+'&#8230;';",
          "71:     }",
          "73:     function getIconForFile(filename) {",
          "74:         var extension = filename.slice((filename.lastIndexOf(\".\") - 1 >>> 0) + 2).toLowerCase();",
          "75:         switch (extension) {",
          "76:             case \"doc\":",
          "77:             case \"docx\":",
          "78:             case \"odt\":",
          "79:             case \"wps\":",
          "80:                 return \"far fa-file-word\";",
          "81:             case \"ppt\":",
          "82:             case \"pptx\":",
          "83:                 return \"far fa-file-powerpoint\";",
          "84:             case \"xls\":",
          "85:             case \"xlsx\":",
          "86:             case \"ods\":",
          "87:                 return \"far fa-file-excel\";",
          "88:             case \"pdf\":",
          "89:                 return \"far fa-file-pdf\";",
          "90:             case \"webm\":",
          "91:             case \"mkv\":",
          "92:             case \"flv\":",
          "93:             case \"vob\":",
          "94:             case \"ogv\":",
          "95:             case \"ogg\":",
          "96:             case \"avi\":",
          "97:             case \"ts\":",
          "98:             case \"mov\":",
          "99:             case \"wmv\":",
          "100:             case \"asf\":",
          "101:             case \"mpeg\":",
          "102:             case \"mpv\":",
          "103:             case \"3gp\":",
          "104:                 return \"far fa-file-video\";",
          "105:             case \"jpeg\":",
          "106:             case \"jpg\":",
          "107:             case \"png\":",
          "108:             case \"gif\":",
          "109:             case \"webp\":",
          "110:             case \"tiff\":",
          "111:             case \"psd\":",
          "112:             case \"bmp\":",
          "113:             case \"svg\":",
          "114:             case \"jp2\":",
          "115:                 return \"far fa-file-image\";",
          "116:             case \"go\":",
          "117:             case \"sh\":",
          "118:             case \"bat\":",
          "119:             case \"java\":",
          "120:             case \"php\":",
          "121:             case \"cs\":",
          "122:             case \"asp\":",
          "123:             case \"aspx\":",
          "124:             case \"css\":",
          "125:             case \"html\":",
          "126:             case \"xhtml\":",
          "127:             case \"htm\":",
          "128:             case \"js\":",
          "129:             case \"jsp\":",
          "130:             case \"py\":",
          "131:             case \"rb\":",
          "132:             case \"cgi\":",
          "133:             case \"c\":",
          "134:             case \"cpp\":",
          "135:             case \"h\":",
          "136:             case \"hpp\":",
          "137:             case \"kt\":",
          "138:             case \"ktm\":",
          "139:             case \"kts\":",
          "140:             case \"swift\":",
          "141:             case \"r\":",
          "142:                 return \"far fa-file-code\";",
          "143:             case \"zip\":",
          "144:             case \"zipx\":",
          "145:             case \"rar\":",
          "146:             case \"tar\":",
          "147:             case \"gz\":",
          "148:             case \"bz2\":",
          "149:             case \"zstd\":",
          "150:             case \"zst\":",
          "151:             case \"sz\":",
          "152:             case \"lz\":",
          "153:             case \"lz4\":",
          "154:             case \"xz\":",
          "155:             case \"jar\":",
          "156:                 return \"far fa-file-archive\";",
          "157:             case \"txt\":",
          "158:             case \"rtf\":",
          "159:             case \"json\":",
          "160:             case \"xml\":",
          "161:             case \"yaml\":",
          "162:             case \"toml\":",
          "163:             case \"log\":",
          "164:             case \"csv\":",
          "165:             case \"ini\":",
          "166:             case \"cfg\":",
          "167:                 return \"far fa-file-alt\";",
          "168:             default:",
          "169:                 return \"far fa-file\";",
          "170:         }",
          "171:     }",
          "173:     $(document).ready(function () {",
          "174:         $.fn.dataTable.ext.buttons.refresh = {",
          "175:             text: '<i class=\"fas fa-sync-alt\"></i>',",
          "176:             name: 'refresh',",
          "177:             titleAttr: \"Refresh\",",
          "178:             action: function (e, dt, node, config) {",
          "179:                 location.reload();",
          "180:             }",
          "181:         };",
          "183:         $.fn.dataTable.ext.buttons.download = {",
          "184:             text: '<i class=\"fas fa-download\"></i>',",
          "185:             name: 'download',",
          "186:             titleAttr: \"Download the whole share as zip\",",
          "187:             action: function (e, dt, node, config) {",
          "188:                 var downloadURL = '{{.DownloadURL}}';",
          "189:                 var ts = new Date().getTime().toString();",
          "190:                 window.location = `${downloadURL}?_=${ts}`;",
          "191:             }",
          "192:         };",
          "194:         var table = $('#dataTable').DataTable({",
          "195:             \"ajax\": {",
          "196:                 \"url\": \"{{.DirsURL}}?path={{.CurrentDir}}\",",
          "197:                 \"dataSrc\": \"\",",
          "198:                 \"error\": function ($xhr, textStatus, errorThrown) {",
          "199:                     $(\".dataTables_processing\").hide();",
          "200:                     var txt = \"Failed to get directory listing\";",
          "201:                     if ($xhr) {",
          "202:                         var json = $xhr.responseJSON;",
          "203:                         if (json) {",
          "204:                             if (json.message){",
          "205:                                 txt += \": \" + json.message;",
          "206:                             } else {",
          "207:                                 txt += \": \" + json.error;",
          "208:                             }",
          "209:                         }",
          "210:                     }",
          "211:                     $('#errorTxt').text(txt);",
          "212:                     $('#errorMsg').show();",
          "213:                     setTimeout(function () {",
          "214:                         $('#errorMsg').hide();",
          "215:                     }, 10000);",
          "216:                 }",
          "217:             },",
          "218:             \"deferRender\": true,",
          "219:             \"processing\": true,",
          "220:             \"lengthMenu\": [ 10, 25, 50, 100, 250, 500 ],",
          "221:             \"stateSave\": true,",
          "222:             \"stateDuration\": 0,",
          "223:             \"stateSaveParams\": function (settings, data) {",
          "224:                 data.sftpgo_dir = '{{.CurrentDir}}';",
          "225:             },",
          "226:             \"stateLoadParams\": function (settings, data) {",
          "227:                 if (!data.sftpgo_dir || data.sftpgo_dir != '{{.CurrentDir}}'){",
          "228:                     data.start = 0;",
          "229:                     data.search.search = \"\";",
          "230:                 }",
          "231:             },",
          "232:             \"columns\": [",
          "233:                 { \"data\": \"type\" },",
          "234:                 {",
          "235:                     \"data\": \"name\",",
          "236:                     \"render\": function (data, type, row) {",
          "237:                         if (type === 'display') {",
          "238:                             var title = \"\";",
          "239:                             var cssClass = \"\";",
          "240:                             var shortened = shortenData(data, 70);",
          "241:                             if (shortened != data){",
          "242:                                 title = escapeHTML(data);",
          "243:                                 cssClass = \"ellipsis\";",
          "244:                             }",
          "246:                             if (row[\"type\"] == \"1\") {",
          "247:                                 return `<i class=\"fas fa-folder\"></i>&nbsp;<a class=\"${cssClass}\" href=\"${row['url']}\" title=\"${title}\">${shortened}</a>`;",
          "248:                             }",
          "249:                             if (row[\"size\"] == \"\") {",
          "250:                                 return `<i class=\"fas fa-external-link-alt\"></i>&nbsp;<a class=\"${cssClass}\" href=\"${row['url']}\" title=\"${title}\">${shortened}</a>`;",
          "251:                             }",
          "252:                             var icon = getIconForFile(data);",
          "253:                             return `<i class=\"${icon}\"></i>&nbsp;<a class=\"${cssClass}\" href=\"${row['url']}\" title=\"${title}\">${shortened}</a>`;",
          "254:                         }",
          "255:                         return data;",
          "256:                     }",
          "257:                 },",
          "258:                 { \"data\": \"size\" },",
          "259:                 { \"data\": \"last_modified\" }",
          "260:             ],",
          "261:             \"buttons\": [],",
          "262:             \"lengthChange\": false,",
          "263:             \"columnDefs\": [",
          "264:                 {",
          "265:                     \"targets\": [0],",
          "266:                     \"visible\": false,",
          "267:                     \"searchable\": false",
          "268:                 },",
          "269:                 {",
          "270:                     \"targets\": [2, 3],",
          "271:                     \"searchable\": false",
          "272:                 }",
          "273:             ],",
          "274:             \"scrollX\": false,",
          "275:             \"scrollY\": false,",
          "276:             \"responsive\": true,",
          "277:             \"language\": {",
          "278:                 \"processing\": '<i class=\"fas fa-spinner fa-spin fa-3x fa-fw\"></i><span class=\"sr-only\">Loading...</span>',",
          "279:                 \"loadingRecords\": \"\",",
          "280:                 \"emptyTable\": \"No files or folders\"",
          "281:             },",
          "282:             \"initComplete\": function (settings, json) {",
          "283:                 table.button().add(0, 'refresh');",
          "284:                 table.button().add(0, 'pageLength');",
          "285:                 table.button().add(0, 'download');",
          "286:                 table.buttons().container().appendTo('.col-md-6:eq(0)', table.table().container());",
          "287:             },",
          "288:             \"orderFixed\": [0, 'asc'],",
          "289:             \"order\": [1, 'asc']",
          "290:         });",
          "292:         new $.fn.dataTable.FixedHeader(table);",
          "293:         $.fn.dataTable.ext.errMode = 'none';",
          "294:     });",
          "295: </script>",
          "296: {{end}}",
          "",
          "---------------"
        ],
        "templates/webclient/shares.html||templates/webclient/shares.html": [
          "File: templates/webclient/shares.html -> templates/webclient/shares.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "93:             <div class=\"modal-body\">",
          "94:                 <div id=\"readShare\">",
          "95:                     <p>You can download the shared contents, as single zip file, using this <a id=\"readLink\" href=\"#\" target=\"_blank\">link</a>.</p>",
          "97:                 </div>",
          "98:                 <div id=\"writeShare\">",
          "99:                     <p>You can upload one or more files to the shared directory by sending a multipart/form-data request to this <a id=\"writeLink\" href=\"#\" target=\"_blank\">link</a>. The form field name for the file(s) is <b><code>filenames</code></b>.</p>",
          "",
          "[Removed Lines]",
          "96:                     <p>If the share consists of a single file you can download it uncompressed using this <a id=\"readUncompressedLink\" href=\"#\" target=\"_blank\">link</a></p>",
          "",
          "[Added Lines]",
          "96:                     <p>If the share consists of a single folder you can browse and download single files using this <a id=\"readBrowseLink\" href=\"#\" target=\"_blank\">link</a>.</p>",
          "97:                     <p>If the share consists of a single file you can download it uncompressed using this <a id=\"readUncompressedLink\" href=\"#\" target=\"_blank\">link</a>.</p>",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "219:                         $('#readLink').attr(\"title\", shareURL);",
          "220:                         $('#readUncompressedLink').attr(\"href\", shareURL+\"?compress=false\");",
          "221:                         $('#readUncompressedLink').attr(\"title\", shareURL+\"?compress=false\");",
          "222:                     } else {",
          "223:                         $('#expiredShare').hide();",
          "224:                         $('#writeShare').show();",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "223:                         $('#readBrowseLink').attr(\"href\", shareURL+\"/browse\");",
          "224:                         $('#readBrowseLink').attr(\"title\", shareURL+\"/browse\");",
          "",
          "---------------"
        ],
        "version/version.go||version/version.go": [
          "File: version/version.go -> version/version.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: import \"strings\"",
          "7: var (",
          "8:  commit = \"\"",
          "",
          "[Removed Lines]",
          "5: const version = \"2.2.1-dev\"",
          "",
          "[Added Lines]",
          "5: const version = \"2.2.2-dev\"",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "c153330ab80598d3c1022ef3117f935a06a0a3f1",
      "candidate_info": {
        "commit_hash": "c153330ab80598d3c1022ef3117f935a06a0a3f1",
        "repo": "drakkan/sftpgo",
        "commit_url": "https://github.com/drakkan/sftpgo/commit/c153330ab80598d3c1022ef3117f935a06a0a3f1",
        "files": [
          "common/transfer.go",
          "dataprovider/user.go",
          "examples/webclient-integrations/test.html",
          "go.mod",
          "go.sum",
          "httpd/api_http_user.go",
          "httpd/api_shares.go",
          "httpd/httpd.go",
          "httpd/httpd_test.go",
          "httpd/server.go",
          "httpd/webclient.go",
          "openapi/openapi.yaml",
          "telemetry/telemetry.go",
          "templates/webadmin/folders.html",
          "templates/webadmin/users.html",
          "templates/webclient/editfile.html",
          "templates/webclient/files.html",
          "templates/webclient/shares.html",
          "webdavd/server.go"
        ],
        "message": "web client: use fetch to upload files\n\nalso add REST API to upload a single file as POST body",
        "before_after_code_files": [
          "common/transfer.go||common/transfer.go",
          "dataprovider/user.go||dataprovider/user.go",
          "examples/webclient-integrations/test.html||examples/webclient-integrations/test.html",
          "go.mod||go.mod",
          "go.sum||go.sum",
          "httpd/api_http_user.go||httpd/api_http_user.go",
          "httpd/api_shares.go||httpd/api_shares.go",
          "httpd/httpd.go||httpd/httpd.go",
          "httpd/httpd_test.go||httpd/httpd_test.go",
          "httpd/server.go||httpd/server.go",
          "httpd/webclient.go||httpd/webclient.go",
          "telemetry/telemetry.go||telemetry/telemetry.go",
          "templates/webadmin/folders.html||templates/webadmin/folders.html",
          "templates/webadmin/users.html||templates/webadmin/users.html",
          "templates/webclient/editfile.html||templates/webclient/editfile.html",
          "templates/webclient/files.html||templates/webclient/files.html",
          "templates/webclient/shares.html||templates/webclient/shares.html",
          "webdavd/server.go||webdavd/server.go"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "templates/webclient/files.html||templates/webclient/files.html"
          ],
          "candidate": [
            "templates/webclient/files.html||templates/webclient/files.html"
          ]
        }
      },
      "candidate_diff": {
        "common/transfer.go||common/transfer.go": [
          "File: common/transfer.go -> common/transfer.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "289: func (t *BaseTransfer) updateQuota(numFiles int, fileSize int64) bool {",
          "292:   return false",
          "293:  }",
          "294:  sizeDiff := fileSize - t.InitialSize",
          "",
          "[Removed Lines]",
          "291:  if t.File == nil && t.ErrTransfer != nil {",
          "",
          "[Added Lines]",
          "291:  if t.File == nil && t.ErrTransfer != nil && !t.Connection.User.HasBufferedSFTP(t.GetVirtualPath()) {",
          "",
          "---------------"
        ],
        "dataprovider/user.go||dataprovider/user.go": [
          "File: dataprovider/user.go -> dataprovider/user.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "348:  return permissions",
          "349: }",
          "351: func (u *User) getForbiddenSFTPSelfUsers(username string) ([]string, error) {",
          "352:  sftpUser, err := UserExists(username)",
          "353:  if err == nil {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "352: func (u *User) HasBufferedSFTP(name string) bool {",
          "353:  fs := u.GetFsConfigForPath(name)",
          "354:  if fs.Provider == sdk.SFTPFilesystemProvider {",
          "355:   return fs.SFTPConfig.BufferSize > 0",
          "356:  }",
          "357:  return false",
          "358: }",
          "",
          "---------------"
        ],
        "examples/webclient-integrations/test.html||examples/webclient-integrations/test.html": [
          "File: examples/webclient-integrations/test.html -> examples/webclient-integrations/test.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "10: </head>",
          "12: <body>",
          "14:     <br>",
          "15:     <button onclick=\"saveBlob(false);\">Save</button>",
          "16:     <br>",
          "17:     <button onclick=\"saveBlob(true);\">Save binary file</button>",
          "19:     <script src=\"https://code.jquery.com/jquery-3.6.0.min.js\"></script>",
          "20:     <script type=\"text/javascript\">",
          "",
          "[Removed Lines]",
          "13:     <textarea id=\"textarea_test\" name=\"textarea_test\" rows=\"6\" cols=\"80\">The text here will be sent to SFTPGo as blob</textarea>",
          "",
          "[Added Lines]",
          "13:     <textarea id=\"textarea_test\" name=\"textarea_test\" rows=\"10\" cols=\"80\">The text here will be sent to SFTPGo as blob</textarea>",
          "18:     <br><br>",
          "19:     <b>Logs</b>",
          "20:     <pre id=\"log\"></pre>",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "25:         $(document).ready(function () {",
          "26:             if (window.opener == null || window.opener.closed) {",
          "28:                 return;",
          "29:             }",
          "",
          "[Removed Lines]",
          "27:                 console.log(\"window opener gone!\");",
          "",
          "[Added Lines]",
          "30:                 printLog(\"window opener gone!\");",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "34:         window.addEventListener('message', (event) => {",
          "35:             if (window.opener == null || window.opener.closed) {",
          "37:                 return;",
          "38:             }",
          "41:             switch (event.data.type){",
          "42:                 case 'readyResponse':",
          "45:                     fileName = event.data.file_name;",
          "46:                     sftpgoUser = event.data.user;",
          "49:                     window.opener.postMessage({type: 'sendBlob'}, \"*\");",
          "50:                     break;",
          "51:                 case 'blobDownloadStart':",
          "55:                     break;",
          "56:                 case 'blob':",
          "58:                     var extension = fileName.slice((fileName.lastIndexOf(\".\") - 1 >>> 0) + 2).toLowerCase();",
          "60:                     if (extension == \"txt\"){",
          "61:                         event.data.file.text().then(function(text){",
          "62:                             $(\"#textarea_test\").val(text);",
          "",
          "[Removed Lines]",
          "36:                 console.log(\"window opener gone!\");",
          "40:             console.log(\"new message: \"+JSON.stringify(event.data));",
          "47:                     console.log(\"ready response received, file name: \" + fileName+\" SFTPGo user: \"+sftpgoUser);",
          "54:                     console.log(\"blob download start received, file name: \" + fileName+\" SFTPGo user: \"+sftpgoUser);",
          "59:                     console.log(\"blob received, file name: \" + fileName+\" extension: \"+extension+\" SFTPGo user: \"+sftpgoUser);",
          "",
          "[Added Lines]",
          "39:                 printLog(\"window opener gone!\");",
          "43:             printLog(\"new message: \"+JSON.stringify(event.data));",
          "50:                     printLog(\"ready response received, file name: \" + fileName+\" SFTPGo user: \"+sftpgoUser);",
          "57:                     printLog(\"blob download start received, file name: \" + fileName+\" SFTPGo user: \"+sftpgoUser);",
          "58:                     break;",
          "59:                 case 'blobDownloadError':",
          "61:                     printLog(\"blob download failed, file name: \" + fileName+\" SFTPGo user: \"+sftpgoUser+\" error message: \"+event.data.message);",
          "66:                     printLog(\"blob received, file name: \" + fileName+\" extension: \"+extension+\" SFTPGo user: \"+sftpgoUser);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "65:                     break;",
          "66:                 case 'blobSaveResult':",
          "69:                     if (event.data.status == \"OK\"){",
          "71:                     }",
          "72:                     break;",
          "73:                 default:",
          "75:             }",
          "76:         });",
          "78:         function saveBlob(binary){",
          "79:             if (window.opener == null || window.opener.closed) {",
          "81:                 return;",
          "82:             }",
          "85:             if (binary){",
          "87:                 fetch('https://raw.githubusercontent.com/drakkan/sftpgo/main/docs/howto/img/logo.png')",
          "88:                     .then(response => response.blob())",
          "89:                     .then(function(responseBlob){",
          "",
          "[Removed Lines]",
          "68:                     console.log(\"blob save status: \"+event.data.status+\", message: \"+event.data.message);",
          "70:                         console.log(\"blob saved, I'm useless now, close me\");",
          "74:                     console.log(\"Unsupported message: \" + JSON.stringify(event.data));",
          "80:                 console.log(\"window opener gone!\");",
          "84:             console.log(\"save blob, binary? \"+binary);",
          "",
          "[Added Lines]",
          "75:                     printLog(\"blob save status: \"+event.data.status+\", message: \"+event.data.message);",
          "77:                         printLog(\"blob saved, I'm useless now, close me\");",
          "81:                     printLog(\"Unsupported message: \" + JSON.stringify(event.data));",
          "87:                 printLog(\"window opener gone!\");",
          "91:             printLog(\"save blob, binary? \"+binary);",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "101:                 },\"*\");",
          "102:             }",
          "103:         }",
          "104:     </script>",
          "105: </body>",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "112:         function printLog(message){",
          "113:             console.log(message);",
          "114:             var logger = document.getElementById('log');",
          "115:             logger.innerHTML += message + '<br>';",
          "116:         }",
          "",
          "---------------"
        ],
        "go.mod||go.mod": [
          "File: go.mod -> go.mod",
          "--- Hunk 1 ---",
          "[Context before]",
          "7:  github.com/Azure/azure-storage-blob-go v0.14.0",
          "8:  github.com/GehirnInc/crypt v0.0.0-20200316065508-bb7000b8a962",
          "9:  github.com/alexedwards/argon2id v0.0.0-20211130144151-3585854a6387",
          "11:  github.com/cockroachdb/cockroach-go/v2 v2.2.4",
          "12:  github.com/eikenb/pipeat v0.0.0-20210603033007-44fc3ffce52b",
          "13:  github.com/fclairamb/ftpserverlib v0.16.0",
          "",
          "[Removed Lines]",
          "10:  github.com/aws/aws-sdk-go v1.42.19",
          "",
          "[Added Lines]",
          "10:  github.com/aws/aws-sdk-go v1.42.20",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "25:  github.com/hashicorp/go-retryablehttp v0.7.0",
          "26:  github.com/jlaffaye/ftp v0.0.0-20201112195030-9aae4d151126",
          "27:  github.com/klauspost/compress v1.13.6",
          "29:  github.com/lib/pq v1.10.4",
          "30:  github.com/lithammer/shortuuid/v3 v3.0.7",
          "31:  github.com/mattn/go-sqlite3 v1.14.9",
          "",
          "[Removed Lines]",
          "28:  github.com/lestrrat-go/jwx v1.2.12",
          "",
          "[Added Lines]",
          "28:  github.com/lestrrat-go/jwx v1.2.13",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "53:  gocloud.dev v0.24.0",
          "54:  golang.org/x/crypto v0.0.0-20211202192323-5770296d904e",
          "55:  golang.org/x/net v0.0.0-20211201190559-0a0e4e1bb54c",
          "57:  golang.org/x/time v0.0.0-20211116232009-f0f3c7e86c11",
          "58:  google.golang.org/api v0.61.0",
          "59:  google.golang.org/grpc v1.42.0",
          "",
          "[Removed Lines]",
          "56:  golang.org/x/sys v0.0.0-20211204120058-94396e421777",
          "",
          "[Added Lines]",
          "56:  golang.org/x/sys v0.0.0-20211205182925-97ca703d548d",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "62: )",
          "64: require (",
          "66:  github.com/Azure/azure-pipeline-go v0.2.3 // indirect",
          "67:  github.com/beorn7/perks v1.0.1 // indirect",
          "68:  github.com/boombuler/barcode v1.0.1 // indirect",
          "",
          "[Removed Lines]",
          "65:  cloud.google.com/go v0.98.0 // indirect",
          "",
          "[Added Lines]",
          "65:  cloud.google.com/go v0.99.0 // indirect",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "129:  golang.org/x/text v0.3.7 // indirect",
          "130:  golang.org/x/xerrors v0.0.0-20200804184101-5ec99f83aff1 // indirect",
          "131:  google.golang.org/appengine v1.6.7 // indirect",
          "133:  gopkg.in/ini.v1 v1.66.2 // indirect",
          "134:  gopkg.in/yaml.v2 v2.4.0 // indirect",
          "135:  gopkg.in/yaml.v3 v3.0.0-20210107192922-496545a6307b // indirect",
          "",
          "[Removed Lines]",
          "132:  google.golang.org/genproto v0.0.0-20211203200212-54befc351ae9 // indirect",
          "",
          "[Added Lines]",
          "132:  google.golang.org/genproto v0.0.0-20211207154714-918901c715cf // indirect",
          "",
          "---------------"
        ],
        "go.sum||go.sum": [
          "File: go.sum -> go.sum",
          "--- Hunk 1 ---",
          "[Context before]",
          "33: cloud.google.com/go v0.94.0/go.mod h1:qAlAugsXlC+JWO+Bke5vCtc9ONxjQT3drlTTnAplMW4=",
          "34: cloud.google.com/go v0.94.1/go.mod h1:qAlAugsXlC+JWO+Bke5vCtc9ONxjQT3drlTTnAplMW4=",
          "35: cloud.google.com/go v0.97.0/go.mod h1:GF7l59pYBVlXQIBLx3a761cZ41F9bBH3JUlihCt2Udc=",
          "38: cloud.google.com/go/bigquery v1.0.1/go.mod h1:i/xbL2UlR5RvWAURpBYZTtm/cXjCha9lbfbpx4poX+o=",
          "39: cloud.google.com/go/bigquery v1.3.0/go.mod h1:PjpwJnslEMmckchkHFfq+HTD2DmtT67aNFKH1/VBDHE=",
          "40: cloud.google.com/go/bigquery v1.4.0/go.mod h1:S8dzgnTigyfTmLBfrtrhyYhwRxG72rYxvftPBK2Dvzc=",
          "",
          "[Removed Lines]",
          "36: cloud.google.com/go v0.98.0 h1:w6LozQJyDDEyhf64Uusu1LCcnLt0I1VMLiJC2kV+eXk=",
          "37: cloud.google.com/go v0.98.0/go.mod h1:ua6Ush4NALrHk5QXDWnjvZHN93OuF0HfuEPq9I1X0cM=",
          "",
          "[Added Lines]",
          "36: cloud.google.com/go v0.99.0 h1:y/cM2iqGgGi5D5DQZl6D9STN/3dR/Vx5Mp8s752oJTY=",
          "37: cloud.google.com/go v0.99.0/go.mod h1:w0Xx2nLzqWJPuozYQX+hFfCSI8WioryfRDzkoI/Y2ZA=",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "136: github.com/aws/aws-sdk-go v1.37.0/go.mod h1:hcU610XS61/+aQV88ixoOzUoG7v3b31pl2zKMmprdro=",
          "137: github.com/aws/aws-sdk-go v1.38.68/go.mod h1:hcU610XS61/+aQV88ixoOzUoG7v3b31pl2zKMmprdro=",
          "138: github.com/aws/aws-sdk-go v1.40.34/go.mod h1:585smgzpB/KqRA+K3y/NL/oYRqQvpNJYvLm+LY1U59Q=",
          "141: github.com/aws/aws-sdk-go-v2 v1.7.0/go.mod h1:tb9wi5s61kTDA5qCkcDbt3KRVV74GGslQkl/DRdX/P4=",
          "142: github.com/aws/aws-sdk-go-v2 v1.9.0/go.mod h1:cK/D0BBs0b/oWPIcX/Z/obahJK1TT7IPVjy53i/mX/4=",
          "143: github.com/aws/aws-sdk-go-v2/config v1.7.0/go.mod h1:w9+nMZ7soXCe5nT46Ri354SNhXDQ6v+V5wqDjnZE+GY=",
          "",
          "[Removed Lines]",
          "139: github.com/aws/aws-sdk-go v1.42.19 h1:L/aM1QwsqVia9qIqexTHwYN+lgLYuOtf11VDgz0YIyw=",
          "140: github.com/aws/aws-sdk-go v1.42.19/go.mod h1:585smgzpB/KqRA+K3y/NL/oYRqQvpNJYvLm+LY1U59Q=",
          "",
          "[Added Lines]",
          "139: github.com/aws/aws-sdk-go v1.42.20 h1:nQkkmTWK5N2Ao1iVzoOx1HTIxwbSWErxyZ1eiwLJWc4=",
          "140: github.com/aws/aws-sdk-go v1.42.20/go.mod h1:585smgzpB/KqRA+K3y/NL/oYRqQvpNJYvLm+LY1U59Q=",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "301: github.com/gobwas/pool v0.2.0/go.mod h1:q8bcK0KcYlCgd9e7WYLm9LpyS+YeLd8JVDW6WezmKEw=",
          "302: github.com/gobwas/ws v1.0.2/go.mod h1:szmBTxLgaFppYjEmNtny/v3w89xOydFnnZMcgRRu/EM=",
          "303: github.com/goccy/go-json v0.7.6/go.mod h1:6MelG93GURQebXPDq3khkgXZkazVtN9CRI+MGFi0w8I=",
          "305: github.com/goccy/go-json v0.8.1 h1:4/Wjm0JIJaTDm8K1KcGrLHJoa8EsJ13YWeX+6Kfq6uI=",
          "306: github.com/goccy/go-json v0.8.1/go.mod h1:6MelG93GURQebXPDq3khkgXZkazVtN9CRI+MGFi0w8I=",
          "307: github.com/godbus/dbus/v5 v5.0.4/go.mod h1:xhWf0FNVPg57R7Z0UbKHbJfkEywrmjJnf7w5xrFpKfA=",
          "",
          "[Removed Lines]",
          "304: github.com/goccy/go-json v0.7.10/go.mod h1:6MelG93GURQebXPDq3khkgXZkazVtN9CRI+MGFi0w8I=",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "566: github.com/lestrrat-go/iter v1.0.1 h1:q8faalr2dY6o8bV45uwrxq12bRa1ezKrB6oM9FUgN4A=",
          "567: github.com/lestrrat-go/iter v1.0.1/go.mod h1:zIdgO1mRKhn8l9vrZJZz9TUMMFbQbLeTsbqPDrJ/OJc=",
          "568: github.com/lestrrat-go/jwx v1.2.6/go.mod h1:tJuGuAI3LC71IicTx82Mz1n3w9woAs2bYJZpkjJQ5aU=",
          "571: github.com/lestrrat-go/option v1.0.0 h1:WqAWL8kh8VcSoD6xjSH34/1m8yxluXQbDeKNfvFeEO4=",
          "572: github.com/lestrrat-go/option v1.0.0/go.mod h1:5ZHFbivi4xwXxhxY9XHDe2FHo6/Z7WWmtT7T5nBBp3I=",
          "573: github.com/lib/pq v1.0.0/go.mod h1:5WUZQaWbwv1U+lTReE5YruASi9Al49XbQIvNi/34Woo=",
          "",
          "[Removed Lines]",
          "569: github.com/lestrrat-go/jwx v1.2.12 h1:XG2R0T2w5YFBy7Clfionp6cDdDPuo3yU5xFJg5/r91o=",
          "570: github.com/lestrrat-go/jwx v1.2.12/go.mod h1:25DcLbNWArPA/Ew5CcBmewl32cJKxOk5cbepBsIJFzw=",
          "",
          "[Added Lines]",
          "568: github.com/lestrrat-go/jwx v1.2.13 h1:GxuOPfAz4+nzL98WaKxBxEEZ9b7qmyDetMGfBm9yVvE=",
          "569: github.com/lestrrat-go/jwx v1.2.13/go.mod h1:3Q3Re8TaOcVTdpx4Tvz++OWmryDklihTDqrrwQiyS2A=",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "991: golang.org/x/sys v0.0.0-20210927094055-39ccf1dd6fa6/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=",
          "992: golang.org/x/sys v0.0.0-20211013075003-97ac67df715c/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=",
          "993: golang.org/x/sys v0.0.0-20211124211545-fe61309f8881/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=",
          "996: golang.org/x/term v0.0.0-20201126162022-7de9c90e9dd1 h1:v+OssWQX+hTHEmOBgwxdZxK4zHq3yOs8F9J7mk0PY8E=",
          "997: golang.org/x/term v0.0.0-20201126162022-7de9c90e9dd1/go.mod h1:bj7SfCRtBDWHUb9snDiAeCFNEtKQo2Wmx5Cou7ajbmo=",
          "998: golang.org/x/text v0.0.0-20170915032832-14c0d48ead0c/go.mod h1:NqM8EUOU14njkJ3fqMW+pc6Ldnwhi/IjpwHt7yyuwOQ=",
          "",
          "[Removed Lines]",
          "994: golang.org/x/sys v0.0.0-20211204120058-94396e421777 h1:QAkhGVjOxMa+n4mlsAWeAU+BMZmimQAaNiMu+iUi94E=",
          "995: golang.org/x/sys v0.0.0-20211204120058-94396e421777/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=",
          "",
          "[Added Lines]",
          "993: golang.org/x/sys v0.0.0-20211205182925-97ca703d548d h1:FjkYO/PPp4Wi0EAUOVLxePm7qVW4r4ctbWpURyuOD0E=",
          "994: golang.org/x/sys v0.0.0-20211205182925-97ca703d548d/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "1197: google.golang.org/genproto v0.0.0-20210924002016-3dee208752a0/go.mod h1:5CzLGKJ67TSI2B9POpiiyGha0AjJvZIUgRMt1dSmuhc=",
          "1198: google.golang.org/genproto v0.0.0-20211016002631-37fc39342514/go.mod h1:5CzLGKJ67TSI2B9POpiiyGha0AjJvZIUgRMt1dSmuhc=",
          "1199: google.golang.org/genproto v0.0.0-20211118181313-81c1377c94b1/go.mod h1:5CzLGKJ67TSI2B9POpiiyGha0AjJvZIUgRMt1dSmuhc=",
          "1203: google.golang.org/grpc v1.8.0/go.mod h1:yo6s7OP7yaDglbqo1J04qKzAhqBH6lvTonzMVmEdcZw=",
          "1204: google.golang.org/grpc v1.19.0/go.mod h1:mqu4LbDTu4XGKhr4mRzUsmM4RtVoemTSY81AxZiDr8c=",
          "1205: google.golang.org/grpc v1.20.1/go.mod h1:10oTOabMzJvdu6/UiuZezV6QK5dSlG84ov/aaiqXj38=",
          "",
          "[Removed Lines]",
          "1200: google.golang.org/genproto v0.0.0-20211129164237-f09f9a12af12/go.mod h1:5CzLGKJ67TSI2B9POpiiyGha0AjJvZIUgRMt1dSmuhc=",
          "1201: google.golang.org/genproto v0.0.0-20211203200212-54befc351ae9 h1:fU3FNfL/oBU2D5DvGqiuyVqqn40DdxvaTFHq7aivA3k=",
          "1202: google.golang.org/genproto v0.0.0-20211203200212-54befc351ae9/go.mod h1:5CzLGKJ67TSI2B9POpiiyGha0AjJvZIUgRMt1dSmuhc=",
          "",
          "[Added Lines]",
          "1199: google.golang.org/genproto v0.0.0-20211206160659-862468c7d6e0/go.mod h1:5CzLGKJ67TSI2B9POpiiyGha0AjJvZIUgRMt1dSmuhc=",
          "1200: google.golang.org/genproto v0.0.0-20211207154714-918901c715cf h1:PSEM+IQFb9xdsj2CGhfqUTfsZvF8DScCVP1QZb2IiTQ=",
          "1201: google.golang.org/genproto v0.0.0-20211207154714-918901c715cf/go.mod h1:5CzLGKJ67TSI2B9POpiiyGha0AjJvZIUgRMt1dSmuhc=",
          "",
          "---------------"
        ],
        "httpd/api_http_user.go||httpd/api_http_user.go": [
          "File: httpd/api_http_user.go -> httpd/api_http_user.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "9:  \"net/http\"",
          "10:  \"os\"",
          "11:  \"path\"",
          "12:  \"time\"",
          "14:  \"github.com/go-chi/render\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "12:  \"strconv\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "169:  }",
          "170: }",
          "172: func uploadUserFiles(w http.ResponseWriter, r *http.Request) {",
          "173:  if maxUploadFileSize > 0 {",
          "174:   r.Body = http.MaxBytesReader(w, r.Body, maxUploadFileSize)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "173: func setFileDirMetadata(w http.ResponseWriter, r *http.Request) {",
          "174:  r.Body = http.MaxBytesReader(w, r.Body, maxRequestSize)",
          "176:  metadata := make(map[string]int64)",
          "177:  err := render.DecodeJSON(r.Body, &metadata)",
          "178:  if err != nil {",
          "179:   sendAPIResponse(w, r, err, \"\", http.StatusBadRequest)",
          "180:   return",
          "181:  }",
          "182:  mTime, ok := metadata[\"modification_time\"]",
          "183:  if !ok || !r.URL.Query().Has(\"path\") {",
          "184:   sendAPIResponse(w, r, errors.New(\"please set a modification_time and a path\"), \"\", http.StatusBadRequest)",
          "185:   return",
          "186:  }",
          "188:  connection, err := getUserConnection(w, r)",
          "189:  if err != nil {",
          "190:   return",
          "191:  }",
          "192:  common.Connections.Add(connection)",
          "193:  defer common.Connections.Remove(connection.GetID())",
          "195:  name := util.CleanPath(r.URL.Query().Get(\"path\"))",
          "196:  attrs := common.StatAttributes{",
          "197:   Flags: common.StatAttrTimes,",
          "198:   Atime: util.GetTimeFromMsecSinceEpoch(mTime),",
          "199:   Mtime: util.GetTimeFromMsecSinceEpoch(mTime),",
          "200:  }",
          "201:  err = connection.SetStat(name, &attrs)",
          "202:  if err != nil {",
          "203:   sendAPIResponse(w, r, err, fmt.Sprintf(\"Unable to set metadata for path %#v\", name), getMappedStatusCode(err))",
          "204:   return",
          "205:  }",
          "206:  sendAPIResponse(w, r, nil, \"OK\", http.StatusOK)",
          "207: }",
          "209: func uploadUserFile(w http.ResponseWriter, r *http.Request) {",
          "210:  if maxUploadFileSize > 0 {",
          "211:   r.Body = http.MaxBytesReader(w, r.Body, maxUploadFileSize)",
          "212:  }",
          "214:  if !r.URL.Query().Has(\"path\") {",
          "215:   sendAPIResponse(w, r, errors.New(\"please set a file path\"), \"\", http.StatusBadRequest)",
          "216:   return",
          "217:  }",
          "219:  connection, err := getUserConnection(w, r)",
          "220:  if err != nil {",
          "221:   return",
          "222:  }",
          "223:  common.Connections.Add(connection)",
          "224:  defer common.Connections.Remove(connection.GetID())",
          "226:  filePath := util.CleanPath(r.URL.Query().Get(\"path\"))",
          "227:  doUploadFile(w, r, connection, filePath) //nolint:errcheck",
          "228: }",
          "230: func doUploadFile(w http.ResponseWriter, r *http.Request, connection *Connection, filePath string) error {",
          "231:  writer, err := connection.getFileWriter(filePath)",
          "232:  if err != nil {",
          "233:   sendAPIResponse(w, r, err, fmt.Sprintf(\"Unable to write file %#v\", filePath), getMappedStatusCode(err))",
          "234:   return err",
          "235:  }",
          "236:  _, err = io.Copy(writer, r.Body)",
          "237:  if err != nil {",
          "238:   writer.Close() //nolint:errcheck",
          "239:   sendAPIResponse(w, r, err, fmt.Sprintf(\"Error saving file %#v\", filePath), getMappedStatusCode(err))",
          "240:   return err",
          "241:  }",
          "242:  err = writer.Close()",
          "243:  if err != nil {",
          "244:   sendAPIResponse(w, r, err, fmt.Sprintf(\"Error closing file %#v\", filePath), getMappedStatusCode(err))",
          "245:   return err",
          "246:  }",
          "247:  setModificationTimeFromHeader(r, connection, filePath)",
          "248:  sendAPIResponse(w, r, nil, \"Upload completed\", http.StatusCreated)",
          "249:  return nil",
          "250: }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "469:  return dataprovider.UpdateUser(&user, dataprovider.ActionExecutorSelf, util.GetIPFromRemoteAddress(r.RemoteAddr))",
          "470: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "552: func setModificationTimeFromHeader(r *http.Request, c *Connection, filePath string) {",
          "553:  mTimeString := r.Header.Get(mTimeHeader)",
          "554:  if mTimeString != \"\" {",
          "556:   mTime, err := strconv.ParseInt(mTimeString, 10, 64)",
          "557:   if err == nil {",
          "558:    attrs := common.StatAttributes{",
          "559:     Flags: common.StatAttrTimes,",
          "560:     Atime: util.GetTimeFromMsecSinceEpoch(mTime),",
          "561:     Mtime: util.GetTimeFromMsecSinceEpoch(mTime),",
          "562:    }",
          "563:    err = c.SetStat(filePath, &attrs)",
          "564:    c.Log(logger.LevelDebug, \"requested modification time %v for file %#v, error: %v\",",
          "565:     attrs.Mtime, filePath, err)",
          "566:   } else {",
          "567:    c.Log(logger.LevelInfo, \"invalid modification time header was ignored: %v\", mTimeString)",
          "568:   }",
          "569:  }",
          "570: }",
          "",
          "---------------"
        ],
        "httpd/api_shares.go||httpd/api_shares.go": [
          "File: httpd/api_shares.go -> httpd/api_shares.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "6:  \"fmt\"",
          "7:  \"net/http\"",
          "8:  \"os\"",
          "10:  \"github.com/go-chi/render\"",
          "11:  \"github.com/rs/xid\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "9:  \"path\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "176:  }",
          "177: }",
          "180:  if maxUploadFileSize > 0 {",
          "181:   r.Body = http.MaxBytesReader(w, r.Body, maxUploadFileSize)",
          "182:  }",
          "",
          "[Removed Lines]",
          "179: func uploadToShare(w http.ResponseWriter, r *http.Request) {",
          "",
          "[Added Lines]",
          "180: func uploadFileToShare(w http.ResponseWriter, r *http.Request) {",
          "181:  if maxUploadFileSize > 0 {",
          "182:   r.Body = http.MaxBytesReader(w, r.Body, maxUploadFileSize)",
          "183:  }",
          "184:  name := getURLParam(r, \"name\")",
          "185:  share, connection, err := checkPublicShare(w, r, dataprovider.ShareScopeWrite)",
          "186:  if err != nil {",
          "187:   return",
          "188:  }",
          "189:  filePath := path.Join(share.Paths[0], name)",
          "190:  if path.Dir(filePath) != share.Paths[0] {",
          "191:   sendAPIResponse(w, r, err, \"Uploading outside the share is not allowed\", http.StatusForbidden)",
          "192:   return",
          "193:  }",
          "194:  dataprovider.UpdateShareLastUse(&share, 1) //nolint:errcheck",
          "196:  common.Connections.Add(connection)",
          "197:  defer common.Connections.Remove(connection.GetID())",
          "198:  if err := doUploadFile(w, r, connection, filePath); err != nil {",
          "199:   dataprovider.UpdateShareLastUse(&share, -1) //nolint:errcheck",
          "200:  }",
          "201: }",
          "203: func uploadFilesToShare(w http.ResponseWriter, r *http.Request) {",
          "",
          "---------------"
        ],
        "httpd/httpd.go||httpd/httpd.go": [
          "File: httpd/httpd.go -> httpd/httpd.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "62:  userFilePath                          = \"/api/v2/user/file\"",
          "63:  userFilesPath                         = \"/api/v2/user/files\"",
          "64:  userStreamZipPath                     = \"/api/v2/user/streamzip\"",
          "65:  apiKeysPath                           = \"/api/v2/apikeys\"",
          "66:  adminTOTPConfigsPath                  = \"/api/v2/admin/totp/configs\"",
          "67:  adminTOTPGeneratePath                 = \"/api/v2/admin/totp/generate\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "65:  userUploadFilePath                    = \"/api/v2/user/files/upload\"",
          "66:  userFilesDirsMetadataPath             = \"/api/v2/user/files/metadata\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "120:  webClientTwoFactorPathDefault         = \"/web/client/twofactor\"",
          "121:  webClientTwoFactorRecoveryPathDefault = \"/web/client/twofactor-recovery\"",
          "122:  webClientFilesPathDefault             = \"/web/client/files\"",
          "123:  webClientSharesPathDefault            = \"/web/client/shares\"",
          "124:  webClientSharePathDefault             = \"/web/client/share\"",
          "125:  webClientEditFilePathDefault          = \"/web/client/editfile\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "125:  webClientFilePathDefault              = \"/web/client/file\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "147:  maxMultipartMem      = 10485760 // 10 MB",
          "148:  osWindows            = \"windows\"",
          "149:  otpHeaderCode        = \"X-SFTPGO-OTP\"",
          "150: )",
          "152: var (",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "153:  mTimeHeader          = \"X-SFTPGO-MTIME\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "195:  webClientTwoFactorPath         string",
          "196:  webClientTwoFactorRecoveryPath string",
          "197:  webClientFilesPath             string",
          "198:  webClientSharesPath            string",
          "199:  webClientSharePath             string",
          "200:  webClientEditFilePath          string",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "202:  webClientFilePath              string",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "578:  webClientTwoFactorPath = path.Join(baseURL, webClientTwoFactorPathDefault)",
          "579:  webClientTwoFactorRecoveryPath = path.Join(baseURL, webClientTwoFactorRecoveryPathDefault)",
          "580:  webClientFilesPath = path.Join(baseURL, webClientFilesPathDefault)",
          "581:  webClientSharesPath = path.Join(baseURL, webClientSharesPathDefault)",
          "582:  webClientPubSharesPath = path.Join(baseURL, webClientPubSharesPathDefault)",
          "583:  webClientSharePath = path.Join(baseURL, webClientSharePathDefault)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "586:  webClientFilePath = path.Join(baseURL, webClientFilePathDefault)",
          "",
          "---------------"
        ],
        "httpd/httpd_test.go||httpd/httpd_test.go": [
          "File: httpd/httpd_test.go -> httpd/httpd_test.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "91:  userDirsPath                    = \"/api/v2/user/dirs\"",
          "92:  userFilesPath                   = \"/api/v2/user/files\"",
          "93:  userStreamZipPath               = \"/api/v2/user/streamzip\"",
          "94:  apiKeysPath                     = \"/api/v2/apikeys\"",
          "95:  adminTOTPConfigsPath            = \"/api/v2/admin/totp/configs\"",
          "96:  adminTOTPGeneratePath           = \"/api/v2/admin/totp/generate\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "94:  userUploadFilePath              = \"/api/v2/user/files/upload\"",
          "95:  userFilesDirsMetadataPath       = \"/api/v2/user/files/metadata\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "8677:  rr := executeRequest(req)",
          "8678:  checkResponseCode(t, http.StatusCreated, rr)",
          "8680:  err = os.WriteFile(preActionPath, getExitCodeScriptContent(1), os.ModePerm)",
          "8681:  assert.NoError(t, err)",
          "8682:  _, err = reader.Seek(0, io.SeekStart)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "8682:  req, err = http.NewRequest(http.MethodPost, userUploadFilePath+\"?path=filepre\",",
          "8683:   bytes.NewBuffer([]byte(\"single upload content\")))",
          "8684:  assert.NoError(t, err)",
          "8685:  req.Header.Add(\"Content-Type\", writer.FormDataContentType())",
          "8686:  setBearerForReq(req, webAPIToken)",
          "8687:  rr = executeRequest(req)",
          "8688:  checkResponseCode(t, http.StatusCreated, rr)",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "8688:  rr = executeRequest(req)",
          "8689:  checkResponseCode(t, http.StatusForbidden, rr)",
          "8691:  _, err = httpdtest.RemoveUser(user, http.StatusOK)",
          "8692:  assert.NoError(t, err)",
          "8693:  err = os.RemoveAll(user.GetHomeDir())",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "8701:  req, err = http.NewRequest(http.MethodPost, userUploadFilePath+\"?path=filepre\",",
          "8702:   bytes.NewBuffer([]byte(\"single upload content\")))",
          "8703:  assert.NoError(t, err)",
          "8704:  req.Header.Add(\"Content-Type\", writer.FormDataContentType())",
          "8705:  setBearerForReq(req, webAPIToken)",
          "8706:  rr = executeRequest(req)",
          "8707:  checkResponseCode(t, http.StatusForbidden, rr)",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "8929:  executeRequest(req)",
          "8930: }",
          "8932: func TestShareUncompressed(t *testing.T) {",
          "8933:  user, _, err := httpdtest.AddUser(getTestUser(), http.StatusCreated)",
          "8934:  assert.NoError(t, err)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "8950: func TestShareUploadSingle(t *testing.T) {",
          "8951:  user, _, err := httpdtest.AddUser(getTestUser(), http.StatusCreated)",
          "8952:  assert.NoError(t, err)",
          "8953:  token, err := getJWTAPIUserTokenFromTestServer(defaultUsername, defaultPassword)",
          "8954:  assert.NoError(t, err)",
          "8956:  share := dataprovider.Share{",
          "8957:   Name:      \"test share\",",
          "8958:   Scope:     dataprovider.ShareScopeWrite,",
          "8959:   Paths:     []string{\"/\"},",
          "8960:   Password:  defaultPassword,",
          "8961:   MaxTokens: 0,",
          "8962:  }",
          "8963:  asJSON, err := json.Marshal(share)",
          "8964:  assert.NoError(t, err)",
          "8965:  req, err := http.NewRequest(http.MethodPost, userSharesPath, bytes.NewBuffer(asJSON))",
          "8966:  assert.NoError(t, err)",
          "8967:  setBearerForReq(req, token)",
          "8968:  rr := executeRequest(req)",
          "8969:  checkResponseCode(t, http.StatusCreated, rr)",
          "8970:  objectID := rr.Header().Get(\"X-Object-ID\")",
          "8971:  assert.NotEmpty(t, objectID)",
          "8973:  content := []byte(\"shared file content\")",
          "8974:  modTime := time.Now().Add(-12 * time.Hour)",
          "8975:  req, err = http.NewRequest(http.MethodPost, path.Join(sharesPath, objectID, \"file.txt\"), bytes.NewBuffer(content))",
          "8976:  assert.NoError(t, err)",
          "8977:  req.SetBasicAuth(defaultUsername, defaultPassword)",
          "8978:  req.Header.Set(\"X-SFTPGO-MTIME\", strconv.FormatInt(util.GetTimeAsMsSinceEpoch(modTime), 10))",
          "8979:  rr = executeRequest(req)",
          "8980:  checkResponseCode(t, http.StatusCreated, rr)",
          "8981:  info, err := os.Stat(filepath.Join(user.GetHomeDir(), \"file.txt\"))",
          "8982:  if assert.NoError(t, err) {",
          "8983:   assert.InDelta(t, util.GetTimeAsMsSinceEpoch(modTime), util.GetTimeAsMsSinceEpoch(info.ModTime()), float64(1000))",
          "8984:  }",
          "8985:  req, err = http.NewRequest(http.MethodPost, path.Join(webClientPubSharesPath, objectID, \"file.txt\"), bytes.NewBuffer(content))",
          "8986:  assert.NoError(t, err)",
          "8987:  req.SetBasicAuth(defaultUsername, defaultPassword)",
          "8988:  rr = executeRequest(req)",
          "8989:  checkResponseCode(t, http.StatusCreated, rr)",
          "8990:  info, err = os.Stat(filepath.Join(user.GetHomeDir(), \"file.txt\"))",
          "8991:  if assert.NoError(t, err) {",
          "8992:   assert.InDelta(t, util.GetTimeAsMsSinceEpoch(time.Now()), util.GetTimeAsMsSinceEpoch(info.ModTime()), float64(3000))",
          "8993:  }",
          "8995:  req, err = http.NewRequest(http.MethodPost, path.Join(sharesPath, objectID, \"%2Fdir%2Ffile1.txt\"), bytes.NewBuffer(content))",
          "8996:  assert.NoError(t, err)",
          "8997:  req.SetBasicAuth(defaultUsername, defaultPassword)",
          "8998:  rr = executeRequest(req)",
          "8999:  checkResponseCode(t, http.StatusForbidden, rr)",
          "9001:  req, err = http.NewRequest(http.MethodPost, path.Join(sharesPath, objectID, \"dir\", \"file.dat\"), bytes.NewBuffer(content))",
          "9002:  assert.NoError(t, err)",
          "9003:  req.SetBasicAuth(defaultUsername, defaultPassword)",
          "9004:  rr = executeRequest(req)",
          "9005:  checkResponseCode(t, http.StatusNotFound, rr)",
          "9007:  req, err = http.NewRequest(http.MethodPost, path.Join(sharesPath, objectID, \"%2F\"), bytes.NewBuffer(content))",
          "9008:  assert.NoError(t, err)",
          "9009:  req.SetBasicAuth(defaultUsername, defaultPassword)",
          "9010:  rr = executeRequest(req)",
          "9011:  checkResponseCode(t, http.StatusNotFound, rr)",
          "9013:  err = os.MkdirAll(filepath.Join(user.GetHomeDir(), \"dir\"), os.ModePerm)",
          "9014:  assert.NoError(t, err)",
          "9015:  req, err = http.NewRequest(http.MethodPost, path.Join(sharesPath, objectID, \"dir\"), bytes.NewBuffer(content))",
          "9016:  assert.NoError(t, err)",
          "9017:  req.SetBasicAuth(defaultUsername, defaultPassword)",
          "9018:  rr = executeRequest(req)",
          "9019:  checkResponseCode(t, http.StatusInternalServerError, rr)",
          "9020:  assert.Contains(t, rr.Body.String(), \"operation unsupported\")",
          "9022:  share, err = dataprovider.ShareExists(objectID, user.Username)",
          "9023:  assert.NoError(t, err)",
          "9024:  assert.Equal(t, 2, share.UsedTokens)",
          "9026:  _, err = httpdtest.RemoveUser(user, http.StatusOK)",
          "9027:  assert.NoError(t, err)",
          "9028:  err = os.RemoveAll(user.GetHomeDir())",
          "9029:  assert.NoError(t, err)",
          "9031:  req, err = http.NewRequest(http.MethodPost, path.Join(sharesPath, objectID, \"file1.txt\"), bytes.NewBuffer(content))",
          "9032:  assert.NoError(t, err)",
          "9033:  req.SetBasicAuth(defaultUsername, defaultPassword)",
          "9034:  rr = executeRequest(req)",
          "9035:  checkResponseCode(t, http.StatusNotFound, rr)",
          "9036: }",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "9985:  checkResponseCode(t, http.StatusNotFound, rr)",
          "9986: }",
          "9988: func TestWebFilesAPI(t *testing.T) {",
          "9989:  user, _, err := httpdtest.AddUser(getTestUser(), http.StatusCreated)",
          "9990:  assert.NoError(t, err)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "10094: func TestWebUploadSingleFile(t *testing.T) {",
          "10095:  user, _, err := httpdtest.AddUser(getTestUser(), http.StatusCreated)",
          "10096:  assert.NoError(t, err)",
          "10097:  webAPIToken, err := getJWTAPIUserTokenFromTestServer(defaultUsername, defaultPassword)",
          "10098:  assert.NoError(t, err)",
          "10100:  content := []byte(\"test content\")",
          "10102:  req, err := http.NewRequest(http.MethodPost, userUploadFilePath, bytes.NewBuffer(content))",
          "10103:  assert.NoError(t, err)",
          "10104:  setBearerForReq(req, webAPIToken)",
          "10105:  rr := executeRequest(req)",
          "10106:  checkResponseCode(t, http.StatusBadRequest, rr)",
          "10107:  assert.Contains(t, rr.Body.String(), \"please set a file path\")",
          "10109:  modTime := time.Now().Add(-24 * time.Hour)",
          "10110:  req, err = http.NewRequest(http.MethodPost, userUploadFilePath+\"?path=file.txt\", bytes.NewBuffer(content))",
          "10111:  assert.NoError(t, err)",
          "10112:  setBearerForReq(req, webAPIToken)",
          "10113:  req.Header.Set(\"X-SFTPGO-MTIME\", strconv.FormatInt(util.GetTimeAsMsSinceEpoch(modTime), 10))",
          "10114:  rr = executeRequest(req)",
          "10115:  checkResponseCode(t, http.StatusCreated, rr)",
          "10117:  info, err := os.Stat(filepath.Join(user.GetHomeDir(), \"file.txt\"))",
          "10118:  if assert.NoError(t, err) {",
          "10119:   assert.InDelta(t, util.GetTimeAsMsSinceEpoch(modTime), util.GetTimeAsMsSinceEpoch(info.ModTime()), float64(1000))",
          "10120:  }",
          "10122:  req, err = http.NewRequest(http.MethodPost, userUploadFilePath+\"?path=file.txt\", bytes.NewBuffer(content))",
          "10123:  assert.NoError(t, err)",
          "10124:  setBearerForReq(req, webAPIToken)",
          "10125:  req.Header.Set(\"X-SFTPGO-MTIME\", \"123abc\")",
          "10126:  rr = executeRequest(req)",
          "10127:  checkResponseCode(t, http.StatusCreated, rr)",
          "10128:  info, err = os.Stat(filepath.Join(user.GetHomeDir(), \"file.txt\"))",
          "10129:  if assert.NoError(t, err) {",
          "10130:   assert.InDelta(t, util.GetTimeAsMsSinceEpoch(time.Now()), util.GetTimeAsMsSinceEpoch(info.ModTime()), float64(3000))",
          "10131:  }",
          "10133:  metadataReq := make(map[string]int64)",
          "10134:  metadataReq[\"modification_time\"] = util.GetTimeAsMsSinceEpoch(modTime)",
          "10135:  asJSON, err := json.Marshal(metadataReq)",
          "10136:  assert.NoError(t, err)",
          "10137:  req, err = http.NewRequest(http.MethodPatch, userFilesDirsMetadataPath+\"?path=file.txt\", bytes.NewBuffer(asJSON))",
          "10138:  assert.NoError(t, err)",
          "10139:  setBearerForReq(req, webAPIToken)",
          "10140:  rr = executeRequest(req)",
          "10141:  checkResponseCode(t, http.StatusOK, rr)",
          "10142:  info, err = os.Stat(filepath.Join(user.GetHomeDir(), \"file.txt\"))",
          "10143:  if assert.NoError(t, err) {",
          "10144:   assert.InDelta(t, util.GetTimeAsMsSinceEpoch(modTime), util.GetTimeAsMsSinceEpoch(info.ModTime()), float64(1000))",
          "10145:  }",
          "10147:  req, err = http.NewRequest(http.MethodPatch, userFilesDirsMetadataPath+\"?path=file2.txt\", bytes.NewBuffer(asJSON))",
          "10148:  assert.NoError(t, err)",
          "10149:  setBearerForReq(req, webAPIToken)",
          "10150:  rr = executeRequest(req)",
          "10151:  checkResponseCode(t, http.StatusNotFound, rr)",
          "10152:  assert.Contains(t, rr.Body.String(), \"Unable to set metadata for path\")",
          "10154:  req, err = http.NewRequest(http.MethodPatch, userFilesDirsMetadataPath+\"?path=file.txt\", bytes.NewBuffer(content))",
          "10155:  assert.NoError(t, err)",
          "10156:  setBearerForReq(req, webAPIToken)",
          "10157:  rr = executeRequest(req)",
          "10158:  checkResponseCode(t, http.StatusBadRequest, rr)",
          "10160:  req, err = http.NewRequest(http.MethodPatch, userFilesDirsMetadataPath, bytes.NewBuffer(asJSON))",
          "10161:  assert.NoError(t, err)",
          "10162:  setBearerForReq(req, webAPIToken)",
          "10163:  rr = executeRequest(req)",
          "10164:  checkResponseCode(t, http.StatusBadRequest, rr)",
          "10165:  assert.Contains(t, rr.Body.String(), \"please set a modification_time and a path\")",
          "10167:  metadataReq = make(map[string]int64)",
          "10168:  asJSON, err = json.Marshal(metadataReq)",
          "10169:  assert.NoError(t, err)",
          "10170:  req, err = http.NewRequest(http.MethodPatch, userFilesDirsMetadataPath+\"?path=file.txt\", bytes.NewBuffer(asJSON))",
          "10171:  assert.NoError(t, err)",
          "10172:  setBearerForReq(req, webAPIToken)",
          "10173:  rr = executeRequest(req)",
          "10174:  checkResponseCode(t, http.StatusBadRequest, rr)",
          "10175:  assert.Contains(t, rr.Body.String(), \"please set a modification_time and a path\")",
          "10177:  req, err = http.NewRequest(http.MethodPost, userUploadFilePath+\"?path=%2Fdir%2Ffile.txt\", bytes.NewBuffer(content))",
          "10178:  assert.NoError(t, err)",
          "10179:  setBearerForReq(req, webAPIToken)",
          "10180:  rr = executeRequest(req)",
          "10181:  checkResponseCode(t, http.StatusNotFound, rr)",
          "10182:  assert.Contains(t, rr.Body.String(), \"Unable to write file\")",
          "10184:  _, err = httpdtest.RemoveUser(user, http.StatusOK)",
          "10185:  assert.NoError(t, err)",
          "10186:  err = os.RemoveAll(user.GetHomeDir())",
          "10187:  assert.NoError(t, err)",
          "10189:  req, err = http.NewRequest(http.MethodPost, userUploadFilePath+\"?path=file.txt\", bytes.NewBuffer(content))",
          "10190:  assert.NoError(t, err)",
          "10191:  setBearerForReq(req, webAPIToken)",
          "10192:  rr = executeRequest(req)",
          "10193:  checkResponseCode(t, http.StatusNotFound, rr)",
          "10194:  assert.Contains(t, rr.Body.String(), \"Unable to retrieve your user\")",
          "10196:  metadataReq[\"modification_time\"] = util.GetTimeAsMsSinceEpoch(modTime)",
          "10197:  asJSON, err = json.Marshal(metadataReq)",
          "10198:  assert.NoError(t, err)",
          "10199:  req, err = http.NewRequest(http.MethodPatch, userFilesDirsMetadataPath+\"?path=file.txt\", bytes.NewBuffer(asJSON))",
          "10200:  assert.NoError(t, err)",
          "10201:  setBearerForReq(req, webAPIToken)",
          "10202:  rr = executeRequest(req)",
          "10203:  checkResponseCode(t, http.StatusNotFound, rr)",
          "10204:  assert.Contains(t, rr.Body.String(), \"Unable to retrieve your user\")",
          "10205: }",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "10281:  checkResponseCode(t, http.StatusNotFound, rr)",
          "10283:  if runtime.GOOS != osWindows {",
          "10285:   assert.NoError(t, err)",
          "10286:   setBearerForReq(req, webAPIToken)",
          "10287:   rr = executeRequest(req)",
          "",
          "[Removed Lines]",
          "10284:   req, err = http.NewRequest(http.MethodDelete, userFilesPath+\"?path=file.zip\", reader)",
          "",
          "[Added Lines]",
          "10503:   req, err = http.NewRequest(http.MethodDelete, userFilesPath+\"?path=file.zip\", nil)",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "10301:   checkResponseCode(t, http.StatusForbidden, rr)",
          "10302:   assert.Contains(t, rr.Body.String(), \"Error closing file\")",
          "10304:   err = os.Chmod(user.GetHomeDir(), os.ModePerm)",
          "10305:   assert.NoError(t, err)",
          "10306:  }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "10523:   req, err = http.NewRequest(http.MethodPost, userUploadFilePath+\"?path=file.zip\", bytes.NewBuffer(nil))",
          "10524:   assert.NoError(t, err)",
          "10525:   setBearerForReq(req, webAPIToken)",
          "10526:   rr = executeRequest(req)",
          "10527:   checkResponseCode(t, http.StatusForbidden, rr)",
          "10528:   assert.Contains(t, rr.Body.String(), \"Error closing file\")",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "10577:  rr = executeRequest(req)",
          "10578:  checkResponseCode(t, http.StatusRequestEntityTooLarge, rr)",
          "10579:  assert.Contains(t, rr.Body.String(), \"denying write due to space limit\")",
          "10581:  req, err = http.NewRequest(http.MethodDelete, userFilesPath+\"?path=file.txt\", nil)",
          "10582:  assert.NoError(t, err)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "10806:  assert.Contains(t, rr.Body.String(), \"Unable to write file\")",
          "10809:  req, err = http.NewRequest(http.MethodDelete, userFilesPath+\"?path=file.txt\", nil)",
          "10810:  assert.NoError(t, err)",
          "10811:  setBearerForReq(req, webAPIToken)",
          "10812:  rr = executeRequest(req)",
          "10813:  checkResponseCode(t, http.StatusOK, rr)",
          "10815:  user, _, err = httpdtest.GetUserByUsername(sftpUser.Username, http.StatusOK)",
          "10816:  assert.NoError(t, err)",
          "10817:  assert.Equal(t, 0, user.UsedQuotaFiles)",
          "10818:  assert.Equal(t, int64(0), user.UsedQuotaSize)",
          "10820:  req, err = http.NewRequest(http.MethodPost, userUploadFilePath+\"?path=file.txt\",",
          "10821:   bytes.NewBuffer([]byte(\"test upload single file content\")))",
          "10822:  assert.NoError(t, err)",
          "10823:  req.Header.Add(\"Content-Type\", writer.FormDataContentType())",
          "10824:  setBearerForReq(req, webAPIToken)",
          "10825:  rr = executeRequest(req)",
          "10826:  checkResponseCode(t, http.StatusRequestEntityTooLarge, rr)",
          "10827:  assert.Contains(t, rr.Body.String(), \"denying write due to space limit\")",
          "10828:  assert.Contains(t, rr.Body.String(), \"Error saving file\")",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "10593:  rr = executeRequest(req)",
          "10594:  checkResponseCode(t, http.StatusRequestEntityTooLarge, rr)",
          "10595:  assert.Contains(t, rr.Body.String(), \"denying write due to space limit\")",
          "10597:  _, err = httpdtest.RemoveUser(sftpUser, http.StatusOK)",
          "10598:  assert.NoError(t, err)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "10846:  assert.Contains(t, rr.Body.String(), \"Error saving file\")",
          "10849:  req, err = http.NewRequest(http.MethodDelete, userFilesPath+\"?path=file.txt\", nil)",
          "10850:  assert.NoError(t, err)",
          "10851:  setBearerForReq(req, webAPIToken)",
          "10852:  rr = executeRequest(req)",
          "10853:  checkResponseCode(t, http.StatusOK, rr)",
          "10855:  user, _, err = httpdtest.GetUserByUsername(sftpUser.Username, http.StatusOK)",
          "10856:  assert.NoError(t, err)",
          "10857:  assert.Equal(t, 0, user.UsedQuotaFiles)",
          "10858:  assert.Equal(t, int64(0), user.UsedQuotaSize)",
          "",
          "---------------"
        ],
        "httpd/server.go||httpd/server.go": [
          "File: httpd/server.go -> httpd/server.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "81:   config := &tls.Config{",
          "82:    GetCertificate:           certMgr.GetCertificateFunc(),",
          "83:    MinVersion:               tls.VersionTLS12,",
          "84:    CipherSuites:             util.GetTLSCiphersFromNames(s.binding.TLSCipherSuites),",
          "85:    PreferServerCipherSuites: true,",
          "86:   }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "84:    NextProtos:               []string{\"http/1.1\", \"h2\"},",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1006:  s.router.Get(sharesPath+\"/{id}\", downloadFromShare)",
          "1009:  s.router.Get(tokenPath, s.getToken)",
          "1010:  s.router.Post(adminPath+\"/{username}/forgot-password\", forgotAdminPassword)",
          "",
          "[Removed Lines]",
          "1007:  s.router.Post(sharesPath+\"/{id}\", uploadToShare)",
          "",
          "[Added Lines]",
          "1008:  s.router.Post(sharesPath+\"/{id}\", uploadFilesToShare)",
          "1009:  s.router.Post(sharesPath+\"/{id}/{name}\", uploadFileToShare)",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1155:   router.With(checkHTTPUserPerm(sdk.WebClientSharesDisabled)).Get(userSharesPath+\"/{id}\", getShareByID)",
          "1156:   router.With(checkHTTPUserPerm(sdk.WebClientSharesDisabled)).Put(userSharesPath+\"/{id}\", updateShare)",
          "1157:   router.With(checkHTTPUserPerm(sdk.WebClientSharesDisabled)).Delete(userSharesPath+\"/{id}\", deleteShare)",
          "1158:  })",
          "1160:  if s.renderOpenAPI {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1160:   router.With(checkHTTPUserPerm(sdk.WebClientWriteDisabled)).Post(userUploadFilePath, uploadUserFile)",
          "1161:   router.With(checkHTTPUserPerm(sdk.WebClientWriteDisabled)).Patch(userFilesDirsMetadataPath, setFileDirMetadata)",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1215:    Post(webClientTwoFactorRecoveryPath, s.handleWebClientTwoFactorRecoveryPost)",
          "1217:   s.router.Get(webClientPubSharesPath+\"/{id}\", downloadFromShare)",
          "1220:   s.router.Group(func(router chi.Router) {",
          "1221:    router.Use(jwtauth.Verify(s.tokenAuth, jwtauth.TokenFromCookie))",
          "",
          "[Removed Lines]",
          "1218:   s.router.Post(webClientPubSharesPath+\"/{id}\", uploadToShare)",
          "",
          "[Added Lines]",
          "1222:   s.router.Post(webClientPubSharesPath+\"/{id}\", uploadFilesToShare)",
          "1223:   s.router.Post(webClientPubSharesPath+\"/{id}/{name}\", uploadFileToShare)",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1224:    router.Get(webClientLogoutPath, handleWebClientLogout)",
          "1225:    router.With(s.refreshCookie).Get(webClientFilesPath, s.handleClientGetFiles)",
          "1226:    router.With(s.refreshCookie).Get(webClientViewPDFPath, handleClientViewPDF)",
          "1227:    router.With(checkHTTPUserPerm(sdk.WebClientWriteDisabled), verifyCSRFHeader).",
          "1229:    router.With(s.refreshCookie).Get(webClientEditFilePath, handleClientEditFile)",
          "1230:    router.With(checkHTTPUserPerm(sdk.WebClientWriteDisabled), verifyCSRFHeader).",
          "1231:     Patch(webClientFilesPath, renameUserFile)",
          "",
          "[Removed Lines]",
          "1228:     Post(webClientFilesPath, uploadUserFiles)",
          "",
          "[Added Lines]",
          "1232:    router.With(s.refreshCookie, verifyCSRFHeader).Get(webClientFilePath, getUserFile)",
          "1234:     Post(webClientFilePath, uploadUserFile)",
          "",
          "---------------"
        ],
        "httpd/webclient.go||httpd/webclient.go": [
          "File: httpd/webclient.go -> httpd/webclient.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "109: type editFilePage struct {",
          "110:  baseClientPage",
          "111:  CurrentDir string",
          "112:  Path       string",
          "113:  Name       string",
          "114:  ReadOnly   bool",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "112:  FileURL    string",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "121:  DirsURL         string",
          "122:  DownloadURL     string",
          "123:  ViewPDFURL      string",
          "124:  CanAddFiles     bool",
          "125:  CanCreateDirs   bool",
          "126:  CanRename       bool",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "125:  FileURL         string",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "412:   Path:           fileName,",
          "413:   Name:           path.Base(fileName),",
          "414:   CurrentDir:     path.Dir(fileName),",
          "415:   ReadOnly:       readOnly,",
          "416:   Data:           fileData,",
          "417:  }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "417:   FileURL:        webClientFilePath,",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "447:   DownloadURL:     webClientDownloadZipPath,",
          "448:   ViewPDFURL:      webClientViewPDFPath,",
          "449:   DirsURL:         webClientDirsPath,",
          "450:   CanAddFiles:     user.CanAddFilesFromWeb(dirName),",
          "451:   CanCreateDirs:   user.CanAddDirsFromWeb(dirName),",
          "452:   CanRename:       user.CanRenameFromWeb(dirName, dirName),",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "453:   FileURL:         webClientFilePath,",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "616:      for idx := range s.binding.WebClientIntegrations {",
          "617:       if util.IsStringInSlice(extension, s.binding.WebClientIntegrations[idx].FileExtensions) {",
          "618:        res[\"ext_url\"] = s.binding.WebClientIntegrations[idx].URL",
          "619:        break",
          "620:       }",
          "621:      }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "623:        res[\"ext_link\"] = fmt.Sprintf(\"%v?path=%v&_=%v\", webClientFilePath,",
          "624:         url.QueryEscape(path.Join(name, info.Name())), time.Now().UTC().Unix())",
          "",
          "---------------"
        ],
        "telemetry/telemetry.go||telemetry/telemetry.go": [
          "File: telemetry/telemetry.go -> telemetry/telemetry.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "105:   config := &tls.Config{",
          "106:    GetCertificate:           certMgr.GetCertificateFunc(),",
          "107:    MinVersion:               tls.VersionTLS12,",
          "108:    CipherSuites:             util.GetTLSCiphersFromNames(c.TLSCipherSuites),",
          "109:    PreferServerCipherSuites: true,",
          "110:   }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "108:    NextProtos:               []string{\"http/1.1\", \"h2\"},",
          "",
          "---------------"
        ],
        "templates/webadmin/folders.html||templates/webadmin/folders.html": [
          "File: templates/webadmin/folders.html -> templates/webadmin/folders.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "155:                 var selectedRows = table.rows({ selected: true }).count();",
          "156:                 if (selectedRows == 1){",
          "157:                     var folderName = table.row({ selected: true }).data()[0];",
          "159:                     window.location.href = path;",
          "160:                 } else {",
          "161:                     window.location.href = '{{.FolderTemplateURL}}';",
          "",
          "[Removed Lines]",
          "158:                     var path = '{{.FolderTemplateURL}}' + \"?from=\" + fixedEncodeURIComponent(folderName);",
          "",
          "[Added Lines]",
          "158:                     var path = '{{.FolderTemplateURL}}' + \"?from=\" + encodeURIComponent(folderName);",
          "",
          "---------------"
        ],
        "templates/webadmin/users.html||templates/webadmin/users.html": [
          "File: templates/webadmin/users.html -> templates/webadmin/users.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "159:             titleAttr: \"Clone\",",
          "160:             action: function (e, dt, node, config) {",
          "161:                 var username = dt.row({ selected: true }).data()[1];",
          "163:                 window.location.href = path;",
          "164:             },",
          "165:             enabled: false",
          "",
          "[Removed Lines]",
          "162:                 var path = '{{.UserURL}}' + \"?clone-from=\" + fixedEncodeURIComponent(username);",
          "",
          "[Added Lines]",
          "162:                 var path = '{{.UserURL}}' + \"?clone-from=\" + encodeURIComponent(username);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "172:                 var selectedRows = table.rows({ selected: true }).count();",
          "173:                 if (selectedRows == 1){",
          "174:                     var username = dt.row({ selected: true }).data()[1];",
          "176:                     window.location.href = path;",
          "177:                 } else {",
          "178:                     window.location.href = '{{.UserTemplateURL}}';",
          "",
          "[Removed Lines]",
          "175:                     var path = '{{.UserTemplateURL}}' + \"?from=\" + fixedEncodeURIComponent(username);",
          "",
          "[Added Lines]",
          "175:                     var path = '{{.UserTemplateURL}}' + \"?from=\" + encodeURIComponent(username);",
          "",
          "---------------"
        ],
        "templates/webclient/editfile.html||templates/webclient/editfile.html": [
          "File: templates/webclient/editfile.html -> templates/webclient/editfile.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "134:     {{if not .ReadOnly}}",
          "135:     function saveFile() {",
          "136:         $('#idSave').addClass(\"disabled\");",
          "167:                     }",
          "173:                 }",
          "175:     }",
          "176:     {{end}}",
          "177: </script>",
          "",
          "[Removed Lines]",
          "137:         cm =  document.querySelector('.CodeMirror').CodeMirror;",
          "138:         var path = '{{.FilesURL}}?path={{.CurrentDir}}';",
          "139:         var data = new FormData();",
          "140:         var blob = new Blob([cm.getValue()]);",
          "141:         data.append(\"filenames\", new File([blob], \"{{.Name}}\"));",
          "143:         $.ajax({",
          "144:                 url: path,",
          "145:                 type: 'POST',",
          "146:                 data: data,",
          "147:                 processData: false,",
          "148:                 contentType: false,",
          "149:                 headers: { 'X-CSRF-TOKEN': '{{.CSRFToken}}' },",
          "150:                 timeout: 15000,",
          "151:                 success: function (result) {",
          "152:                     window.location.href = '{{.FilesURL}}?path={{.CurrentDir}}';",
          "153:                 },",
          "154:                 error: function ($xhr, textStatus, errorThrown) {",
          "155:                     $('#idSave').removeClass(\"disabled\");",
          "156:                     var txt = \"Error saving file\";",
          "157:                     if ($xhr) {",
          "158:                         var json = $xhr.responseJSON;",
          "159:                         if (json) {",
          "160:                             if (json.message) {",
          "161:                                 txt = json.message;",
          "162:                             }",
          "163:                             if (json.error) {",
          "164:                                 txt += \": \" + json.error;",
          "165:                             }",
          "166:                         }",
          "168:                     $('#errorTxt').text(txt);",
          "169:                     $('#errorMsg').show();",
          "170:                     setTimeout(function () {",
          "171:                         $('#errorMsg').hide();",
          "172:                     }, 5000);",
          "174:             });",
          "",
          "[Added Lines]",
          "138:         async function uploadFile() {",
          "139:             var errorMessage = \"Error saving file\";",
          "140:             let response;",
          "141:             try {",
          "142:                 var uploadPath = '{{.FileURL}}?path='+encodeURIComponent('{{.CurrentDir}}/{{.Name}}');",
          "143:                 var cm = document.querySelector('.CodeMirror').CodeMirror;",
          "144:                 var blob = new Blob([cm.getValue()]);",
          "145:                 response = await fetch(uploadPath, {",
          "146:                     method: 'POST',",
          "147:                     headers: {",
          "148:                         'X-CSRF-TOKEN': '{{.CSRFToken}}'",
          "149:                     },",
          "150:                     credentials: 'same-origin',",
          "151:                     redirect: 'error',",
          "152:                     body: blob",
          "153:                 });",
          "154:                 if (response.status == 201){",
          "155:                     window.location.href = '{{.FilesURL}}?path='+encodeURIComponent('{{.CurrentDir}}');",
          "156:                 } else {",
          "157:                     let jsonResponse;",
          "158:                     try {",
          "159:                         jsonResponse = await response.json();",
          "160:                     } catch(e){",
          "161:                         throw Error(errorMessage);",
          "162:                     }",
          "163:                     if (jsonResponse.message) {",
          "164:                         errorMessage = jsonResponse.message;",
          "165:                     }",
          "166:                     if (jsonResponse.error) {",
          "167:                         errorMessage += \": \" + jsonResponse.error;",
          "169:                     throw Error(errorMessage);",
          "171:             } catch (e){",
          "172:                 throw Error(errorMessage+\": \" +e.message);",
          "173:             }",
          "174:         }",
          "176:         uploadFile().catch(function(error){",
          "177:             $('#idSave').removeClass(\"disabled\");",
          "178:             $('#errorTxt').text(error.message);",
          "179:             $('#errorMsg').show();",
          "180:             setTimeout(function () {",
          "181:                 $('#errorMsg').hide();",
          "182:             }, 5000);",
          "183:         });",
          "",
          "---------------"
        ],
        "templates/webclient/files.html||templates/webclient/files.html": [
          "File: templates/webclient/files.html -> templates/webclient/files.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "210:         }",
          "211:     }",
          "214:         if (childReference == null || childReference.closed) {",
          "215:             console.log(\"external window null or closed, cannot notify save\");",
          "216:             return;",
          "",
          "[Removed Lines]",
          "213:     function notifySave(status, message){",
          "",
          "[Added Lines]",
          "213:     function notifyBlobDownloadError(message) {",
          "214:         if (childReference == null || childReference.closed) {",
          "215:             console.log(\"external window null or closed, cannot notify download error\");",
          "216:             return;",
          "217:         }",
          "219:         childReference.postMessage({",
          "220:             type: 'blobDownloadError',",
          "221:             message: message",
          "222:         }, childProps.get('url'));",
          "223:     }",
          "225:     function notifySave(status, message) {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "243:                 }, childProps.get('url'));",
          "244:                 break;",
          "245:             case 'sendBlob':",
          "249:                 childReference.postMessage({",
          "250:                     type: 'blobDownloadStart'",
          "251:                 }, childProps.get('url'));",
          "256:                         let fileBlob = new File([responseBlob], childProps.get('file_name'), {type: responseBlob.type, lastModified: \"\"});",
          "257:                         childReference.postMessage({",
          "258:                             type: 'blob',",
          "259:                             file: fileBlob",
          "260:                         }, childProps.get('url'));",
          "262:                 break;",
          "263:             case 'saveBlob':",
          "266:                 spinnerDone = false;",
          "283:                         $('#spinnerModal').modal('hide');",
          "284:                         notifySave(\"OK\", \"\");",
          "285:                         setTimeout(function () {",
          "286:                             location.reload();",
          "287:                         }, 2000);",
          "302:                         }",
          "309:                     }",
          "310:                 });",
          "312:                 break;",
          "",
          "[Removed Lines]",
          "253:                 fetch(childProps.get('link'))",
          "254:                     .then(response => response.blob())",
          "255:                     .then(function(responseBlob){",
          "261:                     });",
          "265:                 var path = '{{.FilesURL}}?path={{.CurrentDir}}';",
          "267:                 var file = new File([event.data.file], childProps.get('file_name'));",
          "268:                 var data = new FormData();",
          "269:                 data.append('filenames', file);",
          "271:                 $.ajax({",
          "272:                     url: path,",
          "273:                     type: 'POST',",
          "274:                     data: data,",
          "275:                     processData: false,",
          "276:                     contentType: false,",
          "277:                     headers: { 'X-CSRF-TOKEN': '{{.CSRFToken}}' },",
          "278:                     timeout: 0,",
          "279:                     beforeSend: function () {",
          "280:                         $('#spinnerModal').modal('show');",
          "281:                     },",
          "282:                     success: function (result) {",
          "288:                     },",
          "289:                     error: function ($xhr, textStatus, errorThrown) {",
          "290:                         $('#spinnerModal').modal('hide');",
          "291:                         var txt = \"Error saving external file\";",
          "292:                         if ($xhr) {",
          "293:                             var json = $xhr.responseJSON;",
          "294:                             if (json) {",
          "295:                                 if (json.message) {",
          "296:                                     txt = json.message;",
          "297:                                 }",
          "298:                                 if (json.error) {",
          "299:                                     txt += \": \" + json.error;",
          "300:                                 }",
          "301:                             }",
          "303:                         notifySave(\"KO\", txt);",
          "304:                         $('#errorTxt').text(txt);",
          "305:                         $('#errorMsg').show();",
          "306:                         setTimeout(function () {",
          "307:                             $('#errorMsg').hide();",
          "308:                         }, 5000);",
          "",
          "[Added Lines]",
          "261:                 var errorMessage = \"Error downloading file\";",
          "266:                 async function downloadFileAsBlob(){",
          "267:                     var errorMessage = \"Error downloading file\";",
          "268:                     let response;",
          "269:                     try {",
          "270:                         response = await fetch(childProps.get('link'),{",
          "271:                             headers: {",
          "272:                                 'X-CSRF-TOKEN': '{{.CSRFToken}}'",
          "273:                             },",
          "274:                             credentials: 'same-origin',",
          "275:                             redirect: 'error'",
          "276:                         });",
          "277:                     } catch (e){",
          "278:                         throw Error(errorMessage+\": \" +e.message);",
          "279:                     }",
          "280:                     if (response.status == 200){",
          "281:                         let responseBlob;",
          "282:                         try {",
          "283:                             responseBlob = await response.blob();",
          "284:                         } catch (e){",
          "285:                             throw Error(errorMessage+\" as blob: \" +e.message);",
          "286:                         }",
          "292:                     } else {",
          "293:                         let jsonResponse;",
          "294:                         try {",
          "295:                             jsonResponse = await response.json();",
          "296:                         } catch(e){",
          "297:                             throw Error(errorMessage);",
          "298:                         }",
          "299:                         if (jsonResponse.message) {",
          "300:                             errorMessage = jsonResponse.message;",
          "301:                         }",
          "302:                         if (jsonResponse.error) {",
          "303:                             errorMessage += \": \" + jsonResponse.error;",
          "304:                         }",
          "305:                         throw Error(errorMessage);",
          "306:                     }",
          "307:                 }",
          "309:                 downloadFileAsBlob().catch(function(error){",
          "310:                     notifyBlobDownloadError(error.message);",
          "311:                         $('#errorTxt').text(error.message);",
          "312:                         $('#errorMsg').show();",
          "313:                         setTimeout(function () {",
          "314:                             $('#errorMsg').hide();",
          "315:                         }, 5000);",
          "316:                 });",
          "320:                 $('#spinnerModal').modal('show');",
          "322:                 async function saveBlob() {",
          "323:                     var errorMessage = \"Error saving external file\";",
          "324:                     var uploadPath = '{{.FileURL}}?path={{.CurrentDir}}'+encodeURIComponent(\"/\"+childProps.get('file_name'));",
          "325:                     let response;",
          "326:                     try {",
          "327:                         response = await fetch(uploadPath, {",
          "328:                             method: 'POST',",
          "329:                             headers: {",
          "330:                                 'X-CSRF-TOKEN': '{{.CSRFToken}}'",
          "331:                             },",
          "332:                             credentials: 'same-origin',",
          "333:                             redirect: 'error',",
          "334:                             body: event.data.file",
          "335:                         });",
          "336:                     } catch (e){",
          "337:                         throw Error(errorMessage+\": \" +e.message);",
          "338:                     }",
          "339:                     if (response.status == 201){",
          "345:                     } else {",
          "346:                         let jsonResponse;",
          "347:                         try {",
          "348:                             jsonResponse = await response.json();",
          "349:                         } catch(e){",
          "350:                             throw Error(errorMessage);",
          "352:                         if (jsonResponse.message) {",
          "353:                             errorMessage = jsonResponse.message;",
          "354:                         }",
          "355:                         if (jsonResponse.error) {",
          "356:                             errorMessage += \": \" + jsonResponse.error;",
          "357:                         }",
          "358:                         throw Error(errorMessage);",
          "360:                 }",
          "362:                 saveBlob().catch(function(error){",
          "363:                     $('#spinnerModal').modal('hide');",
          "364:                     notifySave(\"KO\", error.message);",
          "365:                     $('#errorTxt').text(error.message);",
          "366:                     $('#errorMsg').show();",
          "367:                     setTimeout(function () {",
          "368:                         $('#errorMsg').hide();",
          "369:                     }, 5000);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "465:             } else {",
          "466:                 path = '{{.FilesURL}}';",
          "467:             }",
          "470:             $.ajax({",
          "471:                 url: path,",
          "",
          "[Removed Lines]",
          "468:             path+='?path={{.CurrentDir}}'+fixedEncodeURIComponent(\"/\"+itemName);",
          "",
          "[Added Lines]",
          "528:             path+='?path={{.CurrentDir}}'+encodeURIComponent(\"/\"+itemName);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "526:             event.preventDefault();",
          "527:             $('#createDirModal').modal('hide');",
          "528:             var dirName = replaceSlash($(\"#directory_name\").val());",
          "530:             $.ajax({",
          "531:                 url: path,",
          "532:                 type: 'POST',",
          "",
          "[Removed Lines]",
          "529:             var path = '{{.DirsURL}}?path={{.CurrentDir}}' + fixedEncodeURIComponent(\"/\"+dirName);",
          "",
          "[Added Lines]",
          "589:             var path = '{{.DirsURL}}?path={{.CurrentDir}}' + encodeURIComponent(\"/\"+dirName);",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "562:             event.preventDefault();",
          "563:             keepAlive();",
          "564:             var keepAliveTimer = setInterval(keepAlive, 300000);",
          "567:             var files = $(\"#files_name\")[0].files;",
          "568:             var has_errors = false;",
          "",
          "[Removed Lines]",
          "565:             var path = '{{.FilesURL}}?path={{.CurrentDir}}';",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "584:                     }",
          "585:                     return;",
          "586:                 }",
          "600:                         index++;",
          "601:                         success++;",
          "602:                         uploadFile();",
          "610:                         }",
          "621:                         }",
          "628:                     }",
          "629:                 });",
          "630:             }",
          "",
          "[Removed Lines]",
          "588:                 var data = new FormData();",
          "589:                 data.append('filenames', files[index]);",
          "591:                 $.ajax({",
          "592:                     url: path,",
          "593:                     type: 'POST',",
          "594:                     data: data,",
          "595:                     processData: false,",
          "596:                     contentType: false,",
          "597:                     headers: { 'X-CSRF-TOKEN': '{{.CSRFToken}}' },",
          "598:                     timeout: 0,",
          "599:                     success: function (result) {",
          "603:                     },",
          "604:                     error: function ($xhr, textStatus, errorThrown) {",
          "605:                         index++;",
          "606:                         has_errors = true;",
          "607:                         var txt = \"Error uploading files\";",
          "608:                         if (success > 0){",
          "609:                             txt = \"Not all files have been uploaded, please reload the page\";",
          "611:                         if ($xhr) {",
          "612:                             var json = $xhr.responseJSON;",
          "613:                             if (json) {",
          "614:                                 if (json.message) {",
          "615:                                     txt = json.message;",
          "616:                                 }",
          "617:                                 if (json.error) {",
          "618:                                     txt += \": \" + json.error;",
          "619:                                 }",
          "620:                             }",
          "622:                         $('#errorTxt').text(txt);",
          "623:                         $('#errorMsg').show();",
          "624:                         setTimeout(function () {",
          "625:                             $('#errorMsg').hide();",
          "626:                         }, 10000);",
          "627:                         uploadFile();",
          "",
          "[Added Lines]",
          "647:                 async function saveFile() {",
          "649:                     var errorMessage = \"Error uploading files\";",
          "650:                     let response;",
          "651:                     try {",
          "652:                         var f = files[index];",
          "653:                         var uploadPath = '{{.FileURL}}?path={{.CurrentDir}}'+encodeURIComponent(\"/\"+f.name);",
          "654:                         response = await fetch(uploadPath, {",
          "655:                             method: 'POST',",
          "656:                             headers: {",
          "657:                                 'X-SFTPGO-MTIME': f.lastModified,",
          "658:                                 'X-CSRF-TOKEN': '{{.CSRFToken}}'",
          "659:                             },",
          "660:                             credentials: 'same-origin',",
          "661:                             redirect: 'error',",
          "662:                             body: f",
          "663:                         });",
          "664:                     } catch (e){",
          "665:                         throw Error(errorMessage+\": \" +e.message);",
          "666:                     }",
          "667:                     if (response.status == 201){",
          "671:                     } else {",
          "672:                         let jsonResponse;",
          "673:                         try {",
          "674:                             jsonResponse = await response.json();",
          "675:                         } catch(e){",
          "676:                             throw Error(errorMessage);",
          "678:                         if (jsonResponse.message) {",
          "679:                             errorMessage = jsonResponse.message;",
          "681:                         if (jsonResponse.error) {",
          "682:                             errorMessage += \": \" + jsonResponse.error;",
          "683:                         }",
          "684:                         throw Error(errorMessage);",
          "686:                 }",
          "688:                 saveFile().catch(function(error){",
          "689:                     index++;",
          "690:                     has_errors = true;",
          "691:                     $('#errorTxt').text(error.message);",
          "692:                     $('#errorMsg').show();",
          "693:                     setTimeout(function () {",
          "694:                         $('#errorMsg').hide();",
          "695:                     }, 10000);",
          "696:                     uploadFile();",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "646:             } else {",
          "647:                 path = '{{.FilesURL}}';",
          "648:             }",
          "650:             $('renameModal').modal('hide');",
          "651:             $.ajax({",
          "652:                 url: path,",
          "",
          "[Removed Lines]",
          "649:             path+='?path={{.CurrentDir}}'+fixedEncodeURIComponent(\"/\"+itemName)+'&target={{.CurrentDir}}'+fixedEncodeURIComponent(\"/\"+targetName);",
          "",
          "[Added Lines]",
          "717:             path+='?path={{.CurrentDir}}'+encodeURIComponent(\"/\"+itemName)+'&target={{.CurrentDir}}'+encodeURIComponent(\"/\"+targetName);",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "698:                 for (i = 0; i < selected.length; i++) {",
          "699:                     filesArray.push(getNameFromMeta(selected[i]));",
          "700:                 }",
          "702:                 var downloadURL = '{{.DownloadURL}}';",
          "703:                 var currentDir = '{{.CurrentDir}}';",
          "704:                 var ts = new Date().getTime().toString();",
          "",
          "[Removed Lines]",
          "701:                 var files = fixedEncodeURIComponent(JSON.stringify(filesArray));",
          "",
          "[Added Lines]",
          "769:                 var files = encodeURIComponent(JSON.stringify(filesArray));",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "763:                 for (i = 0; i < selected.length; i++) {",
          "764:                     filesArray.push(getNameFromMeta(selected[i]));",
          "765:                 }",
          "767:                 var shareURL = '{{.ShareURL}}';",
          "768:                 var currentDir = '{{.CurrentDir}}';",
          "769:                 var ts = new Date().getTime().toString();",
          "",
          "[Removed Lines]",
          "766:                 var files = fixedEncodeURIComponent(JSON.stringify(filesArray));",
          "",
          "[Added Lines]",
          "834:                 var files = encodeURIComponent(JSON.stringify(filesArray));",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "808:                 if (!data.sftpgo_dir || data.sftpgo_dir != '{{.CurrentDir}}'){",
          "809:                     data.start = 0;",
          "810:                     data.search.search = \"\";",
          "811:                 }",
          "812:             },",
          "813:             \"columns\": [",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "879:                     data.checkboxes = [];",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "874:                         {{if .HasIntegrations}}",
          "875:                         if (type === 'display') {",
          "876:                             if (data){",
          "878:                             }",
          "879:                         }",
          "880:                         {{end}}",
          "",
          "[Removed Lines]",
          "877:                                 return `<a href=\"#\" onclick=\"openExternalURL('${data}', '${row[\"url\"]}', '${row[\"name\"]}');\"><i class=\"fas fa-external-link-alt\"></i></a>`;",
          "",
          "[Added Lines]",
          "946:                                 return `<a href=\"#\" onclick=\"openExternalURL('${data}', '${row[\"ext_link\"]}', '${row[\"name\"]}');\"><i class=\"fas fa-external-link-alt\"></i></a>`;",
          "",
          "---------------"
        ],
        "templates/webclient/shares.html||templates/webclient/shares.html": [
          "File: templates/webclient/shares.html -> templates/webclient/shares.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "99:                     <p>You can upload one or more files to the shared directory by sending a multipart/form-data request to this <a id=\"writeLink\" href=\"#\" target=\"_blank\">link</a>. The form field name for the file(s) is <b><code>filenames</code></b>.</p>",
          "100:                     <p>For example:</p>",
          "101:                     <p><code>curl -F filenames=@file1.txt -F filenames=@file2.txt \"share link\"</code></p>",
          "102:                 </div>",
          "103:                 <div id=\"expiredShare\">",
          "104:                     This share is no longer accessible because it has expired",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "102:                     <p>You can upload files one by one by adding the path encoded file name to the share <a id=\"writeLinkSingle\" href=\"#\" target=\"_blank\">link</a> and sending the file as POST body. The optional <b><code>X-SFTPGO-MTIME</code></b> header allows to set the file modification time as milliseconds since epoch.</p>",
          "103:                     <p>For example:</p>",
          "104:                     <p><code>curl --data-binary @file.txt -H \"Content-Type: application/octet-stream\" -H \"X-SFTPGO-MTIME: 1638882991234\" \"share link/file.txt\"</code></p>",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "222:                         $('#readShare').hide();",
          "223:                         $('#writeLink').attr(\"href\", shareURL);",
          "224:                         $('#writeLink').attr(\"title\", shareURL);",
          "225:                     }",
          "226:                 }",
          "227:                 $('#linkModal').modal('show');",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "228:                         $('#writeLinkSingle').attr(\"href\", shareURL);",
          "229:                         $('#writeLinkSingle').attr(\"title\", shareURL);",
          "",
          "---------------"
        ],
        "webdavd/server.go||webdavd/server.go": [
          "File: webdavd/server.go -> webdavd/server.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "59:   httpServer.TLSConfig = &tls.Config{",
          "60:    GetCertificate:           certMgr.GetCertificateFunc(),",
          "61:    MinVersion:               tls.VersionTLS12,",
          "62:    CipherSuites:             util.GetTLSCiphersFromNames(s.binding.TLSCipherSuites),",
          "63:    PreferServerCipherSuites: true,",
          "64:   }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "62:    NextProtos:               []string{\"http/1.1\", \"h2\"},",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "80fb56bc48d08746907c5fa63625bd07667d30e9",
      "candidate_info": {
        "commit_hash": "80fb56bc48d08746907c5fa63625bd07667d30e9",
        "repo": "drakkan/sftpgo",
        "commit_url": "https://github.com/drakkan/sftpgo/commit/80fb56bc48d08746907c5fa63625bd07667d30e9",
        "files": [
          "go.mod",
          "go.sum",
          "httpclient/httpclient.go",
          "httpd/httpd.go",
          "httpd/httpd_test.go",
          "httpd/internal_test.go",
          "httpd/server.go",
          "httpd/webclient.go",
          "openapi/openapi.yaml",
          "templates/webclient/files.html",
          "version/version.go"
        ],
        "message": "WebClient: validate PDF files before rendering\n\nSigned-off-by: Nicola Murino <nicola.murino@gmail.com>",
        "before_after_code_files": [
          "go.mod||go.mod",
          "go.sum||go.sum",
          "httpclient/httpclient.go||httpclient/httpclient.go",
          "httpd/httpd.go||httpd/httpd.go",
          "httpd/httpd_test.go||httpd/httpd_test.go",
          "httpd/internal_test.go||httpd/internal_test.go",
          "httpd/server.go||httpd/server.go",
          "httpd/webclient.go||httpd/webclient.go",
          "templates/webclient/files.html||templates/webclient/files.html",
          "version/version.go||version/version.go"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "templates/webclient/files.html||templates/webclient/files.html"
          ],
          "candidate": [
            "templates/webclient/files.html||templates/webclient/files.html"
          ]
        }
      },
      "candidate_diff": {
        "go.mod||go.mod": [
          "File: go.mod -> go.mod",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: go 1.18",
          "5: require (",
          "7:  github.com/Azure/azure-sdk-for-go/sdk/azcore v1.1.3",
          "8:  github.com/Azure/azure-sdk-for-go/sdk/storage/azblob v0.4.1",
          "9:  github.com/GehirnInc/crypt v0.0.0-20200316065508-bb7000b8a962",
          "10:  github.com/alexedwards/argon2id v0.0.0-20211130144151-3585854a6387",
          "20:  github.com/cockroachdb/cockroach-go/v2 v2.2.16",
          "21:  github.com/coreos/go-oidc/v3 v3.4.0",
          "22:  github.com/eikenb/pipeat v0.0.0-20210730190139-06b3e6902001",
          "24:  github.com/fclairamb/go-log v0.4.1",
          "25:  github.com/go-acme/lego/v4 v4.8.0",
          "26:  github.com/go-chi/chi/v5 v5.0.8-0.20220512131524-9e71a0d4b3d6",
          "",
          "[Removed Lines]",
          "6:  cloud.google.com/go/storage v1.26.0",
          "11:  github.com/aws/aws-sdk-go-v2 v1.16.15",
          "12:  github.com/aws/aws-sdk-go-v2/config v1.17.6",
          "13:  github.com/aws/aws-sdk-go-v2/credentials v1.12.19",
          "14:  github.com/aws/aws-sdk-go-v2/feature/ec2/imds v1.12.16",
          "15:  github.com/aws/aws-sdk-go-v2/feature/s3/manager v1.11.32",
          "16:  github.com/aws/aws-sdk-go-v2/service/marketplacemetering v1.13.18",
          "17:  github.com/aws/aws-sdk-go-v2/service/s3 v1.27.10",
          "18:  github.com/aws/aws-sdk-go-v2/service/secretsmanager v1.16.0",
          "19:  github.com/aws/aws-sdk-go-v2/service/sts v1.16.18",
          "23:  github.com/fclairamb/ftpserverlib v0.19.1",
          "",
          "[Added Lines]",
          "6:  cloud.google.com/go/storage v1.27.0",
          "11:  github.com/aws/aws-sdk-go-v2 v1.16.16",
          "12:  github.com/aws/aws-sdk-go-v2/config v1.17.7",
          "13:  github.com/aws/aws-sdk-go-v2/credentials v1.12.20",
          "14:  github.com/aws/aws-sdk-go-v2/feature/ec2/imds v1.12.17",
          "15:  github.com/aws/aws-sdk-go-v2/feature/s3/manager v1.11.33",
          "16:  github.com/aws/aws-sdk-go-v2/service/marketplacemetering v1.13.19",
          "17:  github.com/aws/aws-sdk-go-v2/service/s3 v1.27.11",
          "18:  github.com/aws/aws-sdk-go-v2/service/secretsmanager v1.16.1",
          "19:  github.com/aws/aws-sdk-go-v2/service/sts v1.16.19",
          "23:  github.com/fclairamb/ftpserverlib v0.20.0",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "31:  github.com/google/shlex v0.0.0-20191202100458-e7afc7fbc510",
          "32:  github.com/google/uuid v1.3.0",
          "33:  github.com/grandcat/zeroconf v1.0.0",
          "35:  github.com/hashicorp/go-plugin v1.4.5",
          "36:  github.com/hashicorp/go-retryablehttp v0.7.1",
          "37:  github.com/jlaffaye/ftp v0.0.0-20201112195030-9aae4d151126",
          "",
          "[Removed Lines]",
          "34:  github.com/hashicorp/go-hclog v1.3.0",
          "",
          "[Added Lines]",
          "34:  github.com/hashicorp/go-hclog v1.3.1",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "68:  golang.org/x/crypto v0.0.0-20220829220503-c86fa9a7ed90",
          "69:  golang.org/x/net v0.0.0-20220909164309-bea034e7d591",
          "70:  golang.org/x/oauth2 v0.0.0-20220909003341-f21342109be1",
          "74:  gopkg.in/natefinch/lumberjack.v2 v2.0.0",
          "75: )",
          "",
          "[Removed Lines]",
          "71:  golang.org/x/sys v0.0.0-20220915200043-7b5979e65e41",
          "72:  golang.org/x/time v0.0.0-20220722155302-e5dcc9cfc0b9",
          "73:  google.golang.org/api v0.96.0",
          "",
          "[Added Lines]",
          "71:  golang.org/x/sys v0.0.0-20220919091848-fb04ddd9f9c8",
          "72:  golang.org/x/time v0.0.0-20220922220347-f3bd1da661af",
          "73:  google.golang.org/api v0.97.0",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "81:  github.com/Azure/azure-sdk-for-go/sdk/internal v1.0.1 // indirect",
          "82:  github.com/ajg/form v1.5.1 // indirect",
          "83:  github.com/aws/aws-sdk-go-v2/aws/protocol/eventstream v1.4.8 // indirect",
          "88:  github.com/aws/aws-sdk-go-v2/service/internal/accept-encoding v1.9.9 // indirect",
          "94:  github.com/aws/smithy-go v1.13.3 // indirect",
          "95:  github.com/beorn7/perks v1.0.1 // indirect",
          "96:  github.com/boombuler/barcode v1.0.1 // indirect",
          "",
          "[Removed Lines]",
          "84:  github.com/aws/aws-sdk-go-v2/internal/configsources v1.1.22 // indirect",
          "85:  github.com/aws/aws-sdk-go-v2/internal/endpoints/v2 v2.4.16 // indirect",
          "86:  github.com/aws/aws-sdk-go-v2/internal/ini v1.3.23 // indirect",
          "87:  github.com/aws/aws-sdk-go-v2/internal/v4a v1.0.13 // indirect",
          "89:  github.com/aws/aws-sdk-go-v2/service/internal/checksum v1.1.17 // indirect",
          "90:  github.com/aws/aws-sdk-go-v2/service/internal/presigned-url v1.9.16 // indirect",
          "91:  github.com/aws/aws-sdk-go-v2/service/internal/s3shared v1.13.16 // indirect",
          "92:  github.com/aws/aws-sdk-go-v2/service/sso v1.11.22 // indirect",
          "93:  github.com/aws/aws-sdk-go-v2/service/ssooidc v1.13.4 // indirect",
          "",
          "[Added Lines]",
          "84:  github.com/aws/aws-sdk-go-v2/internal/configsources v1.1.23 // indirect",
          "85:  github.com/aws/aws-sdk-go-v2/internal/endpoints/v2 v2.4.17 // indirect",
          "86:  github.com/aws/aws-sdk-go-v2/internal/ini v1.3.24 // indirect",
          "87:  github.com/aws/aws-sdk-go-v2/internal/v4a v1.0.14 // indirect",
          "89:  github.com/aws/aws-sdk-go-v2/service/internal/checksum v1.1.18 // indirect",
          "90:  github.com/aws/aws-sdk-go-v2/service/internal/presigned-url v1.9.17 // indirect",
          "91:  github.com/aws/aws-sdk-go-v2/service/internal/s3shared v1.13.17 // indirect",
          "92:  github.com/aws/aws-sdk-go-v2/service/sso v1.11.23 // indirect",
          "93:  github.com/aws/aws-sdk-go-v2/service/ssooidc v1.13.5 // indirect",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "156:  golang.org/x/tools v0.1.12 // indirect",
          "157:  golang.org/x/xerrors v0.0.0-20220907171357-04be3eba64a2 // indirect",
          "158:  google.golang.org/appengine v1.6.7 // indirect",
          "160:  google.golang.org/grpc v1.49.0 // indirect",
          "161:  google.golang.org/protobuf v1.28.1 // indirect",
          "162:  gopkg.in/ini.v1 v1.67.0 // indirect",
          "",
          "[Removed Lines]",
          "159:  google.golang.org/genproto v0.0.0-20220916172020-2692e8806bfa // indirect",
          "",
          "[Added Lines]",
          "159:  google.golang.org/genproto v0.0.0-20220921223823-23cae91e6737 // indirect",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "166: )",
          "168: replace (",
          "170:  github.com/jlaffaye/ftp => github.com/drakkan/ftp v0.0.0-20201114075148-9b9adce499a9",
          "171:  golang.org/x/crypto => github.com/drakkan/crypto v0.0.0-20220831070616-b69bc2ec2993",
          "172:  golang.org/x/net => github.com/drakkan/net v0.0.0-20220916171046-9879e3f5b22a",
          "",
          "[Removed Lines]",
          "169:  github.com/fclairamb/ftpserverlib => github.com/drakkan/ftpserverlib v0.0.0-20220917142547-394d5e183aeb",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "go.sum||go.sum": [
          "File: go.sum -> go.sum",
          "--- Hunk 1 ---",
          "[Context before]",
          "76: cloud.google.com/go/storage v1.14.0/go.mod h1:GrKmX003DSIwi9o29oFT7YDnHYwZoctc3fOKtUw0Xmo=",
          "77: cloud.google.com/go/storage v1.21.0/go.mod h1:XmRlxkgPjlBONznT2dDUU/5XlpU2OjMnKuqnZI01LAA=",
          "78: cloud.google.com/go/storage v1.22.1/go.mod h1:S8N1cAStu7BOeFfE8KAQzmyyLkK8p/vmRq6kuBTW58Y=",
          "81: cloud.google.com/go/trace v1.0.0/go.mod h1:4iErSByzxkyHWzzlAj63/Gmjz0NH1ASqhJguHpGcr6A=",
          "82: cloud.google.com/go/trace v1.2.0/go.mod h1:Wc8y/uYyOhPy12KEnXG9XGrvfMz5F5SrYecQlbW1rwM=",
          "83: contrib.go.opencensus.io/exporter/aws v0.0.0-20200617204711-c478e41e60e9/go.mod h1:uu1P0UCM/6RbsMrgPa98ll8ZcHM858i/AD06a9aLRCA=",
          "",
          "[Removed Lines]",
          "79: cloud.google.com/go/storage v1.26.0 h1:lYAGjknyDJirSzfwUlkv4Nsnj7od7foxQNH/fqZqles=",
          "80: cloud.google.com/go/storage v1.26.0/go.mod h1:mk/N7YwIKEWyTvXAWQCIeiCTdLoRH6Pd5xmSnolQLTI=",
          "",
          "[Added Lines]",
          "79: cloud.google.com/go/storage v1.27.0 h1:YOO045NZI9RKfCj1c5A/ZtuuENUc8OAW+gHdGnDgyMQ=",
          "80: cloud.google.com/go/storage v1.27.0/go.mod h1:x9DOL8TK/ygDUMieqwfhdpQryTeEkhGKMi80i/iqR2s=",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "143: github.com/aws/aws-sdk-go v1.37.0/go.mod h1:hcU610XS61/+aQV88ixoOzUoG7v3b31pl2zKMmprdro=",
          "144: github.com/aws/aws-sdk-go v1.43.31/go.mod h1:y4AeaBuwd2Lk+GepC1E9v0qOiTws0MIWAX4oIKwKHZo=",
          "145: github.com/aws/aws-sdk-go-v2 v1.16.2/go.mod h1:ytwTPBG6fXTZLxxeeCCWj2/EMYp/xDUgX+OET6TLNNU=",
          "148: github.com/aws/aws-sdk-go-v2/aws/protocol/eventstream v1.4.1/go.mod h1:n8Bs1ElDD2wJ9kCRTczA83gYbBmjSwZp3umc6zF4EeM=",
          "149: github.com/aws/aws-sdk-go-v2/aws/protocol/eventstream v1.4.8 h1:tcFliCWne+zOuUfKNRn8JdFBuWPDuISDH08wD2ULkhk=",
          "150: github.com/aws/aws-sdk-go-v2/aws/protocol/eventstream v1.4.8/go.mod h1:JTnlBSot91steJeti4ryyu/tLd4Sk84O5W22L7O2EQU=",
          "151: github.com/aws/aws-sdk-go-v2/config v1.15.3/go.mod h1:9YL3v07Xc/ohTsxFXzan9ZpFpdTOFl4X65BAKYaz8jg=",
          "154: github.com/aws/aws-sdk-go-v2/credentials v1.11.2/go.mod h1:j8YsY9TXTm31k4eFhspiQicfXPLZ0gYXA50i4gxPE8g=",
          "157: github.com/aws/aws-sdk-go-v2/feature/ec2/imds v1.12.3/go.mod h1:uk1vhHHERfSVCUnqSqz8O48LBYDSC+k6brng09jcMOk=",
          "160: github.com/aws/aws-sdk-go-v2/feature/s3/manager v1.11.3/go.mod h1:0dHuD2HZZSiwfJSy1FO5bX1hQ1TxVV1QXXjpn3XUE44=",
          "163: github.com/aws/aws-sdk-go-v2/internal/configsources v1.1.9/go.mod h1:AnVH5pvai0pAF4lXRq0bmhbes1u9R8wTE+g+183bZNM=",
          "166: github.com/aws/aws-sdk-go-v2/internal/endpoints/v2 v2.4.3/go.mod h1:ssOhaLpRlh88H3UmEcsBoVKq309quMvm3Ds8e9d4eJM=",
          "169: github.com/aws/aws-sdk-go-v2/internal/ini v1.3.10/go.mod h1:8DcYQcz0+ZJaSxANlHIsbbi6S+zMwjwdDqwW3r9AzaE=",
          "174: github.com/aws/aws-sdk-go-v2/service/internal/accept-encoding v1.9.1/go.mod h1:GeUru+8VzrTXV/83XyMJ80KpH8xO89VPoUileyNQ+tc=",
          "175: github.com/aws/aws-sdk-go-v2/service/internal/accept-encoding v1.9.9 h1:Lh1AShsuIJTwMkoxVCAYPJgNG5H+eN6SmoUn8nOZ5wE=",
          "176: github.com/aws/aws-sdk-go-v2/service/internal/accept-encoding v1.9.9/go.mod h1:a9j48l6yL5XINLHLcOKInjdvknN+vWqPBxqeIDw7ktw=",
          "177: github.com/aws/aws-sdk-go-v2/service/internal/checksum v1.1.3/go.mod h1:Seb8KNmD6kVTjwRjVEgOT5hPin6sq+v4C2ycJQDwuH8=",
          "180: github.com/aws/aws-sdk-go-v2/service/internal/presigned-url v1.9.3/go.mod h1:wlY6SVjuwvh3TVRpTqdy4I1JpBFLX4UGeKZdWntaocw=",
          "183: github.com/aws/aws-sdk-go-v2/service/internal/s3shared v1.13.3/go.mod h1:Bm/v2IaN6rZ+Op7zX+bOUMdL4fsrYZiD0dsjLhNKwZc=",
          "186: github.com/aws/aws-sdk-go-v2/service/kms v1.16.3/go.mod h1:QuiHPBqlOFCi4LqdSskYYAWpQlx3PKmohy+rE2F+o5g=",
          "189: github.com/aws/aws-sdk-go-v2/service/s3 v1.26.3/go.mod h1:g1qvDuRsJY+XghsV6zg00Z4KJ7DtFFCx8fJD2a491Ak=",
          "192: github.com/aws/aws-sdk-go-v2/service/secretsmanager v1.15.4/go.mod h1:PJc8s+lxyU8rrre0/4a0pn2wgwiDvOEzoOjcJUBr67o=",
          "195: github.com/aws/aws-sdk-go-v2/service/sns v1.17.4/go.mod h1:kElt+uCcXxcqFyc+bQqZPFD9DME/eC6oHBXvFzQ9Bcw=",
          "196: github.com/aws/aws-sdk-go-v2/service/sqs v1.18.3/go.mod h1:skmQo0UPvsjsuYYSYMVmrPc1HWCbHUJyrCEp+ZaLzqM=",
          "197: github.com/aws/aws-sdk-go-v2/service/ssm v1.24.1/go.mod h1:NR/xoKjdbRJ+qx0pMR4mI+N/H1I1ynHwXnO6FowXJc0=",
          "198: github.com/aws/aws-sdk-go-v2/service/sso v1.11.3/go.mod h1:7UQ/e69kU7LDPtY40OyoHYgRmgfGM4mgsLYtcObdveU=",
          "203: github.com/aws/aws-sdk-go-v2/service/sts v1.16.3/go.mod h1:bfBj0iVmsUyUg4weDB4NxktD9rDGeKSVWnjTnwbx9b8=",
          "206: github.com/aws/smithy-go v1.11.2/go.mod h1:3xHYmszWVx2c0kIwQeEVf9uSm4fYZt67FBJnwub1bgM=",
          "207: github.com/aws/smithy-go v1.13.3 h1:l7LYxGuzK6/K+NzJ2mC+VvLUbae0sL3bXU//04MkmnA=",
          "208: github.com/aws/smithy-go v1.13.3/go.mod h1:Tg+OJXh4MB2R/uN61Ko2f6hTZwB/ZYGOtib8J3gBHzA=",
          "",
          "[Removed Lines]",
          "146: github.com/aws/aws-sdk-go-v2 v1.16.15 h1:2sInOWGE4HV54R90Pj8QgqBBw3Qf1I0husqbqjPZzys=",
          "147: github.com/aws/aws-sdk-go-v2 v1.16.15/go.mod h1:SwiyXi/1zTUZ6KIAmLK5V5ll8SiURNUYOqTerZPaF9k=",
          "152: github.com/aws/aws-sdk-go-v2/config v1.17.6 h1:0xHMch3eQ2C8CByMEi0iJOLF+pTLoAQeHVfhFxN7eyk=",
          "153: github.com/aws/aws-sdk-go-v2/config v1.17.6/go.mod h1:CrxsoI/AcKUoWyL9Zo0YaDxRlBfSnDZKBYKDdkNYDQ0=",
          "155: github.com/aws/aws-sdk-go-v2/credentials v1.12.19 h1:fYtSz4Fd0lUavtj4FAtvol9G2k0lh1TK4LfeP1hdnLw=",
          "156: github.com/aws/aws-sdk-go-v2/credentials v1.12.19/go.mod h1:fRQMbLwSHPr0XRzuez6x7BX5+0nNQs5BzG+oR4bQKyY=",
          "158: github.com/aws/aws-sdk-go-v2/feature/ec2/imds v1.12.16 h1:LX38v4cqSqrBETHUBnc8B+N6p5YA41GaPQ3jwICjetI=",
          "159: github.com/aws/aws-sdk-go-v2/feature/ec2/imds v1.12.16/go.mod h1:lnJ8tKos2s7JeBdLVFknwVSlQZAKzkgrFNQmUaTWwRQ=",
          "161: github.com/aws/aws-sdk-go-v2/feature/s3/manager v1.11.32 h1:7VX09WtXhjIcJ+CKwYgFsVjypiqg29awSaMH1RQ++Eg=",
          "162: github.com/aws/aws-sdk-go-v2/feature/s3/manager v1.11.32/go.mod h1:zNsdxtYDwAWcxWMgH9+s1U0OOW+jrPLK6HHNw6r76l4=",
          "164: github.com/aws/aws-sdk-go-v2/internal/configsources v1.1.22 h1:pE27/u2A7JlwICjOvONQDob8PToShRTkuiUE74ymVWg=",
          "165: github.com/aws/aws-sdk-go-v2/internal/configsources v1.1.22/go.mod h1:/vNv5Al0bpiF8YdX2Ov6Xy05VTiXsql94yUqJMYaj0w=",
          "167: github.com/aws/aws-sdk-go-v2/internal/endpoints/v2 v2.4.16 h1:L5LKGHHXOl4t7+5QZMTl38GIzSAq07XUTRtEquiHGMA=",
          "168: github.com/aws/aws-sdk-go-v2/internal/endpoints/v2 v2.4.16/go.mod h1:62dsXI0BqTIGomDl8Hpm33dv0OntGaVblri3ZRParVQ=",
          "170: github.com/aws/aws-sdk-go-v2/internal/ini v1.3.23 h1:Sy266MXyLZZbObFhStGF9dyJm5nFyA8LINTgNm4Q6Ds=",
          "171: github.com/aws/aws-sdk-go-v2/internal/ini v1.3.23/go.mod h1:XtEkQMmxls+Tb5dZLmpa1QAk0OzSIFDAXanC9Jkf81E=",
          "172: github.com/aws/aws-sdk-go-v2/internal/v4a v1.0.13 h1:ZrdsZJfzniYAF3Au4ngj7vWxJS1ZHGYCE0YlATcWYUg=",
          "173: github.com/aws/aws-sdk-go-v2/internal/v4a v1.0.13/go.mod h1:QyDZ5fgUmZFZztFpVcR7w4HV8vwO0ze1OM9rPy6jkEI=",
          "178: github.com/aws/aws-sdk-go-v2/service/internal/checksum v1.1.17 h1:rf0/i+3BMiQZjcQzhjTz3sAXouSl1dcnCrd8mroC4CE=",
          "179: github.com/aws/aws-sdk-go-v2/service/internal/checksum v1.1.17/go.mod h1:Uo/4yJjc7RDB7R5q9JA7aQqFXasu/lAJke8mulo2dA8=",
          "181: github.com/aws/aws-sdk-go-v2/service/internal/presigned-url v1.9.16 h1:9jysIwpUt7KGdsKOl+zA+0pG+7MpSsi0KQUcbE48n38=",
          "182: github.com/aws/aws-sdk-go-v2/service/internal/presigned-url v1.9.16/go.mod h1:faBcf/4ZB4FRc17geaXWOxgzktotyJgBcUBZoHqvdfM=",
          "184: github.com/aws/aws-sdk-go-v2/service/internal/s3shared v1.13.16 h1:jnGshlNJoVF3x8e5EbsFakNKeNUc0Pf3EQvU076bkKU=",
          "185: github.com/aws/aws-sdk-go-v2/service/internal/s3shared v1.13.16/go.mod h1:tMN4hfJxozc/lHWA8Ug/eXEg4ZSm5c4sPB9WE/mdDuw=",
          "187: github.com/aws/aws-sdk-go-v2/service/marketplacemetering v1.13.18 h1:VoxHI3YKYQ1ewtBnfSUsZ8he0tdot/mZuE/vP4qJgBw=",
          "188: github.com/aws/aws-sdk-go-v2/service/marketplacemetering v1.13.18/go.mod h1:zan7AawF2v5WynzqKdF0aeYWZboYiOZ7vMWlhSGLCwQ=",
          "190: github.com/aws/aws-sdk-go-v2/service/s3 v1.27.10 h1:fR5Z06dU41kkSdmSOtHiROealTOu5aNkwidOQ+lT0KQ=",
          "191: github.com/aws/aws-sdk-go-v2/service/s3 v1.27.10/go.mod h1:B+5EUmLgCYrXHxgQ3nTUu3RUbxnrN1JMa41LSXm7lXw=",
          "193: github.com/aws/aws-sdk-go-v2/service/secretsmanager v1.16.0 h1:Lh1yssM4dinNZuESsXnbi+pID8hoviejLZdLmT175i8=",
          "194: github.com/aws/aws-sdk-go-v2/service/secretsmanager v1.16.0/go.mod h1:z0y2iDaghoq7uv6kndhrJCTzgVckv8Aak8kpnu2kYjs=",
          "199: github.com/aws/aws-sdk-go-v2/service/sso v1.11.22 h1:LrEyMbp0gMiXVaXpJ67jJkkqKCxivZvOd6wgXem0bWA=",
          "200: github.com/aws/aws-sdk-go-v2/service/sso v1.11.22/go.mod h1:B2nDzX7lppT8j4EV2/WhT20SnRDp/LdNyqxyGYY46Ow=",
          "201: github.com/aws/aws-sdk-go-v2/service/ssooidc v1.13.4 h1:d7Wh4xMQVVYfrJ1KHFGQ6jY/O51LjnTCWJgh85RT+TQ=",
          "202: github.com/aws/aws-sdk-go-v2/service/ssooidc v1.13.4/go.mod h1:mOofcMJCDSJwmtZykUE/i6tWGNwMnkextriwzY1zcbc=",
          "204: github.com/aws/aws-sdk-go-v2/service/sts v1.16.18 h1:TqEvnK8OceCKNQaDK9d5Ir2bOtC0S0dRQCwSbkV1rz0=",
          "205: github.com/aws/aws-sdk-go-v2/service/sts v1.16.18/go.mod h1:AE4zMc8qCw1JnDvy0ZrDVb/OXRuuweG3BcT2Nv7Qh3E=",
          "",
          "[Added Lines]",
          "146: github.com/aws/aws-sdk-go-v2 v1.16.16 h1:M1fj4FE2lB4NzRb9Y0xdWsn2P0+2UHVxwKyOa4YJNjk=",
          "147: github.com/aws/aws-sdk-go-v2 v1.16.16/go.mod h1:SwiyXi/1zTUZ6KIAmLK5V5ll8SiURNUYOqTerZPaF9k=",
          "152: github.com/aws/aws-sdk-go-v2/config v1.17.7 h1:odVM52tFHhpqZBKNjVW5h+Zt1tKHbhdTQRb+0WHrNtw=",
          "153: github.com/aws/aws-sdk-go-v2/config v1.17.7/go.mod h1:dN2gja/QXxFF15hQreyrqYhLBaQo1d9ZKe/v/uplQoI=",
          "155: github.com/aws/aws-sdk-go-v2/credentials v1.12.20 h1:9+ZhlDY7N9dPnUmf7CDfW9In4sW5Ff3bh7oy4DzS1IE=",
          "156: github.com/aws/aws-sdk-go-v2/credentials v1.12.20/go.mod h1:UKY5HyIux08bbNA7Blv4PcXQ8cTkGh7ghHMFklaviR4=",
          "158: github.com/aws/aws-sdk-go-v2/feature/ec2/imds v1.12.17 h1:r08j4sbZu/RVi+BNxkBJwPMUYY3P8mgSDuKkZ/ZN1lE=",
          "159: github.com/aws/aws-sdk-go-v2/feature/ec2/imds v1.12.17/go.mod h1:yIkQcCDYNsZfXpd5UX2Cy+sWA1jPgIhGTw9cOBzfVnQ=",
          "161: github.com/aws/aws-sdk-go-v2/feature/s3/manager v1.11.33 h1:fAoVmNGhir6BR+RU0/EI+6+D7abM+MCwWf8v4ip5jNI=",
          "162: github.com/aws/aws-sdk-go-v2/feature/s3/manager v1.11.33/go.mod h1:84XgODVR8uRhmOnUkKGUZKqIMxmjmLOR8Uyp7G/TPwc=",
          "164: github.com/aws/aws-sdk-go-v2/internal/configsources v1.1.23 h1:s4g/wnzMf+qepSNgTvaQQHNxyMLKSawNhKCPNy++2xY=",
          "165: github.com/aws/aws-sdk-go-v2/internal/configsources v1.1.23/go.mod h1:2DFxAQ9pfIRy0imBCJv+vZ2X6RKxves6fbnEuSry6b4=",
          "167: github.com/aws/aws-sdk-go-v2/internal/endpoints/v2 v2.4.17 h1:/K482T5A3623WJgWT8w1yRAFK4RzGzEl7y39yhtn9eA=",
          "168: github.com/aws/aws-sdk-go-v2/internal/endpoints/v2 v2.4.17/go.mod h1:pRwaTYCJemADaqCbUAxltMoHKata7hmB5PjEXeu0kfg=",
          "170: github.com/aws/aws-sdk-go-v2/internal/ini v1.3.24 h1:wj5Rwc05hvUSvKuOF29IYb9QrCLjU+rHAy/x/o0DK2c=",
          "171: github.com/aws/aws-sdk-go-v2/internal/ini v1.3.24/go.mod h1:jULHjqqjDlbyTa7pfM7WICATnOv+iOhjletM3N0Xbu8=",
          "172: github.com/aws/aws-sdk-go-v2/internal/v4a v1.0.14 h1:ZSIPAkAsCCjYrhqfw2+lNzWDzxzHXEckFkTePL5RSWQ=",
          "173: github.com/aws/aws-sdk-go-v2/internal/v4a v1.0.14/go.mod h1:AyGgqiKv9ECM6IZeNQtdT8NnMvUb3/2wokeq2Fgryto=",
          "178: github.com/aws/aws-sdk-go-v2/service/internal/checksum v1.1.18 h1:BBYoNQt2kUZUUK4bIPsKrCcjVPUMNsgQpNAwhznK/zo=",
          "179: github.com/aws/aws-sdk-go-v2/service/internal/checksum v1.1.18/go.mod h1:NS55eQ4YixUJPTC+INxi2/jCqe1y2Uw3rnh9wEOVJxY=",
          "181: github.com/aws/aws-sdk-go-v2/service/internal/presigned-url v1.9.17 h1:Jrd/oMh0PKQc6+BowB+pLEwLIgaQF29eYbe7E1Av9Ug=",
          "182: github.com/aws/aws-sdk-go-v2/service/internal/presigned-url v1.9.17/go.mod h1:4nYOrY41Lrbk2170/BGkcJKBhws9Pfn8MG3aGqjjeFI=",
          "184: github.com/aws/aws-sdk-go-v2/service/internal/s3shared v1.13.17 h1:HfVVR1vItaG6le+Bpw6P4midjBDMKnjMyZnw9MXYUcE=",
          "185: github.com/aws/aws-sdk-go-v2/service/internal/s3shared v1.13.17/go.mod h1:YqMdV+gEKCQ59NrB7rzrJdALeBIsYiVi8Inj3+KcqHI=",
          "187: github.com/aws/aws-sdk-go-v2/service/marketplacemetering v1.13.19 h1:6rxMT+zWZh2+0F1XHdDWCSzuMQIJI+tGlfrFi6V/UlU=",
          "188: github.com/aws/aws-sdk-go-v2/service/marketplacemetering v1.13.19/go.mod h1:wGzRNLBD3V8/KKoBSYz0OWv1dnQNvqTyb193fS97dXQ=",
          "190: github.com/aws/aws-sdk-go-v2/service/s3 v1.27.11 h1:3/gm/JTX9bX8CpzTgIlrtYpB3EVBDxyg/GY/QdcIEZw=",
          "191: github.com/aws/aws-sdk-go-v2/service/s3 v1.27.11/go.mod h1:fmgDANqTUCxciViKl9hb/zD5LFbvPINFRgWhDbR+vZo=",
          "193: github.com/aws/aws-sdk-go-v2/service/secretsmanager v1.16.1 h1:eMsEmvJR6zQ1lDi59RDtCc62x9fKs1kv2b8A8nPpWmY=",
          "194: github.com/aws/aws-sdk-go-v2/service/secretsmanager v1.16.1/go.mod h1:HEBBc70BYi5eUvxBqC3xXjU/04NO96X/XNUe5qhC7Bc=",
          "199: github.com/aws/aws-sdk-go-v2/service/sso v1.11.23 h1:pwvCchFUEnlceKIgPUouBJwK81aCkQ8UDMORfeFtW10=",
          "200: github.com/aws/aws-sdk-go-v2/service/sso v1.11.23/go.mod h1:/w0eg9IhFGjGyyncHIQrXtU8wvNsTJOP0R6PPj0wf80=",
          "201: github.com/aws/aws-sdk-go-v2/service/ssooidc v1.13.5 h1:GUnZ62TevLqIoDyHeiWj2P7EqaosgakBKVvWriIdLQY=",
          "202: github.com/aws/aws-sdk-go-v2/service/ssooidc v1.13.5/go.mod h1:csZuQY65DAdFBt1oIjO5hhBR49kQqop4+lcuCjf2arA=",
          "204: github.com/aws/aws-sdk-go-v2/service/sts v1.16.19 h1:9pPi0PsFNAGILFfPCk8Y0iyEBGc6lu6OQ97U7hmdesg=",
          "205: github.com/aws/aws-sdk-go-v2/service/sts v1.16.19/go.mod h1:h4J3oPZQbxLhzGnk+j9dfYHi5qIOVJ5kczZd658/ydM=",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "268: github.com/drakkan/crypto v0.0.0-20220831070616-b69bc2ec2993/go.mod h1:SiM6ypd8Xu1xldObYtbDztuUU7xUzMnUULfphXFZmro=",
          "269: github.com/drakkan/ftp v0.0.0-20201114075148-9b9adce499a9 h1:LPH1dEblAOO/LoG7yHPMtBLXhQmjaga91/DDjWk9jWA=",
          "270: github.com/drakkan/ftp v0.0.0-20201114075148-9b9adce499a9/go.mod h1:2lmrmq866uF2tnje75wQHzmPXhmSWUt7Gyx2vgK1RCU=",
          "273: github.com/drakkan/net v0.0.0-20220916171046-9879e3f5b22a h1:DXelKiOuwaiblhsGccshNDZLf5etRwx3IWInVf2f3Z8=",
          "274: github.com/drakkan/net v0.0.0-20220916171046-9879e3f5b22a/go.mod h1:YDH+HFinaLZZlnHAfSS6ZXJJ9M9t4Dl22yv3iI2vPwk=",
          "275: github.com/eikenb/pipeat v0.0.0-20210730190139-06b3e6902001 h1:/ZshrfQzayqRSBDodmp3rhNCHJCff+utvgBuWRbiqu4=",
          "",
          "[Removed Lines]",
          "271: github.com/drakkan/ftpserverlib v0.0.0-20220917142547-394d5e183aeb h1:sd63fxu7eKejDU0fBiGvVejeEEXNcGv6SVmXrFsDaKM=",
          "272: github.com/drakkan/ftpserverlib v0.0.0-20220917142547-394d5e183aeb/go.mod h1:Nwsxl2ZzyPiSCgB1rZGnEscTenwkxPhCn1D+Hm/k9JA=",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "286: github.com/envoyproxy/protoc-gen-validate v0.1.0/go.mod h1:iSmxcyjqTsJpI2R4NaDN7+kN2VEUnK/pcBlmesArF7c=",
          "287: github.com/fatih/color v1.13.0 h1:8LOYc1KYPPmyKMuN8QV2DNRWNbLo6LZ0iLs8+mlH53w=",
          "288: github.com/fatih/color v1.13.0/go.mod h1:kLAiJbzzSOZDVNGyDpeOxJ47H46qBXwg5ILebYFFOfk=",
          "289: github.com/fclairamb/go-log v0.4.1 h1:rLtdSG9x2pK41AIAnE8WYpl05xBJfw1ZyYxZaXFcBsM=",
          "290: github.com/fclairamb/go-log v0.4.1/go.mod h1:sw1KvnkZ4wKCYkvy4SL3qVZcJSWFP8Ure4pM3z+KNn4=",
          "291: github.com/form3tech-oss/jwt-go v3.2.2+incompatible/go.mod h1:pbq4aXjuKjdthFRnoDwaVPLA+WlJuPGy+QneDUgJi2k=",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "287: github.com/fclairamb/ftpserverlib v0.20.0 h1:9NjQPxo3T0XQCyzSXZJ0XBH4mk4Qv4Lpw3GNVabvnpU=",
          "288: github.com/fclairamb/ftpserverlib v0.20.0/go.mod h1:7pR5Ckeygw3T006z1ND6HYSbJz+fTvkFAXlF6snW4yI=",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "464: github.com/hashicorp/go-cleanhttp v0.5.2 h1:035FKYIWjmULyFRBKPs8TBQoi0x6d9G4xc9neXJWAZQ=",
          "465: github.com/hashicorp/go-cleanhttp v0.5.2/go.mod h1:kO/YDlP8L1346E6Sodw+PrpBSV4/SoxCXGY6BqNFT48=",
          "466: github.com/hashicorp/go-hclog v0.9.2/go.mod h1:5CU+agLiy3J7N7QjHK5d05KxGsuXiQLrjA0H7acj2lQ=",
          "469: github.com/hashicorp/go-plugin v1.4.5 h1:oTE/oQR4eghggRg8VY7PAz3dr++VwDNBGCcOfIvHpBo=",
          "470: github.com/hashicorp/go-plugin v1.4.5/go.mod h1:viDMjcLJuDui6pXb8U4HVfb8AamCWhHGUjr2IrTF67s=",
          "471: github.com/hashicorp/go-retryablehttp v0.7.1 h1:sUiuQAnLlbvmExtFQs72iFW/HXeUn8Z1aJLQ4LJJbTQ=",
          "",
          "[Removed Lines]",
          "467: github.com/hashicorp/go-hclog v1.3.0 h1:G0ACM8Z2WilWgPv3Vdzwm3V0BQu/kSmrkVtpe1fy9do=",
          "468: github.com/hashicorp/go-hclog v1.3.0/go.mod h1:W4Qnvbt70Wk/zYJryRzDRU/4r0kIg0PVHBcfoyhpF5M=",
          "",
          "[Added Lines]",
          "467: github.com/hashicorp/go-hclog v1.3.1 h1:vDwF1DFNZhntP4DAjuTpOw3uEgMUpXh1pB5fW9DqHpo=",
          "468: github.com/hashicorp/go-hclog v1.3.1/go.mod h1:W4Qnvbt70Wk/zYJryRzDRU/4r0kIg0PVHBcfoyhpF5M=",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "980: golang.org/x/sys v0.0.0-20220704084225-05e143d24a9e/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=",
          "981: golang.org/x/sys v0.0.0-20220728004956-3c1f35247d10/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=",
          "982: golang.org/x/sys v0.0.0-20220811171246-fbc7d0a398ab/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=",
          "985: golang.org/x/term v0.0.0-20201126162022-7de9c90e9dd1/go.mod h1:bj7SfCRtBDWHUb9snDiAeCFNEtKQo2Wmx5Cou7ajbmo=",
          "986: golang.org/x/term v0.0.0-20210927222741-03fcf44c2211 h1:JGgROgKl9N8DuW20oFS5gxc+lE67/N3FcwmBPMe7ArY=",
          "987: golang.org/x/term v0.0.0-20210927222741-03fcf44c2211/go.mod h1:jbD1KX2456YbFQfuXm/mYQcufACuNUgVhRMnK/tPxf8=",
          "",
          "[Removed Lines]",
          "983: golang.org/x/sys v0.0.0-20220915200043-7b5979e65e41 h1:ohgcoMbSofXygzo6AD2I1kz3BFmW1QArPYTtwEM3UXc=",
          "984: golang.org/x/sys v0.0.0-20220915200043-7b5979e65e41/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=",
          "",
          "[Added Lines]",
          "983: golang.org/x/sys v0.0.0-20220919091848-fb04ddd9f9c8 h1:h+EGohizhe9XlX18rfpa8k8RAc5XyaeamM+0VHRd4lc=",
          "984: golang.org/x/sys v0.0.0-20220919091848-fb04ddd9f9c8/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "1000: golang.org/x/time v0.0.0-20191024005414-555d28b269f0/go.mod h1:tRJNPiyCQ0inRvYxbN9jk5I+vvW/OXSQhTDSoE431IQ=",
          "1001: golang.org/x/time v0.0.0-20211116232009-f0f3c7e86c11/go.mod h1:tRJNPiyCQ0inRvYxbN9jk5I+vvW/OXSQhTDSoE431IQ=",
          "1002: golang.org/x/time v0.0.0-20220224211638-0e9765cccd65/go.mod h1:tRJNPiyCQ0inRvYxbN9jk5I+vvW/OXSQhTDSoE431IQ=",
          "1005: golang.org/x/tools v0.0.0-20180917221912-90fa682c2a6e/go.mod h1:n7NCudcB/nEzxVGmLbDWY5pfWTLqBcC2KZ6jyYvM4mQ=",
          "1006: golang.org/x/tools v0.0.0-20190114222345-bf090417da8b/go.mod h1:n7NCudcB/nEzxVGmLbDWY5pfWTLqBcC2KZ6jyYvM4mQ=",
          "1007: golang.org/x/tools v0.0.0-20190226205152-f727befe758c/go.mod h1:9Yl7xja0Znq3iFh3HoIrodX9oNMXvdceNzlUR8zjMvY=",
          "",
          "[Removed Lines]",
          "1003: golang.org/x/time v0.0.0-20220722155302-e5dcc9cfc0b9 h1:ftMN5LMiBFjbzleLqtoBZk7KdJwhuybIU+FckUHgoyQ=",
          "1004: golang.org/x/time v0.0.0-20220722155302-e5dcc9cfc0b9/go.mod h1:tRJNPiyCQ0inRvYxbN9jk5I+vvW/OXSQhTDSoE431IQ=",
          "",
          "[Added Lines]",
          "1003: golang.org/x/time v0.0.0-20220922220347-f3bd1da661af h1:Yx9k8YCG3dvF87UAn2tu2HQLf2dt/eR1bXxpLMWeH+Y=",
          "1004: golang.org/x/time v0.0.0-20220922220347-f3bd1da661af/go.mod h1:tRJNPiyCQ0inRvYxbN9jk5I+vvW/OXSQhTDSoE431IQ=",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "1123: google.golang.org/api v0.78.0/go.mod h1:1Sg78yoMLOhlQTeF+ARBoytAcH1NNyyl390YMy6rKmw=",
          "1124: google.golang.org/api v0.80.0/go.mod h1:xY3nI94gbvBrE0J6NHXhxOmW97HG7Khjkku6AFB3Hyg=",
          "1125: google.golang.org/api v0.84.0/go.mod h1:NTsGnUFJMYROtiquksZHBWtHfeMC7iYthki7Eq3pa8o=",
          "1128: google.golang.org/appengine v1.1.0/go.mod h1:EbEs0AVv82hx2wNQdGPgUI5lhzA/G0D9YwlJXL52JkM=",
          "1129: google.golang.org/appengine v1.4.0/go.mod h1:xpcJRLb0r/rnEns0DIKYYv+WjYCduHsrkT7/EB5XEv4=",
          "1130: google.golang.org/appengine v1.5.0/go.mod h1:xpcJRLb0r/rnEns0DIKYYv+WjYCduHsrkT7/EB5XEv4=",
          "",
          "[Removed Lines]",
          "1126: google.golang.org/api v0.96.0 h1:F60cuQPJq7K7FzsxMYHAUJSiXh2oKctHxBMbDygxhfM=",
          "1127: google.golang.org/api v0.96.0/go.mod h1:w7wJQLTM+wvQpNf5JyEcBoxK0RH7EDrh/L4qfsuJ13s=",
          "",
          "[Added Lines]",
          "1126: google.golang.org/api v0.97.0 h1:x/vEL1XDF/2V4xzdNgFPaKHluRESo2aTsL7QzHnBtGQ=",
          "1127: google.golang.org/api v0.97.0/go.mod h1:w7wJQLTM+wvQpNf5JyEcBoxK0RH7EDrh/L4qfsuJ13s=",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "1229: google.golang.org/genproto v0.0.0-20220608133413-ed9918b62aac/go.mod h1:KEWEmljWE5zPzLBa/oHl6DaEt9LmfH6WtH1OHIvleBA=",
          "1230: google.golang.org/genproto v0.0.0-20220616135557-88e70c0c3a90/go.mod h1:KEWEmljWE5zPzLBa/oHl6DaEt9LmfH6WtH1OHIvleBA=",
          "1231: google.golang.org/genproto v0.0.0-20220624142145-8cd45d7dbd1f/go.mod h1:KEWEmljWE5zPzLBa/oHl6DaEt9LmfH6WtH1OHIvleBA=",
          "1234: google.golang.org/grpc v1.19.0/go.mod h1:mqu4LbDTu4XGKhr4mRzUsmM4RtVoemTSY81AxZiDr8c=",
          "1235: google.golang.org/grpc v1.20.1/go.mod h1:10oTOabMzJvdu6/UiuZezV6QK5dSlG84ov/aaiqXj38=",
          "1236: google.golang.org/grpc v1.21.1/go.mod h1:oYelfM1adQP15Ek0mdvEgi9Df8B9CZIaU1084ijfRaM=",
          "",
          "[Removed Lines]",
          "1232: google.golang.org/genproto v0.0.0-20220916172020-2692e8806bfa h1:VWkrxnAx2C2hirAP+W5ADU7e/+93Yhk//ioKd2XFyDI=",
          "1233: google.golang.org/genproto v0.0.0-20220916172020-2692e8806bfa/go.mod h1:0Nb8Qy+Sk5eDzHnzlStwW3itdNaWoZA5XeSG+R3JHSo=",
          "",
          "[Added Lines]",
          "1232: google.golang.org/genproto v0.0.0-20220921223823-23cae91e6737 h1:K1zaaMdYBXRyX+cwFnxj7M6zwDyumLQMZ5xqwGvjreQ=",
          "1233: google.golang.org/genproto v0.0.0-20220921223823-23cae91e6737/go.mod h1:2r/26NEF3bFmT3eC3aZreahSal0C3Shl8Gi6vyDYqOQ=",
          "",
          "---------------"
        ],
        "httpclient/httpclient.go||httpclient/httpclient.go": [
          "File: httpclient/httpclient.go -> httpclient/httpclient.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "75:  Headers         []Header `json:\"headers\" mapstructure:\"headers\"`",
          "76:  customTransport *http.Transport",
          "78: }",
          "80: const logSender = \"httpclient\"",
          "",
          "[Removed Lines]",
          "77:  tlsConfig       *tls.Config",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "85: func (c *Config) Initialize(configDir string) error {",
          "86:  rootCAs, err := c.loadCACerts(configDir)",
          "87:  if err != nil {",
          "88:   return err",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "85:  if c.Timeout <= 0 {",
          "86:   return fmt.Errorf(\"invalid timeout: %v\", c.Timeout)",
          "87:  }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "98:  }",
          "99:  customTransport.TLSClientConfig.InsecureSkipVerify = c.SkipTLSVerify",
          "100:  c.customTransport = customTransport",
          "103:  err = c.loadCertificates(configDir)",
          "104:  if err != nil {",
          "",
          "[Removed Lines]",
          "101:  c.tlsConfig = customTransport.TLSClientConfig",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "170:   if err != nil {",
          "171:    return fmt.Errorf(\"unable to load key pair %#v, %#v: %v\", cert, key, err)",
          "172:   }",
          "173:   logger.Debug(logSender, \"\", \"client certificate %#v and key %#v successfully loaded\", cert, key)",
          "175:  }",
          "176:  return nil",
          "177: }",
          "",
          "[Removed Lines]",
          "174:   c.tlsConfig.Certificates = append(c.tlsConfig.Certificates, tlsCert)",
          "",
          "[Added Lines]",
          "174:   x509Cert, err := x509.ParseCertificate(tlsCert.Certificate[0])",
          "175:   if err == nil {",
          "176:    logger.Debug(logSender, \"\", \"adding leaf certificate for key pair %q, %q\", cert, key)",
          "177:    tlsCert.Leaf = x509Cert",
          "178:   }",
          "180:   c.customTransport.TLSClientConfig.Certificates = append(c.customTransport.TLSClientConfig.Certificates, tlsCert)",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "189: func GetRetraybleHTTPClient() *retryablehttp.Client {",
          "190:  client := retryablehttp.NewClient()",
          "191:  client.HTTPClient.Timeout = time.Duration(httpConfig.Timeout * float64(time.Second))",
          "193:  client.Logger = &logger.LeveledLogger{Sender: \"RetryableHTTPClient\"}",
          "194:  client.RetryWaitMin = time.Duration(httpConfig.RetryWaitMin) * time.Second",
          "195:  client.RetryWaitMax = time.Duration(httpConfig.RetryWaitMax) * time.Second",
          "",
          "[Removed Lines]",
          "192:  client.HTTPClient.Transport.(*http.Transport).TLSClientConfig = httpConfig.tlsConfig",
          "",
          "[Added Lines]",
          "198:  client.HTTPClient.Transport.(*http.Transport).TLSClientConfig = httpConfig.customTransport.TLSClientConfig",
          "",
          "---------------"
        ],
        "httpd/httpd.go||httpd/httpd.go": [
          "File: httpd/httpd.go -> httpd/httpd.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "164:  webClientForgotPwdPathDefault         = \"/web/client/forgot-password\"",
          "165:  webClientResetPwdPathDefault          = \"/web/client/reset-password\"",
          "166:  webClientViewPDFPathDefault           = \"/web/client/viewpdf\"",
          "167:  webStaticFilesPathDefault             = \"/static\"",
          "168:  webOpenAPIPathDefault                 = \"/openapi\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "167:  webClientGetPDFPathDefault            = \"/web/client/getpdf\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "245:  webClientForgotPwdPath         string",
          "246:  webClientResetPwdPath          string",
          "247:  webClientViewPDFPath           string",
          "248:  webStaticFilesPath             string",
          "249:  webOpenAPIPath                 string",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "249:  webClientGetPDFPath            string",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "959:  webClientForgotPwdPath = path.Join(baseURL, webClientForgotPwdPathDefault)",
          "960:  webClientResetPwdPath = path.Join(baseURL, webClientResetPwdPathDefault)",
          "961:  webClientViewPDFPath = path.Join(baseURL, webClientViewPDFPathDefault)",
          "962: }",
          "964: func updateWebAdminURLs(baseURL string) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "964:  webClientGetPDFPath = path.Join(baseURL, webClientGetPDFPathDefault)",
          "",
          "---------------"
        ],
        "httpd/httpd_test.go||httpd/httpd_test.go": [
          "File: httpd/httpd_test.go -> httpd/httpd_test.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "180:  webClientForgotPwdPath          = \"/web/client/forgot-password\"",
          "181:  webClientResetPwdPath           = \"/web/client/reset-password\"",
          "182:  webClientViewPDFPath            = \"/web/client/viewpdf\"",
          "183:  httpBaseURL                     = \"http://127.0.0.1:8081\"",
          "184:  defaultRemoteAddr               = \"127.0.0.1:1234\"",
          "185:  sftpServerAddr                  = \"127.0.0.1:8022\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "183:  webClientGetPDFPath             = \"/web/client/getpdf\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "9706:  checkResponseCode(t, http.StatusTooManyRequests, rr)",
          "9707:  assert.Contains(t, rr.Body.String(), \"too many open sessions\")",
          "9710:  smtpCfg := smtp.Config{",
          "9711:   Host:          \"127.0.0.1\",",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "9710:  req, err = http.NewRequest(http.MethodGet, webClientGetPDFPath+\"?path=file\", nil)",
          "9711:  assert.NoError(t, err)",
          "9712:  setJWTCookieForReq(req, webToken)",
          "9713:  rr = executeRequest(req)",
          "9714:  checkResponseCode(t, http.StatusTooManyRequests, rr)",
          "9715:  assert.Contains(t, rr.Body.String(), \"too many open sessions\")",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "11740:  rr := executeRequest(req)",
          "11741:  checkResponseCode(t, http.StatusBadRequest, rr)",
          "11743:  req, err = http.NewRequest(http.MethodGet, webClientViewPDFPath+\"?path=test.pdf\", nil)",
          "11744:  assert.NoError(t, err)",
          "11745:  setJWTCookieForReq(req, webToken)",
          "11746:  rr = executeRequest(req)",
          "11747:  checkResponseCode(t, http.StatusOK, rr)",
          "11749:  _, err = httpdtest.RemoveUser(user, http.StatusOK)",
          "11750:  assert.NoError(t, err)",
          "11751:  err = os.RemoveAll(user.GetHomeDir())",
          "11752:  assert.NoError(t, err)",
          "11753: }",
          "11755: func TestWebEditFile(t *testing.T) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "11751:  req, err = http.NewRequest(http.MethodGet, webClientGetPDFPath, nil)",
          "11752:  assert.NoError(t, err)",
          "11753:  setJWTCookieForReq(req, webToken)",
          "11754:  rr = executeRequest(req)",
          "11755:  checkResponseCode(t, http.StatusBadRequest, rr)",
          "11763:  req, err = http.NewRequest(http.MethodGet, webClientGetPDFPath+\"?path=test.pdf\", nil)",
          "11764:  assert.NoError(t, err)",
          "11765:  setJWTCookieForReq(req, webToken)",
          "11766:  rr = executeRequest(req)",
          "11767:  checkResponseCode(t, http.StatusBadRequest, rr)",
          "11768:  assert.Contains(t, rr.Body.String(), \"Unable to get file\")",
          "11770:  req, err = http.NewRequest(http.MethodGet, webClientGetPDFPath+\"?path=%2F\", nil)",
          "11771:  assert.NoError(t, err)",
          "11772:  setJWTCookieForReq(req, webToken)",
          "11773:  rr = executeRequest(req)",
          "11774:  checkResponseCode(t, http.StatusBadRequest, rr)",
          "11775:  assert.Contains(t, rr.Body.String(), \"Invalid file\")",
          "11777:  err = os.WriteFile(filepath.Join(user.GetHomeDir(), \"test.pdf\"), []byte(\"some text data\"), 0666)",
          "11778:  assert.NoError(t, err)",
          "11780:  req, err = http.NewRequest(http.MethodGet, webClientGetPDFPath+\"?path=%2Ftest.pdf\", nil)",
          "11781:  assert.NoError(t, err)",
          "11782:  setJWTCookieForReq(req, webToken)",
          "11783:  rr = executeRequest(req)",
          "11784:  checkResponseCode(t, http.StatusBadRequest, rr)",
          "11785:  assert.Contains(t, rr.Body.String(), \"Invalid PDF file\")",
          "11787:  err = createTestFile(filepath.Join(user.GetHomeDir(), \"test.pdf\"), 1024)",
          "11788:  assert.NoError(t, err)",
          "11790:  req, err = http.NewRequest(http.MethodGet, webClientGetPDFPath+\"?path=%2Ftest.pdf\", nil)",
          "11791:  assert.NoError(t, err)",
          "11792:  setJWTCookieForReq(req, webToken)",
          "11793:  rr = executeRequest(req)",
          "11794:  checkResponseCode(t, http.StatusBadRequest, rr)",
          "11795:  assert.Contains(t, rr.Body.String(), \"does not look like a PDF\")",
          "11797:  fakePDF := []byte(`%PDF-1.6`)",
          "11798:  for i := 0; i < 128; i++ {",
          "11799:   fakePDF = append(fakePDF, []byte(fmt.Sprintf(\"%d\", i))...)",
          "11800:  }",
          "11801:  err = os.WriteFile(filepath.Join(user.GetHomeDir(), \"test.pdf\"), fakePDF, 0666)",
          "11802:  assert.NoError(t, err)",
          "11804:  req, err = http.NewRequest(http.MethodGet, webClientGetPDFPath+\"?path=%2Ftest.pdf\", nil)",
          "11805:  assert.NoError(t, err)",
          "11806:  setJWTCookieForReq(req, webToken)",
          "11807:  rr = executeRequest(req)",
          "11808:  checkResponseCode(t, http.StatusOK, rr)",
          "11810:  user.Filters.FilePatterns = []sdk.PatternsFilter{",
          "11811:   {",
          "11812:    Path:           \"/\",",
          "11813:    DeniedPatterns: []string{\"*.pdf\"},",
          "11814:   },",
          "11815:  }",
          "11816:  _, _, err = httpdtest.UpdateUser(user, http.StatusOK, \"\")",
          "11817:  assert.NoError(t, err)",
          "11818:  req, err = http.NewRequest(http.MethodGet, webClientGetPDFPath+\"?path=%2Ftest.pdf\", nil)",
          "11819:  assert.NoError(t, err)",
          "11820:  setJWTCookieForReq(req, webToken)",
          "11821:  rr = executeRequest(req)",
          "11822:  checkResponseCode(t, http.StatusForbidden, rr)",
          "11823:  assert.Contains(t, rr.Body.String(), \"Unable to get a reader for the file\")",
          "11825:  user.Filters.FilePatterns = []sdk.PatternsFilter{",
          "11826:   {",
          "11827:    Path:           \"/\",",
          "11828:    DeniedPatterns: []string{\"*.txt\"},",
          "11829:   },",
          "11830:  }",
          "11831:  user.Filters.DeniedProtocols = []string{common.ProtocolHTTP}",
          "11832:  _, _, err = httpdtest.UpdateUser(user, http.StatusOK, \"\")",
          "11833:  assert.NoError(t, err)",
          "11834:  req, err = http.NewRequest(http.MethodGet, webClientGetPDFPath+\"?path=%2Ftest.pdf\", nil)",
          "11835:  assert.NoError(t, err)",
          "11836:  setJWTCookieForReq(req, webToken)",
          "11837:  rr = executeRequest(req)",
          "11838:  checkResponseCode(t, http.StatusForbidden, rr)",
          "11845:  req, err = http.NewRequest(http.MethodGet, webClientGetPDFPath+\"?path=%2Ftest.pdf\", nil)",
          "11846:  assert.NoError(t, err)",
          "11847:  setJWTCookieForReq(req, webToken)",
          "11848:  rr = executeRequest(req)",
          "11849:  checkResponseCode(t, http.StatusNotFound, rr)",
          "",
          "---------------"
        ],
        "httpd/internal_test.go||httpd/internal_test.go": [
          "File: httpd/internal_test.go -> httpd/internal_test.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "2154:  server.handleClientGetShares(rr, req)",
          "2155:  assert.Equal(t, http.StatusForbidden, rr.Code)",
          "2156:  assert.Contains(t, rr.Body.String(), \"Invalid token claims\")",
          "2157: }",
          "2159: func TestInvalidClaims(t *testing.T) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2158:  rr = httptest.NewRecorder()",
          "2159:  req, _ = http.NewRequest(http.MethodGet, webClientViewPDFPath, nil)",
          "2160:  req.Header.Set(\"Cookie\", fmt.Sprintf(\"jwt=%v\", token[\"access_token\"]))",
          "2161:  server.handleClientGetPDF(rr, req)",
          "2162:  assert.Equal(t, http.StatusForbidden, rr.Code)",
          "2163:  assert.Contains(t, rr.Body.String(), \"Invalid token claims\")",
          "",
          "---------------"
        ],
        "httpd/server.go||httpd/server.go": [
          "File: httpd/server.go -> httpd/server.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "1440:    router.Get(webClientLogoutPath, s.handleWebClientLogout)",
          "1441:    router.With(s.checkSecondFactorRequirement, s.refreshCookie).Get(webClientFilesPath, s.handleClientGetFiles)",
          "1442:    router.With(s.checkSecondFactorRequirement, s.refreshCookie).Get(webClientViewPDFPath, s.handleClientViewPDF)",
          "1443:    router.With(s.checkSecondFactorRequirement, s.refreshCookie, verifyCSRFHeader).Get(webClientFilePath, getUserFile)",
          "1444:    router.With(s.checkSecondFactorRequirement, s.checkHTTPUserPerm(sdk.WebClientWriteDisabled), verifyCSRFHeader).",
          "1445:     Post(webClientFilePath, uploadUserFile)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1443:    router.With(s.checkSecondFactorRequirement, s.refreshCookie).Get(webClientGetPDFPath, s.handleClientGetPDF)",
          "",
          "---------------"
        ],
        "httpd/webclient.go||httpd/webclient.go": [
          "File: httpd/webclient.go -> httpd/webclient.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "37:  \"github.com/drakkan/sftpgo/v2/common\"",
          "38:  \"github.com/drakkan/sftpgo/v2/dataprovider\"",
          "39:  \"github.com/drakkan/sftpgo/v2/mfa\"",
          "40:  \"github.com/drakkan/sftpgo/v2/smtp\"",
          "41:  \"github.com/drakkan/sftpgo/v2/util\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "39:  \"github.com/drakkan/sftpgo/v2/logger\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "757:   s.renderSharedFilesPage(w, r, share.GetRelativePath(name), \"\", share)",
          "758:   return",
          "759:  }",
          "761:  dataprovider.UpdateShareLastUse(&share, 1) //nolint:errcheck",
          "763:   dataprovider.UpdateShareLastUse(&share, -1) //nolint:errcheck",
          "764:   if status > 0 {",
          "765:    s.renderSharedFilesPage(w, r, path.Dir(share.GetRelativePath(name)), err.Error(), share)",
          "",
          "[Removed Lines]",
          "760:  inline := r.URL.Query().Get(\"inline\") != \"\"",
          "762:  if status, err := downloadFile(w, r, connection, name, info, inline, &share); err != nil {",
          "",
          "[Added Lines]",
          "762:  if status, err := downloadFile(w, r, connection, name, info, false, &share); err != nil {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "892:   s.renderFilesPage(w, r, name, \"\", user, len(s.binding.WebClientIntegrations) > 0)",
          "893:   return",
          "894:  }",
          "897:   if status > 0 {",
          "898:    if status == http.StatusRequestedRangeNotSatisfiable {",
          "899:     s.renderClientMessagePage(w, r, http.StatusText(status), \"\", status, err, \"\")",
          "",
          "[Removed Lines]",
          "895:  inline := r.URL.Query().Get(\"inline\") != \"\"",
          "896:  if status, err := downloadFile(w, r, connection, name, info, inline, nil); err != nil && status != 0 {",
          "",
          "[Added Lines]",
          "895:  if status, err := downloadFile(w, r, connection, name, info, false, nil); err != nil && status != 0 {",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1291:  name = util.CleanPath(name)",
          "1292:  data := viewPDFPage{",
          "1293:   Title:     path.Base(name),",
          "1295:   StaticURL: webStaticFilesPath,",
          "1296:   Branding:  s.binding.Branding.WebClient,",
          "1297:  }",
          "1298:  renderClientTemplate(w, templateClientViewPDF, data)",
          "1299: }",
          "",
          "[Removed Lines]",
          "1294:   URL:       fmt.Sprintf(\"%v?path=%v&inline=1\", webClientFilesPath, url.QueryEscape(name)),",
          "",
          "[Added Lines]",
          "1293:   URL:       fmt.Sprintf(\"%s?path=%s&_=%d\", webClientGetPDFPath, url.QueryEscape(name), time.Now().UTC().Unix()),",
          "1300: func (s *httpdServer) handleClientGetPDF(w http.ResponseWriter, r *http.Request) {",
          "1301:  r.Body = http.MaxBytesReader(w, r.Body, maxLoginBodySize)",
          "1302:  claims, err := getTokenClaims(r)",
          "1303:  if err != nil || claims.Username == \"\" {",
          "1304:   s.renderClientForbiddenPage(w, r, \"Invalid token claims\")",
          "1305:   return",
          "1306:  }",
          "1307:  name := r.URL.Query().Get(\"path\")",
          "1308:  if name == \"\" {",
          "1309:   s.renderClientBadRequestPage(w, r, errors.New(\"no file specified\"))",
          "1310:   return",
          "1311:  }",
          "1312:  name = util.CleanPath(name)",
          "1313:  user, err := dataprovider.GetUserWithGroupSettings(claims.Username)",
          "1314:  if err != nil {",
          "1315:   s.renderClientMessagePage(w, r, \"Unable to retrieve your user\", \"\", getRespStatus(err), nil, \"\")",
          "1316:   return",
          "1317:  }",
          "1319:  connID := xid.New().String()",
          "1320:  protocol := getProtocolFromRequest(r)",
          "1321:  connectionID := fmt.Sprintf(\"%v_%v\", protocol, connID)",
          "1322:  if err := checkHTTPClientUser(&user, r, connectionID, false); err != nil {",
          "1323:   s.renderClientForbiddenPage(w, r, err.Error())",
          "1324:   return",
          "1325:  }",
          "1326:  connection := &Connection{",
          "1327:   BaseConnection: common.NewBaseConnection(connID, protocol, util.GetHTTPLocalAddress(r),",
          "1328:    r.RemoteAddr, user),",
          "1329:   request: r,",
          "1330:  }",
          "1331:  if err = common.Connections.Add(connection); err != nil {",
          "1332:   s.renderClientMessagePage(w, r, \"Unable to add connection\", \"\", http.StatusTooManyRequests, err, \"\")",
          "1333:   return",
          "1334:  }",
          "1335:  defer common.Connections.Remove(connection.GetID())",
          "1337:  info, err := connection.Stat(name, 0)",
          "1338:  if err != nil {",
          "1339:   s.renderClientMessagePage(w, r, \"Unable to get file\", \"\", getRespStatus(err), err, \"\")",
          "1340:   return",
          "1341:  }",
          "1342:  if info.IsDir() {",
          "1343:   s.renderClientMessagePage(w, r, \"Invalid file\", fmt.Sprintf(\"%q is not a file\", name),",
          "1344:    http.StatusBadRequest, nil, \"\")",
          "1345:   return",
          "1346:  }",
          "1347:  connection.User.CheckFsRoot(connection.ID) //nolint:errcheck",
          "1348:  reader, err := connection.getFileReader(name, 0, r.Method)",
          "1349:  if err != nil {",
          "1350:   s.renderClientMessagePage(w, r, fmt.Sprintf(\"Unable to get a reader for the file %q\", name), \"\",",
          "1351:    getRespStatus(err), err, \"\")",
          "1352:   return",
          "1353:  }",
          "1354:  defer reader.Close()",
          "1356:  var b bytes.Buffer",
          "1357:  _, err = io.CopyN(&b, reader, 128)",
          "1358:  if err != nil {",
          "1359:   s.renderClientMessagePage(w, r, \"Invalid PDF file\", fmt.Sprintf(\"Unable to validate the file %q as PDF\", name),",
          "1360:    http.StatusBadRequest, nil, \"\")",
          "1361:   return",
          "1362:  }",
          "1363:  if ctype := http.DetectContentType(b.Bytes()); ctype != \"application/pdf\" {",
          "1364:   connection.Log(logger.LevelDebug, \"detected %q content type, expected PDF, file %q\", ctype, name)",
          "1365:   s.renderClientBadRequestPage(w, r, fmt.Errorf(\"the file %q does not look like a PDF\", name))",
          "1366:   return",
          "1367:  }",
          "1368:  downloadFile(w, r, connection, name, info, true, nil) //nolint:errcheck",
          "1369: }",
          "",
          "---------------"
        ],
        "templates/webclient/files.html||templates/webclient/files.html": [
          "File: templates/webclient/files.html -> templates/webclient/files.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "1039:                                     case \"bmp\":",
          "1040:                                     case \"svg\":",
          "1041:                                     case \"ico\":",
          "1043:                                         var title = escapeHTMLForceSafe(row[\"name\"])",
          "1045:                                     case \"mp4\":",
          "1046:                                     case \"mov\":",
          "1047:                                         var name = b64EncodeUnicode(row[\"name\"]);",
          "",
          "[Removed Lines]",
          "1042:                                         var view_url = row['url']+\"&inline=1\";",
          "1044:                                         return `<a href=\"${view_url}\" data-lightbox=\"image-gallery\" data-title=\"${title}\"><i class=\"fas fa-eye\"></i></a>`;",
          "",
          "[Added Lines]",
          "1043:                                         return `<a href=\"${row['url']}\" data-lightbox=\"image-gallery\" data-title=\"${title}\"><i class=\"fas fa-eye\"></i></a>`;",
          "",
          "---------------"
        ],
        "version/version.go||version/version.go": [
          "File: version/version.go -> version/version.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "18: import \"strings\"",
          "22: var (",
          "23:  commit = \"\"",
          "",
          "[Removed Lines]",
          "20: const version = \"2.3.5\"",
          "",
          "[Added Lines]",
          "20: const version = \"2.3.5-dev\"",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "f1832d4478b67e1a91c9479f0e88ca5aac240947",
      "candidate_info": {
        "commit_hash": "f1832d4478b67e1a91c9479f0e88ca5aac240947",
        "repo": "drakkan/sftpgo",
        "commit_url": "https://github.com/drakkan/sftpgo/commit/f1832d4478b67e1a91c9479f0e88ca5aac240947",
        "files": [
          "go.mod",
          "go.sum",
          "httpd/api_shares.go",
          "httpd/httpd_test.go",
          "httpd/server.go",
          "httpd/webclient.go",
          "templates/webclient/shares.html",
          "templates/webclient/shareupload.html"
        ],
        "message": "shares: add an upload form for shares with write scope\n\nSigned-off-by: Nicola Murino <nicola.murino@gmail.com>",
        "before_after_code_files": [
          "go.mod||go.mod",
          "go.sum||go.sum",
          "httpd/api_shares.go||httpd/api_shares.go",
          "httpd/httpd_test.go||httpd/httpd_test.go",
          "httpd/server.go||httpd/server.go",
          "httpd/webclient.go||httpd/webclient.go",
          "templates/webclient/shares.html||templates/webclient/shares.html",
          "templates/webclient/shareupload.html||templates/webclient/shareupload.html"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "templates/webclient/shareupload.html||templates/webclient/shareupload.html"
          ],
          "candidate": [
            "templates/webclient/shareupload.html||templates/webclient/shareupload.html"
          ]
        }
      },
      "candidate_diff": {
        "go.mod||go.mod": [
          "File: go.mod -> go.mod",
          "--- Hunk 1 ---",
          "[Context before]",
          "7:  github.com/Azure/azure-storage-blob-go v0.14.0",
          "8:  github.com/GehirnInc/crypt v0.0.0-20200316065508-bb7000b8a962",
          "9:  github.com/alexedwards/argon2id v0.0.0-20211130144151-3585854a6387",
          "11:  github.com/cockroachdb/cockroach-go/v2 v2.2.8",
          "12:  github.com/coreos/go-oidc/v3 v3.1.0",
          "13:  github.com/eikenb/pipeat v0.0.0-20210603033007-44fc3ffce52b",
          "",
          "[Removed Lines]",
          "10:  github.com/aws/aws-sdk-go v1.42.52",
          "",
          "[Added Lines]",
          "10:  github.com/aws/aws-sdk-go v1.42.53",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "53:  go.etcd.io/bbolt v1.3.6",
          "54:  go.uber.org/automaxprocs v1.4.0",
          "55:  gocloud.dev v0.24.0",
          "57:  golang.org/x/net v0.0.0-20220127200216-cd36cc0744dd",
          "58:  golang.org/x/oauth2 v0.0.0-20211104180415-d3ed0bb246c8",
          "59:  golang.org/x/sys v0.0.0-20220209214540-3681064d5158",
          "",
          "[Removed Lines]",
          "56:  golang.org/x/crypto v0.0.0-20220128200615-198e4374d7ed",
          "",
          "[Added Lines]",
          "56:  golang.org/x/crypto v0.0.0-20220214200702-86341886e292",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "65: require (",
          "66:  cloud.google.com/go v0.100.2 // indirect",
          "69:  github.com/Azure/azure-pipeline-go v0.2.3 // indirect",
          "70:  github.com/beorn7/perks v1.0.1 // indirect",
          "71:  github.com/boombuler/barcode v1.0.1 // indirect",
          "",
          "[Removed Lines]",
          "67:  cloud.google.com/go/compute v1.2.0 // indirect",
          "68:  cloud.google.com/go/iam v0.1.1 // indirect",
          "",
          "[Added Lines]",
          "67:  cloud.google.com/go/compute v1.3.0 // indirect",
          "68:  cloud.google.com/go/iam v0.2.0 // indirect",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "139: replace (",
          "140:  github.com/eikenb/pipeat => github.com/drakkan/pipeat v0.0.0-20210805162858-70e57fa8a639",
          "141:  github.com/jlaffaye/ftp => github.com/drakkan/ftp v0.0.0-20201114075148-9b9adce499a9",
          "143:  golang.org/x/net => github.com/drakkan/net v0.0.0-20220130095023-bd85f1236c34",
          "144: )",
          "",
          "[Removed Lines]",
          "142:  golang.org/x/crypto => github.com/drakkan/crypto v0.0.0-20220130095207-a206cf284b7c",
          "",
          "[Added Lines]",
          "142:  golang.org/x/crypto => github.com/drakkan/crypto v0.0.0-20220215181150-74469fa99b22",
          "",
          "---------------"
        ],
        "go.sum||go.sum": [
          "File: go.sum -> go.sum",
          "--- Hunk 1 ---",
          "[Context before]",
          "46: cloud.google.com/go/bigquery v1.7.0/go.mod h1://okPTzCYNXSlb24MZs83e2Do+h+VXtc4gLoIoXIAPc=",
          "47: cloud.google.com/go/bigquery v1.8.0/go.mod h1:J5hqkt3O0uAFnINi6JXValWIb1v0goeZM77hZzJN/fQ=",
          "48: cloud.google.com/go/compute v0.1.0/go.mod h1:GAesmwr110a34z04OlxYkATPBEfVhkymfTBXtfbBFow=",
          "50: cloud.google.com/go/compute v1.2.0/go.mod h1:xlogom/6gr8RJGBe7nT2eGsQYAFUbbv8dbC29qE3Xmw=",
          "51: cloud.google.com/go/datastore v1.0.0/go.mod h1:LXYbyblFSglQ5pkeyhO+Qmw7ukd3C+pD7TKLgZqpHYE=",
          "52: cloud.google.com/go/datastore v1.1.0/go.mod h1:umbIZjpQpHh4hmRpGhH4tLFup+FVzqBi1b3c64qFpCk=",
          "53: cloud.google.com/go/firestore v1.5.0/go.mod h1:c4nNYR1qdq7eaZ+jSc5fonrQN2k3M7sWATcYTiakjEo=",
          "54: cloud.google.com/go/firestore v1.6.1/go.mod h1:asNXNOzBdyVQmEU+ggO8UPodTkEVFW5Qx+rwHnAz+EY=",
          "56: cloud.google.com/go/iam v0.1.1/go.mod h1:CKqrcnI/suGpybEHxZ7BMehL0oA4LpdyJdUlTl9jVMw=",
          "57: cloud.google.com/go/kms v0.1.0 h1:VXAb5OzejDcyhFzIDeZ5n5AUdlsFnCyexuascIwWMj0=",
          "58: cloud.google.com/go/kms v0.1.0/go.mod h1:8Qp8PCAypHg4FdmlyW1QRAv09BGQ9Uzh7JnmIZxPk+c=",
          "59: cloud.google.com/go/monitoring v0.1.0/go.mod h1:Hpm3XfzJv+UTiXzCG5Ffp0wijzHTC7Cv4eR7o3x/fEE=",
          "",
          "[Removed Lines]",
          "49: cloud.google.com/go/compute v1.2.0 h1:EKki8sSdvDU0OO9mAXGwPXOTOgPz2l08R0/IutDH11I=",
          "55: cloud.google.com/go/iam v0.1.1 h1:4CapQyNFjiksks1/x7jsvsygFPhihslYk5GptIrlX68=",
          "",
          "[Added Lines]",
          "50: cloud.google.com/go/compute v1.3.0 h1:mPL/MzDDYHsh5tHRS9mhmhWlcgClCrCa6ApQCU6wnHI=",
          "51: cloud.google.com/go/compute v1.3.0/go.mod h1:cCZiE1NHEtai4wiufUhW8I8S1JKkAnhnQJWM7YD99wM=",
          "57: cloud.google.com/go/iam v0.2.0 h1:Ouq6qif4mZdXkb3SiFMpxvu0JQJB1Yid9TsZ23N6hg8=",
          "58: cloud.google.com/go/iam v0.2.0/go.mod h1:BCK88+tmjAwnZYfOSizmKCTSFjJHCa18t3DpdGEY13Y=",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "141: github.com/aws/aws-sdk-go v1.15.27/go.mod h1:mFuSZ37Z9YOHbQEwBWztmVzqXrEkub65tZoCYDt7FT0=",
          "142: github.com/aws/aws-sdk-go v1.37.0/go.mod h1:hcU610XS61/+aQV88ixoOzUoG7v3b31pl2zKMmprdro=",
          "143: github.com/aws/aws-sdk-go v1.40.34/go.mod h1:585smgzpB/KqRA+K3y/NL/oYRqQvpNJYvLm+LY1U59Q=",
          "146: github.com/aws/aws-sdk-go-v2 v1.9.0/go.mod h1:cK/D0BBs0b/oWPIcX/Z/obahJK1TT7IPVjy53i/mX/4=",
          "147: github.com/aws/aws-sdk-go-v2/config v1.7.0/go.mod h1:w9+nMZ7soXCe5nT46Ri354SNhXDQ6v+V5wqDjnZE+GY=",
          "148: github.com/aws/aws-sdk-go-v2/credentials v1.4.0/go.mod h1:dgGR+Qq7Wjcd4AOAW5Rf5Tnv3+x7ed6kETXyS9WCuAY=",
          "",
          "[Removed Lines]",
          "144: github.com/aws/aws-sdk-go v1.42.52 h1:/+TZ46+0qu9Ph/UwjVrU3SG8OBi87uJLrLiYRNZKbHQ=",
          "145: github.com/aws/aws-sdk-go v1.42.52/go.mod h1:OGr6lGMAKGlG9CVrYnWYDKIyb829c6EVBRjxqjmPepc=",
          "",
          "[Added Lines]",
          "146: github.com/aws/aws-sdk-go v1.42.53 h1:56T04NWcmc0ZVYFbUc6HdewDQ9iHQFlmS6hj96dRjJs=",
          "147: github.com/aws/aws-sdk-go v1.42.53/go.mod h1:OGr6lGMAKGlG9CVrYnWYDKIyb829c6EVBRjxqjmPepc=",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "216: github.com/dgrijalva/jwt-go v3.2.0+incompatible/go.mod h1:E3ru+11k8xSBh+hMPgOLZmtrrCbhqsmaPHjLKYnJCaQ=",
          "217: github.com/dimchansky/utfbom v1.1.0/go.mod h1:rO41eb7gLfo8SF1jd9F8HplJm1Fewwi4mQvIirEdv+8=",
          "218: github.com/dimchansky/utfbom v1.1.1/go.mod h1:SxdoEBH5qIqFocHMyGOXVAybYJdr71b1Q/j0mACtrfE=",
          "221: github.com/drakkan/ftp v0.0.0-20201114075148-9b9adce499a9 h1:LPH1dEblAOO/LoG7yHPMtBLXhQmjaga91/DDjWk9jWA=",
          "222: github.com/drakkan/ftp v0.0.0-20201114075148-9b9adce499a9/go.mod h1:2lmrmq866uF2tnje75wQHzmPXhmSWUt7Gyx2vgK1RCU=",
          "223: github.com/drakkan/net v0.0.0-20220130095023-bd85f1236c34 h1:DRayAKtBRaVU3jg58b/HCbkRleByBD5q6NkN1wcJ2RU=",
          "",
          "[Removed Lines]",
          "219: github.com/drakkan/crypto v0.0.0-20220130095207-a206cf284b7c h1:IqTZK/MGRdMPRyyJQSxDtrEokSJDJl+nreM2/CFYTsg=",
          "220: github.com/drakkan/crypto v0.0.0-20220130095207-a206cf284b7c/go.mod h1:SiM6ypd8Xu1xldObYtbDztuUU7xUzMnUULfphXFZmro=",
          "",
          "[Added Lines]",
          "221: github.com/drakkan/crypto v0.0.0-20220215181150-74469fa99b22 h1:yHFyJbCfvTY65bTyPOMRGqplA5GNfdZhBVOiYGNeCtY=",
          "222: github.com/drakkan/crypto v0.0.0-20220215181150-74469fa99b22/go.mod h1:SiM6ypd8Xu1xldObYtbDztuUU7xUzMnUULfphXFZmro=",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1082: google.golang.org/api v0.63.0/go.mod h1:gs4ij2ffTRXwuzzgJl/56BdwJaA194ijkfn++9tDuPo=",
          "1083: google.golang.org/api v0.64.0/go.mod h1:931CdxA8Rm4t6zqTFGSsgwbAEZ2+GMYurbndwSimebM=",
          "1084: google.golang.org/api v0.66.0/go.mod h1:I1dmXYpX7HGwz/ejRxwQp2qj5bFAz93HiCU1C1oYd9M=",
          "1085: google.golang.org/api v0.68.0 h1:9eJiHhwJKIYX6sX2fUZxQLi7pDRA/MYu8c12q6WbJik=",
          "1086: google.golang.org/api v0.68.0/go.mod h1:sOM8pTpwgflXRhz+oC8H2Dr+UcbMqkPPWNJo88Q7TH8=",
          "1087: google.golang.org/appengine v1.1.0/go.mod h1:EbEs0AVv82hx2wNQdGPgUI5lhzA/G0D9YwlJXL52JkM=",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1087: google.golang.org/api v0.67.0/go.mod h1:ShHKP8E60yPsKNw/w8w+VYaj9H6buA5UqDp8dhbQZ6g=",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1171: google.golang.org/genproto v0.0.0-20220126215142-9970aeb2e350/go.mod h1:5CzLGKJ67TSI2B9POpiiyGha0AjJvZIUgRMt1dSmuhc=",
          "1172: google.golang.org/genproto v0.0.0-20220201184016-50beb8ab5c44/go.mod h1:5CzLGKJ67TSI2B9POpiiyGha0AjJvZIUgRMt1dSmuhc=",
          "1173: google.golang.org/genproto v0.0.0-20220204002441-d6cc3cc0770e/go.mod h1:5CzLGKJ67TSI2B9POpiiyGha0AjJvZIUgRMt1dSmuhc=",
          "1174: google.golang.org/genproto v0.0.0-20220211171837-173942840c17 h1:2X+CNIheCutWRyKRte8szGxrE5ggtV4U+NKAbh/oLhg=",
          "1175: google.golang.org/genproto v0.0.0-20220211171837-173942840c17/go.mod h1:kGP+zUP2Ddo0ayMi4YuN7C3WZyJvGLZRh8Z5wnAqvEI=",
          "1176: google.golang.org/grpc v1.8.0/go.mod h1:yo6s7OP7yaDglbqo1J04qKzAhqBH6lvTonzMVmEdcZw=",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1177: google.golang.org/genproto v0.0.0-20220207164111-0872dc986b00/go.mod h1:5CzLGKJ67TSI2B9POpiiyGha0AjJvZIUgRMt1dSmuhc=",
          "",
          "---------------"
        ],
        "httpd/api_shares.go||httpd/api_shares.go": [
          "File: httpd/api_shares.go -> httpd/api_shares.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "139: func readBrowsableShareContents(w http.ResponseWriter, r *http.Request) {",
          "140:  r.Body = http.MaxBytesReader(w, r.Body, maxRequestSize)",
          "142:  if err != nil {",
          "143:   return",
          "144:  }",
          "",
          "[Removed Lines]",
          "141:  share, connection, err := checkPublicShare(w, r, dataprovider.ShareScopeRead)",
          "",
          "[Added Lines]",
          "141:  share, connection, err := checkPublicShare(w, r, dataprovider.ShareScopeRead, false)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "166: func downloadBrowsableSharedFile(w http.ResponseWriter, r *http.Request) {",
          "167:  r.Body = http.MaxBytesReader(w, r.Body, maxRequestSize)",
          "169:  if err != nil {",
          "170:   return",
          "171:  }",
          "",
          "[Removed Lines]",
          "168:  share, connection, err := checkPublicShare(w, r, dataprovider.ShareScopeRead)",
          "",
          "[Added Lines]",
          "168:  share, connection, err := checkPublicShare(w, r, dataprovider.ShareScopeRead, false)",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "212: func downloadFromShare(w http.ResponseWriter, r *http.Request) {",
          "213:  r.Body = http.MaxBytesReader(w, r.Body, maxRequestSize)",
          "215:  if err != nil {",
          "216:   return",
          "217:  }",
          "",
          "[Removed Lines]",
          "214:  share, connection, err := checkPublicShare(w, r, dataprovider.ShareScopeRead)",
          "",
          "[Added Lines]",
          "214:  share, connection, err := checkPublicShare(w, r, dataprovider.ShareScopeRead, false)",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "263:   r.Body = http.MaxBytesReader(w, r.Body, maxUploadFileSize)",
          "264:  }",
          "265:  name := getURLParam(r, \"name\")",
          "267:  if err != nil {",
          "268:   return",
          "269:  }",
          "",
          "[Removed Lines]",
          "266:  share, connection, err := checkPublicShare(w, r, dataprovider.ShareScopeWrite)",
          "",
          "[Added Lines]",
          "266:  share, connection, err := checkPublicShare(w, r, dataprovider.ShareScopeWrite, false)",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "285:  if maxUploadFileSize > 0 {",
          "286:   r.Body = http.MaxBytesReader(w, r.Body, maxUploadFileSize)",
          "287:  }",
          "289:  if err != nil {",
          "290:   return",
          "291:  }",
          "",
          "[Removed Lines]",
          "288:  share, connection, err := checkPublicShare(w, r, dataprovider.ShareScopeWrite)",
          "",
          "[Added Lines]",
          "288:  share, connection, err := checkPublicShare(w, r, dataprovider.ShareScopeWrite, false)",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "332: }",
          "334: func checkPublicShare(w http.ResponseWriter, r *http.Request, shareShope dataprovider.ShareScope,",
          "335: ) (dataprovider.Share, *Connection, error) {",
          "336:  shareID := getURLParam(r, \"id\")",
          "337:  share, err := dataprovider.ShareExists(shareID, \"\")",
          "338:  if err != nil {",
          "340:   return share, nil, err",
          "341:  }",
          "342:  if share.Scope != shareShope {",
          "344:   return share, nil, errors.New(\"invalid share scope\")",
          "345:  }",
          "346:  ipAddr := util.GetIPFromRemoteAddress(r.RemoteAddr)",
          "347:  ok, err := share.IsUsable(ipAddr)",
          "348:  if !ok || err != nil {",
          "351:  }",
          "352:  if share.Password != \"\" {",
          "353:   _, password, ok := r.BasicAuth()",
          "354:   if !ok {",
          "355:    w.Header().Set(common.HTTPAuthenticationHeader, basicRealm)",
          "357:    return share, nil, dataprovider.ErrInvalidCredentials",
          "358:   }",
          "359:   match, err := share.CheckPassword(password)",
          "360:   if !match || err != nil {",
          "361:    w.Header().Set(common.HTTPAuthenticationHeader, basicRealm)",
          "363:    return share, nil, dataprovider.ErrInvalidCredentials",
          "364:   }",
          "365:  }",
          "366:  user, err := dataprovider.UserExists(share.Username)",
          "367:  if err != nil {",
          "369:   return share, nil, err",
          "370:  }",
          "371:  connID := xid.New().String()",
          "",
          "[Removed Lines]",
          "339:   sendAPIResponse(w, r, err, \"\", getRespStatus(err))",
          "343:   sendAPIResponse(w, r, nil, \"Invalid share scope\", http.StatusForbidden)",
          "349:   sendAPIResponse(w, r, err, \"\", getRespStatus(err))",
          "350:   return share, nil, errors.New(\"login not allowed\")",
          "356:    sendAPIResponse(w, r, nil, http.StatusText(http.StatusUnauthorized), http.StatusUnauthorized)",
          "362:    sendAPIResponse(w, r, nil, http.StatusText(http.StatusUnauthorized), http.StatusUnauthorized)",
          "368:   sendAPIResponse(w, r, err, \"\", getRespStatus(err))",
          "",
          "[Added Lines]",
          "335:  isWebClient bool,",
          "337:  renderError := func(err error, message string, statusCode int) {",
          "338:   if isWebClient {",
          "339:    renderClientMessagePage(w, r, \"Unable to access the share\", message, statusCode, err, \"\")",
          "340:   } else {",
          "341:    sendAPIResponse(w, r, err, message, statusCode)",
          "342:   }",
          "343:  }",
          "348:   statusCode := getRespStatus(err)",
          "349:   if statusCode == http.StatusNotFound {",
          "350:    err = errors.New(\"share does not exist\")",
          "351:   }",
          "352:   renderError(err, \"\", statusCode)",
          "356:   renderError(nil, \"Invalid share scope\", http.StatusForbidden)",
          "362:   renderError(err, \"\", getRespStatus(err))",
          "363:   return share, nil, err",
          "369:    renderError(dataprovider.ErrInvalidCredentials, http.StatusText(http.StatusUnauthorized), http.StatusUnauthorized)",
          "375:    renderError(dataprovider.ErrInvalidCredentials, http.StatusText(http.StatusUnauthorized), http.StatusUnauthorized)",
          "381:   renderError(err, \"\", getRespStatus(err))",
          "",
          "---------------"
        ],
        "httpd/httpd_test.go||httpd/httpd_test.go": [
          "File: httpd/httpd_test.go -> httpd/httpd_test.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "9412:  if assert.NoError(t, err) {",
          "9413:   assert.InDelta(t, util.GetTimeAsMsSinceEpoch(modTime), util.GetTimeAsMsSinceEpoch(info.ModTime()), float64(1000))",
          "9414:  }",
          "9415:  req, err = http.NewRequest(http.MethodPost, path.Join(webClientPubSharesPath, objectID, \"file.txt\"), bytes.NewBuffer(content))",
          "9416:  assert.NoError(t, err)",
          "9417:  req.SetBasicAuth(defaultUsername, defaultPassword)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "9415:  req, err = http.NewRequest(http.MethodGet, path.Join(webClientPubSharesPath, objectID, \"upload\"), nil)",
          "9416:  assert.NoError(t, err)",
          "9417:  req.SetBasicAuth(defaultUsername, defaultPassword)",
          "9418:  rr = executeRequest(req)",
          "9419:  checkResponseCode(t, http.StatusOK, rr)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "9668:  objectID := rr.Header().Get(\"X-Object-ID\")",
          "9669:  assert.NotEmpty(t, objectID)",
          "9671:  req, err = http.NewRequest(http.MethodGet, path.Join(webClientPubSharesPath, objectID, \"browse?path=%2F\"), nil)",
          "9672:  assert.NoError(t, err)",
          "9673:  rr = executeRequest(req)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "9677:  req, err = http.NewRequest(http.MethodGet, path.Join(webClientPubSharesPath, objectID, \"upload\"), nil)",
          "9678:  assert.NoError(t, err)",
          "9679:  rr = executeRequest(req)",
          "9680:  checkResponseCode(t, http.StatusForbidden, rr)",
          "9681:  assert.Contains(t, rr.Body.String(), \"Invalid share scope\")",
          "",
          "---------------"
        ],
        "httpd/server.go||httpd/server.go": [
          "File: httpd/server.go -> httpd/server.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "1306:    Post(webClientTwoFactorRecoveryPath, s.handleWebClientTwoFactorRecoveryPost)",
          "1308:   s.router.Get(webClientPubSharesPath+\"/{id}\", downloadFromShare)",
          "1311:   s.router.Post(webClientPubSharesPath+\"/{id}\", uploadFilesToShare)",
          "1312:   s.router.Post(webClientPubSharesPath+\"/{id}/{name}\", uploadFileToShare)",
          "",
          "[Removed Lines]",
          "1309:   s.router.Get(webClientPubSharesPath+\"/{id}/browse\", s.handleShareGetFiles)",
          "1310:   s.router.With(compressor.Handler).Get(webClientPubSharesPath+\"/{id}/dirs\", s.handleShareGetDirContents)",
          "",
          "[Added Lines]",
          "1309:   s.router.Get(webClientPubSharesPath+\"/{id}/browse\", handleShareGetFiles)",
          "1310:   s.router.Get(webClientPubSharesPath+\"/{id}/upload\", handleClientUploadToShare)",
          "1311:   s.router.With(compressor.Handler).Get(webClientPubSharesPath+\"/{id}/dirs\", handleShareGetDirContents)",
          "",
          "---------------"
        ],
        "httpd/webclient.go||httpd/webclient.go": [
          "File: httpd/webclient.go -> httpd/webclient.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "46:  templateClientShares            = \"shares.html\"",
          "47:  templateClientViewPDF           = \"viewpdf.html\"",
          "48:  templateShareFiles              = \"sharefiles.html\"",
          "49:  pageClientFilesTitle            = \"My Files\"",
          "50:  pageClientSharesTitle           = \"Shares\"",
          "51:  pageClientProfileTitle          = \"My Profile\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "49:  templateUploadToShare           = \"shareupload.html\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "55:  pageClientForgotPwdTitle        = \"SFTPGo WebClient - Forgot password\"",
          "56:  pageClientResetPwdTitle         = \"SFTPGo WebClient - Reset password\"",
          "57:  pageExtShareTitle               = \"Shared files\"",
          "58: )",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "59:  pageUploadToShareTitle          = \"Upload to share\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "147:  Paths       []dirMapping",
          "148: }",
          "150: type clientMessagePage struct {",
          "151:  baseClientPage",
          "152:  Error   string",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "152: type shareUploadPage struct {",
          "153:  baseClientPage",
          "154:  Share          *dataprovider.Share",
          "155:  UploadBasePath string",
          "156: }",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "261:   filepath.Join(templatesPath, templateClientDir, templateClientBase),",
          "262:   filepath.Join(templatesPath, templateClientDir, templateShareFiles),",
          "263:  }",
          "265:  filesTmpl := util.LoadTemplate(nil, filesPaths...)",
          "266:  profileTmpl := util.LoadTemplate(nil, profilePaths...)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "272:  shareUploadPath := []string{",
          "273:   filepath.Join(templatesPath, templateClientDir, templateClientBase),",
          "274:   filepath.Join(templatesPath, templateClientDir, templateUploadToShare),",
          "275:  }",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "277:  resetPwdTmpl := util.LoadTemplate(nil, resetPwdPaths...)",
          "278:  viewPDFTmpl := util.LoadTemplate(nil, viewPDFPaths...)",
          "279:  shareFilesTmpl := util.LoadTemplate(nil, shareFilesPath...)",
          "281:  clientTemplates[templateClientFiles] = filesTmpl",
          "282:  clientTemplates[templateClientProfile] = profileTmpl",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "292:  shareUploadTmpl := util.LoadTemplate(nil, shareUploadPath...)",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "293:  clientTemplates[templateResetPassword] = resetPwdTmpl",
          "294:  clientTemplates[templateClientViewPDF] = viewPDFTmpl",
          "295:  clientTemplates[templateShareFiles] = shareFilesTmpl",
          "296: }",
          "298: func getBaseClientPageData(title, currentURL string, r *http.Request) baseClientPage {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "309:  clientTemplates[templateUploadToShare] = shareUploadTmpl",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "495:  renderClientTemplate(w, templateShareFiles, data)",
          "496: }",
          "498: func renderFilesPage(w http.ResponseWriter, r *http.Request, dirName, error string, user dataprovider.User,",
          "499:  hasIntegrations bool,",
          "500: ) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "512: func renderUploadToSharePage(w http.ResponseWriter, r *http.Request, share dataprovider.Share) {",
          "513:  currentURL := path.Join(webClientPubSharesPath, share.ShareID, \"upload\")",
          "514:  data := shareUploadPage{",
          "515:   baseClientPage: getBaseClientPageData(pageUploadToShareTitle, currentURL, r),",
          "516:   Share:          &share,",
          "517:   UploadBasePath: path.Join(webClientPubSharesPath, share.ShareID),",
          "518:  }",
          "519:  renderClientTemplate(w, templateUploadToShare, data)",
          "520: }",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "590:  renderCompressedFiles(w, connection, name, filesList, nil)",
          "591: }",
          "594:  r.Body = http.MaxBytesReader(w, r.Body, maxRequestSize)",
          "596:  if err != nil {",
          "597:   return",
          "598:  }",
          "",
          "[Removed Lines]",
          "593: func (s *httpdServer) handleShareGetDirContents(w http.ResponseWriter, r *http.Request) {",
          "595:  share, connection, err := checkPublicShare(w, r, dataprovider.ShareScopeRead)",
          "",
          "[Added Lines]",
          "617: func handleShareGetDirContents(w http.ResponseWriter, r *http.Request) {",
          "619:  share, connection, err := checkPublicShare(w, r, dataprovider.ShareScopeRead, true)",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "636:  render.JSON(w, r, results)",
          "637: }",
          "640:  r.Body = http.MaxBytesReader(w, r.Body, maxRequestSize)",
          "642:  if err != nil {",
          "643:   return",
          "644:  }",
          "",
          "[Removed Lines]",
          "639: func (s *httpdServer) handleShareGetFiles(w http.ResponseWriter, r *http.Request) {",
          "641:  share, connection, err := checkPublicShare(w, r, dataprovider.ShareScopeRead)",
          "",
          "[Added Lines]",
          "663: func handleClientUploadToShare(w http.ResponseWriter, r *http.Request) {",
          "664:  r.Body = http.MaxBytesReader(w, r.Body, maxRequestSize)",
          "665:  share, _, err := checkPublicShare(w, r, dataprovider.ShareScopeWrite, true)",
          "666:  if err != nil {",
          "667:   return",
          "668:  }",
          "669:  renderUploadToSharePage(w, r, share)",
          "670: }",
          "672: func handleShareGetFiles(w http.ResponseWriter, r *http.Request) {",
          "674:  share, connection, err := checkPublicShare(w, r, dataprovider.ShareScopeRead, true)",
          "",
          "---------------"
        ],
        "templates/webclient/shares.html||templates/webclient/shares.html": [
          "File: templates/webclient/shares.html -> templates/webclient/shares.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "93:             <div class=\"modal-body\">",
          "94:                 <div id=\"readShare\">",
          "95:                     <p>You can download the shared contents, as single zip file, using this <a id=\"readLink\" href=\"#\" target=\"_blank\">link</a>.</p>",
          "97:                     <p>If the share consists of a single file you can download it uncompressed using this <a id=\"readUncompressedLink\" href=\"#\" target=\"_blank\">link</a>.</p>",
          "98:                 </div>",
          "99:                 <div id=\"writeShare\">",
          "106:                 </div>",
          "107:                 <div id=\"expiredShare\">",
          "108:                     This share is no longer accessible because it has expired",
          "",
          "[Removed Lines]",
          "96:                     <p>If the share consists of a single folder you can browse and download single files using this <a id=\"readBrowseLink\" href=\"#\" target=\"_blank\">link</a>.</p>",
          "100:                     <p>You can upload one or more files to the shared directory by sending a multipart/form-data request to this <a id=\"writeLink\" href=\"#\" target=\"_blank\">link</a>. The form field name for the file(s) is <b><code>filenames</code></b>.</p>",
          "101:                     <p>For example:</p>",
          "102:                     <p><code>curl -F filenames=@file1.txt -F filenames=@file2.txt \"share link\"</code></p>",
          "103:                     <p>You can upload files one by one by adding the path encoded file name to the share <a id=\"writeLinkSingle\" href=\"#\" target=\"_blank\">link</a> and sending the file as POST body. The optional <b><code>X-SFTPGO-MTIME</code></b> header allows to set the file modification time as milliseconds since epoch.</p>",
          "104:                     <p>For example:</p>",
          "105:                     <p><code>curl --data-binary @file.txt -H \"Content-Type: application/octet-stream\" -H \"X-SFTPGO-MTIME: 1638882991234\" \"share link/file.txt\"</code></p>",
          "",
          "[Added Lines]",
          "96:                     <p>If the share consists of a single directory you can browse and download files using this <a id=\"readBrowseLink\" href=\"#\" target=\"_blank\">page</a>.</p>",
          "100:                     <p>You can upload one or more files to the shared directory using this <a id=\"writePageLink\" href=\"#\" target=\"_blank\">page</a></p>",
          "101:                     <p>",
          "102:                         <a data-toggle=\"collapse\" href=\"#collapseWriteShareAdvanced\" aria-expanded=\"false\" aria-controls=\"collapseWriteShareAdvanced\">",
          "103:                             Advanced options",
          "104:                         </a>",
          "105:                     </p>",
          "106:                     <div class=\"collapse\" id=\"collapseWriteShareAdvanced\">",
          "107:                         <div class=\"card card-body\">",
          "108:                             <p>You can upload one or more files to the shared directory by sending a multipart/form-data request to this <a id=\"writeLink\" href=\"#\" target=\"_blank\">link</a>. The form field name for the file(s) is <b><code>filenames</code></b>.</p>",
          "109:                             <p>Example: <code>curl -F filenames=@file1.txt -F filenames=@file2.txt \"share link\"</code></p>",
          "110:                             <p>Or you can upload files one by one by adding the path encoded file name to the share <a id=\"writeLinkSingle\" href=\"#\" target=\"_blank\">link</a> and sending the file as POST body. The optional <b><code>X-SFTPGO-MTIME</code></b> header allows to set the file modification time as milliseconds since epoch.</p>",
          "111:                             <p>Example: <code>curl --data-binary @file.txt -H \"Content-Type: application/octet-stream\" -H \"X-SFTPGO-MTIME: 1638882991234\" \"share link/file.txt\"</code></p>",
          "112:                         </div>",
          "113:                     </div>",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "226:                         $('#expiredShare').hide();",
          "227:                         $('#writeShare').show();",
          "228:                         $('#readShare').hide();",
          "229:                         $('#writeLink').attr(\"href\", shareURL);",
          "230:                         $('#writeLink').attr(\"title\", shareURL);",
          "231:                         $('#writeLinkSingle').attr(\"href\", shareURL);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "237:                         $('#writePageLink').attr(\"href\", shareURL+\"/upload\");",
          "238:                         $('#writePageLink').attr(\"title\", shareURL+\"/upload\");",
          "",
          "---------------"
        ],
        "templates/webclient/shareupload.html||templates/webclient/shareupload.html": [
          "File: templates/webclient/shareupload.html -> templates/webclient/shareupload.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: {{template \"base\" .}}",
          "3: {{define \"title\"}}{{.Title}}{{end}}",
          "5: {{define \"page_body\"}}",
          "6: <div class=\"row justify-content-center\">",
          "7:     <div class=\"col-xl-5 col-lg-6 col-md-8\">",
          "8:         <div class=\"card shadow-lg my-5\">",
          "9:             <div class=\"card-header py-3\">",
          "10:                 <h6 id=\"default_title\" class=\"m-0 font-weight-bold text-primary\">Upload one or more files to share \"{{.Share.Name}}\", user \"{{.Share.Username}}\"</h6>",
          "11:                 <h6 id=\"success_title\" class=\"m-0 font-weight-bold text-primary\" style=\"display: none;\">Upload completed to share \"{{.Share.Name}}\", user \"{{.Share.Username}}\"</h6>",
          "12:             </div>",
          "13:             <div class=\"card-body\">",
          "14:                 <div id=\"errorMsg\" class=\"card mb-4 border-left-warning\" style=\"display: none;\">",
          "15:                     <div id=\"errorTxt\" class=\"card-body text-form-error\"></div>",
          "16:                 </div>",
          "17:                 <div id=\"successMsg\" class=\"card mb-4 border-left-success\" style=\"display: none;\">",
          "18:                     <div id=\"successTxt\" class=\"card-body\">",
          "19:                         <p>File/s uploaded successfully</p>",
          "20:                         <p>If you want to upload other files click <a href=\"javascript:refreshPage();\">here</a></p>",
          "21:                     </div>",
          "22:                 </div>",
          "23:                 <form id=\"upload_files_form\" action=\"#\" method=\"POST\" enctype=\"multipart/form-data\">",
          "24:                     <div class=\"modal-body\">",
          "25:                         <input type=\"file\" class=\"form-control-file\" id=\"files_name\" name=\"filenames\" required multiple>",
          "26:                     </div>",
          "27:                     <button type=\"submit\" class=\"btn btn-primary float-right mt-3 px-5\">Submit</button>",
          "28:                 </form>",
          "29:             </div>",
          "30:         </div>",
          "31:     </div>",
          "32: </div>",
          "33: {{end}}",
          "35: {{define \"dialog\"}}",
          "36: <div class=\"modal fade\" id=\"spinnerModal\" tabindex=\"-1\" role=\"dialog\" data-keyboard=\"false\" data-backdrop=\"static\">",
          "37:     <div class=\"modal-dialog modal-dialog-centered justify-content-center\" role=\"document\">",
          "38:         <span style=\"color: #333333;\" class=\"fa fa-spinner fa-spin fa-3x\"></span>",
          "39:     </div>",
          "40: </div>",
          "41: {{end}}",
          "43: {{define \"extra_js\"}}",
          "44: <script type=\"text/javascript\">",
          "45:     var spinnerDone = false;",
          "47:     function refreshPage() {",
          "48:         location.reload();",
          "49:     }",
          "51:     $(document).ready(function () {",
          "52:         $('#spinnerModal').on('shown.bs.modal', function () {",
          "53:             if (spinnerDone){",
          "54:                 $('#spinnerModal').modal('hide');",
          "55:             }",
          "56:         });",
          "58:         $(\"#upload_files_form\").submit(function (event){",
          "59:             event.preventDefault();",
          "60:             var files = $(\"#files_name\")[0].files;",
          "61:             var has_errors = false;",
          "62:             var index = 0;",
          "63:             var success = 0;",
          "64:             spinnerDone = false;",
          "66:             $('#spinnerModal').modal('show');",
          "68:             function uploadFile() {",
          "69:                 if (index >= files.length || has_errors){",
          "70:                     $('#spinnerModal').modal('hide');",
          "71:                     spinnerDone = true;",
          "72:                     if (!has_errors){",
          "73:                         $('#errorMsg').hide();",
          "74:                         $('#upload_files_form').hide();",
          "75:                         $('#default_title').hide();",
          "76:                         $('#success_title').show();",
          "77:                         $('#successMsg').show();",
          "78:                     }",
          "79:                     return;",
          "80:                 }",
          "82:                 async function saveFile() {",
          "83:                     var errorMessage = \"Error uploading files\";",
          "84:                     let response;",
          "85:                     try {",
          "86:                         var f = files[index];",
          "87:                         var uploadPath = '{{.UploadBasePath}}/'+fixedEncodeURIComponent(f.name);",
          "88:                         var lastModified;",
          "89:                         try {",
          "90:                             lastModified = f.lastModified;",
          "91:                         } catch (e) {",
          "92:                             console.log(\"unable to get last modified time from file: \"+e.message);",
          "93:                             lastModified = \"\";",
          "94:                         }",
          "95:                         response = await fetch(uploadPath, {",
          "96:                             method: 'POST',",
          "97:                             headers: {",
          "98:                                 'X-SFTPGO-MTIME': lastModified",
          "99:                             },",
          "100:                             credentials: 'same-origin',",
          "101:                             redirect: 'error',",
          "102:                             body: f",
          "103:                         });",
          "104:                     } catch (e){",
          "105:                         throw Error(errorMessage+\": \" +e.message);",
          "106:                     }",
          "107:                     if (response.status == 201){",
          "108:                         index++;",
          "109:                         success++;",
          "110:                         uploadFile();",
          "111:                     } else {",
          "112:                         let jsonResponse;",
          "113:                         try {",
          "114:                             jsonResponse = await response.json();",
          "115:                         } catch(e){",
          "116:                             throw Error(errorMessage);",
          "117:                         }",
          "118:                         if (jsonResponse.message) {",
          "119:                             errorMessage = jsonResponse.message;",
          "120:                         }",
          "121:                         if (jsonResponse.error) {",
          "122:                             errorMessage += \": \" + jsonResponse.error;",
          "123:                         }",
          "124:                         throw Error(errorMessage);",
          "125:                     }",
          "126:                 }",
          "128:                 saveFile().catch(function(error){",
          "129:                     index++;",
          "130:                     has_errors = true;",
          "131:                     $('#errorTxt').text(error.message);",
          "132:                     $('#errorMsg').show();",
          "133:                     setTimeout(function () {",
          "134:                         $('#errorMsg').hide();",
          "135:                     }, 10000);",
          "136:                     uploadFile();",
          "137:                 });",
          "138:             }",
          "140:             uploadFile();",
          "141:         });",
          "142:     });",
          "143: </script>",
          "144: {{end}}",
          "",
          "---------------"
        ]
      }
    }
  ]
}