{
  "cve_id": "CVE-2022-41711",
  "cve_desc": "Badaso version 2.6.0 allows an unauthenticated remote attacker to execute arbitrary code remotely on the server. This is possible because the application does not properly validate the data uploaded by users.",
  "repo": "uasoft-indonesia/badaso",
  "patch_hash": "22250eca7c364d991ce9e0a723941eae4889d6f9",
  "patch_info": {
    "commit_hash": "22250eca7c364d991ce9e0a723941eae4889d6f9",
    "repo": "uasoft-indonesia/badaso",
    "commit_url": "https://github.com/uasoft-indonesia/badaso/commit/22250eca7c364d991ce9e0a723941eae4889d6f9",
    "files": [
      "src/resources/js/components/BadasoUploadFile.vue",
      "src/resources/js/components/BadasoUploadFileMultiple.vue",
      "src/resources/js/components/BadasoUploadImage.vue",
      "src/resources/js/components/BadasoUploadImageMultiple.vue"
    ],
    "message": "Merge pull request #807 from uasoft-indonesia/bugfix/v2/filter-mimeType\n\nBugfix[v2] add filter mimeType",
    "before_after_code_files": [
      "src/resources/js/components/BadasoUploadFile.vue||src/resources/js/components/BadasoUploadFile.vue",
      "src/resources/js/components/BadasoUploadFileMultiple.vue||src/resources/js/components/BadasoUploadFileMultiple.vue",
      "src/resources/js/components/BadasoUploadImage.vue||src/resources/js/components/BadasoUploadImage.vue",
      "src/resources/js/components/BadasoUploadImageMultiple.vue||src/resources/js/components/BadasoUploadImageMultiple.vue"
    ]
  },
  "patch_diff": {
    "src/resources/js/components/BadasoUploadFile.vue||src/resources/js/components/BadasoUploadFile.vue": [
      "File: src/resources/js/components/BadasoUploadFile.vue -> src/resources/js/components/BadasoUploadFile.vue",
      "--- Hunk 1 ---",
      "[Context before]",
      "336:           });",
      "337:           return;",
      "338:         }",
      "340:         this.uploadFile(files[0]);",
      "341:       }",
      "342:     },",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "339:         if (!this.availableMimetypes.file.validMime.includes(files[0].type)) {",
      "340:           this.$vs.notify({",
      "341:             title: this.$t(\"alert.danger\"),",
      "342:             text: \"File type not allowed\",",
      "343:             color: \"danger\",",
      "344:           });",
      "345:           return;",
      "346:         }",
      "",
      "---------------"
    ],
    "src/resources/js/components/BadasoUploadFileMultiple.vue||src/resources/js/components/BadasoUploadFileMultiple.vue": [
      "File: src/resources/js/components/BadasoUploadFileMultiple.vue -> src/resources/js/components/BadasoUploadFileMultiple.vue",
      "--- Hunk 1 ---",
      "[Context before]",
      "367:             });",
      "368:             return;",
      "369:           }",
      "371:           this.uploadFile(file);",
      "372:         }",
      "373:       }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "370:           if (!this.availableMimetypes.file.validMime.includes(file.type)) {",
      "371:             this.$vs.notify({",
      "372:               title: this.$t(\"alert.danger\"),",
      "373:               text: \"File type not allowed\",",
      "374:               color: \"danger\",",
      "375:             });",
      "376:             return;",
      "377:           }",
      "",
      "---------------"
    ],
    "src/resources/js/components/BadasoUploadImage.vue||src/resources/js/components/BadasoUploadImage.vue": [
      "File: src/resources/js/components/BadasoUploadImage.vue -> src/resources/js/components/BadasoUploadImage.vue",
      "--- Hunk 1 ---",
      "[Context before]",
      "380:           });",
      "381:           return;",
      "382:         }",
      "384:         this.uploadImage(files[0]);",
      "385:       }",
      "386:     },",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "383:         if (!this.availableMimetypes.image.validMime.includes(files[0].type)){",
      "384:           this.$vs.notify({",
      "385:             title: this.$t(\"alert.danger\"),",
      "386:             text: \"File type not allowed\",",
      "387:             color: \"danger\",",
      "388:           });",
      "389:           return;",
      "390:         }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "421:     uploadImage(file) {",
      "422:       const files = new FormData();",
      "423:       files.append(\"upload\", file);",
      "425:       files.append(\"working_dir\", this.getActiveFolder);",
      "426:       this.$api.badasoFile",
      "427:         .uploadUsingLfm(files)",
      "",
      "[Removed Lines]",
      "424:       files.append(\"type\", \"image\");",
      "",
      "[Added Lines]",
      "431:       files.append(\"type\", file.type);",
      "",
      "---------------"
    ],
    "src/resources/js/components/BadasoUploadImageMultiple.vue||src/resources/js/components/BadasoUploadImageMultiple.vue": [
      "File: src/resources/js/components/BadasoUploadImageMultiple.vue -> src/resources/js/components/BadasoUploadImageMultiple.vue",
      "--- Hunk 1 ---",
      "[Context before]",
      "395:             });",
      "396:             return;",
      "397:           }",
      "399:           this.uploadImage(file);",
      "400:         }",
      "401:       }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "398:           if (!this.availableMimetypes.image.validMime.includes(file.type)) {",
      "399:             this.$vs.notify({",
      "400:               title: this.$t(\"alert.danger\"),",
      "401:               text: \"File type not allowed\",",
      "402:               color: \"danger\",",
      "403:             });",
      "404:             return;",
      "405:           }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "60638842a5bdcf23b39329e30dae05a7f0386c8c",
      "candidate_info": {
        "commit_hash": "60638842a5bdcf23b39329e30dae05a7f0386c8c",
        "repo": "uasoft-indonesia/badaso",
        "commit_url": "https://github.com/uasoft-indonesia/badaso/commit/60638842a5bdcf23b39329e30dae05a7f0386c8c",
        "files": [
          "src/Helpers/CallHelperTest.php"
        ],
        "message": "Apply fixes from StyleCI",
        "before_after_code_files": [
          "src/Helpers/CallHelperTest.php||src/Helpers/CallHelperTest.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/uasoft-indonesia/badaso/pull/1086"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/Helpers/CallHelperTest.php||src/Helpers/CallHelperTest.php": [
          "File: src/Helpers/CallHelperTest.php -> src/Helpers/CallHelperTest.php"
        ]
      }
    },
    {
      "candidate_hash": "8e9c9d4afe52a593dfcfdab074d38c50d4fc341f",
      "candidate_info": {
        "commit_hash": "8e9c9d4afe52a593dfcfdab074d38c50d4fc341f",
        "repo": "uasoft-indonesia/badaso",
        "commit_url": "https://github.com/uasoft-indonesia/badaso/commit/8e9c9d4afe52a593dfcfdab074d38c50d4fc341f",
        "files": [
          "src/Controllers/BadasoBaseController.php",
          "src/Helpers/ApiDocs.php",
          "src/resources/lang/en/validation.php",
          "src/resources/lang/id/validation.php"
        ],
        "message": "bugfix/status code and id delete multiple",
        "before_after_code_files": [
          "src/Controllers/BadasoBaseController.php||src/Controllers/BadasoBaseController.php",
          "src/Helpers/ApiDocs.php||src/Helpers/ApiDocs.php",
          "src/resources/lang/en/validation.php||src/resources/lang/en/validation.php",
          "src/resources/lang/id/validation.php||src/resources/lang/id/validation.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/uasoft-indonesia/badaso/pull/1086"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/Controllers/BadasoBaseController.php||src/Controllers/BadasoBaseController.php": [
          "File: src/Controllers/BadasoBaseController.php -> src/Controllers/BadasoBaseController.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: use Exception;",
          "6: use Illuminate\\Http\\Request;",
          "7: use Illuminate\\Support\\Facades\\DB;",
          "8: use Uasoft\\Badaso\\Helpers\\ApiResponse;",
          "9: use Uasoft\\Badaso\\Helpers\\Firebase\\FCMNotification;",
          "10: use Uasoft\\Badaso\\Helpers\\GetData;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "8: use Uasoft\\Badaso\\Database\\Schema\\SchemaManager;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "84:             $request->validate([",
          "85:                 'data' => [",
          "86:                     'required',",
          "87:                 ],",
          "88:             ]);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "88:                     function($attribute, $value, $fail) use ($request) {",
          "89:                         $slug = $this->getSlug($request);",
          "90:                         $data_type = $this->getDataType($slug);",
          "91:                         $table_entity = DB::table($data_type->name)->where('id', $request->data['id'])->first();",
          "92:                         if(is_null($table_entity)){",
          "93:                             $fail(__('badaso::validation.crud.id_not_exist'));",
          "94:                         }",
          "95:                     }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "166:                 'slug' => 'required',",
          "167:                 'data' => [",
          "168:                     'required',",
          "169:                 ],",
          "170:                 'data.*.field' => ['required'],",
          "171:                 'data.*.value' => ['required'],",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "178:                     function($attribute, $value, $fail) use ($request) {",
          "179:                         $slug = $this->getSlug($request);",
          "180:                         $data_type = $this->getDataType($slug);",
          "181:                         $table_entity = DB::table($data_type->name)->where('id', $request->data[0]['value'])->first();",
          "183:                         if(is_null($table_entity)){",
          "184:                             $fail(__('badaso::validation.crud.id_not_exist'));",
          "185:                         }",
          "186:                     }",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "242:                 'slug' => 'required',",
          "243:                 'data' => [",
          "244:                     'required',",
          "245:                 ],",
          "246:                 'data.*.field' => ['required'],",
          "247:                 'data.*.value' => ['required'],",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "263:                     function($attribute, $value, $fail) use ($request) {",
          "264:                         $slug = $this->getSlug($request);",
          "265:                         $data_type = $this->getDataType($slug);",
          "267:                         $data = $this->createDataFromRaw($request->input('data') ?? [], $data_type);",
          "268:                         $ids = $data['ids'];",
          "269:                         $id_list = explode(',', $ids);",
          "270:                         foreach ($id_list as $id) {",
          "271:                             $table_entity = DB::table($data_type->name)->where('id', $id)->first();",
          "272:                             if(is_null($table_entity)){",
          "273:                                     $fail(__('badaso::validation.crud.id_not_exist'));",
          "274:                                 }",
          "275:                         }",
          "276:                     }",
          "",
          "---------------"
        ],
        "src/Helpers/ApiDocs.php||src/Helpers/ApiDocs.php": [
          "File: src/Helpers/ApiDocs.php -> src/Helpers/ApiDocs.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "380:             $data_type->display_name_singular,",
          "381:             $data_type->display_name_singular,",
          "382:             $data_type->slug,",
          "384:             self::getColumnExample($id_column['type']).','.self::getColumnExample($id_column['type']),",
          "385:             self::getAuthorize('delete_multiple', $table_name_data_type, $permission),",
          "386:         );",
          "",
          "[Removed Lines]",
          "383:             $id_column['field'],",
          "",
          "[Added Lines]",
          "383:             $id_column['field'] = 'ids',",
          "",
          "---------------"
        ],
        "src/resources/lang/en/validation.php||src/resources/lang/en/validation.php": [
          "File: src/resources/lang/en/validation.php -> src/resources/lang/en/validation.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "12:         'table_column_not_found'              => 'Invalid rows, Field :table_column does not exists',",
          "13:         'table_column_not_have_default_value' => 'Invalid rows, Field :table_column has no default value, please tick the checkbox Add',",
          "14:         'table_deleted_at_not_exists'         => 'Invalidate columns deleted_at, please created new columns delete_at in your table :table_name',",
          "16:     ],",
          "17:     'base64' => [",
          "18:         'length_invalid'   => 'Base64 format is invalid',",
          "",
          "[Removed Lines]",
          "15:         'id_table_wrong'                      => 'Primary key should be named only\"id\"',",
          "",
          "[Added Lines]",
          "15:         'id_table_wrong'                      => 'Primary key should be named only \"id\"',",
          "16:         'id_not_exist'                      => '\"id\" doesn\\'t exist',",
          "",
          "---------------"
        ],
        "src/resources/lang/id/validation.php||src/resources/lang/id/validation.php": [
          "File: src/resources/lang/id/validation.php -> src/resources/lang/id/validation.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "12:         'table_column_not_found'              => 'Row tidak valid, Field :table_column tidak ditemukan',",
          "13:         'table_column_not_have_default_value' => 'Row tidak valid, Field :table_column tidak punya nilai default, tolong centang checkbox Add',",
          "14:         'id_table_wrong'                      => 'Primary Key harus diganti dengan \"id\"',",
          "15:     ],",
          "16:     'base64' => [",
          "17:         'length_invalid'   => 'Format base64 tidak valid',",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "15:         'id_not_exist'                      => '\"id\" tidak ditemukan',",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "8a724cd73ae913bb23cddf625f86f11a3bfaa1ff",
      "candidate_info": {
        "commit_hash": "8a724cd73ae913bb23cddf625f86f11a3bfaa1ff",
        "repo": "uasoft-indonesia/badaso",
        "commit_url": "https://github.com/uasoft-indonesia/badaso/commit/8a724cd73ae913bb23cddf625f86f11a3bfaa1ff",
        "files": [
          "src/Migrations/2021_04_28_004319_create_f_c_m_messages_table.php"
        ],
        "message": "#483 | v2 | Fix Problem runing first migrate with sql server database",
        "before_after_code_files": [
          "src/Migrations/2021_04_28_004319_create_f_c_m_messages_table.php||src/Migrations/2021_04_28_004319_create_f_c_m_messages_table.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/uasoft-indonesia/badaso/pull/1086"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/Migrations/2021_04_28_004319_create_f_c_m_messages_table.php||src/Migrations/2021_04_28_004319_create_f_c_m_messages_table.php": [
          "File: src/Migrations/2021_04_28_004319_create_f_c_m_messages_table.php -> src/Migrations/2021_04_28_004319_create_f_c_m_messages_table.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "24:             $table->timestamps();",
          "26:             $table->foreign('receiver_user_id')->references('id')->on(config('badaso.database.prefix').'users')->onDelete('cascade');",
          "28:         });",
          "29:     }",
          "",
          "[Removed Lines]",
          "27:             $table->foreign('sender_user_id')->references('id')->on(config('badaso.database.prefix').'users')->onDelete('cascade');",
          "",
          "[Added Lines]",
          "27:             $table->foreign('sender_user_id')->references('id')->on(config('badaso.database.prefix').'users');",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "89bf79595324ceba4a50891847ee761796e67bb6",
      "candidate_info": {
        "commit_hash": "89bf79595324ceba4a50891847ee761796e67bb6",
        "repo": "uasoft-indonesia/badaso",
        "commit_url": "https://github.com/uasoft-indonesia/badaso/commit/89bf79595324ceba4a50891847ee761796e67bb6",
        "files": [
          "src/Controllers/BadasoAuthController.php"
        ],
        "message": "Apply fixes from StyleCI",
        "before_after_code_files": [
          "src/Controllers/BadasoAuthController.php||src/Controllers/BadasoAuthController.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/uasoft-indonesia/badaso/pull/1086"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/Controllers/BadasoAuthController.php||src/Controllers/BadasoAuthController.php": [
          "File: src/Controllers/BadasoAuthController.php -> src/Controllers/BadasoAuthController.php"
        ]
      }
    },
    {
      "candidate_hash": "3dfe5ab0e9c11af2485f1a6bb76d92e29cca8442",
      "candidate_info": {
        "commit_hash": "3dfe5ab0e9c11af2485f1a6bb76d92e29cca8442",
        "repo": "uasoft-indonesia/badaso",
        "commit_url": "https://github.com/uasoft-indonesia/badaso/commit/3dfe5ab0e9c11af2485f1a6bb76d92e29cca8442",
        "files": [
          "src/Controllers/BadasoDatabaseController.php"
        ],
        "message": "Fix migration prod command",
        "before_after_code_files": [
          "src/Controllers/BadasoDatabaseController.php||src/Controllers/BadasoDatabaseController.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/uasoft-indonesia/badaso/pull/1086"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/Controllers/BadasoDatabaseController.php||src/Controllers/BadasoDatabaseController.php": [
          "File: src/Controllers/BadasoDatabaseController.php -> src/Controllers/BadasoDatabaseController.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "63:             $this->file_name = $this->file_generator->generateBDOMigrationFile($request->table, 'create', $request->rows, $request->relations);",
          "65:             $exitCode = Artisan::call('migrate', [",
          "67:             ]);",
          "69:             switch ($exitCode) {",
          "",
          "[Removed Lines]",
          "66:                 '--path' => 'database/migrations/badaso/', '--force' => true,",
          "",
          "[Added Lines]",
          "66:                 '--path' => 'database/migrations/badaso/',",
          "67:                 '--force' => true,",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "157:             }",
          "159:             $exitCode = Artisan::call('migrate', [",
          "161:             ]);",
          "163:             switch ($exitCode) {",
          "",
          "[Removed Lines]",
          "160:                 '--path' => 'database/migrations/badaso/', '--force' => true,",
          "",
          "[Added Lines]",
          "161:                 '--path' => 'database/migrations/badaso/',",
          "162:                 '--force' => true,",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "216:             $this->file_name = $this->file_generator->generateBDOMigrationFile($request->table, 'drop', $rows);",
          "218:             $exitCode = Artisan::call('migrate', [",
          "220:             ]);",
          "222:             switch ($exitCode) {",
          "",
          "[Removed Lines]",
          "219:                 '--path' => 'database/migrations/badaso/', '--force' => true,",
          "",
          "[Added Lines]",
          "221:                 '--path' => 'database/migrations/badaso/',",
          "222:                 '--force' => true,",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "310:         try {",
          "311:             $exitCode = Artisan::call('migrate', [",
          "312:                 '--path' => 'database/migrations/badaso/',",
          "313:             ]);",
          "315:             switch ($exitCode) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "316:                 '--force' => true,",
          "",
          "---------------"
        ]
      }
    }
  ]
}