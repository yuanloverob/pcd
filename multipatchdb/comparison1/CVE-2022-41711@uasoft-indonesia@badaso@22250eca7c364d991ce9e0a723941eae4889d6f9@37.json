{
  "cve_id": "CVE-2022-41711",
  "cve_desc": "Badaso version 2.6.0 allows an unauthenticated remote attacker to execute arbitrary code remotely on the server. This is possible because the application does not properly validate the data uploaded by users.",
  "repo": "uasoft-indonesia/badaso",
  "patch_hash": "22250eca7c364d991ce9e0a723941eae4889d6f9",
  "patch_info": {
    "commit_hash": "22250eca7c364d991ce9e0a723941eae4889d6f9",
    "repo": "uasoft-indonesia/badaso",
    "commit_url": "https://github.com/uasoft-indonesia/badaso/commit/22250eca7c364d991ce9e0a723941eae4889d6f9",
    "files": [
      "src/resources/js/components/BadasoUploadFile.vue",
      "src/resources/js/components/BadasoUploadFileMultiple.vue",
      "src/resources/js/components/BadasoUploadImage.vue",
      "src/resources/js/components/BadasoUploadImageMultiple.vue"
    ],
    "message": "Merge pull request #807 from uasoft-indonesia/bugfix/v2/filter-mimeType\n\nBugfix[v2] add filter mimeType",
    "before_after_code_files": [
      "src/resources/js/components/BadasoUploadFile.vue||src/resources/js/components/BadasoUploadFile.vue",
      "src/resources/js/components/BadasoUploadFileMultiple.vue||src/resources/js/components/BadasoUploadFileMultiple.vue",
      "src/resources/js/components/BadasoUploadImage.vue||src/resources/js/components/BadasoUploadImage.vue",
      "src/resources/js/components/BadasoUploadImageMultiple.vue||src/resources/js/components/BadasoUploadImageMultiple.vue"
    ]
  },
  "patch_diff": {
    "src/resources/js/components/BadasoUploadFile.vue||src/resources/js/components/BadasoUploadFile.vue": [
      "File: src/resources/js/components/BadasoUploadFile.vue -> src/resources/js/components/BadasoUploadFile.vue",
      "--- Hunk 1 ---",
      "[Context before]",
      "336:           });",
      "337:           return;",
      "338:         }",
      "340:         this.uploadFile(files[0]);",
      "341:       }",
      "342:     },",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "339:         if (!this.availableMimetypes.file.validMime.includes(files[0].type)) {",
      "340:           this.$vs.notify({",
      "341:             title: this.$t(\"alert.danger\"),",
      "342:             text: \"File type not allowed\",",
      "343:             color: \"danger\",",
      "344:           });",
      "345:           return;",
      "346:         }",
      "",
      "---------------"
    ],
    "src/resources/js/components/BadasoUploadFileMultiple.vue||src/resources/js/components/BadasoUploadFileMultiple.vue": [
      "File: src/resources/js/components/BadasoUploadFileMultiple.vue -> src/resources/js/components/BadasoUploadFileMultiple.vue",
      "--- Hunk 1 ---",
      "[Context before]",
      "367:             });",
      "368:             return;",
      "369:           }",
      "371:           this.uploadFile(file);",
      "372:         }",
      "373:       }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "370:           if (!this.availableMimetypes.file.validMime.includes(file.type)) {",
      "371:             this.$vs.notify({",
      "372:               title: this.$t(\"alert.danger\"),",
      "373:               text: \"File type not allowed\",",
      "374:               color: \"danger\",",
      "375:             });",
      "376:             return;",
      "377:           }",
      "",
      "---------------"
    ],
    "src/resources/js/components/BadasoUploadImage.vue||src/resources/js/components/BadasoUploadImage.vue": [
      "File: src/resources/js/components/BadasoUploadImage.vue -> src/resources/js/components/BadasoUploadImage.vue",
      "--- Hunk 1 ---",
      "[Context before]",
      "380:           });",
      "381:           return;",
      "382:         }",
      "384:         this.uploadImage(files[0]);",
      "385:       }",
      "386:     },",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "383:         if (!this.availableMimetypes.image.validMime.includes(files[0].type)){",
      "384:           this.$vs.notify({",
      "385:             title: this.$t(\"alert.danger\"),",
      "386:             text: \"File type not allowed\",",
      "387:             color: \"danger\",",
      "388:           });",
      "389:           return;",
      "390:         }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "421:     uploadImage(file) {",
      "422:       const files = new FormData();",
      "423:       files.append(\"upload\", file);",
      "425:       files.append(\"working_dir\", this.getActiveFolder);",
      "426:       this.$api.badasoFile",
      "427:         .uploadUsingLfm(files)",
      "",
      "[Removed Lines]",
      "424:       files.append(\"type\", \"image\");",
      "",
      "[Added Lines]",
      "431:       files.append(\"type\", file.type);",
      "",
      "---------------"
    ],
    "src/resources/js/components/BadasoUploadImageMultiple.vue||src/resources/js/components/BadasoUploadImageMultiple.vue": [
      "File: src/resources/js/components/BadasoUploadImageMultiple.vue -> src/resources/js/components/BadasoUploadImageMultiple.vue",
      "--- Hunk 1 ---",
      "[Context before]",
      "395:             });",
      "396:             return;",
      "397:           }",
      "399:           this.uploadImage(file);",
      "400:         }",
      "401:       }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "398:           if (!this.availableMimetypes.image.validMime.includes(file.type)) {",
      "399:             this.$vs.notify({",
      "400:               title: this.$t(\"alert.danger\"),",
      "401:               text: \"File type not allowed\",",
      "402:               color: \"danger\",",
      "403:             });",
      "404:             return;",
      "405:           }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "ee1fbd22eafaf9527610501aef1c1c8ad10d383a",
      "candidate_info": {
        "commit_hash": "ee1fbd22eafaf9527610501aef1c1c8ad10d383a",
        "repo": "uasoft-indonesia/badaso",
        "commit_url": "https://github.com/uasoft-indonesia/badaso/commit/ee1fbd22eafaf9527610501aef1c1c8ad10d383a",
        "files": [
          ".github/release-drafter.yml",
          "composer.json",
          "src/Migrations/2021_10_21_054710_add_is_show_header_and_expand_in_menus_table.php",
          "src/Swagger/swagger_models/auth.php"
        ],
        "message": "fix conflict composer.json",
        "before_after_code_files": [
          "src/Migrations/2021_10_21_054710_add_is_show_header_and_expand_in_menus_table.php||src/Migrations/2021_10_21_054710_add_is_show_header_and_expand_in_menus_table.php",
          "src/Swagger/swagger_models/auth.php||src/Swagger/swagger_models/auth.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/uasoft-indonesia/badaso/pull/1086"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/Migrations/2021_10_21_054710_add_is_show_header_and_expand_in_menus_table.php||src/Migrations/2021_10_21_054710_add_is_show_header_and_expand_in_menus_table.php": [
          "File: src/Migrations/2021_10_21_054710_add_is_show_header_and_expand_in_menus_table.php -> src/Migrations/2021_10_21_054710_add_is_show_header_and_expand_in_menus_table.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "14:     public function up()",
          "15:     {",
          "18:                 $table->boolean('is_show_header')->default(true)->after('icon');",
          "19:             }",
          "21:                 $table->boolean('is_expand')->default(true)->after('icon');",
          "22:             }",
          "24:                 $table->boolean('order')->nullable()->after('icon');",
          "25:             }",
          "26:         });",
          "",
          "[Removed Lines]",
          "16:         Schema::table('badaso_menus', function (Blueprint $table) {",
          "17:             if (! Schema::hasColumn('badaso_menus', 'is_show_header')) {",
          "20:             if (! Schema::hasColumn('badaso_menus', 'is_expand')) {",
          "23:             if (! Schema::hasColumn('badaso_menus', 'order')) {",
          "",
          "[Added Lines]",
          "16:         Schema::table(config('badaso.database.prefix').'menus', function (Blueprint $table) {",
          "17:             if (! Schema::hasColumn(config('badaso.database.prefix').'menus', 'is_show_header')) {",
          "20:             if (! Schema::hasColumn(config('badaso.database.prefix').'menus', 'is_expand')) {",
          "23:             if (! Schema::hasColumn(config('badaso.database.prefix').'menus', 'order')) {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "34:     public function down()",
          "35:     {",
          "38:                 $table->dropColumn('is_show_header');",
          "39:             }",
          "41:                 $table->dropColumn('is_expand');",
          "42:             }",
          "44:                 $table->dropColumn('order');",
          "45:             }",
          "46:         });",
          "",
          "[Removed Lines]",
          "36:         Schema::table('badaso_menus', function (Blueprint $table) {",
          "37:             if (Schema::hasColumn('badaso_menus', 'is_show_header')) {",
          "40:             if (Schema::hasColumn('badaso_menus', 'is_expand')) {",
          "43:             if (Schema::hasColumn('badaso_menus', 'order')) {",
          "",
          "[Added Lines]",
          "36:         Schema::table(config('badaso.database.prefix').'menus', function (Blueprint $table) {",
          "37:             if (Schema::hasColumn(config('badaso.database.prefix').'menus', 'is_show_header')) {",
          "40:             if (Schema::hasColumn(config('badaso.database.prefix').'menus', 'is_expand')) {",
          "43:             if (Schema::hasColumn(config('badaso.database.prefix').'menus', 'order')) {",
          "",
          "---------------"
        ],
        "src/Swagger/swagger_models/auth.php||src/Swagger/swagger_models/auth.php": [
          "File: src/Swagger/swagger_models/auth.php -> src/Swagger/swagger_models/auth.php"
        ]
      }
    },
    {
      "candidate_hash": "bdf0238ab10d9317d033448d20b461f79e9faba5",
      "candidate_info": {
        "commit_hash": "bdf0238ab10d9317d033448d20b461f79e9faba5",
        "repo": "uasoft-indonesia/badaso",
        "commit_url": "https://github.com/uasoft-indonesia/badaso/commit/bdf0238ab10d9317d033448d20b461f79e9faba5",
        "files": [
          "src/resources/js/pages/auth/register.vue",
          "src/resources/js/pages/user/profile.vue"
        ],
        "message": "update register form",
        "before_after_code_files": [
          "src/resources/js/pages/auth/register.vue||src/resources/js/pages/auth/register.vue",
          "src/resources/js/pages/user/profile.vue||src/resources/js/pages/user/profile.vue"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/uasoft-indonesia/badaso/pull/1086"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/resources/js/pages/auth/register.vue||src/resources/js/pages/auth/register.vue": [
          "File: src/resources/js/pages/auth/register.vue -> src/resources/js/pages/auth/register.vue",
          "--- Hunk 1 ---",
          "[Context before]",
          "53:               ></span>",
          "54:             </div>",
          "55:           </div>",
          "77:           <vs-input",
          "78:             icon=\"phone\"",
          "79:             icon-after",
          "",
          "[Removed Lines]",
          "56:             <vs-select",
          "57:               v-model=\"gender\"",
          "58:               size=\"12\"",
          "59:               :placeholder=\"$t('register.field.gender')\"",
          "60:               :items=\"genderitems\"",
          "61:               :alert=\"errors.gender\"",
          "62:             > </vs-select>",
          "63:             <div v-if=\"errors.gender\" class=\"register__error-container\">",
          "64:             <div v-if=\"$helper.isArray(errors.gender)\">",
          "65:               <span",
          "66:                 class=\"register__input--error\"",
          "67:                 v-for=\"(info, index) in errors.gender\"",
          "68:                 :key=\"index\"",
          "69:               >",
          "70:                 {{ info }}",
          "71:               </span>",
          "72:             </div>",
          "73:             <div v-else>",
          "74:               <span class=\"register__input--error\" v-html=\"errors.phone\"></span>",
          "75:             </div>",
          "76:           </div>",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "153:             v-model=\"passwordConfirmation\"",
          "154:             class=\"register__input\"",
          "155:           />",
          "157:             icon=\"place\"",
          "158:             icon-after",
          "159:             size=\"default\"",
          "",
          "[Removed Lines]",
          "156:                   <vs-input",
          "",
          "[Added Lines]",
          "136:             <vs-input",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "175:               <span class=\"register__input--error\" v-html=\"errors.address\"></span>",
          "176:             </div>",
          "177:           </div>",
          "178:           <vs-button",
          "179:             type=\"relief\"",
          "180:             class=\"register__button\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "158:           <badaso-select",
          "159:               v-model=\"gender\"",
          "160:               :placeholder=\"$t('register.field.gender')\"",
          "161:               :items=\"genderitems\"",
          "162:               :alert=\"errors.gender\"",
          "163:            ></badaso-select>",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "211:         baseUrl: process.env.MIX_ADMIN_PANEL_ROUTE_PREFIX",
          "212:             ? process.env.MIX_ADMIN_PANEL_ROUTE_PREFIX",
          "213:             : \"badaso-dashboard\",",
          "219:     };",
          "220:   },",
          "221:   methods: {",
          "",
          "[Removed Lines]",
          "215:         genderitems:[",
          "216:             { label: this.$t(\"register.gender.man\"), value: \"man\" },",
          "217:             { label: this.$t(\"register.gender.woman\"), value: \"woman\" },",
          "218:         ]",
          "",
          "[Added Lines]",
          "200:         genderitems: [",
          "201:             { label: this.$t(\"user.gender.man\"), value: \"man\" },",
          "202:             { label: this.$t(\"user.gender.woman\"), value: \"woman\" },",
          "203:         ],",
          "",
          "---------------"
        ],
        "src/resources/js/pages/user/profile.vue||src/resources/js/pages/user/profile.vue": [
          "File: src/resources/js/pages/user/profile.vue -> src/resources/js/pages/user/profile.vue",
          "--- Hunk 1 ---",
          "[Context before]",
          "149: export default {",
          "150:   name: \"UserProfile\",",
          "151:   components: {},",
          "155:   data() {",
          "156:     return{",
          "157:         errors: {},",
          "",
          "[Removed Lines]",
          "152:   data: () => ({",
          "154:   }),",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "3e983bd9091251f3a994dda9915cf7cf4496061d",
      "candidate_info": {
        "commit_hash": "3e983bd9091251f3a994dda9915cf7cf4496061d",
        "repo": "uasoft-indonesia/badaso",
        "commit_url": "https://github.com/uasoft-indonesia/badaso/commit/3e983bd9091251f3a994dda9915cf7cf4496061d",
        "files": [
          "src/Config/lfm.php",
          "src/Controllers/BadasoFileController.php",
          "tests/Feature/BadasoApiCrudManagementTest.php"
        ],
        "message": "change config lfm",
        "before_after_code_files": [
          "src/Config/lfm.php||src/Config/lfm.php",
          "src/Controllers/BadasoFileController.php||src/Controllers/BadasoFileController.php",
          "tests/Feature/BadasoApiCrudManagementTest.php||tests/Feature/BadasoApiCrudManagementTest.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/uasoft-indonesia/badaso/pull/1086"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/Config/lfm.php||src/Config/lfm.php": [
          "File: src/Config/lfm.php -> src/Config/lfm.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "107:     'should_validate_size' => false,",
          "",
          "[Removed Lines]",
          "109:     'should_validate_mime' => false,",
          "",
          "[Added Lines]",
          "109:     'should_validate_mime' => true,",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "181:     'middleware' => [",
          "182:         'web',",
          "183:         'auth',",
          "185:     ],",
          "186: ];",
          "",
          "[Removed Lines]",
          "184:         BadasoCheckPermissions::class.':browse_file_manager',",
          "",
          "[Added Lines]",
          "184:         BadasoCheckPermissions::class . ':browse_file_manager',",
          "",
          "---------------"
        ],
        "src/Controllers/BadasoFileController.php||src/Controllers/BadasoFileController.php": [
          "File: src/Controllers/BadasoFileController.php -> src/Controllers/BadasoFileController.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "55:     public function uploadFileUsingLfm(Request $request)",
          "56:     {",
          "61:     }",
          "63:     public function deleteFileUsingLfm(Request $request)",
          "",
          "[Removed Lines]",
          "57:         $upload = new UploadController();",
          "58:         $file = $upload->upload();",
          "60:         return ApiResponse::success(json_decode(json_encode($file)));",
          "",
          "[Added Lines]",
          "57:             $upload = new UploadController();",
          "58:             $file = $upload->upload();",
          "60:             if(key_exists('error', $file->original)){",
          "61:                 return ApiResponse::failed($file);",
          "62:             }",
          "64:             return ApiResponse::success(json_decode(json_encode($file)));",
          "",
          "---------------"
        ],
        "tests/Feature/BadasoApiCrudManagementTest.php||tests/Feature/BadasoApiCrudManagementTest.php": [
          "File: tests/Feature/BadasoApiCrudManagementTest.php -> tests/Feature/BadasoApiCrudManagementTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: namespace Uasoft\\Badaso\\Tests\\Feature;",
          "5: use Illuminate\\Database\\Schema\\Blueprint;",
          "6: use Illuminate\\Support\\Facades\\DB;",
          "7: use Illuminate\\Support\\Facades\\Hash;",
          "8: use Illuminate\\Support\\Facades\\Schema;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "6: use Illuminate\\Http\\UploadedFile;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "445:                 }",
          "446:                 PHP;",
          "447:                 $model_path = app_path(\"Models/$model_file_name\");",
          "449:                     file_put_contents($model_path, $model_body);",
          "450:                 }",
          "",
          "[Removed Lines]",
          "448:                 if (! file_exists($model_path)) {",
          "",
          "[Added Lines]",
          "449:                 if (!file_exists($model_path)) {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "466:             $controller_data = [];",
          "467:             if (rand(0, 1)) {",
          "470:                 $controller_file_name = \"{$controller_name}.php\";",
          "471:                 $controller_body = <<<PHP",
          "472:                 <?php",
          "",
          "[Removed Lines]",
          "469:                 $controller_name = str_replace([' ', '_'], '', ucwords($table_name)).'Controller';",
          "",
          "[Added Lines]",
          "470:                 $controller_name = str_replace([' ', '_'], '', ucwords($table_name)) . 'Controller';",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "475:                 class {$controller_name} extends \\Uasoft\\Badaso\\Controllers\\BadasoBaseController {}",
          "476:                 PHP;",
          "477:                 $controller_path = app_path(\"/Http/Controllers/$controller_file_name\");",
          "479:                     file_put_contents($controller_path, $controller_body);",
          "480:                 }",
          "",
          "[Removed Lines]",
          "478:                 if (! file_exists($controller_path)) {",
          "",
          "[Added Lines]",
          "479:                 if (!file_exists($controller_path)) {",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1178:                 }",
          "1179:                 PHP;",
          "1180:                 $model_path = app_path(\"Models/$model_file_name\");",
          "1182:                     file_put_contents($model_path, $model_body);",
          "1183:                 }",
          "",
          "[Removed Lines]",
          "1181:                 if (! file_exists($model_path)) {",
          "",
          "[Added Lines]",
          "1182:                 if (!file_exists($model_path)) {",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "1199:             $controller_data = [];",
          "1200:             if (rand(0, 1)) {",
          "1203:                 $controller_file_name = \"{$controller_name}.php\";",
          "1204:                 $controller_body = <<<PHP",
          "1205:                 <?php",
          "",
          "[Removed Lines]",
          "1202:                 $controller_name = str_replace([' ', '_'], '', ucwords($table_name)).'Controller';",
          "",
          "[Added Lines]",
          "1203:                 $controller_name = str_replace([' ', '_'], '', ucwords($table_name)) . 'Controller';",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "1208:                 class {$controller_name} extends \\Uasoft\\Badaso\\Controllers\\BadasoBaseController {}",
          "1209:                 PHP;",
          "1210:                 $controller_path = app_path(\"/Http/Controllers/$controller_file_name\");",
          "1212:                     file_put_contents($controller_path, $controller_body);",
          "1213:                 }",
          "",
          "[Removed Lines]",
          "1211:                 if (! file_exists($controller_path)) {",
          "",
          "[Added Lines]",
          "1212:                 if (!file_exists($controller_path)) {",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "1228:             $request_body = [",
          "1229:                 'name' =>  $table_name,",
          "1230:                 'slug' =>  $table_name,",
          "1233:                 'icon' =>  'add',",
          "1234:                 'modelName' =>  $model,",
          "1235:                 'policyName' =>  '',",
          "",
          "[Removed Lines]",
          "1231:                 'displayNameSingular' =>  $table_label.'(update)',",
          "1232:                 'displayNamePlural' =>  $table_label.'(update)',",
          "",
          "[Added Lines]",
          "1232:                 'displayNameSingular' =>  $table_label . '(update)',",
          "1233:                 'displayNamePlural' =>  $table_label . '(update)',",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "1315:             $controller_name = \"{$name}Controller.php\";",
          "1317:             if (file_exists($controller_path)) {",
          "1318:                 unlink($controller_path);",
          "1319:             }",
          "1322:             $model_name = \"{$name}.php\";",
          "1324:             if (file_exists($model_path)) {",
          "1325:                 unlink($model_path);",
          "1326:             }",
          "",
          "[Removed Lines]",
          "1316:             $controller_path = app_path('Http/Controllers/'.$controller_name);",
          "1323:             $model_path = app_path('Models/'.$model_name);",
          "",
          "[Added Lines]",
          "1317:             $controller_path = app_path('Http/Controllers/' . $controller_name);",
          "1324:             $model_path = app_path('Models/' . $model_name);",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "1488:         $this->assertTrue(true);",
          "1489:     }",
          "1490: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1492:     public function testUploadImageFile()",
          "1493:     {",
          "1495:         $file_php = UploadedFile::fake()->create('document.php', 20);",
          "1496:         $file =",
          "1497:             [",
          "1498:                 \"type\" => 'file',",
          "1499:                 \"upload\" => $file_php",
          "1500:             ];",
          "1501:         $response = $this->json('POST', CallHelperTest::getUrlApiV1Prefix('/file/upload/lfm'), $file);",
          "1502:         $message = json_decode($response['message'], true);",
          "1503:         $this->assertArrayHasKey('error', $message['original']);",
          "1506:         $file_pdf = UploadedFile::fake()->create('document.pdf', 200);",
          "1507:         $file = [",
          "1508:             \"type\" => 'file',",
          "1509:             \"upload\" => $file_pdf",
          "1510:         ];",
          "1511:         $response = $this->json('POST', CallHelperTest::getUrlApiV1Prefix('/file/upload/lfm'), $file);",
          "1512:         $message = $response['data'];",
          "1513:         $this->assertNull($response['errors']);",
          "1514:         $this->assertArrayHasKey('uploaded', $message['original']);",
          "1517:         $image_file = UploadedFile::fake()->image('image.jpg');",
          "1518:         $image = [",
          "1519:             \"type\" => 'image',",
          "1520:             \"upload\" => $image_file",
          "1521:         ];",
          "1522:         $response = $this->json('POST', CallHelperTest::getUrlApiV1Prefix('/file/upload/lfm'), $image);",
          "1523:         $message = $response['data'];",
          "1524:         $this->assertNull($response['errors']);",
          "1525:         $this->assertArrayHasKey('uploaded', $message['original']);",
          "1526:     }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "3e893b3593bead93e81affa2ad8cf2960a6c3a70",
      "candidate_info": {
        "commit_hash": "3e893b3593bead93e81affa2ad8cf2960a6c3a70",
        "repo": "uasoft-indonesia/badaso",
        "commit_url": "https://github.com/uasoft-indonesia/badaso/commit/3e893b3593bead93e81affa2ad8cf2960a6c3a70",
        "files": [
          "src/Controllers/Controller.php",
          "src/Helpers/GetData.php",
          "tests/Feature/BadasoApiCrudManagementTest.php"
        ],
        "message": "add unit test for entity and bugifix badaso base controller",
        "before_after_code_files": [
          "src/Controllers/Controller.php||src/Controllers/Controller.php",
          "src/Helpers/GetData.php||src/Helpers/GetData.php",
          "tests/Feature/BadasoApiCrudManagementTest.php||tests/Feature/BadasoApiCrudManagementTest.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/uasoft-indonesia/badaso/pull/1086"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/Controllers/Controller.php||src/Controllers/Controller.php": [
          "File: src/Controllers/Controller.php -> src/Controllers/Controller.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "256:             $record = DB::table($data_type->name)->select($fields)->where('id', $id)->first();",
          "257:         }",
          "261:         return $record;",
          "262:     }",
          "",
          "[Removed Lines]",
          "259:         $record = GetData::getRelationData($data_type, $record);",
          "",
          "[Added Lines]",
          "260:         $record = GetData::getRelationData($data_type, $record, 'read');",
          "",
          "---------------"
        ],
        "src/Helpers/GetData.php||src/Helpers/GetData.php": [
          "File: src/Helpers/GetData.php -> src/Helpers/GetData.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "103:             $class = new ReflectionClass(get_class($row));",
          "104:             $class_methods = $class->getMethods();",
          "107:             foreach ($class_methods as $class_method) {",
          "108:                 if ($class_method->class == $class->name) {",
          "109:                     try {",
          "111:                         $record->{$class_method->name} = json_decode(json_encode($row->{$class_method->name}));",
          "113:                     } catch (Exception $e) {",
          "115:                     }",
          "116:                 }",
          "117:             }",
          "118:             $records[] = self::getRelationData($data_type, $record);",
          "119:         }",
          "",
          "[Removed Lines]",
          "106:             $record = json_decode(json_encode($row));",
          "110:                         dd($class_method->name, $class_methods, $row);",
          "",
          "[Added Lines]",
          "106:             $record = $row;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "258:                 && $destination_table_column",
          "259:                 && $destination_table_display_column",
          "260:             ) {",
          "284:                 }",
          "285:             }",
          "286:         }",
          "",
          "[Removed Lines]",
          "261:                 $relation_data = DB::table($destination_table)->select([",
          "262:                     $destination_table_column,",
          "263:                     $destination_table_display_column,",
          "264:                 ])",
          "265:                     ->where($destination_table_column, $row->{$field->field})",
          "266:                     ->get();",
          "268:                 switch ($relation_type) {",
          "269:                     case 'belongs_to':",
          "270:                         $row->{$destination_table} = collect($relation_data)->first();",
          "271:                         break;",
          "273:                     case 'has_many':",
          "274:                         $row->{$destination_table} = collect($relation_data)->toArray();",
          "275:                         break;",
          "277:                     case 'has_many':",
          "278:                         $row->{$destination_table} = collect($relation_data)->first();",
          "279:                         break;",
          "281:                     default:",
          "283:                         break;",
          "",
          "[Added Lines]",
          "260:                 if (isset($row->{$field->field})) {",
          "261:                     $relation_data = DB::table($destination_table)->select([",
          "262:                         $destination_table_column,",
          "263:                         $destination_table_display_column,",
          "264:                     ])",
          "265:                         ->where($destination_table_column, $row->{$field->field})",
          "266:                         ->get();",
          "268:                     switch ($relation_type) {",
          "269:                         case 'belongs_to':",
          "270:                             $row->{$destination_table} = collect($relation_data)->first();",
          "271:                             break;",
          "273:                         case 'has_many':",
          "274:                             $row->{$destination_table} = collect($relation_data)->toArray();",
          "275:                             break;",
          "277:                         case 'has_many':",
          "278:                             $row->{$destination_table} = collect($relation_data)->first();",
          "279:                             break;",
          "281:                         default:",
          "283:                             break;",
          "284:                     }",
          "",
          "---------------"
        ],
        "tests/Feature/BadasoApiCrudManagementTest.php||tests/Feature/BadasoApiCrudManagementTest.php": [
          "File: tests/Feature/BadasoApiCrudManagementTest.php -> tests/Feature/BadasoApiCrudManagementTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "661:         }",
          "662:     }",
          "665:     {",
          "666:         $data_add_entities = CallHelperTest::getCache($this->KEY_DATA_ADD_ENTITY);",
          "667:         foreach ($data_add_entities as $table => $data_add_entity) {",
          "",
          "[Removed Lines]",
          "664:     private function testBrowseDataEntityCrudManagement()",
          "",
          "[Added Lines]",
          "664:     public function testBrowseDataEntityCrudManagement()",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "673:         }",
          "674:     }",
          "677:     {",
          "678:         $data_add_entities = CallHelperTest::getCache($this->KEY_DATA_ADD_ENTITY);",
          "679:         foreach ($data_add_entities as $table => $data_add_entity) {",
          "",
          "[Removed Lines]",
          "676:     private function testGetAllDataEntityCrudManagement()",
          "",
          "[Added Lines]",
          "676:     public function testGetAllDataEntityCrudManagement()",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "703:             $table_row = DB::table($table)->where('id', $id)->first();",
          "707:             $ids = [];",
          "",
          "[Removed Lines]",
          "704:             $this->assertTrue($table_row == null);",
          "",
          "[Added Lines]",
          "704:             if (isset($table_row)) {",
          "705:                 $this->assertNotEmpty($table_row->created_at);",
          "706:             } else {",
          "707:                 $this->assertEmpty($table_row);",
          "708:             }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "6f092ea0c0b8014ed8d6462eed5868b3e382c0cb",
      "candidate_info": {
        "commit_hash": "6f092ea0c0b8014ed8d6462eed5868b3e382c0cb",
        "repo": "uasoft-indonesia/badaso",
        "commit_url": "https://github.com/uasoft-indonesia/badaso/commit/6f092ea0c0b8014ed8d6462eed5868b3e382c0cb",
        "files": [
          "src/Helpers/GetData.php"
        ],
        "message": "update str",
        "before_after_code_files": [
          "src/Helpers/GetData.php||src/Helpers/GetData.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/uasoft-indonesia/badaso/pull/1086"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/Helpers/GetData.php||src/Helpers/GetData.php": [
          "File: src/Helpers/GetData.php -> src/Helpers/GetData.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "396:                         $upload_image = $record->{$data_row->field};",
          "398:                         if (isset($upload_image)) {",
          "400:                                 $upload_image = $upload_image;",
          "401:                             } else {",
          "402:                                 if (config('lfm.should_create_thumbnails') == true) {",
          "",
          "[Removed Lines]",
          "399:                             if (str_contains($upload_image, 'https')) {",
          "",
          "[Added Lines]",
          "399:                             if (str_contains($upload_image, 'http')) {",
          "",
          "---------------"
        ]
      }
    }
  ]
}