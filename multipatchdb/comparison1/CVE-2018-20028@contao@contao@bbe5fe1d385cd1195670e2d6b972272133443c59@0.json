{
  "cve_id": "CVE-2018-20028",
  "cve_desc": "Contao 3.x before 3.5.37, 4.4.x before 4.4.31 and 4.6.x before 4.6.11 has Incorrect Access Control.",
  "repo": "contao/contao",
  "patch_hash": "bbe5fe1d385cd1195670e2d6b972272133443c59",
  "patch_info": {
    "commit_hash": "bbe5fe1d385cd1195670e2d6b972272133443c59",
    "repo": "contao/contao",
    "commit_url": "https://github.com/contao/contao/commit/bbe5fe1d385cd1195670e2d6b972272133443c59",
    "files": [
      "CHANGELOG.md",
      "calendar-bundle/src/Resources/contao/dca/tl_calendar_events.php",
      "calendar-bundle/src/Resources/contao/dca/tl_content.php",
      "core-bundle/src/Resources/contao/dca/tl_article.php",
      "core-bundle/src/Resources/contao/dca/tl_content.php",
      "core-bundle/src/Resources/contao/dca/tl_form_field.php",
      "core-bundle/src/Resources/contao/dca/tl_page.php",
      "core-bundle/src/Resources/contao/drivers/DC_Table.php",
      "news-bundle/src/Resources/contao/dca/tl_content.php",
      "news-bundle/src/Resources/contao/dca/tl_news.php",
      "newsletter-bundle/src/Resources/contao/dca/tl_newsletter.php",
      "newsletter-bundle/src/Resources/contao/dca/tl_newsletter_recipients.php"
    ],
    "message": "Prevent information disclosure through incorrect access control in the back end (see CVE-2018-20028)",
    "before_after_code_files": [
      "calendar-bundle/src/Resources/contao/dca/tl_calendar_events.php||calendar-bundle/src/Resources/contao/dca/tl_calendar_events.php",
      "calendar-bundle/src/Resources/contao/dca/tl_content.php||calendar-bundle/src/Resources/contao/dca/tl_content.php",
      "core-bundle/src/Resources/contao/dca/tl_article.php||core-bundle/src/Resources/contao/dca/tl_article.php",
      "core-bundle/src/Resources/contao/dca/tl_content.php||core-bundle/src/Resources/contao/dca/tl_content.php",
      "core-bundle/src/Resources/contao/dca/tl_form_field.php||core-bundle/src/Resources/contao/dca/tl_form_field.php",
      "core-bundle/src/Resources/contao/dca/tl_page.php||core-bundle/src/Resources/contao/dca/tl_page.php",
      "core-bundle/src/Resources/contao/drivers/DC_Table.php||core-bundle/src/Resources/contao/drivers/DC_Table.php",
      "news-bundle/src/Resources/contao/dca/tl_content.php||news-bundle/src/Resources/contao/dca/tl_content.php",
      "news-bundle/src/Resources/contao/dca/tl_news.php||news-bundle/src/Resources/contao/dca/tl_news.php",
      "newsletter-bundle/src/Resources/contao/dca/tl_newsletter.php||newsletter-bundle/src/Resources/contao/dca/tl_newsletter.php",
      "newsletter-bundle/src/Resources/contao/dca/tl_newsletter_recipients.php||newsletter-bundle/src/Resources/contao/dca/tl_newsletter_recipients.php"
    ]
  },
  "patch_diff": {
    "calendar-bundle/src/Resources/contao/dca/tl_calendar_events.php||calendar-bundle/src/Resources/contao/dca/tl_calendar_events.php": [
      "File: calendar-bundle/src/Resources/contao/dca/tl_calendar_events.php -> calendar-bundle/src/Resources/contao/dca/tl_calendar_events.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "572:   switch (Input::get('act'))",
      "573:   {",
      "574:    case 'paste':",
      "576:     break;",
      "578:    case 'create':",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "575:    case 'select':",
      "576:     if (!\\in_array($id, $root))",
      "577:     {",
      "578:      throw new Contao\\CoreBundle\\Exception\\AccessDeniedException('Not enough permissions to access calendar ID ' . $id . '.');",
      "579:     }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "609:     }",
      "610:     break;",
      "613:    case 'editAll':",
      "614:    case 'deleteAll':",
      "615:    case 'overrideAll':",
      "",
      "[Removed Lines]",
      "612:    case 'select':",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ],
    "calendar-bundle/src/Resources/contao/dca/tl_content.php||calendar-bundle/src/Resources/contao/dca/tl_content.php": [
      "File: calendar-bundle/src/Resources/contao/dca/tl_content.php -> calendar-bundle/src/Resources/contao/dca/tl_content.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "60:   switch (Input::get('act'))",
      "61:   {",
      "66:    case '': // empty",
      "67:    case 'create':",
      "68:    case 'select':",
      "",
      "[Removed Lines]",
      "62:    case 'paste':",
      "64:     break;",
      "",
      "[Added Lines]",
      "63:    case 'paste':",
      "",
      "---------------"
    ],
    "core-bundle/src/Resources/contao/dca/tl_article.php||core-bundle/src/Resources/contao/dca/tl_article.php": [
      "File: core-bundle/src/Resources/contao/dca/tl_article.php -> core-bundle/src/Resources/contao/dca/tl_article.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "376:   $GLOBALS['TL_DCA']['tl_page']['fields']['cgroup']['default'] = (int) Config::get('defaultGroup') ?: (int) $this->User->groups[0];",
      "382:   if (\\is_array($session['CURRENT']['IDS']))",
      "",
      "[Removed Lines]",
      "379:   $GLOBALS['TL_DCA']['tl_page']['list']['sorting']['root'] = $this->User->pagemounts;",
      "",
      "[Added Lines]",
      "379:   if (empty($this->User->pagemounts) || !\\is_array($this->User->pagemounts))",
      "380:   {",
      "381:    $root = array(0);",
      "382:   }",
      "383:   else",
      "384:   {",
      "385:    $root = $this->User->pagemounts;",
      "386:   }",
      "388:   $GLOBALS['TL_DCA']['tl_page']['list']['sorting']['root'] = $root;",
      "",
      "---------------"
    ],
    "core-bundle/src/Resources/contao/dca/tl_content.php||core-bundle/src/Resources/contao/dca/tl_content.php": [
      "File: core-bundle/src/Resources/contao/dca/tl_content.php -> core-bundle/src/Resources/contao/dca/tl_content.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "889:   switch (Input::get('act'))",
      "890:   {",
      "895:    case '': // empty",
      "896:    case 'create':",
      "897:    case 'select':",
      "",
      "[Removed Lines]",
      "891:    case 'paste':",
      "893:     break;",
      "",
      "[Added Lines]",
      "892:    case 'paste':",
      "",
      "---------------"
    ],
    "core-bundle/src/Resources/contao/dca/tl_form_field.php||core-bundle/src/Resources/contao/dca/tl_form_field.php": [
      "File: core-bundle/src/Resources/contao/dca/tl_form_field.php -> core-bundle/src/Resources/contao/dca/tl_form_field.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "462:   switch (Input::get('act'))",
      "463:   {",
      "464:    case 'paste':",
      "466:     break;",
      "468:    case 'create':",
      "470:     if (!\\strlen(Input::get('id')) || !\\in_array(Input::get('id'), $root))",
      "471:     {",
      "472:      throw new Contao\\CoreBundle\\Exception\\AccessDeniedException('Not enough permissions to access form ID ' . Input::get('id') . '.');",
      "",
      "[Removed Lines]",
      "469:    case 'select':",
      "",
      "[Added Lines]",
      "465:    case 'select':",
      "466:     if (!\\in_array($id, $root))",
      "467:     {",
      "468:      throw new Contao\\CoreBundle\\Exception\\AccessDeniedException('Not enough permissions to access form ID ' . $id . '.');",
      "469:     }",
      "",
      "---------------"
    ],
    "core-bundle/src/Resources/contao/dca/tl_page.php||core-bundle/src/Resources/contao/dca/tl_page.php": [
      "File: core-bundle/src/Resources/contao/dca/tl_page.php -> core-bundle/src/Resources/contao/dca/tl_page.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "713:   $GLOBALS['TL_DCA']['tl_page']['fields']['cgroup']['default'] = (int) Config::get('defaultGroup') ?: (int) $this->User->groups[0];",
      "719:   if (\\is_array($session['CURRENT']['IDS']))",
      "",
      "[Removed Lines]",
      "716:   $GLOBALS['TL_DCA']['tl_page']['list']['sorting']['root'] = $this->User->pagemounts;",
      "",
      "[Added Lines]",
      "716:   if (empty($this->User->pagemounts) || !\\is_array($this->User->pagemounts))",
      "717:   {",
      "718:    $root = array(0);",
      "719:   }",
      "720:   else",
      "721:   {",
      "722:    $root = $this->User->pagemounts;",
      "723:   }",
      "725:   $GLOBALS['TL_DCA']['tl_page']['list']['sorting']['root'] = $root;",
      "",
      "---------------"
    ],
    "core-bundle/src/Resources/contao/drivers/DC_Table.php||core-bundle/src/Resources/contao/drivers/DC_Table.php": [
      "File: core-bundle/src/Resources/contao/drivers/DC_Table.php -> core-bundle/src/Resources/contao/drivers/DC_Table.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "230:    elseif (\\is_array($GLOBALS['TL_DCA'][$table]['list']['sorting']['root']))",
      "231:    {",
      "233:    }",
      "234:   }",
      "",
      "[Removed Lines]",
      "232:     $this->root = $this->eliminateNestedPages($GLOBALS['TL_DCA'][$table]['list']['sorting']['root'], $table, $this->Database->fieldExists('sorting', $table));",
      "",
      "[Added Lines]",
      "232:     if ($GLOBALS['TL_DCA'][$table]['list']['sorting']['root'] == array(0))",
      "233:     {",
      "234:      $this->root = array(0);",
      "235:     }",
      "236:     else",
      "237:     {",
      "238:      $this->root = $this->eliminateNestedPages($GLOBALS['TL_DCA'][$table]['list']['sorting']['root'], $table, $this->Database->fieldExists('sorting', $table));",
      "239:     }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "5522:     }",
      "5523:    }",
      "5525:    $objFields = $this->Database->prepare(\"SELECT DISTINCT \" . $what . \" FROM \" . $this->strTable . ((\\is_array($arrProcedure) && \\strlen($arrProcedure[0])) ? ' WHERE ' . implode(' AND ', $arrProcedure) : ''))",
      "5526:           ->execute($arrValues);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "5532:    $table = ($GLOBALS['TL_DCA'][$this->strTable]['list']['sorting']['mode'] == 6) ? $this->ptable : $this->strTable;",
      "5535:    if (isset($GLOBALS['TL_DCA'][$table]['list']['sorting']['root']) && $GLOBALS['TL_DCA'][$table]['list']['sorting']['root'] !== false)",
      "5536:    {",
      "5537:     $arrProcedure[] = \"id IN(\" . implode(',', array_map('\\intval', $GLOBALS['TL_DCA'][$table]['list']['sorting']['root'])) . \")\";",
      "5538:    }",
      "",
      "---------------"
    ],
    "news-bundle/src/Resources/contao/dca/tl_content.php||news-bundle/src/Resources/contao/dca/tl_content.php": [
      "File: news-bundle/src/Resources/contao/dca/tl_content.php -> news-bundle/src/Resources/contao/dca/tl_content.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "60:   switch (Input::get('act'))",
      "61:   {",
      "66:    case '': // empty",
      "67:    case 'create':",
      "68:    case 'select':",
      "",
      "[Removed Lines]",
      "62:    case 'paste':",
      "64:     break;",
      "",
      "[Added Lines]",
      "63:    case 'paste':",
      "",
      "---------------"
    ],
    "news-bundle/src/Resources/contao/dca/tl_news.php||news-bundle/src/Resources/contao/dca/tl_news.php": [
      "File: news-bundle/src/Resources/contao/dca/tl_news.php -> news-bundle/src/Resources/contao/dca/tl_news.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "526:   switch (Input::get('act'))",
      "527:   {",
      "528:    case 'paste':",
      "530:     break;",
      "532:    case 'create':",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "529:    case 'select':",
      "530:     if (!\\in_array($id, $root))",
      "531:     {",
      "532:      throw new Contao\\CoreBundle\\Exception\\AccessDeniedException('Not enough permissions to access news archive ID ' . $id . '.');",
      "533:     }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "582:     }",
      "583:     break;",
      "586:    case 'editAll':",
      "587:    case 'deleteAll':",
      "588:    case 'overrideAll':",
      "",
      "[Removed Lines]",
      "585:    case 'select':",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ],
    "newsletter-bundle/src/Resources/contao/dca/tl_newsletter.php||newsletter-bundle/src/Resources/contao/dca/tl_newsletter.php": [
      "File: newsletter-bundle/src/Resources/contao/dca/tl_newsletter.php -> newsletter-bundle/src/Resources/contao/dca/tl_newsletter.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "309:   {",
      "310:    case 'paste':",
      "311:    case 'select':",
      "313:     break;",
      "315:    case 'create':",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "312:     if (!\\in_array($id, $root))",
      "313:     {",
      "314:      throw new Contao\\CoreBundle\\Exception\\AccessDeniedException('Not enough permissions to access newsletter channel ID ' . $id . '.');",
      "315:     }",
      "",
      "---------------"
    ],
    "newsletter-bundle/src/Resources/contao/dca/tl_newsletter_recipients.php||newsletter-bundle/src/Resources/contao/dca/tl_newsletter_recipients.php": [
      "File: newsletter-bundle/src/Resources/contao/dca/tl_newsletter_recipients.php -> newsletter-bundle/src/Resources/contao/dca/tl_newsletter_recipients.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "237:   {",
      "238:    case 'paste':",
      "239:    case 'select':",
      "241:     break;",
      "243:    case 'create':",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "240:     if (!\\in_array($id, $root))",
      "241:     {",
      "242:      throw new Contao\\CoreBundle\\Exception\\AccessDeniedException('Not enough permissions to access newsletter channel ID ' . $id . '.');",
      "243:     }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "02d9b1b5c360dcc999c56e656b9a107c3a4d8f82",
      "candidate_info": {
        "commit_hash": "02d9b1b5c360dcc999c56e656b9a107c3a4d8f82",
        "repo": "contao/contao",
        "commit_url": "https://github.com/contao/contao/commit/02d9b1b5c360dcc999c56e656b9a107c3a4d8f82",
        "files": [
          "CHANGELOG.md",
          "calendar-bundle/src/Resources/contao/dca/tl_calendar_events.php",
          "core-bundle/src/Resources/contao/dca/tl_form_field.php",
          "news-bundle/src/Resources/contao/dca/tl_news.php",
          "newsletter-bundle/src/Resources/contao/dca/tl_newsletter.php",
          "newsletter-bundle/src/Resources/contao/dca/tl_newsletter_recipients.php"
        ],
        "message": "Correctly check the permission to move child records as non-admin user (see #247)",
        "before_after_code_files": [
          "calendar-bundle/src/Resources/contao/dca/tl_calendar_events.php||calendar-bundle/src/Resources/contao/dca/tl_calendar_events.php",
          "core-bundle/src/Resources/contao/dca/tl_form_field.php||core-bundle/src/Resources/contao/dca/tl_form_field.php",
          "news-bundle/src/Resources/contao/dca/tl_news.php||news-bundle/src/Resources/contao/dca/tl_news.php",
          "newsletter-bundle/src/Resources/contao/dca/tl_newsletter.php||newsletter-bundle/src/Resources/contao/dca/tl_newsletter.php",
          "newsletter-bundle/src/Resources/contao/dca/tl_newsletter_recipients.php||newsletter-bundle/src/Resources/contao/dca/tl_newsletter_recipients.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "calendar-bundle/src/Resources/contao/dca/tl_calendar_events.php||calendar-bundle/src/Resources/contao/dca/tl_calendar_events.php",
            "core-bundle/src/Resources/contao/dca/tl_form_field.php||core-bundle/src/Resources/contao/dca/tl_form_field.php",
            "news-bundle/src/Resources/contao/dca/tl_news.php||news-bundle/src/Resources/contao/dca/tl_news.php",
            "newsletter-bundle/src/Resources/contao/dca/tl_newsletter.php||newsletter-bundle/src/Resources/contao/dca/tl_newsletter.php",
            "newsletter-bundle/src/Resources/contao/dca/tl_newsletter_recipients.php||newsletter-bundle/src/Resources/contao/dca/tl_newsletter_recipients.php"
          ],
          "candidate": [
            "calendar-bundle/src/Resources/contao/dca/tl_calendar_events.php||calendar-bundle/src/Resources/contao/dca/tl_calendar_events.php",
            "core-bundle/src/Resources/contao/dca/tl_form_field.php||core-bundle/src/Resources/contao/dca/tl_form_field.php",
            "news-bundle/src/Resources/contao/dca/tl_news.php||news-bundle/src/Resources/contao/dca/tl_news.php",
            "newsletter-bundle/src/Resources/contao/dca/tl_newsletter.php||newsletter-bundle/src/Resources/contao/dca/tl_newsletter.php",
            "newsletter-bundle/src/Resources/contao/dca/tl_newsletter_recipients.php||newsletter-bundle/src/Resources/contao/dca/tl_newsletter_recipients.php"
          ]
        }
      },
      "candidate_diff": {
        "calendar-bundle/src/Resources/contao/dca/tl_calendar_events.php||calendar-bundle/src/Resources/contao/dca/tl_calendar_events.php": [
          "File: calendar-bundle/src/Resources/contao/dca/tl_calendar_events.php -> calendar-bundle/src/Resources/contao/dca/tl_calendar_events.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "573:   {",
          "574:    case 'paste':",
          "575:    case 'select':",
          "577:     {",
          "578:      throw new Contao\\CoreBundle\\Exception\\AccessDeniedException('Not enough permissions to access calendar ID ' . $id . '.');",
          "579:     }",
          "",
          "[Removed Lines]",
          "576:     if (!\\in_array($id, $root))",
          "",
          "[Added Lines]",
          "576:     if (!\\in_array(CURRENT_ID, $root)) // check CURRENT_ID here (see #247)",
          "",
          "---------------"
        ],
        "core-bundle/src/Resources/contao/dca/tl_form_field.php||core-bundle/src/Resources/contao/dca/tl_form_field.php": [
          "File: core-bundle/src/Resources/contao/dca/tl_form_field.php -> core-bundle/src/Resources/contao/dca/tl_form_field.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "463:   {",
          "464:    case 'paste':",
          "465:    case 'select':",
          "467:     {",
          "468:      throw new Contao\\CoreBundle\\Exception\\AccessDeniedException('Not enough permissions to access form ID ' . $id . '.');",
          "469:     }",
          "",
          "[Removed Lines]",
          "466:     if (!\\in_array($id, $root))",
          "",
          "[Added Lines]",
          "466:     if (!\\in_array(CURRENT_ID, $root)) // check CURRENT_ID here (see #247)",
          "",
          "---------------"
        ],
        "news-bundle/src/Resources/contao/dca/tl_news.php||news-bundle/src/Resources/contao/dca/tl_news.php": [
          "File: news-bundle/src/Resources/contao/dca/tl_news.php -> news-bundle/src/Resources/contao/dca/tl_news.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "527:   {",
          "528:    case 'paste':",
          "529:    case 'select':",
          "531:     {",
          "532:      throw new Contao\\CoreBundle\\Exception\\AccessDeniedException('Not enough permissions to access news archive ID ' . $id . '.');",
          "533:     }",
          "",
          "[Removed Lines]",
          "530:     if (!\\in_array($id, $root))",
          "",
          "[Added Lines]",
          "530:     if (!\\in_array(CURRENT_ID, $root)) // check CURRENT_ID here (see #247)",
          "",
          "---------------"
        ],
        "newsletter-bundle/src/Resources/contao/dca/tl_newsletter.php||newsletter-bundle/src/Resources/contao/dca/tl_newsletter.php": [
          "File: newsletter-bundle/src/Resources/contao/dca/tl_newsletter.php -> newsletter-bundle/src/Resources/contao/dca/tl_newsletter.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "309:   {",
          "310:    case 'paste':",
          "311:    case 'select':",
          "313:     {",
          "314:      throw new Contao\\CoreBundle\\Exception\\AccessDeniedException('Not enough permissions to access newsletter channel ID ' . $id . '.');",
          "315:     }",
          "",
          "[Removed Lines]",
          "312:     if (!\\in_array($id, $root))",
          "",
          "[Added Lines]",
          "312:     if (!\\in_array(CURRENT_ID, $root)) // check CURRENT_ID here (see #247)",
          "",
          "---------------"
        ],
        "newsletter-bundle/src/Resources/contao/dca/tl_newsletter_recipients.php||newsletter-bundle/src/Resources/contao/dca/tl_newsletter_recipients.php": [
          "File: newsletter-bundle/src/Resources/contao/dca/tl_newsletter_recipients.php -> newsletter-bundle/src/Resources/contao/dca/tl_newsletter_recipients.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "237:   {",
          "238:    case 'paste':",
          "239:    case 'select':",
          "241:     {",
          "242:      throw new Contao\\CoreBundle\\Exception\\AccessDeniedException('Not enough permissions to access newsletter channel ID ' . $id . '.');",
          "243:     }",
          "",
          "[Removed Lines]",
          "240:     if (!\\in_array($id, $root))",
          "",
          "[Added Lines]",
          "240:     if (!\\in_array(CURRENT_ID, $root)) // check CURRENT_ID here (see #247)",
          "",
          "---------------"
        ]
      }
    }
  ]
}