{
  "cve_id": "CVE-2021-40828",
  "cve_desc": "Connections initialized by the AWS IoT Device SDK v2 for Java (versions prior to 1.3.3), Python (versions prior to 1.5.18), C++ (versions prior to 1.12.7) and Node.js (versions prior to 1.5.1) did not verify server certificate hostname during TLS handshake when overriding Certificate Authorities (CA) in their trust stores on Windows. This issue has been addressed in aws-c-io submodule versions 0.9.13 onward. This issue affects: Amazon Web Services AWS IoT Device SDK v2 for Java versions prior to 1.3.3 on Microsoft Windows. Amazon Web Services AWS IoT Device SDK v2 for Python versions prior to 1.5.18 on Microsoft Windows. Amazon Web Services AWS IoT Device SDK v2 for C++ versions prior to 1.12.7 on Microsoft Windows. Amazon Web Services AWS IoT Device SDK v2 for Node.js versions prior to 1.5.3 on Microsoft Windows.",
  "repo": "aws/aws-iot-device-sdk-python-v2",
  "patch_hash": "fd4c0ba04b35eab9e20c635af5548fcc5a92d8be",
  "patch_info": {
    "commit_hash": "fd4c0ba04b35eab9e20c635af5548fcc5a92d8be",
    "repo": "aws/aws-iot-device-sdk-python-v2",
    "commit_url": "https://github.com/aws/aws-iot-device-sdk-python-v2/commit/fd4c0ba04b35eab9e20c635af5548fcc5a92d8be",
    "files": [
      "setup.py"
    ],
    "message": "Update to latest CRT (#208)\n\n* On Windows, always perform an SNI check even with an overridden root CA\n* On Windows, properly honor the verify_peer = false option\n* Fix instability with raspberry PI and input stream seeking by doing a better job of modeling file seek offset type and size.",
    "before_after_code_files": [
      "setup.py||setup.py"
    ]
  },
  "patch_diff": {
    "setup.py||setup.py": [
      "File: setup.py -> setup.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "40:         \"Operating System :: OS Independent\",",
      "41:     ],",
      "42:     install_requires=[",
      "44:     ],",
      "45:     python_requires='>=3.6',",
      "46: )",
      "",
      "[Removed Lines]",
      "43:         'awscrt==0.11.20',",
      "",
      "[Added Lines]",
      "43:         'awscrt==0.11.22',",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "5d2ffaaa57ce07be2b5d9260add6b0724e64a183",
      "candidate_info": {
        "commit_hash": "5d2ffaaa57ce07be2b5d9260add6b0724e64a183",
        "repo": "aws/aws-iot-device-sdk-python-v2",
        "commit_url": "https://github.com/aws/aws-iot-device-sdk-python-v2/commit/5d2ffaaa57ce07be2b5d9260add6b0724e64a183",
        "files": [
          "awsiot/eventstreamrpc.py",
          "setup.py"
        ],
        "message": "Fix memory leaks in greengrasscoreipc (#186)\n\n- Update awscrt to fix leaking headers\n- Break circular references in evenstreamrpc so garbage collector can clean them up",
        "before_after_code_files": [
          "awsiot/eventstreamrpc.py||awsiot/eventstreamrpc.py",
          "setup.py||setup.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "setup.py||setup.py"
          ],
          "candidate": [
            "setup.py||setup.py"
          ]
        }
      },
      "candidate_diff": {
        "awsiot/eventstreamrpc.py||awsiot/eventstreamrpc.py": [
          "File: awsiot/eventstreamrpc.py -> awsiot/eventstreamrpc.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "611:         self._closed_future.set_running_or_notify_cancel()  # prevent cancel",
          "612:         self._initial_response_future = Future()",
          "613:         self._initial_response_future.set_running_or_notify_cancel()  # prevent cancel",
          "617:     def _activate(self, request: Shape) -> Future:",
          "618:         headers = [Header.from_string(CONTENT_TYPE_HEADER,",
          "",
          "[Removed Lines]",
          "614:         self._protocol_handler = _ProtocolContinuationHandler(self)",
          "615:         self._continuation = connection._new_stream(self._protocol_handler)",
          "",
          "[Added Lines]",
          "614:         protocol_handler = _ProtocolContinuationHandler(self)",
          "615:         self._continuation = connection._new_stream(protocol_handler)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "806:     def on_continuation_closed(self, *args, **kwargs):",
          "807:         self.operation._on_continuation_closed(*args, **kwargs)",
          "810: class Client:",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "808:         # break circular reference between: ClientOperation, _ProtocolContinuationHandler, ClientContinuation",
          "809:         # so that garbage collector can clean them up",
          "810:         self.operation = None",
          "",
          "---------------"
        ],
        "setup.py||setup.py": [
          "File: setup.py -> setup.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "19:         \"Operating System :: OS Independent\",",
          "20:     ],",
          "21:     install_requires=[",
          "23:     ],",
          "24:     python_requires='>=3.5',",
          "25: )",
          "",
          "[Removed Lines]",
          "22:         'awscrt==0.11.8',",
          "",
          "[Added Lines]",
          "22:         'awscrt==0.11.12',",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "1159294b11c7951851930e534b76d53d80600e46",
      "candidate_info": {
        "commit_hash": "1159294b11c7951851930e534b76d53d80600e46",
        "repo": "aws/aws-iot-device-sdk-python-v2",
        "commit_url": "https://github.com/aws/aws-iot-device-sdk-python-v2/commit/1159294b11c7951851930e534b76d53d80600e46",
        "files": [
          "setup.py"
        ],
        "message": "Update to latest awscrt (#77)",
        "before_after_code_files": [
          "setup.py||setup.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "setup.py||setup.py"
          ],
          "candidate": [
            "setup.py||setup.py"
          ]
        }
      },
      "candidate_diff": {
        "setup.py||setup.py": [
          "File: setup.py -> setup.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "23:     url='https://github.com/aws/aws-iot-device-sdk-python-v2',",
          "24:     packages = ['awsiot'],",
          "25:     install_requires=[",
          "27:         'futures;python_version<\"3.2\"',",
          "28:         'typing;python_version<\"3.5\"',",
          "29:     ],",
          "",
          "[Removed Lines]",
          "26:         'awscrt==0.5.15',",
          "",
          "[Added Lines]",
          "26:         'awscrt==0.6.0',",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "dca78ffdd14de525b3a7a752da02f595b30136a8",
      "candidate_info": {
        "commit_hash": "dca78ffdd14de525b3a7a752da02f595b30136a8",
        "repo": "aws/aws-iot-device-sdk-python-v2",
        "commit_url": "https://github.com/aws/aws-iot-device-sdk-python-v2/commit/dca78ffdd14de525b3a7a752da02f595b30136a8",
        "files": [
          "setup.py"
        ],
        "message": "udpate crt-python to 0.6.2 (#97)\n\nCo-authored-by: Dengke Tang <dengket@amazon.com>",
        "before_after_code_files": [
          "setup.py||setup.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "setup.py||setup.py"
          ],
          "candidate": [
            "setup.py||setup.py"
          ]
        }
      },
      "candidate_diff": {
        "setup.py||setup.py": [
          "File: setup.py -> setup.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "13:     url='https://github.com/aws/aws-iot-device-sdk-python-v2',",
          "14:     packages = ['awsiot'],",
          "15:     install_requires=[",
          "17:         'futures;python_version<\"3.2\"',",
          "18:         'typing;python_version<\"3.5\"',",
          "19:     ],",
          "",
          "[Removed Lines]",
          "16:         'awscrt==0.6.1',",
          "",
          "[Added Lines]",
          "16:         'awscrt==0.6.2',",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "50f33ae0da82019294b558c6096ac24cb04c1046",
      "candidate_info": {
        "commit_hash": "50f33ae0da82019294b558c6096ac24cb04c1046",
        "repo": "aws/aws-iot-device-sdk-python-v2",
        "commit_url": "https://github.com/aws/aws-iot-device-sdk-python-v2/commit/50f33ae0da82019294b558c6096ac24cb04c1046",
        "files": [
          "setup.py"
        ],
        "message": "Dependency update (#231)",
        "before_after_code_files": [
          "setup.py||setup.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "setup.py||setup.py"
          ],
          "candidate": [
            "setup.py||setup.py"
          ]
        }
      },
      "candidate_diff": {
        "setup.py||setup.py": [
          "File: setup.py -> setup.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "40:         \"Operating System :: OS Independent\",",
          "41:     ],",
          "42:     install_requires=[",
          "44:     ],",
          "45:     python_requires='>=3.6',",
          "46: )",
          "",
          "[Removed Lines]",
          "43:         'awscrt==0.12.0',",
          "",
          "[Added Lines]",
          "43:         'awscrt==0.12.1',",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "5aef82573202309063eb540b72cee0e565f85a2d",
      "candidate_info": {
        "commit_hash": "5aef82573202309063eb540b72cee0e565f85a2d",
        "repo": "aws/aws-iot-device-sdk-python-v2",
        "commit_url": "https://github.com/aws/aws-iot-device-sdk-python-v2/commit/5aef82573202309063eb540b72cee0e565f85a2d",
        "files": [
          "setup.py"
        ],
        "message": "Fix CA override functions (#223)\n\nUpdate to awscrt 0.12.0. This fixes the issue where \"override_default_trust_store\" functions did not actually override the system trust store on Linux and Apple platforms.",
        "before_after_code_files": [
          "setup.py||setup.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "setup.py||setup.py"
          ],
          "candidate": [
            "setup.py||setup.py"
          ]
        }
      },
      "candidate_diff": {
        "setup.py||setup.py": [
          "File: setup.py -> setup.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "40:         \"Operating System :: OS Independent\",",
          "41:     ],",
          "42:     install_requires=[",
          "44:     ],",
          "45:     python_requires='>=3.6',",
          "46: )",
          "",
          "[Removed Lines]",
          "43:         'awscrt==0.11.25',",
          "",
          "[Added Lines]",
          "43:         'awscrt==0.12.0',",
          "",
          "---------------"
        ]
      }
    }
  ]
}