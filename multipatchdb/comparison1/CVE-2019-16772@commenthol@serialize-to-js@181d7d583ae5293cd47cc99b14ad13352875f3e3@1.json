{
  "cve_id": "CVE-2019-16772",
  "cve_desc": "The serialize-to-js NPM package before version 3.0.1 is vulnerable to Cross-site Scripting (XSS). It does not properly mitigate against unsafe characters in serialized regular expressions. This vulnerability is not affected on Node.js environment since Node.js's implementation of RegExp.prototype.toString() backslash-escapes all forward slashes in regular expressions. If serialized data of regular expression objects are used in an environment other than Node.js, it is affected by this vulnerability.",
  "repo": "commenthol/serialize-to-js",
  "patch_hash": "181d7d583ae5293cd47cc99b14ad13352875f3e3",
  "patch_info": {
    "commit_hash": "181d7d583ae5293cd47cc99b14ad13352875f3e3",
    "repo": "commenthol/serialize-to-js",
    "commit_url": "https://github.com/commenthol/serialize-to-js/commit/181d7d583ae5293cd47cc99b14ad13352875f3e3",
    "files": [
      "lib/index.js",
      "test/fixtures.js"
    ],
    "message": "fix: for ghsa-3fjq-93xj-3f3f",
    "before_after_code_files": [
      "lib/index.js||lib/index.js",
      "test/fixtures.js||test/fixtures.js"
    ]
  },
  "patch_diff": {
    "lib/index.js||lib/index.js": [
      "File: lib/index.js -> lib/index.js",
      "--- Hunk 1 ---",
      "[Context before]",
      "75:     out += !/^\\s*(function|\\([^)]*\\)\\s*=>)/m.test(tmp) ? 'function ' + tmp : tmp",
      "76:   } else if (util.isObject(source)) {",
      "77:     if (util.isRegExp(source)) {",
      "79:     } else if (util.isDate(source)) {",
      "80:       out += 'new Date(\"' + source.toJSON() + '\")'",
      "81:     } else if (util.isError(source)) {",
      "",
      "[Removed Lines]",
      "78:       out += source.toString()",
      "",
      "[Added Lines]",
      "78:       out += 'new RegExp(\"' + source.source + '\", \"' + source.flags + '\")'",
      "",
      "---------------"
    ],
    "test/fixtures.js||test/fixtures.js": [
      "File: test/fixtures.js -> test/fixtures.js",
      "--- Hunk 1 ---",
      "[Context before]",
      "33:   ],",
      "34:   'regex': [",
      "35:     /test(?:it)?/ig,",
      "37:   ],",
      "38:   'object': [",
      "39:     { a: 1, b: 2 },",
      "",
      "[Removed Lines]",
      "36:     '/test(?:it)?/gi'",
      "",
      "[Added Lines]",
      "36:     'new RegExp(\"test(?:it)?\", \"gi\")'",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "138:     new Float64Array([1e12, 2000000, 3.1415, -4.9e2, 5]),",
      "139:     'new Float64Array([1000000000000, 2000000, 3.1415, -490, 5])',",
      "140:     'toString'",
      "141:   ]",
      "142: }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "141:   ],",
      "142:   'regexXss': [",
      "143:     /[</script><script>alert('xss')//]/i,",
      "144:     'new RegExp(\"[</script><script>alert(\\'xss\\')//]\", \"i\")'",
      "145:   ],",
      "146:   'regex no flags': [",
      "147:     /abc/,",
      "148:     'new RegExp(\"abc\", \"\")'",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "8d164439edd043fbebeb7a7e486a404606236068",
      "candidate_info": {
        "commit_hash": "8d164439edd043fbebeb7a7e486a404606236068",
        "repo": "commenthol/serialize-to-js",
        "commit_url": "https://github.com/commenthol/serialize-to-js/commit/8d164439edd043fbebeb7a7e486a404606236068",
        "files": [
          ".travis.yml",
          "Makefile",
          "test/fixtures.js"
        ],
        "message": "chore: fix tests for node<12",
        "before_after_code_files": [
          "test/fixtures.js||test/fixtures.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "test/fixtures.js||test/fixtures.js"
          ],
          "candidate": [
            "test/fixtures.js||test/fixtures.js"
          ]
        }
      },
      "candidate_diff": {
        "test/fixtures.js||test/fixtures.js": [
          "File: test/fixtures.js -> test/fixtures.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "6:   console.log(JSON.stringify(arg))",
          "7: }",
          "9: module.exports = {",
          "10:   'string': [",
          "11:     \"string's\\n\\\"new\\\"   line\",",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "9: const isLessV13 = parseInt(process.versions.node.split('.')[0]) < 12",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "141:   ],",
          "142:   'regexXss': [",
          "143:     /[</script><script>alert('xss')//]/i,",
          "145:   ],",
          "146:   'regex no flags': [",
          "147:     /abc/,",
          "",
          "[Removed Lines]",
          "144:     'new RegExp(\"[</script><script>alert(\\'xss\\')//]\", \"i\")'",
          "",
          "[Added Lines]",
          "146:     isLessV13",
          "147:       ? 'new RegExp(\"[<\\\\/script><script>alert(\\'xss\\')\\\\/\\\\/]\", \"i\")'",
          "148:       : 'new RegExp(\"[</script><script>alert(\\'xss\\')//]\", \"i\")'",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "090b14b3382640071df597530a30c435e857cafd",
      "candidate_info": {
        "commit_hash": "090b14b3382640071df597530a30c435e857cafd",
        "repo": "commenthol/serialize-to-js",
        "commit_url": "https://github.com/commenthol/serialize-to-js/commit/090b14b3382640071df597530a30c435e857cafd",
        "files": [
          "lib/index.js",
          "test/fixtures.js"
        ],
        "message": "Escape unsafe characters in messages of error objects.",
        "before_after_code_files": [
          "lib/index.js||lib/index.js",
          "test/fixtures.js||test/fixtures.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "lib/index.js||lib/index.js",
            "test/fixtures.js||test/fixtures.js"
          ],
          "candidate": [
            "lib/index.js||lib/index.js",
            "test/fixtures.js||test/fixtures.js"
          ]
        }
      },
      "candidate_diff": {
        "lib/index.js||lib/index.js": [
          "File: lib/index.js -> lib/index.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "79:     } else if (util.isDate(source)) {",
          "80:       out += 'new Date(\"' + source.toJSON() + '\")'",
          "81:     } else if (util.isError(source)) {",
          "83:     } else if (util.isBuffer(source)) {",
          "",
          "[Removed Lines]",
          "82:       out += 'new Error(' + (source.message ? '\"' + source.message + '\"' : '') + ')'",
          "",
          "[Added Lines]",
          "82:       out += 'new Error(' + (source.message ? serialize(source.message) : '') + ')'",
          "",
          "---------------"
        ],
        "test/fixtures.js||test/fixtures.js": [
          "File: test/fixtures.js -> test/fixtures.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "156:   'regex no flags': [",
          "157:     /abc/,",
          "158:     'new RegExp(\"abc\", \"\")'",
          "159:   ]",
          "160: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "159:   ],",
          "160:   'error with unsafe message': [",
          "161:     new Error(\"</script><script>alert('xss')\"),",
          "162:     'new Error(\"\\\\u003C\\\\u002Fscript\\\\u003E\\\\u003Cscript\\\\u003Ealert(\\'xss\\')\")'",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "431734b4a4e23e2cc76e6b9a2dedf2f34b70175b",
      "candidate_info": {
        "commit_hash": "431734b4a4e23e2cc76e6b9a2dedf2f34b70175b",
        "repo": "commenthol/serialize-to-js",
        "commit_url": "https://github.com/commenthol/serialize-to-js/commit/431734b4a4e23e2cc76e6b9a2dedf2f34b70175b",
        "files": [
          ".eslintignore",
          ".gitignore",
          "README.md",
          "package.json",
          "src/index.js",
          "test/fixtures.js",
          "test/index.test.js"
        ],
        "message": "chore: babel transpile",
        "before_after_code_files": [
          "src/index.js||src/index.js",
          "test/fixtures.js||test/fixtures.js",
          "test/index.test.js||test/index.test.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "test/fixtures.js||test/fixtures.js"
          ],
          "candidate": [
            "test/fixtures.js||test/fixtures.js"
          ]
        }
      },
      "candidate_diff": {
        "src/index.js||src/index.js": [
          "File: src/index.js -> src/index.js"
        ],
        "test/fixtures.js||test/fixtures.js": [
          "File: test/fixtures.js -> test/fixtures.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "134:   regexXss: [",
          "135:     /[</script><script>alert('xss')//]/i,",
          "136:     isLessV12",
          "138:       : 'new RegExp(\"[\\\\u003C\\\\u002Fscript\\\\u003E\\\\u003Cscript\\\\u003Ealert(\\'xss\\')\\\\u002F\\\\u002F]\", \"i\")',",
          "140:     isLessV12",
          "142:       : 'new RegExp(\"[</script><script>alert(\\'xss\\')//]\", \"i\")'",
          "143:   ],",
          "144:   regexXss2: [",
          "145:     /[</ script><script>alert('xss')//]/i,",
          "146:     isLessV12",
          "148:       : 'new RegExp(\"[\\\\u003C\\\\u002F script\\\\u003E\\\\u003Cscript\\\\u003Ealert(\\'xss\\')\\\\u002F\\\\u002F]\", \"i\")',",
          "150:     isLessV12",
          "152:       : 'new RegExp(\"[</ script><script>alert(\\'xss\\')//]\", \"i\")'",
          "153:   ],",
          "154:   'regex no flags': [",
          "",
          "[Removed Lines]",
          "137:       ? `new RegExp(\"[\\\\u003C\\\\u005C\\\\u002Fscript\\\\u003E\\\\u003Cscript\\\\u003Ealert('xss')\\\\u005C\\\\u002F\\\\u005C\\\\u002F]\", \"i\")`",
          "141:       ? `new RegExp(\"[<\\\\u005C/script><script>alert('xss')\\\\u005C/\\\\u005C/]\", \"i\")`",
          "147:       ? `new RegExp(\"[\\\\u003C\\\\u005C\\\\u002F script\\\\u003E\\\\u003Cscript\\\\u003Ealert('xss')\\\\u005C\\\\u002F\\\\u005C\\\\u002F]\", \"i\")`",
          "151:       ? `new RegExp(\"[<\\\\u005C/ script><script>alert('xss')\\\\u005C/\\\\u005C/]\", \"i\")`",
          "",
          "[Added Lines]",
          "137:       ? 'new RegExp(\"[\\\\u003C\\\\u005C\\\\u002Fscript\\\\u003E\\\\u003Cscript\\\\u003Ealert(\\'xss\\')\\\\u005C\\\\u002F\\\\u005C\\\\u002F]\", \"i\")'",
          "141:       ? 'new RegExp(\"[<\\\\u005C/script><script>alert(\\'xss\\')\\\\u005C/\\\\u005C/]\", \"i\")'",
          "147:       ? 'new RegExp(\"[\\\\u003C\\\\u005C\\\\u002F script\\\\u003E\\\\u003Cscript\\\\u003Ealert(\\'xss\\')\\\\u005C\\\\u002F\\\\u005C\\\\u002F]\", \"i\")'",
          "151:       ? 'new RegExp(\"[<\\\\u005C/ script><script>alert(\\'xss\\')\\\\u005C/\\\\u005C/]\", \"i\")'",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "165:     { \"</script><script>alert('xss')//\": 0 },",
          "166:     '{\"\\\\u003C\\\\u002Fscript\\\\u003E\\\\u003Cscript\\\\u003Ealert(\\'xss\\')\\\\u002F\\\\u002F\": 0}',",
          "169:   ],",
          "170:   'object with backslash-escaped quote in property name': [",
          "171:     { '\\\\\": 0}; alert(\\'xss\\')//': 0 },",
          "175:   ]",
          "176: }",
          "",
          "[Removed Lines]",
          "168:     `{\"</script><script>alert('xss')//\": 0}`",
          "172:     `{\"\\\\u005C\\\\\": 0}; alert('xss')\\\\u002F\\\\u002F\": 0}`,",
          "174:     `{\"\\\\u005C\\\\\": 0}; alert('xss')//\": 0}`",
          "",
          "[Added Lines]",
          "168:     '{\"</script><script>alert(\\'xss\\')//\": 0}'",
          "172:     '{\"\\\\u005C\\\\\": 0}; alert(\\'xss\\')\\\\u002F\\\\u002F\": 0}',",
          "174:     '{\"\\\\u005C\\\\\": 0}; alert(\\'xss\\')//\": 0}'",
          "",
          "---------------"
        ],
        "test/index.test.js||test/index.test.js": [
          "File: test/index.test.js -> test/index.test.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "156:         .replace(/function xss\\(\\)/, 'function xss ()') // node v8 has no space before brackets",
          "157:       assert.strictEqual(res,",
          "158:         'function xss () {\\n' +",
          "161:         ' return o\\n' +",
          "162:         ' }'",
          "163:       )",
          "",
          "[Removed Lines]",
          "159:         ` const str = '\\\\u003C\\\\u002Fscript>\\\\u003Cscript>alert(\\\\'xss\\\\')//'\\n` +",
          "160:         ` const o = { '\\\\\\\\\": 0}; alert(\\\\'xss\\\\')//': 0, str }\\n` +",
          "",
          "[Added Lines]",
          "158:         ' const str = \\'\\\\u003C\\\\u002Fscript>\\\\u003Cscript>alert(\\\\\\'xss\\\\\\')//\\'\\n' +",
          "159:         ' const o = { \\'\\\\\\\\\": 0}; alert(\\\\\\'xss\\\\\\')//\\': 0, str }\\n' +",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "eac045c9409d814acbe223717b279c71a38ad679",
      "candidate_info": {
        "commit_hash": "eac045c9409d814acbe223717b279c71a38ad679",
        "repo": "commenthol/serialize-to-js",
        "commit_url": "https://github.com/commenthol/serialize-to-js/commit/eac045c9409d814acbe223717b279c71a38ad679",
        "files": [
          "lib/index.js",
          "test/fixtures.js"
        ],
        "message": "fix: now a bit saver",
        "before_after_code_files": [
          "lib/index.js||lib/index.js",
          "test/fixtures.js||test/fixtures.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "lib/index.js||lib/index.js",
            "test/fixtures.js||test/fixtures.js"
          ],
          "candidate": [
            "lib/index.js||lib/index.js",
            "test/fixtures.js||test/fixtures.js"
          ]
        }
      },
      "candidate_diff": {
        "lib/index.js||lib/index.js": [
          "File: lib/index.js -> lib/index.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "75:     out += !/^\\s*(function|\\([^)]*\\)\\s*=>)/m.test(tmp) ? 'function ' + tmp : tmp",
          "76:   } else if (util.isObject(source)) {",
          "77:     if (util.isRegExp(source)) {",
          "79:     } else if (util.isDate(source)) {",
          "80:       out += 'new Date(\"' + source.toJSON() + '\")'",
          "81:     } else if (util.isError(source)) {",
          "",
          "[Removed Lines]",
          "78:       out += 'new RegExp(\"' + source.source + '\", \"' + source.flags + '\")'",
          "",
          "[Added Lines]",
          "78:       out += 'new RegExp(\"' + source.source.replace(/<\\/script/ig, '<\\\\/script') + '\", \"' + source.flags + '\")'",
          "",
          "---------------"
        ],
        "test/fixtures.js||test/fixtures.js": [
          "File: test/fixtures.js -> test/fixtures.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "145:     /[</script><script>alert('xss')//]/i,",
          "146:     isLessV12",
          "147:       ? 'new RegExp(\"[<\\\\/script><script>alert(\\'xss\\')\\\\/\\\\/]\", \"i\")'",
          "149:   ],",
          "150:   'regex no flags': [",
          "151:     /abc/,",
          "",
          "[Removed Lines]",
          "148:       : 'new RegExp(\"[</script><script>alert(\\'xss\\')//]\", \"i\")'",
          "",
          "[Added Lines]",
          "148:       : 'new RegExp(\"[<\\\\/script><script>alert(\\'xss\\')//]\", \"i\")'",
          "",
          "---------------"
        ]
      }
    }
  ]
}