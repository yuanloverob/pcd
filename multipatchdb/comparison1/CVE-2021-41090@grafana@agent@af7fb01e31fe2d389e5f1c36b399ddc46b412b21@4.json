{
  "cve_id": "CVE-2021-41090",
  "cve_desc": "Grafana Agent is a telemetry collector for sending metrics, logs, and trace data to the opinionated Grafana observability stack. Prior to versions 0.20.1 and 0.21.2, inline secrets defined within a metrics instance config are exposed in plaintext over two endpoints: metrics instance configs defined in the base YAML file are exposed at `/-/config` and metrics instance configs defined for the scraping service are exposed at `/agent/api/v1/configs/:key`. Inline secrets will be exposed to anyone being able to reach these endpoints. If HTTPS with client authentication is not configured, these endpoints are accessible to unauthenticated users. Secrets found in these sections are used for delivering metrics to a Prometheus Remote Write system, authenticating against a system for discovering Prometheus targets, and authenticating against a system for collecting metrics. This does not apply for non-inlined secrets, such as `*_file` based secrets. This issue is patched in Grafana Agent versions 0.20.1 and 0.21.2. A few workarounds are available. Users who cannot upgrade should use non-inline secrets where possible. Users may also desire to restrict API access to Grafana Agent with some combination of restricting the network interfaces Grafana Agent listens on through `http_listen_address` in the `server` block, configuring Grafana Agent to use HTTPS with client authentication, and/or using firewall rules to restrict external access to Grafana Agent's API.",
  "repo": "grafana/agent",
  "patch_hash": "af7fb01e31fe2d389e5f1c36b399ddc46b412b21",
  "patch_info": {
    "commit_hash": "af7fb01e31fe2d389e5f1c36b399ddc46b412b21",
    "repo": "grafana/agent",
    "commit_url": "https://github.com/grafana/agent/commit/af7fb01e31fe2d389e5f1c36b399ddc46b412b21",
    "files": [
      "CHANGELOG.md",
      "docs/configuration/integrations/node-exporter-config.md",
      "docs/configuration/integrations/process-exporter-config.md",
      "docs/getting-started/_index.md",
      "docs/operator/custom-resource-quickstart.md",
      "docs/operator/getting-started.md",
      "docs/upgrade-guide/_index.md",
      "pkg/operator/defaults.go",
      "production/README.md",
      "production/grafanacloud-install.sh",
      "production/kubernetes/agent-bare.yaml",
      "production/kubernetes/agent-loki.yaml",
      "production/kubernetes/agent-traces.yaml",
      "production/kubernetes/build/lib/version.libsonnet",
      "production/kubernetes/install-bare.sh",
      "production/tanka/grafana-agent/v1/main.libsonnet",
      "production/tanka/grafana-agent/v2/internal/base.libsonnet",
      "production/tanka/grafana-agent/v2/internal/syncer.libsonnet"
    ],
    "message": "announce patch releases for cve-2021-41090 (#1152)",
    "before_after_code_files": [
      "pkg/operator/defaults.go||pkg/operator/defaults.go",
      "production/grafanacloud-install.sh||production/grafanacloud-install.sh",
      "production/kubernetes/build/lib/version.libsonnet||production/kubernetes/build/lib/version.libsonnet",
      "production/kubernetes/install-bare.sh||production/kubernetes/install-bare.sh",
      "production/tanka/grafana-agent/v1/main.libsonnet||production/tanka/grafana-agent/v1/main.libsonnet",
      "production/tanka/grafana-agent/v2/internal/base.libsonnet||production/tanka/grafana-agent/v2/internal/base.libsonnet",
      "production/tanka/grafana-agent/v2/internal/syncer.libsonnet||production/tanka/grafana-agent/v2/internal/syncer.libsonnet"
    ]
  },
  "patch_diff": {
    "pkg/operator/defaults.go||pkg/operator/defaults.go": [
      "File: pkg/operator/defaults.go -> pkg/operator/defaults.go",
      "--- Hunk 1 ---",
      "[Context before]",
      "15:   \"v0.18.4\",",
      "16:   \"v0.19.0\",",
      "17:   \"v0.20.0\",",
      "18:   \"v0.21.0\",",
      "19:   \"v0.21.1\",",
      "22:  }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "18:   \"v0.20.1\",",
      "21:   \"v0.21.2\",",
      "",
      "---------------"
    ],
    "production/grafanacloud-install.sh||production/grafanacloud-install.sh": [
      "File: production/grafanacloud-install.sh -> production/grafanacloud-install.sh",
      "--- Hunk 1 ---",
      "[Context before]",
      "50: #",
      "51: # Global constants.",
      "52: #",
      "55: RELEASE_URL=\"https://github.com/grafana/agent/releases/download/v${RELEASE_VERSION}\"",
      "56: DEB_URL=\"${RELEASE_URL}/grafana-agent-${RELEASE_VERSION}-1.${ARCH}.deb\"",
      "",
      "[Removed Lines]",
      "53: RELEASE_VERSION=\"0.21.1\"",
      "",
      "[Added Lines]",
      "53: RELEASE_VERSION=\"0.21.2\"",
      "",
      "---------------"
    ],
    "production/kubernetes/build/lib/version.libsonnet||production/kubernetes/build/lib/version.libsonnet": [
      "File: production/kubernetes/build/lib/version.libsonnet -> production/kubernetes/build/lib/version.libsonnet",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "1: 'grafana/agent:v0.21.1'",
      "",
      "[Added Lines]",
      "1: 'grafana/agent:v0.21.2'",
      "",
      "---------------"
    ],
    "production/kubernetes/install-bare.sh||production/kubernetes/install-bare.sh": [
      "File: production/kubernetes/install-bare.sh -> production/kubernetes/install-bare.sh",
      "--- Hunk 1 ---",
      "[Context before]",
      "25: check_installed curl",
      "26: check_installed envsubst",
      "29: MANIFEST_URL=${MANIFEST_URL:-https://raw.githubusercontent.com/grafana/agent/${MANIFEST_BRANCH}/production/kubernetes/agent-bare.yaml}",
      "30: NAMESPACE=${NAMESPACE:-default}",
      "",
      "[Removed Lines]",
      "28: MANIFEST_BRANCH=v0.21.1",
      "",
      "[Added Lines]",
      "28: MANIFEST_BRANCH=v0.21.2",
      "",
      "---------------"
    ],
    "production/tanka/grafana-agent/v1/main.libsonnet||production/tanka/grafana-agent/v1/main.libsonnet": [
      "File: production/tanka/grafana-agent/v1/main.libsonnet -> production/tanka/grafana-agent/v1/main.libsonnet",
      "--- Hunk 1 ---",
      "[Context before]",
      "15: (import './lib/traces.libsonnet') +",
      "16: {",
      "17:   _images:: {",
      "20:   },",
      "",
      "[Removed Lines]",
      "18:     agent: 'grafana/agent:v0.21.1',",
      "19:     agentctl: 'grafana/agentctl:v0.21.1',",
      "",
      "[Added Lines]",
      "18:     agent: 'grafana/agent:v0.21.2',",
      "19:     agentctl: 'grafana/agentctl:v0.21.2',",
      "",
      "---------------"
    ],
    "production/tanka/grafana-agent/v2/internal/base.libsonnet||production/tanka/grafana-agent/v2/internal/base.libsonnet": [
      "File: production/tanka/grafana-agent/v2/internal/base.libsonnet -> production/tanka/grafana-agent/v2/internal/base.libsonnet",
      "--- Hunk 1 ---",
      "[Context before]",
      "10:   local this = self,",
      "12:   _images:: {",
      "15:   },",
      "16:   _config:: {",
      "17:     name: name,",
      "",
      "[Removed Lines]",
      "13:     agent: 'grafana/agent:v0.21.1',",
      "14:     agentctl: 'grafana/agentctl:v0.21.1',",
      "",
      "[Added Lines]",
      "13:     agent: 'grafana/agent:v0.21.2',",
      "14:     agentctl: 'grafana/agentctl:v0.21.2',",
      "",
      "---------------"
    ],
    "production/tanka/grafana-agent/v2/internal/syncer.libsonnet||production/tanka/grafana-agent/v2/internal/syncer.libsonnet": [
      "File: production/tanka/grafana-agent/v2/internal/syncer.libsonnet -> production/tanka/grafana-agent/v2/internal/syncer.libsonnet",
      "--- Hunk 1 ---",
      "[Context before]",
      "14: ) {",
      "15:   local _config = {",
      "16:     api: error 'api must be set',",
      "18:     schedule: '*/5 * * * *',",
      "19:     configs: [],",
      "20:   } + config,",
      "",
      "[Removed Lines]",
      "17:     image: 'grafana/agentctl:v0.21.1',",
      "",
      "[Added Lines]",
      "17:     image: 'grafana/agentctl:v0.21.2',",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "12a17b50836f3ddd0428dffdd5fae8b7da1b41b4",
      "candidate_info": {
        "commit_hash": "12a17b50836f3ddd0428dffdd5fae8b7da1b41b4",
        "repo": "grafana/agent",
        "commit_url": "https://github.com/grafana/agent/commit/12a17b50836f3ddd0428dffdd5fae8b7da1b41b4",
        "files": [
          "CHANGELOG.md",
          "Makefile",
          "docs/sources/configuration/integrations/node-exporter-config.md",
          "docs/sources/configuration/integrations/process-exporter-config.md",
          "docs/sources/operator/custom-resource-quickstart.md",
          "docs/sources/operator/getting-started.md",
          "docs/sources/set-up/install-agent-docker.md",
          "pkg/operator/defaults.go",
          "production/grafanacloud-install.sh",
          "production/kubernetes/agent-bare.yaml",
          "production/kubernetes/agent-loki.yaml",
          "production/kubernetes/agent-traces.yaml",
          "production/kubernetes/build/lib/version.libsonnet",
          "production/kubernetes/install-bare.sh",
          "production/tanka/grafana-agent/v1/main.libsonnet",
          "production/tanka/grafana-agent/v2/internal/base.libsonnet",
          "production/tanka/grafana-agent/v2/internal/syncer.libsonnet",
          "tools/release-note.md"
        ],
        "message": "merger changelog, references and makefile changes from 26 to main (#1919)\n\n* Update main to v0.26\n\n* Update changes to makefile\n\n* merge error",
        "before_after_code_files": [
          "pkg/operator/defaults.go||pkg/operator/defaults.go",
          "production/grafanacloud-install.sh||production/grafanacloud-install.sh",
          "production/kubernetes/build/lib/version.libsonnet||production/kubernetes/build/lib/version.libsonnet",
          "production/kubernetes/install-bare.sh||production/kubernetes/install-bare.sh",
          "production/tanka/grafana-agent/v1/main.libsonnet||production/tanka/grafana-agent/v1/main.libsonnet",
          "production/tanka/grafana-agent/v2/internal/base.libsonnet||production/tanka/grafana-agent/v2/internal/base.libsonnet",
          "production/tanka/grafana-agent/v2/internal/syncer.libsonnet||production/tanka/grafana-agent/v2/internal/syncer.libsonnet"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "pkg/operator/defaults.go||pkg/operator/defaults.go",
            "production/grafanacloud-install.sh||production/grafanacloud-install.sh",
            "production/kubernetes/build/lib/version.libsonnet||production/kubernetes/build/lib/version.libsonnet",
            "production/kubernetes/install-bare.sh||production/kubernetes/install-bare.sh",
            "production/tanka/grafana-agent/v1/main.libsonnet||production/tanka/grafana-agent/v1/main.libsonnet",
            "production/tanka/grafana-agent/v2/internal/base.libsonnet||production/tanka/grafana-agent/v2/internal/base.libsonnet",
            "production/tanka/grafana-agent/v2/internal/syncer.libsonnet||production/tanka/grafana-agent/v2/internal/syncer.libsonnet"
          ],
          "candidate": [
            "pkg/operator/defaults.go||pkg/operator/defaults.go",
            "production/grafanacloud-install.sh||production/grafanacloud-install.sh",
            "production/kubernetes/build/lib/version.libsonnet||production/kubernetes/build/lib/version.libsonnet",
            "production/kubernetes/install-bare.sh||production/kubernetes/install-bare.sh",
            "production/tanka/grafana-agent/v1/main.libsonnet||production/tanka/grafana-agent/v1/main.libsonnet",
            "production/tanka/grafana-agent/v2/internal/base.libsonnet||production/tanka/grafana-agent/v2/internal/base.libsonnet",
            "production/tanka/grafana-agent/v2/internal/syncer.libsonnet||production/tanka/grafana-agent/v2/internal/syncer.libsonnet"
          ]
        }
      },
      "candidate_diff": {
        "pkg/operator/defaults.go||pkg/operator/defaults.go": [
          "File: pkg/operator/defaults.go -> pkg/operator/defaults.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "26:   \"v0.24.2\",",
          "27:   \"v0.25.0\",",
          "28:   \"v0.25.1\",",
          "31:  }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "29:   \"v0.26.0\",",
          "",
          "---------------"
        ],
        "production/grafanacloud-install.sh||production/grafanacloud-install.sh": [
          "File: production/grafanacloud-install.sh -> production/grafanacloud-install.sh",
          "--- Hunk 1 ---",
          "[Context before]",
          "50: #",
          "51: # Global constants.",
          "52: #",
          "55: RELEASE_URL=\"https://github.com/grafana/agent/releases/download/v${RELEASE_VERSION}\"",
          "56: DEB_URL=\"${RELEASE_URL}/grafana-agent-${RELEASE_VERSION}-1.${ARCH}.deb\"",
          "",
          "[Removed Lines]",
          "53: RELEASE_VERSION=\"0.25.1\"",
          "",
          "[Added Lines]",
          "53: RELEASE_VERSION=\"0.26.0\"",
          "",
          "---------------"
        ],
        "production/kubernetes/build/lib/version.libsonnet||production/kubernetes/build/lib/version.libsonnet": [
          "File: production/kubernetes/build/lib/version.libsonnet -> production/kubernetes/build/lib/version.libsonnet",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: 'grafana/agent:v0.25.1'",
          "",
          "[Added Lines]",
          "1: 'grafana/agent:v0.26.0'",
          "",
          "---------------"
        ],
        "production/kubernetes/install-bare.sh||production/kubernetes/install-bare.sh": [
          "File: production/kubernetes/install-bare.sh -> production/kubernetes/install-bare.sh",
          "--- Hunk 1 ---",
          "[Context before]",
          "25: check_installed curl",
          "26: check_installed envsubst",
          "29: MANIFEST_URL=${MANIFEST_URL:-https://raw.githubusercontent.com/grafana/agent/${MANIFEST_BRANCH}/production/kubernetes/agent-bare.yaml}",
          "30: NAMESPACE=${NAMESPACE:-default}",
          "",
          "[Removed Lines]",
          "28: MANIFEST_BRANCH=v0.25.1",
          "",
          "[Added Lines]",
          "28: MANIFEST_BRANCH=v0.26.0",
          "",
          "---------------"
        ],
        "production/tanka/grafana-agent/v1/main.libsonnet||production/tanka/grafana-agent/v1/main.libsonnet": [
          "File: production/tanka/grafana-agent/v1/main.libsonnet -> production/tanka/grafana-agent/v1/main.libsonnet",
          "--- Hunk 1 ---",
          "[Context before]",
          "15: (import './lib/traces.libsonnet') +",
          "16: {",
          "17:   _images:: {",
          "20:   },",
          "",
          "[Removed Lines]",
          "18:     agent: 'grafana/agent:v0.25.1',",
          "19:     agentctl: 'grafana/agentctl:v0.25.1',",
          "",
          "[Added Lines]",
          "18:     agent: 'grafana/agent:v0.26.0',",
          "19:     agentctl: 'grafana/agentctl:v0.26.0',",
          "",
          "---------------"
        ],
        "production/tanka/grafana-agent/v2/internal/base.libsonnet||production/tanka/grafana-agent/v2/internal/base.libsonnet": [
          "File: production/tanka/grafana-agent/v2/internal/base.libsonnet -> production/tanka/grafana-agent/v2/internal/base.libsonnet",
          "--- Hunk 1 ---",
          "[Context before]",
          "11:   local this = self,",
          "13:   _images:: {",
          "16:   },",
          "17:   _config:: {",
          "18:     name: name,",
          "",
          "[Removed Lines]",
          "14:     agent: 'grafana/agent:v0.25.1',",
          "15:     agentctl: 'grafana/agentctl:v0.25.1',",
          "",
          "[Added Lines]",
          "14:     agent: 'grafana/agent:v0.26.0',",
          "15:     agentctl: 'grafana/agentctl:v0.26.0',",
          "",
          "---------------"
        ],
        "production/tanka/grafana-agent/v2/internal/syncer.libsonnet||production/tanka/grafana-agent/v2/internal/syncer.libsonnet": [
          "File: production/tanka/grafana-agent/v2/internal/syncer.libsonnet -> production/tanka/grafana-agent/v2/internal/syncer.libsonnet",
          "--- Hunk 1 ---",
          "[Context before]",
          "14: ) {",
          "15:   local _config = {",
          "16:     api: error 'api must be set',",
          "18:     schedule: '*/5 * * * *',",
          "19:     configs: [],",
          "20:   } + config,",
          "",
          "[Removed Lines]",
          "17:     image: 'grafana/agentctl:v0.25.1',",
          "",
          "[Added Lines]",
          "17:     image: 'grafana/agentctl:v0.26.0',",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "c97c8e10d1afe256f3fa2002e42063a903d96952",
      "candidate_info": {
        "commit_hash": "c97c8e10d1afe256f3fa2002e42063a903d96952",
        "repo": "grafana/agent",
        "commit_url": "https://github.com/grafana/agent/commit/c97c8e10d1afe256f3fa2002e42063a903d96952",
        "files": [
          "docs/sources/configuration/integrations/node-exporter-config.md",
          "docs/sources/configuration/integrations/process-exporter-config.md",
          "docs/sources/operator/custom-resource-quickstart.md",
          "docs/sources/operator/getting-started.md",
          "docs/sources/set-up/install-agent-docker.md",
          "pkg/operator/defaults.go",
          "production/grafanacloud-install.sh",
          "production/kubernetes/agent-bare.yaml",
          "production/kubernetes/agent-loki.yaml",
          "production/kubernetes/agent-traces.yaml",
          "production/kubernetes/build/lib/version.libsonnet",
          "production/kubernetes/build/templates/operator/main.jsonnet",
          "production/kubernetes/install-bare.sh",
          "production/operator/templates/agent-operator.yaml",
          "production/tanka/grafana-agent/v1/main.libsonnet",
          "production/tanka/grafana-agent/v2/internal/base.libsonnet",
          "production/tanka/grafana-agent/v2/internal/syncer.libsonnet"
        ],
        "message": "Update version numbers for 0.27.0-rc.0 (#2067)",
        "before_after_code_files": [
          "pkg/operator/defaults.go||pkg/operator/defaults.go",
          "production/grafanacloud-install.sh||production/grafanacloud-install.sh",
          "production/kubernetes/build/lib/version.libsonnet||production/kubernetes/build/lib/version.libsonnet",
          "production/kubernetes/build/templates/operator/main.jsonnet||production/kubernetes/build/templates/operator/main.jsonnet",
          "production/kubernetes/install-bare.sh||production/kubernetes/install-bare.sh",
          "production/tanka/grafana-agent/v1/main.libsonnet||production/tanka/grafana-agent/v1/main.libsonnet",
          "production/tanka/grafana-agent/v2/internal/base.libsonnet||production/tanka/grafana-agent/v2/internal/base.libsonnet",
          "production/tanka/grafana-agent/v2/internal/syncer.libsonnet||production/tanka/grafana-agent/v2/internal/syncer.libsonnet"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "pkg/operator/defaults.go||pkg/operator/defaults.go",
            "production/grafanacloud-install.sh||production/grafanacloud-install.sh",
            "production/kubernetes/build/lib/version.libsonnet||production/kubernetes/build/lib/version.libsonnet",
            "production/kubernetes/install-bare.sh||production/kubernetes/install-bare.sh",
            "production/tanka/grafana-agent/v1/main.libsonnet||production/tanka/grafana-agent/v1/main.libsonnet",
            "production/tanka/grafana-agent/v2/internal/base.libsonnet||production/tanka/grafana-agent/v2/internal/base.libsonnet",
            "production/tanka/grafana-agent/v2/internal/syncer.libsonnet||production/tanka/grafana-agent/v2/internal/syncer.libsonnet"
          ],
          "candidate": [
            "pkg/operator/defaults.go||pkg/operator/defaults.go",
            "production/grafanacloud-install.sh||production/grafanacloud-install.sh",
            "production/kubernetes/build/lib/version.libsonnet||production/kubernetes/build/lib/version.libsonnet",
            "production/kubernetes/install-bare.sh||production/kubernetes/install-bare.sh",
            "production/tanka/grafana-agent/v1/main.libsonnet||production/tanka/grafana-agent/v1/main.libsonnet",
            "production/tanka/grafana-agent/v2/internal/base.libsonnet||production/tanka/grafana-agent/v2/internal/base.libsonnet",
            "production/tanka/grafana-agent/v2/internal/syncer.libsonnet||production/tanka/grafana-agent/v2/internal/syncer.libsonnet"
          ]
        }
      },
      "candidate_diff": {
        "pkg/operator/defaults.go||pkg/operator/defaults.go": [
          "File: pkg/operator/defaults.go -> pkg/operator/defaults.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "28:   \"v0.25.1\",",
          "29:   \"v0.26.0\",",
          "30:   \"v0.26.1\",",
          "33:  }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "31:   \"v0.27.0-rc.0\",",
          "",
          "---------------"
        ],
        "production/grafanacloud-install.sh||production/grafanacloud-install.sh": [
          "File: production/grafanacloud-install.sh -> production/grafanacloud-install.sh",
          "--- Hunk 1 ---",
          "[Context before]",
          "50: #",
          "51: # Global constants.",
          "52: #",
          "55: RELEASE_URL=\"https://github.com/grafana/agent/releases/download/v${RELEASE_VERSION}\"",
          "56: DEB_URL=\"${RELEASE_URL}/grafana-agent-${RELEASE_VERSION}-1.${ARCH}.deb\"",
          "",
          "[Removed Lines]",
          "53: RELEASE_VERSION=\"0.26.1\"",
          "",
          "[Added Lines]",
          "53: RELEASE_VERSION=\"0.27.0-rc.0\"",
          "",
          "---------------"
        ],
        "production/kubernetes/build/lib/version.libsonnet||production/kubernetes/build/lib/version.libsonnet": [
          "File: production/kubernetes/build/lib/version.libsonnet -> production/kubernetes/build/lib/version.libsonnet",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: 'grafana/agent:v0.26.1'",
          "",
          "[Added Lines]",
          "1: 'grafana/agent:v0.27.0-rc.0'",
          "",
          "---------------"
        ],
        "production/kubernetes/build/templates/operator/main.jsonnet||production/kubernetes/build/templates/operator/main.jsonnet": [
          "File: production/kubernetes/build/templates/operator/main.jsonnet -> production/kubernetes/build/templates/operator/main.jsonnet",
          "--- Hunk 1 ---",
          "[Context before]",
          "23:   local this = self,",
          "25:   _images:: {",
          "28:     ksm: 'registry.k8s.io/kube-state-metrics/kube-state-metrics:v2.5.0'",
          "29:   },",
          "",
          "[Removed Lines]",
          "26:     agent: 'grafana/agent:v0.26.1',",
          "27:     agent_operator: 'grafana/agent-operator:v0.26.1',",
          "",
          "[Added Lines]",
          "26:     agent: 'grafana/agent:v0.27.0-rc.0',",
          "27:     agent_operator: 'grafana/agent-operator:v0.27.0-rc.0',",
          "",
          "---------------"
        ],
        "production/kubernetes/install-bare.sh||production/kubernetes/install-bare.sh": [
          "File: production/kubernetes/install-bare.sh -> production/kubernetes/install-bare.sh",
          "--- Hunk 1 ---",
          "[Context before]",
          "25: check_installed curl",
          "26: check_installed envsubst",
          "29: MANIFEST_URL=${MANIFEST_URL:-https://raw.githubusercontent.com/grafana/agent/${MANIFEST_BRANCH}/production/kubernetes/agent-bare.yaml}",
          "30: NAMESPACE=${NAMESPACE:-default}",
          "",
          "[Removed Lines]",
          "28: MANIFEST_BRANCH=v0.26.1",
          "",
          "[Added Lines]",
          "28: MANIFEST_BRANCH=v0.27.0-rc.0",
          "",
          "---------------"
        ],
        "production/tanka/grafana-agent/v1/main.libsonnet||production/tanka/grafana-agent/v1/main.libsonnet": [
          "File: production/tanka/grafana-agent/v1/main.libsonnet -> production/tanka/grafana-agent/v1/main.libsonnet",
          "--- Hunk 1 ---",
          "[Context before]",
          "15: (import './lib/traces.libsonnet') +",
          "16: {",
          "17:   _images:: {",
          "20:   },",
          "",
          "[Removed Lines]",
          "18:     agent: 'grafana/agent:v0.26.1',",
          "19:     agentctl: 'grafana/agentctl:v0.26.1',",
          "",
          "[Added Lines]",
          "18:     agent: 'grafana/agent:v0.27.0-rc.0',",
          "19:     agentctl: 'grafana/agentctl:v0.27.0-rc.0',",
          "",
          "---------------"
        ],
        "production/tanka/grafana-agent/v2/internal/base.libsonnet||production/tanka/grafana-agent/v2/internal/base.libsonnet": [
          "File: production/tanka/grafana-agent/v2/internal/base.libsonnet -> production/tanka/grafana-agent/v2/internal/base.libsonnet",
          "--- Hunk 1 ---",
          "[Context before]",
          "11:   local this = self,",
          "13:   _images:: {",
          "16:   },",
          "17:   _config:: {",
          "18:     name: name,",
          "",
          "[Removed Lines]",
          "14:     agent: 'grafana/agent:v0.26.1',",
          "15:     agentctl: 'grafana/agentctl:v0.26.1',",
          "",
          "[Added Lines]",
          "14:     agent: 'grafana/agent:v0.27.0-rc.0',",
          "15:     agentctl: 'grafana/agentctl:v0.27.0-rc.0',",
          "",
          "---------------"
        ],
        "production/tanka/grafana-agent/v2/internal/syncer.libsonnet||production/tanka/grafana-agent/v2/internal/syncer.libsonnet": [
          "File: production/tanka/grafana-agent/v2/internal/syncer.libsonnet -> production/tanka/grafana-agent/v2/internal/syncer.libsonnet",
          "--- Hunk 1 ---",
          "[Context before]",
          "14: ) {",
          "15:   local _config = {",
          "16:     api: error 'api must be set',",
          "18:     schedule: '*/5 * * * *',",
          "19:     configs: [],",
          "20:   } + config,",
          "",
          "[Removed Lines]",
          "17:     image: 'grafana/agentctl:v0.26.1',",
          "",
          "[Added Lines]",
          "17:     image: 'grafana/agentctl:v0.27.0-rc.0',",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "e9bd098ffd09930015173008ffb254018e7333c4",
      "candidate_info": {
        "commit_hash": "e9bd098ffd09930015173008ffb254018e7333c4",
        "repo": "grafana/agent",
        "commit_url": "https://github.com/grafana/agent/commit/e9bd098ffd09930015173008ffb254018e7333c4",
        "files": [
          "CHANGELOG.md",
          "docs/configuration-reference.md",
          "docs/getting-started.md",
          "production/README.md",
          "production/grafanacloud-install.sh",
          "production/kubernetes/agent-bare.yaml",
          "production/kubernetes/agent-loki.yaml",
          "production/kubernetes/agent-sigv4.yaml",
          "production/kubernetes/agent-tempo.yaml",
          "production/kubernetes/agent.yaml",
          "production/kubernetes/build/lib/version.libsonnet",
          "production/kubernetes/install-bare.sh",
          "production/kubernetes/install-loki.sh",
          "production/kubernetes/install-sigv4.sh",
          "production/kubernetes/install-tempo.sh",
          "production/kubernetes/install.sh",
          "production/tanka/grafana-agent/v1/main.libsonnet"
        ],
        "message": "prepare for 0.13.0 release (#430)\n\n* prepare for 0.13.0 release\n\n* Update CHANGELOG.md\n\nCo-authored-by: mattdurham <mattdurham@ppog.org>",
        "before_after_code_files": [
          "production/grafanacloud-install.sh||production/grafanacloud-install.sh",
          "production/kubernetes/build/lib/version.libsonnet||production/kubernetes/build/lib/version.libsonnet",
          "production/kubernetes/install-bare.sh||production/kubernetes/install-bare.sh",
          "production/kubernetes/install-loki.sh||production/kubernetes/install-loki.sh",
          "production/kubernetes/install-sigv4.sh||production/kubernetes/install-sigv4.sh",
          "production/kubernetes/install-tempo.sh||production/kubernetes/install-tempo.sh",
          "production/kubernetes/install.sh||production/kubernetes/install.sh",
          "production/tanka/grafana-agent/v1/main.libsonnet||production/tanka/grafana-agent/v1/main.libsonnet"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "production/grafanacloud-install.sh||production/grafanacloud-install.sh",
            "production/kubernetes/build/lib/version.libsonnet||production/kubernetes/build/lib/version.libsonnet",
            "production/kubernetes/install-bare.sh||production/kubernetes/install-bare.sh",
            "production/tanka/grafana-agent/v1/main.libsonnet||production/tanka/grafana-agent/v1/main.libsonnet"
          ],
          "candidate": [
            "production/grafanacloud-install.sh||production/grafanacloud-install.sh",
            "production/kubernetes/build/lib/version.libsonnet||production/kubernetes/build/lib/version.libsonnet",
            "production/kubernetes/install-bare.sh||production/kubernetes/install-bare.sh",
            "production/tanka/grafana-agent/v1/main.libsonnet||production/tanka/grafana-agent/v1/main.libsonnet"
          ]
        }
      },
      "candidate_diff": {
        "production/grafanacloud-install.sh||production/grafanacloud-install.sh": [
          "File: production/grafanacloud-install.sh -> production/grafanacloud-install.sh",
          "--- Hunk 1 ---",
          "[Context before]",
          "47: #",
          "48: # Global constants.",
          "49: #",
          "52: RELEASE_URL=\"https://github.com/grafana/agent/releases/download/v${RELEASE_VERSION}\"",
          "53: DEB_URL=\"${RELEASE_URL}/grafana-agent-${RELEASE_VERSION}-1.${ARCH}.deb\"",
          "",
          "[Removed Lines]",
          "50: RELEASE_VERSION=\"0.12.0\"",
          "",
          "[Added Lines]",
          "50: RELEASE_VERSION=\"0.13.0\"",
          "",
          "---------------"
        ],
        "production/kubernetes/build/lib/version.libsonnet||production/kubernetes/build/lib/version.libsonnet": [
          "File: production/kubernetes/build/lib/version.libsonnet -> production/kubernetes/build/lib/version.libsonnet",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: 'grafana/agent:v0.12.0'",
          "",
          "[Added Lines]",
          "1: 'grafana/agent:v0.13.0'",
          "",
          "---------------"
        ],
        "production/kubernetes/install-bare.sh||production/kubernetes/install-bare.sh": [
          "File: production/kubernetes/install-bare.sh -> production/kubernetes/install-bare.sh",
          "--- Hunk 1 ---",
          "[Context before]",
          "17: check_installed curl",
          "18: check_installed envsubst",
          "21: MANIFEST_URL=${MANIFEST_URL:-https://raw.githubusercontent.com/grafana/agent/${MANIFEST_BRANCH}/production/kubernetes/agent-bare.yaml}",
          "22: NAMESPACE=${NAMESPACE:-default}",
          "",
          "[Removed Lines]",
          "20: MANIFEST_BRANCH=v0.12.0",
          "",
          "[Added Lines]",
          "20: MANIFEST_BRANCH=v0.13.0",
          "",
          "---------------"
        ],
        "production/kubernetes/install-loki.sh||production/kubernetes/install-loki.sh": [
          "File: production/kubernetes/install-loki.sh -> production/kubernetes/install-loki.sh",
          "--- Hunk 1 ---",
          "[Context before]",
          "31: check_installed curl",
          "32: check_installed envsubst",
          "35: MANIFEST_URL=${MANIFEST_URL:-https://raw.githubusercontent.com/grafana/agent/${MANIFEST_BRANCH}/production/kubernetes/agent-loki.yaml}",
          "36: NAMESPACE=${NAMESPACE:-default}",
          "",
          "[Removed Lines]",
          "34: MANIFEST_BRANCH=v0.12.0",
          "",
          "[Added Lines]",
          "34: MANIFEST_BRANCH=v0.13.0",
          "",
          "---------------"
        ],
        "production/kubernetes/install-sigv4.sh||production/kubernetes/install-sigv4.sh": [
          "File: production/kubernetes/install-sigv4.sh -> production/kubernetes/install-sigv4.sh",
          "--- Hunk 1 ---",
          "[Context before]",
          "30: check_installed curl",
          "31: check_installed envsubst",
          "34: MANIFEST_URL=${MANIFEST_URL:-https://raw.githubusercontent.com/grafana/agent/${MANIFEST_BRANCH}/production/kubernetes/agent-sigv4.yaml}",
          "35: NAMESPACE=${NAMESPACE:-default}",
          "36: ROLE_ARN=${ROLE_ARN:-}",
          "",
          "[Removed Lines]",
          "33: MANIFEST_BRANCH=v0.12.0",
          "",
          "[Added Lines]",
          "33: MANIFEST_BRANCH=v0.13.0",
          "",
          "---------------"
        ],
        "production/kubernetes/install-tempo.sh||production/kubernetes/install-tempo.sh": [
          "File: production/kubernetes/install-tempo.sh -> production/kubernetes/install-tempo.sh",
          "--- Hunk 1 ---",
          "[Context before]",
          "31: check_installed curl",
          "32: check_installed envsubst",
          "35: MANIFEST_URL=${MANIFEST_URL:-https://raw.githubusercontent.com/grafana/agent/${MANIFEST_BRANCH}/production/kubernetes/agent-tempo.yaml}",
          "36: NAMESPACE=${NAMESPACE:-default}",
          "",
          "[Removed Lines]",
          "34: MANIFEST_BRANCH=v0.12.0",
          "",
          "[Added Lines]",
          "34: MANIFEST_BRANCH=v0.13.0",
          "",
          "---------------"
        ],
        "production/kubernetes/install.sh||production/kubernetes/install.sh": [
          "File: production/kubernetes/install.sh -> production/kubernetes/install.sh",
          "--- Hunk 1 ---",
          "[Context before]",
          "32: check_installed curl",
          "33: check_installed envsubst",
          "36: MANIFEST_URL=${MANIFEST_URL:-https://raw.githubusercontent.com/grafana/agent/${MANIFEST_BRANCH}/production/kubernetes/agent.yaml}",
          "37: NAMESPACE=${NAMESPACE:-default}",
          "",
          "[Removed Lines]",
          "35: MANIFEST_BRANCH=v0.12.0",
          "",
          "[Added Lines]",
          "35: MANIFEST_BRANCH=v0.13.0",
          "",
          "---------------"
        ],
        "production/tanka/grafana-agent/v1/main.libsonnet||production/tanka/grafana-agent/v1/main.libsonnet": [
          "File: production/tanka/grafana-agent/v1/main.libsonnet -> production/tanka/grafana-agent/v1/main.libsonnet",
          "--- Hunk 1 ---",
          "[Context before]",
          "15: (import './lib/tempo.libsonnet') +",
          "16: {",
          "17:   _images:: {",
          "20:   },",
          "",
          "[Removed Lines]",
          "18:     agent: 'grafana/agent:v0.12.0',",
          "19:     agentctl: 'grafana/agentctl:v0.12.0',",
          "",
          "[Added Lines]",
          "18:     agent: 'grafana/agent:v0.13.0',",
          "19:     agentctl: 'grafana/agentctl:v0.13.0',",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "8d18c1e60ad6e2e183398c79a6583887de73503e",
      "candidate_info": {
        "commit_hash": "8d18c1e60ad6e2e183398c79a6583887de73503e",
        "repo": "grafana/agent",
        "commit_url": "https://github.com/grafana/agent/commit/8d18c1e60ad6e2e183398c79a6583887de73503e",
        "files": [
          "CHANGELOG.md",
          "docs/configuration/integrations/process-exporter-config.md",
          "docs/getting-started/_index.md",
          "docs/operator/getting-started.md",
          "go.mod",
          "pkg/operator/defaults.go",
          "pkg/prom/instance/configstore/remote.go",
          "production/README.md",
          "production/grafanacloud-install.sh",
          "production/kubernetes/agent-bare.yaml",
          "production/kubernetes/agent-loki.yaml",
          "production/kubernetes/agent-tempo.yaml",
          "production/kubernetes/build/lib/version.libsonnet",
          "production/kubernetes/install-bare.sh",
          "production/tanka/grafana-agent/v1/main.libsonnet"
        ],
        "message": "Merge v0.18.1 into main (#802)\n\n* Initialize biggest ref to existing ref when reading a segment (#676)\n\n* initialize biggest ref to existing ref when reading a segment\n\n* changelog\n\n* allow new test to be less hard-coded\n\n* explain error if test fails\n\n* clarify changelog issue\n\n* prepare for v0.16.1 release (#679)\n\n* adding docker-compose example for local testing\n\n(cherry picked from commit 992e3cf26362dc55c28d035bb512d44163370ebd)\n\n* Cherry picking kafka importer\n\n* update Operator FAQ to describe custom scrape jobs (#658)\n\n* Merge\n\n* merge for race condition\n\n* Wall cherry pick\n\n* Import Kafka\n\n* Bump version number to v0.17.0\n\n* Initial release of v0.18.0 includes github_exporter, enabled flag issue, OTLP HTPP, and updated postgres exporter\n\n* Tempo/traces docs fixes for v0.18.0 (#784)\n\n* Needs to be loki for the naming change\n\n* Update date\n\n* No change, just trying to trigger drone\n\n* Fix for drone naming\n\n* Changes that needed to me imported for drone to work.\n\n* Update drone issues\n\n* sign drone\n\n* Drone changes\n\n* Update operator\n\n* standardize on seego\n\n* Test tag\n\n* fix tag\n\n* updated makefile\n\n* release tag fixing\n\n* remove extra tag\n\n* consul specific list support added\n\n* Fix type\n\n* Add comment\n\n* Fix for etcd issue that I introduced\n\n* Update to v0.18.1\n\n* Fix for test error\n\n* Fix small naming/style issues\n\n* Fix small naming/style issues\n\n* Update go.mod\n\n* Update configuration changes to v0.18.1\n\nCo-authored-by: Robert Fratto <robert.fratto@grafana.com>\nCo-authored-by: Gabriel <g.amaral.antunes@gmail.com>\nCo-authored-by: Mario <mariorvinas@gmail.com>",
        "before_after_code_files": [
          "go.mod||go.mod",
          "pkg/operator/defaults.go||pkg/operator/defaults.go",
          "pkg/prom/instance/configstore/remote.go||pkg/prom/instance/configstore/remote.go",
          "production/grafanacloud-install.sh||production/grafanacloud-install.sh",
          "production/kubernetes/build/lib/version.libsonnet||production/kubernetes/build/lib/version.libsonnet",
          "production/kubernetes/install-bare.sh||production/kubernetes/install-bare.sh",
          "production/tanka/grafana-agent/v1/main.libsonnet||production/tanka/grafana-agent/v1/main.libsonnet"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "pkg/operator/defaults.go||pkg/operator/defaults.go",
            "production/grafanacloud-install.sh||production/grafanacloud-install.sh",
            "production/kubernetes/build/lib/version.libsonnet||production/kubernetes/build/lib/version.libsonnet",
            "production/kubernetes/install-bare.sh||production/kubernetes/install-bare.sh",
            "production/tanka/grafana-agent/v1/main.libsonnet||production/tanka/grafana-agent/v1/main.libsonnet"
          ],
          "candidate": [
            "pkg/operator/defaults.go||pkg/operator/defaults.go",
            "production/grafanacloud-install.sh||production/grafanacloud-install.sh",
            "production/kubernetes/build/lib/version.libsonnet||production/kubernetes/build/lib/version.libsonnet",
            "production/kubernetes/install-bare.sh||production/kubernetes/install-bare.sh",
            "production/tanka/grafana-agent/v1/main.libsonnet||production/tanka/grafana-agent/v1/main.libsonnet"
          ]
        }
      },
      "candidate_diff": {
        "go.mod||go.mod": [
          "File: go.mod -> go.mod",
          "--- Hunk 1 ---",
          "[Context before]",
          "19:  github.com/gorilla/mux v1.8.0",
          "20:  github.com/grafana/loki v1.6.2-0.20210429132126-d88f3996eaa2",
          "21:  github.com/hashicorp/consul/api v1.8.1",
          "22:  github.com/hashicorp/go-getter v1.5.3",
          "23:  github.com/infinityworks/github-exporter v0.0.0-20201016091012-831b72461034",
          "24:  github.com/jsternberg/zap-logfmt v1.2.0",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "22:  github.com/hashicorp/go-cleanhttp v0.5.2",
          "",
          "---------------"
        ],
        "pkg/operator/defaults.go||pkg/operator/defaults.go": [
          "File: pkg/operator/defaults.go -> pkg/operator/defaults.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "7:   \"v0.15.0\",",
          "9:   \"v0.16.1\",",
          "12:  }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "10:   \"v0.17.0\",",
          "11:   \"v0.18.0\",",
          "12:   \"v0.18.1\",",
          "",
          "---------------"
        ],
        "pkg/prom/instance/configstore/remote.go||pkg/prom/instance/configstore/remote.go": [
          "File: pkg/prom/instance/configstore/remote.go -> pkg/prom/instance/configstore/remote.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: import (",
          "4:  \"context\"",
          "5:  \"fmt\"",
          "6:  \"strings\"",
          "7:  \"sync\"",
          "9:  \"github.com/cortexproject/cortex/pkg/ring/kv\"",
          "10:  \"github.com/go-kit/kit/log\"",
          "11:  \"github.com/go-kit/kit/log/level\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "5:  \"errors\"",
          "7:  \"net/http\"",
          "11:  \"github.com/weaveworks/common/instrument\"",
          "13:  \"github.com/cortexproject/cortex/pkg/ring/kv/consul\"",
          "15:  \"github.com/hashicorp/go-cleanhttp\"",
          "17:  \"github.com/hashicorp/consul/api\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "14:  \"github.com/prometheus/client_golang/prometheus\"",
          "15: )",
          "19: type Remote struct {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "28: The consul code skipping the cortex handler is due to performance issue with a large number of configs and overloading",
          "29: consul. See issue https://github.com/grafana/agent/issues/789. The long term method will be to refactor and extract",
          "30: the cortex code so other stores can also benefit from this. @mattdurham",
          "34: var consulRequestDuration = instrument.NewHistogramCollector(prometheus.NewHistogramVec(prometheus.HistogramOpts{",
          "35:  Namespace: \"cortex\",",
          "36:  Name:      \"consul_request_duration_seconds\",",
          "37:  Help:      \"Time spent on consul requests.\",",
          "38:  Buckets:   prometheus.DefBuckets,",
          "39: }, []string{\"operation\", \"status_code\"}))",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "21:  reg *util.Unregisterer",
          "23:  kvMut    sync.RWMutex",
          "25:  reloadKV chan struct{}",
          "27:  cancelCtx  context.Context",
          "",
          "[Removed Lines]",
          "24:  kv       kv.Client",
          "",
          "[Added Lines]",
          "48:  kv       *agentRemoteClient",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "31:  configsCh  chan WatchEvent",
          "32: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "60: type agentRemoteClient struct {",
          "61:  kv.Client",
          "62:  consul       *api.Client",
          "63:  consulConfig consul.Config",
          "64: }",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "70:  r.reg.UnregisterAll()",
          "72:  if !enable {",
          "74:   return nil",
          "75:  }",
          "77:  cli, err := kv.NewClient(cfg, GetCodec(), kv.RegistererWithKVName(r.reg, \"agent_configs\"))",
          "78:  if err != nil {",
          "79:   return fmt.Errorf(\"failed to create kv client: %w\", err)",
          "80:  }",
          "83:  return nil",
          "84: }",
          "90:  r.reloadKV <- struct{}{}",
          "91: }",
          "",
          "[Removed Lines]",
          "73:   r.setClient(nil)",
          "82:  r.setClient(cli)",
          "88: func (r *Remote) setClient(client kv.Client) {",
          "89:  r.kv = client",
          "",
          "[Added Lines]",
          "105:   r.setClient(nil, nil)",
          "111:  var consulClient *api.Client",
          "112:  if cfg.Store == \"consul\" {",
          "113:   consulClient, err = api.NewClient(&api.Config{",
          "114:    Address: cfg.Consul.Host,",
          "115:    Token:   cfg.Consul.ACLToken,",
          "116:    Scheme:  \"http\",",
          "117:    HttpClient: &http.Client{",
          "118:     Transport: cleanhttp.DefaultPooledTransport(),",
          "120:     Timeout: cfg.Consul.HTTPClientTimeout,",
          "121:    },",
          "122:   })",
          "123:   if err != nil {",
          "124:    return err",
          "125:   }",
          "127:  }",
          "132:  r.setClient(cli, consulClient)",
          "138: func (r *Remote) setClient(client kv.Client, consulClient *api.Client) {",
          "139:  if client == nil && consulClient == nil {",
          "140:   r.kv = nil",
          "141:  } else {",
          "142:   r.kv = &agentRemoteClient{",
          "143:    Client: client,",
          "144:    consul: consulClient,",
          "145:   }",
          "146:  }",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "119:  }",
          "120: }",
          "124:  if client == nil {",
          "125:   level.Info(r.log).Log(\"msg\", \"not watching the KV, none set\")",
          "",
          "[Removed Lines]",
          "122: func (r *Remote) watchKV(ctx context.Context, client kv.Client) {",
          "",
          "[Added Lines]",
          "179: func (r *Remote) watchKV(ctx context.Context, client *agentRemoteClient) {",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "162:  return r.kv.List(ctx, \"\")",
          "163: }",
          "166: func (r *Remote) Get(ctx context.Context, key string) (instance.Config, error) {",
          "167:  r.kvMut.RLock()",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "223: func (r *Remote) listConsul(ctx context.Context) (api.KVPairs, error) {",
          "224:  if r.kv == nil {",
          "225:   return nil, ErrNotConnected",
          "226:  }",
          "228:  var pairs api.KVPairs",
          "229:  options := &api.QueryOptions{",
          "230:   AllowStale:        !r.kv.consulConfig.ConsistentReads,",
          "231:   RequireConsistent: r.kv.consulConfig.ConsistentReads,",
          "232:  }",
          "234:  err := instrument.CollectedRequest(ctx, \"List\", consulRequestDuration, instrument.ErrorCode, func(ctx context.Context) error {",
          "235:   var err error",
          "237:   pairs, _, err = r.kv.consul.KV().List(\"configurations/\", options.WithContext(ctx))",
          "238:   return err",
          "239:  })",
          "241:  if err != nil {",
          "242:   return nil, err",
          "243:  }",
          "245:  if pairs == nil {",
          "246:   blankPairs := make(api.KVPairs, 0)",
          "247:   return blankPairs, nil",
          "248:  }",
          "249:  return pairs, nil",
          "250: }",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "260:   return nil, ErrNotConnected",
          "261:  }",
          "263:  keys, err := r.kv.List(ctx, \"\")",
          "264:  if err != nil {",
          "265:   return nil, fmt.Errorf(\"failed to list configs: %w\", err)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "354:  if r.kv.consul != nil {",
          "355:   return r.allConsul(ctx, keep)",
          "356:  }",
          "357:  return r.allOther(ctx, keep)",
          "359: }",
          "364: func (r *Remote) allConsul(ctx context.Context, keep func(key string) bool) (<-chan instance.Config, error) {",
          "365:  if r.kv.consul == nil {",
          "366:   level.Error(r.log).Log(\"err\", \"allConsul called but consul client nil\")",
          "367:   return nil, errors.New(\"allConsul called but consul client nil\")",
          "368:  }",
          "369:  var configs []*instance.Config",
          "370:  c := GetCodec()",
          "372:  pairs, err := r.listConsul(ctx)",
          "374:  if err != nil {",
          "375:   return nil, err",
          "376:  }",
          "377:  for _, kvp := range pairs {",
          "378:   if keep != nil && !keep(kvp.Key) {",
          "379:    level.Debug(r.log).Log(\"msg\", \"skipping key that was filtered out\", \"key\", kvp.Key)",
          "380:    continue",
          "381:   }",
          "382:   value, err := c.Decode(kvp.Value)",
          "383:   if err != nil {",
          "384:    level.Error(r.log).Log(\"msg\", \"failed to decode config from store\", \"key\", kvp.Key, \"err\", err)",
          "385:    continue",
          "386:   }",
          "387:   if value == nil {",
          "389:    level.Debug(r.log).Log(\"msg\", \"skipping key that was deleted after list was called\", \"key\", kvp.Key)",
          "390:    continue",
          "391:   }",
          "393:   cfg, err := instance.UnmarshalConfig(strings.NewReader(value.(string)))",
          "394:   if err != nil {",
          "395:    level.Error(r.log).Log(\"msg\", \"failed to unmarshal config from store\", \"key\", kvp.Key, \"err\", err)",
          "396:    continue",
          "397:   }",
          "398:   configs = append(configs, cfg)",
          "399:  }",
          "400:  ch := make(chan instance.Config, len(configs))",
          "401:  for _, cfg := range configs {",
          "402:   ch <- *cfg",
          "403:  }",
          "404:  close(ch)",
          "405:  return ch, nil",
          "406: }",
          "408: func (r *Remote) allOther(ctx context.Context, keep func(key string) bool) (<-chan instance.Config, error) {",
          "409:  if r.kv == nil {",
          "410:   return nil, ErrNotConnected",
          "411:  }",
          "",
          "---------------"
        ],
        "production/grafanacloud-install.sh||production/grafanacloud-install.sh": [
          "File: production/grafanacloud-install.sh -> production/grafanacloud-install.sh",
          "--- Hunk 1 ---",
          "[Context before]",
          "47: #",
          "48: # Global constants.",
          "49: #",
          "52: RELEASE_URL=\"https://github.com/grafana/agent/releases/download/v${RELEASE_VERSION}\"",
          "53: DEB_URL=\"${RELEASE_URL}/grafana-agent-${RELEASE_VERSION}-1.${ARCH}.deb\"",
          "",
          "[Removed Lines]",
          "50: RELEASE_VERSION=\"0.18.0\"",
          "",
          "[Added Lines]",
          "50: RELEASE_VERSION=\"0.18.1\"",
          "",
          "---------------"
        ],
        "production/kubernetes/build/lib/version.libsonnet||production/kubernetes/build/lib/version.libsonnet": [
          "File: production/kubernetes/build/lib/version.libsonnet -> production/kubernetes/build/lib/version.libsonnet",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: 'grafana/agent:v0.16.1'",
          "",
          "[Added Lines]",
          "1: 'grafana/agent:v0.18.1'",
          "",
          "---------------"
        ],
        "production/kubernetes/install-bare.sh||production/kubernetes/install-bare.sh": [
          "File: production/kubernetes/install-bare.sh -> production/kubernetes/install-bare.sh",
          "--- Hunk 1 ---",
          "[Context before]",
          "25: check_installed curl",
          "26: check_installed envsubst",
          "29: MANIFEST_URL=${MANIFEST_URL:-https://raw.githubusercontent.com/grafana/agent/${MANIFEST_BRANCH}/production/kubernetes/agent-bare.yaml}",
          "30: NAMESPACE=${NAMESPACE:-default}",
          "",
          "[Removed Lines]",
          "28: MANIFEST_BRANCH=v0.16.1",
          "",
          "[Added Lines]",
          "28: MANIFEST_BRANCH=v0.18.1",
          "",
          "---------------"
        ],
        "production/tanka/grafana-agent/v1/main.libsonnet||production/tanka/grafana-agent/v1/main.libsonnet": [
          "File: production/tanka/grafana-agent/v1/main.libsonnet -> production/tanka/grafana-agent/v1/main.libsonnet",
          "--- Hunk 1 ---",
          "[Context before]",
          "15: (import './lib/tempo.libsonnet') +",
          "16: {",
          "17:   _images:: {",
          "20:   },",
          "",
          "[Removed Lines]",
          "18:     agent: 'grafana/agent:v0.16.1',",
          "19:     agentctl: 'grafana/agentctl:v0.16.1',",
          "",
          "[Added Lines]",
          "18:     agent: 'grafana/agent:v0.18.1',",
          "19:     agentctl: 'grafana/agentctl:v0.18.1',",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "6b9058085f310df1591d7d2b9cdea52385afb4e1",
      "candidate_info": {
        "commit_hash": "6b9058085f310df1591d7d2b9cdea52385afb4e1",
        "repo": "grafana/agent",
        "commit_url": "https://github.com/grafana/agent/commit/6b9058085f310df1591d7d2b9cdea52385afb4e1",
        "files": [
          "CHANGELOG.md",
          "docs/sources/configuration/integrations/node-exporter-config.md",
          "docs/sources/configuration/integrations/process-exporter-config.md",
          "docs/sources/operator/api.md",
          "docs/sources/operator/custom-resource-quickstart.md",
          "docs/sources/set-up/install-agent-docker.md",
          "example/docker-compose/grafana/dashboards/agent-operational.json",
          "pkg/operator/defaults.go",
          "production/grafanacloud-install.sh",
          "production/kubernetes/agent-bare.yaml",
          "production/kubernetes/agent-loki.yaml",
          "production/kubernetes/agent-traces.yaml",
          "production/kubernetes/build/lib/version.libsonnet",
          "production/kubernetes/build/templates/operator/main.jsonnet",
          "production/kubernetes/install-bare.sh",
          "production/operator/templates/agent-operator.yaml",
          "production/tanka/grafana-agent/v1/main.libsonnet",
          "production/tanka/grafana-agent/v2/internal/base.libsonnet",
          "production/tanka/grafana-agent/v2/internal/syncer.libsonnet"
        ],
        "message": "prepare for v0.29.0-rc.0 release",
        "before_after_code_files": [
          "pkg/operator/defaults.go||pkg/operator/defaults.go",
          "production/grafanacloud-install.sh||production/grafanacloud-install.sh",
          "production/kubernetes/build/lib/version.libsonnet||production/kubernetes/build/lib/version.libsonnet",
          "production/kubernetes/build/templates/operator/main.jsonnet||production/kubernetes/build/templates/operator/main.jsonnet",
          "production/kubernetes/install-bare.sh||production/kubernetes/install-bare.sh",
          "production/tanka/grafana-agent/v1/main.libsonnet||production/tanka/grafana-agent/v1/main.libsonnet",
          "production/tanka/grafana-agent/v2/internal/base.libsonnet||production/tanka/grafana-agent/v2/internal/base.libsonnet",
          "production/tanka/grafana-agent/v2/internal/syncer.libsonnet||production/tanka/grafana-agent/v2/internal/syncer.libsonnet"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "pkg/operator/defaults.go||pkg/operator/defaults.go",
            "production/grafanacloud-install.sh||production/grafanacloud-install.sh",
            "production/kubernetes/build/lib/version.libsonnet||production/kubernetes/build/lib/version.libsonnet",
            "production/kubernetes/install-bare.sh||production/kubernetes/install-bare.sh",
            "production/tanka/grafana-agent/v1/main.libsonnet||production/tanka/grafana-agent/v1/main.libsonnet",
            "production/tanka/grafana-agent/v2/internal/base.libsonnet||production/tanka/grafana-agent/v2/internal/base.libsonnet",
            "production/tanka/grafana-agent/v2/internal/syncer.libsonnet||production/tanka/grafana-agent/v2/internal/syncer.libsonnet"
          ],
          "candidate": [
            "pkg/operator/defaults.go||pkg/operator/defaults.go",
            "production/grafanacloud-install.sh||production/grafanacloud-install.sh",
            "production/kubernetes/build/lib/version.libsonnet||production/kubernetes/build/lib/version.libsonnet",
            "production/kubernetes/install-bare.sh||production/kubernetes/install-bare.sh",
            "production/tanka/grafana-agent/v1/main.libsonnet||production/tanka/grafana-agent/v1/main.libsonnet",
            "production/tanka/grafana-agent/v2/internal/base.libsonnet||production/tanka/grafana-agent/v2/internal/base.libsonnet",
            "production/tanka/grafana-agent/v2/internal/syncer.libsonnet||production/tanka/grafana-agent/v2/internal/syncer.libsonnet"
          ]
        }
      },
      "candidate_diff": {
        "pkg/operator/defaults.go||pkg/operator/defaults.go": [
          "File: pkg/operator/defaults.go -> pkg/operator/defaults.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "32:   \"v0.27.1\",",
          "33:   \"v0.28.0\",",
          "34:   \"v0.28.1\",",
          "36:  }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "35:   \"v0.29.0-rc.0\",",
          "",
          "---------------"
        ],
        "production/grafanacloud-install.sh||production/grafanacloud-install.sh": [
          "File: production/grafanacloud-install.sh -> production/grafanacloud-install.sh",
          "--- Hunk 1 ---",
          "[Context before]",
          "50: #",
          "51: # Global constants.",
          "52: #",
          "55: # The DEB and RPM urls don't include the `v` version prefix in the file names,",
          "56: # so we trim it out using ${RELEASE_VERSION#v} below.",
          "",
          "[Removed Lines]",
          "53: RELEASE_VERSION=\"v0.28.1\"",
          "",
          "[Added Lines]",
          "53: RELEASE_VERSION=\"v0.29.0-rc.0\"",
          "",
          "---------------"
        ],
        "production/kubernetes/build/lib/version.libsonnet||production/kubernetes/build/lib/version.libsonnet": [
          "File: production/kubernetes/build/lib/version.libsonnet -> production/kubernetes/build/lib/version.libsonnet",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: 'grafana/agent:v0.28.1'",
          "",
          "[Added Lines]",
          "1: 'grafana/agent:v0.29.0-rc.0'",
          "",
          "---------------"
        ],
        "production/kubernetes/build/templates/operator/main.jsonnet||production/kubernetes/build/templates/operator/main.jsonnet": [
          "File: production/kubernetes/build/templates/operator/main.jsonnet -> production/kubernetes/build/templates/operator/main.jsonnet",
          "--- Hunk 1 ---",
          "[Context before]",
          "23:   local this = self,",
          "25:   _images:: {",
          "28:     ksm: 'registry.k8s.io/kube-state-metrics/kube-state-metrics:v2.5.0',",
          "29:   },",
          "",
          "[Removed Lines]",
          "26:     agent: 'grafana/agent:v0.28.1',",
          "27:     agent_operator: 'grafana/agent-operator:v0.28.1',",
          "",
          "[Added Lines]",
          "26:     agent: 'grafana/agent:v0.29.0-rc.0',",
          "27:     agent_operator: 'grafana/agent-operator:v0.29.0-rc.0',",
          "",
          "---------------"
        ],
        "production/kubernetes/install-bare.sh||production/kubernetes/install-bare.sh": [
          "File: production/kubernetes/install-bare.sh -> production/kubernetes/install-bare.sh",
          "--- Hunk 1 ---",
          "[Context before]",
          "25: check_installed curl",
          "26: check_installed envsubst",
          "29: MANIFEST_URL=${MANIFEST_URL:-https://raw.githubusercontent.com/grafana/agent/${MANIFEST_BRANCH}/production/kubernetes/agent-bare.yaml}",
          "30: NAMESPACE=${NAMESPACE:-default}",
          "",
          "[Removed Lines]",
          "28: MANIFEST_BRANCH=v0.28.1",
          "",
          "[Added Lines]",
          "28: MANIFEST_BRANCH=v0.29.0-rc.0",
          "",
          "---------------"
        ],
        "production/tanka/grafana-agent/v1/main.libsonnet||production/tanka/grafana-agent/v1/main.libsonnet": [
          "File: production/tanka/grafana-agent/v1/main.libsonnet -> production/tanka/grafana-agent/v1/main.libsonnet",
          "--- Hunk 1 ---",
          "[Context before]",
          "15: (import './lib/traces.libsonnet') +",
          "16: {",
          "17:   _images:: {",
          "20:   },",
          "",
          "[Removed Lines]",
          "18:     agent: 'grafana/agent:v0.28.1',",
          "19:     agentctl: 'grafana/agentctl:v0.28.1',",
          "",
          "[Added Lines]",
          "18:     agent: 'grafana/agent:v0.29.0-rc.0',",
          "19:     agentctl: 'grafana/agentctl:v0.29.0-rc.0',",
          "",
          "---------------"
        ],
        "production/tanka/grafana-agent/v2/internal/base.libsonnet||production/tanka/grafana-agent/v2/internal/base.libsonnet": [
          "File: production/tanka/grafana-agent/v2/internal/base.libsonnet -> production/tanka/grafana-agent/v2/internal/base.libsonnet",
          "--- Hunk 1 ---",
          "[Context before]",
          "11:   local this = self,",
          "13:   _images:: {",
          "16:   },",
          "17:   _config:: {",
          "18:     name: name,",
          "",
          "[Removed Lines]",
          "14:     agent: 'grafana/agent:v0.28.1',",
          "15:     agentctl: 'grafana/agentctl:v0.28.1',",
          "",
          "[Added Lines]",
          "14:     agent: 'grafana/agent:v0.29.0-rc.0',",
          "15:     agentctl: 'grafana/agentctl:v0.29.0-rc.0',",
          "",
          "---------------"
        ],
        "production/tanka/grafana-agent/v2/internal/syncer.libsonnet||production/tanka/grafana-agent/v2/internal/syncer.libsonnet": [
          "File: production/tanka/grafana-agent/v2/internal/syncer.libsonnet -> production/tanka/grafana-agent/v2/internal/syncer.libsonnet",
          "--- Hunk 1 ---",
          "[Context before]",
          "14: ) {",
          "15:   local _config = {",
          "16:     api: error 'api must be set',",
          "18:     schedule: '*/5 * * * *',",
          "19:     configs: [],",
          "20:   } + config,",
          "",
          "[Removed Lines]",
          "17:     image: 'grafana/agentctl:v0.28.1',",
          "",
          "[Added Lines]",
          "17:     image: 'grafana/agentctl:v0.29.0-rc.0',",
          "",
          "---------------"
        ]
      }
    }
  ]
}