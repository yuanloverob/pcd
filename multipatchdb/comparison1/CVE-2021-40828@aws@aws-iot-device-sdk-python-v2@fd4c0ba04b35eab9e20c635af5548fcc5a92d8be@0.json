{
  "cve_id": "CVE-2021-40828",
  "cve_desc": "Connections initialized by the AWS IoT Device SDK v2 for Java (versions prior to 1.3.3), Python (versions prior to 1.5.18), C++ (versions prior to 1.12.7) and Node.js (versions prior to 1.5.1) did not verify server certificate hostname during TLS handshake when overriding Certificate Authorities (CA) in their trust stores on Windows. This issue has been addressed in aws-c-io submodule versions 0.9.13 onward. This issue affects: Amazon Web Services AWS IoT Device SDK v2 for Java versions prior to 1.3.3 on Microsoft Windows. Amazon Web Services AWS IoT Device SDK v2 for Python versions prior to 1.5.18 on Microsoft Windows. Amazon Web Services AWS IoT Device SDK v2 for C++ versions prior to 1.12.7 on Microsoft Windows. Amazon Web Services AWS IoT Device SDK v2 for Node.js versions prior to 1.5.3 on Microsoft Windows.",
  "repo": "aws/aws-iot-device-sdk-python-v2",
  "patch_hash": "fd4c0ba04b35eab9e20c635af5548fcc5a92d8be",
  "patch_info": {
    "commit_hash": "fd4c0ba04b35eab9e20c635af5548fcc5a92d8be",
    "repo": "aws/aws-iot-device-sdk-python-v2",
    "commit_url": "https://github.com/aws/aws-iot-device-sdk-python-v2/commit/fd4c0ba04b35eab9e20c635af5548fcc5a92d8be",
    "files": [
      "setup.py"
    ],
    "message": "Update to latest CRT (#208)\n\n* On Windows, always perform an SNI check even with an overridden root CA\n* On Windows, properly honor the verify_peer = false option\n* Fix instability with raspberry PI and input stream seeking by doing a better job of modeling file seek offset type and size.",
    "before_after_code_files": [
      "setup.py||setup.py"
    ]
  },
  "patch_diff": {
    "setup.py||setup.py": [
      "File: setup.py -> setup.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "40:         \"Operating System :: OS Independent\",",
      "41:     ],",
      "42:     install_requires=[",
      "44:     ],",
      "45:     python_requires='>=3.6',",
      "46: )",
      "",
      "[Removed Lines]",
      "43:         'awscrt==0.11.20',",
      "",
      "[Added Lines]",
      "43:         'awscrt==0.11.22',",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "33ece76d1a6e6adc588855adb8ffdfbdbd9dec99",
      "candidate_info": {
        "commit_hash": "33ece76d1a6e6adc588855adb8ffdfbdbd9dec99",
        "repo": "aws/aws-iot-device-sdk-python-v2",
        "commit_url": "https://github.com/aws/aws-iot-device-sdk-python-v2/commit/33ece76d1a6e6adc588855adb8ffdfbdbd9dec99",
        "files": [
          "setup.py"
        ],
        "message": "Bumped Python CRT version to 0.13.4",
        "before_after_code_files": [
          "setup.py||setup.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "setup.py||setup.py"
          ],
          "candidate": [
            "setup.py||setup.py"
          ]
        }
      },
      "candidate_diff": {
        "setup.py||setup.py": [
          "File: setup.py -> setup.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "40:         \"Operating System :: OS Independent\",",
          "41:     ],",
          "42:     install_requires=[",
          "44:     ],",
          "45:     python_requires='>=3.6',",
          "46: )",
          "",
          "[Removed Lines]",
          "43:         'awscrt==0.13.3',",
          "",
          "[Added Lines]",
          "43:         'awscrt==0.13.4'",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "e55e0654fe76b1a634a649530e18a022dfbd5468",
      "candidate_info": {
        "commit_hash": "e55e0654fe76b1a634a649530e18a022dfbd5468",
        "repo": "aws/aws-iot-device-sdk-python-v2",
        "commit_url": "https://github.com/aws/aws-iot-device-sdk-python-v2/commit/e55e0654fe76b1a634a649530e18a022dfbd5468",
        "files": [
          "continuous-delivery/wait-for-pypi.py",
          "setup.py"
        ],
        "message": "update awscrt to 0.9.10 (#127)\n\n0.9.3 was missing wheels for several platforms",
        "before_after_code_files": [
          "continuous-delivery/wait-for-pypi.py||continuous-delivery/wait-for-pypi.py",
          "setup.py||setup.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "setup.py||setup.py"
          ],
          "candidate": [
            "setup.py||setup.py"
          ]
        }
      },
      "candidate_diff": {
        "continuous-delivery/wait-for-pypi.py||continuous-delivery/wait-for-pypi.py": [
          "File: continuous-delivery/wait-for-pypi.py -> continuous-delivery/wait-for-pypi.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "11: def wait(package, version, index_url=DEFAULT_INDEX_URL, timeout=DEFAULT_TIMEOUT, interval=DEFAULT_INTERVAL):",
          "12:     give_up_time = time.time() + timeout",
          "13:     while True:",
          "15:         output = output.decode()",
          "17:         # output looks like: 'awscrt (0.3.1)  - A common runtime for AWS Python projects\\n...'",
          "",
          "[Removed Lines]",
          "14:         output = subprocess.check_output([sys.executable, '-m', 'pip', 'search', '--index', index_url, package])",
          "",
          "[Added Lines]",
          "14:         output = subprocess.check_output([sys.executable, '-m', 'pip', 'search',",
          "15:                                           '--no-cache-dir', '--index', index_url, package])",
          "",
          "---------------"
        ],
        "setup.py||setup.py": [
          "File: setup.py -> setup.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "13:     url='https://github.com/aws/aws-iot-device-sdk-python-v2',",
          "14:     packages=['awsiot'],",
          "15:     install_requires=[",
          "17:     ],",
          "18:     python_requires='>=3.5',",
          "19: )",
          "",
          "[Removed Lines]",
          "16:         'awscrt==0.9.3',",
          "",
          "[Added Lines]",
          "16:         'awscrt==0.9.10',",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "e6ac456bfcca264777c80d0c195617d3d90b9a3b",
      "candidate_info": {
        "commit_hash": "e6ac456bfcca264777c80d0c195617d3d90b9a3b",
        "repo": "aws/aws-iot-device-sdk-python-v2",
        "commit_url": "https://github.com/aws/aws-iot-device-sdk-python-v2/commit/e6ac456bfcca264777c80d0c195617d3d90b9a3b",
        "files": [
          "setup.py"
        ],
        "message": "Update crt dependency for bug fixes (#89)",
        "before_after_code_files": [
          "setup.py||setup.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "setup.py||setup.py"
          ],
          "candidate": [
            "setup.py||setup.py"
          ]
        }
      },
      "candidate_diff": {
        "setup.py||setup.py": [
          "File: setup.py -> setup.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "13:     url='https://github.com/aws/aws-iot-device-sdk-python-v2',",
          "14:     packages = ['awsiot'],",
          "15:     install_requires=[",
          "17:         'futures;python_version<\"3.2\"',",
          "18:         'typing;python_version<\"3.5\"',",
          "19:     ],",
          "",
          "[Removed Lines]",
          "16:         'awscrt==0.6.0',",
          "",
          "[Added Lines]",
          "16:         'awscrt==0.6.1',",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "0450ce68add7e3d05c6d781ecdac953c299c053a",
      "candidate_info": {
        "commit_hash": "0450ce68add7e3d05c6d781ecdac953c299c053a",
        "repo": "aws/aws-iot-device-sdk-python-v2",
        "commit_url": "https://github.com/aws/aws-iot-device-sdk-python-v2/commit/0450ce68add7e3d05c6d781ecdac953c299c053a",
        "files": [
          "setup.py"
        ],
        "message": "Fix Mac SNI check with overridden root CA (#211)",
        "before_after_code_files": [
          "setup.py||setup.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "setup.py||setup.py"
          ],
          "candidate": [
            "setup.py||setup.py"
          ]
        }
      },
      "candidate_diff": {
        "setup.py||setup.py": [
          "File: setup.py -> setup.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "40:         \"Operating System :: OS Independent\",",
          "41:     ],",
          "42:     install_requires=[",
          "44:     ],",
          "45:     python_requires='>=3.6',",
          "46: )",
          "",
          "[Removed Lines]",
          "43:         'awscrt==0.11.22',",
          "",
          "[Added Lines]",
          "43:         'awscrt==0.11.25',",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "0bc101f1e1354504688741ccde6d314004573af0",
      "candidate_info": {
        "commit_hash": "0bc101f1e1354504688741ccde6d314004573af0",
        "repo": "aws/aws-iot-device-sdk-python-v2",
        "commit_url": "https://github.com/aws/aws-iot-device-sdk-python-v2/commit/0bc101f1e1354504688741ccde6d314004573af0",
        "files": [
          "setup.py"
        ],
        "message": "Add ECC support for PKCS#11 (#308)\n\nfunctionality comes from updated awcrt dependency.\n\nCo-authored-by: @JamieHunter",
        "before_after_code_files": [
          "setup.py||setup.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "setup.py||setup.py"
          ],
          "candidate": [
            "setup.py||setup.py"
          ]
        }
      },
      "candidate_diff": {
        "setup.py||setup.py": [
          "File: setup.py -> setup.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "40:         \"Operating System :: OS Independent\",",
          "41:     ],",
          "42:     install_requires=[",
          "44:     ],",
          "45:     python_requires='>=3.6',",
          "46: )",
          "",
          "[Removed Lines]",
          "43:         'awscrt==0.13.6',",
          "",
          "[Added Lines]",
          "43:         'awscrt==0.13.9',",
          "",
          "---------------"
        ]
      }
    }
  ]
}