{
  "cve_id": "CVE-2024-22232",
  "cve_desc": "A specially crafted url can be created which leads to a directory traversal in the salt file server.\nA malicious user can read an arbitrary file from a Salt master\u2019s filesystem.",
  "repo": "saltstack/salt",
  "patch_hash": "e0cdb80b55123f4a024759ffcf2b3f0e0788e7ab",
  "patch_info": {
    "commit_hash": "e0cdb80b55123f4a024759ffcf2b3f0e0788e7ab",
    "repo": "saltstack/salt",
    "commit_url": "https://github.com/saltstack/salt/commit/e0cdb80b55123f4a024759ffcf2b3f0e0788e7ab",
    "files": [
      "salt/fileserver/__init__.py",
      "salt/fileserver/roots.py",
      "salt/master.py",
      "tests/pytests/unit/fileserver/test_roots.py",
      "tests/pytests/unit/test_fileserver.py",
      "tests/pytests/unit/test_master.py",
      "tests/unit/test_fileserver.py"
    ],
    "message": "CVE fix",
    "before_after_code_files": [
      "salt/fileserver/__init__.py||salt/fileserver/__init__.py",
      "salt/fileserver/roots.py||salt/fileserver/roots.py",
      "salt/master.py||salt/master.py",
      "tests/pytests/unit/fileserver/test_roots.py||tests/pytests/unit/fileserver/test_roots.py",
      "tests/pytests/unit/test_fileserver.py||tests/pytests/unit/test_fileserver.py",
      "tests/pytests/unit/test_master.py||tests/pytests/unit/test_master.py",
      "tests/unit/test_fileserver.py||tests/unit/test_fileserver.py"
    ]
  },
  "patch_diff": {
    "salt/fileserver/__init__.py||salt/fileserver/__init__.py": [
      "File: salt/fileserver/__init__.py -> salt/fileserver/__init__.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "568:         saltenv = salt.utils.stringutils.to_unicode(saltenv)",
      "569:         back = self.backends(back)",
      "570:         kwargs = {}",
      "576:         if salt.utils.url.is_escaped(path):",
      "577:             # don't attempt to find URL query arguments in the path",
      "578:             path = salt.utils.url.unescape(path)",
      "",
      "[Removed Lines]",
      "571:         fnd = {\"path\": \"\", \"rel\": \"\"}",
      "572:         if os.path.isabs(path):",
      "573:             return fnd",
      "574:         if \"../\" in path:",
      "575:             return fnd",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "588:                     args = comp.split(\"=\", 1)",
      "589:                     kwargs[args[0]] = args[1]",
      "591:         if \"env\" in kwargs:",
      "592:             # \"env\" is not supported; Use \"saltenv\".",
      "593:             kwargs.pop(\"env\")",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "586:         fnd = {\"path\": \"\", \"rel\": \"\"}",
      "587:         if os.path.isabs(path) or \"../\" in path:",
      "588:             return fnd",
      "",
      "---------------"
    ],
    "salt/fileserver/roots.py||salt/fileserver/roots.py": [
      "File: salt/fileserver/roots.py -> salt/fileserver/roots.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "27: import salt.utils.path",
      "28: import salt.utils.platform",
      "29: import salt.utils.stringutils",
      "30: import salt.utils.versions",
      "32: log = logging.getLogger(__name__)",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "30: import salt.utils.verify",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "98:         if saltenv == \"__env__\":",
      "99:             root = root.replace(\"__env__\", actual_saltenv)",
      "100:         full = os.path.join(root, path)",
      "101:         if os.path.isfile(full) and not salt.fileserver.is_file_ignored(__opts__, full):",
      "102:             fnd[\"path\"] = full",
      "103:             fnd[\"rel\"] = path",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "103:         # Refuse to serve file that is not under the root.",
      "104:         if not salt.utils.verify.clean_path(root, full, subdir=True):",
      "105:             continue",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "128:     ret[\"dest\"] = fnd[\"rel\"]",
      "129:     gzip = load.get(\"gzip\", None)",
      "130:     fpath = os.path.normpath(fnd[\"path\"])",
      "131:     with salt.utils.files.fopen(fpath, \"rb\") as fp_:",
      "132:         fp_.seek(load[\"loc\"])",
      "133:         data = fp_.read(__opts__[\"file_buffer_size\"])",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "138:     actual_saltenv = saltenv = load[\"saltenv\"]",
      "139:     if saltenv not in __opts__[\"file_roots\"]:",
      "140:         if \"__env__\" in __opts__[\"file_roots\"]:",
      "141:             log.debug(",
      "142:                 \"salt environment '%s' maps to __env__ file_roots directory\", saltenv",
      "143:             )",
      "144:             saltenv = \"__env__\"",
      "145:         else:",
      "146:             return fnd",
      "147:     file_in_root = False",
      "148:     for root in __opts__[\"file_roots\"][saltenv]:",
      "149:         if saltenv == \"__env__\":",
      "150:             root = root.replace(\"__env__\", actual_saltenv)",
      "151:         # Refuse to serve file that is not under the root.",
      "152:         if salt.utils.verify.clean_path(root, fpath, subdir=True):",
      "153:             file_in_root = True",
      "154:     if not file_in_root:",
      "155:         return ret",
      "",
      "---------------"
    ],
    "salt/master.py||salt/master.py": [
      "File: salt/master.py -> salt/master.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "1036:         \"\"\"",
      "1037:         key = payload[\"enc\"]",
      "1038:         load = payload[\"load\"]",
      "1040:         raise salt.ext.tornado.gen.Return(ret)",
      "1042:     def _post_stats(self, start, cmd):",
      "",
      "[Removed Lines]",
      "1039:         ret = {\"aes\": self._handle_aes, \"clear\": self._handle_clear}[key](load)",
      "",
      "[Added Lines]",
      "1039:         if key == \"aes\":",
      "1040:             ret = self.handle_aes(load)",
      "1041:         else:",
      "1042:             ret = self.handle_clear(load)",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "1738:                 self.mminion.returners[fstr](load[\"jid\"], load[\"load\"])",
      "1740:             # Register the syndic",
      "1741:             syndic_cache_path = os.path.join(",
      "1742:                 self.opts[\"cachedir\"], \"syndics\", load[\"id\"]",
      "1743:             )",
      "1745:                 path_name = os.path.split(syndic_cache_path)[0]",
      "1746:                 if not os.path.exists(path_name):",
      "1747:                     os.makedirs(path_name)",
      "",
      "[Removed Lines]",
      "1744:             if not os.path.exists(syndic_cache_path):",
      "",
      "[Added Lines]",
      "1745:             # We are creating a path using user suplied input. Use the",
      "1746:             # clean_path to prevent a directory traversal.",
      "1747:             root = os.path.join(self.opts[\"cachedir\"], \"syndics\")",
      "1751:             if salt.utils.verify.clean_path(",
      "1752:                 root, syndic_cache_path",
      "1753:             ) and not os.path.exists(syndic_cache_path):",
      "",
      "---------------"
    ],
    "tests/pytests/unit/fileserver/test_roots.py||tests/pytests/unit/fileserver/test_roots.py": [
      "File: tests/pytests/unit/fileserver/test_roots.py -> tests/pytests/unit/fileserver/test_roots.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "53:     return dirname",
      "56: @pytest.fixture",
      "57: def configure_loader_modules(tmp_state_tree, temp_salt_master):",
      "58:     opts = temp_salt_master.config.copy()",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "56: @pytest.fixture(autouse=True)",
      "57: def testfilepath(tmp_state_tree, testfile):",
      "58:     return tmp_state_tree / testfile.name",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "75:     assert full_path_to_file == ret[\"path\"]",
      "79:     with patch.dict(roots.__opts__, {\"file_buffer_size\": 262144}):",
      "80:         load = {",
      "81:             \"saltenv\": \"base\",",
      "83:             \"loc\": 0,",
      "84:         }",
      "86:         ret = roots.serve_file(load, fnd)",
      "89:             data = fp_.read()",
      "91:         assert ret == {\"data\": data, \"dest\": \"testfile\"}",
      "",
      "[Removed Lines]",
      "78: def test_serve_file(testfile):",
      "82:             \"path\": str(testfile),",
      "85:         fnd = {\"path\": str(testfile), \"rel\": \"testfile\"}",
      "88:         with salt.utils.files.fopen(str(testfile), \"rb\") as fp_:",
      "",
      "[Added Lines]",
      "83: def test_serve_file(testfilepath):",
      "87:             \"path\": str(testfilepath),",
      "90:         fnd = {\"path\": str(testfilepath), \"rel\": \"testfile\"}",
      "93:         with salt.utils.files.fopen(str(testfilepath), \"rb\") as fp_:",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "236:     # between Python releases.",
      "237:     lines_written = sorted(mtime_map_mock.write_calls())",
      "238:     expected = sorted(",
      "240:         for key, val in new_mtime_map.items()",
      "241:     )",
      "242:     assert lines_written == expected, lines_written",
      "",
      "[Removed Lines]",
      "239:         salt.utils.stringutils.to_bytes(\"{key}:{val}\\n\".format(key=key, val=val))",
      "",
      "[Added Lines]",
      "244:         salt.utils.stringutils.to_bytes(f\"{key}:{val}\\n\")",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "277:         },",
      "278:         \"backend\": \"roots\",",
      "279:     }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "287: def test_find_file_not_in_root(tmp_state_tree):",
      "288:     \"\"\"",
      "289:     Fileroots should never 'find' a file that is outside of it's root.",
      "290:     \"\"\"",
      "291:     badfile = pathlib.Path(tmp_state_tree).parent / \"bar\"",
      "292:     badfile.write_text(\"Bad file\")",
      "293:     badpath = f\"../bar\"",
      "294:     ret = roots.find_file(badpath)",
      "295:     assert ret == {\"path\": \"\", \"rel\": \"\"}",
      "296:     badpath = f\"{tmp_state_tree / '..' / 'bar'}\"",
      "297:     ret = roots.find_file(badpath)",
      "298:     assert ret == {\"path\": \"\", \"rel\": \"\"}",
      "301: def test_serve_file_not_in_root(tmp_state_tree):",
      "302:     \"\"\"",
      "303:     Fileroots should never 'serve' a file that is outside of it's root.",
      "304:     \"\"\"",
      "305:     badfile = pathlib.Path(tmp_state_tree).parent / \"bar\"",
      "306:     badfile.write_text(\"Bad file\")",
      "307:     badpath = f\"../bar\"",
      "308:     load = {\"path\": \"salt://|..\\\\bar\", \"saltenv\": \"base\", \"loc\": 0}",
      "309:     fnd = {",
      "310:         \"path\": f\"{tmp_state_tree / '..' / 'bar'}\",",
      "311:         \"rel\": f\"{pathlib.Path('..') / 'bar'}\",",
      "312:     }",
      "313:     ret = roots.serve_file(load, fnd)",
      "314:     assert ret == {\"data\": \"\", \"dest\": \"../bar\"}",
      "",
      "---------------"
    ],
    "tests/pytests/unit/test_fileserver.py||tests/pytests/unit/test_fileserver.py": [
      "File: tests/pytests/unit/test_fileserver.py -> tests/pytests/unit/test_fileserver.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: \"\"\"",
      "2: \"\"\"",
      "5: import datetime",
      "6: import os",
      "7: import time",
      "9: import salt.fileserver",
      "10: import salt.utils.files",
      "13: def test_diff_with_diffent_keys():",
      "14:     \"\"\"",
      "15:     Test that different maps are indeed reported different",
      "16:     \"\"\"",
      "17:     map1 = {\"file1\": 1234}",
      "18:     map2 = {\"file2\": 1234}",
      "19:     assert salt.fileserver.diff_mtime_map(map1, map2) is True",
      "22: def test_diff_with_diffent_values():",
      "23:     \"\"\"",
      "24:     Test that different maps are indeed reported different",
      "25:     \"\"\"",
      "26:     map1 = {\"file1\": 12345}",
      "27:     map2 = {\"file1\": 1234}",
      "28:     assert salt.fileserver.diff_mtime_map(map1, map2) is True",
      "31: def test_whitelist():",
      "32:     opts = {",
      "33:         \"fileserver_backend\": [\"roots\", \"git\", \"s3fs\", \"hgfs\", \"svn\"],",
      "34:         \"extension_modules\": \"\",",
      "35:     }",
      "36:     fs = salt.fileserver.Fileserver(opts)",
      "37:     assert sorted(fs.servers.whitelist) == sorted(",
      "38:         [\"git\", \"gitfs\", \"hg\", \"hgfs\", \"svn\", \"svnfs\", \"roots\", \"s3fs\"]",
      "39:     ), fs.servers.whitelist",
      "42: def test_future_file_list_cache_file_ignored(tmp_path):",
      "43:     opts = {",
      "44:         \"fileserver_backend\": [\"roots\"],",
      "45:         \"cachedir\": tmp_path,",
      "46:         \"extension_modules\": \"\",",
      "47:     }",
      "49:     back_cachedir = os.path.join(tmp_path, \"file_lists/roots\")",
      "50:     os.makedirs(os.path.join(back_cachedir))",
      "52:     # Touch a couple files",
      "53:     for filename in (\"base.p\", \"foo.txt\"):",
      "54:         with salt.utils.files.fopen(os.path.join(back_cachedir, filename), \"wb\") as _f:",
      "55:             if filename == \"base.p\":",
      "56:                 _f.write(b\"\\x80\")",
      "58:     # Set modification time to file list cache file to 1 year in the future",
      "59:     now = datetime.datetime.utcnow()",
      "60:     future = now + datetime.timedelta(days=365)",
      "61:     mod_time = time.mktime(future.timetuple())",
      "62:     os.utime(os.path.join(back_cachedir, \"base.p\"), (mod_time, mod_time))",
      "64:     list_cache = os.path.join(back_cachedir, \"base.p\")",
      "65:     w_lock = os.path.join(back_cachedir, \".base.w\")",
      "66:     ret = salt.fileserver.check_file_list_cache(opts, \"files\", list_cache, w_lock)",
      "67:     assert (",
      "68:         ret[1] is True",
      "69:     ), \"Cache file list cache file is not refreshed when future modification time\"",
      "72: def test_file_server_url_escape(tmp_path):",
      "73:     (tmp_path / \"srv\").mkdir()",
      "74:     (tmp_path / \"srv\" / \"salt\").mkdir()",
      "75:     (tmp_path / \"foo\").mkdir()",
      "76:     (tmp_path / \"foo\" / \"bar\").write_text(\"Bad file\")",
      "77:     fileroot = str(tmp_path / \"srv\" / \"salt\")",
      "78:     badfile = str(tmp_path / \"foo\" / \"bar\")",
      "79:     opts = {",
      "80:         \"fileserver_backend\": [\"roots\"],",
      "81:         \"extension_modules\": \"\",",
      "82:         \"optimization_order\": [",
      "83:             0,",
      "84:         ],",
      "85:         \"file_roots\": {",
      "86:             \"base\": [fileroot],",
      "87:         },",
      "88:         \"file_ignore_regex\": \"\",",
      "89:         \"file_ignore_glob\": \"\",",
      "90:     }",
      "91:     fs = salt.fileserver.Fileserver(opts)",
      "92:     ret = fs.find_file(",
      "93:         \"salt://|..\\\\..\\\\..\\\\foo/bar\",",
      "94:         \"base\",",
      "95:     )",
      "96:     assert ret == {\"path\": \"\", \"rel\": \"\"}",
      "99: def test_file_server_serve_url_escape(tmp_path):",
      "100:     (tmp_path / \"srv\").mkdir()",
      "101:     (tmp_path / \"srv\" / \"salt\").mkdir()",
      "102:     (tmp_path / \"foo\").mkdir()",
      "103:     (tmp_path / \"foo\" / \"bar\").write_text(\"Bad file\")",
      "104:     fileroot = str(tmp_path / \"srv\" / \"salt\")",
      "105:     badfile = str(tmp_path / \"foo\" / \"bar\")",
      "106:     opts = {",
      "107:         \"fileserver_backend\": [\"roots\"],",
      "108:         \"extension_modules\": \"\",",
      "109:         \"optimization_order\": [",
      "110:             0,",
      "111:         ],",
      "112:         \"file_roots\": {",
      "113:             \"base\": [fileroot],",
      "114:         },",
      "115:         \"file_ignore_regex\": \"\",",
      "116:         \"file_ignore_glob\": \"\",",
      "117:         \"file_buffer_size\": 2048,",
      "118:     }",
      "119:     fs = salt.fileserver.Fileserver(opts)",
      "120:     ret = fs.serve_file(",
      "121:         {",
      "122:             \"path\": \"salt://|..\\\\..\\\\..\\\\foo/bar\",",
      "123:             \"saltenv\": \"base\",",
      "124:             \"loc\": 0,",
      "125:         }",
      "126:     )",
      "127:     assert ret == {\"data\": \"\", \"dest\": \"\"}",
      "",
      "---------------"
    ],
    "tests/pytests/unit/test_master.py||tests/pytests/unit/test_master.py": [
      "File: tests/pytests/unit/test_master.py -> tests/pytests/unit/test_master.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "1: import time",
      "3: import pytest",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: import pathlib",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "160:     with patch.object(encrypted_requests, \"_return\", autospec=True) as fake_return:",
      "161:         encrypted_requests._syndic_return(payload)",
      "162:         fake_return.assert_called_with(expected_return)",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "166: def test_syndic_return_cache_dir_creation(encrypted_requests):",
      "167:     \"\"\"master's cachedir for a syndic will be created by AESFuncs._syndic_return method\"\"\"",
      "168:     cachedir = pathlib.Path(encrypted_requests.opts[\"cachedir\"])",
      "169:     assert not (cachedir / \"syndics\").exists()",
      "170:     encrypted_requests._syndic_return(",
      "171:         {",
      "172:             \"id\": \"mamajama\",",
      "173:             \"jid\": \"\",",
      "174:             \"return\": {},",
      "175:         }",
      "176:     )",
      "177:     assert (cachedir / \"syndics\").exists()",
      "178:     assert (cachedir / \"syndics\" / \"mamajama\").exists()",
      "181: def test_syndic_return_cache_dir_creation_traversal(encrypted_requests):",
      "182:     \"\"\"",
      "183:     master's  AESFuncs._syndic_return method cachdir creation is not vulnerable to a directory traversal",
      "184:     \"\"\"",
      "185:     cachedir = pathlib.Path(encrypted_requests.opts[\"cachedir\"])",
      "186:     assert not (cachedir / \"syndics\").exists()",
      "187:     encrypted_requests._syndic_return(",
      "188:         {",
      "189:             \"id\": \"../mamajama\",",
      "190:             \"jid\": \"\",",
      "191:             \"return\": {},",
      "192:         }",
      "193:     )",
      "194:     assert not (cachedir / \"syndics\").exists()",
      "195:     assert not (cachedir / \"mamajama\").exists()",
      "",
      "---------------"
    ],
    "tests/unit/test_fileserver.py||tests/unit/test_fileserver.py": [
      "File: tests/unit/test_fileserver.py -> tests/unit/test_fileserver.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "8e54d629b915f19ba87af3ce08d2597f169b8ad1",
      "candidate_info": {
        "commit_hash": "8e54d629b915f19ba87af3ce08d2597f169b8ad1",
        "repo": "saltstack/salt",
        "commit_url": "https://github.com/saltstack/salt/commit/8e54d629b915f19ba87af3ce08d2597f169b8ad1",
        "files": [
          "noxfile.py"
        ],
        "message": "Exclude package tests from the `ci-test-onedir` target\n\nSigned-off-by: Pedro Algarvio <palgarvio@vmware.com>",
        "before_after_code_files": [
          "noxfile.py||noxfile.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/saltstack/salt/pull/65969"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "noxfile.py||noxfile.py": [
          "File: noxfile.py -> noxfile.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "1056:     if onedir:",
          "1057:         env[\"ONEDIR_TESTRUN\"] = \"1\"",
          "1058:     chunks = {",
          "1059:         \"unit\": [",
          "1060:             \"tests/unit\",",
          "1061:             \"tests/pytests/unit\",",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1059:         \"pkg\": [",
          "1060:             \"tests/pytests/pkg\",",
          "1061:         ],",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1063:         \"functional\": [",
          "1064:             \"tests/pytests/functional\",",
          "1065:         ],",
          "1067:     }",
          "1069:     test_group_number = os.environ.get(\"TEST_GROUP\") or \"1\"",
          "",
          "[Removed Lines]",
          "1066:         \"scenarios\": [\"tests/pytests/scenarios\"],",
          "",
          "[Added Lines]",
          "1069:         \"scenarios\": [",
          "1070:             \"tests/pytests/scenarios\",",
          "1071:         ],",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "81905044bd7806571fe507e76425f2045af28b9a",
      "candidate_info": {
        "commit_hash": "81905044bd7806571fe507e76425f2045af28b9a",
        "repo": "saltstack/salt",
        "commit_url": "https://github.com/saltstack/salt/commit/81905044bd7806571fe507e76425f2045af28b9a",
        "files": [
          "tools/ci.py"
        ],
        "message": "Increase concurrency in CI pipelines.\n\nSigned-off-by: Pedro Algarvio <palgarvio@vmware.com>",
        "before_after_code_files": [
          "tools/ci.py||tools/ci.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/saltstack/salt/pull/65969"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "tools/ci.py||tools/ci.py": [
          "File: tools/ci.py -> tools/ci.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "656:         \"functional\": 3,",
          "657:         \"integration\": 5,",
          "658:         \"scenarios\": 1,",
          "660:     }",
          "661:     # On nightly and scheduled builds we don't want splits at all",
          "662:     if workflow.lower() in (\"nightly\", \"scheduled\"):",
          "",
          "[Removed Lines]",
          "659:         \"unit\": 2,",
          "",
          "[Added Lines]",
          "659:         \"unit\": 4,",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "4371d34ee09971b681537736e6eb5129028ad177",
      "candidate_info": {
        "commit_hash": "4371d34ee09971b681537736e6eb5129028ad177",
        "repo": "saltstack/salt",
        "commit_url": "https://github.com/saltstack/salt/commit/4371d34ee09971b681537736e6eb5129028ad177",
        "files": [
          ".github/workflows/build-deps-ci-action.yml",
          ".github/workflows/ci.yml",
          ".github/workflows/nightly.yml",
          ".github/workflows/release.yml",
          ".github/workflows/scheduled.yml",
          ".github/workflows/staging.yml",
          ".github/workflows/templates/build-ci-deps.yml.jinja",
          ".github/workflows/templates/build-deps-ci-action.yml.jinja",
          ".github/workflows/templates/layout.yml.jinja",
          ".github/workflows/templates/release.yml.jinja",
          ".github/workflows/templates/test-package-downloads-action.yml.jinja",
          ".github/workflows/templates/test-salt-pkg-repo-downloads.yml.jinja",
          ".github/workflows/templates/test-salt-pkg.yml.jinja",
          ".github/workflows/templates/test-salt.yml.jinja",
          ".github/workflows/test-action-linux.yml",
          ".github/workflows/test-action-macos.yml",
          ".github/workflows/test-action-windows.yml",
          ".github/workflows/test-package-downloads-action.yml",
          ".github/workflows/test-packages-action-linux.yml",
          ".github/workflows/test-packages-action-macos.yml",
          ".github/workflows/test-packages-action-windows.yml"
        ],
        "message": "Now the hashes will match, no more windows line breaks to mess it up\n\nSigned-off-by: Pedro Algarvio <palgarvio@vmware.com>",
        "before_after_code_files": [
          ".github/workflows/templates/build-ci-deps.yml.jinja||.github/workflows/templates/build-ci-deps.yml.jinja",
          ".github/workflows/templates/build-deps-ci-action.yml.jinja||.github/workflows/templates/build-deps-ci-action.yml.jinja",
          ".github/workflows/templates/layout.yml.jinja||.github/workflows/templates/layout.yml.jinja",
          ".github/workflows/templates/release.yml.jinja||.github/workflows/templates/release.yml.jinja",
          ".github/workflows/templates/test-package-downloads-action.yml.jinja||.github/workflows/templates/test-package-downloads-action.yml.jinja",
          ".github/workflows/templates/test-salt-pkg-repo-downloads.yml.jinja||.github/workflows/templates/test-salt-pkg-repo-downloads.yml.jinja",
          ".github/workflows/templates/test-salt-pkg.yml.jinja||.github/workflows/templates/test-salt-pkg.yml.jinja",
          ".github/workflows/templates/test-salt.yml.jinja||.github/workflows/templates/test-salt.yml.jinja"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/saltstack/salt/pull/65969"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        ".github/workflows/templates/build-ci-deps.yml.jinja||.github/workflows/templates/build-ci-deps.yml.jinja": [
          "File: .github/workflows/templates/build-ci-deps.yml.jinja -> .github/workflows/templates/build-ci-deps.yml.jinja",
          "--- Hunk 1 ---",
          "[Context before]",
          "19:       python-version: \"<{ gh_actions_workflows_python_version }>\"",
          "20:       salt-version: \"${{ needs.prepare-workflow.outputs.salt-version }}\"",
          "21:       cache-prefix: ${{ needs.prepare-workflow.outputs.cache-seed }}|<{ python_version }>",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "22:       nox-archive-hash: \"${{ needs.prepare-workflow.outputs.nox-archive-hash }}\"",
          "",
          "---------------"
        ],
        ".github/workflows/templates/build-deps-ci-action.yml.jinja||.github/workflows/templates/build-deps-ci-action.yml.jinja": [
          "File: .github/workflows/templates/build-deps-ci-action.yml.jinja -> .github/workflows/templates/build-deps-ci-action.yml.jinja",
          "--- Hunk 1 ---",
          "[Context before]",
          "20:         required: true",
          "21:         type: string",
          "22:         description: The nox version to install",
          "23:       python-version:",
          "24:         required: false",
          "25:         type: string",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "23:       nox-archive-hash:",
          "24:         required: true",
          "25:         type: string",
          "26:         description: Nox Tarball Cache Hash",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "71:         uses: actions/cache@v3.3.1",
          "72:         with:",
          "73:           path: nox.linux.${{ matrix.arch }}.tar.*",
          "78:       - name: Download Onedir Tarball as an Artifact",
          "79:         if: steps.nox-dependencies-cache.outputs.cache-hit != 'true'",
          "",
          "[Removed Lines]",
          "74:           key: ${{ inputs.cache-prefix }}|testrun-deps|${{ matrix.arch }}|linux|${{ inputs.nox-session }}|${{ inputs.python-version }}|${{",
          "75:               hashFiles('requirements/**/*.txt', 'cicd/golden-images.json', 'noxfile.py')",
          "76:             }}",
          "",
          "[Added Lines]",
          "78:           key: ${{ inputs.cache-prefix }}|testrun-deps|${{ matrix.arch }}|linux|${{ inputs.nox-session }}|${{ inputs.python-version }}|${{ inputs.nox-archive-hash }}",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "182:         uses: actions/cache@v3.3.1",
          "183:         with:",
          "184:           path: nox.macos.${{ matrix.arch }}.tar.*",
          "189:       - name: Download Onedir Tarball as an Artifact",
          "190:         if: steps.nox-dependencies-cache.outputs.cache-hit != 'true'",
          "",
          "[Removed Lines]",
          "185:           key: ${{ inputs.cache-prefix }}|testrun-deps|${{ matrix.arch }}|macos|${{ inputs.nox-session }}|${{ inputs.python-version }}|${{",
          "186:               hashFiles('requirements/**/*.txt', 'cicd/golden-images.json', 'noxfile.py')",
          "187:             }}",
          "",
          "[Added Lines]",
          "187:           key: ${{ inputs.cache-prefix }}|testrun-deps|${{ matrix.arch }}|macos|${{ inputs.nox-session }}|${{ inputs.python-version }}|${{ inputs.nox-archive-hash }}",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "272:         uses: actions/cache@v3.3.1",
          "273:         with:",
          "274:           path: nox.windows.${{ matrix.arch }}.tar.*",
          "279:       - name: Download Onedir Tarball as an Artifact",
          "280:         if: steps.nox-dependencies-cache.outputs.cache-hit != 'true'",
          "",
          "[Removed Lines]",
          "275:           key: ${{ inputs.cache-prefix }}|testrun-deps|${{ matrix.arch }}|windows|${{ inputs.nox-session }}|${{ inputs.python-version }}|${{",
          "276:               hashFiles('requirements/**/*.txt', 'cicd/golden-images.json', 'noxfile.py')",
          "277:             }}",
          "",
          "[Added Lines]",
          "275:           key: ${{ inputs.cache-prefix }}|testrun-deps|${{ matrix.arch }}|windows|${{ inputs.nox-session }}|${{ inputs.python-version }}|${{ inputs.nox-archive-hash }}",
          "",
          "---------------"
        ],
        ".github/workflows/templates/layout.yml.jinja||.github/workflows/templates/layout.yml.jinja": [
          "File: .github/workflows/templates/layout.yml.jinja -> .github/workflows/templates/layout.yml.jinja",
          "--- Hunk 1 ---",
          "[Context before]",
          "96:       latest-release: ${{ steps.get-salt-releases.outputs.latest-release }}",
          "97:       releases: ${{ steps.get-salt-releases.outputs.releases }}",
          "98:       testing-releases: ${{ steps.get-testing-releases.outputs.testing-releases }}",
          "99:     steps:",
          "100:       - uses: actions/checkout@v4",
          "101:         with:",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "99:       nox-archive-hash: ${{ steps.nox-archive-hash.outputs.nox-archive-hash }}",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "212:         run: |",
          "213:           tools ci get-pr-test-labels --repository ${{ github.repository }}",
          "215:       <%- if prepare_actual_release %>",
          "217:       - name: Check Existing Releases",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "216:       - name: Get Hash For Nox Tarball Cache",
          "217:         id: nox-archive-hash",
          "218:         run: |",
          "219:           echo \"nox-archive-hash=${{ hashFiles('requirements/**/*.txt', 'cicd/golden-images.json', 'noxfile.py') }}\" | tee -a \"$GITHUB_OUTPUT\"",
          "",
          "---------------"
        ],
        ".github/workflows/templates/release.yml.jinja||.github/workflows/templates/release.yml.jinja": [
          "File: .github/workflows/templates/release.yml.jinja -> .github/workflows/templates/release.yml.jinja",
          "--- Hunk 1 ---",
          "[Context before]",
          "86:       cache-seed: ${{ steps.set-cache-seed.outputs.cache-seed }}",
          "87:       latest-release: ${{ steps.get-salt-releases.outputs.latest-release }}",
          "88:       releases: ${{ steps.get-salt-releases.outputs.releases }}",
          "89:     steps:",
          "90:       - uses: actions/checkout@v4",
          "91:         with:",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "89:       nox-archive-hash: ${{ steps.nox-archive-hash.outputs.nox-archive-hash }}",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "144:         run: |",
          "145:           tools ci define-cache-seed ${{ env.CACHE_SEED }}",
          "147:   <%- endblock prepare_workflow_job %>",
          "148:   <%- endif %>",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "148:       - name: Get Hash For Nox Tarball Cache",
          "149:         id: nox-archive-hash",
          "150:         run: |",
          "151:           echo \"nox-archive-hash=${{ hashFiles('requirements/**/*.txt', 'cicd/golden-images.json', 'noxfile.py') }}\" | tee -a \"$GITHUB_OUTPUT\"",
          "",
          "---------------"
        ],
        ".github/workflows/templates/test-package-downloads-action.yml.jinja||.github/workflows/templates/test-package-downloads-action.yml.jinja": [
          "File: .github/workflows/templates/test-package-downloads-action.yml.jinja -> .github/workflows/templates/test-package-downloads-action.yml.jinja",
          "--- Hunk 1 ---",
          "[Context before]",
          "23:         required: true",
          "24:         type: string",
          "25:         description: The nox version to install",
          "26:       python-version:",
          "27:         required: false",
          "28:         type: string",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "26:       nox-archive-hash:",
          "27:         required: true",
          "28:         type: string",
          "29:         description: Nox Tarball Cache Hash",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "98:         uses: actions/cache@v3.3.1",
          "99:         with:",
          "100:           path: nox.linux.${{ matrix.arch }}.tar.*",
          "104:           # If we get a cache miss here it means the dependencies step failed to save the cache",
          "105:           fail-on-cache-miss: true",
          "",
          "[Removed Lines]",
          "101:           key: ${{ inputs.cache-prefix }}|testrun-deps|${{ matrix.arch }}|linux|${{ inputs.nox-session }}|${{ inputs.python-version }}|${{",
          "102:               hashFiles('requirements/**/*.txt', 'cicd/golden-images.json', 'noxfile.py')",
          "103:             }}",
          "",
          "[Added Lines]",
          "105:           key: ${{ inputs.cache-prefix }}|testrun-deps|${{ matrix.arch }}|linux|${{ inputs.nox-session }}|${{ inputs.python-version }}|${{ inputs.nox-archive-hash }}",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "346:         uses: actions/cache@v3.3.1",
          "347:         with:",
          "348:           path: nox.macos.${{ matrix.arch }}.tar.*",
          "352:           # If we get a cache miss here it means the dependencies step failed to save the cache",
          "353:           fail-on-cache-miss: true",
          "",
          "[Removed Lines]",
          "349:           key: ${{ inputs.cache-prefix }}|testrun-deps|${{ matrix.arch }}|macos|${{ inputs.nox-session }}|${{ inputs.python-version }}|${{",
          "350:               hashFiles('requirements/**/*.txt', 'cicd/golden-images.json', 'noxfile.py')",
          "351:             }}",
          "",
          "[Added Lines]",
          "351:           key: ${{ inputs.cache-prefix }}|testrun-deps|${{ matrix.arch }}|macos|${{ inputs.nox-session }}|${{ inputs.python-version }}|${{ inputs.nox-archive-hash }}",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "549:         uses: actions/cache@v3.3.1",
          "550:         with:",
          "551:           path: nox.windows.${{ matrix.arch }}.tar.*",
          "555:           # If we get a cache miss here it means the dependencies step failed to save the cache",
          "556:           fail-on-cache-miss: true",
          "",
          "[Removed Lines]",
          "552:           key: ${{ inputs.cache-prefix }}|testrun-deps|${{ matrix.arch }}|windows|${{ inputs.nox-session }}|${{ inputs.python-version }}|${{",
          "553:               hashFiles('requirements/**/*.txt', 'cicd/golden-images.json', 'noxfile.py')",
          "554:             }}",
          "",
          "[Added Lines]",
          "552:           key: ${{ inputs.cache-prefix }}|testrun-deps|${{ matrix.arch }}|windows|${{ inputs.nox-session }}|${{ inputs.python-version }}|${{ inputs.nox-archive-hash }}",
          "",
          "---------------"
        ],
        ".github/workflows/templates/test-salt-pkg-repo-downloads.yml.jinja||.github/workflows/templates/test-salt-pkg-repo-downloads.yml.jinja": [
          "File: .github/workflows/templates/test-salt-pkg-repo-downloads.yml.jinja -> .github/workflows/templates/test-salt-pkg-repo-downloads.yml.jinja",
          "--- Hunk 1 ---",
          "[Context before]",
          "31:       python-version: \"<{ gh_actions_workflows_python_version }>\"",
          "32:       skip-code-coverage: true",
          "33:       latest-release: \"${{ needs.prepare-workflow.outputs.latest-release }}\"",
          "34:     secrets: inherit",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "34:       nox-archive-hash: \"${{ needs.prepare-workflow.outputs.nox-archive-hash }}\"",
          "",
          "---------------"
        ],
        ".github/workflows/templates/test-salt-pkg.yml.jinja||.github/workflows/templates/test-salt-pkg.yml.jinja": [
          "File: .github/workflows/templates/test-salt-pkg.yml.jinja -> .github/workflows/templates/test-salt-pkg.yml.jinja",
          "--- Hunk 1 ---",
          "[Context before]",
          "23:       skip-code-coverage: <{ skip_test_coverage_check }>",
          "24:       skip-junit-reports: <{ skip_junit_reports_check }>",
          "25:       testing-releases: ${{ needs.prepare-workflow.outputs.testing-releases }}",
          "26:     <%- if fips == \"fips\" %>",
          "27:       fips: true",
          "28:     <%- endif %>",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "26:       nox-archive-hash: \"${{ needs.prepare-workflow.outputs.nox-archive-hash }}\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "56:       skip-code-coverage: <{ skip_test_coverage_check }>",
          "57:       skip-junit-reports: <{ skip_junit_reports_check }>",
          "58:       testing-releases: ${{ needs.prepare-workflow.outputs.testing-releases }}",
          "60:   <%- endfor %>",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "60:       nox-archive-hash: \"${{ needs.prepare-workflow.outputs.nox-archive-hash }}\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "86:       skip-code-coverage: <{ skip_test_coverage_check }>",
          "87:       skip-junit-reports: <{ skip_junit_reports_check }>",
          "88:       testing-releases: ${{ needs.prepare-workflow.outputs.testing-releases }}",
          "90:     <%- endfor %>",
          "91:   <%- endfor %>",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "91:       nox-archive-hash: \"${{ needs.prepare-workflow.outputs.nox-archive-hash }}\"",
          "",
          "---------------"
        ],
        ".github/workflows/templates/test-salt.yml.jinja||.github/workflows/templates/test-salt.yml.jinja": [
          "File: .github/workflows/templates/test-salt.yml.jinja -> .github/workflows/templates/test-salt.yml.jinja",
          "--- Hunk 1 ---",
          "[Context before]",
          "28:       skip-junit-reports: <{ skip_junit_reports_check }>",
          "29:       workflow-slug: <{ workflow_slug }>",
          "30:       default-timeout: <{ timeout_value }>",
          "32:   <%- endfor %>",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "31:       nox-archive-hash: \"${{ needs.prepare-workflow.outputs.nox-archive-hash }}\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "56:       skip-junit-reports: <{ skip_junit_reports_check }>",
          "57:       workflow-slug: <{ workflow_slug }>",
          "58:       default-timeout: <{ timeout_value }>",
          "60:   <%- endfor %>",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "60:       nox-archive-hash: \"${{ needs.prepare-workflow.outputs.nox-archive-hash }}\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "83:       skip-junit-reports: <{ skip_junit_reports_check }>",
          "84:       workflow-slug: <{ workflow_slug }>",
          "85:       default-timeout: <{ timeout_value }>",
          "86:     <%- if fips == \"fips\" %>",
          "87:       fips: true",
          "88:     <%- endif %>",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "88:       nox-archive-hash: \"${{ needs.prepare-workflow.outputs.nox-archive-hash }}\"",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "4ec9295d7dfc406ddb76b51bebcd2b403f62d787",
      "candidate_info": {
        "commit_hash": "4ec9295d7dfc406ddb76b51bebcd2b403f62d787",
        "repo": "saltstack/salt",
        "commit_url": "https://github.com/saltstack/salt/commit/4ec9295d7dfc406ddb76b51bebcd2b403f62d787",
        "files": [
          "salt/modules/aptpkg.py",
          "tests/pytests/unit/modules/test_aptpkg.py"
        ],
        "message": "Remove deprecation warning which turned into an error on Jan 2024\n\nSigned-off-by: Pedro Algarvio <palgarvio@vmware.com>",
        "before_after_code_files": [
          "salt/modules/aptpkg.py||salt/modules/aptpkg.py",
          "tests/pytests/unit/modules/test_aptpkg.py||tests/pytests/unit/modules/test_aptpkg.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/saltstack/salt/pull/65969"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "salt/modules/aptpkg.py||salt/modules/aptpkg.py": [
          "File: salt/modules/aptpkg.py -> salt/modules/aptpkg.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "47:     SaltInvocationError,",
          "48: )",
          "49: from salt.modules.cmdmod import _parse_env",
          "52: log = logging.getLogger(__name__)",
          "",
          "[Removed Lines]",
          "50: from salt.utils.versions import warn_until_date",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "3113:     return sanitized",
          "3149: def _parse_selections(dpkgselection):",
          "3150:     \"\"\"",
          "3151:     Parses the format from ``dpkg --get-selections`` and return a format that",
          "",
          "[Removed Lines]",
          "3116: def expand_repo_def(**kwargs):",
          "3117:     \"\"\"",
          "3118:     Take a repository definition and expand it to the full pkg repository dict",
          "3119:     that can be used for comparison.  This is a helper function to make",
          "3120:     the Debian/Ubuntu apt sources sane for comparison in the pkgrepo states.",
          "3122:     This is designed to be called from pkgrepo states and will have little use",
          "3123:     being called on the CLI.",
          "3125:     CLI Examples:",
          "3127:     .. code-block:: bash",
          "3129:         NOT USABLE IN THE CLI",
          "3130:     \"\"\"",
          "3131:     warn_until_date(",
          "3132:         \"20240101\",",
          "3133:         \"The pkg.expand_repo_def function is deprecated and set for removal \"",
          "3134:         \"after {date}. This is only unsed internally by the apt pkg state \"",
          "3135:         \"module. If that's not the case, please file an new issue requesting \"",
          "3136:         \"the removal of this deprecation warning\",",
          "3137:         stacklevel=3,",
          "3138:     )",
          "3139:     if \"os_name\" not in kwargs:",
          "3140:         kwargs[\"os_name\"] = __grains__[\"os\"]",
          "3141:     if \"os_codename\" not in kwargs:",
          "3142:         if \"lsb_distrib_codename\" in kwargs:",
          "3143:             kwargs[\"os_codename\"] = kwargs[\"lsb_distrib_codename\"]",
          "3144:         else:",
          "3145:             kwargs[\"os_codename\"] = __grains__.get(\"oscodename\")",
          "3146:     return _expand_repo_def(**kwargs)",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "tests/pytests/unit/modules/test_aptpkg.py||tests/pytests/unit/modules/test_aptpkg.py": [
          "File: tests/pytests/unit/modules/test_aptpkg.py -> tests/pytests/unit/modules/test_aptpkg.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "1270:     # Valid source",
          "1271:     repo = \"# deb cdrom:[Debian GNU/Linux 11.4.0 _Bullseye_ - Official amd64 NETINST 20220709-10:31]/ bullseye main\\n\"",
          "1275:     assert isinstance(sanitized, dict)",
          "1276:     assert \"uri\" in sanitized",
          "",
          "[Removed Lines]",
          "1272:     sanitized = aptpkg.expand_repo_def(os_name=\"debian\", repo=repo, file=source_file)",
          "1273:     log.warning(\"SAN: %s\", sanitized)",
          "",
          "[Added Lines]",
          "1272:     sanitized = aptpkg._expand_repo_def(os_name=\"debian\", repo=repo, file=source_file)",
          "1273:     log.debug(\"SAN: %s\", sanitized)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1281:     # Pass the architecture and make sure it is added the the line attribute",
          "1282:     repo = \"deb http://cdn-aws.deb.debian.org/debian/ stretch main\\n\"",
          "1284:         os_name=\"debian\", repo=repo, file=source_file, architectures=\"amd64\"",
          "1285:     )",
          "",
          "[Removed Lines]",
          "1283:     sanitized = aptpkg.expand_repo_def(",
          "",
          "[Added Lines]",
          "1283:     sanitized = aptpkg._expand_repo_def(",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "6bb31e253449cd4c25c2599257ff895947273b74",
      "candidate_info": {
        "commit_hash": "6bb31e253449cd4c25c2599257ff895947273b74",
        "repo": "saltstack/salt",
        "commit_url": "https://github.com/saltstack/salt/commit/6bb31e253449cd4c25c2599257ff895947273b74",
        "files": [
          "pkg/debian/rules",
          "pkg/rpm/salt.spec"
        ],
        "message": "Fix source package build\n\nSigned-off-by: Pedro Algarvio <palgarvio@vmware.com>",
        "before_after_code_files": [
          "pkg/rpm/salt.spec||pkg/rpm/salt.spec"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/saltstack/salt/pull/65969"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "pkg/rpm/salt.spec||pkg/rpm/salt.spec": [
          "File: pkg/rpm/salt.spec -> pkg/rpm/salt.spec",
          "--- Hunk 1 ---",
          "[Context before]",
          "169:   export FETCH_RELENV_VERSION=${SALT_RELENV_VERSION}",
          "170:   export PY=$(build/venv/bin/python3 -c 'import sys; sys.stdout.write(\"{}.{}\".format(*sys.version_info)); sys.stdout.flush()')",
          "171:   build/venv/bin/python3 -m pip install -r %{_salt_src}/requirements/static/ci/py${PY}/tools.txt",
          "174:   cd %{_salt_src}",
          "175:  $RPM_BUILD_DIR/build/venv/bin/tools pkg build onedir-dependencies --arch ${SALT_PACKAGE_ARCH} --relenv-version=${SALT_RELENV_VERSION} --python-version ${SALT_PYTHON_VERSION} --package-name $RPM_BUILD_DIR/build/salt --platform linux",
          "",
          "[Removed Lines]",
          "172:   build/venv/bin/relenv fetch --arch=${SALT_PACKAGE_ARCH} --python=${SALT_PYTHON_VERSION}",
          "173:   build/venv/bin/relenv toolchain fetch --arch=${SALT_PACKAGE_ARCH}",
          "",
          "[Added Lines]",
          "172:   build/venv/bin/relenv fetch --python=${SALT_PYTHON_VERSION}",
          "173:   build/venv/bin/relenv toolchain fetch",
          "",
          "---------------"
        ]
      }
    }
  ]
}