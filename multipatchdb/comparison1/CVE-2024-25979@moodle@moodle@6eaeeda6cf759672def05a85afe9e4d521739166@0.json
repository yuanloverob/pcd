{
  "cve_id": "CVE-2024-25979",
  "cve_desc": "The URL parameters accepted by forum search were not limited to the allowed parameters.",
  "repo": "moodle/moodle",
  "patch_hash": "6eaeeda6cf759672def05a85afe9e4d521739166",
  "patch_info": {
    "commit_hash": "6eaeeda6cf759672def05a85afe9e4d521739166",
    "repo": "moodle/moodle",
    "commit_url": "https://github.com/moodle/moodle/commit/6eaeeda6cf759672def05a85afe9e4d521739166",
    "files": [
      "mod/forum/search.php"
    ],
    "message": "MDL-69774 mod_forum: Restrict URL to accpet only expected params",
    "before_after_code_files": [
      "mod/forum/search.php||mod/forum/search.php"
    ]
  },
  "patch_diff": {
    "mod/forum/search.php||mod/forum/search.php": [
      "File: mod/forum/search.php -> mod/forum/search.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "69: }",
      "70: $starredonly = optional_param('starredonly', false, PARAM_BOOL); // Include only favourites.",
      "72: $PAGE->set_pagelayout('standard');",
      "74: $PAGE->set_secondary_active_tab(\"coursehome\");",
      "76: if (empty($search)) {   // Check the other parameters instead",
      "",
      "[Removed Lines]",
      "73: $PAGE->set_url($FULLME); //TODO: this is very sloppy --skodak",
      "",
      "[Added Lines]",
      "72: $params = [",
      "73:     'id' => $id,",
      "74:     'perpage' => $perpage,",
      "75: ];",
      "77: if ($search !== '') {",
      "78:     $params['search'] = $search;",
      "79: }",
      "81: if ($page) {",
      "82:     $params['page'] = $page;",
      "83: }",
      "85: if ($showform) {",
      "86:     $params['showform'] = $showform;",
      "87: }",
      "89: if ($user !== '') {",
      "90:     $params['user'] = $user;",
      "91: }",
      "93: if ($userid) {",
      "94:     $params['userid'] = $userid;",
      "95: }",
      "97: if ($forumid) {",
      "98:     $params['forumid'] = $forumid;",
      "99: }",
      "101: if ($subject !== '') {",
      "102:     $params['subject'] = $subject;",
      "103: }",
      "105: if ($phrase !== '') {",
      "106:     $params['phrase'] = $phrase;",
      "107: }",
      "109: if ($words !== '') {",
      "110:     $params['words'] = $words;",
      "111: }",
      "113: if ($fullwords !== '') {",
      "114:     $params['fullwords'] = $fullwords;",
      "115: }",
      "117: if ($notwords !== '') {",
      "118:     $params['notwords'] = $notwords;",
      "119: }",
      "121: if ($timefromrestrict) {",
      "122:     $params['timefromrestrict'] = $timefromrestrict;",
      "123: }",
      "125: if ($fromday) {",
      "126:     $params['fromday'] = $fromday;",
      "127: }",
      "129: if ($fromhour) {",
      "130:     $params['fromhour'] = $fromhour;",
      "131: }",
      "133: if ($fromminute) {",
      "134:     $params['fromminute'] = $fromminute;",
      "135: }",
      "137: if ($frommonth) {",
      "138:     $params['frommonth'] = $frommonth;",
      "139: }",
      "141: if ($fromyear) {",
      "142:     $params['fromyear'] = $fromyear;",
      "143: }",
      "145: if ($datefrom) {",
      "146:     $params['datefrom'] = $datefrom;",
      "147: }",
      "149: if ($timetorestrict) {",
      "150:     $params['timetorestrict'] = $timetorestrict;",
      "151: }",
      "153: if ($today) {",
      "154:     $params['today'] = $today;",
      "155: }",
      "157: if ($tohour) {",
      "158:     $params['tohour'] = $tohour;",
      "159: }",
      "161: if ($tominute) {",
      "162:     $params['tominute'] = $tominute;",
      "163: }",
      "165: if ($tomonth) {",
      "166:     $params['tomonth'] = $tomonth;",
      "167: }",
      "169: if ($toyear) {",
      "170:     $params['toyear'] = $toyear;",
      "171: }",
      "173: if ($dateto) {",
      "174:     $params['dateto'] = $dateto;",
      "175: }",
      "177: if ($starredonly) {",
      "178:     $params['starredonly'] = $starredonly;",
      "179: }",
      "182: $PAGE->set_url(new moodle_url('/mod/forum/search.php', $params));",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "26ed8fda6ce5332c0702e96e4c0e16a465d32fb3",
      "candidate_info": {
        "commit_hash": "26ed8fda6ce5332c0702e96e4c0e16a465d32fb3",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/26ed8fda6ce5332c0702e96e4c0e16a465d32fb3",
        "files": [
          "mod/forum/search.php"
        ],
        "message": "MDL-69774 mod_forum: Restrict URL to accpet only expected params",
        "before_after_code_files": [
          "mod/forum/search.php||mod/forum/search.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "mod/forum/search.php||mod/forum/search.php"
          ],
          "candidate": [
            "mod/forum/search.php||mod/forum/search.php"
          ]
        }
      },
      "candidate_diff": {
        "mod/forum/search.php||mod/forum/search.php": [
          "File: mod/forum/search.php -> mod/forum/search.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "69: }",
          "70: $starredonly = optional_param('starredonly', false, PARAM_BOOL); // Include only favourites.",
          "72: $PAGE->set_pagelayout('standard');",
          "74: $PAGE->set_secondary_active_tab(\"coursehome\");",
          "76: if (empty($search)) {   // Check the other parameters instead",
          "",
          "[Removed Lines]",
          "73: $PAGE->set_url($FULLME); //TODO: this is very sloppy --skodak",
          "",
          "[Added Lines]",
          "72: $params = [",
          "73:     'id' => $id,",
          "74:     'perpage' => $perpage,",
          "75: ];",
          "77: if ($search !== '') {",
          "78:     $params['search'] = $search;",
          "79: }",
          "81: if ($page) {",
          "82:     $params['page'] = $page;",
          "83: }",
          "85: if ($showform) {",
          "86:     $params['showform'] = $showform;",
          "87: }",
          "89: if ($user !== '') {",
          "90:     $params['user'] = $user;",
          "91: }",
          "93: if ($userid) {",
          "94:     $params['userid'] = $userid;",
          "95: }",
          "97: if ($forumid) {",
          "98:     $params['forumid'] = $forumid;",
          "99: }",
          "101: if ($subject !== '') {",
          "102:     $params['subject'] = $subject;",
          "103: }",
          "105: if ($phrase !== '') {",
          "106:     $params['phrase'] = $phrase;",
          "107: }",
          "109: if ($words !== '') {",
          "110:     $params['words'] = $words;",
          "111: }",
          "113: if ($fullwords !== '') {",
          "114:     $params['fullwords'] = $fullwords;",
          "115: }",
          "117: if ($notwords !== '') {",
          "118:     $params['notwords'] = $notwords;",
          "119: }",
          "121: if ($timefromrestrict) {",
          "122:     $params['timefromrestrict'] = $timefromrestrict;",
          "123: }",
          "125: if ($fromday) {",
          "126:     $params['fromday'] = $fromday;",
          "127: }",
          "129: if ($fromhour) {",
          "130:     $params['fromhour'] = $fromhour;",
          "131: }",
          "133: if ($fromminute) {",
          "134:     $params['fromminute'] = $fromminute;",
          "135: }",
          "137: if ($frommonth) {",
          "138:     $params['frommonth'] = $frommonth;",
          "139: }",
          "141: if ($fromyear) {",
          "142:     $params['fromyear'] = $fromyear;",
          "143: }",
          "145: if ($datefrom) {",
          "146:     $params['datefrom'] = $datefrom;",
          "147: }",
          "149: if ($timetorestrict) {",
          "150:     $params['timetorestrict'] = $timetorestrict;",
          "151: }",
          "153: if ($today) {",
          "154:     $params['today'] = $today;",
          "155: }",
          "157: if ($tohour) {",
          "158:     $params['tohour'] = $tohour;",
          "159: }",
          "161: if ($tominute) {",
          "162:     $params['tominute'] = $tominute;",
          "163: }",
          "165: if ($tomonth) {",
          "166:     $params['tomonth'] = $tomonth;",
          "167: }",
          "169: if ($toyear) {",
          "170:     $params['toyear'] = $toyear;",
          "171: }",
          "173: if ($dateto) {",
          "174:     $params['dateto'] = $dateto;",
          "175: }",
          "177: if ($starredonly) {",
          "178:     $params['starredonly'] = $starredonly;",
          "179: }",
          "182: $PAGE->set_url(new moodle_url('/mod/forum/search.php', $params));",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "6a8d0fb2b0a82a4a746bf2a42b2d0d54716c45d5",
      "candidate_info": {
        "commit_hash": "6a8d0fb2b0a82a4a746bf2a42b2d0d54716c45d5",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/6a8d0fb2b0a82a4a746bf2a42b2d0d54716c45d5",
        "files": [
          "mod/forum/search.php"
        ],
        "message": "MDL-69774 mod_forum: Restrict URL to accpet only expected params",
        "before_after_code_files": [
          "mod/forum/search.php||mod/forum/search.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "mod/forum/search.php||mod/forum/search.php"
          ],
          "candidate": [
            "mod/forum/search.php||mod/forum/search.php"
          ]
        }
      },
      "candidate_diff": {
        "mod/forum/search.php||mod/forum/search.php": [
          "File: mod/forum/search.php -> mod/forum/search.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "69: }",
          "70: $starredonly = optional_param('starredonly', false, PARAM_BOOL); // Include only favourites.",
          "72: $PAGE->set_pagelayout('standard');",
          "74: $PAGE->set_secondary_active_tab(\"coursehome\");",
          "76: if (empty($search)) {   // Check the other parameters instead",
          "",
          "[Removed Lines]",
          "73: $PAGE->set_url($FULLME); //TODO: this is very sloppy --skodak",
          "",
          "[Added Lines]",
          "72: $params = [",
          "73:     'id' => $id,",
          "74:     'perpage' => $perpage,",
          "75: ];",
          "77: if ($search !== '') {",
          "78:     $params['search'] = $search;",
          "79: }",
          "81: if ($page) {",
          "82:     $params['page'] = $page;",
          "83: }",
          "85: if ($showform) {",
          "86:     $params['showform'] = $showform;",
          "87: }",
          "89: if ($user !== '') {",
          "90:     $params['user'] = $user;",
          "91: }",
          "93: if ($userid) {",
          "94:     $params['userid'] = $userid;",
          "95: }",
          "97: if ($forumid) {",
          "98:     $params['forumid'] = $forumid;",
          "99: }",
          "101: if ($subject !== '') {",
          "102:     $params['subject'] = $subject;",
          "103: }",
          "105: if ($phrase !== '') {",
          "106:     $params['phrase'] = $phrase;",
          "107: }",
          "109: if ($words !== '') {",
          "110:     $params['words'] = $words;",
          "111: }",
          "113: if ($fullwords !== '') {",
          "114:     $params['fullwords'] = $fullwords;",
          "115: }",
          "117: if ($notwords !== '') {",
          "118:     $params['notwords'] = $notwords;",
          "119: }",
          "121: if ($timefromrestrict) {",
          "122:     $params['timefromrestrict'] = $timefromrestrict;",
          "123: }",
          "125: if ($fromday) {",
          "126:     $params['fromday'] = $fromday;",
          "127: }",
          "129: if ($fromhour) {",
          "130:     $params['fromhour'] = $fromhour;",
          "131: }",
          "133: if ($fromminute) {",
          "134:     $params['fromminute'] = $fromminute;",
          "135: }",
          "137: if ($frommonth) {",
          "138:     $params['frommonth'] = $frommonth;",
          "139: }",
          "141: if ($fromyear) {",
          "142:     $params['fromyear'] = $fromyear;",
          "143: }",
          "145: if ($datefrom) {",
          "146:     $params['datefrom'] = $datefrom;",
          "147: }",
          "149: if ($timetorestrict) {",
          "150:     $params['timetorestrict'] = $timetorestrict;",
          "151: }",
          "153: if ($today) {",
          "154:     $params['today'] = $today;",
          "155: }",
          "157: if ($tohour) {",
          "158:     $params['tohour'] = $tohour;",
          "159: }",
          "161: if ($tominute) {",
          "162:     $params['tominute'] = $tominute;",
          "163: }",
          "165: if ($tomonth) {",
          "166:     $params['tomonth'] = $tomonth;",
          "167: }",
          "169: if ($toyear) {",
          "170:     $params['toyear'] = $toyear;",
          "171: }",
          "173: if ($dateto) {",
          "174:     $params['dateto'] = $dateto;",
          "175: }",
          "177: if ($starredonly) {",
          "178:     $params['starredonly'] = $starredonly;",
          "179: }",
          "182: $PAGE->set_url(new moodle_url('/mod/forum/search.php', $params));",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "61fb8ee988bd3b7779ef892a86d394b001891c23",
      "candidate_info": {
        "commit_hash": "61fb8ee988bd3b7779ef892a86d394b001891c23",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/61fb8ee988bd3b7779ef892a86d394b001891c23",
        "files": [
          "mod/forum/search.php"
        ],
        "message": "MDL-69774 mod_forum: Restrict URL to accpet only expected params",
        "before_after_code_files": [
          "mod/forum/search.php||mod/forum/search.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "mod/forum/search.php||mod/forum/search.php"
          ],
          "candidate": [
            "mod/forum/search.php||mod/forum/search.php"
          ]
        }
      },
      "candidate_diff": {
        "mod/forum/search.php||mod/forum/search.php": [
          "File: mod/forum/search.php -> mod/forum/search.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "69: }",
          "70: $starredonly = optional_param('starredonly', false, PARAM_BOOL); // Include only favourites.",
          "72: $PAGE->set_pagelayout('standard');",
          "74: $PAGE->set_secondary_active_tab(\"coursehome\");",
          "76: if (empty($search)) {   // Check the other parameters instead",
          "",
          "[Removed Lines]",
          "73: $PAGE->set_url($FULLME); //TODO: this is very sloppy --skodak",
          "",
          "[Added Lines]",
          "72: $params = [",
          "73:     'id' => $id,",
          "74:     'perpage' => $perpage,",
          "75: ];",
          "77: if ($search !== '') {",
          "78:     $params['search'] = $search;",
          "79: }",
          "81: if ($page) {",
          "82:     $params['page'] = $page;",
          "83: }",
          "85: if ($showform) {",
          "86:     $params['showform'] = $showform;",
          "87: }",
          "89: if ($user !== '') {",
          "90:     $params['user'] = $user;",
          "91: }",
          "93: if ($userid) {",
          "94:     $params['userid'] = $userid;",
          "95: }",
          "97: if ($forumid) {",
          "98:     $params['forumid'] = $forumid;",
          "99: }",
          "101: if ($subject !== '') {",
          "102:     $params['subject'] = $subject;",
          "103: }",
          "105: if ($phrase !== '') {",
          "106:     $params['phrase'] = $phrase;",
          "107: }",
          "109: if ($words !== '') {",
          "110:     $params['words'] = $words;",
          "111: }",
          "113: if ($fullwords !== '') {",
          "114:     $params['fullwords'] = $fullwords;",
          "115: }",
          "117: if ($notwords !== '') {",
          "118:     $params['notwords'] = $notwords;",
          "119: }",
          "121: if ($timefromrestrict) {",
          "122:     $params['timefromrestrict'] = $timefromrestrict;",
          "123: }",
          "125: if ($fromday) {",
          "126:     $params['fromday'] = $fromday;",
          "127: }",
          "129: if ($fromhour) {",
          "130:     $params['fromhour'] = $fromhour;",
          "131: }",
          "133: if ($fromminute) {",
          "134:     $params['fromminute'] = $fromminute;",
          "135: }",
          "137: if ($frommonth) {",
          "138:     $params['frommonth'] = $frommonth;",
          "139: }",
          "141: if ($fromyear) {",
          "142:     $params['fromyear'] = $fromyear;",
          "143: }",
          "145: if ($datefrom) {",
          "146:     $params['datefrom'] = $datefrom;",
          "147: }",
          "149: if ($timetorestrict) {",
          "150:     $params['timetorestrict'] = $timetorestrict;",
          "151: }",
          "153: if ($today) {",
          "154:     $params['today'] = $today;",
          "155: }",
          "157: if ($tohour) {",
          "158:     $params['tohour'] = $tohour;",
          "159: }",
          "161: if ($tominute) {",
          "162:     $params['tominute'] = $tominute;",
          "163: }",
          "165: if ($tomonth) {",
          "166:     $params['tomonth'] = $tomonth;",
          "167: }",
          "169: if ($toyear) {",
          "170:     $params['toyear'] = $toyear;",
          "171: }",
          "173: if ($dateto) {",
          "174:     $params['dateto'] = $dateto;",
          "175: }",
          "177: if ($starredonly) {",
          "178:     $params['starredonly'] = $starredonly;",
          "179: }",
          "182: $PAGE->set_url(new moodle_url('/mod/forum/search.php', $params));",
          "",
          "---------------"
        ]
      }
    }
  ]
}