{
  "cve_id": "CVE-2022-25892",
  "cve_desc": "The package muhammara before 2.6.1, from 3.0.0 and before 3.1.1; all versions of package hummus are vulnerable to Denial of Service (DoS) when supplied with a maliciously crafted PDF file to be parsed.",
  "repo": "julianhille/MuhammaraJS",
  "patch_hash": "90b278d09f16062d93a4160ef0a54d449d739c51",
  "patch_info": {
    "commit_hash": "90b278d09f16062d93a4160ef0a54d449d739c51",
    "repo": "julianhille/MuhammaraJS",
    "commit_url": "https://github.com/julianhille/MuhammaraJS/commit/90b278d09f16062d93a4160ef0a54d449d739c51",
    "files": [
      "CHANGELOG.md",
      "src/deps/PDFWriter/PDFParser.cpp",
      "tests/SigSeg.js",
      "tests/TestMaterials/BrokenPdfBadHeader.txt"
    ],
    "message": "Fix npe as backport for 2.x\n\nFixes #214",
    "before_after_code_files": [
      "src/deps/PDFWriter/PDFParser.cpp||src/deps/PDFWriter/PDFParser.cpp",
      "tests/SigSeg.js||tests/SigSeg.js"
    ]
  },
  "patch_diff": {
    "src/deps/PDFWriter/PDFParser.cpp||src/deps/PDFWriter/PDFParser.cpp": [
      "File: src/deps/PDFWriter/PDFParser.cpp -> src/deps/PDFWriter/PDFParser.cpp",
      "--- Hunk 1 ---",
      "[Context before]",
      "352:   mObjectParser.ResetReadState();",
      "353:   RefCountPtr<PDFObject> anObject(mObjectParser.ParseNewObject());",
      "355:   if(anObject->GetType() == PDFObject::ePDFObjectInteger)",
      "356:   {",
      "357:    mLastXrefPosition = (LongFilePositionType)((PDFInteger*)anObject.GetPtr())->GetValue();",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "355:   if (!anObject) {",
      "356:    status = PDFHummus::eFailure;",
      "357:    TRACE_LOG(\"PDFParser::ParseXrefPosition: Unable to find any object\");",
      "358:    break;",
      "359:   }",
      "",
      "---------------"
    ],
    "tests/SigSeg.js||tests/SigSeg.js": [
      "File: tests/SigSeg.js -> tests/SigSeg.js",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: var muhammara = require(\"../muhammara\");",
      "2: const { expect } = require(\"chai\");",
      "4: describe(\"SigSegv test\", function () {",
      "5:   it(\"should read fields correctly\", function () {",
      "6:     expect(() =>",
      "7:       muhammara.createReader(",
      "8:         __dirname + \"/TestMaterials/BrokenPdfBadHeader.txt\"",
      "9:       )",
      "10:     ).to.throw();",
      "11:   });",
      "12: });",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "26c505bc6931cb84f28906ed50d7eb60017ca6e5",
      "candidate_info": {
        "commit_hash": "26c505bc6931cb84f28906ed50d7eb60017ca6e5",
        "repo": "julianhille/MuhammaraJS",
        "commit_url": "https://github.com/julianhille/MuhammaraJS/commit/26c505bc6931cb84f28906ed50d7eb60017ca6e5",
        "files": [
          "src/deps/PDFWriter/DocumentContext.cpp"
        ],
        "message": "Fix segfault when using return value of GetPageTreeChild",
        "before_after_code_files": [
          "src/deps/PDFWriter/DocumentContext.cpp||src/deps/PDFWriter/DocumentContext.cpp"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/julianhille/MuhammaraJS/pull/238"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/deps/PDFWriter/DocumentContext.cpp||src/deps/PDFWriter/DocumentContext.cpp": [
          "File: src/deps/PDFWriter/DocumentContext.cpp -> src/deps/PDFWriter/DocumentContext.cpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "2398:         hasLeafs = pageTreeRoot->IsLeafParent();",
          "2399:         if(pageTreeRoot->GetNodesCount() == 0)",
          "2400:             break;",
          "2402:             pageTreeRoot = pageTreeRoot->GetPageTreeChild(0);",
          "2403:     }",
          "2405:     return hasLeafs;",
          "",
          "[Removed Lines]",
          "2401:         else",
          "",
          "[Added Lines]",
          "2401:         else {",
          "2403:             if (!pageTreeRoot)",
          "2404:                 break;",
          "2405:         }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "a0588a33efc68f22e4666d8576a57654f579d659",
      "candidate_info": {
        "commit_hash": "a0588a33efc68f22e4666d8576a57654f579d659",
        "repo": "julianhille/MuhammaraJS",
        "commit_url": "https://github.com/julianhille/MuhammaraJS/commit/a0588a33efc68f22e4666d8576a57654f579d659",
        "files": [
          "src/deps/PDFWriter/PDFParser.cpp"
        ],
        "message": "Found NP dereference in pdf parser",
        "before_after_code_files": [
          "src/deps/PDFWriter/PDFParser.cpp||src/deps/PDFWriter/PDFParser.cpp"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/julianhille/MuhammaraJS/pull/238"
        ],
        "olp_code_files": {
          "patch": [
            "src/deps/PDFWriter/PDFParser.cpp||src/deps/PDFWriter/PDFParser.cpp"
          ],
          "candidate": [
            "src/deps/PDFWriter/PDFParser.cpp||src/deps/PDFWriter/PDFParser.cpp"
          ]
        }
      },
      "candidate_diff": {
        "src/deps/PDFWriter/PDFParser.cpp||src/deps/PDFWriter/PDFParser.cpp": [
          "File: src/deps/PDFWriter/PDFParser.cpp -> src/deps/PDFWriter/PDFParser.cpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "390:    while(!foundStartXref && mStream->NotEnded())",
          "391:    {",
          "392:     PDFObjectCastPtr<PDFSymbol> startxRef(mObjectParser.ParseNewObject());",
          "393:     foundStartXref = startxRef.GetPtr() && (startxRef->GetValue() == scStartxref);",
          "394:    }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "393:     if(!startxRef)",
          "394:     {",
          "395:      status = PDFHummus::eFailure;",
          "396:         TRACE_LOG(\"PDFParser::ParseXrefPosition, syntax error in reading xref position\");",
          "397:         break;",
          "398:     }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "70290d0202a8efe7fce1bb50d75bc1dcc5775222",
      "candidate_info": {
        "commit_hash": "70290d0202a8efe7fce1bb50d75bc1dcc5775222",
        "repo": "julianhille/MuhammaraJS",
        "commit_url": "https://github.com/julianhille/MuhammaraJS/commit/70290d0202a8efe7fce1bb50d75bc1dcc5775222",
        "files": [
          "src/deps/PDFWriter/DecryptionHelper.cpp",
          "src/deps/PDFWriter/DocumentContext.cpp",
          "src/deps/PDFWriter/PDFPageInput.cpp"
        ],
        "message": "Fix a segfault through returning null in QueryObject",
        "before_after_code_files": [
          "src/deps/PDFWriter/DecryptionHelper.cpp||src/deps/PDFWriter/DecryptionHelper.cpp",
          "src/deps/PDFWriter/DocumentContext.cpp||src/deps/PDFWriter/DocumentContext.cpp",
          "src/deps/PDFWriter/PDFPageInput.cpp||src/deps/PDFWriter/PDFPageInput.cpp"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/julianhille/MuhammaraJS/pull/238"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/deps/PDFWriter/DecryptionHelper.cpp||src/deps/PDFWriter/DecryptionHelper.cpp": [
          "File: src/deps/PDFWriter/DecryptionHelper.cpp -> src/deps/PDFWriter/DecryptionHelper.cpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "409:    for (; i < filterObjectArray->GetLength(); ++i)",
          "410:    {",
          "411:     PDFObjectCastPtr<PDFName> filterObjectItem(filterObjectArray->QueryObject(i));",
          "413:      break;",
          "414:    }",
          "415:    if (i < filterObjectArray->GetLength()) {",
          "",
          "[Removed Lines]",
          "412:     if (filterObjectItem->GetValue() == \"Crypt\")",
          "",
          "[Added Lines]",
          "412:     if (!filterObjectItem || filterObjectItem->GetValue() == \"Crypt\")",
          "",
          "---------------"
        ],
        "src/deps/PDFWriter/DocumentContext.cpp||src/deps/PDFWriter/DocumentContext.cpp": [
          "File: src/deps/PDFWriter/DocumentContext.cpp -> src/deps/PDFWriter/DocumentContext.cpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "2176:     if(idArray.GetPtr() && idArray->GetLength() == 2)",
          "2177:     {",
          "2178:         PDFObjectCastPtr<PDFHexString> firstID = idArray->QueryObject(0);",
          "2180:             mModifiedDocumentID = firstID->GetValue();",
          "2181:     }",
          "",
          "[Removed Lines]",
          "2179:         if(firstID.GetPtr())",
          "",
          "[Added Lines]",
          "2179:         if(firstID != NULL && firstID.GetPtr())",
          "",
          "---------------"
        ],
        "src/deps/PDFWriter/PDFPageInput.cpp||src/deps/PDFWriter/PDFPageInput.cpp": [
          "File: src/deps/PDFWriter/PDFPageInput.cpp -> src/deps/PDFWriter/PDFPageInput.cpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "181:  RefCountPtr<PDFObject> lowerLeftY(inPDFArray->QueryObject(1));",
          "182:  RefCountPtr<PDFObject> upperRightX(inPDFArray->QueryObject(2));",
          "183:  RefCountPtr<PDFObject> upperRightY(inPDFArray->QueryObject(3));",
          "185:  outPDFRectangle.LowerLeftX = ParsedPrimitiveHelper(lowerLeftX.GetPtr()).GetAsDouble();",
          "186:  outPDFRectangle.LowerLeftY = ParsedPrimitiveHelper(lowerLeftY.GetPtr()).GetAsDouble();",
          "187:  outPDFRectangle.UpperRightX = ParsedPrimitiveHelper(upperRightX.GetPtr()).GetAsDouble();",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "184:  if (!lowerLeftX || !lowerLeftY || !upperRightX || !upperRightY)",
          "185:  {",
          "188:   TRACE_LOG(\"Could not apply pdf rectangle as values are NULL\");",
          "189:   return;",
          "190:  }",
          "",
          "---------------"
        ]
      }
    }
  ]
}