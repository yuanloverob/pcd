{
  "cve_id": "CVE-2023-6940",
  "cve_desc": "with only one user interaction(download a malicious config), attackers can gain full command execution on the victim system.",
  "repo": "mlflow/mlflow",
  "patch_hash": "a98a341a7222f894b7735db575ad9311ecaba4e3",
  "patch_info": {
    "commit_hash": "a98a341a7222f894b7735db575ad9311ecaba4e3",
    "repo": "mlflow/mlflow",
    "commit_url": "https://github.com/mlflow/mlflow/commit/a98a341a7222f894b7735db575ad9311ecaba4e3",
    "files": [
      "mlflow/utils/file_utils.py"
    ],
    "message": "Add sandboxed jinja2 loader for yaml rendering (#10676)\n\nSigned-off-by: Ben Wilson <benjamin.wilson@databricks.com>",
    "before_after_code_files": [
      "mlflow/utils/file_utils.py||mlflow/utils/file_utils.py"
    ]
  },
  "patch_diff": {
    "mlflow/utils/file_utils.py||mlflow/utils/file_utils.py": [
      "File: mlflow/utils/file_utils.py -> mlflow/utils/file_utils.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "329:     :param context_name: Name of the context file",
      "330:     :return: Data in yaml file as dictionary",
      "331:     \"\"\"",
      "334:     template_path = os.path.join(root, template_name)",
      "335:     context_path = os.path.join(root, context_name)",
      "",
      "[Removed Lines]",
      "332:     import jinja2",
      "",
      "[Added Lines]",
      "332:     from jinja2 import FileSystemLoader, StrictUndefined",
      "333:     from jinja2.sandbox import SandboxedEnvironment",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "338:         if not pathlib.Path(path).is_file():",
      "339:             raise MissingConfigException(f\"Yaml file '{path}' does not exist.\")",
      "344:         line_comment_prefix=\"#\",",
      "345:     )",
      "",
      "[Removed Lines]",
      "341:     j2_env = jinja2.Environment(",
      "342:         loader=jinja2.FileSystemLoader(root, encoding=ENCODING),",
      "343:         undefined=jinja2.StrictUndefined,",
      "",
      "[Added Lines]",
      "342:     j2_env = SandboxedEnvironment(",
      "343:         loader=FileSystemLoader(root, encoding=ENCODING),",
      "344:         undefined=StrictUndefined,",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "8029113817175cc9b9bed5c1bebe2f9afea2835b",
      "candidate_info": {
        "commit_hash": "8029113817175cc9b9bed5c1bebe2f9afea2835b",
        "repo": "mlflow/mlflow",
        "commit_url": "https://github.com/mlflow/mlflow/commit/8029113817175cc9b9bed5c1bebe2f9afea2835b",
        "files": [
          "mlflow/utils/file_utils.py"
        ],
        "message": "Add sandboxed jinja2 loader for yaml rendering (#10676)\n\nSigned-off-by: Ben Wilson <benjamin.wilson@databricks.com>",
        "before_after_code_files": [
          "mlflow/utils/file_utils.py||mlflow/utils/file_utils.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "mlflow/utils/file_utils.py||mlflow/utils/file_utils.py"
          ],
          "candidate": [
            "mlflow/utils/file_utils.py||mlflow/utils/file_utils.py"
          ]
        }
      },
      "candidate_diff": {
        "mlflow/utils/file_utils.py||mlflow/utils/file_utils.py": [
          "File: mlflow/utils/file_utils.py -> mlflow/utils/file_utils.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "329:     :param context_name: Name of the context file",
          "330:     :return: Data in yaml file as dictionary",
          "331:     \"\"\"",
          "334:     template_path = os.path.join(root, template_name)",
          "335:     context_path = os.path.join(root, context_name)",
          "",
          "[Removed Lines]",
          "332:     import jinja2",
          "",
          "[Added Lines]",
          "332:     from jinja2 import FileSystemLoader, StrictUndefined",
          "333:     from jinja2.sandbox import SandboxedEnvironment",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "338:         if not pathlib.Path(path).is_file():",
          "339:             raise MissingConfigException(f\"Yaml file '{path}' does not exist.\")",
          "344:         line_comment_prefix=\"#\",",
          "345:     )",
          "",
          "[Removed Lines]",
          "341:     j2_env = jinja2.Environment(",
          "342:         loader=jinja2.FileSystemLoader(root, encoding=ENCODING),",
          "343:         undefined=jinja2.StrictUndefined,",
          "",
          "[Added Lines]",
          "342:     j2_env = SandboxedEnvironment(",
          "343:         loader=FileSystemLoader(root, encoding=ENCODING),",
          "344:         undefined=StrictUndefined,",
          "",
          "---------------"
        ]
      }
    }
  ]
}