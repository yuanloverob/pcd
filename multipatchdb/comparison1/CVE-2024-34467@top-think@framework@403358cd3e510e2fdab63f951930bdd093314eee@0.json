{
  "cve_id": "CVE-2024-34467",
  "cve_desc": "ThinkPHP 8.0.3 allows remote attackers to exploit XSS due to inadequate filtering of function argument values in think_exception.tpl.",
  "repo": "top-think/framework",
  "patch_hash": "403358cd3e510e2fdab63f951930bdd093314eee",
  "patch_info": {
    "commit_hash": "403358cd3e510e2fdab63f951930bdd093314eee",
    "repo": "top-think/framework",
    "commit_url": "https://github.com/top-think/framework/commit/403358cd3e510e2fdab63f951930bdd093314eee",
    "files": [
      "src/tpl/think_exception.tpl"
    ],
    "message": "\u4fee\u6b63 $key \u672a\u7f16\u7801\n\n\u4fee\u6b63\u5f02\u5e38\u9875\u9762\u7684 XSS \u6f0f\u6d1e\n```http\nGET http://127.0.0.1:8080/?%3Cscript%3Eeval(atob(`YWxlcnQoJzEyMycp`))%3C/script%3E=1\n```\n\n```php\n<?php\n\nnamespace app\\controller;\n\nclass Index\n{\n    public function index(array $params)\n    {\n    }\n}\n```",
    "before_after_code_files": [
      "src/tpl/think_exception.tpl||src/tpl/think_exception.tpl"
    ]
  },
  "patch_diff": {
    "src/tpl/think_exception.tpl||src/tpl/think_exception.tpl": [
      "File: src/tpl/think_exception.tpl -> src/tpl/think_exception.tpl",
      "--- Hunk 1 ---",
      "[Context before]",
      "68:                     break;",
      "69:             }",
      "72:         }",
      "74:         return implode(', ', $result);",
      "",
      "[Removed Lines]",
      "71:             $result[] = is_int($key) ? $value : \"'{$key}' => {$value}\";",
      "",
      "[Added Lines]",
      "71:             $result[] = is_int($key) ? $value : sprintf('\\'%s\\' => %s', htmlentities($key), $value);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "289eb432fbabf4dd3d4a327b06e4d073679b08cc",
      "candidate_info": {
        "commit_hash": "289eb432fbabf4dd3d4a327b06e4d073679b08cc",
        "repo": "top-think/framework",
        "commit_url": "https://github.com/top-think/framework/commit/289eb432fbabf4dd3d4a327b06e4d073679b08cc",
        "files": [
          "src/tpl/think_exception.tpl"
        ],
        "message": "\u4fee\u6b63 $key \u672a\u7f16\u7801\n\n\u4fee\u6b63\u5f02\u5e38\u9875\u9762\u7684 XSS \u6f0f\u6d1e\n```http\nGET http://127.0.0.1:8080/?%3Cscript%3Eeval(atob(`YWxlcnQoJzEyMycp`))%3C/script%3E=1\n```\n\n```php\n<?php\n\nnamespace app\\controller;\n\nclass Index\n{\n    public function index(array $params)\n    {\n    }\n}\n```",
        "before_after_code_files": [
          "src/tpl/think_exception.tpl||src/tpl/think_exception.tpl"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "src/tpl/think_exception.tpl||src/tpl/think_exception.tpl"
          ],
          "candidate": [
            "src/tpl/think_exception.tpl||src/tpl/think_exception.tpl"
          ]
        }
      },
      "candidate_diff": {
        "src/tpl/think_exception.tpl||src/tpl/think_exception.tpl": [
          "File: src/tpl/think_exception.tpl -> src/tpl/think_exception.tpl",
          "--- Hunk 1 ---",
          "[Context before]",
          "68:                     break;",
          "69:             }",
          "72:         }",
          "74:         return implode(', ', $result);",
          "",
          "[Removed Lines]",
          "71:             $result[] = is_int($key) ? $value : \"'{$key}' => {$value}\";",
          "",
          "[Added Lines]",
          "71:             $result[] = is_int($key) ? $value : sprintf('\\'%s\\' => %s', htmlentities($key), $value);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "d1cf82166e14817f1235a985c64c01bd89d7b58a",
      "candidate_info": {
        "commit_hash": "d1cf82166e14817f1235a985c64c01bd89d7b58a",
        "repo": "top-think/framework",
        "commit_url": "https://github.com/top-think/framework/commit/d1cf82166e14817f1235a985c64c01bd89d7b58a",
        "files": [
          "src/tpl/think_exception.tpl"
        ],
        "message": "\u4fee\u6b63 $key \u672a\u7f16\u7801\n\n\u4fee\u6b63\u5f02\u5e38\u9875\u9762\u7684 XSS \u6f0f\u6d1e\n```http\nGET http://127.0.0.1:8080/?%3Cscript%3Eeval(atob(`YWxlcnQoJzEyMycp`))%3C/script%3E=1\n```\n\n```php\n<?php\n\nnamespace app\\controller;\n\nclass Index\n{\n    public function index(array $params)\n    {\n    }\n}\n```",
        "before_after_code_files": [
          "src/tpl/think_exception.tpl||src/tpl/think_exception.tpl"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "src/tpl/think_exception.tpl||src/tpl/think_exception.tpl"
          ],
          "candidate": [
            "src/tpl/think_exception.tpl||src/tpl/think_exception.tpl"
          ]
        }
      },
      "candidate_diff": {
        "src/tpl/think_exception.tpl||src/tpl/think_exception.tpl": [
          "File: src/tpl/think_exception.tpl -> src/tpl/think_exception.tpl",
          "--- Hunk 1 ---",
          "[Context before]",
          "68:                     break;",
          "69:             }",
          "72:         }",
          "74:         return implode(', ', $result);",
          "",
          "[Removed Lines]",
          "71:             $result[] = is_int($key) ? $value : \"'{$key}' => {$value}\";",
          "",
          "[Added Lines]",
          "71:             $result[] = is_int($key) ? $value : sprintf('\\'%s\\' => %s', htmlentities($key), $value);",
          "",
          "---------------"
        ]
      }
    }
  ]
}