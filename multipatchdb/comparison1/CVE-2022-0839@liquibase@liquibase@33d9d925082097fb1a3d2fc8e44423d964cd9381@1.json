{
  "cve_id": "CVE-2022-0839",
  "cve_desc": "Improper Restriction of XML External Entity Reference in GitHub repository liquibase/liquibase prior to 4.8.0.",
  "repo": "liquibase/liquibase",
  "patch_hash": "33d9d925082097fb1a3d2fc8e44423d964cd9381",
  "patch_info": {
    "commit_hash": "33d9d925082097fb1a3d2fc8e44423d964cd9381",
    "repo": "liquibase/liquibase",
    "commit_url": "https://github.com/liquibase/liquibase/commit/33d9d925082097fb1a3d2fc8e44423d964cd9381",
    "files": [
      "liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy"
    ],
    "message": "Added liquibase.secureParsing test",
    "before_after_code_files": [
      "liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy||liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy"
    ]
  },
  "patch_diff": {
    "liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy||liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy": [
      "File: liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy -> liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy",
      "--- Hunk 1 ---",
      "[Context before]",
      "24:     def INSECURE_XML = \"\"\"",
      "25: <!DOCTYPE databaseChangeLog [",
      "27:         ]>",
      "29: <databaseChangeLog xmlns=\"http://www.liquibase.org/xml/ns/dbchangelog\"",
      "",
      "[Removed Lines]",
      "26:         <!ENTITY insecure SYSTEM \"https://localhost/insecure\">",
      "",
      "[Added Lines]",
      "26:         <!ENTITY insecure SYSTEM \"file://invalid.txt\">",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "84:         then:",
      "85:         def e = thrown(ChangeLogParseException)",
      "87:     }",
      "89:     def \"allows liquibase.secureParsing=false to disable secure parsing\"() {",
      "",
      "[Removed Lines]",
      "86:         e.message.contains(\"Failed to read external document 'insecure'\")",
      "",
      "[Added Lines]",
      "86:         e.message.contains(\"access is not allowed due to restriction set by the accessExternalDTD property\")",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "98:         then:",
      "99:         def e = thrown(ChangeLogParseException)",
      "101:     }",
      "103: }",
      "",
      "[Removed Lines]",
      "100:         e.message.contains(\"Connection refused\")",
      "",
      "[Added Lines]",
      "100:         e.message.contains(\"Error Reading Changelog File: invalid.txt\")",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "12db931db03835b455dcfabedd9257a9d78b05c7",
      "candidate_info": {
        "commit_hash": "12db931db03835b455dcfabedd9257a9d78b05c7",
        "repo": "liquibase/liquibase",
        "commit_url": "https://github.com/liquibase/liquibase/commit/12db931db03835b455dcfabedd9257a9d78b05c7",
        "files": [
          "liquibase-core/src/main/java/liquibase/parser/ChangeLogParser.java",
          "liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy"
        ],
        "message": "Fix XML parsing test on Windows (#2516)\n\nIt is not valid to have a file:// URL with only two forward slashes. It is valid to have either 1 or 3 forward slashes. See https://en.wikipedia.org/wiki/File_URI_scheme",
        "before_after_code_files": [
          "liquibase-core/src/main/java/liquibase/parser/ChangeLogParser.java||liquibase-core/src/main/java/liquibase/parser/ChangeLogParser.java",
          "liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy||liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy||liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy"
          ],
          "candidate": [
            "liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy||liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy"
          ]
        }
      },
      "candidate_diff": {
        "liquibase-core/src/main/java/liquibase/parser/ChangeLogParser.java||liquibase-core/src/main/java/liquibase/parser/ChangeLogParser.java": [
          "File: liquibase-core/src/main/java/liquibase/parser/ChangeLogParser.java -> liquibase-core/src/main/java/liquibase/parser/ChangeLogParser.java"
        ],
        "liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy||liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy": [
          "File: liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy -> liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy",
          "--- Hunk 1 ---",
          "[Context before]",
          "24:     def INSECURE_XML = \"\"\"",
          "25: <!DOCTYPE databaseChangeLog [",
          "27:         ]>",
          "29: <databaseChangeLog xmlns=\"http://www.liquibase.org/xml/ns/dbchangelog\"",
          "",
          "[Removed Lines]",
          "26:         <!ENTITY insecure SYSTEM \"file://invalid.txt\">",
          "",
          "[Added Lines]",
          "26:         <!ENTITY insecure SYSTEM \"file:///invalid.txt\">",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "98:         then:",
          "99:         def e = thrown(ChangeLogParseException)",
          "101:     }",
          "103: }",
          "",
          "[Removed Lines]",
          "100:         e.message.contains(\"Error Reading Changelog File: invalid.txt\")",
          "",
          "[Added Lines]",
          "100:         e.message.contains(\"Error Reading Changelog File: \" + File.separator + \"invalid.txt\")",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "3edac0f17d572ba2047de9f9a42a3cde82cf340c",
      "candidate_info": {
        "commit_hash": "3edac0f17d572ba2047de9f9a42a3cde82cf340c",
        "repo": "liquibase/liquibase",
        "commit_url": "https://github.com/liquibase/liquibase/commit/3edac0f17d572ba2047de9f9a42a3cde82cf340c",
        "files": [
          "liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy"
        ],
        "message": "Playing with ResourceAccessor changes",
        "before_after_code_files": [
          "liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy||liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy||liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy"
          ],
          "candidate": [
            "liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy||liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy"
          ]
        }
      },
      "candidate_diff": {
        "liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy||liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy": [
          "File: liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy -> liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy",
          "--- Hunk 1 ---",
          "[Context before]",
          "83:         e.message.contains(\"Unable to resolve xml entity file:///invalid.txt. liquibase.secureParsing is set to 'true'\")",
          "84:     }",
          "98:     }",
          "100:     def \"getSchemaVersion\"() {",
          "",
          "[Removed Lines]",
          "86:     def \"allows liquibase.secureParsing=false to disable secure parsing\"() {",
          "87:         when:",
          "88:         def resourceAccessor = new MockResourceAccessor([\"com/example/insecure.xml\": INSECURE_XML])",
          "90:         Scope.child(GlobalConfiguration.SECURE_PARSING.key, \"false\", { ->",
          "91:             new XMLChangeLogSAXParser().parse(\"com/example/insecure.xml\", new ChangeLogParameters(), resourceAccessor)",
          "92:         })",
          "95:         then:",
          "96:         def e = thrown(ChangeLogParseException)",
          "97:         e.message.contains(\"Error Reading Changelog File: \" + File.separator + \"invalid.txt\")",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "54e15c7a1be4e1c1601c1cacdd9d6315cd56ea0d",
      "candidate_info": {
        "commit_hash": "54e15c7a1be4e1c1601c1cacdd9d6315cd56ea0d",
        "repo": "liquibase/liquibase",
        "commit_url": "https://github.com/liquibase/liquibase/commit/54e15c7a1be4e1c1601c1cacdd9d6315cd56ea0d",
        "files": [
          "liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy"
        ],
        "message": "Updated LiquibaseEntityResolver's secureParsing error message",
        "before_after_code_files": [
          "liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy||liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy||liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy"
          ],
          "candidate": [
            "liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy||liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy"
          ]
        }
      },
      "candidate_diff": {
        "liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy||liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy": [
          "File: liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy -> liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy",
          "--- Hunk 1 ---",
          "[Context before]",
          "84:         then:",
          "85:         def e = thrown(ChangeLogParseException)",
          "87:     }",
          "89:     def \"allows liquibase.secureParsing=false to disable secure parsing\"() {",
          "",
          "[Removed Lines]",
          "86:         e.message.contains(\"access is not allowed due to restriction set by the accessExternalDTD property\")",
          "",
          "[Added Lines]",
          "86:         e.message.contains(\"Unable to resolve xml entity file:///invalid.txt locally: liquibase.secureParsing is set to 'true' which does not allow remote lookups. Set it to 'false' to allow remote lookups of xsd files\")",
          "",
          "---------------"
        ]
      }
    }
  ]
}