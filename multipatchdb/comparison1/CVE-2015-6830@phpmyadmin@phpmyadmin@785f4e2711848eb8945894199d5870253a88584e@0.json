{
  "cve_id": "CVE-2015-6830",
  "cve_desc": "libraries/plugins/auth/AuthenticationCookie.class.php in phpMyAdmin 4.3.x before 4.3.13.2 and 4.4.x before 4.4.14.1 allows remote attackers to bypass a multiple-reCaptcha protection mechanism against brute-force credential guessing by providing a correct response to a single reCaptcha.",
  "repo": "phpmyadmin/phpmyadmin",
  "patch_hash": "785f4e2711848eb8945894199d5870253a88584e",
  "patch_info": {
    "commit_hash": "785f4e2711848eb8945894199d5870253a88584e",
    "repo": "phpmyadmin/phpmyadmin",
    "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/785f4e2711848eb8945894199d5870253a88584e",
    "files": [
      "ChangeLog",
      "libraries/plugins/auth/AuthenticationCookie.class.php",
      "test/classes/plugin/auth/PMA_AuthenticationCookie_test.php"
    ],
    "message": "Fix reCaptcha bypass\n\nSigned-off-by: Madhura Jayaratne <madhura.cj@gmail.com>",
    "before_after_code_files": [
      "libraries/plugins/auth/AuthenticationCookie.class.php||libraries/plugins/auth/AuthenticationCookie.class.php",
      "test/classes/plugin/auth/PMA_AuthenticationCookie_test.php||test/classes/plugin/auth/PMA_AuthenticationCookie_test.php"
    ]
  },
  "patch_diff": {
    "libraries/plugins/auth/AuthenticationCookie.class.php||libraries/plugins/auth/AuthenticationCookie.class.php": [
      "File: libraries/plugins/auth/AuthenticationCookie.class.php -> libraries/plugins/auth/AuthenticationCookie.class.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "223:                 . $GLOBALS['server'] . '\" />';",
      "224:         } // end if (server choice)",
      "235:         if (  !empty($GLOBALS['cfg']['CaptchaLoginPrivateKey'])",
      "236:             && !empty($GLOBALS['cfg']['CaptchaLoginPublicKey'])",
      "238:         ) {",
      "240:             echo '<script src=\"https://www.google.com/recaptcha/api.js?hl='",
      "",
      "[Removed Lines]",
      "227:         $skip = false;",
      "228:         if (  isset($_SESSION['last_valid_captcha'])",
      "229:             && $_SESSION['last_valid_captcha']",
      "230:         ) {",
      "231:             $skip = true;",
      "232:         }",
      "237:             && !$skip",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "337:             if (! defined('TESTSUITE')) {",
      "338:                 session_destroy();",
      "341:             }",
      "343:             if ($GLOBALS['cfg']['LoginCookieDeleteAll']) {",
      "",
      "[Removed Lines]",
      "340:                 $_SESSION['last_valid_captcha'] = false;",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "360:         if (! empty($_REQUEST['pma_username'])) {",
      "371:             if (! empty($GLOBALS['cfg']['CaptchaLoginPrivateKey'])",
      "372:                 && ! empty($GLOBALS['cfg']['CaptchaLoginPublicKey'])",
      "374:             ) {",
      "375:                 if (! empty($_POST[\"g-recaptcha-response\"])) {",
      "",
      "[Removed Lines]",
      "363:             $skip = false;",
      "364:             if (isset($_SESSION['last_valid_captcha'])",
      "365:                 && $_SESSION['last_valid_captcha']",
      "366:             ) {",
      "367:                 $skip = true;",
      "368:             }",
      "373:                 && ! $skip",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "389:                     if ($resp == null || ! $resp->isSuccess()) {",
      "390:                         $conn_error = __('Entered captcha is wrong, try again!');",
      "392:                         return false;",
      "395:                     }",
      "396:                 } else {",
      "403:                 }",
      "404:             }",
      "",
      "[Removed Lines]",
      "391:                         $_SESSION['last_valid_captcha'] = false;",
      "393:                     } else {",
      "394:                         $_SESSION['last_valid_captcha'] = true;",
      "397:                     if (! isset($_SESSION['last_valid_captcha'])",
      "398:                         || ! $_SESSION['last_valid_captcha']",
      "399:                     ) {",
      "400:                         $conn_error = __('Please enter correct captcha!');",
      "401:                         return false;",
      "402:                     }",
      "",
      "[Added Lines]",
      "374:                     $conn_error = __('Please enter correct captcha!');",
      "375:                     return false;",
      "",
      "---------------"
    ],
    "test/classes/plugin/auth/PMA_AuthenticationCookie_test.php||test/classes/plugin/auth/PMA_AuthenticationCookie_test.php": [
      "File: test/classes/plugin/auth/PMA_AuthenticationCookie_test.php -> test/classes/plugin/auth/PMA_AuthenticationCookie_test.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "186:         $GLOBALS['cfg']['Lang'] = 'en';",
      "187:         $GLOBALS['cfg']['AllowArbitraryServer'] = true;",
      "188:         $GLOBALS['cfg']['Servers'] = array(1, 2);",
      "190:         $GLOBALS['target'] = 'testTarget';",
      "191:         $GLOBALS['db'] = 'testDb';",
      "192:         $GLOBALS['table'] = 'testTable';",
      "",
      "[Removed Lines]",
      "189:         $_SESSION['last_valid_captcha'] = true;",
      "",
      "[Added Lines]",
      "189:         $GLOBALS['cfg']['CaptchaLoginPrivateKey'] = '';",
      "190:         $GLOBALS['cfg']['CaptchaLoginPublicKey'] = '';",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "308:         $GLOBALS['cfg']['Lang'] = '';",
      "309:         $GLOBALS['cfg']['AllowArbitraryServer'] = false;",
      "310:         $GLOBALS['cfg']['Servers'] = array(1);",
      "312:         $GLOBALS['cfg']['CaptchaLoginPrivateKey'] = 'testprivkey';",
      "313:         $GLOBALS['cfg']['CaptchaLoginPublicKey'] = 'testpubkey';",
      "314:         $GLOBALS['server'] = 0;",
      "",
      "[Removed Lines]",
      "311:         $_SESSION['last_valid_captcha'] = false;",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "435:         $GLOBALS['cfg']['CaptchaLoginPrivateKey'] = 'testprivkey';",
      "436:         $GLOBALS['cfg']['CaptchaLoginPublicKey'] = 'testpubkey';",
      "437:         $_POST[\"g-recaptcha-response\"] = '';",
      "",
      "[Removed Lines]",
      "434:         $_SESSION['last_valid_captcha'] = false;",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "485:         $_REQUEST['old_usr'] = '';",
      "486:         $_REQUEST['pma_username'] = 'testPMAUser';",
      "487:         $_REQUEST['pma_servername'] = 'testPMAServer';",
      "",
      "[Removed Lines]",
      "484:         $_SESSION['last_valid_captcha'] = true;",
      "",
      "[Added Lines]",
      "483:         $GLOBALS['cfg']['CaptchaLoginPrivateKey'] = '';",
      "484:         $GLOBALS['cfg']['CaptchaLoginPublicKey'] = '';",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "611:         $_COOKIE['pma_iv-1'] = base64_encode('testiv09testiv09');",
      "612:         $GLOBALS['cfg']['blowfish_secret'] = 'secret';",
      "613:         $_SESSION['last_access_time'] = '';",
      "617:         $this->object = $this->getMockBuilder('AuthenticationCookie')",
      "",
      "[Removed Lines]",
      "614:         $_SESSION['last_valid_captcha'] = true;",
      "",
      "[Added Lines]",
      "614:         $GLOBALS['cfg']['CaptchaLoginPrivateKey'] = '';",
      "615:         $GLOBALS['cfg']['CaptchaLoginPublicKey'] = '';",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "649:         $_COOKIE['pmaPass-1'] = 'pmaPass1';",
      "650:         $_COOKIE['pma_iv-1'] = base64_encode('testiv09testiv09');",
      "651:         $GLOBALS['cfg']['blowfish_secret'] = 'secret';",
      "653:         $_SESSION['last_access_time'] = time() - 1000;",
      "654:         $GLOBALS['cfg']['LoginCookieValidity'] = 1440;",
      "",
      "[Removed Lines]",
      "652:         $_SESSION['last_valid_captcha'] = true;",
      "",
      "[Added Lines]",
      "653:         $GLOBALS['cfg']['CaptchaLoginPrivateKey'] = '';",
      "654:         $GLOBALS['cfg']['CaptchaLoginPublicKey'] = '';",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "694:         $_COOKIE['pma_iv-1'] = base64_encode('testiv09testiv09');",
      "695:         $GLOBALS['cfg']['blowfish_secret'] = 'secret';",
      "696:         $_SESSION['last_access_time'] = 1;",
      "698:         $GLOBALS['cfg']['LoginCookieValidity'] = 0;",
      "699:         $_SESSION['last_access_time'] = -1;",
      "",
      "[Removed Lines]",
      "697:         $_SESSION['last_valid_captcha'] = true;",
      "",
      "[Added Lines]",
      "699:         $GLOBALS['cfg']['CaptchaLoginPrivateKey'] = '';",
      "700:         $GLOBALS['cfg']['CaptchaLoginPublicKey'] = '';",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "bdd76f18ce068302927d006b304faab2e6898998",
      "candidate_info": {
        "commit_hash": "bdd76f18ce068302927d006b304faab2e6898998",
        "repo": "phpmyadmin/phpmyadmin",
        "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/bdd76f18ce068302927d006b304faab2e6898998",
        "files": [
          "ChangeLog",
          "libraries/plugins/auth/AuthenticationCookie.class.php"
        ],
        "message": "bug #4259 reCaptcha sound session expired problem\n\nSigned-off-by: Madhura Jayaratne <madhura.cj@gmail.com>",
        "before_after_code_files": [
          "libraries/plugins/auth/AuthenticationCookie.class.php||libraries/plugins/auth/AuthenticationCookie.class.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "libraries/plugins/auth/AuthenticationCookie.class.php||libraries/plugins/auth/AuthenticationCookie.class.php"
          ],
          "candidate": [
            "libraries/plugins/auth/AuthenticationCookie.class.php||libraries/plugins/auth/AuthenticationCookie.class.php"
          ]
        }
      },
      "candidate_diff": {
        "libraries/plugins/auth/AuthenticationCookie.class.php||libraries/plugins/auth/AuthenticationCookie.class.php": [
          "File: libraries/plugins/auth/AuthenticationCookie.class.php -> libraries/plugins/auth/AuthenticationCookie.class.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "245:                  </noscript>",
          "246:                  <script type=\"text/javascript\">",
          "247:                     $(function() {",
          "253:                             $(this).addClass(\"disableAjax\");",
          "254:                         });",
          "255:                     });",
          "",
          "[Removed Lines]",
          "248:                         $(\"#recaptcha_reload_btn\").addClass(\"disableAjax\");",
          "249:                         $(\"#recaptcha_switch_audio_btn\").addClass(\"disableAjax\");",
          "250:                         $(\"#recaptcha_switch_img_btn\").addClass(\"disableAjax\");",
          "251:                         $(\"#recaptcha_whatsthis_btn\").addClass(\"disableAjax\");",
          "252:                         $(\"#recaptcha_audio_play_again\").live(\"mouseover\", function() {",
          "",
          "[Added Lines]",
          "248:                         $(\"#recaptcha_reload_btn,\" +",
          "249:                           \"#recaptcha_switch_audio_btn,\" +",
          "250:                           \"#recaptcha_switch_img_btn,\" +",
          "251:                           \"#recaptcha_whatsthis_btn,\" +",
          "252:                           \"#recaptcha_audio_play_again\")",
          "253:                         .live(\"mouseover\", function() {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "743a5288350596e067da2569abe5f663a79c4d67",
      "candidate_info": {
        "commit_hash": "743a5288350596e067da2569abe5f663a79c4d67",
        "repo": "phpmyadmin/phpmyadmin",
        "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/743a5288350596e067da2569abe5f663a79c4d67",
        "files": [
          "ChangeLog",
          "libraries/Header.class.php",
          "libraries/plugins/auth/AuthenticationCookie.class.php",
          "libraries/plugins/auth/recaptcha/LICENSE",
          "libraries/plugins/auth/recaptcha/recaptchalib.php",
          "libraries/plugins/auth/recaptchalib.php",
          "test/classes/plugin/auth/PMA_AuthenticationCookie_test.php"
        ],
        "message": "rfe #1590 Recaptcha API v2\n\nSigned-off-by: Madhura Jayaratne <madhura.cj@gmail.com>",
        "before_after_code_files": [
          "libraries/Header.class.php||libraries/Header.class.php",
          "libraries/plugins/auth/AuthenticationCookie.class.php||libraries/plugins/auth/AuthenticationCookie.class.php",
          "libraries/plugins/auth/recaptcha/recaptchalib.php||libraries/plugins/auth/recaptcha/recaptchalib.php",
          "libraries/plugins/auth/recaptchalib.php||libraries/plugins/auth/recaptchalib.php",
          "test/classes/plugin/auth/PMA_AuthenticationCookie_test.php||test/classes/plugin/auth/PMA_AuthenticationCookie_test.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "libraries/plugins/auth/AuthenticationCookie.class.php||libraries/plugins/auth/AuthenticationCookie.class.php",
            "test/classes/plugin/auth/PMA_AuthenticationCookie_test.php||test/classes/plugin/auth/PMA_AuthenticationCookie_test.php"
          ],
          "candidate": [
            "libraries/plugins/auth/AuthenticationCookie.class.php||libraries/plugins/auth/AuthenticationCookie.class.php",
            "test/classes/plugin/auth/PMA_AuthenticationCookie_test.php||test/classes/plugin/auth/PMA_AuthenticationCookie_test.php"
          ]
        }
      },
      "candidate_diff": {
        "libraries/Header.class.php||libraries/Header.class.php": [
          "File: libraries/Header.class.php -> libraries/Header.class.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "499:         if (!empty($GLOBALS['cfg']['CaptchaLoginPrivateKey'])",
          "500:             && !empty($GLOBALS['cfg']['CaptchaLoginPublicKey'])",
          "501:         ) {",
          "503:         } else {",
          "504:             $captcha_url = '';",
          "505:         }",
          "",
          "[Removed Lines]",
          "502:             $captcha_url = ' https://www.google.com ';",
          "",
          "[Added Lines]",
          "502:             $captcha_url = ' https://www.google.com https://www.gstatic.com ';",
          "",
          "---------------"
        ],
        "libraries/plugins/auth/AuthenticationCookie.class.php||libraries/plugins/auth/AuthenticationCookie.class.php": [
          "File: libraries/plugins/auth/AuthenticationCookie.class.php -> libraries/plugins/auth/AuthenticationCookie.class.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "233:             && !$skip",
          "234:         ) {",
          "269:         }",
          "271:         echo '</fieldset>",
          "",
          "[Removed Lines]",
          "236:             echo '<script type=\"text/javascript\">",
          "237:                     var RecaptchaOptions = {",
          "238:                         theme : \"white\"",
          "239:                     };",
          "240:                  </script>",
          "241:                  <script type=\"text/javascript\"",
          "242:                     src=\"https://www.google.com/recaptcha/api/challenge?'",
          "243:                     . 'k=' . $GLOBALS['cfg']['CaptchaLoginPublicKey'] . '&amp;'",
          "244:                     . 'hl=' . $GLOBALS['lang'] . '\">",
          "245:                  </script>",
          "246:                  <noscript>",
          "247:                     <iframe src=\"https://www.google.com/recaptcha/api/noscript?k='",
          "248:                 . $GLOBALS['cfg']['CaptchaLoginPublicKey'] . '\"",
          "249:                         height=\"300\" width=\"500\" frameborder=\"0\"></iframe><br>",
          "250:                     <textarea name=\"recaptcha_challenge_field\" rows=\"3\" cols=\"40\">",
          "251:                     </textarea>",
          "252:                     <input type=\"hidden\" name=\"recaptcha_response_field\"",
          "253:                         value=\"manual_challenge\">",
          "254:                  </noscript>",
          "255:                  <script type=\"text/javascript\">",
          "256:                     $(function() {",
          "257:                         $(document).on(",
          "258:                           \"mouseover\",",
          "259:                           \"#recaptcha_reload_btn,\" +",
          "260:                           \"#recaptcha_switch_audio_btn,\" +",
          "261:                           \"#recaptcha_switch_img_btn,\" +",
          "262:                           \"#recaptcha_whatsthis_btn,\" +",
          "263:                           \"#recaptcha_audio_play_again\"",
          "264:                           function() {",
          "265:                             $(this).addClass(\"disableAjax\");",
          "266:                         });",
          "267:                     });",
          "268:                  </script>';",
          "",
          "[Added Lines]",
          "236:             echo '<script src=\"https://www.google.com/recaptcha/api.js?hl='",
          "237:                 . $GLOBALS['lang'] . '\" async defer></script>';",
          "238:             echo '<div class=\"g-recaptcha\" data-sitekey=\"'",
          "239:                 . $GLOBALS['cfg']['CaptchaLoginPublicKey'] . '\"></div>';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "365:             && !empty($GLOBALS['cfg']['CaptchaLoginPublicKey'])",
          "366:             && !$skip",
          "367:         ) {",
          "376:                     $_SERVER[\"REMOTE_ADDR\"],",
          "379:                 );",
          "383:                     $conn_error = __('Entered captcha is wrong, try again!');",
          "384:                     $_SESSION['last_valid_captcha'] = false;",
          "385:                     return false;",
          "386:                 } else {",
          "387:                     $_SESSION['last_valid_captcha'] = true;",
          "388:                 }",
          "394:             } else {",
          "395:                 if (! isset($_SESSION['last_valid_captcha'])",
          "396:                     || ! $_SESSION['last_valid_captcha']",
          "397:                 ) {",
          "398:                     return false;",
          "399:                 }",
          "400:             }",
          "",
          "[Removed Lines]",
          "368:             if (  !empty($_POST[\"recaptcha_challenge_field\"])",
          "369:                 && !empty($_POST[\"recaptcha_response_field\"])",
          "370:             ) {",
          "371:                 include_once 'libraries/plugins/auth/recaptchalib.php';",
          "374:                 $resp = recaptcha_check_answer(",
          "375:                     $GLOBALS['cfg']['CaptchaLoginPrivateKey'],",
          "377:                     $_POST[\"recaptcha_challenge_field\"],",
          "378:                     $_POST[\"recaptcha_response_field\"]",
          "382:                 if ( !$resp->is_valid ) {",
          "389:             } elseif (! empty($_POST[\"recaptcha_challenge_field\"])",
          "390:                 && empty($_POST[\"recaptcha_response_field\"])",
          "391:             ) {",
          "392:                 $conn_error = __('Please enter correct captcha!');",
          "393:                 return false;",
          "",
          "[Added Lines]",
          "339:             if (! empty($_POST[\"g-recaptcha-response\"])) {",
          "341:                 include_once 'libraries/plugins/auth/recaptcha/recaptchalib.php';",
          "342:                 $reCaptcha = new ReCaptcha(",
          "343:                     $GLOBALS['cfg']['CaptchaLoginPrivateKey']",
          "344:                 );",
          "347:                 $resp = $reCaptcha->verifyResponse(",
          "349:                     $_POST[\"g-recaptcha-response\"]",
          "353:                 if ($resp == null || ! $resp->success) {",
          "364:                     $conn_error = __('Please enter correct captcha!');",
          "",
          "---------------"
        ],
        "libraries/plugins/auth/recaptcha/recaptchalib.php||libraries/plugins/auth/recaptcha/recaptchalib.php": [
          "File: libraries/plugins/auth/recaptcha/recaptchalib.php -> libraries/plugins/auth/recaptcha/recaptchalib.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: <?php",
          "36: class ReCaptchaResponse",
          "37: {",
          "38:     public $success;",
          "39:     public $errorCodes;",
          "40: }",
          "42: class ReCaptcha",
          "43: {",
          "44:     private static $_signupUrl = \"https://www.google.com/recaptcha/admin\";",
          "45:     private static $_siteVerifyUrl =",
          "46:         \"https://www.google.com/recaptcha/api/siteverify?\";",
          "47:     private $_secret;",
          "48:     private static $_version = \"php_1.0\";",
          "55:     function ReCaptcha($secret)",
          "56:     {",
          "57:         if ($secret == null || $secret == \"\") {",
          "58:             die(\"To use reCAPTCHA you must get an API key from <a href='\"",
          "59:                 . self::$_signupUrl . \"'>\" . self::$_signupUrl . \"</a>\");",
          "60:         }",
          "61:         $this->_secret=$secret;",
          "62:     }",
          "71:     private function _encodeQS($data)",
          "72:     {",
          "73:         $req = \"\";",
          "74:         foreach ($data as $key => $value) {",
          "75:             $req .= $key . '=' . urlencode(stripslashes($value)) . '&';",
          "76:         }",
          "79:         $req=substr($req, 0, strlen($req)-1);",
          "80:         return $req;",
          "81:     }",
          "91:     private function _submitHTTPGet($path, $data)",
          "92:     {",
          "93:         $req = $this->_encodeQS($data);",
          "94:         $response = file_get_contents($path . $req);",
          "95:         return $response;",
          "96:     }",
          "107:     public function verifyResponse($remoteIp, $response)",
          "108:     {",
          "110:         if ($response == null || strlen($response) == 0) {",
          "111:             $recaptchaResponse = new ReCaptchaResponse();",
          "112:             $recaptchaResponse->success = false;",
          "113:             $recaptchaResponse->errorCodes = 'missing-input';",
          "114:             return $recaptchaResponse;",
          "115:         }",
          "117:         $getResponse = $this->_submitHttpGet(",
          "118:             self::$_siteVerifyUrl,",
          "119:             array (",
          "120:                 'secret' => $this->_secret,",
          "121:                 'remoteip' => $remoteIp,",
          "122:                 'v' => self::$_version,",
          "123:                 'response' => $response",
          "124:             )",
          "125:         );",
          "126:         $answers = json_decode($getResponse, true);",
          "127:         $recaptchaResponse = new ReCaptchaResponse();",
          "129:         if (trim($answers ['success']) == true) {",
          "130:             $recaptchaResponse->success = true;",
          "131:         } else {",
          "132:             $recaptchaResponse->success = false;",
          "133:             $recaptchaResponse->errorCodes = $answers ['error-codes'];",
          "134:         }",
          "136:         return $recaptchaResponse;",
          "137:     }",
          "138: }",
          "140: ?>",
          "",
          "---------------"
        ],
        "libraries/plugins/auth/recaptchalib.php||libraries/plugins/auth/recaptchalib.php": [
          "File: libraries/plugins/auth/recaptchalib.php -> libraries/plugins/auth/recaptchalib.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "test/classes/plugin/auth/PMA_AuthenticationCookie_test.php||test/classes/plugin/auth/PMA_AuthenticationCookie_test.php": [
          "File: test/classes/plugin/auth/PMA_AuthenticationCookie_test.php -> test/classes/plugin/auth/PMA_AuthenticationCookie_test.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "372:         );",
          "374:         $this->assertContains(",
          "377:             $result",
          "378:         );",
          "380:         $this->assertContains(",
          "393:             $result",
          "394:         );",
          "",
          "[Removed Lines]",
          "375:             'src=\"https://www.google.com/recaptcha/api/'",
          "376:             . 'challenge?k=testpubkey&amp;hl=en\">',",
          "381:             'iframe src=\"https://www.google.com/recaptcha/api/noscript' .",
          "382:             '?k=testpubkey\"',",
          "383:             $result",
          "384:         );",
          "386:         $this->assertContains(",
          "387:             '<textarea name=\"recaptcha_challenge_field\" rows=\"3\" cols=\"40\">',",
          "388:             $result",
          "389:         );",
          "391:         $this->assertContains(",
          "392:             '<input type=\"hidden\" name=\"recaptcha_response_field\"',",
          "",
          "[Added Lines]",
          "375:             '<script src=\"https://www.google.com/recaptcha/api.js?hl=en\"'",
          "376:             . ' async defer></script>',",
          "381:             '<div class=\"g-recaptcha\" data-sitekey=\"testpubkey\">',",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "473:         $_SESSION['last_valid_captcha'] = false;",
          "474:         $GLOBALS['cfg']['CaptchaLoginPrivateKey'] = 'testprivkey';",
          "475:         $GLOBALS['cfg']['CaptchaLoginPublicKey'] = 'testpubkey';",
          "479:         $this->assertFalse(",
          "480:             $this->object->authCheck()",
          "",
          "[Removed Lines]",
          "476:         $_POST[\"recaptcha_challenge_field\"] = 'captcha1';",
          "477:         $_POST[\"recaptcha_response_field\"] = '';",
          "",
          "[Added Lines]",
          "465:         $_POST[\"g-recaptcha-response\"] = '';",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "485:             $GLOBALS['conn_error']",
          "486:         );",
          "502:         $GLOBALS['cfg']['CaptchaLoginPrivateKey'] = '';",
          "",
          "[Removed Lines]",
          "490:         $_SESSION['last_valid_captcha'] = false;",
          "491:         $GLOBALS['cfg']['CaptchaLoginPrivateKey'] = 'testprivkey';",
          "492:         $GLOBALS['cfg']['CaptchaLoginPublicKey'] = 'testpubkey';",
          "493:         $_POST[\"recaptcha_challenge_field\"] = '';",
          "494:         $_POST[\"recaptcha_response_field\"] = '';",
          "496:         $this->assertFalse(",
          "497:             $this->object->authCheck()",
          "498:         );",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "478e781f1be0b2ca7a652a3690115af77f6e23ea",
      "candidate_info": {
        "commit_hash": "478e781f1be0b2ca7a652a3690115af77f6e23ea",
        "repo": "phpmyadmin/phpmyadmin",
        "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/478e781f1be0b2ca7a652a3690115af77f6e23ea",
        "files": [
          "js/functions.js",
          "js/tbl_operations.js",
          "libraries/plugins/auth/AuthenticationCookie.class.php"
        ],
        "message": "Replace more instances of .live() and .die() with .on() and .off()\n\nSigned-off-by: Madhura Jayaratne <madhura.cj@gmail.com>",
        "before_after_code_files": [
          "js/functions.js||js/functions.js",
          "js/tbl_operations.js||js/tbl_operations.js",
          "libraries/plugins/auth/AuthenticationCookie.class.php||libraries/plugins/auth/AuthenticationCookie.class.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "libraries/plugins/auth/AuthenticationCookie.class.php||libraries/plugins/auth/AuthenticationCookie.class.php"
          ],
          "candidate": [
            "libraries/plugins/auth/AuthenticationCookie.class.php||libraries/plugins/auth/AuthenticationCookie.class.php"
          ]
        }
      },
      "candidate_diff": {
        "js/functions.js||js/functions.js": [
          "File: js/functions.js -> js/functions.js"
        ],
        "js/tbl_operations.js||js/tbl_operations.js": [
          "File: js/tbl_operations.js -> js/tbl_operations.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "4: AJAX.registerTeardown('tbl_operations.js', function () {",
          "12: });",
          "",
          "[Removed Lines]",
          "5:     $(\"#copyTable.ajax\").die('submit');",
          "6:     $(\"#moveTableForm\").die('submit');",
          "7:     $(\"#tableOptionsForm\").die('submit');",
          "8:     $(\"#tbl_maintenance li a.maintain_action.ajax\").die('click');",
          "9:     $(\"#drop_tbl_anchor.ajax\").die('click');",
          "10:     $(\"#drop_view_anchor.ajax\").die('click');",
          "11:     $(\"#truncate_tbl_anchor.ajax\").die('click');",
          "",
          "[Added Lines]",
          "5:     $(document).off('submit', \"#copyTable.ajax\");",
          "6:     $(document).off('submit', \"#moveTableForm\");",
          "7:     $(document).off('submit', \"#tableOptionsForm\");",
          "8:     $(document).off('click', \"#tbl_maintenance li a.maintain_action.ajax\");",
          "9:     $(document).off('click', \"#drop_tbl_anchor.ajax\");",
          "10:     $(document).off('click', \"#drop_view_anchor.ajax\");",
          "11:     $(document).off('click', \"#truncate_tbl_anchor.ajax\");",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "23:         event.preventDefault();",
          "24:         var $form = $(this);",
          "25:         PMA_prepareForAjaxRequest($form);",
          "",
          "[Removed Lines]",
          "22:     $(\"#copyTable.ajax\").live('submit', function (event) {",
          "",
          "[Added Lines]",
          "22:     $(document).on('submit', \"#copyTable.ajax\", function (event) {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "52:         event.preventDefault();",
          "53:         var $form = $(this);",
          "54:         var db = $form.find('select[name=target_db]').val();",
          "",
          "[Removed Lines]",
          "51:     $(\"#moveTableForm\").live('submit', function (event) {",
          "",
          "[Added Lines]",
          "51:     $(document).on('submit', \"#moveTableForm\", function (event) {",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "76:         event.preventDefault();",
          "77:         event.stopPropagation();",
          "78:         var $form = $(this);",
          "",
          "[Removed Lines]",
          "75:     $(\"#tableOptionsForm\").live('submit', function (event) {",
          "",
          "[Added Lines]",
          "75:     $(document).on('submit', \"#tableOptionsForm\", function (event) {",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "104:         event.preventDefault();",
          "105:         if ($(\".sqlqueryresults\").length !== 0) {",
          "106:             $(\".sqlqueryresults\").remove();",
          "",
          "[Removed Lines]",
          "103:     $(\"#tbl_maintenance li a.maintain_action.ajax\").live('click', function (event) {",
          "",
          "[Added Lines]",
          "103:     $(document).on('click', \"#tbl_maintenance li a.maintain_action.ajax\", function (event) {",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "140:         }); // end $.post()",
          "141:     });//end of table maintenance ajax click",
          "144:         event.preventDefault();",
          "",
          "[Removed Lines]",
          "143:     $(\"#drop_tbl_anchor.ajax\").live('click', function (event) {",
          "",
          "[Added Lines]",
          "143:     $(document).on('click', \"#drop_tbl_anchor.ajax\", function (event) {",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "173:         }); // end $.PMA_confirm()",
          "174:     }); //end of Drop Table Ajax action",
          "177:         event.preventDefault();",
          "",
          "[Removed Lines]",
          "176:     $(\"#drop_view_anchor.ajax\").live('click', function (event) {",
          "",
          "[Added Lines]",
          "176:     $(document).on('click', \"#drop_view_anchor.ajax\", function (event) {",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "206:         }); // end $.PMA_confirm()",
          "207:     }); //end of Drop View Ajax action",
          "210:         event.preventDefault();",
          "",
          "[Removed Lines]",
          "209:     $(\"#truncate_tbl_anchor.ajax\").live('click', function (event) {",
          "",
          "[Added Lines]",
          "209:     $(document).on('click', \"#truncate_tbl_anchor.ajax\", function (event) {",
          "",
          "---------------"
        ],
        "libraries/plugins/auth/AuthenticationCookie.class.php||libraries/plugins/auth/AuthenticationCookie.class.php": [
          "File: libraries/plugins/auth/AuthenticationCookie.class.php -> libraries/plugins/auth/AuthenticationCookie.class.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "248:                  </noscript>",
          "249:                  <script type=\"text/javascript\">",
          "250:                     $(function() {",
          "252:                           \"#recaptcha_switch_audio_btn,\" +",
          "253:                           \"#recaptcha_switch_img_btn,\" +",
          "254:                           \"#recaptcha_whatsthis_btn,\" +",
          "257:                             $(this).addClass(\"disableAjax\");",
          "258:                         });",
          "259:                     });",
          "",
          "[Removed Lines]",
          "251:                         $(\"#recaptcha_reload_btn,\" +",
          "255:                           \"#recaptcha_audio_play_again\")",
          "256:                         .live(\"mouseover\", function() {",
          "",
          "[Added Lines]",
          "251:                         $(document).on(",
          "252:                           \"mouseover\",",
          "253:                           \"#recaptcha_reload_btn,\" +",
          "257:                           \"#recaptcha_audio_play_again\"",
          "258:                           function() {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "43ec83fbdaa1925a89ce9f187d1e8577593a4899",
      "candidate_info": {
        "commit_hash": "43ec83fbdaa1925a89ce9f187d1e8577593a4899",
        "repo": "phpmyadmin/phpmyadmin",
        "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/43ec83fbdaa1925a89ce9f187d1e8577593a4899",
        "files": [
          "ChangeLog",
          "libraries/plugins/auth/AuthenticationCookie.class.php"
        ],
        "message": "bug #4259 reCaptcha sound session expired problem\n\nSigned-off-by: Madhura Jayaratne <madhura.cj@gmail.com>",
        "before_after_code_files": [
          "libraries/plugins/auth/AuthenticationCookie.class.php||libraries/plugins/auth/AuthenticationCookie.class.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "libraries/plugins/auth/AuthenticationCookie.class.php||libraries/plugins/auth/AuthenticationCookie.class.php"
          ],
          "candidate": [
            "libraries/plugins/auth/AuthenticationCookie.class.php||libraries/plugins/auth/AuthenticationCookie.class.php"
          ]
        }
      },
      "candidate_diff": {
        "libraries/plugins/auth/AuthenticationCookie.class.php||libraries/plugins/auth/AuthenticationCookie.class.php": [
          "File: libraries/plugins/auth/AuthenticationCookie.class.php -> libraries/plugins/auth/AuthenticationCookie.class.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "244:                         value=\"manual_challenge\">",
          "245:                  </noscript>",
          "246:                  <script type=\"text/javascript\">",
          "253:                     });",
          "254:                  </script>';",
          "255:         }",
          "",
          "[Removed Lines]",
          "247:                     $(\"#recaptcha_reload_btn\").addClass(\"disableAjax\");",
          "248:                     $(\"#recaptcha_switch_audio_btn\").addClass(\"disableAjax\");",
          "249:                     $(\"#recaptcha_switch_img_btn\").addClass(\"disableAjax\");",
          "250:                     $(\"#recaptcha_whatsthis_btn\").addClass(\"disableAjax\");",
          "251:                     $(\"#recaptcha_audio_play_again\").live(\"mouseover\", function() {",
          "252:                         $(this).addClass(\"disableAjax\");",
          "",
          "[Added Lines]",
          "247:                     $(function() {",
          "248:                         $(\"#recaptcha_reload_btn\").addClass(\"disableAjax\");",
          "249:                         $(\"#recaptcha_switch_audio_btn\").addClass(\"disableAjax\");",
          "250:                         $(\"#recaptcha_switch_img_btn\").addClass(\"disableAjax\");",
          "251:                         $(\"#recaptcha_whatsthis_btn\").addClass(\"disableAjax\");",
          "252:                         $(\"#recaptcha_audio_play_again\").live(\"mouseover\", function() {",
          "253:                             $(this).addClass(\"disableAjax\");",
          "254:                         });",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "0391bab8251f7ff4b57e5440497b9536e0600cba",
      "candidate_info": {
        "commit_hash": "0391bab8251f7ff4b57e5440497b9536e0600cba",
        "repo": "phpmyadmin/phpmyadmin",
        "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/0391bab8251f7ff4b57e5440497b9536e0600cba",
        "files": [
          "ChangeLog",
          "libraries/plugins/auth/AuthenticationCookie.class.php"
        ],
        "message": "bug #4931 False error before entering reCAPTCHA\n\nSigned-off-by: Madhura Jayaratne <madhura.cj@gmail.com>",
        "before_after_code_files": [
          "libraries/plugins/auth/AuthenticationCookie.class.php||libraries/plugins/auth/AuthenticationCookie.class.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "libraries/plugins/auth/AuthenticationCookie.class.php||libraries/plugins/auth/AuthenticationCookie.class.php"
          ],
          "candidate": [
            "libraries/plugins/auth/AuthenticationCookie.class.php||libraries/plugins/auth/AuthenticationCookie.class.php"
          ]
        }
      },
      "candidate_diff": {
        "libraries/plugins/auth/AuthenticationCookie.class.php||libraries/plugins/auth/AuthenticationCookie.class.php": [
          "File: libraries/plugins/auth/AuthenticationCookie.class.php -> libraries/plugins/auth/AuthenticationCookie.class.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "323:             return false;",
          "324:         }",
          "370:         if (! empty($_REQUEST['old_usr'])) {",
          "",
          "[Removed Lines]",
          "327:         $skip = false;",
          "328:         if (  isset($_SESSION['last_valid_captcha'])",
          "329:             && $_SESSION['last_valid_captcha']",
          "330:         ) {",
          "331:             $skip = true;",
          "332:         }",
          "335:         if (  !empty($GLOBALS['cfg']['CaptchaLoginPrivateKey'])",
          "336:             && !empty($GLOBALS['cfg']['CaptchaLoginPublicKey'])",
          "337:             && !$skip",
          "338:         ) {",
          "339:             if (! empty($_POST[\"g-recaptcha-response\"])) {",
          "341:                 include_once 'libraries/plugins/auth/recaptcha/recaptchalib.php';",
          "342:                 $reCaptcha = new ReCaptcha(",
          "343:                     $GLOBALS['cfg']['CaptchaLoginPrivateKey']",
          "344:                 );",
          "347:                 $resp = $reCaptcha->verifyResponse(",
          "348:                     $_SERVER[\"REMOTE_ADDR\"],",
          "349:                     $_POST[\"g-recaptcha-response\"]",
          "350:                 );",
          "353:                 if ($resp == null || ! $resp->success) {",
          "354:                     $conn_error = __('Entered captcha is wrong, try again!');",
          "355:                     $_SESSION['last_valid_captcha'] = false;",
          "356:                     return false;",
          "357:                 } else {",
          "358:                     $_SESSION['last_valid_captcha'] = true;",
          "359:                 }",
          "360:             } else {",
          "361:                 if (! isset($_SESSION['last_valid_captcha'])",
          "362:                     || ! $_SESSION['last_valid_captcha']",
          "363:                 ) {",
          "364:                     $conn_error = __('Please enter correct captcha!');",
          "365:                     return false;",
          "366:                 }",
          "367:             }",
          "368:         }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "398:         }",
          "400:         if (! empty($_REQUEST['pma_username'])) {",
          "402:             $GLOBALS['PHP_AUTH_USER'] = $_REQUEST['pma_username'];",
          "403:             $GLOBALS['PHP_AUTH_PW']   = empty($_REQUEST['pma_password'])",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "359:             $skip = false;",
          "360:             if (isset($_SESSION['last_valid_captcha'])",
          "361:                 && $_SESSION['last_valid_captcha']",
          "362:             ) {",
          "363:                 $skip = true;",
          "364:             }",
          "367:             if (! empty($GLOBALS['cfg']['CaptchaLoginPrivateKey'])",
          "368:                 && ! empty($GLOBALS['cfg']['CaptchaLoginPublicKey'])",
          "369:                 && ! $skip",
          "370:             ) {",
          "371:                 if (! empty($_POST[\"g-recaptcha-response\"])) {",
          "373:                     include_once 'libraries/plugins/auth/recaptcha/recaptchalib.php';",
          "374:                     $reCaptcha = new ReCaptcha(",
          "375:                         $GLOBALS['cfg']['CaptchaLoginPrivateKey']",
          "376:                     );",
          "379:                     $resp = $reCaptcha->verifyResponse(",
          "380:                         $_SERVER[\"REMOTE_ADDR\"],",
          "381:                         $_POST[\"g-recaptcha-response\"]",
          "382:                     );",
          "385:                     if ($resp == null || ! $resp->success) {",
          "386:                         $conn_error = __('Entered captcha is wrong, try again!');",
          "387:                         $_SESSION['last_valid_captcha'] = false;",
          "388:                         return false;",
          "389:                     } else {",
          "390:                         $_SESSION['last_valid_captcha'] = true;",
          "391:                     }",
          "392:                 } else {",
          "393:                     if (! isset($_SESSION['last_valid_captcha'])",
          "394:                         || ! $_SESSION['last_valid_captcha']",
          "395:                     ) {",
          "396:                         $conn_error = __('Please enter correct captcha!');",
          "397:                         return false;",
          "398:                     }",
          "399:                 }",
          "400:             }",
          "",
          "---------------"
        ]
      }
    }
  ]
}