{
  "cve_id": "CVE-2022-45299",
  "cve_desc": "An issue in the IpFile argument of rust-lang webbrowser-rs v0.8.2 allows attackers to access arbitrary files via supplying a crafted URL.",
  "repo": "amodm/webbrowser-rs",
  "patch_hash": "431b5139e274b7e456bea27e768aaa121b97be4c",
  "patch_info": {
    "commit_hash": "431b5139e274b7e456bea27e768aaa121b97be4c",
    "repo": "amodm/webbrowser-rs",
    "commit_url": "https://github.com/amodm/webbrowser-rs/commit/431b5139e274b7e456bea27e768aaa121b97be4c",
    "files": [
      "README.md",
      "src/lib.rs",
      "src/macos.rs",
      "src/unix.rs",
      "src/windows.rs"
    ],
    "message": "define consistent behaviour to include opening web browser even for local files",
    "before_after_code_files": [
      "src/lib.rs||src/lib.rs",
      "src/macos.rs||src/macos.rs",
      "src/unix.rs||src/unix.rs",
      "src/windows.rs||src/windows.rs"
    ]
  },
  "patch_diff": {
    "src/lib.rs||src/lib.rs": [
      "File: src/lib.rs -> src/lib.rs",
      "--- Hunk 1 ---",
      "[Context before]",
      "62:     \"Only Windows, Mac OS, iOS, Linux, *BSD and Haiku and Wasm32 are currently supported\"",
      "63: );",
      "65: use std::default::Default;",
      "66: use std::io::{Error, ErrorKind, Result};",
      "67: use std::str::FromStr;",
      "68: use std::{error, fmt};",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "69: use std::convert::TryFrom;",
      "71: use std::fmt::Display;",
      "73: use std::ops::Deref;",
      "74: use std::path::PathBuf;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "280:     url: &str,",
      "281:     options: &BrowserOptions,",
      "282: ) -> Result<()> {",
      "284:     os::open_browser_internal(browser, &target, options)",
      "285: }",
      "294: impl TargetType {",
      "296:     #[cfg(any(target_os = \"android\", target_os = \"ios\", target_family = \"wasm\"))]",
      "297:     fn is_http(&self) -> bool {",
      "303:             _ => false,",
      "304:         }",
      "305:     }",
      "",
      "[Removed Lines]",
      "283:     let target = TargetType::from(url);",
      "289: enum TargetType {",
      "290:     Url(url::Url),",
      "291:     Path(String),",
      "292: }",
      "298:         match self {",
      "299:             Self::Url(u) => match u.scheme() {",
      "300:                 \"http\" | \"https\" => true,",
      "301:                 _ => false,",
      "302:             },",
      "",
      "[Added Lines]",
      "291:     let target = TargetType::try_from(url)?;",
      "297: struct TargetType(url::Url);",
      "303:         match self.0.scheme() {",
      "304:             \"http\" | \"https\" => true,",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "309:     #[cfg(any(target_os = \"android\", target_os = \"ios\", target_family = \"wasm\"))]",
      "310:     fn get_http_url(&self) -> Result<&str> {",
      "311:         if self.is_http() {",
      "313:         } else {",
      "315:         }",
      "316:     }",
      "317: }",
      "325:     }",
      "326: }",
      "333:         }",
      "334:     }",
      "335: }",
      "",
      "[Removed Lines]",
      "312:             Ok(self.as_ref())",
      "314:             Err(Error::new(ErrorKind::InvalidInput, \"not a valid url\"))",
      "319: impl AsRef<str> for TargetType {",
      "320:     fn as_ref(&self) -> &str {",
      "321:         match self {",
      "322:             TargetType::Url(u) => u.as_str(),",
      "323:             TargetType::Path(p) => p,",
      "324:         }",
      "328: impl From<&str> for TargetType {",
      "329:     fn from(target: &str) -> Self {",
      "330:         match url::Url::parse(target) {",
      "331:             Ok(u) => TargetType::Url(u),",
      "332:             Err(_) => TargetType::Path(target.into()),",
      "",
      "[Added Lines]",
      "314:             Ok(self.0.as_str())",
      "316:             Err(Error::new(ErrorKind::InvalidInput, \"not an http url\"))",
      "321: impl Deref for TargetType {",
      "322:     type Target = str;",
      "324:     fn deref(&self) -> &Self::Target {",
      "325:         self.0.as_str()",
      "326:     }",
      "327: }",
      "329: impl Display for TargetType {",
      "330:     fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {",
      "331:         (self as &str).fmt(f)",
      "335: impl TryFrom<&str> for TargetType {",
      "336:     type Error = Error;",
      "338:     fn try_from(value: &str) -> Result<Self> {",
      "339:         match url::Url::parse(value) {",
      "340:             Ok(u) => Ok(Self(u)),",
      "341:             Err(_) => {",
      "343:                 let pb = PathBuf::from(value);",
      "344:                 let url = url::Url::from_file_path(if pb.is_relative() {",
      "345:                     std::env::current_dir()?.join(pb)",
      "346:                 } else {",
      "347:                     pb",
      "348:                 })",
      "349:                 .map_err(|_| {",
      "350:                     Error::new(ErrorKind::InvalidInput, \"failed to convert path to url\")",
      "351:                 })?;",
      "353:                 Ok(Self(url))",
      "354:             }",
      "",
      "---------------"
    ],
    "src/macos.rs||src/macos.rs": [
      "File: src/macos.rs -> src/macos.rs",
      "--- Hunk 1 ---",
      "[Context before]",
      "82:     }",
      "90:     let mut launched_app: CFURLRef = std::ptr::null_mut();",
      "91:     let status = unsafe { LSOpenFromURLSpec(&spec, &mut launched_app) };",
      "92:     log::trace!(\"received status: {}\", status);",
      "",
      "[Removed Lines]",
      "85:     log::trace!(",
      "86:         \"about to start browser: {} for {}\",",
      "87:         &browser,",
      "88:         target.as_ref()",
      "89:     );",
      "",
      "[Added Lines]",
      "85:     log::trace!(\"about to start browser: {} for {}\", &browser, &target);",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "208: #[cfg(test)]",
      "209: mod tests {",
      "210:     use super::*;",
      "212:     #[test]",
      "213:     fn open_non_existing_browser() {",
      "214:         let _ = env_logger::try_init();",
      "215:         if let Err(err) = open_browser_internal(",
      "216:             Browser::Opera,",
      "218:             &BrowserOptions::default(),",
      "219:         ) {",
      "220:             assert_eq!(err.kind(), ErrorKind::NotFound);",
      "",
      "[Removed Lines]",
      "217:             &TargetType::from(\"https://github.com\"),",
      "",
      "[Added Lines]",
      "207:     use std::convert::TryFrom;",
      "214:             &TargetType::try_from(\"https://github.com\").expect(\"failed to parse url\"),",
      "",
      "---------------"
    ],
    "src/unix.rs||src/unix.rs": [
      "File: src/unix.rs -> src/unix.rs",
      "--- Hunk 1 ---",
      "[Context before]",
      "30:     options: &BrowserOptions,",
      "31: ) -> Result<()> {",
      "32:     match browser {",
      "34:         _ => Err(Error::new(",
      "35:             ErrorKind::NotFound,",
      "36:             \"only default browser supported\",",
      "",
      "[Removed Lines]",
      "33:         Browser::Default => open_browser_default(target.as_ref(), options),",
      "",
      "[Added Lines]",
      "33:         Browser::Default => open_browser_default(&target, options),",
      "",
      "---------------"
    ],
    "src/windows.rs||src/windows.rs": [
      "File: src/windows.rs -> src/windows.rs",
      "--- Hunk 1 ---",
      "[Context before]",
      "33:             static OPEN: &[u16] = &['o' as u16, 'p' as u16, 'e' as u16, 'n' as u16, 0x0000];",
      "34:             static HTTP: &[u16] = &['h' as u16, 't' as u16, 't' as u16, 'p' as u16, 0x0000];",
      "36:                 .map_err(|e| Error::new(ErrorKind::InvalidInput, e))?;",
      "37:             let code = unsafe {",
      "38:                 let coinitializeex_result = CoInitializeEx(",
      "",
      "[Removed Lines]",
      "35:             let url = U16CString::from_str(target.as_ref())",
      "",
      "[Added Lines]",
      "35:             let url = U16CString::from_str(&target)",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "ecfbf66daa0cc139bd557bd7899a183bd6575990",
      "candidate_info": {
        "commit_hash": "ecfbf66daa0cc139bd557bd7899a183bd6575990",
        "repo": "amodm/webbrowser-rs",
        "commit_url": "https://github.com/amodm/webbrowser-rs/commit/ecfbf66daa0cc139bd557bd7899a183bd6575990",
        "files": [
          "README.md",
          "src/android.rs",
          "src/lib.rs",
          "src/macos.rs",
          "src/unix.rs",
          "src/wasm.rs",
          "src/windows.rs"
        ],
        "message": "Document consistent behaviour, and provide way of overriding suppression of output",
        "before_after_code_files": [
          "src/android.rs||src/android.rs",
          "src/lib.rs||src/lib.rs",
          "src/macos.rs||src/macos.rs",
          "src/unix.rs||src/unix.rs",
          "src/wasm.rs||src/wasm.rs",
          "src/windows.rs||src/windows.rs"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/lib.rs||src/lib.rs",
            "src/macos.rs||src/macos.rs",
            "src/unix.rs||src/unix.rs",
            "src/windows.rs||src/windows.rs"
          ],
          "candidate": [
            "src/lib.rs||src/lib.rs",
            "src/macos.rs||src/macos.rs",
            "src/unix.rs||src/unix.rs",
            "src/windows.rs||src/windows.rs"
          ]
        }
      },
      "candidate_diff": {
        "src/android.rs||src/android.rs": [
          "File: src/android.rs -> src/android.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "2: use jni::objects::JValue;",
          "3: pub use std::os::unix::process::ExitStatusExt;",
          "4: use std::process::ExitStatus;",
          "7: #[inline]",
          "10:     let native_activity = ndk_glue::native_activity();",
          "11:     let vm_ptr = native_activity.vm();",
          "",
          "[Removed Lines]",
          "1: use crate::{Browser, Error, ErrorKind, Result};",
          "8: pub fn open_browser_internal(_: Browser, url: &str) -> Result<()> {",
          "",
          "[Added Lines]",
          "1: use crate::{Browser, BrowserOptions, Error, ErrorKind, Result};",
          "8: pub fn open_browser_internal(_: Browser, url: &str, _: &BrowserOptions) -> Result<()> {",
          "",
          "---------------"
        ],
        "src/lib.rs||src/lib.rs": [
          "File: src/lib.rs -> src/lib.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "141:     }",
          "142: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "144: #[derive(Debug, Eq, PartialEq, Copy, Clone, Hash)]",
          "148: pub struct BrowserOptions {",
          "149:     pub suppress_output: bool,",
          "150: }",
          "152: impl fmt::Display for BrowserOptions {",
          "153:     fn fmt(&self, f: &mut fmt::Formatter) -> fmt::Result {",
          "154:         f.write_fmt(format_args!(",
          "155:             \"BrowserOptions(supress_output={})\",",
          "156:             self.suppress_output",
          "157:         ))",
          "158:     }",
          "159: }",
          "161: impl std::default::Default for BrowserOptions {",
          "162:     fn default() -> Self {",
          "163:         BrowserOptions {",
          "164:             suppress_output: true,",
          "165:         }",
          "166:     }",
          "167: }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "179: pub fn open_browser(browser: Browser, url: &str) -> Result<()> {",
          "180:     let url_s: String = match url::Url::parse(url) {",
          "181:         Ok(u) => u.as_str().into(),",
          "182:         Err(_) => url.into(),",
          "183:     };",
          "185: }",
          "187: #[test]",
          "",
          "[Removed Lines]",
          "184:     os::open_browser_internal(browser, &url_s)",
          "",
          "[Added Lines]",
          "205:     open_browser_with_options(browser, url, &BrowserOptions::default())",
          "206: }",
          "222: pub fn open_browser_with_options(",
          "223:     browser: Browser,",
          "224:     url: &str,",
          "225:     options: &BrowserOptions,",
          "226: ) -> Result<()> {",
          "231:     os::open_browser_internal(browser, &url_s, options)",
          "",
          "---------------"
        ],
        "src/macos.rs||src/macos.rs": [
          "File: src/macos.rs -> src/macos.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "4: mod common;",
          "5: use common::from_status;",
          "8: #[inline]",
          "10:     let url_s: String = match url::Url::parse(url_raw) {",
          "11:         Ok(u) => u.as_str().into(),",
          "12:         Err(_) => url_raw.into(),",
          "",
          "[Removed Lines]",
          "1: use crate::{Browser, Error, ErrorKind, Result};",
          "2: use std::process::Command;",
          "9: pub fn open_browser_internal(browser: Browser, url_raw: &str) -> Result<()> {",
          "",
          "[Added Lines]",
          "1: use crate::{Browser, BrowserOptions, Error, ErrorKind, Result};",
          "2: use std::process::{Command, Stdio};",
          "9: pub fn open_browser_internal(",
          "10:     browser: Browser,",
          "11:     url_raw: &str,",
          "12:     options: &BrowserOptions,",
          "13: ) -> Result<()> {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "14:     let url = &url_s;",
          "15:     let mut cmd = Command::new(\"open\");",
          "16:     match browser {",
          "18:         _ => {",
          "19:             let app: Option<&str> = match browser {",
          "20:                 Browser::Firefox => Some(\"Firefox\"),",
          "",
          "[Removed Lines]",
          "17:         Browser::Default => from_status(cmd.arg(url).status()),",
          "",
          "[Added Lines]",
          "21:         Browser::Default => run_command(cmd.arg(url), options),",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "25:                 _ => None,",
          "26:             };",
          "27:             match app {",
          "29:                 None => Err(Error::new(",
          "30:                     ErrorKind::NotFound,",
          "31:                     format!(\"Unsupported browser {:?}\", browser),",
          "",
          "[Removed Lines]",
          "28:                 Some(name) => from_status(cmd.arg(\"-a\").arg(name).arg(url).status()),",
          "",
          "[Added Lines]",
          "32:                 Some(name) => run_command(cmd.arg(\"-a\").arg(name).arg(url), options),",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "34:         }",
          "35:     }",
          "36: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "42: fn run_command(cmd: &mut Command, options: &BrowserOptions) -> Result<()> {",
          "43:     if options.suppress_output {",
          "44:         cmd.stdout(Stdio::null())",
          "45:             .stdin(Stdio::null())",
          "46:             .stderr(Stdio::null());",
          "47:     }",
          "48:     from_status(cmd.status())",
          "49: }",
          "",
          "---------------"
        ],
        "src/unix.rs||src/unix.rs": [
          "File: src/unix.rs -> src/unix.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "2: use std::os::unix::fs::PermissionsExt;",
          "3: use std::path::{Path, PathBuf};",
          "4: use std::process::{Command, Stdio};",
          "6: macro_rules! try_browser {",
          "8:         for_matching_path($name, |pb| {",
          "9:             let mut cmd = Command::new(pb);",
          "10:             $(",
          "11:                 cmd.arg($arg);",
          "12:             )+",
          "14:         })",
          "15:     }",
          "16: }",
          "",
          "[Removed Lines]",
          "1: use crate::{Browser, Error, ErrorKind, Result};",
          "7:     ( $name:expr, $( $arg:expr ),+ ) => {",
          "13:             run_command(&mut cmd, !is_text_browser(&pb))",
          "",
          "[Added Lines]",
          "1: use crate::{Browser, BrowserOptions, Error, ErrorKind, Result};",
          "7:     ( $options: expr, $name:expr, $( $arg:expr ),+ ) => {",
          "13:             run_command(&mut cmd, !is_text_browser(&pb), $options)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "25: #[inline]",
          "34:         .or_else(|r| match guess_desktop_env() {",
          "51:             _ => Err(r),",
          "52:         })",
          "56:         .map_err(|_| {",
          "57:             Error::new(",
          "",
          "[Removed Lines]",
          "26: pub fn open_browser_internal(_: Browser, url: &str) -> Result<()> {",
          "28:     try_with_browser_env(url)",
          "30:         .or_else(|_| try_haiku(url))",
          "32:         .or_else(|_| try_browser!(\"xdg-open\", url))",
          "35:             \"kde\" => try_browser!(\"kde-open\", url)",
          "36:                 .or_else(|_| try_browser!(\"kde-open5\", url))",
          "37:                 .or_else(|_| try_browser!(\"kfmclient\", \"newTab\", url)),",
          "39:             \"gnome\" => try_browser!(\"gio\", \"open\", url)",
          "40:                 .or_else(|_| try_browser!(\"gvfs-open\", url))",
          "41:                 .or_else(|_| try_browser!(\"gnome-open\", url)),",
          "43:             \"mate\" => try_browser!(\"gio\", \"open\", url)",
          "44:                 .or_else(|_| try_browser!(\"gvfs-open\", url))",
          "45:                 .or_else(|_| try_browser!(\"mate-open\", url)),",
          "47:             \"xfce\" => try_browser!(\"exo-open\", url)",
          "48:                 .or_else(|_| try_browser!(\"gio\", \"open\", url))",
          "49:                 .or_else(|_| try_browser!(\"gvfs-open\", url)),",
          "54:         .or_else(|_| try_browser!(\"x-www-browser\", url))",
          "",
          "[Added Lines]",
          "26: pub fn open_browser_internal(_: Browser, url: &str, options: &BrowserOptions) -> Result<()> {",
          "28:     try_with_browser_env(url, options)",
          "30:         .or_else(|_| try_haiku(options, url))",
          "32:         .or_else(|_| try_browser!(options, \"xdg-open\", url))",
          "35:             \"kde\" => try_browser!(options, \"kde-open\", url)",
          "36:                 .or_else(|_| try_browser!(options, \"kde-open5\", url))",
          "37:                 .or_else(|_| try_browser!(options, \"kfmclient\", \"newTab\", url)),",
          "39:             \"gnome\" => try_browser!(options, \"gio\", \"open\", url)",
          "40:                 .or_else(|_| try_browser!(options, \"gvfs-open\", url))",
          "41:                 .or_else(|_| try_browser!(options, \"gnome-open\", url)),",
          "43:             \"mate\" => try_browser!(options, \"gio\", \"open\", url)",
          "44:                 .or_else(|_| try_browser!(options, \"gvfs-open\", url))",
          "45:                 .or_else(|_| try_browser!(options, \"mate-open\", url)),",
          "47:             \"xfce\" => try_browser!(options, \"exo-open\", url)",
          "48:                 .or_else(|_| try_browser!(options, \"gio\", \"open\", url))",
          "49:                 .or_else(|_| try_browser!(options, \"gvfs-open\", url)),",
          "54:         .or_else(|_| try_browser!(options, \"x-www-browser\", url))",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "64: }",
          "66: #[inline]",
          "69:     for browser in std::env::var(\"BROWSER\")",
          "70:         .unwrap_or_else(|_| String::from(\"\"))",
          "",
          "[Removed Lines]",
          "67: fn try_with_browser_env(url: &str) -> Result<()> {",
          "",
          "[Added Lines]",
          "67: fn try_with_browser_env(url: &str, options: &BrowserOptions) -> Result<()> {",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "89:                     cmd.arg(url);",
          "90:                 }",
          "92:             });",
          "93:             if env_exit.is_ok() {",
          "94:                 return Ok(());",
          "",
          "[Removed Lines]",
          "91:                 run_command(&mut cmd, !is_text_browser(pb))",
          "",
          "[Added Lines]",
          "91:                 run_command(&mut cmd, !is_text_browser(pb), options)",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "138: #[inline]",
          "140:     if cfg!(target_os = \"haiku\") {",
          "142:     } else {",
          "143:         Err(Error::new(ErrorKind::NotFound, \"Not on haiku\"))",
          "144:     }",
          "",
          "[Removed Lines]",
          "139: fn try_haiku(url: &str) -> Result<()> {",
          "141:         try_browser!(\"open\", url).map(|_| ())",
          "",
          "[Added Lines]",
          "139: fn try_haiku(options: &BrowserOptions, url: &str) -> Result<()> {",
          "141:         try_browser!(options, \"open\", url).map(|_| ())",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "195: #[inline]",
          "197:     if background {",
          "205:     } else {",
          "208:         cmd.status().and_then(|status| {",
          "209:             if status.success() {",
          "210:                 Ok(())",
          "",
          "[Removed Lines]",
          "196: fn run_command(cmd: &mut Command, background: bool) -> Result<()> {",
          "200:         cmd.stdin(Stdio::null())",
          "201:             .stdout(Stdio::null())",
          "202:             .stderr(Stdio::null())",
          "203:             .spawn()",
          "204:             .map(|_| ())",
          "",
          "[Added Lines]",
          "196: fn run_command(cmd: &mut Command, background: bool, options: &BrowserOptions) -> Result<()> {",
          "200:         if options.suppress_output {",
          "201:             cmd.stdin(Stdio::null())",
          "202:                 .stdout(Stdio::null())",
          "203:                 .stderr(Stdio::null())",
          "204:         } else {",
          "205:             cmd",
          "206:         }",
          "207:         .spawn()",
          "208:         .map(|_| ())",
          "",
          "---------------"
        ],
        "src/wasm.rs||src/wasm.rs": [
          "File: src/wasm.rs -> src/wasm.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: #[inline]",
          "8:     let configured_target = option_env!(\"WEBBROWSER_WASM_TARGET\");",
          "9:     let window = web_sys::window();",
          "10:     match window {",
          "11:         Some(w) => {",
          "12:             let target = configured_target.unwrap_or_else(|| \"_blank\");",
          "15:             match w.open_with_url_and_target(url, target) {",
          "16:                 Ok(x) => match x {",
          "17:                     Some(_) => Ok(()),",
          "18:                     None => {",
          "20:                         Err(Error::new(ErrorKind::Other, POPUP_ERR_MSG))",
          "21:                     }",
          "22:                 },",
          "23:                 Err(_) => {",
          "25:                     Err(Error::new(ErrorKind::Other, \"error opening url\"))",
          "26:                 }",
          "27:             }",
          "",
          "[Removed Lines]",
          "1: use crate::{Browser, Error, ErrorKind, Result};",
          "6: pub fn open_browser_internal(_: Browser, url: &str) -> Result<()> {",
          "13:             wasm_console_log(&format!(\"target for url {} detected as {}\", url, target));",
          "19:                         wasm_console_log(POPUP_ERR_MSG);",
          "24:                     wasm_console_log(\"window error while opening url\");",
          "",
          "[Added Lines]",
          "1: use crate::{Browser, BrowserOptions, Error, ErrorKind, Result};",
          "6: pub fn open_browser_internal(_: Browser, url: &str, options: &BrowserOptions) -> Result<()> {",
          "13:             wasm_console_log(",
          "14:                 &format!(\"target for url {} detected as {}\", url, target),",
          "15:                 options,",
          "16:             );",
          "22:                         wasm_console_log(POPUP_ERR_MSG, options);",
          "27:                     wasm_console_log(\"window error while opening url\", options);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "34: }",
          "38:     #[cfg(all(debug_assertions, feature = \"wasm-console\"))]",
          "40: }",
          "42: const POPUP_ERR_MSG: &'static str = \"popup blocked? window detected, but open_url failed\";",
          "",
          "[Removed Lines]",
          "37: fn wasm_console_log(_msg: &str) {",
          "39:     web_sys::console::log_1(&format!(\"[webbrowser] {}\", &_msg).into());",
          "",
          "[Added Lines]",
          "40: fn wasm_console_log(_msg: &str, options: &BrowserOptions) {",
          "42:     if !options.suppress_output {",
          "43:         web_sys::console::log_1(&format!(\"[webbrowser] {}\", &_msg).into());",
          "44:     }",
          "",
          "---------------"
        ],
        "src/windows.rs||src/windows.rs": [
          "File: src/windows.rs -> src/windows.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: extern crate widestring;",
          "2: extern crate winapi;",
          "5: pub use std::os::windows::process::ExitStatusExt;",
          "6: use std::ptr;",
          "7: use widestring::U16CString;",
          "12: #[inline]",
          "14:     use winapi::shared::winerror::SUCCEEDED;",
          "15:     use winapi::um::combaseapi::{CoInitializeEx, CoUninitialize};",
          "16:     use winapi::um::objbase::{COINIT_APARTMENTTHREADED, COINIT_DISABLE_OLE1DDE};",
          "",
          "[Removed Lines]",
          "4: use crate::{Browser, Error, ErrorKind, Result};",
          "13: pub fn open_browser_internal(browser: Browser, url: &str) -> Result<()> {",
          "",
          "[Added Lines]",
          "4: use crate::{Browser, BrowserOptions, Error, ErrorKind, Result};",
          "15: pub fn open_browser_internal(browser: Browser, url: &str, _: &BrowserOptions) -> Result<()> {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "0d426c3652410099f93aee6bdf863bd920829161",
      "candidate_info": {
        "commit_hash": "0d426c3652410099f93aee6bdf863bd920829161",
        "repo": "amodm/webbrowser-rs",
        "commit_url": "https://github.com/amodm/webbrowser-rs/commit/0d426c3652410099f93aee6bdf863bd920829161",
        "files": [
          "src/lib.rs"
        ],
        "message": "fix wasm build (again) #build-wasm",
        "before_after_code_files": [
          "src/lib.rs||src/lib.rs"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/lib.rs||src/lib.rs"
          ],
          "candidate": [
            "src/lib.rs||src/lib.rs"
          ]
        }
      },
      "candidate_diff": {
        "src/lib.rs||src/lib.rs": [
          "File: src/lib.rs -> src/lib.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "71: use std::fmt::Display;",
          "72: use std::io::{Error, ErrorKind, Result};",
          "73: use std::ops::Deref;",
          "75: use std::str::FromStr;",
          "76: use std::{error, fmt};",
          "",
          "[Removed Lines]",
          "74: use std::path::PathBuf;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "335: impl TryFrom<&str> for TargetType {",
          "336:     type Error = Error;",
          "338:     fn try_from(value: &str) -> Result<Self> {",
          "339:         match url::Url::parse(value) {",
          "340:             Ok(u) => Ok(Self(u)),",
          "341:             Err(_) => {",
          "344:                 } else {",
          "358:             }",
          "359:         }",
          "360:     }",
          "",
          "[Removed Lines]",
          "342:                 if cfg!(target_family = \"wasm\") {",
          "343:                     Err(Error::new(ErrorKind::InvalidInput, \"invalid url for wasm\"))",
          "346:                     let pb = PathBuf::from(value);",
          "347:                     let url = url::Url::from_file_path(if pb.is_relative() {",
          "348:                         std::env::current_dir()?.join(pb)",
          "349:                     } else {",
          "350:                         pb",
          "351:                     })",
          "352:                     .map_err(|_| {",
          "353:                         Error::new(ErrorKind::InvalidInput, \"failed to convert path to url\")",
          "354:                     })?;",
          "356:                     Ok(Self(url))",
          "357:                 }",
          "",
          "[Added Lines]",
          "337:     #[cfg(target_family = \"wasm\")]",
          "338:     fn try_from(_: &str) -> Result<Self> {",
          "339:         Err(Error::new(ErrorKind::InvalidInput, \"invalid url for wasm\"))",
          "340:     }",
          "342:     #[cfg(not(target_family = \"wasm\"))]",
          "348:                 let pb = std::path::PathBuf::from(value);",
          "349:                 let url = url::Url::from_file_path(if pb.is_relative() {",
          "350:                     std::env::current_dir()?.join(pb)",
          "352:                     pb",
          "353:                 })",
          "354:                 .map_err(|_| {",
          "355:                     Error::new(ErrorKind::InvalidInput, \"failed to convert path to url\")",
          "356:                 })?;",
          "358:                 Ok(Self(url))",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "31203d25780935d2a49eae31ca70af444deb2e25",
      "candidate_info": {
        "commit_hash": "31203d25780935d2a49eae31ca70af444deb2e25",
        "repo": "amodm/webbrowser-rs",
        "commit_url": "https://github.com/amodm/webbrowser-rs/commit/31203d25780935d2a49eae31ca70af444deb2e25",
        "files": [
          "src/android.rs",
          "src/ios.rs",
          "src/lib.rs",
          "src/macos.rs",
          "src/unix.rs",
          "src/wasm.rs",
          "src/windows.rs",
          "tests/test-ios-app/testglue/src/lib.rs"
        ],
        "message": "change internal signature to better handle url and local paths separately",
        "before_after_code_files": [
          "src/android.rs||src/android.rs",
          "src/ios.rs||src/ios.rs",
          "src/lib.rs||src/lib.rs",
          "src/macos.rs||src/macos.rs",
          "src/unix.rs||src/unix.rs",
          "src/wasm.rs||src/wasm.rs",
          "src/windows.rs||src/windows.rs",
          "tests/test-ios-app/testglue/src/lib.rs||tests/test-ios-app/testglue/src/lib.rs"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/lib.rs||src/lib.rs",
            "src/macos.rs||src/macos.rs",
            "src/unix.rs||src/unix.rs",
            "src/windows.rs||src/windows.rs"
          ],
          "candidate": [
            "src/lib.rs||src/lib.rs",
            "src/macos.rs||src/macos.rs",
            "src/unix.rs||src/unix.rs",
            "src/windows.rs||src/windows.rs"
          ]
        }
      },
      "candidate_diff": {
        "src/android.rs||src/android.rs": [
          "File: src/android.rs -> src/android.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "2: use jni::objects::JValue;",
          "3: use std::process::{Command, Stdio};",
          "9:     match browser {",
          "10:         Browser::Default => open_browser_default(url, options),",
          "11:         _ => Err(Error::new(",
          "",
          "[Removed Lines]",
          "1: use crate::{Browser, BrowserOptions, Error, ErrorKind, Result};",
          "7: #[inline]",
          "8: pub fn open_browser_internal(browser: Browser, url: &str, options: &BrowserOptions) -> Result<()> {",
          "",
          "[Added Lines]",
          "1: use crate::{Browser, BrowserOptions, Error, ErrorKind, Result, TargetType};",
          "7: pub(super) fn open_browser_internal(",
          "8:     browser: Browser,",
          "9:     target: &TargetType,",
          "10:     options: &BrowserOptions,",
          "11: ) -> Result<()> {",
          "13:     let url = crate::get_http_url(target)?;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "16: }",
          "20: fn open_browser_default(url: &str, options: &BrowserOptions) -> Result<()> {",
          "22:     if options.dry_run {",
          "",
          "[Removed Lines]",
          "19: #[inline]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "100: fn try_for_termux(url: &str, options: &BrowserOptions) -> Result<()> {",
          "101:     use std::env;",
          "102:     if env::var(\"TERMUX_VERSION\").is_ok() {",
          "",
          "[Removed Lines]",
          "99: #[inline]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/ios.rs||src/ios.rs": [
          "File: src/ios.rs -> src/ios.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "2: use objc::{class, msg_send, runtime::Object, sel, sel_impl};",
          "7:     _browser: Browser,",
          "10: ) -> Result<()> {",
          "13:         return Ok(());",
          "14:     }",
          "19:     unsafe {",
          "20:         let app: *mut Object = msg_send![class!(UIApplication), sharedApplication];",
          "21:         if app.is_null() {",
          "",
          "[Removed Lines]",
          "1: use crate::{Browser, BrowserOptions, Error, ErrorKind, Result};",
          "5: #[inline]",
          "6: pub fn open_browser_internal(",
          "8:     url: &str,",
          "9:     _options: &BrowserOptions,",
          "12:     if _options.dry_run {",
          "15:     let url_s: String = match url::Url::parse(url) {",
          "16:         Ok(u) => u.as_str().into(),",
          "17:         Err(_) => url.into(),",
          "18:     };",
          "",
          "[Added Lines]",
          "1: use crate::{Browser, BrowserOptions, Error, ErrorKind, Result, TargetType};",
          "5: pub(super) fn open_browser_internal(",
          "7:     target: &TargetType,",
          "8:     options: &BrowserOptions,",
          "11:     let url = crate::get_http_url(target)?;",
          "14:     if options.dry_run {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "24:                 \"UIApplication is null, can't open url\",",
          "25:             ));",
          "26:         }",
          "29:         let url_string: *mut Object = msg_send![class!(NSString), stringWithUTF8String: url_cstr];",
          "",
          "[Removed Lines]",
          "27:         let url_cstr = std::ffi::CString::new(url_s).unwrap();",
          "",
          "[Added Lines]",
          "26:         let url_cstr = std::ffi::CString::new(url).unwrap();",
          "",
          "---------------"
        ],
        "src/lib.rs||src/lib.rs": [
          "File: src/lib.rs -> src/lib.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "280:     url: &str,",
          "281:     options: &BrowserOptions,",
          "282: ) -> Result<()> {",
          "286:     };",
          "288: }",
          "290: #[test]",
          "",
          "[Removed Lines]",
          "283:     let url_s: String = match url::Url::parse(url) {",
          "284:         Ok(u) => u.as_str().into(),",
          "285:         Err(_) => url.into(),",
          "287:     os::open_browser_internal(browser, &url_s, options)",
          "",
          "[Added Lines]",
          "283:     let target = match url::Url::parse(url) {",
          "284:         Ok(u) => TargetType::Url(u),",
          "285:         Err(_) => TargetType::Path(url.into()),",
          "287:     os::open_browser_internal(browser, &target, options)",
          "288: }",
          "292: enum TargetType {",
          "293:     Url(url::Url),",
          "294:     Path(String),",
          "295: }",
          "299: #[cfg(any(target_os = \"android\", target_os = \"ios\", target_family = \"wasm\"))]",
          "300: #[inline]",
          "301: pub(crate) fn get_http_url(target: &TargetType) -> Result<&str> {",
          "302:     match target {",
          "303:         TargetType::Url(u) => match u.scheme() {",
          "304:             \"http\" | \"https\" => Ok(u.as_str()),",
          "305:             _ => Err(Error::new(ErrorKind::InvalidInput, \"not a valid url\")),",
          "306:         },",
          "307:         _ => Err(Error::new(ErrorKind::InvalidInput, \"not a valid url\")),",
          "308:     }",
          "",
          "---------------"
        ],
        "src/macos.rs||src/macos.rs": [
          "File: src/macos.rs -> src/macos.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "2: use std::process::{Command, Stdio};",
          "4: mod common;",
          "5: use common::from_status;",
          "10:     browser: Browser,",
          "12:     options: &BrowserOptions,",
          "13: ) -> Result<()> {",
          "17:     };",
          "19:     let mut cmd = Command::new(\"open\");",
          "20:     match browser {",
          "21:         Browser::Default => {",
          "",
          "[Removed Lines]",
          "1: use crate::{Browser, BrowserOptions, Error, ErrorKind, Result};",
          "8: #[inline]",
          "9: pub fn open_browser_internal(",
          "11:     url_raw: &str,",
          "14:     let url_s: String = match url::Url::parse(url_raw) {",
          "15:         Ok(u) => u.as_str().into(),",
          "16:         Err(_) => url_raw.into(),",
          "18:     let url = &url_s;",
          "",
          "[Added Lines]",
          "1: use crate::{Browser, BrowserOptions, Error, ErrorKind, Result, TargetType};",
          "8: pub(super) fn open_browser_internal(",
          "10:     target: &TargetType,",
          "13:     let url = match target {",
          "14:         TargetType::Url(u) => u.as_str(),",
          "15:         TargetType::Path(s) => s.as_str(),",
          "",
          "---------------"
        ],
        "src/unix.rs||src/unix.rs": [
          "File: src/unix.rs -> src/unix.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "2: use log::{debug, trace};",
          "3: use std::io::{BufRead, BufReader};",
          "4: use std::os::unix::fs::PermissionsExt;",
          "",
          "[Removed Lines]",
          "1: use crate::{Browser, BrowserOptions, Error, ErrorKind, Result};",
          "",
          "[Added Lines]",
          "1: use crate::{Browser, BrowserOptions, Error, ErrorKind, Result, TargetType};",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "28:     match browser {",
          "29:         Browser::Default => open_browser_default(url, options),",
          "30:         _ => Err(Error::new(",
          "",
          "[Removed Lines]",
          "27: pub fn open_browser_internal(browser: Browser, url: &str, options: &BrowserOptions) -> Result<()> {",
          "",
          "[Added Lines]",
          "27: pub(super) fn open_browser_internal(",
          "28:     browser: Browser,",
          "29:     target: &TargetType,",
          "30:     options: &BrowserOptions,",
          "31: ) -> Result<()> {",
          "32:     let url = match target {",
          "33:         TargetType::Url(u) => u.as_str(),",
          "34:         TargetType::Path(s) => s.as_str(),",
          "35:     };",
          "",
          "---------------"
        ],
        "src/wasm.rs||src/wasm.rs": [
          "File: src/wasm.rs -> src/wasm.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "8:     if options.dry_run {",
          "9:         return Ok(());",
          "",
          "[Removed Lines]",
          "1: use crate::{Browser, BrowserOptions, Error, ErrorKind, Result};",
          "5: #[inline]",
          "6: pub fn open_browser_internal(_: Browser, url: &str, options: &BrowserOptions) -> Result<()> {",
          "",
          "[Added Lines]",
          "1: use crate::{Browser, BrowserOptions, Error, ErrorKind, Result, TargetType};",
          "5: pub(super) fn open_browser_internal(",
          "6:     _: Browser,",
          "7:     target: &TargetType,",
          "8:     options: &BrowserOptions,",
          "9: ) -> Result<()> {",
          "11:     let url = crate::get_http_url(target)?;",
          "",
          "---------------"
        ],
        "src/windows.rs||src/windows.rs": [
          "File: src/windows.rs -> src/windows.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: extern crate widestring;",
          "2: extern crate winapi;",
          "5: pub use std::os::windows::process::ExitStatusExt;",
          "6: use std::{mem, ptr};",
          "7: use widestring::U16CString;",
          "21:     };",
          "23:     match browser {",
          "24:         Browser::Default => {",
          "",
          "[Removed Lines]",
          "4: use crate::{Browser, BrowserOptions, Error, ErrorKind, Result};",
          "14: #[inline]",
          "15: pub fn open_browser_internal(browser: Browser, url: &str, options: &BrowserOptions) -> Result<()> {",
          "16:     use winapi::shared::winerror::SUCCEEDED;",
          "17:     use winapi::um::combaseapi::{CoInitializeEx, CoUninitialize};",
          "18:     use winapi::um::objbase::{COINIT_APARTMENTTHREADED, COINIT_DISABLE_OLE1DDE};",
          "19:     use winapi::um::shellapi::{",
          "20:         ShellExecuteExW, SEE_MASK_CLASSNAME, SEE_MASK_NOCLOSEPROCESS, SHELLEXECUTEINFOW,",
          "22:     use winapi::um::winuser::SW_SHOWNORMAL;",
          "",
          "[Added Lines]",
          "4: use crate::{Browser, BrowserOptions, Error, ErrorKind, Result, TargetType};",
          "8: use winapi::shared::winerror::SUCCEEDED;",
          "9: use winapi::um::combaseapi::{CoInitializeEx, CoUninitialize};",
          "10: use winapi::um::objbase::{COINIT_APARTMENTTHREADED, COINIT_DISABLE_OLE1DDE};",
          "11: use winapi::um::shellapi::{",
          "12:     ShellExecuteExW, SEE_MASK_CLASSNAME, SEE_MASK_NOCLOSEPROCESS, SHELLEXECUTEINFOW,",
          "13: };",
          "14: use winapi::um::winuser::SW_SHOWNORMAL;",
          "21: pub(super) fn open_browser_internal(",
          "22:     browser: Browser,",
          "23:     target: &TargetType,",
          "24:     options: &BrowserOptions,",
          "25: ) -> Result<()> {",
          "26:     let url = match target {",
          "27:         TargetType::Url(u) => u.as_str(),",
          "28:         TargetType::Path(s) => s.as_str(),",
          "",
          "---------------"
        ],
        "tests/test-ios-app/testglue/src/lib.rs||tests/test-ios-app/testglue/src/lib.rs": [
          "File: tests/test-ios-app/testglue/src/lib.rs -> tests/test-ios-app/testglue/src/lib.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "2: use std::ffi::CStr;",
          "5: #[no_mangle]",
          "6: pub extern fn test_open_webbrowser(url_c_chars: *const c_char) {",
          "",
          "[Removed Lines]",
          "1: use std::os::raw::{c_char};",
          "3: use webbrowser;",
          "",
          "[Added Lines]",
          "2: use std::os::raw::c_char;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "a3afcbbac1eaa86dd2976853444ec5ad44b04cb8",
      "candidate_info": {
        "commit_hash": "a3afcbbac1eaa86dd2976853444ec5ad44b04cb8",
        "repo": "amodm/webbrowser-rs",
        "commit_url": "https://github.com/amodm/webbrowser-rs/commit/a3afcbbac1eaa86dd2976853444ec5ad44b04cb8",
        "files": [
          "Cargo.toml",
          "src/unix.rs",
          "tests/common.rs",
          "tests/test_macos.rs",
          "tests/test_unix.rs",
          "tests/test_windows.rs"
        ],
        "message": "tests for local html file opening in browser",
        "before_after_code_files": [
          "src/unix.rs||src/unix.rs",
          "tests/common.rs||tests/common.rs",
          "tests/test_macos.rs||tests/test_macos.rs",
          "tests/test_unix.rs||tests/test_unix.rs",
          "tests/test_windows.rs||tests/test_windows.rs"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/unix.rs||src/unix.rs"
          ],
          "candidate": [
            "src/unix.rs||src/unix.rs"
          ]
        }
      },
      "candidate_diff": {
        "src/unix.rs||src/unix.rs": [
          "File: src/unix.rs -> src/unix.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "30:     options: &BrowserOptions,",
          "31: ) -> Result<()> {",
          "32:     match browser {",
          "34:         _ => Err(Error::new(",
          "35:             ErrorKind::NotFound,",
          "36:             \"only default browser supported\",",
          "",
          "[Removed Lines]",
          "33:         Browser::Default => open_browser_default(&target, options),",
          "",
          "[Added Lines]",
          "33:         Browser::Default => open_browser_default(target, options),",
          "",
          "---------------"
        ],
        "tests/common.rs||tests/common.rs": [
          "File: tests/common.rs -> tests/common.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: use actix_files as fs;",
          "2: use actix_web::{web, App, HttpRequest, HttpResponse, HttpServer, Responder};",
          "3: use crossbeam_channel as cbc;",
          "5: use urlencoding::decode;",
          "6: use webbrowser::{open_browser, Browser};",
          "",
          "[Removed Lines]",
          "4: use std::sync::Arc;",
          "",
          "[Added Lines]",
          "4: use rand::RngCore;",
          "5: use std::{io::Write, path::PathBuf, sync::Arc};",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "14:     if data.tx.send(req.uri().to_string()).is_err() {",
          "15:         panic!(\"channel send failed\");",
          "16:     }",
          "20: }",
          "22: pub async fn check_request_received_using<F>(uri: String, host: &str, op: F)",
          "",
          "[Removed Lines]",
          "17:     HttpResponse::Ok()",
          "18:         .content_type(\"text/html; charset=utf-8\")",
          "19:         .body(format!(\"<html><body><p>URI: {}</p><script type=\\\"text/javascript>window.close();</script></body></html>\", req.uri()))",
          "",
          "[Added Lines]",
          "18:     let uri = req.uri();",
          "19:     if uri.path() == URI_PNG_1PX {",
          "20:         HttpResponse::Ok()",
          "21:             .content_type(\"image/png\")",
          "22:             .body(PNG_1PX.to_vec())",
          "23:     } else {",
          "24:         HttpResponse::Ok()",
          "25:             .content_type(\"text/html; charset=utf-8\")",
          "26:             .body(format!(\"<html><body><p>URI: {}</p><script type=\\\"text/javascript>window.close();</script></body></html>\", req.uri()))",
          "27:     }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "78:     .await;",
          "79: }",
          "81: #[allow(dead_code)]",
          "82: pub async fn check_browser(browser: Browser, platform: &str) {",
          "83:     check_request_received(browser, format!(\"/{}\", platform)).await;",
          "84:     check_request_received(browser, format!(\"/{}/\ud83d\ude00\ud83d\ude00\ud83d\ude00\", platform)).await;",
          "85: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "89: #[allow(dead_code)]",
          "90: pub async fn check_local_file<F>(browser: Browser, html_dir: Option<PathBuf>, url_op: F)",
          "91: where",
          "92:     F: FnOnce(&PathBuf) -> String,",
          "93: {",
          "94:     let cwd = std::env::current_dir().expect(\"unable to determine current dir\");",
          "95:     let tmpdir = cwd.join(\"target\").join(\"tmp\");",
          "96:     let html_dir = html_dir.unwrap_or(tmpdir);",
          "97:     let id = rand::thread_rng().next_u32();",
          "98:     let pb = html_dir.join(format!(\"test.{}.html\", id));",
          "99:     let img_uri = format!(\"{}?r={}\", URI_PNG_1PX, id);",
          "100:     check_request_received_using(img_uri, \"127.0.0.1\", |uri| {",
          "101:         let url = url_op(&pb);",
          "102:         let mut html_file = std::fs::File::create(&pb).expect(\"failed to create html file\");",
          "103:         html_file",
          "104:             .write_fmt(format_args!(",
          "105:                 \"<p>html file: {}</p><p>url: {}</p>img: <img src=\\\"{}\\\"/>\",",
          "106:                 &pb.as_os_str().to_string_lossy(),",
          "107:                 url,",
          "108:                 uri",
          "109:             ))",
          "110:             .expect(\"failed to write html file\");",
          "111:         drop(html_file);",
          "112:         open_browser(browser, &url).expect(\"failed to open browser\");",
          "113:     })",
          "114:     .await;",
          "115:     let _ = std::fs::remove_file(&pb);",
          "116: }",
          "124: const URI_PNG_1PX: &str = \"/img/1px.png\";",
          "127: const PNG_1PX: [u8; 82] = [",
          "128:     137, 80, 78, 71, 13, 10, 26, 10, 0, 0, 0, 13, 73, 72, 68, 82, 0, 0, 0, 1, 0, 0, 0, 1, 8, 2, 0,",
          "129:     0, 0, 144, 119, 83, 222, 0, 0, 0, 1, 115, 82, 71, 66, 0, 174, 206, 28, 233, 0, 0, 0, 12, 73,",
          "130:     68, 65, 84, 24, 87, 99, 248, 239, 154, 12, 0, 3, 238, 1, 168, 16, 134, 253, 64, 0, 0, 0, 0, 73,",
          "131:     69, 78, 68, 174, 66, 96, 130,",
          "132: ];",
          "",
          "---------------"
        ],
        "tests/test_macos.rs||tests/test_macos.rs": [
          "File: tests/test_macos.rs -> tests/test_macos.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: mod tests {",
          "6:     const TEST_PLATFORM: &str = \"macos\";",
          "9:     use webbrowser::Browser;",
          "11:     #[tokio::test(flavor = \"multi_thread\", worker_threads = 2)]",
          "",
          "[Removed Lines]",
          "8:     use super::common::check_browser;",
          "",
          "[Added Lines]",
          "8:     use super::common::{check_browser, check_local_file};",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "47:             \"should not have found WebPositive\",",
          "48:         );",
          "49:     }",
          "50: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "51:     #[tokio::test(flavor = \"multi_thread\", worker_threads = 2)]",
          "52:     async fn test_local_file_abs_path() {",
          "53:         check_local_file(Browser::Default, None, |pb| {",
          "54:             pb.as_os_str().to_string_lossy().into()",
          "55:         })",
          "56:         .await;",
          "57:     }",
          "59:     #[tokio::test(flavor = \"multi_thread\", worker_threads = 2)]",
          "60:     async fn test_local_file_rel_path() {",
          "61:         let cwd = std::env::current_dir().expect(\"unable to get current dir\");",
          "62:         check_local_file(Browser::Default, None, |pb| {",
          "63:             pb.strip_prefix(cwd)",
          "64:                 .expect(\"strip prefix failed\")",
          "65:                 .as_os_str()",
          "66:                 .to_string_lossy()",
          "67:                 .into()",
          "68:         })",
          "69:         .await;",
          "70:     }",
          "72:     #[tokio::test(flavor = \"multi_thread\", worker_threads = 2)]",
          "73:     async fn test_local_file_uri() {",
          "74:         check_local_file(Browser::Default, None, |pb| {",
          "75:             url::Url::from_file_path(pb)",
          "76:                 .expect(\"failed to convert path to url\")",
          "77:                 .to_string()",
          "78:         })",
          "79:         .await;",
          "80:     }",
          "",
          "---------------"
        ],
        "tests/test_unix.rs||tests/test_unix.rs": [
          "File: tests/test_unix.rs -> tests/test_unix.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: mod tests {",
          "6:     const TEST_PLATFORM: &str = \"unix\";",
          "9:     use webbrowser::Browser;",
          "11:     #[tokio::test(flavor = \"multi_thread\", worker_threads = 2)]",
          "",
          "[Removed Lines]",
          "8:     use super::common::check_browser;",
          "",
          "[Added Lines]",
          "8:     use super::common::{check_browser, check_local_file};",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "22:     fn test_non_existence_safari() {",
          "23:         assert!(!Browser::Safari.exists(), \"should not have found Safari\");",
          "24:     }",
          "25: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "26:     #[tokio::test(flavor = \"multi_thread\", worker_threads = 2)]",
          "27:     async fn test_local_file_abs_path() {",
          "28:         check_local_file(Browser::Default, None, |pb| {",
          "29:             pb.as_os_str().to_string_lossy().into()",
          "30:         })",
          "31:         .await;",
          "32:     }",
          "34:     #[tokio::test(flavor = \"multi_thread\", worker_threads = 2)]",
          "35:     async fn test_local_file_rel_path() {",
          "36:         let cwd = std::env::current_dir().expect(\"unable to get current dir\");",
          "37:         check_local_file(Browser::Default, None, |pb| {",
          "38:             pb.strip_prefix(cwd)",
          "39:                 .expect(\"strip prefix failed\")",
          "40:                 .as_os_str()",
          "41:                 .to_string_lossy()",
          "42:                 .into()",
          "43:         })",
          "44:         .await;",
          "45:     }",
          "47:     #[tokio::test(flavor = \"multi_thread\", worker_threads = 2)]",
          "48:     async fn test_local_file_uri() {",
          "49:         check_local_file(Browser::Default, None, |pb| {",
          "50:             url::Url::from_file_path(pb)",
          "51:                 .expect(\"failed to convert path to url\")",
          "52:                 .to_string()",
          "53:         })",
          "54:         .await;",
          "55:     }",
          "",
          "---------------"
        ],
        "tests/test_windows.rs||tests/test_windows.rs": [
          "File: tests/test_windows.rs -> tests/test_windows.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: mod tests {",
          "6:     const TEST_PLATFORM: &str = \"windows\";",
          "9:     use webbrowser::Browser;",
          "11:     #[tokio::test(flavor = \"multi_thread\", worker_threads = 2)]",
          "",
          "[Removed Lines]",
          "8:     use super::common::check_browser;",
          "",
          "[Added Lines]",
          "8:     use super::common::{check_browser, check_local_file};",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "28:     fn test_non_existence_safari() {",
          "29:         assert!(!Browser::Safari.exists(), \"should not have found Safari\");",
          "30:     }",
          "31: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "32:     #[tokio::test(flavor = \"multi_thread\", worker_threads = 2)]",
          "33:     async fn test_local_file_abs_path() {",
          "34:         check_local_file(Browser::Default, None, |pb| {",
          "35:             pb.as_os_str().to_string_lossy().into()",
          "36:         })",
          "37:         .await;",
          "38:     }",
          "40:     #[tokio::test(flavor = \"multi_thread\", worker_threads = 2)]",
          "41:     async fn test_local_file_rel_path() {",
          "42:         let cwd = std::env::current_dir().expect(\"unable to get current dir\");",
          "43:         check_local_file(Browser::Default, None, |pb| {",
          "44:             pb.strip_prefix(cwd)",
          "45:                 .expect(\"strip prefix failed\")",
          "46:                 .as_os_str()",
          "47:                 .to_string_lossy()",
          "48:                 .into()",
          "49:         })",
          "50:         .await;",
          "51:     }",
          "53:     #[tokio::test(flavor = \"multi_thread\", worker_threads = 2)]",
          "54:     async fn test_local_file_uri() {",
          "55:         check_local_file(Browser::Default, None, |pb| {",
          "56:             url::Url::from_file_path(pb)",
          "57:                 .expect(\"failed to convert path to url\")",
          "58:                 .to_string()",
          "59:         })",
          "60:         .await;",
          "61:     }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "a487a1c448f347afd3df3eea7d3e560334928315",
      "candidate_info": {
        "commit_hash": "a487a1c448f347afd3df3eea7d3e560334928315",
        "repo": "amodm/webbrowser-rs",
        "commit_url": "https://github.com/amodm/webbrowser-rs/commit/a487a1c448f347afd3df3eea7d3e560334928315",
        "files": [
          "src/android.rs",
          "src/lib.rs",
          "src/macos.rs",
          "src/unix.rs",
          "src/wasm.rs",
          "src/windows.rs",
          "tests/test_android.rs",
          "tests/test_macos.rs",
          "tests/test_unix.rs",
          "tests/test_wasm.rs",
          "tests/test_windows.rs"
        ],
        "message": "Introduce BrowserOptions::is_available() to fix #46",
        "before_after_code_files": [
          "src/android.rs||src/android.rs",
          "src/lib.rs||src/lib.rs",
          "src/macos.rs||src/macos.rs",
          "src/unix.rs||src/unix.rs",
          "src/wasm.rs||src/wasm.rs",
          "src/windows.rs||src/windows.rs",
          "tests/test_android.rs||tests/test_android.rs",
          "tests/test_macos.rs||tests/test_macos.rs",
          "tests/test_unix.rs||tests/test_unix.rs",
          "tests/test_wasm.rs||tests/test_wasm.rs",
          "tests/test_windows.rs||tests/test_windows.rs"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/lib.rs||src/lib.rs",
            "src/macos.rs||src/macos.rs",
            "src/unix.rs||src/unix.rs",
            "src/windows.rs||src/windows.rs"
          ],
          "candidate": [
            "src/lib.rs||src/lib.rs",
            "src/macos.rs||src/macos.rs",
            "src/unix.rs||src/unix.rs",
            "src/windows.rs||src/windows.rs"
          ]
        }
      },
      "candidate_diff": {
        "src/android.rs||src/android.rs": [
          "File: src/android.rs -> src/android.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: pub use std::os::unix::process::ExitStatusExt;",
          "4: use std::process::ExitStatus;",
          "7: #[inline]",
          "10:     let native_activity = ndk_glue::native_activity();",
          "11:     let vm_ptr = native_activity.vm();",
          "",
          "[Removed Lines]",
          "8: pub fn open_browser_internal(_: Browser, url: &str, _: &BrowserOptions) -> Result<()> {",
          "",
          "[Added Lines]",
          "9: pub fn open_browser_internal(browser: Browser, url: &str, options: &BrowserOptions) -> Result<()> {",
          "10:     match browser {",
          "11:         Browser::Default => open_browser_default(url, options),",
          "12:         _ => Err(Error::new(",
          "13:             ErrorKind::NotFound,",
          "14:             \"only default browser supported\",",
          "15:         )),",
          "16:     }",
          "17: }",
          "20: #[inline]",
          "21: pub fn open_browser_default(url: &str, options: &BrowserOptions) -> Result<()> {",
          "23:     if options.dry_run {",
          "24:         return Ok(());",
          "25:     }",
          "",
          "---------------"
        ],
        "src/lib.rs||src/lib.rs": [
          "File: src/lib.rs -> src/lib.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "88:     WebPositive,",
          "89: }",
          "92: #[derive(Debug, Eq, PartialEq, Copy, Clone, Hash)]",
          "93: pub struct ParseBrowserError;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "91: impl Browser {",
          "93:     pub fn is_available() -> bool {",
          "94:         Browser::Default.exists()",
          "95:     }",
          "98:     pub fn exists(&self) -> bool {",
          "99:         open_browser_with_options(",
          "101:             \"https://rootnet.in\",",
          "102:             BrowserOptions::new().with_dry_run(true),",
          "103:         )",
          "104:         .is_ok()",
          "105:     }",
          "106: }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "149: pub struct BrowserOptions {",
          "158: }",
          "160: impl fmt::Display for BrowserOptions {",
          "161:     fn fmt(&self, f: &mut fmt::Formatter) -> fmt::Result {",
          "162:         f.write_fmt(format_args!(",
          "165:         ))",
          "166:     }",
          "167: }",
          "",
          "[Removed Lines]",
          "152:     pub suppress_output: bool,",
          "157:     pub target_hint: String,",
          "163:             \"BrowserOptions(supress_output={}, target_hint={})\",",
          "164:             self.suppress_output, self.target_hint,",
          "",
          "[Added Lines]",
          "167:     suppress_output: bool,",
          "168:     target_hint: String,",
          "169:     dry_run: bool,",
          "175:             \"BrowserOptions(supress_output={}, target_hint={}, dry_run={})\",",
          "176:             self.suppress_output, self.target_hint, self.dry_run",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "172:         BrowserOptions {",
          "173:             suppress_output: true,",
          "174:             target_hint,",
          "175:         }",
          "176:     }",
          "177: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "187:             dry_run: false,",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "181:         Self::default()",
          "182:     }",
          "184:     pub fn with_suppress_output(&mut self, suppress_output: bool) -> &mut Self {",
          "185:         self.suppress_output = suppress_output;",
          "186:         self",
          "187:     }",
          "189:     pub fn with_target_hint(&mut self, target_hint: &str) -> &mut Self {",
          "190:         self.target_hint = target_hint.to_owned();",
          "191:         self",
          "192:     }",
          "193: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "214:     pub fn with_dry_run(&mut self, dry_run: bool) -> &mut Self {",
          "215:         self.dry_run = dry_run;",
          "216:         self",
          "217:     }",
          "",
          "---------------"
        ],
        "src/macos.rs||src/macos.rs": [
          "File: src/macos.rs -> src/macos.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "18:     let url = &url_s;",
          "19:     let mut cmd = Command::new(\"open\");",
          "20:     match browser {",
          "22:         _ => {",
          "23:             let app: Option<&str> = match browser {",
          "24:                 Browser::Firefox => Some(\"Firefox\"),",
          "",
          "[Removed Lines]",
          "21:         Browser::Default => run_command(cmd.arg(url), options),",
          "",
          "[Added Lines]",
          "21:         Browser::Default => {",
          "23:             if options.dry_run {",
          "24:                 return Ok(());",
          "25:             }",
          "27:             run_command(cmd.arg(url), options)",
          "28:         }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "29:                 _ => None,",
          "30:             };",
          "31:             match app {",
          "33:                 None => Err(Error::new(",
          "34:                     ErrorKind::NotFound,",
          "35:                     format!(\"Unsupported browser {:?}\", browser),",
          "",
          "[Removed Lines]",
          "32:                 Some(name) => run_command(cmd.arg(\"-a\").arg(name).arg(url), options),",
          "",
          "[Added Lines]",
          "39:                 Some(name) => {",
          "40:                     if options.dry_run {",
          "42:                         let md = std::fs::metadata(format!(\"/Applications/{}.app\", name));",
          "43:                         if md.map(|x| x.is_dir()).unwrap_or(false) {",
          "44:                             Ok(())",
          "45:                         } else {",
          "46:                             Err(Error::new(",
          "47:                                 ErrorKind::NotFound,",
          "48:                                 format!(\"Browser {} not available\", name),",
          "49:                             ))",
          "50:                         }",
          "51:                     } else {",
          "53:                         run_command(cmd.arg(\"-a\").arg(name).arg(url), options)",
          "54:                     }",
          "55:                 }",
          "",
          "---------------"
        ],
        "src/unix.rs||src/unix.rs": [
          "File: src/unix.rs -> src/unix.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "25: #[inline]",
          "28:     try_with_browser_env(url, options)",
          "",
          "[Removed Lines]",
          "26: pub fn open_browser_internal(_: Browser, url: &str, options: &BrowserOptions) -> Result<()> {",
          "",
          "[Added Lines]",
          "26: pub fn open_browser_internal(browser: Browser, url: &str, options: &BrowserOptions) -> Result<()> {",
          "27:     match browser {",
          "28:         Browser::Default => open_browser_default(url, options),",
          "29:         _ => Err(Error::new(",
          "30:             ErrorKind::NotFound,",
          "31:             \"only default browser supported\",",
          "32:         )),",
          "33:     }",
          "34: }",
          "40: #[inline]",
          "41: fn open_browser_default(url: &str, options: &BrowserOptions) -> Result<()> {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "195: #[inline]",
          "196: fn run_command(cmd: &mut Command, background: bool, options: &BrowserOptions) -> Result<()> {",
          "197:     if background {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "214:     if options.dry_run {",
          "215:         return Ok(());",
          "216:     }",
          "",
          "---------------"
        ],
        "src/wasm.rs||src/wasm.rs": [
          "File: src/wasm.rs -> src/wasm.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: #[inline]",
          "6: pub fn open_browser_internal(_: Browser, url: &str, options: &BrowserOptions) -> Result<()> {",
          "7:     let window = web_sys::window();",
          "8:     match window {",
          "9:         Some(w) => match w.open_with_url_and_target(url, &options.target_hint) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "8:     if options.dry_run {",
          "9:         return Ok(());",
          "10:     }",
          "",
          "---------------"
        ],
        "src/windows.rs||src/windows.rs": [
          "File: src/windows.rs -> src/windows.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "14: #[inline]",
          "16:     use winapi::shared::winerror::SUCCEEDED;",
          "17:     use winapi::um::combaseapi::{CoInitializeEx, CoUninitialize};",
          "18:     use winapi::um::objbase::{COINIT_APARTMENTTHREADED, COINIT_DISABLE_OLE1DDE};",
          "",
          "[Removed Lines]",
          "15: pub fn open_browser_internal(browser: Browser, url: &str, _: &BrowserOptions) -> Result<()> {",
          "",
          "[Added Lines]",
          "15: pub fn open_browser_internal(browser: Browser, url: &str, options: &BrowserOptions) -> Result<()> {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "20:     use winapi::um::winuser::SW_SHOWNORMAL;",
          "21:     match browser {",
          "22:         Browser::Default => {",
          "23:             static OPEN: &[u16] = &['o' as u16, 'p' as u16, 'e' as u16, 'n' as u16, 0x0000];",
          "24:             let url =",
          "25:                 U16CString::from_str(url).map_err(|e| Error::new(ErrorKind::InvalidInput, e))?;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "24:             if options.dry_run {",
          "25:                 return Ok(());",
          "26:             }",
          "",
          "---------------"
        ],
        "tests/test_android.rs||tests/test_android.rs": [
          "File: tests/test_android.rs -> tests/test_android.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "9:     use std::fs;",
          "10:     use std::path::PathBuf;",
          "11:     use std::process::Command;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "12:     use webbrowser::Browser;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "74:             .expect(\"no ip address found\")",
          "75:             .into()",
          "76:     }",
          "77: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "79:     #[test]",
          "80:     fn test_existence_default() {",
          "81:         assert!(Browser::is_available(), \"should have found a browser\");",
          "82:     }",
          "84:     #[test]",
          "85:     fn test_non_existence_safari() {",
          "86:         assert!(!Browser::Safari.exists(), \"should not have found Safari\");",
          "87:     }",
          "",
          "---------------"
        ],
        "tests/test_macos.rs||tests/test_macos.rs": [
          "File: tests/test_macos.rs -> tests/test_macos.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "29:     async fn test_open_chrome() {",
          "30:         check_browser(Browser::Chrome, TEST_PLATFORM).await;",
          "31:     }",
          "32: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "33:     #[test]",
          "34:     fn test_existence_default() {",
          "35:         assert!(Browser::is_available(), \"should have found a browser\");",
          "36:     }",
          "38:     #[test]",
          "39:     fn test_existence_safari() {",
          "40:         assert!(Browser::Safari.exists(), \"should have found Safari\");",
          "41:     }",
          "43:     #[test]",
          "44:     fn test_non_existence_webpositive() {",
          "45:         assert!(",
          "46:             !Browser::WebPositive.exists(),",
          "47:             \"should not have found WebPositive\",",
          "48:         );",
          "49:     }",
          "",
          "---------------"
        ],
        "tests/test_unix.rs||tests/test_unix.rs": [
          "File: tests/test_unix.rs -> tests/test_unix.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "12:     async fn test_open_default() {",
          "13:         check_browser(Browser::Default, TEST_PLATFORM).await;",
          "14:     }",
          "15: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "16:     #[test]",
          "17:     fn test_existence_default() {",
          "18:         assert!(Browser::is_available(), \"should have found a browser\");",
          "19:     }",
          "21:     #[test]",
          "22:     fn test_non_existence_safari() {",
          "23:         assert!(!Browser::Safari.exists(), \"should not have found Safari\");",
          "24:     }",
          "",
          "---------------"
        ],
        "tests/test_wasm.rs||tests/test_wasm.rs": [
          "File: tests/test_wasm.rs -> tests/test_wasm.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "8:     use super::common::check_request_received_using;",
          "9:     use std::fs;",
          "10:     use std::path::PathBuf;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "11:     use webbrowser::Browser;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "44:         })",
          "45:         .await;",
          "46:     }",
          "47: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "49:     #[test]",
          "50:     fn test_existence_default() {",
          "51:         assert!(Browser::is_available(), \"should've found a browser\");",
          "52:     }",
          "54:     #[test]",
          "55:     fn test_non_existence_safari() {",
          "56:         assert!(!Browser::Safari.exists(), \"should've not found Safari\");",
          "57:     }",
          "",
          "---------------"
        ],
        "tests/test_windows.rs||tests/test_windows.rs": [
          "File: tests/test_windows.rs -> tests/test_windows.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "18:     async fn test_open_internet_explorer() {",
          "19:         check_browser(Browser::InternetExplorer, TEST_PLATFORM).await;",
          "20:     }",
          "21: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "22:     #[test]",
          "23:     fn test_existence_default() {",
          "24:         assert!(Browser::is_available(), \"should have found a browser\");",
          "25:     }",
          "27:     #[test]",
          "28:     fn test_non_existence_safari() {",
          "29:         assert!(!Browser::Safari.exists(), \"should not have found Safari\");",
          "30:     }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "30486a96ae3fab5bcd31e75c48b15440efaec9c1",
      "candidate_info": {
        "commit_hash": "30486a96ae3fab5bcd31e75c48b15440efaec9c1",
        "repo": "amodm/webbrowser-rs",
        "commit_url": "https://github.com/amodm/webbrowser-rs/commit/30486a96ae3fab5bcd31e75c48b15440efaec9c1",
        "files": [
          "src/lib.rs"
        ],
        "message": "better implementation for is_http",
        "before_after_code_files": [
          "src/lib.rs||src/lib.rs"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/lib.rs||src/lib.rs"
          ],
          "candidate": [
            "src/lib.rs||src/lib.rs"
          ]
        }
      },
      "candidate_diff": {
        "src/lib.rs||src/lib.rs": [
          "File: src/lib.rs -> src/lib.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "323:         target_family = \"wasm\"",
          "324:     ))]",
          "325:     fn is_http(&self) -> bool {",
          "330:     }",
          "",
          "[Removed Lines]",
          "326:         match self.0.scheme() {",
          "327:             \"http\" | \"https\" => true,",
          "328:             _ => false,",
          "329:         }",
          "",
          "[Added Lines]",
          "326:         matches!(self.0.scheme(), \"http\" | \"https\")",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "05cec736f89235c2e8085cac4f54107f57b1cf1a",
      "candidate_info": {
        "commit_hash": "05cec736f89235c2e8085cac4f54107f57b1cf1a",
        "repo": "amodm/webbrowser-rs",
        "commit_url": "https://github.com/amodm/webbrowser-rs/commit/05cec736f89235c2e8085cac4f54107f57b1cf1a",
        "files": [
          "Cargo.toml",
          "src/common.rs",
          "src/lib.rs",
          "src/macos.rs"
        ],
        "message": "move macos implementation to use CoreFoundation instead of open #build-macos",
        "before_after_code_files": [
          "src/common.rs||src/common.rs",
          "src/lib.rs||src/lib.rs",
          "src/macos.rs||src/macos.rs"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/lib.rs||src/lib.rs",
            "src/macos.rs||src/macos.rs"
          ],
          "candidate": [
            "src/lib.rs||src/lib.rs",
            "src/macos.rs||src/macos.rs"
          ]
        }
      },
      "candidate_diff": {
        "src/common.rs||src/common.rs": [
          "File: src/common.rs -> src/common.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/lib.rs||src/lib.rs": [
          "File: src/lib.rs -> src/lib.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "280:     url: &str,",
          "281:     options: &BrowserOptions,",
          "282: ) -> Result<()> {",
          "287:     os::open_browser_internal(browser, &target, options)",
          "288: }",
          "",
          "[Removed Lines]",
          "283:     let target = match url::Url::parse(url) {",
          "284:         Ok(u) => TargetType::Url(u),",
          "285:         Err(_) => TargetType::Path(url.into()),",
          "286:     };",
          "",
          "[Added Lines]",
          "283:     let target = TargetType::from(url);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "328:     }",
          "329: }",
          "331: #[test]",
          "332: #[ignore]",
          "333: fn test_open_firefox() {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "328: impl From<&str> for TargetType {",
          "329:     fn from(target: &str) -> Self {",
          "330:         match url::Url::parse(target) {",
          "331:             Ok(u) => TargetType::Url(u),",
          "332:             Err(_) => TargetType::Path(target.into()),",
          "333:         }",
          "334:     }",
          "335: }",
          "",
          "---------------"
        ],
        "src/macos.rs||src/macos.rs": [
          "File: src/macos.rs -> src/macos.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: use crate::{Browser, BrowserOptions, Error, ErrorKind, Result, TargetType};",
          "8: pub(super) fn open_browser_internal(",
          "9:     browser: Browser,",
          "10:     target: &TargetType,",
          "11:     options: &BrowserOptions,",
          "12: ) -> Result<()> {",
          "16:         Browser::Default => {",
          "20:             }",
          "23:         }",
          "24:         _ => {",
          "55:             }",
          "56:         }",
          "57:     }",
          "58: }",
          "65:     }",
          "69:     }",
          "72: }",
          "",
          "[Removed Lines]",
          "2: use std::process::{Command, Stdio};",
          "4: mod common;",
          "5: use common::from_status;",
          "13:     let url = target.as_ref();",
          "14:     let mut cmd = Command::new(\"open\");",
          "15:     match browser {",
          "18:             if options.dry_run {",
          "19:                 return Ok(());",
          "22:             run_command(cmd.arg(url), options)",
          "25:             let app: Option<&str> = match browser {",
          "26:                 Browser::Firefox => Some(\"Firefox\"),",
          "27:                 Browser::Chrome => Some(\"Google Chrome\"),",
          "28:                 Browser::Opera => Some(\"Opera\"),",
          "29:                 Browser::Safari => Some(\"Safari\"),",
          "30:                 Browser::WebPositive => Some(\"WebPositive\"),",
          "31:                 _ => None,",
          "32:             };",
          "33:             match app {",
          "34:                 Some(name) => {",
          "35:                     if options.dry_run {",
          "37:                         let md = std::fs::metadata(format!(\"/Applications/{}.app\", name));",
          "38:                         if md.map(|x| x.is_dir()).unwrap_or(false) {",
          "39:                             Ok(())",
          "40:                         } else {",
          "41:                             Err(Error::new(",
          "42:                                 ErrorKind::NotFound,",
          "43:                                 format!(\"Browser {} not available\", name),",
          "44:                             ))",
          "45:                         }",
          "46:                     } else {",
          "48:                         run_command(cmd.arg(\"-a\").arg(name).arg(url), options)",
          "49:                     }",
          "50:                 }",
          "51:                 None => Err(Error::new(",
          "52:                     ErrorKind::NotFound,",
          "53:                     format!(\"Unsupported browser {:?}\", browser),",
          "54:                 )),",
          "60: fn run_command(cmd: &mut Command, options: &BrowserOptions) -> Result<()> {",
          "61:     if options.suppress_output && option_env!(\"WEBBROWSER_FORCE_NO_SUPPRESS\").is_none() {",
          "62:         cmd.stdout(Stdio::null())",
          "63:             .stdin(Stdio::null())",
          "64:             .stderr(Stdio::null());",
          "67:     if option_env!(\"WEBBROWSER_DEBUG_TESTS\").is_some() {",
          "68:         println!(\"[debug-macos-tests] about to run command: {:?}\", cmd);",
          "71:     from_status(cmd.status())",
          "",
          "[Added Lines]",
          "2: use core_foundation::array::{CFArray, CFArrayRef};",
          "3: use core_foundation::base::TCFType;",
          "4: use core_foundation::error::{CFError, CFErrorRef};",
          "5: use core_foundation::url::{CFURLRef, CFURL};",
          "6: use std::os::raw::c_void;",
          "15:     let browser_cf_url = match browser {",
          "16:         Browser::Firefox => create_cf_url(\"file:///Applications/Firefox.app/\"),",
          "17:         Browser::Chrome => create_cf_url(\"file:///Applications/Google Chrome.app/\"),",
          "18:         Browser::Opera => create_cf_url(\"file:///Applications/Opera.app/\"),",
          "19:         Browser::Safari => create_cf_url(\"file:///Applications/Safari.app/\"),",
          "21:             if let Some(dummy_url) = create_cf_url(\"https://\") {",
          "22:                 let mut err: CFErrorRef = std::ptr::null_mut();",
          "23:                 let result = unsafe {",
          "24:                     LSCopyDefaultApplicationURLForURL(",
          "25:                         dummy_url.as_concrete_TypeRef(),",
          "26:                         LSROLE_VIEWER,",
          "27:                         &mut err,",
          "28:                     )",
          "29:                 };",
          "30:                 if result.is_null() {",
          "31:                     log::error!(\"failed to get default browser: {}\", unsafe {",
          "32:                         CFError::wrap_under_create_rule(err)",
          "33:                     });",
          "34:                     create_cf_url(DEFAULT_BROWSER_URL)",
          "35:                 } else {",
          "36:                     let cf_url = unsafe { CFURL::wrap_under_create_rule(result) };",
          "37:                     log::trace!(\"default browser is {:?}\", &cf_url);",
          "38:                     Some(cf_url)",
          "39:                 }",
          "40:             } else {",
          "41:                 create_cf_url(DEFAULT_BROWSER_URL)",
          "45:             return Err(Error::new(",
          "46:                 ErrorKind::NotFound,",
          "47:                 \"browser not supported on macos\",",
          "48:             ))",
          "49:         }",
          "50:     }",
          "51:     .ok_or_else(|| Error::new(ErrorKind::Other, \"failed to create CFURL\"))?;",
          "53:     let cf_url = create_cf_url(target.as_ref())",
          "54:         .ok_or_else(|| Error::new(ErrorKind::Other, \"failed to create CFURL\"))?;",
          "56:     let urls_v = [cf_url];",
          "57:     let urls_arr = CFArray::<CFURL>::from_CFTypes(&urls_v);",
          "58:     let spec = LSLaunchURLSpec {",
          "59:         app_url: browser_cf_url.as_concrete_TypeRef(),",
          "60:         item_urls: urls_arr.as_concrete_TypeRef(),",
          "61:         pass_thru_params: std::ptr::null(),",
          "62:         launch_flags: LS_LAUNCH_FLAG_DEFAULTS | LS_LAUNCH_FLAG_ASYNC,",
          "63:         async_ref_con: std::ptr::null(),",
          "64:     };",
          "67:     if options.dry_run {",
          "68:         return if let Some(path) = browser_cf_url.to_path() {",
          "69:             if path.is_dir() {",
          "70:                 log::debug!(\"dry-run: not actually opening the browser {}\", &browser);",
          "71:                 Ok(())",
          "72:             } else {",
          "73:                 log::debug!(\"dry-run: browser {} not found\", &browser);",
          "74:                 Err(Error::new(ErrorKind::NotFound, \"browser not found\"))",
          "76:         } else {",
          "77:             Err(Error::new(",
          "78:                 ErrorKind::Other,",
          "79:                 \"unable to convert app url to path\",",
          "80:             ))",
          "81:         };",
          "82:     }",
          "85:     log::trace!(",
          "86:         \"about to start browser: {} for {}\",",
          "87:         &browser,",
          "88:         target.as_ref()",
          "89:     );",
          "90:     let mut launched_app: CFURLRef = std::ptr::null_mut();",
          "91:     let status = unsafe { LSOpenFromURLSpec(&spec, &mut launched_app) };",
          "92:     log::trace!(\"received status: {}\", status);",
          "93:     if status == 0 {",
          "94:         Ok(())",
          "95:     } else {",
          "96:         Err(Error::from(LSError::from(status)))",
          "97:     }",
          "98: }",
          "101: fn create_cf_url(url: &str) -> Option<CFURL> {",
          "102:     let url_u8 = url.as_bytes();",
          "103:     let url_ref = unsafe {",
          "104:         core_foundation::url::CFURLCreateWithBytes(",
          "105:             std::ptr::null(),",
          "106:             url_u8.as_ptr(),",
          "107:             url_u8.len() as isize,",
          "108:             core_foundation::string::kCFStringEncodingUTF8,",
          "109:             std::ptr::null(),",
          "110:         )",
          "111:     };",
          "113:     if url_ref.is_null() {",
          "114:         None",
          "115:     } else {",
          "116:         Some(unsafe { CFURL::wrap_under_create_rule(url_ref) })",
          "117:     }",
          "118: }",
          "120: type OSStatus = i32;",
          "124: enum LSError {",
          "125:     Unknown(OSStatus),",
          "126:     ApplicationNotFound,",
          "127:     NoLaunchPermission,",
          "128: }",
          "130: impl From<OSStatus> for LSError {",
          "131:     fn from(status: OSStatus) -> Self {",
          "132:         match status {",
          "134:             -43 | -10814 => Self::ApplicationNotFound,",
          "135:             -10826 => Self::NoLaunchPermission,",
          "136:             _ => Self::Unknown(status),",
          "141: impl std::fmt::Display for LSError {",
          "142:     fn fmt(&self, f: &mut std::fmt::Formatter<'_>) -> std::fmt::Result {",
          "143:         match self {",
          "144:             Self::Unknown(code) => write!(f, \"ls_error: code {}\", code),",
          "145:             Self::ApplicationNotFound => f.write_str(\"ls_error: application not found\"),",
          "146:             Self::NoLaunchPermission => f.write_str(\"ls_error: no launch permission\"),",
          "147:         }",
          "148:     }",
          "149: }",
          "151: impl std::fmt::Debug for LSError {",
          "152:     fn fmt(&self, f: &mut std::fmt::Formatter<'_>) -> std::fmt::Result {",
          "153:         std::fmt::Display::fmt(self, f)",
          "154:     }",
          "155: }",
          "157: impl From<LSError> for Error {",
          "158:     fn from(err: LSError) -> Self {",
          "159:         let kind = match err {",
          "160:             LSError::Unknown(_) => ErrorKind::Other,",
          "161:             LSError::ApplicationNotFound => ErrorKind::NotFound,",
          "162:             LSError::NoLaunchPermission => ErrorKind::PermissionDenied,",
          "163:         };",
          "164:         Error::new(kind, err.to_string())",
          "166: }",
          "168: type LSRolesMask = u32;",
          "171: const LSROLE_VIEWER: LSRolesMask = 0x00000002;",
          "174: const LS_LAUNCH_FLAG_DEFAULTS: u32 = 0x00000001;",
          "175: const LS_LAUNCH_FLAG_ASYNC: u32 = 0x00010000;",
          "177: #[repr(C)]",
          "178: struct LSLaunchURLSpec {",
          "179:     app_url: CFURLRef,",
          "180:     item_urls: CFArrayRef,",
          "181:     pass_thru_params: *const c_void,",
          "182:     launch_flags: u32,",
          "183:     async_ref_con: *const c_void,",
          "184: }",
          "187: #[link(name = \"CoreServices\", kind = \"framework\")]",
          "188: extern \"C\" {",
          "191:     fn LSCopyDefaultApplicationURLForURL(",
          "192:         inURL: CFURLRef,",
          "193:         inRoleMask: LSRolesMask,",
          "194:         outError: *mut CFErrorRef,",
          "195:     ) -> CFURLRef;",
          "199:     fn LSOpenFromURLSpec(",
          "200:         inLaunchSpec: *const LSLaunchURLSpec,",
          "201:         outLaunchedURL: *mut CFURLRef,",
          "202:     ) -> OSStatus;",
          "203: }",
          "206: const DEFAULT_BROWSER_URL: &str = \"file:///Applications/Safari.app/\";",
          "208: #[cfg(test)]",
          "209: mod tests {",
          "210:     use super::*;",
          "212:     #[test]",
          "213:     fn open_non_existing_browser() {",
          "214:         let _ = env_logger::try_init();",
          "215:         if let Err(err) = open_browser_internal(",
          "216:             Browser::Opera,",
          "217:             &TargetType::from(\"https://github.com\"),",
          "218:             &BrowserOptions::default(),",
          "219:         ) {",
          "220:             assert_eq!(err.kind(), ErrorKind::NotFound);",
          "221:         } else {",
          "222:             panic!(\"expected opening non-existing browser to fail\");",
          "223:         }",
          "226:     #[test]",
          "227:     fn test_existence() {",
          "228:         let _ = env_logger::try_init();",
          "229:         assert!(Browser::Safari.exists());",
          "230:         assert!(!Browser::Opera.exists());",
          "231:     }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "809ca269d46b54cb101387e0b69e3cb387d4e6a6",
      "candidate_info": {
        "commit_hash": "809ca269d46b54cb101387e0b69e3cb387d4e6a6",
        "repo": "amodm/webbrowser-rs",
        "commit_url": "https://github.com/amodm/webbrowser-rs/commit/809ca269d46b54cb101387e0b69e3cb387d4e6a6",
        "files": [
          "src/android.rs",
          "src/common.rs",
          "src/lib.rs",
          "src/macos.rs",
          "src/unix.rs",
          "src/wasm.rs",
          "src/windows.rs"
        ],
        "message": "Breaking change: modify publicly exposed signature to bring consistency. Fixes #42",
        "before_after_code_files": [
          "src/android.rs||src/android.rs",
          "src/common.rs||src/common.rs",
          "src/lib.rs||src/lib.rs",
          "src/macos.rs||src/macos.rs",
          "src/unix.rs||src/unix.rs",
          "src/wasm.rs||src/wasm.rs",
          "src/windows.rs||src/windows.rs"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/lib.rs||src/lib.rs",
            "src/macos.rs||src/macos.rs",
            "src/unix.rs||src/unix.rs",
            "src/windows.rs||src/windows.rs"
          ],
          "candidate": [
            "src/lib.rs||src/lib.rs",
            "src/macos.rs||src/macos.rs",
            "src/unix.rs||src/unix.rs",
            "src/windows.rs||src/windows.rs"
          ]
        }
      },
      "candidate_diff": {
        "src/android.rs||src/android.rs": [
          "File: src/android.rs -> src/android.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "7: #[inline]",
          "10:     let native_activity = ndk_glue::native_activity();",
          "11:     let vm_ptr = native_activity.vm();",
          "",
          "[Removed Lines]",
          "8: pub fn open_browser_internal(_: Browser, url: &str) -> Result<ExitStatus> {",
          "",
          "[Added Lines]",
          "8: pub fn open_browser_internal(_: Browser, url: &str) -> Result<()> {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "61:     )",
          "62:     .map_err(|_| -> Error { Error::new(ErrorKind::Other, \"Failed to start activity\") })?;",
          "65: }",
          "",
          "[Removed Lines]",
          "64:     Ok(ExitStatus::from_raw(0))",
          "",
          "[Added Lines]",
          "64:     Ok(())",
          "",
          "---------------"
        ],
        "src/common.rs||src/common.rs": [
          "File: src/common.rs -> src/common.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: use crate::{Error, ErrorKind, Result};",
          "2: use std::process::ExitStatus;",
          "6: pub fn from_status(res: Result<ExitStatus>) -> Result<()> {",
          "7:     match res {",
          "8:         Ok(status) => {",
          "9:             if let Some(code) = status.code() {",
          "10:                 if code == 0 {",
          "11:                     Ok(())",
          "12:                 } else {",
          "13:                     Err(Error::new(",
          "14:                         ErrorKind::Other,",
          "15:                         format!(\"return code {}\", code),",
          "16:                     ))",
          "17:                 }",
          "18:             } else {",
          "19:                 Err(Error::new(ErrorKind::Other, \"interrupted by signal\"))",
          "20:             }",
          "21:         }",
          "22:         Err(err) => Err(err),",
          "23:     }",
          "24: }",
          "",
          "---------------"
        ],
        "src/lib.rs||src/lib.rs": [
          "File: src/lib.rs -> src/lib.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "53:     target_os = \"linux\",",
          "54:     target_os = \"freebsd\",",
          "55:     target_os = \"netbsd\",",
          "56:     target_os = \"openbsd\",",
          "61: use std::default::Default;",
          "62: use std::io::{Error, ErrorKind, Result};",
          "64: use std::str::FromStr;",
          "65: use std::{error, fmt};",
          "70: #[derive(Debug, Eq, PartialEq, Copy, Clone, Hash)]",
          "72: pub enum Browser {",
          "",
          "[Removed Lines]",
          "29: #[cfg(windows)]",
          "30: mod windows;",
          "31: #[cfg(windows)]",
          "32: use windows::*;",
          "34: #[cfg(target_os = \"android\")]",
          "35: mod android;",
          "36: #[cfg(target_os = \"android\")]",
          "37: use android::*;",
          "39: #[cfg(target_os = \"macos\")]",
          "40: mod macos;",
          "41: #[cfg(target_os = \"macos\")]",
          "42: use macos::*;",
          "44: #[cfg(any(",
          "45:     target_os = \"linux\",",
          "46:     target_os = \"freebsd\",",
          "47:     target_os = \"netbsd\",",
          "48:     target_os = \"openbsd\",",
          "49:     target_os = \"haiku\"",
          "50: ))]",
          "51: mod unix;",
          "52: #[cfg(any(",
          "57:     target_os = \"haiku\"",
          "58: ))]",
          "59: use unix::*;",
          "63: use std::process::{ExitStatus, Output};",
          "67: #[cfg(target_arch = \"wasm32\")]",
          "68: use web_sys::Window;",
          "",
          "[Added Lines]",
          "29: #[cfg_attr(target_os = \"macos\", path = \"macos.rs\")]",
          "30: #[cfg_attr(target_os = \"android\", path = \"android.rs\")]",
          "31: #[cfg_attr(target_arch = \"wasm32\", path = \"wasm.rs\")]",
          "32: #[cfg_attr(windows, path = \"windows.rs\")]",
          "33: #[cfg_attr(",
          "34:     any(",
          "35:         target_os = \"linux\",",
          "36:         target_os = \"freebsd\",",
          "37:         target_os = \"netbsd\",",
          "38:         target_os = \"openbsd\",",
          "39:         target_os = \"haiku\"",
          "40:     ),",
          "41:     path = \"unix.rs\"",
          "42: )]",
          "43: mod os;",
          "45: #[cfg(not(any(",
          "46:     target_os = \"android\",",
          "47:     target_os = \"windows\",",
          "48:     target_os = \"macos\",",
          "53:     target_os = \"haiku\",",
          "54:     target_arch = \"wasm32\"",
          "55: )))]",
          "56: compile_error!(\"Only Windows, Mac OS, Linux, *BSD and Haiku and Wasm32 are currently supported\");",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "174: pub fn open(url: &str) -> Result<()> {",
          "186: }",
          "",
          "[Removed Lines]",
          "168: #[cfg(not(target_arch = \"wasm32\"))]",
          "169: pub fn open(url: &str) -> Result<Output> {",
          "170:     open_browser(Browser::Default, url)",
          "171: }",
          "173: #[cfg(target_arch = \"wasm32\")]",
          "175:     let window = web_sys::window();",
          "176:     match window {",
          "177:         Some(w) => {",
          "178:             w.open_with_url(url);",
          "179:             Ok(())",
          "180:         }",
          "181:         None => Err(std::io::Error::new(",
          "182:             ErrorKind::Other,",
          "183:             \"should have a window in this context\",",
          "184:         )),",
          "185:     }",
          "",
          "[Added Lines]",
          "162:     open_browser(Browser::Default, url)",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "219: }",
          "234: #[test]",
          "235: #[ignore]",
          "236: fn test_open_firefox() {",
          "",
          "[Removed Lines]",
          "199: #[cfg(not(target_arch = \"wasm32\"))]",
          "200: pub fn open_browser(browser: Browser, url: &str) -> Result<Output> {",
          "201:     open_browser_internal(browser, url).and_then(|status| {",
          "202:         if let Some(code) = status.code() {",
          "203:             if code == 0 {",
          "204:                 Ok(Output {",
          "205:                     status: ExitStatus::from_raw(0),",
          "206:                     stdout: vec![],",
          "207:                     stderr: vec![],",
          "208:                 })",
          "209:             } else {",
          "210:                 Err(Error::new(",
          "211:                     ErrorKind::Other,",
          "212:                     format!(\"return code {}\", code),",
          "213:                 ))",
          "214:             }",
          "215:         } else {",
          "216:             Err(Error::new(ErrorKind::Other, \"interrupted by signal\"))",
          "217:         }",
          "218:     })",
          "221: #[cfg(not(any(",
          "222:     target_os = \"android\",",
          "223:     target_os = \"windows\",",
          "224:     target_os = \"macos\",",
          "225:     target_os = \"linux\",",
          "226:     target_os = \"freebsd\",",
          "227:     target_os = \"netbsd\",",
          "228:     target_os = \"openbsd\",",
          "229:     target_os = \"haiku\",",
          "230:     target_arch = \"wasm32\"",
          "231: )))]",
          "232: compile_error!(\"Only Windows, Mac OS, Linux, *BSD and Haiku and Wasm32 are currently supported\");",
          "",
          "[Added Lines]",
          "176: pub fn open_browser(browser: Browser, url: &str) -> Result<()> {",
          "177:     os::open_browser_internal(browser, url)",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "243:     assert!(open_browser(Browser::Chrome, \"http://github.com\").is_ok());",
          "244: }",
          "252: #[test]",
          "253: #[ignore]",
          "254: fn test_open_safari() {",
          "",
          "[Removed Lines]",
          "246: #[test]",
          "247: #[cfg(target_arch = \"wasm32\")]",
          "248: fn test_open_default_wasm() {",
          "249:     assert!(open(\"http://github.com\").is_ok());",
          "250: }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/macos.rs||src/macos.rs": [
          "File: src/macos.rs -> src/macos.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: use crate::{Browser, Error, ErrorKind, Result};",
          "6: #[inline]",
          "8:     let mut cmd = Command::new(\"open\");",
          "9:     match browser {",
          "11:         _ => {",
          "12:             let app: Option<&str> = match browser {",
          "13:                 Browser::Firefox => Some(\"Firefox\"),",
          "",
          "[Removed Lines]",
          "2: pub use std::os::unix::process::ExitStatusExt;",
          "3: use std::process::{Command, ExitStatus};",
          "7: pub fn open_browser_internal(browser: Browser, url: &str) -> Result<ExitStatus> {",
          "10:         Browser::Default => cmd.arg(url).status(),",
          "",
          "[Added Lines]",
          "2: use std::process::Command;",
          "4: mod common;",
          "5: use common::from_status;",
          "9: pub fn open_browser_internal(browser: Browser, url: &str) -> Result<()> {",
          "12:         Browser::Default => from_status(cmd.arg(url).status()),",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "18:                 _ => None,",
          "19:             };",
          "20:             match app {",
          "22:                 None => Err(Error::new(",
          "23:                     ErrorKind::NotFound,",
          "24:                     format!(\"Unsupported browser {:?}\", browser),",
          "",
          "[Removed Lines]",
          "21:                 Some(name) => cmd.arg(\"-a\").arg(name).arg(url).status(),",
          "",
          "[Added Lines]",
          "23:                 Some(name) => from_status(cmd.arg(\"-a\").arg(name).arg(url).status()),",
          "",
          "---------------"
        ],
        "src/unix.rs||src/unix.rs": [
          "File: src/unix.rs -> src/unix.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: use crate::{Browser, Error, ErrorKind, Result};",
          "3: use std::process::{Command, ExitStatus};",
          "",
          "[Removed Lines]",
          "2: pub use std::os::unix::process::ExitStatusExt;",
          "",
          "[Added Lines]",
          "2: use std::os::unix::process::ExitStatusExt;",
          "5: mod common;",
          "6: use common::from_status;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "11: #[inline]",
          "13:     match browser {",
          "14:         Browser::Default => open_on_unix_using_browser_env(url)",
          "15:             .or_else(|_| -> Result<ExitStatus> { Command::new(\"xdg-open\").arg(url).status() })",
          "",
          "[Removed Lines]",
          "12: pub fn open_browser_internal(browser: Browser, url: &str) -> Result<ExitStatus> {",
          "",
          "[Added Lines]",
          "15: pub fn open_browser_internal(browser: Browser, url: &str) -> Result<()> {",
          "16:     from_status(open_browser_unix(browser, url))",
          "17: }",
          "19: fn open_browser_unix(browser: Browser, url: &str) -> Result<ExitStatus> {",
          "",
          "---------------"
        ],
        "src/wasm.rs||src/wasm.rs": [
          "File: src/wasm.rs -> src/wasm.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: use crate::{Browser, ErrorKind, Result};",
          "5: #[inline]",
          "6: pub fn open_browser_internal(_: Browser, url: &str) -> Result<()> {",
          "8:     let configured_target = option_env!(\"WEBBROWSER_WASM_TARGET\");",
          "9:     let window = web_sys::window();",
          "10:     match window {",
          "11:         Some(w) => {",
          "12:             let target = configured_target.unwrap_or_else(|| \"_blank\");",
          "13:             wasm_console_log(&format!(\"target for url {} detected as {}\", url, target));",
          "15:             match w.open_with_url_and_target(url, target) {",
          "16:                 Ok(x) => match x {",
          "17:                     Some(y) => Ok(()),",
          "18:                     None => {",
          "19:                         const err_msg: &'static str =",
          "20:                             \"popup blocked? window detected, but open_url failed\";",
          "21:                         wasm_console_log(&err_msg);",
          "22:                         Err(std::io::Error::new(ErrorKind::Other, err_msg))",
          "23:                     }",
          "24:                 },",
          "25:                 Err(_) => {",
          "26:                     wasm_console_log(\"window error while opening url\");",
          "27:                     Err(std::io::Error::new(ErrorKind::Other, \"error opening url\"))",
          "28:                 }",
          "29:             }",
          "30:         }",
          "31:         None => Err(std::io::Error::new(",
          "32:             ErrorKind::Other,",
          "33:             \"should have a window in this context\",",
          "34:         )),",
          "35:     }",
          "36: }",
          "39: fn wasm_console_log(msg: &str) {",
          "40:     #[cfg(debug_assertions)]",
          "41:     web_sys::console::log_1(&format!(\"[webbrowser] {}\", &msg).into());",
          "42: }",
          "",
          "---------------"
        ],
        "src/windows.rs||src/windows.rs": [
          "File: src/windows.rs -> src/windows.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "4: use crate::{Browser, Error, ErrorKind, Result};",
          "5: pub use std::os::windows::process::ExitStatusExt;",
          "7: use std::ptr;",
          "8: use widestring::U16CString;",
          "",
          "[Removed Lines]",
          "6: use std::process::ExitStatus;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "13: #[inline]",
          "15:     use winapi::shared::winerror::SUCCEEDED;",
          "16:     use winapi::um::combaseapi::{CoInitializeEx, CoUninitialize};",
          "17:     use winapi::um::objbase::{COINIT_APARTMENTTHREADED, COINIT_DISABLE_OLE1DDE};",
          "",
          "[Removed Lines]",
          "14: pub fn open_browser_internal(browser: Browser, url: &str) -> Result<ExitStatus> {",
          "",
          "[Added Lines]",
          "13: pub fn open_browser_internal(browser: Browser, url: &str) -> Result<()> {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "41:                 code",
          "42:             };",
          "43:             if code > 32 {",
          "45:             } else {",
          "46:                 Err(Error::last_os_error())",
          "47:             }",
          "",
          "[Removed Lines]",
          "44:                 Ok(ExitStatus::from_raw(0))",
          "",
          "[Added Lines]",
          "43:                 Ok(())",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "a800e535b7cfdc33b597f4507a91166ecaf92952",
      "candidate_info": {
        "commit_hash": "a800e535b7cfdc33b597f4507a91166ecaf92952",
        "repo": "amodm/webbrowser-rs",
        "commit_url": "https://github.com/amodm/webbrowser-rs/commit/a800e535b7cfdc33b597f4507a91166ecaf92952",
        "files": [
          ".github/workflows/macos.yaml",
          "src/macos.rs"
        ],
        "message": "conditional compilation for debugging macos tests",
        "before_after_code_files": [
          "src/macos.rs||src/macos.rs"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/macos.rs||src/macos.rs"
          ],
          "candidate": [
            "src/macos.rs||src/macos.rs"
          ]
        }
      },
      "candidate_diff": {
        "src/macos.rs||src/macos.rs": [
          "File: src/macos.rs -> src/macos.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "40: }",
          "42: fn run_command(cmd: &mut Command, options: &BrowserOptions) -> Result<()> {",
          "44:         cmd.stdout(Stdio::null())",
          "45:             .stdin(Stdio::null())",
          "46:             .stderr(Stdio::null());",
          "47:     }",
          "48:     from_status(cmd.status())",
          "49: }",
          "",
          "[Removed Lines]",
          "43:     if options.suppress_output {",
          "",
          "[Added Lines]",
          "43:     if options.suppress_output && !option_env!(\"WEBBROWSER_FORCE_NO_SUPPRESS\").is_some() {",
          "49:     if option_env!(\"WEBBROWSER_DEBUG_TESTS\").is_some() {",
          "50:         println!(\"[debug-macos-tests] about to run command: {:?}\", cmd);",
          "51:     }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "11789ddfe36264bbbe7d596ab61e3fff855c3adb",
      "candidate_info": {
        "commit_hash": "11789ddfe36264bbbe7d596ab61e3fff855c3adb",
        "repo": "amodm/webbrowser-rs",
        "commit_url": "https://github.com/amodm/webbrowser-rs/commit/11789ddfe36264bbbe7d596ab61e3fff855c3adb",
        "files": [
          "Cargo.toml",
          "README.md",
          "src/lib.rs",
          "src/macos.rs",
          "tests/common.rs",
          "tests/test_macos.rs"
        ],
        "message": "fix handling of unicode characters in URL",
        "before_after_code_files": [
          "src/lib.rs||src/lib.rs",
          "src/macos.rs||src/macos.rs",
          "tests/common.rs||tests/common.rs",
          "tests/test_macos.rs||tests/test_macos.rs"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/lib.rs||src/lib.rs",
            "src/macos.rs||src/macos.rs"
          ],
          "candidate": [
            "src/lib.rs||src/lib.rs",
            "src/macos.rs||src/macos.rs"
          ]
        }
      },
      "candidate_diff": {
        "src/lib.rs||src/lib.rs": [
          "File: src/lib.rs -> src/lib.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "179: pub fn open_browser(browser: Browser, url: &str) -> Result<()> {",
          "181: }",
          "183: #[test]",
          "",
          "[Removed Lines]",
          "180:     os::open_browser_internal(browser, url)",
          "",
          "[Added Lines]",
          "180:     let url_s: String = match url::Url::parse(url) {",
          "181:         Ok(u) => u.as_str().into(),",
          "182:         Err(_) => url.into(),",
          "183:     };",
          "184:     os::open_browser_internal(browser, &url_s)",
          "",
          "---------------"
        ],
        "src/macos.rs||src/macos.rs": [
          "File: src/macos.rs -> src/macos.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "8: #[inline]",
          "10:     let mut cmd = Command::new(\"open\");",
          "11:     match browser {",
          "12:         Browser::Default => from_status(cmd.arg(url).status()),",
          "",
          "[Removed Lines]",
          "9: pub fn open_browser_internal(browser: Browser, url: &str) -> Result<()> {",
          "",
          "[Added Lines]",
          "9: pub fn open_browser_internal(browser: Browser, url_raw: &str) -> Result<()> {",
          "10:     let url_s: String = match url::Url::parse(url_raw) {",
          "11:         Ok(u) => u.as_str().into(),",
          "12:         Err(_) => url_raw.into(),",
          "13:     };",
          "14:     let url = &url_s;",
          "",
          "---------------"
        ],
        "tests/common.rs||tests/common.rs": [
          "File: tests/common.rs -> tests/common.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "70: #[allow(dead_code)]",
          "71: pub async fn check_browser(browser: Browser, platform: &str) {",
          "72:     check_request_received(browser, format!(\"/{}\", platform)).await;",
          "74: }",
          "",
          "[Removed Lines]",
          "73:     check_request_received(browser, format!(\"/{}/\uff4e\uff4f\uff4e\uff41\uff53\uff43\uff49\uff49\", platform)).await;",
          "",
          "[Added Lines]",
          "73:     check_request_received(browser, format!(\"/{}/\ud83d\ude00\ud83d\ude00\ud83d\ude00\", platform)).await;",
          "",
          "---------------"
        ],
        "tests/test_macos.rs||tests/test_macos.rs": [
          "File: tests/test_macos.rs -> tests/test_macos.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: mod tests {",
          "6:     const TEST_PLATFORM: &str = \"macos\";",
          "9:     use webbrowser::Browser;",
          "11:     #[actix_rt::test]",
          "12:     async fn test_open_default() {",
          "16:     }",
          "18:     #[actix_rt::test]",
          "19:     async fn test_open_safari() {",
          "23:     }",
          "25:     #[actix_rt::test]",
          "",
          "[Removed Lines]",
          "8:     use super::common::{check_browser, check_request_received};",
          "15:         check_request_received(Browser::Default, format!(\"/{}\", TEST_PLATFORM)).await;",
          "22:         check_request_received(Browser::Safari, format!(\"/{}\", TEST_PLATFORM)).await;",
          "",
          "[Added Lines]",
          "8:     use super::common::check_browser;",
          "13:         check_browser(Browser::Default, TEST_PLATFORM).await;",
          "18:         check_browser(Browser::Safari, TEST_PLATFORM).await;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "bb23f75ce0c903ea824b3b1af57d209aa65fffcf",
      "candidate_info": {
        "commit_hash": "bb23f75ce0c903ea824b3b1af57d209aa65fffcf",
        "repo": "amodm/webbrowser-rs",
        "commit_url": "https://github.com/amodm/webbrowser-rs/commit/bb23f75ce0c903ea824b3b1af57d209aa65fffcf",
        "files": [
          ".github/workflows/linux.yaml",
          "src/windows.rs"
        ],
        "message": "fix linux and windows builds #build-linux #build-windows",
        "before_after_code_files": [
          "src/windows.rs||src/windows.rs"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/windows.rs||src/windows.rs"
          ],
          "candidate": [
            "src/windows.rs||src/windows.rs"
          ]
        }
      },
      "candidate_diff": {
        "src/windows.rs||src/windows.rs": [
          "File: src/windows.rs -> src/windows.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "33:             static OPEN: &[u16] = &['o' as u16, 'p' as u16, 'e' as u16, 'n' as u16, 0x0000];",
          "34:             static HTTP: &[u16] = &['h' as u16, 't' as u16, 't' as u16, 'p' as u16, 0x0000];",
          "36:                 .map_err(|e| Error::new(ErrorKind::InvalidInput, e))?;",
          "37:             let code = unsafe {",
          "38:                 let coinitializeex_result = CoInitializeEx(",
          "",
          "[Removed Lines]",
          "35:             let url = U16CString::from_str(&target)",
          "",
          "[Added Lines]",
          "35:             let url = U16CString::from_str(&**target)",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "614cacf4a67ae0a75323768a1d70c16d792a760d",
      "candidate_info": {
        "commit_hash": "614cacf4a67ae0a75323768a1d70c16d792a760d",
        "repo": "amodm/webbrowser-rs",
        "commit_url": "https://github.com/amodm/webbrowser-rs/commit/614cacf4a67ae0a75323768a1d70c16d792a760d",
        "files": [
          "src/unix.rs"
        ],
        "message": "Bring consistent behaviour on Unix. Non-terminal browsers are guaranteed to not block the thread",
        "before_after_code_files": [
          "src/unix.rs||src/unix.rs"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/unix.rs||src/unix.rs"
          ],
          "candidate": [
            "src/unix.rs||src/unix.rs"
          ]
        }
      },
      "candidate_diff": {
        "src/unix.rs||src/unix.rs": [
          "File: src/unix.rs -> src/unix.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: use crate::{Browser, Error, ErrorKind, Result};",
          "",
          "[Removed Lines]",
          "2: use std::os::unix::process::ExitStatusExt;",
          "3: use std::process::{Command, ExitStatus};",
          "5: mod common;",
          "6: use common::from_status;",
          "",
          "[Added Lines]",
          "2: use std::os::unix::fs::PermissionsExt;",
          "3: use std::path::PathBuf;",
          "4: use std::process::{Command, Stdio};",
          "6: macro_rules! try_browser {",
          "7:     ( $name:expr, $( $arg:expr ),+ ) => {",
          "8:         for_matching_path($name, |pb| {",
          "9:             let mut cmd = Command::new(pb);",
          "10:             $(",
          "11:                 cmd.arg($arg);",
          "12:             )+",
          "13:             run_command(&mut cmd, !is_text_browser(&pb))",
          "14:         })",
          "15:     }",
          "16: }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "14: #[inline]",
          "47: }",
          "54:         if !browser.is_empty() {",
          "",
          "[Removed Lines]",
          "15: pub fn open_browser_internal(browser: Browser, url: &str) -> Result<()> {",
          "16:     from_status(open_browser_unix(browser, url))",
          "17: }",
          "19: fn open_browser_unix(browser: Browser, url: &str) -> Result<ExitStatus> {",
          "20:     match browser {",
          "21:         Browser::Default => open_on_unix_using_browser_env(url)",
          "22:             .or_else(|_| -> Result<ExitStatus> { Command::new(\"xdg-open\").arg(url).status() })",
          "23:             .or_else(|r| -> Result<ExitStatus> {",
          "24:                 if let Ok(desktop) = ::std::env::var(\"XDG_CURRENT_DESKTOP\") {",
          "25:                     if desktop == \"KDE\" {",
          "26:                         return Command::new(\"kioclient\").arg(\"exec\").arg(url).status();",
          "27:                     }",
          "28:                 }",
          "29:                 Err(r) // If either `if` check fails, fall through to the next or_else",
          "30:             })",
          "31:             .or_else(|_| -> Result<ExitStatus> { Command::new(\"gvfs-open\").arg(url).status() })",
          "32:             .or_else(|_| -> Result<ExitStatus> { Command::new(\"gnome-open\").arg(url).status() })",
          "33:             .or_else(|_| -> Result<ExitStatus> {",
          "34:                 Command::new(\"kioclient\").arg(\"exec\").arg(url).status()",
          "35:             })",
          "36:             .or_else(|e| -> Result<ExitStatus> {",
          "37:                 if let Ok(_child) = Command::new(\"x-www-browser\").arg(url).spawn() {",
          "38:                     return Ok(ExitStatusExt::from_raw(0));",
          "39:                 }",
          "40:                 Err(e)",
          "41:             }),",
          "42:         _ => Err(Error::new(",
          "43:             ErrorKind::NotFound,",
          "44:             \"Only the default browser is supported on this platform right now\",",
          "45:         )),",
          "46:     }",
          "49: fn open_on_unix_using_browser_env(url: &str) -> Result<ExitStatus> {",
          "50:     let browsers = ::std::env::var(\"BROWSER\")",
          "51:         .map_err(|_| -> Error { Error::new(ErrorKind::NotFound, \"BROWSER env not set\") })?;",
          "52:     for browser in browsers.split(':') {",
          "",
          "[Added Lines]",
          "25: pub fn open_browser_internal(_: Browser, url: &str) -> Result<()> {",
          "27:     try_with_browser_env(url)",
          "29:         .or_else(|_| try_browser!(\"xdg-open\", url))",
          "31:         .or_else(|r| {",
          "33:             let desktop_env: String = std::env::var(\"XDG_CURRENT_DESKTOP\")",
          "34:                 .unwrap_or_else(|_| String::from(\"unknown\"))",
          "35:                 .to_ascii_uppercase();",
          "36:             match desktop_env.as_str() {",
          "37:                 \"KDE\" => try_browser!(\"kde-open\", url).or_else(|_| try_browser!(\"kde-open5\", url)),",
          "38:                 \"GNOME\" | \"CINNAMON\" => try_browser!(\"gio\", \"open\", url)",
          "39:                     .or_else(|_| try_browser!(\"gvfs-open\", url))",
          "40:                     .or_else(|_| try_browser!(\"gnome-open\", url)),",
          "41:                 \"MATE\" => try_browser!(\"gio\", \"open\", url)",
          "42:                     .or_else(|_| try_browser!(\"gvfs-open\", url))",
          "43:                     .or_else(|_| try_browser!(\"mate-open\", url)),",
          "44:                 \"XFCE\" => try_browser!(\"exo-open\", url)",
          "45:                     .or_else(|_| try_browser!(\"gio\", \"open\", url))",
          "46:                     .or_else(|_| try_browser!(\"gvfs-open\", url)),",
          "47:                 _ => Err(r),",
          "48:             }",
          "49:         })",
          "51:         .or_else(|_| try_browser!(\"x-www-browser\", url))",
          "53:         .and_then(|_| Ok(()))",
          "54:         .or_else(|_| {",
          "55:             Err(Error::new(",
          "56:                 ErrorKind::NotFound,",
          "57:                 \"No valid browsers detected. You can specify one in BROWSERS environment variable\",",
          "58:             ))",
          "59:         })",
          "62: #[inline]",
          "63: fn try_with_browser_env(url: &str) -> Result<()> {",
          "65:     for browser in std::env::var(\"BROWSER\")",
          "66:         .unwrap_or_else(|_| String::from(\"\"))",
          "67:         .split(':')",
          "68:     {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "58:                 .replace(\"%s\", url)",
          "59:                 .replace(\"%c\", \":\")",
          "60:                 .replace(\"%%\", \"%\");",
          "72:             }",
          "73:         }",
          "74:     }",
          "75:     Err(Error::new(",
          "76:         ErrorKind::NotFound,",
          "78:     ))",
          "79: }",
          "",
          "[Removed Lines]",
          "61:             let cmdarr: Vec<&str> = cmdline.split_whitespace().collect();",
          "62:             let mut cmd = Command::new(&cmdarr[0]);",
          "63:             if cmdarr.len() > 1 {",
          "64:                 cmd.args(&cmdarr[1..cmdarr.len()]);",
          "65:             }",
          "66:             if !browser.contains(\"%s\") {",
          "68:                 cmd.arg(url);",
          "69:             }",
          "70:             if let Ok(status) = cmd.status() {",
          "71:                 return Ok(status);",
          "77:         \"No valid command in $BROWSER\",",
          "",
          "[Added Lines]",
          "76:             let cmdarr: Vec<&str> = cmdline.split_ascii_whitespace().collect();",
          "77:             let browser_cmd = cmdarr[0];",
          "78:             let env_exit = for_matching_path(browser_cmd, |pb| {",
          "79:                 let mut cmd = Command::new(pb);",
          "80:                 for i in 1..cmdarr.len() {",
          "81:                     cmd.arg(cmdarr[i]);",
          "82:                 }",
          "83:                 if !browser.contains(\"%s\") {",
          "85:                     cmd.arg(url);",
          "86:                 }",
          "87:                 run_command(&mut cmd, !is_text_browser(&pb))",
          "88:             });",
          "89:             if env_exit.is_ok() {",
          "90:                 return Ok(());",
          "96:         \"No valid browser configured in BROWSER environment variable\",",
          "101: #[inline]",
          "102: fn is_text_browser(pb: &PathBuf) -> bool {",
          "103:     for browser in TEXT_BROWSERS.iter() {",
          "104:         if pb.ends_with(&browser) {",
          "105:             return true;",
          "106:         }",
          "107:     }",
          "108:     false",
          "109: }",
          "111: #[inline]",
          "112: fn for_matching_path<F>(name: &str, op: F) -> Result<()>",
          "113: where",
          "114:     F: FnOnce(&PathBuf) -> Result<()>,",
          "115: {",
          "116:     let err = Err(Error::new(ErrorKind::NotFound, \"command not found\"));",
          "120:     if name.contains(std::path::MAIN_SEPARATOR) {",
          "121:         let pb = std::path::PathBuf::from(name);",
          "122:         if let Ok(metadata) = pb.metadata() {",
          "123:             if metadata.is_file() && metadata.permissions().mode() & 0o111 != 0 {",
          "124:                 return op(&pb);",
          "125:             }",
          "126:         } else {",
          "127:             return err;",
          "128:         }",
          "129:     } else {",
          "131:         if let Ok(path) = std::env::var(\"PATH\") {",
          "132:             for entry in path.split(\":\") {",
          "133:                 let mut pb = std::path::PathBuf::from(entry);",
          "134:                 pb.push(name);",
          "135:                 if let Ok(metadata) = pb.metadata() {",
          "136:                     if metadata.is_file() && metadata.permissions().mode() & 0o111 != 0 {",
          "137:                         return op(&pb);",
          "138:                     }",
          "139:                 }",
          "140:             }",
          "141:         }",
          "142:     }",
          "144:     err",
          "145: }",
          "148: #[inline]",
          "149: fn run_command(cmd: &mut Command, background: bool) -> Result<()> {",
          "150:     if background {",
          "153:         cmd.stdin(Stdio::null())",
          "154:             .stdout(Stdio::null())",
          "155:             .stderr(Stdio::null())",
          "156:             .spawn()",
          "157:             .and_then(|_| Ok(()))",
          "158:     } else {",
          "161:         cmd.status().and_then(|status| {",
          "162:             if status.success() {",
          "163:                 Ok(())",
          "164:             } else {",
          "165:                 Err(Error::new(",
          "166:                     ErrorKind::Other,",
          "167:                     \"command present but exited unsuccessfully\",",
          "168:                 ))",
          "169:             }",
          "170:         })",
          "171:     }",
          "172: }",
          "174: static TEXT_BROWSERS: [&'static str; 9] = [",
          "175:     \"lynx\", \"links\", \"links2\", \"elinks\", \"w3m\", \"eww\", \"netrik\", \"retawq\", \"curl\",",
          "176: ];",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "1ac45cba6d57b535a2ac92a0bd01f8e13dd1eed1",
      "candidate_info": {
        "commit_hash": "1ac45cba6d57b535a2ac92a0bd01f8e13dd1eed1",
        "repo": "amodm/webbrowser-rs",
        "commit_url": "https://github.com/amodm/webbrowser-rs/commit/1ac45cba6d57b535a2ac92a0bd01f8e13dd1eed1",
        "files": [
          "src/unix.rs"
        ],
        "message": "delete unrelevant open command for unix",
        "before_after_code_files": [
          "src/unix.rs||src/unix.rs"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/unix.rs||src/unix.rs"
          ],
          "candidate": [
            "src/unix.rs||src/unix.rs"
          ]
        }
      },
      "candidate_diff": {
        "src/unix.rs||src/unix.rs": [
          "File: src/unix.rs -> src/unix.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "23:             })",
          "24:             .or_else(|_| -> Result<ExitStatus> { Command::new(\"gvfs-open\").arg(url).status() })",
          "25:             .or_else(|_| -> Result<ExitStatus> { Command::new(\"gnome-open\").arg(url).status() })",
          "27:             .or_else(|_| -> Result<ExitStatus> {",
          "28:                 Command::new(\"kioclient\").arg(\"exec\").arg(url).status()",
          "29:             })",
          "",
          "[Removed Lines]",
          "26:             .or_else(|_| -> Result<ExitStatus> { Command::new(\"open\").arg(url).status() })",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "7e881f823e55ef70e8cd6d9ea08c938897aac682",
      "candidate_info": {
        "commit_hash": "7e881f823e55ef70e8cd6d9ea08c938897aac682",
        "repo": "amodm/webbrowser-rs",
        "commit_url": "https://github.com/amodm/webbrowser-rs/commit/7e881f823e55ef70e8cd6d9ea08c938897aac682",
        "files": [
          "src/android.rs",
          "src/ios.rs",
          "src/lib.rs",
          "src/macos.rs",
          "src/unix.rs",
          "src/wasm.rs",
          "src/windows.rs"
        ],
        "message": "refactor TargetType",
        "before_after_code_files": [
          "src/android.rs||src/android.rs",
          "src/ios.rs||src/ios.rs",
          "src/lib.rs||src/lib.rs",
          "src/macos.rs||src/macos.rs",
          "src/unix.rs||src/unix.rs",
          "src/wasm.rs||src/wasm.rs",
          "src/windows.rs||src/windows.rs"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/lib.rs||src/lib.rs",
            "src/macos.rs||src/macos.rs",
            "src/unix.rs||src/unix.rs",
            "src/windows.rs||src/windows.rs"
          ],
          "candidate": [
            "src/lib.rs||src/lib.rs",
            "src/macos.rs||src/macos.rs",
            "src/unix.rs||src/unix.rs",
            "src/windows.rs||src/windows.rs"
          ]
        }
      },
      "candidate_diff": {
        "src/android.rs||src/android.rs": [
          "File: src/android.rs -> src/android.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "10:     options: &BrowserOptions,",
          "11: ) -> Result<()> {",
          "15:     match browser {",
          "16:         Browser::Default => open_browser_default(url, options),",
          "",
          "[Removed Lines]",
          "13:     let url = crate::get_http_url(target)?;",
          "",
          "[Added Lines]",
          "13:     let url = target.get_http_url()?;",
          "",
          "---------------"
        ],
        "src/ios.rs||src/ios.rs": [
          "File: src/ios.rs -> src/ios.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "8:     options: &BrowserOptions,",
          "9: ) -> Result<()> {",
          "14:     if options.dry_run {",
          "",
          "[Removed Lines]",
          "11:     let url = crate::get_http_url(target)?;",
          "",
          "[Added Lines]",
          "11:     let url = target.get_http_url()?;",
          "",
          "---------------"
        ],
        "src/lib.rs||src/lib.rs": [
          "File: src/lib.rs -> src/lib.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "294:     Path(String),",
          "295: }",
          "308:     }",
          "309: }",
          "",
          "[Removed Lines]",
          "299: #[cfg(any(target_os = \"android\", target_os = \"ios\", target_family = \"wasm\"))]",
          "300: #[inline]",
          "301: pub(crate) fn get_http_url(target: &TargetType) -> Result<&str> {",
          "302:     match target {",
          "303:         TargetType::Url(u) => match u.scheme() {",
          "304:             \"http\" | \"https\" => Ok(u.as_str()),",
          "305:             _ => Err(Error::new(ErrorKind::InvalidInput, \"not a valid url\")),",
          "306:         },",
          "307:         _ => Err(Error::new(ErrorKind::InvalidInput, \"not a valid url\")),",
          "",
          "[Added Lines]",
          "297: impl TargetType {",
          "299:     #[cfg(any(target_os = \"android\", target_os = \"ios\", target_family = \"wasm\"))]",
          "300:     fn is_http(&self) -> bool {",
          "301:         match self {",
          "302:             Self::Url(u) => match u.scheme() {",
          "303:                 \"http\" | \"https\" => true,",
          "304:                 _ => false,",
          "305:             },",
          "306:             _ => false,",
          "307:         }",
          "308:     }",
          "312:     #[cfg(any(target_os = \"android\", target_os = \"ios\", target_family = \"wasm\"))]",
          "313:     fn get_http_url(&self) -> Result<&str> {",
          "314:         if self.is_http() {",
          "315:             Ok(self.as_ref())",
          "316:         } else {",
          "317:             Err(Error::new(ErrorKind::InvalidInput, \"not a valid url\"))",
          "318:         }",
          "319:     }",
          "320: }",
          "322: impl AsRef<str> for TargetType {",
          "323:     fn as_ref(&self) -> &str {",
          "324:         match self {",
          "325:             TargetType::Url(u) => u.as_str(),",
          "326:             TargetType::Path(p) => p,",
          "327:         }",
          "",
          "---------------"
        ],
        "src/macos.rs||src/macos.rs": [
          "File: src/macos.rs -> src/macos.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "10:     target: &TargetType,",
          "11:     options: &BrowserOptions,",
          "12: ) -> Result<()> {",
          "18:     let mut cmd = Command::new(\"open\");",
          "19:     match browser {",
          "20:         Browser::Default => {",
          "",
          "[Removed Lines]",
          "13:     let url = match target {",
          "14:         TargetType::Url(u) => u.as_str(),",
          "15:         TargetType::Path(s) => s.as_str(),",
          "16:     };",
          "",
          "[Added Lines]",
          "13:     let url = target.as_ref();",
          "",
          "---------------"
        ],
        "src/unix.rs||src/unix.rs": [
          "File: src/unix.rs -> src/unix.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "29:     target: &TargetType,",
          "30:     options: &BrowserOptions,",
          "31: ) -> Result<()> {",
          "37:     match browser {",
          "39:         _ => Err(Error::new(",
          "40:             ErrorKind::NotFound,",
          "41:             \"only default browser supported\",",
          "",
          "[Removed Lines]",
          "32:     let url = match target {",
          "33:         TargetType::Url(u) => u.as_str(),",
          "34:         TargetType::Path(s) => s.as_str(),",
          "35:     };",
          "38:         Browser::Default => open_browser_default(url, options),",
          "",
          "[Added Lines]",
          "33:         Browser::Default => open_browser_default(target.as_ref(), options),",
          "",
          "---------------"
        ],
        "src/wasm.rs||src/wasm.rs": [
          "File: src/wasm.rs -> src/wasm.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "8:     options: &BrowserOptions,",
          "9: ) -> Result<()> {",
          "14:     if options.dry_run {",
          "",
          "[Removed Lines]",
          "11:     let url = crate::get_http_url(target)?;",
          "",
          "[Added Lines]",
          "11:     let url = target.get_http_url()?;",
          "",
          "---------------"
        ],
        "src/windows.rs||src/windows.rs": [
          "File: src/windows.rs -> src/windows.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "23:     target: &TargetType,",
          "24:     options: &BrowserOptions,",
          "25: ) -> Result<()> {",
          "31:     match browser {",
          "32:         Browser::Default => {",
          "",
          "[Removed Lines]",
          "26:     let url = match target {",
          "27:         TargetType::Url(u) => u.as_str(),",
          "28:         TargetType::Path(s) => s.as_str(),",
          "29:     };",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "38:             static OPEN: &[u16] = &['o' as u16, 'p' as u16, 'e' as u16, 'n' as u16, 0x0000];",
          "39:             static HTTP: &[u16] = &['h' as u16, 't' as u16, 't' as u16, 'p' as u16, 0x0000];",
          "42:             let code = unsafe {",
          "43:                 let coinitializeex_result = CoInitializeEx(",
          "44:                     ptr::null_mut(),",
          "",
          "[Removed Lines]",
          "40:             let url =",
          "41:                 U16CString::from_str(url).map_err(|e| Error::new(ErrorKind::InvalidInput, e))?;",
          "",
          "[Added Lines]",
          "35:             let url = U16CString::from_str(target.as_ref())",
          "36:                 .map_err(|e| Error::new(ErrorKind::InvalidInput, e))?;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "68161a5c3ef7dc9fa3314b1f291d65c05ef46db4",
      "candidate_info": {
        "commit_hash": "68161a5c3ef7dc9fa3314b1f291d65c05ef46db4",
        "repo": "amodm/webbrowser-rs",
        "commit_url": "https://github.com/amodm/webbrowser-rs/commit/68161a5c3ef7dc9fa3314b1f291d65c05ef46db4",
        "files": [
          "src/lib.rs"
        ],
        "message": "fix wasm build #build-wasm",
        "before_after_code_files": [
          "src/lib.rs||src/lib.rs"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/lib.rs||src/lib.rs"
          ],
          "candidate": [
            "src/lib.rs||src/lib.rs"
          ]
        }
      },
      "candidate_diff": {
        "src/lib.rs||src/lib.rs": [
          "File: src/lib.rs -> src/lib.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "339:         match url::Url::parse(value) {",
          "340:             Ok(u) => Ok(Self(u)),",
          "341:             Err(_) => {",
          "346:                 } else {",
          "354:             }",
          "355:         }",
          "356:     }",
          "",
          "[Removed Lines]",
          "343:                 let pb = PathBuf::from(value);",
          "344:                 let url = url::Url::from_file_path(if pb.is_relative() {",
          "345:                     std::env::current_dir()?.join(pb)",
          "347:                     pb",
          "348:                 })",
          "349:                 .map_err(|_| {",
          "350:                     Error::new(ErrorKind::InvalidInput, \"failed to convert path to url\")",
          "351:                 })?;",
          "353:                 Ok(Self(url))",
          "",
          "[Added Lines]",
          "342:                 if cfg!(target_family = \"wasm\") {",
          "343:                     Err(Error::new(ErrorKind::InvalidInput, \"invalid url for wasm\"))",
          "346:                     let pb = PathBuf::from(value);",
          "347:                     let url = url::Url::from_file_path(if pb.is_relative() {",
          "348:                         std::env::current_dir()?.join(pb)",
          "349:                     } else {",
          "350:                         pb",
          "351:                     })",
          "352:                     .map_err(|_| {",
          "353:                         Error::new(ErrorKind::InvalidInput, \"failed to convert path to url\")",
          "354:                     })?;",
          "356:                     Ok(Self(url))",
          "357:                 }",
          "",
          "---------------"
        ]
      }
    }
  ]
}