{
  "cve_id": "CVE-2024-34713",
  "cve_desc": "sshproxy is used on a gateway to transparently proxy a user SSH connection on the gateway to an internal host via SSH. Prior to version 1.6.3, any user authorized to connect to a ssh server using `sshproxy` can inject options to the `ssh` command executed by `sshproxy`. All versions of `sshproxy` are impacted. The problem is patched starting in version 1.6.3. The only workaround is to use the `force_command` option in `sshproxy.yaml`, but it's rarely relevant.",
  "repo": "cea-hpc/sshproxy",
  "patch_hash": "f7eabd05d5f0f951e160293692327cad9a7d9580",
  "patch_info": {
    "commit_hash": "f7eabd05d5f0f951e160293692327cad9a7d9580",
    "repo": "cea-hpc/sshproxy",
    "commit_url": "https://github.com/cea-hpc/sshproxy/commit/f7eabd05d5f0f951e160293692327cad9a7d9580",
    "files": [
      "cmd/sshproxy/sshproxy.go",
      "test/fedora-image/Dockerfile"
    ],
    "message": "Prevent ssh option injection (#16)",
    "before_after_code_files": [
      "cmd/sshproxy/sshproxy.go||cmd/sshproxy/sshproxy.go"
    ]
  },
  "patch_diff": {
    "cmd/sshproxy/sshproxy.go||cmd/sshproxy/sshproxy.go": [
      "File: cmd/sshproxy/sshproxy.go -> cmd/sshproxy/sshproxy.go",
      "--- Hunk 1 ---",
      "[Context before]",
      "474:    if doCmd == fromCmd {",
      "475:     log.Debugf(\"translateCmdConf = %+v\", translateCmdConf)",
      "476:     sshArgs = append(sshArgs, translateCmdConf.SSHArgs...)",
      "478:     if config.Dump != \"\" && translateCmdConf.DisableDump {",
      "479:      config.Dump = \"etcd\"",
      "480:     }",
      "",
      "[Removed Lines]",
      "477:     sshArgs = append(sshArgs, \"--\", host, translateCmdConf.Command)",
      "",
      "[Added Lines]",
      "477:     sshArgs = append(sshArgs, host, \"--\", translateCmdConf.Command)",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "488:     sshArgs = append(sshArgs, \"-t\")",
      "489:    }",
      "491:   }",
      "492:  } else {",
      "493:   sshArgs = append(sshArgs, host)",
      "",
      "[Removed Lines]",
      "490:    sshArgs = append(sshArgs, host, doCmd)",
      "",
      "[Added Lines]",
      "490:    sshArgs = append(sshArgs, host, \"--\", doCmd)",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "3b8bccc874dc4ca2c80c956cad65722abb46f0b9",
      "candidate_info": {
        "commit_hash": "3b8bccc874dc4ca2c80c956cad65722abb46f0b9",
        "repo": "cea-hpc/sshproxy",
        "commit_url": "https://github.com/cea-hpc/sshproxy/commit/3b8bccc874dc4ca2c80c956cad65722abb46f0b9",
        "files": [
          "cmd/sshproxy/sshproxy.go",
          "test/centos-image/Dockerfile"
        ],
        "message": "Prevent ssh option injection",
        "before_after_code_files": [
          "cmd/sshproxy/sshproxy.go||cmd/sshproxy/sshproxy.go"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_olp_changes": 1,
        "olp_code_files": {
          "patch": [
            "cmd/sshproxy/sshproxy.go||cmd/sshproxy/sshproxy.go"
          ],
          "candidate": [
            "cmd/sshproxy/sshproxy.go||cmd/sshproxy/sshproxy.go"
          ]
        }
      },
      "candidate_diff": {
        "cmd/sshproxy/sshproxy.go||cmd/sshproxy/sshproxy.go": [
          "File: cmd/sshproxy/sshproxy.go -> cmd/sshproxy/sshproxy.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "474:    if doCmd == fromCmd {",
          "475:     log.Debugf(\"translateCmdConf = %+v\", translateCmdConf)",
          "476:     sshArgs = append(sshArgs, translateCmdConf.SSHArgs...)",
          "478:     if config.Dump != \"\" && translateCmdConf.DisableDump {",
          "479:      config.Dump = \"etcd\"",
          "480:     }",
          "",
          "[Removed Lines]",
          "477:     sshArgs = append(sshArgs, \"--\", host, translateCmdConf.Command)",
          "",
          "[Added Lines]",
          "477:     sshArgs = append(sshArgs, host, \"--\", translateCmdConf.Command)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "488:     sshArgs = append(sshArgs, \"-t\")",
          "489:    }",
          "491:   }",
          "492:  } else {",
          "493:   sshArgs = append(sshArgs, host)",
          "",
          "[Removed Lines]",
          "490:    sshArgs = append(sshArgs, host, doCmd)",
          "",
          "[Added Lines]",
          "490:    sshArgs = append(sshArgs, host, \"--\", doCmd)",
          "",
          "---------------"
        ]
      }
    }
  ]
}