{
  "cve_id": "CVE-2015-5254",
  "cve_desc": "Apache ActiveMQ 5.x before 5.13.0 does not restrict the classes that can be serialized in the broker, which allows remote attackers to execute arbitrary code via a crafted serialized Java Message Service (JMS) ObjectMessage object.",
  "repo": "apache/activemq",
  "patch_hash": "e7a4b53f799685e337972dd36ba0253c04bcc01f",
  "patch_info": {
    "commit_hash": "e7a4b53f799685e337972dd36ba0253c04bcc01f",
    "repo": "apache/activemq",
    "commit_url": "https://github.com/apache/activemq/commit/e7a4b53f799685e337972dd36ba0253c04bcc01",
    "files": [
      "activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java",
      "activemq-http/src/main/java/org/apache/activemq/transport/xstream/XStreamWireFormat.java",
      "activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/JmsFrameTranslator.java",
      "activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/XStreamSupport.java",
      "activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/StompTestSupport.java",
      "activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/util/XStreamBrokerContext.java",
      "activemq-web/src/main/java/org/apache/activemq/web/MessageQuery.java"
    ],
    "message": "https://issues.apache.org/jira/browse/AMQ-6013 - restrict classes which can be serialized inside the broker",
    "before_after_code_files": [
      "activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java||activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java",
      "activemq-http/src/main/java/org/apache/activemq/transport/xstream/XStreamWireFormat.java||activemq-http/src/main/java/org/apache/activemq/transport/xstream/XStreamWireFormat.java",
      "activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/JmsFrameTranslator.java||activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/JmsFrameTranslator.java",
      "activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/XStreamSupport.java||activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/XStreamSupport.java",
      "activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/StompTestSupport.java||activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/StompTestSupport.java",
      "activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/util/XStreamBrokerContext.java||activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/util/XStreamBrokerContext.java",
      "activemq-web/src/main/java/org/apache/activemq/web/MessageQuery.java||activemq-web/src/main/java/org/apache/activemq/web/MessageQuery.java"
    ]
  },
  "patch_diff": {
    "activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java||activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java": [
      "File: activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java -> activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java",
      "--- Hunk 1 ---",
      "[Context before]",
      "21: import java.io.ObjectInputStream;",
      "22: import java.io.ObjectStreamClass;",
      "23: import java.lang.reflect.Proxy;",
      "25: import org.slf4j.Logger;",
      "26: import org.slf4j.LoggerFactory;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "24: import java.util.Arrays;",
      "25: import java.util.Collection;",
      "26: import java.util.Map;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "31:     private static final ClassLoader FALLBACK_CLASS_LOADER =",
      "32:         ClassLoadingAwareObjectInputStream.class.getClassLoader();",
      "34:     private final ClassLoader inLoader;",
      "36:     public ClassLoadingAwareObjectInputStream(InputStream in) throws IOException {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "37:     private static String[] serializablePackages;",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "41:     @Override",
      "42:     protected Class<?> resolveClass(ObjectStreamClass classDesc) throws IOException, ClassNotFoundException {",
      "43:         ClassLoader cl = Thread.currentThread().getContextClassLoader();",
      "45:     }",
      "47:     @Override",
      "",
      "[Removed Lines]",
      "44:         return load(classDesc.getName(), cl, inLoader);",
      "",
      "[Added Lines]",
      "49:         Class clazz = load(classDesc.getName(), cl, inLoader);",
      "50:         checkSecurity(clazz);",
      "51:         return clazz;",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "52:             cinterfaces[i] = load(interfaces[i], cl);",
      "53:         }",
      "55:         try {",
      "57:         } catch (IllegalArgumentException e) {",
      "58:             try {",
      "60:             } catch (IllegalArgumentException e1) {",
      "62:             }",
      "63:             try {",
      "65:             } catch (IllegalArgumentException e2) {",
      "67:             }",
      "70:         }",
      "71:     }",
      "",
      "[Removed Lines]",
      "56:             return Proxy.getProxyClass(cl, cinterfaces);",
      "59:                 return Proxy.getProxyClass(inLoader, cinterfaces);",
      "64:                 return Proxy.getProxyClass(FALLBACK_CLASS_LOADER, cinterfaces);",
      "69:             throw new ClassNotFoundException(null, e);",
      "",
      "[Added Lines]",
      "62:         Class clazz = null;",
      "64:             clazz = Proxy.getProxyClass(cl, cinterfaces);",
      "67:                 clazz = Proxy.getProxyClass(inLoader, cinterfaces);",
      "72:                 clazz = Proxy.getProxyClass(FALLBACK_CLASS_LOADER, cinterfaces);",
      "76:         }",
      "78:         if (clazz != null) {",
      "79:             checkSecurity(clazz);",
      "80:             return clazz;",
      "81:         } else {",
      "82:             throw new ClassNotFoundException(null);",
      "83:         }",
      "84:     }",
      "86:     public static String[] getSerialziablePackages() {",
      "87:        if (serializablePackages == null) {",
      "88:            serializablePackages = System.getProperty(\"org.apache.activemq.SERIALIZABLE_PACKAGES\",",
      "89:                        \"java.lang,java.util,org.apache.activemq,org.fusesource.hawtbuf,com.thoughtworks.xstream.mapper\").split(\",\");",
      "90:        }",
      "92:        return serializablePackages;",
      "93:     };",
      "95:     public static boolean isAllAllowed() {",
      "96:         return getSerialziablePackages().length == 1 && getSerialziablePackages()[0].equals(\"*\");",
      "97:     }",
      "99:     private void checkSecurity(Class clazz) throws ClassNotFoundException {",
      "100:         if (!clazz.isPrimitive()) {",
      "101:             if (clazz.getPackage() != null && !isAllAllowed()) {",
      "102:                boolean found = false;",
      "103:                for (String packageName : getSerialziablePackages()) {",
      "104:                    if (clazz.getPackage().getName().equals(packageName) || clazz.getPackage().getName().startsWith(packageName + \".\")) {",
      "105:                        found = true;",
      "106:                        break;",
      "107:                    }",
      "108:                }",
      "110:                if (!found) {",
      "111:                    throw new ClassNotFoundException(\"Forbidden \" + clazz + \"! This class is not allowed to be serialized. Add package with 'org.apache.activemq.SERIALIZABLE_PACKAGES' system property.\");",
      "112:                }",
      "113:             }",
      "",
      "---------------"
    ],
    "activemq-http/src/main/java/org/apache/activemq/transport/xstream/XStreamWireFormat.java||activemq-http/src/main/java/org/apache/activemq/transport/xstream/XStreamWireFormat.java": [
      "File: activemq-http/src/main/java/org/apache/activemq/transport/xstream/XStreamWireFormat.java -> activemq-http/src/main/java/org/apache/activemq/transport/xstream/XStreamWireFormat.java",
      "--- Hunk 1 ---",
      "[Context before]",
      "19: import java.io.IOException;",
      "20: import java.io.Reader;",
      "22: import org.apache.activemq.command.MarshallAware;",
      "23: import org.apache.activemq.command.MessageDispatch;",
      "24: import org.apache.activemq.transport.util.TextWireFormat;",
      "25: import org.apache.activemq.wireformat.WireFormat;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "22: <<<<<<< HEAD",
      "23: =======",
      "24: import com.thoughtworks.xstream.converters.Converter;",
      "25: import com.thoughtworks.xstream.converters.MarshallingContext;",
      "26: import com.thoughtworks.xstream.converters.UnmarshallingContext;",
      "27: import com.thoughtworks.xstream.io.HierarchicalStreamReader;",
      "28: import com.thoughtworks.xstream.io.HierarchicalStreamWriter;",
      "29: >>>>>>> a7e2a44... https://issues.apache.org/jira/browse/AMQ-6013 - restrict classes which can be serialized inside the broker",
      "32: import org.apache.activemq.transport.stomp.XStreamSupport;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "93:     }",
      "98:         if (xStream == null) {",
      "99:             xStream = createXStream();",
      "",
      "[Removed Lines]",
      "97:     public XStream getXStream() {",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "112:     protected XStream createXStream() {",
      "114:         xstream.ignoreUnknownElements();",
      "115:         return xstream;",
      "116:     }",
      "",
      "[Removed Lines]",
      "113:         XStream xstream = new XStream();",
      "",
      "[Added Lines]",
      "121:         final XStream xstream = XStreamSupport.createXStream();",
      "",
      "---------------"
    ],
    "activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/JmsFrameTranslator.java||activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/JmsFrameTranslator.java": [
      "File: activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/JmsFrameTranslator.java -> activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/JmsFrameTranslator.java",
      "--- Hunk 1 ---",
      "[Context before]",
      "91:                         msg = createMapMessage(in);",
      "92:                         break;",
      "93:                     default:",
      "95:                 }",
      "96:             } catch (Throwable e) {",
      "97:                 command.getHeaders().put(Headers.TRANSFORMATION_ERROR, e.getMessage());",
      "",
      "[Removed Lines]",
      "94:                         throw new Exception(\"Unkown transformation: \" + transformation);",
      "",
      "[Added Lines]",
      "94:                         throw new Exception(\"Unknown transformation: \" + transformation);",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "254:         }",
      "256:         if (xstream == null) {",
      "258:             xstream.ignoreUnknownElements();",
      "259:         }",
      "",
      "[Removed Lines]",
      "257:             xstream = new XStream();",
      "",
      "[Added Lines]",
      "257:             xstream = XStreamSupport.createXStream();",
      "",
      "---------------"
    ],
    "activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/XStreamSupport.java||activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/XStreamSupport.java": [
      "File: activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/XStreamSupport.java -> activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/XStreamSupport.java",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "17: package org.apache.activemq.transport.stomp;",
      "19: import com.thoughtworks.xstream.XStream;",
      "20: import com.thoughtworks.xstream.security.AnyTypePermission;",
      "21: import com.thoughtworks.xstream.security.NoTypePermission;",
      "22: import com.thoughtworks.xstream.security.PrimitiveTypePermission;",
      "23: import org.apache.activemq.util.ClassLoadingAwareObjectInputStream;",
      "25: import java.util.Collection;",
      "26: import java.util.Map;",
      "28: public class XStreamSupport {",
      "30:     public static XStream createXStream() {",
      "31:         XStream stream = new XStream();",
      "32:         stream.addPermission(NoTypePermission.NONE);",
      "33:         stream.addPermission(PrimitiveTypePermission.PRIMITIVES);",
      "34:         stream.allowTypeHierarchy(Collection.class);",
      "35:         stream.allowTypeHierarchy(Map.class);",
      "36:         stream.allowTypes(new Class[]{String.class});",
      "37:         if (ClassLoadingAwareObjectInputStream.isAllAllowed()) {",
      "38:             stream.addPermission(AnyTypePermission.ANY);",
      "39:         } else {",
      "40:             for (String packageName : ClassLoadingAwareObjectInputStream.getSerialziablePackages()) {",
      "41:                 stream.allowTypesByWildcard(new String[]{packageName + \".**\"});",
      "42:             }",
      "43:         }",
      "44:         return stream;",
      "45:     }",
      "47: }",
      "",
      "---------------"
    ],
    "activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/StompTestSupport.java||activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/StompTestSupport.java": [
      "File: activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/StompTestSupport.java -> activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/StompTestSupport.java",
      "--- Hunk 1 ---",
      "[Context before]",
      "111:     }",
      "113:     public void startBroker() throws Exception {",
      "115:         createBroker(true);",
      "117:         XStreamBrokerContext context = new XStreamBrokerContext();",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "114:         System.setProperty(\"org.apache.activemq.SERIALIZABLE_PACKAGES\", \"*\");",
      "",
      "---------------"
    ],
    "activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/util/XStreamBrokerContext.java||activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/util/XStreamBrokerContext.java": [
      "File: activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/util/XStreamBrokerContext.java -> activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/util/XStreamBrokerContext.java",
      "--- Hunk 1 ---",
      "[Context before]",
      "23: import org.apache.activemq.transport.stomp.SamplePojo;",
      "25: import com.thoughtworks.xstream.XStream;",
      "27: public class XStreamBrokerContext implements BrokerContext {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "26: import org.apache.activemq.transport.stomp.XStreamSupport;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "31:     public XStreamBrokerContext() {",
      "34:         stream.processAnnotations(SamplePojo.class);",
      "36:         beansMap.put(\"xstream\", stream);",
      "",
      "[Removed Lines]",
      "33:         XStream stream = new XStream();",
      "",
      "[Added Lines]",
      "34:         XStream stream = XStreamSupport.createXStream();",
      "",
      "---------------"
    ],
    "activemq-web/src/main/java/org/apache/activemq/web/MessageQuery.java||activemq-web/src/main/java/org/apache/activemq/web/MessageQuery.java": [
      "File: activemq-web/src/main/java/org/apache/activemq/web/MessageQuery.java -> activemq-web/src/main/java/org/apache/activemq/web/MessageQuery.java",
      "--- Hunk 1 ---",
      "[Context before]",
      "81:         if (message instanceof ObjectMessage) {",
      "82:             try {",
      "83:                 return ((ObjectMessage) message).getObject();",
      "87:             }",
      "88:         }",
      "89:         if (message instanceof MapMessage) {",
      "",
      "[Removed Lines]",
      "84:             } catch (JMSException e) {",
      "86:                 return e;",
      "",
      "[Added Lines]",
      "84:             } catch (Exception e) {",
      "86:                 return new String(\"Cannot display ObjectMessage body. Reason: \" + e.getMessage());",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "9a0298f3e95d5b489b2589e37f0945084bcbab5a",
      "candidate_info": {
        "commit_hash": "9a0298f3e95d5b489b2589e37f0945084bcbab5a",
        "repo": "apache/activemq",
        "commit_url": "https://github.com/apache/activemq/commit/9a0298f3e95d5b489b2589e37f0945084bcbab5a",
        "files": [
          "activemq-camel/src/test/java/org/apache/activemq/camel/ObjectMessageTest.java",
          "activemq-camel/src/test/resources/org/apache/activemq/camel/jms-object-message.xml",
          "activemq-client/src/main/java/org/apache/activemq/ActiveMQConnectionFactory.java",
          "activemq-client/src/main/java/org/apache/activemq/command/ActiveMQObjectMessage.java",
          "activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java"
        ],
        "message": "https://issues.apache.org/jira/browse/AMQ-6077 - define default values (based on system property) for connection factory and object message\n\n(cherry picked from commit eeec0c07b06e6121ed33e20f7c663214538d0da1)",
        "before_after_code_files": [
          "activemq-camel/src/test/java/org/apache/activemq/camel/ObjectMessageTest.java||activemq-camel/src/test/java/org/apache/activemq/camel/ObjectMessageTest.java",
          "activemq-client/src/main/java/org/apache/activemq/ActiveMQConnectionFactory.java||activemq-client/src/main/java/org/apache/activemq/ActiveMQConnectionFactory.java",
          "activemq-client/src/main/java/org/apache/activemq/command/ActiveMQObjectMessage.java||activemq-client/src/main/java/org/apache/activemq/command/ActiveMQObjectMessage.java",
          "activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java||activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java||activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java"
          ],
          "candidate": [
            "activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java||activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java"
          ]
        }
      },
      "candidate_diff": {
        "activemq-camel/src/test/java/org/apache/activemq/camel/ObjectMessageTest.java||activemq-camel/src/test/java/org/apache/activemq/camel/ObjectMessageTest.java": [
          "File: activemq-camel/src/test/java/org/apache/activemq/camel/ObjectMessageTest.java -> activemq-camel/src/test/java/org/apache/activemq/camel/ObjectMessageTest.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "58:         assertCorrectObjectReceived(resultTrusted);",
          "60:         MockEndpoint resultCamel = resolveMandatoryEndpoint(\"mock:result-camel\", MockEndpoint.class);",
          "64:     }",
          "",
          "[Removed Lines]",
          "61:         resultCamel.expectedMessageCount(0);",
          "62:         resultCamel.assertIsSatisfied(1, TimeUnit.SECONDS);",
          "",
          "[Added Lines]",
          "61:         resultCamel.expectedMessageCount(1);",
          "62:         resultCamel.assertIsNotSatisfied();",
          "64:         MockEndpoint resultEmpty = resolveMandatoryEndpoint(\"mock:result-empty\", MockEndpoint.class);",
          "65:         resultEmpty.expectedMessageCount(1);",
          "66:         resultEmpty.assertIsNotSatisfied();",
          "",
          "---------------"
        ],
        "activemq-client/src/main/java/org/apache/activemq/ActiveMQConnectionFactory.java||activemq-client/src/main/java/org/apache/activemq/ActiveMQConnectionFactory.java": [
          "File: activemq-client/src/main/java/org/apache/activemq/ActiveMQConnectionFactory.java -> activemq-client/src/main/java/org/apache/activemq/ActiveMQConnectionFactory.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "43: import org.apache.activemq.transport.Transport;",
          "44: import org.apache.activemq.transport.TransportFactory;",
          "45: import org.apache.activemq.transport.TransportListener;",
          "50: import org.apache.activemq.util.URISupport.CompositeData;",
          "51: import org.slf4j.Logger;",
          "52: import org.slf4j.LoggerFactory;",
          "",
          "[Removed Lines]",
          "46: import org.apache.activemq.util.IdGenerator;",
          "47: import org.apache.activemq.util.IntrospectionSupport;",
          "48: import org.apache.activemq.util.JMSExceptionSupport;",
          "49: import org.apache.activemq.util.URISupport;",
          "",
          "[Added Lines]",
          "46: import org.apache.activemq.util.*;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "180:     protected int xaAckMode = -1; // ensure default init before setting via brokerUrl introspection in sub class",
          "181:     private boolean rmIdFromConnectionId = false;",
          "182:     private boolean consumerExpiryCheckEnabled = true;",
          "184:     private boolean trustAllPackages = false;",
          "",
          "[Removed Lines]",
          "183:     private List<String> trustedPackages = new ArrayList<String>();",
          "",
          "[Added Lines]",
          "180:     private List<String> trustedPackages = Arrays.asList(ClassLoadingAwareObjectInputStream.serializablePackages);",
          "",
          "---------------"
        ],
        "activemq-client/src/main/java/org/apache/activemq/command/ActiveMQObjectMessage.java||activemq-client/src/main/java/org/apache/activemq/command/ActiveMQObjectMessage.java": [
          "File: activemq-client/src/main/java/org/apache/activemq/command/ActiveMQObjectMessage.java -> activemq-client/src/main/java/org/apache/activemq/command/ActiveMQObjectMessage.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "25: import java.io.OutputStream;",
          "26: import java.io.Serializable;",
          "27: import java.util.ArrayList;",
          "28: import java.util.List;",
          "29: import java.util.zip.DeflaterOutputStream;",
          "30: import java.util.zip.InflaterInputStream;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "28: import java.util.Arrays;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "70:     public static final byte DATA_STRUCTURE_TYPE = CommandTypes.ACTIVEMQ_OBJECT_MESSAGE;",
          "73:     private boolean trustAllPackages = false;",
          "75:     protected transient Serializable object;",
          "",
          "[Removed Lines]",
          "72:     private List<String> trustedPackages = new ArrayList<String>();",
          "",
          "[Added Lines]",
          "73:     private List<String> trustedPackages = Arrays.asList(ClassLoadingAwareObjectInputStream.serializablePackages);",
          "",
          "---------------"
        ],
        "activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java||activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java": [
          "File: activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java -> activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "109:                    }",
          "110:                }",
          "111:                if (!found) {",
          "113:                }",
          "114:             }",
          "115:         }",
          "",
          "[Removed Lines]",
          "112:                    throw new ClassNotFoundException(\"Forbidden \" + clazz + \"! This class is not allowed to be serialized. Add package with 'org.apache.activemq.SERIALIZABLE_PACKAGES' system property.\");",
          "",
          "[Added Lines]",
          "112:                    throw new ClassNotFoundException(\"Forbidden \" + clazz + \"! This class is not trusted to be serialized as ObjectMessage payload. Please take a look at http://activemq.apache.org/objectmessage.html for more information on how to configure trusted classes.\");",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "7eb9b218b2705cf9273e30ee2da026e43b6dd4e0",
      "candidate_info": {
        "commit_hash": "7eb9b218b2705cf9273e30ee2da026e43b6dd4e0",
        "repo": "apache/activemq",
        "commit_url": "https://github.com/apache/activemq/commit/7eb9b218b2705cf9273e30ee2da026e43b6dd4e",
        "files": [
          "activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java",
          "activemq-http/src/main/java/org/apache/activemq/transport/xstream/XStreamWireFormat.java",
          "activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/XStreamSupport.java",
          "activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/StompTestSupport.java"
        ],
        "message": "https://issues.apache.org/jira/browse/AMQ-6013 - init serializable packages statically",
        "before_after_code_files": [
          "activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java||activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java",
          "activemq-http/src/main/java/org/apache/activemq/transport/xstream/XStreamWireFormat.java||activemq-http/src/main/java/org/apache/activemq/transport/xstream/XStreamWireFormat.java",
          "activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/XStreamSupport.java||activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/XStreamSupport.java",
          "activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/StompTestSupport.java||activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/StompTestSupport.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java||activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java",
            "activemq-http/src/main/java/org/apache/activemq/transport/xstream/XStreamWireFormat.java||activemq-http/src/main/java/org/apache/activemq/transport/xstream/XStreamWireFormat.java",
            "activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/XStreamSupport.java||activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/XStreamSupport.java",
            "activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/StompTestSupport.java||activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/StompTestSupport.java"
          ],
          "candidate": [
            "activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java||activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java",
            "activemq-http/src/main/java/org/apache/activemq/transport/xstream/XStreamWireFormat.java||activemq-http/src/main/java/org/apache/activemq/transport/xstream/XStreamWireFormat.java",
            "activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/XStreamSupport.java||activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/XStreamSupport.java",
            "activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/StompTestSupport.java||activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/StompTestSupport.java"
          ]
        }
      },
      "candidate_diff": {
        "activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java||activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java": [
          "File: activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java -> activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "34:     private static final ClassLoader FALLBACK_CLASS_LOADER =",
          "35:         ClassLoadingAwareObjectInputStream.class.getClassLoader();",
          "39:     private final ClassLoader inLoader;",
          "41:     public ClassLoadingAwareObjectInputStream(InputStream in) throws IOException {",
          "42:         super(in);",
          "43:         inLoader = in.getClass().getClassLoader();",
          "",
          "[Removed Lines]",
          "37:     private static String[] serializablePackages;",
          "",
          "[Added Lines]",
          "37:     public static final String[] serializablePackages;",
          "41:     static {",
          "42:         serializablePackages = System.getProperty(\"org.apache.activemq.SERIALIZABLE_PACKAGES\",",
          "43:                     \"java.lang,java.util,org.apache.activemq,org.fusesource.hawtbuf,com.thoughtworks.xstream.mapper\").split(\",\");",
          "44:     }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "83:         }",
          "84:     }",
          "95:     public static boolean isAllAllowed() {",
          "97:     }",
          "99:     private void checkSecurity(Class clazz) throws ClassNotFoundException {",
          "100:         if (!clazz.isPrimitive()) {",
          "101:             if (clazz.getPackage() != null && !isAllAllowed()) {",
          "102:                boolean found = false;",
          "104:                    if (clazz.getPackage().getName().equals(packageName) || clazz.getPackage().getName().startsWith(packageName + \".\")) {",
          "105:                        found = true;",
          "106:                        break;",
          "",
          "[Removed Lines]",
          "86:     public static String[] getSerialziablePackages() {",
          "87:        if (serializablePackages == null) {",
          "88:            serializablePackages = System.getProperty(\"org.apache.activemq.SERIALIZABLE_PACKAGES\",",
          "89:                        \"java.lang,java.util,org.apache.activemq,org.fusesource.hawtbuf,com.thoughtworks.xstream.mapper\").split(\",\");",
          "90:        }",
          "92:        return serializablePackages;",
          "93:     };",
          "96:         return getSerialziablePackages().length == 1 && getSerialziablePackages()[0].equals(\"*\");",
          "103:                for (String packageName : getSerialziablePackages()) {",
          "",
          "[Added Lines]",
          "92:         return serializablePackages.length == 1 && serializablePackages[0].equals(\"*\");",
          "99:                for (String packageName : serializablePackages) {",
          "",
          "---------------"
        ],
        "activemq-http/src/main/java/org/apache/activemq/transport/xstream/XStreamWireFormat.java||activemq-http/src/main/java/org/apache/activemq/transport/xstream/XStreamWireFormat.java": [
          "File: activemq-http/src/main/java/org/apache/activemq/transport/xstream/XStreamWireFormat.java -> activemq-http/src/main/java/org/apache/activemq/transport/xstream/XStreamWireFormat.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "19: import java.io.IOException;",
          "20: import java.io.Reader;",
          "24: import com.thoughtworks.xstream.converters.Converter;",
          "25: import com.thoughtworks.xstream.converters.MarshallingContext;",
          "26: import com.thoughtworks.xstream.converters.UnmarshallingContext;",
          "27: import com.thoughtworks.xstream.io.HierarchicalStreamReader;",
          "28: import com.thoughtworks.xstream.io.HierarchicalStreamWriter;",
          "30: import org.apache.activemq.command.MarshallAware;",
          "31: import org.apache.activemq.command.MessageDispatch;",
          "32: import org.apache.activemq.transport.stomp.XStreamSupport;",
          "",
          "[Removed Lines]",
          "22: <<<<<<< HEAD",
          "23: =======",
          "29: >>>>>>> a7e2a44... https://issues.apache.org/jira/browse/AMQ-6013 - restrict classes which can be serialized inside the broker",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "102:     }",
          "106:         if (xStream == null) {",
          "107:             xStream = createXStream();",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "103:     public XStream getXStream() {",
          "",
          "---------------"
        ],
        "activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/XStreamSupport.java||activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/XStreamSupport.java": [
          "File: activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/XStreamSupport.java -> activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/XStreamSupport.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "37:         if (ClassLoadingAwareObjectInputStream.isAllAllowed()) {",
          "38:             stream.addPermission(AnyTypePermission.ANY);",
          "39:         } else {",
          "41:                 stream.allowTypesByWildcard(new String[]{packageName + \".**\"});",
          "42:             }",
          "43:         }",
          "",
          "[Removed Lines]",
          "40:             for (String packageName : ClassLoadingAwareObjectInputStream.getSerialziablePackages()) {",
          "",
          "[Added Lines]",
          "40:             for (String packageName : ClassLoadingAwareObjectInputStream.serializablePackages) {",
          "",
          "---------------"
        ],
        "activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/StompTestSupport.java||activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/StompTestSupport.java": [
          "File: activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/StompTestSupport.java -> activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/StompTestSupport.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "111:     }",
          "113:     public void startBroker() throws Exception {",
          "117:         XStreamBrokerContext context = new XStreamBrokerContext();",
          "118:         brokerService.setBrokerContext(context);",
          "",
          "[Removed Lines]",
          "114:         System.setProperty(\"org.apache.activemq.SERIALIZABLE_PACKAGES\", \"*\");",
          "115:         createBroker(true);",
          "",
          "[Added Lines]",
          "114:         createBroker();",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "82e12f0e5f02d68766446bfb91bac021a4596389",
      "candidate_info": {
        "commit_hash": "82e12f0e5f02d68766446bfb91bac021a4596389",
        "repo": "apache/activemq",
        "commit_url": "https://github.com/apache/activemq/commit/82e12f0e5f02d68766446bfb91bac021a4596389",
        "files": [
          "activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/StompTestSupport.java",
          "activemq-unit-tests/src/test/java/org/apache/activemq/transport/failover/FailoverTimeoutTest.java"
        ],
        "message": "Fix compile failure after back ports/cherry-picks",
        "before_after_code_files": [
          "activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/StompTestSupport.java||activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/StompTestSupport.java",
          "activemq-unit-tests/src/test/java/org/apache/activemq/transport/failover/FailoverTimeoutTest.java||activemq-unit-tests/src/test/java/org/apache/activemq/transport/failover/FailoverTimeoutTest.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/StompTestSupport.java||activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/StompTestSupport.java"
          ],
          "candidate": [
            "activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/StompTestSupport.java||activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/StompTestSupport.java"
          ]
        }
      },
      "candidate_diff": {
        "activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/StompTestSupport.java||activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/StompTestSupport.java": [
          "File: activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/StompTestSupport.java -> activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/StompTestSupport.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "111:     }",
          "113:     public void startBroker() throws Exception {",
          "116:         XStreamBrokerContext context = new XStreamBrokerContext();",
          "117:         brokerService.setBrokerContext(context);",
          "",
          "[Removed Lines]",
          "114:         createBroker();",
          "",
          "[Added Lines]",
          "114:         createBroker(true);",
          "",
          "---------------"
        ],
        "activemq-unit-tests/src/test/java/org/apache/activemq/transport/failover/FailoverTimeoutTest.java||activemq-unit-tests/src/test/java/org/apache/activemq/transport/failover/FailoverTimeoutTest.java": [
          "File: activemq-unit-tests/src/test/java/org/apache/activemq/transport/failover/FailoverTimeoutTest.java -> activemq-unit-tests/src/test/java/org/apache/activemq/transport/failover/FailoverTimeoutTest.java"
        ]
      }
    },
    {
      "candidate_hash": "7a262b74dbdec043bae4f0aa01a4fd3a6e10243d",
      "candidate_info": {
        "commit_hash": "7a262b74dbdec043bae4f0aa01a4fd3a6e10243d",
        "repo": "apache/activemq",
        "commit_url": "https://github.com/apache/activemq/commit/7a262b74dbdec043bae4f0aa01a4fd3a6e10243d",
        "files": [
          "activemq-client/src/main/java/org/apache/activemq/ActiveMQConnection.java",
          "activemq-client/src/main/java/org/apache/activemq/ActiveMQConnectionFactory.java",
          "activemq-client/src/main/java/org/apache/activemq/ActiveMQMessageConsumer.java",
          "activemq-client/src/main/java/org/apache/activemq/command/ActiveMQObjectMessage.java",
          "activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java"
        ],
        "message": "https://issues.apache.org/jira/browse/AMQ-6077 - define object message trusted packages on connection factory\n\n(cherry picked from commit 94446e53dc348b9109dff46e92484ed9e6cc1d72)\n(cherry picked from commit 5e02e305ea39314589329643c164be62d5b35592)",
        "before_after_code_files": [
          "activemq-client/src/main/java/org/apache/activemq/ActiveMQConnection.java||activemq-client/src/main/java/org/apache/activemq/ActiveMQConnection.java",
          "activemq-client/src/main/java/org/apache/activemq/ActiveMQConnectionFactory.java||activemq-client/src/main/java/org/apache/activemq/ActiveMQConnectionFactory.java",
          "activemq-client/src/main/java/org/apache/activemq/ActiveMQMessageConsumer.java||activemq-client/src/main/java/org/apache/activemq/ActiveMQMessageConsumer.java",
          "activemq-client/src/main/java/org/apache/activemq/command/ActiveMQObjectMessage.java||activemq-client/src/main/java/org/apache/activemq/command/ActiveMQObjectMessage.java",
          "activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java||activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java||activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java"
          ],
          "candidate": [
            "activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java||activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java"
          ]
        }
      },
      "candidate_diff": {
        "activemq-client/src/main/java/org/apache/activemq/ActiveMQConnection.java||activemq-client/src/main/java/org/apache/activemq/ActiveMQConnection.java": [
          "File: activemq-client/src/main/java/org/apache/activemq/ActiveMQConnection.java -> activemq-client/src/main/java/org/apache/activemq/ActiveMQConnection.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "19: import java.io.IOException;",
          "20: import java.net.URI;",
          "21: import java.net.URISyntaxException;",
          "25: import java.util.concurrent.ConcurrentHashMap;",
          "26: import java.util.concurrent.ConcurrentMap;",
          "27: import java.util.concurrent.CopyOnWriteArrayList;",
          "",
          "[Removed Lines]",
          "22: import java.util.HashMap;",
          "23: import java.util.Iterator;",
          "24: import java.util.Map;",
          "",
          "[Added Lines]",
          "22: import java.util.*;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "206:     private int maxThreadPoolSize = DEFAULT_THREAD_POOL_SIZE;",
          "207:     private RejectedExecutionHandler rejectedTaskHandler = null;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "207:     private List<String> trustedPackages = new ArrayList<String>();",
          "208:     private boolean trustAllPackages = false;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "2593:     public void setConsumerExpiryCheckEnabled(boolean consumerExpiryCheckEnabled) {",
          "2594:         this.consumerExpiryCheckEnabled = consumerExpiryCheckEnabled;",
          "2595:     }",
          "2596: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2598:     public List<String> getTrustedPackages() {",
          "2599:         return trustedPackages;",
          "2600:     }",
          "2602:     public void setTrustedPackages(List<String> trustedPackages) {",
          "2603:         this.trustedPackages = trustedPackages;",
          "2604:     }",
          "2606:     public boolean isTrustAllPackages() {",
          "2607:         return trustAllPackages;",
          "2608:     }",
          "2610:     public void setTrustAllPackages(boolean trustAllPackages) {",
          "2611:         this.trustAllPackages = trustAllPackages;",
          "2612:     }",
          "",
          "---------------"
        ],
        "activemq-client/src/main/java/org/apache/activemq/ActiveMQConnectionFactory.java||activemq-client/src/main/java/org/apache/activemq/ActiveMQConnectionFactory.java": [
          "File: activemq-client/src/main/java/org/apache/activemq/ActiveMQConnectionFactory.java -> activemq-client/src/main/java/org/apache/activemq/ActiveMQConnectionFactory.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "20: import java.net.URISyntaxException;",
          "21: import java.security.AccessController;",
          "22: import java.security.PrivilegedAction;",
          "26: import java.util.concurrent.RejectedExecutionHandler;",
          "28: import javax.jms.Connection;",
          "",
          "[Removed Lines]",
          "23: import java.util.HashMap;",
          "24: import java.util.Map;",
          "25: import java.util.Properties;",
          "",
          "[Added Lines]",
          "23: import java.util.*;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "182:     protected int xaAckMode = -1; // ensure default init before setting via brokerUrl introspection in sub class",
          "183:     private boolean rmIdFromConnectionId = false;",
          "184:     private boolean consumerExpiryCheckEnabled = true;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "183:     private List<String> trustedPackages = new ArrayList<String>();",
          "184:     private boolean trustAllPackages = false;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "406:         connection.setNestedMapAndListEnabled(isNestedMapAndListEnabled());",
          "407:         connection.setRmIdFromConnectionId(isRmIdFromConnectionId());",
          "408:         connection.setConsumerExpiryCheckEnabled(isConsumerExpiryCheckEnabled());",
          "409:         if (transportListener != null) {",
          "410:             connection.addTransportListener(transportListener);",
          "411:         }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "409:         connection.setTrustedPackages(getTrustedPackages());",
          "410:         connection.setTrustAllPackages(isTrustAllPackages());",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1244:     public void setConsumerExpiryCheckEnabled(boolean consumerExpiryCheckEnabled) {",
          "1245:         this.consumerExpiryCheckEnabled = consumerExpiryCheckEnabled;",
          "1246:     }",
          "1247: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1250:     public List<String> getTrustedPackages() {",
          "1251:         return trustedPackages;",
          "1252:     }",
          "1254:     public void setTrustedPackages(List<String> trustedPackages) {",
          "1255:         this.trustedPackages = trustedPackages;",
          "1256:     }",
          "1258:     public boolean isTrustAllPackages() {",
          "1259:         return trustAllPackages;",
          "1260:     }",
          "1262:     public void setTrustAllPackages(boolean trustAllPackages) {",
          "1263:         this.trustAllPackages = trustAllPackages;",
          "1264:     }",
          "",
          "---------------"
        ],
        "activemq-client/src/main/java/org/apache/activemq/ActiveMQMessageConsumer.java||activemq-client/src/main/java/org/apache/activemq/ActiveMQMessageConsumer.java": [
          "File: activemq-client/src/main/java/org/apache/activemq/ActiveMQMessageConsumer.java -> activemq-client/src/main/java/org/apache/activemq/ActiveMQMessageConsumer.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "40: import javax.jms.TransactionRolledBackException;",
          "42: import org.apache.activemq.blob.BlobDownloader;",
          "56: import org.apache.activemq.management.JMSConsumerStatsImpl;",
          "57: import org.apache.activemq.management.StatsCapable;",
          "58: import org.apache.activemq.management.StatsImpl;",
          "",
          "[Removed Lines]",
          "43: import org.apache.activemq.command.ActiveMQBlobMessage;",
          "44: import org.apache.activemq.command.ActiveMQDestination;",
          "45: import org.apache.activemq.command.ActiveMQMessage;",
          "46: import org.apache.activemq.command.ActiveMQTempDestination;",
          "47: import org.apache.activemq.command.CommandTypes;",
          "48: import org.apache.activemq.command.ConsumerId;",
          "49: import org.apache.activemq.command.ConsumerInfo;",
          "50: import org.apache.activemq.command.MessageAck;",
          "51: import org.apache.activemq.command.MessageDispatch;",
          "52: import org.apache.activemq.command.MessageId;",
          "53: import org.apache.activemq.command.MessagePull;",
          "54: import org.apache.activemq.command.RemoveInfo;",
          "55: import org.apache.activemq.command.TransactionId;",
          "",
          "[Added Lines]",
          "43: import org.apache.activemq.command.*;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "588:         if (m.getDataStructureType()==CommandTypes.ACTIVEMQ_BLOB_MESSAGE) {",
          "589:             ((ActiveMQBlobMessage)m).setBlobDownloader(new BlobDownloader(session.getBlobTransferPolicy()));",
          "590:         }",
          "591:         if (transformer != null) {",
          "592:             Message transformedMessage = transformer.consumerTransform(session, this, m);",
          "593:             if (transformedMessage != null) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "579:         if (m.getDataStructureType() == CommandTypes.ACTIVEMQ_OBJECT_MESSAGE) {",
          "580:             ((ActiveMQObjectMessage)m).setTrustAllPackages(session.getConnection().isTrustAllPackages());",
          "581:             ((ActiveMQObjectMessage)m).setTrustedPackages(session.getConnection().getTrustedPackages());",
          "582:         }",
          "",
          "---------------"
        ],
        "activemq-client/src/main/java/org/apache/activemq/command/ActiveMQObjectMessage.java||activemq-client/src/main/java/org/apache/activemq/command/ActiveMQObjectMessage.java": [
          "File: activemq-client/src/main/java/org/apache/activemq/command/ActiveMQObjectMessage.java -> activemq-client/src/main/java/org/apache/activemq/command/ActiveMQObjectMessage.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "24: import java.io.ObjectOutputStream;",
          "25: import java.io.OutputStream;",
          "26: import java.io.Serializable;",
          "27: import java.util.zip.DeflaterOutputStream;",
          "28: import java.util.zip.InflaterInputStream;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "27: import java.util.ArrayList;",
          "28: import java.util.List;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "66: public class ActiveMQObjectMessage extends ActiveMQMessage implements ObjectMessage {",
          "69:     public static final byte DATA_STRUCTURE_TYPE = CommandTypes.ACTIVEMQ_OBJECT_MESSAGE;",
          "72:     protected transient Serializable object;",
          "74:     public Message copy() {",
          "75:         ActiveMQObjectMessage copy = new ActiveMQObjectMessage();",
          "76:         copy(copy);",
          "77:         return copy;",
          "78:     }",
          "",
          "[Removed Lines]",
          "70:     static final ClassLoader ACTIVEMQ_CLASSLOADER = ActiveMQObjectMessage.class.getClassLoader();",
          "",
          "[Added Lines]",
          "72:     private List<String> trustedPackages = new ArrayList<String>();",
          "73:     private boolean trustAllPackages = false;",
          "80:         copy.setTrustAllPackages(trustAllPackages);",
          "81:         copy.setTrustedPackages(trustedPackages);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "187:                 }",
          "188:                 DataInputStream dataIn = new DataInputStream(is);",
          "189:                 ClassLoadingAwareObjectInputStream objIn = new ClassLoadingAwareObjectInputStream(dataIn);",
          "190:                 try {",
          "191:                     object = (Serializable)objIn.readObject();",
          "192:                 } catch (ClassNotFoundException ce) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "195:                 objIn.setTrustedPackages(trustedPackages);",
          "196:                 objIn.setTrustAllPackages(trustAllPackages);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "234:         }",
          "235:         return super.toString();",
          "236:     }",
          "237: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "245:     public List<String> getTrustedPackages() {",
          "246:         return trustedPackages;",
          "247:     }",
          "249:     public void setTrustedPackages(List<String> trustedPackages) {",
          "250:         this.trustedPackages = trustedPackages;",
          "251:     }",
          "253:     public boolean isTrustAllPackages() {",
          "254:         return trustAllPackages;",
          "255:     }",
          "257:     public void setTrustAllPackages(boolean trustAllPackages) {",
          "258:         this.trustAllPackages = trustAllPackages;",
          "259:     }",
          "",
          "---------------"
        ],
        "activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java||activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java": [
          "File: activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java -> activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "21: import java.io.ObjectInputStream;",
          "22: import java.io.ObjectStreamClass;",
          "23: import java.lang.reflect.Proxy;",
          "28: import org.slf4j.Logger;",
          "29: import org.slf4j.LoggerFactory;",
          "",
          "[Removed Lines]",
          "24: import java.util.Arrays;",
          "25: import java.util.Collection;",
          "26: import java.util.Map;",
          "",
          "[Added Lines]",
          "24: import java.util.*;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "37:     public static final String[] serializablePackages;",
          "39:     private final ClassLoader inLoader;",
          "41:     static {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "37:     private List<String> trustedPackages = new ArrayList<String>();",
          "38:     private boolean trustAllPackages = false;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "46:     public ClassLoadingAwareObjectInputStream(InputStream in) throws IOException {",
          "47:         super(in);",
          "48:         inLoader = in.getClass().getClassLoader();",
          "49:     }",
          "51:     @Override",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "50:         trustedPackages.addAll(Arrays.asList(serializablePackages));",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "92:         return serializablePackages.length == 1 && serializablePackages[0].equals(\"*\");",
          "93:     }",
          "95:     private void checkSecurity(Class clazz) throws ClassNotFoundException {",
          "96:         if (!clazz.isPrimitive()) {",
          "98:                boolean found = false;",
          "100:                    if (clazz.getPackage().getName().equals(packageName) || clazz.getPackage().getName().startsWith(packageName + \".\")) {",
          "101:                        found = true;",
          "102:                        break;",
          "103:                    }",
          "104:                }",
          "106:                if (!found) {",
          "107:                    throw new ClassNotFoundException(\"Forbidden \" + clazz + \"! This class is not allowed to be serialized. Add package with 'org.apache.activemq.SERIALIZABLE_PACKAGES' system property.\");",
          "108:                }",
          "",
          "[Removed Lines]",
          "97:             if (clazz.getPackage() != null && !isAllAllowed()) {",
          "99:                for (String packageName : serializablePackages) {",
          "",
          "[Added Lines]",
          "97:     private boolean trustAllPackages() {",
          "98:         return trustAllPackages || (trustedPackages.size() == 1 && trustedPackages.get(0).equals(\"*\"));",
          "99:     }",
          "103:             if (clazz.getPackage() != null && !trustAllPackages()) {",
          "105:                for (String packageName : getTrustedPackages()) {",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "193:         return null;",
          "194:     }",
          "196: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "201:     public List<String> getTrustedPackages() {",
          "202:         return trustedPackages;",
          "203:     }",
          "205:     public void setTrustedPackages(List<String> trustedPackages) {",
          "206:         this.trustedPackages = trustedPackages;",
          "207:     }",
          "209:     public void addTrustedPackage(String trustedPackage) {",
          "210:         this.trustedPackages.add(trustedPackage);",
          "211:     }",
          "213:     public boolean isTrustAllPackages() {",
          "214:         return trustAllPackages;",
          "215:     }",
          "217:     public void setTrustAllPackages(boolean trustAllPackages) {",
          "218:         this.trustAllPackages = trustAllPackages;",
          "219:     }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "a7e2a44fe8d4435ae99532eb0ab852e6247f7b16",
      "candidate_info": {
        "commit_hash": "a7e2a44fe8d4435ae99532eb0ab852e6247f7b16",
        "repo": "apache/activemq",
        "commit_url": "https://github.com/apache/activemq/commit/a7e2a44fe8d4435ae99532eb0ab852e6247f7b16",
        "files": [
          "activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java",
          "activemq-http/src/main/java/org/apache/activemq/transport/xstream/XStreamWireFormat.java",
          "activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/JmsFrameTranslator.java",
          "activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/XStreamSupport.java",
          "activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/StompTestSupport.java",
          "activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/util/XStreamBrokerContext.java",
          "activemq-web/src/main/java/org/apache/activemq/web/MessageQuery.java"
        ],
        "message": "https://issues.apache.org/jira/browse/AMQ-6013 - restrict classes which can be serialized inside the broker",
        "before_after_code_files": [
          "activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java||activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java",
          "activemq-http/src/main/java/org/apache/activemq/transport/xstream/XStreamWireFormat.java||activemq-http/src/main/java/org/apache/activemq/transport/xstream/XStreamWireFormat.java",
          "activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/JmsFrameTranslator.java||activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/JmsFrameTranslator.java",
          "activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/XStreamSupport.java||activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/XStreamSupport.java",
          "activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/StompTestSupport.java||activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/StompTestSupport.java",
          "activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/util/XStreamBrokerContext.java||activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/util/XStreamBrokerContext.java",
          "activemq-web/src/main/java/org/apache/activemq/web/MessageQuery.java||activemq-web/src/main/java/org/apache/activemq/web/MessageQuery.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java||activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java",
            "activemq-http/src/main/java/org/apache/activemq/transport/xstream/XStreamWireFormat.java||activemq-http/src/main/java/org/apache/activemq/transport/xstream/XStreamWireFormat.java",
            "activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/JmsFrameTranslator.java||activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/JmsFrameTranslator.java",
            "activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/XStreamSupport.java||activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/XStreamSupport.java",
            "activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/StompTestSupport.java||activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/StompTestSupport.java",
            "activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/util/XStreamBrokerContext.java||activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/util/XStreamBrokerContext.java",
            "activemq-web/src/main/java/org/apache/activemq/web/MessageQuery.java||activemq-web/src/main/java/org/apache/activemq/web/MessageQuery.java"
          ],
          "candidate": [
            "activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java||activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java",
            "activemq-http/src/main/java/org/apache/activemq/transport/xstream/XStreamWireFormat.java||activemq-http/src/main/java/org/apache/activemq/transport/xstream/XStreamWireFormat.java",
            "activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/JmsFrameTranslator.java||activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/JmsFrameTranslator.java",
            "activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/XStreamSupport.java||activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/XStreamSupport.java",
            "activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/StompTestSupport.java||activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/StompTestSupport.java",
            "activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/util/XStreamBrokerContext.java||activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/util/XStreamBrokerContext.java",
            "activemq-web/src/main/java/org/apache/activemq/web/MessageQuery.java||activemq-web/src/main/java/org/apache/activemq/web/MessageQuery.java"
          ]
        }
      },
      "candidate_diff": {
        "activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java||activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java": [
          "File: activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java -> activemq-client/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "21: import java.io.ObjectInputStream;",
          "22: import java.io.ObjectStreamClass;",
          "23: import java.lang.reflect.Proxy;",
          "25: import org.slf4j.Logger;",
          "26: import org.slf4j.LoggerFactory;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "24: import java.util.Arrays;",
          "25: import java.util.Collection;",
          "26: import java.util.Map;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "31:     private static final ClassLoader FALLBACK_CLASS_LOADER =",
          "32:         ClassLoadingAwareObjectInputStream.class.getClassLoader();",
          "34:     private final ClassLoader inLoader;",
          "36:     public ClassLoadingAwareObjectInputStream(InputStream in) throws IOException {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "37:     private static String[] serializablePackages;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "41:     @Override",
          "42:     protected Class<?> resolveClass(ObjectStreamClass classDesc) throws IOException, ClassNotFoundException {",
          "43:         ClassLoader cl = Thread.currentThread().getContextClassLoader();",
          "45:     }",
          "47:     @Override",
          "",
          "[Removed Lines]",
          "44:         return load(classDesc.getName(), cl, inLoader);",
          "",
          "[Added Lines]",
          "49:         Class clazz = load(classDesc.getName(), cl, inLoader);",
          "50:         checkSecurity(clazz);",
          "51:         return clazz;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "52:             cinterfaces[i] = load(interfaces[i], cl);",
          "53:         }",
          "55:         try {",
          "57:         } catch (IllegalArgumentException e) {",
          "58:             try {",
          "60:             } catch (IllegalArgumentException e1) {",
          "62:             }",
          "63:             try {",
          "65:             } catch (IllegalArgumentException e2) {",
          "67:             }",
          "70:         }",
          "71:     }",
          "",
          "[Removed Lines]",
          "56:             return Proxy.getProxyClass(cl, cinterfaces);",
          "59:                 return Proxy.getProxyClass(inLoader, cinterfaces);",
          "64:                 return Proxy.getProxyClass(FALLBACK_CLASS_LOADER, cinterfaces);",
          "69:             throw new ClassNotFoundException(null, e);",
          "",
          "[Added Lines]",
          "62:         Class clazz = null;",
          "64:             clazz = Proxy.getProxyClass(cl, cinterfaces);",
          "67:                 clazz = Proxy.getProxyClass(inLoader, cinterfaces);",
          "72:                 clazz = Proxy.getProxyClass(FALLBACK_CLASS_LOADER, cinterfaces);",
          "76:         }",
          "78:         if (clazz != null) {",
          "79:             checkSecurity(clazz);",
          "80:             return clazz;",
          "81:         } else {",
          "82:             throw new ClassNotFoundException(null);",
          "83:         }",
          "84:     }",
          "86:     public static String[] getSerialziablePackages() {",
          "87:        if (serializablePackages == null) {",
          "88:            serializablePackages = System.getProperty(\"org.apache.activemq.SERIALIZABLE_PACKAGES\",",
          "89:                        \"java.lang,java.util,org.apache.activemq,org.fusesource.hawtbuf,com.thoughtworks.xstream.mapper\").split(\",\");",
          "90:        }",
          "92:        return serializablePackages;",
          "93:     };",
          "95:     public static boolean isAllAllowed() {",
          "96:         return getSerialziablePackages().length == 1 && getSerialziablePackages()[0].equals(\"*\");",
          "97:     }",
          "99:     private void checkSecurity(Class clazz) throws ClassNotFoundException {",
          "100:         if (!clazz.isPrimitive()) {",
          "101:             if (clazz.getPackage() != null && !isAllAllowed()) {",
          "102:                boolean found = false;",
          "103:                for (String packageName : getSerialziablePackages()) {",
          "104:                    if (clazz.getPackage().getName().equals(packageName) || clazz.getPackage().getName().startsWith(packageName + \".\")) {",
          "105:                        found = true;",
          "106:                        break;",
          "107:                    }",
          "108:                }",
          "110:                if (!found) {",
          "111:                    throw new ClassNotFoundException(\"Forbidden \" + clazz + \"! This class is not allowed to be serialized. Add package with 'org.apache.activemq.SERIALIZABLE_PACKAGES' system property.\");",
          "112:                }",
          "113:             }",
          "",
          "---------------"
        ],
        "activemq-http/src/main/java/org/apache/activemq/transport/xstream/XStreamWireFormat.java||activemq-http/src/main/java/org/apache/activemq/transport/xstream/XStreamWireFormat.java": [
          "File: activemq-http/src/main/java/org/apache/activemq/transport/xstream/XStreamWireFormat.java -> activemq-http/src/main/java/org/apache/activemq/transport/xstream/XStreamWireFormat.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "20: import java.io.Reader;",
          "22: import com.thoughtworks.xstream.converters.Converter;",
          "24: import com.thoughtworks.xstream.converters.MarshallingContext;",
          "25: import com.thoughtworks.xstream.converters.UnmarshallingContext;",
          "26: import com.thoughtworks.xstream.io.HierarchicalStreamReader;",
          "27: import com.thoughtworks.xstream.io.HierarchicalStreamWriter;",
          "28: import org.apache.activemq.command.MarshallAware;",
          "29: import org.apache.activemq.command.MessageDispatch;",
          "30: import org.apache.activemq.transport.util.TextWireFormat;",
          "31: import org.apache.activemq.util.ByteSequence;",
          "32: import org.apache.activemq.wireformat.WireFormat;",
          "",
          "[Removed Lines]",
          "23: import com.thoughtworks.xstream.converters.ConverterLookup;",
          "",
          "[Added Lines]",
          "29: import org.apache.activemq.transport.stomp.XStreamSupport;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "119:     protected XStream createXStream() {",
          "121:         xstream.ignoreUnknownElements();",
          "122:         xstream.registerConverter(new Converter() {",
          "123:             final Converter delegate = xstream.getConverterLookup().lookupConverterForType(ByteSequence.class);",
          "",
          "[Removed Lines]",
          "120:         final XStream xstream = new XStream();",
          "",
          "[Added Lines]",
          "120:         final XStream xstream = XStreamSupport.createXStream();",
          "",
          "---------------"
        ],
        "activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/JmsFrameTranslator.java||activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/JmsFrameTranslator.java": [
          "File: activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/JmsFrameTranslator.java -> activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/JmsFrameTranslator.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "91:                         msg = createMapMessage(in);",
          "92:                         break;",
          "93:                     default:",
          "95:                 }",
          "96:             } catch (Throwable e) {",
          "97:                 command.getHeaders().put(Headers.TRANSFORMATION_ERROR, e.getMessage());",
          "",
          "[Removed Lines]",
          "94:                         throw new Exception(\"Unkown transformation: \" + transformation);",
          "",
          "[Added Lines]",
          "94:                         throw new Exception(\"Unknown transformation: \" + transformation);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "254:         }",
          "256:         if (xstream == null) {",
          "258:             xstream.ignoreUnknownElements();",
          "259:         }",
          "",
          "[Removed Lines]",
          "257:             xstream = new XStream();",
          "",
          "[Added Lines]",
          "257:             xstream = XStreamSupport.createXStream();",
          "",
          "---------------"
        ],
        "activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/XStreamSupport.java||activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/XStreamSupport.java": [
          "File: activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/XStreamSupport.java -> activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/XStreamSupport.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "17: package org.apache.activemq.transport.stomp;",
          "19: import com.thoughtworks.xstream.XStream;",
          "20: import com.thoughtworks.xstream.security.AnyTypePermission;",
          "21: import com.thoughtworks.xstream.security.NoTypePermission;",
          "22: import com.thoughtworks.xstream.security.PrimitiveTypePermission;",
          "23: import org.apache.activemq.util.ClassLoadingAwareObjectInputStream;",
          "25: import java.util.Collection;",
          "26: import java.util.Map;",
          "28: public class XStreamSupport {",
          "30:     public static XStream createXStream() {",
          "31:         XStream stream = new XStream();",
          "32:         stream.addPermission(NoTypePermission.NONE);",
          "33:         stream.addPermission(PrimitiveTypePermission.PRIMITIVES);",
          "34:         stream.allowTypeHierarchy(Collection.class);",
          "35:         stream.allowTypeHierarchy(Map.class);",
          "36:         stream.allowTypes(new Class[]{String.class});",
          "37:         if (ClassLoadingAwareObjectInputStream.isAllAllowed()) {",
          "38:             stream.addPermission(AnyTypePermission.ANY);",
          "39:         } else {",
          "40:             for (String packageName : ClassLoadingAwareObjectInputStream.getSerialziablePackages()) {",
          "41:                 stream.allowTypesByWildcard(new String[]{packageName + \".**\"});",
          "42:             }",
          "43:         }",
          "44:         return stream;",
          "45:     }",
          "47: }",
          "",
          "---------------"
        ],
        "activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/StompTestSupport.java||activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/StompTestSupport.java": [
          "File: activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/StompTestSupport.java -> activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/StompTestSupport.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "119:     }",
          "121:     public void startBroker() throws Exception {",
          "123:         createBroker(true);",
          "125:         XStreamBrokerContext context = new XStreamBrokerContext();",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "122:         System.setProperty(\"org.apache.activemq.SERIALIZABLE_PACKAGES\", \"*\");",
          "",
          "---------------"
        ],
        "activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/util/XStreamBrokerContext.java||activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/util/XStreamBrokerContext.java": [
          "File: activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/util/XStreamBrokerContext.java -> activemq-stomp/src/test/java/org/apache/activemq/transport/stomp/util/XStreamBrokerContext.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "23: import org.apache.activemq.transport.stomp.SamplePojo;",
          "25: import com.thoughtworks.xstream.XStream;",
          "27: public class XStreamBrokerContext implements BrokerContext {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "26: import org.apache.activemq.transport.stomp.XStreamSupport;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "31:     public XStreamBrokerContext() {",
          "34:         stream.processAnnotations(SamplePojo.class);",
          "36:         beansMap.put(\"xstream\", stream);",
          "",
          "[Removed Lines]",
          "33:         XStream stream = new XStream();",
          "",
          "[Added Lines]",
          "34:         XStream stream = XStreamSupport.createXStream();",
          "",
          "---------------"
        ],
        "activemq-web/src/main/java/org/apache/activemq/web/MessageQuery.java||activemq-web/src/main/java/org/apache/activemq/web/MessageQuery.java": [
          "File: activemq-web/src/main/java/org/apache/activemq/web/MessageQuery.java -> activemq-web/src/main/java/org/apache/activemq/web/MessageQuery.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "81:         if (message instanceof ObjectMessage) {",
          "82:             try {",
          "83:                 return ((ObjectMessage) message).getObject();",
          "87:             }",
          "88:         }",
          "89:         if (message instanceof MapMessage) {",
          "",
          "[Removed Lines]",
          "84:             } catch (JMSException e) {",
          "86:                 return e;",
          "",
          "[Added Lines]",
          "84:             } catch (Exception e) {",
          "86:                 return new String(\"Cannot display ObjectMessage body. Reason: \" + e.getMessage());",
          "",
          "---------------"
        ]
      }
    }
  ]
}