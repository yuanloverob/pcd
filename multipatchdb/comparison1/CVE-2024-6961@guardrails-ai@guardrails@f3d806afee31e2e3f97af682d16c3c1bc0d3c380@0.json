{
  "cve_id": "CVE-2024-6961",
  "cve_desc": "RAIL documents are an XML-based format invented by Guardrails AI to enforce formatting checks on LLM outputs. Guardrails users that consume RAIL documents from external sources are vulnerable to XXE, which may cause leakage of internal file data via the SYSTEM entity.",
  "repo": "guardrails-ai/guardrails",
  "patch_hash": "f3d806afee31e2e3f97af682d16c3c1bc0d3c380",
  "patch_info": {
    "commit_hash": "f3d806afee31e2e3f97af682d16c3c1bc0d3c380",
    "repo": "guardrails-ai/guardrails",
    "commit_url": "https://github.com/guardrails-ai/guardrails/commit/f3d806afee31e2e3f97af682d16c3c1bc0d3c380",
    "files": [
      "guardrails/classes/templating/constants_container.py",
      "guardrails/schema/rail_schema.py"
    ],
    "message": "Merge pull request #922 from guardrails-ai/rail-xxe-fix\n\nRail XXE Fix",
    "before_after_code_files": [
      "guardrails/classes/templating/constants_container.py||guardrails/classes/templating/constants_container.py",
      "guardrails/schema/rail_schema.py||guardrails/schema/rail_schema.py"
    ]
  },
  "patch_diff": {
    "guardrails/classes/templating/constants_container.py||guardrails/classes/templating/constants_container.py": [
      "File: guardrails/classes/templating/constants_container.py -> guardrails/classes/templating/constants_container.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "17:         with open(constants_file, \"r\") as f:",
      "18:             xml = f.read()",
      "21:         parsed_constants = ET.fromstring(xml, parser=parser)",
      "23:         for child in parsed_constants:",
      "",
      "[Removed Lines]",
      "20:         parser = ET.XMLParser(encoding=\"utf-8\")",
      "",
      "[Added Lines]",
      "20:         parser = ET.XMLParser(encoding=\"utf-8\", resolve_entities=False)",
      "",
      "---------------"
    ],
    "guardrails/schema/rail_schema.py||guardrails/schema/rail_schema.py": [
      "File: guardrails/schema/rail_schema.py -> guardrails/schema/rail_schema.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "350:         validators=[], validator_map={}, exec_opts=GuardExecutionOptions()",
      "351:     )",
      "354:     rail_xml: _Element = ET.fromstring(rail_string, parser=XMLPARSER)",
      "356:     # Load <output /> schema",
      "",
      "[Removed Lines]",
      "353:     XMLPARSER = XMLParser(encoding=\"utf-8\")",
      "",
      "[Added Lines]",
      "353:     XMLPARSER = XMLParser(encoding=\"utf-8\", resolve_entities=False)",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "0b42190e78b460e69e38bdd70aaebded414b1b32",
      "candidate_info": {
        "commit_hash": "0b42190e78b460e69e38bdd70aaebded414b1b32",
        "repo": "guardrails-ai/guardrails",
        "commit_url": "https://github.com/guardrails-ai/guardrails/commit/0b42190e78b460e69e38bdd70aaebded414b1b32",
        "files": [
          "guardrails/classes/templating/constants_container.py",
          "guardrails/schema/rail_schema.py"
        ],
        "message": "0.5.0 re-impl of #921",
        "before_after_code_files": [
          "guardrails/classes/templating/constants_container.py||guardrails/classes/templating/constants_container.py",
          "guardrails/schema/rail_schema.py||guardrails/schema/rail_schema.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/guardrails-ai/guardrails/pull/922"
        ],
        "olp_code_files": {
          "patch": [
            "guardrails/classes/templating/constants_container.py||guardrails/classes/templating/constants_container.py",
            "guardrails/schema/rail_schema.py||guardrails/schema/rail_schema.py"
          ],
          "candidate": [
            "guardrails/classes/templating/constants_container.py||guardrails/classes/templating/constants_container.py",
            "guardrails/schema/rail_schema.py||guardrails/schema/rail_schema.py"
          ]
        }
      },
      "candidate_diff": {
        "guardrails/classes/templating/constants_container.py||guardrails/classes/templating/constants_container.py": [
          "File: guardrails/classes/templating/constants_container.py -> guardrails/classes/templating/constants_container.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "17:         with open(constants_file, \"r\") as f:",
          "18:             xml = f.read()",
          "21:         parsed_constants = ET.fromstring(xml, parser=parser)",
          "23:         for child in parsed_constants:",
          "",
          "[Removed Lines]",
          "20:         parser = ET.XMLParser(encoding=\"utf-8\")",
          "",
          "[Added Lines]",
          "20:         parser = ET.XMLParser(encoding=\"utf-8\", resolve_entities=False)",
          "",
          "---------------"
        ],
        "guardrails/schema/rail_schema.py||guardrails/schema/rail_schema.py": [
          "File: guardrails/schema/rail_schema.py -> guardrails/schema/rail_schema.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "350:         validators=[], validator_map={}, exec_opts=GuardExecutionOptions()",
          "351:     )",
          "354:     rail_xml: _Element = ET.fromstring(rail_string, parser=XMLPARSER)",
          "356:     # Load <output /> schema",
          "",
          "[Removed Lines]",
          "353:     XMLPARSER = XMLParser(encoding=\"utf-8\")",
          "",
          "[Added Lines]",
          "353:     XMLPARSER = XMLParser(encoding=\"utf-8\", resolve_entities=False)",
          "",
          "---------------"
        ]
      }
    }
  ]
}