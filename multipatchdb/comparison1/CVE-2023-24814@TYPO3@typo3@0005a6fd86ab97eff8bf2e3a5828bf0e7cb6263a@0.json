{
  "cve_id": "CVE-2023-24814",
  "cve_desc": "TYPO3 is a free and open source Content Management Framework released under the GNU General Public License. In affected versions the TYPO3 core component `GeneralUtility::getIndpEnv()` uses the unfiltered server environment variable `PATH_INFO`, which allows attackers to inject malicious content. In combination with the TypoScript setting `config.absRefPrefix=auto`, attackers can inject malicious HTML code to pages that have not been rendered and cached, yet. As a result, injected values would be cached and delivered to other website visitors (persisted cross-site scripting). Individual code which relies on the resolved value of `GeneralUtility::getIndpEnv('SCRIPT_NAME')` and corresponding usages (as shown below) are vulnerable as well. Additional investigations confirmed that at least Apache web server deployments using CGI (FPM, FCGI/FastCGI, and similar) are affected. However, there still might be the risk that other scenarios like nginx, IIS, or Apache/mod_php are vulnerable. The usage of server environment variable `PATH_INFO` has been removed from corresponding processings in `GeneralUtility::getIndpEnv()`. Besides that, the public property `TypoScriptFrontendController::$absRefPrefix` is encoded for both being used as a URI component and for being used as a prefix in an HTML context. This mitigates the cross-site scripting vulnerability. Users are advised to update to TYPO3 versions 8.7.51 ELTS, 9.5.40 ELTS, 10.4.35 LTS, 11.5.23 LTS and 12.2.0 which fix this problem. For users who are unable to patch in a timely manner the TypoScript setting `config.absRefPrefix` should at least be set to a static path value, instead of using auto - e.g. `config.absRefPrefix=/`. This workaround **does not fix all aspects of the vulnerability**, and is just considered to be an intermediate mitigation to the most prominent manifestation.",
  "repo": "TYPO3/typo3",
  "patch_hash": "0005a6fd86ab97eff8bf2e3a5828bf0e7cb6263a",
  "patch_info": {
    "commit_hash": "0005a6fd86ab97eff8bf2e3a5828bf0e7cb6263a",
    "repo": "TYPO3/typo3",
    "commit_url": "https://github.com/TYPO3/typo3/commit/0005a6fd86ab97eff8bf2e3a5828bf0e7cb6263a",
    "files": [
      "typo3/sysext/core/Classes/Core/SystemEnvironmentBuilder.php",
      "typo3/sysext/core/Classes/Http/NormalizedParams.php",
      "typo3/sysext/core/Classes/Utility/GeneralUtility.php",
      "typo3/sysext/core/Tests/Acceptance/Support/Extension/ApplicationEnvironment.php",
      "typo3/sysext/core/Tests/Unit/Http/NormalizedParamsTest.php",
      "typo3/sysext/core/Tests/Unit/Log/Processor/WebProcessorTest.php",
      "typo3/sysext/felogin/Tests/Unit/Validation/RedirectUrlValidatorTest.php",
      "typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php"
    ],
    "message": "[SECURITY] Prevent XSS due to wrong PATH_INFO evaluation\n\nAs already started in #88304 (but only for NormalizedParams)\nand later reverted in #89312 (because of cgi-bin problems),\nPATH_INFO is no longer considered as a preferable SCRIPT_NAME\nalternative. All known server configurations set SCRIPT_NAME\nthese days to a proper value when cgi.fix_pathinfo is set.\n\nThe fallback to PATH_INFO has been introduced with\nthe initial revision of TYPO3 and isn't needed at all nowadays,\nit's actually wrong, as a REQUEST_URI like /index.php/foo/bar\nwould incorrectly be interpreted as $scriptName == \"/foo/bar\",\nwhich let's all calculations on $scriptName fail and\neven leads to XSS where values derived from $scriptName are\nprinted without being escaped.\n\nAlso any ORIG_SCRIPT_NAME evaluation is dropped, as this variable\ncontains the SCRIPT_NAME that was set by the webserver configuration\nbefore PHP applied cgi.fix_pathinfo. Using ORIG_SCRIPT_NAME\neffectively meant bypassing PHP's pathinfo fix. It usually contains\nthe cgi-wrapper paths, which is why PATH_INFO was used to overrule\nwrong ORIG_SCRIPT_NAME values.\n\nGeneralUtility::getIndpEnv('PATH_INFO') is adapted to trust the\nservers PATH_INFO information, now that we no longer allow\nservers to send SCRIPT_NAME as PATH_INFO (we enforce\ncgi.fix_pathinfo=1 for CGI installations).\n\nThe normalized SCRIPT_NAME is now adapted to be encoded as a URL\npath by default, as all TYPO3 usages expect this to be an URL path.\nNote that $_SERVER['SCRIPT_NAME'] refers to the servers file\nsystem path, not the URL encoded value.\n\nThis SCRIPT_NAME sanitization actually enables:\n\na) TYPO3 to be run in a subfolder that contains characters\nthat need URL encoding\ne.g. `/test:site/` \u2013 url encoded that'd be `/test3Asite/`.\n\nb) prevention of XSS in case third party extensions\nmissed to escape any URL that is derived from SCRIPT_NAME\n(while making sure that properly escaped\noutput is not double escaped)\n\nResolves: #99651\nRelated: #88304\nRelated: #89312\nReleases: main, 11.5, 10.4\nChange-Id: Ief95253d764665db5182a15ce8ffd02ea02ee61e\nSecurity-Bulletin: TYPO3-CORE-SA-2023-001\nSecurity-References: CVE-2023-24814\nReviewed-on: https://review.typo3.org/c/Packages/TYPO3.CMS/+/77739\nTested-by: Oliver Hader <oliver.hader@typo3.org>\nReviewed-by: Oliver Hader <oliver.hader@typo3.org>",
    "before_after_code_files": [
      "typo3/sysext/core/Classes/Core/SystemEnvironmentBuilder.php||typo3/sysext/core/Classes/Core/SystemEnvironmentBuilder.php",
      "typo3/sysext/core/Classes/Http/NormalizedParams.php||typo3/sysext/core/Classes/Http/NormalizedParams.php",
      "typo3/sysext/core/Classes/Utility/GeneralUtility.php||typo3/sysext/core/Classes/Utility/GeneralUtility.php",
      "typo3/sysext/core/Tests/Acceptance/Support/Extension/ApplicationEnvironment.php||typo3/sysext/core/Tests/Acceptance/Support/Extension/ApplicationEnvironment.php",
      "typo3/sysext/core/Tests/Unit/Http/NormalizedParamsTest.php||typo3/sysext/core/Tests/Unit/Http/NormalizedParamsTest.php",
      "typo3/sysext/core/Tests/Unit/Log/Processor/WebProcessorTest.php||typo3/sysext/core/Tests/Unit/Log/Processor/WebProcessorTest.php",
      "typo3/sysext/felogin/Tests/Unit/Validation/RedirectUrlValidatorTest.php||typo3/sysext/felogin/Tests/Unit/Validation/RedirectUrlValidatorTest.php",
      "typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php||typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php"
    ]
  },
  "patch_diff": {
    "typo3/sysext/core/Classes/Core/SystemEnvironmentBuilder.php||typo3/sysext/core/Classes/Core/SystemEnvironmentBuilder.php": [
      "File: typo3/sysext/core/Classes/Core/SystemEnvironmentBuilder.php -> typo3/sysext/core/Classes/Core/SystemEnvironmentBuilder.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "255:     }",
      "264:     protected static function getPathThisScriptNonCli()",
      "265:     {",
      "273:         }",
      "275:     }",
      "",
      "[Removed Lines]",
      "266:         $isCgi = Environment::isRunningOnCgiServer();",
      "267:         if ($isCgi && Environment::usesCgiFixPathInfo()) {",
      "268:             return $_SERVER['SCRIPT_FILENAME'];",
      "269:         }",
      "270:         $cgiPath = $_SERVER['ORIG_PATH_TRANSLATED'] ?? $_SERVER['PATH_TRANSLATED'] ?? '';",
      "271:         if ($cgiPath && $isCgi) {",
      "272:             return $cgiPath;",
      "274:         return $_SERVER['ORIG_SCRIPT_FILENAME'] ?? $_SERVER['SCRIPT_FILENAME'];",
      "",
      "[Added Lines]",
      "264:         if (Environment::isRunningOnCgiServer() && !Environment::usesCgiFixPathInfo()) {",
      "265:             throw new \\Exception('TYPO3 does only support being used with cgi.fix_pathinfo=1 on CGI server APIs.', 1675108421);",
      "268:         return $_SERVER['SCRIPT_FILENAME'];",
      "",
      "---------------"
    ],
    "typo3/sysext/core/Classes/Http/NormalizedParams.php||typo3/sysext/core/Classes/Http/NormalizedParams.php": [
      "File: typo3/sysext/core/Classes/Http/NormalizedParams.php -> typo3/sysext/core/Classes/Http/NormalizedParams.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "311:         $requestHost = $this->requestHost = ($isHttps ? 'https://' : 'http://') . $httpHost;",
      "312:         $requestHostOnly = $this->requestHostOnly = self::determineRequestHostOnly($httpHost);",
      "313:         $this->requestPort = self::determineRequestPort($httpHost, $requestHostOnly);",
      "315:             $serverParams,",
      "316:             $configuration,",
      "317:             $isHttps,",
      "318:             $isBehindReverseProxy",
      "319:         );",
      "320:         $requestUri = $this->requestUri = self::determineRequestUri(",
      "321:             $serverParams,",
      "322:             $configuration,",
      "",
      "[Removed Lines]",
      "314:         $scriptName = $this->scriptName = self::determineScriptName(",
      "",
      "[Added Lines]",
      "314:         $scriptNameOnFileSystem = self::determineScriptName(",
      "320:         $scriptName = $this->scriptName = self::encodeFileSystemPathComponentForUrlPath($scriptNameOnFileSystem);",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "329:         $requestDir = $this->requestDir = $requestHost . GeneralUtility::dirname($scriptName) . '/';",
      "330:         $this->remoteAddress = self::determineRemoteAddress($serverParams, $configuration, $isBehindReverseProxy);",
      "331:         $scriptFilename = $this->scriptFilename = $pathThisScript;",
      "333:         $siteUrl = $this->siteUrl = self::determineSiteUrl($requestDir, $pathThisScript, $pathSite . '/');",
      "334:         $this->sitePath = self::determineSitePath($requestHost, $siteUrl);",
      "335:         $this->siteScript = self::determineSiteScript($requestUrl, $siteUrl);",
      "",
      "[Removed Lines]",
      "332:         $this->documentRoot = self::determineDocumentRoot($scriptName, $scriptFilename);",
      "",
      "[Added Lines]",
      "333:         $this->documentRoot = self::determineDocumentRoot($scriptNameOnFileSystem, $scriptFilename);",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "344:         $this->queryString = $serverParams['QUERY_STRING'] ?? '';",
      "345:     }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "348:     private static function encodeFileSystemPathComponentForUrlPath(string $path): string",
      "349:     {",
      "350:         return implode('/', array_map('rawurlencode', explode('/', $path)));",
      "351:     }",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "632:         bool $isHttps,",
      "633:         bool $isBehindReverseProxy",
      "634:     ): string {",
      "646:         if ($isBehindReverseProxy) {",
      "648:             if ($isHttps && !empty($configuration['reverseProxyPrefixSSL'])) {",
      "",
      "[Removed Lines]",
      "641:         $possiblePathInfo = ($serverParams['ORIG_PATH_INFO'] ?? '') ?: ($serverParams['PATH_INFO'] ?? '');",
      "642:         $possibleScriptName = ($serverParams['ORIG_SCRIPT_NAME'] ?? '') ?: ($serverParams['SCRIPT_NAME'] ?? '');",
      "643:         $scriptName = Environment::isRunningOnCgiServer() && $possiblePathInfo",
      "644:             ? $possiblePathInfo",
      "645:             : $possibleScriptName;",
      "",
      "[Added Lines]",
      "641:         $scriptName = $serverParams['SCRIPT_NAME'] ?? '';",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "786:     {",
      "",
      "[Removed Lines]",
      "785:     protected static function determineDocumentRoot(string $scriptName, string $scriptFilename): string",
      "",
      "[Added Lines]",
      "781:     protected static function determineDocumentRoot(string $scriptNameOnFileSystem, string $scriptFilename): string",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "792:         $webDocRoot = '';",
      "794:         $scriptFilenameArray = explode('/', strrev($scriptFilename));",
      "795:         $path = [];",
      "796:         foreach ($scriptNameArray as $segmentNumber => $segment) {",
      "",
      "[Removed Lines]",
      "793:         $scriptNameArray = explode('/', strrev($scriptName));",
      "",
      "[Added Lines]",
      "789:         $scriptNameArray = explode('/', strrev($scriptNameOnFileSystem));",
      "",
      "---------------"
    ],
    "typo3/sysext/core/Classes/Utility/GeneralUtility.php||typo3/sysext/core/Classes/Utility/GeneralUtility.php": [
      "File: typo3/sysext/core/Classes/Utility/GeneralUtility.php -> typo3/sysext/core/Classes/Utility/GeneralUtility.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "2310:         $retVal = '';",
      "2311:         switch ((string)$getEnvName) {",
      "2312:             case 'SCRIPT_NAME':",
      "2318:                 if (self::cmpIP($_SERVER['REMOTE_ADDR'] ?? '', $GLOBALS['TYPO3_CONF_VARS']['SYS']['reverseProxyIP'] ?? '')) {",
      "2319:                     if (self::getIndpEnv('TYPO3_SSL') && $GLOBALS['TYPO3_CONF_VARS']['SYS']['reverseProxyPrefixSSL']) {",
      "",
      "[Removed Lines]",
      "2313:                 $retVal = Environment::isRunningOnCgiServer()",
      "2314:                     && (($_SERVER['ORIG_PATH_INFO'] ?? false) ?: ($_SERVER['PATH_INFO'] ?? false))",
      "2315:                         ? (($_SERVER['ORIG_PATH_INFO'] ?? '') ?: ($_SERVER['PATH_INFO'] ?? ''))",
      "2316:                         : (($_SERVER['ORIG_SCRIPT_NAME'] ?? '') ?: ($_SERVER['SCRIPT_NAME'] ?? ''));",
      "",
      "[Added Lines]",
      "2313:                 $retVal = $_SERVER['SCRIPT_NAME'] ?? '';",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "2322:                         $retVal = $GLOBALS['TYPO3_CONF_VARS']['SYS']['reverseProxyPrefix'] . $retVal;",
      "2323:                     }",
      "2324:                 }",
      "2325:                 break;",
      "2326:             case 'SCRIPT_FILENAME':",
      "2327:                 $retVal = Environment::getCurrentScript();",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "2322:                 $retVal = self::encodeFileSystemPathComponentForUrlPath($retVal);",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "2350:                 }",
      "2351:                 break;",
      "2352:             case 'PATH_INFO':",
      "2364:                 break;",
      "2365:             case 'TYPO3_REV_PROXY':",
      "2366:                 $retVal = self::cmpIP($_SERVER['REMOTE_ADDR'] ?? '', $GLOBALS['TYPO3_CONF_VARS']['SYS']['reverseProxyIP']);",
      "",
      "[Removed Lines]",
      "2361:                 if (!Environment::isRunningOnCgiServer()) {",
      "2362:                     $retVal = $_SERVER['PATH_INFO'] ?? '';",
      "2363:                 }",
      "",
      "[Added Lines]",
      "2351:                 $retVal = $_SERVER['PATH_INFO'] ?? '';",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "2435:                 $SFN = self::getIndpEnv('SCRIPT_FILENAME');",
      "2437:                 $SFN_A = explode('/', strrev($SFN));",
      "2438:                 $acc = [];",
      "2439:                 foreach ($SN_A as $kk => $vv) {",
      "",
      "[Removed Lines]",
      "2436:                 $SN_A = explode('/', strrev(self::getIndpEnv('SCRIPT_NAME')));",
      "",
      "[Added Lines]",
      "2427:                 $SN_A = array_map('rawurldecode', explode('/', strrev(self::getIndpEnv('SCRIPT_NAME'))));",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "2558:         return !empty($_SERVER['HTTPS']) && strtolower($_SERVER['HTTPS']) !== 'off';",
      "2559:     }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "2552:     protected static function encodeFileSystemPathComponentForUrlPath(string $path): string",
      "2553:     {",
      "2554:         return implode('/', array_map('rawurlencode', explode('/', $path)));",
      "2555:     }",
      "",
      "---------------"
    ],
    "typo3/sysext/core/Tests/Acceptance/Support/Extension/ApplicationEnvironment.php||typo3/sysext/core/Tests/Acceptance/Support/Extension/ApplicationEnvironment.php": [
      "File: typo3/sysext/core/Tests/Acceptance/Support/Extension/ApplicationEnvironment.php -> typo3/sysext/core/Tests/Acceptance/Support/Extension/ApplicationEnvironment.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "145:             'SCRIPT_NAME' => '/typo3/index.php',",
      "146:             'PHP_SELF' => '/typo3/index.php',",
      "147:             'SCRIPT_FILENAME' => $docRoot . '/index.php',",
      "149:             'QUERY_STRING' => $requestUrlParts['query'] ?? '',",
      "150:             'REQUEST_URI' => $requestUrlParts['path'] . (isset($requestUrlParts['query']) ? '?' . $requestUrlParts['query'] : ''),",
      "151:             'REQUEST_METHOD' => $method,",
      "",
      "[Removed Lines]",
      "148:             'PATH_TRANSLATED' => $docRoot . '/index.php',",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ],
    "typo3/sysext/core/Tests/Unit/Http/NormalizedParamsTest.php||typo3/sysext/core/Tests/Unit/Http/NormalizedParamsTest.php": [
      "File: typo3/sysext/core/Tests/Unit/Http/NormalizedParamsTest.php -> typo3/sysext/core/Tests/Unit/Http/NormalizedParamsTest.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "360:                 [],",
      "361:                 '',",
      "362:             ],",
      "412:                 [",
      "415:                     'SCRIPT_NAME' => '/script/name.php',",
      "416:                 ],",
      "417:                 [],",
      "418:                 '/script/name.php',",
      "419:             ],",
      "429:                 [",
      "431:                 ],",
      "432:                 [],",
      "434:             ],",
      "435:             'add proxy ssl prefix' => [",
      "436:                 [",
      "",
      "[Removed Lines]",
      "363:             'use ORIG_SCRIPT_NAME if ORIG_PATH_INFO is set but empty' => [",
      "364:                 [",
      "365:                     'ORIG_PATH_INFO' => '',",
      "366:                     'PATH_INFO' => '',",
      "367:                     'ORIG_SCRIPT_NAME' => '/orig/script/name.php',",
      "368:                     'SCRIPT_NAME' => '/script/name.php',",
      "369:                 ],",
      "370:                 [],",
      "371:                 '/orig/script/name.php',",
      "372:             ],",
      "373:             'use ORIG_SCRIPT_NAME if PATH_INFO is set but empty' => [",
      "374:                 [",
      "375:                     'PATH_INFO' => '',",
      "376:                     'ORIG_SCRIPT_NAME' => '/orig/script/name.php',",
      "377:                     'SCRIPT_NAME' => '/script/name.php',",
      "378:                 ],",
      "379:                 [],",
      "380:                 '/orig/script/name.php',",
      "381:             ],",
      "382:             'use SCRIPT_NAME if ORIG_PATH_INFO is set but empty' => [",
      "383:                 [",
      "384:                     'ORIG_PATH_INFO' => '',",
      "385:                     'PATH_INFO' => '',",
      "386:                     'ORIG_SCRIPT_NAME' => '',",
      "387:                     'SCRIPT_NAME' => '/script/name.php',",
      "388:                 ],",
      "389:                 [],",
      "390:                 '/script/name.php',",
      "391:             ],",
      "392:             'use SCRIPT_NAME if PATH_INFO is set but empty' => [",
      "393:                 [",
      "394:                     'PATH_INFO' => '',",
      "395:                     'ORIG_SCRIPT_NAME' => '',",
      "396:                     'SCRIPT_NAME' => '/script/name.php',",
      "397:                 ],",
      "398:                 [],",
      "399:                 '/script/name.php',",
      "400:             ],",
      "401:             'use SCRIPT_NAME if ORIG_PATH_INFO is set' => [",
      "402:                 [",
      "403:                     'ORIG_PATH_INFO' => '/foo/bar',",
      "404:                     'PATH_INFO' => '',",
      "405:                     'ORIG_SCRIPT_NAME' => '',",
      "406:                     'SCRIPT_NAME' => '/script/name.php',",
      "407:                 ],",
      "408:                 [],",
      "409:                 '/script/name.php',",
      "410:             ],",
      "411:             'use SCRIPT_NAME if PATH_INFO is set' => [",
      "413:                     'PATH_INFO' => '/foo/bar',",
      "414:                     'ORIG_SCRIPT_NAME' => '',",
      "420:             'use ORIG_SCRIPT_NAME' => [",
      "421:                 [",
      "422:                     'ORIG_SCRIPT_NAME' => '/orig/script/name.php',",
      "423:                     'SCRIPT_NAME' => '/script/name.php',",
      "424:                 ],",
      "425:                 [],",
      "426:                 '/orig/script/name.php',",
      "427:             ],",
      "428:             'use SCRIPT_NAME' => [",
      "430:                     'SCRIPT_NAME' => '/script/name.php',",
      "433:                 '/script/name.php',",
      "",
      "[Added Lines]",
      "363:             'use SCRIPT_NAME' => [",
      "370:             'apply URL encoding to SCRIPT_NAME' => [",
      "372:                     'SCRIPT_NAME' => '/test:site/script/name.php',",
      "375:                 '/test%3Asite/script/name.php',",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "497:                 [],",
      "498:                 '/typo3/index.php?parameter=foo/bar&id=42',",
      "499:             ],",
      "500:             'prefix with proxy prefix with ssl if using REQUEST_URI' => [",
      "501:                 [",
      "502:                     'HTTP_HOST' => 'www.domain.com',",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "442:             'use query string and script name in special subdirectory if REQUEST_URI is not set' => [",
      "443:                 [",
      "444:                     'QUERY_STRING' => 'parameter=foo/bar&id=42',",
      "445:                     'SCRIPT_NAME' => '/sub:dir/typo3/index.php',",
      "446:                 ],",
      "447:                 [],",
      "448:                 '/sub%3Adir/typo3/index.php?parameter=foo/bar&id=42',",
      "449:             ],",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "905:         $serverParams = [",
      "906:             'SCRIPT_NAME' => '/typo3/index.php',",
      "907:             'HTTP_HOST' => 'www.domain.com',",
      "909:         ];",
      "910:         $pathThisScript = '/var/www/myInstance/Web/typo3/index.php';",
      "911:         $pathSite = '/var/www/myInstance/Web';",
      "",
      "[Removed Lines]",
      "908:             'PATH_INFO' => '/typo3/index.php',",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "978:         return [",
      "979:             'not in a sub directory' => [",
      "980:                 [",
      "982:                     'HTTP_HOST' => 'www.domain.com',",
      "983:                 ],",
      "984:                 '/var/www/myInstance/Web/typo3/index.php',",
      "",
      "[Removed Lines]",
      "981:                     'SCRIPT_NAME' => '/typo3/index.php?id=42&foo=bar',",
      "",
      "[Added Lines]",
      "930:                     'SCRIPT_NAME' => '/typo3/index.php',",
      "931:                     'REQUEST_URI' => '/typo3/index.php?id=42&foo=bar',",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "987:             ],",
      "988:             'in a sub directory' => [",
      "989:                 [",
      "991:                     'HTTP_HOST' => 'www.domain.com',",
      "992:                 ],",
      "993:                 '/var/www/myInstance/Web/typo3/index.php',",
      "",
      "[Removed Lines]",
      "990:                     'SCRIPT_NAME' => '/some/sub/dir/typo3/index.php?id=42&foo=bar',",
      "",
      "[Added Lines]",
      "940:                     'SCRIPT_NAME' => '/some/sub/dir/typo3/index.php',",
      "941:                     'REQUEST_URI' => '/some/sub/dir/typo3/index.php?id=42&foo=bar',",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "1023:     public function getPathInfoReturnsExpectedValue(): void",
      "1024:     {",
      "1025:         $serverParams = [",
      "1027:         ];",
      "1029:         $serverRequestParameters = new NormalizedParams($serverParams, [], '', '');",
      "1030:         self::assertSame($expected, $serverRequestParameters->getPathInfo());",
      "1031:     }",
      "",
      "[Removed Lines]",
      "1026:             'PATH_INFO' => '/typo3/index.php',",
      "1028:         $expected = '/typo3/index.php';",
      "",
      "[Added Lines]",
      "977:             'PATH_INFO' => '/foo/bar',",
      "979:         $expected = '/foo/bar';",
      "",
      "---------------"
    ],
    "typo3/sysext/core/Tests/Unit/Log/Processor/WebProcessorTest.php||typo3/sysext/core/Tests/Unit/Log/Processor/WebProcessorTest.php": [
      "File: typo3/sysext/core/Tests/Unit/Log/Processor/WebProcessorTest.php -> typo3/sysext/core/Tests/Unit/Log/Processor/WebProcessorTest.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "31:     public function webProcessorAddsWebDataToLogRecord(): void",
      "32:     {",
      "34:         $_SERVER['REQUEST_URI'] = '';",
      "36:         $_SERVER['REMOTE_ADDR'] = '';",
      "37:         $_SERVER['QUERY_STRING'] = '';",
      "38:         $_SERVER['SSL_SESSION_ID'] = '';",
      "",
      "[Removed Lines]",
      "33:         $_SERVER['PATH_INFO'] = '';",
      "35:         $_SERVER['ORIG_SCRIPT_NAME'] = '';",
      "",
      "[Added Lines]",
      "34:         $_SERVER['SCRIPT_NAME'] = '';",
      "",
      "---------------"
    ],
    "typo3/sysext/felogin/Tests/Unit/Validation/RedirectUrlValidatorTest.php||typo3/sysext/felogin/Tests/Unit/Validation/RedirectUrlValidatorTest.php": [
      "File: typo3/sysext/felogin/Tests/Unit/Validation/RedirectUrlValidatorTest.php -> typo3/sysext/felogin/Tests/Unit/Validation/RedirectUrlValidatorTest.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "65:     protected function setUpFakeSitePathAndHost(): void",
      "66:     {",
      "68:         $_SERVER['HTTP_HOST'] = $this->testHostName;",
      "70:         $request = ServerRequestFactory::fromGlobals();",
      "",
      "[Removed Lines]",
      "67:         $_SERVER['ORIG_PATH_INFO'] = $_SERVER['PATH_INFO'] = $_SERVER['ORIG_SCRIPT_NAME'] = $_SERVER['SCRIPT_NAME'] = $this->testSitePath . 'index.php';",
      "",
      "[Added Lines]",
      "67:         $_SERVER['SCRIPT_NAME'] = $this->testSitePath . 'index.php';",
      "",
      "---------------"
    ],
    "typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php||typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php": [
      "File: typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php -> typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "2423:         if (!$this->absRefPrefix) {",
      "2424:             return;",
      "2425:         }",
      "2426:         $search = [",
      "2427:             '\"_assets/',",
      "2428:             '\"typo3temp/',",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "2426:         $encodedAbsRefPrefix = htmlspecialchars($this->absRefPrefix, ENT_QUOTES | ENT_HTML5);",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "2430:             '\"' . PathUtility::stripPathSitePrefix(Environment::getFrameworkBasePath()) . '/',",
      "2431:         ];",
      "2432:         $replace = [",
      "2437:         ];",
      "2439:         $directories = GeneralUtility::trimExplode(',', $GLOBALS['TYPO3_CONF_VARS']['FE']['additionalAbsRefPrefixDirectories'], true);",
      "2440:         foreach ($directories as $directory) {",
      "2441:             $search[] = '\"' . $directory;",
      "2443:         }",
      "2444:         $this->content = str_replace(",
      "2445:             $search,",
      "",
      "[Removed Lines]",
      "2433:             '\"' . $this->absRefPrefix . '_assets/',",
      "2434:             '\"' . $this->absRefPrefix . 'typo3temp/',",
      "2435:             '\"' . $this->absRefPrefix . PathUtility::stripPathSitePrefix(Environment::getExtensionsPath()) . '/',",
      "2436:             '\"' . $this->absRefPrefix . PathUtility::stripPathSitePrefix(Environment::getFrameworkBasePath()) . '/',",
      "2442:             $replace[] = '\"' . $this->absRefPrefix . $directory;",
      "",
      "[Added Lines]",
      "2434:             '\"' . $encodedAbsRefPrefix . '_assets/',",
      "2435:             '\"' . $encodedAbsRefPrefix . 'typo3temp/',",
      "2436:             '\"' . $encodedAbsRefPrefix . PathUtility::stripPathSitePrefix(Environment::getExtensionsPath()) . '/',",
      "2437:             '\"' . $encodedAbsRefPrefix . PathUtility::stripPathSitePrefix(Environment::getFrameworkBasePath()) . '/',",
      "2443:             $replace[] = '\"' . $encodedAbsRefPrefix . $directory;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "c568946b081ac3493d21c3bb6b5da767164e8c08",
      "candidate_info": {
        "commit_hash": "c568946b081ac3493d21c3bb6b5da767164e8c08",
        "repo": "TYPO3/typo3",
        "commit_url": "https://github.com/TYPO3/typo3/commit/c568946b081ac3493d21c3bb6b5da767164e8c08",
        "files": [
          "typo3/sysext/core/Classes/Utility/GeneralUtility.php"
        ],
        "message": "[TASK] Modernize array function callbacks in GeneralUtility\n\nFunction callbacks are declared using the new PHP 8.1 feature\n\"first class callable\", which e.g. uses the named `trim(...)`\nfunction symbol, instead of the string `'trim'`.\n\nsee https://www.php.net/manual/en/functions.first_class_callable_syntax.php\n\nResolves: #100144\nReleases: main\nChange-Id: I708f86e022e397f3fcf32596043336b430e9c9ef\nReviewed-on: https://review.typo3.org/c/Packages/TYPO3.CMS/+/78097\nReviewed-by: Oliver Bartsch <bo@cedev.de>\nTested-by: core-ci <typo3@b13.com>\nTested-by: Oliver Bartsch <bo@cedev.de>\nReviewed-by: Christian Kuhn <lolli@schwarzbu.ch>\nReviewed-by: Benni Mack <benni@typo3.org>\nTested-by: Christian Kuhn <lolli@schwarzbu.ch>",
        "before_after_code_files": [
          "typo3/sysext/core/Classes/Utility/GeneralUtility.php||typo3/sysext/core/Classes/Utility/GeneralUtility.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "typo3/sysext/core/Classes/Utility/GeneralUtility.php||typo3/sysext/core/Classes/Utility/GeneralUtility.php"
          ],
          "candidate": [
            "typo3/sysext/core/Classes/Utility/GeneralUtility.php||typo3/sysext/core/Classes/Utility/GeneralUtility.php"
          ]
        }
      },
      "candidate_diff": {
        "typo3/sysext/core/Classes/Utility/GeneralUtility.php||typo3/sysext/core/Classes/Utility/GeneralUtility.php": [
          "File: typo3/sysext/core/Classes/Utility/GeneralUtility.php -> typo3/sysext/core/Classes/Utility/GeneralUtility.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "893:             return [$string];",
          "894:         }",
          "895:         $explodedValues = explode($delimiter, strrev($string), $limit);",
          "897:         return array_reverse($explodedValues);",
          "898:     }",
          "",
          "[Removed Lines]",
          "896:         $explodedValues = array_map('strrev', $explodedValues);",
          "",
          "[Added Lines]",
          "896:         $explodedValues = array_map(strrev(...), $explodedValues);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "918:         $result = explode($delim, (string)$string);",
          "919:         if ($removeEmptyValues) {",
          "922:         }",
          "924:         if ($limit === 0) {",
          "927:         }",
          "929:         if ($limit < 0) {",
          "932:         }",
          "",
          "[Removed Lines]",
          "921:             $result = array_values(array_filter($result, static fn ($item) => trim($item) !== ''));",
          "926:             return array_map('trim', $result);",
          "931:             return array_map('trim', array_slice($result, 0, $limit));",
          "",
          "[Added Lines]",
          "921:             $result = array_values(array_filter($result, static fn (string $item): bool => trim($item) !== ''));",
          "926:             return array_map(trim(...), $result);",
          "931:             return array_map(trim(...), array_slice($result, 0, $limit));",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "937:         if ($tail) {",
          "938:             $result[] = implode($delim, $tail);",
          "939:         }",
          "941:     }",
          "",
          "[Removed Lines]",
          "940:         return array_map('trim', $result);",
          "",
          "[Added Lines]",
          "940:         return array_map(trim(...), $result);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "2430:                 $SFN_A = explode('/', strrev($SFN));",
          "2431:                 $acc = [];",
          "2432:                 foreach ($SN_A as $kk => $vv) {",
          "",
          "[Removed Lines]",
          "2429:                 $SN_A = array_map('rawurldecode', explode('/', strrev(self::getIndpEnv('SCRIPT_NAME'))));",
          "",
          "[Added Lines]",
          "2429:                 $SN_A = array_map(rawurldecode(...), explode('/', strrev(self::getIndpEnv('SCRIPT_NAME'))));",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "2554:     protected static function encodeFileSystemPathComponentForUrlPath(string $path): string",
          "2555:     {",
          "2557:     }",
          "",
          "[Removed Lines]",
          "2556:         return implode('/', array_map('rawurlencode', explode('/', $path)));",
          "",
          "[Added Lines]",
          "2556:         return implode('/', array_map(rawurlencode(...), explode('/', $path)));",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "315cbd2b45033eba0a3e36bb4b0b1e357c05cf7b",
      "candidate_info": {
        "commit_hash": "315cbd2b45033eba0a3e36bb4b0b1e357c05cf7b",
        "repo": "TYPO3/typo3",
        "commit_url": "https://github.com/TYPO3/typo3/commit/315cbd2b45033eba0a3e36bb4b0b1e357c05cf7b",
        "files": [
          "typo3/sysext/core/Classes/Localization/Parser/AbstractXmlParser.php",
          "typo3/sysext/core/Classes/Package/PackageManager.php",
          "typo3/sysext/core/Configuration/DefaultConfiguration.php",
          "typo3/sysext/core/Configuration/DefaultConfigurationDescription.yaml",
          "typo3/sysext/core/Documentation/Changelog/12.0/Breaking-96982-RemovedSupportForGlobalExtensions.rst",
          "typo3/sysext/extensionmanager/Classes/Domain/Model/Extension.php",
          "typo3/sysext/fluid/Classes/ViewHelpers/Debug/RenderViewHelper.php",
          "typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php",
          "typo3/sysext/frontend/Classes/Resource/FilePathSanitizer.php",
          "typo3/sysext/install/Classes/Report/InstallStatusReport.php",
          "typo3/sysext/install/Classes/Service/SilentConfigurationUpgradeService.php"
        ],
        "message": "[!!!][TASK] Remove support for \"global extensions\"\n\nTYPO3 has supported the functionality of \"global extensions\",\nextensions that could be put into \"typo3/ext/\", next to\nsystem extensions in \"typo3/sysext/\" and locally installed\nextensions \"in \"typo3conf/ext/\". With the rise of composer-based\ninstallations, this functionality is removed to streamline\nthe concepts of the location of extensions in TYPO3 v12.0.\n\nThe functionality has been disabled by default for TYPO3\ninstallations since at least TYPO3 4.0.\n\nAll occurrences where the global extensions path is checked\nhas been removed, along with the global configuration setting\n`$TYPO3_CONF_VARS[EXT][allowGlobalInstall]`.\n\nResolves: #96982\nReleases: main\nChange-Id: I1678076c025614feeec3dedbd55c1564de0f5b53\nReviewed-on: https://review.typo3.org/c/Packages/TYPO3.CMS/+/73626\nTested-by: core-ci <typo3@b13.com>\nTested-by: Stefan B\u00fcrk <stefan@buerk.tech>\nTested-by: Christian Kuhn <lolli@schwarzbu.ch>\nReviewed-by: Stefan B\u00fcrk <stefan@buerk.tech>\nReviewed-by: Christian Kuhn <lolli@schwarzbu.ch>",
        "before_after_code_files": [
          "typo3/sysext/core/Classes/Localization/Parser/AbstractXmlParser.php||typo3/sysext/core/Classes/Localization/Parser/AbstractXmlParser.php",
          "typo3/sysext/core/Classes/Package/PackageManager.php||typo3/sysext/core/Classes/Package/PackageManager.php",
          "typo3/sysext/core/Configuration/DefaultConfiguration.php||typo3/sysext/core/Configuration/DefaultConfiguration.php",
          "typo3/sysext/extensionmanager/Classes/Domain/Model/Extension.php||typo3/sysext/extensionmanager/Classes/Domain/Model/Extension.php",
          "typo3/sysext/fluid/Classes/ViewHelpers/Debug/RenderViewHelper.php||typo3/sysext/fluid/Classes/ViewHelpers/Debug/RenderViewHelper.php",
          "typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php||typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php",
          "typo3/sysext/frontend/Classes/Resource/FilePathSanitizer.php||typo3/sysext/frontend/Classes/Resource/FilePathSanitizer.php",
          "typo3/sysext/install/Classes/Report/InstallStatusReport.php||typo3/sysext/install/Classes/Report/InstallStatusReport.php",
          "typo3/sysext/install/Classes/Service/SilentConfigurationUpgradeService.php||typo3/sysext/install/Classes/Service/SilentConfigurationUpgradeService.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php||typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php"
          ],
          "candidate": [
            "typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php||typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php"
          ]
        }
      },
      "candidate_diff": {
        "typo3/sysext/core/Classes/Localization/Parser/AbstractXmlParser.php||typo3/sysext/core/Classes/Localization/Parser/AbstractXmlParser.php": [
          "File: typo3/sysext/core/Classes/Localization/Parser/AbstractXmlParser.php -> typo3/sysext/core/Classes/Localization/Parser/AbstractXmlParser.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "144:         if (str_starts_with($fileRef, Environment::getFrameworkBasePath() . '/')) {",
          "146:             $validatedPrefix = Environment::getFrameworkBasePath() . '/';",
          "150:         } elseif (str_starts_with($fileRef, Environment::getExtensionsPath() . '/')) {",
          "152:             $validatedPrefix = Environment::getExtensionsPath() . '/';",
          "",
          "[Removed Lines]",
          "147:         } elseif (str_starts_with($fileRef, Environment::getBackendPath() . '/ext/')) {",
          "149:             $validatedPrefix = Environment::getBackendPath() . '/ext/';",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "typo3/sysext/core/Classes/Package/PackageManager.php||typo3/sysext/core/Classes/Package/PackageManager.php": [
          "File: typo3/sysext/core/Classes/Package/PackageManager.php -> typo3/sysext/core/Classes/Package/PackageManager.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "1051:     protected function getPackageBasePaths()",
          "1052:     {",
          "1055:             if (is_dir(Environment::getExtensionsPath()) && $this->hasSubDirectories(Environment::getExtensionsPath())) {",
          "1056:                 $this->packagesBasePaths['local'] = Environment::getExtensionsPath() . '/*/';",
          "1057:             }",
          "1061:             $this->packagesBasePaths['system'] = Environment::getFrameworkBasePath() . '/*/';",
          "1062:         }",
          "1063:         return $this->packagesBasePaths;",
          "",
          "[Removed Lines]",
          "1053:         if (count($this->packagesBasePaths) < 3) {",
          "1058:             if (is_dir(Environment::getBackendPath() . '/ext') && $this->hasSubDirectories(Environment::getBackendPath() . '/ext')) {",
          "1059:                 $this->packagesBasePaths['global'] = Environment::getBackendPath() . '/ext/*/';",
          "1060:             }",
          "",
          "[Added Lines]",
          "1053:         if ($this->packagesBasePaths === []) {",
          "",
          "---------------"
        ],
        "typo3/sysext/core/Configuration/DefaultConfiguration.php||typo3/sysext/core/Configuration/DefaultConfiguration.php": [
          "File: typo3/sysext/core/Configuration/DefaultConfiguration.php -> typo3/sysext/core/Configuration/DefaultConfiguration.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "1206:         ],",
          "1207:     ],",
          "1208:     'EXT' => [ // Options related to the Extension Management",
          "1210:         'allowLocalInstall' => true,",
          "1211:         'excludeForPackaging' => '(?:\\\\.(?!htaccess$).*|.*~|.*\\\\.swp|.*\\\\.bak|node_modules|bower_components)',",
          "1212:     ],",
          "",
          "[Removed Lines]",
          "1209:         'allowGlobalInstall' => false,",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "typo3/sysext/extensionmanager/Classes/Domain/Model/Extension.php||typo3/sysext/extensionmanager/Classes/Domain/Model/Extension.php": [
          "File: typo3/sysext/extensionmanager/Classes/Domain/Model/Extension.php -> typo3/sysext/extensionmanager/Classes/Domain/Model/Extension.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "466:     {",
          "467:         $installPaths = [",
          "468:             'System' => Environment::getFrameworkBasePath() . '/',",
          "470:             'Local' => Environment::getExtensionsPath() . '/',",
          "471:         ];",
          "472:         return $installPaths;",
          "",
          "[Removed Lines]",
          "469:             'Global' => Environment::getBackendPath() . '/ext/',",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "481:     public static function returnAllowedInstallPaths()",
          "482:     {",
          "483:         $installPaths = self::returnInstallPaths();",
          "487:         if (empty($GLOBALS['TYPO3_CONF_VARS']['EXT']['allowLocalInstall'])) {",
          "488:             unset($installPaths['Local']);",
          "489:         }",
          "",
          "[Removed Lines]",
          "484:         if (empty($GLOBALS['TYPO3_CONF_VARS']['EXT']['allowGlobalInstall'])) {",
          "485:             unset($installPaths['Global']);",
          "486:         }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "typo3/sysext/fluid/Classes/ViewHelpers/Debug/RenderViewHelper.php||typo3/sysext/fluid/Classes/ViewHelpers/Debug/RenderViewHelper.php": [
          "File: typo3/sysext/fluid/Classes/ViewHelpers/Debug/RenderViewHelper.php -> typo3/sysext/fluid/Classes/ViewHelpers/Debug/RenderViewHelper.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "99:             $path = $this->renderingContext->getTemplatePaths()->getPartialPathAndFilename($partial);",
          "100:             $path = str_replace(",
          "101:                 [",
          "103:                     Environment::getExtensionsPath() . '/',",
          "104:                     Environment::getFrameworkBasePath() . '/',",
          "105:                 ],",
          "",
          "[Removed Lines]",
          "102:                     Environment::getBackendPath() . '/ext/',",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php||typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php": [
          "File: typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php -> typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "2548:             '\"_assets/',",
          "2549:             '\"typo3temp/',",
          "2550:             '\"' . PathUtility::stripPathSitePrefix(Environment::getExtensionsPath()) . '/',",
          "2552:             '\"' . PathUtility::stripPathSitePrefix(Environment::getFrameworkBasePath()) . '/',",
          "2553:         ];",
          "2554:         $replace = [",
          "2555:             '\"' . $this->absRefPrefix . '_assets/',",
          "2556:             '\"' . $this->absRefPrefix . 'typo3temp/',",
          "2557:             '\"' . $this->absRefPrefix . PathUtility::stripPathSitePrefix(Environment::getExtensionsPath()) . '/',",
          "2559:             '\"' . $this->absRefPrefix . PathUtility::stripPathSitePrefix(Environment::getFrameworkBasePath()) . '/',",
          "2560:         ];",
          "",
          "[Removed Lines]",
          "2551:             '\"' . PathUtility::stripPathSitePrefix(Environment::getBackendPath()) . '/ext/',",
          "2558:             '\"' . $this->absRefPrefix . PathUtility::stripPathSitePrefix(Environment::getBackendPath()) . '/ext/',",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "typo3/sysext/frontend/Classes/Resource/FilePathSanitizer.php||typo3/sysext/frontend/Classes/Resource/FilePathSanitizer.php": [
          "File: typo3/sysext/frontend/Classes/Resource/FilePathSanitizer.php -> typo3/sysext/frontend/Classes/Resource/FilePathSanitizer.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "56:             $GLOBALS['TYPO3_CONF_VARS']['BE']['fileadminDir'],",
          "57:             'uploads/',",
          "58:             'typo3temp/',",
          "60:             PathUtility::stripPathSitePrefix(Environment::getFrameworkBasePath()) . '/',",
          "61:             PathUtility::stripPathSitePrefix(Environment::getExtensionsPath()) . '/',",
          "62:         ];",
          "",
          "[Removed Lines]",
          "59:             PathUtility::stripPathSitePrefix(Environment::getBackendPath()) . '/ext/',",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "typo3/sysext/install/Classes/Report/InstallStatusReport.php||typo3/sysext/install/Classes/Report/InstallStatusReport.php": [
          "File: typo3/sysext/install/Classes/Report/InstallStatusReport.php -> typo3/sysext/install/Classes/Report/InstallStatusReport.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "100:         if (!Environment::isComposerMode()) {",
          "101:             $checkWritable[Environment::getExtensionsPath()] = 0;",
          "105:         }",
          "107:         foreach ($checkWritable as $path => $requirementLevel) {",
          "",
          "[Removed Lines]",
          "102:             if ($GLOBALS['TYPO3_CONF_VARS']['EXT']['allowGlobalInstall']) {",
          "103:                 $checkWritable[Environment::getBackendPath() . '/ext/'] = -1;",
          "104:             }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "typo3/sysext/install/Classes/Service/SilentConfigurationUpgradeService.php||typo3/sysext/install/Classes/Service/SilentConfigurationUpgradeService.php": [
          "File: typo3/sysext/install/Classes/Service/SilentConfigurationUpgradeService.php -> typo3/sysext/install/Classes/Service/SilentConfigurationUpgradeService.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "169:         'SYS/features/form.legacyUploadMimeTypes',",
          "171:         'SYS/USdateFormat',",
          "172:     ];",
          "174:     public function __construct(ConfigurationManager $configurationManager)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "173:         'EXT/allowGlobalInstall',",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "7a2600c5016e74e32fa5e40103e8bb108f5f596f",
      "candidate_info": {
        "commit_hash": "7a2600c5016e74e32fa5e40103e8bb108f5f596f",
        "repo": "TYPO3/typo3",
        "commit_url": "https://github.com/TYPO3/typo3/commit/7a2600c5016e74e32fa5e40103e8bb108f5f596f",
        "files": [
          "Build/phpstan/phpstan-baseline.neon",
          "typo3/sysext/adminpanel/Classes/Controller/MainController.php",
          "typo3/sysext/backend/Classes/Controller/EditDocumentController.php",
          "typo3/sysext/backend/Classes/Controller/LoginController.php",
          "typo3/sysext/backend/Classes/Http/Application.php",
          "typo3/sysext/backend/Classes/Middleware/ForcedHttpsBackendRedirector.php",
          "typo3/sysext/backend/Classes/Routing/UriBuilder.php",
          "typo3/sysext/backend/Classes/ServiceProvider.php",
          "typo3/sysext/backend/Tests/Functional/Template/Components/Buttons/Action/ShortcutButtonTest.php",
          "typo3/sysext/backend/Tests/Functional/Template/Fixtures/RecordListCopyToClipboard.html",
          "typo3/sysext/backend/Tests/Functional/Template/Fixtures/RecordListSingleTableCopyToClipboard.html",
          "typo3/sysext/backend/Tests/Functional/Template/Fixtures/SpecialRouteIdentifierWithArgumentsCopyToClipboard.html",
          "typo3/sysext/backend/Tests/Unit/Routing/UriBuilderTest.php",
          "typo3/sysext/backend/Tests/Unit/View/ArrayBrowserTest.php",
          "typo3/sysext/core/Classes/Authentication/BackendUserAuthentication.php",
          "typo3/sysext/core/Classes/Core/SystemEnvironmentBuilder.php",
          "typo3/sysext/core/Classes/LinkHandling/LegacyLinkNotationConverter.php",
          "typo3/sysext/core/Classes/Routing/BackendEntryPointResolver.php",
          "typo3/sysext/core/Classes/ServiceProvider.php",
          "typo3/sysext/core/Configuration/Services.yaml",
          "typo3/sysext/core/Documentation/Changelog/12.0/Deprecation-98283-PHPConstantTYPO3_mainDir.rst",
          "typo3/sysext/extbase/Tests/Unit/Mvc/Web/Routing/UriBuilderTest.php",
          "typo3/sysext/felogin/Tests/Unit/Validation/RedirectUrlValidatorTest.php",
          "typo3/sysext/fluid/Classes/ViewHelpers/Be/LinkViewHelper.php",
          "typo3/sysext/fluid/Tests/Functional/ViewHelpers/Be/LinkViewHelperTest.php",
          "typo3/sysext/fluid/Tests/Functional/ViewHelpers/Be/UriViewHelperTest.php",
          "typo3/sysext/frontend/Classes/Http/Application.php",
          "typo3/sysext/frontend/Classes/ServiceProvider.php",
          "typo3/sysext/install/Classes/Controller/BackendModuleController.php",
          "typo3/sysext/install/Classes/Http/Application.php",
          "typo3/sysext/install/Configuration/ExtensionScanner/Php/ConstantMatcher.php",
          "typo3/sysext/reports/Classes/Controller/ReportController.php"
        ],
        "message": "[TASK] Deprecate TYPO3_mainDir\n\nThis patch deprecates the constant \"TYPO3_mainDir\"\nin favor of a BackendEntryPointResolver which\ncontains the information in a unified way to work with\nthe prefix for the path or URL.\n\nSome tests are adapted properly to run in \"frontend\ncontext\" now (e.g. felogin\") to simulate the proper\nbehavior.\n\nResolves: #98283\nReleases: main\nChange-Id: I8d7c410456a9fe41d220aa481032df251e949936\nReviewed-on: https://review.typo3.org/c/Packages/TYPO3.CMS/+/75620\nTested-by: Susanne Moog <look@susi.dev>\nTested-by: core-ci <typo3@b13.com>\nTested-by: Benjamin Franzke <bfr@qbus.de>\nReviewed-by: Susanne Moog <look@susi.dev>\nReviewed-by: Benjamin Franzke <bfr@qbus.de>",
        "before_after_code_files": [
          "Build/phpstan/phpstan-baseline.neon||Build/phpstan/phpstan-baseline.neon",
          "typo3/sysext/adminpanel/Classes/Controller/MainController.php||typo3/sysext/adminpanel/Classes/Controller/MainController.php",
          "typo3/sysext/backend/Classes/Controller/EditDocumentController.php||typo3/sysext/backend/Classes/Controller/EditDocumentController.php",
          "typo3/sysext/backend/Classes/Controller/LoginController.php||typo3/sysext/backend/Classes/Controller/LoginController.php",
          "typo3/sysext/backend/Classes/Http/Application.php||typo3/sysext/backend/Classes/Http/Application.php",
          "typo3/sysext/backend/Classes/Middleware/ForcedHttpsBackendRedirector.php||typo3/sysext/backend/Classes/Middleware/ForcedHttpsBackendRedirector.php",
          "typo3/sysext/backend/Classes/Routing/UriBuilder.php||typo3/sysext/backend/Classes/Routing/UriBuilder.php",
          "typo3/sysext/backend/Classes/ServiceProvider.php||typo3/sysext/backend/Classes/ServiceProvider.php",
          "typo3/sysext/backend/Tests/Functional/Template/Components/Buttons/Action/ShortcutButtonTest.php||typo3/sysext/backend/Tests/Functional/Template/Components/Buttons/Action/ShortcutButtonTest.php",
          "typo3/sysext/backend/Tests/Functional/Template/Fixtures/RecordListCopyToClipboard.html||typo3/sysext/backend/Tests/Functional/Template/Fixtures/RecordListCopyToClipboard.html",
          "typo3/sysext/backend/Tests/Functional/Template/Fixtures/RecordListSingleTableCopyToClipboard.html||typo3/sysext/backend/Tests/Functional/Template/Fixtures/RecordListSingleTableCopyToClipboard.html",
          "typo3/sysext/backend/Tests/Functional/Template/Fixtures/SpecialRouteIdentifierWithArgumentsCopyToClipboard.html||typo3/sysext/backend/Tests/Functional/Template/Fixtures/SpecialRouteIdentifierWithArgumentsCopyToClipboard.html",
          "typo3/sysext/backend/Tests/Unit/Routing/UriBuilderTest.php||typo3/sysext/backend/Tests/Unit/Routing/UriBuilderTest.php",
          "typo3/sysext/backend/Tests/Unit/View/ArrayBrowserTest.php||typo3/sysext/backend/Tests/Unit/View/ArrayBrowserTest.php",
          "typo3/sysext/core/Classes/Authentication/BackendUserAuthentication.php||typo3/sysext/core/Classes/Authentication/BackendUserAuthentication.php",
          "typo3/sysext/core/Classes/Core/SystemEnvironmentBuilder.php||typo3/sysext/core/Classes/Core/SystemEnvironmentBuilder.php",
          "typo3/sysext/core/Classes/LinkHandling/LegacyLinkNotationConverter.php||typo3/sysext/core/Classes/LinkHandling/LegacyLinkNotationConverter.php",
          "typo3/sysext/core/Classes/Routing/BackendEntryPointResolver.php||typo3/sysext/core/Classes/Routing/BackendEntryPointResolver.php",
          "typo3/sysext/core/Classes/ServiceProvider.php||typo3/sysext/core/Classes/ServiceProvider.php",
          "typo3/sysext/extbase/Tests/Unit/Mvc/Web/Routing/UriBuilderTest.php||typo3/sysext/extbase/Tests/Unit/Mvc/Web/Routing/UriBuilderTest.php",
          "typo3/sysext/felogin/Tests/Unit/Validation/RedirectUrlValidatorTest.php||typo3/sysext/felogin/Tests/Unit/Validation/RedirectUrlValidatorTest.php",
          "typo3/sysext/fluid/Classes/ViewHelpers/Be/LinkViewHelper.php||typo3/sysext/fluid/Classes/ViewHelpers/Be/LinkViewHelper.php",
          "typo3/sysext/fluid/Tests/Functional/ViewHelpers/Be/LinkViewHelperTest.php||typo3/sysext/fluid/Tests/Functional/ViewHelpers/Be/LinkViewHelperTest.php",
          "typo3/sysext/fluid/Tests/Functional/ViewHelpers/Be/UriViewHelperTest.php||typo3/sysext/fluid/Tests/Functional/ViewHelpers/Be/UriViewHelperTest.php",
          "typo3/sysext/frontend/Classes/Http/Application.php||typo3/sysext/frontend/Classes/Http/Application.php",
          "typo3/sysext/frontend/Classes/ServiceProvider.php||typo3/sysext/frontend/Classes/ServiceProvider.php",
          "typo3/sysext/install/Classes/Controller/BackendModuleController.php||typo3/sysext/install/Classes/Controller/BackendModuleController.php",
          "typo3/sysext/install/Classes/Http/Application.php||typo3/sysext/install/Classes/Http/Application.php",
          "typo3/sysext/install/Configuration/ExtensionScanner/Php/ConstantMatcher.php||typo3/sysext/install/Configuration/ExtensionScanner/Php/ConstantMatcher.php",
          "typo3/sysext/reports/Classes/Controller/ReportController.php||typo3/sysext/reports/Classes/Controller/ReportController.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "typo3/sysext/core/Classes/Core/SystemEnvironmentBuilder.php||typo3/sysext/core/Classes/Core/SystemEnvironmentBuilder.php",
            "typo3/sysext/felogin/Tests/Unit/Validation/RedirectUrlValidatorTest.php||typo3/sysext/felogin/Tests/Unit/Validation/RedirectUrlValidatorTest.php"
          ],
          "candidate": [
            "typo3/sysext/core/Classes/Core/SystemEnvironmentBuilder.php||typo3/sysext/core/Classes/Core/SystemEnvironmentBuilder.php",
            "typo3/sysext/felogin/Tests/Unit/Validation/RedirectUrlValidatorTest.php||typo3/sysext/felogin/Tests/Unit/Validation/RedirectUrlValidatorTest.php"
          ]
        }
      },
      "candidate_diff": {
        "Build/phpstan/phpstan-baseline.neon||Build/phpstan/phpstan-baseline.neon": [
          "File: Build/phpstan/phpstan-baseline.neon -> Build/phpstan/phpstan-baseline.neon",
          "--- Hunk 1 ---",
          "[Context before]",
          "2515:    count: 1",
          "2516:    path: ../../typo3/sysext/fluid/Classes/View/TemplatePaths.php",
          "2523:   -",
          "2524:    message: \"#^Call to an undefined method TYPO3Fluid\\\\\\\\Fluid\\\\\\\\Core\\\\\\\\Rendering\\\\\\\\RenderingContextInterface\\\\:\\\\:getRequest\\\\(\\\\)\\\\.$#\"",
          "2525:    count: 2",
          "",
          "[Removed Lines]",
          "2518:   -",
          "2519:    message: \"#^Parameter \\\\#2 \\\\$attributeValue of method TYPO3Fluid\\\\\\\\Fluid\\\\\\\\Core\\\\\\\\ViewHelper\\\\\\\\TagBuilder\\\\:\\\\:addAttribute\\\\(\\\\) expects array\\\\|string\\\\|Traversable\\\\|null, TYPO3\\\\\\\\CMS\\\\\\\\Core\\\\\\\\Http\\\\\\\\Uri given\\\\.$#\"",
          "2520:    count: 1",
          "2521:    path: ../../typo3/sysext/fluid/Classes/ViewHelpers/Be/LinkViewHelper.php",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "3820:    count: 1",
          "3821:    path: ../../typo3/sysext/recycler/Tests/Unit/Task/CleanerFieldProviderTest.php",
          "3828:   -",
          "3829:    message: \"#^Constructor of class TYPO3\\\\\\\\CMS\\\\\\\\RteCKEditor\\\\\\\\Form\\\\\\\\Resolver\\\\\\\\RichTextNodeResolver has an unused parameter \\\\$nodeFactory\\\\.$#\"",
          "3830:    count: 1",
          "",
          "[Removed Lines]",
          "3823:   -",
          "3824:    message: \"#^Parameter \\\\#1 \\\\$href of method TYPO3\\\\\\\\CMS\\\\\\\\Backend\\\\\\\\Template\\\\\\\\Components\\\\\\\\Menu\\\\\\\\MenuItem\\\\:\\\\:setHref\\\\(\\\\) expects string, TYPO3\\\\\\\\CMS\\\\\\\\Core\\\\\\\\Http\\\\\\\\Uri given\\\\.$#\"",
          "3825:    count: 2",
          "3826:    path: ../../typo3/sysext/reports/Classes/Controller/ReportController.php",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "typo3/sysext/adminpanel/Classes/Controller/MainController.php||typo3/sysext/adminpanel/Classes/Controller/MainController.php": [
          "File: typo3/sysext/adminpanel/Classes/Controller/MainController.php -> typo3/sysext/adminpanel/Classes/Controller/MainController.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "130:                 $arguments,",
          "131:                 UriBuilder::SHAREABLE_URL",
          "132:             );",
          "138:             $view->assignMultiple(",
          "139:                 [",
          "",
          "[Removed Lines]",
          "135:             $requestDir = $request->getAttribute('normalizedParams')->getRequestDir();",
          "136:             $backendUrl = str_replace($requestDir, $requestDir . 'typo3/', $backendUrl);",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "typo3/sysext/backend/Classes/Controller/EditDocumentController.php||typo3/sysext/backend/Classes/Controller/EditDocumentController.php": [
          "File: typo3/sysext/backend/Classes/Controller/EditDocumentController.php -> typo3/sysext/backend/Classes/Controller/EditDocumentController.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "57: use TYPO3\\CMS\\Core\\Resource\\Exception\\InsufficientUserPermissionsException;",
          "58: use TYPO3\\CMS\\Core\\Resource\\FileInterface;",
          "59: use TYPO3\\CMS\\Core\\Resource\\ResourceFactory;",
          "60: use TYPO3\\CMS\\Core\\Type\\Bitmask\\Permission;",
          "61: use TYPO3\\CMS\\Core\\Type\\ContextualFeedbackSeverity;",
          "62: use TYPO3\\CMS\\Core\\Utility\\GeneralUtility;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "60: use TYPO3\\CMS\\Core\\Routing\\BackendEntryPointResolver;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "341:         protected readonly IconFactory $iconFactory,",
          "342:         protected readonly PageRenderer $pageRenderer,",
          "343:         protected readonly UriBuilder $uriBuilder,",
          "345:     ) {",
          "346:     }",
          "",
          "[Removed Lines]",
          "344:         protected readonly ModuleTemplateFactory $moduleTemplateFactory",
          "",
          "[Added Lines]",
          "345:         protected readonly ModuleTemplateFactory $moduleTemplateFactory,",
          "346:         protected readonly BackendEntryPointResolver $backendEntryPointResolver",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1269:                         $l18nParent",
          "1270:                     );",
          "1271:                 }",
          "1273:                 $this->registerColumnsOnlyButtonToButtonBar($buttonBar, ButtonBar::BUTTON_POSITION_LEFT, 7);",
          "1274:                 $this->registerHistoryButtonToButtonBar($buttonBar, ButtonBar::BUTTON_POSITION_RIGHT, 1);",
          "1275:             }",
          "",
          "[Removed Lines]",
          "1272:                 $this->registerDeleteButtonToButtonBar($buttonBar, ButtonBar::BUTTON_POSITION_LEFT, 6);",
          "",
          "[Added Lines]",
          "1274:                 $this->registerDeleteButtonToButtonBar($buttonBar, ButtonBar::BUTTON_POSITION_LEFT, 6, $request);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1497:     {",
          "1498:         if ($this->firstEl['deleteAccess']",
          "1499:             && !$this->getDisableDelete()",
          "",
          "[Removed Lines]",
          "1496:     protected function registerDeleteButtonToButtonBar(ButtonBar $buttonBar, string $position, int $group): void",
          "",
          "[Added Lines]",
          "1498:     protected function registerDeleteButtonToButtonBar(ButtonBar $buttonBar, string $position, int $group, ServerRequestInterface $request): void",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1508:                 $parsedUrl = parse_url($returnUrl);",
          "1510:                 parse_str($parsedUrl['query'] ?? '', $queryParams);",
          "1511:                 if ($routePath",
          "1512:                     && isset($queryParams['id'])",
          "",
          "[Removed Lines]",
          "1509:                 $routePath = str_replace(TYPO3_mainDir, '', $parsedUrl['path'] ?? '');",
          "",
          "[Added Lines]",
          "1511:                 $routePath = str_replace($this->backendEntryPointResolver->getPathFromRequest($request), '', $parsedUrl['path'] ?? '');",
          "",
          "---------------"
        ],
        "typo3/sysext/backend/Classes/Controller/LoginController.php||typo3/sysext/backend/Classes/Controller/LoginController.php": [
          "File: typo3/sysext/backend/Classes/Controller/LoginController.php -> typo3/sysext/backend/Classes/Controller/LoginController.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "43: use TYPO3\\CMS\\Core\\Localization\\LanguageService;",
          "44: use TYPO3\\CMS\\Core\\Localization\\Locales;",
          "45: use TYPO3\\CMS\\Core\\Page\\PageRenderer;",
          "46: use TYPO3\\CMS\\Core\\Utility\\GeneralUtility;",
          "47: use TYPO3\\CMS\\Fluid\\View\\StandaloneView;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "46: use TYPO3\\CMS\\Core\\Routing\\BackendEntryPointResolver;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "109:         protected readonly Context $context,",
          "110:         protected readonly LoginProviderResolver $loginProviderResolver,",
          "111:         protected readonly ExtensionConfiguration $extensionConfiguration,",
          "112:     ) {",
          "113:     }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "113:         protected readonly BackendEntryPointResolver $backendEntryPointResolver",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "121:         $this->request = $request;",
          "122:         $this->init($request);",
          "123:         $response = $this->createLoginLogoutForm($request);",
          "125:     }",
          "",
          "[Removed Lines]",
          "124:         return $this->appendLoginProviderCookie($request->getAttribute('normalizedParams'), $response);",
          "",
          "[Added Lines]",
          "126:         return $this->appendLoginProviderCookie($request, $request->getAttribute('normalizedParams'), $response);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "133:         $this->init($request);",
          "134:         $this->loginRefresh = true;",
          "135:         $response = $this->createLoginLogoutForm($request);",
          "137:     }",
          "",
          "[Removed Lines]",
          "136:         return $this->appendLoginProviderCookie($request->getAttribute('normalizedParams'), $response);",
          "",
          "[Added Lines]",
          "138:         return $this->appendLoginProviderCookie($request, $request->getAttribute('normalizedParams'), $response);",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "161:     {",
          "162:         if ($this->loginProviderIdentifier === $this->loginProviderResolver->getPrimaryLoginProviderIdentifier()) {",
          "163:             return $response;",
          "",
          "[Removed Lines]",
          "160:     protected function appendLoginProviderCookie(NormalizedParams $normalizedParams, ResponseInterface $response): ResponseInterface",
          "",
          "[Added Lines]",
          "162:     protected function appendLoginProviderCookie(ServerRequestInterface $request, NormalizedParams $normalizedParams, ResponseInterface $response): ResponseInterface",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "167:             'be_lastLoginProvider',",
          "168:             $this->loginProviderIdentifier,",
          "169:             $GLOBALS['EXEC_TIME'] + 7776000, // 90 days",
          "171:             '',",
          "172:             $normalizedParams->isHttps(),",
          "173:             true,",
          "",
          "[Removed Lines]",
          "170:             $normalizedParams->getSitePath() . TYPO3_mainDir,",
          "",
          "[Added Lines]",
          "172:             $this->backendEntryPointResolver->getPathFromRequest($request),",
          "",
          "---------------"
        ],
        "typo3/sysext/backend/Classes/Http/Application.php||typo3/sysext/backend/Classes/Http/Application.php": [
          "File: typo3/sysext/backend/Classes/Http/Application.php -> typo3/sysext/backend/Classes/Http/Application.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "28: use TYPO3\\CMS\\Core\\Core\\SystemEnvironmentBuilder;",
          "29: use TYPO3\\CMS\\Core\\Http\\AbstractApplication;",
          "30: use TYPO3\\CMS\\Core\\Http\\RedirectResponse;",
          "35: class Application extends AbstractApplication",
          "36: {",
          "47:     public function __construct(",
          "48:         RequestHandlerInterface $requestHandler,",
          "51:     ) {",
          "52:         $this->requestHandler = $requestHandler;",
          "55:     }",
          "57:     public function handle(ServerRequestInterface $request): ResponseInterface",
          "58:     {",
          "59:         if (!Bootstrap::checkIfEssentialConfigurationExists($this->configurationManager)) {",
          "61:         }",
          "",
          "[Removed Lines]",
          "40:     protected $configurationManager;",
          "45:     protected $context;",
          "49:         ConfigurationManager $configurationManager,",
          "50:         Context $context",
          "53:         $this->configurationManager = $configurationManager;",
          "54:         $this->context = $context;",
          "60:             return $this->installToolRedirect();",
          "",
          "[Added Lines]",
          "31: use TYPO3\\CMS\\Core\\Routing\\BackendEntryPointResolver;",
          "40:         protected readonly ConfigurationManager $configurationManager,",
          "41:         protected readonly Context $context,",
          "42:         protected readonly BackendEntryPointResolver $backendEntryPointResolver",
          "50:             return $this->installToolRedirect($request);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "77:     {",
          "79:     }",
          "",
          "[Removed Lines]",
          "76:     protected function installToolRedirect(): ResponseInterface",
          "78:         return new RedirectResponse('./install.php', 302);",
          "",
          "[Added Lines]",
          "64:     protected function installToolRedirect(ServerRequestInterface $request): ResponseInterface",
          "66:         return new RedirectResponse($this->backendEntryPointResolver->getPathFromRequest($request) . 'install.php', 302);",
          "",
          "---------------"
        ],
        "typo3/sysext/backend/Classes/Middleware/ForcedHttpsBackendRedirector.php||typo3/sysext/backend/Classes/Middleware/ForcedHttpsBackendRedirector.php": [
          "File: typo3/sysext/backend/Classes/Middleware/ForcedHttpsBackendRedirector.php -> typo3/sysext/backend/Classes/Middleware/ForcedHttpsBackendRedirector.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "22: use Psr\\Http\\Server\\MiddlewareInterface;",
          "23: use Psr\\Http\\Server\\RequestHandlerInterface;",
          "24: use TYPO3\\CMS\\Core\\Http\\RedirectResponse;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "25: use TYPO3\\CMS\\Core\\Routing\\BackendEntryPointResolver;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "35: class ForcedHttpsBackendRedirector implements MiddlewareInterface",
          "36: {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "38:     public function __construct(",
          "39:         protected readonly BackendEntryPointResolver $backendEntryPointResolver",
          "40:     ) {",
          "41:     }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "43:     {",
          "44:         if ((bool)$GLOBALS['TYPO3_CONF_VARS']['BE']['lockSSL'] && !$request->getAttribute('normalizedParams')->isHttps()) {",
          "45:             if ((int)$GLOBALS['TYPO3_CONF_VARS']['BE']['lockSSLPort']) {",
          "47:             } else {",
          "49:             }",
          "53:         }",
          "55:         return $handler->handle($request);",
          "",
          "[Removed Lines]",
          "46:                 $sslPortSuffix = ':' . (int)$GLOBALS['TYPO3_CONF_VARS']['BE']['lockSSLPort'];",
          "48:                 $sslPortSuffix = '';",
          "50:             [, $url] = explode('://', $request->getAttribute('normalizedParams')->getSiteUrl() . TYPO3_mainDir, 2);",
          "51:             [$server, $address] = explode('/', $url, 2);",
          "52:             return new RedirectResponse('https://' . $server . $sslPortSuffix . '/' . $address);",
          "",
          "[Added Lines]",
          "51:                 $sslPortSuffix = (int)$GLOBALS['TYPO3_CONF_VARS']['BE']['lockSSLPort'];",
          "53:                 $sslPortSuffix = null;",
          "55:             $backendUrl = $this->backendEntryPointResolver->getUriFromRequest($request)",
          "56:                 ->withScheme('https')",
          "57:                 ->withPort($sslPortSuffix);",
          "58:             return new RedirectResponse($backendUrl);",
          "",
          "---------------"
        ],
        "typo3/sysext/backend/Classes/Routing/UriBuilder.php||typo3/sysext/backend/Classes/Routing/UriBuilder.php": [
          "File: typo3/sysext/backend/Classes/Routing/UriBuilder.php -> typo3/sysext/backend/Classes/Routing/UriBuilder.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "16: namespace TYPO3\\CMS\\Backend\\Routing;",
          "18: use Psr\\Http\\Message\\ServerRequestInterface;",
          "19: use TYPO3\\CMS\\Backend\\Routing\\Exception\\MethodNotAllowedException;",
          "20: use TYPO3\\CMS\\Backend\\Routing\\Exception\\RouteNotFoundException;",
          "21: use TYPO3\\CMS\\Backend\\Routing\\Exception\\RouteTypeNotAllowedException;",
          "22: use TYPO3\\CMS\\Core\\Core\\Environment;",
          "23: use TYPO3\\CMS\\Core\\FormProtection\\FormProtectionFactory;",
          "25: use TYPO3\\CMS\\Core\\Http\\Uri;",
          "26: use TYPO3\\CMS\\Core\\SingletonInterface;",
          "27: use TYPO3\\CMS\\Core\\Utility\\GeneralUtility;",
          "28: use TYPO3\\CMS\\Core\\Utility\\HttpUtility;",
          "",
          "[Removed Lines]",
          "24: use TYPO3\\CMS\\Core\\Http\\NormalizedParams;",
          "",
          "[Added Lines]",
          "19: use Psr\\Http\\Message\\UriInterface;",
          "26: use TYPO3\\CMS\\Core\\Routing\\BackendEntryPointResolver;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "54:     const SHAREABLE_URL = 'share';",
          "",
          "[Removed Lines]",
          "59:     protected $router;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "73:     }",
          "",
          "[Removed Lines]",
          "70:     public function __construct(Router $router)",
          "71:     {",
          "72:         $this->router = $router;",
          "",
          "[Added Lines]",
          "65:     public function __construct(",
          "66:         protected readonly Router $router,",
          "67:         protected readonly BackendEntryPointResolver $backendEntryPointResolver",
          "68:     ) {",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "106:     {",
          "107:         if ($redirect === null) {",
          "108:             return $this->buildUriFromRoute($name, $parameters, $referenceType);",
          "",
          "[Removed Lines]",
          "105:     public function buildUriWithRedirect(string $name, array $parameters = [], RouteRedirect $redirect = null, string $referenceType = self::ABSOLUTE_PATH): Uri",
          "",
          "[Added Lines]",
          "101:     public function buildUriWithRedirect(string $name, array $parameters = [], RouteRedirect $redirect = null, string $referenceType = self::ABSOLUTE_PATH): UriInterface",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "173:     {",
          "174:         $path = ltrim($route . HttpUtility::buildQueryString($parameters, '?'), '/');",
          "175:         if ($referenceType === self::ABSOLUTE_PATH) {",
          "176:             $uri = PathUtility::getAbsoluteWebPath(Environment::getBackendPath() . '/' . $path);",
          "181:         } else {",
          "183:         }",
          "185:     }",
          "186: }",
          "",
          "[Removed Lines]",
          "172:     protected function buildUri(string $route, array $parameters, string $referenceType): Uri",
          "177:         } elseif (($GLOBALS['TYPO3_REQUEST'] ?? null) instanceof ServerRequestInterface",
          "178:             && $GLOBALS['TYPO3_REQUEST']->getAttribute('normalizedParams') instanceof NormalizedParams",
          "179:         ) {",
          "180:             $uri = $GLOBALS['TYPO3_REQUEST']->getAttribute('normalizedParams')->getRequestDir() . $path;",
          "182:             $uri = GeneralUtility::getIndpEnv('TYPO3_REQUEST_DIR') . $path;",
          "184:         return GeneralUtility::makeInstance(Uri::class, $uri);",
          "",
          "[Added Lines]",
          "168:     protected function buildUri(string $route, array $parameters, string $referenceType): UriInterface",
          "173:         } elseif (($GLOBALS['TYPO3_REQUEST'] ?? null) instanceof ServerRequestInterface) {",
          "174:             $uri = $this->backendEntryPointResolver->getUriFromRequest($GLOBALS['TYPO3_REQUEST'], $path);",
          "176:             $uri = $path;",
          "178:         return $uri instanceof UriInterface ? $uri : GeneralUtility::makeInstance(Uri::class, $uri);",
          "",
          "---------------"
        ],
        "typo3/sysext/backend/Classes/ServiceProvider.php||typo3/sysext/backend/Classes/ServiceProvider.php": [
          "File: typo3/sysext/backend/Classes/ServiceProvider.php -> typo3/sysext/backend/Classes/ServiceProvider.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "40: use TYPO3\\CMS\\Core\\Imaging\\IconRegistry;",
          "41: use TYPO3\\CMS\\Core\\Package\\AbstractServiceProvider;",
          "42: use TYPO3\\CMS\\Core\\Package\\Cache\\PackageDependentCacheIdentifier;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "43: use TYPO3\\CMS\\Core\\Routing\\BackendEntryPointResolver;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "92:         return new Application(",
          "93:             $requestHandler,",
          "94:             $container->get(ConfigurationManager::class),",
          "96:         );",
          "97:     }",
          "",
          "[Removed Lines]",
          "95:             $container->get(Context::class)",
          "",
          "[Added Lines]",
          "96:             $container->get(Context::class),",
          "97:             $container->get(BackendEntryPointResolver::class)",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "118:     {",
          "119:         return self::new($container, UriBuilder::class, [",
          "120:             $container->get(Router::class),",
          "121:         ]);",
          "122:     }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "123:             $container->get(BackendEntryPointResolver::class),",
          "",
          "---------------"
        ],
        "typo3/sysext/backend/Tests/Functional/Template/Components/Buttons/Action/ShortcutButtonTest.php||typo3/sysext/backend/Tests/Functional/Template/Components/Buttons/Action/ShortcutButtonTest.php": [
          "File: typo3/sysext/backend/Tests/Functional/Template/Components/Buttons/Action/ShortcutButtonTest.php -> typo3/sysext/backend/Tests/Functional/Template/Components/Buttons/Action/ShortcutButtonTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "20: use TYPO3\\CMS\\Backend\\Template\\Components\\Buttons\\Action\\ShortcutButton;",
          "21: use TYPO3\\CMS\\Core\\Core\\Bootstrap;",
          "22: use TYPO3\\TestingFramework\\Core\\Functional\\FunctionalTestCase;",
          "24: class ShortcutButtonTest extends FunctionalTestCase",
          "25: {",
          "26:     private const FIXTURES_PATH_PATTERN = __DIR__ . '/../../../Fixtures/%s.html';",
          "",
          "[Removed Lines]",
          "28:     protected function setUp(): void",
          "29:     {",
          "30:         parent::setUp();",
          "31:     }",
          "",
          "[Added Lines]",
          "22: use TYPO3\\CMS\\Core\\Core\\SystemEnvironmentBuilder;",
          "23: use TYPO3\\CMS\\Core\\Http\\NormalizedParams;",
          "24: use TYPO3\\CMS\\Core\\Http\\ServerRequest;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "65:         $this->importCSVDataSet(__DIR__ . '/../../../../Fixtures/be_users.csv');",
          "66:         $this->setUpBackendUser(1);",
          "67:         Bootstrap::initializeLanguageObject();",
          "69:         self::assertEquals(",
          "70:             $this->normalizeSpaces(file_get_contents(sprintf(self::FIXTURES_PATH_PATTERN, $expectedMarkupFile))),",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "66:         $serverParams = array_replace($_SERVER, ['HTTP_HOST' => 'example.com', 'SCRIPT_NAME' => '/typo3/index.php']);",
          "67:         $request = new ServerRequest('https://example.com/typo3/index.php', 'GET', null, $serverParams);",
          "68:         $GLOBALS['TYPO3_REQUEST'] = $request",
          "69:             ->withAttribute('applicationType', SystemEnvironmentBuilder::REQUESTTYPE_BE)",
          "70:             ->withAttribute('normalizedParams', NormalizedParams::createFromServerParams($serverParams));",
          "",
          "---------------"
        ],
        "typo3/sysext/backend/Tests/Functional/Template/Fixtures/RecordListCopyToClipboard.html||typo3/sysext/backend/Tests/Functional/Template/Fixtures/RecordListCopyToClipboard.html": [
          "File: typo3/sysext/backend/Tests/Functional/Template/Fixtures/RecordListCopyToClipboard.html -> typo3/sysext/backend/Tests/Functional/Template/Fixtures/RecordListCopyToClipboard.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "25:         </button>",
          "26:     </li>",
          "27:     <li>",
          "29:             <button type=\"button\" class=\"dropdown-item\">",
          "30:                 <span class=\"t3js-icon icon icon-size-small icon-state-default icon-actions-link\" data-identifier=\"actions-link\">",
          "31:                     <span class=\"icon-markup\">",
          "",
          "[Removed Lines]",
          "28:         <typo3-copy-to-clipboard text=\"http://vendor/phpunit/phpunit/module/web/list\">",
          "",
          "[Added Lines]",
          "28:         <typo3-copy-to-clipboard text=\"http://example.com/typo3/module/web/list\">",
          "",
          "---------------"
        ],
        "typo3/sysext/backend/Tests/Functional/Template/Fixtures/RecordListSingleTableCopyToClipboard.html||typo3/sysext/backend/Tests/Functional/Template/Fixtures/RecordListSingleTableCopyToClipboard.html": [
          "File: typo3/sysext/backend/Tests/Functional/Template/Fixtures/RecordListSingleTableCopyToClipboard.html -> typo3/sysext/backend/Tests/Functional/Template/Fixtures/RecordListSingleTableCopyToClipboard.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "25:         </button>",
          "26:     </li>",
          "27:     <li>",
          "29:             <button type=\"button\" class=\"dropdown-item\">",
          "30:                 <span class=\"t3js-icon icon icon-size-small icon-state-default icon-actions-link\" data-identifier=\"actions-link\">",
          "31:                     <span class=\"icon-markup\">",
          "",
          "[Removed Lines]",
          "28:         <typo3-copy-to-clipboard text=\"http://vendor/phpunit/phpunit/module/web/list?id=123&amp;table=some_table&amp;GET%5BclipBoard%5D=1\">",
          "",
          "[Added Lines]",
          "28:         <typo3-copy-to-clipboard text=\"http://example.com/typo3/module/web/list?id=123&amp;table=some_table&amp;GET%5BclipBoard%5D=1\">",
          "",
          "---------------"
        ],
        "typo3/sysext/backend/Tests/Functional/Template/Fixtures/SpecialRouteIdentifierWithArgumentsCopyToClipboard.html||typo3/sysext/backend/Tests/Functional/Template/Fixtures/SpecialRouteIdentifierWithArgumentsCopyToClipboard.html": [
          "File: typo3/sysext/backend/Tests/Functional/Template/Fixtures/SpecialRouteIdentifierWithArgumentsCopyToClipboard.html -> typo3/sysext/backend/Tests/Functional/Template/Fixtures/SpecialRouteIdentifierWithArgumentsCopyToClipboard.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "25:         </button>",
          "26:     </li>",
          "27:     <li>",
          "29:             <button type=\"button\" class=\"dropdown-item\">",
          "30:                 <span class=\"t3js-icon icon icon-size-small icon-state-default icon-actions-link\" data-identifier=\"actions-link\">",
          "31:                     <span class=\"icon-markup\">",
          "",
          "[Removed Lines]",
          "28:         <typo3-copy-to-clipboard text=\"http://vendor/phpunit/phpunit/record/edit?id=123&amp;edit%5Bpages%5D%5B123%5D=edit&amp;edit%5BoverrideVals%5D%5Bpages%5D%5Bsys_language_uid%5D=1\">",
          "",
          "[Added Lines]",
          "28:         <typo3-copy-to-clipboard text=\"http://example.com/typo3/record/edit?id=123&amp;edit%5Bpages%5D%5B123%5D=edit&amp;edit%5BoverrideVals%5D%5Bpages%5D%5Bsys_language_uid%5D=1\">",
          "",
          "---------------"
        ],
        "typo3/sysext/backend/Tests/Unit/Routing/UriBuilderTest.php||typo3/sysext/backend/Tests/Unit/Routing/UriBuilderTest.php": [
          "File: typo3/sysext/backend/Tests/Unit/Routing/UriBuilderTest.php -> typo3/sysext/backend/Tests/Unit/Routing/UriBuilderTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "21: use TYPO3\\CMS\\Backend\\Routing\\Route;",
          "22: use TYPO3\\CMS\\Backend\\Routing\\Router;",
          "23: use TYPO3\\CMS\\Backend\\Routing\\UriBuilder;",
          "24: use TYPO3\\CMS\\Core\\Utility\\StringUtility;",
          "25: use TYPO3\\TestingFramework\\Core\\Unit\\UnitTestCase;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "24: use TYPO3\\CMS\\Core\\Routing\\BackendEntryPointResolver;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "82:         foreach ($routes as $nameRoute => $route) {",
          "83:             $router->addRoute($nameRoute, $route);",
          "84:         }",
          "86:         $uri = $subject->buildUriFromRoute(",
          "87:             $routeName,",
          "88:             $routeParameters",
          "",
          "[Removed Lines]",
          "85:         $subject = new UriBuilder($router);",
          "",
          "[Added Lines]",
          "86:         $subject = new UriBuilder($router, new BackendEntryPointResolver());",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "98:     {",
          "99:         $this->expectException(RouteNotFoundException::class);",
          "100:         $this->expectExceptionCode(1476050190);",
          "102:         $subject->buildUriFromRoute(StringUtility::getUniqueId('any'));",
          "103:     }",
          "104: }",
          "",
          "[Removed Lines]",
          "101:         $subject = new UriBuilder(new Router());",
          "",
          "[Added Lines]",
          "102:         $subject = new UriBuilder(new Router(), new BackendEntryPointResolver());",
          "",
          "---------------"
        ],
        "typo3/sysext/backend/Tests/Unit/View/ArrayBrowserTest.php||typo3/sysext/backend/Tests/Unit/View/ArrayBrowserTest.php": [
          "File: typo3/sysext/backend/Tests/Unit/View/ArrayBrowserTest.php -> typo3/sysext/backend/Tests/Unit/View/ArrayBrowserTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "20: use TYPO3\\CMS\\Backend\\Routing\\Router;",
          "21: use TYPO3\\CMS\\Backend\\Routing\\UriBuilder;",
          "22: use TYPO3\\CMS\\Backend\\View\\ArrayBrowser;",
          "23: use TYPO3\\CMS\\Core\\Utility\\GeneralUtility;",
          "24: use TYPO3\\TestingFramework\\Core\\Unit\\UnitTestCase;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "23: use TYPO3\\CMS\\Core\\Routing\\BackendEntryPointResolver;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "36:     public function depthKeysWithEmptyFirstParameterAddsNothing(): void",
          "37:     {",
          "39:         $subject = new ArrayBrowser();",
          "40:         self::assertEquals([], $subject->depthKeys([], []));",
          "41:     }",
          "",
          "[Removed Lines]",
          "38:         GeneralUtility::setSingletonInstance(UriBuilder::class, new UriBuilder(new Router()));",
          "",
          "[Added Lines]",
          "39:         GeneralUtility::setSingletonInstance(UriBuilder::class, new UriBuilder(new Router(), new BackendEntryPointResolver()));",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "46:     public function depthKeysWithNumericKeyAddsOneNumberForKeyFromFirstArray(): void",
          "47:     {",
          "49:         $subject = new ArrayBrowser();",
          "50:         self::assertEquals([0 => 1], $subject->depthKeys(['foo'], []));",
          "51:     }",
          "",
          "[Removed Lines]",
          "48:         GeneralUtility::setSingletonInstance(UriBuilder::class, new UriBuilder(new Router()));",
          "",
          "[Added Lines]",
          "49:         GeneralUtility::setSingletonInstance(UriBuilder::class, new UriBuilder(new Router(), new BackendEntryPointResolver()));",
          "",
          "---------------"
        ],
        "typo3/sysext/core/Classes/Authentication/BackendUserAuthentication.php||typo3/sysext/core/Classes/Authentication/BackendUserAuthentication.php": [
          "File: typo3/sysext/core/Classes/Authentication/BackendUserAuthentication.php -> typo3/sysext/core/Classes/Authentication/BackendUserAuthentication.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "37: use TYPO3\\CMS\\Core\\Resource\\ResourceFactory;",
          "38: use TYPO3\\CMS\\Core\\Resource\\ResourceStorage;",
          "39: use TYPO3\\CMS\\Core\\Resource\\StorageRepository;",
          "40: use TYPO3\\CMS\\Core\\SysLog\\Action as SystemLogGenericAction;",
          "41: use TYPO3\\CMS\\Core\\SysLog\\Error as SystemLogErrorClassification;",
          "42: use TYPO3\\CMS\\Core\\SysLog\\Type;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "40: use TYPO3\\CMS\\Core\\Routing\\BackendEntryPointResolver;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2066:     {",
          "2067:         if (empty($this->user['uid'])) {",
          "2070:             throw new ImmediateResponseException(new RedirectResponse($url, 303), 1607271747);",
          "2071:         }",
          "2072:         if ($this->isUserAllowedToLogin()) {",
          "",
          "[Removed Lines]",
          "2069:             $url = $GLOBALS['TYPO3_REQUEST']->getAttribute('normalizedParams')->getSiteUrl() . TYPO3_mainDir;",
          "",
          "[Added Lines]",
          "2070:             $entryPointResolver = GeneralUtility::makeInstance(BackendEntryPointResolver::class);",
          "2071:             $url = $entryPointResolver->getUriFromRequest($GLOBALS['TYPO3_REQUEST']);",
          "",
          "---------------"
        ],
        "typo3/sysext/core/Classes/Core/SystemEnvironmentBuilder.php||typo3/sysext/core/Classes/Core/SystemEnvironmentBuilder.php": [
          "File: typo3/sysext/core/Classes/Core/SystemEnvironmentBuilder.php -> typo3/sysext/core/Classes/Core/SystemEnvironmentBuilder.php"
        ],
        "typo3/sysext/core/Classes/LinkHandling/LegacyLinkNotationConverter.php||typo3/sysext/core/Classes/LinkHandling/LegacyLinkNotationConverter.php": [
          "File: typo3/sysext/core/Classes/LinkHandling/LegacyLinkNotationConverter.php -> typo3/sysext/core/Classes/LinkHandling/LegacyLinkNotationConverter.php"
        ],
        "typo3/sysext/core/Classes/Routing/BackendEntryPointResolver.php||typo3/sysext/core/Classes/Routing/BackendEntryPointResolver.php": [
          "File: typo3/sysext/core/Classes/Routing/BackendEntryPointResolver.php -> typo3/sysext/core/Classes/Routing/BackendEntryPointResolver.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: <?php",
          "3: declare(strict_types=1);",
          "18: namespace TYPO3\\CMS\\Core\\Routing;",
          "20: use Psr\\Http\\Message\\ServerRequestInterface;",
          "21: use Psr\\Http\\Message\\UriInterface;",
          "22: use TYPO3\\CMS\\Core\\Http\\NormalizedParams;",
          "23: use TYPO3\\CMS\\Core\\Http\\Uri;",
          "28: class BackendEntryPointResolver",
          "29: {",
          "30:     protected string $path = 'typo3/';",
          "35:     public function getPathFromRequest(ServerRequestInterface $request): string",
          "36:     {",
          "37:         if ($request->getAttribute('normalizedParams') instanceof NormalizedParams) {",
          "38:             $normalizedParams = $request->getAttribute('normalizedParams');",
          "39:         } else {",
          "40:             $normalizedParams = NormalizedParams::createFromRequest($request);",
          "41:         }",
          "42:         return $normalizedParams->getSitePath() . $this->path;",
          "43:     }",
          "48:     public function getUriFromRequest(ServerRequestInterface $request, string $additionalPathPart = ''): UriInterface",
          "49:     {",
          "50:         if ($request->getAttribute('normalizedParams') instanceof NormalizedParams) {",
          "51:             $normalizedParams = $request->getAttribute('normalizedParams');",
          "52:         } else {",
          "53:             $normalizedParams = NormalizedParams::createFromRequest($request);",
          "54:         }",
          "55:         return new Uri($normalizedParams->getSiteUrl() . $this->path . ltrim($additionalPathPart, '/'));",
          "56:     }",
          "57: }",
          "",
          "---------------"
        ],
        "typo3/sysext/core/Classes/ServiceProvider.php||typo3/sysext/core/Classes/ServiceProvider.php": [
          "File: typo3/sysext/core/Classes/ServiceProvider.php -> typo3/sysext/core/Classes/ServiceProvider.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "80:             Middleware\\VerifyHostHeader::class => [ static::class, 'getVerifyHostHeaderMiddleware' ],",
          "81:             Package\\FailsafePackageManager::class => [ static::class, 'getFailsafePackageManager' ],",
          "82:             Package\\Cache\\PackageDependentCacheIdentifier::class => [ static::class, 'getPackageDependentCacheIdentifier' ],",
          "83:             Registry::class => [ static::class, 'getRegistry' ],",
          "84:             Resource\\Index\\FileIndexRepository::class => [ static::class, 'getFileIndexRepository' ],",
          "85:             Resource\\Index\\MetaDataRepository::class => [ static::class, 'getMetaDataRepository' ],",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "83:             Routing\\BackendEntryPointResolver::class => [ static::class, 'getBackendEntryPointResolver' ],",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "482:         return self::new($container, TypoScript\\TypoScriptService::class);",
          "483:     }",
          "485:     public static function getGuzzleClientFactory(ContainerInterface $container): Http\\Client\\GuzzleClientFactory",
          "486:     {",
          "487:         return new Http\\Client\\GuzzleClientFactory();",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "486:     public static function getBackendEntryPointResolver(ContainerInterface $container): Routing\\BackendEntryPointResolver",
          "487:     {",
          "488:         return self::new($container, Routing\\BackendEntryPointResolver::class);",
          "489:     }",
          "",
          "---------------"
        ],
        "typo3/sysext/extbase/Tests/Unit/Mvc/Web/Routing/UriBuilderTest.php||typo3/sysext/extbase/Tests/Unit/Mvc/Web/Routing/UriBuilderTest.php": [
          "File: typo3/sysext/extbase/Tests/Unit/Mvc/Web/Routing/UriBuilderTest.php -> typo3/sysext/extbase/Tests/Unit/Mvc/Web/Routing/UriBuilderTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "23: use TYPO3\\CMS\\Backend\\Routing\\Route;",
          "24: use TYPO3\\CMS\\Backend\\Routing\\Router;",
          "25: use TYPO3\\CMS\\Backend\\Routing\\UriBuilder as BackendUriBuilder;",
          "26: use TYPO3\\CMS\\Core\\Http\\ServerRequest;",
          "27: use TYPO3\\CMS\\Core\\Http\\Uri;",
          "28: use TYPO3\\CMS\\Core\\Utility\\GeneralUtility;",
          "29: use TYPO3\\CMS\\Extbase\\Configuration\\ConfigurationManager;",
          "30: use TYPO3\\CMS\\Extbase\\Configuration\\ConfigurationManagerInterface;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "26: use TYPO3\\CMS\\Core\\Core\\SystemEnvironmentBuilder;",
          "27: use TYPO3\\CMS\\Core\\Http\\NormalizedParams;",
          "30: use TYPO3\\CMS\\Core\\Routing\\BackendEntryPointResolver;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "92:         $router->addRoute('module_key', new Route('/test/Path', []));",
          "93:         $router->addRoute('module_key2', new Route('/test/Path2', []));",
          "94:         $router->addRoute('', new Route('', []));",
          "96:     }",
          "",
          "[Removed Lines]",
          "95:         GeneralUtility::setSingletonInstance(BackendUriBuilder::class, new BackendUriBuilder($router));",
          "",
          "[Added Lines]",
          "98:         GeneralUtility::setSingletonInstance(BackendUriBuilder::class, new BackendUriBuilder($router, new BackendEntryPointResolver()));",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "190:     public function uriForSetsPluginNameFromRequestIfPluginNameIsNotSetInFrontend(): void",
          "191:     {",
          "193:         $this->mockExtensionService->expects(self::once())->method('getPluginNamespace')->willReturn('tx_someextension_somepluginnamefromrequest');",
          "194:         $this->mockRequest->expects(self::once())->method('getPluginName')->willReturn('SomePluginNameFromRequest');",
          "195:         $expectedArguments = ['tx_someextension_somepluginnamefromrequest' => ['controller' => 'SomeController']];",
          "",
          "[Removed Lines]",
          "192:         $GLOBALS['TYPO3_REQUEST'] = (new ServerRequest(new Uri('')))->withAttribute('applicationType', 1);",
          "",
          "[Added Lines]",
          "195:         $GLOBALS['TYPO3_REQUEST'] = (new ServerRequest(new Uri('')))->withAttribute('applicationType', SystemEnvironmentBuilder::REQUESTTYPE_FE);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "213:     public function buildBackendUriKeepsQueryParametersIfAddQueryStringIsSet(): void",
          "214:     {",
          "216:         $_GET['id'] = 'pageId';",
          "217:         $_GET['foo'] = 'bar';",
          "218:         $_POST = [];",
          "219:         $this->uriBuilder->setAddQueryString(true);",
          "220:         $expectedResult = '/typo3/test/Path?token=dummyToken&id=pageId&foo=bar';",
          "",
          "[Removed Lines]",
          "215:         $GLOBALS['TYPO3_REQUEST'] = $this->getRequestWithRouteAttribute();",
          "",
          "[Added Lines]",
          "220:         $GLOBALS['TYPO3_REQUEST'] = $this->getRequestWithRouteAttribute()->withQueryParams($_GET);",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "228:     public function buildBackendUriRouteAttributeOverrulesGetParameterIfAddQueryStringIsSet(): void",
          "229:     {",
          "231:         $_GET = ['route' => 'test/Path', 'id' => 'pageId', 'foo' => 'bar'];",
          "232:         $_POST = [];",
          "233:         $this->uriBuilder->setAddQueryString(true);",
          "234:         $expectedResult = '/typo3/test/Path2?token=dummyToken&id=pageId&foo=bar';",
          "235:         $actualResult = $this->uriBuilder->buildBackendUri();",
          "",
          "[Removed Lines]",
          "230:         $GLOBALS['TYPO3_REQUEST'] = $this->getRequestWithRouteAttribute('test/Path2');",
          "",
          "[Added Lines]",
          "235:         $GLOBALS['TYPO3_REQUEST'] = $this->getRequestWithRouteAttribute('test/Path2')->withQueryParams($_GET);",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "323:     public function buildBackendUriKeepsModuleQueryParametersIfAddQueryStringIsNotSet(): void",
          "324:     {",
          "326:         $_GET = (['id' => 'pageId', 'foo' => 'bar']);",
          "327:         $expectedResult = '/typo3/test/Path?token=dummyToken&id=pageId';",
          "328:         $actualResult = $this->uriBuilder->buildBackendUri();",
          "329:         self::assertEquals($expectedResult, $actualResult);",
          "",
          "[Removed Lines]",
          "325:         $GLOBALS['TYPO3_REQUEST'] = $this->getRequestWithRouteAttribute();",
          "",
          "[Added Lines]",
          "329:         $GLOBALS['TYPO3_REQUEST'] = $this->getRequestWithRouteAttribute()->withQueryParams($_GET);",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "335:     public function buildBackendUriMergesAndOverrulesQueryParametersWithArguments(): void",
          "336:     {",
          "338:         $_GET = ['id' => 'pageId', 'foo' => 'bar'];",
          "339:         $this->uriBuilder->setArguments(['route' => '/test/Path2', 'somePrefix' => ['bar' => 'baz']]);",
          "340:         $expectedResult = '/typo3/test/Path2?token=dummyToken&id=pageId&somePrefix%5Bbar%5D=baz';",
          "341:         $actualResult = $this->uriBuilder->buildBackendUri();",
          "",
          "[Removed Lines]",
          "337:         $GLOBALS['TYPO3_REQUEST'] = $this->getRequestWithRouteAttribute();",
          "",
          "[Added Lines]",
          "341:         $GLOBALS['TYPO3_REQUEST'] = $this->getRequestWithRouteAttribute()->withQueryParams($_GET);",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "374:     public function buildBackendUriCreatesAbsoluteUrisIfSpecified(): void",
          "375:     {",
          "377:         $_SERVER['HTTP_HOST'] = 'baseuri';",
          "380:         $_SERVER['REMOTE_ADDR'] = '127.0.0.1';",
          "381:         $this->uriBuilder->setCreateAbsoluteUri(true);",
          "383:         $actualResult = $this->uriBuilder->buildBackendUri();",
          "384:         self::assertSame($expectedResult, $actualResult);",
          "385:     }",
          "",
          "[Removed Lines]",
          "376:         $GLOBALS['TYPO3_REQUEST'] = $this->getRequestWithRouteAttribute();",
          "378:         $_SERVER['SCRIPT_NAME'] = '/typo3/index.php';",
          "379:         $_SERVER['ORIG_SCRIPT_NAME'] = '/typo3/index.php';",
          "382:         $expectedResult = 'http://baseuri/' . TYPO3_mainDir . 'test/Path?token=dummyToken';",
          "",
          "[Added Lines]",
          "380:         $_SERVER['SCRIPT_NAME'] = '/index.php';",
          "381:         $_SERVER['ORIG_SCRIPT_NAME'] = '/index.php';",
          "383:         $GLOBALS['TYPO3_REQUEST'] = $this->getRequestWithRouteAttribute()",
          "384:             ->withAttribute('applicationType', SystemEnvironmentBuilder::REQUESTTYPE_BE)",
          "385:             ->withAttribute('normalizedParams', NormalizedParams::createFromServerParams($_SERVER));",
          "387:         $expectedResult = 'http://baseuri/typo3/test/Path?token=dummyToken';",
          "",
          "---------------"
        ],
        "typo3/sysext/felogin/Tests/Unit/Validation/RedirectUrlValidatorTest.php||typo3/sysext/felogin/Tests/Unit/Validation/RedirectUrlValidatorTest.php": [
          "File: typo3/sysext/felogin/Tests/Unit/Validation/RedirectUrlValidatorTest.php -> typo3/sysext/felogin/Tests/Unit/Validation/RedirectUrlValidatorTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "24: use TYPO3\\CMS\\Core\\Http\\ServerRequestFactory;",
          "25: use TYPO3\\CMS\\Core\\Site\\Entity\\Site;",
          "26: use TYPO3\\CMS\\Core\\Site\\SiteFinder;",
          "27: use TYPO3\\CMS\\FrontendLogin\\Validation\\RedirectUrlValidator;",
          "28: use TYPO3\\TestingFramework\\Core\\Unit\\UnitTestCase;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "27: use TYPO3\\CMS\\Core\\Utility\\GeneralUtility;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "76:     protected function setUpFakeSitePathAndHost(): void",
          "77:     {",
          "79:         $_SERVER['HTTP_HOST'] = $this->testHostName;",
          "81:         $request = ServerRequestFactory::fromGlobals();",
          "",
          "[Removed Lines]",
          "78:         $_SERVER['ORIG_PATH_INFO'] = $_SERVER['PATH_INFO'] = $_SERVER['ORIG_SCRIPT_NAME'] = $_SERVER['SCRIPT_NAME'] = $this->testSitePath . TYPO3_mainDir;",
          "",
          "[Added Lines]",
          "79:         $_SERVER['ORIG_PATH_INFO'] = $_SERVER['PATH_INFO'] = $_SERVER['ORIG_SCRIPT_NAME'] = $_SERVER['SCRIPT_NAME'] = $this->testSitePath . 'index.php';",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "122:             Environment::getPublicPath(),",
          "123:             Environment::getVarPath(),",
          "124:             Environment::getConfigPath(),",
          "126:             Environment::isWindows() ? 'WINDOWS' : 'UNIX'",
          "127:         );",
          "128:         self::assertFalse($this->accessibleFixture->isValid($url));",
          "",
          "[Removed Lines]",
          "125:             Environment::getBackendPath() . '/index.php',",
          "",
          "[Added Lines]",
          "126:             Environment::getPublicPath() . '/index.php',",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "160:             Environment::getPublicPath(),",
          "161:             Environment::getVarPath(),",
          "162:             Environment::getConfigPath(),",
          "164:             Environment::isWindows() ? 'WINDOWS' : 'UNIX'",
          "165:         );",
          "166:         self::assertTrue($this->accessibleFixture->isValid($url));",
          "",
          "[Removed Lines]",
          "163:             Environment::getBackendPath() . '/index.php',",
          "",
          "[Added Lines]",
          "164:             Environment::getPublicPath() . '/index.php',",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "188:     public function validateRedirectUrlClearsInvalidUrlInSubdirectory(string $url): void",
          "189:     {",
          "190:         $this->testSitePath = '/subdir/';",
          "191:         $this->setUpFakeSitePathAndHost();",
          "192:         self::assertFalse($this->accessibleFixture->isValid($url));",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "191:         GeneralUtility::flushInternalRuntimeCaches();",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "222:             Environment::getPublicPath(),",
          "223:             Environment::getVarPath(),",
          "224:             Environment::getConfigPath(),",
          "226:             Environment::isWindows() ? 'WINDOWS' : 'UNIX'",
          "227:         );",
          "228:         $this->testSitePath = '/subdir/';",
          "",
          "[Removed Lines]",
          "225:             Environment::getBackendPath() . '/index.php',",
          "",
          "[Added Lines]",
          "227:             Environment::getPublicPath() . '/index.php',",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "280:             Environment::getPublicPath(),",
          "281:             Environment::getVarPath(),",
          "282:             Environment::getConfigPath(),",
          "284:             Environment::isWindows() ? 'WINDOWS' : 'UNIX'",
          "285:         );",
          "286:         $_SERVER['HTTP_HOST'] = $host;",
          "",
          "[Removed Lines]",
          "283:             Environment::getBackendPath() . '/index.php',",
          "",
          "[Added Lines]",
          "285:             Environment::getPublicPath() . '/index.php',",
          "",
          "---------------"
        ],
        "typo3/sysext/fluid/Classes/ViewHelpers/Be/LinkViewHelper.php||typo3/sysext/fluid/Classes/ViewHelpers/Be/LinkViewHelper.php": [
          "File: typo3/sysext/fluid/Classes/ViewHelpers/Be/LinkViewHelper.php -> typo3/sysext/fluid/Classes/ViewHelpers/Be/LinkViewHelper.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "68:         $parameters = $this->arguments['parameters'];",
          "69:         $referenceType = $this->arguments['referenceType'];",
          "70:         $uri = $uriBuilder->buildUriFromRoute($route, $parameters, $referenceType);",
          "72:         $this->tag->setContent((string)$this->renderChildren());",
          "73:         $this->tag->forceClosingTag(true);",
          "74:         return $this->tag->render();",
          "",
          "[Removed Lines]",
          "71:         $this->tag->addAttribute('href', $uri);",
          "",
          "[Added Lines]",
          "71:         $this->tag->addAttribute('href', (string)$uri);",
          "",
          "---------------"
        ],
        "typo3/sysext/fluid/Tests/Functional/ViewHelpers/Be/LinkViewHelperTest.php||typo3/sysext/fluid/Tests/Functional/ViewHelpers/Be/LinkViewHelperTest.php": [
          "File: typo3/sysext/fluid/Tests/Functional/ViewHelpers/Be/LinkViewHelperTest.php -> typo3/sysext/fluid/Tests/Functional/ViewHelpers/Be/LinkViewHelperTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "20: use TYPO3\\CMS\\Backend\\Routing\\Router;",
          "21: use TYPO3\\CMS\\Backend\\Routing\\UriBuilder;",
          "22: use TYPO3\\CMS\\Core\\Utility\\GeneralUtility;",
          "23: use TYPO3\\CMS\\Fluid\\Core\\Rendering\\RenderingContextFactory;",
          "24: use TYPO3\\TestingFramework\\Core\\Functional\\FunctionalTestCase;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "22: use TYPO3\\CMS\\Core\\Routing\\BackendEntryPointResolver;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "34:     public function renderRendersTagWithHrefFromRoute(): void",
          "35:     {",
          "38:         $uriBuilderMock->expects(self::once())->method('buildUriFromRoute')",
          "39:             ->with('theRouteArgument', ['parameter' => 'to pass'], 'theReferenceTypeArgument')->willReturn('theUri');",
          "40:         GeneralUtility::setSingletonInstance(UriBuilder::class, $uriBuilderMock);",
          "",
          "[Removed Lines]",
          "37:         $uriBuilderMock = $this->getMockBuilder(UriBuilder::class)->setConstructorArgs([new Router()])->getMock();",
          "",
          "[Added Lines]",
          "38:         $uriBuilderMock = $this->getMockBuilder(UriBuilder::class)->setConstructorArgs([new Router(), new BackendEntryPointResolver()])->getMock();",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "52:     public function renderPassesEmptyArrayToUriBuilderForNoParameters(): void",
          "53:     {",
          "56:         $uriBuilderMock->expects(self::once())->method('buildUriFromRoute')",
          "57:             ->with('theRouteArgument', [], 'theReferenceTypeArgument')->willReturn('theUri');",
          "58:         GeneralUtility::setSingletonInstance(UriBuilder::class, $uriBuilderMock);",
          "",
          "[Removed Lines]",
          "55:         $uriBuilderMock = $this->getMockBuilder(UriBuilder::class)->setConstructorArgs([new Router()])->getMock();",
          "",
          "[Added Lines]",
          "56:         $uriBuilderMock = $this->getMockBuilder(UriBuilder::class)->setConstructorArgs([new Router(), new BackendEntryPointResolver()])->getMock();",
          "",
          "---------------"
        ],
        "typo3/sysext/fluid/Tests/Functional/ViewHelpers/Be/UriViewHelperTest.php||typo3/sysext/fluid/Tests/Functional/ViewHelpers/Be/UriViewHelperTest.php": [
          "File: typo3/sysext/fluid/Tests/Functional/ViewHelpers/Be/UriViewHelperTest.php -> typo3/sysext/fluid/Tests/Functional/ViewHelpers/Be/UriViewHelperTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "20: use TYPO3\\CMS\\Backend\\Routing\\Router;",
          "21: use TYPO3\\CMS\\Backend\\Routing\\UriBuilder;",
          "22: use TYPO3\\CMS\\Core\\Utility\\GeneralUtility;",
          "23: use TYPO3\\CMS\\Fluid\\Core\\Rendering\\RenderingContextFactory;",
          "24: use TYPO3\\TestingFramework\\Core\\Functional\\FunctionalTestCase;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "22: use TYPO3\\CMS\\Core\\Routing\\BackendEntryPointResolver;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "34:     public function renderRendersTagWithHrefFromRoute(): void",
          "35:     {",
          "38:         $uriBuilderMock->expects(self::once())->method('buildUriFromRoute')",
          "39:             ->with('theRouteArgument', ['parameter' => 'to pass'], 'theReferenceTypeArgument')->willReturn('theUri');",
          "40:         GeneralUtility::setSingletonInstance(UriBuilder::class, $uriBuilderMock);",
          "",
          "[Removed Lines]",
          "37:         $uriBuilderMock = $this->getMockBuilder(UriBuilder::class)->setConstructorArgs([new Router()])->getMock();",
          "",
          "[Added Lines]",
          "38:         $uriBuilderMock = $this->getMockBuilder(UriBuilder::class)->setConstructorArgs([new Router(), new BackendEntryPointResolver()])->getMock();",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "52:     public function renderPassesEmptyArrayToUriBuilderForNoParameters(): void",
          "53:     {",
          "56:         $uriBuilderMock->expects(self::once())->method('buildUriFromRoute')",
          "57:             ->with('theRouteArgument', [], 'theReferenceTypeArgument')->willReturn('theUri');",
          "58:         GeneralUtility::setSingletonInstance(UriBuilder::class, $uriBuilderMock);",
          "",
          "[Removed Lines]",
          "55:         $uriBuilderMock = $this->getMockBuilder(UriBuilder::class)->setConstructorArgs([new Router()])->getMock();",
          "",
          "[Added Lines]",
          "56:         $uriBuilderMock = $this->getMockBuilder(UriBuilder::class)->setConstructorArgs([new Router(), new BackendEntryPointResolver()])->getMock();",
          "",
          "---------------"
        ],
        "typo3/sysext/frontend/Classes/Http/Application.php||typo3/sysext/frontend/Classes/Http/Application.php": [
          "File: typo3/sysext/frontend/Classes/Http/Application.php -> typo3/sysext/frontend/Classes/Http/Application.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "30: use TYPO3\\CMS\\Core\\Core\\SystemEnvironmentBuilder;",
          "31: use TYPO3\\CMS\\Core\\Http\\AbstractApplication;",
          "32: use TYPO3\\CMS\\Core\\Http\\RedirectResponse;",
          "37: class Application extends AbstractApplication",
          "38: {",
          "49:     public function __construct(",
          "50:         RequestHandlerInterface $requestHandler,",
          "53:     ) {",
          "54:         $this->requestHandler = $requestHandler;",
          "57:     }",
          "59:     public function handle(ServerRequestInterface $request): ResponseInterface",
          "60:     {",
          "61:         if (!Bootstrap::checkIfEssentialConfigurationExists($this->configurationManager)) {",
          "63:         }",
          "",
          "[Removed Lines]",
          "42:     protected $configurationManager;",
          "47:     protected $context;",
          "51:         ConfigurationManager $configurationManager,",
          "52:         Context $context",
          "55:         $this->configurationManager = $configurationManager;",
          "56:         $this->context = $context;",
          "62:             return $this->installToolRedirect();",
          "",
          "[Added Lines]",
          "33: use TYPO3\\CMS\\Core\\Routing\\BackendEntryPointResolver;",
          "42:         protected readonly ConfigurationManager $configurationManager,",
          "43:         protected readonly Context $context,",
          "44:         protected readonly BackendEntryPointResolver $backendEntryPointResolver",
          "52:             return $this->installToolRedirect($request);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "78:     {",
          "81:     }",
          "",
          "[Removed Lines]",
          "77:     protected function installToolRedirect(): ResponseInterface",
          "79:         $path = TYPO3_mainDir . 'install.php';",
          "80:         return new RedirectResponse($path, 302);",
          "",
          "[Added Lines]",
          "65:     protected function installToolRedirect(ServerRequestInterface $request): ResponseInterface",
          "67:         return new RedirectResponse($this->backendEntryPointResolver->getPathFromRequest($request) . 'install.php', 302);",
          "",
          "---------------"
        ],
        "typo3/sysext/frontend/Classes/ServiceProvider.php||typo3/sysext/frontend/Classes/ServiceProvider.php": [
          "File: typo3/sysext/frontend/Classes/ServiceProvider.php -> typo3/sysext/frontend/Classes/ServiceProvider.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "28: use TYPO3\\CMS\\Core\\Http\\MiddlewareDispatcher;",
          "29: use TYPO3\\CMS\\Core\\Http\\MiddlewareStackResolver;",
          "30: use TYPO3\\CMS\\Core\\Package\\AbstractServiceProvider;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "31: use TYPO3\\CMS\\Core\\Routing\\BackendEntryPointResolver;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "63:         return new Http\\Application(",
          "64:             $requestHandler,",
          "65:             $container->get(ConfigurationManager::class),",
          "67:         );",
          "68:     }",
          "",
          "[Removed Lines]",
          "66:             $container->get(Context::class)",
          "",
          "[Added Lines]",
          "67:             $container->get(Context::class),",
          "68:             $container->get(BackendEntryPointResolver::class)",
          "",
          "---------------"
        ],
        "typo3/sysext/install/Classes/Controller/BackendModuleController.php||typo3/sysext/install/Classes/Controller/BackendModuleController.php": [
          "File: typo3/sysext/install/Classes/Controller/BackendModuleController.php -> typo3/sysext/install/Classes/Controller/BackendModuleController.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "20: use Psr\\Http\\Message\\ResponseInterface;",
          "21: use Psr\\Http\\Message\\ServerRequestInterface;",
          "22: use TYPO3\\CMS\\Backend\\Routing\\UriBuilder;",
          "23: use TYPO3\\CMS\\Backend\\Template\\ModuleTemplateFactory;",
          "24: use TYPO3\\CMS\\Core\\Authentication\\AbstractAuthenticationService;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "22: use Psr\\Http\\Message\\UriInterface;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "28: use TYPO3\\CMS\\Core\\Crypto\\PasswordHashing\\PasswordHashFactory;",
          "29: use TYPO3\\CMS\\Core\\Http\\HtmlResponse;",
          "30: use TYPO3\\CMS\\Core\\Http\\RedirectResponse;",
          "32: use TYPO3\\CMS\\Core\\Utility\\GeneralUtility;",
          "33: use TYPO3\\CMS\\Core\\Utility\\PathUtility;",
          "34: use TYPO3\\CMS\\Install\\Service\\SessionService;",
          "",
          "[Removed Lines]",
          "31: use TYPO3\\CMS\\Core\\Http\\Uri;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "161:         return new RedirectResponse((string)$redirectUri, 403);",
          "162:     }",
          "165:     {",
          "166:         return $this->uriBuilder->buildUriFromRoute(",
          "167:             'install.backend-user-confirmation',",
          "",
          "[Removed Lines]",
          "164:     protected function getBackendUserConfirmationUri(array $parameters): Uri",
          "",
          "[Added Lines]",
          "164:     protected function getBackendUserConfirmationUri(array $parameters): UriInterface",
          "",
          "---------------"
        ],
        "typo3/sysext/install/Classes/Http/Application.php||typo3/sysext/install/Classes/Http/Application.php": [
          "File: typo3/sysext/install/Classes/Http/Application.php -> typo3/sysext/install/Classes/Http/Application.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "33: class Application extends AbstractApplication",
          "34: {",
          "40:     public function __construct(",
          "41:         RequestHandlerInterface $requestHandler,",
          "43:     ) {",
          "44:         $this->requestHandler = $requestHandler;",
          "46:     }",
          "48:     public function handle(ServerRequestInterface $request): ResponseInterface",
          "",
          "[Removed Lines]",
          "38:     protected $context;",
          "42:         Context $context",
          "45:         $this->context = $context;",
          "",
          "[Added Lines]",
          "37:         protected readonly Context $context",
          "",
          "---------------"
        ],
        "typo3/sysext/install/Configuration/ExtensionScanner/Php/ConstantMatcher.php||typo3/sysext/install/Configuration/ExtensionScanner/Php/ConstantMatcher.php": [
          "File: typo3/sysext/install/Configuration/ExtensionScanner/Php/ConstantMatcher.php -> typo3/sysext/install/Configuration/ExtensionScanner/Php/ConstantMatcher.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "283:             'Breaking-96107-DeprecatedFunctionalityRemoved.rst',",
          "284:         ],",
          "285:     ],",
          "286: ];",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "286:     'TYPO3_mainDir' => [",
          "287:         'restFiles' => [",
          "288:             'Deprecation-98283-PHPConstantTYPO3_mainDir.rst',",
          "289:         ],",
          "290:     ],",
          "",
          "---------------"
        ],
        "typo3/sysext/reports/Classes/Controller/ReportController.php||typo3/sysext/reports/Classes/Controller/ReportController.php": [
          "File: typo3/sysext/reports/Classes/Controller/ReportController.php -> typo3/sysext/reports/Classes/Controller/ReportController.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "139:         $menu->setIdentifier('WebFuncJumpMenu');",
          "140:         $menuItem = $menu->makeMenuItem()",
          "141:             ->setHref(",
          "143:             )",
          "144:             ->setTitle($languageService->sL('LLL:EXT:reports/Resources/Private/Language/locallang.xlf:reports_overview'));",
          "145:         $menu->addMenuItem($menuItem);",
          "146:         foreach ($this->reportRegistry->getReports() as $report) {",
          "147:             $menuItem = $menu->makeMenuItem()",
          "149:                     'system_reports',",
          "150:                     ['action' => 'detail', 'report' => $report->getIdentifier()]",
          "151:                 ))",
          "",
          "[Removed Lines]",
          "142:                 $this->uriBuilder->buildUriFromRoute('system_reports', ['action' => 'index'])",
          "148:                 ->setHref($this->uriBuilder->buildUriFromRoute(",
          "",
          "[Added Lines]",
          "142:                 (string)$this->uriBuilder->buildUriFromRoute('system_reports', ['action' => 'index'])",
          "148:                 ->setHref((string)$this->uriBuilder->buildUriFromRoute(",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "fa9832df37101579d5d52498616cb31e37ac3804",
      "candidate_info": {
        "commit_hash": "fa9832df37101579d5d52498616cb31e37ac3804",
        "repo": "TYPO3/typo3",
        "commit_url": "https://github.com/TYPO3/typo3/commit/fa9832df37101579d5d52498616cb31e37ac3804",
        "files": [
          "typo3/sysext/core/Classes/Core/SystemEnvironmentBuilder.php",
          "typo3/sysext/core/Classes/Http/NormalizedParams.php",
          "typo3/sysext/core/Classes/Utility/GeneralUtility.php",
          "typo3/sysext/core/Tests/Unit/Http/NormalizedParamsTest.php",
          "typo3/sysext/core/Tests/Unit/Log/Processor/WebProcessorTest.php",
          "typo3/sysext/core/Tests/Unit/Resource/ResourceCompressorTest.php",
          "typo3/sysext/extbase/Tests/Unit/Mvc/Web/Routing/UriBuilderTest.php",
          "typo3/sysext/felogin/Tests/Unit/Validation/RedirectUrlValidatorTest.php",
          "typo3/sysext/fluid/Tests/Unit/Core/Widget/WidgetRequestBuilderTest.php",
          "typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php"
        ],
        "message": "[SECURITY] Prevent XSS due to wrong PATH_INFO evaluation\n\nAs already started in #88304 (but only for NormalizedParams)\nand later reverted in #89312 (because of cgi-bin problems),\nPATH_INFO is no longer considered as a preferable SCRIPT_NAME\nalternative. All known server configurations set SCRIPT_NAME\nthese days to a proper value when cgi.fix_pathinfo is set.\n\nThe fallback to PATH_INFO has been introduced with\nthe initial revision of TYPO3 and isn't needed at all nowadays,\nit's actually wrong, as a REQUEST_URI like /index.php/foo/bar\nwould incorrectly be interpreted as $scriptName == \"/foo/bar\",\nwhich let's all calculations on $scriptName fail and\neven leads to XSS where values derived from $scriptName are\nprinted without being escaped.\n\nAlso any ORIG_SCRIPT_NAME evaluation is dropped, as this variable\ncontains the SCRIPT_NAME that was set by the webserver configuration\nbefore PHP applied cgi.fix_pathinfo. Using ORIG_SCRIPT_NAME\neffectively meant bypassing PHP's pathinfo fix. It usually contains\nthe cgi-wrapper paths, which is why PATH_INFO was used to overrule\nwrong ORIG_SCRIPT_NAME values.\n\nGeneralUtility::getIndpEnv('PATH_INFO') is adapted to trust the\nservers PATH_INFO information, now that we no longer allow\nservers to send SCRIPT_NAME as PATH_INFO (we enforce\ncgi.fix_pathinfo=1 for CGI installations).\n\nThe normalized SCRIPT_NAME is now adapted to be encoded as a URL\npath by default, as all TYPO3 usages expect this to be an URL path.\nNote that $_SERVER['SCRIPT_NAME'] refers to the servers file\nsystem path, not the URL encoded value.\n\nThis SCRIPT_NAME sanitization actually enables:\n\na) TYPO3 to be run in a subfolder that contains characters\nthat need URL encoding\ne.g. `/test:site/` \u2013 url encoded that'd be `/test3Asite/`.\n\nb) prevention of XSS in case third party extensions\nmissed to escape any URL that is derived from SCRIPT_NAME\n(while making sure that properly escaped\noutput is not double escaped)\n\nResolves: #99651\nRelated: #88304\nRelated: #89312\nReleases: main, 11.5, 10.4\nChange-Id: Ief95253d764665db5182a15ce8ffd02ea02ee61e\nSecurity-Bulletin: TYPO3-CORE-SA-2023-001\nSecurity-References: CVE-2023-24814\nReviewed-on: https://review.typo3.org/c/Packages/TYPO3.CMS/+/77737\nReviewed-by: Oliver Hader <oliver.hader@typo3.org>\nTested-by: Oliver Hader <oliver.hader@typo3.org>",
        "before_after_code_files": [
          "typo3/sysext/core/Classes/Core/SystemEnvironmentBuilder.php||typo3/sysext/core/Classes/Core/SystemEnvironmentBuilder.php",
          "typo3/sysext/core/Classes/Http/NormalizedParams.php||typo3/sysext/core/Classes/Http/NormalizedParams.php",
          "typo3/sysext/core/Classes/Utility/GeneralUtility.php||typo3/sysext/core/Classes/Utility/GeneralUtility.php",
          "typo3/sysext/core/Tests/Unit/Http/NormalizedParamsTest.php||typo3/sysext/core/Tests/Unit/Http/NormalizedParamsTest.php",
          "typo3/sysext/core/Tests/Unit/Log/Processor/WebProcessorTest.php||typo3/sysext/core/Tests/Unit/Log/Processor/WebProcessorTest.php",
          "typo3/sysext/core/Tests/Unit/Resource/ResourceCompressorTest.php||typo3/sysext/core/Tests/Unit/Resource/ResourceCompressorTest.php",
          "typo3/sysext/extbase/Tests/Unit/Mvc/Web/Routing/UriBuilderTest.php||typo3/sysext/extbase/Tests/Unit/Mvc/Web/Routing/UriBuilderTest.php",
          "typo3/sysext/felogin/Tests/Unit/Validation/RedirectUrlValidatorTest.php||typo3/sysext/felogin/Tests/Unit/Validation/RedirectUrlValidatorTest.php",
          "typo3/sysext/fluid/Tests/Unit/Core/Widget/WidgetRequestBuilderTest.php||typo3/sysext/fluid/Tests/Unit/Core/Widget/WidgetRequestBuilderTest.php",
          "typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php||typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_olp_changes": 1,
        "olp_code_files": {
          "patch": [
            "typo3/sysext/core/Classes/Core/SystemEnvironmentBuilder.php||typo3/sysext/core/Classes/Core/SystemEnvironmentBuilder.php",
            "typo3/sysext/core/Classes/Http/NormalizedParams.php||typo3/sysext/core/Classes/Http/NormalizedParams.php",
            "typo3/sysext/core/Classes/Utility/GeneralUtility.php||typo3/sysext/core/Classes/Utility/GeneralUtility.php",
            "typo3/sysext/core/Tests/Unit/Http/NormalizedParamsTest.php||typo3/sysext/core/Tests/Unit/Http/NormalizedParamsTest.php",
            "typo3/sysext/core/Tests/Unit/Log/Processor/WebProcessorTest.php||typo3/sysext/core/Tests/Unit/Log/Processor/WebProcessorTest.php",
            "typo3/sysext/felogin/Tests/Unit/Validation/RedirectUrlValidatorTest.php||typo3/sysext/felogin/Tests/Unit/Validation/RedirectUrlValidatorTest.php",
            "typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php||typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php"
          ],
          "candidate": [
            "typo3/sysext/core/Classes/Core/SystemEnvironmentBuilder.php||typo3/sysext/core/Classes/Core/SystemEnvironmentBuilder.php",
            "typo3/sysext/core/Classes/Http/NormalizedParams.php||typo3/sysext/core/Classes/Http/NormalizedParams.php",
            "typo3/sysext/core/Classes/Utility/GeneralUtility.php||typo3/sysext/core/Classes/Utility/GeneralUtility.php",
            "typo3/sysext/core/Tests/Unit/Http/NormalizedParamsTest.php||typo3/sysext/core/Tests/Unit/Http/NormalizedParamsTest.php",
            "typo3/sysext/core/Tests/Unit/Log/Processor/WebProcessorTest.php||typo3/sysext/core/Tests/Unit/Log/Processor/WebProcessorTest.php",
            "typo3/sysext/felogin/Tests/Unit/Validation/RedirectUrlValidatorTest.php||typo3/sysext/felogin/Tests/Unit/Validation/RedirectUrlValidatorTest.php",
            "typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php||typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php"
          ]
        }
      },
      "candidate_diff": {
        "typo3/sysext/core/Classes/Core/SystemEnvironmentBuilder.php||typo3/sysext/core/Classes/Core/SystemEnvironmentBuilder.php": [
          "File: typo3/sysext/core/Classes/Core/SystemEnvironmentBuilder.php -> typo3/sysext/core/Classes/Core/SystemEnvironmentBuilder.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "305:     }",
          "314:     protected static function getPathThisScriptNonCli()",
          "315:     {",
          "323:         }",
          "325:     }",
          "",
          "[Removed Lines]",
          "316:         $isCgi = Environment::isRunningOnCgiServer();",
          "317:         if ($isCgi && Environment::usesCgiFixPathInfo()) {",
          "318:             return $_SERVER['SCRIPT_FILENAME'];",
          "319:         }",
          "320:         $cgiPath = $_SERVER['ORIG_PATH_TRANSLATED'] ?? $_SERVER['PATH_TRANSLATED'] ?? '';",
          "321:         if ($cgiPath && $isCgi) {",
          "322:             return $cgiPath;",
          "324:         return $_SERVER['ORIG_SCRIPT_FILENAME'] ?? $_SERVER['SCRIPT_FILENAME'];",
          "",
          "[Added Lines]",
          "314:         if (Environment::isRunningOnCgiServer() && !Environment::usesCgiFixPathInfo()) {",
          "315:             throw new \\Exception('TYPO3 does only support being used with cgi.fix_pathinfo=1 on CGI server APIs.', 1675108421);",
          "318:         return $_SERVER['SCRIPT_FILENAME'];",
          "",
          "---------------"
        ],
        "typo3/sysext/core/Classes/Http/NormalizedParams.php||typo3/sysext/core/Classes/Http/NormalizedParams.php": [
          "File: typo3/sysext/core/Classes/Http/NormalizedParams.php -> typo3/sysext/core/Classes/Http/NormalizedParams.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "304:         $requestHost = $this->requestHost = ($isHttps ? 'https://' : 'http://') . $httpHost;",
          "305:         $requestHostOnly = $this->requestHostOnly = self::determineRequestHostOnly($httpHost);",
          "306:         $this->requestPort = self::determineRequestPort($httpHost, $requestHostOnly);",
          "308:             $serverParams,",
          "309:             $configuration,",
          "310:             $isHttps,",
          "311:             $isBehindReverseProxy",
          "312:         );",
          "313:         $requestUri = $this->requestUri = self::determineRequestUri(",
          "314:             $serverParams,",
          "315:             $configuration,",
          "",
          "[Removed Lines]",
          "307:         $scriptName = $this->scriptName = self::determineScriptName(",
          "",
          "[Added Lines]",
          "307:         $scriptNameOnFileSystem = self::determineScriptName(",
          "313:         $scriptName = $this->scriptName = self::encodeFileSystemPathComponentForUrlPath($scriptNameOnFileSystem);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "322:         $requestDir = $this->requestDir = $requestHost . GeneralUtility::dirname($scriptName) . '/';",
          "323:         $this->remoteAddress = self::determineRemoteAddress($serverParams, $configuration, $isBehindReverseProxy);",
          "324:         $scriptFilename = $this->scriptFilename = $pathThisScript;",
          "326:         $siteUrl = $this->siteUrl = self::determineSiteUrl($requestDir, $pathThisScript, $pathSite . '/');",
          "327:         $this->sitePath = self::determineSitePath($requestHost, $siteUrl);",
          "328:         $this->siteScript = self::determineSiteScript($requestUrl, $siteUrl);",
          "",
          "[Removed Lines]",
          "325:         $this->documentRoot = self::determineDocumentRoot($scriptName, $scriptFilename);",
          "",
          "[Added Lines]",
          "326:         $this->documentRoot = self::determineDocumentRoot($scriptNameOnFileSystem, $scriptFilename);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "337:         $this->queryString = $serverParams['QUERY_STRING'] ?? '';",
          "338:     }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "341:     private static function encodeFileSystemPathComponentForUrlPath(string $path): string",
          "342:     {",
          "343:         return implode('/', array_map('rawurlencode', explode('/', $path)));",
          "344:     }",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "634:         bool $isHttps,",
          "635:         bool $isBehindReverseProxy",
          "636:     ): string {",
          "648:         if ($isBehindReverseProxy) {",
          "650:             if ($isHttps && !empty($configuration['reverseProxyPrefixSSL'])) {",
          "",
          "[Removed Lines]",
          "643:         $possiblePathInfo = ($serverParams['ORIG_PATH_INFO'] ?? '') ?: ($serverParams['PATH_INFO'] ?? '');",
          "644:         $possibleScriptName = ($serverParams['ORIG_SCRIPT_NAME'] ?? '') ?: ($serverParams['SCRIPT_NAME'] ?? '');",
          "645:         $scriptName = Environment::isRunningOnCgiServer() && $possiblePathInfo",
          "646:             ? $possiblePathInfo",
          "647:             : $possibleScriptName;",
          "",
          "[Added Lines]",
          "643:         $scriptName = $serverParams['SCRIPT_NAME'] ?? '';",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "788:     {",
          "",
          "[Removed Lines]",
          "787:     protected static function determineDocumentRoot(string $scriptName, string $scriptFilename): string",
          "",
          "[Added Lines]",
          "783:     protected static function determineDocumentRoot(string $scriptNameOnFileSystem, string $scriptFilename): string",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "794:         $webDocRoot = '';",
          "796:         $scriptFilenameArray = explode('/', strrev($scriptFilename));",
          "797:         $path = [];",
          "798:         foreach ($scriptNameArray as $segmentNumber => $segment) {",
          "",
          "[Removed Lines]",
          "795:         $scriptNameArray = explode('/', strrev($scriptName));",
          "",
          "[Added Lines]",
          "791:         $scriptNameArray = explode('/', strrev($scriptNameOnFileSystem));",
          "",
          "---------------"
        ],
        "typo3/sysext/core/Classes/Utility/GeneralUtility.php||typo3/sysext/core/Classes/Utility/GeneralUtility.php": [
          "File: typo3/sysext/core/Classes/Utility/GeneralUtility.php -> typo3/sysext/core/Classes/Utility/GeneralUtility.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "2653:         $retVal = '';",
          "2654:         switch ((string)$getEnvName) {",
          "2655:             case 'SCRIPT_NAME':",
          "2661:                 if (self::cmpIP($_SERVER['REMOTE_ADDR'] ?? '', $GLOBALS['TYPO3_CONF_VARS']['SYS']['reverseProxyIP'] ?? '')) {",
          "2662:                     if (self::getIndpEnv('TYPO3_SSL') && $GLOBALS['TYPO3_CONF_VARS']['SYS']['reverseProxyPrefixSSL']) {",
          "",
          "[Removed Lines]",
          "2656:                 $retVal = Environment::isRunningOnCgiServer()",
          "2657:                     && (($_SERVER['ORIG_PATH_INFO'] ?? false) ?: ($_SERVER['PATH_INFO'] ?? false))",
          "2658:                         ? (($_SERVER['ORIG_PATH_INFO'] ?? '') ?: ($_SERVER['PATH_INFO'] ?? ''))",
          "2659:                         : (($_SERVER['ORIG_SCRIPT_NAME'] ?? '') ?: ($_SERVER['SCRIPT_NAME'] ?? ''));",
          "",
          "[Added Lines]",
          "2656:                 $retVal = $_SERVER['SCRIPT_NAME'] ?? '';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2665:                         $retVal = $GLOBALS['TYPO3_CONF_VARS']['SYS']['reverseProxyPrefix'] . $retVal;",
          "2666:                     }",
          "2667:                 }",
          "2668:                 break;",
          "2669:             case 'SCRIPT_FILENAME':",
          "2670:                 $retVal = Environment::getCurrentScript();",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2665:                 $retVal = self::encodeFileSystemPathComponentForUrlPath($retVal);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "2693:                 }",
          "2694:                 break;",
          "2695:             case 'PATH_INFO':",
          "2707:                 break;",
          "2708:             case 'TYPO3_REV_PROXY':",
          "2709:                 $retVal = self::cmpIP($_SERVER['REMOTE_ADDR'], $GLOBALS['TYPO3_CONF_VARS']['SYS']['reverseProxyIP']);",
          "",
          "[Removed Lines]",
          "2704:                 if (!Environment::isRunningOnCgiServer()) {",
          "2705:                     $retVal = $_SERVER['PATH_INFO'];",
          "2706:                 }",
          "",
          "[Added Lines]",
          "2694:                 $retVal = $_SERVER['PATH_INFO'] ?? '';",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "2784:                 $SFN = self::getIndpEnv('SCRIPT_FILENAME');",
          "2786:                 $SFN_A = explode('/', strrev($SFN));",
          "2787:                 $acc = [];",
          "2788:                 foreach ($SN_A as $kk => $vv) {",
          "",
          "[Removed Lines]",
          "2785:                 $SN_A = explode('/', strrev(self::getIndpEnv('SCRIPT_NAME')));",
          "",
          "[Added Lines]",
          "2776:                 $SN_A = array_map('rawurldecode', explode('/', strrev(self::getIndpEnv('SCRIPT_NAME'))));",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "2973:         return !empty($_SERVER['HTTPS']) && strtolower($_SERVER['HTTPS']) !== 'off';",
          "2974:     }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2967:     protected static function encodeFileSystemPathComponentForUrlPath(string $path): string",
          "2968:     {",
          "2969:         return implode('/', array_map('rawurlencode', explode('/', $path)));",
          "2970:     }",
          "",
          "---------------"
        ],
        "typo3/sysext/core/Tests/Unit/Http/NormalizedParamsTest.php||typo3/sysext/core/Tests/Unit/Http/NormalizedParamsTest.php": [
          "File: typo3/sysext/core/Tests/Unit/Http/NormalizedParamsTest.php -> typo3/sysext/core/Tests/Unit/Http/NormalizedParamsTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "369:                 [],",
          "370:                 ''",
          "371:             ],",
          "421:                 [",
          "424:                     'SCRIPT_NAME' => '/script/name.php',",
          "425:                 ],",
          "426:                 [],",
          "427:                 '/script/name.php',",
          "428:             ],",
          "430:                 [",
          "433:                 ],",
          "434:                 [],",
          "443:             ],",
          "444:             'add proxy ssl prefix' => [",
          "445:                 [",
          "",
          "[Removed Lines]",
          "372:             'use ORIG_SCRIPT_NAME if ORIG_PATH_INFO is set but empty' => [",
          "373:                 [",
          "374:                     'ORIG_PATH_INFO' => '',",
          "375:                     'PATH_INFO' => '',",
          "376:                     'ORIG_SCRIPT_NAME' => '/orig/script/name.php',",
          "377:                     'SCRIPT_NAME' => '/script/name.php',",
          "378:                 ],",
          "379:                 [],",
          "380:                 '/orig/script/name.php',",
          "381:             ],",
          "382:             'use ORIG_SCRIPT_NAME if PATH_INFO is set but empty' => [",
          "383:                 [",
          "384:                     'PATH_INFO' => '',",
          "385:                     'ORIG_SCRIPT_NAME' => '/orig/script/name.php',",
          "386:                     'SCRIPT_NAME' => '/script/name.php',",
          "387:                 ],",
          "388:                 [],",
          "389:                 '/orig/script/name.php',",
          "390:             ],",
          "391:             'use SCRIPT_NAME if ORIG_PATH_INFO is set but empty' => [",
          "392:                 [",
          "393:                     'ORIG_PATH_INFO' => '',",
          "394:                     'PATH_INFO' => '',",
          "395:                     'ORIG_SCRIPT_NAME' => '',",
          "396:                     'SCRIPT_NAME' => '/script/name.php',",
          "397:                 ],",
          "398:                 [],",
          "399:                 '/script/name.php',",
          "400:             ],",
          "401:             'use SCRIPT_NAME if PATH_INFO is set but empty' => [",
          "402:                 [",
          "403:                     'PATH_INFO' => '',",
          "404:                     'ORIG_SCRIPT_NAME' => '',",
          "405:                     'SCRIPT_NAME' => '/script/name.php',",
          "406:                 ],",
          "407:                 [],",
          "408:                 '/script/name.php',",
          "409:             ],",
          "410:             'use SCRIPT_NAME if ORIG_PATH_INFO is set' => [",
          "411:                 [",
          "412:                     'ORIG_PATH_INFO' => '/foo/bar',",
          "413:                     'PATH_INFO' => '',",
          "414:                     'ORIG_SCRIPT_NAME' => '',",
          "415:                     'SCRIPT_NAME' => '/script/name.php',",
          "416:                 ],",
          "417:                 [],",
          "418:                 '/script/name.php',",
          "419:             ],",
          "420:             'use SCRIPT_NAME if PATH_INFO is set' => [",
          "422:                     'PATH_INFO' => '/foo/bar',",
          "423:                     'ORIG_SCRIPT_NAME' => '',",
          "429:             'use ORIG_SCRIPT_NAME' => [",
          "431:                     'ORIG_SCRIPT_NAME' => '/orig/script/name.php',",
          "432:                     'SCRIPT_NAME' => '/script/name.php',",
          "435:                 '/orig/script/name.php',",
          "436:             ],",
          "437:             'use SCRIPT_NAME' => [",
          "438:                 [",
          "439:                     'SCRIPT_NAME' => '/script/name.php',",
          "440:                 ],",
          "441:                 [],",
          "442:                 '/script/name.php',",
          "",
          "[Added Lines]",
          "372:             'use SCRIPT_NAME' => [",
          "379:             'apply URL encoding to SCRIPT_NAME' => [",
          "381:                     'SCRIPT_NAME' => '/test:site/script/name.php',",
          "384:                 '/test%3Asite/script/name.php',",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "509:                 [],",
          "510:                 '/typo3/index.php?route=foo/bar&id=42',",
          "511:             ],",
          "512:             'prefix with proxy prefix with ssl if using REQUEST_URI' => [",
          "513:                 [",
          "514:                     'HTTP_HOST' => 'www.domain.com',",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "454:             'use query string and script name in special subdirectory if REQUEST_URI is not set' => [",
          "455:                 [",
          "456:                     'QUERY_STRING' => 'parameter=foo/bar&id=42',",
          "457:                     'SCRIPT_NAME' => '/sub:dir/typo3/index.php',",
          "458:                 ],",
          "459:                 [],",
          "460:                 '/sub%3Adir/typo3/index.php?parameter=foo/bar&id=42',",
          "461:             ],",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "936:         $serverParams = [",
          "937:             'SCRIPT_NAME' => '/typo3/index.php',",
          "938:             'HTTP_HOST' => 'www.domain.com',",
          "940:         ];",
          "941:         $pathThisScript = '/var/www/myInstance/Web/typo3/index.php';",
          "942:         $pathSite = '/var/www/myInstance/Web';",
          "",
          "[Removed Lines]",
          "939:             'PATH_INFO' => '/typo3/index.php',",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1000:         return [",
          "1001:             'not in a sub directory' => [",
          "1002:                 [",
          "1004:                     'HTTP_HOST' => 'www.domain.com',",
          "1005:                 ],",
          "1006:                 '/var/www/myInstance/Web/typo3/index.php',",
          "",
          "[Removed Lines]",
          "1003:                     'SCRIPT_NAME' => '/typo3/index.php?id=42&foo=bar',",
          "",
          "[Added Lines]",
          "952:                     'SCRIPT_NAME' => '/typo3/index.php',",
          "953:                     'REQUEST_URI' => '/typo3/index.php?id=42&foo=bar',",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1009:             ],",
          "1010:             'in a sub directory' => [",
          "1011:                 [",
          "1013:                     'HTTP_HOST' => 'www.domain.com',",
          "1014:                 ],",
          "1015:                 '/var/www/myInstance/Web/typo3/index.php',",
          "",
          "[Removed Lines]",
          "1012:                     'SCRIPT_NAME' => '/some/sub/dir/typo3/index.php?id=42&foo=bar',",
          "",
          "[Added Lines]",
          "962:                     'SCRIPT_NAME' => '/some/sub/dir/typo3/index.php',",
          "963:                     'REQUEST_URI' => '/some/sub/dir/typo3/index.php?id=42&foo=bar',",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "1049:     public function getPathInfoReturnsExpectedValue()",
          "1050:     {",
          "1051:         $serverParams = [",
          "1053:         ];",
          "1055:         $serverRequestParameters = new NormalizedParams($serverParams, [], '', '');",
          "1056:         self::assertSame($expected, $serverRequestParameters->getPathInfo());",
          "1057:     }",
          "",
          "[Removed Lines]",
          "1052:             'PATH_INFO' => '/typo3/index.php',",
          "1054:         $expected = '/typo3/index.php';",
          "",
          "[Added Lines]",
          "1003:             'PATH_INFO' => '/foo/bar',",
          "1005:         $expected = '/foo/bar';",
          "",
          "---------------"
        ],
        "typo3/sysext/core/Tests/Unit/Log/Processor/WebProcessorTest.php||typo3/sysext/core/Tests/Unit/Log/Processor/WebProcessorTest.php": [
          "File: typo3/sysext/core/Tests/Unit/Log/Processor/WebProcessorTest.php -> typo3/sysext/core/Tests/Unit/Log/Processor/WebProcessorTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "34:     public function webProcessorAddsWebDataToLogRecord()",
          "35:     {",
          "37:         $_SERVER['REQUEST_URI'] = '';",
          "39:         $_SERVER['REMOTE_ADDR'] = '';",
          "40:         $_SERVER['QUERY_STRING'] = '';",
          "41:         $_SERVER['SSL_SESSION_ID'] = '';",
          "",
          "[Removed Lines]",
          "36:         $_SERVER['PATH_INFO'] = '';",
          "38:         $_SERVER['ORIG_SCRIPT_NAME'] = '';",
          "",
          "[Added Lines]",
          "37:         $_SERVER['SCRIPT_NAME'] = '';",
          "",
          "---------------"
        ],
        "typo3/sysext/core/Tests/Unit/Resource/ResourceCompressorTest.php||typo3/sysext/core/Tests/Unit/Resource/ResourceCompressorTest.php": [
          "File: typo3/sysext/core/Tests/Unit/Resource/ResourceCompressorTest.php -> typo3/sysext/core/Tests/Unit/Resource/ResourceCompressorTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "636:         $bePath = Environment::getBackendPath();",
          "637:         $subfolderFake = basename(Environment::getPublicPath());",
          "639:         Environment::initialize(",
          "640:             Environment::getContext(),",
          "641:             true,",
          "",
          "[Removed Lines]",
          "638:         $_SERVER['ORIG_SCRIPT_NAME'] = '/' . $subfolderFake . '/typo3/index.php';",
          "",
          "[Added Lines]",
          "638:         $_SERVER['SCRIPT_NAME'] = '/' . $subfolderFake . '/typo3/index.php';",
          "",
          "---------------"
        ],
        "typo3/sysext/extbase/Tests/Unit/Mvc/Web/Routing/UriBuilderTest.php||typo3/sysext/extbase/Tests/Unit/Mvc/Web/Routing/UriBuilderTest.php": [
          "File: typo3/sysext/extbase/Tests/Unit/Mvc/Web/Routing/UriBuilderTest.php -> typo3/sysext/extbase/Tests/Unit/Mvc/Web/Routing/UriBuilderTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "377:         $_GET['route'] = '/test/Path';",
          "378:         $_SERVER['HTTP_HOST'] = 'baseuri';",
          "379:         $_SERVER['SCRIPT_NAME'] = '/index.php';",
          "381:         $_SERVER['REMOTE_ADDR'] = '127.0.0.1';",
          "382:         $this->mockRequest->expects(self::any())->method('getBaseUri')->willReturn('http://baseuri');",
          "383:         $this->uriBuilder->setCreateAbsoluteUri(true);",
          "",
          "[Removed Lines]",
          "380:         $_SERVER['ORIG_SCRIPT_NAME'] = '/index.php';",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "405:         $_GET['route'] = '/test/Path';",
          "406:         $_SERVER['HTTP_HOST'] = 'baseuri';",
          "407:         $_SERVER['SCRIPT_NAME'] = '/typo3/index.php';",
          "409:         $_SERVER['REMOTE_ADDR'] = '127.0.0.1';",
          "410:         $this->mockRequest->expects(self::any())->method('getBaseUri')->willReturn('http://baseuri');",
          "411:         $this->uriBuilder->setCreateAbsoluteUri(true);",
          "",
          "[Removed Lines]",
          "408:         $_SERVER['ORIG_SCRIPT_NAME'] = '/typo3/index.php';",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "typo3/sysext/felogin/Tests/Unit/Validation/RedirectUrlValidatorTest.php||typo3/sysext/felogin/Tests/Unit/Validation/RedirectUrlValidatorTest.php": [
          "File: typo3/sysext/felogin/Tests/Unit/Validation/RedirectUrlValidatorTest.php -> typo3/sysext/felogin/Tests/Unit/Validation/RedirectUrlValidatorTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "76:     protected function setUpFakeSitePathAndHost()",
          "77:     {",
          "79:         $_SERVER['HTTP_HOST'] = $this->testHostName;",
          "80:     }",
          "",
          "[Removed Lines]",
          "78:         $_SERVER['ORIG_PATH_INFO'] = $_SERVER['PATH_INFO'] = $_SERVER['ORIG_SCRIPT_NAME'] = $_SERVER['SCRIPT_NAME'] = $this->testSitePath . TYPO3_mainDir;",
          "",
          "[Added Lines]",
          "78:         $_SERVER['SCRIPT_NAME'] = $this->testSitePath . TYPO3_mainDir;",
          "",
          "---------------"
        ],
        "typo3/sysext/fluid/Tests/Unit/Core/Widget/WidgetRequestBuilderTest.php||typo3/sysext/fluid/Tests/Unit/Core/Widget/WidgetRequestBuilderTest.php": [
          "File: typo3/sysext/fluid/Tests/Unit/Core/Widget/WidgetRequestBuilderTest.php -> typo3/sysext/fluid/Tests/Unit/Core/Widget/WidgetRequestBuilderTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "80:             'REMOTE_ADDR' => 'foo',",
          "81:             'SSL_SESSION_ID' => 'foo',",
          "82:             'REQUEST_URI' => 'foo',",
          "84:             'REQUEST_METHOD' => 'foo'",
          "85:         ];",
          "86:         $_GET = [",
          "",
          "[Removed Lines]",
          "83:             'ORIG_SCRIPT_NAME' => 'foo',",
          "",
          "[Added Lines]",
          "83:             'SCRIPT_NAME' => 'foo',",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "100:             'REMOTE_ADDR' => 'foo',",
          "101:             'SSL_SESSION_ID' => 'foo',",
          "102:             'REQUEST_URI' => 'foo',",
          "104:             'REQUEST_METHOD' => 'foo'",
          "105:         ];",
          "106:         $_GET = [",
          "",
          "[Removed Lines]",
          "103:             'ORIG_SCRIPT_NAME' => 'foo',",
          "",
          "[Added Lines]",
          "103:             'SCRIPT_NAME' => 'foo',",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "121:             'REMOTE_ADDR' => 'foo',",
          "122:             'SSL_SESSION_ID' => 'foo',",
          "123:             'REQUEST_URI' => 'foo',",
          "125:             'REQUEST_METHOD' => 'foo'",
          "126:         ];",
          "127:         $_GET = [",
          "",
          "[Removed Lines]",
          "124:             'ORIG_SCRIPT_NAME' => 'foo',",
          "",
          "[Added Lines]",
          "124:             'SCRIPT_NAME' => 'foo',",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "142:             'REMOTE_ADDR' => 'foo',",
          "143:             'SSL_SESSION_ID' => 'foo',",
          "144:             'REQUEST_URI' => 'foo',",
          "146:             'REQUEST_METHOD' => 'POST'",
          "147:         ];",
          "148:         $_GET = [",
          "",
          "[Removed Lines]",
          "145:             'ORIG_SCRIPT_NAME' => 'foo',",
          "",
          "[Added Lines]",
          "145:             'SCRIPT_NAME' => 'foo',",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "162:             'REMOTE_ADDR' => 'foo',",
          "163:             'SSL_SESSION_ID' => 'foo',",
          "164:             'REQUEST_URI' => 'foo',",
          "166:             'REQUEST_METHOD' => 'POST'",
          "167:         ];",
          "168:         $_GET = [",
          "",
          "[Removed Lines]",
          "165:             'ORIG_SCRIPT_NAME' => 'foo',",
          "",
          "[Added Lines]",
          "165:             'SCRIPT_NAME' => 'foo',",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "186:             'REMOTE_ADDR' => 'foo',",
          "187:             'SSL_SESSION_ID' => 'foo',",
          "188:             'REQUEST_URI' => 'foo',",
          "190:             'REQUEST_METHOD' => 'GET'",
          "191:         ];",
          "192:         $_GET = [",
          "",
          "[Removed Lines]",
          "189:             'ORIG_SCRIPT_NAME' => 'foo',",
          "",
          "[Added Lines]",
          "189:             'SCRIPT_NAME' => 'foo',",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "210:             'REMOTE_ADDR' => 'foo',",
          "211:             'SSL_SESSION_ID' => 'foo',",
          "212:             'REQUEST_URI' => 'foo',",
          "214:             'REQUEST_METHOD' => 'foo'",
          "215:         ];",
          "216:         $_GET = [",
          "",
          "[Removed Lines]",
          "213:             'ORIG_SCRIPT_NAME' => 'foo',",
          "",
          "[Added Lines]",
          "213:             'SCRIPT_NAME' => 'foo',",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "231:             'REMOTE_ADDR' => 'foo',",
          "232:             'SSL_SESSION_ID' => 'foo',",
          "233:             'REQUEST_URI' => 'foo',",
          "235:             'REQUEST_METHOD' => 'foo'",
          "236:         ];",
          "237:         $_GET = [",
          "",
          "[Removed Lines]",
          "234:             'ORIG_SCRIPT_NAME' => 'foo',",
          "",
          "[Added Lines]",
          "234:             'SCRIPT_NAME' => 'foo',",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "252:             'REMOTE_ADDR' => 'foo',",
          "253:             'SSL_SESSION_ID' => 'foo',",
          "254:             'REQUEST_URI' => 'foo',",
          "256:             'REQUEST_METHOD' => 'foo'",
          "257:         ];",
          "258:         $_GET = [",
          "",
          "[Removed Lines]",
          "255:             'ORIG_SCRIPT_NAME' => 'foo',",
          "",
          "[Added Lines]",
          "255:             'SCRIPT_NAME' => 'foo',",
          "",
          "---------------"
        ],
        "typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php||typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php": [
          "File: typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php -> typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "3420:         if (!$this->absRefPrefix) {",
          "3421:             return;",
          "3422:         }",
          "3423:         $search = [",
          "3424:             '\"typo3temp/',",
          "3425:             '\"' . PathUtility::stripPathSitePrefix(Environment::getExtensionsPath()) . '/',",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3423:         $encodedAbsRefPrefix = htmlspecialchars($this->absRefPrefix, ENT_QUOTES | ENT_HTML5);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "3427:             '\"' . PathUtility::stripPathSitePrefix(Environment::getFrameworkBasePath()) . '/',",
          "3428:         ];",
          "3429:         $replace = [",
          "3434:         ];",
          "3436:         $storageRepository = GeneralUtility::makeInstance(StorageRepository::class);",
          "",
          "[Removed Lines]",
          "3430:             '\"' . $this->absRefPrefix . 'typo3temp/',",
          "3431:             '\"' . $this->absRefPrefix . PathUtility::stripPathSitePrefix(Environment::getExtensionsPath()) . '/',",
          "3432:             '\"' . $this->absRefPrefix . PathUtility::stripPathSitePrefix(Environment::getBackendPath()) . '/ext/',",
          "3433:             '\"' . $this->absRefPrefix . PathUtility::stripPathSitePrefix(Environment::getFrameworkBasePath()) . '/',",
          "",
          "[Added Lines]",
          "3431:             '\"' . $encodedAbsRefPrefix . 'typo3temp/',",
          "3432:             '\"' . $encodedAbsRefPrefix . PathUtility::stripPathSitePrefix(Environment::getExtensionsPath()) . '/',",
          "3433:             '\"' . $encodedAbsRefPrefix . PathUtility::stripPathSitePrefix(Environment::getBackendPath()) . '/ext/',",
          "3434:             '\"' . $encodedAbsRefPrefix . PathUtility::stripPathSitePrefix(Environment::getFrameworkBasePath()) . '/',",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "3439:             if ($storage->getDriverType() === 'Local' && $storage->isPublic() && $storage->isOnline()) {",
          "3440:                 $folder = $storage->getPublicUrl($storage->getRootLevelFolder(), true);",
          "3441:                 $search[] = '\"' . $folder;",
          "3443:             }",
          "3444:         }",
          "3446:         $directories = GeneralUtility::trimExplode(',', $GLOBALS['TYPO3_CONF_VARS']['FE']['additionalAbsRefPrefixDirectories'], true);",
          "3447:         foreach ($directories as $directory) {",
          "3448:             $search[] = '\"' . $directory;",
          "3450:         }",
          "3451:         $this->content = str_replace(",
          "3452:             $search,",
          "",
          "[Removed Lines]",
          "3442:                 $replace[] = '\"' . $this->absRefPrefix . $folder;",
          "3449:             $replace[] = '\"' . $this->absRefPrefix . $directory;",
          "",
          "[Added Lines]",
          "3443:                 $replace[] = '\"' . $encodedAbsRefPrefix . $folder;",
          "3450:             $replace[] = '\"' . $encodedAbsRefPrefix . $directory;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "b809408340b00569d4979b7c4a6bf1d334f9a580",
      "candidate_info": {
        "commit_hash": "b809408340b00569d4979b7c4a6bf1d334f9a580",
        "repo": "TYPO3/typo3",
        "commit_url": "https://github.com/TYPO3/typo3/commit/b809408340b00569d4979b7c4a6bf1d334f9a580",
        "files": [
          "typo3/sysext/core/Classes/Core/SystemEnvironmentBuilder.php",
          "typo3/sysext/core/Classes/Http/NormalizedParams.php",
          "typo3/sysext/core/Classes/Utility/GeneralUtility.php",
          "typo3/sysext/core/Tests/Acceptance/Support/Extension/BackendCoreEnvironment.php",
          "typo3/sysext/core/Tests/Unit/Http/NormalizedParamsTest.php",
          "typo3/sysext/core/Tests/Unit/Log/Processor/WebProcessorTest.php",
          "typo3/sysext/core/Tests/Unit/Resource/ResourceCompressorTest.php",
          "typo3/sysext/extbase/Tests/Unit/Mvc/Web/Routing/UriBuilderTest.php",
          "typo3/sysext/felogin/Tests/Unit/Validation/RedirectUrlValidatorTest.php",
          "typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php"
        ],
        "message": "[SECURITY] Prevent XSS due to wrong PATH_INFO evaluation\n\nAs already started in #88304 (but only for NormalizedParams)\nand later reverted in #89312 (because of cgi-bin problems),\nPATH_INFO is no longer considered as a preferable SCRIPT_NAME\nalternative. All known server configurations set SCRIPT_NAME\nthese days to a proper value when cgi.fix_pathinfo is set.\n\nThe fallback to PATH_INFO has been introduced with\nthe initial revision of TYPO3 and isn't needed at all nowadays,\nit's actually wrong, as a REQUEST_URI like /index.php/foo/bar\nwould incorrectly be interpreted as $scriptName == \"/foo/bar\",\nwhich let's all calculations on $scriptName fail and\neven leads to XSS where values derived from $scriptName are\nprinted without being escaped.\n\nAlso any ORIG_SCRIPT_NAME evaluation is dropped, as this variable\ncontains the SCRIPT_NAME that was set by the webserver configuration\nbefore PHP applied cgi.fix_pathinfo. Using ORIG_SCRIPT_NAME\neffectively meant bypassing PHP's pathinfo fix. It usually contains\nthe cgi-wrapper paths, which is why PATH_INFO was used to overrule\nwrong ORIG_SCRIPT_NAME values.\n\nGeneralUtility::getIndpEnv('PATH_INFO') is adapted to trust the\nservers PATH_INFO information, now that we no longer allow\nservers to send SCRIPT_NAME as PATH_INFO (we enforce\ncgi.fix_pathinfo=1 for CGI installations).\n\nThe normalized SCRIPT_NAME is now adapted to be encoded as a URL\npath by default, as all TYPO3 usages expect this to be an URL path.\nNote that $_SERVER['SCRIPT_NAME'] refers to the servers file\nsystem path, not the URL encoded value.\n\nThis SCRIPT_NAME sanitization actually enables:\n\na) TYPO3 to be run in a subfolder that contains characters\nthat need URL encoding\ne.g. `/test:site/` \u2013 url encoded that'd be `/test3Asite/`.\n\nb) prevention of XSS in case third party extensions\nmissed to escape any URL that is derived from SCRIPT_NAME\n(while making sure that properly escaped\noutput is not double escaped)\n\nResolves: #99651\nRelated: #88304\nRelated: #89312\nReleases: main, 11.5, 10.4\nChange-Id: Ief95253d764665db5182a15ce8ffd02ea02ee61e\nSecurity-Bulletin: TYPO3-CORE-SA-2023-001\nSecurity-References: CVE-2023-24814\nReviewed-on: https://review.typo3.org/c/Packages/TYPO3.CMS/+/77738\nReviewed-by: Oliver Hader <oliver.hader@typo3.org>\nTested-by: Oliver Hader <oliver.hader@typo3.org>",
        "before_after_code_files": [
          "typo3/sysext/core/Classes/Core/SystemEnvironmentBuilder.php||typo3/sysext/core/Classes/Core/SystemEnvironmentBuilder.php",
          "typo3/sysext/core/Classes/Http/NormalizedParams.php||typo3/sysext/core/Classes/Http/NormalizedParams.php",
          "typo3/sysext/core/Classes/Utility/GeneralUtility.php||typo3/sysext/core/Classes/Utility/GeneralUtility.php",
          "typo3/sysext/core/Tests/Acceptance/Support/Extension/BackendCoreEnvironment.php||typo3/sysext/core/Tests/Acceptance/Support/Extension/BackendCoreEnvironment.php",
          "typo3/sysext/core/Tests/Unit/Http/NormalizedParamsTest.php||typo3/sysext/core/Tests/Unit/Http/NormalizedParamsTest.php",
          "typo3/sysext/core/Tests/Unit/Log/Processor/WebProcessorTest.php||typo3/sysext/core/Tests/Unit/Log/Processor/WebProcessorTest.php",
          "typo3/sysext/core/Tests/Unit/Resource/ResourceCompressorTest.php||typo3/sysext/core/Tests/Unit/Resource/ResourceCompressorTest.php",
          "typo3/sysext/extbase/Tests/Unit/Mvc/Web/Routing/UriBuilderTest.php||typo3/sysext/extbase/Tests/Unit/Mvc/Web/Routing/UriBuilderTest.php",
          "typo3/sysext/felogin/Tests/Unit/Validation/RedirectUrlValidatorTest.php||typo3/sysext/felogin/Tests/Unit/Validation/RedirectUrlValidatorTest.php",
          "typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php||typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_olp_changes": 1,
        "olp_code_files": {
          "patch": [
            "typo3/sysext/core/Classes/Core/SystemEnvironmentBuilder.php||typo3/sysext/core/Classes/Core/SystemEnvironmentBuilder.php",
            "typo3/sysext/core/Classes/Http/NormalizedParams.php||typo3/sysext/core/Classes/Http/NormalizedParams.php",
            "typo3/sysext/core/Classes/Utility/GeneralUtility.php||typo3/sysext/core/Classes/Utility/GeneralUtility.php",
            "typo3/sysext/core/Tests/Unit/Http/NormalizedParamsTest.php||typo3/sysext/core/Tests/Unit/Http/NormalizedParamsTest.php",
            "typo3/sysext/core/Tests/Unit/Log/Processor/WebProcessorTest.php||typo3/sysext/core/Tests/Unit/Log/Processor/WebProcessorTest.php",
            "typo3/sysext/felogin/Tests/Unit/Validation/RedirectUrlValidatorTest.php||typo3/sysext/felogin/Tests/Unit/Validation/RedirectUrlValidatorTest.php",
            "typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php||typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php"
          ],
          "candidate": [
            "typo3/sysext/core/Classes/Core/SystemEnvironmentBuilder.php||typo3/sysext/core/Classes/Core/SystemEnvironmentBuilder.php",
            "typo3/sysext/core/Classes/Http/NormalizedParams.php||typo3/sysext/core/Classes/Http/NormalizedParams.php",
            "typo3/sysext/core/Classes/Utility/GeneralUtility.php||typo3/sysext/core/Classes/Utility/GeneralUtility.php",
            "typo3/sysext/core/Tests/Unit/Http/NormalizedParamsTest.php||typo3/sysext/core/Tests/Unit/Http/NormalizedParamsTest.php",
            "typo3/sysext/core/Tests/Unit/Log/Processor/WebProcessorTest.php||typo3/sysext/core/Tests/Unit/Log/Processor/WebProcessorTest.php",
            "typo3/sysext/felogin/Tests/Unit/Validation/RedirectUrlValidatorTest.php||typo3/sysext/felogin/Tests/Unit/Validation/RedirectUrlValidatorTest.php",
            "typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php||typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php"
          ]
        }
      },
      "candidate_diff": {
        "typo3/sysext/core/Classes/Core/SystemEnvironmentBuilder.php||typo3/sysext/core/Classes/Core/SystemEnvironmentBuilder.php": [
          "File: typo3/sysext/core/Classes/Core/SystemEnvironmentBuilder.php -> typo3/sysext/core/Classes/Core/SystemEnvironmentBuilder.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "264:     }",
          "273:     protected static function getPathThisScriptNonCli()",
          "274:     {",
          "282:         }",
          "284:     }",
          "",
          "[Removed Lines]",
          "275:         $isCgi = Environment::isRunningOnCgiServer();",
          "276:         if ($isCgi && Environment::usesCgiFixPathInfo()) {",
          "277:             return $_SERVER['SCRIPT_FILENAME'];",
          "278:         }",
          "279:         $cgiPath = $_SERVER['ORIG_PATH_TRANSLATED'] ?? $_SERVER['PATH_TRANSLATED'] ?? '';",
          "280:         if ($cgiPath && $isCgi) {",
          "281:             return $cgiPath;",
          "283:         return $_SERVER['ORIG_SCRIPT_FILENAME'] ?? $_SERVER['SCRIPT_FILENAME'];",
          "",
          "[Added Lines]",
          "273:         if (Environment::isRunningOnCgiServer() && !Environment::usesCgiFixPathInfo()) {",
          "274:             throw new \\Exception('TYPO3 does only support being used with cgi.fix_pathinfo=1 on CGI server APIs.', 1675108421);",
          "277:         return $_SERVER['SCRIPT_FILENAME'];",
          "",
          "---------------"
        ],
        "typo3/sysext/core/Classes/Http/NormalizedParams.php||typo3/sysext/core/Classes/Http/NormalizedParams.php": [
          "File: typo3/sysext/core/Classes/Http/NormalizedParams.php -> typo3/sysext/core/Classes/Http/NormalizedParams.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "308:         $requestHost = $this->requestHost = ($isHttps ? 'https://' : 'http://') . $httpHost;",
          "309:         $requestHostOnly = $this->requestHostOnly = self::determineRequestHostOnly($httpHost);",
          "310:         $this->requestPort = self::determineRequestPort($httpHost, $requestHostOnly);",
          "312:             $serverParams,",
          "313:             $configuration,",
          "314:             $isHttps,",
          "315:             $isBehindReverseProxy",
          "316:         );",
          "317:         $requestUri = $this->requestUri = self::determineRequestUri(",
          "318:             $serverParams,",
          "319:             $configuration,",
          "",
          "[Removed Lines]",
          "311:         $scriptName = $this->scriptName = self::determineScriptName(",
          "",
          "[Added Lines]",
          "311:         $scriptNameOnFileSystem = self::determineScriptName(",
          "317:         $scriptName = $this->scriptName = self::encodeFileSystemPathComponentForUrlPath($scriptNameOnFileSystem);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "326:         $requestDir = $this->requestDir = $requestHost . GeneralUtility::dirname($scriptName) . '/';",
          "327:         $this->remoteAddress = self::determineRemoteAddress($serverParams, $configuration, $isBehindReverseProxy);",
          "328:         $scriptFilename = $this->scriptFilename = $pathThisScript;",
          "330:         $siteUrl = $this->siteUrl = self::determineSiteUrl($requestDir, $pathThisScript, $pathSite . '/');",
          "331:         $this->sitePath = self::determineSitePath($requestHost, $siteUrl);",
          "332:         $this->siteScript = self::determineSiteScript($requestUrl, $siteUrl);",
          "",
          "[Removed Lines]",
          "329:         $this->documentRoot = self::determineDocumentRoot($scriptName, $scriptFilename);",
          "",
          "[Added Lines]",
          "330:         $this->documentRoot = self::determineDocumentRoot($scriptNameOnFileSystem, $scriptFilename);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "341:         $this->queryString = $serverParams['QUERY_STRING'] ?? '';",
          "342:     }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "345:     private static function encodeFileSystemPathComponentForUrlPath(string $path): string",
          "346:     {",
          "347:         return implode('/', array_map('rawurlencode', explode('/', $path)));",
          "348:     }",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "629:         bool $isHttps,",
          "630:         bool $isBehindReverseProxy",
          "631:     ): string {",
          "643:         if ($isBehindReverseProxy) {",
          "645:             if ($isHttps && !empty($configuration['reverseProxyPrefixSSL'])) {",
          "",
          "[Removed Lines]",
          "638:         $possiblePathInfo = ($serverParams['ORIG_PATH_INFO'] ?? '') ?: ($serverParams['PATH_INFO'] ?? '');",
          "639:         $possibleScriptName = ($serverParams['ORIG_SCRIPT_NAME'] ?? '') ?: ($serverParams['SCRIPT_NAME'] ?? '');",
          "640:         $scriptName = Environment::isRunningOnCgiServer() && $possiblePathInfo",
          "641:             ? $possiblePathInfo",
          "642:             : $possibleScriptName;",
          "",
          "[Added Lines]",
          "638:         $scriptName = $serverParams['SCRIPT_NAME'] ?? '';",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "783:     {",
          "",
          "[Removed Lines]",
          "782:     protected static function determineDocumentRoot(string $scriptName, string $scriptFilename): string",
          "",
          "[Added Lines]",
          "778:     protected static function determineDocumentRoot(string $scriptNameOnFileSystem, string $scriptFilename): string",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "789:         $webDocRoot = '';",
          "791:         $scriptFilenameArray = explode('/', strrev($scriptFilename));",
          "792:         $path = [];",
          "793:         foreach ($scriptNameArray as $segmentNumber => $segment) {",
          "",
          "[Removed Lines]",
          "790:         $scriptNameArray = explode('/', strrev($scriptName));",
          "",
          "[Added Lines]",
          "786:         $scriptNameArray = explode('/', strrev($scriptNameOnFileSystem));",
          "",
          "---------------"
        ],
        "typo3/sysext/core/Classes/Utility/GeneralUtility.php||typo3/sysext/core/Classes/Utility/GeneralUtility.php": [
          "File: typo3/sysext/core/Classes/Utility/GeneralUtility.php -> typo3/sysext/core/Classes/Utility/GeneralUtility.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "2478:         $retVal = '';",
          "2479:         switch ((string)$getEnvName) {",
          "2480:             case 'SCRIPT_NAME':",
          "2486:                 if (self::cmpIP($_SERVER['REMOTE_ADDR'] ?? '', $GLOBALS['TYPO3_CONF_VARS']['SYS']['reverseProxyIP'] ?? '')) {",
          "2487:                     if (self::getIndpEnv('TYPO3_SSL') && $GLOBALS['TYPO3_CONF_VARS']['SYS']['reverseProxyPrefixSSL']) {",
          "",
          "[Removed Lines]",
          "2481:                 $retVal = Environment::isRunningOnCgiServer()",
          "2482:                     && (($_SERVER['ORIG_PATH_INFO'] ?? false) ?: ($_SERVER['PATH_INFO'] ?? false))",
          "2483:                         ? (($_SERVER['ORIG_PATH_INFO'] ?? '') ?: ($_SERVER['PATH_INFO'] ?? ''))",
          "2484:                         : (($_SERVER['ORIG_SCRIPT_NAME'] ?? '') ?: ($_SERVER['SCRIPT_NAME'] ?? ''));",
          "",
          "[Added Lines]",
          "2481:                 $retVal = $_SERVER['SCRIPT_NAME'] ?? '';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2490:                         $retVal = $GLOBALS['TYPO3_CONF_VARS']['SYS']['reverseProxyPrefix'] . $retVal;",
          "2491:                     }",
          "2492:                 }",
          "2493:                 break;",
          "2494:             case 'SCRIPT_FILENAME':",
          "2495:                 $retVal = Environment::getCurrentScript();",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2490:                 $retVal = self::encodeFileSystemPathComponentForUrlPath($retVal);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "2518:                 }",
          "2519:                 break;",
          "2520:             case 'PATH_INFO':",
          "2532:                 break;",
          "2533:             case 'TYPO3_REV_PROXY':",
          "2534:                 $retVal = self::cmpIP($_SERVER['REMOTE_ADDR'] ?? '', $GLOBALS['TYPO3_CONF_VARS']['SYS']['reverseProxyIP']);",
          "",
          "[Removed Lines]",
          "2529:                 if (!Environment::isRunningOnCgiServer()) {",
          "2530:                     $retVal = $_SERVER['PATH_INFO'] ?? '';",
          "2531:                 }",
          "",
          "[Added Lines]",
          "2519:                 $retVal = $_SERVER['PATH_INFO'] ?? '';",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "2603:                 $SFN = self::getIndpEnv('SCRIPT_FILENAME');",
          "2605:                 $SFN_A = explode('/', strrev($SFN));",
          "2606:                 $acc = [];",
          "2607:                 foreach ($SN_A as $kk => $vv) {",
          "",
          "[Removed Lines]",
          "2604:                 $SN_A = explode('/', strrev(self::getIndpEnv('SCRIPT_NAME')));",
          "",
          "[Added Lines]",
          "2595:                 $SN_A = array_map('rawurldecode', explode('/', strrev(self::getIndpEnv('SCRIPT_NAME'))));",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "2741:         return !empty($_SERVER['HTTPS']) && strtolower($_SERVER['HTTPS']) !== 'off';",
          "2742:     }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2735:     protected static function encodeFileSystemPathComponentForUrlPath(string $path): string",
          "2736:     {",
          "2737:         return implode('/', array_map('rawurlencode', explode('/', $path)));",
          "2738:     }",
          "",
          "---------------"
        ],
        "typo3/sysext/core/Tests/Acceptance/Support/Extension/BackendCoreEnvironment.php||typo3/sysext/core/Tests/Acceptance/Support/Extension/BackendCoreEnvironment.php": [
          "File: typo3/sysext/core/Tests/Acceptance/Support/Extension/BackendCoreEnvironment.php -> typo3/sysext/core/Tests/Acceptance/Support/Extension/BackendCoreEnvironment.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "155:             'SCRIPT_NAME' => '/typo3/index.php',",
          "156:             'PHP_SELF' => '/typo3/index.php',",
          "157:             'SCRIPT_FILENAME' => $docRoot . '/index.php',",
          "159:             'QUERY_STRING' => $requestUrlParts['query'] ?? '',",
          "160:             'REQUEST_URI' => $requestUrlParts['path'] . (isset($requestUrlParts['query']) ? '?' . $requestUrlParts['query'] : ''),",
          "161:             'REQUEST_METHOD' => $method,",
          "",
          "[Removed Lines]",
          "158:             'PATH_TRANSLATED' => $docRoot . '/index.php',",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "typo3/sysext/core/Tests/Unit/Http/NormalizedParamsTest.php||typo3/sysext/core/Tests/Unit/Http/NormalizedParamsTest.php": [
          "File: typo3/sysext/core/Tests/Unit/Http/NormalizedParamsTest.php -> typo3/sysext/core/Tests/Unit/Http/NormalizedParamsTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "369:                 [],",
          "370:                 '',",
          "371:             ],",
          "421:                 [",
          "424:                     'SCRIPT_NAME' => '/script/name.php',",
          "425:                 ],",
          "426:                 [],",
          "427:                 '/script/name.php',",
          "428:             ],",
          "438:                 [",
          "440:                 ],",
          "441:                 [],",
          "443:             ],",
          "444:             'add proxy ssl prefix' => [",
          "445:                 [",
          "",
          "[Removed Lines]",
          "372:             'use ORIG_SCRIPT_NAME if ORIG_PATH_INFO is set but empty' => [",
          "373:                 [",
          "374:                     'ORIG_PATH_INFO' => '',",
          "375:                     'PATH_INFO' => '',",
          "376:                     'ORIG_SCRIPT_NAME' => '/orig/script/name.php',",
          "377:                     'SCRIPT_NAME' => '/script/name.php',",
          "378:                 ],",
          "379:                 [],",
          "380:                 '/orig/script/name.php',",
          "381:             ],",
          "382:             'use ORIG_SCRIPT_NAME if PATH_INFO is set but empty' => [",
          "383:                 [",
          "384:                     'PATH_INFO' => '',",
          "385:                     'ORIG_SCRIPT_NAME' => '/orig/script/name.php',",
          "386:                     'SCRIPT_NAME' => '/script/name.php',",
          "387:                 ],",
          "388:                 [],",
          "389:                 '/orig/script/name.php',",
          "390:             ],",
          "391:             'use SCRIPT_NAME if ORIG_PATH_INFO is set but empty' => [",
          "392:                 [",
          "393:                     'ORIG_PATH_INFO' => '',",
          "394:                     'PATH_INFO' => '',",
          "395:                     'ORIG_SCRIPT_NAME' => '',",
          "396:                     'SCRIPT_NAME' => '/script/name.php',",
          "397:                 ],",
          "398:                 [],",
          "399:                 '/script/name.php',",
          "400:             ],",
          "401:             'use SCRIPT_NAME if PATH_INFO is set but empty' => [",
          "402:                 [",
          "403:                     'PATH_INFO' => '',",
          "404:                     'ORIG_SCRIPT_NAME' => '',",
          "405:                     'SCRIPT_NAME' => '/script/name.php',",
          "406:                 ],",
          "407:                 [],",
          "408:                 '/script/name.php',",
          "409:             ],",
          "410:             'use SCRIPT_NAME if ORIG_PATH_INFO is set' => [",
          "411:                 [",
          "412:                     'ORIG_PATH_INFO' => '/foo/bar',",
          "413:                     'PATH_INFO' => '',",
          "414:                     'ORIG_SCRIPT_NAME' => '',",
          "415:                     'SCRIPT_NAME' => '/script/name.php',",
          "416:                 ],",
          "417:                 [],",
          "418:                 '/script/name.php',",
          "419:             ],",
          "420:             'use SCRIPT_NAME if PATH_INFO is set' => [",
          "422:                     'PATH_INFO' => '/foo/bar',",
          "423:                     'ORIG_SCRIPT_NAME' => '',",
          "429:             'use ORIG_SCRIPT_NAME' => [",
          "430:                 [",
          "431:                     'ORIG_SCRIPT_NAME' => '/orig/script/name.php',",
          "432:                     'SCRIPT_NAME' => '/script/name.php',",
          "433:                 ],",
          "434:                 [],",
          "435:                 '/orig/script/name.php',",
          "436:             ],",
          "437:             'use SCRIPT_NAME' => [",
          "439:                     'SCRIPT_NAME' => '/script/name.php',",
          "442:                 '/script/name.php',",
          "",
          "[Added Lines]",
          "372:             'use SCRIPT_NAME' => [",
          "379:             'apply URL encoding to SCRIPT_NAME' => [",
          "381:                     'SCRIPT_NAME' => '/test:site/script/name.php',",
          "384:                 '/test%3Asite/script/name.php',",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "509:                 [],",
          "510:                 '/typo3/index.php?parameter=foo/bar&id=42',",
          "511:             ],",
          "512:             'prefix with proxy prefix with ssl if using REQUEST_URI' => [",
          "513:                 [",
          "514:                     'HTTP_HOST' => 'www.domain.com',",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "454:             'use query string and script name in special subdirectory if REQUEST_URI is not set' => [",
          "455:                 [",
          "456:                     'QUERY_STRING' => 'parameter=foo/bar&id=42',",
          "457:                     'SCRIPT_NAME' => '/sub:dir/typo3/index.php',",
          "458:                 ],",
          "459:                 [],",
          "460:                 '/sub%3Adir/typo3/index.php?parameter=foo/bar&id=42',",
          "461:             ],",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "936:         $serverParams = [",
          "937:             'SCRIPT_NAME' => '/typo3/index.php',",
          "938:             'HTTP_HOST' => 'www.domain.com',",
          "940:         ];",
          "941:         $pathThisScript = '/var/www/myInstance/Web/typo3/index.php';",
          "942:         $pathSite = '/var/www/myInstance/Web';",
          "",
          "[Removed Lines]",
          "939:             'PATH_INFO' => '/typo3/index.php',",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1013:         return [",
          "1014:             'not in a sub directory' => [",
          "1015:                 [",
          "1017:                     'HTTP_HOST' => 'www.domain.com',",
          "1018:                 ],",
          "1019:                 '/var/www/myInstance/Web/typo3/index.php',",
          "",
          "[Removed Lines]",
          "1016:                     'SCRIPT_NAME' => '/typo3/index.php?id=42&foo=bar',",
          "",
          "[Added Lines]",
          "965:                     'SCRIPT_NAME' => '/typo3/index.php',",
          "966:                     'REQUEST_URI' => '/typo3/index.php?id=42&foo=bar',",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1022:             ],",
          "1023:             'in a sub directory' => [",
          "1024:                 [",
          "1026:                     'HTTP_HOST' => 'www.domain.com',",
          "1027:                 ],",
          "1028:                 '/var/www/myInstance/Web/typo3/index.php',",
          "",
          "[Removed Lines]",
          "1025:                     'SCRIPT_NAME' => '/some/sub/dir/typo3/index.php?id=42&foo=bar',",
          "",
          "[Added Lines]",
          "975:                     'SCRIPT_NAME' => '/some/sub/dir/typo3/index.php',",
          "976:                     'REQUEST_URI' => '/some/sub/dir/typo3/index.php?id=42&foo=bar',",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "1062:     public function getPathInfoReturnsExpectedValue(): void",
          "1063:     {",
          "1064:         $serverParams = [",
          "1066:         ];",
          "1068:         $serverRequestParameters = new NormalizedParams($serverParams, [], '', '');",
          "1069:         self::assertSame($expected, $serverRequestParameters->getPathInfo());",
          "1070:     }",
          "",
          "[Removed Lines]",
          "1065:             'PATH_INFO' => '/typo3/index.php',",
          "1067:         $expected = '/typo3/index.php';",
          "",
          "[Added Lines]",
          "1016:             'PATH_INFO' => '/foo/bar',",
          "1018:         $expected = '/foo/bar';",
          "",
          "---------------"
        ],
        "typo3/sysext/core/Tests/Unit/Log/Processor/WebProcessorTest.php||typo3/sysext/core/Tests/Unit/Log/Processor/WebProcessorTest.php": [
          "File: typo3/sysext/core/Tests/Unit/Log/Processor/WebProcessorTest.php -> typo3/sysext/core/Tests/Unit/Log/Processor/WebProcessorTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "34:     public function webProcessorAddsWebDataToLogRecord(): void",
          "35:     {",
          "37:         $_SERVER['REQUEST_URI'] = '';",
          "39:         $_SERVER['REMOTE_ADDR'] = '';",
          "40:         $_SERVER['QUERY_STRING'] = '';",
          "41:         $_SERVER['SSL_SESSION_ID'] = '';",
          "",
          "[Removed Lines]",
          "36:         $_SERVER['PATH_INFO'] = '';",
          "38:         $_SERVER['ORIG_SCRIPT_NAME'] = '';",
          "",
          "[Added Lines]",
          "37:         $_SERVER['SCRIPT_NAME'] = '';",
          "",
          "---------------"
        ],
        "typo3/sysext/core/Tests/Unit/Resource/ResourceCompressorTest.php||typo3/sysext/core/Tests/Unit/Resource/ResourceCompressorTest.php": [
          "File: typo3/sysext/core/Tests/Unit/Resource/ResourceCompressorTest.php -> typo3/sysext/core/Tests/Unit/Resource/ResourceCompressorTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "638:         $bePath = Environment::getBackendPath();",
          "639:         $subfolderFake = basename(Environment::getPublicPath());",
          "641:         Environment::initialize(",
          "642:             Environment::getContext(),",
          "643:             true,",
          "",
          "[Removed Lines]",
          "640:         $_SERVER['ORIG_SCRIPT_NAME'] = '/' . $subfolderFake . '/typo3/index.php';",
          "",
          "[Added Lines]",
          "640:         $_SERVER['SCRIPT_NAME'] = '/' . $subfolderFake . '/typo3/index.php';",
          "",
          "---------------"
        ],
        "typo3/sysext/extbase/Tests/Unit/Mvc/Web/Routing/UriBuilderTest.php||typo3/sysext/extbase/Tests/Unit/Mvc/Web/Routing/UriBuilderTest.php": [
          "File: typo3/sysext/extbase/Tests/Unit/Mvc/Web/Routing/UriBuilderTest.php -> typo3/sysext/extbase/Tests/Unit/Mvc/Web/Routing/UriBuilderTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "379:         $GLOBALS['TYPO3_REQUEST'] = $this->getRequestWithRouteAttribute();",
          "380:         $_SERVER['HTTP_HOST'] = 'baseuri';",
          "381:         $_SERVER['SCRIPT_NAME'] = '/index.php';",
          "383:         $_SERVER['REMOTE_ADDR'] = '127.0.0.1';",
          "384:         $this->uriBuilder->setCreateAbsoluteUri(true);",
          "385:         $expectedResult = 'http://baseuri/' . TYPO3_mainDir . 'test/Path?token=dummyToken';",
          "",
          "[Removed Lines]",
          "382:         $_SERVER['ORIG_SCRIPT_NAME'] = '/index.php';",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "406:         $GLOBALS['TYPO3_REQUEST'] = $this->getRequestWithRouteAttribute();",
          "407:         $_SERVER['HTTP_HOST'] = 'baseuri';",
          "408:         $_SERVER['SCRIPT_NAME'] = '/typo3/index.php';",
          "410:         $_SERVER['REMOTE_ADDR'] = '127.0.0.1';",
          "411:         $this->uriBuilder->setCreateAbsoluteUri(true);",
          "412:         $expectedResult = 'http://baseuri/' . TYPO3_mainDir . 'test/Path?token=dummyToken';",
          "",
          "[Removed Lines]",
          "409:         $_SERVER['ORIG_SCRIPT_NAME'] = '/typo3/index.php';",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "typo3/sysext/felogin/Tests/Unit/Validation/RedirectUrlValidatorTest.php||typo3/sysext/felogin/Tests/Unit/Validation/RedirectUrlValidatorTest.php": [
          "File: typo3/sysext/felogin/Tests/Unit/Validation/RedirectUrlValidatorTest.php -> typo3/sysext/felogin/Tests/Unit/Validation/RedirectUrlValidatorTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "79:     protected function setUpFakeSitePathAndHost(): void",
          "80:     {",
          "82:         $_SERVER['HTTP_HOST'] = $this->testHostName;",
          "84:         $request = ServerRequestFactory::fromGlobals();",
          "",
          "[Removed Lines]",
          "81:         $_SERVER['ORIG_PATH_INFO'] = $_SERVER['PATH_INFO'] = $_SERVER['ORIG_SCRIPT_NAME'] = $_SERVER['SCRIPT_NAME'] = $this->testSitePath . TYPO3_mainDir;",
          "",
          "[Added Lines]",
          "81:         $_SERVER['SCRIPT_NAME'] = $this->testSitePath . TYPO3_mainDir;",
          "",
          "---------------"
        ],
        "typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php||typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php": [
          "File: typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php -> typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "3026:         if (!$this->absRefPrefix) {",
          "3027:             return;",
          "3028:         }",
          "3029:         $search = [",
          "3030:             '\"_assets/',",
          "3031:             '\"typo3temp/',",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3029:         $encodedAbsRefPrefix = htmlspecialchars($this->absRefPrefix, ENT_QUOTES | ENT_HTML5);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "3034:             '\"' . PathUtility::stripPathSitePrefix(Environment::getFrameworkBasePath()) . '/',",
          "3035:         ];",
          "3036:         $replace = [",
          "3042:         ];",
          "3044:         $directories = GeneralUtility::trimExplode(',', $GLOBALS['TYPO3_CONF_VARS']['FE']['additionalAbsRefPrefixDirectories'], true);",
          "3045:         foreach ($directories as $directory) {",
          "3046:             $search[] = '\"' . $directory;",
          "3048:         }",
          "3049:         $this->content = str_replace(",
          "3050:             $search,",
          "",
          "[Removed Lines]",
          "3037:             '\"' . $this->absRefPrefix . '_assets/',",
          "3038:             '\"' . $this->absRefPrefix . 'typo3temp/',",
          "3039:             '\"' . $this->absRefPrefix . PathUtility::stripPathSitePrefix(Environment::getExtensionsPath()) . '/',",
          "3040:             '\"' . $this->absRefPrefix . PathUtility::stripPathSitePrefix(Environment::getBackendPath()) . '/ext/',",
          "3041:             '\"' . $this->absRefPrefix . PathUtility::stripPathSitePrefix(Environment::getFrameworkBasePath()) . '/',",
          "3047:             $replace[] = '\"' . $this->absRefPrefix . $directory;",
          "",
          "[Added Lines]",
          "3038:             '\"' . $encodedAbsRefPrefix . '_assets/',",
          "3039:             '\"' . $encodedAbsRefPrefix . 'typo3temp/',",
          "3040:             '\"' . $encodedAbsRefPrefix . PathUtility::stripPathSitePrefix(Environment::getExtensionsPath()) . '/',",
          "3041:             '\"' . $encodedAbsRefPrefix . PathUtility::stripPathSitePrefix(Environment::getBackendPath()) . '/ext/',",
          "3042:             '\"' . $encodedAbsRefPrefix . PathUtility::stripPathSitePrefix(Environment::getFrameworkBasePath()) . '/',",
          "3048:             $replace[] = '\"' . $encodedAbsRefPrefix . $directory;",
          "",
          "---------------"
        ]
      }
    }
  ]
}