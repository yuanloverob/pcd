{
  "cve_id": "CVE-2022-39220",
  "cve_desc": "SFTPGo is an SFTP server written in Go. Versions prior to 2.3.5 are subject to Cross-site scripting (XSS) vulnerabilities in the SFTPGo WebClient, allowing remote attackers to inject malicious code. This issue is patched in version 2.3.5. No known workarounds exist.",
  "repo": "drakkan/sftpgo",
  "patch_hash": "cbef217cfa92478ee8e00ba1a5fb074f8a8aeee0",
  "patch_info": {
    "commit_hash": "cbef217cfa92478ee8e00ba1a5fb074f8a8aeee0",
    "repo": "drakkan/sftpgo",
    "commit_url": "https://github.com/drakkan/sftpgo/commit/cbef217cfa92478ee8e00ba1a5fb074f8a8aeee0",
    "files": [
      "templates/webadmin/base.html",
      "templates/webclient/base.html",
      "templates/webclient/files.html",
      "templates/webclient/sharefiles.html",
      "templates/webclient/shareupload.html"
    ],
    "message": "WebClient: improve HTML escaping\n\nSigned-off-by: Nicola Murino <nicola.murino@gmail.com>",
    "before_after_code_files": [
      "templates/webadmin/base.html||templates/webadmin/base.html",
      "templates/webclient/base.html||templates/webclient/base.html",
      "templates/webclient/files.html||templates/webclient/files.html",
      "templates/webclient/sharefiles.html||templates/webclient/sharefiles.html",
      "templates/webclient/shareupload.html||templates/webclient/shareupload.html"
    ]
  },
  "patch_diff": {
    "templates/webadmin/base.html||templates/webadmin/base.html": [
      "File: templates/webadmin/base.html -> templates/webadmin/base.html",
      "--- Hunk 1 ---",
      "[Context before]",
      "265:     <script src=\"{{.StaticURL}}/js/sb-admin-2.min.js\"></script>",
      "267:     <script type=\"text/javascript\">",
      "268:         function fixedEncodeURIComponent(str) {",
      "270:                 return '%' + c.charCodeAt(0).toString(16);",
      "271:             });",
      "272:         }",
      "",
      "[Removed Lines]",
      "269:             return encodeURIComponent(str).replace(/[!'()*]/g, function (c) {",
      "",
      "[Added Lines]",
      "268:         function escapeHTML(str) {",
      "269:             var div = document.createElement('div');",
      "270:             div.appendChild(document.createTextNode(str));",
      "271:             return div.innerHTML;",
      "272:         }",
      "274:         function unescapeHTML(escapedStr) {",
      "275:             var div = document.createElement('div');",
      "276:             div.innerHTML = escapedStr;",
      "277:             var child = div.childNodes[0];",
      "278:             return child ? child.nodeValue : '';",
      "279:         }",
      "282:             return encodeURIComponent(unescapeHTML(str)).replace(/[!'()*]/g, function (c) {",
      "",
      "---------------"
    ],
    "templates/webclient/base.html||templates/webclient/base.html": [
      "File: templates/webclient/base.html -> templates/webclient/base.html",
      "--- Hunk 1 ---",
      "[Context before]",
      "219:     <script src=\"{{.StaticURL}}/js/sb-admin-2.min.js\"></script>",
      "221:     <script type=\"text/javascript\">",
      "222:         function fixedEncodeURIComponent(str) {",
      "224:                 return '%' + c.charCodeAt(0).toString(16);",
      "225:             });",
      "226:         }",
      "",
      "[Removed Lines]",
      "223:             return encodeURIComponent(str).replace(/[!'()*]/g, function (c) {",
      "",
      "[Added Lines]",
      "222:         function escapeHTML(str) {",
      "223:             var div = document.createElement('div');",
      "224:             div.appendChild(document.createTextNode(str));",
      "225:             return div.innerHTML;",
      "226:         }",
      "228:         function unescapeHTML(escapedStr) {",
      "229:             var div = document.createElement('div');",
      "230:             div.innerHTML = escapedStr;",
      "231:             var child = div.childNodes[0];",
      "232:             return child ? child.nodeValue : '';",
      "233:         }",
      "235:         function escapeHTMLForceSafe(str) {",
      "236:             return str",
      "237:                 .replace(/&/g, '_')",
      "238:                 .replace(/</g, '_')",
      "239:                 .replace(/>/g, '_')",
      "240:                 .replace(/\\\"/g, '_')",
      "241:                 .replace(/\\'/g, '_');",
      "242:         }",
      "245:             return encodeURIComponent(unescapeHTML(str)).replace(/[!'()*]/g, function (c) {",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "229:             return str.replace(/\\//g,'\\u2215');",
      "230:         }",
      "239:     </script>",
      "241:     <!-- Page level plugins -->",
      "",
      "[Removed Lines]",
      "232:         var escapeHTML = function ( t ) {",
      "233:       return t",
      "234:        .replace( /&/g, '&amp;' )",
      "235:        .replace( /</g, '&lt;' )",
      "236:        .replace( />/g, '&gt;' )",
      "237:        .replace( /\"/g, '&quot;' );",
      "238:          };",
      "",
      "[Added Lines]",
      "254:         function b64EncodeUnicode(str) {",
      "255:             return btoa(encodeURIComponent(str));",
      "256:         }",
      "258:         function UnicodeDecodeB64(str) {",
      "259:             return decodeURIComponent(atob(str));",
      "260:         }",
      "",
      "---------------"
    ],
    "templates/webclient/files.html||templates/webclient/files.html": [
      "File: templates/webclient/files.html -> templates/webclient/files.html",
      "--- Hunk 1 ---",
      "[Context before]",
      "239:         if (childReference == null || childReference.closed) {",
      "240:             childProps.set('link', fileLink);",
      "241:             childProps.set('url', url);",
      "243:             childReference = window.open(url, '_blank');",
      "244:             if (!checkerStarted){",
      "245:                 keepAlive();",
      "",
      "[Removed Lines]",
      "242:             childProps.set('file_name', fileName);",
      "",
      "[Added Lines]",
      "242:             childProps.set('file_name', UnicodeDecodeB64(fileName));",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "367:                 async function saveBlob() {",
      "368:                     var errorMessage = \"Error saving external file\";",
      "370:                     let response;",
      "371:                     try {",
      "372:                         response = await fetch(uploadPath, {",
      "",
      "[Removed Lines]",
      "369:                     var uploadPath = '{{.FileURL}}?path={{.CurrentDir}}'+encodeURIComponent(\"/\"+childProps.get('file_name'));",
      "",
      "[Added Lines]",
      "369:                     var uploadPath = '{{.FileURL}}?path={{.CurrentDir}}'+encodeURIComponent(\"/\"+unescapeHTML(childProps.get('file_name')));",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "447:     }",
      "449:     function openVideoPlayer(name, url, videoType){",
      "451:         $('#videoModal').modal('show');",
      "452:         player.src({",
      "453:             type: videoType,",
      "",
      "[Removed Lines]",
      "450:         $(\"#video_title\").text(name);",
      "",
      "[Added Lines]",
      "450:         $(\"#video_title\").text(UnicodeDecodeB64(name));",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "995:                             var title = \"\";",
      "996:                             var cssClass = \"\";",
      "997:                             var shortened = shortenData(data, 70);",
      "998:                             if (shortened != data){",
      "1000:                                 cssClass = \"ellipsis\";",
      "1001:                             }",
      "",
      "[Removed Lines]",
      "999:                                 title = escapeHTML(data);",
      "",
      "[Added Lines]",
      "998:                             data = escapeHTML(data);",
      "1000:                                 title = data;",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "1017:                 { \"data\": \"edit_url\",",
      "1018:                     \"render\": function (data, type, row) {",
      "1019:                         if (type === 'display') {",
      "1021:                             var extension = filename.slice((filename.lastIndexOf(\".\") - 1 >>> 0) + 2).toLowerCase();",
      "1022:                             if (data){",
      "1023:                                 if (extension == \"csv\" || extension == \"bat\" || CodeMirror.findModeByExtension(extension) != null){",
      "",
      "[Removed Lines]",
      "1020:                             var filename = row[\"name\"];",
      "",
      "[Added Lines]",
      "1021:                             var filename = escapeHTML(row[\"name\"]);",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "1039:                                     case \"svg\":",
      "1040:                                     case \"ico\":",
      "1041:                                         var view_url = row['url']+\"&inline=1\";",
      "1043:                                     case \"mp4\":",
      "1044:                                     case \"mov\":",
      "1046:                                     case \"webm\":",
      "1048:                                     case \"ogv\":",
      "1049:                                     case \"ogg\":",
      "1051:                                     case \"pdf\":",
      "1052:                                         if (PDFObject.supportsPDFs){",
      "1053:                                             var view_url = row['url'];",
      "",
      "[Removed Lines]",
      "1042:                                         return `<a href=\"${view_url}\" data-lightbox=\"image-gallery\" data-title=\"${filename}\"><i class=\"fas fa-eye\"></i></a>`;",
      "1045:                                         return `<a href=\"#\" onclick=\"openVideoPlayer('${row[\"name\"]}', '${row['url']}', 'video/mp4');\"><i class=\"fas fa-eye\"></i></a>`;",
      "1047:                                         return `<a href=\"#\" onclick=\"openVideoPlayer('${row[\"name\"]}', '${row['url']}', 'video/webm');\"><i class=\"fas fa-eye\"></i></a>`;",
      "1050:                                         return `<a href=\"#\" onclick=\"openVideoPlayer('${row[\"name\"]}', '${row['url']}', 'video/ogg');\"><i class=\"fas fa-eye\"></i></a>`;",
      "",
      "[Added Lines]",
      "1043:                                         var title = escapeHTMLForceSafe(row[\"name\"])",
      "1044:                                         return `<a href=\"${view_url}\" data-lightbox=\"image-gallery\" data-title=\"${title}\"><i class=\"fas fa-eye\"></i></a>`;",
      "1047:                                         var name = b64EncodeUnicode(row[\"name\"]);",
      "1048:                                         return `<a href=\"#\" onclick=\"openVideoPlayer('${name}', '${row['url']}', 'video/mp4');\"><i class=\"fas fa-eye\"></i></a>`;",
      "1050:                                         var name = b64EncodeUnicode(row[\"name\"]);",
      "1051:                                         return `<a href=\"#\" onclick=\"openVideoPlayer('${name}', '${row['url']}', 'video/webm');\"><i class=\"fas fa-eye\"></i></a>`;",
      "1054:                                         var name = b64EncodeUnicode(row[\"name\"]);",
      "1055:                                         return `<a href=\"#\" onclick=\"openVideoPlayer('${name}}', '${row['url']}', 'video/ogg');\"><i class=\"fas fa-eye\"></i></a>`;",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "1065:                         {{if .HasIntegrations}}",
      "1066:                         if (type === 'display') {",
      "1067:                             if (data){",
      "1069:                             }",
      "1070:                         }",
      "1071:                         {{end}}",
      "",
      "[Removed Lines]",
      "1068:                                 return `<a href=\"#\" onclick=\"openExternalURL('${data}', '${row[\"ext_link\"]}', '${row[\"name\"]}');\"><i class=\"fas fa-external-link-alt\"></i></a>`;",
      "",
      "[Added Lines]",
      "1073:                                 var name = b64EncodeUnicode(escapeHTML(row[\"name\"]));",
      "1074:                                 return `<a href=\"#\" onclick=\"openExternalURL('${data}', '${row[\"ext_link\"]}', '${name}');\"><i class=\"fas fa-external-link-alt\"></i></a>`;",
      "",
      "---------------"
    ],
    "templates/webclient/sharefiles.html||templates/webclient/sharefiles.html": [
      "File: templates/webclient/sharefiles.html -> templates/webclient/sharefiles.html",
      "--- Hunk 1 ---",
      "[Context before]",
      "94: <script src=\"{{.StaticURL}}/vendor/datatables/dataTables.responsive.min.js\"></script>",
      "95: <script src=\"{{.StaticURL}}/vendor/datatables/responsive.bootstrap4.min.js\"></script>",
      "96: <script type=\"text/javascript\">",
      "106:     function shortenData(d, cutoff) {",
      "107:         if ( typeof d !== 'string' ) {",
      "108:    return d;",
      "109:   }",
      "111:   if ( d.length <= cutoff ) {",
      "113:   }",
      "115:         var shortened = d.substr(0, cutoff-1);",
      "117:     }",
      "119:     function getIconForFile(filename) {",
      "",
      "[Removed Lines]",
      "98:     var escapeHTML = function ( t ) {",
      "99:   return t",
      "100:    .replace( /&/g, '&amp;' )",
      "101:    .replace( /</g, '&lt;' )",
      "102:    .replace( />/g, '&gt;' )",
      "103:    .replace( /\"/g, '&quot;' );",
      "104:  };",
      "112:    return d;",
      "116:         return shortened+'&#8230;';",
      "",
      "[Added Lines]",
      "103:    return escapeHTML(d);",
      "107:         return escapeHTML(shortened)+'&#8230;';",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "250:                     let response;",
      "251:                     try {",
      "252:                         var f = files[index];",
      "254:                         var lastModified;",
      "255:                         try {",
      "256:                             lastModified = f.lastModified;",
      "",
      "[Removed Lines]",
      "253:                         var uploadPath = '{{.UploadBaseURL}}'+fixedEncodeURIComponent(\"/\"+f.name);",
      "",
      "[Added Lines]",
      "244:                         var uploadPath = '{{.UploadBaseURL}}'+fixedEncodeURIComponent(\"/\"+escapeHTML(f.name));",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "384:                             var title = \"\";",
      "385:                             var cssClass = \"\";",
      "386:                             var shortened = shortenData(data, 70);",
      "387:                             if (shortened != data){",
      "388:                                 title = escapeHTML(data);",
      "389:                                 cssClass = \"ellipsis\";",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "378:                             data = escapeHTML(data);",
      "",
      "---------------"
    ],
    "templates/webclient/shareupload.html||templates/webclient/shareupload.html": [
      "File: templates/webclient/shareupload.html -> templates/webclient/shareupload.html",
      "--- Hunk 1 ---",
      "[Context before]",
      "99:                     let response;",
      "100:                     try {",
      "101:                         var f = files[index];",
      "103:                         var lastModified;",
      "104:                         try {",
      "105:                             lastModified = f.lastModified;",
      "",
      "[Removed Lines]",
      "102:                         var uploadPath = '{{.UploadBasePath}}/'+fixedEncodeURIComponent(f.name);",
      "",
      "[Added Lines]",
      "102:                         var uploadPath = '{{.UploadBasePath}}/'+fixedEncodeURIComponent(escapeHTML(f.name));",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "64e87d64bdd2110989e2835aeab563ac83b09911",
      "candidate_info": {
        "commit_hash": "64e87d64bdd2110989e2835aeab563ac83b09911",
        "repo": "drakkan/sftpgo",
        "commit_url": "https://github.com/drakkan/sftpgo/commit/64e87d64bdd2110989e2835aeab563ac83b09911",
        "files": [
          "docs/web-client.md",
          "go.mod",
          "go.sum",
          "httpd/api_utils.go",
          "httpd/httpd.go",
          "httpd/httpd_test.go",
          "httpd/internal_test.go",
          "httpd/server.go",
          "httpd/webclient.go",
          "static/vendor/codemirror/addon/dialog/dialog.css",
          "static/vendor/codemirror/addon/dialog/dialog.js",
          "static/vendor/codemirror/addon/search/jump-to-line.js",
          "static/vendor/codemirror/addon/search/match-highlighter.js",
          "static/vendor/codemirror/addon/search/matchesonscrollbar.css",
          "static/vendor/codemirror/addon/search/matchesonscrollbar.js",
          "static/vendor/codemirror/addon/search/search.js",
          "static/vendor/codemirror/addon/search/searchcursor.js",
          "static/vendor/codemirror/addon/selection/active-line.js",
          "static/vendor/codemirror/codemirror.css",
          "static/vendor/codemirror/codemirror.js",
          "static/vendor/codemirror/meta.js",
          "templates/webadmin/admins.html",
          "templates/webadmin/connections.html",
          "templates/webadmin/defender.html",
          "templates/webadmin/folders.html",
          "templates/webadmin/users.html",
          "templates/webclient/base.html",
          "templates/webclient/editfile.html",
          "templates/webclient/files.html"
        ],
        "message": "web client UI: allow to edit plain text files\n\nFixes #567",
        "before_after_code_files": [
          "go.mod||go.mod",
          "go.sum||go.sum",
          "httpd/api_utils.go||httpd/api_utils.go",
          "httpd/httpd.go||httpd/httpd.go",
          "httpd/httpd_test.go||httpd/httpd_test.go",
          "httpd/internal_test.go||httpd/internal_test.go",
          "httpd/server.go||httpd/server.go",
          "httpd/webclient.go||httpd/webclient.go",
          "static/vendor/codemirror/addon/dialog/dialog.css||static/vendor/codemirror/addon/dialog/dialog.css",
          "static/vendor/codemirror/addon/dialog/dialog.js||static/vendor/codemirror/addon/dialog/dialog.js",
          "static/vendor/codemirror/addon/search/jump-to-line.js||static/vendor/codemirror/addon/search/jump-to-line.js",
          "static/vendor/codemirror/addon/search/match-highlighter.js||static/vendor/codemirror/addon/search/match-highlighter.js",
          "static/vendor/codemirror/addon/search/matchesonscrollbar.css||static/vendor/codemirror/addon/search/matchesonscrollbar.css",
          "static/vendor/codemirror/addon/search/matchesonscrollbar.js||static/vendor/codemirror/addon/search/matchesonscrollbar.js",
          "static/vendor/codemirror/addon/search/search.js||static/vendor/codemirror/addon/search/search.js",
          "static/vendor/codemirror/addon/search/searchcursor.js||static/vendor/codemirror/addon/search/searchcursor.js",
          "static/vendor/codemirror/addon/selection/active-line.js||static/vendor/codemirror/addon/selection/active-line.js",
          "static/vendor/codemirror/codemirror.css||static/vendor/codemirror/codemirror.css",
          "static/vendor/codemirror/codemirror.js||static/vendor/codemirror/codemirror.js",
          "static/vendor/codemirror/meta.js||static/vendor/codemirror/meta.js",
          "templates/webadmin/admins.html||templates/webadmin/admins.html",
          "templates/webadmin/connections.html||templates/webadmin/connections.html",
          "templates/webadmin/defender.html||templates/webadmin/defender.html",
          "templates/webadmin/folders.html||templates/webadmin/folders.html",
          "templates/webadmin/users.html||templates/webadmin/users.html",
          "templates/webclient/base.html||templates/webclient/base.html",
          "templates/webclient/editfile.html||templates/webclient/editfile.html",
          "templates/webclient/files.html||templates/webclient/files.html"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "templates/webclient/base.html||templates/webclient/base.html",
            "templates/webclient/files.html||templates/webclient/files.html"
          ],
          "candidate": [
            "templates/webclient/base.html||templates/webclient/base.html",
            "templates/webclient/files.html||templates/webclient/files.html"
          ]
        }
      },
      "candidate_diff": {
        "go.mod||go.mod": [
          "File: go.mod -> go.mod",
          "--- Hunk 1 ---",
          "[Context before]",
          "7:  github.com/Azure/azure-storage-blob-go v0.14.0",
          "8:  github.com/GehirnInc/crypt v0.0.0-20200316065508-bb7000b8a962",
          "9:  github.com/alexedwards/argon2id v0.0.0-20210511081203-7d35d68092b8",
          "12:  github.com/eikenb/pipeat v0.0.0-20210603033007-44fc3ffce52b",
          "13:  github.com/fatih/color v1.13.0 // indirect",
          "14:  github.com/fclairamb/ftpserverlib v0.16.0",
          "",
          "[Removed Lines]",
          "10:  github.com/aws/aws-sdk-go v1.40.56",
          "11:  github.com/cockroachdb/cockroach-go/v2 v2.2.0",
          "",
          "[Added Lines]",
          "10:  github.com/aws/aws-sdk-go v1.40.59",
          "11:  github.com/cockroachdb/cockroach-go/v2 v2.2.1",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "21:  github.com/google/shlex v0.0.0-20191202100458-e7afc7fbc510",
          "22:  github.com/grandcat/zeroconf v1.0.0",
          "23:  github.com/hashicorp/go-cleanhttp v0.5.2 // indirect",
          "25:  github.com/hashicorp/go-plugin v1.4.3",
          "26:  github.com/hashicorp/go-retryablehttp v0.7.0",
          "27:  github.com/hashicorp/yamux v0.0.0-20210826001029-26ff87cf9493 // indirect",
          "",
          "[Removed Lines]",
          "24:  github.com/hashicorp/go-hclog v0.16.2",
          "",
          "[Added Lines]",
          "24:  github.com/hashicorp/go-hclog v1.0.0",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "63:  gocloud.dev v0.24.0",
          "64:  golang.org/x/crypto v0.0.0-20210915214749-c084706c2272",
          "65:  golang.org/x/net v0.0.0-20211005215030-d2e5035098b3",
          "67:  golang.org/x/time v0.0.0-20210723032227-1f47c861a9ac",
          "68:  google.golang.org/api v0.58.0",
          "70:  google.golang.org/grpc v1.41.0",
          "71:  google.golang.org/protobuf v1.27.1",
          "72:  gopkg.in/natefinch/lumberjack.v2 v2.0.0",
          "",
          "[Removed Lines]",
          "66:  golang.org/x/sys v0.0.0-20211004093028-2c5d950f24ef",
          "69:  google.golang.org/genproto v0.0.0-20211005153810-c76a74d43a8e // indirect",
          "",
          "[Added Lines]",
          "66:  golang.org/x/sys v0.0.0-20211007075335-d3039528d8ac",
          "69:  google.golang.org/genproto v0.0.0-20211008145708-270636b82663 // indirect",
          "",
          "---------------"
        ],
        "go.sum||go.sum": [
          "File: go.sum -> go.sum",
          "--- Hunk 1 ---",
          "[Context before]",
          "137: github.com/aws/aws-sdk-go v1.37.0/go.mod h1:hcU610XS61/+aQV88ixoOzUoG7v3b31pl2zKMmprdro=",
          "138: github.com/aws/aws-sdk-go v1.38.68/go.mod h1:hcU610XS61/+aQV88ixoOzUoG7v3b31pl2zKMmprdro=",
          "139: github.com/aws/aws-sdk-go v1.40.34/go.mod h1:585smgzpB/KqRA+K3y/NL/oYRqQvpNJYvLm+LY1U59Q=",
          "142: github.com/aws/aws-sdk-go-v2 v1.7.0/go.mod h1:tb9wi5s61kTDA5qCkcDbt3KRVV74GGslQkl/DRdX/P4=",
          "143: github.com/aws/aws-sdk-go-v2 v1.9.0/go.mod h1:cK/D0BBs0b/oWPIcX/Z/obahJK1TT7IPVjy53i/mX/4=",
          "144: github.com/aws/aws-sdk-go-v2/config v1.7.0/go.mod h1:w9+nMZ7soXCe5nT46Ri354SNhXDQ6v+V5wqDjnZE+GY=",
          "",
          "[Removed Lines]",
          "140: github.com/aws/aws-sdk-go v1.40.56 h1:FM2yjR0UUYFzDTMx+mH9Vyw1k1EUUxsAFzk+BjkzANA=",
          "141: github.com/aws/aws-sdk-go v1.40.56/go.mod h1:585smgzpB/KqRA+K3y/NL/oYRqQvpNJYvLm+LY1U59Q=",
          "",
          "[Added Lines]",
          "140: github.com/aws/aws-sdk-go v1.40.59 h1:aBHm8lOpwbqmqnUlV5mLYLSBa54bZGR8JZOMzDa/r/Q=",
          "141: github.com/aws/aws-sdk-go v1.40.59/go.mod h1:585smgzpB/KqRA+K3y/NL/oYRqQvpNJYvLm+LY1U59Q=",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "185: github.com/cncf/xds/go v0.0.0-20210312221358-fbca930ec8ed/go.mod h1:eXthEFrGJvWHgFFCl3hGmgk+/aYT6PnTQLykKQRLhEs=",
          "186: github.com/cncf/xds/go v0.0.0-20210805033703-aa0b78936158/go.mod h1:eXthEFrGJvWHgFFCl3hGmgk+/aYT6PnTQLykKQRLhEs=",
          "187: github.com/cockroachdb/apd v1.1.0/go.mod h1:8Sl8LxpKi29FqWXR16WEFZRNSz3SoPzUzeMeY4+DwBQ=",
          "190: github.com/codahale/hdrhistogram v0.0.0-20161010025455-3a0bb77429bd/go.mod h1:sE/e/2PUdi/liOCUjSTXgM1o87ZssimdTWN964YiIeI=",
          "191: github.com/coreos/go-semver v0.3.0/go.mod h1:nnelYz7RCh+5ahJtPPxZlU+153eP4D4r3EedlOD2RNk=",
          "192: github.com/coreos/go-systemd v0.0.0-20190321100706-95778dfbb74e/go.mod h1:F5haX7vjVVG0kc13fIWeqUViNPyEJxv/OmvnBo0Yme4=",
          "",
          "[Removed Lines]",
          "188: github.com/cockroachdb/cockroach-go/v2 v2.2.0 h1:/5znzg5n373N/3ESjHF5SMLxiW4RKB05Ql//KWfeTFs=",
          "189: github.com/cockroachdb/cockroach-go/v2 v2.2.0/go.mod h1:u3MiKYGupPPjkn3ozknpMUpxPaNLTFWAya419/zv6eI=",
          "",
          "[Added Lines]",
          "188: github.com/cockroachdb/cockroach-go/v2 v2.2.1 h1:nZte1DDdL9iu8IV0YPmX8l9Lg2+HRJ3CMvkT3iG52rc=",
          "189: github.com/cockroachdb/cockroach-go/v2 v2.2.1/go.mod h1:u3MiKYGupPPjkn3ozknpMUpxPaNLTFWAya419/zv6eI=",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "415: github.com/hashicorp/go-hclog v0.9.2/go.mod h1:5CU+agLiy3J7N7QjHK5d05KxGsuXiQLrjA0H7acj2lQ=",
          "416: github.com/hashicorp/go-hclog v0.12.0/go.mod h1:whpDNt7SSdeAju8AWKIWsul05p54N/39EeqMAyrmvFQ=",
          "417: github.com/hashicorp/go-hclog v0.14.1/go.mod h1:whpDNt7SSdeAju8AWKIWsul05p54N/39EeqMAyrmvFQ=",
          "420: github.com/hashicorp/go-immutable-radix v1.0.0/go.mod h1:0y9vanUI8NX6FsYoO3zeMjhV/C5i9g4Q3DwcSNZ4P60=",
          "421: github.com/hashicorp/go-msgpack v0.5.3/go.mod h1:ahLV/dePpqEmjfWmKiqvPkv/twdG7iPBM1vqhUKIvfM=",
          "422: github.com/hashicorp/go-multierror v1.0.0/go.mod h1:dHtQlpGsu+cZNNAkkCN/P3hoUDHhCYQXV3UM06sGGrk=",
          "",
          "[Removed Lines]",
          "418: github.com/hashicorp/go-hclog v0.16.2 h1:K4ev2ib4LdQETX5cSZBG0DVLk1jwGqSPXBjdah3veNs=",
          "419: github.com/hashicorp/go-hclog v0.16.2/go.mod h1:whpDNt7SSdeAju8AWKIWsul05p54N/39EeqMAyrmvFQ=",
          "",
          "[Added Lines]",
          "418: github.com/hashicorp/go-hclog v1.0.0 h1:bkKf0BeBXcSYa7f5Fyi9gMuQ8gNsxeiNpZjR6VxNZeo=",
          "419: github.com/hashicorp/go-hclog v1.0.0/go.mod h1:whpDNt7SSdeAju8AWKIWsul05p54N/39EeqMAyrmvFQ=",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "963: golang.org/x/sys v0.0.0-20210908233432-aa78b53d3365/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=",
          "964: golang.org/x/sys v0.0.0-20210917161153-d61c044b1678/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=",
          "965: golang.org/x/sys v0.0.0-20210927094055-39ccf1dd6fa6/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=",
          "968: golang.org/x/term v0.0.0-20201126162022-7de9c90e9dd1 h1:v+OssWQX+hTHEmOBgwxdZxK4zHq3yOs8F9J7mk0PY8E=",
          "969: golang.org/x/term v0.0.0-20201126162022-7de9c90e9dd1/go.mod h1:bj7SfCRtBDWHUb9snDiAeCFNEtKQo2Wmx5Cou7ajbmo=",
          "970: golang.org/x/text v0.0.0-20170915032832-14c0d48ead0c/go.mod h1:NqM8EUOU14njkJ3fqMW+pc6Ldnwhi/IjpwHt7yyuwOQ=",
          "",
          "[Removed Lines]",
          "966: golang.org/x/sys v0.0.0-20211004093028-2c5d950f24ef h1:fPxZ3Umkct3LZ8gK9nbk+DWDJ9fstZa2grBn+lWVKPs=",
          "967: golang.org/x/sys v0.0.0-20211004093028-2c5d950f24ef/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=",
          "",
          "[Added Lines]",
          "966: golang.org/x/sys v0.0.0-20211007075335-d3039528d8ac h1:oN6lz7iLW/YC7un8pq+9bOLyXrprv2+DKfkJY+2LJJw=",
          "967: golang.org/x/sys v0.0.0-20211007075335-d3039528d8ac/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1165: google.golang.org/genproto v0.0.0-20210917145530-b395a37504d4/go.mod h1:eFjDcFEctNawg4eG61bRv87N7iHBWyVhJu7u1kqDUXY=",
          "1166: google.golang.org/genproto v0.0.0-20210921142501-181ce0d877f6/go.mod h1:5CzLGKJ67TSI2B9POpiiyGha0AjJvZIUgRMt1dSmuhc=",
          "1167: google.golang.org/genproto v0.0.0-20210924002016-3dee208752a0/go.mod h1:5CzLGKJ67TSI2B9POpiiyGha0AjJvZIUgRMt1dSmuhc=",
          "1170: google.golang.org/grpc v1.8.0/go.mod h1:yo6s7OP7yaDglbqo1J04qKzAhqBH6lvTonzMVmEdcZw=",
          "1171: google.golang.org/grpc v1.19.0/go.mod h1:mqu4LbDTu4XGKhr4mRzUsmM4RtVoemTSY81AxZiDr8c=",
          "1172: google.golang.org/grpc v1.20.1/go.mod h1:10oTOabMzJvdu6/UiuZezV6QK5dSlG84ov/aaiqXj38=",
          "",
          "[Removed Lines]",
          "1168: google.golang.org/genproto v0.0.0-20211005153810-c76a74d43a8e h1:Im71rbA1N3CbIag/PumYhQcNR8bLNmuOtRIyOnnLsT8=",
          "1169: google.golang.org/genproto v0.0.0-20211005153810-c76a74d43a8e/go.mod h1:5CzLGKJ67TSI2B9POpiiyGha0AjJvZIUgRMt1dSmuhc=",
          "",
          "[Added Lines]",
          "1168: google.golang.org/genproto v0.0.0-20211008145708-270636b82663 h1:33YYJanAOLxgS7pGjzC1IUrFLpwN//bbgtnKYikOmQU=",
          "1169: google.golang.org/genproto v0.0.0-20211008145708-270636b82663/go.mod h1:5CzLGKJ67TSI2B9POpiiyGha0AjJvZIUgRMt1dSmuhc=",
          "",
          "---------------"
        ],
        "httpd/api_utils.go||httpd/api_utils.go": [
          "File: httpd/api_utils.go -> httpd/api_utils.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "71:  if os.IsNotExist(err) {",
          "72:   return http.StatusBadRequest",
          "73:  }",
          "74:  return http.StatusInternalServerError",
          "75: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "74:  if os.IsPermission(err) {",
          "75:   return http.StatusForbidden",
          "76:  }",
          "",
          "---------------"
        ],
        "httpd/httpd.go||httpd/httpd.go": [
          "File: httpd/httpd.go -> httpd/httpd.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "115:  webClientTwoFactorPathDefault         = \"/web/client/twofactor\"",
          "116:  webClientTwoFactorRecoveryPathDefault = \"/web/client/twofactor-recovery\"",
          "117:  webClientFilesPathDefault             = \"/web/client/files\"",
          "118:  webClientDirsPathDefault              = \"/web/client/dirs\"",
          "119:  webClientDownloadZipPathDefault       = \"/web/client/downloadzip\"",
          "120:  webClientProfilePathDefault           = \"/web/client/profile\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "118:  webClientEditFilePathDefault          = \"/web/client/editfile\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "127:  webClientLogoutPathDefault            = \"/web/client/logout\"",
          "128:  webStaticFilesPathDefault             = \"/static\"",
          "136: )",
          "138: var (",
          "",
          "[Removed Lines]",
          "130:  MaxRestoreSize   = 10485760 // 10 MB",
          "131:  maxRequestSize   = 1048576  // 1MB",
          "132:  maxLoginBodySize = 262144   // 256 KB",
          "133:  maxMultipartMem  = 8388608  // 8MB",
          "134:  osWindows        = \"windows\"",
          "135:  otpHeaderCode    = \"X-SFTPGO-OTP\"",
          "",
          "[Added Lines]",
          "131:  MaxRestoreSize       = 10485760 // 10 MB",
          "132:  maxRequestSize       = 1048576  // 1MB",
          "133:  maxLoginBodySize     = 262144   // 256 KB",
          "134:  httpdMaxEditFileSize = 524288   // 512 KB",
          "135:  maxMultipartMem      = 8388608  // 8MB",
          "136:  osWindows            = \"windows\"",
          "137:  otpHeaderCode        = \"X-SFTPGO-OTP\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "179:  webClientTwoFactorPath         string",
          "180:  webClientTwoFactorRecoveryPath string",
          "181:  webClientFilesPath             string",
          "182:  webClientDirsPath              string",
          "183:  webClientDownloadZipPath       string",
          "184:  webClientProfilePath           string",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "184:  webClientEditFilePath          string",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "522:  webClientTwoFactorPath = path.Join(baseURL, webClientTwoFactorPathDefault)",
          "523:  webClientTwoFactorRecoveryPath = path.Join(baseURL, webClientTwoFactorRecoveryPathDefault)",
          "524:  webClientFilesPath = path.Join(baseURL, webClientFilesPathDefault)",
          "525:  webClientDirsPath = path.Join(baseURL, webClientDirsPathDefault)",
          "526:  webClientDownloadZipPath = path.Join(baseURL, webClientDownloadZipPathDefault)",
          "527:  webClientProfilePath = path.Join(baseURL, webClientProfilePathDefault)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "528:  webClientEditFilePath = path.Join(baseURL, webClientEditFilePathDefault)",
          "",
          "---------------"
        ],
        "httpd/httpd_test.go||httpd/httpd_test.go": [
          "File: httpd/httpd_test.go -> httpd/httpd_test.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "128:  webBasePathClient               = \"/web/client\"",
          "129:  webClientLoginPath              = \"/web/client/login\"",
          "130:  webClientFilesPath              = \"/web/client/files\"",
          "131:  webClientDirsPath               = \"/web/client/dirs\"",
          "132:  webClientDownloadZipPath        = \"/web/client/downloadzip\"",
          "133:  webChangeClientPwdPath          = \"/web/client/changepwd\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "131:  webClientEditFilePath           = \"/web/client/editfile\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "3956:  if runtime.GOOS != osWindows {",
          "3957:   err = os.Chmod(backupsPath, 0001)",
          "3958:   assert.NoError(t, err)",
          "3960:   assert.NoError(t, err)",
          "3963:   assert.NoError(t, err)",
          "3964:   err = os.Chmod(backupsPath, 0755)",
          "3965:   assert.NoError(t, err)",
          "",
          "[Removed Lines]",
          "3959:   _, _, err = httpdtest.Dumpdata(\"bck.json\", \"\", \"\", http.StatusInternalServerError)",
          "3962:   _, _, err = httpdtest.Dumpdata(filepath.Join(\"subdir\", \"bck.json\"), \"\", \"\", http.StatusInternalServerError)",
          "",
          "[Added Lines]",
          "3960:   _, _, err = httpdtest.Dumpdata(\"bck.json\", \"\", \"\", http.StatusForbidden)",
          "3963:   _, _, err = httpdtest.Dumpdata(filepath.Join(\"subdir\", \"bck.json\"), \"\", \"\", http.StatusForbidden)",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "4223:  if runtime.GOOS != osWindows {",
          "4224:   err = os.Chmod(backupFilePath, 0111)",
          "4225:   assert.NoError(t, err)",
          "4227:   assert.NoError(t, err)",
          "4228:   err = os.Chmod(backupFilePath, 0644)",
          "4229:   assert.NoError(t, err)",
          "",
          "[Removed Lines]",
          "4226:   _, _, err = httpdtest.Loaddata(backupFilePath, \"1\", \"\", http.StatusInternalServerError)",
          "",
          "[Added Lines]",
          "4227:   _, _, err = httpdtest.Loaddata(backupFilePath, \"1\", \"\", http.StatusForbidden)",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "8357:  assert.NoError(t, err)",
          "8358: }",
          "8360: func TestWebGetFiles(t *testing.T) {",
          "8361:  user, _, err := httpdtest.AddUser(getTestUser(), http.StatusCreated)",
          "8362:  assert.NoError(t, err)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "8361: func TestWebEditFile(t *testing.T) {",
          "8362:  user, _, err := httpdtest.AddUser(getTestUser(), http.StatusCreated)",
          "8363:  assert.NoError(t, err)",
          "8364:  testFile1 := \"testfile1.txt\"",
          "8365:  testFile2 := \"testfile2\"",
          "8366:  file1Size := int64(65536)",
          "8367:  file2Size := int64(655360)",
          "8368:  err = createTestFile(filepath.Join(user.GetHomeDir(), testFile1), file1Size)",
          "8369:  assert.NoError(t, err)",
          "8370:  err = createTestFile(filepath.Join(user.GetHomeDir(), testFile2), file2Size)",
          "8371:  assert.NoError(t, err)",
          "8373:  webToken, err := getJWTWebClientTokenFromTestServer(defaultUsername, defaultPassword)",
          "8374:  assert.NoError(t, err)",
          "8376:  req, err := http.NewRequest(http.MethodGet, webClientEditFilePath+\"?path=\"+testFile1, nil)",
          "8377:  assert.NoError(t, err)",
          "8378:  setJWTCookieForReq(req, webToken)",
          "8379:  rr := executeRequest(req)",
          "8380:  checkResponseCode(t, http.StatusOK, rr)",
          "8382:  req, err = http.NewRequest(http.MethodGet, webClientEditFilePath+\"?path=\"+testFile2, nil)",
          "8383:  assert.NoError(t, err)",
          "8384:  setJWTCookieForReq(req, webToken)",
          "8385:  rr = executeRequest(req)",
          "8386:  checkResponseCode(t, http.StatusBadRequest, rr)",
          "8387:  assert.Contains(t, rr.Body.String(), \"exceeds the maximum allowed size\")",
          "8389:  req, err = http.NewRequest(http.MethodGet, webClientEditFilePath+\"?path=missing\", nil)",
          "8390:  assert.NoError(t, err)",
          "8391:  setJWTCookieForReq(req, webToken)",
          "8392:  rr = executeRequest(req)",
          "8393:  checkResponseCode(t, http.StatusBadRequest, rr)",
          "8394:  assert.Contains(t, rr.Body.String(), \"Unable to stat file\")",
          "8396:  req, err = http.NewRequest(http.MethodGet, webClientEditFilePath+\"?path=%2F\", nil)",
          "8397:  assert.NoError(t, err)",
          "8398:  setJWTCookieForReq(req, webToken)",
          "8399:  rr = executeRequest(req)",
          "8400:  checkResponseCode(t, http.StatusBadRequest, rr)",
          "8401:  assert.Contains(t, rr.Body.String(), \"does not point to a file\")",
          "8403:  user.Filters.DeniedProtocols = []string{common.ProtocolHTTP}",
          "8404:  _, _, err = httpdtest.UpdateUser(user, http.StatusOK, \"\")",
          "8405:  assert.NoError(t, err)",
          "8407:  req, err = http.NewRequest(http.MethodGet, webClientEditFilePath+\"?path=\"+testFile1, nil)",
          "8408:  assert.NoError(t, err)",
          "8409:  setJWTCookieForReq(req, webToken)",
          "8410:  rr = executeRequest(req)",
          "8411:  checkResponseCode(t, http.StatusForbidden, rr)",
          "8413:  user.Filters.DeniedProtocols = []string{common.ProtocolFTP}",
          "8414:  user.Filters.FilePatterns = []sdk.PatternsFilter{",
          "8415:   {",
          "8416:    Path:           \"/\",",
          "8417:    DeniedPatterns: []string{\"*.txt\"},",
          "8418:   },",
          "8419:  }",
          "8420:  _, _, err = httpdtest.UpdateUser(user, http.StatusOK, \"\")",
          "8421:  assert.NoError(t, err)",
          "8423:  req, err = http.NewRequest(http.MethodGet, webClientEditFilePath+\"?path=\"+testFile1, nil)",
          "8424:  assert.NoError(t, err)",
          "8425:  setJWTCookieForReq(req, webToken)",
          "8426:  rr = executeRequest(req)",
          "8427:  checkResponseCode(t, http.StatusForbidden, rr)",
          "8428:  assert.Contains(t, rr.Body.String(), \"Unable to get a reader\")",
          "8430:  _, err = httpdtest.RemoveUser(user, http.StatusOK)",
          "8431:  assert.NoError(t, err)",
          "8432:  err = os.RemoveAll(user.GetHomeDir())",
          "8433:  assert.NoError(t, err)",
          "8435:  req, err = http.NewRequest(http.MethodGet, webClientEditFilePath+\"?path=\"+testFile1, nil)",
          "8436:  assert.NoError(t, err)",
          "8437:  setJWTCookieForReq(req, webToken)",
          "8438:  rr = executeRequest(req)",
          "8439:  checkResponseCode(t, http.StatusNotFound, rr)",
          "8440: }",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "9497: func TestClientUserClose(t *testing.T) {",
          "9498:  u := getTestUser()",
          "9501:  user, _, err := httpdtest.AddUser(u, http.StatusCreated)",
          "9502:  assert.NoError(t, err)",
          "9503:  testFileName := \"file.dat\"",
          "9505:  testFilePath := filepath.Join(user.GetHomeDir(), testFileName)",
          "9506:  err = createTestFile(testFilePath, testFileSize)",
          "9507:  assert.NoError(t, err)",
          "",
          "[Removed Lines]",
          "9499:  u.UploadBandwidth = 64",
          "9500:  u.DownloadBandwidth = 64",
          "9504:  testFileSize := int64(1048576)",
          "",
          "[Added Lines]",
          "9581:  u.UploadBandwidth = 32",
          "9582:  u.DownloadBandwidth = 32",
          "9586:  testFileSize := int64(524288)",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "9523:   checkResponseCode(t, http.StatusOK, rr)",
          "9524:  }()",
          "9525:  wg.Add(1)",
          "9526:  go func() {",
          "9527:   defer wg.Done()",
          "9528:   body := new(bytes.Buffer)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "9608:  go func() {",
          "9609:   defer wg.Done()",
          "9610:   req, _ := http.NewRequest(http.MethodGet, webClientEditFilePath+\"?path=\"+testFileName, nil)",
          "9611:   setJWTCookieForReq(req, webToken)",
          "9612:   rr := executeRequest(req)",
          "9613:   checkResponseCode(t, http.StatusInternalServerError, rr)",
          "9614:   assert.Contains(t, rr.Body.String(), \"Unable to read the file\")",
          "9615:  }()",
          "9616:  wg.Add(1)",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "9547:  assert.Eventually(t, func() bool {",
          "9548:   stats := common.Connections.GetStats()",
          "9550:    if len(stats[0].Transfers) > 0 && len(stats[1].Transfers) > 0 {",
          "9551:     return true",
          "9552:    }",
          "",
          "[Removed Lines]",
          "9549:   if len(stats) == 2 {",
          "",
          "[Added Lines]",
          "9640:   if len(stats) == 3 {",
          "",
          "---------------"
        ],
        "httpd/internal_test.go||httpd/internal_test.go": [
          "File: httpd/internal_test.go -> httpd/internal_test.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "1756:  handleWebClientDownloadZip(rr, req)",
          "1757:  assert.Equal(t, http.StatusForbidden, rr.Code)",
          "1758:  assert.Contains(t, rr.Body.String(), \"Invalid token claims\")",
          "1759: }",
          "1761: func TestInvalidClaims(t *testing.T) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1760:  rr = httptest.NewRecorder()",
          "1761:  req, _ = http.NewRequest(http.MethodGet, webClientEditFilePath, nil)",
          "1762:  req.Header.Set(\"Cookie\", fmt.Sprintf(\"jwt=%v\", token[\"access_token\"]))",
          "1763:  handleClientEditFile(rr, req)",
          "1764:  assert.Equal(t, http.StatusForbidden, rr.Code)",
          "1765:  assert.Contains(t, rr.Body.String(), \"Invalid token claims\")",
          "",
          "---------------"
        ],
        "httpd/server.go||httpd/server.go": [
          "File: httpd/server.go -> httpd/server.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "1088:    router.With(s.refreshCookie).Get(webClientFilesPath, handleClientGetFiles)",
          "1089:    router.With(checkHTTPUserPerm(sdk.WebClientWriteDisabled), verifyCSRFHeader).",
          "1090:     Post(webClientFilesPath, uploadUserFiles)",
          "1091:    router.With(checkHTTPUserPerm(sdk.WebClientWriteDisabled), verifyCSRFHeader).",
          "1092:     Patch(webClientFilesPath, renameUserFile)",
          "1093:    router.With(checkHTTPUserPerm(sdk.WebClientWriteDisabled), verifyCSRFHeader).",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1091:    router.With(checkHTTPUserPerm(sdk.WebClientWriteDisabled), s.refreshCookie).",
          "1092:     Get(webClientEditFilePath, handleClientEditFile)",
          "",
          "---------------"
        ],
        "httpd/webclient.go||httpd/webclient.go": [
          "File: httpd/webclient.go -> httpd/webclient.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: package httpd",
          "3: import (",
          "4:  \"encoding/json\"",
          "5:  \"fmt\"",
          "6:  \"html/template\"",
          "7:  \"net/http\"",
          "8:  \"net/url\"",
          "9:  \"os\"",
          "10:  \"path\"",
          "11:  \"path/filepath\"",
          "12:  \"time\"",
          "14:  \"github.com/go-chi/render\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "4:  \"bytes\"",
          "8:  \"io\"",
          "14:  \"strings\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "35:  templateClientTwoFactor         = \"twofactor.html\"",
          "36:  templateClientTwoFactorRecovery = \"twofactor-recovery.html\"",
          "37:  templateClientMFA               = \"mfa.html\"",
          "38:  pageClientFilesTitle            = \"My Files\"",
          "39:  pageClientProfileTitle          = \"My Profile\"",
          "40:  pageClientChangePwdTitle        = \"Change password\"",
          "41:  pageClient2FATitle              = \"Two-factor auth\"",
          "42: )",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "41:  templateClientEditFile          = \"editfile.html\"",
          "46:  pageClientEditFileTitle         = \"Edit file\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "83:  Href    string",
          "84: }",
          "86: type filesPage struct {",
          "87:  baseClientPage",
          "88:  CurrentDir    string",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "91: type editFilePage struct {",
          "92:  baseClientPage",
          "93:  CurrentDir string",
          "94:  Path       string",
          "95:  Name       string",
          "96:  Data       string",
          "97: }",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "145:   filepath.Join(templatesPath, templateClientDir, templateClientBase),",
          "146:   filepath.Join(templatesPath, templateClientDir, templateClientFiles),",
          "147:  }",
          "148:  profilePaths := []string{",
          "149:   filepath.Join(templatesPath, templateClientDir, templateClientBase),",
          "150:   filepath.Join(templatesPath, templateClientDir, templateClientProfile),",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "161:  editFilePath := []string{",
          "162:   filepath.Join(templatesPath, templateClientDir, templateClientBase),",
          "163:   filepath.Join(templatesPath, templateClientDir, templateClientEditFile),",
          "164:  }",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "182:  mfaTmpl := util.LoadTemplate(nil, mfaPath...)",
          "183:  twoFactorTmpl := util.LoadTemplate(nil, twoFactorPath...)",
          "184:  twoFactorRecoveryTmpl := util.LoadTemplate(nil, twoFactorRecoveryPath...)",
          "186:  clientTemplates[templateClientFiles] = filesTmpl",
          "187:  clientTemplates[templateClientProfile] = profileTmpl",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "202:  editFileTmpl := util.LoadTemplate(nil, editFilePath...)",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "191:  clientTemplates[templateClientMFA] = mfaTmpl",
          "192:  clientTemplates[templateClientTwoFactor] = twoFactorTmpl",
          "193:  clientTemplates[templateClientTwoFactorRecovery] = twoFactorRecoveryTmpl",
          "194: }",
          "196: func getBaseClientPageData(title, currentURL string, r *http.Request) baseClientPage {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "212:  clientTemplates[templateClientEditFile] = editFileTmpl",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "300:  renderClientTemplate(w, templateClientMFA, data)",
          "301: }",
          "303: func renderFilesPage(w http.ResponseWriter, r *http.Request, dirName, error string, user dataprovider.User) {",
          "304:  data := filesPage{",
          "305:   baseClientPage: getBaseClientPageData(pageClientFilesTitle, webClientFilesPath, r),",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "322: func renderEditFilePage(w http.ResponseWriter, r *http.Request, fileName, fileData string) {",
          "323:  data := editFilePage{",
          "324:   baseClientPage: getBaseClientPageData(pageClientEditFileTitle, webClientEditFilePath, r),",
          "325:   Path:           fileName,",
          "326:   Name:           path.Base(fileName),",
          "327:   CurrentDir:     path.Dir(fileName),",
          "328:   Data:           fileData,",
          "329:  }",
          "331:  renderClientTemplate(w, templateClientEditFile, data)",
          "332: }",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "456:  results := make([]map[string]string, 0, len(contents))",
          "457:  for _, info := range contents {",
          "458:   res := make(map[string]string)",
          "459:   if info.IsDir() {",
          "460:    res[\"type\"] = \"1\"",
          "461:    res[\"size\"] = \"\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "490:   res[\"url\"] = getFileObjectURL(name, info.Name())",
          "491:   editURL := \"\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "465:     res[\"size\"] = \"\"",
          "466:    } else {",
          "467:     res[\"size\"] = util.ByteCountIEC(info.Size())",
          "468:    }",
          "469:   }",
          "471:   res[\"name\"] = info.Name()",
          "472:   res[\"last_modified\"] = getFileObjectModTime(info.ModTime())",
          "474:   results = append(results, res)",
          "475:  }",
          "",
          "[Removed Lines]",
          "470:   res[\"type_name\"] = fmt.Sprintf(\"%v_%v\", res[\"type\"], info.Name())",
          "473:   res[\"url\"] = getFileObjectURL(name, info.Name())",
          "",
          "[Added Lines]",
          "501:     if info.Size() < httpdMaxEditFileSize {",
          "502:      editURL = strings.Replace(res[\"url\"], webClientFilesPath, webClientEditFilePath, 1)",
          "503:     }",
          "506:   res[\"meta\"] = fmt.Sprintf(\"%v_%v\", res[\"type\"], info.Name())",
          "509:   res[\"edit_url\"] = editURL",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "534:  }",
          "535: }",
          "537: func handleClientGetProfile(w http.ResponseWriter, r *http.Request) {",
          "538:  r.Body = http.MaxBytesReader(w, r.Body, maxRequestSize)",
          "539:  renderClientProfilePage(w, r, \"\")",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "573: func handleClientEditFile(w http.ResponseWriter, r *http.Request) {",
          "574:  r.Body = http.MaxBytesReader(w, r.Body, maxRequestSize)",
          "575:  claims, err := getTokenClaims(r)",
          "576:  if err != nil || claims.Username == \"\" {",
          "577:   renderClientForbiddenPage(w, r, \"Invalid token claims\")",
          "578:   return",
          "579:  }",
          "581:  user, err := dataprovider.UserExists(claims.Username)",
          "582:  if err != nil {",
          "583:   renderClientMessagePage(w, r, \"Unable to retrieve your user\", \"\", getRespStatus(err), nil, \"\")",
          "584:   return",
          "585:  }",
          "587:  connID := xid.New().String()",
          "588:  connectionID := fmt.Sprintf(\"%v_%v\", common.ProtocolHTTP, connID)",
          "589:  if err := checkHTTPClientUser(&user, r, connectionID); err != nil {",
          "590:   renderClientForbiddenPage(w, r, err.Error())",
          "591:   return",
          "592:  }",
          "593:  connection := &Connection{",
          "594:   BaseConnection: common.NewBaseConnection(connID, common.ProtocolHTTP, util.GetHTTPLocalAddress(r),",
          "595:    r.RemoteAddr, user),",
          "596:   request: r,",
          "597:  }",
          "598:  common.Connections.Add(connection)",
          "599:  defer common.Connections.Remove(connection.GetID())",
          "601:  name := util.CleanPath(r.URL.Query().Get(\"path\"))",
          "602:  info, err := connection.Stat(name, 0)",
          "603:  if err != nil {",
          "604:   renderClientMessagePage(w, r, fmt.Sprintf(\"Unable to stat file %#v\", name), \"\",",
          "605:    getRespStatus(err), nil, \"\")",
          "606:   return",
          "607:  }",
          "608:  if info.IsDir() {",
          "609:   renderClientMessagePage(w, r, fmt.Sprintf(\"The path %#v does not point to a file\", name), \"\",",
          "610:    http.StatusBadRequest, nil, \"\")",
          "611:   return",
          "612:  }",
          "613:  if info.Size() > httpdMaxEditFileSize {",
          "614:   renderClientMessagePage(w, r, fmt.Sprintf(\"The file size %v for %#v exceeds the maximum allowed size\",",
          "615:    util.ByteCountIEC(info.Size()), name), \"\", http.StatusBadRequest, nil, \"\")",
          "616:   return",
          "617:  }",
          "619:  reader, err := connection.getFileReader(name, 0, r.Method)",
          "620:  if err != nil {",
          "621:   renderClientMessagePage(w, r, fmt.Sprintf(\"Unable to get a reader for the file %#v\", name), \"\",",
          "622:    getRespStatus(err), nil, \"\")",
          "623:   return",
          "624:  }",
          "625:  defer reader.Close()",
          "627:  var b bytes.Buffer",
          "628:  _, err = io.Copy(&b, reader)",
          "629:  if err != nil {",
          "630:   renderClientMessagePage(w, r, fmt.Sprintf(\"Unable to read the file %#v\", name), \"\", http.StatusInternalServerError,",
          "631:    nil, \"\")",
          "632:   return",
          "633:  }",
          "635:  renderEditFilePage(w, r, name, b.String())",
          "636: }",
          "",
          "---------------"
        ],
        "static/vendor/codemirror/addon/dialog/dialog.css||static/vendor/codemirror/addon/dialog/dialog.css": [
          "File: static/vendor/codemirror/addon/dialog/dialog.css -> static/vendor/codemirror/addon/dialog/dialog.css",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: .CodeMirror-dialog {",
          "2:   position: absolute;",
          "3:   left: 0; right: 0;",
          "4:   background: inherit;",
          "5:   z-index: 15;",
          "6:   padding: .1em .8em;",
          "7:   overflow: hidden;",
          "8:   color: inherit;",
          "9: }",
          "11: .CodeMirror-dialog-top {",
          "12:   border-bottom: 1px solid #eee;",
          "13:   top: 0;",
          "14: }",
          "16: .CodeMirror-dialog-bottom {",
          "17:   border-top: 1px solid #eee;",
          "18:   bottom: 0;",
          "19: }",
          "21: .CodeMirror-dialog input {",
          "22:   border: none;",
          "23:   outline: none;",
          "24:   background: transparent;",
          "25:   width: 20em;",
          "26:   color: inherit;",
          "27:   font-family: monospace;",
          "28: }",
          "30: .CodeMirror-dialog button {",
          "31:   font-size: 70%;",
          "32: }",
          "",
          "---------------"
        ],
        "static/vendor/codemirror/addon/dialog/dialog.js||static/vendor/codemirror/addon/dialog/dialog.js": [
          "File: static/vendor/codemirror/addon/dialog/dialog.js -> static/vendor/codemirror/addon/dialog/dialog.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "6: (function(mod) {",
          "7:   if (typeof exports == \"object\" && typeof module == \"object\") // CommonJS",
          "8:     mod(require(\"../../lib/codemirror\"));",
          "9:   else if (typeof define == \"function\" && define.amd) // AMD",
          "10:     define([\"../../lib/codemirror\"], mod);",
          "11:   else // Plain browser env",
          "12:     mod(CodeMirror);",
          "13: })(function(CodeMirror) {",
          "14:   function dialogDiv(cm, template, bottom) {",
          "15:     var wrap = cm.getWrapperElement();",
          "16:     var dialog;",
          "17:     dialog = wrap.appendChild(document.createElement(\"div\"));",
          "18:     if (bottom)",
          "19:       dialog.className = \"CodeMirror-dialog CodeMirror-dialog-bottom\";",
          "20:     else",
          "21:       dialog.className = \"CodeMirror-dialog CodeMirror-dialog-top\";",
          "23:     if (typeof template == \"string\") {",
          "24:       dialog.innerHTML = template;",
          "25:     } else { // Assuming it's a detached DOM element.",
          "26:       dialog.appendChild(template);",
          "27:     }",
          "28:     CodeMirror.addClass(wrap, 'dialog-opened');",
          "29:     return dialog;",
          "30:   }",
          "32:   function closeNotification(cm, newVal) {",
          "33:     if (cm.state.currentNotificationClose)",
          "34:       cm.state.currentNotificationClose();",
          "35:     cm.state.currentNotificationClose = newVal;",
          "36:   }",
          "38:   CodeMirror.defineExtension(\"openDialog\", function(template, callback, options) {",
          "39:     if (!options) options = {};",
          "41:     closeNotification(this, null);",
          "43:     var dialog = dialogDiv(this, template, options.bottom);",
          "44:     var closed = false, me = this;",
          "45:     function close(newVal) {",
          "46:       if (typeof newVal == 'string') {",
          "47:         inp.value = newVal;",
          "48:       } else {",
          "49:         if (closed) return;",
          "50:         closed = true;",
          "51:         CodeMirror.rmClass(dialog.parentNode, 'dialog-opened');",
          "52:         dialog.parentNode.removeChild(dialog);",
          "53:         me.focus();",
          "55:         if (options.onClose) options.onClose(dialog);",
          "56:       }",
          "57:     }",
          "59:     var inp = dialog.getElementsByTagName(\"input\")[0], button;",
          "60:     if (inp) {",
          "61:       inp.focus();",
          "63:       if (options.value) {",
          "64:         inp.value = options.value;",
          "65:         if (options.selectValueOnOpen !== false) {",
          "66:           inp.select();",
          "67:         }",
          "68:       }",
          "70:       if (options.onInput)",
          "71:         CodeMirror.on(inp, \"input\", function(e) { options.onInput(e, inp.value, close);});",
          "72:       if (options.onKeyUp)",
          "73:         CodeMirror.on(inp, \"keyup\", function(e) {options.onKeyUp(e, inp.value, close);});",
          "75:       CodeMirror.on(inp, \"keydown\", function(e) {",
          "76:         if (options && options.onKeyDown && options.onKeyDown(e, inp.value, close)) { return; }",
          "77:         if (e.keyCode == 27 || (options.closeOnEnter !== false && e.keyCode == 13)) {",
          "78:           inp.blur();",
          "79:           CodeMirror.e_stop(e);",
          "80:           close();",
          "81:         }",
          "82:         if (e.keyCode == 13) callback(inp.value, e);",
          "83:       });",
          "85:       if (options.closeOnBlur !== false) CodeMirror.on(dialog, \"focusout\", function (evt) {",
          "86:         if (evt.relatedTarget !== null) close();",
          "87:       });",
          "88:     } else if (button = dialog.getElementsByTagName(\"button\")[0]) {",
          "89:       CodeMirror.on(button, \"click\", function() {",
          "90:         close();",
          "91:         me.focus();",
          "92:       });",
          "94:       if (options.closeOnBlur !== false) CodeMirror.on(button, \"blur\", close);",
          "96:       button.focus();",
          "97:     }",
          "98:     return close;",
          "99:   });",
          "101:   CodeMirror.defineExtension(\"openConfirm\", function(template, callbacks, options) {",
          "102:     closeNotification(this, null);",
          "103:     var dialog = dialogDiv(this, template, options && options.bottom);",
          "104:     var buttons = dialog.getElementsByTagName(\"button\");",
          "105:     var closed = false, me = this, blurring = 1;",
          "106:     function close() {",
          "107:       if (closed) return;",
          "108:       closed = true;",
          "109:       CodeMirror.rmClass(dialog.parentNode, 'dialog-opened');",
          "110:       dialog.parentNode.removeChild(dialog);",
          "111:       me.focus();",
          "112:     }",
          "113:     buttons[0].focus();",
          "114:     for (var i = 0; i < buttons.length; ++i) {",
          "115:       var b = buttons[i];",
          "116:       (function(callback) {",
          "117:         CodeMirror.on(b, \"click\", function(e) {",
          "118:           CodeMirror.e_preventDefault(e);",
          "119:           close();",
          "120:           if (callback) callback(me);",
          "121:         });",
          "122:       })(callbacks[i]);",
          "123:       CodeMirror.on(b, \"blur\", function() {",
          "124:         --blurring;",
          "125:         setTimeout(function() { if (blurring <= 0) close(); }, 200);",
          "126:       });",
          "127:       CodeMirror.on(b, \"focus\", function() { ++blurring; });",
          "128:     }",
          "129:   });",
          "139:   CodeMirror.defineExtension(\"openNotification\", function(template, options) {",
          "140:     closeNotification(this, close);",
          "141:     var dialog = dialogDiv(this, template, options && options.bottom);",
          "142:     var closed = false, doneTimer;",
          "143:     var duration = options && typeof options.duration !== \"undefined\" ? options.duration : 5000;",
          "145:     function close() {",
          "146:       if (closed) return;",
          "147:       closed = true;",
          "148:       clearTimeout(doneTimer);",
          "149:       CodeMirror.rmClass(dialog.parentNode, 'dialog-opened');",
          "150:       dialog.parentNode.removeChild(dialog);",
          "151:     }",
          "153:     CodeMirror.on(dialog, 'click', function(e) {",
          "154:       CodeMirror.e_preventDefault(e);",
          "155:       close();",
          "156:     });",
          "158:     if (duration)",
          "159:       doneTimer = setTimeout(close, duration);",
          "161:     return close;",
          "162:   });",
          "163: });",
          "",
          "---------------"
        ],
        "static/vendor/codemirror/addon/search/jump-to-line.js||static/vendor/codemirror/addon/search/jump-to-line.js": [
          "File: static/vendor/codemirror/addon/search/jump-to-line.js -> static/vendor/codemirror/addon/search/jump-to-line.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "6: (function(mod) {",
          "7:   if (typeof exports == \"object\" && typeof module == \"object\") // CommonJS",
          "8:     mod(require(\"../../lib/codemirror\"), require(\"../dialog/dialog\"));",
          "9:   else if (typeof define == \"function\" && define.amd) // AMD",
          "10:     define([\"../../lib/codemirror\", \"../dialog/dialog\"], mod);",
          "11:   else // Plain browser env",
          "12:     mod(CodeMirror);",
          "13: })(function(CodeMirror) {",
          "14:   \"use strict\";",
          "17:   CodeMirror.defineOption(\"search\", {bottom: false});",
          "19:   function dialog(cm, text, shortText, deflt, f) {",
          "20:     if (cm.openDialog) cm.openDialog(text, f, {value: deflt, selectValueOnOpen: true, bottom: cm.options.search.bottom});",
          "21:     else f(prompt(shortText, deflt));",
          "22:   }",
          "24:   function getJumpDialog(cm) {",
          "25:     return cm.phrase(\"Jump to line:\") + ' <input type=\"text\" style=\"width: 10em\" class=\"CodeMirror-search-field\"/> <span style=\"color: #888\" class=\"CodeMirror-search-hint\">' + cm.phrase(\"(Use line:column or scroll% syntax)\") + '</span>';",
          "26:   }",
          "28:   function interpretLine(cm, string) {",
          "29:     var num = Number(string)",
          "30:     if (/^[-+]/.test(string)) return cm.getCursor().line + num",
          "31:     else return num - 1",
          "32:   }",
          "34:   CodeMirror.commands.jumpToLine = function(cm) {",
          "35:     var cur = cm.getCursor();",
          "36:     dialog(cm, getJumpDialog(cm), cm.phrase(\"Jump to line:\"), (cur.line + 1) + \":\" + cur.ch, function(posStr) {",
          "37:       if (!posStr) return;",
          "39:       var match;",
          "40:       if (match = /^\\s*([\\+\\-]?\\d+)\\s*\\:\\s*(\\d+)\\s*$/.exec(posStr)) {",
          "41:         cm.setCursor(interpretLine(cm, match[1]), Number(match[2]))",
          "42:       } else if (match = /^\\s*([\\+\\-]?\\d+(\\.\\d+)?)\\%\\s*/.exec(posStr)) {",
          "43:         var line = Math.round(cm.lineCount() * Number(match[1]) / 100);",
          "44:         if (/^[-+]/.test(match[1])) line = cur.line + line + 1;",
          "45:         cm.setCursor(line - 1, cur.ch);",
          "46:       } else if (match = /^\\s*\\:?\\s*([\\+\\-]?\\d+)\\s*/.exec(posStr)) {",
          "47:         cm.setCursor(interpretLine(cm, match[1]), cur.ch);",
          "48:       }",
          "49:     });",
          "50:   };",
          "52:   CodeMirror.keyMap[\"default\"][\"Alt-G\"] = \"jumpToLine\";",
          "53: });",
          "",
          "---------------"
        ],
        "static/vendor/codemirror/addon/search/match-highlighter.js||static/vendor/codemirror/addon/search/match-highlighter.js": [
          "File: static/vendor/codemirror/addon/search/match-highlighter.js -> static/vendor/codemirror/addon/search/match-highlighter.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "22: (function(mod) {",
          "23:   if (typeof exports == \"object\" && typeof module == \"object\") // CommonJS",
          "24:     mod(require(\"../../lib/codemirror\"), require(\"./matchesonscrollbar\"));",
          "25:   else if (typeof define == \"function\" && define.amd) // AMD",
          "26:     define([\"../../lib/codemirror\", \"./matchesonscrollbar\"], mod);",
          "27:   else // Plain browser env",
          "28:     mod(CodeMirror);",
          "29: })(function(CodeMirror) {",
          "30:   \"use strict\";",
          "32:   var defaults = {",
          "33:     style: \"matchhighlight\",",
          "34:     minChars: 2,",
          "35:     delay: 100,",
          "36:     wordsOnly: false,",
          "37:     annotateScrollbar: false,",
          "38:     showToken: false,",
          "39:     trim: true",
          "40:   }",
          "42:   function State(options) {",
          "43:     this.options = {}",
          "44:     for (var name in defaults)",
          "45:       this.options[name] = (options && options.hasOwnProperty(name) ? options : defaults)[name]",
          "46:     this.overlay = this.timeout = null;",
          "47:     this.matchesonscroll = null;",
          "48:     this.active = false;",
          "49:   }",
          "51:   CodeMirror.defineOption(\"highlightSelectionMatches\", false, function(cm, val, old) {",
          "52:     if (old && old != CodeMirror.Init) {",
          "53:       removeOverlay(cm);",
          "54:       clearTimeout(cm.state.matchHighlighter.timeout);",
          "55:       cm.state.matchHighlighter = null;",
          "56:       cm.off(\"cursorActivity\", cursorActivity);",
          "57:       cm.off(\"focus\", onFocus)",
          "58:     }",
          "59:     if (val) {",
          "60:       var state = cm.state.matchHighlighter = new State(val);",
          "61:       if (cm.hasFocus()) {",
          "62:         state.active = true",
          "63:         highlightMatches(cm)",
          "64:       } else {",
          "65:         cm.on(\"focus\", onFocus)",
          "66:       }",
          "67:       cm.on(\"cursorActivity\", cursorActivity);",
          "68:     }",
          "69:   });",
          "71:   function cursorActivity(cm) {",
          "72:     var state = cm.state.matchHighlighter;",
          "73:     if (state.active || cm.hasFocus()) scheduleHighlight(cm, state)",
          "74:   }",
          "76:   function onFocus(cm) {",
          "77:     var state = cm.state.matchHighlighter",
          "78:     if (!state.active) {",
          "79:       state.active = true",
          "80:       scheduleHighlight(cm, state)",
          "81:     }",
          "82:   }",
          "84:   function scheduleHighlight(cm, state) {",
          "85:     clearTimeout(state.timeout);",
          "86:     state.timeout = setTimeout(function() {highlightMatches(cm);}, state.options.delay);",
          "87:   }",
          "89:   function addOverlay(cm, query, hasBoundary, style) {",
          "90:     var state = cm.state.matchHighlighter;",
          "91:     cm.addOverlay(state.overlay = makeOverlay(query, hasBoundary, style));",
          "92:     if (state.options.annotateScrollbar && cm.showMatchesOnScrollbar) {",
          "93:       var searchFor = hasBoundary ? new RegExp((/\\w/.test(query.charAt(0)) ? \"\\\\b\" : \"\") +",
          "94:                                                query.replace(/[\\\\\\[.+*?(){|^$]/g, \"\\\\$&\") +",
          "95:                                                (/\\w/.test(query.charAt(query.length - 1)) ? \"\\\\b\" : \"\")) : query;",
          "96:       state.matchesonscroll = cm.showMatchesOnScrollbar(searchFor, false,",
          "97:         {className: \"CodeMirror-selection-highlight-scrollbar\"});",
          "98:     }",
          "99:   }",
          "101:   function removeOverlay(cm) {",
          "102:     var state = cm.state.matchHighlighter;",
          "103:     if (state.overlay) {",
          "104:       cm.removeOverlay(state.overlay);",
          "105:       state.overlay = null;",
          "106:       if (state.matchesonscroll) {",
          "107:         state.matchesonscroll.clear();",
          "108:         state.matchesonscroll = null;",
          "109:       }",
          "110:     }",
          "111:   }",
          "113:   function highlightMatches(cm) {",
          "114:     cm.operation(function() {",
          "115:       var state = cm.state.matchHighlighter;",
          "116:       removeOverlay(cm);",
          "117:       if (!cm.somethingSelected() && state.options.showToken) {",
          "118:         var re = state.options.showToken === true ? /[\\w$]/ : state.options.showToken;",
          "119:         var cur = cm.getCursor(), line = cm.getLine(cur.line), start = cur.ch, end = start;",
          "120:         while (start && re.test(line.charAt(start - 1))) --start;",
          "121:         while (end < line.length && re.test(line.charAt(end))) ++end;",
          "122:         if (start < end)",
          "123:           addOverlay(cm, line.slice(start, end), re, state.options.style);",
          "124:         return;",
          "125:       }",
          "126:       var from = cm.getCursor(\"from\"), to = cm.getCursor(\"to\");",
          "127:       if (from.line != to.line) return;",
          "128:       if (state.options.wordsOnly && !isWord(cm, from, to)) return;",
          "129:       var selection = cm.getRange(from, to)",
          "130:       if (state.options.trim) selection = selection.replace(/^\\s+|\\s+$/g, \"\")",
          "131:       if (selection.length >= state.options.minChars)",
          "132:         addOverlay(cm, selection, false, state.options.style);",
          "133:     });",
          "134:   }",
          "136:   function isWord(cm, from, to) {",
          "137:     var str = cm.getRange(from, to);",
          "138:     if (str.match(/^\\w+$/) !== null) {",
          "139:         if (from.ch > 0) {",
          "140:             var pos = {line: from.line, ch: from.ch - 1};",
          "141:             var chr = cm.getRange(pos, from);",
          "142:             if (chr.match(/\\W/) === null) return false;",
          "143:         }",
          "144:         if (to.ch < cm.getLine(from.line).length) {",
          "145:             var pos = {line: to.line, ch: to.ch + 1};",
          "146:             var chr = cm.getRange(to, pos);",
          "147:             if (chr.match(/\\W/) === null) return false;",
          "148:         }",
          "149:         return true;",
          "150:     } else return false;",
          "151:   }",
          "153:   function boundariesAround(stream, re) {",
          "154:     return (!stream.start || !re.test(stream.string.charAt(stream.start - 1))) &&",
          "155:       (stream.pos == stream.string.length || !re.test(stream.string.charAt(stream.pos)));",
          "156:   }",
          "158:   function makeOverlay(query, hasBoundary, style) {",
          "159:     return {token: function(stream) {",
          "160:       if (stream.match(query) &&",
          "161:           (!hasBoundary || boundariesAround(stream, hasBoundary)))",
          "162:         return style;",
          "163:       stream.next();",
          "164:       stream.skipTo(query.charAt(0)) || stream.skipToEnd();",
          "165:     }};",
          "166:   }",
          "167: });",
          "",
          "---------------"
        ],
        "static/vendor/codemirror/addon/search/matchesonscrollbar.css||static/vendor/codemirror/addon/search/matchesonscrollbar.css": [
          "File: static/vendor/codemirror/addon/search/matchesonscrollbar.css -> static/vendor/codemirror/addon/search/matchesonscrollbar.css",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: .CodeMirror-search-match {",
          "2:   background: gold;",
          "3:   border-top: 1px solid orange;",
          "4:   border-bottom: 1px solid orange;",
          "5:   -moz-box-sizing: border-box;",
          "6:   box-sizing: border-box;",
          "7:   opacity: .5;",
          "8: }",
          "",
          "---------------"
        ],
        "static/vendor/codemirror/addon/search/matchesonscrollbar.js||static/vendor/codemirror/addon/search/matchesonscrollbar.js": [
          "File: static/vendor/codemirror/addon/search/matchesonscrollbar.js -> static/vendor/codemirror/addon/search/matchesonscrollbar.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "4: (function(mod) {",
          "5:   if (typeof exports == \"object\" && typeof module == \"object\") // CommonJS",
          "6:     mod(require(\"../../lib/codemirror\"), require(\"./searchcursor\"), require(\"../scroll/annotatescrollbar\"));",
          "7:   else if (typeof define == \"function\" && define.amd) // AMD",
          "8:     define([\"../../lib/codemirror\", \"./searchcursor\", \"../scroll/annotatescrollbar\"], mod);",
          "9:   else // Plain browser env",
          "10:     mod(CodeMirror);",
          "11: })(function(CodeMirror) {",
          "12:   \"use strict\";",
          "14:   CodeMirror.defineExtension(\"showMatchesOnScrollbar\", function(query, caseFold, options) {",
          "15:     if (typeof options == \"string\") options = {className: options};",
          "16:     if (!options) options = {};",
          "17:     return new SearchAnnotation(this, query, caseFold, options);",
          "18:   });",
          "20:   function SearchAnnotation(cm, query, caseFold, options) {",
          "21:     this.cm = cm;",
          "22:     this.options = options;",
          "23:     var annotateOptions = {listenForChanges: false};",
          "24:     for (var prop in options) annotateOptions[prop] = options[prop];",
          "25:     if (!annotateOptions.className) annotateOptions.className = \"CodeMirror-search-match\";",
          "26:     this.annotation = cm.annotateScrollbar(annotateOptions);",
          "27:     this.query = query;",
          "28:     this.caseFold = caseFold;",
          "29:     this.gap = {from: cm.firstLine(), to: cm.lastLine() + 1};",
          "30:     this.matches = [];",
          "31:     this.update = null;",
          "33:     this.findMatches();",
          "34:     this.annotation.update(this.matches);",
          "36:     var self = this;",
          "37:     cm.on(\"change\", this.changeHandler = function(_cm, change) { self.onChange(change); });",
          "38:   }",
          "40:   var MAX_MATCHES = 1000;",
          "42:   SearchAnnotation.prototype.findMatches = function() {",
          "43:     if (!this.gap) return;",
          "44:     for (var i = 0; i < this.matches.length; i++) {",
          "45:       var match = this.matches[i];",
          "46:       if (match.from.line >= this.gap.to) break;",
          "47:       if (match.to.line >= this.gap.from) this.matches.splice(i--, 1);",
          "48:     }",
          "49:     var cursor = this.cm.getSearchCursor(this.query, CodeMirror.Pos(this.gap.from, 0), {caseFold: this.caseFold, multiline: this.options.multiline});",
          "50:     var maxMatches = this.options && this.options.maxMatches || MAX_MATCHES;",
          "51:     while (cursor.findNext()) {",
          "52:       var match = {from: cursor.from(), to: cursor.to()};",
          "53:       if (match.from.line >= this.gap.to) break;",
          "54:       this.matches.splice(i++, 0, match);",
          "55:       if (this.matches.length > maxMatches) break;",
          "56:     }",
          "57:     this.gap = null;",
          "58:   };",
          "60:   function offsetLine(line, changeStart, sizeChange) {",
          "61:     if (line <= changeStart) return line;",
          "62:     return Math.max(changeStart, line + sizeChange);",
          "63:   }",
          "65:   SearchAnnotation.prototype.onChange = function(change) {",
          "66:     var startLine = change.from.line;",
          "67:     var endLine = CodeMirror.changeEnd(change).line;",
          "68:     var sizeChange = endLine - change.to.line;",
          "69:     if (this.gap) {",
          "70:       this.gap.from = Math.min(offsetLine(this.gap.from, startLine, sizeChange), change.from.line);",
          "71:       this.gap.to = Math.max(offsetLine(this.gap.to, startLine, sizeChange), change.from.line);",
          "72:     } else {",
          "73:       this.gap = {from: change.from.line, to: endLine + 1};",
          "74:     }",
          "76:     if (sizeChange) for (var i = 0; i < this.matches.length; i++) {",
          "77:       var match = this.matches[i];",
          "78:       var newFrom = offsetLine(match.from.line, startLine, sizeChange);",
          "79:       if (newFrom != match.from.line) match.from = CodeMirror.Pos(newFrom, match.from.ch);",
          "80:       var newTo = offsetLine(match.to.line, startLine, sizeChange);",
          "81:       if (newTo != match.to.line) match.to = CodeMirror.Pos(newTo, match.to.ch);",
          "82:     }",
          "83:     clearTimeout(this.update);",
          "84:     var self = this;",
          "85:     this.update = setTimeout(function() { self.updateAfterChange(); }, 250);",
          "86:   };",
          "88:   SearchAnnotation.prototype.updateAfterChange = function() {",
          "89:     this.findMatches();",
          "90:     this.annotation.update(this.matches);",
          "91:   };",
          "93:   SearchAnnotation.prototype.clear = function() {",
          "94:     this.cm.off(\"change\", this.changeHandler);",
          "95:     this.annotation.clear();",
          "96:   };",
          "97: });",
          "",
          "---------------"
        ],
        "static/vendor/codemirror/addon/search/search.js||static/vendor/codemirror/addon/search/search.js": [
          "File: static/vendor/codemirror/addon/search/search.js -> static/vendor/codemirror/addon/search/search.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "12: (function(mod) {",
          "13:   if (typeof exports == \"object\" && typeof module == \"object\") // CommonJS",
          "14:     mod(require(\"../../lib/codemirror\"), require(\"./searchcursor\"), require(\"../dialog/dialog\"));",
          "15:   else if (typeof define == \"function\" && define.amd) // AMD",
          "16:     define([\"../../lib/codemirror\", \"./searchcursor\", \"../dialog/dialog\"], mod);",
          "17:   else // Plain browser env",
          "18:     mod(CodeMirror);",
          "19: })(function(CodeMirror) {",
          "20:   \"use strict\";",
          "23:   CodeMirror.defineOption(\"search\", {bottom: false});",
          "25:   function searchOverlay(query, caseInsensitive) {",
          "26:     if (typeof query == \"string\")",
          "27:       query = new RegExp(query.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, \"\\\\$&\"), caseInsensitive ? \"gi\" : \"g\");",
          "28:     else if (!query.global)",
          "29:       query = new RegExp(query.source, query.ignoreCase ? \"gi\" : \"g\");",
          "31:     return {token: function(stream) {",
          "32:       query.lastIndex = stream.pos;",
          "33:       var match = query.exec(stream.string);",
          "34:       if (match && match.index == stream.pos) {",
          "35:         stream.pos += match[0].length || 1;",
          "36:         return \"searching\";",
          "37:       } else if (match) {",
          "38:         stream.pos = match.index;",
          "39:       } else {",
          "40:         stream.skipToEnd();",
          "41:       }",
          "42:     }};",
          "43:   }",
          "45:   function SearchState() {",
          "46:     this.posFrom = this.posTo = this.lastQuery = this.query = null;",
          "47:     this.overlay = null;",
          "48:   }",
          "50:   function getSearchState(cm) {",
          "51:     return cm.state.search || (cm.state.search = new SearchState());",
          "52:   }",
          "54:   function queryCaseInsensitive(query) {",
          "55:     return typeof query == \"string\" && query == query.toLowerCase();",
          "56:   }",
          "58:   function getSearchCursor(cm, query, pos) {",
          "60:     return cm.getSearchCursor(query, pos, {caseFold: queryCaseInsensitive(query), multiline: true});",
          "61:   }",
          "63:   function persistentDialog(cm, text, deflt, onEnter, onKeyDown) {",
          "64:     cm.openDialog(text, onEnter, {",
          "65:       value: deflt,",
          "66:       selectValueOnOpen: true,",
          "67:       closeOnEnter: false,",
          "68:       onClose: function() { clearSearch(cm); },",
          "69:       onKeyDown: onKeyDown,",
          "70:       bottom: cm.options.search.bottom",
          "71:     });",
          "72:   }",
          "74:   function dialog(cm, text, shortText, deflt, f) {",
          "75:     if (cm.openDialog) cm.openDialog(text, f, {value: deflt, selectValueOnOpen: true, bottom: cm.options.search.bottom});",
          "76:     else f(prompt(shortText, deflt));",
          "77:   }",
          "79:   function confirmDialog(cm, text, shortText, fs) {",
          "80:     if (cm.openConfirm) cm.openConfirm(text, fs);",
          "81:     else if (confirm(shortText)) fs[0]();",
          "82:   }",
          "84:   function parseString(string) {",
          "85:     return string.replace(/\\\\([nrt\\\\])/g, function(match, ch) {",
          "86:       if (ch == \"n\") return \"\\n\"",
          "87:       if (ch == \"r\") return \"\\r\"",
          "88:       if (ch == \"t\") return \"\\t\"",
          "89:       if (ch == \"\\\\\") return \"\\\\\"",
          "90:       return match",
          "91:     })",
          "92:   }",
          "94:   function parseQuery(query) {",
          "95:     var isRE = query.match(/^\\/(.*)\\/([a-z]*)$/);",
          "96:     if (isRE) {",
          "97:       try { query = new RegExp(isRE[1], isRE[2].indexOf(\"i\") == -1 ? \"\" : \"i\"); }",
          "98:       catch(e) {} // Not a regular expression after all, do a string search",
          "99:     } else {",
          "100:       query = parseString(query)",
          "101:     }",
          "102:     if (typeof query == \"string\" ? query == \"\" : query.test(\"\"))",
          "103:       query = /x^/;",
          "104:     return query;",
          "105:   }",
          "107:   function startSearch(cm, state, query) {",
          "108:     state.queryText = query;",
          "109:     state.query = parseQuery(query);",
          "110:     cm.removeOverlay(state.overlay, queryCaseInsensitive(state.query));",
          "111:     state.overlay = searchOverlay(state.query, queryCaseInsensitive(state.query));",
          "112:     cm.addOverlay(state.overlay);",
          "113:     if (cm.showMatchesOnScrollbar) {",
          "114:       if (state.annotate) { state.annotate.clear(); state.annotate = null; }",
          "115:       state.annotate = cm.showMatchesOnScrollbar(state.query, queryCaseInsensitive(state.query));",
          "116:     }",
          "117:   }",
          "119:   function doSearch(cm, rev, persistent, immediate) {",
          "120:     var state = getSearchState(cm);",
          "121:     if (state.query) return findNext(cm, rev);",
          "122:     var q = cm.getSelection() || state.lastQuery;",
          "123:     if (q instanceof RegExp && q.source == \"x^\") q = null",
          "124:     if (persistent && cm.openDialog) {",
          "125:       var hiding = null",
          "126:       var searchNext = function(query, event) {",
          "127:         CodeMirror.e_stop(event);",
          "128:         if (!query) return;",
          "129:         if (query != state.queryText) {",
          "130:           startSearch(cm, state, query);",
          "131:           state.posFrom = state.posTo = cm.getCursor();",
          "132:         }",
          "133:         if (hiding) hiding.style.opacity = 1",
          "134:         findNext(cm, event.shiftKey, function(_, to) {",
          "135:           var dialog",
          "136:           if (to.line < 3 && document.querySelector &&",
          "137:               (dialog = cm.display.wrapper.querySelector(\".CodeMirror-dialog\")) &&",
          "138:               dialog.getBoundingClientRect().bottom - 4 > cm.cursorCoords(to, \"window\").top)",
          "139:             (hiding = dialog).style.opacity = .4",
          "140:         })",
          "141:       };",
          "142:       persistentDialog(cm, getQueryDialog(cm), q, searchNext, function(event, query) {",
          "143:         var keyName = CodeMirror.keyName(event)",
          "144:         var extra = cm.getOption('extraKeys'), cmd = (extra && extra[keyName]) || CodeMirror.keyMap[cm.getOption(\"keyMap\")][keyName]",
          "145:         if (cmd == \"findNext\" || cmd == \"findPrev\" ||",
          "146:           cmd == \"findPersistentNext\" || cmd == \"findPersistentPrev\") {",
          "147:           CodeMirror.e_stop(event);",
          "148:           startSearch(cm, getSearchState(cm), query);",
          "149:           cm.execCommand(cmd);",
          "150:         } else if (cmd == \"find\" || cmd == \"findPersistent\") {",
          "151:           CodeMirror.e_stop(event);",
          "152:           searchNext(query, event);",
          "153:         }",
          "154:       });",
          "155:       if (immediate && q) {",
          "156:         startSearch(cm, state, q);",
          "157:         findNext(cm, rev);",
          "158:       }",
          "159:     } else {",
          "160:       dialog(cm, getQueryDialog(cm), \"Search for:\", q, function(query) {",
          "161:         if (query && !state.query) cm.operation(function() {",
          "162:           startSearch(cm, state, query);",
          "163:           state.posFrom = state.posTo = cm.getCursor();",
          "164:           findNext(cm, rev);",
          "165:         });",
          "166:       });",
          "167:     }",
          "168:   }",
          "170:   function findNext(cm, rev, callback) {cm.operation(function() {",
          "171:     var state = getSearchState(cm);",
          "172:     var cursor = getSearchCursor(cm, state.query, rev ? state.posFrom : state.posTo);",
          "173:     if (!cursor.find(rev)) {",
          "174:       cursor = getSearchCursor(cm, state.query, rev ? CodeMirror.Pos(cm.lastLine()) : CodeMirror.Pos(cm.firstLine(), 0));",
          "175:       if (!cursor.find(rev)) return;",
          "176:     }",
          "177:     cm.setSelection(cursor.from(), cursor.to());",
          "178:     cm.scrollIntoView({from: cursor.from(), to: cursor.to()}, 20);",
          "179:     state.posFrom = cursor.from(); state.posTo = cursor.to();",
          "180:     if (callback) callback(cursor.from(), cursor.to())",
          "181:   });}",
          "183:   function clearSearch(cm) {cm.operation(function() {",
          "184:     var state = getSearchState(cm);",
          "185:     state.lastQuery = state.query;",
          "186:     if (!state.query) return;",
          "187:     state.query = state.queryText = null;",
          "188:     cm.removeOverlay(state.overlay);",
          "189:     if (state.annotate) { state.annotate.clear(); state.annotate = null; }",
          "190:   });}",
          "192:   function el(tag, attrs) {",
          "193:     var element = tag ? document.createElement(tag) : document.createDocumentFragment();",
          "194:     for (var key in attrs) {",
          "195:       element[key] = attrs[key];",
          "196:     }",
          "197:     for (var i = 2; i < arguments.length; i++) {",
          "198:       var child = arguments[i]",
          "199:       element.appendChild(typeof child == \"string\" ? document.createTextNode(child) : child);",
          "200:     }",
          "201:     return element;",
          "202:   }",
          "204:   function getQueryDialog(cm)  {",
          "205:     return el(\"\", null,",
          "206:               el(\"span\", {className: \"CodeMirror-search-label\"}, cm.phrase(\"Search:\")), \" \",",
          "207:               el(\"input\", {type: \"text\", \"style\": \"width: 10em\", className: \"CodeMirror-search-field\"}), \" \",",
          "208:               el(\"span\", {style: \"color: #888\", className: \"CodeMirror-search-hint\"},",
          "209:                  cm.phrase(\"(Use /re/ syntax for regexp search)\")));",
          "210:   }",
          "211:   function getReplaceQueryDialog(cm) {",
          "212:     return el(\"\", null, \" \",",
          "213:               el(\"input\", {type: \"text\", \"style\": \"width: 10em\", className: \"CodeMirror-search-field\"}), \" \",",
          "214:               el(\"span\", {style: \"color: #888\", className: \"CodeMirror-search-hint\"},",
          "215:                  cm.phrase(\"(Use /re/ syntax for regexp search)\")));",
          "216:   }",
          "217:   function getReplacementQueryDialog(cm) {",
          "218:     return el(\"\", null,",
          "219:               el(\"span\", {className: \"CodeMirror-search-label\"}, cm.phrase(\"With:\")), \" \",",
          "220:               el(\"input\", {type: \"text\", \"style\": \"width: 10em\", className: \"CodeMirror-search-field\"}));",
          "221:   }",
          "222:   function getDoReplaceConfirm(cm) {",
          "223:     return el(\"\", null,",
          "224:               el(\"span\", {className: \"CodeMirror-search-label\"}, cm.phrase(\"Replace?\")), \" \",",
          "225:               el(\"button\", {}, cm.phrase(\"Yes\")), \" \",",
          "226:               el(\"button\", {}, cm.phrase(\"No\")), \" \",",
          "227:               el(\"button\", {}, cm.phrase(\"All\")), \" \",",
          "228:               el(\"button\", {}, cm.phrase(\"Stop\")));",
          "229:   }",
          "231:   function replaceAll(cm, query, text) {",
          "232:     cm.operation(function() {",
          "233:       for (var cursor = getSearchCursor(cm, query); cursor.findNext();) {",
          "234:         if (typeof query != \"string\") {",
          "235:           var match = cm.getRange(cursor.from(), cursor.to()).match(query);",
          "236:           cursor.replace(text.replace(/\\$(\\d)/g, function(_, i) {return match[i];}));",
          "237:         } else cursor.replace(text);",
          "238:       }",
          "239:     });",
          "240:   }",
          "242:   function replace(cm, all) {",
          "243:     if (cm.getOption(\"readOnly\")) return;",
          "244:     var query = cm.getSelection() || getSearchState(cm).lastQuery;",
          "245:     var dialogText = all ? cm.phrase(\"Replace all:\") : cm.phrase(\"Replace:\")",
          "246:     var fragment = el(\"\", null,",
          "247:                       el(\"span\", {className: \"CodeMirror-search-label\"}, dialogText),",
          "248:                       getReplaceQueryDialog(cm))",
          "249:     dialog(cm, fragment, dialogText, query, function(query) {",
          "250:       if (!query) return;",
          "251:       query = parseQuery(query);",
          "252:       dialog(cm, getReplacementQueryDialog(cm), cm.phrase(\"Replace with:\"), \"\", function(text) {",
          "253:         text = parseString(text)",
          "254:         if (all) {",
          "255:           replaceAll(cm, query, text)",
          "256:         } else {",
          "257:           clearSearch(cm);",
          "258:           var cursor = getSearchCursor(cm, query, cm.getCursor(\"from\"));",
          "259:           var advance = function() {",
          "260:             var start = cursor.from(), match;",
          "261:             if (!(match = cursor.findNext())) {",
          "262:               cursor = getSearchCursor(cm, query);",
          "263:               if (!(match = cursor.findNext()) ||",
          "264:                   (start && cursor.from().line == start.line && cursor.from().ch == start.ch)) return;",
          "265:             }",
          "266:             cm.setSelection(cursor.from(), cursor.to());",
          "267:             cm.scrollIntoView({from: cursor.from(), to: cursor.to()});",
          "268:             confirmDialog(cm, getDoReplaceConfirm(cm), cm.phrase(\"Replace?\"),",
          "269:                           [function() {doReplace(match);}, advance,",
          "270:                            function() {replaceAll(cm, query, text)}]);",
          "271:           };",
          "272:           var doReplace = function(match) {",
          "273:             cursor.replace(typeof query == \"string\" ? text :",
          "274:                            text.replace(/\\$(\\d)/g, function(_, i) {return match[i];}));",
          "275:             advance();",
          "276:           };",
          "277:           advance();",
          "278:         }",
          "279:       });",
          "280:     });",
          "281:   }",
          "283:   CodeMirror.commands.find = function(cm) {clearSearch(cm); doSearch(cm);};",
          "284:   CodeMirror.commands.findPersistent = function(cm) {clearSearch(cm); doSearch(cm, false, true);};",
          "285:   CodeMirror.commands.findPersistentNext = function(cm) {doSearch(cm, false, true, true);};",
          "286:   CodeMirror.commands.findPersistentPrev = function(cm) {doSearch(cm, true, true, true);};",
          "287:   CodeMirror.commands.findNext = doSearch;",
          "288:   CodeMirror.commands.findPrev = function(cm) {doSearch(cm, true);};",
          "289:   CodeMirror.commands.clearSearch = clearSearch;",
          "290:   CodeMirror.commands.replace = replace;",
          "291:   CodeMirror.commands.replaceAll = function(cm) {replace(cm, true);};",
          "292: });",
          "",
          "---------------"
        ],
        "static/vendor/codemirror/addon/search/searchcursor.js||static/vendor/codemirror/addon/search/searchcursor.js": [
          "File: static/vendor/codemirror/addon/search/searchcursor.js -> static/vendor/codemirror/addon/search/searchcursor.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "4: (function(mod) {",
          "5:   if (typeof exports == \"object\" && typeof module == \"object\") // CommonJS",
          "6:     mod(require(\"../../lib/codemirror\"))",
          "7:   else if (typeof define == \"function\" && define.amd) // AMD",
          "8:     define([\"../../lib/codemirror\"], mod)",
          "9:   else // Plain browser env",
          "10:     mod(CodeMirror)",
          "11: })(function(CodeMirror) {",
          "12:   \"use strict\"",
          "13:   var Pos = CodeMirror.Pos",
          "15:   function regexpFlags(regexp) {",
          "16:     var flags = regexp.flags",
          "17:     return flags != null ? flags : (regexp.ignoreCase ? \"i\" : \"\")",
          "18:       + (regexp.global ? \"g\" : \"\")",
          "19:       + (regexp.multiline ? \"m\" : \"\")",
          "20:   }",
          "22:   function ensureFlags(regexp, flags) {",
          "23:     var current = regexpFlags(regexp), target = current",
          "24:     for (var i = 0; i < flags.length; i++) if (target.indexOf(flags.charAt(i)) == -1)",
          "25:       target += flags.charAt(i)",
          "26:     return current == target ? regexp : new RegExp(regexp.source, target)",
          "27:   }",
          "29:   function maybeMultiline(regexp) {",
          "30:     return /\\\\s|\\\\n|\\n|\\\\W|\\\\D|\\[\\^/.test(regexp.source)",
          "31:   }",
          "33:   function searchRegexpForward(doc, regexp, start) {",
          "34:     regexp = ensureFlags(regexp, \"g\")",
          "35:     for (var line = start.line, ch = start.ch, last = doc.lastLine(); line <= last; line++, ch = 0) {",
          "36:       regexp.lastIndex = ch",
          "37:       var string = doc.getLine(line), match = regexp.exec(string)",
          "38:       if (match)",
          "39:         return {from: Pos(line, match.index),",
          "40:                 to: Pos(line, match.index + match[0].length),",
          "41:                 match: match}",
          "42:     }",
          "43:   }",
          "45:   function searchRegexpForwardMultiline(doc, regexp, start) {",
          "46:     if (!maybeMultiline(regexp)) return searchRegexpForward(doc, regexp, start)",
          "48:     regexp = ensureFlags(regexp, \"gm\")",
          "49:     var string, chunk = 1",
          "50:     for (var line = start.line, last = doc.lastLine(); line <= last;) {",
          "56:       for (var i = 0; i < chunk; i++) {",
          "57:         if (line > last) break",
          "58:         var curLine = doc.getLine(line++)",
          "59:         string = string == null ? curLine : string + \"\\n\" + curLine",
          "60:       }",
          "61:       chunk = chunk * 2",
          "62:       regexp.lastIndex = start.ch",
          "63:       var match = regexp.exec(string)",
          "64:       if (match) {",
          "65:         var before = string.slice(0, match.index).split(\"\\n\"), inside = match[0].split(\"\\n\")",
          "66:         var startLine = start.line + before.length - 1, startCh = before[before.length - 1].length",
          "67:         return {from: Pos(startLine, startCh),",
          "68:                 to: Pos(startLine + inside.length - 1,",
          "69:                         inside.length == 1 ? startCh + inside[0].length : inside[inside.length - 1].length),",
          "70:                 match: match}",
          "71:       }",
          "72:     }",
          "73:   }",
          "75:   function lastMatchIn(string, regexp, endMargin) {",
          "76:     var match, from = 0",
          "77:     while (from <= string.length) {",
          "78:       regexp.lastIndex = from",
          "79:       var newMatch = regexp.exec(string)",
          "80:       if (!newMatch) break",
          "81:       var end = newMatch.index + newMatch[0].length",
          "82:       if (end > string.length - endMargin) break",
          "83:       if (!match || end > match.index + match[0].length)",
          "84:         match = newMatch",
          "85:       from = newMatch.index + 1",
          "86:     }",
          "87:     return match",
          "88:   }",
          "90:   function searchRegexpBackward(doc, regexp, start) {",
          "91:     regexp = ensureFlags(regexp, \"g\")",
          "92:     for (var line = start.line, ch = start.ch, first = doc.firstLine(); line >= first; line--, ch = -1) {",
          "93:       var string = doc.getLine(line)",
          "94:       var match = lastMatchIn(string, regexp, ch < 0 ? 0 : string.length - ch)",
          "95:       if (match)",
          "96:         return {from: Pos(line, match.index),",
          "97:                 to: Pos(line, match.index + match[0].length),",
          "98:                 match: match}",
          "99:     }",
          "100:   }",
          "102:   function searchRegexpBackwardMultiline(doc, regexp, start) {",
          "103:     if (!maybeMultiline(regexp)) return searchRegexpBackward(doc, regexp, start)",
          "104:     regexp = ensureFlags(regexp, \"gm\")",
          "105:     var string, chunkSize = 1, endMargin = doc.getLine(start.line).length - start.ch",
          "106:     for (var line = start.line, first = doc.firstLine(); line >= first;) {",
          "107:       for (var i = 0; i < chunkSize && line >= first; i++) {",
          "108:         var curLine = doc.getLine(line--)",
          "109:         string = string == null ? curLine : curLine + \"\\n\" + string",
          "110:       }",
          "111:       chunkSize *= 2",
          "113:       var match = lastMatchIn(string, regexp, endMargin)",
          "114:       if (match) {",
          "115:         var before = string.slice(0, match.index).split(\"\\n\"), inside = match[0].split(\"\\n\")",
          "116:         var startLine = line + before.length, startCh = before[before.length - 1].length",
          "117:         return {from: Pos(startLine, startCh),",
          "118:                 to: Pos(startLine + inside.length - 1,",
          "119:                         inside.length == 1 ? startCh + inside[0].length : inside[inside.length - 1].length),",
          "120:                 match: match}",
          "121:       }",
          "122:     }",
          "123:   }",
          "125:   var doFold, noFold",
          "126:   if (String.prototype.normalize) {",
          "127:     doFold = function(str) { return str.normalize(\"NFD\").toLowerCase() }",
          "128:     noFold = function(str) { return str.normalize(\"NFD\") }",
          "129:   } else {",
          "130:     doFold = function(str) { return str.toLowerCase() }",
          "131:     noFold = function(str) { return str }",
          "132:   }",
          "136:   function adjustPos(orig, folded, pos, foldFunc) {",
          "137:     if (orig.length == folded.length) return pos",
          "138:     for (var min = 0, max = pos + Math.max(0, orig.length - folded.length);;) {",
          "139:       if (min == max) return min",
          "140:       var mid = (min + max) >> 1",
          "141:       var len = foldFunc(orig.slice(0, mid)).length",
          "142:       if (len == pos) return mid",
          "143:       else if (len > pos) max = mid",
          "144:       else min = mid + 1",
          "145:     }",
          "146:   }",
          "148:   function searchStringForward(doc, query, start, caseFold) {",
          "151:     if (!query.length) return null",
          "152:     var fold = caseFold ? doFold : noFold",
          "153:     var lines = fold(query).split(/\\r|\\n\\r?/)",
          "155:     search: for (var line = start.line, ch = start.ch, last = doc.lastLine() + 1 - lines.length; line <= last; line++, ch = 0) {",
          "156:       var orig = doc.getLine(line).slice(ch), string = fold(orig)",
          "157:       if (lines.length == 1) {",
          "158:         var found = string.indexOf(lines[0])",
          "159:         if (found == -1) continue search",
          "160:         var start = adjustPos(orig, string, found, fold) + ch",
          "161:         return {from: Pos(line, adjustPos(orig, string, found, fold) + ch),",
          "162:                 to: Pos(line, adjustPos(orig, string, found + lines[0].length, fold) + ch)}",
          "163:       } else {",
          "164:         var cutFrom = string.length - lines[0].length",
          "165:         if (string.slice(cutFrom) != lines[0]) continue search",
          "166:         for (var i = 1; i < lines.length - 1; i++)",
          "167:           if (fold(doc.getLine(line + i)) != lines[i]) continue search",
          "168:         var end = doc.getLine(line + lines.length - 1), endString = fold(end), lastLine = lines[lines.length - 1]",
          "169:         if (endString.slice(0, lastLine.length) != lastLine) continue search",
          "170:         return {from: Pos(line, adjustPos(orig, string, cutFrom, fold) + ch),",
          "171:                 to: Pos(line + lines.length - 1, adjustPos(end, endString, lastLine.length, fold))}",
          "172:       }",
          "173:     }",
          "174:   }",
          "176:   function searchStringBackward(doc, query, start, caseFold) {",
          "177:     if (!query.length) return null",
          "178:     var fold = caseFold ? doFold : noFold",
          "179:     var lines = fold(query).split(/\\r|\\n\\r?/)",
          "181:     search: for (var line = start.line, ch = start.ch, first = doc.firstLine() - 1 + lines.length; line >= first; line--, ch = -1) {",
          "182:       var orig = doc.getLine(line)",
          "183:       if (ch > -1) orig = orig.slice(0, ch)",
          "184:       var string = fold(orig)",
          "185:       if (lines.length == 1) {",
          "186:         var found = string.lastIndexOf(lines[0])",
          "187:         if (found == -1) continue search",
          "188:         return {from: Pos(line, adjustPos(orig, string, found, fold)),",
          "189:                 to: Pos(line, adjustPos(orig, string, found + lines[0].length, fold))}",
          "190:       } else {",
          "191:         var lastLine = lines[lines.length - 1]",
          "192:         if (string.slice(0, lastLine.length) != lastLine) continue search",
          "193:         for (var i = 1, start = line - lines.length + 1; i < lines.length - 1; i++)",
          "194:           if (fold(doc.getLine(start + i)) != lines[i]) continue search",
          "195:         var top = doc.getLine(line + 1 - lines.length), topString = fold(top)",
          "196:         if (topString.slice(topString.length - lines[0].length) != lines[0]) continue search",
          "197:         return {from: Pos(line + 1 - lines.length, adjustPos(top, topString, top.length - lines[0].length, fold)),",
          "198:                 to: Pos(line, adjustPos(orig, string, lastLine.length, fold))}",
          "199:       }",
          "200:     }",
          "201:   }",
          "203:   function SearchCursor(doc, query, pos, options) {",
          "204:     this.atOccurrence = false",
          "205:     this.doc = doc",
          "206:     pos = pos ? doc.clipPos(pos) : Pos(0, 0)",
          "207:     this.pos = {from: pos, to: pos}",
          "209:     var caseFold",
          "210:     if (typeof options == \"object\") {",
          "211:       caseFold = options.caseFold",
          "212:     } else { // Backwards compat for when caseFold was the 4th argument",
          "213:       caseFold = options",
          "214:       options = null",
          "215:     }",
          "217:     if (typeof query == \"string\") {",
          "218:       if (caseFold == null) caseFold = false",
          "219:       this.matches = function(reverse, pos) {",
          "220:         return (reverse ? searchStringBackward : searchStringForward)(doc, query, pos, caseFold)",
          "221:       }",
          "222:     } else {",
          "223:       query = ensureFlags(query, \"gm\")",
          "224:       if (!options || options.multiline !== false)",
          "225:         this.matches = function(reverse, pos) {",
          "226:           return (reverse ? searchRegexpBackwardMultiline : searchRegexpForwardMultiline)(doc, query, pos)",
          "227:         }",
          "228:       else",
          "229:         this.matches = function(reverse, pos) {",
          "230:           return (reverse ? searchRegexpBackward : searchRegexpForward)(doc, query, pos)",
          "231:         }",
          "232:     }",
          "233:   }",
          "235:   SearchCursor.prototype = {",
          "236:     findNext: function() {return this.find(false)},",
          "237:     findPrevious: function() {return this.find(true)},",
          "239:     find: function(reverse) {",
          "240:       var result = this.matches(reverse, this.doc.clipPos(reverse ? this.pos.from : this.pos.to))",
          "244:       while (result && CodeMirror.cmpPos(result.from, result.to) == 0) {",
          "245:         if (reverse) {",
          "246:           if (result.from.ch) result.from = Pos(result.from.line, result.from.ch - 1)",
          "247:           else if (result.from.line == this.doc.firstLine()) result = null",
          "248:           else result = this.matches(reverse, this.doc.clipPos(Pos(result.from.line - 1)))",
          "249:         } else {",
          "250:           if (result.to.ch < this.doc.getLine(result.to.line).length) result.to = Pos(result.to.line, result.to.ch + 1)",
          "251:           else if (result.to.line == this.doc.lastLine()) result = null",
          "252:           else result = this.matches(reverse, Pos(result.to.line + 1, 0))",
          "253:         }",
          "254:       }",
          "256:       if (result) {",
          "257:         this.pos = result",
          "258:         this.atOccurrence = true",
          "259:         return this.pos.match || true",
          "260:       } else {",
          "261:         var end = Pos(reverse ? this.doc.firstLine() : this.doc.lastLine() + 1, 0)",
          "262:         this.pos = {from: end, to: end}",
          "263:         return this.atOccurrence = false",
          "264:       }",
          "265:     },",
          "267:     from: function() {if (this.atOccurrence) return this.pos.from},",
          "268:     to: function() {if (this.atOccurrence) return this.pos.to},",
          "270:     replace: function(newText, origin) {",
          "271:       if (!this.atOccurrence) return",
          "272:       var lines = CodeMirror.splitLines(newText)",
          "273:       this.doc.replaceRange(lines, this.pos.from, this.pos.to, origin)",
          "274:       this.pos.to = Pos(this.pos.from.line + lines.length - 1,",
          "275:                         lines[lines.length - 1].length + (lines.length == 1 ? this.pos.from.ch : 0))",
          "276:     }",
          "277:   }",
          "279:   CodeMirror.defineExtension(\"getSearchCursor\", function(query, pos, caseFold) {",
          "280:     return new SearchCursor(this.doc, query, pos, caseFold)",
          "281:   })",
          "282:   CodeMirror.defineDocExtension(\"getSearchCursor\", function(query, pos, caseFold) {",
          "283:     return new SearchCursor(this, query, pos, caseFold)",
          "284:   })",
          "286:   CodeMirror.defineExtension(\"selectMatches\", function(query, caseFold) {",
          "287:     var ranges = []",
          "288:     var cur = this.getSearchCursor(query, this.getCursor(\"from\"), caseFold)",
          "289:     while (cur.findNext()) {",
          "290:       if (CodeMirror.cmpPos(cur.to(), this.getCursor(\"to\")) > 0) break",
          "291:       ranges.push({anchor: cur.from(), head: cur.to()})",
          "292:     }",
          "293:     if (ranges.length)",
          "294:       this.setSelections(ranges, 0)",
          "295:   })",
          "296: });",
          "",
          "---------------"
        ],
        "static/vendor/codemirror/addon/selection/active-line.js||static/vendor/codemirror/addon/selection/active-line.js": [
          "File: static/vendor/codemirror/addon/selection/active-line.js -> static/vendor/codemirror/addon/selection/active-line.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "4: (function(mod) {",
          "5:   if (typeof exports == \"object\" && typeof module == \"object\") // CommonJS",
          "6:     mod(require(\"../../lib/codemirror\"));",
          "7:   else if (typeof define == \"function\" && define.amd) // AMD",
          "8:     define([\"../../lib/codemirror\"], mod);",
          "9:   else // Plain browser env",
          "10:     mod(CodeMirror);",
          "11: })(function(CodeMirror) {",
          "12:   \"use strict\";",
          "13:   var WRAP_CLASS = \"CodeMirror-activeline\";",
          "14:   var BACK_CLASS = \"CodeMirror-activeline-background\";",
          "15:   var GUTT_CLASS = \"CodeMirror-activeline-gutter\";",
          "17:   CodeMirror.defineOption(\"styleActiveLine\", false, function(cm, val, old) {",
          "18:     var prev = old == CodeMirror.Init ? false : old;",
          "19:     if (val == prev) return",
          "20:     if (prev) {",
          "21:       cm.off(\"beforeSelectionChange\", selectionChange);",
          "22:       clearActiveLines(cm);",
          "23:       delete cm.state.activeLines;",
          "24:     }",
          "25:     if (val) {",
          "26:       cm.state.activeLines = [];",
          "27:       updateActiveLines(cm, cm.listSelections());",
          "28:       cm.on(\"beforeSelectionChange\", selectionChange);",
          "29:     }",
          "30:   });",
          "32:   function clearActiveLines(cm) {",
          "33:     for (var i = 0; i < cm.state.activeLines.length; i++) {",
          "34:       cm.removeLineClass(cm.state.activeLines[i], \"wrap\", WRAP_CLASS);",
          "35:       cm.removeLineClass(cm.state.activeLines[i], \"background\", BACK_CLASS);",
          "36:       cm.removeLineClass(cm.state.activeLines[i], \"gutter\", GUTT_CLASS);",
          "37:     }",
          "38:   }",
          "40:   function sameArray(a, b) {",
          "41:     if (a.length != b.length) return false;",
          "42:     for (var i = 0; i < a.length; i++)",
          "43:       if (a[i] != b[i]) return false;",
          "44:     return true;",
          "45:   }",
          "47:   function updateActiveLines(cm, ranges) {",
          "48:     var active = [];",
          "49:     for (var i = 0; i < ranges.length; i++) {",
          "50:       var range = ranges[i];",
          "51:       var option = cm.getOption(\"styleActiveLine\");",
          "52:       if (typeof option == \"object\" && option.nonEmpty ? range.anchor.line != range.head.line : !range.empty())",
          "53:         continue",
          "54:       var line = cm.getLineHandleVisualStart(range.head.line);",
          "55:       if (active[active.length - 1] != line) active.push(line);",
          "56:     }",
          "57:     if (sameArray(cm.state.activeLines, active)) return;",
          "58:     cm.operation(function() {",
          "59:       clearActiveLines(cm);",
          "60:       for (var i = 0; i < active.length; i++) {",
          "61:         cm.addLineClass(active[i], \"wrap\", WRAP_CLASS);",
          "62:         cm.addLineClass(active[i], \"background\", BACK_CLASS);",
          "63:         cm.addLineClass(active[i], \"gutter\", GUTT_CLASS);",
          "64:       }",
          "65:       cm.state.activeLines = active;",
          "66:     });",
          "67:   }",
          "69:   function selectionChange(cm, sel) {",
          "70:     updateActiveLines(cm, sel.ranges);",
          "71:   }",
          "72: });",
          "",
          "---------------"
        ],
        "static/vendor/codemirror/codemirror.css||static/vendor/codemirror/codemirror.css": [
          "File: static/vendor/codemirror/codemirror.css -> static/vendor/codemirror/codemirror.css",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3: .CodeMirror {",
          "5:   font-family: monospace;",
          "6:   height: 300px;",
          "7:   color: black;",
          "8:   direction: ltr;",
          "9: }",
          "13: .CodeMirror-lines {",
          "15: }",
          "16: .CodeMirror pre.CodeMirror-line,",
          "17: .CodeMirror pre.CodeMirror-line-like {",
          "19: }",
          "21: .CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler {",
          "23: }",
          "27: .CodeMirror-gutters {",
          "28:   border-right: 1px solid #ddd;",
          "29:   background-color: #f7f7f7;",
          "30:   white-space: nowrap;",
          "31: }",
          "32: .CodeMirror-linenumbers {}",
          "33: .CodeMirror-linenumber {",
          "34:   padding: 0 3px 0 5px;",
          "35:   min-width: 20px;",
          "36:   text-align: right;",
          "37:   color: #999;",
          "38:   white-space: nowrap;",
          "39: }",
          "41: .CodeMirror-guttermarker { color: black; }",
          "42: .CodeMirror-guttermarker-subtle { color: #999; }",
          "46: .CodeMirror-cursor {",
          "47:   border-left: 1px solid black;",
          "48:   border-right: none;",
          "49:   width: 0;",
          "50: }",
          "52: .CodeMirror div.CodeMirror-secondarycursor {",
          "53:   border-left: 1px solid silver;",
          "54: }",
          "55: .cm-fat-cursor .CodeMirror-cursor {",
          "56:   width: auto;",
          "57:   border: 0 !important;",
          "58:   background: #7e7;",
          "59: }",
          "60: .cm-fat-cursor div.CodeMirror-cursors {",
          "61:   z-index: 1;",
          "62: }",
          "63: .cm-fat-cursor-mark {",
          "64:   background-color: rgba(20, 255, 20, 0.5);",
          "65:   -webkit-animation: blink 1.06s steps(1) infinite;",
          "66:   -moz-animation: blink 1.06s steps(1) infinite;",
          "67:   animation: blink 1.06s steps(1) infinite;",
          "68: }",
          "69: .cm-animate-fat-cursor {",
          "70:   width: auto;",
          "71:   -webkit-animation: blink 1.06s steps(1) infinite;",
          "72:   -moz-animation: blink 1.06s steps(1) infinite;",
          "73:   animation: blink 1.06s steps(1) infinite;",
          "74:   background-color: #7e7;",
          "75: }",
          "76: @-moz-keyframes blink {",
          "77:   0% {}",
          "78:   50% { background-color: transparent; }",
          "79:   100% {}",
          "80: }",
          "81: @-webkit-keyframes blink {",
          "82:   0% {}",
          "83:   50% { background-color: transparent; }",
          "84:   100% {}",
          "85: }",
          "86: @keyframes blink {",
          "87:   0% {}",
          "88:   50% { background-color: transparent; }",
          "89:   100% {}",
          "90: }",
          "93: .CodeMirror-overwrite .CodeMirror-cursor {}",
          "95: .cm-tab { display: inline-block; text-decoration: inherit; }",
          "97: .CodeMirror-rulers {",
          "98:   position: absolute;",
          "99:   left: 0; right: 0; top: -50px; bottom: 0;",
          "100:   overflow: hidden;",
          "101: }",
          "102: .CodeMirror-ruler {",
          "103:   border-left: 1px solid #ccc;",
          "104:   top: 0; bottom: 0;",
          "105:   position: absolute;",
          "106: }",
          "110: .cm-s-default .cm-header {color: blue;}",
          "111: .cm-s-default .cm-quote {color: #090;}",
          "112: .cm-negative {color: #d44;}",
          "113: .cm-positive {color: #292;}",
          "114: .cm-header, .cm-strong {font-weight: bold;}",
          "115: .cm-em {font-style: italic;}",
          "116: .cm-link {text-decoration: underline;}",
          "117: .cm-strikethrough {text-decoration: line-through;}",
          "119: .cm-s-default .cm-keyword {color: #708;}",
          "120: .cm-s-default .cm-atom {color: #219;}",
          "121: .cm-s-default .cm-number {color: #164;}",
          "122: .cm-s-default .cm-def {color: #00f;}",
          "123: .cm-s-default .cm-variable,",
          "124: .cm-s-default .cm-punctuation,",
          "125: .cm-s-default .cm-property,",
          "126: .cm-s-default .cm-operator {}",
          "127: .cm-s-default .cm-variable-2 {color: #05a;}",
          "128: .cm-s-default .cm-variable-3, .cm-s-default .cm-type {color: #085;}",
          "129: .cm-s-default .cm-comment {color: #a50;}",
          "130: .cm-s-default .cm-string {color: #a11;}",
          "131: .cm-s-default .cm-string-2 {color: #f50;}",
          "132: .cm-s-default .cm-meta {color: #555;}",
          "133: .cm-s-default .cm-qualifier {color: #555;}",
          "134: .cm-s-default .cm-builtin {color: #30a;}",
          "135: .cm-s-default .cm-bracket {color: #997;}",
          "136: .cm-s-default .cm-tag {color: #170;}",
          "137: .cm-s-default .cm-attribute {color: #00c;}",
          "138: .cm-s-default .cm-hr {color: #999;}",
          "139: .cm-s-default .cm-link {color: #00c;}",
          "141: .cm-s-default .cm-error {color: #f00;}",
          "142: .cm-invalidchar {color: #f00;}",
          "144: .CodeMirror-composing { border-bottom: 2px solid; }",
          "148: div.CodeMirror span.CodeMirror-matchingbracket {color: #0b0;}",
          "149: div.CodeMirror span.CodeMirror-nonmatchingbracket {color: #a22;}",
          "150: .CodeMirror-matchingtag { background: rgba(255, 150, 0, .3); }",
          "151: .CodeMirror-activeline-background {background: #e8f2ff;}",
          "158: .CodeMirror {",
          "159:   position: relative;",
          "160:   overflow: hidden;",
          "161:   background: white;",
          "162: }",
          "164: .CodeMirror-scroll {",
          "168:   margin-bottom: -50px; margin-right: -50px;",
          "169:   padding-bottom: 50px;",
          "170:   height: 100%;",
          "172:   position: relative;",
          "173: }",
          "174: .CodeMirror-sizer {",
          "175:   position: relative;",
          "176:   border-right: 50px solid transparent;",
          "177: }",
          "180:    before actual scrolling happens, thus preventing shaking and",
          "182: .CodeMirror-vscrollbar, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler {",
          "183:   position: absolute;",
          "184:   z-index: 6;",
          "185:   display: none;",
          "186:   outline: none;",
          "187: }",
          "188: .CodeMirror-vscrollbar {",
          "189:   right: 0; top: 0;",
          "190:   overflow-x: hidden;",
          "191:   overflow-y: scroll;",
          "192: }",
          "193: .CodeMirror-hscrollbar {",
          "194:   bottom: 0; left: 0;",
          "195:   overflow-y: hidden;",
          "196:   overflow-x: scroll;",
          "197: }",
          "198: .CodeMirror-scrollbar-filler {",
          "199:   right: 0; bottom: 0;",
          "200: }",
          "201: .CodeMirror-gutter-filler {",
          "202:   left: 0; bottom: 0;",
          "203: }",
          "205: .CodeMirror-gutters {",
          "206:   position: absolute; left: 0; top: 0;",
          "207:   min-height: 100%;",
          "208:   z-index: 3;",
          "209: }",
          "210: .CodeMirror-gutter {",
          "211:   white-space: normal;",
          "212:   height: 100%;",
          "213:   display: inline-block;",
          "214:   vertical-align: top;",
          "215:   margin-bottom: -50px;",
          "216: }",
          "217: .CodeMirror-gutter-wrapper {",
          "218:   position: absolute;",
          "219:   z-index: 4;",
          "220:   background: none !important;",
          "221:   border: none !important;",
          "222: }",
          "223: .CodeMirror-gutter-background {",
          "224:   position: absolute;",
          "225:   top: 0; bottom: 0;",
          "226:   z-index: 4;",
          "227: }",
          "228: .CodeMirror-gutter-elt {",
          "229:   position: absolute;",
          "230:   cursor: default;",
          "231:   z-index: 4;",
          "232: }",
          "233: .CodeMirror-gutter-wrapper ::selection { background-color: transparent }",
          "234: .CodeMirror-gutter-wrapper ::-moz-selection { background-color: transparent }",
          "236: .CodeMirror-lines {",
          "237:   cursor: text;",
          "239: }",
          "240: .CodeMirror pre.CodeMirror-line,",
          "241: .CodeMirror pre.CodeMirror-line-like {",
          "243:   -moz-border-radius: 0; -webkit-border-radius: 0; border-radius: 0;",
          "244:   border-width: 0;",
          "245:   background: transparent;",
          "246:   font-family: inherit;",
          "247:   font-size: inherit;",
          "248:   margin: 0;",
          "249:   white-space: pre;",
          "250:   word-wrap: normal;",
          "251:   line-height: inherit;",
          "252:   color: inherit;",
          "253:   z-index: 2;",
          "254:   position: relative;",
          "255:   overflow: visible;",
          "256:   -webkit-tap-highlight-color: transparent;",
          "257:   -webkit-font-variant-ligatures: contextual;",
          "258:   font-variant-ligatures: contextual;",
          "259: }",
          "260: .CodeMirror-wrap pre.CodeMirror-line,",
          "261: .CodeMirror-wrap pre.CodeMirror-line-like {",
          "262:   word-wrap: break-word;",
          "263:   white-space: pre-wrap;",
          "264:   word-break: normal;",
          "265: }",
          "267: .CodeMirror-linebackground {",
          "268:   position: absolute;",
          "269:   left: 0; right: 0; top: 0; bottom: 0;",
          "270:   z-index: 0;",
          "271: }",
          "273: .CodeMirror-linewidget {",
          "274:   position: relative;",
          "275:   z-index: 2;",
          "277: }",
          "279: .CodeMirror-widget {}",
          "281: .CodeMirror-rtl pre { direction: rtl; }",
          "283: .CodeMirror-code {",
          "284:   outline: none;",
          "285: }",
          "288: .CodeMirror-scroll,",
          "289: .CodeMirror-sizer,",
          "290: .CodeMirror-gutter,",
          "291: .CodeMirror-gutters,",
          "292: .CodeMirror-linenumber {",
          "293:   -moz-box-sizing: content-box;",
          "294:   box-sizing: content-box;",
          "295: }",
          "297: .CodeMirror-measure {",
          "298:   position: absolute;",
          "299:   width: 100%;",
          "300:   height: 0;",
          "301:   overflow: hidden;",
          "302:   visibility: hidden;",
          "303: }",
          "305: .CodeMirror-cursor {",
          "306:   position: absolute;",
          "307:   pointer-events: none;",
          "308: }",
          "309: .CodeMirror-measure pre { position: static; }",
          "311: div.CodeMirror-cursors {",
          "312:   visibility: hidden;",
          "313:   position: relative;",
          "314:   z-index: 3;",
          "315: }",
          "316: div.CodeMirror-dragcursors {",
          "317:   visibility: visible;",
          "318: }",
          "320: .CodeMirror-focused div.CodeMirror-cursors {",
          "321:   visibility: visible;",
          "322: }",
          "324: .CodeMirror-selected { background: #d9d9d9; }",
          "325: .CodeMirror-focused .CodeMirror-selected { background: #d7d4f0; }",
          "326: .CodeMirror-crosshair { cursor: crosshair; }",
          "327: .CodeMirror-line::selection, .CodeMirror-line > span::selection, .CodeMirror-line > span > span::selection { background: #d7d4f0; }",
          "328: .CodeMirror-line::-moz-selection, .CodeMirror-line > span::-moz-selection, .CodeMirror-line > span > span::-moz-selection { background: #d7d4f0; }",
          "330: .cm-searching {",
          "331:   background-color: #ffa;",
          "332:   background-color: rgba(255, 255, 0, .4);",
          "333: }",
          "336: .cm-force-border { padding-right: .1px; }",
          "338: @media print {",
          "340:   .CodeMirror div.CodeMirror-cursors {",
          "341:     visibility: hidden;",
          "342:   }",
          "343: }",
          "346: .cm-tab-wrap-hack:after { content: ''; }",
          "349: span.CodeMirror-selectedtext { background: none; }",
          "",
          "---------------"
        ],
        "static/vendor/codemirror/codemirror.js||static/vendor/codemirror/codemirror.js": [
          "File: static/vendor/codemirror/codemirror.js -> static/vendor/codemirror/codemirror.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "10: (function (global, factory) {",
          "11:   typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :",
          "12:   typeof define === 'function' && define.amd ? define(factory) :",
          "13:   (global = global || self, global.CodeMirror = factory());",
          "14: }(this, (function () { 'use strict';",
          "18:   var userAgent = navigator.userAgent;",
          "19:   var platform = navigator.platform;",
          "21:   var gecko = /gecko\\/\\d/i.test(userAgent);",
          "22:   var ie_upto10 = /MSIE \\d/.test(userAgent);",
          "23:   var ie_11up = /Trident\\/(?:[7-9]|\\d{2,})\\..*rv:(\\d+)/.exec(userAgent);",
          "24:   var edge = /Edge\\/(\\d+)/.exec(userAgent);",
          "25:   var ie = ie_upto10 || ie_11up || edge;",
          "26:   var ie_version = ie && (ie_upto10 ? document.documentMode || 6 : +(edge || ie_11up)[1]);",
          "27:   var webkit = !edge && /WebKit\\//.test(userAgent);",
          "28:   var qtwebkit = webkit && /Qt\\/\\d+\\.\\d+/.test(userAgent);",
          "29:   var chrome = !edge && /Chrome\\//.test(userAgent);",
          "30:   var presto = /Opera\\//.test(userAgent);",
          "31:   var safari = /Apple Computer/.test(navigator.vendor);",
          "32:   var mac_geMountainLion = /Mac OS X 1\\d\\D([8-9]|\\d\\d)\\D/.test(userAgent);",
          "33:   var phantom = /PhantomJS/.test(userAgent);",
          "35:   var ios = safari && (/Mobile\\/\\w+/.test(userAgent) || navigator.maxTouchPoints > 2);",
          "36:   var android = /Android/.test(userAgent);",
          "38:   var mobile = ios || android || /webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(userAgent);",
          "39:   var mac = ios || /Mac/.test(platform);",
          "40:   var chromeOS = /\\bCrOS\\b/.test(userAgent);",
          "41:   var windows = /win/i.test(platform);",
          "43:   var presto_version = presto && userAgent.match(/Version\\/(\\d*\\.\\d*)/);",
          "44:   if (presto_version) { presto_version = Number(presto_version[1]); }",
          "45:   if (presto_version && presto_version >= 15) { presto = false; webkit = true; }",
          "47:   var flipCtrlCmd = mac && (qtwebkit || presto && (presto_version == null || presto_version < 12.11));",
          "48:   var captureRightClick = gecko || (ie && ie_version >= 9);",
          "50:   function classTest(cls) { return new RegExp(\"(^|\\\\s)\" + cls + \"(?:$|\\\\s)\\\\s*\") }",
          "52:   var rmClass = function(node, cls) {",
          "53:     var current = node.className;",
          "54:     var match = classTest(cls).exec(current);",
          "55:     if (match) {",
          "56:       var after = current.slice(match.index + match[0].length);",
          "57:       node.className = current.slice(0, match.index) + (after ? match[1] + after : \"\");",
          "58:     }",
          "59:   };",
          "61:   function removeChildren(e) {",
          "62:     for (var count = e.childNodes.length; count > 0; --count)",
          "63:       { e.removeChild(e.firstChild); }",
          "64:     return e",
          "65:   }",
          "67:   function removeChildrenAndAdd(parent, e) {",
          "68:     return removeChildren(parent).appendChild(e)",
          "69:   }",
          "71:   function elt(tag, content, className, style) {",
          "72:     var e = document.createElement(tag);",
          "73:     if (className) { e.className = className; }",
          "74:     if (style) { e.style.cssText = style; }",
          "75:     if (typeof content == \"string\") { e.appendChild(document.createTextNode(content)); }",
          "76:     else if (content) { for (var i = 0; i < content.length; ++i) { e.appendChild(content[i]); } }",
          "77:     return e",
          "78:   }",
          "80:   function eltP(tag, content, className, style) {",
          "81:     var e = elt(tag, content, className, style);",
          "82:     e.setAttribute(\"role\", \"presentation\");",
          "83:     return e",
          "84:   }",
          "86:   var range;",
          "87:   if (document.createRange) { range = function(node, start, end, endNode) {",
          "88:     var r = document.createRange();",
          "89:     r.setEnd(endNode || node, end);",
          "90:     r.setStart(node, start);",
          "91:     return r",
          "92:   }; }",
          "93:   else { range = function(node, start, end) {",
          "94:     var r = document.body.createTextRange();",
          "95:     try { r.moveToElementText(node.parentNode); }",
          "96:     catch(e) { return r }",
          "97:     r.collapse(true);",
          "98:     r.moveEnd(\"character\", end);",
          "99:     r.moveStart(\"character\", start);",
          "100:     return r",
          "101:   }; }",
          "103:   function contains(parent, child) {",
          "104:     if (child.nodeType == 3) // Android browser always returns false when child is a textnode",
          "105:       { child = child.parentNode; }",
          "106:     if (parent.contains)",
          "107:       { return parent.contains(child) }",
          "108:     do {",
          "109:       if (child.nodeType == 11) { child = child.host; }",
          "110:       if (child == parent) { return true }",
          "111:     } while (child = child.parentNode)",
          "112:   }",
          "114:   function activeElt() {",
          "118:     var activeElement;",
          "119:     try {",
          "120:       activeElement = document.activeElement;",
          "121:     } catch(e) {",
          "122:       activeElement = document.body || null;",
          "123:     }",
          "124:     while (activeElement && activeElement.shadowRoot && activeElement.shadowRoot.activeElement)",
          "125:       { activeElement = activeElement.shadowRoot.activeElement; }",
          "126:     return activeElement",
          "127:   }",
          "129:   function addClass(node, cls) {",
          "130:     var current = node.className;",
          "131:     if (!classTest(cls).test(current)) { node.className += (current ? \" \" : \"\") + cls; }",
          "132:   }",
          "133:   function joinClasses(a, b) {",
          "134:     var as = a.split(\" \");",
          "135:     for (var i = 0; i < as.length; i++)",
          "136:       { if (as[i] && !classTest(as[i]).test(b)) { b += \" \" + as[i]; } }",
          "137:     return b",
          "138:   }",
          "140:   var selectInput = function(node) { node.select(); };",
          "141:   if (ios) // Mobile Safari apparently has a bug where select() is broken.",
          "142:     { selectInput = function(node) { node.selectionStart = 0; node.selectionEnd = node.value.length; }; }",
          "143:   else if (ie) // Suppress mysterious IE10 errors",
          "144:     { selectInput = function(node) { try { node.select(); } catch(_e) {} }; }",
          "146:   function bind(f) {",
          "147:     var args = Array.prototype.slice.call(arguments, 1);",
          "148:     return function(){return f.apply(null, args)}",
          "149:   }",
          "151:   function copyObj(obj, target, overwrite) {",
          "152:     if (!target) { target = {}; }",
          "153:     for (var prop in obj)",
          "154:       { if (obj.hasOwnProperty(prop) && (overwrite !== false || !target.hasOwnProperty(prop)))",
          "155:         { target[prop] = obj[prop]; } }",
          "156:     return target",
          "157:   }",
          "161:   function countColumn(string, end, tabSize, startIndex, startValue) {",
          "162:     if (end == null) {",
          "163:       end = string.search(/[^\\s\\u00a0]/);",
          "164:       if (end == -1) { end = string.length; }",
          "165:     }",
          "166:     for (var i = startIndex || 0, n = startValue || 0;;) {",
          "167:       var nextTab = string.indexOf(\"\\t\", i);",
          "168:       if (nextTab < 0 || nextTab >= end)",
          "169:         { return n + (end - i) }",
          "170:       n += nextTab - i;",
          "171:       n += tabSize - (n % tabSize);",
          "172:       i = nextTab + 1;",
          "173:     }",
          "174:   }",
          "176:   var Delayed = function() {",
          "177:     this.id = null;",
          "178:     this.f = null;",
          "179:     this.time = 0;",
          "180:     this.handler = bind(this.onTimeout, this);",
          "181:   };",
          "182:   Delayed.prototype.onTimeout = function (self) {",
          "183:     self.id = 0;",
          "184:     if (self.time <= +new Date) {",
          "185:       self.f();",
          "186:     } else {",
          "187:       setTimeout(self.handler, self.time - +new Date);",
          "188:     }",
          "189:   };",
          "190:   Delayed.prototype.set = function (ms, f) {",
          "191:     this.f = f;",
          "192:     var time = +new Date + ms;",
          "193:     if (!this.id || time < this.time) {",
          "194:       clearTimeout(this.id);",
          "195:       this.id = setTimeout(this.handler, ms);",
          "196:       this.time = time;",
          "197:     }",
          "198:   };",
          "200:   function indexOf(array, elt) {",
          "201:     for (var i = 0; i < array.length; ++i)",
          "202:       { if (array[i] == elt) { return i } }",
          "203:     return -1",
          "204:   }",
          "207:   var scrollerGap = 50;",
          "211:   var Pass = {toString: function(){return \"CodeMirror.Pass\"}};",
          "214:   var sel_dontScroll = {scroll: false}, sel_mouse = {origin: \"*mouse\"}, sel_move = {origin: \"+move\"};",
          "218:   function findColumn(string, goal, tabSize) {",
          "219:     for (var pos = 0, col = 0;;) {",
          "220:       var nextTab = string.indexOf(\"\\t\", pos);",
          "221:       if (nextTab == -1) { nextTab = string.length; }",
          "222:       var skipped = nextTab - pos;",
          "223:       if (nextTab == string.length || col + skipped >= goal)",
          "224:         { return pos + Math.min(skipped, goal - col) }",
          "225:       col += nextTab - pos;",
          "226:       col += tabSize - (col % tabSize);",
          "227:       pos = nextTab + 1;",
          "228:       if (col >= goal) { return pos }",
          "229:     }",
          "230:   }",
          "232:   var spaceStrs = [\"\"];",
          "233:   function spaceStr(n) {",
          "234:     while (spaceStrs.length <= n)",
          "235:       { spaceStrs.push(lst(spaceStrs) + \" \"); }",
          "236:     return spaceStrs[n]",
          "237:   }",
          "239:   function lst(arr) { return arr[arr.length-1] }",
          "241:   function map(array, f) {",
          "242:     var out = [];",
          "243:     for (var i = 0; i < array.length; i++) { out[i] = f(array[i], i); }",
          "244:     return out",
          "245:   }",
          "247:   function insertSorted(array, value, score) {",
          "248:     var pos = 0, priority = score(value);",
          "249:     while (pos < array.length && score(array[pos]) <= priority) { pos++; }",
          "250:     array.splice(pos, 0, value);",
          "251:   }",
          "253:   function nothing() {}",
          "255:   function createObj(base, props) {",
          "256:     var inst;",
          "257:     if (Object.create) {",
          "258:       inst = Object.create(base);",
          "259:     } else {",
          "260:       nothing.prototype = base;",
          "261:       inst = new nothing();",
          "262:     }",
          "263:     if (props) { copyObj(props, inst); }",
          "264:     return inst",
          "265:   }",
          "267:   var nonASCIISingleCaseWordChar = /[\\u00df\\u0587\\u0590-\\u05f4\\u0600-\\u06ff\\u3040-\\u309f\\u30a0-\\u30ff\\u3400-\\u4db5\\u4e00-\\u9fcc\\uac00-\\ud7af]/;",
          "268:   function isWordCharBasic(ch) {",
          "269:     return /\\w/.test(ch) || ch > \"\\x80\" &&",
          "270:       (ch.toUpperCase() != ch.toLowerCase() || nonASCIISingleCaseWordChar.test(ch))",
          "271:   }",
          "272:   function isWordChar(ch, helper) {",
          "273:     if (!helper) { return isWordCharBasic(ch) }",
          "274:     if (helper.source.indexOf(\"\\\\w\") > -1 && isWordCharBasic(ch)) { return true }",
          "275:     return helper.test(ch)",
          "276:   }",
          "278:   function isEmpty(obj) {",
          "279:     for (var n in obj) { if (obj.hasOwnProperty(n) && obj[n]) { return false } }",
          "280:     return true",
          "281:   }",
          "288:   var extendingChars = /[\\u0300-\\u036f\\u0483-\\u0489\\u0591-\\u05bd\\u05bf\\u05c1\\u05c2\\u05c4\\u05c5\\u05c7\\u0610-\\u061a\\u064b-\\u065e\\u0670\\u06d6-\\u06dc\\u06de-\\u06e4\\u06e7\\u06e8\\u06ea-\\u06ed\\u0711\\u0730-\\u074a\\u07a6-\\u07b0\\u07eb-\\u07f3\\u0816-\\u0819\\u081b-\\u0823\\u0825-\\u0827\\u0829-\\u082d\\u0900-\\u0902\\u093c\\u0941-\\u0948\\u094d\\u0951-\\u0955\\u0962\\u0963\\u0981\\u09bc\\u09be\\u09c1-\\u09c4\\u09cd\\u09d7\\u09e2\\u09e3\\u0a01\\u0a02\\u0a3c\\u0a41\\u0a42\\u0a47\\u0a48\\u0a4b-\\u0a4d\\u0a51\\u0a70\\u0a71\\u0a75\\u0a81\\u0a82\\u0abc\\u0ac1-\\u0ac5\\u0ac7\\u0ac8\\u0acd\\u0ae2\\u0ae3\\u0b01\\u0b3c\\u0b3e\\u0b3f\\u0b41-\\u0b44\\u0b4d\\u0b56\\u0b57\\u0b62\\u0b63\\u0b82\\u0bbe\\u0bc0\\u0bcd\\u0bd7\\u0c3e-\\u0c40\\u0c46-\\u0c48\\u0c4a-\\u0c4d\\u0c55\\u0c56\\u0c62\\u0c63\\u0cbc\\u0cbf\\u0cc2\\u0cc6\\u0ccc\\u0ccd\\u0cd5\\u0cd6\\u0ce2\\u0ce3\\u0d3e\\u0d41-\\u0d44\\u0d4d\\u0d57\\u0d62\\u0d63\\u0dca\\u0dcf\\u0dd2-\\u0dd4\\u0dd6\\u0ddf\\u0e31\\u0e34-\\u0e3a\\u0e47-\\u0e4e\\u0eb1\\u0eb4-\\u0eb9\\u0ebb\\u0ebc\\u0ec8-\\u0ecd\\u0f18\\u0f19\\u0f35\\u0f37\\u0f39\\u0f71-\\u0f7e\\u0f80-\\u0f84\\u0f86\\u0f87\\u0f90-\\u0f97\\u0f99-\\u0fbc\\u0fc6\\u102d-\\u1030\\u1032-\\u1037\\u1039\\u103a\\u103d\\u103e\\u1058\\u1059\\u105e-\\u1060\\u1071-\\u1074\\u1082\\u1085\\u1086\\u108d\\u109d\\u135f\\u1712-\\u1714\\u1732-\\u1734\\u1752\\u1753\\u1772\\u1773\\u17b7-\\u17bd\\u17c6\\u17c9-\\u17d3\\u17dd\\u180b-\\u180d\\u18a9\\u1920-\\u1922\\u1927\\u1928\\u1932\\u1939-\\u193b\\u1a17\\u1a18\\u1a56\\u1a58-\\u1a5e\\u1a60\\u1a62\\u1a65-\\u1a6c\\u1a73-\\u1a7c\\u1a7f\\u1b00-\\u1b03\\u1b34\\u1b36-\\u1b3a\\u1b3c\\u1b42\\u1b6b-\\u1b73\\u1b80\\u1b81\\u1ba2-\\u1ba5\\u1ba8\\u1ba9\\u1c2c-\\u1c33\\u1c36\\u1c37\\u1cd0-\\u1cd2\\u1cd4-\\u1ce0\\u1ce2-\\u1ce8\\u1ced\\u1dc0-\\u1de6\\u1dfd-\\u1dff\\u200c\\u200d\\u20d0-\\u20f0\\u2cef-\\u2cf1\\u2de0-\\u2dff\\u302a-\\u302f\\u3099\\u309a\\ua66f-\\ua672\\ua67c\\ua67d\\ua6f0\\ua6f1\\ua802\\ua806\\ua80b\\ua825\\ua826\\ua8c4\\ua8e0-\\ua8f1\\ua926-\\ua92d\\ua947-\\ua951\\ua980-\\ua982\\ua9b3\\ua9b6-\\ua9b9\\ua9bc\\uaa29-\\uaa2e\\uaa31\\uaa32\\uaa35\\uaa36\\uaa43\\uaa4c\\uaab0\\uaab2-\\uaab4\\uaab7\\uaab8\\uaabe\\uaabf\\uaac1\\uabe5\\uabe8\\uabed\\udc00-\\udfff\\ufb1e\\ufe00-\\ufe0f\\ufe20-\\ufe26\\uff9e\\uff9f]/;",
          "289:   function isExtendingChar(ch) { return ch.charCodeAt(0) >= 768 && extendingChars.test(ch) }",
          "292:   function skipExtendingChars(str, pos, dir) {",
          "293:     while ((dir < 0 ? pos > 0 : pos < str.length) && isExtendingChar(str.charAt(pos))) { pos += dir; }",
          "294:     return pos",
          "295:   }",
          "300:   function findFirst(pred, from, to) {",
          "303:     var dir = from > to ? -1 : 1;",
          "304:     for (;;) {",
          "305:       if (from == to) { return from }",
          "306:       var midF = (from + to) / 2, mid = dir < 0 ? Math.ceil(midF) : Math.floor(midF);",
          "307:       if (mid == from) { return pred(mid) ? from : to }",
          "308:       if (pred(mid)) { to = mid; }",
          "309:       else { from = mid + dir; }",
          "310:     }",
          "311:   }",
          "315:   function iterateBidiSections(order, from, to, f) {",
          "316:     if (!order) { return f(from, to, \"ltr\", 0) }",
          "317:     var found = false;",
          "318:     for (var i = 0; i < order.length; ++i) {",
          "319:       var part = order[i];",
          "320:       if (part.from < to && part.to > from || from == to && part.to == from) {",
          "321:         f(Math.max(part.from, from), Math.min(part.to, to), part.level == 1 ? \"rtl\" : \"ltr\", i);",
          "322:         found = true;",
          "323:       }",
          "324:     }",
          "325:     if (!found) { f(from, to, \"ltr\"); }",
          "326:   }",
          "328:   var bidiOther = null;",
          "329:   function getBidiPartAt(order, ch, sticky) {",
          "330:     var found;",
          "331:     bidiOther = null;",
          "332:     for (var i = 0; i < order.length; ++i) {",
          "333:       var cur = order[i];",
          "334:       if (cur.from < ch && cur.to > ch) { return i }",
          "335:       if (cur.to == ch) {",
          "336:         if (cur.from != cur.to && sticky == \"before\") { found = i; }",
          "337:         else { bidiOther = i; }",
          "338:       }",
          "339:       if (cur.from == ch) {",
          "340:         if (cur.from != cur.to && sticky != \"before\") { found = i; }",
          "341:         else { bidiOther = i; }",
          "342:       }",
          "343:     }",
          "344:     return found != null ? found : bidiOther",
          "345:   }",
          "370:   var bidiOrdering = (function() {",
          "372:     var lowTypes = \"bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN\";",
          "374:     var arabicTypes = \"nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111\";",
          "375:     function charType(code) {",
          "376:       if (code <= 0xf7) { return lowTypes.charAt(code) }",
          "377:       else if (0x590 <= code && code <= 0x5f4) { return \"R\" }",
          "378:       else if (0x600 <= code && code <= 0x6f9) { return arabicTypes.charAt(code - 0x600) }",
          "379:       else if (0x6ee <= code && code <= 0x8ac) { return \"r\" }",
          "380:       else if (0x2000 <= code && code <= 0x200b) { return \"w\" }",
          "381:       else if (code == 0x200c) { return \"b\" }",
          "382:       else { return \"L\" }",
          "383:     }",
          "385:     var bidiRE = /[\\u0590-\\u05f4\\u0600-\\u06ff\\u0700-\\u08ac]/;",
          "386:     var isNeutral = /[stwN]/, isStrong = /[LRr]/, countsAsLeft = /[Lb1n]/, countsAsNum = /[1n]/;",
          "388:     function BidiSpan(level, from, to) {",
          "389:       this.level = level;",
          "390:       this.from = from; this.to = to;",
          "391:     }",
          "393:     return function(str, direction) {",
          "394:       var outerType = direction == \"ltr\" ? \"L\" : \"R\";",
          "396:       if (str.length == 0 || direction == \"ltr\" && !bidiRE.test(str)) { return false }",
          "397:       var len = str.length, types = [];",
          "398:       for (var i = 0; i < len; ++i)",
          "399:         { types.push(charType(str.charCodeAt(i))); }",
          "405:       for (var i$1 = 0, prev = outerType; i$1 < len; ++i$1) {",
          "406:         var type = types[i$1];",
          "407:         if (type == \"m\") { types[i$1] = prev; }",
          "408:         else { prev = type; }",
          "409:       }",
          "416:       for (var i$2 = 0, cur = outerType; i$2 < len; ++i$2) {",
          "417:         var type$1 = types[i$2];",
          "418:         if (type$1 == \"1\" && cur == \"r\") { types[i$2] = \"n\"; }",
          "419:         else if (isStrong.test(type$1)) { cur = type$1; if (type$1 == \"r\") { types[i$2] = \"R\"; } }",
          "420:       }",
          "425:       for (var i$3 = 1, prev$1 = types[0]; i$3 < len - 1; ++i$3) {",
          "426:         var type$2 = types[i$3];",
          "427:         if (type$2 == \"+\" && prev$1 == \"1\" && types[i$3+1] == \"1\") { types[i$3] = \"1\"; }",
          "428:         else if (type$2 == \",\" && prev$1 == types[i$3+1] &&",
          "429:                  (prev$1 == \"1\" || prev$1 == \"n\")) { types[i$3] = prev$1; }",
          "430:         prev$1 = type$2;",
          "431:       }",
          "437:       for (var i$4 = 0; i$4 < len; ++i$4) {",
          "438:         var type$3 = types[i$4];",
          "439:         if (type$3 == \",\") { types[i$4] = \"N\"; }",
          "440:         else if (type$3 == \"%\") {",
          "441:           var end = (void 0);",
          "442:           for (end = i$4 + 1; end < len && types[end] == \"%\"; ++end) {}",
          "443:           var replace = (i$4 && types[i$4-1] == \"!\") || (end < len && types[end] == \"1\") ? \"1\" : \"N\";",
          "444:           for (var j = i$4; j < end; ++j) { types[j] = replace; }",
          "445:           i$4 = end - 1;",
          "446:         }",
          "447:       }",
          "452:       for (var i$5 = 0, cur$1 = outerType; i$5 < len; ++i$5) {",
          "453:         var type$4 = types[i$5];",
          "454:         if (cur$1 == \"L\" && type$4 == \"1\") { types[i$5] = \"L\"; }",
          "455:         else if (isStrong.test(type$4)) { cur$1 = type$4; }",
          "456:       }",
          "464:       for (var i$6 = 0; i$6 < len; ++i$6) {",
          "465:         if (isNeutral.test(types[i$6])) {",
          "466:           var end$1 = (void 0);",
          "467:           for (end$1 = i$6 + 1; end$1 < len && isNeutral.test(types[end$1]); ++end$1) {}",
          "468:           var before = (i$6 ? types[i$6-1] : outerType) == \"L\";",
          "469:           var after = (end$1 < len ? types[end$1] : outerType) == \"L\";",
          "470:           var replace$1 = before == after ? (before ? \"L\" : \"R\") : outerType;",
          "471:           for (var j$1 = i$6; j$1 < end$1; ++j$1) { types[j$1] = replace$1; }",
          "472:           i$6 = end$1 - 1;",
          "473:         }",
          "474:       }",
          "481:       var order = [], m;",
          "482:       for (var i$7 = 0; i$7 < len;) {",
          "483:         if (countsAsLeft.test(types[i$7])) {",
          "484:           var start = i$7;",
          "485:           for (++i$7; i$7 < len && countsAsLeft.test(types[i$7]); ++i$7) {}",
          "486:           order.push(new BidiSpan(0, start, i$7));",
          "487:         } else {",
          "488:           var pos = i$7, at = order.length, isRTL = direction == \"rtl\" ? 1 : 0;",
          "489:           for (++i$7; i$7 < len && types[i$7] != \"L\"; ++i$7) {}",
          "490:           for (var j$2 = pos; j$2 < i$7;) {",
          "491:             if (countsAsNum.test(types[j$2])) {",
          "492:               if (pos < j$2) { order.splice(at, 0, new BidiSpan(1, pos, j$2)); at += isRTL; }",
          "493:               var nstart = j$2;",
          "494:               for (++j$2; j$2 < i$7 && countsAsNum.test(types[j$2]); ++j$2) {}",
          "495:               order.splice(at, 0, new BidiSpan(2, nstart, j$2));",
          "496:               at += isRTL;",
          "497:               pos = j$2;",
          "498:             } else { ++j$2; }",
          "499:           }",
          "500:           if (pos < i$7) { order.splice(at, 0, new BidiSpan(1, pos, i$7)); }",
          "501:         }",
          "502:       }",
          "503:       if (direction == \"ltr\") {",
          "504:         if (order[0].level == 1 && (m = str.match(/^\\s+/))) {",
          "505:           order[0].from = m[0].length;",
          "506:           order.unshift(new BidiSpan(0, 0, m[0].length));",
          "507:         }",
          "508:         if (lst(order).level == 1 && (m = str.match(/\\s+$/))) {",
          "509:           lst(order).to -= m[0].length;",
          "510:           order.push(new BidiSpan(0, len - m[0].length, len));",
          "511:         }",
          "512:       }",
          "514:       return direction == \"rtl\" ? order.reverse() : order",
          "515:     }",
          "516:   })();",
          "521:   function getOrder(line, direction) {",
          "522:     var order = line.order;",
          "523:     if (order == null) { order = line.order = bidiOrdering(line.text, direction); }",
          "524:     return order",
          "525:   }",
          "532:   var noHandlers = [];",
          "534:   var on = function(emitter, type, f) {",
          "535:     if (emitter.addEventListener) {",
          "536:       emitter.addEventListener(type, f, false);",
          "537:     } else if (emitter.attachEvent) {",
          "538:       emitter.attachEvent(\"on\" + type, f);",
          "539:     } else {",
          "540:       var map = emitter._handlers || (emitter._handlers = {});",
          "541:       map[type] = (map[type] || noHandlers).concat(f);",
          "542:     }",
          "543:   };",
          "545:   function getHandlers(emitter, type) {",
          "546:     return emitter._handlers && emitter._handlers[type] || noHandlers",
          "547:   }",
          "549:   function off(emitter, type, f) {",
          "550:     if (emitter.removeEventListener) {",
          "551:       emitter.removeEventListener(type, f, false);",
          "552:     } else if (emitter.detachEvent) {",
          "553:       emitter.detachEvent(\"on\" + type, f);",
          "554:     } else {",
          "555:       var map = emitter._handlers, arr = map && map[type];",
          "556:       if (arr) {",
          "557:         var index = indexOf(arr, f);",
          "558:         if (index > -1)",
          "559:           { map[type] = arr.slice(0, index).concat(arr.slice(index + 1)); }",
          "560:       }",
          "561:     }",
          "562:   }",
          "564:   function signal(emitter, type /*, values...*/) {",
          "565:     var handlers = getHandlers(emitter, type);",
          "566:     if (!handlers.length) { return }",
          "567:     var args = Array.prototype.slice.call(arguments, 2);",
          "568:     for (var i = 0; i < handlers.length; ++i) { handlers[i].apply(null, args); }",
          "569:   }",
          "574:   function signalDOMEvent(cm, e, override) {",
          "575:     if (typeof e == \"string\")",
          "576:       { e = {type: e, preventDefault: function() { this.defaultPrevented = true; }}; }",
          "577:     signal(cm, override || e.type, cm, e);",
          "578:     return e_defaultPrevented(e) || e.codemirrorIgnore",
          "579:   }",
          "581:   function signalCursorActivity(cm) {",
          "582:     var arr = cm._handlers && cm._handlers.cursorActivity;",
          "583:     if (!arr) { return }",
          "584:     var set = cm.curOp.cursorActivityHandlers || (cm.curOp.cursorActivityHandlers = []);",
          "585:     for (var i = 0; i < arr.length; ++i) { if (indexOf(set, arr[i]) == -1)",
          "586:       { set.push(arr[i]); } }",
          "587:   }",
          "589:   function hasHandler(emitter, type) {",
          "590:     return getHandlers(emitter, type).length > 0",
          "591:   }",
          "595:   function eventMixin(ctor) {",
          "596:     ctor.prototype.on = function(type, f) {on(this, type, f);};",
          "597:     ctor.prototype.off = function(type, f) {off(this, type, f);};",
          "598:   }",
          "603:   function e_preventDefault(e) {",
          "604:     if (e.preventDefault) { e.preventDefault(); }",
          "605:     else { e.returnValue = false; }",
          "606:   }",
          "607:   function e_stopPropagation(e) {",
          "608:     if (e.stopPropagation) { e.stopPropagation(); }",
          "609:     else { e.cancelBubble = true; }",
          "610:   }",
          "611:   function e_defaultPrevented(e) {",
          "612:     return e.defaultPrevented != null ? e.defaultPrevented : e.returnValue == false",
          "613:   }",
          "614:   function e_stop(e) {e_preventDefault(e); e_stopPropagation(e);}",
          "616:   function e_target(e) {return e.target || e.srcElement}",
          "617:   function e_button(e) {",
          "618:     var b = e.which;",
          "619:     if (b == null) {",
          "620:       if (e.button & 1) { b = 1; }",
          "621:       else if (e.button & 2) { b = 3; }",
          "622:       else if (e.button & 4) { b = 2; }",
          "623:     }",
          "624:     if (mac && e.ctrlKey && b == 1) { b = 3; }",
          "625:     return b",
          "626:   }",
          "629:   var dragAndDrop = function() {",
          "632:     if (ie && ie_version < 9) { return false }",
          "633:     var div = elt('div');",
          "634:     return \"draggable\" in div || \"dragDrop\" in div",
          "635:   }();",
          "637:   var zwspSupported;",
          "638:   function zeroWidthElement(measure) {",
          "639:     if (zwspSupported == null) {",
          "640:       var test = elt(\"span\", \"\\u200b\");",
          "641:       removeChildrenAndAdd(measure, elt(\"span\", [test, document.createTextNode(\"x\")]));",
          "642:       if (measure.firstChild.offsetHeight != 0)",
          "643:         { zwspSupported = test.offsetWidth <= 1 && test.offsetHeight > 2 && !(ie && ie_version < 8); }",
          "644:     }",
          "645:     var node = zwspSupported ? elt(\"span\", \"\\u200b\") :",
          "646:       elt(\"span\", \"\\u00a0\", null, \"display: inline-block; width: 1px; margin-right: -1px\");",
          "647:     node.setAttribute(\"cm-text\", \"\");",
          "648:     return node",
          "649:   }",
          "652:   var badBidiRects;",
          "653:   function hasBadBidiRects(measure) {",
          "654:     if (badBidiRects != null) { return badBidiRects }",
          "655:     var txt = removeChildrenAndAdd(measure, document.createTextNode(\"A\\u062eA\"));",
          "656:     var r0 = range(txt, 0, 1).getBoundingClientRect();",
          "657:     var r1 = range(txt, 1, 2).getBoundingClientRect();",
          "658:     removeChildren(measure);",
          "659:     if (!r0 || r0.left == r0.right) { return false } // Safari returns null in some cases (#2780)",
          "660:     return badBidiRects = (r1.right - r0.right < 3)",
          "661:   }",
          "665:   var splitLinesAuto = \"\\n\\nb\".split(/\\n/).length != 3 ? function (string) {",
          "666:     var pos = 0, result = [], l = string.length;",
          "667:     while (pos <= l) {",
          "668:       var nl = string.indexOf(\"\\n\", pos);",
          "669:       if (nl == -1) { nl = string.length; }",
          "670:       var line = string.slice(pos, string.charAt(nl - 1) == \"\\r\" ? nl - 1 : nl);",
          "671:       var rt = line.indexOf(\"\\r\");",
          "672:       if (rt != -1) {",
          "673:         result.push(line.slice(0, rt));",
          "674:         pos += rt + 1;",
          "675:       } else {",
          "676:         result.push(line);",
          "677:         pos = nl + 1;",
          "678:       }",
          "679:     }",
          "680:     return result",
          "681:   } : function (string) { return string.split(/\\r\\n?|\\n/); };",
          "683:   var hasSelection = window.getSelection ? function (te) {",
          "684:     try { return te.selectionStart != te.selectionEnd }",
          "685:     catch(e) { return false }",
          "686:   } : function (te) {",
          "687:     var range;",
          "688:     try {range = te.ownerDocument.selection.createRange();}",
          "689:     catch(e) {}",
          "690:     if (!range || range.parentElement() != te) { return false }",
          "691:     return range.compareEndPoints(\"StartToEnd\", range) != 0",
          "692:   };",
          "694:   var hasCopyEvent = (function () {",
          "695:     var e = elt(\"div\");",
          "696:     if (\"oncopy\" in e) { return true }",
          "697:     e.setAttribute(\"oncopy\", \"return;\");",
          "698:     return typeof e.oncopy == \"function\"",
          "699:   })();",
          "701:   var badZoomedRects = null;",
          "702:   function hasBadZoomedRects(measure) {",
          "703:     if (badZoomedRects != null) { return badZoomedRects }",
          "704:     var node = removeChildrenAndAdd(measure, elt(\"span\", \"x\"));",
          "705:     var normal = node.getBoundingClientRect();",
          "706:     var fromRange = range(node, 0, 1).getBoundingClientRect();",
          "707:     return badZoomedRects = Math.abs(normal.left - fromRange.left) > 1",
          "708:   }",
          "711:   var modes = {}, mimeModes = {};",
          "716:   function defineMode(name, mode) {",
          "717:     if (arguments.length > 2)",
          "718:       { mode.dependencies = Array.prototype.slice.call(arguments, 2); }",
          "719:     modes[name] = mode;",
          "720:   }",
          "722:   function defineMIME(mime, spec) {",
          "723:     mimeModes[mime] = spec;",
          "724:   }",
          "728:   function resolveMode(spec) {",
          "729:     if (typeof spec == \"string\" && mimeModes.hasOwnProperty(spec)) {",
          "730:       spec = mimeModes[spec];",
          "731:     } else if (spec && typeof spec.name == \"string\" && mimeModes.hasOwnProperty(spec.name)) {",
          "732:       var found = mimeModes[spec.name];",
          "733:       if (typeof found == \"string\") { found = {name: found}; }",
          "734:       spec = createObj(found, spec);",
          "735:       spec.name = found.name;",
          "736:     } else if (typeof spec == \"string\" && /^[\\w\\-]+\\/[\\w\\-]+\\+xml$/.test(spec)) {",
          "737:       return resolveMode(\"application/xml\")",
          "738:     } else if (typeof spec == \"string\" && /^[\\w\\-]+\\/[\\w\\-]+\\+json$/.test(spec)) {",
          "739:       return resolveMode(\"application/json\")",
          "740:     }",
          "741:     if (typeof spec == \"string\") { return {name: spec} }",
          "742:     else { return spec || {name: \"null\"} }",
          "743:   }",
          "747:   function getMode(options, spec) {",
          "748:     spec = resolveMode(spec);",
          "749:     var mfactory = modes[spec.name];",
          "750:     if (!mfactory) { return getMode(options, \"text/plain\") }",
          "751:     var modeObj = mfactory(options, spec);",
          "752:     if (modeExtensions.hasOwnProperty(spec.name)) {",
          "753:       var exts = modeExtensions[spec.name];",
          "754:       for (var prop in exts) {",
          "755:         if (!exts.hasOwnProperty(prop)) { continue }",
          "756:         if (modeObj.hasOwnProperty(prop)) { modeObj[\"_\" + prop] = modeObj[prop]; }",
          "757:         modeObj[prop] = exts[prop];",
          "758:       }",
          "759:     }",
          "760:     modeObj.name = spec.name;",
          "761:     if (spec.helperType) { modeObj.helperType = spec.helperType; }",
          "762:     if (spec.modeProps) { for (var prop$1 in spec.modeProps)",
          "763:       { modeObj[prop$1] = spec.modeProps[prop$1]; } }",
          "765:     return modeObj",
          "766:   }",
          "770:   var modeExtensions = {};",
          "771:   function extendMode(mode, properties) {",
          "772:     var exts = modeExtensions.hasOwnProperty(mode) ? modeExtensions[mode] : (modeExtensions[mode] = {});",
          "773:     copyObj(properties, exts);",
          "774:   }",
          "776:   function copyState(mode, state) {",
          "777:     if (state === true) { return state }",
          "778:     if (mode.copyState) { return mode.copyState(state) }",
          "779:     var nstate = {};",
          "780:     for (var n in state) {",
          "781:       var val = state[n];",
          "782:       if (val instanceof Array) { val = val.concat([]); }",
          "783:       nstate[n] = val;",
          "784:     }",
          "785:     return nstate",
          "786:   }",
          "790:   function innerMode(mode, state) {",
          "791:     var info;",
          "792:     while (mode.innerMode) {",
          "793:       info = mode.innerMode(state);",
          "794:       if (!info || info.mode == mode) { break }",
          "795:       state = info.state;",
          "796:       mode = info.mode;",
          "797:     }",
          "798:     return info || {mode: mode, state: state}",
          "799:   }",
          "801:   function startState(mode, a1, a2) {",
          "802:     return mode.startState ? mode.startState(a1, a2) : true",
          "803:   }",
          "810:   var StringStream = function(string, tabSize, lineOracle) {",
          "811:     this.pos = this.start = 0;",
          "812:     this.string = string;",
          "813:     this.tabSize = tabSize || 8;",
          "814:     this.lastColumnPos = this.lastColumnValue = 0;",
          "815:     this.lineStart = 0;",
          "816:     this.lineOracle = lineOracle;",
          "817:   };",
          "819:   StringStream.prototype.eol = function () {return this.pos >= this.string.length};",
          "820:   StringStream.prototype.sol = function () {return this.pos == this.lineStart};",
          "821:   StringStream.prototype.peek = function () {return this.string.charAt(this.pos) || undefined};",
          "822:   StringStream.prototype.next = function () {",
          "823:     if (this.pos < this.string.length)",
          "824:       { return this.string.charAt(this.pos++) }",
          "825:   };",
          "826:   StringStream.prototype.eat = function (match) {",
          "827:     var ch = this.string.charAt(this.pos);",
          "828:     var ok;",
          "829:     if (typeof match == \"string\") { ok = ch == match; }",
          "830:     else { ok = ch && (match.test ? match.test(ch) : match(ch)); }",
          "831:     if (ok) {++this.pos; return ch}",
          "832:   };",
          "833:   StringStream.prototype.eatWhile = function (match) {",
          "834:     var start = this.pos;",
          "835:     while (this.eat(match)){}",
          "836:     return this.pos > start",
          "837:   };",
          "838:   StringStream.prototype.eatSpace = function () {",
          "839:     var start = this.pos;",
          "840:     while (/[\\s\\u00a0]/.test(this.string.charAt(this.pos))) { ++this.pos; }",
          "841:     return this.pos > start",
          "842:   };",
          "843:   StringStream.prototype.skipToEnd = function () {this.pos = this.string.length;};",
          "844:   StringStream.prototype.skipTo = function (ch) {",
          "845:     var found = this.string.indexOf(ch, this.pos);",
          "846:     if (found > -1) {this.pos = found; return true}",
          "847:   };",
          "848:   StringStream.prototype.backUp = function (n) {this.pos -= n;};",
          "849:   StringStream.prototype.column = function () {",
          "850:     if (this.lastColumnPos < this.start) {",
          "851:       this.lastColumnValue = countColumn(this.string, this.start, this.tabSize, this.lastColumnPos, this.lastColumnValue);",
          "852:       this.lastColumnPos = this.start;",
          "853:     }",
          "854:     return this.lastColumnValue - (this.lineStart ? countColumn(this.string, this.lineStart, this.tabSize) : 0)",
          "855:   };",
          "856:   StringStream.prototype.indentation = function () {",
          "857:     return countColumn(this.string, null, this.tabSize) -",
          "858:       (this.lineStart ? countColumn(this.string, this.lineStart, this.tabSize) : 0)",
          "859:   };",
          "860:   StringStream.prototype.match = function (pattern, consume, caseInsensitive) {",
          "861:     if (typeof pattern == \"string\") {",
          "862:       var cased = function (str) { return caseInsensitive ? str.toLowerCase() : str; };",
          "863:       var substr = this.string.substr(this.pos, pattern.length);",
          "864:       if (cased(substr) == cased(pattern)) {",
          "865:         if (consume !== false) { this.pos += pattern.length; }",
          "866:         return true",
          "867:       }",
          "868:     } else {",
          "869:       var match = this.string.slice(this.pos).match(pattern);",
          "870:       if (match && match.index > 0) { return null }",
          "871:       if (match && consume !== false) { this.pos += match[0].length; }",
          "872:       return match",
          "873:     }",
          "874:   };",
          "875:   StringStream.prototype.current = function (){return this.string.slice(this.start, this.pos)};",
          "876:   StringStream.prototype.hideFirstChars = function (n, inner) {",
          "877:     this.lineStart += n;",
          "878:     try { return inner() }",
          "879:     finally { this.lineStart -= n; }",
          "880:   };",
          "881:   StringStream.prototype.lookAhead = function (n) {",
          "882:     var oracle = this.lineOracle;",
          "883:     return oracle && oracle.lookAhead(n)",
          "884:   };",
          "885:   StringStream.prototype.baseToken = function () {",
          "886:     var oracle = this.lineOracle;",
          "887:     return oracle && oracle.baseToken(this.pos)",
          "888:   };",
          "891:   function getLine(doc, n) {",
          "892:     n -= doc.first;",
          "893:     if (n < 0 || n >= doc.size) { throw new Error(\"There is no line \" + (n + doc.first) + \" in the document.\") }",
          "894:     var chunk = doc;",
          "895:     while (!chunk.lines) {",
          "896:       for (var i = 0;; ++i) {",
          "897:         var child = chunk.children[i], sz = child.chunkSize();",
          "898:         if (n < sz) { chunk = child; break }",
          "899:         n -= sz;",
          "900:       }",
          "901:     }",
          "902:     return chunk.lines[n]",
          "903:   }",
          "907:   function getBetween(doc, start, end) {",
          "908:     var out = [], n = start.line;",
          "909:     doc.iter(start.line, end.line + 1, function (line) {",
          "910:       var text = line.text;",
          "911:       if (n == end.line) { text = text.slice(0, end.ch); }",
          "912:       if (n == start.line) { text = text.slice(start.ch); }",
          "913:       out.push(text);",
          "914:       ++n;",
          "915:     });",
          "916:     return out",
          "917:   }",
          "919:   function getLines(doc, from, to) {",
          "920:     var out = [];",
          "921:     doc.iter(from, to, function (line) { out.push(line.text); }); // iter aborts when callback returns truthy value",
          "922:     return out",
          "923:   }",
          "927:   function updateLineHeight(line, height) {",
          "928:     var diff = height - line.height;",
          "929:     if (diff) { for (var n = line; n; n = n.parent) { n.height += diff; } }",
          "930:   }",
          "934:   function lineNo(line) {",
          "935:     if (line.parent == null) { return null }",
          "936:     var cur = line.parent, no = indexOf(cur.lines, line);",
          "937:     for (var chunk = cur.parent; chunk; cur = chunk, chunk = chunk.parent) {",
          "938:       for (var i = 0;; ++i) {",
          "939:         if (chunk.children[i] == cur) { break }",
          "940:         no += chunk.children[i].chunkSize();",
          "941:       }",
          "942:     }",
          "943:     return no + cur.first",
          "944:   }",
          "948:   function lineAtHeight(chunk, h) {",
          "949:     var n = chunk.first;",
          "950:     outer: do {",
          "951:       for (var i$1 = 0; i$1 < chunk.children.length; ++i$1) {",
          "952:         var child = chunk.children[i$1], ch = child.height;",
          "953:         if (h < ch) { chunk = child; continue outer }",
          "954:         h -= ch;",
          "955:         n += child.chunkSize();",
          "956:       }",
          "957:       return n",
          "958:     } while (!chunk.lines)",
          "959:     var i = 0;",
          "960:     for (; i < chunk.lines.length; ++i) {",
          "961:       var line = chunk.lines[i], lh = line.height;",
          "962:       if (h < lh) { break }",
          "963:       h -= lh;",
          "964:     }",
          "965:     return n + i",
          "966:   }",
          "968:   function isLine(doc, l) {return l >= doc.first && l < doc.first + doc.size}",
          "970:   function lineNumberFor(options, i) {",
          "971:     return String(options.lineNumberFormatter(i + options.firstLineNumber))",
          "972:   }",
          "975:   function Pos(line, ch, sticky) {",
          "976:     if ( sticky === void 0 ) sticky = null;",
          "978:     if (!(this instanceof Pos)) { return new Pos(line, ch, sticky) }",
          "979:     this.line = line;",
          "980:     this.ch = ch;",
          "981:     this.sticky = sticky;",
          "982:   }",
          "986:   function cmp(a, b) { return a.line - b.line || a.ch - b.ch }",
          "988:   function equalCursorPos(a, b) { return a.sticky == b.sticky && cmp(a, b) == 0 }",
          "990:   function copyPos(x) {return Pos(x.line, x.ch)}",
          "991:   function maxPos(a, b) { return cmp(a, b) < 0 ? b : a }",
          "992:   function minPos(a, b) { return cmp(a, b) < 0 ? a : b }",
          "996:   function clipLine(doc, n) {return Math.max(doc.first, Math.min(n, doc.first + doc.size - 1))}",
          "997:   function clipPos(doc, pos) {",
          "998:     if (pos.line < doc.first) { return Pos(doc.first, 0) }",
          "999:     var last = doc.first + doc.size - 1;",
          "1000:     if (pos.line > last) { return Pos(last, getLine(doc, last).text.length) }",
          "1001:     return clipToLen(pos, getLine(doc, pos.line).text.length)",
          "1002:   }",
          "1003:   function clipToLen(pos, linelen) {",
          "1004:     var ch = pos.ch;",
          "1005:     if (ch == null || ch > linelen) { return Pos(pos.line, linelen) }",
          "1006:     else if (ch < 0) { return Pos(pos.line, 0) }",
          "1007:     else { return pos }",
          "1008:   }",
          "1009:   function clipPosArray(doc, array) {",
          "1010:     var out = [];",
          "1011:     for (var i = 0; i < array.length; i++) { out[i] = clipPos(doc, array[i]); }",
          "1012:     return out",
          "1013:   }",
          "1015:   var SavedContext = function(state, lookAhead) {",
          "1016:     this.state = state;",
          "1017:     this.lookAhead = lookAhead;",
          "1018:   };",
          "1020:   var Context = function(doc, state, line, lookAhead) {",
          "1021:     this.state = state;",
          "1022:     this.doc = doc;",
          "1023:     this.line = line;",
          "1024:     this.maxLookAhead = lookAhead || 0;",
          "1025:     this.baseTokens = null;",
          "1026:     this.baseTokenPos = 1;",
          "1027:   };",
          "1029:   Context.prototype.lookAhead = function (n) {",
          "1030:     var line = this.doc.getLine(this.line + n);",
          "1031:     if (line != null && n > this.maxLookAhead) { this.maxLookAhead = n; }",
          "1032:     return line",
          "1033:   };",
          "1035:   Context.prototype.baseToken = function (n) {",
          "1036:     if (!this.baseTokens) { return null }",
          "1037:     while (this.baseTokens[this.baseTokenPos] <= n)",
          "1038:       { this.baseTokenPos += 2; }",
          "1039:     var type = this.baseTokens[this.baseTokenPos + 1];",
          "1040:     return {type: type && type.replace(/( |^)overlay .*/, \"\"),",
          "1041:             size: this.baseTokens[this.baseTokenPos] - n}",
          "1042:   };",
          "1044:   Context.prototype.nextLine = function () {",
          "1045:     this.line++;",
          "1046:     if (this.maxLookAhead > 0) { this.maxLookAhead--; }",
          "1047:   };",
          "1049:   Context.fromSaved = function (doc, saved, line) {",
          "1050:     if (saved instanceof SavedContext)",
          "1051:       { return new Context(doc, copyState(doc.mode, saved.state), line, saved.lookAhead) }",
          "1052:     else",
          "1053:       { return new Context(doc, copyState(doc.mode, saved), line) }",
          "1054:   };",
          "1056:   Context.prototype.save = function (copy) {",
          "1057:     var state = copy !== false ? copyState(this.doc.mode, this.state) : this.state;",
          "1058:     return this.maxLookAhead > 0 ? new SavedContext(state, this.maxLookAhead) : state",
          "1059:   };",
          "1066:   function highlightLine(cm, line, context, forceToEnd) {",
          "1069:     var st = [cm.state.modeGen], lineClasses = {};",
          "1071:     runMode(cm, line.text, cm.doc.mode, context, function (end, style) { return st.push(end, style); },",
          "1072:             lineClasses, forceToEnd);",
          "1073:     var state = context.state;",
          "1076:     var loop = function ( o ) {",
          "1077:       context.baseTokens = st;",
          "1078:       var overlay = cm.state.overlays[o], i = 1, at = 0;",
          "1079:       context.state = true;",
          "1080:       runMode(cm, line.text, overlay.mode, context, function (end, style) {",
          "1081:         var start = i;",
          "1083:         while (at < end) {",
          "1084:           var i_end = st[i];",
          "1085:           if (i_end > end)",
          "1086:             { st.splice(i, 1, end, st[i+1], i_end); }",
          "1087:           i += 2;",
          "1088:           at = Math.min(end, i_end);",
          "1089:         }",
          "1090:         if (!style) { return }",
          "1091:         if (overlay.opaque) {",
          "1092:           st.splice(start, i - start, end, \"overlay \" + style);",
          "1093:           i = start + 2;",
          "1094:         } else {",
          "1095:           for (; start < i; start += 2) {",
          "1096:             var cur = st[start+1];",
          "1097:             st[start+1] = (cur ? cur + \" \" : \"\") + \"overlay \" + style;",
          "1098:           }",
          "1099:         }",
          "1100:       }, lineClasses);",
          "1101:       context.state = state;",
          "1102:       context.baseTokens = null;",
          "1103:       context.baseTokenPos = 1;",
          "1104:     };",
          "1106:     for (var o = 0; o < cm.state.overlays.length; ++o) loop( o );",
          "1108:     return {styles: st, classes: lineClasses.bgClass || lineClasses.textClass ? lineClasses : null}",
          "1109:   }",
          "1111:   function getLineStyles(cm, line, updateFrontier) {",
          "1112:     if (!line.styles || line.styles[0] != cm.state.modeGen) {",
          "1113:       var context = getContextBefore(cm, lineNo(line));",
          "1114:       var resetState = line.text.length > cm.options.maxHighlightLength && copyState(cm.doc.mode, context.state);",
          "1115:       var result = highlightLine(cm, line, context);",
          "1116:       if (resetState) { context.state = resetState; }",
          "1117:       line.stateAfter = context.save(!resetState);",
          "1118:       line.styles = result.styles;",
          "1119:       if (result.classes) { line.styleClasses = result.classes; }",
          "1120:       else if (line.styleClasses) { line.styleClasses = null; }",
          "1121:       if (updateFrontier === cm.doc.highlightFrontier)",
          "1122:         { cm.doc.modeFrontier = Math.max(cm.doc.modeFrontier, ++cm.doc.highlightFrontier); }",
          "1123:     }",
          "1124:     return line.styles",
          "1125:   }",
          "1127:   function getContextBefore(cm, n, precise) {",
          "1128:     var doc = cm.doc, display = cm.display;",
          "1129:     if (!doc.mode.startState) { return new Context(doc, true, n) }",
          "1130:     var start = findStartLine(cm, n, precise);",
          "1131:     var saved = start > doc.first && getLine(doc, start - 1).stateAfter;",
          "1132:     var context = saved ? Context.fromSaved(doc, saved, start) : new Context(doc, startState(doc.mode), start);",
          "1134:     doc.iter(start, n, function (line) {",
          "1135:       processLine(cm, line.text, context);",
          "1136:       var pos = context.line;",
          "1137:       line.stateAfter = pos == n - 1 || pos % 5 == 0 || pos >= display.viewFrom && pos < display.viewTo ? context.save() : null;",
          "1138:       context.nextLine();",
          "1139:     });",
          "1140:     if (precise) { doc.modeFrontier = context.line; }",
          "1141:     return context",
          "1142:   }",
          "1147:   function processLine(cm, text, context, startAt) {",
          "1148:     var mode = cm.doc.mode;",
          "1149:     var stream = new StringStream(text, cm.options.tabSize, context);",
          "1150:     stream.start = stream.pos = startAt || 0;",
          "1151:     if (text == \"\") { callBlankLine(mode, context.state); }",
          "1152:     while (!stream.eol()) {",
          "1153:       readToken(mode, stream, context.state);",
          "1154:       stream.start = stream.pos;",
          "1155:     }",
          "1156:   }",
          "1158:   function callBlankLine(mode, state) {",
          "1159:     if (mode.blankLine) { return mode.blankLine(state) }",
          "1160:     if (!mode.innerMode) { return }",
          "1161:     var inner = innerMode(mode, state);",
          "1162:     if (inner.mode.blankLine) { return inner.mode.blankLine(inner.state) }",
          "1163:   }",
          "1165:   function readToken(mode, stream, state, inner) {",
          "1166:     for (var i = 0; i < 10; i++) {",
          "1167:       if (inner) { inner[0] = innerMode(mode, state).mode; }",
          "1168:       var style = mode.token(stream, state);",
          "1169:       if (stream.pos > stream.start) { return style }",
          "1170:     }",
          "1171:     throw new Error(\"Mode \" + mode.name + \" failed to advance stream.\")",
          "1172:   }",
          "1174:   var Token = function(stream, type, state) {",
          "1175:     this.start = stream.start; this.end = stream.pos;",
          "1176:     this.string = stream.current();",
          "1177:     this.type = type || null;",
          "1178:     this.state = state;",
          "1179:   };",
          "1182:   function takeToken(cm, pos, precise, asArray) {",
          "1183:     var doc = cm.doc, mode = doc.mode, style;",
          "1184:     pos = clipPos(doc, pos);",
          "1185:     var line = getLine(doc, pos.line), context = getContextBefore(cm, pos.line, precise);",
          "1186:     var stream = new StringStream(line.text, cm.options.tabSize, context), tokens;",
          "1187:     if (asArray) { tokens = []; }",
          "1188:     while ((asArray || stream.pos < pos.ch) && !stream.eol()) {",
          "1189:       stream.start = stream.pos;",
          "1190:       style = readToken(mode, stream, context.state);",
          "1191:       if (asArray) { tokens.push(new Token(stream, style, copyState(doc.mode, context.state))); }",
          "1192:     }",
          "1193:     return asArray ? tokens : new Token(stream, style, context.state)",
          "1194:   }",
          "1196:   function extractLineClasses(type, output) {",
          "1197:     if (type) { for (;;) {",
          "1198:       var lineClass = type.match(/(?:^|\\s+)line-(background-)?(\\S+)/);",
          "1199:       if (!lineClass) { break }",
          "1200:       type = type.slice(0, lineClass.index) + type.slice(lineClass.index + lineClass[0].length);",
          "1201:       var prop = lineClass[1] ? \"bgClass\" : \"textClass\";",
          "1202:       if (output[prop] == null)",
          "1203:         { output[prop] = lineClass[2]; }",
          "1204:       else if (!(new RegExp(\"(?:^|\\\\s)\" + lineClass[2] + \"(?:$|\\\\s)\")).test(output[prop]))",
          "1205:         { output[prop] += \" \" + lineClass[2]; }",
          "1206:     } }",
          "1207:     return type",
          "1208:   }",
          "1211:   function runMode(cm, text, mode, context, f, lineClasses, forceToEnd) {",
          "1212:     var flattenSpans = mode.flattenSpans;",
          "1213:     if (flattenSpans == null) { flattenSpans = cm.options.flattenSpans; }",
          "1214:     var curStart = 0, curStyle = null;",
          "1215:     var stream = new StringStream(text, cm.options.tabSize, context), style;",
          "1216:     var inner = cm.options.addModeClass && [null];",
          "1217:     if (text == \"\") { extractLineClasses(callBlankLine(mode, context.state), lineClasses); }",
          "1218:     while (!stream.eol()) {",
          "1219:       if (stream.pos > cm.options.maxHighlightLength) {",
          "1220:         flattenSpans = false;",
          "1221:         if (forceToEnd) { processLine(cm, text, context, stream.pos); }",
          "1222:         stream.pos = text.length;",
          "1223:         style = null;",
          "1224:       } else {",
          "1225:         style = extractLineClasses(readToken(mode, stream, context.state, inner), lineClasses);",
          "1226:       }",
          "1227:       if (inner) {",
          "1228:         var mName = inner[0].name;",
          "1229:         if (mName) { style = \"m-\" + (style ? mName + \" \" + style : mName); }",
          "1230:       }",
          "1231:       if (!flattenSpans || curStyle != style) {",
          "1232:         while (curStart < stream.start) {",
          "1233:           curStart = Math.min(stream.start, curStart + 5000);",
          "1234:           f(curStart, curStyle);",
          "1235:         }",
          "1236:         curStyle = style;",
          "1237:       }",
          "1238:       stream.start = stream.pos;",
          "1239:     }",
          "1240:     while (curStart < stream.pos) {",
          "1244:       var pos = Math.min(stream.pos, curStart + 5000);",
          "1245:       f(pos, curStyle);",
          "1246:       curStart = pos;",
          "1247:     }",
          "1248:   }",
          "1255:   function findStartLine(cm, n, precise) {",
          "1256:     var minindent, minline, doc = cm.doc;",
          "1257:     var lim = precise ? -1 : n - (cm.doc.mode.innerMode ? 1000 : 100);",
          "1258:     for (var search = n; search > lim; --search) {",
          "1259:       if (search <= doc.first) { return doc.first }",
          "1260:       var line = getLine(doc, search - 1), after = line.stateAfter;",
          "1261:       if (after && (!precise || search + (after instanceof SavedContext ? after.lookAhead : 0) <= doc.modeFrontier))",
          "1262:         { return search }",
          "1263:       var indented = countColumn(line.text, null, cm.options.tabSize);",
          "1264:       if (minline == null || minindent > indented) {",
          "1265:         minline = search - 1;",
          "1266:         minindent = indented;",
          "1267:       }",
          "1268:     }",
          "1269:     return minline",
          "1270:   }",
          "1272:   function retreatFrontier(doc, n) {",
          "1273:     doc.modeFrontier = Math.min(doc.modeFrontier, n);",
          "1274:     if (doc.highlightFrontier < n - 10) { return }",
          "1275:     var start = doc.first;",
          "1276:     for (var line = n - 1; line > start; line--) {",
          "1277:       var saved = getLine(doc, line).stateAfter;",
          "1281:       if (saved && (!(saved instanceof SavedContext) || line + saved.lookAhead < n)) {",
          "1282:         start = line + 1;",
          "1283:         break",
          "1284:       }",
          "1285:     }",
          "1286:     doc.highlightFrontier = Math.min(doc.highlightFrontier, start);",
          "1287:   }",
          "1290:   var sawReadOnlySpans = false, sawCollapsedSpans = false;",
          "1292:   function seeReadOnlySpans() {",
          "1293:     sawReadOnlySpans = true;",
          "1294:   }",
          "1296:   function seeCollapsedSpans() {",
          "1297:     sawCollapsedSpans = true;",
          "1298:   }",
          "1302:   function MarkedSpan(marker, from, to) {",
          "1303:     this.marker = marker;",
          "1304:     this.from = from; this.to = to;",
          "1305:   }",
          "1308:   function getMarkedSpanFor(spans, marker) {",
          "1309:     if (spans) { for (var i = 0; i < spans.length; ++i) {",
          "1310:       var span = spans[i];",
          "1311:       if (span.marker == marker) { return span }",
          "1312:     } }",
          "1313:   }",
          "1317:   function removeMarkedSpan(spans, span) {",
          "1318:     var r;",
          "1319:     for (var i = 0; i < spans.length; ++i)",
          "1320:       { if (spans[i] != span) { (r || (r = [])).push(spans[i]); } }",
          "1321:     return r",
          "1322:   }",
          "1325:   function addMarkedSpan(line, span, op) {",
          "1326:     var inThisOp = op && window.WeakSet && (op.markedSpans || (op.markedSpans = new WeakSet));",
          "1327:     if (inThisOp && inThisOp.has(line.markedSpans)) {",
          "1328:       line.markedSpans.push(span);",
          "1329:     } else {",
          "1330:       line.markedSpans = line.markedSpans ? line.markedSpans.concat([span]) : [span];",
          "1331:       if (inThisOp) { inThisOp.add(line.markedSpans); }",
          "1332:     }",
          "1333:     span.marker.attachLine(line);",
          "1334:   }",
          "1340:   function markedSpansBefore(old, startCh, isInsert) {",
          "1341:     var nw;",
          "1342:     if (old) { for (var i = 0; i < old.length; ++i) {",
          "1343:       var span = old[i], marker = span.marker;",
          "1344:       var startsBefore = span.from == null || (marker.inclusiveLeft ? span.from <= startCh : span.from < startCh);",
          "1345:       if (startsBefore || span.from == startCh && marker.type == \"bookmark\" && (!isInsert || !span.marker.insertLeft)) {",
          "1346:         var endsAfter = span.to == null || (marker.inclusiveRight ? span.to >= startCh : span.to > startCh)",
          "1347:         ;(nw || (nw = [])).push(new MarkedSpan(marker, span.from, endsAfter ? null : span.to));",
          "1348:       }",
          "1349:     } }",
          "1350:     return nw",
          "1351:   }",
          "1352:   function markedSpansAfter(old, endCh, isInsert) {",
          "1353:     var nw;",
          "1354:     if (old) { for (var i = 0; i < old.length; ++i) {",
          "1355:       var span = old[i], marker = span.marker;",
          "1356:       var endsAfter = span.to == null || (marker.inclusiveRight ? span.to >= endCh : span.to > endCh);",
          "1357:       if (endsAfter || span.from == endCh && marker.type == \"bookmark\" && (!isInsert || span.marker.insertLeft)) {",
          "1358:         var startsBefore = span.from == null || (marker.inclusiveLeft ? span.from <= endCh : span.from < endCh)",
          "1359:         ;(nw || (nw = [])).push(new MarkedSpan(marker, startsBefore ? null : span.from - endCh,",
          "1360:                                               span.to == null ? null : span.to - endCh));",
          "1361:       }",
          "1362:     } }",
          "1363:     return nw",
          "1364:   }",
          "1372:   function stretchSpansOverChange(doc, change) {",
          "1373:     if (change.full) { return null }",
          "1374:     var oldFirst = isLine(doc, change.from.line) && getLine(doc, change.from.line).markedSpans;",
          "1375:     var oldLast = isLine(doc, change.to.line) && getLine(doc, change.to.line).markedSpans;",
          "1376:     if (!oldFirst && !oldLast) { return null }",
          "1378:     var startCh = change.from.ch, endCh = change.to.ch, isInsert = cmp(change.from, change.to) == 0;",
          "1380:     var first = markedSpansBefore(oldFirst, startCh, isInsert);",
          "1381:     var last = markedSpansAfter(oldLast, endCh, isInsert);",
          "1384:     var sameLine = change.text.length == 1, offset = lst(change.text).length + (sameLine ? startCh : 0);",
          "1385:     if (first) {",
          "1387:       for (var i = 0; i < first.length; ++i) {",
          "1388:         var span = first[i];",
          "1389:         if (span.to == null) {",
          "1390:           var found = getMarkedSpanFor(last, span.marker);",
          "1391:           if (!found) { span.to = startCh; }",
          "1392:           else if (sameLine) { span.to = found.to == null ? null : found.to + offset; }",
          "1393:         }",
          "1394:       }",
          "1395:     }",
          "1396:     if (last) {",
          "1398:       for (var i$1 = 0; i$1 < last.length; ++i$1) {",
          "1399:         var span$1 = last[i$1];",
          "1400:         if (span$1.to != null) { span$1.to += offset; }",
          "1401:         if (span$1.from == null) {",
          "1402:           var found$1 = getMarkedSpanFor(first, span$1.marker);",
          "1403:           if (!found$1) {",
          "1404:             span$1.from = offset;",
          "1405:             if (sameLine) { (first || (first = [])).push(span$1); }",
          "1406:           }",
          "1407:         } else {",
          "1408:           span$1.from += offset;",
          "1409:           if (sameLine) { (first || (first = [])).push(span$1); }",
          "1410:         }",
          "1411:       }",
          "1412:     }",
          "1414:     if (first) { first = clearEmptySpans(first); }",
          "1415:     if (last && last != first) { last = clearEmptySpans(last); }",
          "1417:     var newMarkers = [first];",
          "1418:     if (!sameLine) {",
          "1420:       var gap = change.text.length - 2, gapMarkers;",
          "1421:       if (gap > 0 && first)",
          "1422:         { for (var i$2 = 0; i$2 < first.length; ++i$2)",
          "1423:           { if (first[i$2].to == null)",
          "1424:             { (gapMarkers || (gapMarkers = [])).push(new MarkedSpan(first[i$2].marker, null, null)); } } }",
          "1425:       for (var i$3 = 0; i$3 < gap; ++i$3)",
          "1426:         { newMarkers.push(gapMarkers); }",
          "1427:       newMarkers.push(last);",
          "1428:     }",
          "1429:     return newMarkers",
          "1430:   }",
          "1434:   function clearEmptySpans(spans) {",
          "1435:     for (var i = 0; i < spans.length; ++i) {",
          "1436:       var span = spans[i];",
          "1437:       if (span.from != null && span.from == span.to && span.marker.clearWhenEmpty !== false)",
          "1438:         { spans.splice(i--, 1); }",
          "1439:     }",
          "1440:     if (!spans.length) { return null }",
          "1441:     return spans",
          "1442:   }",
          "1445:   function removeReadOnlyRanges(doc, from, to) {",
          "1446:     var markers = null;",
          "1447:     doc.iter(from.line, to.line + 1, function (line) {",
          "1448:       if (line.markedSpans) { for (var i = 0; i < line.markedSpans.length; ++i) {",
          "1449:         var mark = line.markedSpans[i].marker;",
          "1450:         if (mark.readOnly && (!markers || indexOf(markers, mark) == -1))",
          "1451:           { (markers || (markers = [])).push(mark); }",
          "1452:       } }",
          "1453:     });",
          "1454:     if (!markers) { return null }",
          "1455:     var parts = [{from: from, to: to}];",
          "1456:     for (var i = 0; i < markers.length; ++i) {",
          "1457:       var mk = markers[i], m = mk.find(0);",
          "1458:       for (var j = 0; j < parts.length; ++j) {",
          "1459:         var p = parts[j];",
          "1460:         if (cmp(p.to, m.from) < 0 || cmp(p.from, m.to) > 0) { continue }",
          "1461:         var newParts = [j, 1], dfrom = cmp(p.from, m.from), dto = cmp(p.to, m.to);",
          "1462:         if (dfrom < 0 || !mk.inclusiveLeft && !dfrom)",
          "1463:           { newParts.push({from: p.from, to: m.from}); }",
          "1464:         if (dto > 0 || !mk.inclusiveRight && !dto)",
          "1465:           { newParts.push({from: m.to, to: p.to}); }",
          "1466:         parts.splice.apply(parts, newParts);",
          "1467:         j += newParts.length - 3;",
          "1468:       }",
          "1469:     }",
          "1470:     return parts",
          "1471:   }",
          "1474:   function detachMarkedSpans(line) {",
          "1475:     var spans = line.markedSpans;",
          "1476:     if (!spans) { return }",
          "1477:     for (var i = 0; i < spans.length; ++i)",
          "1478:       { spans[i].marker.detachLine(line); }",
          "1479:     line.markedSpans = null;",
          "1480:   }",
          "1481:   function attachMarkedSpans(line, spans) {",
          "1482:     if (!spans) { return }",
          "1483:     for (var i = 0; i < spans.length; ++i)",
          "1484:       { spans[i].marker.attachLine(line); }",
          "1485:     line.markedSpans = spans;",
          "1486:   }",
          "1490:   function extraLeft(marker) { return marker.inclusiveLeft ? -1 : 0 }",
          "1491:   function extraRight(marker) { return marker.inclusiveRight ? 1 : 0 }",
          "1496:   function compareCollapsedMarkers(a, b) {",
          "1497:     var lenDiff = a.lines.length - b.lines.length;",
          "1498:     if (lenDiff != 0) { return lenDiff }",
          "1499:     var aPos = a.find(), bPos = b.find();",
          "1500:     var fromCmp = cmp(aPos.from, bPos.from) || extraLeft(a) - extraLeft(b);",
          "1501:     if (fromCmp) { return -fromCmp }",
          "1502:     var toCmp = cmp(aPos.to, bPos.to) || extraRight(a) - extraRight(b);",
          "1503:     if (toCmp) { return toCmp }",
          "1504:     return b.id - a.id",
          "1505:   }",
          "1509:   function collapsedSpanAtSide(line, start) {",
          "1510:     var sps = sawCollapsedSpans && line.markedSpans, found;",
          "1511:     if (sps) { for (var sp = (void 0), i = 0; i < sps.length; ++i) {",
          "1512:       sp = sps[i];",
          "1513:       if (sp.marker.collapsed && (start ? sp.from : sp.to) == null &&",
          "1514:           (!found || compareCollapsedMarkers(found, sp.marker) < 0))",
          "1515:         { found = sp.marker; }",
          "1516:     } }",
          "1517:     return found",
          "1518:   }",
          "1519:   function collapsedSpanAtStart(line) { return collapsedSpanAtSide(line, true) }",
          "1520:   function collapsedSpanAtEnd(line) { return collapsedSpanAtSide(line, false) }",
          "1522:   function collapsedSpanAround(line, ch) {",
          "1523:     var sps = sawCollapsedSpans && line.markedSpans, found;",
          "1524:     if (sps) { for (var i = 0; i < sps.length; ++i) {",
          "1525:       var sp = sps[i];",
          "1526:       if (sp.marker.collapsed && (sp.from == null || sp.from < ch) && (sp.to == null || sp.to > ch) &&",
          "1527:           (!found || compareCollapsedMarkers(found, sp.marker) < 0)) { found = sp.marker; }",
          "1528:     } }",
          "1529:     return found",
          "1530:   }",
          "1535:   function conflictingCollapsedRange(doc, lineNo, from, to, marker) {",
          "1536:     var line = getLine(doc, lineNo);",
          "1537:     var sps = sawCollapsedSpans && line.markedSpans;",
          "1538:     if (sps) { for (var i = 0; i < sps.length; ++i) {",
          "1539:       var sp = sps[i];",
          "1540:       if (!sp.marker.collapsed) { continue }",
          "1541:       var found = sp.marker.find(0);",
          "1542:       var fromCmp = cmp(found.from, from) || extraLeft(sp.marker) - extraLeft(marker);",
          "1543:       var toCmp = cmp(found.to, to) || extraRight(sp.marker) - extraRight(marker);",
          "1544:       if (fromCmp >= 0 && toCmp <= 0 || fromCmp <= 0 && toCmp >= 0) { continue }",
          "1545:       if (fromCmp <= 0 && (sp.marker.inclusiveRight && marker.inclusiveLeft ? cmp(found.to, from) >= 0 : cmp(found.to, from) > 0) ||",
          "1546:           fromCmp >= 0 && (sp.marker.inclusiveRight && marker.inclusiveLeft ? cmp(found.from, to) <= 0 : cmp(found.from, to) < 0))",
          "1547:         { return true }",
          "1548:     } }",
          "1549:   }",
          "1555:   function visualLine(line) {",
          "1556:     var merged;",
          "1557:     while (merged = collapsedSpanAtStart(line))",
          "1558:       { line = merged.find(-1, true).line; }",
          "1559:     return line",
          "1560:   }",
          "1562:   function visualLineEnd(line) {",
          "1563:     var merged;",
          "1564:     while (merged = collapsedSpanAtEnd(line))",
          "1565:       { line = merged.find(1, true).line; }",
          "1566:     return line",
          "1567:   }",
          "1571:   function visualLineContinued(line) {",
          "1572:     var merged, lines;",
          "1573:     while (merged = collapsedSpanAtEnd(line)) {",
          "1574:       line = merged.find(1, true).line",
          "1575:       ;(lines || (lines = [])).push(line);",
          "1576:     }",
          "1577:     return lines",
          "1578:   }",
          "1582:   function visualLineNo(doc, lineN) {",
          "1583:     var line = getLine(doc, lineN), vis = visualLine(line);",
          "1584:     if (line == vis) { return lineN }",
          "1585:     return lineNo(vis)",
          "1586:   }",
          "1590:   function visualLineEndNo(doc, lineN) {",
          "1591:     if (lineN > doc.lastLine()) { return lineN }",
          "1592:     var line = getLine(doc, lineN), merged;",
          "1593:     if (!lineIsHidden(doc, line)) { return lineN }",
          "1594:     while (merged = collapsedSpanAtEnd(line))",
          "1595:       { line = merged.find(1, true).line; }",
          "1596:     return lineNo(line) + 1",
          "1597:   }",
          "1602:   function lineIsHidden(doc, line) {",
          "1603:     var sps = sawCollapsedSpans && line.markedSpans;",
          "1604:     if (sps) { for (var sp = (void 0), i = 0; i < sps.length; ++i) {",
          "1605:       sp = sps[i];",
          "1606:       if (!sp.marker.collapsed) { continue }",
          "1607:       if (sp.from == null) { return true }",
          "1608:       if (sp.marker.widgetNode) { continue }",
          "1609:       if (sp.from == 0 && sp.marker.inclusiveLeft && lineIsHiddenInner(doc, line, sp))",
          "1610:         { return true }",
          "1611:     } }",
          "1612:   }",
          "1613:   function lineIsHiddenInner(doc, line, span) {",
          "1614:     if (span.to == null) {",
          "1615:       var end = span.marker.find(1, true);",
          "1616:       return lineIsHiddenInner(doc, end.line, getMarkedSpanFor(end.line.markedSpans, span.marker))",
          "1617:     }",
          "1618:     if (span.marker.inclusiveRight && span.to == line.text.length)",
          "1619:       { return true }",
          "1620:     for (var sp = (void 0), i = 0; i < line.markedSpans.length; ++i) {",
          "1621:       sp = line.markedSpans[i];",
          "1622:       if (sp.marker.collapsed && !sp.marker.widgetNode && sp.from == span.to &&",
          "1623:           (sp.to == null || sp.to != span.from) &&",
          "1624:           (sp.marker.inclusiveLeft || span.marker.inclusiveRight) &&",
          "1625:           lineIsHiddenInner(doc, line, sp)) { return true }",
          "1626:     }",
          "1627:   }",
          "1630:   function heightAtLine(lineObj) {",
          "1631:     lineObj = visualLine(lineObj);",
          "1633:     var h = 0, chunk = lineObj.parent;",
          "1634:     for (var i = 0; i < chunk.lines.length; ++i) {",
          "1635:       var line = chunk.lines[i];",
          "1636:       if (line == lineObj) { break }",
          "1637:       else { h += line.height; }",
          "1638:     }",
          "1639:     for (var p = chunk.parent; p; chunk = p, p = chunk.parent) {",
          "1640:       for (var i$1 = 0; i$1 < p.children.length; ++i$1) {",
          "1641:         var cur = p.children[i$1];",
          "1642:         if (cur == chunk) { break }",
          "1643:         else { h += cur.height; }",
          "1644:       }",
          "1645:     }",
          "1646:     return h",
          "1647:   }",
          "1652:   function lineLength(line) {",
          "1653:     if (line.height == 0) { return 0 }",
          "1654:     var len = line.text.length, merged, cur = line;",
          "1655:     while (merged = collapsedSpanAtStart(cur)) {",
          "1656:       var found = merged.find(0, true);",
          "1657:       cur = found.from.line;",
          "1658:       len += found.from.ch - found.to.ch;",
          "1659:     }",
          "1660:     cur = line;",
          "1661:     while (merged = collapsedSpanAtEnd(cur)) {",
          "1662:       var found$1 = merged.find(0, true);",
          "1663:       len -= cur.text.length - found$1.from.ch;",
          "1664:       cur = found$1.to.line;",
          "1665:       len += cur.text.length - found$1.to.ch;",
          "1666:     }",
          "1667:     return len",
          "1668:   }",
          "1671:   function findMaxLine(cm) {",
          "1672:     var d = cm.display, doc = cm.doc;",
          "1673:     d.maxLine = getLine(doc, doc.first);",
          "1674:     d.maxLineLength = lineLength(d.maxLine);",
          "1675:     d.maxLineChanged = true;",
          "1676:     doc.iter(function (line) {",
          "1677:       var len = lineLength(line);",
          "1678:       if (len > d.maxLineLength) {",
          "1679:         d.maxLineLength = len;",
          "1680:         d.maxLine = line;",
          "1681:       }",
          "1682:     });",
          "1683:   }",
          "1689:   var Line = function(text, markedSpans, estimateHeight) {",
          "1690:     this.text = text;",
          "1691:     attachMarkedSpans(this, markedSpans);",
          "1692:     this.height = estimateHeight ? estimateHeight(this) : 1;",
          "1693:   };",
          "1695:   Line.prototype.lineNo = function () { return lineNo(this) };",
          "1696:   eventMixin(Line);",
          "1701:   function updateLine(line, text, markedSpans, estimateHeight) {",
          "1702:     line.text = text;",
          "1703:     if (line.stateAfter) { line.stateAfter = null; }",
          "1704:     if (line.styles) { line.styles = null; }",
          "1705:     if (line.order != null) { line.order = null; }",
          "1706:     detachMarkedSpans(line);",
          "1707:     attachMarkedSpans(line, markedSpans);",
          "1708:     var estHeight = estimateHeight ? estimateHeight(line) : 1;",
          "1709:     if (estHeight != line.height) { updateLineHeight(line, estHeight); }",
          "1710:   }",
          "1713:   function cleanUpLine(line) {",
          "1714:     line.parent = null;",
          "1715:     detachMarkedSpans(line);",
          "1716:   }",
          "1721:   var styleToClassCache = {}, styleToClassCacheWithMode = {};",
          "1722:   function interpretTokenStyle(style, options) {",
          "1723:     if (!style || /^\\s*$/.test(style)) { return null }",
          "1724:     var cache = options.addModeClass ? styleToClassCacheWithMode : styleToClassCache;",
          "1725:     return cache[style] ||",
          "1726:       (cache[style] = style.replace(/\\S+/g, \"cm-$&\"))",
          "1727:   }",
          "1734:   function buildLineContent(cm, lineView) {",
          "1738:     var content = eltP(\"span\", null, null, webkit ? \"padding-right: .1px\" : null);",
          "1739:     var builder = {pre: eltP(\"pre\", [content], \"CodeMirror-line\"), content: content,",
          "1740:                    col: 0, pos: 0, cm: cm,",
          "1741:                    trailingSpace: false,",
          "1742:                    splitSpaces: cm.getOption(\"lineWrapping\")};",
          "1743:     lineView.measure = {};",
          "1746:     for (var i = 0; i <= (lineView.rest ? lineView.rest.length : 0); i++) {",
          "1747:       var line = i ? lineView.rest[i - 1] : lineView.line, order = (void 0);",
          "1748:       builder.pos = 0;",
          "1749:       builder.addToken = buildToken;",
          "1752:       if (hasBadBidiRects(cm.display.measure) && (order = getOrder(line, cm.doc.direction)))",
          "1753:         { builder.addToken = buildTokenBadBidi(builder.addToken, order); }",
          "1754:       builder.map = [];",
          "1755:       var allowFrontierUpdate = lineView != cm.display.externalMeasured && lineNo(line);",
          "1756:       insertLineContent(line, builder, getLineStyles(cm, line, allowFrontierUpdate));",
          "1757:       if (line.styleClasses) {",
          "1758:         if (line.styleClasses.bgClass)",
          "1759:           { builder.bgClass = joinClasses(line.styleClasses.bgClass, builder.bgClass || \"\"); }",
          "1760:         if (line.styleClasses.textClass)",
          "1761:           { builder.textClass = joinClasses(line.styleClasses.textClass, builder.textClass || \"\"); }",
          "1762:       }",
          "1765:       if (builder.map.length == 0)",
          "1766:         { builder.map.push(0, 0, builder.content.appendChild(zeroWidthElement(cm.display.measure))); }",
          "1769:       if (i == 0) {",
          "1770:         lineView.measure.map = builder.map;",
          "1771:         lineView.measure.cache = {};",
          "1772:       } else {",
          "1773:   (lineView.measure.maps || (lineView.measure.maps = [])).push(builder.map)",
          "1774:         ;(lineView.measure.caches || (lineView.measure.caches = [])).push({});",
          "1775:       }",
          "1776:     }",
          "1779:     if (webkit) {",
          "1780:       var last = builder.content.lastChild;",
          "1781:       if (/\\bcm-tab\\b/.test(last.className) || (last.querySelector && last.querySelector(\".cm-tab\")))",
          "1782:         { builder.content.className = \"cm-tab-wrap-hack\"; }",
          "1783:     }",
          "1785:     signal(cm, \"renderLine\", cm, lineView.line, builder.pre);",
          "1786:     if (builder.pre.className)",
          "1787:       { builder.textClass = joinClasses(builder.pre.className, builder.textClass || \"\"); }",
          "1789:     return builder",
          "1790:   }",
          "1792:   function defaultSpecialCharPlaceholder(ch) {",
          "1793:     var token = elt(\"span\", \"\\u2022\", \"cm-invalidchar\");",
          "1794:     token.title = \"\\\\u\" + ch.charCodeAt(0).toString(16);",
          "1795:     token.setAttribute(\"aria-label\", token.title);",
          "1796:     return token",
          "1797:   }",
          "1801:   function buildToken(builder, text, style, startStyle, endStyle, css, attributes) {",
          "1802:     if (!text) { return }",
          "1803:     var displayText = builder.splitSpaces ? splitSpaces(text, builder.trailingSpace) : text;",
          "1804:     var special = builder.cm.state.specialChars, mustWrap = false;",
          "1805:     var content;",
          "1806:     if (!special.test(text)) {",
          "1807:       builder.col += text.length;",
          "1808:       content = document.createTextNode(displayText);",
          "1809:       builder.map.push(builder.pos, builder.pos + text.length, content);",
          "1810:       if (ie && ie_version < 9) { mustWrap = true; }",
          "1811:       builder.pos += text.length;",
          "1812:     } else {",
          "1813:       content = document.createDocumentFragment();",
          "1814:       var pos = 0;",
          "1815:       while (true) {",
          "1816:         special.lastIndex = pos;",
          "1817:         var m = special.exec(text);",
          "1818:         var skipped = m ? m.index - pos : text.length - pos;",
          "1819:         if (skipped) {",
          "1820:           var txt = document.createTextNode(displayText.slice(pos, pos + skipped));",
          "1821:           if (ie && ie_version < 9) { content.appendChild(elt(\"span\", [txt])); }",
          "1822:           else { content.appendChild(txt); }",
          "1823:           builder.map.push(builder.pos, builder.pos + skipped, txt);",
          "1824:           builder.col += skipped;",
          "1825:           builder.pos += skipped;",
          "1826:         }",
          "1827:         if (!m) { break }",
          "1828:         pos += skipped + 1;",
          "1829:         var txt$1 = (void 0);",
          "1830:         if (m[0] == \"\\t\") {",
          "1831:           var tabSize = builder.cm.options.tabSize, tabWidth = tabSize - builder.col % tabSize;",
          "1832:           txt$1 = content.appendChild(elt(\"span\", spaceStr(tabWidth), \"cm-tab\"));",
          "1833:           txt$1.setAttribute(\"role\", \"presentation\");",
          "1834:           txt$1.setAttribute(\"cm-text\", \"\\t\");",
          "1835:           builder.col += tabWidth;",
          "1836:         } else if (m[0] == \"\\r\" || m[0] == \"\\n\") {",
          "1837:           txt$1 = content.appendChild(elt(\"span\", m[0] == \"\\r\" ? \"\\u240d\" : \"\\u2424\", \"cm-invalidchar\"));",
          "1838:           txt$1.setAttribute(\"cm-text\", m[0]);",
          "1839:           builder.col += 1;",
          "1840:         } else {",
          "1841:           txt$1 = builder.cm.options.specialCharPlaceholder(m[0]);",
          "1842:           txt$1.setAttribute(\"cm-text\", m[0]);",
          "1843:           if (ie && ie_version < 9) { content.appendChild(elt(\"span\", [txt$1])); }",
          "1844:           else { content.appendChild(txt$1); }",
          "1845:           builder.col += 1;",
          "1846:         }",
          "1847:         builder.map.push(builder.pos, builder.pos + 1, txt$1);",
          "1848:         builder.pos++;",
          "1849:       }",
          "1850:     }",
          "1851:     builder.trailingSpace = displayText.charCodeAt(text.length - 1) == 32;",
          "1852:     if (style || startStyle || endStyle || mustWrap || css || attributes) {",
          "1853:       var fullStyle = style || \"\";",
          "1854:       if (startStyle) { fullStyle += startStyle; }",
          "1855:       if (endStyle) { fullStyle += endStyle; }",
          "1856:       var token = elt(\"span\", [content], fullStyle, css);",
          "1857:       if (attributes) {",
          "1858:         for (var attr in attributes) { if (attributes.hasOwnProperty(attr) && attr != \"style\" && attr != \"class\")",
          "1859:           { token.setAttribute(attr, attributes[attr]); } }",
          "1860:       }",
          "1861:       return builder.content.appendChild(token)",
          "1862:     }",
          "1863:     builder.content.appendChild(content);",
          "1864:   }",
          "1868:   function splitSpaces(text, trailingBefore) {",
          "1869:     if (text.length > 1 && !/  /.test(text)) { return text }",
          "1870:     var spaceBefore = trailingBefore, result = \"\";",
          "1871:     for (var i = 0; i < text.length; i++) {",
          "1872:       var ch = text.charAt(i);",
          "1873:       if (ch == \" \" && spaceBefore && (i == text.length - 1 || text.charCodeAt(i + 1) == 32))",
          "1874:         { ch = \"\\u00a0\"; }",
          "1875:       result += ch;",
          "1876:       spaceBefore = ch == \" \";",
          "1877:     }",
          "1878:     return result",
          "1879:   }",
          "1883:   function buildTokenBadBidi(inner, order) {",
          "1884:     return function (builder, text, style, startStyle, endStyle, css, attributes) {",
          "1885:       style = style ? style + \" cm-force-border\" : \"cm-force-border\";",
          "1886:       var start = builder.pos, end = start + text.length;",
          "1887:       for (;;) {",
          "1889:         var part = (void 0);",
          "1890:         for (var i = 0; i < order.length; i++) {",
          "1891:           part = order[i];",
          "1892:           if (part.to > start && part.from <= start) { break }",
          "1893:         }",
          "1894:         if (part.to >= end) { return inner(builder, text, style, startStyle, endStyle, css, attributes) }",
          "1895:         inner(builder, text.slice(0, part.to - start), style, startStyle, null, css, attributes);",
          "1896:         startStyle = null;",
          "1897:         text = text.slice(part.to - start);",
          "1898:         start = part.to;",
          "1899:       }",
          "1900:     }",
          "1901:   }",
          "1903:   function buildCollapsedSpan(builder, size, marker, ignoreWidget) {",
          "1904:     var widget = !ignoreWidget && marker.widgetNode;",
          "1905:     if (widget) { builder.map.push(builder.pos, builder.pos + size, widget); }",
          "1906:     if (!ignoreWidget && builder.cm.display.input.needsContentAttribute) {",
          "1907:       if (!widget)",
          "1908:         { widget = builder.content.appendChild(document.createElement(\"span\")); }",
          "1909:       widget.setAttribute(\"cm-marker\", marker.id);",
          "1910:     }",
          "1911:     if (widget) {",
          "1912:       builder.cm.display.input.setUneditable(widget);",
          "1913:       builder.content.appendChild(widget);",
          "1914:     }",
          "1915:     builder.pos += size;",
          "1916:     builder.trailingSpace = false;",
          "1917:   }",
          "1921:   function insertLineContent(line, builder, styles) {",
          "1922:     var spans = line.markedSpans, allText = line.text, at = 0;",
          "1923:     if (!spans) {",
          "1924:       for (var i$1 = 1; i$1 < styles.length; i$1+=2)",
          "1925:         { builder.addToken(builder, allText.slice(at, at = styles[i$1]), interpretTokenStyle(styles[i$1+1], builder.cm.options)); }",
          "1926:       return",
          "1927:     }",
          "1929:     var len = allText.length, pos = 0, i = 1, text = \"\", style, css;",
          "1930:     var nextChange = 0, spanStyle, spanEndStyle, spanStartStyle, collapsed, attributes;",
          "1931:     for (;;) {",
          "1932:       if (nextChange == pos) { // Update current marker set",
          "1933:         spanStyle = spanEndStyle = spanStartStyle = css = \"\";",
          "1934:         attributes = null;",
          "1935:         collapsed = null; nextChange = Infinity;",
          "1936:         var foundBookmarks = [], endStyles = (void 0);",
          "1937:         for (var j = 0; j < spans.length; ++j) {",
          "1938:           var sp = spans[j], m = sp.marker;",
          "1939:           if (m.type == \"bookmark\" && sp.from == pos && m.widgetNode) {",
          "1940:             foundBookmarks.push(m);",
          "1941:           } else if (sp.from <= pos && (sp.to == null || sp.to > pos || m.collapsed && sp.to == pos && sp.from == pos)) {",
          "1942:             if (sp.to != null && sp.to != pos && nextChange > sp.to) {",
          "1943:               nextChange = sp.to;",
          "1944:               spanEndStyle = \"\";",
          "1945:             }",
          "1946:             if (m.className) { spanStyle += \" \" + m.className; }",
          "1947:             if (m.css) { css = (css ? css + \";\" : \"\") + m.css; }",
          "1948:             if (m.startStyle && sp.from == pos) { spanStartStyle += \" \" + m.startStyle; }",
          "1949:             if (m.endStyle && sp.to == nextChange) { (endStyles || (endStyles = [])).push(m.endStyle, sp.to); }",
          "1952:             if (m.title) { (attributes || (attributes = {})).title = m.title; }",
          "1953:             if (m.attributes) {",
          "1954:               for (var attr in m.attributes)",
          "1955:                 { (attributes || (attributes = {}))[attr] = m.attributes[attr]; }",
          "1956:             }",
          "1957:             if (m.collapsed && (!collapsed || compareCollapsedMarkers(collapsed.marker, m) < 0))",
          "1958:               { collapsed = sp; }",
          "1959:           } else if (sp.from > pos && nextChange > sp.from) {",
          "1960:             nextChange = sp.from;",
          "1961:           }",
          "1962:         }",
          "1963:         if (endStyles) { for (var j$1 = 0; j$1 < endStyles.length; j$1 += 2)",
          "1964:           { if (endStyles[j$1 + 1] == nextChange) { spanEndStyle += \" \" + endStyles[j$1]; } } }",
          "1966:         if (!collapsed || collapsed.from == pos) { for (var j$2 = 0; j$2 < foundBookmarks.length; ++j$2)",
          "1967:           { buildCollapsedSpan(builder, 0, foundBookmarks[j$2]); } }",
          "1968:         if (collapsed && (collapsed.from || 0) == pos) {",
          "1969:           buildCollapsedSpan(builder, (collapsed.to == null ? len + 1 : collapsed.to) - pos,",
          "1970:                              collapsed.marker, collapsed.from == null);",
          "1971:           if (collapsed.to == null) { return }",
          "1972:           if (collapsed.to == pos) { collapsed = false; }",
          "1973:         }",
          "1974:       }",
          "1975:       if (pos >= len) { break }",
          "1977:       var upto = Math.min(len, nextChange);",
          "1978:       while (true) {",
          "1979:         if (text) {",
          "1980:           var end = pos + text.length;",
          "1981:           if (!collapsed) {",
          "1982:             var tokenText = end > upto ? text.slice(0, upto - pos) : text;",
          "1983:             builder.addToken(builder, tokenText, style ? style + spanStyle : spanStyle,",
          "1984:                              spanStartStyle, pos + tokenText.length == nextChange ? spanEndStyle : \"\", css, attributes);",
          "1985:           }",
          "1986:           if (end >= upto) {text = text.slice(upto - pos); pos = upto; break}",
          "1987:           pos = end;",
          "1988:           spanStartStyle = \"\";",
          "1989:         }",
          "1990:         text = allText.slice(at, at = styles[i++]);",
          "1991:         style = interpretTokenStyle(styles[i++], builder.cm.options);",
          "1992:       }",
          "1993:     }",
          "1994:   }",
          "2000:   function LineView(doc, line, lineN) {",
          "2002:     this.line = line;",
          "2004:     this.rest = visualLineContinued(line);",
          "2006:     this.size = this.rest ? lineNo(lst(this.rest)) - lineN + 1 : 1;",
          "2007:     this.node = this.text = null;",
          "2008:     this.hidden = lineIsHidden(doc, line);",
          "2009:   }",
          "2012:   function buildViewArray(cm, from, to) {",
          "2013:     var array = [], nextPos;",
          "2014:     for (var pos = from; pos < to; pos = nextPos) {",
          "2015:       var view = new LineView(cm.doc, getLine(cm.doc, pos), pos);",
          "2016:       nextPos = pos + view.size;",
          "2017:       array.push(view);",
          "2018:     }",
          "2019:     return array",
          "2020:   }",
          "2022:   var operationGroup = null;",
          "2024:   function pushOperation(op) {",
          "2025:     if (operationGroup) {",
          "2026:       operationGroup.ops.push(op);",
          "2027:     } else {",
          "2028:       op.ownsGroup = operationGroup = {",
          "2029:         ops: [op],",
          "2030:         delayedCallbacks: []",
          "2031:       };",
          "2032:     }",
          "2033:   }",
          "2035:   function fireCallbacksForOps(group) {",
          "2038:     var callbacks = group.delayedCallbacks, i = 0;",
          "2039:     do {",
          "2040:       for (; i < callbacks.length; i++)",
          "2041:         { callbacks[i].call(null); }",
          "2042:       for (var j = 0; j < group.ops.length; j++) {",
          "2043:         var op = group.ops[j];",
          "2044:         if (op.cursorActivityHandlers)",
          "2045:           { while (op.cursorActivityCalled < op.cursorActivityHandlers.length)",
          "2046:             { op.cursorActivityHandlers[op.cursorActivityCalled++].call(null, op.cm); } }",
          "2047:       }",
          "2048:     } while (i < callbacks.length)",
          "2049:   }",
          "2051:   function finishOperation(op, endCb) {",
          "2052:     var group = op.ownsGroup;",
          "2053:     if (!group) { return }",
          "2055:     try { fireCallbacksForOps(group); }",
          "2056:     finally {",
          "2057:       operationGroup = null;",
          "2058:       endCb(group);",
          "2059:     }",
          "2060:   }",
          "2062:   var orphanDelayedCallbacks = null;",
          "2071:   function signalLater(emitter, type /*, values...*/) {",
          "2072:     var arr = getHandlers(emitter, type);",
          "2073:     if (!arr.length) { return }",
          "2074:     var args = Array.prototype.slice.call(arguments, 2), list;",
          "2075:     if (operationGroup) {",
          "2076:       list = operationGroup.delayedCallbacks;",
          "2077:     } else if (orphanDelayedCallbacks) {",
          "2078:       list = orphanDelayedCallbacks;",
          "2079:     } else {",
          "2080:       list = orphanDelayedCallbacks = [];",
          "2081:       setTimeout(fireOrphanDelayed, 0);",
          "2082:     }",
          "2083:     var loop = function ( i ) {",
          "2084:       list.push(function () { return arr[i].apply(null, args); });",
          "2085:     };",
          "2087:     for (var i = 0; i < arr.length; ++i)",
          "2088:       loop( i );",
          "2089:   }",
          "2091:   function fireOrphanDelayed() {",
          "2092:     var delayed = orphanDelayedCallbacks;",
          "2093:     orphanDelayedCallbacks = null;",
          "2094:     for (var i = 0; i < delayed.length; ++i) { delayed[i](); }",
          "2095:   }",
          "2100:   function updateLineForChanges(cm, lineView, lineN, dims) {",
          "2101:     for (var j = 0; j < lineView.changes.length; j++) {",
          "2102:       var type = lineView.changes[j];",
          "2103:       if (type == \"text\") { updateLineText(cm, lineView); }",
          "2104:       else if (type == \"gutter\") { updateLineGutter(cm, lineView, lineN, dims); }",
          "2105:       else if (type == \"class\") { updateLineClasses(cm, lineView); }",
          "2106:       else if (type == \"widget\") { updateLineWidgets(cm, lineView, dims); }",
          "2107:     }",
          "2108:     lineView.changes = null;",
          "2109:   }",
          "2113:   function ensureLineWrapped(lineView) {",
          "2114:     if (lineView.node == lineView.text) {",
          "2115:       lineView.node = elt(\"div\", null, null, \"position: relative\");",
          "2116:       if (lineView.text.parentNode)",
          "2117:         { lineView.text.parentNode.replaceChild(lineView.node, lineView.text); }",
          "2118:       lineView.node.appendChild(lineView.text);",
          "2119:       if (ie && ie_version < 8) { lineView.node.style.zIndex = 2; }",
          "2120:     }",
          "2121:     return lineView.node",
          "2122:   }",
          "2124:   function updateLineBackground(cm, lineView) {",
          "2125:     var cls = lineView.bgClass ? lineView.bgClass + \" \" + (lineView.line.bgClass || \"\") : lineView.line.bgClass;",
          "2126:     if (cls) { cls += \" CodeMirror-linebackground\"; }",
          "2127:     if (lineView.background) {",
          "2128:       if (cls) { lineView.background.className = cls; }",
          "2129:       else { lineView.background.parentNode.removeChild(lineView.background); lineView.background = null; }",
          "2130:     } else if (cls) {",
          "2131:       var wrap = ensureLineWrapped(lineView);",
          "2132:       lineView.background = wrap.insertBefore(elt(\"div\", null, cls), wrap.firstChild);",
          "2133:       cm.display.input.setUneditable(lineView.background);",
          "2134:     }",
          "2135:   }",
          "2139:   function getLineContent(cm, lineView) {",
          "2140:     var ext = cm.display.externalMeasured;",
          "2141:     if (ext && ext.line == lineView.line) {",
          "2142:       cm.display.externalMeasured = null;",
          "2143:       lineView.measure = ext.measure;",
          "2144:       return ext.built",
          "2145:     }",
          "2146:     return buildLineContent(cm, lineView)",
          "2147:   }",
          "2152:   function updateLineText(cm, lineView) {",
          "2153:     var cls = lineView.text.className;",
          "2154:     var built = getLineContent(cm, lineView);",
          "2155:     if (lineView.text == lineView.node) { lineView.node = built.pre; }",
          "2156:     lineView.text.parentNode.replaceChild(built.pre, lineView.text);",
          "2157:     lineView.text = built.pre;",
          "2158:     if (built.bgClass != lineView.bgClass || built.textClass != lineView.textClass) {",
          "2159:       lineView.bgClass = built.bgClass;",
          "2160:       lineView.textClass = built.textClass;",
          "2161:       updateLineClasses(cm, lineView);",
          "2162:     } else if (cls) {",
          "2163:       lineView.text.className = cls;",
          "2164:     }",
          "2165:   }",
          "2167:   function updateLineClasses(cm, lineView) {",
          "2168:     updateLineBackground(cm, lineView);",
          "2169:     if (lineView.line.wrapClass)",
          "2170:       { ensureLineWrapped(lineView).className = lineView.line.wrapClass; }",
          "2171:     else if (lineView.node != lineView.text)",
          "2172:       { lineView.node.className = \"\"; }",
          "2173:     var textClass = lineView.textClass ? lineView.textClass + \" \" + (lineView.line.textClass || \"\") : lineView.line.textClass;",
          "2174:     lineView.text.className = textClass || \"\";",
          "2175:   }",
          "2177:   function updateLineGutter(cm, lineView, lineN, dims) {",
          "2178:     if (lineView.gutter) {",
          "2179:       lineView.node.removeChild(lineView.gutter);",
          "2180:       lineView.gutter = null;",
          "2181:     }",
          "2182:     if (lineView.gutterBackground) {",
          "2183:       lineView.node.removeChild(lineView.gutterBackground);",
          "2184:       lineView.gutterBackground = null;",
          "2185:     }",
          "2186:     if (lineView.line.gutterClass) {",
          "2187:       var wrap = ensureLineWrapped(lineView);",
          "2188:       lineView.gutterBackground = elt(\"div\", null, \"CodeMirror-gutter-background \" + lineView.line.gutterClass,",
          "2189:                                       (\"left: \" + (cm.options.fixedGutter ? dims.fixedPos : -dims.gutterTotalWidth) + \"px; width: \" + (dims.gutterTotalWidth) + \"px\"));",
          "2190:       cm.display.input.setUneditable(lineView.gutterBackground);",
          "2191:       wrap.insertBefore(lineView.gutterBackground, lineView.text);",
          "2192:     }",
          "2193:     var markers = lineView.line.gutterMarkers;",
          "2194:     if (cm.options.lineNumbers || markers) {",
          "2195:       var wrap$1 = ensureLineWrapped(lineView);",
          "2196:       var gutterWrap = lineView.gutter = elt(\"div\", null, \"CodeMirror-gutter-wrapper\", (\"left: \" + (cm.options.fixedGutter ? dims.fixedPos : -dims.gutterTotalWidth) + \"px\"));",
          "2197:       gutterWrap.setAttribute(\"aria-hidden\", \"true\");",
          "2198:       cm.display.input.setUneditable(gutterWrap);",
          "2199:       wrap$1.insertBefore(gutterWrap, lineView.text);",
          "2200:       if (lineView.line.gutterClass)",
          "2201:         { gutterWrap.className += \" \" + lineView.line.gutterClass; }",
          "2202:       if (cm.options.lineNumbers && (!markers || !markers[\"CodeMirror-linenumbers\"]))",
          "2203:         { lineView.lineNumber = gutterWrap.appendChild(",
          "2204:           elt(\"div\", lineNumberFor(cm.options, lineN),",
          "2205:               \"CodeMirror-linenumber CodeMirror-gutter-elt\",",
          "2206:               (\"left: \" + (dims.gutterLeft[\"CodeMirror-linenumbers\"]) + \"px; width: \" + (cm.display.lineNumInnerWidth) + \"px\"))); }",
          "2207:       if (markers) { for (var k = 0; k < cm.display.gutterSpecs.length; ++k) {",
          "2208:         var id = cm.display.gutterSpecs[k].className, found = markers.hasOwnProperty(id) && markers[id];",
          "2209:         if (found)",
          "2210:           { gutterWrap.appendChild(elt(\"div\", [found], \"CodeMirror-gutter-elt\",",
          "2211:                                      (\"left: \" + (dims.gutterLeft[id]) + \"px; width: \" + (dims.gutterWidth[id]) + \"px\"))); }",
          "2212:       } }",
          "2213:     }",
          "2214:   }",
          "2216:   function updateLineWidgets(cm, lineView, dims) {",
          "2217:     if (lineView.alignable) { lineView.alignable = null; }",
          "2218:     var isWidget = classTest(\"CodeMirror-linewidget\");",
          "2219:     for (var node = lineView.node.firstChild, next = (void 0); node; node = next) {",
          "2220:       next = node.nextSibling;",
          "2221:       if (isWidget.test(node.className)) { lineView.node.removeChild(node); }",
          "2222:     }",
          "2223:     insertLineWidgets(cm, lineView, dims);",
          "2224:   }",
          "2227:   function buildLineElement(cm, lineView, lineN, dims) {",
          "2228:     var built = getLineContent(cm, lineView);",
          "2229:     lineView.text = lineView.node = built.pre;",
          "2230:     if (built.bgClass) { lineView.bgClass = built.bgClass; }",
          "2231:     if (built.textClass) { lineView.textClass = built.textClass; }",
          "2233:     updateLineClasses(cm, lineView);",
          "2234:     updateLineGutter(cm, lineView, lineN, dims);",
          "2235:     insertLineWidgets(cm, lineView, dims);",
          "2236:     return lineView.node",
          "2237:   }",
          "2241:   function insertLineWidgets(cm, lineView, dims) {",
          "2242:     insertLineWidgetsFor(cm, lineView.line, lineView, dims, true);",
          "2243:     if (lineView.rest) { for (var i = 0; i < lineView.rest.length; i++)",
          "2244:       { insertLineWidgetsFor(cm, lineView.rest[i], lineView, dims, false); } }",
          "2245:   }",
          "2247:   function insertLineWidgetsFor(cm, line, lineView, dims, allowAbove) {",
          "2248:     if (!line.widgets) { return }",
          "2249:     var wrap = ensureLineWrapped(lineView);",
          "2250:     for (var i = 0, ws = line.widgets; i < ws.length; ++i) {",
          "2251:       var widget = ws[i], node = elt(\"div\", [widget.node], \"CodeMirror-linewidget\" + (widget.className ? \" \" + widget.className : \"\"));",
          "2252:       if (!widget.handleMouseEvents) { node.setAttribute(\"cm-ignore-events\", \"true\"); }",
          "2253:       positionLineWidget(widget, node, lineView, dims);",
          "2254:       cm.display.input.setUneditable(node);",
          "2255:       if (allowAbove && widget.above)",
          "2256:         { wrap.insertBefore(node, lineView.gutter || lineView.text); }",
          "2257:       else",
          "2258:         { wrap.appendChild(node); }",
          "2259:       signalLater(widget, \"redraw\");",
          "2260:     }",
          "2261:   }",
          "2263:   function positionLineWidget(widget, node, lineView, dims) {",
          "2264:     if (widget.noHScroll) {",
          "2265:   (lineView.alignable || (lineView.alignable = [])).push(node);",
          "2266:       var width = dims.wrapperWidth;",
          "2267:       node.style.left = dims.fixedPos + \"px\";",
          "2268:       if (!widget.coverGutter) {",
          "2269:         width -= dims.gutterTotalWidth;",
          "2270:         node.style.paddingLeft = dims.gutterTotalWidth + \"px\";",
          "2271:       }",
          "2272:       node.style.width = width + \"px\";",
          "2273:     }",
          "2274:     if (widget.coverGutter) {",
          "2275:       node.style.zIndex = 5;",
          "2276:       node.style.position = \"relative\";",
          "2277:       if (!widget.noHScroll) { node.style.marginLeft = -dims.gutterTotalWidth + \"px\"; }",
          "2278:     }",
          "2279:   }",
          "2281:   function widgetHeight(widget) {",
          "2282:     if (widget.height != null) { return widget.height }",
          "2283:     var cm = widget.doc.cm;",
          "2284:     if (!cm) { return 0 }",
          "2285:     if (!contains(document.body, widget.node)) {",
          "2286:       var parentStyle = \"position: relative;\";",
          "2287:       if (widget.coverGutter)",
          "2288:         { parentStyle += \"margin-left: -\" + cm.display.gutters.offsetWidth + \"px;\"; }",
          "2289:       if (widget.noHScroll)",
          "2290:         { parentStyle += \"width: \" + cm.display.wrapper.clientWidth + \"px;\"; }",
          "2291:       removeChildrenAndAdd(cm.display.measure, elt(\"div\", [widget.node], null, parentStyle));",
          "2292:     }",
          "2293:     return widget.height = widget.node.parentNode.offsetHeight",
          "2294:   }",
          "2297:   function eventInWidget(display, e) {",
          "2298:     for (var n = e_target(e); n != display.wrapper; n = n.parentNode) {",
          "2299:       if (!n || (n.nodeType == 1 && n.getAttribute(\"cm-ignore-events\") == \"true\") ||",
          "2300:           (n.parentNode == display.sizer && n != display.mover))",
          "2301:         { return true }",
          "2302:     }",
          "2303:   }",
          "2307:   function paddingTop(display) {return display.lineSpace.offsetTop}",
          "2308:   function paddingVert(display) {return display.mover.offsetHeight - display.lineSpace.offsetHeight}",
          "2309:   function paddingH(display) {",
          "2310:     if (display.cachedPaddingH) { return display.cachedPaddingH }",
          "2311:     var e = removeChildrenAndAdd(display.measure, elt(\"pre\", \"x\", \"CodeMirror-line-like\"));",
          "2312:     var style = window.getComputedStyle ? window.getComputedStyle(e) : e.currentStyle;",
          "2313:     var data = {left: parseInt(style.paddingLeft), right: parseInt(style.paddingRight)};",
          "2314:     if (!isNaN(data.left) && !isNaN(data.right)) { display.cachedPaddingH = data; }",
          "2315:     return data",
          "2316:   }",
          "2318:   function scrollGap(cm) { return scrollerGap - cm.display.nativeBarWidth }",
          "2319:   function displayWidth(cm) {",
          "2320:     return cm.display.scroller.clientWidth - scrollGap(cm) - cm.display.barWidth",
          "2321:   }",
          "2322:   function displayHeight(cm) {",
          "2323:     return cm.display.scroller.clientHeight - scrollGap(cm) - cm.display.barHeight",
          "2324:   }",
          "2330:   function ensureLineHeights(cm, lineView, rect) {",
          "2331:     var wrapping = cm.options.lineWrapping;",
          "2332:     var curWidth = wrapping && displayWidth(cm);",
          "2333:     if (!lineView.measure.heights || wrapping && lineView.measure.width != curWidth) {",
          "2334:       var heights = lineView.measure.heights = [];",
          "2335:       if (wrapping) {",
          "2336:         lineView.measure.width = curWidth;",
          "2337:         var rects = lineView.text.firstChild.getClientRects();",
          "2338:         for (var i = 0; i < rects.length - 1; i++) {",
          "2339:           var cur = rects[i], next = rects[i + 1];",
          "2340:           if (Math.abs(cur.bottom - next.bottom) > 2)",
          "2341:             { heights.push((cur.bottom + next.top) / 2 - rect.top); }",
          "2342:         }",
          "2343:       }",
          "2344:       heights.push(rect.bottom - rect.top);",
          "2345:     }",
          "2346:   }",
          "2351:   function mapFromLineView(lineView, line, lineN) {",
          "2352:     if (lineView.line == line)",
          "2353:       { return {map: lineView.measure.map, cache: lineView.measure.cache} }",
          "2354:     for (var i = 0; i < lineView.rest.length; i++)",
          "2355:       { if (lineView.rest[i] == line)",
          "2356:         { return {map: lineView.measure.maps[i], cache: lineView.measure.caches[i]} } }",
          "2357:     for (var i$1 = 0; i$1 < lineView.rest.length; i$1++)",
          "2358:       { if (lineNo(lineView.rest[i$1]) > lineN)",
          "2359:         { return {map: lineView.measure.maps[i$1], cache: lineView.measure.caches[i$1], before: true} } }",
          "2360:   }",
          "2364:   function updateExternalMeasurement(cm, line) {",
          "2365:     line = visualLine(line);",
          "2366:     var lineN = lineNo(line);",
          "2367:     var view = cm.display.externalMeasured = new LineView(cm.doc, line, lineN);",
          "2368:     view.lineN = lineN;",
          "2369:     var built = view.built = buildLineContent(cm, view);",
          "2370:     view.text = built.pre;",
          "2371:     removeChildrenAndAdd(cm.display.lineMeasure, built.pre);",
          "2372:     return view",
          "2373:   }",
          "2377:   function measureChar(cm, line, ch, bias) {",
          "2378:     return measureCharPrepared(cm, prepareMeasureForLine(cm, line), ch, bias)",
          "2379:   }",
          "2382:   function findViewForLine(cm, lineN) {",
          "2383:     if (lineN >= cm.display.viewFrom && lineN < cm.display.viewTo)",
          "2384:       { return cm.display.view[findViewIndex(cm, lineN)] }",
          "2385:     var ext = cm.display.externalMeasured;",
          "2386:     if (ext && lineN >= ext.lineN && lineN < ext.lineN + ext.size)",
          "2387:       { return ext }",
          "2388:   }",
          "2395:   function prepareMeasureForLine(cm, line) {",
          "2396:     var lineN = lineNo(line);",
          "2397:     var view = findViewForLine(cm, lineN);",
          "2398:     if (view && !view.text) {",
          "2399:       view = null;",
          "2400:     } else if (view && view.changes) {",
          "2401:       updateLineForChanges(cm, view, lineN, getDimensions(cm));",
          "2402:       cm.curOp.forceUpdate = true;",
          "2403:     }",
          "2404:     if (!view)",
          "2405:       { view = updateExternalMeasurement(cm, line); }",
          "2407:     var info = mapFromLineView(view, line, lineN);",
          "2408:     return {",
          "2409:       line: line, view: view, rect: null,",
          "2410:       map: info.map, cache: info.cache, before: info.before,",
          "2411:       hasHeights: false",
          "2412:     }",
          "2413:   }",
          "2417:   function measureCharPrepared(cm, prepared, ch, bias, varHeight) {",
          "2418:     if (prepared.before) { ch = -1; }",
          "2419:     var key = ch + (bias || \"\"), found;",
          "2420:     if (prepared.cache.hasOwnProperty(key)) {",
          "2421:       found = prepared.cache[key];",
          "2422:     } else {",
          "2423:       if (!prepared.rect)",
          "2424:         { prepared.rect = prepared.view.text.getBoundingClientRect(); }",
          "2425:       if (!prepared.hasHeights) {",
          "2426:         ensureLineHeights(cm, prepared.view, prepared.rect);",
          "2427:         prepared.hasHeights = true;",
          "2428:       }",
          "2429:       found = measureCharInner(cm, prepared, ch, bias);",
          "2430:       if (!found.bogus) { prepared.cache[key] = found; }",
          "2431:     }",
          "2432:     return {left: found.left, right: found.right,",
          "2433:             top: varHeight ? found.rtop : found.top,",
          "2434:             bottom: varHeight ? found.rbottom : found.bottom}",
          "2435:   }",
          "2437:   var nullRect = {left: 0, right: 0, top: 0, bottom: 0};",
          "2439:   function nodeAndOffsetInLineMap(map, ch, bias) {",
          "2440:     var node, start, end, collapse, mStart, mEnd;",
          "2443:     for (var i = 0; i < map.length; i += 3) {",
          "2444:       mStart = map[i];",
          "2445:       mEnd = map[i + 1];",
          "2446:       if (ch < mStart) {",
          "2447:         start = 0; end = 1;",
          "2448:         collapse = \"left\";",
          "2449:       } else if (ch < mEnd) {",
          "2450:         start = ch - mStart;",
          "2451:         end = start + 1;",
          "2452:       } else if (i == map.length - 3 || ch == mEnd && map[i + 3] > ch) {",
          "2453:         end = mEnd - mStart;",
          "2454:         start = end - 1;",
          "2455:         if (ch >= mEnd) { collapse = \"right\"; }",
          "2456:       }",
          "2457:       if (start != null) {",
          "2458:         node = map[i + 2];",
          "2459:         if (mStart == mEnd && bias == (node.insertLeft ? \"left\" : \"right\"))",
          "2460:           { collapse = bias; }",
          "2461:         if (bias == \"left\" && start == 0)",
          "2462:           { while (i && map[i - 2] == map[i - 3] && map[i - 1].insertLeft) {",
          "2463:             node = map[(i -= 3) + 2];",
          "2464:             collapse = \"left\";",
          "2465:           } }",
          "2466:         if (bias == \"right\" && start == mEnd - mStart)",
          "2467:           { while (i < map.length - 3 && map[i + 3] == map[i + 4] && !map[i + 5].insertLeft) {",
          "2468:             node = map[(i += 3) + 2];",
          "2469:             collapse = \"right\";",
          "2470:           } }",
          "2471:         break",
          "2472:       }",
          "2473:     }",
          "2474:     return {node: node, start: start, end: end, collapse: collapse, coverStart: mStart, coverEnd: mEnd}",
          "2475:   }",
          "2477:   function getUsefulRect(rects, bias) {",
          "2478:     var rect = nullRect;",
          "2479:     if (bias == \"left\") { for (var i = 0; i < rects.length; i++) {",
          "2480:       if ((rect = rects[i]).left != rect.right) { break }",
          "2481:     } } else { for (var i$1 = rects.length - 1; i$1 >= 0; i$1--) {",
          "2482:       if ((rect = rects[i$1]).left != rect.right) { break }",
          "2483:     } }",
          "2484:     return rect",
          "2485:   }",
          "2487:   function measureCharInner(cm, prepared, ch, bias) {",
          "2488:     var place = nodeAndOffsetInLineMap(prepared.map, ch, bias);",
          "2489:     var node = place.node, start = place.start, end = place.end, collapse = place.collapse;",
          "2491:     var rect;",
          "2492:     if (node.nodeType == 3) { // If it is a text node, use a range to retrieve the coordinates.",
          "2493:       for (var i$1 = 0; i$1 < 4; i$1++) { // Retry a maximum of 4 times when nonsense rectangles are returned",
          "2494:         while (start && isExtendingChar(prepared.line.text.charAt(place.coverStart + start))) { --start; }",
          "2495:         while (place.coverStart + end < place.coverEnd && isExtendingChar(prepared.line.text.charAt(place.coverStart + end))) { ++end; }",
          "2496:         if (ie && ie_version < 9 && start == 0 && end == place.coverEnd - place.coverStart)",
          "2497:           { rect = node.parentNode.getBoundingClientRect(); }",
          "2498:         else",
          "2499:           { rect = getUsefulRect(range(node, start, end).getClientRects(), bias); }",
          "2500:         if (rect.left || rect.right || start == 0) { break }",
          "2501:         end = start;",
          "2502:         start = start - 1;",
          "2503:         collapse = \"right\";",
          "2504:       }",
          "2505:       if (ie && ie_version < 11) { rect = maybeUpdateRectForZooming(cm.display.measure, rect); }",
          "2506:     } else { // If it is a widget, simply get the box for the whole widget.",
          "2507:       if (start > 0) { collapse = bias = \"right\"; }",
          "2508:       var rects;",
          "2509:       if (cm.options.lineWrapping && (rects = node.getClientRects()).length > 1)",
          "2510:         { rect = rects[bias == \"right\" ? rects.length - 1 : 0]; }",
          "2511:       else",
          "2512:         { rect = node.getBoundingClientRect(); }",
          "2513:     }",
          "2514:     if (ie && ie_version < 9 && !start && (!rect || !rect.left && !rect.right)) {",
          "2515:       var rSpan = node.parentNode.getClientRects()[0];",
          "2516:       if (rSpan)",
          "2517:         { rect = {left: rSpan.left, right: rSpan.left + charWidth(cm.display), top: rSpan.top, bottom: rSpan.bottom}; }",
          "2518:       else",
          "2519:         { rect = nullRect; }",
          "2520:     }",
          "2522:     var rtop = rect.top - prepared.rect.top, rbot = rect.bottom - prepared.rect.top;",
          "2523:     var mid = (rtop + rbot) / 2;",
          "2524:     var heights = prepared.view.measure.heights;",
          "2525:     var i = 0;",
          "2526:     for (; i < heights.length - 1; i++)",
          "2527:       { if (mid < heights[i]) { break } }",
          "2528:     var top = i ? heights[i - 1] : 0, bot = heights[i];",
          "2529:     var result = {left: (collapse == \"right\" ? rect.right : rect.left) - prepared.rect.left,",
          "2530:                   right: (collapse == \"left\" ? rect.left : rect.right) - prepared.rect.left,",
          "2531:                   top: top, bottom: bot};",
          "2532:     if (!rect.left && !rect.right) { result.bogus = true; }",
          "2533:     if (!cm.options.singleCursorHeightPerLine) { result.rtop = rtop; result.rbottom = rbot; }",
          "2535:     return result",
          "2536:   }",
          "2540:   function maybeUpdateRectForZooming(measure, rect) {",
          "2541:     if (!window.screen || screen.logicalXDPI == null ||",
          "2542:         screen.logicalXDPI == screen.deviceXDPI || !hasBadZoomedRects(measure))",
          "2543:       { return rect }",
          "2544:     var scaleX = screen.logicalXDPI / screen.deviceXDPI;",
          "2545:     var scaleY = screen.logicalYDPI / screen.deviceYDPI;",
          "2546:     return {left: rect.left * scaleX, right: rect.right * scaleX,",
          "2547:             top: rect.top * scaleY, bottom: rect.bottom * scaleY}",
          "2548:   }",
          "2550:   function clearLineMeasurementCacheFor(lineView) {",
          "2551:     if (lineView.measure) {",
          "2552:       lineView.measure.cache = {};",
          "2553:       lineView.measure.heights = null;",
          "2554:       if (lineView.rest) { for (var i = 0; i < lineView.rest.length; i++)",
          "2555:         { lineView.measure.caches[i] = {}; } }",
          "2556:     }",
          "2557:   }",
          "2559:   function clearLineMeasurementCache(cm) {",
          "2560:     cm.display.externalMeasure = null;",
          "2561:     removeChildren(cm.display.lineMeasure);",
          "2562:     for (var i = 0; i < cm.display.view.length; i++)",
          "2563:       { clearLineMeasurementCacheFor(cm.display.view[i]); }",
          "2564:   }",
          "2566:   function clearCaches(cm) {",
          "2567:     clearLineMeasurementCache(cm);",
          "2568:     cm.display.cachedCharWidth = cm.display.cachedTextHeight = cm.display.cachedPaddingH = null;",
          "2569:     if (!cm.options.lineWrapping) { cm.display.maxLineChanged = true; }",
          "2570:     cm.display.lineNumChars = null;",
          "2571:   }",
          "2573:   function pageScrollX() {",
          "2577:     if (chrome && android) { return -(document.body.getBoundingClientRect().left - parseInt(getComputedStyle(document.body).marginLeft)) }",
          "2578:     return window.pageXOffset || (document.documentElement || document.body).scrollLeft",
          "2579:   }",
          "2580:   function pageScrollY() {",
          "2581:     if (chrome && android) { return -(document.body.getBoundingClientRect().top - parseInt(getComputedStyle(document.body).marginTop)) }",
          "2582:     return window.pageYOffset || (document.documentElement || document.body).scrollTop",
          "2583:   }",
          "2585:   function widgetTopHeight(lineObj) {",
          "2586:     var height = 0;",
          "2587:     if (lineObj.widgets) { for (var i = 0; i < lineObj.widgets.length; ++i) { if (lineObj.widgets[i].above)",
          "2588:       { height += widgetHeight(lineObj.widgets[i]); } } }",
          "2589:     return height",
          "2590:   }",
          "2596:   function intoCoordSystem(cm, lineObj, rect, context, includeWidgets) {",
          "2597:     if (!includeWidgets) {",
          "2598:       var height = widgetTopHeight(lineObj);",
          "2599:       rect.top += height; rect.bottom += height;",
          "2600:     }",
          "2601:     if (context == \"line\") { return rect }",
          "2602:     if (!context) { context = \"local\"; }",
          "2603:     var yOff = heightAtLine(lineObj);",
          "2604:     if (context == \"local\") { yOff += paddingTop(cm.display); }",
          "2605:     else { yOff -= cm.display.viewOffset; }",
          "2606:     if (context == \"page\" || context == \"window\") {",
          "2607:       var lOff = cm.display.lineSpace.getBoundingClientRect();",
          "2608:       yOff += lOff.top + (context == \"window\" ? 0 : pageScrollY());",
          "2609:       var xOff = lOff.left + (context == \"window\" ? 0 : pageScrollX());",
          "2610:       rect.left += xOff; rect.right += xOff;",
          "2611:     }",
          "2612:     rect.top += yOff; rect.bottom += yOff;",
          "2613:     return rect",
          "2614:   }",
          "2618:   function fromCoordSystem(cm, coords, context) {",
          "2619:     if (context == \"div\") { return coords }",
          "2620:     var left = coords.left, top = coords.top;",
          "2622:     if (context == \"page\") {",
          "2623:       left -= pageScrollX();",
          "2624:       top -= pageScrollY();",
          "2625:     } else if (context == \"local\" || !context) {",
          "2626:       var localBox = cm.display.sizer.getBoundingClientRect();",
          "2627:       left += localBox.left;",
          "2628:       top += localBox.top;",
          "2629:     }",
          "2631:     var lineSpaceBox = cm.display.lineSpace.getBoundingClientRect();",
          "2632:     return {left: left - lineSpaceBox.left, top: top - lineSpaceBox.top}",
          "2633:   }",
          "2635:   function charCoords(cm, pos, context, lineObj, bias) {",
          "2636:     if (!lineObj) { lineObj = getLine(cm.doc, pos.line); }",
          "2637:     return intoCoordSystem(cm, lineObj, measureChar(cm, lineObj, pos.ch, bias), context)",
          "2638:   }",
          "2656:   function cursorCoords(cm, pos, context, lineObj, preparedMeasure, varHeight) {",
          "2657:     lineObj = lineObj || getLine(cm.doc, pos.line);",
          "2658:     if (!preparedMeasure) { preparedMeasure = prepareMeasureForLine(cm, lineObj); }",
          "2659:     function get(ch, right) {",
          "2660:       var m = measureCharPrepared(cm, preparedMeasure, ch, right ? \"right\" : \"left\", varHeight);",
          "2661:       if (right) { m.left = m.right; } else { m.right = m.left; }",
          "2662:       return intoCoordSystem(cm, lineObj, m, context)",
          "2663:     }",
          "2664:     var order = getOrder(lineObj, cm.doc.direction), ch = pos.ch, sticky = pos.sticky;",
          "2665:     if (ch >= lineObj.text.length) {",
          "2666:       ch = lineObj.text.length;",
          "2667:       sticky = \"before\";",
          "2668:     } else if (ch <= 0) {",
          "2669:       ch = 0;",
          "2670:       sticky = \"after\";",
          "2671:     }",
          "2672:     if (!order) { return get(sticky == \"before\" ? ch - 1 : ch, sticky == \"before\") }",
          "2674:     function getBidi(ch, partPos, invert) {",
          "2675:       var part = order[partPos], right = part.level == 1;",
          "2676:       return get(invert ? ch - 1 : ch, right != invert)",
          "2677:     }",
          "2678:     var partPos = getBidiPartAt(order, ch, sticky);",
          "2679:     var other = bidiOther;",
          "2680:     var val = getBidi(ch, partPos, sticky == \"before\");",
          "2681:     if (other != null) { val.other = getBidi(ch, other, sticky != \"before\"); }",
          "2682:     return val",
          "2683:   }",
          "2687:   function estimateCoords(cm, pos) {",
          "2688:     var left = 0;",
          "2689:     pos = clipPos(cm.doc, pos);",
          "2690:     if (!cm.options.lineWrapping) { left = charWidth(cm.display) * pos.ch; }",
          "2691:     var lineObj = getLine(cm.doc, pos.line);",
          "2692:     var top = heightAtLine(lineObj) + paddingTop(cm.display);",
          "2693:     return {left: left, right: left, top: top, bottom: top + lineObj.height}",
          "2694:   }",
          "2702:   function PosWithInfo(line, ch, sticky, outside, xRel) {",
          "2703:     var pos = Pos(line, ch, sticky);",
          "2704:     pos.xRel = xRel;",
          "2705:     if (outside) { pos.outside = outside; }",
          "2706:     return pos",
          "2707:   }",
          "2711:   function coordsChar(cm, x, y) {",
          "2712:     var doc = cm.doc;",
          "2713:     y += cm.display.viewOffset;",
          "2714:     if (y < 0) { return PosWithInfo(doc.first, 0, null, -1, -1) }",
          "2715:     var lineN = lineAtHeight(doc, y), last = doc.first + doc.size - 1;",
          "2716:     if (lineN > last)",
          "2717:       { return PosWithInfo(doc.first + doc.size - 1, getLine(doc, last).text.length, null, 1, 1) }",
          "2718:     if (x < 0) { x = 0; }",
          "2720:     var lineObj = getLine(doc, lineN);",
          "2721:     for (;;) {",
          "2722:       var found = coordsCharInner(cm, lineObj, lineN, x, y);",
          "2723:       var collapsed = collapsedSpanAround(lineObj, found.ch + (found.xRel > 0 || found.outside > 0 ? 1 : 0));",
          "2724:       if (!collapsed) { return found }",
          "2725:       var rangeEnd = collapsed.find(1);",
          "2726:       if (rangeEnd.line == lineN) { return rangeEnd }",
          "2727:       lineObj = getLine(doc, lineN = rangeEnd.line);",
          "2728:     }",
          "2729:   }",
          "2731:   function wrappedLineExtent(cm, lineObj, preparedMeasure, y) {",
          "2732:     y -= widgetTopHeight(lineObj);",
          "2733:     var end = lineObj.text.length;",
          "2734:     var begin = findFirst(function (ch) { return measureCharPrepared(cm, preparedMeasure, ch - 1).bottom <= y; }, end, 0);",
          "2735:     end = findFirst(function (ch) { return measureCharPrepared(cm, preparedMeasure, ch).top > y; }, begin, end);",
          "2736:     return {begin: begin, end: end}",
          "2737:   }",
          "2739:   function wrappedLineExtentChar(cm, lineObj, preparedMeasure, target) {",
          "2740:     if (!preparedMeasure) { preparedMeasure = prepareMeasureForLine(cm, lineObj); }",
          "2741:     var targetTop = intoCoordSystem(cm, lineObj, measureCharPrepared(cm, preparedMeasure, target), \"line\").top;",
          "2742:     return wrappedLineExtent(cm, lineObj, preparedMeasure, targetTop)",
          "2743:   }",
          "2747:   function boxIsAfter(box, x, y, left) {",
          "2748:     return box.bottom <= y ? false : box.top > y ? true : (left ? box.left : box.right) > x",
          "2749:   }",
          "2751:   function coordsCharInner(cm, lineObj, lineNo, x, y) {",
          "2753:     y -= heightAtLine(lineObj);",
          "2754:     var preparedMeasure = prepareMeasureForLine(cm, lineObj);",
          "2757:     var widgetHeight = widgetTopHeight(lineObj);",
          "2758:     var begin = 0, end = lineObj.text.length, ltr = true;",
          "2760:     var order = getOrder(lineObj, cm.doc.direction);",
          "2763:     if (order) {",
          "2764:       var part = (cm.options.lineWrapping ? coordsBidiPartWrapped : coordsBidiPart)",
          "2765:                    (cm, lineObj, lineNo, preparedMeasure, order, x, y);",
          "2766:       ltr = part.level != 1;",
          "2771:       begin = ltr ? part.from : part.to - 1;",
          "2772:       end = ltr ? part.to : part.from - 1;",
          "2773:     }",
          "2778:     var chAround = null, boxAround = null;",
          "2779:     var ch = findFirst(function (ch) {",
          "2780:       var box = measureCharPrepared(cm, preparedMeasure, ch);",
          "2781:       box.top += widgetHeight; box.bottom += widgetHeight;",
          "2782:       if (!boxIsAfter(box, x, y, false)) { return false }",
          "2783:       if (box.top <= y && box.left <= x) {",
          "2784:         chAround = ch;",
          "2785:         boxAround = box;",
          "2786:       }",
          "2787:       return true",
          "2788:     }, begin, end);",
          "2790:     var baseX, sticky, outside = false;",
          "2792:     if (boxAround) {",
          "2794:       var atLeft = x - boxAround.left < boxAround.right - x, atStart = atLeft == ltr;",
          "2795:       ch = chAround + (atStart ? 0 : 1);",
          "2796:       sticky = atStart ? \"after\" : \"before\";",
          "2797:       baseX = atLeft ? boxAround.left : boxAround.right;",
          "2798:     } else {",
          "2800:       if (!ltr && (ch == end || ch == begin)) { ch++; }",
          "2804:       sticky = ch == 0 ? \"after\" : ch == lineObj.text.length ? \"before\" :",
          "2805:         (measureCharPrepared(cm, preparedMeasure, ch - (ltr ? 1 : 0)).bottom + widgetHeight <= y) == ltr ?",
          "2806:         \"after\" : \"before\";",
          "2809:       var coords = cursorCoords(cm, Pos(lineNo, ch, sticky), \"line\", lineObj, preparedMeasure);",
          "2810:       baseX = coords.left;",
          "2811:       outside = y < coords.top ? -1 : y >= coords.bottom ? 1 : 0;",
          "2812:     }",
          "2814:     ch = skipExtendingChars(lineObj.text, ch, 1);",
          "2815:     return PosWithInfo(lineNo, ch, sticky, outside, x - baseX)",
          "2816:   }",
          "2818:   function coordsBidiPart(cm, lineObj, lineNo, preparedMeasure, order, x, y) {",
          "2823:     var index = findFirst(function (i) {",
          "2824:       var part = order[i], ltr = part.level != 1;",
          "2825:       return boxIsAfter(cursorCoords(cm, Pos(lineNo, ltr ? part.to : part.from, ltr ? \"before\" : \"after\"),",
          "2826:                                      \"line\", lineObj, preparedMeasure), x, y, true)",
          "2827:     }, 0, order.length - 1);",
          "2828:     var part = order[index];",
          "2832:     if (index > 0) {",
          "2833:       var ltr = part.level != 1;",
          "2834:       var start = cursorCoords(cm, Pos(lineNo, ltr ? part.from : part.to, ltr ? \"after\" : \"before\"),",
          "2835:                                \"line\", lineObj, preparedMeasure);",
          "2836:       if (boxIsAfter(start, x, y, true) && start.top > y)",
          "2837:         { part = order[index - 1]; }",
          "2838:     }",
          "2839:     return part",
          "2840:   }",
          "2842:   function coordsBidiPartWrapped(cm, lineObj, _lineNo, preparedMeasure, order, x, y) {",
          "2850:     var ref = wrappedLineExtent(cm, lineObj, preparedMeasure, y);",
          "2851:     var begin = ref.begin;",
          "2852:     var end = ref.end;",
          "2853:     if (/\\s/.test(lineObj.text.charAt(end - 1))) { end--; }",
          "2854:     var part = null, closestDist = null;",
          "2855:     for (var i = 0; i < order.length; i++) {",
          "2856:       var p = order[i];",
          "2857:       if (p.from >= end || p.to <= begin) { continue }",
          "2858:       var ltr = p.level != 1;",
          "2859:       var endX = measureCharPrepared(cm, preparedMeasure, ltr ? Math.min(end, p.to) - 1 : Math.max(begin, p.from)).right;",
          "2862:       var dist = endX < x ? x - endX + 1e9 : endX - x;",
          "2863:       if (!part || closestDist > dist) {",
          "2864:         part = p;",
          "2865:         closestDist = dist;",
          "2866:       }",
          "2867:     }",
          "2868:     if (!part) { part = order[order.length - 1]; }",
          "2870:     if (part.from < begin) { part = {from: begin, to: part.to, level: part.level}; }",
          "2871:     if (part.to > end) { part = {from: part.from, to: end, level: part.level}; }",
          "2872:     return part",
          "2873:   }",
          "2875:   var measureText;",
          "2877:   function textHeight(display) {",
          "2878:     if (display.cachedTextHeight != null) { return display.cachedTextHeight }",
          "2879:     if (measureText == null) {",
          "2880:       measureText = elt(\"pre\", null, \"CodeMirror-line-like\");",
          "2883:       for (var i = 0; i < 49; ++i) {",
          "2884:         measureText.appendChild(document.createTextNode(\"x\"));",
          "2885:         measureText.appendChild(elt(\"br\"));",
          "2886:       }",
          "2887:       measureText.appendChild(document.createTextNode(\"x\"));",
          "2888:     }",
          "2889:     removeChildrenAndAdd(display.measure, measureText);",
          "2890:     var height = measureText.offsetHeight / 50;",
          "2891:     if (height > 3) { display.cachedTextHeight = height; }",
          "2892:     removeChildren(display.measure);",
          "2893:     return height || 1",
          "2894:   }",
          "2897:   function charWidth(display) {",
          "2898:     if (display.cachedCharWidth != null) { return display.cachedCharWidth }",
          "2899:     var anchor = elt(\"span\", \"xxxxxxxxxx\");",
          "2900:     var pre = elt(\"pre\", [anchor], \"CodeMirror-line-like\");",
          "2901:     removeChildrenAndAdd(display.measure, pre);",
          "2902:     var rect = anchor.getBoundingClientRect(), width = (rect.right - rect.left) / 10;",
          "2903:     if (width > 2) { display.cachedCharWidth = width; }",
          "2904:     return width || 10",
          "2905:   }",
          "2909:   function getDimensions(cm) {",
          "2910:     var d = cm.display, left = {}, width = {};",
          "2911:     var gutterLeft = d.gutters.clientLeft;",
          "2912:     for (var n = d.gutters.firstChild, i = 0; n; n = n.nextSibling, ++i) {",
          "2913:       var id = cm.display.gutterSpecs[i].className;",
          "2914:       left[id] = n.offsetLeft + n.clientLeft + gutterLeft;",
          "2915:       width[id] = n.clientWidth;",
          "2916:     }",
          "2917:     return {fixedPos: compensateForHScroll(d),",
          "2918:             gutterTotalWidth: d.gutters.offsetWidth,",
          "2919:             gutterLeft: left,",
          "2920:             gutterWidth: width,",
          "2921:             wrapperWidth: d.wrapper.clientWidth}",
          "2922:   }",
          "2927:   function compensateForHScroll(display) {",
          "2928:     return display.scroller.getBoundingClientRect().left - display.sizer.getBoundingClientRect().left",
          "2929:   }",
          "2934:   function estimateHeight(cm) {",
          "2935:     var th = textHeight(cm.display), wrapping = cm.options.lineWrapping;",
          "2936:     var perLine = wrapping && Math.max(5, cm.display.scroller.clientWidth / charWidth(cm.display) - 3);",
          "2937:     return function (line) {",
          "2938:       if (lineIsHidden(cm.doc, line)) { return 0 }",
          "2940:       var widgetsHeight = 0;",
          "2941:       if (line.widgets) { for (var i = 0; i < line.widgets.length; i++) {",
          "2942:         if (line.widgets[i].height) { widgetsHeight += line.widgets[i].height; }",
          "2943:       } }",
          "2945:       if (wrapping)",
          "2946:         { return widgetsHeight + (Math.ceil(line.text.length / perLine) || 1) * th }",
          "2947:       else",
          "2948:         { return widgetsHeight + th }",
          "2949:     }",
          "2950:   }",
          "2952:   function estimateLineHeights(cm) {",
          "2953:     var doc = cm.doc, est = estimateHeight(cm);",
          "2954:     doc.iter(function (line) {",
          "2955:       var estHeight = est(line);",
          "2956:       if (estHeight != line.height) { updateLineHeight(line, estHeight); }",
          "2957:     });",
          "2958:   }",
          "2965:   function posFromMouse(cm, e, liberal, forRect) {",
          "2966:     var display = cm.display;",
          "2967:     if (!liberal && e_target(e).getAttribute(\"cm-not-content\") == \"true\") { return null }",
          "2969:     var x, y, space = display.lineSpace.getBoundingClientRect();",
          "2971:     try { x = e.clientX - space.left; y = e.clientY - space.top; }",
          "2972:     catch (e$1) { return null }",
          "2973:     var coords = coordsChar(cm, x, y), line;",
          "2974:     if (forRect && coords.xRel > 0 && (line = getLine(cm.doc, coords.line).text).length == coords.ch) {",
          "2975:       var colDiff = countColumn(line, line.length, cm.options.tabSize) - line.length;",
          "2976:       coords = Pos(coords.line, Math.max(0, Math.round((x - paddingH(cm.display).left) / charWidth(cm.display)) - colDiff));",
          "2977:     }",
          "2978:     return coords",
          "2979:   }",
          "2983:   function findViewIndex(cm, n) {",
          "2984:     if (n >= cm.display.viewTo) { return null }",
          "2985:     n -= cm.display.viewFrom;",
          "2986:     if (n < 0) { return null }",
          "2987:     var view = cm.display.view;",
          "2988:     for (var i = 0; i < view.length; i++) {",
          "2989:       n -= view[i].size;",
          "2990:       if (n < 0) { return i }",
          "2991:     }",
          "2992:   }",
          "3000:   function regChange(cm, from, to, lendiff) {",
          "3001:     if (from == null) { from = cm.doc.first; }",
          "3002:     if (to == null) { to = cm.doc.first + cm.doc.size; }",
          "3003:     if (!lendiff) { lendiff = 0; }",
          "3005:     var display = cm.display;",
          "3006:     if (lendiff && to < display.viewTo &&",
          "3007:         (display.updateLineNumbers == null || display.updateLineNumbers > from))",
          "3008:       { display.updateLineNumbers = from; }",
          "3010:     cm.curOp.viewChanged = true;",
          "3012:     if (from >= display.viewTo) { // Change after",
          "3013:       if (sawCollapsedSpans && visualLineNo(cm.doc, from) < display.viewTo)",
          "3014:         { resetView(cm); }",
          "3015:     } else if (to <= display.viewFrom) { // Change before",
          "3016:       if (sawCollapsedSpans && visualLineEndNo(cm.doc, to + lendiff) > display.viewFrom) {",
          "3017:         resetView(cm);",
          "3018:       } else {",
          "3019:         display.viewFrom += lendiff;",
          "3020:         display.viewTo += lendiff;",
          "3021:       }",
          "3022:     } else if (from <= display.viewFrom && to >= display.viewTo) { // Full overlap",
          "3023:       resetView(cm);",
          "3024:     } else if (from <= display.viewFrom) { // Top overlap",
          "3025:       var cut = viewCuttingPoint(cm, to, to + lendiff, 1);",
          "3026:       if (cut) {",
          "3027:         display.view = display.view.slice(cut.index);",
          "3028:         display.viewFrom = cut.lineN;",
          "3029:         display.viewTo += lendiff;",
          "3030:       } else {",
          "3031:         resetView(cm);",
          "3032:       }",
          "3033:     } else if (to >= display.viewTo) { // Bottom overlap",
          "3034:       var cut$1 = viewCuttingPoint(cm, from, from, -1);",
          "3035:       if (cut$1) {",
          "3036:         display.view = display.view.slice(0, cut$1.index);",
          "3037:         display.viewTo = cut$1.lineN;",
          "3038:       } else {",
          "3039:         resetView(cm);",
          "3040:       }",
          "3041:     } else { // Gap in the middle",
          "3042:       var cutTop = viewCuttingPoint(cm, from, from, -1);",
          "3043:       var cutBot = viewCuttingPoint(cm, to, to + lendiff, 1);",
          "3044:       if (cutTop && cutBot) {",
          "3045:         display.view = display.view.slice(0, cutTop.index)",
          "3046:           .concat(buildViewArray(cm, cutTop.lineN, cutBot.lineN))",
          "3047:           .concat(display.view.slice(cutBot.index));",
          "3048:         display.viewTo += lendiff;",
          "3049:       } else {",
          "3050:         resetView(cm);",
          "3051:       }",
          "3052:     }",
          "3054:     var ext = display.externalMeasured;",
          "3055:     if (ext) {",
          "3056:       if (to < ext.lineN)",
          "3057:         { ext.lineN += lendiff; }",
          "3058:       else if (from < ext.lineN + ext.size)",
          "3059:         { display.externalMeasured = null; }",
          "3060:     }",
          "3061:   }",
          "3065:   function regLineChange(cm, line, type) {",
          "3066:     cm.curOp.viewChanged = true;",
          "3067:     var display = cm.display, ext = cm.display.externalMeasured;",
          "3068:     if (ext && line >= ext.lineN && line < ext.lineN + ext.size)",
          "3069:       { display.externalMeasured = null; }",
          "3071:     if (line < display.viewFrom || line >= display.viewTo) { return }",
          "3072:     var lineView = display.view[findViewIndex(cm, line)];",
          "3073:     if (lineView.node == null) { return }",
          "3074:     var arr = lineView.changes || (lineView.changes = []);",
          "3075:     if (indexOf(arr, type) == -1) { arr.push(type); }",
          "3076:   }",
          "3079:   function resetView(cm) {",
          "3080:     cm.display.viewFrom = cm.display.viewTo = cm.doc.first;",
          "3081:     cm.display.view = [];",
          "3082:     cm.display.viewOffset = 0;",
          "3083:   }",
          "3085:   function viewCuttingPoint(cm, oldN, newN, dir) {",
          "3086:     var index = findViewIndex(cm, oldN), diff, view = cm.display.view;",
          "3087:     if (!sawCollapsedSpans || newN == cm.doc.first + cm.doc.size)",
          "3088:       { return {index: index, lineN: newN} }",
          "3089:     var n = cm.display.viewFrom;",
          "3090:     for (var i = 0; i < index; i++)",
          "3091:       { n += view[i].size; }",
          "3092:     if (n != oldN) {",
          "3093:       if (dir > 0) {",
          "3094:         if (index == view.length - 1) { return null }",
          "3095:         diff = (n + view[index].size) - oldN;",
          "3096:         index++;",
          "3097:       } else {",
          "3098:         diff = n - oldN;",
          "3099:       }",
          "3100:       oldN += diff; newN += diff;",
          "3101:     }",
          "3102:     while (visualLineNo(cm.doc, newN) != newN) {",
          "3103:       if (index == (dir < 0 ? 0 : view.length - 1)) { return null }",
          "3104:       newN += dir * view[index - (dir < 0 ? 1 : 0)].size;",
          "3105:       index += dir;",
          "3106:     }",
          "3107:     return {index: index, lineN: newN}",
          "3108:   }",
          "3112:   function adjustView(cm, from, to) {",
          "3113:     var display = cm.display, view = display.view;",
          "3114:     if (view.length == 0 || from >= display.viewTo || to <= display.viewFrom) {",
          "3115:       display.view = buildViewArray(cm, from, to);",
          "3116:       display.viewFrom = from;",
          "3117:     } else {",
          "3118:       if (display.viewFrom > from)",
          "3119:         { display.view = buildViewArray(cm, from, display.viewFrom).concat(display.view); }",
          "3120:       else if (display.viewFrom < from)",
          "3121:         { display.view = display.view.slice(findViewIndex(cm, from)); }",
          "3122:       display.viewFrom = from;",
          "3123:       if (display.viewTo < to)",
          "3124:         { display.view = display.view.concat(buildViewArray(cm, display.viewTo, to)); }",
          "3125:       else if (display.viewTo > to)",
          "3126:         { display.view = display.view.slice(0, findViewIndex(cm, to)); }",
          "3127:     }",
          "3128:     display.viewTo = to;",
          "3129:   }",
          "3133:   function countDirtyView(cm) {",
          "3134:     var view = cm.display.view, dirty = 0;",
          "3135:     for (var i = 0; i < view.length; i++) {",
          "3136:       var lineView = view[i];",
          "3137:       if (!lineView.hidden && (!lineView.node || lineView.changes)) { ++dirty; }",
          "3138:     }",
          "3139:     return dirty",
          "3140:   }",
          "3142:   function updateSelection(cm) {",
          "3143:     cm.display.input.showSelection(cm.display.input.prepareSelection());",
          "3144:   }",
          "3146:   function prepareSelection(cm, primary) {",
          "3147:     if ( primary === void 0 ) primary = true;",
          "3149:     var doc = cm.doc, result = {};",
          "3150:     var curFragment = result.cursors = document.createDocumentFragment();",
          "3151:     var selFragment = result.selection = document.createDocumentFragment();",
          "3153:     for (var i = 0; i < doc.sel.ranges.length; i++) {",
          "3154:       if (!primary && i == doc.sel.primIndex) { continue }",
          "3155:       var range = doc.sel.ranges[i];",
          "3156:       if (range.from().line >= cm.display.viewTo || range.to().line < cm.display.viewFrom) { continue }",
          "3157:       var collapsed = range.empty();",
          "3158:       if (collapsed || cm.options.showCursorWhenSelecting)",
          "3159:         { drawSelectionCursor(cm, range.head, curFragment); }",
          "3160:       if (!collapsed)",
          "3161:         { drawSelectionRange(cm, range, selFragment); }",
          "3162:     }",
          "3163:     return result",
          "3164:   }",
          "3167:   function drawSelectionCursor(cm, head, output) {",
          "3168:     var pos = cursorCoords(cm, head, \"div\", null, null, !cm.options.singleCursorHeightPerLine);",
          "3170:     var cursor = output.appendChild(elt(\"div\", \"\\u00a0\", \"CodeMirror-cursor\"));",
          "3171:     cursor.style.left = pos.left + \"px\";",
          "3172:     cursor.style.top = pos.top + \"px\";",
          "3173:     cursor.style.height = Math.max(0, pos.bottom - pos.top) * cm.options.cursorHeight + \"px\";",
          "3175:     if (/\\bcm-fat-cursor\\b/.test(cm.getWrapperElement().className)) {",
          "3176:       var charPos = charCoords(cm, head, \"div\", null, null);",
          "3177:       if (charPos.right - charPos.left > 0) {",
          "3178:         cursor.style.width = (charPos.right - charPos.left) + \"px\";",
          "3179:       }",
          "3180:     }",
          "3182:     if (pos.other) {",
          "3184:       var otherCursor = output.appendChild(elt(\"div\", \"\\u00a0\", \"CodeMirror-cursor CodeMirror-secondarycursor\"));",
          "3185:       otherCursor.style.display = \"\";",
          "3186:       otherCursor.style.left = pos.other.left + \"px\";",
          "3187:       otherCursor.style.top = pos.other.top + \"px\";",
          "3188:       otherCursor.style.height = (pos.other.bottom - pos.other.top) * .85 + \"px\";",
          "3189:     }",
          "3190:   }",
          "3192:   function cmpCoords(a, b) { return a.top - b.top || a.left - b.left }",
          "3195:   function drawSelectionRange(cm, range, output) {",
          "3196:     var display = cm.display, doc = cm.doc;",
          "3197:     var fragment = document.createDocumentFragment();",
          "3198:     var padding = paddingH(cm.display), leftSide = padding.left;",
          "3199:     var rightSide = Math.max(display.sizerWidth, displayWidth(cm) - display.sizer.offsetLeft) - padding.right;",
          "3200:     var docLTR = doc.direction == \"ltr\";",
          "3202:     function add(left, top, width, bottom) {",
          "3203:       if (top < 0) { top = 0; }",
          "3204:       top = Math.round(top);",
          "3205:       bottom = Math.round(bottom);",
          "3206:       fragment.appendChild(elt(\"div\", null, \"CodeMirror-selected\", (\"position: absolute; left: \" + left + \"px;\\n                             top: \" + top + \"px; width: \" + (width == null ? rightSide - left : width) + \"px;\\n                             height: \" + (bottom - top) + \"px\")));",
          "3207:     }",
          "3209:     function drawForLine(line, fromArg, toArg) {",
          "3210:       var lineObj = getLine(doc, line);",
          "3211:       var lineLen = lineObj.text.length;",
          "3212:       var start, end;",
          "3213:       function coords(ch, bias) {",
          "3214:         return charCoords(cm, Pos(line, ch), \"div\", lineObj, bias)",
          "3215:       }",
          "3217:       function wrapX(pos, dir, side) {",
          "3218:         var extent = wrappedLineExtentChar(cm, lineObj, null, pos);",
          "3219:         var prop = (dir == \"ltr\") == (side == \"after\") ? \"left\" : \"right\";",
          "3220:         var ch = side == \"after\" ? extent.begin : extent.end - (/\\s/.test(lineObj.text.charAt(extent.end - 1)) ? 2 : 1);",
          "3221:         return coords(ch, prop)[prop]",
          "3222:       }",
          "3224:       var order = getOrder(lineObj, doc.direction);",
          "3225:       iterateBidiSections(order, fromArg || 0, toArg == null ? lineLen : toArg, function (from, to, dir, i) {",
          "3226:         var ltr = dir == \"ltr\";",
          "3227:         var fromPos = coords(from, ltr ? \"left\" : \"right\");",
          "3228:         var toPos = coords(to - 1, ltr ? \"right\" : \"left\");",
          "3230:         var openStart = fromArg == null && from == 0, openEnd = toArg == null && to == lineLen;",
          "3231:         var first = i == 0, last = !order || i == order.length - 1;",
          "3232:         if (toPos.top - fromPos.top <= 3) { // Single line",
          "3233:           var openLeft = (docLTR ? openStart : openEnd) && first;",
          "3234:           var openRight = (docLTR ? openEnd : openStart) && last;",
          "3235:           var left = openLeft ? leftSide : (ltr ? fromPos : toPos).left;",
          "3236:           var right = openRight ? rightSide : (ltr ? toPos : fromPos).right;",
          "3237:           add(left, fromPos.top, right - left, fromPos.bottom);",
          "3238:         } else { // Multiple lines",
          "3239:           var topLeft, topRight, botLeft, botRight;",
          "3240:           if (ltr) {",
          "3241:             topLeft = docLTR && openStart && first ? leftSide : fromPos.left;",
          "3242:             topRight = docLTR ? rightSide : wrapX(from, dir, \"before\");",
          "3243:             botLeft = docLTR ? leftSide : wrapX(to, dir, \"after\");",
          "3244:             botRight = docLTR && openEnd && last ? rightSide : toPos.right;",
          "3245:           } else {",
          "3246:             topLeft = !docLTR ? leftSide : wrapX(from, dir, \"before\");",
          "3247:             topRight = !docLTR && openStart && first ? rightSide : fromPos.right;",
          "3248:             botLeft = !docLTR && openEnd && last ? leftSide : toPos.left;",
          "3249:             botRight = !docLTR ? rightSide : wrapX(to, dir, \"after\");",
          "3250:           }",
          "3251:           add(topLeft, fromPos.top, topRight - topLeft, fromPos.bottom);",
          "3252:           if (fromPos.bottom < toPos.top) { add(leftSide, fromPos.bottom, null, toPos.top); }",
          "3253:           add(botLeft, toPos.top, botRight - botLeft, toPos.bottom);",
          "3254:         }",
          "3256:         if (!start || cmpCoords(fromPos, start) < 0) { start = fromPos; }",
          "3257:         if (cmpCoords(toPos, start) < 0) { start = toPos; }",
          "3258:         if (!end || cmpCoords(fromPos, end) < 0) { end = fromPos; }",
          "3259:         if (cmpCoords(toPos, end) < 0) { end = toPos; }",
          "3260:       });",
          "3261:       return {start: start, end: end}",
          "3262:     }",
          "3264:     var sFrom = range.from(), sTo = range.to();",
          "3265:     if (sFrom.line == sTo.line) {",
          "3266:       drawForLine(sFrom.line, sFrom.ch, sTo.ch);",
          "3267:     } else {",
          "3268:       var fromLine = getLine(doc, sFrom.line), toLine = getLine(doc, sTo.line);",
          "3269:       var singleVLine = visualLine(fromLine) == visualLine(toLine);",
          "3270:       var leftEnd = drawForLine(sFrom.line, sFrom.ch, singleVLine ? fromLine.text.length + 1 : null).end;",
          "3271:       var rightStart = drawForLine(sTo.line, singleVLine ? 0 : null, sTo.ch).start;",
          "3272:       if (singleVLine) {",
          "3273:         if (leftEnd.top < rightStart.top - 2) {",
          "3274:           add(leftEnd.right, leftEnd.top, null, leftEnd.bottom);",
          "3275:           add(leftSide, rightStart.top, rightStart.left, rightStart.bottom);",
          "3276:         } else {",
          "3277:           add(leftEnd.right, leftEnd.top, rightStart.left - leftEnd.right, leftEnd.bottom);",
          "3278:         }",
          "3279:       }",
          "3280:       if (leftEnd.bottom < rightStart.top)",
          "3281:         { add(leftSide, leftEnd.bottom, null, rightStart.top); }",
          "3282:     }",
          "3284:     output.appendChild(fragment);",
          "3285:   }",
          "3288:   function restartBlink(cm) {",
          "3289:     if (!cm.state.focused) { return }",
          "3290:     var display = cm.display;",
          "3291:     clearInterval(display.blinker);",
          "3292:     var on = true;",
          "3293:     display.cursorDiv.style.visibility = \"\";",
          "3294:     if (cm.options.cursorBlinkRate > 0)",
          "3295:       { display.blinker = setInterval(function () {",
          "3296:         if (!cm.hasFocus()) { onBlur(cm); }",
          "3297:         display.cursorDiv.style.visibility = (on = !on) ? \"\" : \"hidden\";",
          "3298:       }, cm.options.cursorBlinkRate); }",
          "3299:     else if (cm.options.cursorBlinkRate < 0)",
          "3300:       { display.cursorDiv.style.visibility = \"hidden\"; }",
          "3301:   }",
          "3303:   function ensureFocus(cm) {",
          "3304:     if (!cm.hasFocus()) {",
          "3305:       cm.display.input.focus();",
          "3306:       if (!cm.state.focused) { onFocus(cm); }",
          "3307:     }",
          "3308:   }",
          "3310:   function delayBlurEvent(cm) {",
          "3311:     cm.state.delayingBlurEvent = true;",
          "3312:     setTimeout(function () { if (cm.state.delayingBlurEvent) {",
          "3313:       cm.state.delayingBlurEvent = false;",
          "3314:       if (cm.state.focused) { onBlur(cm); }",
          "3315:     } }, 100);",
          "3316:   }",
          "3318:   function onFocus(cm, e) {",
          "3319:     if (cm.state.delayingBlurEvent && !cm.state.draggingText) { cm.state.delayingBlurEvent = false; }",
          "3321:     if (cm.options.readOnly == \"nocursor\") { return }",
          "3322:     if (!cm.state.focused) {",
          "3323:       signal(cm, \"focus\", cm, e);",
          "3324:       cm.state.focused = true;",
          "3325:       addClass(cm.display.wrapper, \"CodeMirror-focused\");",
          "3329:       if (!cm.curOp && cm.display.selForContextMenu != cm.doc.sel) {",
          "3330:         cm.display.input.reset();",
          "3331:         if (webkit) { setTimeout(function () { return cm.display.input.reset(true); }, 20); } // Issue #1730",
          "3332:       }",
          "3333:       cm.display.input.receivedFocus();",
          "3334:     }",
          "3335:     restartBlink(cm);",
          "3336:   }",
          "3337:   function onBlur(cm, e) {",
          "3338:     if (cm.state.delayingBlurEvent) { return }",
          "3340:     if (cm.state.focused) {",
          "3341:       signal(cm, \"blur\", cm, e);",
          "3342:       cm.state.focused = false;",
          "3343:       rmClass(cm.display.wrapper, \"CodeMirror-focused\");",
          "3344:     }",
          "3345:     clearInterval(cm.display.blinker);",
          "3346:     setTimeout(function () { if (!cm.state.focused) { cm.display.shift = false; } }, 150);",
          "3347:   }",
          "3351:   function updateHeightsInViewport(cm) {",
          "3352:     var display = cm.display;",
          "3353:     var prevBottom = display.lineDiv.offsetTop;",
          "3354:     var viewTop = Math.max(0, display.scroller.getBoundingClientRect().top);",
          "3355:     var oldHeight = display.lineDiv.getBoundingClientRect().top;",
          "3356:     var mustScroll = 0;",
          "3357:     for (var i = 0; i < display.view.length; i++) {",
          "3358:       var cur = display.view[i], wrapping = cm.options.lineWrapping;",
          "3359:       var height = (void 0), width = 0;",
          "3360:       if (cur.hidden) { continue }",
          "3361:       oldHeight += cur.line.height;",
          "3362:       if (ie && ie_version < 8) {",
          "3363:         var bot = cur.node.offsetTop + cur.node.offsetHeight;",
          "3364:         height = bot - prevBottom;",
          "3365:         prevBottom = bot;",
          "3366:       } else {",
          "3367:         var box = cur.node.getBoundingClientRect();",
          "3368:         height = box.bottom - box.top;",
          "3371:         if (!wrapping && cur.text.firstChild)",
          "3372:           { width = cur.text.firstChild.getBoundingClientRect().right - box.left - 1; }",
          "3373:       }",
          "3374:       var diff = cur.line.height - height;",
          "3375:       if (diff > .005 || diff < -.005) {",
          "3376:         if (oldHeight < viewTop) { mustScroll -= diff; }",
          "3377:         updateLineHeight(cur.line, height);",
          "3378:         updateWidgetHeight(cur.line);",
          "3379:         if (cur.rest) { for (var j = 0; j < cur.rest.length; j++)",
          "3380:           { updateWidgetHeight(cur.rest[j]); } }",
          "3381:       }",
          "3382:       if (width > cm.display.sizerWidth) {",
          "3383:         var chWidth = Math.ceil(width / charWidth(cm.display));",
          "3384:         if (chWidth > cm.display.maxLineLength) {",
          "3385:           cm.display.maxLineLength = chWidth;",
          "3386:           cm.display.maxLine = cur.line;",
          "3387:           cm.display.maxLineChanged = true;",
          "3388:         }",
          "3389:       }",
          "3390:     }",
          "3391:     if (Math.abs(mustScroll) > 2) { display.scroller.scrollTop += mustScroll; }",
          "3392:   }",
          "3396:   function updateWidgetHeight(line) {",
          "3397:     if (line.widgets) { for (var i = 0; i < line.widgets.length; ++i) {",
          "3398:       var w = line.widgets[i], parent = w.node.parentNode;",
          "3399:       if (parent) { w.height = parent.offsetHeight; }",
          "3400:     } }",
          "3401:   }",
          "3406:   function visibleLines(display, doc, viewport) {",
          "3407:     var top = viewport && viewport.top != null ? Math.max(0, viewport.top) : display.scroller.scrollTop;",
          "3408:     top = Math.floor(top - paddingTop(display));",
          "3409:     var bottom = viewport && viewport.bottom != null ? viewport.bottom : top + display.wrapper.clientHeight;",
          "3411:     var from = lineAtHeight(doc, top), to = lineAtHeight(doc, bottom);",
          "3414:     if (viewport && viewport.ensure) {",
          "3415:       var ensureFrom = viewport.ensure.from.line, ensureTo = viewport.ensure.to.line;",
          "3416:       if (ensureFrom < from) {",
          "3417:         from = ensureFrom;",
          "3418:         to = lineAtHeight(doc, heightAtLine(getLine(doc, ensureFrom)) + display.wrapper.clientHeight);",
          "3419:       } else if (Math.min(ensureTo, doc.lastLine()) >= to) {",
          "3420:         from = lineAtHeight(doc, heightAtLine(getLine(doc, ensureTo)) - display.wrapper.clientHeight);",
          "3421:         to = ensureTo;",
          "3422:       }",
          "3423:     }",
          "3424:     return {from: from, to: Math.max(to, from + 1)}",
          "3425:   }",
          "3431:   function maybeScrollWindow(cm, rect) {",
          "3432:     if (signalDOMEvent(cm, \"scrollCursorIntoView\")) { return }",
          "3434:     var display = cm.display, box = display.sizer.getBoundingClientRect(), doScroll = null;",
          "3435:     if (rect.top + box.top < 0) { doScroll = true; }",
          "3436:     else if (rect.bottom + box.top > (window.innerHeight || document.documentElement.clientHeight)) { doScroll = false; }",
          "3437:     if (doScroll != null && !phantom) {",
          "3438:       var scrollNode = elt(\"div\", \"\\u200b\", null, (\"position: absolute;\\n                         top: \" + (rect.top - display.viewOffset - paddingTop(cm.display)) + \"px;\\n                         height: \" + (rect.bottom - rect.top + scrollGap(cm) + display.barHeight) + \"px;\\n                         left: \" + (rect.left) + \"px; width: \" + (Math.max(2, rect.right - rect.left)) + \"px;\"));",
          "3439:       cm.display.lineSpace.appendChild(scrollNode);",
          "3440:       scrollNode.scrollIntoView(doScroll);",
          "3441:       cm.display.lineSpace.removeChild(scrollNode);",
          "3442:     }",
          "3443:   }",
          "3448:   function scrollPosIntoView(cm, pos, end, margin) {",
          "3449:     if (margin == null) { margin = 0; }",
          "3450:     var rect;",
          "3451:     if (!cm.options.lineWrapping && pos == end) {",
          "3455:       end = pos.sticky == \"before\" ? Pos(pos.line, pos.ch + 1, \"before\") : pos;",
          "3456:       pos = pos.ch ? Pos(pos.line, pos.sticky == \"before\" ? pos.ch - 1 : pos.ch, \"after\") : pos;",
          "3457:     }",
          "3458:     for (var limit = 0; limit < 5; limit++) {",
          "3459:       var changed = false;",
          "3460:       var coords = cursorCoords(cm, pos);",
          "3461:       var endCoords = !end || end == pos ? coords : cursorCoords(cm, end);",
          "3462:       rect = {left: Math.min(coords.left, endCoords.left),",
          "3463:               top: Math.min(coords.top, endCoords.top) - margin,",
          "3464:               right: Math.max(coords.left, endCoords.left),",
          "3465:               bottom: Math.max(coords.bottom, endCoords.bottom) + margin};",
          "3466:       var scrollPos = calculateScrollPos(cm, rect);",
          "3467:       var startTop = cm.doc.scrollTop, startLeft = cm.doc.scrollLeft;",
          "3468:       if (scrollPos.scrollTop != null) {",
          "3469:         updateScrollTop(cm, scrollPos.scrollTop);",
          "3470:         if (Math.abs(cm.doc.scrollTop - startTop) > 1) { changed = true; }",
          "3471:       }",
          "3472:       if (scrollPos.scrollLeft != null) {",
          "3473:         setScrollLeft(cm, scrollPos.scrollLeft);",
          "3474:         if (Math.abs(cm.doc.scrollLeft - startLeft) > 1) { changed = true; }",
          "3475:       }",
          "3476:       if (!changed) { break }",
          "3477:     }",
          "3478:     return rect",
          "3479:   }",
          "3482:   function scrollIntoView(cm, rect) {",
          "3483:     var scrollPos = calculateScrollPos(cm, rect);",
          "3484:     if (scrollPos.scrollTop != null) { updateScrollTop(cm, scrollPos.scrollTop); }",
          "3485:     if (scrollPos.scrollLeft != null) { setScrollLeft(cm, scrollPos.scrollLeft); }",
          "3486:   }",
          "3492:   function calculateScrollPos(cm, rect) {",
          "3493:     var display = cm.display, snapMargin = textHeight(cm.display);",
          "3494:     if (rect.top < 0) { rect.top = 0; }",
          "3495:     var screentop = cm.curOp && cm.curOp.scrollTop != null ? cm.curOp.scrollTop : display.scroller.scrollTop;",
          "3496:     var screen = displayHeight(cm), result = {};",
          "3497:     if (rect.bottom - rect.top > screen) { rect.bottom = rect.top + screen; }",
          "3498:     var docBottom = cm.doc.height + paddingVert(display);",
          "3499:     var atTop = rect.top < snapMargin, atBottom = rect.bottom > docBottom - snapMargin;",
          "3500:     if (rect.top < screentop) {",
          "3501:       result.scrollTop = atTop ? 0 : rect.top;",
          "3502:     } else if (rect.bottom > screentop + screen) {",
          "3503:       var newTop = Math.min(rect.top, (atBottom ? docBottom : rect.bottom) - screen);",
          "3504:       if (newTop != screentop) { result.scrollTop = newTop; }",
          "3505:     }",
          "3507:     var gutterSpace = cm.options.fixedGutter ? 0 : display.gutters.offsetWidth;",
          "3508:     var screenleft = cm.curOp && cm.curOp.scrollLeft != null ? cm.curOp.scrollLeft : display.scroller.scrollLeft - gutterSpace;",
          "3509:     var screenw = displayWidth(cm) - display.gutters.offsetWidth;",
          "3510:     var tooWide = rect.right - rect.left > screenw;",
          "3511:     if (tooWide) { rect.right = rect.left + screenw; }",
          "3512:     if (rect.left < 10)",
          "3513:       { result.scrollLeft = 0; }",
          "3514:     else if (rect.left < screenleft)",
          "3515:       { result.scrollLeft = Math.max(0, rect.left + gutterSpace - (tooWide ? 0 : 10)); }",
          "3516:     else if (rect.right > screenw + screenleft - 3)",
          "3517:       { result.scrollLeft = rect.right + (tooWide ? 0 : 10) - screenw; }",
          "3518:     return result",
          "3519:   }",
          "3523:   function addToScrollTop(cm, top) {",
          "3524:     if (top == null) { return }",
          "3525:     resolveScrollToPos(cm);",
          "3526:     cm.curOp.scrollTop = (cm.curOp.scrollTop == null ? cm.doc.scrollTop : cm.curOp.scrollTop) + top;",
          "3527:   }",
          "3531:   function ensureCursorVisible(cm) {",
          "3532:     resolveScrollToPos(cm);",
          "3533:     var cur = cm.getCursor();",
          "3534:     cm.curOp.scrollToPos = {from: cur, to: cur, margin: cm.options.cursorScrollMargin};",
          "3535:   }",
          "3537:   function scrollToCoords(cm, x, y) {",
          "3538:     if (x != null || y != null) { resolveScrollToPos(cm); }",
          "3539:     if (x != null) { cm.curOp.scrollLeft = x; }",
          "3540:     if (y != null) { cm.curOp.scrollTop = y; }",
          "3541:   }",
          "3543:   function scrollToRange(cm, range) {",
          "3544:     resolveScrollToPos(cm);",
          "3545:     cm.curOp.scrollToPos = range;",
          "3546:   }",
          "3552:   function resolveScrollToPos(cm) {",
          "3553:     var range = cm.curOp.scrollToPos;",
          "3554:     if (range) {",
          "3555:       cm.curOp.scrollToPos = null;",
          "3556:       var from = estimateCoords(cm, range.from), to = estimateCoords(cm, range.to);",
          "3557:       scrollToCoordsRange(cm, from, to, range.margin);",
          "3558:     }",
          "3559:   }",
          "3561:   function scrollToCoordsRange(cm, from, to, margin) {",
          "3562:     var sPos = calculateScrollPos(cm, {",
          "3563:       left: Math.min(from.left, to.left),",
          "3564:       top: Math.min(from.top, to.top) - margin,",
          "3565:       right: Math.max(from.right, to.right),",
          "3566:       bottom: Math.max(from.bottom, to.bottom) + margin",
          "3567:     });",
          "3568:     scrollToCoords(cm, sPos.scrollLeft, sPos.scrollTop);",
          "3569:   }",
          "3573:   function updateScrollTop(cm, val) {",
          "3574:     if (Math.abs(cm.doc.scrollTop - val) < 2) { return }",
          "3575:     if (!gecko) { updateDisplaySimple(cm, {top: val}); }",
          "3576:     setScrollTop(cm, val, true);",
          "3577:     if (gecko) { updateDisplaySimple(cm); }",
          "3578:     startWorker(cm, 100);",
          "3579:   }",
          "3581:   function setScrollTop(cm, val, forceScroll) {",
          "3582:     val = Math.max(0, Math.min(cm.display.scroller.scrollHeight - cm.display.scroller.clientHeight, val));",
          "3583:     if (cm.display.scroller.scrollTop == val && !forceScroll) { return }",
          "3584:     cm.doc.scrollTop = val;",
          "3585:     cm.display.scrollbars.setScrollTop(val);",
          "3586:     if (cm.display.scroller.scrollTop != val) { cm.display.scroller.scrollTop = val; }",
          "3587:   }",
          "3591:   function setScrollLeft(cm, val, isScroller, forceScroll) {",
          "3592:     val = Math.max(0, Math.min(val, cm.display.scroller.scrollWidth - cm.display.scroller.clientWidth));",
          "3593:     if ((isScroller ? val == cm.doc.scrollLeft : Math.abs(cm.doc.scrollLeft - val) < 2) && !forceScroll) { return }",
          "3594:     cm.doc.scrollLeft = val;",
          "3595:     alignHorizontally(cm);",
          "3596:     if (cm.display.scroller.scrollLeft != val) { cm.display.scroller.scrollLeft = val; }",
          "3597:     cm.display.scrollbars.setScrollLeft(val);",
          "3598:   }",
          "3604:   function measureForScrollbars(cm) {",
          "3605:     var d = cm.display, gutterW = d.gutters.offsetWidth;",
          "3606:     var docH = Math.round(cm.doc.height + paddingVert(cm.display));",
          "3607:     return {",
          "3608:       clientHeight: d.scroller.clientHeight,",
          "3609:       viewHeight: d.wrapper.clientHeight,",
          "3610:       scrollWidth: d.scroller.scrollWidth, clientWidth: d.scroller.clientWidth,",
          "3611:       viewWidth: d.wrapper.clientWidth,",
          "3612:       barLeft: cm.options.fixedGutter ? gutterW : 0,",
          "3613:       docHeight: docH,",
          "3614:       scrollHeight: docH + scrollGap(cm) + d.barHeight,",
          "3615:       nativeBarWidth: d.nativeBarWidth,",
          "3616:       gutterWidth: gutterW",
          "3617:     }",
          "3618:   }",
          "3620:   var NativeScrollbars = function(place, scroll, cm) {",
          "3621:     this.cm = cm;",
          "3622:     var vert = this.vert = elt(\"div\", [elt(\"div\", null, null, \"min-width: 1px\")], \"CodeMirror-vscrollbar\");",
          "3623:     var horiz = this.horiz = elt(\"div\", [elt(\"div\", null, null, \"height: 100%; min-height: 1px\")], \"CodeMirror-hscrollbar\");",
          "3624:     vert.tabIndex = horiz.tabIndex = -1;",
          "3625:     place(vert); place(horiz);",
          "3627:     on(vert, \"scroll\", function () {",
          "3628:       if (vert.clientHeight) { scroll(vert.scrollTop, \"vertical\"); }",
          "3629:     });",
          "3630:     on(horiz, \"scroll\", function () {",
          "3631:       if (horiz.clientWidth) { scroll(horiz.scrollLeft, \"horizontal\"); }",
          "3632:     });",
          "3634:     this.checkedZeroWidth = false;",
          "3636:     if (ie && ie_version < 8) { this.horiz.style.minHeight = this.vert.style.minWidth = \"18px\"; }",
          "3637:   };",
          "3639:   NativeScrollbars.prototype.update = function (measure) {",
          "3640:     var needsH = measure.scrollWidth > measure.clientWidth + 1;",
          "3641:     var needsV = measure.scrollHeight > measure.clientHeight + 1;",
          "3642:     var sWidth = measure.nativeBarWidth;",
          "3644:     if (needsV) {",
          "3645:       this.vert.style.display = \"block\";",
          "3646:       this.vert.style.bottom = needsH ? sWidth + \"px\" : \"0\";",
          "3647:       var totalHeight = measure.viewHeight - (needsH ? sWidth : 0);",
          "3649:       this.vert.firstChild.style.height =",
          "3650:         Math.max(0, measure.scrollHeight - measure.clientHeight + totalHeight) + \"px\";",
          "3651:     } else {",
          "3652:       this.vert.style.display = \"\";",
          "3653:       this.vert.firstChild.style.height = \"0\";",
          "3654:     }",
          "3656:     if (needsH) {",
          "3657:       this.horiz.style.display = \"block\";",
          "3658:       this.horiz.style.right = needsV ? sWidth + \"px\" : \"0\";",
          "3659:       this.horiz.style.left = measure.barLeft + \"px\";",
          "3660:       var totalWidth = measure.viewWidth - measure.barLeft - (needsV ? sWidth : 0);",
          "3661:       this.horiz.firstChild.style.width =",
          "3662:         Math.max(0, measure.scrollWidth - measure.clientWidth + totalWidth) + \"px\";",
          "3663:     } else {",
          "3664:       this.horiz.style.display = \"\";",
          "3665:       this.horiz.firstChild.style.width = \"0\";",
          "3666:     }",
          "3668:     if (!this.checkedZeroWidth && measure.clientHeight > 0) {",
          "3669:       if (sWidth == 0) { this.zeroWidthHack(); }",
          "3670:       this.checkedZeroWidth = true;",
          "3671:     }",
          "3673:     return {right: needsV ? sWidth : 0, bottom: needsH ? sWidth : 0}",
          "3674:   };",
          "3676:   NativeScrollbars.prototype.setScrollLeft = function (pos) {",
          "3677:     if (this.horiz.scrollLeft != pos) { this.horiz.scrollLeft = pos; }",
          "3678:     if (this.disableHoriz) { this.enableZeroWidthBar(this.horiz, this.disableHoriz, \"horiz\"); }",
          "3679:   };",
          "3681:   NativeScrollbars.prototype.setScrollTop = function (pos) {",
          "3682:     if (this.vert.scrollTop != pos) { this.vert.scrollTop = pos; }",
          "3683:     if (this.disableVert) { this.enableZeroWidthBar(this.vert, this.disableVert, \"vert\"); }",
          "3684:   };",
          "3686:   NativeScrollbars.prototype.zeroWidthHack = function () {",
          "3687:     var w = mac && !mac_geMountainLion ? \"12px\" : \"18px\";",
          "3688:     this.horiz.style.height = this.vert.style.width = w;",
          "3689:     this.horiz.style.pointerEvents = this.vert.style.pointerEvents = \"none\";",
          "3690:     this.disableHoriz = new Delayed;",
          "3691:     this.disableVert = new Delayed;",
          "3692:   };",
          "3694:   NativeScrollbars.prototype.enableZeroWidthBar = function (bar, delay, type) {",
          "3695:     bar.style.pointerEvents = \"auto\";",
          "3696:     function maybeDisable() {",
          "3703:       var box = bar.getBoundingClientRect();",
          "3704:       var elt = type == \"vert\" ? document.elementFromPoint(box.right - 1, (box.top + box.bottom) / 2)",
          "3705:           : document.elementFromPoint((box.right + box.left) / 2, box.bottom - 1);",
          "3706:       if (elt != bar) { bar.style.pointerEvents = \"none\"; }",
          "3707:       else { delay.set(1000, maybeDisable); }",
          "3708:     }",
          "3709:     delay.set(1000, maybeDisable);",
          "3710:   };",
          "3712:   NativeScrollbars.prototype.clear = function () {",
          "3713:     var parent = this.horiz.parentNode;",
          "3714:     parent.removeChild(this.horiz);",
          "3715:     parent.removeChild(this.vert);",
          "3716:   };",
          "3718:   var NullScrollbars = function () {};",
          "3720:   NullScrollbars.prototype.update = function () { return {bottom: 0, right: 0} };",
          "3721:   NullScrollbars.prototype.setScrollLeft = function () {};",
          "3722:   NullScrollbars.prototype.setScrollTop = function () {};",
          "3723:   NullScrollbars.prototype.clear = function () {};",
          "3725:   function updateScrollbars(cm, measure) {",
          "3726:     if (!measure) { measure = measureForScrollbars(cm); }",
          "3727:     var startWidth = cm.display.barWidth, startHeight = cm.display.barHeight;",
          "3728:     updateScrollbarsInner(cm, measure);",
          "3729:     for (var i = 0; i < 4 && startWidth != cm.display.barWidth || startHeight != cm.display.barHeight; i++) {",
          "3730:       if (startWidth != cm.display.barWidth && cm.options.lineWrapping)",
          "3731:         { updateHeightsInViewport(cm); }",
          "3732:       updateScrollbarsInner(cm, measureForScrollbars(cm));",
          "3733:       startWidth = cm.display.barWidth; startHeight = cm.display.barHeight;",
          "3734:     }",
          "3735:   }",
          "3739:   function updateScrollbarsInner(cm, measure) {",
          "3740:     var d = cm.display;",
          "3741:     var sizes = d.scrollbars.update(measure);",
          "3743:     d.sizer.style.paddingRight = (d.barWidth = sizes.right) + \"px\";",
          "3744:     d.sizer.style.paddingBottom = (d.barHeight = sizes.bottom) + \"px\";",
          "3745:     d.heightForcer.style.borderBottom = sizes.bottom + \"px solid transparent\";",
          "3747:     if (sizes.right && sizes.bottom) {",
          "3748:       d.scrollbarFiller.style.display = \"block\";",
          "3749:       d.scrollbarFiller.style.height = sizes.bottom + \"px\";",
          "3750:       d.scrollbarFiller.style.width = sizes.right + \"px\";",
          "3751:     } else { d.scrollbarFiller.style.display = \"\"; }",
          "3752:     if (sizes.bottom && cm.options.coverGutterNextToScrollbar && cm.options.fixedGutter) {",
          "3753:       d.gutterFiller.style.display = \"block\";",
          "3754:       d.gutterFiller.style.height = sizes.bottom + \"px\";",
          "3755:       d.gutterFiller.style.width = measure.gutterWidth + \"px\";",
          "3756:     } else { d.gutterFiller.style.display = \"\"; }",
          "3757:   }",
          "3759:   var scrollbarModel = {\"native\": NativeScrollbars, \"null\": NullScrollbars};",
          "3761:   function initScrollbars(cm) {",
          "3762:     if (cm.display.scrollbars) {",
          "3763:       cm.display.scrollbars.clear();",
          "3764:       if (cm.display.scrollbars.addClass)",
          "3765:         { rmClass(cm.display.wrapper, cm.display.scrollbars.addClass); }",
          "3766:     }",
          "3768:     cm.display.scrollbars = new scrollbarModel[cm.options.scrollbarStyle](function (node) {",
          "3769:       cm.display.wrapper.insertBefore(node, cm.display.scrollbarFiller);",
          "3771:       on(node, \"mousedown\", function () {",
          "3772:         if (cm.state.focused) { setTimeout(function () { return cm.display.input.focus(); }, 0); }",
          "3773:       });",
          "3774:       node.setAttribute(\"cm-not-content\", \"true\");",
          "3775:     }, function (pos, axis) {",
          "3776:       if (axis == \"horizontal\") { setScrollLeft(cm, pos); }",
          "3777:       else { updateScrollTop(cm, pos); }",
          "3778:     }, cm);",
          "3779:     if (cm.display.scrollbars.addClass)",
          "3780:       { addClass(cm.display.wrapper, cm.display.scrollbars.addClass); }",
          "3781:   }",
          "3789:   var nextOpId = 0;",
          "3791:   function startOperation(cm) {",
          "3792:     cm.curOp = {",
          "3793:       cm: cm,",
          "3794:       viewChanged: false,      // Flag that indicates that lines might need to be redrawn",
          "3795:       startHeight: cm.doc.height, // Used to detect need to update scrollbar",
          "3796:       forceUpdate: false,      // Used to force a redraw",
          "3797:       updateInput: 0,       // Whether to reset the input textarea",
          "3798:       typing: false,           // Whether this reset should be careful to leave existing text (for compositing)",
          "3799:       changeObjs: null,        // Accumulated changes, for firing change events",
          "3800:       cursorActivityHandlers: null, // Set of handlers to fire cursorActivity on",
          "3801:       cursorActivityCalled: 0, // Tracks which cursorActivity handlers have been called already",
          "3802:       selectionChanged: false, // Whether the selection needs to be redrawn",
          "3803:       updateMaxLine: false,    // Set when the widest line needs to be determined anew",
          "3804:       scrollLeft: null, scrollTop: null, // Intermediate scroll position, not pushed to DOM yet",
          "3805:       scrollToPos: null,       // Used to scroll to a specific position",
          "3806:       focus: false,",
          "3807:       id: ++nextOpId,          // Unique ID",
          "3808:       markArrays: null         // Used by addMarkedSpan",
          "3809:     };",
          "3810:     pushOperation(cm.curOp);",
          "3811:   }",
          "3814:   function endOperation(cm) {",
          "3815:     var op = cm.curOp;",
          "3816:     if (op) { finishOperation(op, function (group) {",
          "3817:       for (var i = 0; i < group.ops.length; i++)",
          "3818:         { group.ops[i].cm.curOp = null; }",
          "3819:       endOperations(group);",
          "3820:     }); }",
          "3821:   }",
          "3825:   function endOperations(group) {",
          "3826:     var ops = group.ops;",
          "3827:     for (var i = 0; i < ops.length; i++) // Read DOM",
          "3828:       { endOperation_R1(ops[i]); }",
          "3829:     for (var i$1 = 0; i$1 < ops.length; i$1++) // Write DOM (maybe)",
          "3830:       { endOperation_W1(ops[i$1]); }",
          "3831:     for (var i$2 = 0; i$2 < ops.length; i$2++) // Read DOM",
          "3832:       { endOperation_R2(ops[i$2]); }",
          "3833:     for (var i$3 = 0; i$3 < ops.length; i$3++) // Write DOM (maybe)",
          "3834:       { endOperation_W2(ops[i$3]); }",
          "3835:     for (var i$4 = 0; i$4 < ops.length; i$4++) // Read DOM",
          "3836:       { endOperation_finish(ops[i$4]); }",
          "3837:   }",
          "3839:   function endOperation_R1(op) {",
          "3840:     var cm = op.cm, display = cm.display;",
          "3841:     maybeClipScrollbars(cm);",
          "3842:     if (op.updateMaxLine) { findMaxLine(cm); }",
          "3844:     op.mustUpdate = op.viewChanged || op.forceUpdate || op.scrollTop != null ||",
          "3845:       op.scrollToPos && (op.scrollToPos.from.line < display.viewFrom ||",
          "3846:                          op.scrollToPos.to.line >= display.viewTo) ||",
          "3847:       display.maxLineChanged && cm.options.lineWrapping;",
          "3848:     op.update = op.mustUpdate &&",
          "3849:       new DisplayUpdate(cm, op.mustUpdate && {top: op.scrollTop, ensure: op.scrollToPos}, op.forceUpdate);",
          "3850:   }",
          "3852:   function endOperation_W1(op) {",
          "3853:     op.updatedDisplay = op.mustUpdate && updateDisplayIfNeeded(op.cm, op.update);",
          "3854:   }",
          "3856:   function endOperation_R2(op) {",
          "3857:     var cm = op.cm, display = cm.display;",
          "3858:     if (op.updatedDisplay) { updateHeightsInViewport(cm); }",
          "3860:     op.barMeasure = measureForScrollbars(cm);",
          "3865:     if (display.maxLineChanged && !cm.options.lineWrapping) {",
          "3866:       op.adjustWidthTo = measureChar(cm, display.maxLine, display.maxLine.text.length).left + 3;",
          "3867:       cm.display.sizerWidth = op.adjustWidthTo;",
          "3868:       op.barMeasure.scrollWidth =",
          "3869:         Math.max(display.scroller.clientWidth, display.sizer.offsetLeft + op.adjustWidthTo + scrollGap(cm) + cm.display.barWidth);",
          "3870:       op.maxScrollLeft = Math.max(0, display.sizer.offsetLeft + op.adjustWidthTo - displayWidth(cm));",
          "3871:     }",
          "3873:     if (op.updatedDisplay || op.selectionChanged)",
          "3874:       { op.preparedSelection = display.input.prepareSelection(); }",
          "3875:   }",
          "3877:   function endOperation_W2(op) {",
          "3878:     var cm = op.cm;",
          "3880:     if (op.adjustWidthTo != null) {",
          "3881:       cm.display.sizer.style.minWidth = op.adjustWidthTo + \"px\";",
          "3882:       if (op.maxScrollLeft < cm.doc.scrollLeft)",
          "3883:         { setScrollLeft(cm, Math.min(cm.display.scroller.scrollLeft, op.maxScrollLeft), true); }",
          "3884:       cm.display.maxLineChanged = false;",
          "3885:     }",
          "3887:     var takeFocus = op.focus && op.focus == activeElt();",
          "3888:     if (op.preparedSelection)",
          "3889:       { cm.display.input.showSelection(op.preparedSelection, takeFocus); }",
          "3890:     if (op.updatedDisplay || op.startHeight != cm.doc.height)",
          "3891:       { updateScrollbars(cm, op.barMeasure); }",
          "3892:     if (op.updatedDisplay)",
          "3893:       { setDocumentHeight(cm, op.barMeasure); }",
          "3895:     if (op.selectionChanged) { restartBlink(cm); }",
          "3897:     if (cm.state.focused && op.updateInput)",
          "3898:       { cm.display.input.reset(op.typing); }",
          "3899:     if (takeFocus) { ensureFocus(op.cm); }",
          "3900:   }",
          "3902:   function endOperation_finish(op) {",
          "3903:     var cm = op.cm, display = cm.display, doc = cm.doc;",
          "3905:     if (op.updatedDisplay) { postUpdateDisplay(cm, op.update); }",
          "3908:     if (display.wheelStartX != null && (op.scrollTop != null || op.scrollLeft != null || op.scrollToPos))",
          "3909:       { display.wheelStartX = display.wheelStartY = null; }",
          "3912:     if (op.scrollTop != null) { setScrollTop(cm, op.scrollTop, op.forceScroll); }",
          "3914:     if (op.scrollLeft != null) { setScrollLeft(cm, op.scrollLeft, true, true); }",
          "3916:     if (op.scrollToPos) {",
          "3917:       var rect = scrollPosIntoView(cm, clipPos(doc, op.scrollToPos.from),",
          "3918:                                    clipPos(doc, op.scrollToPos.to), op.scrollToPos.margin);",
          "3919:       maybeScrollWindow(cm, rect);",
          "3920:     }",
          "3924:     var hidden = op.maybeHiddenMarkers, unhidden = op.maybeUnhiddenMarkers;",
          "3925:     if (hidden) { for (var i = 0; i < hidden.length; ++i)",
          "3926:       { if (!hidden[i].lines.length) { signal(hidden[i], \"hide\"); } } }",
          "3927:     if (unhidden) { for (var i$1 = 0; i$1 < unhidden.length; ++i$1)",
          "3928:       { if (unhidden[i$1].lines.length) { signal(unhidden[i$1], \"unhide\"); } } }",
          "3930:     if (display.wrapper.offsetHeight)",
          "3931:       { doc.scrollTop = cm.display.scroller.scrollTop; }",
          "3934:     if (op.changeObjs)",
          "3935:       { signal(cm, \"changes\", cm, op.changeObjs); }",
          "3936:     if (op.update)",
          "3937:       { op.update.finish(); }",
          "3938:   }",
          "3941:   function runInOp(cm, f) {",
          "3942:     if (cm.curOp) { return f() }",
          "3943:     startOperation(cm);",
          "3944:     try { return f() }",
          "3945:     finally { endOperation(cm); }",
          "3946:   }",
          "3948:   function operation(cm, f) {",
          "3949:     return function() {",
          "3950:       if (cm.curOp) { return f.apply(cm, arguments) }",
          "3951:       startOperation(cm);",
          "3952:       try { return f.apply(cm, arguments) }",
          "3953:       finally { endOperation(cm); }",
          "3954:     }",
          "3955:   }",
          "3958:   function methodOp(f) {",
          "3959:     return function() {",
          "3960:       if (this.curOp) { return f.apply(this, arguments) }",
          "3961:       startOperation(this);",
          "3962:       try { return f.apply(this, arguments) }",
          "3963:       finally { endOperation(this); }",
          "3964:     }",
          "3965:   }",
          "3966:   function docMethodOp(f) {",
          "3967:     return function() {",
          "3968:       var cm = this.cm;",
          "3969:       if (!cm || cm.curOp) { return f.apply(this, arguments) }",
          "3970:       startOperation(cm);",
          "3971:       try { return f.apply(this, arguments) }",
          "3972:       finally { endOperation(cm); }",
          "3973:     }",
          "3974:   }",
          "3978:   function startWorker(cm, time) {",
          "3979:     if (cm.doc.highlightFrontier < cm.display.viewTo)",
          "3980:       { cm.state.highlight.set(time, bind(highlightWorker, cm)); }",
          "3981:   }",
          "3983:   function highlightWorker(cm) {",
          "3984:     var doc = cm.doc;",
          "3985:     if (doc.highlightFrontier >= cm.display.viewTo) { return }",
          "3986:     var end = +new Date + cm.options.workTime;",
          "3987:     var context = getContextBefore(cm, doc.highlightFrontier);",
          "3988:     var changedLines = [];",
          "3990:     doc.iter(context.line, Math.min(doc.first + doc.size, cm.display.viewTo + 500), function (line) {",
          "3991:       if (context.line >= cm.display.viewFrom) { // Visible",
          "3992:         var oldStyles = line.styles;",
          "3993:         var resetState = line.text.length > cm.options.maxHighlightLength ? copyState(doc.mode, context.state) : null;",
          "3994:         var highlighted = highlightLine(cm, line, context, true);",
          "3995:         if (resetState) { context.state = resetState; }",
          "3996:         line.styles = highlighted.styles;",
          "3997:         var oldCls = line.styleClasses, newCls = highlighted.classes;",
          "3998:         if (newCls) { line.styleClasses = newCls; }",
          "3999:         else if (oldCls) { line.styleClasses = null; }",
          "4000:         var ischange = !oldStyles || oldStyles.length != line.styles.length ||",
          "4001:           oldCls != newCls && (!oldCls || !newCls || oldCls.bgClass != newCls.bgClass || oldCls.textClass != newCls.textClass);",
          "4002:         for (var i = 0; !ischange && i < oldStyles.length; ++i) { ischange = oldStyles[i] != line.styles[i]; }",
          "4003:         if (ischange) { changedLines.push(context.line); }",
          "4004:         line.stateAfter = context.save();",
          "4005:         context.nextLine();",
          "4006:       } else {",
          "4007:         if (line.text.length <= cm.options.maxHighlightLength)",
          "4008:           { processLine(cm, line.text, context); }",
          "4009:         line.stateAfter = context.line % 5 == 0 ? context.save() : null;",
          "4010:         context.nextLine();",
          "4011:       }",
          "4012:       if (+new Date > end) {",
          "4013:         startWorker(cm, cm.options.workDelay);",
          "4014:         return true",
          "4015:       }",
          "4016:     });",
          "4017:     doc.highlightFrontier = context.line;",
          "4018:     doc.modeFrontier = Math.max(doc.modeFrontier, context.line);",
          "4019:     if (changedLines.length) { runInOp(cm, function () {",
          "4020:       for (var i = 0; i < changedLines.length; i++)",
          "4021:         { regLineChange(cm, changedLines[i], \"text\"); }",
          "4022:     }); }",
          "4023:   }",
          "4027:   var DisplayUpdate = function(cm, viewport, force) {",
          "4028:     var display = cm.display;",
          "4030:     this.viewport = viewport;",
          "4032:     this.visible = visibleLines(display, cm.doc, viewport);",
          "4033:     this.editorIsHidden = !display.wrapper.offsetWidth;",
          "4034:     this.wrapperHeight = display.wrapper.clientHeight;",
          "4035:     this.wrapperWidth = display.wrapper.clientWidth;",
          "4036:     this.oldDisplayWidth = displayWidth(cm);",
          "4037:     this.force = force;",
          "4038:     this.dims = getDimensions(cm);",
          "4039:     this.events = [];",
          "4040:   };",
          "4042:   DisplayUpdate.prototype.signal = function (emitter, type) {",
          "4043:     if (hasHandler(emitter, type))",
          "4044:       { this.events.push(arguments); }",
          "4045:   };",
          "4046:   DisplayUpdate.prototype.finish = function () {",
          "4047:     for (var i = 0; i < this.events.length; i++)",
          "4048:       { signal.apply(null, this.events[i]); }",
          "4049:   };",
          "4051:   function maybeClipScrollbars(cm) {",
          "4052:     var display = cm.display;",
          "4053:     if (!display.scrollbarsClipped && display.scroller.offsetWidth) {",
          "4054:       display.nativeBarWidth = display.scroller.offsetWidth - display.scroller.clientWidth;",
          "4055:       display.heightForcer.style.height = scrollGap(cm) + \"px\";",
          "4056:       display.sizer.style.marginBottom = -display.nativeBarWidth + \"px\";",
          "4057:       display.sizer.style.borderRightWidth = scrollGap(cm) + \"px\";",
          "4058:       display.scrollbarsClipped = true;",
          "4059:     }",
          "4060:   }",
          "4062:   function selectionSnapshot(cm) {",
          "4063:     if (cm.hasFocus()) { return null }",
          "4064:     var active = activeElt();",
          "4065:     if (!active || !contains(cm.display.lineDiv, active)) { return null }",
          "4066:     var result = {activeElt: active};",
          "4067:     if (window.getSelection) {",
          "4068:       var sel = window.getSelection();",
          "4069:       if (sel.anchorNode && sel.extend && contains(cm.display.lineDiv, sel.anchorNode)) {",
          "4070:         result.anchorNode = sel.anchorNode;",
          "4071:         result.anchorOffset = sel.anchorOffset;",
          "4072:         result.focusNode = sel.focusNode;",
          "4073:         result.focusOffset = sel.focusOffset;",
          "4074:       }",
          "4075:     }",
          "4076:     return result",
          "4077:   }",
          "4079:   function restoreSelection(snapshot) {",
          "4080:     if (!snapshot || !snapshot.activeElt || snapshot.activeElt == activeElt()) { return }",
          "4081:     snapshot.activeElt.focus();",
          "4082:     if (!/^(INPUT|TEXTAREA)$/.test(snapshot.activeElt.nodeName) &&",
          "4083:         snapshot.anchorNode && contains(document.body, snapshot.anchorNode) && contains(document.body, snapshot.focusNode)) {",
          "4084:       var sel = window.getSelection(), range = document.createRange();",
          "4085:       range.setEnd(snapshot.anchorNode, snapshot.anchorOffset);",
          "4086:       range.collapse(false);",
          "4087:       sel.removeAllRanges();",
          "4088:       sel.addRange(range);",
          "4089:       sel.extend(snapshot.focusNode, snapshot.focusOffset);",
          "4090:     }",
          "4091:   }",
          "4096:   function updateDisplayIfNeeded(cm, update) {",
          "4097:     var display = cm.display, doc = cm.doc;",
          "4099:     if (update.editorIsHidden) {",
          "4100:       resetView(cm);",
          "4101:       return false",
          "4102:     }",
          "4105:     if (!update.force &&",
          "4106:         update.visible.from >= display.viewFrom && update.visible.to <= display.viewTo &&",
          "4107:         (display.updateLineNumbers == null || display.updateLineNumbers >= display.viewTo) &&",
          "4108:         display.renderedView == display.view && countDirtyView(cm) == 0)",
          "4109:       { return false }",
          "4111:     if (maybeUpdateLineNumberWidth(cm)) {",
          "4112:       resetView(cm);",
          "4113:       update.dims = getDimensions(cm);",
          "4114:     }",
          "4117:     var end = doc.first + doc.size;",
          "4118:     var from = Math.max(update.visible.from - cm.options.viewportMargin, doc.first);",
          "4119:     var to = Math.min(end, update.visible.to + cm.options.viewportMargin);",
          "4120:     if (display.viewFrom < from && from - display.viewFrom < 20) { from = Math.max(doc.first, display.viewFrom); }",
          "4121:     if (display.viewTo > to && display.viewTo - to < 20) { to = Math.min(end, display.viewTo); }",
          "4122:     if (sawCollapsedSpans) {",
          "4123:       from = visualLineNo(cm.doc, from);",
          "4124:       to = visualLineEndNo(cm.doc, to);",
          "4125:     }",
          "4127:     var different = from != display.viewFrom || to != display.viewTo ||",
          "4128:       display.lastWrapHeight != update.wrapperHeight || display.lastWrapWidth != update.wrapperWidth;",
          "4129:     adjustView(cm, from, to);",
          "4131:     display.viewOffset = heightAtLine(getLine(cm.doc, display.viewFrom));",
          "4133:     cm.display.mover.style.top = display.viewOffset + \"px\";",
          "4135:     var toUpdate = countDirtyView(cm);",
          "4136:     if (!different && toUpdate == 0 && !update.force && display.renderedView == display.view &&",
          "4137:         (display.updateLineNumbers == null || display.updateLineNumbers >= display.viewTo))",
          "4138:       { return false }",
          "4142:     var selSnapshot = selectionSnapshot(cm);",
          "4143:     if (toUpdate > 4) { display.lineDiv.style.display = \"none\"; }",
          "4144:     patchDisplay(cm, display.updateLineNumbers, update.dims);",
          "4145:     if (toUpdate > 4) { display.lineDiv.style.display = \"\"; }",
          "4146:     display.renderedView = display.view;",
          "4149:     restoreSelection(selSnapshot);",
          "4153:     removeChildren(display.cursorDiv);",
          "4154:     removeChildren(display.selectionDiv);",
          "4155:     display.gutters.style.height = display.sizer.style.minHeight = 0;",
          "4157:     if (different) {",
          "4158:       display.lastWrapHeight = update.wrapperHeight;",
          "4159:       display.lastWrapWidth = update.wrapperWidth;",
          "4160:       startWorker(cm, 400);",
          "4161:     }",
          "4163:     display.updateLineNumbers = null;",
          "4165:     return true",
          "4166:   }",
          "4168:   function postUpdateDisplay(cm, update) {",
          "4169:     var viewport = update.viewport;",
          "4171:     for (var first = true;; first = false) {",
          "4172:       if (!first || !cm.options.lineWrapping || update.oldDisplayWidth == displayWidth(cm)) {",
          "4174:         if (viewport && viewport.top != null)",
          "4175:           { viewport = {top: Math.min(cm.doc.height + paddingVert(cm.display) - displayHeight(cm), viewport.top)}; }",
          "4178:         update.visible = visibleLines(cm.display, cm.doc, viewport);",
          "4179:         if (update.visible.from >= cm.display.viewFrom && update.visible.to <= cm.display.viewTo)",
          "4180:           { break }",
          "4181:       } else if (first) {",
          "4182:         update.visible = visibleLines(cm.display, cm.doc, viewport);",
          "4183:       }",
          "4184:       if (!updateDisplayIfNeeded(cm, update)) { break }",
          "4185:       updateHeightsInViewport(cm);",
          "4186:       var barMeasure = measureForScrollbars(cm);",
          "4187:       updateSelection(cm);",
          "4188:       updateScrollbars(cm, barMeasure);",
          "4189:       setDocumentHeight(cm, barMeasure);",
          "4190:       update.force = false;",
          "4191:     }",
          "4193:     update.signal(cm, \"update\", cm);",
          "4194:     if (cm.display.viewFrom != cm.display.reportedViewFrom || cm.display.viewTo != cm.display.reportedViewTo) {",
          "4195:       update.signal(cm, \"viewportChange\", cm, cm.display.viewFrom, cm.display.viewTo);",
          "4196:       cm.display.reportedViewFrom = cm.display.viewFrom; cm.display.reportedViewTo = cm.display.viewTo;",
          "4197:     }",
          "4198:   }",
          "4200:   function updateDisplaySimple(cm, viewport) {",
          "4201:     var update = new DisplayUpdate(cm, viewport);",
          "4202:     if (updateDisplayIfNeeded(cm, update)) {",
          "4203:       updateHeightsInViewport(cm);",
          "4204:       postUpdateDisplay(cm, update);",
          "4205:       var barMeasure = measureForScrollbars(cm);",
          "4206:       updateSelection(cm);",
          "4207:       updateScrollbars(cm, barMeasure);",
          "4208:       setDocumentHeight(cm, barMeasure);",
          "4209:       update.finish();",
          "4210:     }",
          "4211:   }",
          "4217:   function patchDisplay(cm, updateNumbersFrom, dims) {",
          "4218:     var display = cm.display, lineNumbers = cm.options.lineNumbers;",
          "4219:     var container = display.lineDiv, cur = container.firstChild;",
          "4221:     function rm(node) {",
          "4222:       var next = node.nextSibling;",
          "4224:       if (webkit && mac && cm.display.currentWheelTarget == node)",
          "4225:         { node.style.display = \"none\"; }",
          "4226:       else",
          "4227:         { node.parentNode.removeChild(node); }",
          "4228:       return next",
          "4229:     }",
          "4231:     var view = display.view, lineN = display.viewFrom;",
          "4234:     for (var i = 0; i < view.length; i++) {",
          "4235:       var lineView = view[i];",
          "4236:       if (lineView.hidden) ; else if (!lineView.node || lineView.node.parentNode != container) { // Not drawn yet",
          "4237:         var node = buildLineElement(cm, lineView, lineN, dims);",
          "4238:         container.insertBefore(node, cur);",
          "4239:       } else { // Already drawn",
          "4240:         while (cur != lineView.node) { cur = rm(cur); }",
          "4241:         var updateNumber = lineNumbers && updateNumbersFrom != null &&",
          "4242:           updateNumbersFrom <= lineN && lineView.lineNumber;",
          "4243:         if (lineView.changes) {",
          "4244:           if (indexOf(lineView.changes, \"gutter\") > -1) { updateNumber = false; }",
          "4245:           updateLineForChanges(cm, lineView, lineN, dims);",
          "4246:         }",
          "4247:         if (updateNumber) {",
          "4248:           removeChildren(lineView.lineNumber);",
          "4249:           lineView.lineNumber.appendChild(document.createTextNode(lineNumberFor(cm.options, lineN)));",
          "4250:         }",
          "4251:         cur = lineView.node.nextSibling;",
          "4252:       }",
          "4253:       lineN += lineView.size;",
          "4254:     }",
          "4255:     while (cur) { cur = rm(cur); }",
          "4256:   }",
          "4258:   function updateGutterSpace(display) {",
          "4259:     var width = display.gutters.offsetWidth;",
          "4260:     display.sizer.style.marginLeft = width + \"px\";",
          "4262:     signalLater(display, \"gutterChanged\", display);",
          "4263:   }",
          "4265:   function setDocumentHeight(cm, measure) {",
          "4266:     cm.display.sizer.style.minHeight = measure.docHeight + \"px\";",
          "4267:     cm.display.heightForcer.style.top = measure.docHeight + \"px\";",
          "4268:     cm.display.gutters.style.height = (measure.docHeight + cm.display.barHeight + scrollGap(cm)) + \"px\";",
          "4269:   }",
          "4273:   function alignHorizontally(cm) {",
          "4274:     var display = cm.display, view = display.view;",
          "4275:     if (!display.alignWidgets && (!display.gutters.firstChild || !cm.options.fixedGutter)) { return }",
          "4276:     var comp = compensateForHScroll(display) - display.scroller.scrollLeft + cm.doc.scrollLeft;",
          "4277:     var gutterW = display.gutters.offsetWidth, left = comp + \"px\";",
          "4278:     for (var i = 0; i < view.length; i++) { if (!view[i].hidden) {",
          "4279:       if (cm.options.fixedGutter) {",
          "4280:         if (view[i].gutter)",
          "4281:           { view[i].gutter.style.left = left; }",
          "4282:         if (view[i].gutterBackground)",
          "4283:           { view[i].gutterBackground.style.left = left; }",
          "4284:       }",
          "4285:       var align = view[i].alignable;",
          "4286:       if (align) { for (var j = 0; j < align.length; j++)",
          "4287:         { align[j].style.left = left; } }",
          "4288:     } }",
          "4289:     if (cm.options.fixedGutter)",
          "4290:       { display.gutters.style.left = (comp + gutterW) + \"px\"; }",
          "4291:   }",
          "4296:   function maybeUpdateLineNumberWidth(cm) {",
          "4297:     if (!cm.options.lineNumbers) { return false }",
          "4298:     var doc = cm.doc, last = lineNumberFor(cm.options, doc.first + doc.size - 1), display = cm.display;",
          "4299:     if (last.length != display.lineNumChars) {",
          "4300:       var test = display.measure.appendChild(elt(\"div\", [elt(\"div\", last)],",
          "4301:                                                  \"CodeMirror-linenumber CodeMirror-gutter-elt\"));",
          "4302:       var innerW = test.firstChild.offsetWidth, padding = test.offsetWidth - innerW;",
          "4303:       display.lineGutter.style.width = \"\";",
          "4304:       display.lineNumInnerWidth = Math.max(innerW, display.lineGutter.offsetWidth - padding) + 1;",
          "4305:       display.lineNumWidth = display.lineNumInnerWidth + padding;",
          "4306:       display.lineNumChars = display.lineNumInnerWidth ? last.length : -1;",
          "4307:       display.lineGutter.style.width = display.lineNumWidth + \"px\";",
          "4308:       updateGutterSpace(cm.display);",
          "4309:       return true",
          "4310:     }",
          "4311:     return false",
          "4312:   }",
          "4314:   function getGutters(gutters, lineNumbers) {",
          "4315:     var result = [], sawLineNumbers = false;",
          "4316:     for (var i = 0; i < gutters.length; i++) {",
          "4317:       var name = gutters[i], style = null;",
          "4318:       if (typeof name != \"string\") { style = name.style; name = name.className; }",
          "4319:       if (name == \"CodeMirror-linenumbers\") {",
          "4320:         if (!lineNumbers) { continue }",
          "4321:         else { sawLineNumbers = true; }",
          "4322:       }",
          "4323:       result.push({className: name, style: style});",
          "4324:     }",
          "4325:     if (lineNumbers && !sawLineNumbers) { result.push({className: \"CodeMirror-linenumbers\", style: null}); }",
          "4326:     return result",
          "4327:   }",
          "4331:   function renderGutters(display) {",
          "4332:     var gutters = display.gutters, specs = display.gutterSpecs;",
          "4333:     removeChildren(gutters);",
          "4334:     display.lineGutter = null;",
          "4335:     for (var i = 0; i < specs.length; ++i) {",
          "4336:       var ref = specs[i];",
          "4337:       var className = ref.className;",
          "4338:       var style = ref.style;",
          "4339:       var gElt = gutters.appendChild(elt(\"div\", null, \"CodeMirror-gutter \" + className));",
          "4340:       if (style) { gElt.style.cssText = style; }",
          "4341:       if (className == \"CodeMirror-linenumbers\") {",
          "4342:         display.lineGutter = gElt;",
          "4343:         gElt.style.width = (display.lineNumWidth || 1) + \"px\";",
          "4344:       }",
          "4345:     }",
          "4346:     gutters.style.display = specs.length ? \"\" : \"none\";",
          "4347:     updateGutterSpace(display);",
          "4348:   }",
          "4350:   function updateGutters(cm) {",
          "4351:     renderGutters(cm.display);",
          "4352:     regChange(cm);",
          "4353:     alignHorizontally(cm);",
          "4354:   }",
          "4360:   function Display(place, doc, input, options) {",
          "4361:     var d = this;",
          "4362:     this.input = input;",
          "4365:     d.scrollbarFiller = elt(\"div\", null, \"CodeMirror-scrollbar-filler\");",
          "4366:     d.scrollbarFiller.setAttribute(\"cm-not-content\", \"true\");",
          "4369:     d.gutterFiller = elt(\"div\", null, \"CodeMirror-gutter-filler\");",
          "4370:     d.gutterFiller.setAttribute(\"cm-not-content\", \"true\");",
          "4372:     d.lineDiv = eltP(\"div\", null, \"CodeMirror-code\");",
          "4374:     d.selectionDiv = elt(\"div\", null, null, \"position: relative; z-index: 1\");",
          "4375:     d.cursorDiv = elt(\"div\", null, \"CodeMirror-cursors\");",
          "4377:     d.measure = elt(\"div\", null, \"CodeMirror-measure\");",
          "4379:     d.lineMeasure = elt(\"div\", null, \"CodeMirror-measure\");",
          "4381:     d.lineSpace = eltP(\"div\", [d.measure, d.lineMeasure, d.selectionDiv, d.cursorDiv, d.lineDiv],",
          "4382:                       null, \"position: relative; outline: none\");",
          "4383:     var lines = eltP(\"div\", [d.lineSpace], \"CodeMirror-lines\");",
          "4385:     d.mover = elt(\"div\", [lines], null, \"position: relative\");",
          "4387:     d.sizer = elt(\"div\", [d.mover], \"CodeMirror-sizer\");",
          "4388:     d.sizerWidth = null;",
          "4392:     d.heightForcer = elt(\"div\", null, null, \"position: absolute; height: \" + scrollerGap + \"px; width: 1px;\");",
          "4394:     d.gutters = elt(\"div\", null, \"CodeMirror-gutters\");",
          "4395:     d.lineGutter = null;",
          "4397:     d.scroller = elt(\"div\", [d.sizer, d.heightForcer, d.gutters], \"CodeMirror-scroll\");",
          "4398:     d.scroller.setAttribute(\"tabIndex\", \"-1\");",
          "4400:     d.wrapper = elt(\"div\", [d.scrollbarFiller, d.gutterFiller, d.scroller], \"CodeMirror\");",
          "4404:     d.wrapper.setAttribute('translate', 'no');",
          "4407:     if (ie && ie_version < 8) { d.gutters.style.zIndex = -1; d.scroller.style.paddingRight = 0; }",
          "4408:     if (!webkit && !(gecko && mobile)) { d.scroller.draggable = true; }",
          "4410:     if (place) {",
          "4411:       if (place.appendChild) { place.appendChild(d.wrapper); }",
          "4412:       else { place(d.wrapper); }",
          "4413:     }",
          "4416:     d.viewFrom = d.viewTo = doc.first;",
          "4417:     d.reportedViewFrom = d.reportedViewTo = doc.first;",
          "4419:     d.view = [];",
          "4420:     d.renderedView = null;",
          "4423:     d.externalMeasured = null;",
          "4425:     d.viewOffset = 0;",
          "4426:     d.lastWrapHeight = d.lastWrapWidth = 0;",
          "4427:     d.updateLineNumbers = null;",
          "4429:     d.nativeBarWidth = d.barHeight = d.barWidth = 0;",
          "4430:     d.scrollbarsClipped = false;",
          "4434:     d.lineNumWidth = d.lineNumInnerWidth = d.lineNumChars = null;",
          "4438:     d.alignWidgets = false;",
          "4440:     d.cachedCharWidth = d.cachedTextHeight = d.cachedPaddingH = null;",
          "4444:     d.maxLine = null;",
          "4445:     d.maxLineLength = 0;",
          "4446:     d.maxLineChanged = false;",
          "4449:     d.wheelDX = d.wheelDY = d.wheelStartX = d.wheelStartY = null;",
          "4452:     d.shift = false;",
          "4456:     d.selForContextMenu = null;",
          "4458:     d.activeTouch = null;",
          "4460:     d.gutterSpecs = getGutters(options.gutters, options.lineNumbers);",
          "4461:     renderGutters(d);",
          "4463:     input.init(d);",
          "4464:   }",
          "4477:   var wheelSamples = 0, wheelPixelsPerUnit = null;",
          "4482:   if (ie) { wheelPixelsPerUnit = -.53; }",
          "4483:   else if (gecko) { wheelPixelsPerUnit = 15; }",
          "4484:   else if (chrome) { wheelPixelsPerUnit = -.7; }",
          "4485:   else if (safari) { wheelPixelsPerUnit = -1/3; }",
          "4487:   function wheelEventDelta(e) {",
          "4488:     var dx = e.wheelDeltaX, dy = e.wheelDeltaY;",
          "4489:     if (dx == null && e.detail && e.axis == e.HORIZONTAL_AXIS) { dx = e.detail; }",
          "4490:     if (dy == null && e.detail && e.axis == e.VERTICAL_AXIS) { dy = e.detail; }",
          "4491:     else if (dy == null) { dy = e.wheelDelta; }",
          "4492:     return {x: dx, y: dy}",
          "4493:   }",
          "4494:   function wheelEventPixels(e) {",
          "4495:     var delta = wheelEventDelta(e);",
          "4496:     delta.x *= wheelPixelsPerUnit;",
          "4497:     delta.y *= wheelPixelsPerUnit;",
          "4498:     return delta",
          "4499:   }",
          "4501:   function onScrollWheel(cm, e) {",
          "4502:     var delta = wheelEventDelta(e), dx = delta.x, dy = delta.y;",
          "4503:     var pixelsPerUnit = wheelPixelsPerUnit;",
          "4504:     if (event.deltaMode === 0) {",
          "4505:       dx = e.deltaX;",
          "4506:       dy = e.deltaY;",
          "4507:       pixelsPerUnit = 1;",
          "4508:     }",
          "4510:     var display = cm.display, scroll = display.scroller;",
          "4512:     var canScrollX = scroll.scrollWidth > scroll.clientWidth;",
          "4513:     var canScrollY = scroll.scrollHeight > scroll.clientHeight;",
          "4514:     if (!(dx && canScrollX || dy && canScrollY)) { return }",
          "4520:     if (dy && mac && webkit) {",
          "4521:       outer: for (var cur = e.target, view = display.view; cur != scroll; cur = cur.parentNode) {",
          "4522:         for (var i = 0; i < view.length; i++) {",
          "4523:           if (view[i].node == cur) {",
          "4524:             cm.display.currentWheelTarget = cur;",
          "4525:             break outer",
          "4526:           }",
          "4527:         }",
          "4528:       }",
          "4529:     }",
          "4537:     if (dx && !gecko && !presto && pixelsPerUnit != null) {",
          "4538:       if (dy && canScrollY)",
          "4539:         { updateScrollTop(cm, Math.max(0, scroll.scrollTop + dy * pixelsPerUnit)); }",
          "4540:       setScrollLeft(cm, Math.max(0, scroll.scrollLeft + dx * pixelsPerUnit));",
          "4545:       if (!dy || (dy && canScrollY))",
          "4546:         { e_preventDefault(e); }",
          "4547:       display.wheelStartX = null; // Abort measurement, if in progress",
          "4548:       return",
          "4549:     }",
          "4553:     if (dy && pixelsPerUnit != null) {",
          "4554:       var pixels = dy * pixelsPerUnit;",
          "4555:       var top = cm.doc.scrollTop, bot = top + display.wrapper.clientHeight;",
          "4556:       if (pixels < 0) { top = Math.max(0, top + pixels - 50); }",
          "4557:       else { bot = Math.min(cm.doc.height, bot + pixels + 50); }",
          "4558:       updateDisplaySimple(cm, {top: top, bottom: bot});",
          "4559:     }",
          "4561:     if (wheelSamples < 20 && e.deltaMode !== 0) {",
          "4562:       if (display.wheelStartX == null) {",
          "4563:         display.wheelStartX = scroll.scrollLeft; display.wheelStartY = scroll.scrollTop;",
          "4564:         display.wheelDX = dx; display.wheelDY = dy;",
          "4565:         setTimeout(function () {",
          "4566:           if (display.wheelStartX == null) { return }",
          "4567:           var movedX = scroll.scrollLeft - display.wheelStartX;",
          "4568:           var movedY = scroll.scrollTop - display.wheelStartY;",
          "4569:           var sample = (movedY && display.wheelDY && movedY / display.wheelDY) ||",
          "4570:             (movedX && display.wheelDX && movedX / display.wheelDX);",
          "4571:           display.wheelStartX = display.wheelStartY = null;",
          "4572:           if (!sample) { return }",
          "4573:           wheelPixelsPerUnit = (wheelPixelsPerUnit * wheelSamples + sample) / (wheelSamples + 1);",
          "4574:           ++wheelSamples;",
          "4575:         }, 200);",
          "4576:       } else {",
          "4577:         display.wheelDX += dx; display.wheelDY += dy;",
          "4578:       }",
          "4579:     }",
          "4580:   }",
          "4587:   var Selection = function(ranges, primIndex) {",
          "4588:     this.ranges = ranges;",
          "4589:     this.primIndex = primIndex;",
          "4590:   };",
          "4592:   Selection.prototype.primary = function () { return this.ranges[this.primIndex] };",
          "4594:   Selection.prototype.equals = function (other) {",
          "4595:     if (other == this) { return true }",
          "4596:     if (other.primIndex != this.primIndex || other.ranges.length != this.ranges.length) { return false }",
          "4597:     for (var i = 0; i < this.ranges.length; i++) {",
          "4598:       var here = this.ranges[i], there = other.ranges[i];",
          "4599:       if (!equalCursorPos(here.anchor, there.anchor) || !equalCursorPos(here.head, there.head)) { return false }",
          "4600:     }",
          "4601:     return true",
          "4602:   };",
          "4604:   Selection.prototype.deepCopy = function () {",
          "4605:     var out = [];",
          "4606:     for (var i = 0; i < this.ranges.length; i++)",
          "4607:       { out[i] = new Range(copyPos(this.ranges[i].anchor), copyPos(this.ranges[i].head)); }",
          "4608:     return new Selection(out, this.primIndex)",
          "4609:   };",
          "4611:   Selection.prototype.somethingSelected = function () {",
          "4612:     for (var i = 0; i < this.ranges.length; i++)",
          "4613:       { if (!this.ranges[i].empty()) { return true } }",
          "4614:     return false",
          "4615:   };",
          "4617:   Selection.prototype.contains = function (pos, end) {",
          "4618:     if (!end) { end = pos; }",
          "4619:     for (var i = 0; i < this.ranges.length; i++) {",
          "4620:       var range = this.ranges[i];",
          "4621:       if (cmp(end, range.from()) >= 0 && cmp(pos, range.to()) <= 0)",
          "4622:         { return i }",
          "4623:     }",
          "4624:     return -1",
          "4625:   };",
          "4627:   var Range = function(anchor, head) {",
          "4628:     this.anchor = anchor; this.head = head;",
          "4629:   };",
          "4631:   Range.prototype.from = function () { return minPos(this.anchor, this.head) };",
          "4632:   Range.prototype.to = function () { return maxPos(this.anchor, this.head) };",
          "4633:   Range.prototype.empty = function () { return this.head.line == this.anchor.line && this.head.ch == this.anchor.ch };",
          "4638:   function normalizeSelection(cm, ranges, primIndex) {",
          "4639:     var mayTouch = cm && cm.options.selectionsMayTouch;",
          "4640:     var prim = ranges[primIndex];",
          "4641:     ranges.sort(function (a, b) { return cmp(a.from(), b.from()); });",
          "4642:     primIndex = indexOf(ranges, prim);",
          "4643:     for (var i = 1; i < ranges.length; i++) {",
          "4644:       var cur = ranges[i], prev = ranges[i - 1];",
          "4645:       var diff = cmp(prev.to(), cur.from());",
          "4646:       if (mayTouch && !cur.empty() ? diff > 0 : diff >= 0) {",
          "4647:         var from = minPos(prev.from(), cur.from()), to = maxPos(prev.to(), cur.to());",
          "4648:         var inv = prev.empty() ? cur.from() == cur.head : prev.from() == prev.head;",
          "4649:         if (i <= primIndex) { --primIndex; }",
          "4650:         ranges.splice(--i, 2, new Range(inv ? to : from, inv ? from : to));",
          "4651:       }",
          "4652:     }",
          "4653:     return new Selection(ranges, primIndex)",
          "4654:   }",
          "4656:   function simpleSelection(anchor, head) {",
          "4657:     return new Selection([new Range(anchor, head || anchor)], 0)",
          "4658:   }",
          "4662:   function changeEnd(change) {",
          "4663:     if (!change.text) { return change.to }",
          "4664:     return Pos(change.from.line + change.text.length - 1,",
          "4665:                lst(change.text).length + (change.text.length == 1 ? change.from.ch : 0))",
          "4666:   }",
          "4670:   function adjustForChange(pos, change) {",
          "4671:     if (cmp(pos, change.from) < 0) { return pos }",
          "4672:     if (cmp(pos, change.to) <= 0) { return changeEnd(change) }",
          "4674:     var line = pos.line + change.text.length - (change.to.line - change.from.line) - 1, ch = pos.ch;",
          "4675:     if (pos.line == change.to.line) { ch += changeEnd(change).ch - change.to.ch; }",
          "4676:     return Pos(line, ch)",
          "4677:   }",
          "4679:   function computeSelAfterChange(doc, change) {",
          "4680:     var out = [];",
          "4681:     for (var i = 0; i < doc.sel.ranges.length; i++) {",
          "4682:       var range = doc.sel.ranges[i];",
          "4683:       out.push(new Range(adjustForChange(range.anchor, change),",
          "4684:                          adjustForChange(range.head, change)));",
          "4685:     }",
          "4686:     return normalizeSelection(doc.cm, out, doc.sel.primIndex)",
          "4687:   }",
          "4689:   function offsetPos(pos, old, nw) {",
          "4690:     if (pos.line == old.line)",
          "4691:       { return Pos(nw.line, pos.ch - old.ch + nw.ch) }",
          "4692:     else",
          "4693:       { return Pos(nw.line + (pos.line - old.line), pos.ch) }",
          "4694:   }",
          "4698:   function computeReplacedSel(doc, changes, hint) {",
          "4699:     var out = [];",
          "4700:     var oldPrev = Pos(doc.first, 0), newPrev = oldPrev;",
          "4701:     for (var i = 0; i < changes.length; i++) {",
          "4702:       var change = changes[i];",
          "4703:       var from = offsetPos(change.from, oldPrev, newPrev);",
          "4704:       var to = offsetPos(changeEnd(change), oldPrev, newPrev);",
          "4705:       oldPrev = change.to;",
          "4706:       newPrev = to;",
          "4707:       if (hint == \"around\") {",
          "4708:         var range = doc.sel.ranges[i], inv = cmp(range.head, range.anchor) < 0;",
          "4709:         out[i] = new Range(inv ? to : from, inv ? from : to);",
          "4710:       } else {",
          "4711:         out[i] = new Range(from, from);",
          "4712:       }",
          "4713:     }",
          "4714:     return new Selection(out, doc.sel.primIndex)",
          "4715:   }",
          "4719:   function loadMode(cm) {",
          "4720:     cm.doc.mode = getMode(cm.options, cm.doc.modeOption);",
          "4721:     resetModeState(cm);",
          "4722:   }",
          "4724:   function resetModeState(cm) {",
          "4725:     cm.doc.iter(function (line) {",
          "4726:       if (line.stateAfter) { line.stateAfter = null; }",
          "4727:       if (line.styles) { line.styles = null; }",
          "4728:     });",
          "4729:     cm.doc.modeFrontier = cm.doc.highlightFrontier = cm.doc.first;",
          "4730:     startWorker(cm, 100);",
          "4731:     cm.state.modeGen++;",
          "4732:     if (cm.curOp) { regChange(cm); }",
          "4733:   }",
          "4740:   function isWholeLineUpdate(doc, change) {",
          "4741:     return change.from.ch == 0 && change.to.ch == 0 && lst(change.text) == \"\" &&",
          "4742:       (!doc.cm || doc.cm.options.wholeLineUpdateBefore)",
          "4743:   }",
          "4746:   function updateDoc(doc, change, markedSpans, estimateHeight) {",
          "4747:     function spansFor(n) {return markedSpans ? markedSpans[n] : null}",
          "4748:     function update(line, text, spans) {",
          "4749:       updateLine(line, text, spans, estimateHeight);",
          "4750:       signalLater(line, \"change\", line, change);",
          "4751:     }",
          "4752:     function linesFor(start, end) {",
          "4753:       var result = [];",
          "4754:       for (var i = start; i < end; ++i)",
          "4755:         { result.push(new Line(text[i], spansFor(i), estimateHeight)); }",
          "4756:       return result",
          "4757:     }",
          "4759:     var from = change.from, to = change.to, text = change.text;",
          "4760:     var firstLine = getLine(doc, from.line), lastLine = getLine(doc, to.line);",
          "4761:     var lastText = lst(text), lastSpans = spansFor(text.length - 1), nlines = to.line - from.line;",
          "4764:     if (change.full) {",
          "4765:       doc.insert(0, linesFor(0, text.length));",
          "4766:       doc.remove(text.length, doc.size - text.length);",
          "4767:     } else if (isWholeLineUpdate(doc, change)) {",
          "4770:       var added = linesFor(0, text.length - 1);",
          "4771:       update(lastLine, lastLine.text, lastSpans);",
          "4772:       if (nlines) { doc.remove(from.line, nlines); }",
          "4773:       if (added.length) { doc.insert(from.line, added); }",
          "4774:     } else if (firstLine == lastLine) {",
          "4775:       if (text.length == 1) {",
          "4776:         update(firstLine, firstLine.text.slice(0, from.ch) + lastText + firstLine.text.slice(to.ch), lastSpans);",
          "4777:       } else {",
          "4778:         var added$1 = linesFor(1, text.length - 1);",
          "4779:         added$1.push(new Line(lastText + firstLine.text.slice(to.ch), lastSpans, estimateHeight));",
          "4780:         update(firstLine, firstLine.text.slice(0, from.ch) + text[0], spansFor(0));",
          "4781:         doc.insert(from.line + 1, added$1);",
          "4782:       }",
          "4783:     } else if (text.length == 1) {",
          "4784:       update(firstLine, firstLine.text.slice(0, from.ch) + text[0] + lastLine.text.slice(to.ch), spansFor(0));",
          "4785:       doc.remove(from.line + 1, nlines);",
          "4786:     } else {",
          "4787:       update(firstLine, firstLine.text.slice(0, from.ch) + text[0], spansFor(0));",
          "4788:       update(lastLine, lastText + lastLine.text.slice(to.ch), lastSpans);",
          "4789:       var added$2 = linesFor(1, text.length - 1);",
          "4790:       if (nlines > 1) { doc.remove(from.line + 1, nlines - 1); }",
          "4791:       doc.insert(from.line + 1, added$2);",
          "4792:     }",
          "4794:     signalLater(doc, \"change\", doc, change);",
          "4795:   }",
          "4798:   function linkedDocs(doc, f, sharedHistOnly) {",
          "4799:     function propagate(doc, skip, sharedHist) {",
          "4800:       if (doc.linked) { for (var i = 0; i < doc.linked.length; ++i) {",
          "4801:         var rel = doc.linked[i];",
          "4802:         if (rel.doc == skip) { continue }",
          "4803:         var shared = sharedHist && rel.sharedHist;",
          "4804:         if (sharedHistOnly && !shared) { continue }",
          "4805:         f(rel.doc, shared);",
          "4806:         propagate(rel.doc, doc, shared);",
          "4807:       } }",
          "4808:     }",
          "4809:     propagate(doc, null, true);",
          "4810:   }",
          "4813:   function attachDoc(cm, doc) {",
          "4814:     if (doc.cm) { throw new Error(\"This document is already in use.\") }",
          "4815:     cm.doc = doc;",
          "4816:     doc.cm = cm;",
          "4817:     estimateLineHeights(cm);",
          "4818:     loadMode(cm);",
          "4819:     setDirectionClass(cm);",
          "4820:     cm.options.direction = doc.direction;",
          "4821:     if (!cm.options.lineWrapping) { findMaxLine(cm); }",
          "4822:     cm.options.mode = doc.modeOption;",
          "4823:     regChange(cm);",
          "4824:   }",
          "4826:   function setDirectionClass(cm) {",
          "4827:   (cm.doc.direction == \"rtl\" ? addClass : rmClass)(cm.display.lineDiv, \"CodeMirror-rtl\");",
          "4828:   }",
          "4830:   function directionChanged(cm) {",
          "4831:     runInOp(cm, function () {",
          "4832:       setDirectionClass(cm);",
          "4833:       regChange(cm);",
          "4834:     });",
          "4835:   }",
          "4837:   function History(prev) {",
          "4841:     this.done = []; this.undone = [];",
          "4842:     this.undoDepth = prev ? prev.undoDepth : Infinity;",
          "4845:     this.lastModTime = this.lastSelTime = 0;",
          "4846:     this.lastOp = this.lastSelOp = null;",
          "4847:     this.lastOrigin = this.lastSelOrigin = null;",
          "4849:     this.generation = this.maxGeneration = prev ? prev.maxGeneration : 1;",
          "4850:   }",
          "4854:   function historyChangeFromChange(doc, change) {",
          "4855:     var histChange = {from: copyPos(change.from), to: changeEnd(change), text: getBetween(doc, change.from, change.to)};",
          "4856:     attachLocalSpans(doc, histChange, change.from.line, change.to.line + 1);",
          "4857:     linkedDocs(doc, function (doc) { return attachLocalSpans(doc, histChange, change.from.line, change.to.line + 1); }, true);",
          "4858:     return histChange",
          "4859:   }",
          "4863:   function clearSelectionEvents(array) {",
          "4864:     while (array.length) {",
          "4865:       var last = lst(array);",
          "4866:       if (last.ranges) { array.pop(); }",
          "4867:       else { break }",
          "4868:     }",
          "4869:   }",
          "4873:   function lastChangeEvent(hist, force) {",
          "4874:     if (force) {",
          "4875:       clearSelectionEvents(hist.done);",
          "4876:       return lst(hist.done)",
          "4877:     } else if (hist.done.length && !lst(hist.done).ranges) {",
          "4878:       return lst(hist.done)",
          "4879:     } else if (hist.done.length > 1 && !hist.done[hist.done.length - 2].ranges) {",
          "4880:       hist.done.pop();",
          "4881:       return lst(hist.done)",
          "4882:     }",
          "4883:   }",
          "4888:   function addChangeToHistory(doc, change, selAfter, opId) {",
          "4889:     var hist = doc.history;",
          "4890:     hist.undone.length = 0;",
          "4891:     var time = +new Date, cur;",
          "4892:     var last;",
          "4894:     if ((hist.lastOp == opId ||",
          "4895:          hist.lastOrigin == change.origin && change.origin &&",
          "4896:          ((change.origin.charAt(0) == \"+\" && hist.lastModTime > time - (doc.cm ? doc.cm.options.historyEventDelay : 500)) ||",
          "4897:           change.origin.charAt(0) == \"*\")) &&",
          "4898:         (cur = lastChangeEvent(hist, hist.lastOp == opId))) {",
          "4900:       last = lst(cur.changes);",
          "4901:       if (cmp(change.from, change.to) == 0 && cmp(change.from, last.to) == 0) {",
          "4904:         last.to = changeEnd(change);",
          "4905:       } else {",
          "4907:         cur.changes.push(historyChangeFromChange(doc, change));",
          "4908:       }",
          "4909:     } else {",
          "4911:       var before = lst(hist.done);",
          "4912:       if (!before || !before.ranges)",
          "4913:         { pushSelectionToHistory(doc.sel, hist.done); }",
          "4914:       cur = {changes: [historyChangeFromChange(doc, change)],",
          "4915:              generation: hist.generation};",
          "4916:       hist.done.push(cur);",
          "4917:       while (hist.done.length > hist.undoDepth) {",
          "4918:         hist.done.shift();",
          "4919:         if (!hist.done[0].ranges) { hist.done.shift(); }",
          "4920:       }",
          "4921:     }",
          "4922:     hist.done.push(selAfter);",
          "4923:     hist.generation = ++hist.maxGeneration;",
          "4924:     hist.lastModTime = hist.lastSelTime = time;",
          "4925:     hist.lastOp = hist.lastSelOp = opId;",
          "4926:     hist.lastOrigin = hist.lastSelOrigin = change.origin;",
          "4928:     if (!last) { signal(doc, \"historyAdded\"); }",
          "4929:   }",
          "4931:   function selectionEventCanBeMerged(doc, origin, prev, sel) {",
          "4932:     var ch = origin.charAt(0);",
          "4933:     return ch == \"*\" ||",
          "4934:       ch == \"+\" &&",
          "4935:       prev.ranges.length == sel.ranges.length &&",
          "4936:       prev.somethingSelected() == sel.somethingSelected() &&",
          "4937:       new Date - doc.history.lastSelTime <= (doc.cm ? doc.cm.options.historyEventDelay : 500)",
          "4938:   }",
          "4944:   function addSelectionToHistory(doc, sel, opId, options) {",
          "4945:     var hist = doc.history, origin = options && options.origin;",
          "4951:     if (opId == hist.lastSelOp ||",
          "4952:         (origin && hist.lastSelOrigin == origin &&",
          "4953:          (hist.lastModTime == hist.lastSelTime && hist.lastOrigin == origin ||",
          "4954:           selectionEventCanBeMerged(doc, origin, lst(hist.done), sel))))",
          "4955:       { hist.done[hist.done.length - 1] = sel; }",
          "4956:     else",
          "4957:       { pushSelectionToHistory(sel, hist.done); }",
          "4959:     hist.lastSelTime = +new Date;",
          "4960:     hist.lastSelOrigin = origin;",
          "4961:     hist.lastSelOp = opId;",
          "4962:     if (options && options.clearRedo !== false)",
          "4963:       { clearSelectionEvents(hist.undone); }",
          "4964:   }",
          "4966:   function pushSelectionToHistory(sel, dest) {",
          "4967:     var top = lst(dest);",
          "4968:     if (!(top && top.ranges && top.equals(sel)))",
          "4969:       { dest.push(sel); }",
          "4970:   }",
          "4973:   function attachLocalSpans(doc, change, from, to) {",
          "4974:     var existing = change[\"spans_\" + doc.id], n = 0;",
          "4975:     doc.iter(Math.max(doc.first, from), Math.min(doc.first + doc.size, to), function (line) {",
          "4976:       if (line.markedSpans)",
          "4977:         { (existing || (existing = change[\"spans_\" + doc.id] = {}))[n] = line.markedSpans; }",
          "4978:       ++n;",
          "4979:     });",
          "4980:   }",
          "4984:   function removeClearedSpans(spans) {",
          "4985:     if (!spans) { return null }",
          "4986:     var out;",
          "4987:     for (var i = 0; i < spans.length; ++i) {",
          "4988:       if (spans[i].marker.explicitlyCleared) { if (!out) { out = spans.slice(0, i); } }",
          "4989:       else if (out) { out.push(spans[i]); }",
          "4990:     }",
          "4991:     return !out ? spans : out.length ? out : null",
          "4992:   }",
          "4995:   function getOldSpans(doc, change) {",
          "4996:     var found = change[\"spans_\" + doc.id];",
          "4997:     if (!found) { return null }",
          "4998:     var nw = [];",
          "4999:     for (var i = 0; i < change.text.length; ++i)",
          "5000:       { nw.push(removeClearedSpans(found[i])); }",
          "5001:     return nw",
          "5002:   }",
          "5008:   function mergeOldSpans(doc, change) {",
          "5009:     var old = getOldSpans(doc, change);",
          "5010:     var stretched = stretchSpansOverChange(doc, change);",
          "5011:     if (!old) { return stretched }",
          "5012:     if (!stretched) { return old }",
          "5014:     for (var i = 0; i < old.length; ++i) {",
          "5015:       var oldCur = old[i], stretchCur = stretched[i];",
          "5016:       if (oldCur && stretchCur) {",
          "5017:         spans: for (var j = 0; j < stretchCur.length; ++j) {",
          "5018:           var span = stretchCur[j];",
          "5019:           for (var k = 0; k < oldCur.length; ++k)",
          "5020:             { if (oldCur[k].marker == span.marker) { continue spans } }",
          "5021:           oldCur.push(span);",
          "5022:         }",
          "5023:       } else if (stretchCur) {",
          "5024:         old[i] = stretchCur;",
          "5025:       }",
          "5026:     }",
          "5027:     return old",
          "5028:   }",
          "5032:   function copyHistoryArray(events, newGroup, instantiateSel) {",
          "5033:     var copy = [];",
          "5034:     for (var i = 0; i < events.length; ++i) {",
          "5035:       var event = events[i];",
          "5036:       if (event.ranges) {",
          "5037:         copy.push(instantiateSel ? Selection.prototype.deepCopy.call(event) : event);",
          "5038:         continue",
          "5039:       }",
          "5040:       var changes = event.changes, newChanges = [];",
          "5041:       copy.push({changes: newChanges});",
          "5042:       for (var j = 0; j < changes.length; ++j) {",
          "5043:         var change = changes[j], m = (void 0);",
          "5044:         newChanges.push({from: change.from, to: change.to, text: change.text});",
          "5045:         if (newGroup) { for (var prop in change) { if (m = prop.match(/^spans_(\\d+)$/)) {",
          "5046:           if (indexOf(newGroup, Number(m[1])) > -1) {",
          "5047:             lst(newChanges)[prop] = change[prop];",
          "5048:             delete change[prop];",
          "5049:           }",
          "5050:         } } }",
          "5051:       }",
          "5052:     }",
          "5053:     return copy",
          "5054:   }",
          "5064:   function extendRange(range, head, other, extend) {",
          "5065:     if (extend) {",
          "5066:       var anchor = range.anchor;",
          "5067:       if (other) {",
          "5068:         var posBefore = cmp(head, anchor) < 0;",
          "5069:         if (posBefore != (cmp(other, anchor) < 0)) {",
          "5070:           anchor = head;",
          "5071:           head = other;",
          "5072:         } else if (posBefore != (cmp(head, other) < 0)) {",
          "5073:           head = other;",
          "5074:         }",
          "5075:       }",
          "5076:       return new Range(anchor, head)",
          "5077:     } else {",
          "5078:       return new Range(other || head, head)",
          "5079:     }",
          "5080:   }",
          "5083:   function extendSelection(doc, head, other, options, extend) {",
          "5084:     if (extend == null) { extend = doc.cm && (doc.cm.display.shift || doc.extend); }",
          "5085:     setSelection(doc, new Selection([extendRange(doc.sel.primary(), head, other, extend)], 0), options);",
          "5086:   }",
          "5090:   function extendSelections(doc, heads, options) {",
          "5091:     var out = [];",
          "5092:     var extend = doc.cm && (doc.cm.display.shift || doc.extend);",
          "5093:     for (var i = 0; i < doc.sel.ranges.length; i++)",
          "5094:       { out[i] = extendRange(doc.sel.ranges[i], heads[i], null, extend); }",
          "5095:     var newSel = normalizeSelection(doc.cm, out, doc.sel.primIndex);",
          "5096:     setSelection(doc, newSel, options);",
          "5097:   }",
          "5100:   function replaceOneSelection(doc, i, range, options) {",
          "5101:     var ranges = doc.sel.ranges.slice(0);",
          "5102:     ranges[i] = range;",
          "5103:     setSelection(doc, normalizeSelection(doc.cm, ranges, doc.sel.primIndex), options);",
          "5104:   }",
          "5107:   function setSimpleSelection(doc, anchor, head, options) {",
          "5108:     setSelection(doc, simpleSelection(anchor, head), options);",
          "5109:   }",
          "5113:   function filterSelectionChange(doc, sel, options) {",
          "5114:     var obj = {",
          "5115:       ranges: sel.ranges,",
          "5116:       update: function(ranges) {",
          "5117:         this.ranges = [];",
          "5118:         for (var i = 0; i < ranges.length; i++)",
          "5119:           { this.ranges[i] = new Range(clipPos(doc, ranges[i].anchor),",
          "5120:                                      clipPos(doc, ranges[i].head)); }",
          "5121:       },",
          "5122:       origin: options && options.origin",
          "5123:     };",
          "5124:     signal(doc, \"beforeSelectionChange\", doc, obj);",
          "5125:     if (doc.cm) { signal(doc.cm, \"beforeSelectionChange\", doc.cm, obj); }",
          "5126:     if (obj.ranges != sel.ranges) { return normalizeSelection(doc.cm, obj.ranges, obj.ranges.length - 1) }",
          "5127:     else { return sel }",
          "5128:   }",
          "5130:   function setSelectionReplaceHistory(doc, sel, options) {",
          "5131:     var done = doc.history.done, last = lst(done);",
          "5132:     if (last && last.ranges) {",
          "5133:       done[done.length - 1] = sel;",
          "5134:       setSelectionNoUndo(doc, sel, options);",
          "5135:     } else {",
          "5136:       setSelection(doc, sel, options);",
          "5137:     }",
          "5138:   }",
          "5141:   function setSelection(doc, sel, options) {",
          "5142:     setSelectionNoUndo(doc, sel, options);",
          "5143:     addSelectionToHistory(doc, doc.sel, doc.cm ? doc.cm.curOp.id : NaN, options);",
          "5144:   }",
          "5146:   function setSelectionNoUndo(doc, sel, options) {",
          "5147:     if (hasHandler(doc, \"beforeSelectionChange\") || doc.cm && hasHandler(doc.cm, \"beforeSelectionChange\"))",
          "5148:       { sel = filterSelectionChange(doc, sel, options); }",
          "5150:     var bias = options && options.bias ||",
          "5151:       (cmp(sel.primary().head, doc.sel.primary().head) < 0 ? -1 : 1);",
          "5152:     setSelectionInner(doc, skipAtomicInSelection(doc, sel, bias, true));",
          "5154:     if (!(options && options.scroll === false) && doc.cm && doc.cm.getOption(\"readOnly\") != \"nocursor\")",
          "5155:       { ensureCursorVisible(doc.cm); }",
          "5156:   }",
          "5158:   function setSelectionInner(doc, sel) {",
          "5159:     if (sel.equals(doc.sel)) { return }",
          "5161:     doc.sel = sel;",
          "5163:     if (doc.cm) {",
          "5164:       doc.cm.curOp.updateInput = 1;",
          "5165:       doc.cm.curOp.selectionChanged = true;",
          "5166:       signalCursorActivity(doc.cm);",
          "5167:     }",
          "5168:     signalLater(doc, \"cursorActivity\", doc);",
          "5169:   }",
          "5173:   function reCheckSelection(doc) {",
          "5174:     setSelectionInner(doc, skipAtomicInSelection(doc, doc.sel, null, false));",
          "5175:   }",
          "5179:   function skipAtomicInSelection(doc, sel, bias, mayClear) {",
          "5180:     var out;",
          "5181:     for (var i = 0; i < sel.ranges.length; i++) {",
          "5182:       var range = sel.ranges[i];",
          "5183:       var old = sel.ranges.length == doc.sel.ranges.length && doc.sel.ranges[i];",
          "5184:       var newAnchor = skipAtomic(doc, range.anchor, old && old.anchor, bias, mayClear);",
          "5185:       var newHead = skipAtomic(doc, range.head, old && old.head, bias, mayClear);",
          "5186:       if (out || newAnchor != range.anchor || newHead != range.head) {",
          "5187:         if (!out) { out = sel.ranges.slice(0, i); }",
          "5188:         out[i] = new Range(newAnchor, newHead);",
          "5189:       }",
          "5190:     }",
          "5191:     return out ? normalizeSelection(doc.cm, out, sel.primIndex) : sel",
          "5192:   }",
          "5194:   function skipAtomicInner(doc, pos, oldPos, dir, mayClear) {",
          "5195:     var line = getLine(doc, pos.line);",
          "5196:     if (line.markedSpans) { for (var i = 0; i < line.markedSpans.length; ++i) {",
          "5197:       var sp = line.markedSpans[i], m = sp.marker;",
          "5202:       var preventCursorLeft = (\"selectLeft\" in m) ? !m.selectLeft : m.inclusiveLeft;",
          "5203:       var preventCursorRight = (\"selectRight\" in m) ? !m.selectRight : m.inclusiveRight;",
          "5205:       if ((sp.from == null || (preventCursorLeft ? sp.from <= pos.ch : sp.from < pos.ch)) &&",
          "5206:           (sp.to == null || (preventCursorRight ? sp.to >= pos.ch : sp.to > pos.ch))) {",
          "5207:         if (mayClear) {",
          "5208:           signal(m, \"beforeCursorEnter\");",
          "5209:           if (m.explicitlyCleared) {",
          "5210:             if (!line.markedSpans) { break }",
          "5211:             else {--i; continue}",
          "5212:           }",
          "5213:         }",
          "5214:         if (!m.atomic) { continue }",
          "5216:         if (oldPos) {",
          "5217:           var near = m.find(dir < 0 ? 1 : -1), diff = (void 0);",
          "5218:           if (dir < 0 ? preventCursorRight : preventCursorLeft)",
          "5219:             { near = movePos(doc, near, -dir, near && near.line == pos.line ? line : null); }",
          "5220:           if (near && near.line == pos.line && (diff = cmp(near, oldPos)) && (dir < 0 ? diff < 0 : diff > 0))",
          "5221:             { return skipAtomicInner(doc, near, pos, dir, mayClear) }",
          "5222:         }",
          "5224:         var far = m.find(dir < 0 ? -1 : 1);",
          "5225:         if (dir < 0 ? preventCursorLeft : preventCursorRight)",
          "5226:           { far = movePos(doc, far, dir, far.line == pos.line ? line : null); }",
          "5227:         return far ? skipAtomicInner(doc, far, pos, dir, mayClear) : null",
          "5228:       }",
          "5229:     } }",
          "5230:     return pos",
          "5231:   }",
          "5234:   function skipAtomic(doc, pos, oldPos, bias, mayClear) {",
          "5235:     var dir = bias || 1;",
          "5236:     var found = skipAtomicInner(doc, pos, oldPos, dir, mayClear) ||",
          "5237:         (!mayClear && skipAtomicInner(doc, pos, oldPos, dir, true)) ||",
          "5238:         skipAtomicInner(doc, pos, oldPos, -dir, mayClear) ||",
          "5239:         (!mayClear && skipAtomicInner(doc, pos, oldPos, -dir, true));",
          "5240:     if (!found) {",
          "5241:       doc.cantEdit = true;",
          "5242:       return Pos(doc.first, 0)",
          "5243:     }",
          "5244:     return found",
          "5245:   }",
          "5247:   function movePos(doc, pos, dir, line) {",
          "5248:     if (dir < 0 && pos.ch == 0) {",
          "5249:       if (pos.line > doc.first) { return clipPos(doc, Pos(pos.line - 1)) }",
          "5250:       else { return null }",
          "5251:     } else if (dir > 0 && pos.ch == (line || getLine(doc, pos.line)).text.length) {",
          "5252:       if (pos.line < doc.first + doc.size - 1) { return Pos(pos.line + 1, 0) }",
          "5253:       else { return null }",
          "5254:     } else {",
          "5255:       return new Pos(pos.line, pos.ch + dir)",
          "5256:     }",
          "5257:   }",
          "5259:   function selectAll(cm) {",
          "5260:     cm.setSelection(Pos(cm.firstLine(), 0), Pos(cm.lastLine()), sel_dontScroll);",
          "5261:   }",
          "5266:   function filterChange(doc, change, update) {",
          "5267:     var obj = {",
          "5268:       canceled: false,",
          "5269:       from: change.from,",
          "5270:       to: change.to,",
          "5271:       text: change.text,",
          "5272:       origin: change.origin,",
          "5273:       cancel: function () { return obj.canceled = true; }",
          "5274:     };",
          "5275:     if (update) { obj.update = function (from, to, text, origin) {",
          "5276:       if (from) { obj.from = clipPos(doc, from); }",
          "5277:       if (to) { obj.to = clipPos(doc, to); }",
          "5278:       if (text) { obj.text = text; }",
          "5279:       if (origin !== undefined) { obj.origin = origin; }",
          "5280:     }; }",
          "5281:     signal(doc, \"beforeChange\", doc, obj);",
          "5282:     if (doc.cm) { signal(doc.cm, \"beforeChange\", doc.cm, obj); }",
          "5284:     if (obj.canceled) {",
          "5285:       if (doc.cm) { doc.cm.curOp.updateInput = 2; }",
          "5286:       return null",
          "5287:     }",
          "5288:     return {from: obj.from, to: obj.to, text: obj.text, origin: obj.origin}",
          "5289:   }",
          "5293:   function makeChange(doc, change, ignoreReadOnly) {",
          "5294:     if (doc.cm) {",
          "5295:       if (!doc.cm.curOp) { return operation(doc.cm, makeChange)(doc, change, ignoreReadOnly) }",
          "5296:       if (doc.cm.state.suppressEdits) { return }",
          "5297:     }",
          "5299:     if (hasHandler(doc, \"beforeChange\") || doc.cm && hasHandler(doc.cm, \"beforeChange\")) {",
          "5300:       change = filterChange(doc, change, true);",
          "5301:       if (!change) { return }",
          "5302:     }",
          "5306:     var split = sawReadOnlySpans && !ignoreReadOnly && removeReadOnlyRanges(doc, change.from, change.to);",
          "5307:     if (split) {",
          "5308:       for (var i = split.length - 1; i >= 0; --i)",
          "5309:         { makeChangeInner(doc, {from: split[i].from, to: split[i].to, text: i ? [\"\"] : change.text, origin: change.origin}); }",
          "5310:     } else {",
          "5311:       makeChangeInner(doc, change);",
          "5312:     }",
          "5313:   }",
          "5315:   function makeChangeInner(doc, change) {",
          "5316:     if (change.text.length == 1 && change.text[0] == \"\" && cmp(change.from, change.to) == 0) { return }",
          "5317:     var selAfter = computeSelAfterChange(doc, change);",
          "5318:     addChangeToHistory(doc, change, selAfter, doc.cm ? doc.cm.curOp.id : NaN);",
          "5320:     makeChangeSingleDoc(doc, change, selAfter, stretchSpansOverChange(doc, change));",
          "5321:     var rebased = [];",
          "5323:     linkedDocs(doc, function (doc, sharedHist) {",
          "5324:       if (!sharedHist && indexOf(rebased, doc.history) == -1) {",
          "5325:         rebaseHist(doc.history, change);",
          "5326:         rebased.push(doc.history);",
          "5327:       }",
          "5328:       makeChangeSingleDoc(doc, change, null, stretchSpansOverChange(doc, change));",
          "5329:     });",
          "5330:   }",
          "5333:   function makeChangeFromHistory(doc, type, allowSelectionOnly) {",
          "5334:     var suppress = doc.cm && doc.cm.state.suppressEdits;",
          "5335:     if (suppress && !allowSelectionOnly) { return }",
          "5337:     var hist = doc.history, event, selAfter = doc.sel;",
          "5338:     var source = type == \"undo\" ? hist.done : hist.undone, dest = type == \"undo\" ? hist.undone : hist.done;",
          "5342:     var i = 0;",
          "5343:     for (; i < source.length; i++) {",
          "5344:       event = source[i];",
          "5345:       if (allowSelectionOnly ? event.ranges && !event.equals(doc.sel) : !event.ranges)",
          "5346:         { break }",
          "5347:     }",
          "5348:     if (i == source.length) { return }",
          "5349:     hist.lastOrigin = hist.lastSelOrigin = null;",
          "5351:     for (;;) {",
          "5352:       event = source.pop();",
          "5353:       if (event.ranges) {",
          "5354:         pushSelectionToHistory(event, dest);",
          "5355:         if (allowSelectionOnly && !event.equals(doc.sel)) {",
          "5356:           setSelection(doc, event, {clearRedo: false});",
          "5357:           return",
          "5358:         }",
          "5359:         selAfter = event;",
          "5360:       } else if (suppress) {",
          "5361:         source.push(event);",
          "5362:         return",
          "5363:       } else { break }",
          "5364:     }",
          "5368:     var antiChanges = [];",
          "5369:     pushSelectionToHistory(selAfter, dest);",
          "5370:     dest.push({changes: antiChanges, generation: hist.generation});",
          "5371:     hist.generation = event.generation || ++hist.maxGeneration;",
          "5373:     var filter = hasHandler(doc, \"beforeChange\") || doc.cm && hasHandler(doc.cm, \"beforeChange\");",
          "5375:     var loop = function ( i ) {",
          "5376:       var change = event.changes[i];",
          "5377:       change.origin = type;",
          "5378:       if (filter && !filterChange(doc, change, false)) {",
          "5379:         source.length = 0;",
          "5380:         return {}",
          "5381:       }",
          "5383:       antiChanges.push(historyChangeFromChange(doc, change));",
          "5385:       var after = i ? computeSelAfterChange(doc, change) : lst(source);",
          "5386:       makeChangeSingleDoc(doc, change, after, mergeOldSpans(doc, change));",
          "5387:       if (!i && doc.cm) { doc.cm.scrollIntoView({from: change.from, to: changeEnd(change)}); }",
          "5388:       var rebased = [];",
          "5391:       linkedDocs(doc, function (doc, sharedHist) {",
          "5392:         if (!sharedHist && indexOf(rebased, doc.history) == -1) {",
          "5393:           rebaseHist(doc.history, change);",
          "5394:           rebased.push(doc.history);",
          "5395:         }",
          "5396:         makeChangeSingleDoc(doc, change, null, mergeOldSpans(doc, change));",
          "5397:       });",
          "5398:     };",
          "5400:     for (var i$1 = event.changes.length - 1; i$1 >= 0; --i$1) {",
          "5401:       var returned = loop( i$1 );",
          "5403:       if ( returned ) return returned.v;",
          "5404:     }",
          "5405:   }",
          "5409:   function shiftDoc(doc, distance) {",
          "5410:     if (distance == 0) { return }",
          "5411:     doc.first += distance;",
          "5412:     doc.sel = new Selection(map(doc.sel.ranges, function (range) { return new Range(",
          "5413:       Pos(range.anchor.line + distance, range.anchor.ch),",
          "5414:       Pos(range.head.line + distance, range.head.ch)",
          "5415:     ); }), doc.sel.primIndex);",
          "5416:     if (doc.cm) {",
          "5417:       regChange(doc.cm, doc.first, doc.first - distance, distance);",
          "5418:       for (var d = doc.cm.display, l = d.viewFrom; l < d.viewTo; l++)",
          "5419:         { regLineChange(doc.cm, l, \"gutter\"); }",
          "5420:     }",
          "5421:   }",
          "5425:   function makeChangeSingleDoc(doc, change, selAfter, spans) {",
          "5426:     if (doc.cm && !doc.cm.curOp)",
          "5427:       { return operation(doc.cm, makeChangeSingleDoc)(doc, change, selAfter, spans) }",
          "5429:     if (change.to.line < doc.first) {",
          "5430:       shiftDoc(doc, change.text.length - 1 - (change.to.line - change.from.line));",
          "5431:       return",
          "5432:     }",
          "5433:     if (change.from.line > doc.lastLine()) { return }",
          "5436:     if (change.from.line < doc.first) {",
          "5437:       var shift = change.text.length - 1 - (doc.first - change.from.line);",
          "5438:       shiftDoc(doc, shift);",
          "5439:       change = {from: Pos(doc.first, 0), to: Pos(change.to.line + shift, change.to.ch),",
          "5440:                 text: [lst(change.text)], origin: change.origin};",
          "5441:     }",
          "5442:     var last = doc.lastLine();",
          "5443:     if (change.to.line > last) {",
          "5444:       change = {from: change.from, to: Pos(last, getLine(doc, last).text.length),",
          "5445:                 text: [change.text[0]], origin: change.origin};",
          "5446:     }",
          "5448:     change.removed = getBetween(doc, change.from, change.to);",
          "5450:     if (!selAfter) { selAfter = computeSelAfterChange(doc, change); }",
          "5451:     if (doc.cm) { makeChangeSingleDocInEditor(doc.cm, change, spans); }",
          "5452:     else { updateDoc(doc, change, spans); }",
          "5453:     setSelectionNoUndo(doc, selAfter, sel_dontScroll);",
          "5455:     if (doc.cantEdit && skipAtomic(doc, Pos(doc.firstLine(), 0)))",
          "5456:       { doc.cantEdit = false; }",
          "5457:   }",
          "5461:   function makeChangeSingleDocInEditor(cm, change, spans) {",
          "5462:     var doc = cm.doc, display = cm.display, from = change.from, to = change.to;",
          "5464:     var recomputeMaxLength = false, checkWidthStart = from.line;",
          "5465:     if (!cm.options.lineWrapping) {",
          "5466:       checkWidthStart = lineNo(visualLine(getLine(doc, from.line)));",
          "5467:       doc.iter(checkWidthStart, to.line + 1, function (line) {",
          "5468:         if (line == display.maxLine) {",
          "5469:           recomputeMaxLength = true;",
          "5470:           return true",
          "5471:         }",
          "5472:       });",
          "5473:     }",
          "5475:     if (doc.sel.contains(change.from, change.to) > -1)",
          "5476:       { signalCursorActivity(cm); }",
          "5478:     updateDoc(doc, change, spans, estimateHeight(cm));",
          "5480:     if (!cm.options.lineWrapping) {",
          "5481:       doc.iter(checkWidthStart, from.line + change.text.length, function (line) {",
          "5482:         var len = lineLength(line);",
          "5483:         if (len > display.maxLineLength) {",
          "5484:           display.maxLine = line;",
          "5485:           display.maxLineLength = len;",
          "5486:           display.maxLineChanged = true;",
          "5487:           recomputeMaxLength = false;",
          "5488:         }",
          "5489:       });",
          "5490:       if (recomputeMaxLength) { cm.curOp.updateMaxLine = true; }",
          "5491:     }",
          "5493:     retreatFrontier(doc, from.line);",
          "5494:     startWorker(cm, 400);",
          "5496:     var lendiff = change.text.length - (to.line - from.line) - 1;",
          "5498:     if (change.full)",
          "5499:       { regChange(cm); }",
          "5500:     else if (from.line == to.line && change.text.length == 1 && !isWholeLineUpdate(cm.doc, change))",
          "5501:       { regLineChange(cm, from.line, \"text\"); }",
          "5502:     else",
          "5503:       { regChange(cm, from.line, to.line + 1, lendiff); }",
          "5505:     var changesHandler = hasHandler(cm, \"changes\"), changeHandler = hasHandler(cm, \"change\");",
          "5506:     if (changeHandler || changesHandler) {",
          "5507:       var obj = {",
          "5508:         from: from, to: to,",
          "5509:         text: change.text,",
          "5510:         removed: change.removed,",
          "5511:         origin: change.origin",
          "5512:       };",
          "5513:       if (changeHandler) { signalLater(cm, \"change\", cm, obj); }",
          "5514:       if (changesHandler) { (cm.curOp.changeObjs || (cm.curOp.changeObjs = [])).push(obj); }",
          "5515:     }",
          "5516:     cm.display.selForContextMenu = null;",
          "5517:   }",
          "5519:   function replaceRange(doc, code, from, to, origin) {",
          "5520:     var assign;",
          "5522:     if (!to) { to = from; }",
          "5523:     if (cmp(to, from) < 0) { (assign = [to, from], from = assign[0], to = assign[1]); }",
          "5524:     if (typeof code == \"string\") { code = doc.splitLines(code); }",
          "5525:     makeChange(doc, {from: from, to: to, text: code, origin: origin});",
          "5526:   }",
          "5530:   function rebaseHistSelSingle(pos, from, to, diff) {",
          "5531:     if (to < pos.line) {",
          "5532:       pos.line += diff;",
          "5533:     } else if (from < pos.line) {",
          "5534:       pos.line = from;",
          "5535:       pos.ch = 0;",
          "5536:     }",
          "5537:   }",
          "5546:   function rebaseHistArray(array, from, to, diff) {",
          "5547:     for (var i = 0; i < array.length; ++i) {",
          "5548:       var sub = array[i], ok = true;",
          "5549:       if (sub.ranges) {",
          "5550:         if (!sub.copied) { sub = array[i] = sub.deepCopy(); sub.copied = true; }",
          "5551:         for (var j = 0; j < sub.ranges.length; j++) {",
          "5552:           rebaseHistSelSingle(sub.ranges[j].anchor, from, to, diff);",
          "5553:           rebaseHistSelSingle(sub.ranges[j].head, from, to, diff);",
          "5554:         }",
          "5555:         continue",
          "5556:       }",
          "5557:       for (var j$1 = 0; j$1 < sub.changes.length; ++j$1) {",
          "5558:         var cur = sub.changes[j$1];",
          "5559:         if (to < cur.from.line) {",
          "5560:           cur.from = Pos(cur.from.line + diff, cur.from.ch);",
          "5561:           cur.to = Pos(cur.to.line + diff, cur.to.ch);",
          "5562:         } else if (from <= cur.to.line) {",
          "5563:           ok = false;",
          "5564:           break",
          "5565:         }",
          "5566:       }",
          "5567:       if (!ok) {",
          "5568:         array.splice(0, i + 1);",
          "5569:         i = 0;",
          "5570:       }",
          "5571:     }",
          "5572:   }",
          "5574:   function rebaseHist(hist, change) {",
          "5575:     var from = change.from.line, to = change.to.line, diff = change.text.length - (to - from) - 1;",
          "5576:     rebaseHistArray(hist.done, from, to, diff);",
          "5577:     rebaseHistArray(hist.undone, from, to, diff);",
          "5578:   }",
          "5583:   function changeLine(doc, handle, changeType, op) {",
          "5584:     var no = handle, line = handle;",
          "5585:     if (typeof handle == \"number\") { line = getLine(doc, clipLine(doc, handle)); }",
          "5586:     else { no = lineNo(handle); }",
          "5587:     if (no == null) { return null }",
          "5588:     if (op(line, no) && doc.cm) { regLineChange(doc.cm, no, changeType); }",
          "5589:     return line",
          "5590:   }",
          "5605:   function LeafChunk(lines) {",
          "5606:     this.lines = lines;",
          "5607:     this.parent = null;",
          "5608:     var height = 0;",
          "5609:     for (var i = 0; i < lines.length; ++i) {",
          "5610:       lines[i].parent = this;",
          "5611:       height += lines[i].height;",
          "5612:     }",
          "5613:     this.height = height;",
          "5614:   }",
          "5616:   LeafChunk.prototype = {",
          "5617:     chunkSize: function() { return this.lines.length },",
          "5620:     removeInner: function(at, n) {",
          "5621:       for (var i = at, e = at + n; i < e; ++i) {",
          "5622:         var line = this.lines[i];",
          "5623:         this.height -= line.height;",
          "5624:         cleanUpLine(line);",
          "5625:         signalLater(line, \"delete\");",
          "5626:       }",
          "5627:       this.lines.splice(at, n);",
          "5628:     },",
          "5631:     collapse: function(lines) {",
          "5632:       lines.push.apply(lines, this.lines);",
          "5633:     },",
          "5637:     insertInner: function(at, lines, height) {",
          "5638:       this.height += height;",
          "5639:       this.lines = this.lines.slice(0, at).concat(lines).concat(this.lines.slice(at));",
          "5640:       for (var i = 0; i < lines.length; ++i) { lines[i].parent = this; }",
          "5641:     },",
          "5644:     iterN: function(at, n, op) {",
          "5645:       for (var e = at + n; at < e; ++at)",
          "5646:         { if (op(this.lines[at])) { return true } }",
          "5647:     }",
          "5648:   };",
          "5650:   function BranchChunk(children) {",
          "5651:     this.children = children;",
          "5652:     var size = 0, height = 0;",
          "5653:     for (var i = 0; i < children.length; ++i) {",
          "5654:       var ch = children[i];",
          "5655:       size += ch.chunkSize(); height += ch.height;",
          "5656:       ch.parent = this;",
          "5657:     }",
          "5658:     this.size = size;",
          "5659:     this.height = height;",
          "5660:     this.parent = null;",
          "5661:   }",
          "5663:   BranchChunk.prototype = {",
          "5664:     chunkSize: function() { return this.size },",
          "5666:     removeInner: function(at, n) {",
          "5667:       this.size -= n;",
          "5668:       for (var i = 0; i < this.children.length; ++i) {",
          "5669:         var child = this.children[i], sz = child.chunkSize();",
          "5670:         if (at < sz) {",
          "5671:           var rm = Math.min(n, sz - at), oldHeight = child.height;",
          "5672:           child.removeInner(at, rm);",
          "5673:           this.height -= oldHeight - child.height;",
          "5674:           if (sz == rm) { this.children.splice(i--, 1); child.parent = null; }",
          "5675:           if ((n -= rm) == 0) { break }",
          "5676:           at = 0;",
          "5677:         } else { at -= sz; }",
          "5678:       }",
          "5681:       if (this.size - n < 25 &&",
          "5682:           (this.children.length > 1 || !(this.children[0] instanceof LeafChunk))) {",
          "5683:         var lines = [];",
          "5684:         this.collapse(lines);",
          "5685:         this.children = [new LeafChunk(lines)];",
          "5686:         this.children[0].parent = this;",
          "5687:       }",
          "5688:     },",
          "5690:     collapse: function(lines) {",
          "5691:       for (var i = 0; i < this.children.length; ++i) { this.children[i].collapse(lines); }",
          "5692:     },",
          "5694:     insertInner: function(at, lines, height) {",
          "5695:       this.size += lines.length;",
          "5696:       this.height += height;",
          "5697:       for (var i = 0; i < this.children.length; ++i) {",
          "5698:         var child = this.children[i], sz = child.chunkSize();",
          "5699:         if (at <= sz) {",
          "5700:           child.insertInner(at, lines, height);",
          "5701:           if (child.lines && child.lines.length > 50) {",
          "5704:             var remaining = child.lines.length % 25 + 25;",
          "5705:             for (var pos = remaining; pos < child.lines.length;) {",
          "5706:               var leaf = new LeafChunk(child.lines.slice(pos, pos += 25));",
          "5707:               child.height -= leaf.height;",
          "5708:               this.children.splice(++i, 0, leaf);",
          "5709:               leaf.parent = this;",
          "5710:             }",
          "5711:             child.lines = child.lines.slice(0, remaining);",
          "5712:             this.maybeSpill();",
          "5713:           }",
          "5714:           break",
          "5715:         }",
          "5716:         at -= sz;",
          "5717:       }",
          "5718:     },",
          "5721:     maybeSpill: function() {",
          "5722:       if (this.children.length <= 10) { return }",
          "5723:       var me = this;",
          "5724:       do {",
          "5725:         var spilled = me.children.splice(me.children.length - 5, 5);",
          "5726:         var sibling = new BranchChunk(spilled);",
          "5727:         if (!me.parent) { // Become the parent node",
          "5728:           var copy = new BranchChunk(me.children);",
          "5729:           copy.parent = me;",
          "5730:           me.children = [copy, sibling];",
          "5731:           me = copy;",
          "5732:        } else {",
          "5733:           me.size -= sibling.size;",
          "5734:           me.height -= sibling.height;",
          "5735:           var myIndex = indexOf(me.parent.children, me);",
          "5736:           me.parent.children.splice(myIndex + 1, 0, sibling);",
          "5737:         }",
          "5738:         sibling.parent = me.parent;",
          "5739:       } while (me.children.length > 10)",
          "5740:       me.parent.maybeSpill();",
          "5741:     },",
          "5743:     iterN: function(at, n, op) {",
          "5744:       for (var i = 0; i < this.children.length; ++i) {",
          "5745:         var child = this.children[i], sz = child.chunkSize();",
          "5746:         if (at < sz) {",
          "5747:           var used = Math.min(n, sz - at);",
          "5748:           if (child.iterN(at, used, op)) { return true }",
          "5749:           if ((n -= used) == 0) { break }",
          "5750:           at = 0;",
          "5751:         } else { at -= sz; }",
          "5752:       }",
          "5753:     }",
          "5754:   };",
          "5758:   var LineWidget = function(doc, node, options) {",
          "5759:     if (options) { for (var opt in options) { if (options.hasOwnProperty(opt))",
          "5760:       { this[opt] = options[opt]; } } }",
          "5761:     this.doc = doc;",
          "5762:     this.node = node;",
          "5763:   };",
          "5765:   LineWidget.prototype.clear = function () {",
          "5766:     var cm = this.doc.cm, ws = this.line.widgets, line = this.line, no = lineNo(line);",
          "5767:     if (no == null || !ws) { return }",
          "5768:     for (var i = 0; i < ws.length; ++i) { if (ws[i] == this) { ws.splice(i--, 1); } }",
          "5769:     if (!ws.length) { line.widgets = null; }",
          "5770:     var height = widgetHeight(this);",
          "5771:     updateLineHeight(line, Math.max(0, line.height - height));",
          "5772:     if (cm) {",
          "5773:       runInOp(cm, function () {",
          "5774:         adjustScrollWhenAboveVisible(cm, line, -height);",
          "5775:         regLineChange(cm, no, \"widget\");",
          "5776:       });",
          "5777:       signalLater(cm, \"lineWidgetCleared\", cm, this, no);",
          "5778:     }",
          "5779:   };",
          "5781:   LineWidget.prototype.changed = function () {",
          "5782:       var this$1 = this;",
          "5784:     var oldH = this.height, cm = this.doc.cm, line = this.line;",
          "5785:     this.height = null;",
          "5786:     var diff = widgetHeight(this) - oldH;",
          "5787:     if (!diff) { return }",
          "5788:     if (!lineIsHidden(this.doc, line)) { updateLineHeight(line, line.height + diff); }",
          "5789:     if (cm) {",
          "5790:       runInOp(cm, function () {",
          "5791:         cm.curOp.forceUpdate = true;",
          "5792:         adjustScrollWhenAboveVisible(cm, line, diff);",
          "5793:         signalLater(cm, \"lineWidgetChanged\", cm, this$1, lineNo(line));",
          "5794:       });",
          "5795:     }",
          "5796:   };",
          "5797:   eventMixin(LineWidget);",
          "5799:   function adjustScrollWhenAboveVisible(cm, line, diff) {",
          "5800:     if (heightAtLine(line) < ((cm.curOp && cm.curOp.scrollTop) || cm.doc.scrollTop))",
          "5801:       { addToScrollTop(cm, diff); }",
          "5802:   }",
          "5804:   function addLineWidget(doc, handle, node, options) {",
          "5805:     var widget = new LineWidget(doc, node, options);",
          "5806:     var cm = doc.cm;",
          "5807:     if (cm && widget.noHScroll) { cm.display.alignWidgets = true; }",
          "5808:     changeLine(doc, handle, \"widget\", function (line) {",
          "5809:       var widgets = line.widgets || (line.widgets = []);",
          "5810:       if (widget.insertAt == null) { widgets.push(widget); }",
          "5811:       else { widgets.splice(Math.min(widgets.length, Math.max(0, widget.insertAt)), 0, widget); }",
          "5812:       widget.line = line;",
          "5813:       if (cm && !lineIsHidden(doc, line)) {",
          "5814:         var aboveVisible = heightAtLine(line) < doc.scrollTop;",
          "5815:         updateLineHeight(line, line.height + widgetHeight(widget));",
          "5816:         if (aboveVisible) { addToScrollTop(cm, widget.height); }",
          "5817:         cm.curOp.forceUpdate = true;",
          "5818:       }",
          "5819:       return true",
          "5820:     });",
          "5821:     if (cm) { signalLater(cm, \"lineWidgetAdded\", cm, widget, typeof handle == \"number\" ? handle : lineNo(handle)); }",
          "5822:     return widget",
          "5823:   }",
          "5840:   var nextMarkerId = 0;",
          "5842:   var TextMarker = function(doc, type) {",
          "5843:     this.lines = [];",
          "5844:     this.type = type;",
          "5845:     this.doc = doc;",
          "5846:     this.id = ++nextMarkerId;",
          "5847:   };",
          "5850:   TextMarker.prototype.clear = function () {",
          "5851:     if (this.explicitlyCleared) { return }",
          "5852:     var cm = this.doc.cm, withOp = cm && !cm.curOp;",
          "5853:     if (withOp) { startOperation(cm); }",
          "5854:     if (hasHandler(this, \"clear\")) {",
          "5855:       var found = this.find();",
          "5856:       if (found) { signalLater(this, \"clear\", found.from, found.to); }",
          "5857:     }",
          "5858:     var min = null, max = null;",
          "5859:     for (var i = 0; i < this.lines.length; ++i) {",
          "5860:       var line = this.lines[i];",
          "5861:       var span = getMarkedSpanFor(line.markedSpans, this);",
          "5862:       if (cm && !this.collapsed) { regLineChange(cm, lineNo(line), \"text\"); }",
          "5863:       else if (cm) {",
          "5864:         if (span.to != null) { max = lineNo(line); }",
          "5865:         if (span.from != null) { min = lineNo(line); }",
          "5866:       }",
          "5867:       line.markedSpans = removeMarkedSpan(line.markedSpans, span);",
          "5868:       if (span.from == null && this.collapsed && !lineIsHidden(this.doc, line) && cm)",
          "5869:         { updateLineHeight(line, textHeight(cm.display)); }",
          "5870:     }",
          "5871:     if (cm && this.collapsed && !cm.options.lineWrapping) { for (var i$1 = 0; i$1 < this.lines.length; ++i$1) {",
          "5872:       var visual = visualLine(this.lines[i$1]), len = lineLength(visual);",
          "5873:       if (len > cm.display.maxLineLength) {",
          "5874:         cm.display.maxLine = visual;",
          "5875:         cm.display.maxLineLength = len;",
          "5876:         cm.display.maxLineChanged = true;",
          "5877:       }",
          "5878:     } }",
          "5880:     if (min != null && cm && this.collapsed) { regChange(cm, min, max + 1); }",
          "5881:     this.lines.length = 0;",
          "5882:     this.explicitlyCleared = true;",
          "5883:     if (this.atomic && this.doc.cantEdit) {",
          "5884:       this.doc.cantEdit = false;",
          "5885:       if (cm) { reCheckSelection(cm.doc); }",
          "5886:     }",
          "5887:     if (cm) { signalLater(cm, \"markerCleared\", cm, this, min, max); }",
          "5888:     if (withOp) { endOperation(cm); }",
          "5889:     if (this.parent) { this.parent.clear(); }",
          "5890:   };",
          "5897:   TextMarker.prototype.find = function (side, lineObj) {",
          "5898:     if (side == null && this.type == \"bookmark\") { side = 1; }",
          "5899:     var from, to;",
          "5900:     for (var i = 0; i < this.lines.length; ++i) {",
          "5901:       var line = this.lines[i];",
          "5902:       var span = getMarkedSpanFor(line.markedSpans, this);",
          "5903:       if (span.from != null) {",
          "5904:         from = Pos(lineObj ? line : lineNo(line), span.from);",
          "5905:         if (side == -1) { return from }",
          "5906:       }",
          "5907:       if (span.to != null) {",
          "5908:         to = Pos(lineObj ? line : lineNo(line), span.to);",
          "5909:         if (side == 1) { return to }",
          "5910:       }",
          "5911:     }",
          "5912:     return from && {from: from, to: to}",
          "5913:   };",
          "5917:   TextMarker.prototype.changed = function () {",
          "5918:       var this$1 = this;",
          "5920:     var pos = this.find(-1, true), widget = this, cm = this.doc.cm;",
          "5921:     if (!pos || !cm) { return }",
          "5922:     runInOp(cm, function () {",
          "5923:       var line = pos.line, lineN = lineNo(pos.line);",
          "5924:       var view = findViewForLine(cm, lineN);",
          "5925:       if (view) {",
          "5926:         clearLineMeasurementCacheFor(view);",
          "5927:         cm.curOp.selectionChanged = cm.curOp.forceUpdate = true;",
          "5928:       }",
          "5929:       cm.curOp.updateMaxLine = true;",
          "5930:       if (!lineIsHidden(widget.doc, line) && widget.height != null) {",
          "5931:         var oldHeight = widget.height;",
          "5932:         widget.height = null;",
          "5933:         var dHeight = widgetHeight(widget) - oldHeight;",
          "5934:         if (dHeight)",
          "5935:           { updateLineHeight(line, line.height + dHeight); }",
          "5936:       }",
          "5937:       signalLater(cm, \"markerChanged\", cm, this$1);",
          "5938:     });",
          "5939:   };",
          "5941:   TextMarker.prototype.attachLine = function (line) {",
          "5942:     if (!this.lines.length && this.doc.cm) {",
          "5943:       var op = this.doc.cm.curOp;",
          "5944:       if (!op.maybeHiddenMarkers || indexOf(op.maybeHiddenMarkers, this) == -1)",
          "5945:         { (op.maybeUnhiddenMarkers || (op.maybeUnhiddenMarkers = [])).push(this); }",
          "5946:     }",
          "5947:     this.lines.push(line);",
          "5948:   };",
          "5950:   TextMarker.prototype.detachLine = function (line) {",
          "5951:     this.lines.splice(indexOf(this.lines, line), 1);",
          "5952:     if (!this.lines.length && this.doc.cm) {",
          "5953:       var op = this.doc.cm.curOp",
          "5954:       ;(op.maybeHiddenMarkers || (op.maybeHiddenMarkers = [])).push(this);",
          "5955:     }",
          "5956:   };",
          "5957:   eventMixin(TextMarker);",
          "5960:   function markText(doc, from, to, options, type) {",
          "5964:     if (options && options.shared) { return markTextShared(doc, from, to, options, type) }",
          "5966:     if (doc.cm && !doc.cm.curOp) { return operation(doc.cm, markText)(doc, from, to, options, type) }",
          "5968:     var marker = new TextMarker(doc, type), diff = cmp(from, to);",
          "5969:     if (options) { copyObj(options, marker, false); }",
          "5971:     if (diff > 0 || diff == 0 && marker.clearWhenEmpty !== false)",
          "5972:       { return marker }",
          "5973:     if (marker.replacedWith) {",
          "5975:       marker.collapsed = true;",
          "5976:       marker.widgetNode = eltP(\"span\", [marker.replacedWith], \"CodeMirror-widget\");",
          "5977:       if (!options.handleMouseEvents) { marker.widgetNode.setAttribute(\"cm-ignore-events\", \"true\"); }",
          "5978:       if (options.insertLeft) { marker.widgetNode.insertLeft = true; }",
          "5979:     }",
          "5980:     if (marker.collapsed) {",
          "5981:       if (conflictingCollapsedRange(doc, from.line, from, to, marker) ||",
          "5982:           from.line != to.line && conflictingCollapsedRange(doc, to.line, from, to, marker))",
          "5983:         { throw new Error(\"Inserting collapsed marker partially overlapping an existing one\") }",
          "5984:       seeCollapsedSpans();",
          "5985:     }",
          "5987:     if (marker.addToHistory)",
          "5988:       { addChangeToHistory(doc, {from: from, to: to, origin: \"markText\"}, doc.sel, NaN); }",
          "5990:     var curLine = from.line, cm = doc.cm, updateMaxLine;",
          "5991:     doc.iter(curLine, to.line + 1, function (line) {",
          "5992:       if (cm && marker.collapsed && !cm.options.lineWrapping && visualLine(line) == cm.display.maxLine)",
          "5993:         { updateMaxLine = true; }",
          "5994:       if (marker.collapsed && curLine != from.line) { updateLineHeight(line, 0); }",
          "5995:       addMarkedSpan(line, new MarkedSpan(marker,",
          "5996:                                          curLine == from.line ? from.ch : null,",
          "5997:                                          curLine == to.line ? to.ch : null), doc.cm && doc.cm.curOp);",
          "5998:       ++curLine;",
          "5999:     });",
          "6001:     if (marker.collapsed) { doc.iter(from.line, to.line + 1, function (line) {",
          "6002:       if (lineIsHidden(doc, line)) { updateLineHeight(line, 0); }",
          "6003:     }); }",
          "6005:     if (marker.clearOnEnter) { on(marker, \"beforeCursorEnter\", function () { return marker.clear(); }); }",
          "6007:     if (marker.readOnly) {",
          "6008:       seeReadOnlySpans();",
          "6009:       if (doc.history.done.length || doc.history.undone.length)",
          "6010:         { doc.clearHistory(); }",
          "6011:     }",
          "6012:     if (marker.collapsed) {",
          "6013:       marker.id = ++nextMarkerId;",
          "6014:       marker.atomic = true;",
          "6015:     }",
          "6016:     if (cm) {",
          "6018:       if (updateMaxLine) { cm.curOp.updateMaxLine = true; }",
          "6019:       if (marker.collapsed)",
          "6020:         { regChange(cm, from.line, to.line + 1); }",
          "6021:       else if (marker.className || marker.startStyle || marker.endStyle || marker.css ||",
          "6022:                marker.attributes || marker.title)",
          "6023:         { for (var i = from.line; i <= to.line; i++) { regLineChange(cm, i, \"text\"); } }",
          "6024:       if (marker.atomic) { reCheckSelection(cm.doc); }",
          "6025:       signalLater(cm, \"markerAdded\", cm, marker);",
          "6026:     }",
          "6027:     return marker",
          "6028:   }",
          "6035:   var SharedTextMarker = function(markers, primary) {",
          "6036:     this.markers = markers;",
          "6037:     this.primary = primary;",
          "6038:     for (var i = 0; i < markers.length; ++i)",
          "6039:       { markers[i].parent = this; }",
          "6040:   };",
          "6042:   SharedTextMarker.prototype.clear = function () {",
          "6043:     if (this.explicitlyCleared) { return }",
          "6044:     this.explicitlyCleared = true;",
          "6045:     for (var i = 0; i < this.markers.length; ++i)",
          "6046:       { this.markers[i].clear(); }",
          "6047:     signalLater(this, \"clear\");",
          "6048:   };",
          "6050:   SharedTextMarker.prototype.find = function (side, lineObj) {",
          "6051:     return this.primary.find(side, lineObj)",
          "6052:   };",
          "6053:   eventMixin(SharedTextMarker);",
          "6055:   function markTextShared(doc, from, to, options, type) {",
          "6056:     options = copyObj(options);",
          "6057:     options.shared = false;",
          "6058:     var markers = [markText(doc, from, to, options, type)], primary = markers[0];",
          "6059:     var widget = options.widgetNode;",
          "6060:     linkedDocs(doc, function (doc) {",
          "6061:       if (widget) { options.widgetNode = widget.cloneNode(true); }",
          "6062:       markers.push(markText(doc, clipPos(doc, from), clipPos(doc, to), options, type));",
          "6063:       for (var i = 0; i < doc.linked.length; ++i)",
          "6064:         { if (doc.linked[i].isParent) { return } }",
          "6065:       primary = lst(markers);",
          "6066:     });",
          "6067:     return new SharedTextMarker(markers, primary)",
          "6068:   }",
          "6070:   function findSharedMarkers(doc) {",
          "6071:     return doc.findMarks(Pos(doc.first, 0), doc.clipPos(Pos(doc.lastLine())), function (m) { return m.parent; })",
          "6072:   }",
          "6074:   function copySharedMarkers(doc, markers) {",
          "6075:     for (var i = 0; i < markers.length; i++) {",
          "6076:       var marker = markers[i], pos = marker.find();",
          "6077:       var mFrom = doc.clipPos(pos.from), mTo = doc.clipPos(pos.to);",
          "6078:       if (cmp(mFrom, mTo)) {",
          "6079:         var subMark = markText(doc, mFrom, mTo, marker.primary, marker.primary.type);",
          "6080:         marker.markers.push(subMark);",
          "6081:         subMark.parent = marker;",
          "6082:       }",
          "6083:     }",
          "6084:   }",
          "6086:   function detachSharedMarkers(markers) {",
          "6087:     var loop = function ( i ) {",
          "6088:       var marker = markers[i], linked = [marker.primary.doc];",
          "6089:       linkedDocs(marker.primary.doc, function (d) { return linked.push(d); });",
          "6090:       for (var j = 0; j < marker.markers.length; j++) {",
          "6091:         var subMarker = marker.markers[j];",
          "6092:         if (indexOf(linked, subMarker.doc) == -1) {",
          "6093:           subMarker.parent = null;",
          "6094:           marker.markers.splice(j--, 1);",
          "6095:         }",
          "6096:       }",
          "6097:     };",
          "6099:     for (var i = 0; i < markers.length; i++) loop( i );",
          "6100:   }",
          "6102:   var nextDocId = 0;",
          "6103:   var Doc = function(text, mode, firstLine, lineSep, direction) {",
          "6104:     if (!(this instanceof Doc)) { return new Doc(text, mode, firstLine, lineSep, direction) }",
          "6105:     if (firstLine == null) { firstLine = 0; }",
          "6107:     BranchChunk.call(this, [new LeafChunk([new Line(\"\", null)])]);",
          "6108:     this.first = firstLine;",
          "6109:     this.scrollTop = this.scrollLeft = 0;",
          "6110:     this.cantEdit = false;",
          "6111:     this.cleanGeneration = 1;",
          "6112:     this.modeFrontier = this.highlightFrontier = firstLine;",
          "6113:     var start = Pos(firstLine, 0);",
          "6114:     this.sel = simpleSelection(start);",
          "6115:     this.history = new History(null);",
          "6116:     this.id = ++nextDocId;",
          "6117:     this.modeOption = mode;",
          "6118:     this.lineSep = lineSep;",
          "6119:     this.direction = (direction == \"rtl\") ? \"rtl\" : \"ltr\";",
          "6120:     this.extend = false;",
          "6122:     if (typeof text == \"string\") { text = this.splitLines(text); }",
          "6123:     updateDoc(this, {from: start, to: start, text: text});",
          "6124:     setSelection(this, simpleSelection(start), sel_dontScroll);",
          "6125:   };",
          "6127:   Doc.prototype = createObj(BranchChunk.prototype, {",
          "6128:     constructor: Doc,",
          "6133:     iter: function(from, to, op) {",
          "6134:       if (op) { this.iterN(from - this.first, to - from, op); }",
          "6135:       else { this.iterN(this.first, this.first + this.size, from); }",
          "6136:     },",
          "6139:     insert: function(at, lines) {",
          "6140:       var height = 0;",
          "6141:       for (var i = 0; i < lines.length; ++i) { height += lines[i].height; }",
          "6142:       this.insertInner(at - this.first, lines, height);",
          "6143:     },",
          "6144:     remove: function(at, n) { this.removeInner(at - this.first, n); },",
          "6149:     getValue: function(lineSep) {",
          "6150:       var lines = getLines(this, this.first, this.first + this.size);",
          "6151:       if (lineSep === false) { return lines }",
          "6152:       return lines.join(lineSep || this.lineSeparator())",
          "6153:     },",
          "6154:     setValue: docMethodOp(function(code) {",
          "6155:       var top = Pos(this.first, 0), last = this.first + this.size - 1;",
          "6156:       makeChange(this, {from: top, to: Pos(last, getLine(this, last).text.length),",
          "6157:                         text: this.splitLines(code), origin: \"setValue\", full: true}, true);",
          "6158:       if (this.cm) { scrollToCoords(this.cm, 0, 0); }",
          "6159:       setSelection(this, simpleSelection(top), sel_dontScroll);",
          "6160:     }),",
          "6161:     replaceRange: function(code, from, to, origin) {",
          "6162:       from = clipPos(this, from);",
          "6163:       to = to ? clipPos(this, to) : from;",
          "6164:       replaceRange(this, code, from, to, origin);",
          "6165:     },",
          "6166:     getRange: function(from, to, lineSep) {",
          "6167:       var lines = getBetween(this, clipPos(this, from), clipPos(this, to));",
          "6168:       if (lineSep === false) { return lines }",
          "6169:       if (lineSep === '') { return lines.join('') }",
          "6170:       return lines.join(lineSep || this.lineSeparator())",
          "6171:     },",
          "6173:     getLine: function(line) {var l = this.getLineHandle(line); return l && l.text},",
          "6175:     getLineHandle: function(line) {if (isLine(this, line)) { return getLine(this, line) }},",
          "6176:     getLineNumber: function(line) {return lineNo(line)},",
          "6178:     getLineHandleVisualStart: function(line) {",
          "6179:       if (typeof line == \"number\") { line = getLine(this, line); }",
          "6180:       return visualLine(line)",
          "6181:     },",
          "6183:     lineCount: function() {return this.size},",
          "6184:     firstLine: function() {return this.first},",
          "6185:     lastLine: function() {return this.first + this.size - 1},",
          "6187:     clipPos: function(pos) {return clipPos(this, pos)},",
          "6189:     getCursor: function(start) {",
          "6190:       var range = this.sel.primary(), pos;",
          "6191:       if (start == null || start == \"head\") { pos = range.head; }",
          "6192:       else if (start == \"anchor\") { pos = range.anchor; }",
          "6193:       else if (start == \"end\" || start == \"to\" || start === false) { pos = range.to(); }",
          "6194:       else { pos = range.from(); }",
          "6195:       return pos",
          "6196:     },",
          "6197:     listSelections: function() { return this.sel.ranges },",
          "6198:     somethingSelected: function() {return this.sel.somethingSelected()},",
          "6200:     setCursor: docMethodOp(function(line, ch, options) {",
          "6201:       setSimpleSelection(this, clipPos(this, typeof line == \"number\" ? Pos(line, ch || 0) : line), null, options);",
          "6202:     }),",
          "6203:     setSelection: docMethodOp(function(anchor, head, options) {",
          "6204:       setSimpleSelection(this, clipPos(this, anchor), clipPos(this, head || anchor), options);",
          "6205:     }),",
          "6206:     extendSelection: docMethodOp(function(head, other, options) {",
          "6207:       extendSelection(this, clipPos(this, head), other && clipPos(this, other), options);",
          "6208:     }),",
          "6209:     extendSelections: docMethodOp(function(heads, options) {",
          "6210:       extendSelections(this, clipPosArray(this, heads), options);",
          "6211:     }),",
          "6212:     extendSelectionsBy: docMethodOp(function(f, options) {",
          "6213:       var heads = map(this.sel.ranges, f);",
          "6214:       extendSelections(this, clipPosArray(this, heads), options);",
          "6215:     }),",
          "6216:     setSelections: docMethodOp(function(ranges, primary, options) {",
          "6217:       if (!ranges.length) { return }",
          "6218:       var out = [];",
          "6219:       for (var i = 0; i < ranges.length; i++)",
          "6220:         { out[i] = new Range(clipPos(this, ranges[i].anchor),",
          "6221:                            clipPos(this, ranges[i].head || ranges[i].anchor)); }",
          "6222:       if (primary == null) { primary = Math.min(ranges.length - 1, this.sel.primIndex); }",
          "6223:       setSelection(this, normalizeSelection(this.cm, out, primary), options);",
          "6224:     }),",
          "6225:     addSelection: docMethodOp(function(anchor, head, options) {",
          "6226:       var ranges = this.sel.ranges.slice(0);",
          "6227:       ranges.push(new Range(clipPos(this, anchor), clipPos(this, head || anchor)));",
          "6228:       setSelection(this, normalizeSelection(this.cm, ranges, ranges.length - 1), options);",
          "6229:     }),",
          "6231:     getSelection: function(lineSep) {",
          "6232:       var ranges = this.sel.ranges, lines;",
          "6233:       for (var i = 0; i < ranges.length; i++) {",
          "6234:         var sel = getBetween(this, ranges[i].from(), ranges[i].to());",
          "6235:         lines = lines ? lines.concat(sel) : sel;",
          "6236:       }",
          "6237:       if (lineSep === false) { return lines }",
          "6238:       else { return lines.join(lineSep || this.lineSeparator()) }",
          "6239:     },",
          "6240:     getSelections: function(lineSep) {",
          "6241:       var parts = [], ranges = this.sel.ranges;",
          "6242:       for (var i = 0; i < ranges.length; i++) {",
          "6243:         var sel = getBetween(this, ranges[i].from(), ranges[i].to());",
          "6244:         if (lineSep !== false) { sel = sel.join(lineSep || this.lineSeparator()); }",
          "6245:         parts[i] = sel;",
          "6246:       }",
          "6247:       return parts",
          "6248:     },",
          "6249:     replaceSelection: function(code, collapse, origin) {",
          "6250:       var dup = [];",
          "6251:       for (var i = 0; i < this.sel.ranges.length; i++)",
          "6252:         { dup[i] = code; }",
          "6253:       this.replaceSelections(dup, collapse, origin || \"+input\");",
          "6254:     },",
          "6255:     replaceSelections: docMethodOp(function(code, collapse, origin) {",
          "6256:       var changes = [], sel = this.sel;",
          "6257:       for (var i = 0; i < sel.ranges.length; i++) {",
          "6258:         var range = sel.ranges[i];",
          "6259:         changes[i] = {from: range.from(), to: range.to(), text: this.splitLines(code[i]), origin: origin};",
          "6260:       }",
          "6261:       var newSel = collapse && collapse != \"end\" && computeReplacedSel(this, changes, collapse);",
          "6262:       for (var i$1 = changes.length - 1; i$1 >= 0; i$1--)",
          "6263:         { makeChange(this, changes[i$1]); }",
          "6264:       if (newSel) { setSelectionReplaceHistory(this, newSel); }",
          "6265:       else if (this.cm) { ensureCursorVisible(this.cm); }",
          "6266:     }),",
          "6267:     undo: docMethodOp(function() {makeChangeFromHistory(this, \"undo\");}),",
          "6268:     redo: docMethodOp(function() {makeChangeFromHistory(this, \"redo\");}),",
          "6269:     undoSelection: docMethodOp(function() {makeChangeFromHistory(this, \"undo\", true);}),",
          "6270:     redoSelection: docMethodOp(function() {makeChangeFromHistory(this, \"redo\", true);}),",
          "6272:     setExtending: function(val) {this.extend = val;},",
          "6273:     getExtending: function() {return this.extend},",
          "6275:     historySize: function() {",
          "6276:       var hist = this.history, done = 0, undone = 0;",
          "6277:       for (var i = 0; i < hist.done.length; i++) { if (!hist.done[i].ranges) { ++done; } }",
          "6278:       for (var i$1 = 0; i$1 < hist.undone.length; i$1++) { if (!hist.undone[i$1].ranges) { ++undone; } }",
          "6279:       return {undo: done, redo: undone}",
          "6280:     },",
          "6281:     clearHistory: function() {",
          "6282:       var this$1 = this;",
          "6284:       this.history = new History(this.history);",
          "6285:       linkedDocs(this, function (doc) { return doc.history = this$1.history; }, true);",
          "6286:     },",
          "6288:     markClean: function() {",
          "6289:       this.cleanGeneration = this.changeGeneration(true);",
          "6290:     },",
          "6291:     changeGeneration: function(forceSplit) {",
          "6292:       if (forceSplit)",
          "6293:         { this.history.lastOp = this.history.lastSelOp = this.history.lastOrigin = null; }",
          "6294:       return this.history.generation",
          "6295:     },",
          "6296:     isClean: function (gen) {",
          "6297:       return this.history.generation == (gen || this.cleanGeneration)",
          "6298:     },",
          "6300:     getHistory: function() {",
          "6301:       return {done: copyHistoryArray(this.history.done),",
          "6302:               undone: copyHistoryArray(this.history.undone)}",
          "6303:     },",
          "6304:     setHistory: function(histData) {",
          "6305:       var hist = this.history = new History(this.history);",
          "6306:       hist.done = copyHistoryArray(histData.done.slice(0), null, true);",
          "6307:       hist.undone = copyHistoryArray(histData.undone.slice(0), null, true);",
          "6308:     },",
          "6310:     setGutterMarker: docMethodOp(function(line, gutterID, value) {",
          "6311:       return changeLine(this, line, \"gutter\", function (line) {",
          "6312:         var markers = line.gutterMarkers || (line.gutterMarkers = {});",
          "6313:         markers[gutterID] = value;",
          "6314:         if (!value && isEmpty(markers)) { line.gutterMarkers = null; }",
          "6315:         return true",
          "6316:       })",
          "6317:     }),",
          "6319:     clearGutter: docMethodOp(function(gutterID) {",
          "6320:       var this$1 = this;",
          "6322:       this.iter(function (line) {",
          "6323:         if (line.gutterMarkers && line.gutterMarkers[gutterID]) {",
          "6324:           changeLine(this$1, line, \"gutter\", function () {",
          "6325:             line.gutterMarkers[gutterID] = null;",
          "6326:             if (isEmpty(line.gutterMarkers)) { line.gutterMarkers = null; }",
          "6327:             return true",
          "6328:           });",
          "6329:         }",
          "6330:       });",
          "6331:     }),",
          "6333:     lineInfo: function(line) {",
          "6334:       var n;",
          "6335:       if (typeof line == \"number\") {",
          "6336:         if (!isLine(this, line)) { return null }",
          "6337:         n = line;",
          "6338:         line = getLine(this, line);",
          "6339:         if (!line) { return null }",
          "6340:       } else {",
          "6341:         n = lineNo(line);",
          "6342:         if (n == null) { return null }",
          "6343:       }",
          "6344:       return {line: n, handle: line, text: line.text, gutterMarkers: line.gutterMarkers,",
          "6345:               textClass: line.textClass, bgClass: line.bgClass, wrapClass: line.wrapClass,",
          "6346:               widgets: line.widgets}",
          "6347:     },",
          "6349:     addLineClass: docMethodOp(function(handle, where, cls) {",
          "6350:       return changeLine(this, handle, where == \"gutter\" ? \"gutter\" : \"class\", function (line) {",
          "6351:         var prop = where == \"text\" ? \"textClass\"",
          "6352:                  : where == \"background\" ? \"bgClass\"",
          "6353:                  : where == \"gutter\" ? \"gutterClass\" : \"wrapClass\";",
          "6354:         if (!line[prop]) { line[prop] = cls; }",
          "6355:         else if (classTest(cls).test(line[prop])) { return false }",
          "6356:         else { line[prop] += \" \" + cls; }",
          "6357:         return true",
          "6358:       })",
          "6359:     }),",
          "6360:     removeLineClass: docMethodOp(function(handle, where, cls) {",
          "6361:       return changeLine(this, handle, where == \"gutter\" ? \"gutter\" : \"class\", function (line) {",
          "6362:         var prop = where == \"text\" ? \"textClass\"",
          "6363:                  : where == \"background\" ? \"bgClass\"",
          "6364:                  : where == \"gutter\" ? \"gutterClass\" : \"wrapClass\";",
          "6365:         var cur = line[prop];",
          "6366:         if (!cur) { return false }",
          "6367:         else if (cls == null) { line[prop] = null; }",
          "6368:         else {",
          "6369:           var found = cur.match(classTest(cls));",
          "6370:           if (!found) { return false }",
          "6371:           var end = found.index + found[0].length;",
          "6372:           line[prop] = cur.slice(0, found.index) + (!found.index || end == cur.length ? \"\" : \" \") + cur.slice(end) || null;",
          "6373:         }",
          "6374:         return true",
          "6375:       })",
          "6376:     }),",
          "6378:     addLineWidget: docMethodOp(function(handle, node, options) {",
          "6379:       return addLineWidget(this, handle, node, options)",
          "6380:     }),",
          "6381:     removeLineWidget: function(widget) { widget.clear(); },",
          "6383:     markText: function(from, to, options) {",
          "6384:       return markText(this, clipPos(this, from), clipPos(this, to), options, options && options.type || \"range\")",
          "6385:     },",
          "6386:     setBookmark: function(pos, options) {",
          "6387:       var realOpts = {replacedWith: options && (options.nodeType == null ? options.widget : options),",
          "6388:                       insertLeft: options && options.insertLeft,",
          "6389:                       clearWhenEmpty: false, shared: options && options.shared,",
          "6390:                       handleMouseEvents: options && options.handleMouseEvents};",
          "6391:       pos = clipPos(this, pos);",
          "6392:       return markText(this, pos, pos, realOpts, \"bookmark\")",
          "6393:     },",
          "6394:     findMarksAt: function(pos) {",
          "6395:       pos = clipPos(this, pos);",
          "6396:       var markers = [], spans = getLine(this, pos.line).markedSpans;",
          "6397:       if (spans) { for (var i = 0; i < spans.length; ++i) {",
          "6398:         var span = spans[i];",
          "6399:         if ((span.from == null || span.from <= pos.ch) &&",
          "6400:             (span.to == null || span.to >= pos.ch))",
          "6401:           { markers.push(span.marker.parent || span.marker); }",
          "6402:       } }",
          "6403:       return markers",
          "6404:     },",
          "6405:     findMarks: function(from, to, filter) {",
          "6406:       from = clipPos(this, from); to = clipPos(this, to);",
          "6407:       var found = [], lineNo = from.line;",
          "6408:       this.iter(from.line, to.line + 1, function (line) {",
          "6409:         var spans = line.markedSpans;",
          "6410:         if (spans) { for (var i = 0; i < spans.length; i++) {",
          "6411:           var span = spans[i];",
          "6412:           if (!(span.to != null && lineNo == from.line && from.ch >= span.to ||",
          "6413:                 span.from == null && lineNo != from.line ||",
          "6414:                 span.from != null && lineNo == to.line && span.from >= to.ch) &&",
          "6415:               (!filter || filter(span.marker)))",
          "6416:             { found.push(span.marker.parent || span.marker); }",
          "6417:         } }",
          "6418:         ++lineNo;",
          "6419:       });",
          "6420:       return found",
          "6421:     },",
          "6422:     getAllMarks: function() {",
          "6423:       var markers = [];",
          "6424:       this.iter(function (line) {",
          "6425:         var sps = line.markedSpans;",
          "6426:         if (sps) { for (var i = 0; i < sps.length; ++i)",
          "6427:           { if (sps[i].from != null) { markers.push(sps[i].marker); } } }",
          "6428:       });",
          "6429:       return markers",
          "6430:     },",
          "6432:     posFromIndex: function(off) {",
          "6433:       var ch, lineNo = this.first, sepSize = this.lineSeparator().length;",
          "6434:       this.iter(function (line) {",
          "6435:         var sz = line.text.length + sepSize;",
          "6436:         if (sz > off) { ch = off; return true }",
          "6437:         off -= sz;",
          "6438:         ++lineNo;",
          "6439:       });",
          "6440:       return clipPos(this, Pos(lineNo, ch))",
          "6441:     },",
          "6442:     indexFromPos: function (coords) {",
          "6443:       coords = clipPos(this, coords);",
          "6444:       var index = coords.ch;",
          "6445:       if (coords.line < this.first || coords.ch < 0) { return 0 }",
          "6446:       var sepSize = this.lineSeparator().length;",
          "6447:       this.iter(this.first, coords.line, function (line) { // iter aborts when callback returns a truthy value",
          "6448:         index += line.text.length + sepSize;",
          "6449:       });",
          "6450:       return index",
          "6451:     },",
          "6453:     copy: function(copyHistory) {",
          "6454:       var doc = new Doc(getLines(this, this.first, this.first + this.size),",
          "6455:                         this.modeOption, this.first, this.lineSep, this.direction);",
          "6456:       doc.scrollTop = this.scrollTop; doc.scrollLeft = this.scrollLeft;",
          "6457:       doc.sel = this.sel;",
          "6458:       doc.extend = false;",
          "6459:       if (copyHistory) {",
          "6460:         doc.history.undoDepth = this.history.undoDepth;",
          "6461:         doc.setHistory(this.getHistory());",
          "6462:       }",
          "6463:       return doc",
          "6464:     },",
          "6466:     linkedDoc: function(options) {",
          "6467:       if (!options) { options = {}; }",
          "6468:       var from = this.first, to = this.first + this.size;",
          "6469:       if (options.from != null && options.from > from) { from = options.from; }",
          "6470:       if (options.to != null && options.to < to) { to = options.to; }",
          "6471:       var copy = new Doc(getLines(this, from, to), options.mode || this.modeOption, from, this.lineSep, this.direction);",
          "6472:       if (options.sharedHist) { copy.history = this.history",
          "6473:       ; }(this.linked || (this.linked = [])).push({doc: copy, sharedHist: options.sharedHist});",
          "6474:       copy.linked = [{doc: this, isParent: true, sharedHist: options.sharedHist}];",
          "6475:       copySharedMarkers(copy, findSharedMarkers(this));",
          "6476:       return copy",
          "6477:     },",
          "6478:     unlinkDoc: function(other) {",
          "6479:       if (other instanceof CodeMirror) { other = other.doc; }",
          "6480:       if (this.linked) { for (var i = 0; i < this.linked.length; ++i) {",
          "6481:         var link = this.linked[i];",
          "6482:         if (link.doc != other) { continue }",
          "6483:         this.linked.splice(i, 1);",
          "6484:         other.unlinkDoc(this);",
          "6485:         detachSharedMarkers(findSharedMarkers(this));",
          "6486:         break",
          "6487:       } }",
          "6489:       if (other.history == this.history) {",
          "6490:         var splitIds = [other.id];",
          "6491:         linkedDocs(other, function (doc) { return splitIds.push(doc.id); }, true);",
          "6492:         other.history = new History(null);",
          "6493:         other.history.done = copyHistoryArray(this.history.done, splitIds);",
          "6494:         other.history.undone = copyHistoryArray(this.history.undone, splitIds);",
          "6495:       }",
          "6496:     },",
          "6497:     iterLinkedDocs: function(f) {linkedDocs(this, f);},",
          "6499:     getMode: function() {return this.mode},",
          "6500:     getEditor: function() {return this.cm},",
          "6502:     splitLines: function(str) {",
          "6503:       if (this.lineSep) { return str.split(this.lineSep) }",
          "6504:       return splitLinesAuto(str)",
          "6505:     },",
          "6506:     lineSeparator: function() { return this.lineSep || \"\\n\" },",
          "6508:     setDirection: docMethodOp(function (dir) {",
          "6509:       if (dir != \"rtl\") { dir = \"ltr\"; }",
          "6510:       if (dir == this.direction) { return }",
          "6511:       this.direction = dir;",
          "6512:       this.iter(function (line) { return line.order = null; });",
          "6513:       if (this.cm) { directionChanged(this.cm); }",
          "6514:     })",
          "6515:   });",
          "6518:   Doc.prototype.eachLine = Doc.prototype.iter;",
          "6522:   var lastDrop = 0;",
          "6524:   function onDrop(e) {",
          "6525:     var cm = this;",
          "6526:     clearDragCursor(cm);",
          "6527:     if (signalDOMEvent(cm, e) || eventInWidget(cm.display, e))",
          "6528:       { return }",
          "6529:     e_preventDefault(e);",
          "6530:     if (ie) { lastDrop = +new Date; }",
          "6531:     var pos = posFromMouse(cm, e, true), files = e.dataTransfer.files;",
          "6532:     if (!pos || cm.isReadOnly()) { return }",
          "6535:     if (files && files.length && window.FileReader && window.File) {",
          "6536:       var n = files.length, text = Array(n), read = 0;",
          "6537:       var markAsReadAndPasteIfAllFilesAreRead = function () {",
          "6538:         if (++read == n) {",
          "6539:           operation(cm, function () {",
          "6540:             pos = clipPos(cm.doc, pos);",
          "6541:             var change = {from: pos, to: pos,",
          "6542:                           text: cm.doc.splitLines(",
          "6543:                               text.filter(function (t) { return t != null; }).join(cm.doc.lineSeparator())),",
          "6544:                           origin: \"paste\"};",
          "6545:             makeChange(cm.doc, change);",
          "6546:             setSelectionReplaceHistory(cm.doc, simpleSelection(clipPos(cm.doc, pos), clipPos(cm.doc, changeEnd(change))));",
          "6547:           })();",
          "6548:         }",
          "6549:       };",
          "6550:       var readTextFromFile = function (file, i) {",
          "6551:         if (cm.options.allowDropFileTypes &&",
          "6552:             indexOf(cm.options.allowDropFileTypes, file.type) == -1) {",
          "6553:           markAsReadAndPasteIfAllFilesAreRead();",
          "6554:           return",
          "6555:         }",
          "6556:         var reader = new FileReader;",
          "6557:         reader.onerror = function () { return markAsReadAndPasteIfAllFilesAreRead(); };",
          "6558:         reader.onload = function () {",
          "6559:           var content = reader.result;",
          "6560:           if (/[\\x00-\\x08\\x0e-\\x1f]{2}/.test(content)) {",
          "6561:             markAsReadAndPasteIfAllFilesAreRead();",
          "6562:             return",
          "6563:           }",
          "6564:           text[i] = content;",
          "6565:           markAsReadAndPasteIfAllFilesAreRead();",
          "6566:         };",
          "6567:         reader.readAsText(file);",
          "6568:       };",
          "6569:       for (var i = 0; i < files.length; i++) { readTextFromFile(files[i], i); }",
          "6570:     } else { // Normal drop",
          "6572:       if (cm.state.draggingText && cm.doc.sel.contains(pos) > -1) {",
          "6573:         cm.state.draggingText(e);",
          "6575:         setTimeout(function () { return cm.display.input.focus(); }, 20);",
          "6576:         return",
          "6577:       }",
          "6578:       try {",
          "6579:         var text$1 = e.dataTransfer.getData(\"Text\");",
          "6580:         if (text$1) {",
          "6581:           var selected;",
          "6582:           if (cm.state.draggingText && !cm.state.draggingText.copy)",
          "6583:             { selected = cm.listSelections(); }",
          "6584:           setSelectionNoUndo(cm.doc, simpleSelection(pos, pos));",
          "6585:           if (selected) { for (var i$1 = 0; i$1 < selected.length; ++i$1)",
          "6586:             { replaceRange(cm.doc, \"\", selected[i$1].anchor, selected[i$1].head, \"drag\"); } }",
          "6587:           cm.replaceSelection(text$1, \"around\", \"paste\");",
          "6588:           cm.display.input.focus();",
          "6589:         }",
          "6590:       }",
          "6591:       catch(e$1){}",
          "6592:     }",
          "6593:   }",
          "6595:   function onDragStart(cm, e) {",
          "6596:     if (ie && (!cm.state.draggingText || +new Date - lastDrop < 100)) { e_stop(e); return }",
          "6597:     if (signalDOMEvent(cm, e) || eventInWidget(cm.display, e)) { return }",
          "6599:     e.dataTransfer.setData(\"Text\", cm.getSelection());",
          "6600:     e.dataTransfer.effectAllowed = \"copyMove\";",
          "6604:     if (e.dataTransfer.setDragImage && !safari) {",
          "6605:       var img = elt(\"img\", null, null, \"position: fixed; left: 0; top: 0;\");",
          "6606:       img.src = \"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\";",
          "6607:       if (presto) {",
          "6608:         img.width = img.height = 1;",
          "6609:         cm.display.wrapper.appendChild(img);",
          "6611:         img._top = img.offsetTop;",
          "6612:       }",
          "6613:       e.dataTransfer.setDragImage(img, 0, 0);",
          "6614:       if (presto) { img.parentNode.removeChild(img); }",
          "6615:     }",
          "6616:   }",
          "6618:   function onDragOver(cm, e) {",
          "6619:     var pos = posFromMouse(cm, e);",
          "6620:     if (!pos) { return }",
          "6621:     var frag = document.createDocumentFragment();",
          "6622:     drawSelectionCursor(cm, pos, frag);",
          "6623:     if (!cm.display.dragCursor) {",
          "6624:       cm.display.dragCursor = elt(\"div\", null, \"CodeMirror-cursors CodeMirror-dragcursors\");",
          "6625:       cm.display.lineSpace.insertBefore(cm.display.dragCursor, cm.display.cursorDiv);",
          "6626:     }",
          "6627:     removeChildrenAndAdd(cm.display.dragCursor, frag);",
          "6628:   }",
          "6630:   function clearDragCursor(cm) {",
          "6631:     if (cm.display.dragCursor) {",
          "6632:       cm.display.lineSpace.removeChild(cm.display.dragCursor);",
          "6633:       cm.display.dragCursor = null;",
          "6634:     }",
          "6635:   }",
          "6641:   function forEachCodeMirror(f) {",
          "6642:     if (!document.getElementsByClassName) { return }",
          "6643:     var byClass = document.getElementsByClassName(\"CodeMirror\"), editors = [];",
          "6644:     for (var i = 0; i < byClass.length; i++) {",
          "6645:       var cm = byClass[i].CodeMirror;",
          "6646:       if (cm) { editors.push(cm); }",
          "6647:     }",
          "6648:     if (editors.length) { editors[0].operation(function () {",
          "6649:       for (var i = 0; i < editors.length; i++) { f(editors[i]); }",
          "6650:     }); }",
          "6651:   }",
          "6653:   var globalsRegistered = false;",
          "6654:   function ensureGlobalHandlers() {",
          "6655:     if (globalsRegistered) { return }",
          "6656:     registerGlobalHandlers();",
          "6657:     globalsRegistered = true;",
          "6658:   }",
          "6659:   function registerGlobalHandlers() {",
          "6661:     var resizeTimer;",
          "6662:     on(window, \"resize\", function () {",
          "6663:       if (resizeTimer == null) { resizeTimer = setTimeout(function () {",
          "6664:         resizeTimer = null;",
          "6665:         forEachCodeMirror(onResize);",
          "6666:       }, 100); }",
          "6667:     });",
          "6669:     on(window, \"blur\", function () { return forEachCodeMirror(onBlur); });",
          "6670:   }",
          "6672:   function onResize(cm) {",
          "6673:     var d = cm.display;",
          "6675:     d.cachedCharWidth = d.cachedTextHeight = d.cachedPaddingH = null;",
          "6676:     d.scrollbarsClipped = false;",
          "6677:     cm.setSize();",
          "6678:   }",
          "6680:   var keyNames = {",
          "6681:     3: \"Pause\", 8: \"Backspace\", 9: \"Tab\", 13: \"Enter\", 16: \"Shift\", 17: \"Ctrl\", 18: \"Alt\",",
          "6682:     19: \"Pause\", 20: \"CapsLock\", 27: \"Esc\", 32: \"Space\", 33: \"PageUp\", 34: \"PageDown\", 35: \"End\",",
          "6683:     36: \"Home\", 37: \"Left\", 38: \"Up\", 39: \"Right\", 40: \"Down\", 44: \"PrintScrn\", 45: \"Insert\",",
          "6684:     46: \"Delete\", 59: \";\", 61: \"=\", 91: \"Mod\", 92: \"Mod\", 93: \"Mod\",",
          "6685:     106: \"*\", 107: \"=\", 109: \"-\", 110: \".\", 111: \"/\", 145: \"ScrollLock\",",
          "6686:     173: \"-\", 186: \";\", 187: \"=\", 188: \",\", 189: \"-\", 190: \".\", 191: \"/\", 192: \"`\", 219: \"[\", 220: \"\\\\\",",
          "6687:     221: \"]\", 222: \"'\", 224: \"Mod\", 63232: \"Up\", 63233: \"Down\", 63234: \"Left\", 63235: \"Right\", 63272: \"Delete\",",
          "6688:     63273: \"Home\", 63275: \"End\", 63276: \"PageUp\", 63277: \"PageDown\", 63302: \"Insert\"",
          "6689:   };",
          "6692:   for (var i = 0; i < 10; i++) { keyNames[i + 48] = keyNames[i + 96] = String(i); }",
          "6694:   for (var i$1 = 65; i$1 <= 90; i$1++) { keyNames[i$1] = String.fromCharCode(i$1); }",
          "6696:   for (var i$2 = 1; i$2 <= 12; i$2++) { keyNames[i$2 + 111] = keyNames[i$2 + 63235] = \"F\" + i$2; }",
          "6698:   var keyMap = {};",
          "6700:   keyMap.basic = {",
          "6701:     \"Left\": \"goCharLeft\", \"Right\": \"goCharRight\", \"Up\": \"goLineUp\", \"Down\": \"goLineDown\",",
          "6702:     \"End\": \"goLineEnd\", \"Home\": \"goLineStartSmart\", \"PageUp\": \"goPageUp\", \"PageDown\": \"goPageDown\",",
          "6703:     \"Delete\": \"delCharAfter\", \"Backspace\": \"delCharBefore\", \"Shift-Backspace\": \"delCharBefore\",",
          "6704:     \"Tab\": \"defaultTab\", \"Shift-Tab\": \"indentAuto\",",
          "6705:     \"Enter\": \"newlineAndIndent\", \"Insert\": \"toggleOverwrite\",",
          "6706:     \"Esc\": \"singleSelection\"",
          "6707:   };",
          "6711:   keyMap.pcDefault = {",
          "6712:     \"Ctrl-A\": \"selectAll\", \"Ctrl-D\": \"deleteLine\", \"Ctrl-Z\": \"undo\", \"Shift-Ctrl-Z\": \"redo\", \"Ctrl-Y\": \"redo\",",
          "6713:     \"Ctrl-Home\": \"goDocStart\", \"Ctrl-End\": \"goDocEnd\", \"Ctrl-Up\": \"goLineUp\", \"Ctrl-Down\": \"goLineDown\",",
          "6714:     \"Ctrl-Left\": \"goGroupLeft\", \"Ctrl-Right\": \"goGroupRight\", \"Alt-Left\": \"goLineStart\", \"Alt-Right\": \"goLineEnd\",",
          "6715:     \"Ctrl-Backspace\": \"delGroupBefore\", \"Ctrl-Delete\": \"delGroupAfter\", \"Ctrl-S\": \"save\", \"Ctrl-F\": \"find\",",
          "6716:     \"Ctrl-G\": \"findNext\", \"Shift-Ctrl-G\": \"findPrev\", \"Shift-Ctrl-F\": \"replace\", \"Shift-Ctrl-R\": \"replaceAll\",",
          "6717:     \"Ctrl-[\": \"indentLess\", \"Ctrl-]\": \"indentMore\",",
          "6718:     \"Ctrl-U\": \"undoSelection\", \"Shift-Ctrl-U\": \"redoSelection\", \"Alt-U\": \"redoSelection\",",
          "6719:     \"fallthrough\": \"basic\"",
          "6720:   };",
          "6722:   keyMap.emacsy = {",
          "6723:     \"Ctrl-F\": \"goCharRight\", \"Ctrl-B\": \"goCharLeft\", \"Ctrl-P\": \"goLineUp\", \"Ctrl-N\": \"goLineDown\",",
          "6724:     \"Ctrl-A\": \"goLineStart\", \"Ctrl-E\": \"goLineEnd\", \"Ctrl-V\": \"goPageDown\", \"Shift-Ctrl-V\": \"goPageUp\",",
          "6725:     \"Ctrl-D\": \"delCharAfter\", \"Ctrl-H\": \"delCharBefore\", \"Alt-Backspace\": \"delWordBefore\", \"Ctrl-K\": \"killLine\",",
          "6726:     \"Ctrl-T\": \"transposeChars\", \"Ctrl-O\": \"openLine\"",
          "6727:   };",
          "6728:   keyMap.macDefault = {",
          "6729:     \"Cmd-A\": \"selectAll\", \"Cmd-D\": \"deleteLine\", \"Cmd-Z\": \"undo\", \"Shift-Cmd-Z\": \"redo\", \"Cmd-Y\": \"redo\",",
          "6730:     \"Cmd-Home\": \"goDocStart\", \"Cmd-Up\": \"goDocStart\", \"Cmd-End\": \"goDocEnd\", \"Cmd-Down\": \"goDocEnd\", \"Alt-Left\": \"goGroupLeft\",",
          "6731:     \"Alt-Right\": \"goGroupRight\", \"Cmd-Left\": \"goLineLeft\", \"Cmd-Right\": \"goLineRight\", \"Alt-Backspace\": \"delGroupBefore\",",
          "6732:     \"Ctrl-Alt-Backspace\": \"delGroupAfter\", \"Alt-Delete\": \"delGroupAfter\", \"Cmd-S\": \"save\", \"Cmd-F\": \"find\",",
          "6733:     \"Cmd-G\": \"findNext\", \"Shift-Cmd-G\": \"findPrev\", \"Cmd-Alt-F\": \"replace\", \"Shift-Cmd-Alt-F\": \"replaceAll\",",
          "6734:     \"Cmd-[\": \"indentLess\", \"Cmd-]\": \"indentMore\", \"Cmd-Backspace\": \"delWrappedLineLeft\", \"Cmd-Delete\": \"delWrappedLineRight\",",
          "6735:     \"Cmd-U\": \"undoSelection\", \"Shift-Cmd-U\": \"redoSelection\", \"Ctrl-Up\": \"goDocStart\", \"Ctrl-Down\": \"goDocEnd\",",
          "6736:     \"fallthrough\": [\"basic\", \"emacsy\"]",
          "6737:   };",
          "6738:   keyMap[\"default\"] = mac ? keyMap.macDefault : keyMap.pcDefault;",
          "6742:   function normalizeKeyName(name) {",
          "6743:     var parts = name.split(/-(?!$)/);",
          "6744:     name = parts[parts.length - 1];",
          "6745:     var alt, ctrl, shift, cmd;",
          "6746:     for (var i = 0; i < parts.length - 1; i++) {",
          "6747:       var mod = parts[i];",
          "6748:       if (/^(cmd|meta|m)$/i.test(mod)) { cmd = true; }",
          "6749:       else if (/^a(lt)?$/i.test(mod)) { alt = true; }",
          "6750:       else if (/^(c|ctrl|control)$/i.test(mod)) { ctrl = true; }",
          "6751:       else if (/^s(hift)?$/i.test(mod)) { shift = true; }",
          "6752:       else { throw new Error(\"Unrecognized modifier name: \" + mod) }",
          "6753:     }",
          "6754:     if (alt) { name = \"Alt-\" + name; }",
          "6755:     if (ctrl) { name = \"Ctrl-\" + name; }",
          "6756:     if (cmd) { name = \"Cmd-\" + name; }",
          "6757:     if (shift) { name = \"Shift-\" + name; }",
          "6758:     return name",
          "6759:   }",
          "6766:   function normalizeKeyMap(keymap) {",
          "6767:     var copy = {};",
          "6768:     for (var keyname in keymap) { if (keymap.hasOwnProperty(keyname)) {",
          "6769:       var value = keymap[keyname];",
          "6770:       if (/^(name|fallthrough|(de|at)tach)$/.test(keyname)) { continue }",
          "6771:       if (value == \"...\") { delete keymap[keyname]; continue }",
          "6773:       var keys = map(keyname.split(\" \"), normalizeKeyName);",
          "6774:       for (var i = 0; i < keys.length; i++) {",
          "6775:         var val = (void 0), name = (void 0);",
          "6776:         if (i == keys.length - 1) {",
          "6777:           name = keys.join(\" \");",
          "6778:           val = value;",
          "6779:         } else {",
          "6780:           name = keys.slice(0, i + 1).join(\" \");",
          "6781:           val = \"...\";",
          "6782:         }",
          "6783:         var prev = copy[name];",
          "6784:         if (!prev) { copy[name] = val; }",
          "6785:         else if (prev != val) { throw new Error(\"Inconsistent bindings for \" + name) }",
          "6786:       }",
          "6787:       delete keymap[keyname];",
          "6788:     } }",
          "6789:     for (var prop in copy) { keymap[prop] = copy[prop]; }",
          "6790:     return keymap",
          "6791:   }",
          "6793:   function lookupKey(key, map, handle, context) {",
          "6794:     map = getKeyMap(map);",
          "6795:     var found = map.call ? map.call(key, context) : map[key];",
          "6796:     if (found === false) { return \"nothing\" }",
          "6797:     if (found === \"...\") { return \"multi\" }",
          "6798:     if (found != null && handle(found)) { return \"handled\" }",
          "6800:     if (map.fallthrough) {",
          "6801:       if (Object.prototype.toString.call(map.fallthrough) != \"[object Array]\")",
          "6802:         { return lookupKey(key, map.fallthrough, handle, context) }",
          "6803:       for (var i = 0; i < map.fallthrough.length; i++) {",
          "6804:         var result = lookupKey(key, map.fallthrough[i], handle, context);",
          "6805:         if (result) { return result }",
          "6806:       }",
          "6807:     }",
          "6808:   }",
          "6812:   function isModifierKey(value) {",
          "6813:     var name = typeof value == \"string\" ? value : keyNames[value.keyCode];",
          "6814:     return name == \"Ctrl\" || name == \"Alt\" || name == \"Shift\" || name == \"Mod\"",
          "6815:   }",
          "6817:   function addModifierNames(name, event, noShift) {",
          "6818:     var base = name;",
          "6819:     if (event.altKey && base != \"Alt\") { name = \"Alt-\" + name; }",
          "6820:     if ((flipCtrlCmd ? event.metaKey : event.ctrlKey) && base != \"Ctrl\") { name = \"Ctrl-\" + name; }",
          "6821:     if ((flipCtrlCmd ? event.ctrlKey : event.metaKey) && base != \"Mod\") { name = \"Cmd-\" + name; }",
          "6822:     if (!noShift && event.shiftKey && base != \"Shift\") { name = \"Shift-\" + name; }",
          "6823:     return name",
          "6824:   }",
          "6827:   function keyName(event, noShift) {",
          "6828:     if (presto && event.keyCode == 34 && event[\"char\"]) { return false }",
          "6829:     var name = keyNames[event.keyCode];",
          "6830:     if (name == null || event.altGraphKey) { return false }",
          "6833:     if (event.keyCode == 3 && event.code) { name = event.code; }",
          "6834:     return addModifierNames(name, event, noShift)",
          "6835:   }",
          "6837:   function getKeyMap(val) {",
          "6838:     return typeof val == \"string\" ? keyMap[val] : val",
          "6839:   }",
          "6843:   function deleteNearSelection(cm, compute) {",
          "6844:     var ranges = cm.doc.sel.ranges, kill = [];",
          "6847:     for (var i = 0; i < ranges.length; i++) {",
          "6848:       var toKill = compute(ranges[i]);",
          "6849:       while (kill.length && cmp(toKill.from, lst(kill).to) <= 0) {",
          "6850:         var replaced = kill.pop();",
          "6851:         if (cmp(replaced.from, toKill.from) < 0) {",
          "6852:           toKill.from = replaced.from;",
          "6853:           break",
          "6854:         }",
          "6855:       }",
          "6856:       kill.push(toKill);",
          "6857:     }",
          "6859:     runInOp(cm, function () {",
          "6860:       for (var i = kill.length - 1; i >= 0; i--)",
          "6861:         { replaceRange(cm.doc, \"\", kill[i].from, kill[i].to, \"+delete\"); }",
          "6862:       ensureCursorVisible(cm);",
          "6863:     });",
          "6864:   }",
          "6866:   function moveCharLogically(line, ch, dir) {",
          "6867:     var target = skipExtendingChars(line.text, ch + dir, dir);",
          "6868:     return target < 0 || target > line.text.length ? null : target",
          "6869:   }",
          "6871:   function moveLogically(line, start, dir) {",
          "6872:     var ch = moveCharLogically(line, start.ch, dir);",
          "6873:     return ch == null ? null : new Pos(start.line, ch, dir < 0 ? \"after\" : \"before\")",
          "6874:   }",
          "6876:   function endOfLine(visually, cm, lineObj, lineNo, dir) {",
          "6877:     if (visually) {",
          "6878:       if (cm.doc.direction == \"rtl\") { dir = -dir; }",
          "6879:       var order = getOrder(lineObj, cm.doc.direction);",
          "6880:       if (order) {",
          "6881:         var part = dir < 0 ? lst(order) : order[0];",
          "6882:         var moveInStorageOrder = (dir < 0) == (part.level == 1);",
          "6883:         var sticky = moveInStorageOrder ? \"after\" : \"before\";",
          "6884:         var ch;",
          "6891:         if (part.level > 0 || cm.doc.direction == \"rtl\") {",
          "6892:           var prep = prepareMeasureForLine(cm, lineObj);",
          "6893:           ch = dir < 0 ? lineObj.text.length - 1 : 0;",
          "6894:           var targetTop = measureCharPrepared(cm, prep, ch).top;",
          "6895:           ch = findFirst(function (ch) { return measureCharPrepared(cm, prep, ch).top == targetTop; }, (dir < 0) == (part.level == 1) ? part.from : part.to - 1, ch);",
          "6896:           if (sticky == \"before\") { ch = moveCharLogically(lineObj, ch, 1); }",
          "6897:         } else { ch = dir < 0 ? part.to : part.from; }",
          "6898:         return new Pos(lineNo, ch, sticky)",
          "6899:       }",
          "6900:     }",
          "6901:     return new Pos(lineNo, dir < 0 ? lineObj.text.length : 0, dir < 0 ? \"before\" : \"after\")",
          "6902:   }",
          "6904:   function moveVisually(cm, line, start, dir) {",
          "6905:     var bidi = getOrder(line, cm.doc.direction);",
          "6906:     if (!bidi) { return moveLogically(line, start, dir) }",
          "6907:     if (start.ch >= line.text.length) {",
          "6908:       start.ch = line.text.length;",
          "6909:       start.sticky = \"before\";",
          "6910:     } else if (start.ch <= 0) {",
          "6911:       start.ch = 0;",
          "6912:       start.sticky = \"after\";",
          "6913:     }",
          "6914:     var partPos = getBidiPartAt(bidi, start.ch, start.sticky), part = bidi[partPos];",
          "6915:     if (cm.doc.direction == \"ltr\" && part.level % 2 == 0 && (dir > 0 ? part.to > start.ch : part.from < start.ch)) {",
          "6918:       return moveLogically(line, start, dir)",
          "6919:     }",
          "6921:     var mv = function (pos, dir) { return moveCharLogically(line, pos instanceof Pos ? pos.ch : pos, dir); };",
          "6922:     var prep;",
          "6923:     var getWrappedLineExtent = function (ch) {",
          "6924:       if (!cm.options.lineWrapping) { return {begin: 0, end: line.text.length} }",
          "6925:       prep = prep || prepareMeasureForLine(cm, line);",
          "6926:       return wrappedLineExtentChar(cm, line, prep, ch)",
          "6927:     };",
          "6928:     var wrappedLineExtent = getWrappedLineExtent(start.sticky == \"before\" ? mv(start, -1) : start.ch);",
          "6930:     if (cm.doc.direction == \"rtl\" || part.level == 1) {",
          "6931:       var moveInStorageOrder = (part.level == 1) == (dir < 0);",
          "6932:       var ch = mv(start, moveInStorageOrder ? 1 : -1);",
          "6933:       if (ch != null && (!moveInStorageOrder ? ch >= part.from && ch >= wrappedLineExtent.begin : ch <= part.to && ch <= wrappedLineExtent.end)) {",
          "6935:         var sticky = moveInStorageOrder ? \"before\" : \"after\";",
          "6936:         return new Pos(start.line, ch, sticky)",
          "6937:       }",
          "6938:     }",
          "6943:     var searchInVisualLine = function (partPos, dir, wrappedLineExtent) {",
          "6944:       var getRes = function (ch, moveInStorageOrder) { return moveInStorageOrder",
          "6945:         ? new Pos(start.line, mv(ch, 1), \"before\")",
          "6946:         : new Pos(start.line, ch, \"after\"); };",
          "6948:       for (; partPos >= 0 && partPos < bidi.length; partPos += dir) {",
          "6949:         var part = bidi[partPos];",
          "6950:         var moveInStorageOrder = (dir > 0) == (part.level != 1);",
          "6951:         var ch = moveInStorageOrder ? wrappedLineExtent.begin : mv(wrappedLineExtent.end, -1);",
          "6952:         if (part.from <= ch && ch < part.to) { return getRes(ch, moveInStorageOrder) }",
          "6953:         ch = moveInStorageOrder ? part.from : mv(part.to, -1);",
          "6954:         if (wrappedLineExtent.begin <= ch && ch < wrappedLineExtent.end) { return getRes(ch, moveInStorageOrder) }",
          "6955:       }",
          "6956:     };",
          "6959:     var res = searchInVisualLine(partPos + dir, dir, wrappedLineExtent);",
          "6960:     if (res) { return res }",
          "6963:     var nextCh = dir > 0 ? wrappedLineExtent.end : mv(wrappedLineExtent.begin, -1);",
          "6964:     if (nextCh != null && !(dir > 0 && nextCh == line.text.length)) {",
          "6965:       res = searchInVisualLine(dir > 0 ? 0 : bidi.length - 1, dir, getWrappedLineExtent(nextCh));",
          "6966:       if (res) { return res }",
          "6967:     }",
          "6970:     return null",
          "6971:   }",
          "6975:   var commands = {",
          "6976:     selectAll: selectAll,",
          "6977:     singleSelection: function (cm) { return cm.setSelection(cm.getCursor(\"anchor\"), cm.getCursor(\"head\"), sel_dontScroll); },",
          "6978:     killLine: function (cm) { return deleteNearSelection(cm, function (range) {",
          "6979:       if (range.empty()) {",
          "6980:         var len = getLine(cm.doc, range.head.line).text.length;",
          "6981:         if (range.head.ch == len && range.head.line < cm.lastLine())",
          "6982:           { return {from: range.head, to: Pos(range.head.line + 1, 0)} }",
          "6983:         else",
          "6984:           { return {from: range.head, to: Pos(range.head.line, len)} }",
          "6985:       } else {",
          "6986:         return {from: range.from(), to: range.to()}",
          "6987:       }",
          "6988:     }); },",
          "6989:     deleteLine: function (cm) { return deleteNearSelection(cm, function (range) { return ({",
          "6990:       from: Pos(range.from().line, 0),",
          "6991:       to: clipPos(cm.doc, Pos(range.to().line + 1, 0))",
          "6992:     }); }); },",
          "6993:     delLineLeft: function (cm) { return deleteNearSelection(cm, function (range) { return ({",
          "6994:       from: Pos(range.from().line, 0), to: range.from()",
          "6995:     }); }); },",
          "6996:     delWrappedLineLeft: function (cm) { return deleteNearSelection(cm, function (range) {",
          "6997:       var top = cm.charCoords(range.head, \"div\").top + 5;",
          "6998:       var leftPos = cm.coordsChar({left: 0, top: top}, \"div\");",
          "6999:       return {from: leftPos, to: range.from()}",
          "7000:     }); },",
          "7001:     delWrappedLineRight: function (cm) { return deleteNearSelection(cm, function (range) {",
          "7002:       var top = cm.charCoords(range.head, \"div\").top + 5;",
          "7003:       var rightPos = cm.coordsChar({left: cm.display.lineDiv.offsetWidth + 100, top: top}, \"div\");",
          "7004:       return {from: range.from(), to: rightPos }",
          "7005:     }); },",
          "7006:     undo: function (cm) { return cm.undo(); },",
          "7007:     redo: function (cm) { return cm.redo(); },",
          "7008:     undoSelection: function (cm) { return cm.undoSelection(); },",
          "7009:     redoSelection: function (cm) { return cm.redoSelection(); },",
          "7010:     goDocStart: function (cm) { return cm.extendSelection(Pos(cm.firstLine(), 0)); },",
          "7011:     goDocEnd: function (cm) { return cm.extendSelection(Pos(cm.lastLine())); },",
          "7012:     goLineStart: function (cm) { return cm.extendSelectionsBy(function (range) { return lineStart(cm, range.head.line); },",
          "7013:       {origin: \"+move\", bias: 1}",
          "7014:     ); },",
          "7015:     goLineStartSmart: function (cm) { return cm.extendSelectionsBy(function (range) { return lineStartSmart(cm, range.head); },",
          "7016:       {origin: \"+move\", bias: 1}",
          "7017:     ); },",
          "7018:     goLineEnd: function (cm) { return cm.extendSelectionsBy(function (range) { return lineEnd(cm, range.head.line); },",
          "7019:       {origin: \"+move\", bias: -1}",
          "7020:     ); },",
          "7021:     goLineRight: function (cm) { return cm.extendSelectionsBy(function (range) {",
          "7022:       var top = cm.cursorCoords(range.head, \"div\").top + 5;",
          "7023:       return cm.coordsChar({left: cm.display.lineDiv.offsetWidth + 100, top: top}, \"div\")",
          "7024:     }, sel_move); },",
          "7025:     goLineLeft: function (cm) { return cm.extendSelectionsBy(function (range) {",
          "7026:       var top = cm.cursorCoords(range.head, \"div\").top + 5;",
          "7027:       return cm.coordsChar({left: 0, top: top}, \"div\")",
          "7028:     }, sel_move); },",
          "7029:     goLineLeftSmart: function (cm) { return cm.extendSelectionsBy(function (range) {",
          "7030:       var top = cm.cursorCoords(range.head, \"div\").top + 5;",
          "7031:       var pos = cm.coordsChar({left: 0, top: top}, \"div\");",
          "7032:       if (pos.ch < cm.getLine(pos.line).search(/\\S/)) { return lineStartSmart(cm, range.head) }",
          "7033:       return pos",
          "7034:     }, sel_move); },",
          "7035:     goLineUp: function (cm) { return cm.moveV(-1, \"line\"); },",
          "7036:     goLineDown: function (cm) { return cm.moveV(1, \"line\"); },",
          "7037:     goPageUp: function (cm) { return cm.moveV(-1, \"page\"); },",
          "7038:     goPageDown: function (cm) { return cm.moveV(1, \"page\"); },",
          "7039:     goCharLeft: function (cm) { return cm.moveH(-1, \"char\"); },",
          "7040:     goCharRight: function (cm) { return cm.moveH(1, \"char\"); },",
          "7041:     goColumnLeft: function (cm) { return cm.moveH(-1, \"column\"); },",
          "7042:     goColumnRight: function (cm) { return cm.moveH(1, \"column\"); },",
          "7043:     goWordLeft: function (cm) { return cm.moveH(-1, \"word\"); },",
          "7044:     goGroupRight: function (cm) { return cm.moveH(1, \"group\"); },",
          "7045:     goGroupLeft: function (cm) { return cm.moveH(-1, \"group\"); },",
          "7046:     goWordRight: function (cm) { return cm.moveH(1, \"word\"); },",
          "7047:     delCharBefore: function (cm) { return cm.deleteH(-1, \"codepoint\"); },",
          "7048:     delCharAfter: function (cm) { return cm.deleteH(1, \"char\"); },",
          "7049:     delWordBefore: function (cm) { return cm.deleteH(-1, \"word\"); },",
          "7050:     delWordAfter: function (cm) { return cm.deleteH(1, \"word\"); },",
          "7051:     delGroupBefore: function (cm) { return cm.deleteH(-1, \"group\"); },",
          "7052:     delGroupAfter: function (cm) { return cm.deleteH(1, \"group\"); },",
          "7053:     indentAuto: function (cm) { return cm.indentSelection(\"smart\"); },",
          "7054:     indentMore: function (cm) { return cm.indentSelection(\"add\"); },",
          "7055:     indentLess: function (cm) { return cm.indentSelection(\"subtract\"); },",
          "7056:     insertTab: function (cm) { return cm.replaceSelection(\"\\t\"); },",
          "7057:     insertSoftTab: function (cm) {",
          "7058:       var spaces = [], ranges = cm.listSelections(), tabSize = cm.options.tabSize;",
          "7059:       for (var i = 0; i < ranges.length; i++) {",
          "7060:         var pos = ranges[i].from();",
          "7061:         var col = countColumn(cm.getLine(pos.line), pos.ch, tabSize);",
          "7062:         spaces.push(spaceStr(tabSize - col % tabSize));",
          "7063:       }",
          "7064:       cm.replaceSelections(spaces);",
          "7065:     },",
          "7066:     defaultTab: function (cm) {",
          "7067:       if (cm.somethingSelected()) { cm.indentSelection(\"add\"); }",
          "7068:       else { cm.execCommand(\"insertTab\"); }",
          "7069:     },",
          "7077:     transposeChars: function (cm) { return runInOp(cm, function () {",
          "7078:       var ranges = cm.listSelections(), newSel = [];",
          "7079:       for (var i = 0; i < ranges.length; i++) {",
          "7080:         if (!ranges[i].empty()) { continue }",
          "7081:         var cur = ranges[i].head, line = getLine(cm.doc, cur.line).text;",
          "7082:         if (line) {",
          "7083:           if (cur.ch == line.length) { cur = new Pos(cur.line, cur.ch - 1); }",
          "7084:           if (cur.ch > 0) {",
          "7085:             cur = new Pos(cur.line, cur.ch + 1);",
          "7086:             cm.replaceRange(line.charAt(cur.ch - 1) + line.charAt(cur.ch - 2),",
          "7087:                             Pos(cur.line, cur.ch - 2), cur, \"+transpose\");",
          "7088:           } else if (cur.line > cm.doc.first) {",
          "7089:             var prev = getLine(cm.doc, cur.line - 1).text;",
          "7090:             if (prev) {",
          "7091:               cur = new Pos(cur.line, 1);",
          "7092:               cm.replaceRange(line.charAt(0) + cm.doc.lineSeparator() +",
          "7093:                               prev.charAt(prev.length - 1),",
          "7094:                               Pos(cur.line - 1, prev.length - 1), cur, \"+transpose\");",
          "7095:             }",
          "7096:           }",
          "7097:         }",
          "7098:         newSel.push(new Range(cur, cur));",
          "7099:       }",
          "7100:       cm.setSelections(newSel);",
          "7101:     }); },",
          "7102:     newlineAndIndent: function (cm) { return runInOp(cm, function () {",
          "7103:       var sels = cm.listSelections();",
          "7104:       for (var i = sels.length - 1; i >= 0; i--)",
          "7105:         { cm.replaceRange(cm.doc.lineSeparator(), sels[i].anchor, sels[i].head, \"+input\"); }",
          "7106:       sels = cm.listSelections();",
          "7107:       for (var i$1 = 0; i$1 < sels.length; i$1++)",
          "7108:         { cm.indentLine(sels[i$1].from().line, null, true); }",
          "7109:       ensureCursorVisible(cm);",
          "7110:     }); },",
          "7111:     openLine: function (cm) { return cm.replaceSelection(\"\\n\", \"start\"); },",
          "7112:     toggleOverwrite: function (cm) { return cm.toggleOverwrite(); }",
          "7113:   };",
          "7116:   function lineStart(cm, lineN) {",
          "7117:     var line = getLine(cm.doc, lineN);",
          "7118:     var visual = visualLine(line);",
          "7119:     if (visual != line) { lineN = lineNo(visual); }",
          "7120:     return endOfLine(true, cm, visual, lineN, 1)",
          "7121:   }",
          "7122:   function lineEnd(cm, lineN) {",
          "7123:     var line = getLine(cm.doc, lineN);",
          "7124:     var visual = visualLineEnd(line);",
          "7125:     if (visual != line) { lineN = lineNo(visual); }",
          "7126:     return endOfLine(true, cm, line, lineN, -1)",
          "7127:   }",
          "7128:   function lineStartSmart(cm, pos) {",
          "7129:     var start = lineStart(cm, pos.line);",
          "7130:     var line = getLine(cm.doc, start.line);",
          "7131:     var order = getOrder(line, cm.doc.direction);",
          "7132:     if (!order || order[0].level == 0) {",
          "7133:       var firstNonWS = Math.max(start.ch, line.text.search(/\\S/));",
          "7134:       var inWS = pos.line == start.line && pos.ch <= firstNonWS && pos.ch;",
          "7135:       return Pos(start.line, inWS ? 0 : firstNonWS, start.sticky)",
          "7136:     }",
          "7137:     return start",
          "7138:   }",
          "7141:   function doHandleBinding(cm, bound, dropShift) {",
          "7142:     if (typeof bound == \"string\") {",
          "7143:       bound = commands[bound];",
          "7144:       if (!bound) { return false }",
          "7145:     }",
          "7148:     cm.display.input.ensurePolled();",
          "7149:     var prevShift = cm.display.shift, done = false;",
          "7150:     try {",
          "7151:       if (cm.isReadOnly()) { cm.state.suppressEdits = true; }",
          "7152:       if (dropShift) { cm.display.shift = false; }",
          "7153:       done = bound(cm) != Pass;",
          "7154:     } finally {",
          "7155:       cm.display.shift = prevShift;",
          "7156:       cm.state.suppressEdits = false;",
          "7157:     }",
          "7158:     return done",
          "7159:   }",
          "7161:   function lookupKeyForEditor(cm, name, handle) {",
          "7162:     for (var i = 0; i < cm.state.keyMaps.length; i++) {",
          "7163:       var result = lookupKey(name, cm.state.keyMaps[i], handle, cm);",
          "7164:       if (result) { return result }",
          "7165:     }",
          "7166:     return (cm.options.extraKeys && lookupKey(name, cm.options.extraKeys, handle, cm))",
          "7167:       || lookupKey(name, cm.options.keyMap, handle, cm)",
          "7168:   }",
          "7173:   var stopSeq = new Delayed;",
          "7175:   function dispatchKey(cm, name, e, handle) {",
          "7176:     var seq = cm.state.keySeq;",
          "7177:     if (seq) {",
          "7178:       if (isModifierKey(name)) { return \"handled\" }",
          "7179:       if (/\\'$/.test(name))",
          "7180:         { cm.state.keySeq = null; }",
          "7181:       else",
          "7182:         { stopSeq.set(50, function () {",
          "7183:           if (cm.state.keySeq == seq) {",
          "7184:             cm.state.keySeq = null;",
          "7185:             cm.display.input.reset();",
          "7186:           }",
          "7187:         }); }",
          "7188:       if (dispatchKeyInner(cm, seq + \" \" + name, e, handle)) { return true }",
          "7189:     }",
          "7190:     return dispatchKeyInner(cm, name, e, handle)",
          "7191:   }",
          "7193:   function dispatchKeyInner(cm, name, e, handle) {",
          "7194:     var result = lookupKeyForEditor(cm, name, handle);",
          "7196:     if (result == \"multi\")",
          "7197:       { cm.state.keySeq = name; }",
          "7198:     if (result == \"handled\")",
          "7199:       { signalLater(cm, \"keyHandled\", cm, name, e); }",
          "7201:     if (result == \"handled\" || result == \"multi\") {",
          "7202:       e_preventDefault(e);",
          "7203:       restartBlink(cm);",
          "7204:     }",
          "7206:     return !!result",
          "7207:   }",
          "7210:   function handleKeyBinding(cm, e) {",
          "7211:     var name = keyName(e, true);",
          "7212:     if (!name) { return false }",
          "7214:     if (e.shiftKey && !cm.state.keySeq) {",
          "7218:       return dispatchKey(cm, \"Shift-\" + name, e, function (b) { return doHandleBinding(cm, b, true); })",
          "7219:           || dispatchKey(cm, name, e, function (b) {",
          "7220:                if (typeof b == \"string\" ? /^go[A-Z]/.test(b) : b.motion)",
          "7221:                  { return doHandleBinding(cm, b) }",
          "7222:              })",
          "7223:     } else {",
          "7224:       return dispatchKey(cm, name, e, function (b) { return doHandleBinding(cm, b); })",
          "7225:     }",
          "7226:   }",
          "7229:   function handleCharBinding(cm, e, ch) {",
          "7230:     return dispatchKey(cm, \"'\" + ch + \"'\", e, function (b) { return doHandleBinding(cm, b, true); })",
          "7231:   }",
          "7233:   var lastStoppedKey = null;",
          "7234:   function onKeyDown(e) {",
          "7235:     var cm = this;",
          "7236:     if (e.target && e.target != cm.display.input.getField()) { return }",
          "7237:     cm.curOp.focus = activeElt();",
          "7238:     if (signalDOMEvent(cm, e)) { return }",
          "7240:     if (ie && ie_version < 11 && e.keyCode == 27) { e.returnValue = false; }",
          "7241:     var code = e.keyCode;",
          "7242:     cm.display.shift = code == 16 || e.shiftKey;",
          "7243:     var handled = handleKeyBinding(cm, e);",
          "7244:     if (presto) {",
          "7245:       lastStoppedKey = handled ? code : null;",
          "7247:       if (!handled && code == 88 && !hasCopyEvent && (mac ? e.metaKey : e.ctrlKey))",
          "7248:         { cm.replaceSelection(\"\", null, \"cut\"); }",
          "7249:     }",
          "7250:     if (gecko && !mac && !handled && code == 46 && e.shiftKey && !e.ctrlKey && document.execCommand)",
          "7251:       { document.execCommand(\"cut\"); }",
          "7254:     if (code == 18 && !/\\bCodeMirror-crosshair\\b/.test(cm.display.lineDiv.className))",
          "7255:       { showCrossHair(cm); }",
          "7256:   }",
          "7258:   function showCrossHair(cm) {",
          "7259:     var lineDiv = cm.display.lineDiv;",
          "7260:     addClass(lineDiv, \"CodeMirror-crosshair\");",
          "7262:     function up(e) {",
          "7263:       if (e.keyCode == 18 || !e.altKey) {",
          "7264:         rmClass(lineDiv, \"CodeMirror-crosshair\");",
          "7265:         off(document, \"keyup\", up);",
          "7266:         off(document, \"mouseover\", up);",
          "7267:       }",
          "7268:     }",
          "7269:     on(document, \"keyup\", up);",
          "7270:     on(document, \"mouseover\", up);",
          "7271:   }",
          "7273:   function onKeyUp(e) {",
          "7274:     if (e.keyCode == 16) { this.doc.sel.shift = false; }",
          "7275:     signalDOMEvent(this, e);",
          "7276:   }",
          "7278:   function onKeyPress(e) {",
          "7279:     var cm = this;",
          "7280:     if (e.target && e.target != cm.display.input.getField()) { return }",
          "7281:     if (eventInWidget(cm.display, e) || signalDOMEvent(cm, e) || e.ctrlKey && !e.altKey || mac && e.metaKey) { return }",
          "7282:     var keyCode = e.keyCode, charCode = e.charCode;",
          "7283:     if (presto && keyCode == lastStoppedKey) {lastStoppedKey = null; e_preventDefault(e); return}",
          "7284:     if ((presto && (!e.which || e.which < 10)) && handleKeyBinding(cm, e)) { return }",
          "7285:     var ch = String.fromCharCode(charCode == null ? keyCode : charCode);",
          "7287:     if (ch == \"\\x08\") { return }",
          "7288:     if (handleCharBinding(cm, e, ch)) { return }",
          "7289:     cm.display.input.onKeyPress(e);",
          "7290:   }",
          "7292:   var DOUBLECLICK_DELAY = 400;",
          "7294:   var PastClick = function(time, pos, button) {",
          "7295:     this.time = time;",
          "7296:     this.pos = pos;",
          "7297:     this.button = button;",
          "7298:   };",
          "7300:   PastClick.prototype.compare = function (time, pos, button) {",
          "7301:     return this.time + DOUBLECLICK_DELAY > time &&",
          "7302:       cmp(pos, this.pos) == 0 && button == this.button",
          "7303:   };",
          "7305:   var lastClick, lastDoubleClick;",
          "7306:   function clickRepeat(pos, button) {",
          "7307:     var now = +new Date;",
          "7308:     if (lastDoubleClick && lastDoubleClick.compare(now, pos, button)) {",
          "7309:       lastClick = lastDoubleClick = null;",
          "7310:       return \"triple\"",
          "7311:     } else if (lastClick && lastClick.compare(now, pos, button)) {",
          "7312:       lastDoubleClick = new PastClick(now, pos, button);",
          "7313:       lastClick = null;",
          "7314:       return \"double\"",
          "7315:     } else {",
          "7316:       lastClick = new PastClick(now, pos, button);",
          "7317:       lastDoubleClick = null;",
          "7318:       return \"single\"",
          "7319:     }",
          "7320:   }",
          "7327:   function onMouseDown(e) {",
          "7328:     var cm = this, display = cm.display;",
          "7329:     if (signalDOMEvent(cm, e) || display.activeTouch && display.input.supportsTouch()) { return }",
          "7330:     display.input.ensurePolled();",
          "7331:     display.shift = e.shiftKey;",
          "7333:     if (eventInWidget(display, e)) {",
          "7334:       if (!webkit) {",
          "7337:         display.scroller.draggable = false;",
          "7338:         setTimeout(function () { return display.scroller.draggable = true; }, 100);",
          "7339:       }",
          "7340:       return",
          "7341:     }",
          "7342:     if (clickInGutter(cm, e)) { return }",
          "7343:     var pos = posFromMouse(cm, e), button = e_button(e), repeat = pos ? clickRepeat(pos, button) : \"single\";",
          "7344:     window.focus();",
          "7347:     if (button == 1 && cm.state.selectingText)",
          "7348:       { cm.state.selectingText(e); }",
          "7350:     if (pos && handleMappedButton(cm, button, pos, repeat, e)) { return }",
          "7352:     if (button == 1) {",
          "7353:       if (pos) { leftButtonDown(cm, pos, repeat, e); }",
          "7354:       else if (e_target(e) == display.scroller) { e_preventDefault(e); }",
          "7355:     } else if (button == 2) {",
          "7356:       if (pos) { extendSelection(cm.doc, pos); }",
          "7357:       setTimeout(function () { return display.input.focus(); }, 20);",
          "7358:     } else if (button == 3) {",
          "7359:       if (captureRightClick) { cm.display.input.onContextMenu(e); }",
          "7360:       else { delayBlurEvent(cm); }",
          "7361:     }",
          "7362:   }",
          "7364:   function handleMappedButton(cm, button, pos, repeat, event) {",
          "7365:     var name = \"Click\";",
          "7366:     if (repeat == \"double\") { name = \"Double\" + name; }",
          "7367:     else if (repeat == \"triple\") { name = \"Triple\" + name; }",
          "7368:     name = (button == 1 ? \"Left\" : button == 2 ? \"Middle\" : \"Right\") + name;",
          "7370:     return dispatchKey(cm,  addModifierNames(name, event), event, function (bound) {",
          "7371:       if (typeof bound == \"string\") { bound = commands[bound]; }",
          "7372:       if (!bound) { return false }",
          "7373:       var done = false;",
          "7374:       try {",
          "7375:         if (cm.isReadOnly()) { cm.state.suppressEdits = true; }",
          "7376:         done = bound(cm, pos) != Pass;",
          "7377:       } finally {",
          "7378:         cm.state.suppressEdits = false;",
          "7379:       }",
          "7380:       return done",
          "7381:     })",
          "7382:   }",
          "7384:   function configureMouse(cm, repeat, event) {",
          "7385:     var option = cm.getOption(\"configureMouse\");",
          "7386:     var value = option ? option(cm, repeat, event) : {};",
          "7387:     if (value.unit == null) {",
          "7388:       var rect = chromeOS ? event.shiftKey && event.metaKey : event.altKey;",
          "7389:       value.unit = rect ? \"rectangle\" : repeat == \"single\" ? \"char\" : repeat == \"double\" ? \"word\" : \"line\";",
          "7390:     }",
          "7391:     if (value.extend == null || cm.doc.extend) { value.extend = cm.doc.extend || event.shiftKey; }",
          "7392:     if (value.addNew == null) { value.addNew = mac ? event.metaKey : event.ctrlKey; }",
          "7393:     if (value.moveOnDrag == null) { value.moveOnDrag = !(mac ? event.altKey : event.ctrlKey); }",
          "7394:     return value",
          "7395:   }",
          "7397:   function leftButtonDown(cm, pos, repeat, event) {",
          "7398:     if (ie) { setTimeout(bind(ensureFocus, cm), 0); }",
          "7399:     else { cm.curOp.focus = activeElt(); }",
          "7401:     var behavior = configureMouse(cm, repeat, event);",
          "7403:     var sel = cm.doc.sel, contained;",
          "7404:     if (cm.options.dragDrop && dragAndDrop && !cm.isReadOnly() &&",
          "7405:         repeat == \"single\" && (contained = sel.contains(pos)) > -1 &&",
          "7406:         (cmp((contained = sel.ranges[contained]).from(), pos) < 0 || pos.xRel > 0) &&",
          "7407:         (cmp(contained.to(), pos) > 0 || pos.xRel < 0))",
          "7408:       { leftButtonStartDrag(cm, event, pos, behavior); }",
          "7409:     else",
          "7410:       { leftButtonSelect(cm, event, pos, behavior); }",
          "7411:   }",
          "7415:   function leftButtonStartDrag(cm, event, pos, behavior) {",
          "7416:     var display = cm.display, moved = false;",
          "7417:     var dragEnd = operation(cm, function (e) {",
          "7418:       if (webkit) { display.scroller.draggable = false; }",
          "7419:       cm.state.draggingText = false;",
          "7420:       if (cm.state.delayingBlurEvent) {",
          "7421:         if (cm.hasFocus()) { cm.state.delayingBlurEvent = false; }",
          "7422:         else { delayBlurEvent(cm); }",
          "7423:       }",
          "7424:       off(display.wrapper.ownerDocument, \"mouseup\", dragEnd);",
          "7425:       off(display.wrapper.ownerDocument, \"mousemove\", mouseMove);",
          "7426:       off(display.scroller, \"dragstart\", dragStart);",
          "7427:       off(display.scroller, \"drop\", dragEnd);",
          "7428:       if (!moved) {",
          "7429:         e_preventDefault(e);",
          "7430:         if (!behavior.addNew)",
          "7431:           { extendSelection(cm.doc, pos, null, null, behavior.extend); }",
          "7433:         if ((webkit && !safari) || ie && ie_version == 9)",
          "7434:           { setTimeout(function () {display.wrapper.ownerDocument.body.focus({preventScroll: true}); display.input.focus();}, 20); }",
          "7435:         else",
          "7436:           { display.input.focus(); }",
          "7437:       }",
          "7438:     });",
          "7439:     var mouseMove = function(e2) {",
          "7440:       moved = moved || Math.abs(event.clientX - e2.clientX) + Math.abs(event.clientY - e2.clientY) >= 10;",
          "7441:     };",
          "7442:     var dragStart = function () { return moved = true; };",
          "7444:     if (webkit) { display.scroller.draggable = true; }",
          "7445:     cm.state.draggingText = dragEnd;",
          "7446:     dragEnd.copy = !behavior.moveOnDrag;",
          "7447:     on(display.wrapper.ownerDocument, \"mouseup\", dragEnd);",
          "7448:     on(display.wrapper.ownerDocument, \"mousemove\", mouseMove);",
          "7449:     on(display.scroller, \"dragstart\", dragStart);",
          "7450:     on(display.scroller, \"drop\", dragEnd);",
          "7452:     cm.state.delayingBlurEvent = true;",
          "7453:     setTimeout(function () { return display.input.focus(); }, 20);",
          "7455:     if (display.scroller.dragDrop) { display.scroller.dragDrop(); }",
          "7456:   }",
          "7458:   function rangeForUnit(cm, pos, unit) {",
          "7459:     if (unit == \"char\") { return new Range(pos, pos) }",
          "7460:     if (unit == \"word\") { return cm.findWordAt(pos) }",
          "7461:     if (unit == \"line\") { return new Range(Pos(pos.line, 0), clipPos(cm.doc, Pos(pos.line + 1, 0))) }",
          "7462:     var result = unit(cm, pos);",
          "7463:     return new Range(result.from, result.to)",
          "7464:   }",
          "7467:   function leftButtonSelect(cm, event, start, behavior) {",
          "7468:     if (ie) { delayBlurEvent(cm); }",
          "7469:     var display = cm.display, doc = cm.doc;",
          "7470:     e_preventDefault(event);",
          "7472:     var ourRange, ourIndex, startSel = doc.sel, ranges = startSel.ranges;",
          "7473:     if (behavior.addNew && !behavior.extend) {",
          "7474:       ourIndex = doc.sel.contains(start);",
          "7475:       if (ourIndex > -1)",
          "7476:         { ourRange = ranges[ourIndex]; }",
          "7477:       else",
          "7478:         { ourRange = new Range(start, start); }",
          "7479:     } else {",
          "7480:       ourRange = doc.sel.primary();",
          "7481:       ourIndex = doc.sel.primIndex;",
          "7482:     }",
          "7484:     if (behavior.unit == \"rectangle\") {",
          "7485:       if (!behavior.addNew) { ourRange = new Range(start, start); }",
          "7486:       start = posFromMouse(cm, event, true, true);",
          "7487:       ourIndex = -1;",
          "7488:     } else {",
          "7489:       var range = rangeForUnit(cm, start, behavior.unit);",
          "7490:       if (behavior.extend)",
          "7491:         { ourRange = extendRange(ourRange, range.anchor, range.head, behavior.extend); }",
          "7492:       else",
          "7493:         { ourRange = range; }",
          "7494:     }",
          "7496:     if (!behavior.addNew) {",
          "7497:       ourIndex = 0;",
          "7498:       setSelection(doc, new Selection([ourRange], 0), sel_mouse);",
          "7499:       startSel = doc.sel;",
          "7500:     } else if (ourIndex == -1) {",
          "7501:       ourIndex = ranges.length;",
          "7502:       setSelection(doc, normalizeSelection(cm, ranges.concat([ourRange]), ourIndex),",
          "7503:                    {scroll: false, origin: \"*mouse\"});",
          "7504:     } else if (ranges.length > 1 && ranges[ourIndex].empty() && behavior.unit == \"char\" && !behavior.extend) {",
          "7505:       setSelection(doc, normalizeSelection(cm, ranges.slice(0, ourIndex).concat(ranges.slice(ourIndex + 1)), 0),",
          "7506:                    {scroll: false, origin: \"*mouse\"});",
          "7507:       startSel = doc.sel;",
          "7508:     } else {",
          "7509:       replaceOneSelection(doc, ourIndex, ourRange, sel_mouse);",
          "7510:     }",
          "7512:     var lastPos = start;",
          "7513:     function extendTo(pos) {",
          "7514:       if (cmp(lastPos, pos) == 0) { return }",
          "7515:       lastPos = pos;",
          "7517:       if (behavior.unit == \"rectangle\") {",
          "7518:         var ranges = [], tabSize = cm.options.tabSize;",
          "7519:         var startCol = countColumn(getLine(doc, start.line).text, start.ch, tabSize);",
          "7520:         var posCol = countColumn(getLine(doc, pos.line).text, pos.ch, tabSize);",
          "7521:         var left = Math.min(startCol, posCol), right = Math.max(startCol, posCol);",
          "7522:         for (var line = Math.min(start.line, pos.line), end = Math.min(cm.lastLine(), Math.max(start.line, pos.line));",
          "7523:              line <= end; line++) {",
          "7524:           var text = getLine(doc, line).text, leftPos = findColumn(text, left, tabSize);",
          "7525:           if (left == right)",
          "7526:             { ranges.push(new Range(Pos(line, leftPos), Pos(line, leftPos))); }",
          "7527:           else if (text.length > leftPos)",
          "7528:             { ranges.push(new Range(Pos(line, leftPos), Pos(line, findColumn(text, right, tabSize)))); }",
          "7529:         }",
          "7530:         if (!ranges.length) { ranges.push(new Range(start, start)); }",
          "7531:         setSelection(doc, normalizeSelection(cm, startSel.ranges.slice(0, ourIndex).concat(ranges), ourIndex),",
          "7532:                      {origin: \"*mouse\", scroll: false});",
          "7533:         cm.scrollIntoView(pos);",
          "7534:       } else {",
          "7535:         var oldRange = ourRange;",
          "7536:         var range = rangeForUnit(cm, pos, behavior.unit);",
          "7537:         var anchor = oldRange.anchor, head;",
          "7538:         if (cmp(range.anchor, anchor) > 0) {",
          "7539:           head = range.head;",
          "7540:           anchor = minPos(oldRange.from(), range.anchor);",
          "7541:         } else {",
          "7542:           head = range.anchor;",
          "7543:           anchor = maxPos(oldRange.to(), range.head);",
          "7544:         }",
          "7545:         var ranges$1 = startSel.ranges.slice(0);",
          "7546:         ranges$1[ourIndex] = bidiSimplify(cm, new Range(clipPos(doc, anchor), head));",
          "7547:         setSelection(doc, normalizeSelection(cm, ranges$1, ourIndex), sel_mouse);",
          "7548:       }",
          "7549:     }",
          "7551:     var editorSize = display.wrapper.getBoundingClientRect();",
          "7556:     var counter = 0;",
          "7558:     function extend(e) {",
          "7559:       var curCount = ++counter;",
          "7560:       var cur = posFromMouse(cm, e, true, behavior.unit == \"rectangle\");",
          "7561:       if (!cur) { return }",
          "7562:       if (cmp(cur, lastPos) != 0) {",
          "7563:         cm.curOp.focus = activeElt();",
          "7564:         extendTo(cur);",
          "7565:         var visible = visibleLines(display, doc);",
          "7566:         if (cur.line >= visible.to || cur.line < visible.from)",
          "7567:           { setTimeout(operation(cm, function () {if (counter == curCount) { extend(e); }}), 150); }",
          "7568:       } else {",
          "7569:         var outside = e.clientY < editorSize.top ? -20 : e.clientY > editorSize.bottom ? 20 : 0;",
          "7570:         if (outside) { setTimeout(operation(cm, function () {",
          "7571:           if (counter != curCount) { return }",
          "7572:           display.scroller.scrollTop += outside;",
          "7573:           extend(e);",
          "7574:         }), 50); }",
          "7575:       }",
          "7576:     }",
          "7578:     function done(e) {",
          "7579:       cm.state.selectingText = false;",
          "7580:       counter = Infinity;",
          "7584:       if (e) {",
          "7585:         e_preventDefault(e);",
          "7586:         display.input.focus();",
          "7587:       }",
          "7588:       off(display.wrapper.ownerDocument, \"mousemove\", move);",
          "7589:       off(display.wrapper.ownerDocument, \"mouseup\", up);",
          "7590:       doc.history.lastSelOrigin = null;",
          "7591:     }",
          "7593:     var move = operation(cm, function (e) {",
          "7594:       if (e.buttons === 0 || !e_button(e)) { done(e); }",
          "7595:       else { extend(e); }",
          "7596:     });",
          "7597:     var up = operation(cm, done);",
          "7598:     cm.state.selectingText = up;",
          "7599:     on(display.wrapper.ownerDocument, \"mousemove\", move);",
          "7600:     on(display.wrapper.ownerDocument, \"mouseup\", up);",
          "7601:   }",
          "7605:   function bidiSimplify(cm, range) {",
          "7606:     var anchor = range.anchor;",
          "7607:     var head = range.head;",
          "7608:     var anchorLine = getLine(cm.doc, anchor.line);",
          "7609:     if (cmp(anchor, head) == 0 && anchor.sticky == head.sticky) { return range }",
          "7610:     var order = getOrder(anchorLine);",
          "7611:     if (!order) { return range }",
          "7612:     var index = getBidiPartAt(order, anchor.ch, anchor.sticky), part = order[index];",
          "7613:     if (part.from != anchor.ch && part.to != anchor.ch) { return range }",
          "7614:     var boundary = index + ((part.from == anchor.ch) == (part.level != 1) ? 0 : 1);",
          "7615:     if (boundary == 0 || boundary == order.length) { return range }",
          "7619:     var leftSide;",
          "7620:     if (head.line != anchor.line) {",
          "7621:       leftSide = (head.line - anchor.line) * (cm.doc.direction == \"ltr\" ? 1 : -1) > 0;",
          "7622:     } else {",
          "7623:       var headIndex = getBidiPartAt(order, head.ch, head.sticky);",
          "7624:       var dir = headIndex - index || (head.ch - anchor.ch) * (part.level == 1 ? -1 : 1);",
          "7625:       if (headIndex == boundary - 1 || headIndex == boundary)",
          "7626:         { leftSide = dir < 0; }",
          "7627:       else",
          "7628:         { leftSide = dir > 0; }",
          "7629:     }",
          "7631:     var usePart = order[boundary + (leftSide ? -1 : 0)];",
          "7632:     var from = leftSide == (usePart.level == 1);",
          "7633:     var ch = from ? usePart.from : usePart.to, sticky = from ? \"after\" : \"before\";",
          "7634:     return anchor.ch == ch && anchor.sticky == sticky ? range : new Range(new Pos(anchor.line, ch, sticky), head)",
          "7635:   }",
          "7640:   function gutterEvent(cm, e, type, prevent) {",
          "7641:     var mX, mY;",
          "7642:     if (e.touches) {",
          "7643:       mX = e.touches[0].clientX;",
          "7644:       mY = e.touches[0].clientY;",
          "7645:     } else {",
          "7646:       try { mX = e.clientX; mY = e.clientY; }",
          "7647:       catch(e$1) { return false }",
          "7648:     }",
          "7649:     if (mX >= Math.floor(cm.display.gutters.getBoundingClientRect().right)) { return false }",
          "7650:     if (prevent) { e_preventDefault(e); }",
          "7652:     var display = cm.display;",
          "7653:     var lineBox = display.lineDiv.getBoundingClientRect();",
          "7655:     if (mY > lineBox.bottom || !hasHandler(cm, type)) { return e_defaultPrevented(e) }",
          "7656:     mY -= lineBox.top - display.viewOffset;",
          "7658:     for (var i = 0; i < cm.display.gutterSpecs.length; ++i) {",
          "7659:       var g = display.gutters.childNodes[i];",
          "7660:       if (g && g.getBoundingClientRect().right >= mX) {",
          "7661:         var line = lineAtHeight(cm.doc, mY);",
          "7662:         var gutter = cm.display.gutterSpecs[i];",
          "7663:         signal(cm, type, cm, line, gutter.className, e);",
          "7664:         return e_defaultPrevented(e)",
          "7665:       }",
          "7666:     }",
          "7667:   }",
          "7669:   function clickInGutter(cm, e) {",
          "7670:     return gutterEvent(cm, e, \"gutterClick\", true)",
          "7671:   }",
          "7678:   function onContextMenu(cm, e) {",
          "7679:     if (eventInWidget(cm.display, e) || contextMenuInGutter(cm, e)) { return }",
          "7680:     if (signalDOMEvent(cm, e, \"contextmenu\")) { return }",
          "7681:     if (!captureRightClick) { cm.display.input.onContextMenu(e); }",
          "7682:   }",
          "7684:   function contextMenuInGutter(cm, e) {",
          "7685:     if (!hasHandler(cm, \"gutterContextMenu\")) { return false }",
          "7686:     return gutterEvent(cm, e, \"gutterContextMenu\", false)",
          "7687:   }",
          "7689:   function themeChanged(cm) {",
          "7690:     cm.display.wrapper.className = cm.display.wrapper.className.replace(/\\s*cm-s-\\S+/g, \"\") +",
          "7691:       cm.options.theme.replace(/(^|\\s)\\s*/g, \" cm-s-\");",
          "7692:     clearCaches(cm);",
          "7693:   }",
          "7695:   var Init = {toString: function(){return \"CodeMirror.Init\"}};",
          "7697:   var defaults = {};",
          "7698:   var optionHandlers = {};",
          "7700:   function defineOptions(CodeMirror) {",
          "7701:     var optionHandlers = CodeMirror.optionHandlers;",
          "7703:     function option(name, deflt, handle, notOnInit) {",
          "7704:       CodeMirror.defaults[name] = deflt;",
          "7705:       if (handle) { optionHandlers[name] =",
          "7706:         notOnInit ? function (cm, val, old) {if (old != Init) { handle(cm, val, old); }} : handle; }",
          "7707:     }",
          "7709:     CodeMirror.defineOption = option;",
          "7712:     CodeMirror.Init = Init;",
          "7716:     option(\"value\", \"\", function (cm, val) { return cm.setValue(val); }, true);",
          "7717:     option(\"mode\", null, function (cm, val) {",
          "7718:       cm.doc.modeOption = val;",
          "7719:       loadMode(cm);",
          "7720:     }, true);",
          "7722:     option(\"indentUnit\", 2, loadMode, true);",
          "7723:     option(\"indentWithTabs\", false);",
          "7724:     option(\"smartIndent\", true);",
          "7725:     option(\"tabSize\", 4, function (cm) {",
          "7726:       resetModeState(cm);",
          "7727:       clearCaches(cm);",
          "7728:       regChange(cm);",
          "7729:     }, true);",
          "7731:     option(\"lineSeparator\", null, function (cm, val) {",
          "7732:       cm.doc.lineSep = val;",
          "7733:       if (!val) { return }",
          "7734:       var newBreaks = [], lineNo = cm.doc.first;",
          "7735:       cm.doc.iter(function (line) {",
          "7736:         for (var pos = 0;;) {",
          "7737:           var found = line.text.indexOf(val, pos);",
          "7738:           if (found == -1) { break }",
          "7739:           pos = found + val.length;",
          "7740:           newBreaks.push(Pos(lineNo, found));",
          "7741:         }",
          "7742:         lineNo++;",
          "7743:       });",
          "7744:       for (var i = newBreaks.length - 1; i >= 0; i--)",
          "7745:         { replaceRange(cm.doc, val, newBreaks[i], Pos(newBreaks[i].line, newBreaks[i].ch + val.length)); }",
          "7746:     });",
          "7747:     option(\"specialChars\", /[\\u0000-\\u001f\\u007f-\\u009f\\u00ad\\u061c\\u200b\\u200e\\u200f\\u2028\\u2029\\ufeff\\ufff9-\\ufffc]/g, function (cm, val, old) {",
          "7748:       cm.state.specialChars = new RegExp(val.source + (val.test(\"\\t\") ? \"\" : \"|\\t\"), \"g\");",
          "7749:       if (old != Init) { cm.refresh(); }",
          "7750:     });",
          "7751:     option(\"specialCharPlaceholder\", defaultSpecialCharPlaceholder, function (cm) { return cm.refresh(); }, true);",
          "7752:     option(\"electricChars\", true);",
          "7753:     option(\"inputStyle\", mobile ? \"contenteditable\" : \"textarea\", function () {",
          "7754:       throw new Error(\"inputStyle can not (yet) be changed in a running editor\") // FIXME",
          "7755:     }, true);",
          "7756:     option(\"spellcheck\", false, function (cm, val) { return cm.getInputField().spellcheck = val; }, true);",
          "7757:     option(\"autocorrect\", false, function (cm, val) { return cm.getInputField().autocorrect = val; }, true);",
          "7758:     option(\"autocapitalize\", false, function (cm, val) { return cm.getInputField().autocapitalize = val; }, true);",
          "7759:     option(\"rtlMoveVisually\", !windows);",
          "7760:     option(\"wholeLineUpdateBefore\", true);",
          "7762:     option(\"theme\", \"default\", function (cm) {",
          "7763:       themeChanged(cm);",
          "7764:       updateGutters(cm);",
          "7765:     }, true);",
          "7766:     option(\"keyMap\", \"default\", function (cm, val, old) {",
          "7767:       var next = getKeyMap(val);",
          "7768:       var prev = old != Init && getKeyMap(old);",
          "7769:       if (prev && prev.detach) { prev.detach(cm, next); }",
          "7770:       if (next.attach) { next.attach(cm, prev || null); }",
          "7771:     });",
          "7772:     option(\"extraKeys\", null);",
          "7773:     option(\"configureMouse\", null);",
          "7775:     option(\"lineWrapping\", false, wrappingChanged, true);",
          "7776:     option(\"gutters\", [], function (cm, val) {",
          "7777:       cm.display.gutterSpecs = getGutters(val, cm.options.lineNumbers);",
          "7778:       updateGutters(cm);",
          "7779:     }, true);",
          "7780:     option(\"fixedGutter\", true, function (cm, val) {",
          "7781:       cm.display.gutters.style.left = val ? compensateForHScroll(cm.display) + \"px\" : \"0\";",
          "7782:       cm.refresh();",
          "7783:     }, true);",
          "7784:     option(\"coverGutterNextToScrollbar\", false, function (cm) { return updateScrollbars(cm); }, true);",
          "7785:     option(\"scrollbarStyle\", \"native\", function (cm) {",
          "7786:       initScrollbars(cm);",
          "7787:       updateScrollbars(cm);",
          "7788:       cm.display.scrollbars.setScrollTop(cm.doc.scrollTop);",
          "7789:       cm.display.scrollbars.setScrollLeft(cm.doc.scrollLeft);",
          "7790:     }, true);",
          "7791:     option(\"lineNumbers\", false, function (cm, val) {",
          "7792:       cm.display.gutterSpecs = getGutters(cm.options.gutters, val);",
          "7793:       updateGutters(cm);",
          "7794:     }, true);",
          "7795:     option(\"firstLineNumber\", 1, updateGutters, true);",
          "7796:     option(\"lineNumberFormatter\", function (integer) { return integer; }, updateGutters, true);",
          "7797:     option(\"showCursorWhenSelecting\", false, updateSelection, true);",
          "7799:     option(\"resetSelectionOnContextMenu\", true);",
          "7800:     option(\"lineWiseCopyCut\", true);",
          "7801:     option(\"pasteLinesPerSelection\", true);",
          "7802:     option(\"selectionsMayTouch\", false);",
          "7804:     option(\"readOnly\", false, function (cm, val) {",
          "7805:       if (val == \"nocursor\") {",
          "7806:         onBlur(cm);",
          "7807:         cm.display.input.blur();",
          "7808:       }",
          "7809:       cm.display.input.readOnlyChanged(val);",
          "7810:     });",
          "7812:     option(\"screenReaderLabel\", null, function (cm, val) {",
          "7813:       val = (val === '') ? null : val;",
          "7814:       cm.display.input.screenReaderLabelChanged(val);",
          "7815:     });",
          "7817:     option(\"disableInput\", false, function (cm, val) {if (!val) { cm.display.input.reset(); }}, true);",
          "7818:     option(\"dragDrop\", true, dragDropChanged);",
          "7819:     option(\"allowDropFileTypes\", null);",
          "7821:     option(\"cursorBlinkRate\", 530);",
          "7822:     option(\"cursorScrollMargin\", 0);",
          "7823:     option(\"cursorHeight\", 1, updateSelection, true);",
          "7824:     option(\"singleCursorHeightPerLine\", true, updateSelection, true);",
          "7825:     option(\"workTime\", 100);",
          "7826:     option(\"workDelay\", 100);",
          "7827:     option(\"flattenSpans\", true, resetModeState, true);",
          "7828:     option(\"addModeClass\", false, resetModeState, true);",
          "7829:     option(\"pollInterval\", 100);",
          "7830:     option(\"undoDepth\", 200, function (cm, val) { return cm.doc.history.undoDepth = val; });",
          "7831:     option(\"historyEventDelay\", 1250);",
          "7832:     option(\"viewportMargin\", 10, function (cm) { return cm.refresh(); }, true);",
          "7833:     option(\"maxHighlightLength\", 10000, resetModeState, true);",
          "7834:     option(\"moveInputWithCursor\", true, function (cm, val) {",
          "7835:       if (!val) { cm.display.input.resetPosition(); }",
          "7836:     });",
          "7838:     option(\"tabindex\", null, function (cm, val) { return cm.display.input.getField().tabIndex = val || \"\"; });",
          "7839:     option(\"autofocus\", null);",
          "7840:     option(\"direction\", \"ltr\", function (cm, val) { return cm.doc.setDirection(val); }, true);",
          "7841:     option(\"phrases\", null);",
          "7842:   }",
          "7844:   function dragDropChanged(cm, value, old) {",
          "7845:     var wasOn = old && old != Init;",
          "7846:     if (!value != !wasOn) {",
          "7847:       var funcs = cm.display.dragFunctions;",
          "7848:       var toggle = value ? on : off;",
          "7849:       toggle(cm.display.scroller, \"dragstart\", funcs.start);",
          "7850:       toggle(cm.display.scroller, \"dragenter\", funcs.enter);",
          "7851:       toggle(cm.display.scroller, \"dragover\", funcs.over);",
          "7852:       toggle(cm.display.scroller, \"dragleave\", funcs.leave);",
          "7853:       toggle(cm.display.scroller, \"drop\", funcs.drop);",
          "7854:     }",
          "7855:   }",
          "7857:   function wrappingChanged(cm) {",
          "7858:     if (cm.options.lineWrapping) {",
          "7859:       addClass(cm.display.wrapper, \"CodeMirror-wrap\");",
          "7860:       cm.display.sizer.style.minWidth = \"\";",
          "7861:       cm.display.sizerWidth = null;",
          "7862:     } else {",
          "7863:       rmClass(cm.display.wrapper, \"CodeMirror-wrap\");",
          "7864:       findMaxLine(cm);",
          "7865:     }",
          "7866:     estimateLineHeights(cm);",
          "7867:     regChange(cm);",
          "7868:     clearCaches(cm);",
          "7869:     setTimeout(function () { return updateScrollbars(cm); }, 100);",
          "7870:   }",
          "7875:   function CodeMirror(place, options) {",
          "7876:     var this$1 = this;",
          "7878:     if (!(this instanceof CodeMirror)) { return new CodeMirror(place, options) }",
          "7880:     this.options = options = options ? copyObj(options) : {};",
          "7882:     copyObj(defaults, options, false);",
          "7884:     var doc = options.value;",
          "7885:     if (typeof doc == \"string\") { doc = new Doc(doc, options.mode, null, options.lineSeparator, options.direction); }",
          "7886:     else if (options.mode) { doc.modeOption = options.mode; }",
          "7887:     this.doc = doc;",
          "7889:     var input = new CodeMirror.inputStyles[options.inputStyle](this);",
          "7890:     var display = this.display = new Display(place, doc, input, options);",
          "7891:     display.wrapper.CodeMirror = this;",
          "7892:     themeChanged(this);",
          "7893:     if (options.lineWrapping)",
          "7894:       { this.display.wrapper.className += \" CodeMirror-wrap\"; }",
          "7895:     initScrollbars(this);",
          "7897:     this.state = {",
          "7898:       keyMaps: [],  // stores maps added by addKeyMap",
          "7899:       overlays: [], // highlighting overlays, as added by addOverlay",
          "7900:       modeGen: 0,   // bumped when mode/overlay changes, used to invalidate highlighting info",
          "7901:       overwrite: false,",
          "7902:       delayingBlurEvent: false,",
          "7903:       focused: false,",
          "7904:       suppressEdits: false, // used to disable editing during key handlers when in readOnly mode",
          "7905:       pasteIncoming: -1, cutIncoming: -1, // help recognize paste/cut edits in input.poll",
          "7906:       selectingText: false,",
          "7907:       draggingText: false,",
          "7908:       highlight: new Delayed(), // stores highlight worker timeout",
          "7909:       keySeq: null,  // Unfinished key sequence",
          "7910:       specialChars: null",
          "7911:     };",
          "7913:     if (options.autofocus && !mobile) { display.input.focus(); }",
          "7917:     if (ie && ie_version < 11) { setTimeout(function () { return this$1.display.input.reset(true); }, 20); }",
          "7919:     registerEventHandlers(this);",
          "7920:     ensureGlobalHandlers();",
          "7922:     startOperation(this);",
          "7923:     this.curOp.forceUpdate = true;",
          "7924:     attachDoc(this, doc);",
          "7926:     if ((options.autofocus && !mobile) || this.hasFocus())",
          "7927:       { setTimeout(function () {",
          "7928:         if (this$1.hasFocus() && !this$1.state.focused) { onFocus(this$1); }",
          "7929:       }, 20); }",
          "7930:     else",
          "7931:       { onBlur(this); }",
          "7933:     for (var opt in optionHandlers) { if (optionHandlers.hasOwnProperty(opt))",
          "7934:       { optionHandlers[opt](this, options[opt], Init); } }",
          "7935:     maybeUpdateLineNumberWidth(this);",
          "7936:     if (options.finishInit) { options.finishInit(this); }",
          "7937:     for (var i = 0; i < initHooks.length; ++i) { initHooks[i](this); }",
          "7938:     endOperation(this);",
          "7941:     if (webkit && options.lineWrapping &&",
          "7942:         getComputedStyle(display.lineDiv).textRendering == \"optimizelegibility\")",
          "7943:       { display.lineDiv.style.textRendering = \"auto\"; }",
          "7944:   }",
          "7947:   CodeMirror.defaults = defaults;",
          "7949:   CodeMirror.optionHandlers = optionHandlers;",
          "7952:   function registerEventHandlers(cm) {",
          "7953:     var d = cm.display;",
          "7954:     on(d.scroller, \"mousedown\", operation(cm, onMouseDown));",
          "7956:     if (ie && ie_version < 11)",
          "7957:       { on(d.scroller, \"dblclick\", operation(cm, function (e) {",
          "7958:         if (signalDOMEvent(cm, e)) { return }",
          "7959:         var pos = posFromMouse(cm, e);",
          "7960:         if (!pos || clickInGutter(cm, e) || eventInWidget(cm.display, e)) { return }",
          "7961:         e_preventDefault(e);",
          "7962:         var word = cm.findWordAt(pos);",
          "7963:         extendSelection(cm.doc, word.anchor, word.head);",
          "7964:       })); }",
          "7965:     else",
          "7966:       { on(d.scroller, \"dblclick\", function (e) { return signalDOMEvent(cm, e) || e_preventDefault(e); }); }",
          "7970:     on(d.scroller, \"contextmenu\", function (e) { return onContextMenu(cm, e); });",
          "7971:     on(d.input.getField(), \"contextmenu\", function (e) {",
          "7972:       if (!d.scroller.contains(e.target)) { onContextMenu(cm, e); }",
          "7973:     });",
          "7976:     var touchFinished, prevTouch = {end: 0};",
          "7977:     function finishTouch() {",
          "7978:       if (d.activeTouch) {",
          "7979:         touchFinished = setTimeout(function () { return d.activeTouch = null; }, 1000);",
          "7980:         prevTouch = d.activeTouch;",
          "7981:         prevTouch.end = +new Date;",
          "7982:       }",
          "7983:     }",
          "7984:     function isMouseLikeTouchEvent(e) {",
          "7985:       if (e.touches.length != 1) { return false }",
          "7986:       var touch = e.touches[0];",
          "7987:       return touch.radiusX <= 1 && touch.radiusY <= 1",
          "7988:     }",
          "7989:     function farAway(touch, other) {",
          "7990:       if (other.left == null) { return true }",
          "7991:       var dx = other.left - touch.left, dy = other.top - touch.top;",
          "7992:       return dx * dx + dy * dy > 20 * 20",
          "7993:     }",
          "7994:     on(d.scroller, \"touchstart\", function (e) {",
          "7995:       if (!signalDOMEvent(cm, e) && !isMouseLikeTouchEvent(e) && !clickInGutter(cm, e)) {",
          "7996:         d.input.ensurePolled();",
          "7997:         clearTimeout(touchFinished);",
          "7998:         var now = +new Date;",
          "7999:         d.activeTouch = {start: now, moved: false,",
          "8000:                          prev: now - prevTouch.end <= 300 ? prevTouch : null};",
          "8001:         if (e.touches.length == 1) {",
          "8002:           d.activeTouch.left = e.touches[0].pageX;",
          "8003:           d.activeTouch.top = e.touches[0].pageY;",
          "8004:         }",
          "8005:       }",
          "8006:     });",
          "8007:     on(d.scroller, \"touchmove\", function () {",
          "8008:       if (d.activeTouch) { d.activeTouch.moved = true; }",
          "8009:     });",
          "8010:     on(d.scroller, \"touchend\", function (e) {",
          "8011:       var touch = d.activeTouch;",
          "8012:       if (touch && !eventInWidget(d, e) && touch.left != null &&",
          "8013:           !touch.moved && new Date - touch.start < 300) {",
          "8014:         var pos = cm.coordsChar(d.activeTouch, \"page\"), range;",
          "8015:         if (!touch.prev || farAway(touch, touch.prev)) // Single tap",
          "8016:           { range = new Range(pos, pos); }",
          "8017:         else if (!touch.prev.prev || farAway(touch, touch.prev.prev)) // Double tap",
          "8018:           { range = cm.findWordAt(pos); }",
          "8019:         else // Triple tap",
          "8020:           { range = new Range(Pos(pos.line, 0), clipPos(cm.doc, Pos(pos.line + 1, 0))); }",
          "8021:         cm.setSelection(range.anchor, range.head);",
          "8022:         cm.focus();",
          "8023:         e_preventDefault(e);",
          "8024:       }",
          "8025:       finishTouch();",
          "8026:     });",
          "8027:     on(d.scroller, \"touchcancel\", finishTouch);",
          "8031:     on(d.scroller, \"scroll\", function () {",
          "8032:       if (d.scroller.clientHeight) {",
          "8033:         updateScrollTop(cm, d.scroller.scrollTop);",
          "8034:         setScrollLeft(cm, d.scroller.scrollLeft, true);",
          "8035:         signal(cm, \"scroll\", cm);",
          "8036:       }",
          "8037:     });",
          "8040:     on(d.scroller, \"mousewheel\", function (e) { return onScrollWheel(cm, e); });",
          "8041:     on(d.scroller, \"DOMMouseScroll\", function (e) { return onScrollWheel(cm, e); });",
          "8044:     on(d.wrapper, \"scroll\", function () { return d.wrapper.scrollTop = d.wrapper.scrollLeft = 0; });",
          "8046:     d.dragFunctions = {",
          "8047:       enter: function (e) {if (!signalDOMEvent(cm, e)) { e_stop(e); }},",
          "8048:       over: function (e) {if (!signalDOMEvent(cm, e)) { onDragOver(cm, e); e_stop(e); }},",
          "8049:       start: function (e) { return onDragStart(cm, e); },",
          "8050:       drop: operation(cm, onDrop),",
          "8051:       leave: function (e) {if (!signalDOMEvent(cm, e)) { clearDragCursor(cm); }}",
          "8052:     };",
          "8054:     var inp = d.input.getField();",
          "8055:     on(inp, \"keyup\", function (e) { return onKeyUp.call(cm, e); });",
          "8056:     on(inp, \"keydown\", operation(cm, onKeyDown));",
          "8057:     on(inp, \"keypress\", operation(cm, onKeyPress));",
          "8058:     on(inp, \"focus\", function (e) { return onFocus(cm, e); });",
          "8059:     on(inp, \"blur\", function (e) { return onBlur(cm, e); });",
          "8060:   }",
          "8062:   var initHooks = [];",
          "8063:   CodeMirror.defineInitHook = function (f) { return initHooks.push(f); };",
          "8070:   function indentLine(cm, n, how, aggressive) {",
          "8071:     var doc = cm.doc, state;",
          "8072:     if (how == null) { how = \"add\"; }",
          "8073:     if (how == \"smart\") {",
          "8076:       if (!doc.mode.indent) { how = \"prev\"; }",
          "8077:       else { state = getContextBefore(cm, n).state; }",
          "8078:     }",
          "8080:     var tabSize = cm.options.tabSize;",
          "8081:     var line = getLine(doc, n), curSpace = countColumn(line.text, null, tabSize);",
          "8082:     if (line.stateAfter) { line.stateAfter = null; }",
          "8083:     var curSpaceString = line.text.match(/^\\s*/)[0], indentation;",
          "8084:     if (!aggressive && !/\\S/.test(line.text)) {",
          "8085:       indentation = 0;",
          "8086:       how = \"not\";",
          "8087:     } else if (how == \"smart\") {",
          "8088:       indentation = doc.mode.indent(state, line.text.slice(curSpaceString.length), line.text);",
          "8089:       if (indentation == Pass || indentation > 150) {",
          "8090:         if (!aggressive) { return }",
          "8091:         how = \"prev\";",
          "8092:       }",
          "8093:     }",
          "8094:     if (how == \"prev\") {",
          "8095:       if (n > doc.first) { indentation = countColumn(getLine(doc, n-1).text, null, tabSize); }",
          "8096:       else { indentation = 0; }",
          "8097:     } else if (how == \"add\") {",
          "8098:       indentation = curSpace + cm.options.indentUnit;",
          "8099:     } else if (how == \"subtract\") {",
          "8100:       indentation = curSpace - cm.options.indentUnit;",
          "8101:     } else if (typeof how == \"number\") {",
          "8102:       indentation = curSpace + how;",
          "8103:     }",
          "8104:     indentation = Math.max(0, indentation);",
          "8106:     var indentString = \"\", pos = 0;",
          "8107:     if (cm.options.indentWithTabs)",
          "8108:       { for (var i = Math.floor(indentation / tabSize); i; --i) {pos += tabSize; indentString += \"\\t\";} }",
          "8109:     if (pos < indentation) { indentString += spaceStr(indentation - pos); }",
          "8111:     if (indentString != curSpaceString) {",
          "8112:       replaceRange(doc, indentString, Pos(n, 0), Pos(n, curSpaceString.length), \"+input\");",
          "8113:       line.stateAfter = null;",
          "8114:       return true",
          "8115:     } else {",
          "8118:       for (var i$1 = 0; i$1 < doc.sel.ranges.length; i$1++) {",
          "8119:         var range = doc.sel.ranges[i$1];",
          "8120:         if (range.head.line == n && range.head.ch < curSpaceString.length) {",
          "8121:           var pos$1 = Pos(n, curSpaceString.length);",
          "8122:           replaceOneSelection(doc, i$1, new Range(pos$1, pos$1));",
          "8123:           break",
          "8124:         }",
          "8125:       }",
          "8126:     }",
          "8127:   }",
          "8132:   var lastCopied = null;",
          "8134:   function setLastCopied(newLastCopied) {",
          "8135:     lastCopied = newLastCopied;",
          "8136:   }",
          "8138:   function applyTextInput(cm, inserted, deleted, sel, origin) {",
          "8139:     var doc = cm.doc;",
          "8140:     cm.display.shift = false;",
          "8141:     if (!sel) { sel = doc.sel; }",
          "8143:     var recent = +new Date - 200;",
          "8144:     var paste = origin == \"paste\" || cm.state.pasteIncoming > recent;",
          "8145:     var textLines = splitLinesAuto(inserted), multiPaste = null;",
          "8147:     if (paste && sel.ranges.length > 1) {",
          "8148:       if (lastCopied && lastCopied.text.join(\"\\n\") == inserted) {",
          "8149:         if (sel.ranges.length % lastCopied.text.length == 0) {",
          "8150:           multiPaste = [];",
          "8151:           for (var i = 0; i < lastCopied.text.length; i++)",
          "8152:             { multiPaste.push(doc.splitLines(lastCopied.text[i])); }",
          "8153:         }",
          "8154:       } else if (textLines.length == sel.ranges.length && cm.options.pasteLinesPerSelection) {",
          "8155:         multiPaste = map(textLines, function (l) { return [l]; });",
          "8156:       }",
          "8157:     }",
          "8159:     var updateInput = cm.curOp.updateInput;",
          "8161:     for (var i$1 = sel.ranges.length - 1; i$1 >= 0; i$1--) {",
          "8162:       var range = sel.ranges[i$1];",
          "8163:       var from = range.from(), to = range.to();",
          "8164:       if (range.empty()) {",
          "8165:         if (deleted && deleted > 0) // Handle deletion",
          "8166:           { from = Pos(from.line, from.ch - deleted); }",
          "8167:         else if (cm.state.overwrite && !paste) // Handle overwrite",
          "8168:           { to = Pos(to.line, Math.min(getLine(doc, to.line).text.length, to.ch + lst(textLines).length)); }",
          "8169:         else if (paste && lastCopied && lastCopied.lineWise && lastCopied.text.join(\"\\n\") == textLines.join(\"\\n\"))",
          "8170:           { from = to = Pos(from.line, 0); }",
          "8171:       }",
          "8172:       var changeEvent = {from: from, to: to, text: multiPaste ? multiPaste[i$1 % multiPaste.length] : textLines,",
          "8173:                          origin: origin || (paste ? \"paste\" : cm.state.cutIncoming > recent ? \"cut\" : \"+input\")};",
          "8174:       makeChange(cm.doc, changeEvent);",
          "8175:       signalLater(cm, \"inputRead\", cm, changeEvent);",
          "8176:     }",
          "8177:     if (inserted && !paste)",
          "8178:       { triggerElectric(cm, inserted); }",
          "8180:     ensureCursorVisible(cm);",
          "8181:     if (cm.curOp.updateInput < 2) { cm.curOp.updateInput = updateInput; }",
          "8182:     cm.curOp.typing = true;",
          "8183:     cm.state.pasteIncoming = cm.state.cutIncoming = -1;",
          "8184:   }",
          "8186:   function handlePaste(e, cm) {",
          "8187:     var pasted = e.clipboardData && e.clipboardData.getData(\"Text\");",
          "8188:     if (pasted) {",
          "8189:       e.preventDefault();",
          "8190:       if (!cm.isReadOnly() && !cm.options.disableInput)",
          "8191:         { runInOp(cm, function () { return applyTextInput(cm, pasted, 0, null, \"paste\"); }); }",
          "8192:       return true",
          "8193:     }",
          "8194:   }",
          "8196:   function triggerElectric(cm, inserted) {",
          "8198:     if (!cm.options.electricChars || !cm.options.smartIndent) { return }",
          "8199:     var sel = cm.doc.sel;",
          "8201:     for (var i = sel.ranges.length - 1; i >= 0; i--) {",
          "8202:       var range = sel.ranges[i];",
          "8203:       if (range.head.ch > 100 || (i && sel.ranges[i - 1].head.line == range.head.line)) { continue }",
          "8204:       var mode = cm.getModeAt(range.head);",
          "8205:       var indented = false;",
          "8206:       if (mode.electricChars) {",
          "8207:         for (var j = 0; j < mode.electricChars.length; j++)",
          "8208:           { if (inserted.indexOf(mode.electricChars.charAt(j)) > -1) {",
          "8209:             indented = indentLine(cm, range.head.line, \"smart\");",
          "8210:             break",
          "8211:           } }",
          "8212:       } else if (mode.electricInput) {",
          "8213:         if (mode.electricInput.test(getLine(cm.doc, range.head.line).text.slice(0, range.head.ch)))",
          "8214:           { indented = indentLine(cm, range.head.line, \"smart\"); }",
          "8215:       }",
          "8216:       if (indented) { signalLater(cm, \"electricInput\", cm, range.head.line); }",
          "8217:     }",
          "8218:   }",
          "8220:   function copyableRanges(cm) {",
          "8221:     var text = [], ranges = [];",
          "8222:     for (var i = 0; i < cm.doc.sel.ranges.length; i++) {",
          "8223:       var line = cm.doc.sel.ranges[i].head.line;",
          "8224:       var lineRange = {anchor: Pos(line, 0), head: Pos(line + 1, 0)};",
          "8225:       ranges.push(lineRange);",
          "8226:       text.push(cm.getRange(lineRange.anchor, lineRange.head));",
          "8227:     }",
          "8228:     return {text: text, ranges: ranges}",
          "8229:   }",
          "8231:   function disableBrowserMagic(field, spellcheck, autocorrect, autocapitalize) {",
          "8232:     field.setAttribute(\"autocorrect\", autocorrect ? \"\" : \"off\");",
          "8233:     field.setAttribute(\"autocapitalize\", autocapitalize ? \"\" : \"off\");",
          "8234:     field.setAttribute(\"spellcheck\", !!spellcheck);",
          "8235:   }",
          "8237:   function hiddenTextarea() {",
          "8238:     var te = elt(\"textarea\", null, null, \"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; outline: none\");",
          "8239:     var div = elt(\"div\", [te], null, \"overflow: hidden; position: relative; width: 3px; height: 0px;\");",
          "8244:     if (webkit) { te.style.width = \"1000px\"; }",
          "8245:     else { te.setAttribute(\"wrap\", \"off\"); }",
          "8247:     if (ios) { te.style.border = \"1px solid black\"; }",
          "8248:     disableBrowserMagic(te);",
          "8249:     return div",
          "8250:   }",
          "8260:   function addEditorMethods(CodeMirror) {",
          "8261:     var optionHandlers = CodeMirror.optionHandlers;",
          "8263:     var helpers = CodeMirror.helpers = {};",
          "8265:     CodeMirror.prototype = {",
          "8266:       constructor: CodeMirror,",
          "8267:       focus: function(){window.focus(); this.display.input.focus();},",
          "8269:       setOption: function(option, value) {",
          "8270:         var options = this.options, old = options[option];",
          "8271:         if (options[option] == value && option != \"mode\") { return }",
          "8272:         options[option] = value;",
          "8273:         if (optionHandlers.hasOwnProperty(option))",
          "8274:           { operation(this, optionHandlers[option])(this, value, old); }",
          "8275:         signal(this, \"optionChange\", this, option);",
          "8276:       },",
          "8278:       getOption: function(option) {return this.options[option]},",
          "8279:       getDoc: function() {return this.doc},",
          "8281:       addKeyMap: function(map, bottom) {",
          "8282:         this.state.keyMaps[bottom ? \"push\" : \"unshift\"](getKeyMap(map));",
          "8283:       },",
          "8284:       removeKeyMap: function(map) {",
          "8285:         var maps = this.state.keyMaps;",
          "8286:         for (var i = 0; i < maps.length; ++i)",
          "8287:           { if (maps[i] == map || maps[i].name == map) {",
          "8288:             maps.splice(i, 1);",
          "8289:             return true",
          "8290:           } }",
          "8291:       },",
          "8293:       addOverlay: methodOp(function(spec, options) {",
          "8294:         var mode = spec.token ? spec : CodeMirror.getMode(this.options, spec);",
          "8295:         if (mode.startState) { throw new Error(\"Overlays may not be stateful.\") }",
          "8296:         insertSorted(this.state.overlays,",
          "8297:                      {mode: mode, modeSpec: spec, opaque: options && options.opaque,",
          "8298:                       priority: (options && options.priority) || 0},",
          "8299:                      function (overlay) { return overlay.priority; });",
          "8300:         this.state.modeGen++;",
          "8301:         regChange(this);",
          "8302:       }),",
          "8303:       removeOverlay: methodOp(function(spec) {",
          "8304:         var overlays = this.state.overlays;",
          "8305:         for (var i = 0; i < overlays.length; ++i) {",
          "8306:           var cur = overlays[i].modeSpec;",
          "8307:           if (cur == spec || typeof spec == \"string\" && cur.name == spec) {",
          "8308:             overlays.splice(i, 1);",
          "8309:             this.state.modeGen++;",
          "8310:             regChange(this);",
          "8311:             return",
          "8312:           }",
          "8313:         }",
          "8314:       }),",
          "8316:       indentLine: methodOp(function(n, dir, aggressive) {",
          "8317:         if (typeof dir != \"string\" && typeof dir != \"number\") {",
          "8318:           if (dir == null) { dir = this.options.smartIndent ? \"smart\" : \"prev\"; }",
          "8319:           else { dir = dir ? \"add\" : \"subtract\"; }",
          "8320:         }",
          "8321:         if (isLine(this.doc, n)) { indentLine(this, n, dir, aggressive); }",
          "8322:       }),",
          "8323:       indentSelection: methodOp(function(how) {",
          "8324:         var ranges = this.doc.sel.ranges, end = -1;",
          "8325:         for (var i = 0; i < ranges.length; i++) {",
          "8326:           var range = ranges[i];",
          "8327:           if (!range.empty()) {",
          "8328:             var from = range.from(), to = range.to();",
          "8329:             var start = Math.max(end, from.line);",
          "8330:             end = Math.min(this.lastLine(), to.line - (to.ch ? 0 : 1)) + 1;",
          "8331:             for (var j = start; j < end; ++j)",
          "8332:               { indentLine(this, j, how); }",
          "8333:             var newRanges = this.doc.sel.ranges;",
          "8334:             if (from.ch == 0 && ranges.length == newRanges.length && newRanges[i].from().ch > 0)",
          "8335:               { replaceOneSelection(this.doc, i, new Range(from, newRanges[i].to()), sel_dontScroll); }",
          "8336:           } else if (range.head.line > end) {",
          "8337:             indentLine(this, range.head.line, how, true);",
          "8338:             end = range.head.line;",
          "8339:             if (i == this.doc.sel.primIndex) { ensureCursorVisible(this); }",
          "8340:           }",
          "8341:         }",
          "8342:       }),",
          "8346:       getTokenAt: function(pos, precise) {",
          "8347:         return takeToken(this, pos, precise)",
          "8348:       },",
          "8350:       getLineTokens: function(line, precise) {",
          "8351:         return takeToken(this, Pos(line), precise, true)",
          "8352:       },",
          "8354:       getTokenTypeAt: function(pos) {",
          "8355:         pos = clipPos(this.doc, pos);",
          "8356:         var styles = getLineStyles(this, getLine(this.doc, pos.line));",
          "8357:         var before = 0, after = (styles.length - 1) / 2, ch = pos.ch;",
          "8358:         var type;",
          "8359:         if (ch == 0) { type = styles[2]; }",
          "8360:         else { for (;;) {",
          "8361:           var mid = (before + after) >> 1;",
          "8362:           if ((mid ? styles[mid * 2 - 1] : 0) >= ch) { after = mid; }",
          "8363:           else if (styles[mid * 2 + 1] < ch) { before = mid + 1; }",
          "8364:           else { type = styles[mid * 2 + 2]; break }",
          "8365:         } }",
          "8366:         var cut = type ? type.indexOf(\"overlay \") : -1;",
          "8367:         return cut < 0 ? type : cut == 0 ? null : type.slice(0, cut - 1)",
          "8368:       },",
          "8370:       getModeAt: function(pos) {",
          "8371:         var mode = this.doc.mode;",
          "8372:         if (!mode.innerMode) { return mode }",
          "8373:         return CodeMirror.innerMode(mode, this.getTokenAt(pos).state).mode",
          "8374:       },",
          "8376:       getHelper: function(pos, type) {",
          "8377:         return this.getHelpers(pos, type)[0]",
          "8378:       },",
          "8380:       getHelpers: function(pos, type) {",
          "8381:         var found = [];",
          "8382:         if (!helpers.hasOwnProperty(type)) { return found }",
          "8383:         var help = helpers[type], mode = this.getModeAt(pos);",
          "8384:         if (typeof mode[type] == \"string\") {",
          "8385:           if (help[mode[type]]) { found.push(help[mode[type]]); }",
          "8386:         } else if (mode[type]) {",
          "8387:           for (var i = 0; i < mode[type].length; i++) {",
          "8388:             var val = help[mode[type][i]];",
          "8389:             if (val) { found.push(val); }",
          "8390:           }",
          "8391:         } else if (mode.helperType && help[mode.helperType]) {",
          "8392:           found.push(help[mode.helperType]);",
          "8393:         } else if (help[mode.name]) {",
          "8394:           found.push(help[mode.name]);",
          "8395:         }",
          "8396:         for (var i$1 = 0; i$1 < help._global.length; i$1++) {",
          "8397:           var cur = help._global[i$1];",
          "8398:           if (cur.pred(mode, this) && indexOf(found, cur.val) == -1)",
          "8399:             { found.push(cur.val); }",
          "8400:         }",
          "8401:         return found",
          "8402:       },",
          "8404:       getStateAfter: function(line, precise) {",
          "8405:         var doc = this.doc;",
          "8406:         line = clipLine(doc, line == null ? doc.first + doc.size - 1: line);",
          "8407:         return getContextBefore(this, line + 1, precise).state",
          "8408:       },",
          "8410:       cursorCoords: function(start, mode) {",
          "8411:         var pos, range = this.doc.sel.primary();",
          "8412:         if (start == null) { pos = range.head; }",
          "8413:         else if (typeof start == \"object\") { pos = clipPos(this.doc, start); }",
          "8414:         else { pos = start ? range.from() : range.to(); }",
          "8415:         return cursorCoords(this, pos, mode || \"page\")",
          "8416:       },",
          "8418:       charCoords: function(pos, mode) {",
          "8419:         return charCoords(this, clipPos(this.doc, pos), mode || \"page\")",
          "8420:       },",
          "8422:       coordsChar: function(coords, mode) {",
          "8423:         coords = fromCoordSystem(this, coords, mode || \"page\");",
          "8424:         return coordsChar(this, coords.left, coords.top)",
          "8425:       },",
          "8427:       lineAtHeight: function(height, mode) {",
          "8428:         height = fromCoordSystem(this, {top: height, left: 0}, mode || \"page\").top;",
          "8429:         return lineAtHeight(this.doc, height + this.display.viewOffset)",
          "8430:       },",
          "8431:       heightAtLine: function(line, mode, includeWidgets) {",
          "8432:         var end = false, lineObj;",
          "8433:         if (typeof line == \"number\") {",
          "8434:           var last = this.doc.first + this.doc.size - 1;",
          "8435:           if (line < this.doc.first) { line = this.doc.first; }",
          "8436:           else if (line > last) { line = last; end = true; }",
          "8437:           lineObj = getLine(this.doc, line);",
          "8438:         } else {",
          "8439:           lineObj = line;",
          "8440:         }",
          "8441:         return intoCoordSystem(this, lineObj, {top: 0, left: 0}, mode || \"page\", includeWidgets || end).top +",
          "8442:           (end ? this.doc.height - heightAtLine(lineObj) : 0)",
          "8443:       },",
          "8445:       defaultTextHeight: function() { return textHeight(this.display) },",
          "8446:       defaultCharWidth: function() { return charWidth(this.display) },",
          "8448:       getViewport: function() { return {from: this.display.viewFrom, to: this.display.viewTo}},",
          "8450:       addWidget: function(pos, node, scroll, vert, horiz) {",
          "8451:         var display = this.display;",
          "8452:         pos = cursorCoords(this, clipPos(this.doc, pos));",
          "8453:         var top = pos.bottom, left = pos.left;",
          "8454:         node.style.position = \"absolute\";",
          "8455:         node.setAttribute(\"cm-ignore-events\", \"true\");",
          "8456:         this.display.input.setUneditable(node);",
          "8457:         display.sizer.appendChild(node);",
          "8458:         if (vert == \"over\") {",
          "8459:           top = pos.top;",
          "8460:         } else if (vert == \"above\" || vert == \"near\") {",
          "8461:           var vspace = Math.max(display.wrapper.clientHeight, this.doc.height),",
          "8462:           hspace = Math.max(display.sizer.clientWidth, display.lineSpace.clientWidth);",
          "8464:           if ((vert == 'above' || pos.bottom + node.offsetHeight > vspace) && pos.top > node.offsetHeight)",
          "8465:             { top = pos.top - node.offsetHeight; }",
          "8466:           else if (pos.bottom + node.offsetHeight <= vspace)",
          "8467:             { top = pos.bottom; }",
          "8468:           if (left + node.offsetWidth > hspace)",
          "8469:             { left = hspace - node.offsetWidth; }",
          "8470:         }",
          "8471:         node.style.top = top + \"px\";",
          "8472:         node.style.left = node.style.right = \"\";",
          "8473:         if (horiz == \"right\") {",
          "8474:           left = display.sizer.clientWidth - node.offsetWidth;",
          "8475:           node.style.right = \"0px\";",
          "8476:         } else {",
          "8477:           if (horiz == \"left\") { left = 0; }",
          "8478:           else if (horiz == \"middle\") { left = (display.sizer.clientWidth - node.offsetWidth) / 2; }",
          "8479:           node.style.left = left + \"px\";",
          "8480:         }",
          "8481:         if (scroll)",
          "8482:           { scrollIntoView(this, {left: left, top: top, right: left + node.offsetWidth, bottom: top + node.offsetHeight}); }",
          "8483:       },",
          "8485:       triggerOnKeyDown: methodOp(onKeyDown),",
          "8486:       triggerOnKeyPress: methodOp(onKeyPress),",
          "8487:       triggerOnKeyUp: onKeyUp,",
          "8488:       triggerOnMouseDown: methodOp(onMouseDown),",
          "8490:       execCommand: function(cmd) {",
          "8491:         if (commands.hasOwnProperty(cmd))",
          "8492:           { return commands[cmd].call(null, this) }",
          "8493:       },",
          "8495:       triggerElectric: methodOp(function(text) { triggerElectric(this, text); }),",
          "8497:       findPosH: function(from, amount, unit, visually) {",
          "8498:         var dir = 1;",
          "8499:         if (amount < 0) { dir = -1; amount = -amount; }",
          "8500:         var cur = clipPos(this.doc, from);",
          "8501:         for (var i = 0; i < amount; ++i) {",
          "8502:           cur = findPosH(this.doc, cur, dir, unit, visually);",
          "8503:           if (cur.hitSide) { break }",
          "8504:         }",
          "8505:         return cur",
          "8506:       },",
          "8508:       moveH: methodOp(function(dir, unit) {",
          "8509:         var this$1 = this;",
          "8511:         this.extendSelectionsBy(function (range) {",
          "8512:           if (this$1.display.shift || this$1.doc.extend || range.empty())",
          "8513:             { return findPosH(this$1.doc, range.head, dir, unit, this$1.options.rtlMoveVisually) }",
          "8514:           else",
          "8515:             { return dir < 0 ? range.from() : range.to() }",
          "8516:         }, sel_move);",
          "8517:       }),",
          "8519:       deleteH: methodOp(function(dir, unit) {",
          "8520:         var sel = this.doc.sel, doc = this.doc;",
          "8521:         if (sel.somethingSelected())",
          "8522:           { doc.replaceSelection(\"\", null, \"+delete\"); }",
          "8523:         else",
          "8524:           { deleteNearSelection(this, function (range) {",
          "8525:             var other = findPosH(doc, range.head, dir, unit, false);",
          "8526:             return dir < 0 ? {from: other, to: range.head} : {from: range.head, to: other}",
          "8527:           }); }",
          "8528:       }),",
          "8530:       findPosV: function(from, amount, unit, goalColumn) {",
          "8531:         var dir = 1, x = goalColumn;",
          "8532:         if (amount < 0) { dir = -1; amount = -amount; }",
          "8533:         var cur = clipPos(this.doc, from);",
          "8534:         for (var i = 0; i < amount; ++i) {",
          "8535:           var coords = cursorCoords(this, cur, \"div\");",
          "8536:           if (x == null) { x = coords.left; }",
          "8537:           else { coords.left = x; }",
          "8538:           cur = findPosV(this, coords, dir, unit);",
          "8539:           if (cur.hitSide) { break }",
          "8540:         }",
          "8541:         return cur",
          "8542:       },",
          "8544:       moveV: methodOp(function(dir, unit) {",
          "8545:         var this$1 = this;",
          "8547:         var doc = this.doc, goals = [];",
          "8548:         var collapse = !this.display.shift && !doc.extend && doc.sel.somethingSelected();",
          "8549:         doc.extendSelectionsBy(function (range) {",
          "8550:           if (collapse)",
          "8551:             { return dir < 0 ? range.from() : range.to() }",
          "8552:           var headPos = cursorCoords(this$1, range.head, \"div\");",
          "8553:           if (range.goalColumn != null) { headPos.left = range.goalColumn; }",
          "8554:           goals.push(headPos.left);",
          "8555:           var pos = findPosV(this$1, headPos, dir, unit);",
          "8556:           if (unit == \"page\" && range == doc.sel.primary())",
          "8557:             { addToScrollTop(this$1, charCoords(this$1, pos, \"div\").top - headPos.top); }",
          "8558:           return pos",
          "8559:         }, sel_move);",
          "8560:         if (goals.length) { for (var i = 0; i < doc.sel.ranges.length; i++)",
          "8561:           { doc.sel.ranges[i].goalColumn = goals[i]; } }",
          "8562:       }),",
          "8565:       findWordAt: function(pos) {",
          "8566:         var doc = this.doc, line = getLine(doc, pos.line).text;",
          "8567:         var start = pos.ch, end = pos.ch;",
          "8568:         if (line) {",
          "8569:           var helper = this.getHelper(pos, \"wordChars\");",
          "8570:           if ((pos.sticky == \"before\" || end == line.length) && start) { --start; } else { ++end; }",
          "8571:           var startChar = line.charAt(start);",
          "8572:           var check = isWordChar(startChar, helper)",
          "8573:             ? function (ch) { return isWordChar(ch, helper); }",
          "8574:             : /\\s/.test(startChar) ? function (ch) { return /\\s/.test(ch); }",
          "8575:             : function (ch) { return (!/\\s/.test(ch) && !isWordChar(ch)); };",
          "8576:           while (start > 0 && check(line.charAt(start - 1))) { --start; }",
          "8577:           while (end < line.length && check(line.charAt(end))) { ++end; }",
          "8578:         }",
          "8579:         return new Range(Pos(pos.line, start), Pos(pos.line, end))",
          "8580:       },",
          "8582:       toggleOverwrite: function(value) {",
          "8583:         if (value != null && value == this.state.overwrite) { return }",
          "8584:         if (this.state.overwrite = !this.state.overwrite)",
          "8585:           { addClass(this.display.cursorDiv, \"CodeMirror-overwrite\"); }",
          "8586:         else",
          "8587:           { rmClass(this.display.cursorDiv, \"CodeMirror-overwrite\"); }",
          "8589:         signal(this, \"overwriteToggle\", this, this.state.overwrite);",
          "8590:       },",
          "8591:       hasFocus: function() { return this.display.input.getField() == activeElt() },",
          "8592:       isReadOnly: function() { return !!(this.options.readOnly || this.doc.cantEdit) },",
          "8594:       scrollTo: methodOp(function (x, y) { scrollToCoords(this, x, y); }),",
          "8595:       getScrollInfo: function() {",
          "8596:         var scroller = this.display.scroller;",
          "8597:         return {left: scroller.scrollLeft, top: scroller.scrollTop,",
          "8598:                 height: scroller.scrollHeight - scrollGap(this) - this.display.barHeight,",
          "8599:                 width: scroller.scrollWidth - scrollGap(this) - this.display.barWidth,",
          "8600:                 clientHeight: displayHeight(this), clientWidth: displayWidth(this)}",
          "8601:       },",
          "8603:       scrollIntoView: methodOp(function(range, margin) {",
          "8604:         if (range == null) {",
          "8605:           range = {from: this.doc.sel.primary().head, to: null};",
          "8606:           if (margin == null) { margin = this.options.cursorScrollMargin; }",
          "8607:         } else if (typeof range == \"number\") {",
          "8608:           range = {from: Pos(range, 0), to: null};",
          "8609:         } else if (range.from == null) {",
          "8610:           range = {from: range, to: null};",
          "8611:         }",
          "8612:         if (!range.to) { range.to = range.from; }",
          "8613:         range.margin = margin || 0;",
          "8615:         if (range.from.line != null) {",
          "8616:           scrollToRange(this, range);",
          "8617:         } else {",
          "8618:           scrollToCoordsRange(this, range.from, range.to, range.margin);",
          "8619:         }",
          "8620:       }),",
          "8622:       setSize: methodOp(function(width, height) {",
          "8623:         var this$1 = this;",
          "8625:         var interpret = function (val) { return typeof val == \"number\" || /^\\d+$/.test(String(val)) ? val + \"px\" : val; };",
          "8626:         if (width != null) { this.display.wrapper.style.width = interpret(width); }",
          "8627:         if (height != null) { this.display.wrapper.style.height = interpret(height); }",
          "8628:         if (this.options.lineWrapping) { clearLineMeasurementCache(this); }",
          "8629:         var lineNo = this.display.viewFrom;",
          "8630:         this.doc.iter(lineNo, this.display.viewTo, function (line) {",
          "8631:           if (line.widgets) { for (var i = 0; i < line.widgets.length; i++)",
          "8632:             { if (line.widgets[i].noHScroll) { regLineChange(this$1, lineNo, \"widget\"); break } } }",
          "8633:           ++lineNo;",
          "8634:         });",
          "8635:         this.curOp.forceUpdate = true;",
          "8636:         signal(this, \"refresh\", this);",
          "8637:       }),",
          "8639:       operation: function(f){return runInOp(this, f)},",
          "8640:       startOperation: function(){return startOperation(this)},",
          "8641:       endOperation: function(){return endOperation(this)},",
          "8643:       refresh: methodOp(function() {",
          "8644:         var oldHeight = this.display.cachedTextHeight;",
          "8645:         regChange(this);",
          "8646:         this.curOp.forceUpdate = true;",
          "8647:         clearCaches(this);",
          "8648:         scrollToCoords(this, this.doc.scrollLeft, this.doc.scrollTop);",
          "8649:         updateGutterSpace(this.display);",
          "8650:         if (oldHeight == null || Math.abs(oldHeight - textHeight(this.display)) > .5 || this.options.lineWrapping)",
          "8651:           { estimateLineHeights(this); }",
          "8652:         signal(this, \"refresh\", this);",
          "8653:       }),",
          "8655:       swapDoc: methodOp(function(doc) {",
          "8656:         var old = this.doc;",
          "8657:         old.cm = null;",
          "8659:         if (this.state.selectingText) { this.state.selectingText(); }",
          "8660:         attachDoc(this, doc);",
          "8661:         clearCaches(this);",
          "8662:         this.display.input.reset();",
          "8663:         scrollToCoords(this, doc.scrollLeft, doc.scrollTop);",
          "8664:         this.curOp.forceScroll = true;",
          "8665:         signalLater(this, \"swapDoc\", this, old);",
          "8666:         return old",
          "8667:       }),",
          "8669:       phrase: function(phraseText) {",
          "8670:         var phrases = this.options.phrases;",
          "8671:         return phrases && Object.prototype.hasOwnProperty.call(phrases, phraseText) ? phrases[phraseText] : phraseText",
          "8672:       },",
          "8674:       getInputField: function(){return this.display.input.getField()},",
          "8675:       getWrapperElement: function(){return this.display.wrapper},",
          "8676:       getScrollerElement: function(){return this.display.scroller},",
          "8677:       getGutterElement: function(){return this.display.gutters}",
          "8678:     };",
          "8679:     eventMixin(CodeMirror);",
          "8681:     CodeMirror.registerHelper = function(type, name, value) {",
          "8682:       if (!helpers.hasOwnProperty(type)) { helpers[type] = CodeMirror[type] = {_global: []}; }",
          "8683:       helpers[type][name] = value;",
          "8684:     };",
          "8685:     CodeMirror.registerGlobalHelper = function(type, name, predicate, value) {",
          "8686:       CodeMirror.registerHelper(type, name, value);",
          "8687:       helpers[type]._global.push({pred: predicate, val: value});",
          "8688:     };",
          "8689:   }",
          "8700:   function findPosH(doc, pos, dir, unit, visually) {",
          "8701:     var oldPos = pos;",
          "8702:     var origDir = dir;",
          "8703:     var lineObj = getLine(doc, pos.line);",
          "8704:     var lineDir = visually && doc.direction == \"rtl\" ? -dir : dir;",
          "8705:     function findNextLine() {",
          "8706:       var l = pos.line + lineDir;",
          "8707:       if (l < doc.first || l >= doc.first + doc.size) { return false }",
          "8708:       pos = new Pos(l, pos.ch, pos.sticky);",
          "8709:       return lineObj = getLine(doc, l)",
          "8710:     }",
          "8711:     function moveOnce(boundToLine) {",
          "8712:       var next;",
          "8713:       if (unit == \"codepoint\") {",
          "8714:         var ch = lineObj.text.charCodeAt(pos.ch + (dir > 0 ? 0 : -1));",
          "8715:         if (isNaN(ch)) {",
          "8716:           next = null;",
          "8717:         } else {",
          "8718:           var astral = dir > 0 ? ch >= 0xD800 && ch < 0xDC00 : ch >= 0xDC00 && ch < 0xDFFF;",
          "8719:           next = new Pos(pos.line, Math.max(0, Math.min(lineObj.text.length, pos.ch + dir * (astral ? 2 : 1))), -dir);",
          "8720:         }",
          "8721:       } else if (visually) {",
          "8722:         next = moveVisually(doc.cm, lineObj, pos, dir);",
          "8723:       } else {",
          "8724:         next = moveLogically(lineObj, pos, dir);",
          "8725:       }",
          "8726:       if (next == null) {",
          "8727:         if (!boundToLine && findNextLine())",
          "8728:           { pos = endOfLine(visually, doc.cm, lineObj, pos.line, lineDir); }",
          "8729:         else",
          "8730:           { return false }",
          "8731:       } else {",
          "8732:         pos = next;",
          "8733:       }",
          "8734:       return true",
          "8735:     }",
          "8737:     if (unit == \"char\" || unit == \"codepoint\") {",
          "8738:       moveOnce();",
          "8739:     } else if (unit == \"column\") {",
          "8740:       moveOnce(true);",
          "8741:     } else if (unit == \"word\" || unit == \"group\") {",
          "8742:       var sawType = null, group = unit == \"group\";",
          "8743:       var helper = doc.cm && doc.cm.getHelper(pos, \"wordChars\");",
          "8744:       for (var first = true;; first = false) {",
          "8745:         if (dir < 0 && !moveOnce(!first)) { break }",
          "8746:         var cur = lineObj.text.charAt(pos.ch) || \"\\n\";",
          "8747:         var type = isWordChar(cur, helper) ? \"w\"",
          "8748:           : group && cur == \"\\n\" ? \"n\"",
          "8749:           : !group || /\\s/.test(cur) ? null",
          "8750:           : \"p\";",
          "8751:         if (group && !first && !type) { type = \"s\"; }",
          "8752:         if (sawType && sawType != type) {",
          "8753:           if (dir < 0) {dir = 1; moveOnce(); pos.sticky = \"after\";}",
          "8754:           break",
          "8755:         }",
          "8757:         if (type) { sawType = type; }",
          "8758:         if (dir > 0 && !moveOnce(!first)) { break }",
          "8759:       }",
          "8760:     }",
          "8761:     var result = skipAtomic(doc, pos, oldPos, origDir, true);",
          "8762:     if (equalCursorPos(oldPos, result)) { result.hitSide = true; }",
          "8763:     return result",
          "8764:   }",
          "8769:   function findPosV(cm, pos, dir, unit) {",
          "8770:     var doc = cm.doc, x = pos.left, y;",
          "8771:     if (unit == \"page\") {",
          "8772:       var pageSize = Math.min(cm.display.wrapper.clientHeight, window.innerHeight || document.documentElement.clientHeight);",
          "8773:       var moveAmount = Math.max(pageSize - .5 * textHeight(cm.display), 3);",
          "8774:       y = (dir > 0 ? pos.bottom : pos.top) + dir * moveAmount;",
          "8776:     } else if (unit == \"line\") {",
          "8777:       y = dir > 0 ? pos.bottom + 3 : pos.top - 3;",
          "8778:     }",
          "8779:     var target;",
          "8780:     for (;;) {",
          "8781:       target = coordsChar(cm, x, y);",
          "8782:       if (!target.outside) { break }",
          "8783:       if (dir < 0 ? y <= 0 : y >= doc.height) { target.hitSide = true; break }",
          "8784:       y += dir * 5;",
          "8785:     }",
          "8786:     return target",
          "8787:   }",
          "8791:   var ContentEditableInput = function(cm) {",
          "8792:     this.cm = cm;",
          "8793:     this.lastAnchorNode = this.lastAnchorOffset = this.lastFocusNode = this.lastFocusOffset = null;",
          "8794:     this.polling = new Delayed();",
          "8795:     this.composing = null;",
          "8796:     this.gracePeriod = false;",
          "8797:     this.readDOMTimeout = null;",
          "8798:   };",
          "8800:   ContentEditableInput.prototype.init = function (display) {",
          "8801:       var this$1 = this;",
          "8803:     var input = this, cm = input.cm;",
          "8804:     var div = input.div = display.lineDiv;",
          "8805:     div.contentEditable = true;",
          "8806:     disableBrowserMagic(div, cm.options.spellcheck, cm.options.autocorrect, cm.options.autocapitalize);",
          "8808:     function belongsToInput(e) {",
          "8809:       for (var t = e.target; t; t = t.parentNode) {",
          "8810:         if (t == div) { return true }",
          "8811:         if (/\\bCodeMirror-(?:line)?widget\\b/.test(t.className)) { break }",
          "8812:       }",
          "8813:       return false",
          "8814:     }",
          "8816:     on(div, \"paste\", function (e) {",
          "8817:       if (!belongsToInput(e) || signalDOMEvent(cm, e) || handlePaste(e, cm)) { return }",
          "8819:       if (ie_version <= 11) { setTimeout(operation(cm, function () { return this$1.updateFromDOM(); }), 20); }",
          "8820:     });",
          "8822:     on(div, \"compositionstart\", function (e) {",
          "8823:       this$1.composing = {data: e.data, done: false};",
          "8824:     });",
          "8825:     on(div, \"compositionupdate\", function (e) {",
          "8826:       if (!this$1.composing) { this$1.composing = {data: e.data, done: false}; }",
          "8827:     });",
          "8828:     on(div, \"compositionend\", function (e) {",
          "8829:       if (this$1.composing) {",
          "8830:         if (e.data != this$1.composing.data) { this$1.readFromDOMSoon(); }",
          "8831:         this$1.composing.done = true;",
          "8832:       }",
          "8833:     });",
          "8835:     on(div, \"touchstart\", function () { return input.forceCompositionEnd(); });",
          "8837:     on(div, \"input\", function () {",
          "8838:       if (!this$1.composing) { this$1.readFromDOMSoon(); }",
          "8839:     });",
          "8841:     function onCopyCut(e) {",
          "8842:       if (!belongsToInput(e) || signalDOMEvent(cm, e)) { return }",
          "8843:       if (cm.somethingSelected()) {",
          "8844:         setLastCopied({lineWise: false, text: cm.getSelections()});",
          "8845:         if (e.type == \"cut\") { cm.replaceSelection(\"\", null, \"cut\"); }",
          "8846:       } else if (!cm.options.lineWiseCopyCut) {",
          "8847:         return",
          "8848:       } else {",
          "8849:         var ranges = copyableRanges(cm);",
          "8850:         setLastCopied({lineWise: true, text: ranges.text});",
          "8851:         if (e.type == \"cut\") {",
          "8852:           cm.operation(function () {",
          "8853:             cm.setSelections(ranges.ranges, 0, sel_dontScroll);",
          "8854:             cm.replaceSelection(\"\", null, \"cut\");",
          "8855:           });",
          "8856:         }",
          "8857:       }",
          "8858:       if (e.clipboardData) {",
          "8859:         e.clipboardData.clearData();",
          "8860:         var content = lastCopied.text.join(\"\\n\");",
          "8862:         e.clipboardData.setData(\"Text\", content);",
          "8863:         if (e.clipboardData.getData(\"Text\") == content) {",
          "8864:           e.preventDefault();",
          "8865:           return",
          "8866:         }",
          "8867:       }",
          "8869:       var kludge = hiddenTextarea(), te = kludge.firstChild;",
          "8870:       cm.display.lineSpace.insertBefore(kludge, cm.display.lineSpace.firstChild);",
          "8871:       te.value = lastCopied.text.join(\"\\n\");",
          "8872:       var hadFocus = activeElt();",
          "8873:       selectInput(te);",
          "8874:       setTimeout(function () {",
          "8875:         cm.display.lineSpace.removeChild(kludge);",
          "8876:         hadFocus.focus();",
          "8877:         if (hadFocus == div) { input.showPrimarySelection(); }",
          "8878:       }, 50);",
          "8879:     }",
          "8880:     on(div, \"copy\", onCopyCut);",
          "8881:     on(div, \"cut\", onCopyCut);",
          "8882:   };",
          "8884:   ContentEditableInput.prototype.screenReaderLabelChanged = function (label) {",
          "8886:     if(label) {",
          "8887:       this.div.setAttribute('aria-label', label);",
          "8888:     } else {",
          "8889:       this.div.removeAttribute('aria-label');",
          "8890:     }",
          "8891:   };",
          "8893:   ContentEditableInput.prototype.prepareSelection = function () {",
          "8894:     var result = prepareSelection(this.cm, false);",
          "8895:     result.focus = activeElt() == this.div;",
          "8896:     return result",
          "8897:   };",
          "8899:   ContentEditableInput.prototype.showSelection = function (info, takeFocus) {",
          "8900:     if (!info || !this.cm.display.view.length) { return }",
          "8901:     if (info.focus || takeFocus) { this.showPrimarySelection(); }",
          "8902:     this.showMultipleSelections(info);",
          "8903:   };",
          "8905:   ContentEditableInput.prototype.getSelection = function () {",
          "8906:     return this.cm.display.wrapper.ownerDocument.getSelection()",
          "8907:   };",
          "8909:   ContentEditableInput.prototype.showPrimarySelection = function () {",
          "8910:     var sel = this.getSelection(), cm = this.cm, prim = cm.doc.sel.primary();",
          "8911:     var from = prim.from(), to = prim.to();",
          "8913:     if (cm.display.viewTo == cm.display.viewFrom || from.line >= cm.display.viewTo || to.line < cm.display.viewFrom) {",
          "8914:       sel.removeAllRanges();",
          "8915:       return",
          "8916:     }",
          "8918:     var curAnchor = domToPos(cm, sel.anchorNode, sel.anchorOffset);",
          "8919:     var curFocus = domToPos(cm, sel.focusNode, sel.focusOffset);",
          "8920:     if (curAnchor && !curAnchor.bad && curFocus && !curFocus.bad &&",
          "8921:         cmp(minPos(curAnchor, curFocus), from) == 0 &&",
          "8922:         cmp(maxPos(curAnchor, curFocus), to) == 0)",
          "8923:       { return }",
          "8925:     var view = cm.display.view;",
          "8926:     var start = (from.line >= cm.display.viewFrom && posToDOM(cm, from)) ||",
          "8927:         {node: view[0].measure.map[2], offset: 0};",
          "8928:     var end = to.line < cm.display.viewTo && posToDOM(cm, to);",
          "8929:     if (!end) {",
          "8930:       var measure = view[view.length - 1].measure;",
          "8931:       var map = measure.maps ? measure.maps[measure.maps.length - 1] : measure.map;",
          "8932:       end = {node: map[map.length - 1], offset: map[map.length - 2] - map[map.length - 3]};",
          "8933:     }",
          "8935:     if (!start || !end) {",
          "8936:       sel.removeAllRanges();",
          "8937:       return",
          "8938:     }",
          "8940:     var old = sel.rangeCount && sel.getRangeAt(0), rng;",
          "8941:     try { rng = range(start.node, start.offset, end.offset, end.node); }",
          "8942:     catch(e) {} // Our model of the DOM might be outdated, in which case the range we try to set can be impossible",
          "8943:     if (rng) {",
          "8944:       if (!gecko && cm.state.focused) {",
          "8945:         sel.collapse(start.node, start.offset);",
          "8946:         if (!rng.collapsed) {",
          "8947:           sel.removeAllRanges();",
          "8948:           sel.addRange(rng);",
          "8949:         }",
          "8950:       } else {",
          "8951:         sel.removeAllRanges();",
          "8952:         sel.addRange(rng);",
          "8953:       }",
          "8954:       if (old && sel.anchorNode == null) { sel.addRange(old); }",
          "8955:       else if (gecko) { this.startGracePeriod(); }",
          "8956:     }",
          "8957:     this.rememberSelection();",
          "8958:   };",
          "8960:   ContentEditableInput.prototype.startGracePeriod = function () {",
          "8961:       var this$1 = this;",
          "8963:     clearTimeout(this.gracePeriod);",
          "8964:     this.gracePeriod = setTimeout(function () {",
          "8965:       this$1.gracePeriod = false;",
          "8966:       if (this$1.selectionChanged())",
          "8967:         { this$1.cm.operation(function () { return this$1.cm.curOp.selectionChanged = true; }); }",
          "8968:     }, 20);",
          "8969:   };",
          "8971:   ContentEditableInput.prototype.showMultipleSelections = function (info) {",
          "8972:     removeChildrenAndAdd(this.cm.display.cursorDiv, info.cursors);",
          "8973:     removeChildrenAndAdd(this.cm.display.selectionDiv, info.selection);",
          "8974:   };",
          "8976:   ContentEditableInput.prototype.rememberSelection = function () {",
          "8977:     var sel = this.getSelection();",
          "8978:     this.lastAnchorNode = sel.anchorNode; this.lastAnchorOffset = sel.anchorOffset;",
          "8979:     this.lastFocusNode = sel.focusNode; this.lastFocusOffset = sel.focusOffset;",
          "8980:   };",
          "8982:   ContentEditableInput.prototype.selectionInEditor = function () {",
          "8983:     var sel = this.getSelection();",
          "8984:     if (!sel.rangeCount) { return false }",
          "8985:     var node = sel.getRangeAt(0).commonAncestorContainer;",
          "8986:     return contains(this.div, node)",
          "8987:   };",
          "8989:   ContentEditableInput.prototype.focus = function () {",
          "8990:     if (this.cm.options.readOnly != \"nocursor\") {",
          "8991:       if (!this.selectionInEditor() || activeElt() != this.div)",
          "8992:         { this.showSelection(this.prepareSelection(), true); }",
          "8993:       this.div.focus();",
          "8994:     }",
          "8995:   };",
          "8996:   ContentEditableInput.prototype.blur = function () { this.div.blur(); };",
          "8997:   ContentEditableInput.prototype.getField = function () { return this.div };",
          "8999:   ContentEditableInput.prototype.supportsTouch = function () { return true };",
          "9001:   ContentEditableInput.prototype.receivedFocus = function () {",
          "9002:       var this$1 = this;",
          "9004:     var input = this;",
          "9005:     if (this.selectionInEditor())",
          "9006:       { setTimeout(function () { return this$1.pollSelection(); }, 20); }",
          "9007:     else",
          "9008:       { runInOp(this.cm, function () { return input.cm.curOp.selectionChanged = true; }); }",
          "9010:     function poll() {",
          "9011:       if (input.cm.state.focused) {",
          "9012:         input.pollSelection();",
          "9013:         input.polling.set(input.cm.options.pollInterval, poll);",
          "9014:       }",
          "9015:     }",
          "9016:     this.polling.set(this.cm.options.pollInterval, poll);",
          "9017:   };",
          "9019:   ContentEditableInput.prototype.selectionChanged = function () {",
          "9020:     var sel = this.getSelection();",
          "9021:     return sel.anchorNode != this.lastAnchorNode || sel.anchorOffset != this.lastAnchorOffset ||",
          "9022:       sel.focusNode != this.lastFocusNode || sel.focusOffset != this.lastFocusOffset",
          "9023:   };",
          "9025:   ContentEditableInput.prototype.pollSelection = function () {",
          "9026:     if (this.readDOMTimeout != null || this.gracePeriod || !this.selectionChanged()) { return }",
          "9027:     var sel = this.getSelection(), cm = this.cm;",
          "9034:     if (android && chrome && this.cm.display.gutterSpecs.length && isInGutter(sel.anchorNode)) {",
          "9035:       this.cm.triggerOnKeyDown({type: \"keydown\", keyCode: 8, preventDefault: Math.abs});",
          "9036:       this.blur();",
          "9037:       this.focus();",
          "9038:       return",
          "9039:     }",
          "9040:     if (this.composing) { return }",
          "9041:     this.rememberSelection();",
          "9042:     var anchor = domToPos(cm, sel.anchorNode, sel.anchorOffset);",
          "9043:     var head = domToPos(cm, sel.focusNode, sel.focusOffset);",
          "9044:     if (anchor && head) { runInOp(cm, function () {",
          "9045:       setSelection(cm.doc, simpleSelection(anchor, head), sel_dontScroll);",
          "9046:       if (anchor.bad || head.bad) { cm.curOp.selectionChanged = true; }",
          "9047:     }); }",
          "9048:   };",
          "9050:   ContentEditableInput.prototype.pollContent = function () {",
          "9051:     if (this.readDOMTimeout != null) {",
          "9052:       clearTimeout(this.readDOMTimeout);",
          "9053:       this.readDOMTimeout = null;",
          "9054:     }",
          "9056:     var cm = this.cm, display = cm.display, sel = cm.doc.sel.primary();",
          "9057:     var from = sel.from(), to = sel.to();",
          "9058:     if (from.ch == 0 && from.line > cm.firstLine())",
          "9059:       { from = Pos(from.line - 1, getLine(cm.doc, from.line - 1).length); }",
          "9060:     if (to.ch == getLine(cm.doc, to.line).text.length && to.line < cm.lastLine())",
          "9061:       { to = Pos(to.line + 1, 0); }",
          "9062:     if (from.line < display.viewFrom || to.line > display.viewTo - 1) { return false }",
          "9064:     var fromIndex, fromLine, fromNode;",
          "9065:     if (from.line == display.viewFrom || (fromIndex = findViewIndex(cm, from.line)) == 0) {",
          "9066:       fromLine = lineNo(display.view[0].line);",
          "9067:       fromNode = display.view[0].node;",
          "9068:     } else {",
          "9069:       fromLine = lineNo(display.view[fromIndex].line);",
          "9070:       fromNode = display.view[fromIndex - 1].node.nextSibling;",
          "9071:     }",
          "9072:     var toIndex = findViewIndex(cm, to.line);",
          "9073:     var toLine, toNode;",
          "9074:     if (toIndex == display.view.length - 1) {",
          "9075:       toLine = display.viewTo - 1;",
          "9076:       toNode = display.lineDiv.lastChild;",
          "9077:     } else {",
          "9078:       toLine = lineNo(display.view[toIndex + 1].line) - 1;",
          "9079:       toNode = display.view[toIndex + 1].node.previousSibling;",
          "9080:     }",
          "9082:     if (!fromNode) { return false }",
          "9083:     var newText = cm.doc.splitLines(domTextBetween(cm, fromNode, toNode, fromLine, toLine));",
          "9084:     var oldText = getBetween(cm.doc, Pos(fromLine, 0), Pos(toLine, getLine(cm.doc, toLine).text.length));",
          "9085:     while (newText.length > 1 && oldText.length > 1) {",
          "9086:       if (lst(newText) == lst(oldText)) { newText.pop(); oldText.pop(); toLine--; }",
          "9087:       else if (newText[0] == oldText[0]) { newText.shift(); oldText.shift(); fromLine++; }",
          "9088:       else { break }",
          "9089:     }",
          "9091:     var cutFront = 0, cutEnd = 0;",
          "9092:     var newTop = newText[0], oldTop = oldText[0], maxCutFront = Math.min(newTop.length, oldTop.length);",
          "9093:     while (cutFront < maxCutFront && newTop.charCodeAt(cutFront) == oldTop.charCodeAt(cutFront))",
          "9094:       { ++cutFront; }",
          "9095:     var newBot = lst(newText), oldBot = lst(oldText);",
          "9096:     var maxCutEnd = Math.min(newBot.length - (newText.length == 1 ? cutFront : 0),",
          "9097:                              oldBot.length - (oldText.length == 1 ? cutFront : 0));",
          "9098:     while (cutEnd < maxCutEnd &&",
          "9099:            newBot.charCodeAt(newBot.length - cutEnd - 1) == oldBot.charCodeAt(oldBot.length - cutEnd - 1))",
          "9100:       { ++cutEnd; }",
          "9102:     if (newText.length == 1 && oldText.length == 1 && fromLine == from.line) {",
          "9103:       while (cutFront && cutFront > from.ch &&",
          "9104:              newBot.charCodeAt(newBot.length - cutEnd - 1) == oldBot.charCodeAt(oldBot.length - cutEnd - 1)) {",
          "9105:         cutFront--;",
          "9106:         cutEnd++;",
          "9107:       }",
          "9108:     }",
          "9110:     newText[newText.length - 1] = newBot.slice(0, newBot.length - cutEnd).replace(/^\\u200b+/, \"\");",
          "9111:     newText[0] = newText[0].slice(cutFront).replace(/\\u200b+$/, \"\");",
          "9113:     var chFrom = Pos(fromLine, cutFront);",
          "9114:     var chTo = Pos(toLine, oldText.length ? lst(oldText).length - cutEnd : 0);",
          "9115:     if (newText.length > 1 || newText[0] || cmp(chFrom, chTo)) {",
          "9116:       replaceRange(cm.doc, newText, chFrom, chTo, \"+input\");",
          "9117:       return true",
          "9118:     }",
          "9119:   };",
          "9121:   ContentEditableInput.prototype.ensurePolled = function () {",
          "9122:     this.forceCompositionEnd();",
          "9123:   };",
          "9124:   ContentEditableInput.prototype.reset = function () {",
          "9125:     this.forceCompositionEnd();",
          "9126:   };",
          "9127:   ContentEditableInput.prototype.forceCompositionEnd = function () {",
          "9128:     if (!this.composing) { return }",
          "9129:     clearTimeout(this.readDOMTimeout);",
          "9130:     this.composing = null;",
          "9131:     this.updateFromDOM();",
          "9132:     this.div.blur();",
          "9133:     this.div.focus();",
          "9134:   };",
          "9135:   ContentEditableInput.prototype.readFromDOMSoon = function () {",
          "9136:       var this$1 = this;",
          "9138:     if (this.readDOMTimeout != null) { return }",
          "9139:     this.readDOMTimeout = setTimeout(function () {",
          "9140:       this$1.readDOMTimeout = null;",
          "9141:       if (this$1.composing) {",
          "9142:         if (this$1.composing.done) { this$1.composing = null; }",
          "9143:         else { return }",
          "9144:       }",
          "9145:       this$1.updateFromDOM();",
          "9146:     }, 80);",
          "9147:   };",
          "9149:   ContentEditableInput.prototype.updateFromDOM = function () {",
          "9150:       var this$1 = this;",
          "9152:     if (this.cm.isReadOnly() || !this.pollContent())",
          "9153:       { runInOp(this.cm, function () { return regChange(this$1.cm); }); }",
          "9154:   };",
          "9156:   ContentEditableInput.prototype.setUneditable = function (node) {",
          "9157:     node.contentEditable = \"false\";",
          "9158:   };",
          "9160:   ContentEditableInput.prototype.onKeyPress = function (e) {",
          "9161:     if (e.charCode == 0 || this.composing) { return }",
          "9162:     e.preventDefault();",
          "9163:     if (!this.cm.isReadOnly())",
          "9164:       { operation(this.cm, applyTextInput)(this.cm, String.fromCharCode(e.charCode == null ? e.keyCode : e.charCode), 0); }",
          "9165:   };",
          "9167:   ContentEditableInput.prototype.readOnlyChanged = function (val) {",
          "9168:     this.div.contentEditable = String(val != \"nocursor\");",
          "9169:   };",
          "9171:   ContentEditableInput.prototype.onContextMenu = function () {};",
          "9172:   ContentEditableInput.prototype.resetPosition = function () {};",
          "9174:   ContentEditableInput.prototype.needsContentAttribute = true;",
          "9176:   function posToDOM(cm, pos) {",
          "9177:     var view = findViewForLine(cm, pos.line);",
          "9178:     if (!view || view.hidden) { return null }",
          "9179:     var line = getLine(cm.doc, pos.line);",
          "9180:     var info = mapFromLineView(view, line, pos.line);",
          "9182:     var order = getOrder(line, cm.doc.direction), side = \"left\";",
          "9183:     if (order) {",
          "9184:       var partPos = getBidiPartAt(order, pos.ch);",
          "9185:       side = partPos % 2 ? \"right\" : \"left\";",
          "9186:     }",
          "9187:     var result = nodeAndOffsetInLineMap(info.map, pos.ch, side);",
          "9188:     result.offset = result.collapse == \"right\" ? result.end : result.start;",
          "9189:     return result",
          "9190:   }",
          "9192:   function isInGutter(node) {",
          "9193:     for (var scan = node; scan; scan = scan.parentNode)",
          "9194:       { if (/CodeMirror-gutter-wrapper/.test(scan.className)) { return true } }",
          "9195:     return false",
          "9196:   }",
          "9198:   function badPos(pos, bad) { if (bad) { pos.bad = true; } return pos }",
          "9200:   function domTextBetween(cm, from, to, fromLine, toLine) {",
          "9201:     var text = \"\", closing = false, lineSep = cm.doc.lineSeparator(), extraLinebreak = false;",
          "9202:     function recognizeMarker(id) { return function (marker) { return marker.id == id; } }",
          "9203:     function close() {",
          "9204:       if (closing) {",
          "9205:         text += lineSep;",
          "9206:         if (extraLinebreak) { text += lineSep; }",
          "9207:         closing = extraLinebreak = false;",
          "9208:       }",
          "9209:     }",
          "9210:     function addText(str) {",
          "9211:       if (str) {",
          "9212:         close();",
          "9213:         text += str;",
          "9214:       }",
          "9215:     }",
          "9216:     function walk(node) {",
          "9217:       if (node.nodeType == 1) {",
          "9218:         var cmText = node.getAttribute(\"cm-text\");",
          "9219:         if (cmText) {",
          "9220:           addText(cmText);",
          "9221:           return",
          "9222:         }",
          "9223:         var markerID = node.getAttribute(\"cm-marker\"), range;",
          "9224:         if (markerID) {",
          "9225:           var found = cm.findMarks(Pos(fromLine, 0), Pos(toLine + 1, 0), recognizeMarker(+markerID));",
          "9226:           if (found.length && (range = found[0].find(0)))",
          "9227:             { addText(getBetween(cm.doc, range.from, range.to).join(lineSep)); }",
          "9228:           return",
          "9229:         }",
          "9230:         if (node.getAttribute(\"contenteditable\") == \"false\") { return }",
          "9231:         var isBlock = /^(pre|div|p|li|table|br)$/i.test(node.nodeName);",
          "9232:         if (!/^br$/i.test(node.nodeName) && node.textContent.length == 0) { return }",
          "9234:         if (isBlock) { close(); }",
          "9235:         for (var i = 0; i < node.childNodes.length; i++)",
          "9236:           { walk(node.childNodes[i]); }",
          "9238:         if (/^(pre|p)$/i.test(node.nodeName)) { extraLinebreak = true; }",
          "9239:         if (isBlock) { closing = true; }",
          "9240:       } else if (node.nodeType == 3) {",
          "9241:         addText(node.nodeValue.replace(/\\u200b/g, \"\").replace(/\\u00a0/g, \" \"));",
          "9242:       }",
          "9243:     }",
          "9244:     for (;;) {",
          "9245:       walk(from);",
          "9246:       if (from == to) { break }",
          "9247:       from = from.nextSibling;",
          "9248:       extraLinebreak = false;",
          "9249:     }",
          "9250:     return text",
          "9251:   }",
          "9253:   function domToPos(cm, node, offset) {",
          "9254:     var lineNode;",
          "9255:     if (node == cm.display.lineDiv) {",
          "9256:       lineNode = cm.display.lineDiv.childNodes[offset];",
          "9257:       if (!lineNode) { return badPos(cm.clipPos(Pos(cm.display.viewTo - 1)), true) }",
          "9258:       node = null; offset = 0;",
          "9259:     } else {",
          "9260:       for (lineNode = node;; lineNode = lineNode.parentNode) {",
          "9261:         if (!lineNode || lineNode == cm.display.lineDiv) { return null }",
          "9262:         if (lineNode.parentNode && lineNode.parentNode == cm.display.lineDiv) { break }",
          "9263:       }",
          "9264:     }",
          "9265:     for (var i = 0; i < cm.display.view.length; i++) {",
          "9266:       var lineView = cm.display.view[i];",
          "9267:       if (lineView.node == lineNode)",
          "9268:         { return locateNodeInLineView(lineView, node, offset) }",
          "9269:     }",
          "9270:   }",
          "9272:   function locateNodeInLineView(lineView, node, offset) {",
          "9273:     var wrapper = lineView.text.firstChild, bad = false;",
          "9274:     if (!node || !contains(wrapper, node)) { return badPos(Pos(lineNo(lineView.line), 0), true) }",
          "9275:     if (node == wrapper) {",
          "9276:       bad = true;",
          "9277:       node = wrapper.childNodes[offset];",
          "9278:       offset = 0;",
          "9279:       if (!node) {",
          "9280:         var line = lineView.rest ? lst(lineView.rest) : lineView.line;",
          "9281:         return badPos(Pos(lineNo(line), line.text.length), bad)",
          "9282:       }",
          "9283:     }",
          "9285:     var textNode = node.nodeType == 3 ? node : null, topNode = node;",
          "9286:     if (!textNode && node.childNodes.length == 1 && node.firstChild.nodeType == 3) {",
          "9287:       textNode = node.firstChild;",
          "9288:       if (offset) { offset = textNode.nodeValue.length; }",
          "9289:     }",
          "9290:     while (topNode.parentNode != wrapper) { topNode = topNode.parentNode; }",
          "9291:     var measure = lineView.measure, maps = measure.maps;",
          "9293:     function find(textNode, topNode, offset) {",
          "9294:       for (var i = -1; i < (maps ? maps.length : 0); i++) {",
          "9295:         var map = i < 0 ? measure.map : maps[i];",
          "9296:         for (var j = 0; j < map.length; j += 3) {",
          "9297:           var curNode = map[j + 2];",
          "9298:           if (curNode == textNode || curNode == topNode) {",
          "9299:             var line = lineNo(i < 0 ? lineView.line : lineView.rest[i]);",
          "9300:             var ch = map[j] + offset;",
          "9301:             if (offset < 0 || curNode != textNode) { ch = map[j + (offset ? 1 : 0)]; }",
          "9302:             return Pos(line, ch)",
          "9303:           }",
          "9304:         }",
          "9305:       }",
          "9306:     }",
          "9307:     var found = find(textNode, topNode, offset);",
          "9308:     if (found) { return badPos(found, bad) }",
          "9311:     for (var after = topNode.nextSibling, dist = textNode ? textNode.nodeValue.length - offset : 0; after; after = after.nextSibling) {",
          "9312:       found = find(after, after.firstChild, 0);",
          "9313:       if (found)",
          "9314:         { return badPos(Pos(found.line, found.ch - dist), bad) }",
          "9315:       else",
          "9316:         { dist += after.textContent.length; }",
          "9317:     }",
          "9318:     for (var before = topNode.previousSibling, dist$1 = offset; before; before = before.previousSibling) {",
          "9319:       found = find(before, before.firstChild, -1);",
          "9320:       if (found)",
          "9321:         { return badPos(Pos(found.line, found.ch + dist$1), bad) }",
          "9322:       else",
          "9323:         { dist$1 += before.textContent.length; }",
          "9324:     }",
          "9325:   }",
          "9329:   var TextareaInput = function(cm) {",
          "9330:     this.cm = cm;",
          "9332:     this.prevInput = \"\";",
          "9337:     this.pollingFast = false;",
          "9339:     this.polling = new Delayed();",
          "9341:     this.hasSelection = false;",
          "9342:     this.composing = null;",
          "9343:   };",
          "9345:   TextareaInput.prototype.init = function (display) {",
          "9346:       var this$1 = this;",
          "9348:     var input = this, cm = this.cm;",
          "9349:     this.createField(display);",
          "9350:     var te = this.textarea;",
          "9352:     display.wrapper.insertBefore(this.wrapper, display.wrapper.firstChild);",
          "9355:     if (ios) { te.style.width = \"0px\"; }",
          "9357:     on(te, \"input\", function () {",
          "9358:       if (ie && ie_version >= 9 && this$1.hasSelection) { this$1.hasSelection = null; }",
          "9359:       input.poll();",
          "9360:     });",
          "9362:     on(te, \"paste\", function (e) {",
          "9363:       if (signalDOMEvent(cm, e) || handlePaste(e, cm)) { return }",
          "9365:       cm.state.pasteIncoming = +new Date;",
          "9366:       input.fastPoll();",
          "9367:     });",
          "9369:     function prepareCopyCut(e) {",
          "9370:       if (signalDOMEvent(cm, e)) { return }",
          "9371:       if (cm.somethingSelected()) {",
          "9372:         setLastCopied({lineWise: false, text: cm.getSelections()});",
          "9373:       } else if (!cm.options.lineWiseCopyCut) {",
          "9374:         return",
          "9375:       } else {",
          "9376:         var ranges = copyableRanges(cm);",
          "9377:         setLastCopied({lineWise: true, text: ranges.text});",
          "9378:         if (e.type == \"cut\") {",
          "9379:           cm.setSelections(ranges.ranges, null, sel_dontScroll);",
          "9380:         } else {",
          "9381:           input.prevInput = \"\";",
          "9382:           te.value = ranges.text.join(\"\\n\");",
          "9383:           selectInput(te);",
          "9384:         }",
          "9385:       }",
          "9386:       if (e.type == \"cut\") { cm.state.cutIncoming = +new Date; }",
          "9387:     }",
          "9388:     on(te, \"cut\", prepareCopyCut);",
          "9389:     on(te, \"copy\", prepareCopyCut);",
          "9391:     on(display.scroller, \"paste\", function (e) {",
          "9392:       if (eventInWidget(display, e) || signalDOMEvent(cm, e)) { return }",
          "9393:       if (!te.dispatchEvent) {",
          "9394:         cm.state.pasteIncoming = +new Date;",
          "9395:         input.focus();",
          "9396:         return",
          "9397:       }",
          "9400:       var event = new Event(\"paste\");",
          "9401:       event.clipboardData = e.clipboardData;",
          "9402:       te.dispatchEvent(event);",
          "9403:     });",
          "9406:     on(display.lineSpace, \"selectstart\", function (e) {",
          "9407:       if (!eventInWidget(display, e)) { e_preventDefault(e); }",
          "9408:     });",
          "9410:     on(te, \"compositionstart\", function () {",
          "9411:       var start = cm.getCursor(\"from\");",
          "9412:       if (input.composing) { input.composing.range.clear(); }",
          "9413:       input.composing = {",
          "9414:         start: start,",
          "9415:         range: cm.markText(start, cm.getCursor(\"to\"), {className: \"CodeMirror-composing\"})",
          "9416:       };",
          "9417:     });",
          "9418:     on(te, \"compositionend\", function () {",
          "9419:       if (input.composing) {",
          "9420:         input.poll();",
          "9421:         input.composing.range.clear();",
          "9422:         input.composing = null;",
          "9423:       }",
          "9424:     });",
          "9425:   };",
          "9427:   TextareaInput.prototype.createField = function (_display) {",
          "9429:     this.wrapper = hiddenTextarea();",
          "9432:     this.textarea = this.wrapper.firstChild;",
          "9433:   };",
          "9435:   TextareaInput.prototype.screenReaderLabelChanged = function (label) {",
          "9437:     if(label) {",
          "9438:       this.textarea.setAttribute('aria-label', label);",
          "9439:     } else {",
          "9440:       this.textarea.removeAttribute('aria-label');",
          "9441:     }",
          "9442:   };",
          "9444:   TextareaInput.prototype.prepareSelection = function () {",
          "9446:     var cm = this.cm, display = cm.display, doc = cm.doc;",
          "9447:     var result = prepareSelection(cm);",
          "9450:     if (cm.options.moveInputWithCursor) {",
          "9451:       var headPos = cursorCoords(cm, doc.sel.primary().head, \"div\");",
          "9452:       var wrapOff = display.wrapper.getBoundingClientRect(), lineOff = display.lineDiv.getBoundingClientRect();",
          "9453:       result.teTop = Math.max(0, Math.min(display.wrapper.clientHeight - 10,",
          "9454:                                           headPos.top + lineOff.top - wrapOff.top));",
          "9455:       result.teLeft = Math.max(0, Math.min(display.wrapper.clientWidth - 10,",
          "9456:                                            headPos.left + lineOff.left - wrapOff.left));",
          "9457:     }",
          "9459:     return result",
          "9460:   };",
          "9462:   TextareaInput.prototype.showSelection = function (drawn) {",
          "9463:     var cm = this.cm, display = cm.display;",
          "9464:     removeChildrenAndAdd(display.cursorDiv, drawn.cursors);",
          "9465:     removeChildrenAndAdd(display.selectionDiv, drawn.selection);",
          "9466:     if (drawn.teTop != null) {",
          "9467:       this.wrapper.style.top = drawn.teTop + \"px\";",
          "9468:       this.wrapper.style.left = drawn.teLeft + \"px\";",
          "9469:     }",
          "9470:   };",
          "9474:   TextareaInput.prototype.reset = function (typing) {",
          "9475:     if (this.contextMenuPending || this.composing) { return }",
          "9476:     var cm = this.cm;",
          "9477:     if (cm.somethingSelected()) {",
          "9478:       this.prevInput = \"\";",
          "9479:       var content = cm.getSelection();",
          "9480:       this.textarea.value = content;",
          "9481:       if (cm.state.focused) { selectInput(this.textarea); }",
          "9482:       if (ie && ie_version >= 9) { this.hasSelection = content; }",
          "9483:     } else if (!typing) {",
          "9484:       this.prevInput = this.textarea.value = \"\";",
          "9485:       if (ie && ie_version >= 9) { this.hasSelection = null; }",
          "9486:     }",
          "9487:   };",
          "9489:   TextareaInput.prototype.getField = function () { return this.textarea };",
          "9491:   TextareaInput.prototype.supportsTouch = function () { return false };",
          "9493:   TextareaInput.prototype.focus = function () {",
          "9494:     if (this.cm.options.readOnly != \"nocursor\" && (!mobile || activeElt() != this.textarea)) {",
          "9495:       try { this.textarea.focus(); }",
          "9496:       catch (e) {} // IE8 will throw if the textarea is display: none or not in DOM",
          "9497:     }",
          "9498:   };",
          "9500:   TextareaInput.prototype.blur = function () { this.textarea.blur(); };",
          "9502:   TextareaInput.prototype.resetPosition = function () {",
          "9503:     this.wrapper.style.top = this.wrapper.style.left = 0;",
          "9504:   };",
          "9506:   TextareaInput.prototype.receivedFocus = function () { this.slowPoll(); };",
          "9510:   TextareaInput.prototype.slowPoll = function () {",
          "9511:       var this$1 = this;",
          "9513:     if (this.pollingFast) { return }",
          "9514:     this.polling.set(this.cm.options.pollInterval, function () {",
          "9515:       this$1.poll();",
          "9516:       if (this$1.cm.state.focused) { this$1.slowPoll(); }",
          "9517:     });",
          "9518:   };",
          "9523:   TextareaInput.prototype.fastPoll = function () {",
          "9524:     var missed = false, input = this;",
          "9525:     input.pollingFast = true;",
          "9526:     function p() {",
          "9527:       var changed = input.poll();",
          "9528:       if (!changed && !missed) {missed = true; input.polling.set(60, p);}",
          "9529:       else {input.pollingFast = false; input.slowPoll();}",
          "9530:     }",
          "9531:     input.polling.set(20, p);",
          "9532:   };",
          "9540:   TextareaInput.prototype.poll = function () {",
          "9541:       var this$1 = this;",
          "9543:     var cm = this.cm, input = this.textarea, prevInput = this.prevInput;",
          "9548:     if (this.contextMenuPending || !cm.state.focused ||",
          "9549:         (hasSelection(input) && !prevInput && !this.composing) ||",
          "9550:         cm.isReadOnly() || cm.options.disableInput || cm.state.keySeq)",
          "9551:       { return false }",
          "9553:     var text = input.value;",
          "9555:     if (text == prevInput && !cm.somethingSelected()) { return false }",
          "9559:     if (ie && ie_version >= 9 && this.hasSelection === text ||",
          "9560:         mac && /[\\uf700-\\uf7ff]/.test(text)) {",
          "9561:       cm.display.input.reset();",
          "9562:       return false",
          "9563:     }",
          "9565:     if (cm.doc.sel == cm.display.selForContextMenu) {",
          "9566:       var first = text.charCodeAt(0);",
          "9567:       if (first == 0x200b && !prevInput) { prevInput = \"\\u200b\"; }",
          "9568:       if (first == 0x21da) { this.reset(); return this.cm.execCommand(\"undo\") }",
          "9569:     }",
          "9571:     var same = 0, l = Math.min(prevInput.length, text.length);",
          "9572:     while (same < l && prevInput.charCodeAt(same) == text.charCodeAt(same)) { ++same; }",
          "9574:     runInOp(cm, function () {",
          "9575:       applyTextInput(cm, text.slice(same), prevInput.length - same,",
          "9576:                      null, this$1.composing ? \"*compose\" : null);",
          "9579:       if (text.length > 1000 || text.indexOf(\"\\n\") > -1) { input.value = this$1.prevInput = \"\"; }",
          "9580:       else { this$1.prevInput = text; }",
          "9582:       if (this$1.composing) {",
          "9583:         this$1.composing.range.clear();",
          "9584:         this$1.composing.range = cm.markText(this$1.composing.start, cm.getCursor(\"to\"),",
          "9585:                                            {className: \"CodeMirror-composing\"});",
          "9586:       }",
          "9587:     });",
          "9588:     return true",
          "9589:   };",
          "9591:   TextareaInput.prototype.ensurePolled = function () {",
          "9592:     if (this.pollingFast && this.poll()) { this.pollingFast = false; }",
          "9593:   };",
          "9595:   TextareaInput.prototype.onKeyPress = function () {",
          "9596:     if (ie && ie_version >= 9) { this.hasSelection = null; }",
          "9597:     this.fastPoll();",
          "9598:   };",
          "9600:   TextareaInput.prototype.onContextMenu = function (e) {",
          "9601:     var input = this, cm = input.cm, display = cm.display, te = input.textarea;",
          "9602:     if (input.contextMenuPending) { input.contextMenuPending(); }",
          "9603:     var pos = posFromMouse(cm, e), scrollPos = display.scroller.scrollTop;",
          "9604:     if (!pos || presto) { return } // Opera is difficult.",
          "9608:     var reset = cm.options.resetSelectionOnContextMenu;",
          "9609:     if (reset && cm.doc.sel.contains(pos) == -1)",
          "9610:       { operation(cm, setSelection)(cm.doc, simpleSelection(pos), sel_dontScroll); }",
          "9612:     var oldCSS = te.style.cssText, oldWrapperCSS = input.wrapper.style.cssText;",
          "9613:     var wrapperBox = input.wrapper.offsetParent.getBoundingClientRect();",
          "9614:     input.wrapper.style.cssText = \"position: static\";",
          "9615:     te.style.cssText = \"position: absolute; width: 30px; height: 30px;\\n      top: \" + (e.clientY - wrapperBox.top - 5) + \"px; left: \" + (e.clientX - wrapperBox.left - 5) + \"px;\\n      z-index: 1000; background: \" + (ie ? \"rgba(255, 255, 255, .05)\" : \"transparent\") + \";\\n      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);\";",
          "9616:     var oldScrollY;",
          "9617:     if (webkit) { oldScrollY = window.scrollY; } // Work around Chrome issue (#2712)",
          "9618:     display.input.focus();",
          "9619:     if (webkit) { window.scrollTo(null, oldScrollY); }",
          "9620:     display.input.reset();",
          "9622:     if (!cm.somethingSelected()) { te.value = input.prevInput = \" \"; }",
          "9623:     input.contextMenuPending = rehide;",
          "9624:     display.selForContextMenu = cm.doc.sel;",
          "9625:     clearTimeout(display.detectingSelectAll);",
          "9630:     function prepareSelectAllHack() {",
          "9631:       if (te.selectionStart != null) {",
          "9632:         var selected = cm.somethingSelected();",
          "9633:         var extval = \"\\u200b\" + (selected ? te.value : \"\");",
          "9634:         te.value = \"\\u21da\"; // Used to catch context-menu undo",
          "9635:         te.value = extval;",
          "9636:         input.prevInput = selected ? \"\" : \"\\u200b\";",
          "9637:         te.selectionStart = 1; te.selectionEnd = extval.length;",
          "9640:         display.selForContextMenu = cm.doc.sel;",
          "9641:       }",
          "9642:     }",
          "9643:     function rehide() {",
          "9644:       if (input.contextMenuPending != rehide) { return }",
          "9645:       input.contextMenuPending = false;",
          "9646:       input.wrapper.style.cssText = oldWrapperCSS;",
          "9647:       te.style.cssText = oldCSS;",
          "9648:       if (ie && ie_version < 9) { display.scrollbars.setScrollTop(display.scroller.scrollTop = scrollPos); }",
          "9651:       if (te.selectionStart != null) {",
          "9652:         if (!ie || (ie && ie_version < 9)) { prepareSelectAllHack(); }",
          "9653:         var i = 0, poll = function () {",
          "9654:           if (display.selForContextMenu == cm.doc.sel && te.selectionStart == 0 &&",
          "9655:               te.selectionEnd > 0 && input.prevInput == \"\\u200b\") {",
          "9656:             operation(cm, selectAll)(cm);",
          "9657:           } else if (i++ < 10) {",
          "9658:             display.detectingSelectAll = setTimeout(poll, 500);",
          "9659:           } else {",
          "9660:             display.selForContextMenu = null;",
          "9661:             display.input.reset();",
          "9662:           }",
          "9663:         };",
          "9664:         display.detectingSelectAll = setTimeout(poll, 200);",
          "9665:       }",
          "9666:     }",
          "9668:     if (ie && ie_version >= 9) { prepareSelectAllHack(); }",
          "9669:     if (captureRightClick) {",
          "9670:       e_stop(e);",
          "9671:       var mouseup = function () {",
          "9672:         off(window, \"mouseup\", mouseup);",
          "9673:         setTimeout(rehide, 20);",
          "9674:       };",
          "9675:       on(window, \"mouseup\", mouseup);",
          "9676:     } else {",
          "9677:       setTimeout(rehide, 50);",
          "9678:     }",
          "9679:   };",
          "9681:   TextareaInput.prototype.readOnlyChanged = function (val) {",
          "9682:     if (!val) { this.reset(); }",
          "9683:     this.textarea.disabled = val == \"nocursor\";",
          "9684:     this.textarea.readOnly = !!val;",
          "9685:   };",
          "9687:   TextareaInput.prototype.setUneditable = function () {};",
          "9689:   TextareaInput.prototype.needsContentAttribute = false;",
          "9691:   function fromTextArea(textarea, options) {",
          "9692:     options = options ? copyObj(options) : {};",
          "9693:     options.value = textarea.value;",
          "9694:     if (!options.tabindex && textarea.tabIndex)",
          "9695:       { options.tabindex = textarea.tabIndex; }",
          "9696:     if (!options.placeholder && textarea.placeholder)",
          "9697:       { options.placeholder = textarea.placeholder; }",
          "9700:     if (options.autofocus == null) {",
          "9701:       var hasFocus = activeElt();",
          "9702:       options.autofocus = hasFocus == textarea ||",
          "9703:         textarea.getAttribute(\"autofocus\") != null && hasFocus == document.body;",
          "9704:     }",
          "9706:     function save() {textarea.value = cm.getValue();}",
          "9708:     var realSubmit;",
          "9709:     if (textarea.form) {",
          "9710:       on(textarea.form, \"submit\", save);",
          "9712:       if (!options.leaveSubmitMethodAlone) {",
          "9713:         var form = textarea.form;",
          "9714:         realSubmit = form.submit;",
          "9715:         try {",
          "9716:           var wrappedSubmit = form.submit = function () {",
          "9717:             save();",
          "9718:             form.submit = realSubmit;",
          "9719:             form.submit();",
          "9720:             form.submit = wrappedSubmit;",
          "9721:           };",
          "9722:         } catch(e) {}",
          "9723:       }",
          "9724:     }",
          "9726:     options.finishInit = function (cm) {",
          "9727:       cm.save = save;",
          "9728:       cm.getTextArea = function () { return textarea; };",
          "9729:       cm.toTextArea = function () {",
          "9730:         cm.toTextArea = isNaN; // Prevent this from being ran twice",
          "9731:         save();",
          "9732:         textarea.parentNode.removeChild(cm.getWrapperElement());",
          "9733:         textarea.style.display = \"\";",
          "9734:         if (textarea.form) {",
          "9735:           off(textarea.form, \"submit\", save);",
          "9736:           if (!options.leaveSubmitMethodAlone && typeof textarea.form.submit == \"function\")",
          "9737:             { textarea.form.submit = realSubmit; }",
          "9738:         }",
          "9739:       };",
          "9740:     };",
          "9742:     textarea.style.display = \"none\";",
          "9743:     var cm = CodeMirror(function (node) { return textarea.parentNode.insertBefore(node, textarea.nextSibling); },",
          "9744:       options);",
          "9745:     return cm",
          "9746:   }",
          "9748:   function addLegacyProps(CodeMirror) {",
          "9749:     CodeMirror.off = off;",
          "9750:     CodeMirror.on = on;",
          "9751:     CodeMirror.wheelEventPixels = wheelEventPixels;",
          "9752:     CodeMirror.Doc = Doc;",
          "9753:     CodeMirror.splitLines = splitLinesAuto;",
          "9754:     CodeMirror.countColumn = countColumn;",
          "9755:     CodeMirror.findColumn = findColumn;",
          "9756:     CodeMirror.isWordChar = isWordCharBasic;",
          "9757:     CodeMirror.Pass = Pass;",
          "9758:     CodeMirror.signal = signal;",
          "9759:     CodeMirror.Line = Line;",
          "9760:     CodeMirror.changeEnd = changeEnd;",
          "9761:     CodeMirror.scrollbarModel = scrollbarModel;",
          "9762:     CodeMirror.Pos = Pos;",
          "9763:     CodeMirror.cmpPos = cmp;",
          "9764:     CodeMirror.modes = modes;",
          "9765:     CodeMirror.mimeModes = mimeModes;",
          "9766:     CodeMirror.resolveMode = resolveMode;",
          "9767:     CodeMirror.getMode = getMode;",
          "9768:     CodeMirror.modeExtensions = modeExtensions;",
          "9769:     CodeMirror.extendMode = extendMode;",
          "9770:     CodeMirror.copyState = copyState;",
          "9771:     CodeMirror.startState = startState;",
          "9772:     CodeMirror.innerMode = innerMode;",
          "9773:     CodeMirror.commands = commands;",
          "9774:     CodeMirror.keyMap = keyMap;",
          "9775:     CodeMirror.keyName = keyName;",
          "9776:     CodeMirror.isModifierKey = isModifierKey;",
          "9777:     CodeMirror.lookupKey = lookupKey;",
          "9778:     CodeMirror.normalizeKeyMap = normalizeKeyMap;",
          "9779:     CodeMirror.StringStream = StringStream;",
          "9780:     CodeMirror.SharedTextMarker = SharedTextMarker;",
          "9781:     CodeMirror.TextMarker = TextMarker;",
          "9782:     CodeMirror.LineWidget = LineWidget;",
          "9783:     CodeMirror.e_preventDefault = e_preventDefault;",
          "9784:     CodeMirror.e_stopPropagation = e_stopPropagation;",
          "9785:     CodeMirror.e_stop = e_stop;",
          "9786:     CodeMirror.addClass = addClass;",
          "9787:     CodeMirror.contains = contains;",
          "9788:     CodeMirror.rmClass = rmClass;",
          "9789:     CodeMirror.keyNames = keyNames;",
          "9790:   }",
          "9794:   defineOptions(CodeMirror);",
          "9796:   addEditorMethods(CodeMirror);",
          "9799:   var dontDelegate = \"iter insert remove copy getEditor constructor\".split(\" \");",
          "9800:   for (var prop in Doc.prototype) { if (Doc.prototype.hasOwnProperty(prop) && indexOf(dontDelegate, prop) < 0)",
          "9801:     { CodeMirror.prototype[prop] = (function(method) {",
          "9802:       return function() {return method.apply(this.doc, arguments)}",
          "9803:     })(Doc.prototype[prop]); } }",
          "9805:   eventMixin(Doc);",
          "9806:   CodeMirror.inputStyles = {\"textarea\": TextareaInput, \"contenteditable\": ContentEditableInput};",
          "9811:   CodeMirror.defineMode = function(name/*, mode, \u2026*/) {",
          "9812:     if (!CodeMirror.defaults.mode && name != \"null\") { CodeMirror.defaults.mode = name; }",
          "9813:     defineMode.apply(this, arguments);",
          "9814:   };",
          "9816:   CodeMirror.defineMIME = defineMIME;",
          "9819:   CodeMirror.defineMode(\"null\", function () { return ({token: function (stream) { return stream.skipToEnd(); }}); });",
          "9820:   CodeMirror.defineMIME(\"text/plain\", \"null\");",
          "9824:   CodeMirror.defineExtension = function (name, func) {",
          "9825:     CodeMirror.prototype[name] = func;",
          "9826:   };",
          "9827:   CodeMirror.defineDocExtension = function (name, func) {",
          "9828:     Doc.prototype[name] = func;",
          "9829:   };",
          "9831:   CodeMirror.fromTextArea = fromTextArea;",
          "9833:   addLegacyProps(CodeMirror);",
          "9835:   CodeMirror.version = \"5.63.1\";",
          "9837:   return CodeMirror;",
          "9839: })));",
          "",
          "---------------"
        ],
        "static/vendor/codemirror/meta.js||static/vendor/codemirror/meta.js": [
          "File: static/vendor/codemirror/meta.js -> static/vendor/codemirror/meta.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "4: (function(mod) {",
          "5:   if (typeof exports == \"object\" && typeof module == \"object\") // CommonJS",
          "6:     mod(require(\"../lib/codemirror\"));",
          "7:   else if (typeof define == \"function\" && define.amd) // AMD",
          "8:     define([\"../lib/codemirror\"], mod);",
          "9:   else // Plain browser env",
          "10:     mod(CodeMirror);",
          "11: })(function(CodeMirror) {",
          "12:   \"use strict\";",
          "14:   CodeMirror.modeInfo = [",
          "15:     {name: \"APL\", mime: \"text/apl\", mode: \"apl\", ext: [\"dyalog\", \"apl\"]},",
          "16:     {name: \"PGP\", mimes: [\"application/pgp\", \"application/pgp-encrypted\", \"application/pgp-keys\", \"application/pgp-signature\"], mode: \"asciiarmor\", ext: [\"asc\", \"pgp\", \"sig\"]},",
          "17:     {name: \"ASN.1\", mime: \"text/x-ttcn-asn\", mode: \"asn.1\", ext: [\"asn\", \"asn1\"]},",
          "18:     {name: \"Asterisk\", mime: \"text/x-asterisk\", mode: \"asterisk\", file: /^extensions\\.conf$/i},",
          "19:     {name: \"Brainfuck\", mime: \"text/x-brainfuck\", mode: \"brainfuck\", ext: [\"b\", \"bf\"]},",
          "20:     {name: \"C\", mime: \"text/x-csrc\", mode: \"clike\", ext: [\"c\", \"h\", \"ino\"]},",
          "21:     {name: \"C++\", mime: \"text/x-c++src\", mode: \"clike\", ext: [\"cpp\", \"c++\", \"cc\", \"cxx\", \"hpp\", \"h++\", \"hh\", \"hxx\"], alias: [\"cpp\"]},",
          "22:     {name: \"Cobol\", mime: \"text/x-cobol\", mode: \"cobol\", ext: [\"cob\", \"cpy\", \"cbl\"]},",
          "23:     {name: \"C#\", mime: \"text/x-csharp\", mode: \"clike\", ext: [\"cs\"], alias: [\"csharp\", \"cs\"]},",
          "24:     {name: \"Clojure\", mime: \"text/x-clojure\", mode: \"clojure\", ext: [\"clj\", \"cljc\", \"cljx\"]},",
          "25:     {name: \"ClojureScript\", mime: \"text/x-clojurescript\", mode: \"clojure\", ext: [\"cljs\"]},",
          "26:     {name: \"Closure Stylesheets (GSS)\", mime: \"text/x-gss\", mode: \"css\", ext: [\"gss\"]},",
          "27:     {name: \"CMake\", mime: \"text/x-cmake\", mode: \"cmake\", ext: [\"cmake\", \"cmake.in\"], file: /^CMakeLists\\.txt$/},",
          "28:     {name: \"CoffeeScript\", mimes: [\"application/vnd.coffeescript\", \"text/coffeescript\", \"text/x-coffeescript\"], mode: \"coffeescript\", ext: [\"coffee\"], alias: [\"coffee\", \"coffee-script\"]},",
          "29:     {name: \"Common Lisp\", mime: \"text/x-common-lisp\", mode: \"commonlisp\", ext: [\"cl\", \"lisp\", \"el\"], alias: [\"lisp\"]},",
          "30:     {name: \"Cypher\", mime: \"application/x-cypher-query\", mode: \"cypher\", ext: [\"cyp\", \"cypher\"]},",
          "31:     {name: \"Cython\", mime: \"text/x-cython\", mode: \"python\", ext: [\"pyx\", \"pxd\", \"pxi\"]},",
          "32:     {name: \"Crystal\", mime: \"text/x-crystal\", mode: \"crystal\", ext: [\"cr\"]},",
          "33:     {name: \"CSS\", mime: \"text/css\", mode: \"css\", ext: [\"css\"]},",
          "34:     {name: \"CQL\", mime: \"text/x-cassandra\", mode: \"sql\", ext: [\"cql\"]},",
          "35:     {name: \"D\", mime: \"text/x-d\", mode: \"d\", ext: [\"d\"]},",
          "36:     {name: \"Dart\", mimes: [\"application/dart\", \"text/x-dart\"], mode: \"dart\", ext: [\"dart\"]},",
          "37:     {name: \"diff\", mime: \"text/x-diff\", mode: \"diff\", ext: [\"diff\", \"patch\"]},",
          "38:     {name: \"Django\", mime: \"text/x-django\", mode: \"django\"},",
          "39:     {name: \"Dockerfile\", mime: \"text/x-dockerfile\", mode: \"dockerfile\", file: /^Dockerfile$/},",
          "40:     {name: \"DTD\", mime: \"application/xml-dtd\", mode: \"dtd\", ext: [\"dtd\"]},",
          "41:     {name: \"Dylan\", mime: \"text/x-dylan\", mode: \"dylan\", ext: [\"dylan\", \"dyl\", \"intr\"]},",
          "42:     {name: \"EBNF\", mime: \"text/x-ebnf\", mode: \"ebnf\"},",
          "43:     {name: \"ECL\", mime: \"text/x-ecl\", mode: \"ecl\", ext: [\"ecl\"]},",
          "44:     {name: \"edn\", mime: \"application/edn\", mode: \"clojure\", ext: [\"edn\"]},",
          "45:     {name: \"Eiffel\", mime: \"text/x-eiffel\", mode: \"eiffel\", ext: [\"e\"]},",
          "46:     {name: \"Elm\", mime: \"text/x-elm\", mode: \"elm\", ext: [\"elm\"]},",
          "47:     {name: \"Embedded JavaScript\", mime: \"application/x-ejs\", mode: \"htmlembedded\", ext: [\"ejs\"]},",
          "48:     {name: \"Embedded Ruby\", mime: \"application/x-erb\", mode: \"htmlembedded\", ext: [\"erb\"]},",
          "49:     {name: \"Erlang\", mime: \"text/x-erlang\", mode: \"erlang\", ext: [\"erl\"]},",
          "50:     {name: \"Esper\", mime: \"text/x-esper\", mode: \"sql\"},",
          "51:     {name: \"Factor\", mime: \"text/x-factor\", mode: \"factor\", ext: [\"factor\"]},",
          "52:     {name: \"FCL\", mime: \"text/x-fcl\", mode: \"fcl\"},",
          "53:     {name: \"Forth\", mime: \"text/x-forth\", mode: \"forth\", ext: [\"forth\", \"fth\", \"4th\"]},",
          "54:     {name: \"Fortran\", mime: \"text/x-fortran\", mode: \"fortran\", ext: [\"f\", \"for\", \"f77\", \"f90\", \"f95\"]},",
          "55:     {name: \"F#\", mime: \"text/x-fsharp\", mode: \"mllike\", ext: [\"fs\"], alias: [\"fsharp\"]},",
          "56:     {name: \"Gas\", mime: \"text/x-gas\", mode: \"gas\", ext: [\"s\"]},",
          "57:     {name: \"Gherkin\", mime: \"text/x-feature\", mode: \"gherkin\", ext: [\"feature\"]},",
          "58:     {name: \"GitHub Flavored Markdown\", mime: \"text/x-gfm\", mode: \"gfm\", file: /^(readme|contributing|history)\\.md$/i},",
          "59:     {name: \"Go\", mime: \"text/x-go\", mode: \"go\", ext: [\"go\"]},",
          "60:     {name: \"Groovy\", mime: \"text/x-groovy\", mode: \"groovy\", ext: [\"groovy\", \"gradle\"], file: /^Jenkinsfile$/},",
          "61:     {name: \"HAML\", mime: \"text/x-haml\", mode: \"haml\", ext: [\"haml\"]},",
          "62:     {name: \"Haskell\", mime: \"text/x-haskell\", mode: \"haskell\", ext: [\"hs\"]},",
          "63:     {name: \"Haskell (Literate)\", mime: \"text/x-literate-haskell\", mode: \"haskell-literate\", ext: [\"lhs\"]},",
          "64:     {name: \"Haxe\", mime: \"text/x-haxe\", mode: \"haxe\", ext: [\"hx\"]},",
          "65:     {name: \"HXML\", mime: \"text/x-hxml\", mode: \"haxe\", ext: [\"hxml\"]},",
          "66:     {name: \"ASP.NET\", mime: \"application/x-aspx\", mode: \"htmlembedded\", ext: [\"aspx\"], alias: [\"asp\", \"aspx\"]},",
          "67:     {name: \"HTML\", mime: \"text/html\", mode: \"htmlmixed\", ext: [\"html\", \"htm\", \"handlebars\", \"hbs\"], alias: [\"xhtml\"]},",
          "68:     {name: \"HTTP\", mime: \"message/http\", mode: \"http\"},",
          "69:     {name: \"IDL\", mime: \"text/x-idl\", mode: \"idl\", ext: [\"pro\"]},",
          "70:     {name: \"Pug\", mime: \"text/x-pug\", mode: \"pug\", ext: [\"jade\", \"pug\"], alias: [\"jade\"]},",
          "71:     {name: \"Java\", mime: \"text/x-java\", mode: \"clike\", ext: [\"java\"]},",
          "72:     {name: \"Java Server Pages\", mime: \"application/x-jsp\", mode: \"htmlembedded\", ext: [\"jsp\"], alias: [\"jsp\"]},",
          "73:     {name: \"JavaScript\", mimes: [\"text/javascript\", \"text/ecmascript\", \"application/javascript\", \"application/x-javascript\", \"application/ecmascript\"],",
          "74:      mode: \"javascript\", ext: [\"js\"], alias: [\"ecmascript\", \"js\", \"node\"]},",
          "75:     {name: \"JSON\", mimes: [\"application/json\", \"application/x-json\"], mode: \"javascript\", ext: [\"json\", \"map\"], alias: [\"json5\"]},",
          "76:     {name: \"JSON-LD\", mime: \"application/ld+json\", mode: \"javascript\", ext: [\"jsonld\"], alias: [\"jsonld\"]},",
          "77:     {name: \"JSX\", mime: \"text/jsx\", mode: \"jsx\", ext: [\"jsx\"]},",
          "78:     {name: \"Jinja2\", mime: \"text/jinja2\", mode: \"jinja2\", ext: [\"j2\", \"jinja\", \"jinja2\"]},",
          "79:     {name: \"Julia\", mime: \"text/x-julia\", mode: \"julia\", ext: [\"jl\"], alias: [\"jl\"]},",
          "80:     {name: \"Kotlin\", mime: \"text/x-kotlin\", mode: \"clike\", ext: [\"kt\"]},",
          "81:     {name: \"LESS\", mime: \"text/x-less\", mode: \"css\", ext: [\"less\"]},",
          "82:     {name: \"LiveScript\", mime: \"text/x-livescript\", mode: \"livescript\", ext: [\"ls\"], alias: [\"ls\"]},",
          "83:     {name: \"Lua\", mime: \"text/x-lua\", mode: \"lua\", ext: [\"lua\"]},",
          "84:     {name: \"Markdown\", mime: \"text/x-markdown\", mode: \"markdown\", ext: [\"markdown\", \"md\", \"mkd\"]},",
          "85:     {name: \"mIRC\", mime: \"text/mirc\", mode: \"mirc\"},",
          "86:     {name: \"MariaDB SQL\", mime: \"text/x-mariadb\", mode: \"sql\"},",
          "87:     {name: \"Mathematica\", mime: \"text/x-mathematica\", mode: \"mathematica\", ext: [\"m\", \"nb\", \"wl\", \"wls\"]},",
          "88:     {name: \"Modelica\", mime: \"text/x-modelica\", mode: \"modelica\", ext: [\"mo\"]},",
          "89:     {name: \"MUMPS\", mime: \"text/x-mumps\", mode: \"mumps\", ext: [\"mps\"]},",
          "90:     {name: \"MS SQL\", mime: \"text/x-mssql\", mode: \"sql\"},",
          "91:     {name: \"mbox\", mime: \"application/mbox\", mode: \"mbox\", ext: [\"mbox\"]},",
          "92:     {name: \"MySQL\", mime: \"text/x-mysql\", mode: \"sql\"},",
          "93:     {name: \"Nginx\", mime: \"text/x-nginx-conf\", mode: \"nginx\", file: /nginx.*\\.conf$/i},",
          "94:     {name: \"NSIS\", mime: \"text/x-nsis\", mode: \"nsis\", ext: [\"nsh\", \"nsi\"]},",
          "95:     {name: \"NTriples\", mimes: [\"application/n-triples\", \"application/n-quads\", \"text/n-triples\"],",
          "96:      mode: \"ntriples\", ext: [\"nt\", \"nq\"]},",
          "97:     {name: \"Objective-C\", mime: \"text/x-objectivec\", mode: \"clike\", ext: [\"m\"], alias: [\"objective-c\", \"objc\"]},",
          "98:     {name: \"Objective-C++\", mime: \"text/x-objectivec++\", mode: \"clike\", ext: [\"mm\"], alias: [\"objective-c++\", \"objc++\"]},",
          "99:     {name: \"OCaml\", mime: \"text/x-ocaml\", mode: \"mllike\", ext: [\"ml\", \"mli\", \"mll\", \"mly\"]},",
          "100:     {name: \"Octave\", mime: \"text/x-octave\", mode: \"octave\", ext: [\"m\"]},",
          "101:     {name: \"Oz\", mime: \"text/x-oz\", mode: \"oz\", ext: [\"oz\"]},",
          "102:     {name: \"Pascal\", mime: \"text/x-pascal\", mode: \"pascal\", ext: [\"p\", \"pas\"]},",
          "103:     {name: \"PEG.js\", mime: \"null\", mode: \"pegjs\", ext: [\"jsonld\"]},",
          "104:     {name: \"Perl\", mime: \"text/x-perl\", mode: \"perl\", ext: [\"pl\", \"pm\"]},",
          "105:     {name: \"PHP\", mimes: [\"text/x-php\", \"application/x-httpd-php\", \"application/x-httpd-php-open\"], mode: \"php\", ext: [\"php\", \"php3\", \"php4\", \"php5\", \"php7\", \"phtml\"]},",
          "106:     {name: \"Pig\", mime: \"text/x-pig\", mode: \"pig\", ext: [\"pig\"]},",
          "107:     {name: \"Plain Text\", mime: \"text/plain\", mode: \"null\", ext: [\"txt\", \"text\", \"conf\", \"def\", \"list\", \"log\"]},",
          "108:     {name: \"PLSQL\", mime: \"text/x-plsql\", mode: \"sql\", ext: [\"pls\"]},",
          "109:     {name: \"PostgreSQL\", mime: \"text/x-pgsql\", mode: \"sql\"},",
          "110:     {name: \"PowerShell\", mime: \"application/x-powershell\", mode: \"powershell\", ext: [\"ps1\", \"psd1\", \"psm1\"]},",
          "111:     {name: \"Properties files\", mime: \"text/x-properties\", mode: \"properties\", ext: [\"properties\", \"ini\", \"in\"], alias: [\"ini\", \"properties\"]},",
          "112:     {name: \"ProtoBuf\", mime: \"text/x-protobuf\", mode: \"protobuf\", ext: [\"proto\"]},",
          "113:     {name: \"Python\", mime: \"text/x-python\", mode: \"python\", ext: [\"BUILD\", \"bzl\", \"py\", \"pyw\"], file: /^(BUCK|BUILD)$/},",
          "114:     {name: \"Puppet\", mime: \"text/x-puppet\", mode: \"puppet\", ext: [\"pp\"]},",
          "115:     {name: \"Q\", mime: \"text/x-q\", mode: \"q\", ext: [\"q\"]},",
          "116:     {name: \"R\", mime: \"text/x-rsrc\", mode: \"r\", ext: [\"r\", \"R\"], alias: [\"rscript\"]},",
          "117:     {name: \"reStructuredText\", mime: \"text/x-rst\", mode: \"rst\", ext: [\"rst\"], alias: [\"rst\"]},",
          "118:     {name: \"RPM Changes\", mime: \"text/x-rpm-changes\", mode: \"rpm\"},",
          "119:     {name: \"RPM Spec\", mime: \"text/x-rpm-spec\", mode: \"rpm\", ext: [\"spec\"]},",
          "120:     {name: \"Ruby\", mime: \"text/x-ruby\", mode: \"ruby\", ext: [\"rb\"], alias: [\"jruby\", \"macruby\", \"rake\", \"rb\", \"rbx\"]},",
          "121:     {name: \"Rust\", mime: \"text/x-rustsrc\", mode: \"rust\", ext: [\"rs\"]},",
          "122:     {name: \"SAS\", mime: \"text/x-sas\", mode: \"sas\", ext: [\"sas\"]},",
          "123:     {name: \"Sass\", mime: \"text/x-sass\", mode: \"sass\", ext: [\"sass\"]},",
          "124:     {name: \"Scala\", mime: \"text/x-scala\", mode: \"clike\", ext: [\"scala\"]},",
          "125:     {name: \"Scheme\", mime: \"text/x-scheme\", mode: \"scheme\", ext: [\"scm\", \"ss\"]},",
          "126:     {name: \"SCSS\", mime: \"text/x-scss\", mode: \"css\", ext: [\"scss\"]},",
          "127:     {name: \"Shell\", mimes: [\"text/x-sh\", \"application/x-sh\"], mode: \"shell\", ext: [\"sh\", \"ksh\", \"bash\"], alias: [\"bash\", \"sh\", \"zsh\"], file: /^PKGBUILD$/},",
          "128:     {name: \"Sieve\", mime: \"application/sieve\", mode: \"sieve\", ext: [\"siv\", \"sieve\"]},",
          "129:     {name: \"Slim\", mimes: [\"text/x-slim\", \"application/x-slim\"], mode: \"slim\", ext: [\"slim\"]},",
          "130:     {name: \"Smalltalk\", mime: \"text/x-stsrc\", mode: \"smalltalk\", ext: [\"st\"]},",
          "131:     {name: \"Smarty\", mime: \"text/x-smarty\", mode: \"smarty\", ext: [\"tpl\"]},",
          "132:     {name: \"Solr\", mime: \"text/x-solr\", mode: \"solr\"},",
          "133:     {name: \"SML\", mime: \"text/x-sml\", mode: \"mllike\", ext: [\"sml\", \"sig\", \"fun\", \"smackspec\"]},",
          "134:     {name: \"Soy\", mime: \"text/x-soy\", mode: \"soy\", ext: [\"soy\"], alias: [\"closure template\"]},",
          "135:     {name: \"SPARQL\", mime: \"application/sparql-query\", mode: \"sparql\", ext: [\"rq\", \"sparql\"], alias: [\"sparul\"]},",
          "136:     {name: \"Spreadsheet\", mime: \"text/x-spreadsheet\", mode: \"spreadsheet\", alias: [\"excel\", \"formula\"]},",
          "137:     {name: \"SQL\", mime: \"text/x-sql\", mode: \"sql\", ext: [\"sql\"]},",
          "138:     {name: \"SQLite\", mime: \"text/x-sqlite\", mode: \"sql\"},",
          "139:     {name: \"Squirrel\", mime: \"text/x-squirrel\", mode: \"clike\", ext: [\"nut\"]},",
          "140:     {name: \"Stylus\", mime: \"text/x-styl\", mode: \"stylus\", ext: [\"styl\"]},",
          "141:     {name: \"Swift\", mime: \"text/x-swift\", mode: \"swift\", ext: [\"swift\"]},",
          "142:     {name: \"sTeX\", mime: \"text/x-stex\", mode: \"stex\"},",
          "143:     {name: \"LaTeX\", mime: \"text/x-latex\", mode: \"stex\", ext: [\"text\", \"ltx\", \"tex\"], alias: [\"tex\"]},",
          "144:     {name: \"SystemVerilog\", mime: \"text/x-systemverilog\", mode: \"verilog\", ext: [\"v\", \"sv\", \"svh\"]},",
          "145:     {name: \"Tcl\", mime: \"text/x-tcl\", mode: \"tcl\", ext: [\"tcl\"]},",
          "146:     {name: \"Textile\", mime: \"text/x-textile\", mode: \"textile\", ext: [\"textile\"]},",
          "147:     {name: \"TiddlyWiki\", mime: \"text/x-tiddlywiki\", mode: \"tiddlywiki\"},",
          "148:     {name: \"Tiki wiki\", mime: \"text/tiki\", mode: \"tiki\"},",
          "149:     {name: \"TOML\", mime: \"text/x-toml\", mode: \"toml\", ext: [\"toml\"]},",
          "150:     {name: \"Tornado\", mime: \"text/x-tornado\", mode: \"tornado\"},",
          "151:     {name: \"troff\", mime: \"text/troff\", mode: \"troff\", ext: [\"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\"]},",
          "152:     {name: \"TTCN\", mime: \"text/x-ttcn\", mode: \"ttcn\", ext: [\"ttcn\", \"ttcn3\", \"ttcnpp\"]},",
          "153:     {name: \"TTCN_CFG\", mime: \"text/x-ttcn-cfg\", mode: \"ttcn-cfg\", ext: [\"cfg\"]},",
          "154:     {name: \"Turtle\", mime: \"text/turtle\", mode: \"turtle\", ext: [\"ttl\"]},",
          "155:     {name: \"TypeScript\", mime: \"application/typescript\", mode: \"javascript\", ext: [\"ts\"], alias: [\"ts\"]},",
          "156:     {name: \"TypeScript-JSX\", mime: \"text/typescript-jsx\", mode: \"jsx\", ext: [\"tsx\"], alias: [\"tsx\"]},",
          "157:     {name: \"Twig\", mime: \"text/x-twig\", mode: \"twig\"},",
          "158:     {name: \"Web IDL\", mime: \"text/x-webidl\", mode: \"webidl\", ext: [\"webidl\"]},",
          "159:     {name: \"VB.NET\", mime: \"text/x-vb\", mode: \"vb\", ext: [\"vb\"]},",
          "160:     {name: \"VBScript\", mime: \"text/vbscript\", mode: \"vbscript\", ext: [\"vbs\"]},",
          "161:     {name: \"Velocity\", mime: \"text/velocity\", mode: \"velocity\", ext: [\"vtl\"]},",
          "162:     {name: \"Verilog\", mime: \"text/x-verilog\", mode: \"verilog\", ext: [\"v\"]},",
          "163:     {name: \"VHDL\", mime: \"text/x-vhdl\", mode: \"vhdl\", ext: [\"vhd\", \"vhdl\"]},",
          "164:     {name: \"Vue.js Component\", mimes: [\"script/x-vue\", \"text/x-vue\"], mode: \"vue\", ext: [\"vue\"]},",
          "165:     {name: \"XML\", mimes: [\"application/xml\", \"text/xml\"], mode: \"xml\", ext: [\"xml\", \"xsl\", \"xsd\", \"svg\"], alias: [\"rss\", \"wsdl\", \"xsd\"]},",
          "166:     {name: \"XQuery\", mime: \"application/xquery\", mode: \"xquery\", ext: [\"xy\", \"xquery\"]},",
          "167:     {name: \"Yacas\", mime: \"text/x-yacas\", mode: \"yacas\", ext: [\"ys\"]},",
          "168:     {name: \"YAML\", mimes: [\"text/x-yaml\", \"text/yaml\"], mode: \"yaml\", ext: [\"yaml\", \"yml\"], alias: [\"yml\"]},",
          "169:     {name: \"Z80\", mime: \"text/x-z80\", mode: \"z80\", ext: [\"z80\"]},",
          "170:     {name: \"mscgen\", mime: \"text/x-mscgen\", mode: \"mscgen\", ext: [\"mscgen\", \"mscin\", \"msc\"]},",
          "171:     {name: \"xu\", mime: \"text/x-xu\", mode: \"mscgen\", ext: [\"xu\"]},",
          "172:     {name: \"msgenny\", mime: \"text/x-msgenny\", mode: \"mscgen\", ext: [\"msgenny\"]},",
          "173:     {name: \"WebAssembly\", mime: \"text/webassembly\", mode: \"wast\", ext: [\"wat\", \"wast\"]},",
          "174:   ];",
          "176:   for (var i = 0; i < CodeMirror.modeInfo.length; i++) {",
          "177:     var info = CodeMirror.modeInfo[i];",
          "178:     if (info.mimes) info.mime = info.mimes[0];",
          "179:   }",
          "181:   CodeMirror.findModeByMIME = function(mime) {",
          "182:     mime = mime.toLowerCase();",
          "183:     for (var i = 0; i < CodeMirror.modeInfo.length; i++) {",
          "184:       var info = CodeMirror.modeInfo[i];",
          "185:       if (info.mime == mime) return info;",
          "186:       if (info.mimes) for (var j = 0; j < info.mimes.length; j++)",
          "187:         if (info.mimes[j] == mime) return info;",
          "188:     }",
          "189:     if (/\\+xml$/.test(mime)) return CodeMirror.findModeByMIME(\"application/xml\")",
          "190:     if (/\\+json$/.test(mime)) return CodeMirror.findModeByMIME(\"application/json\")",
          "191:   };",
          "193:   CodeMirror.findModeByExtension = function(ext) {",
          "194:     ext = ext.toLowerCase();",
          "195:     for (var i = 0; i < CodeMirror.modeInfo.length; i++) {",
          "196:       var info = CodeMirror.modeInfo[i];",
          "197:       if (info.ext) for (var j = 0; j < info.ext.length; j++)",
          "198:         if (info.ext[j] == ext) return info;",
          "199:     }",
          "200:   };",
          "202:   CodeMirror.findModeByFileName = function(filename) {",
          "203:     for (var i = 0; i < CodeMirror.modeInfo.length; i++) {",
          "204:       var info = CodeMirror.modeInfo[i];",
          "205:       if (info.file && info.file.test(filename)) return info;",
          "206:     }",
          "207:     var dot = filename.lastIndexOf(\".\");",
          "208:     var ext = dot > -1 && filename.substring(dot + 1, filename.length);",
          "209:     if (ext) return CodeMirror.findModeByExtension(ext);",
          "210:   };",
          "212:   CodeMirror.findModeByName = function(name) {",
          "213:     name = name.toLowerCase();",
          "214:     for (var i = 0; i < CodeMirror.modeInfo.length; i++) {",
          "215:       var info = CodeMirror.modeInfo[i];",
          "216:       if (info.name.toLowerCase() == name) return info;",
          "217:       if (info.alias) for (var j = 0; j < info.alias.length; j++)",
          "218:         if (info.alias[j].toLowerCase() == name) return info;",
          "219:     }",
          "220:   };",
          "221: });",
          "",
          "---------------"
        ],
        "templates/webadmin/admins.html||templates/webadmin/admins.html": [
          "File: templates/webadmin/admins.html -> templates/webadmin/admins.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "194:         table.button().add(0,'edit');",
          "195:         table.button().add(0,'add');",
          "199:         table.on('select deselect', function () {",
          "200:             var selectedRows = table.rows({ selected: true }).count();",
          "",
          "[Removed Lines]",
          "197:         table.buttons().container().appendTo('#dataTable_wrapper .col-md-6:eq(0)');",
          "",
          "[Added Lines]",
          "197:         table.buttons().container().appendTo('.col-md-6:eq(0)', table.table().container());",
          "",
          "---------------"
        ],
        "templates/webadmin/connections.html||templates/webadmin/connections.html": [
          "File: templates/webadmin/connections.html -> templates/webadmin/connections.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "179:             table.button('disconnect:name').enable(selectedRows == 1);",
          "180:         });",
          "181:         {{end}}",
          "183:     });",
          "184: </script>",
          "185: {{end}}",
          "",
          "[Removed Lines]",
          "182:         table.buttons().container().appendTo('#dataTable_wrapper .col-md-6:eq(0)');",
          "",
          "[Added Lines]",
          "182:         table.buttons().container().appendTo('.col-md-6:eq(0)', table.table().container());",
          "",
          "---------------"
        ],
        "templates/webadmin/defender.html||templates/webadmin/defender.html": [
          "File: templates/webadmin/defender.html -> templates/webadmin/defender.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "194:                 {{end}}",
          "195:                 table.button().add(0, 'pageLength');",
          "196:                 table.button().add(0, 'refresh');",
          "198:             },",
          "199:             \"order\": [[2, 'desc'],[3,'desc']]",
          "200:         });",
          "",
          "[Removed Lines]",
          "197:                 table.buttons().container().appendTo('#dataTable_wrapper .col-md-6:eq(0)');",
          "",
          "[Added Lines]",
          "197:                 table.buttons().container().appendTo('.col-md-6:eq(0)', table.table().container());",
          "",
          "---------------"
        ],
        "templates/webadmin/folders.html||templates/webadmin/folders.html": [
          "File: templates/webadmin/folders.html -> templates/webadmin/folders.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "272:         table.button().add(0,'add');",
          "273:         {{end}}",
          "277:         table.on('select deselect', function () {",
          "278:             var selectedRows = table.rows({ selected: true }).count();",
          "",
          "[Removed Lines]",
          "275:         table.buttons().container().appendTo('#dataTable_wrapper .col-md-6:eq(0)');",
          "",
          "[Added Lines]",
          "275:         table.buttons().container().appendTo('.col-md-6:eq(0)', table.table().container());",
          "",
          "---------------"
        ],
        "templates/webadmin/users.html||templates/webadmin/users.html": [
          "File: templates/webadmin/users.html -> templates/webadmin/users.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "297:         table.button().add(0,'add');",
          "298:         {{end}}",
          "302:         table.on('select deselect', function () {",
          "303:             var selectedRows = table.rows({ selected: true }).count();",
          "",
          "[Removed Lines]",
          "300:         table.buttons().container().appendTo('#dataTable_wrapper .col-md-6:eq(0)');",
          "",
          "[Added Lines]",
          "300:         table.buttons().container().appendTo('.col-md-6:eq(0)', table.table().container());",
          "",
          "---------------"
        ],
        "templates/webclient/base.html||templates/webclient/base.html": [
          "File: templates/webclient/base.html -> templates/webclient/base.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "120:                     <!-- Topbar Navbar -->",
          "121:                     <ul class=\"navbar-nav ml-auto\">",
          "123:                         <!-- Nav Item - User Information -->",
          "124:                         <li class=\"nav-item dropdown no-arrow\">",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "122:                         {{block \"additionalnavitems\" .}}{{end}}",
          "",
          "---------------"
        ],
        "templates/webclient/editfile.html||templates/webclient/editfile.html": [
          "File: templates/webclient/editfile.html -> templates/webclient/editfile.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: {{template \"base\" .}}",
          "3: {{define \"title\"}}{{.Title}}{{end}}",
          "5: {{define \"extra_css\"}}",
          "6: <link href=\"{{.StaticURL}}/vendor/codemirror/codemirror.css\" rel=\"stylesheet\">",
          "7: <link href=\"{{.StaticURL}}/vendor/codemirror/addon/dialog/dialog.css\" rel=\"stylesheet\">",
          "8: <link href=\"{{.StaticURL}}/vendor/codemirror/addon/search/matchesonscrollbar.css\" rel=\"stylesheet\">",
          "9: <style>",
          "10:     .CodeMirror {",
          "11:         border: 1px solid #eee;",
          "12:         height: 30em;",
          "13:         font-size: 13px;",
          "14:     }",
          "15:     .shortcut {font-family: monospace; color: #666;}",
          "16: </style>",
          "17: {{end}}",
          "18: {{define \"additionalnavitems\"}}",
          "19: <li class=\"nav-item dropdown no-arrow mx-1\">",
          "20:     <a class=\"nav-link dropdown-toggle\" href=\"#\" id=\"editorDropdown\" role=\"button\"",
          "21:         data-toggle=\"modal\" data-target=\"#infoModal\">",
          "22:         <i class=\"fas fa-info fa-fw\"></i>",
          "23:     </a>",
          "24: </li>",
          "26: <div class=\"topbar-divider d-none d-sm-block\"></div>",
          "27: {{end}}",
          "29: {{define \"page_body\"}}",
          "30: <div id=\"errorMsg\" class=\"card mb-4 border-left-warning\" style=\"display: none;\">",
          "31:     <div id=\"errorTxt\" class=\"card-body text-form-error\"></div>",
          "32: </div>",
          "33: <div class=\"card shadow mb-4\">",
          "34:     <div class=\"card-header\">",
          "35:         <h6 class=\"d-flex justify-content-between align-items-center\">",
          "36:             <span class=\"font-weight-bold text-primary\">Edit file \"{{.Path}}\"</span>",
          "37:             <span class=\"btn-toolbar\">",
          "38:                 <a id=\"idBack\" class=\"btn btn-secondary mx-1 my-1\" href='{{.FilesURL}}?path={{.CurrentDir}}' role=\"button\">Back</a>",
          "39:                 <a id=\"idSave\" class=\"btn btn-primary mx-1 my-1\" href=\"#\" onclick=\"saveFile()\" role=\"button\">Save</a>",
          "40:             </span>",
          "41:         </h6>",
          "42:     </div>",
          "43:     <div class=\"card-body\">",
          "44:         <div class=\"col-sm-12\">",
          "45:             <textarea id=\"editor\" name=\"editor\"></textarea>",
          "46:         </div>",
          "47:     </div>",
          "48: </div>",
          "49: {{end}}",
          "51: {{define \"dialog\"}}",
          "52: <div class=\"modal fade\" id=\"infoModal\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"infoModalLabel\"",
          "53:     aria-hidden=\"true\">",
          "54:     <div class=\"modal-dialog\" role=\"document\">",
          "55:         <div class=\"modal-content\">",
          "56:             <div class=\"modal-header\">",
          "57:                 <h5 class=\"modal-title\" id=\"infoModalLabel\">",
          "58:                     Editor keybindings",
          "59:                 </h5>",
          "60:                 <button class=\"close\" type=\"button\" data-dismiss=\"modal\" aria-label=\"Close\">",
          "61:                     <span aria-hidden=\"true\">&times;</span>",
          "62:                 </button>",
          "63:             </div>",
          "64:             <div class=\"modal-body\">",
          "65:                 <p>",
          "66:                     <span class=\"shortcut\">Ctrl-F / Cmd-F</span> => Start searching",
          "67:                 </p>",
          "68:                 <p>",
          "69:                     <span class=\"shortcut\">Ctrl-G / Cmd-G</span> => Find next",
          "70:                 </p>",
          "71:                 <p>",
          "72:                     <span class=\"shortcut\">Shift-Ctrl-G / Shift-Cmd-G</span> => Find previous",
          "73:                 </p>",
          "74:                 <p>",
          "75:                     <span class=\"shortcut\">Shift-Ctrl-F / Cmd-Option-F</span> => Replace",
          "76:                 </p>",
          "77:                 <p>",
          "78:                     <span class=\"shortcut\">Shift-Ctrl-R / Shift-Cmd-Option-F</span> => Replace all",
          "79:                 </p>",
          "80:                 <p>",
          "81:                     <span class=\"shortcut\">Alt-G</span> => Jump to line",
          "82:                 </p>",
          "83:                 <p>",
          "84:                     <span class=\"shortcut\">Alt-F</span> => Persistent search: enter to find next, Shift-Enter to find previous",
          "85:                 </p>",
          "86:             </div>",
          "87:             <div class=\"modal-footer\">",
          "88:                 <button class=\"btn btn-primary\" type=\"button\" data-dismiss=\"modal\">OK</button>",
          "89:             </div>",
          "90:         </div>",
          "91:     </div>",
          "92: </div>",
          "93: {{end}}",
          "95: {{define \"extra_js\"}}",
          "96: <script src=\"{{.StaticURL}}/vendor/codemirror/codemirror.js\"></script>",
          "97: <script src=\"{{.StaticURL}}/vendor/codemirror/meta.js\"></script>",
          "98: <script src=\"{{.StaticURL}}/vendor/codemirror/addon/selection/active-line.js\"></script>",
          "99: <script src=\"{{.StaticURL}}/vendor/codemirror/addon/dialog/dialog.js\"></script>",
          "100: <script src=\"{{.StaticURL}}/vendor/codemirror/addon/search/searchcursor.js\"></script>",
          "101: <script src=\"{{.StaticURL}}/vendor/codemirror/addon/search/search.js\"></script>",
          "102: <script src=\"{{.StaticURL}}/vendor/codemirror/addon/search/matchesonscrollbar.js\"></script>",
          "103: <script src=\"{{.StaticURL}}/vendor/codemirror/addon/search/jump-to-line.js\"></script>",
          "104: <script type=\"text/javascript\">",
          "105:     $(document).ready(function () {",
          "106:         var cm = CodeMirror.fromTextArea(document.getElementById(\"editor\"), {",
          "107:             lineNumbers: true,",
          "108:             styleActiveLine: true,",
          "109:             extraKeys: {\"Alt-F\": \"findPersistent\"},",
          "110:             autofocus: true",
          "111:         });",
          "112:         var filename = \"{{.Path}}\";",
          "113:         var extension = filename.slice((filename.lastIndexOf(\".\") - 1 >>> 0) + 2).toLowerCase();",
          "114:         mode = CodeMirror.findModeByExtension(extension);",
          "115:         if (mode != null) {",
          "116:             cm.setOption(\"mode\", mode.mode);",
          "117:         }",
          "118:         cm.setValue(\"{{.Data}}\");",
          "119:         setInterval(keepAlive, 90000);",
          "120:     });",
          "122:     function keepAlive() {",
          "123:         $.ajax({",
          "124:             url: '{{.ProfileURL}}',",
          "125:             timeout: 15000",
          "126:         });",
          "127:     }",
          "129:     function saveFile() {",
          "130:         $('#idSave').addClass(\"disabled\");",
          "131:         cm =  document.querySelector('.CodeMirror').CodeMirror;",
          "132:         var path = '{{.FilesURL}}?path={{.CurrentDir}}';",
          "133:         var data = new FormData();",
          "134:         var blob = new Blob([cm.getValue()]);",
          "135:         data.append(\"filename\", new File([blob], \"{{.Name}}\"));",
          "137:         $.ajax({",
          "138:                 url: path,",
          "139:                 type: 'POST',",
          "140:                 data: data,",
          "141:                 processData: false,",
          "142:                 contentType: false,",
          "143:                 headers: { 'X-CSRF-TOKEN': '{{.CSRFToken}}' },",
          "144:                 timeout: 15000,",
          "145:                 success: function (result) {",
          "146:                     window.location.href = '{{.FilesURL}}?path={{.CurrentDir}}';",
          "147:                 },",
          "148:                 error: function ($xhr, textStatus, errorThrown) {",
          "149:                     $('#idSave').removeClass(\"disabled\");",
          "150:                     var txt = \"Error saving file\";",
          "151:                     if ($xhr) {",
          "152:                         var json = $xhr.responseJSON;",
          "153:                         if (json) {",
          "154:                             if (json.message) {",
          "155:                                 txt = json.message;",
          "156:                             }",
          "157:                             if (json.error) {",
          "158:                                 txt += \": \" + json.error;",
          "159:                             }",
          "160:                         }",
          "161:                     }",
          "162:                     $('#errorTxt').text(txt);",
          "163:                     $('#errorMsg').show();",
          "164:                     setTimeout(function () {",
          "165:                         $('#errorMsg').hide();",
          "166:                     }, 5000);",
          "167:                 }",
          "168:             });",
          "169:     }",
          "170: </script>",
          "171: {{end}}",
          "",
          "---------------"
        ],
        "templates/webclient/files.html||templates/webclient/files.html": [
          "File: templates/webclient/files.html -> templates/webclient/files.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "40:                         <th>Name</th>",
          "41:                         <th>Size</th>",
          "42:                         <th>Last modified</th>",
          "43:                     </tr>",
          "44:                 </thead>",
          "45:             </table>",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "43:                         <th></th>",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "49: {{end}}",
          "51: {{define \"dialog\"}}",
          "53:     aria-hidden=\"true\">",
          "54:     <div class=\"modal-dialog\" role=\"document\">",
          "55:         <div class=\"modal-content\">",
          "56:             <div class=\"modal-header\">",
          "58:                     Create a new directory",
          "59:                 </h5>",
          "60:                 <button class=\"close\" type=\"button\" data-dismiss=\"modal\" aria-label=\"Close\">",
          "",
          "[Removed Lines]",
          "52: <div class=\"modal fade\" id=\"createDirModal\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"deleteModalLabel\"",
          "57:                 <h5 class=\"modal-title\" id=\"deleteModalLabel\">",
          "",
          "[Added Lines]",
          "53: <div class=\"modal fade\" id=\"createDirModal\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"createDirModalLabel\"",
          "58:                 <h5 class=\"modal-title\" id=\"createDirModalLabel\">",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "169: <script src=\"{{.StaticURL}}/vendor/datatables/dataTables.responsive.min.js\"></script>",
          "170: <script src=\"{{.StaticURL}}/vendor/datatables/responsive.bootstrap4.min.js\"></script>",
          "171: <script src=\"{{.StaticURL}}/vendor/datatables/dataTables.checkboxes.min.js\"></script>",
          "172: <script type=\"text/javascript\">",
          "174:     function getIconForFile(filename) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "173: {{if .CanAddFiles}}",
          "174: <script src=\"{{.StaticURL}}/vendor/codemirror/codemirror.js\"></script>",
          "175: <script src=\"{{.StaticURL}}/vendor/codemirror/meta.js\"></script>",
          "176: {{end}}",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "271:         }",
          "272:     }",
          "276:     }",
          "280:     }",
          "282:     function deleteAction() {",
          "283:         var table = $('#dataTable').DataTable();",
          "284:         table.button('delete:name').enable(false);",
          "285:         var selected = table.column(0).checkboxes.selected()[0];",
          "288:         var path;",
          "289:         if (itemType == \"1\"){",
          "290:             path = '{{.DirsURL}}';",
          "",
          "[Removed Lines]",
          "274:     function getNameFromTypeName(typeName) {",
          "275:         return typeName.split('_').slice(1).join('_');",
          "278:     function getTypeFromTypeName(typeName) {",
          "279:         return typeName.split('_')[0];",
          "286:         var itemType = getTypeFromTypeName(selected);",
          "287:         var itemName = getNameFromTypeName(selected);",
          "",
          "[Added Lines]",
          "279:     function getNameFromMeta(meta) {",
          "280:         return meta.split('_').slice(1).join('_');",
          "283:     function getTypeFromMeta(meta) {",
          "284:         return meta.split('_')[0];",
          "291:         var itemType = getTypeFromMeta(selected);",
          "292:         var itemName = getNameFromMeta(selected);",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "403:             var table = $('#dataTable').DataTable();",
          "404:             table.button('rename:name').enable(false);",
          "405:             var selected = table.column(0).checkboxes.selected()[0];",
          "408:             var targetName = replaceSlash($(\"#rename_new_name\").val());",
          "409:             var path;",
          "410:             if (itemType == \"1\"){",
          "",
          "[Removed Lines]",
          "406:             var itemType = getTypeFromTypeName(selected);",
          "407:             var itemName = getNameFromTypeName(selected);",
          "",
          "[Added Lines]",
          "411:             var itemType = getTypeFromMeta(selected);",
          "412:             var itemName = getNameFromMeta(selected);",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "462:                 var filesArray = [];",
          "463:                 var selected = dt.column(0).checkboxes.selected();",
          "464:                 for (i = 0; i < selected.length; i++) {",
          "466:                 }",
          "467:                 var files = fixedEncodeURIComponent(JSON.stringify(filesArray));",
          "468:                 var downloadURL = '{{.DownloadURL}}';",
          "",
          "[Removed Lines]",
          "465:                     filesArray.push(getNameFromTypeName(selected[i]));",
          "",
          "[Added Lines]",
          "470:                     filesArray.push(getNameFromMeta(selected[i]));",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "495:         };",
          "497:         $.fn.dataTable.ext.buttons.rename = {",
          "499:             name: 'rename',",
          "500:             titleAttr: \"Rename\",",
          "501:             action: function (e, dt, node, config) {",
          "502:                 var selected = table.column(0).checkboxes.selected()[0];",
          "504:                 $(\"#rename_old_name\").val(itemName);",
          "505:                 $(\"#rename_new_name\").val(\"\");",
          "506:                 $('#renameModal').modal('show');",
          "",
          "[Removed Lines]",
          "498:             text: '<i class=\"fas fa-edit\"></i>',",
          "503:                 var itemName = getNameFromTypeName(selected);",
          "",
          "[Added Lines]",
          "503:             text: '<i class=\"fas fa-pen\"></i>',",
          "508:                 var itemName = getNameFromMeta(selected);",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "545:             \"deferRender\": true,",
          "546:             \"processing\": true,",
          "547:             \"columns\": [",
          "549:                 { \"data\": \"type\" },",
          "550:                 {",
          "551:                     \"data\": \"name\",",
          "",
          "[Removed Lines]",
          "548:                 { \"data\": \"type_name\" },",
          "",
          "[Added Lines]",
          "553:                 { \"data\": \"meta\" },",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "564:                     }",
          "565:                 },",
          "566:                 { \"data\": \"size\" },",
          "568:             ],",
          "569:             \"buttons\": [],",
          "570:             \"lengthChange\": false,",
          "",
          "[Removed Lines]",
          "567:                 { \"data\": \"last_modified\" }",
          "",
          "[Added Lines]",
          "572:                 { \"data\": \"last_modified\" },",
          "573:                 { \"data\": \"edit_url\",",
          "574:                     \"render\": function (data, type, row) {",
          "575:                         if (type === 'display') {",
          "576:                             {{if .CanAddFiles}}",
          "577:                             if (data != \"\"){",
          "578:                                 var filename = row[\"name\"];",
          "579:                                 var extension = filename.slice((filename.lastIndexOf(\".\") - 1 >>> 0) + 2).toLowerCase();",
          "580:                                 if (extension == \"csv\" || extension == \"bat\" || CodeMirror.findModeByExtension(extension) != null){",
          "581:                                     return `<a href=\"${data}\"><i class=\"fas fa-edit\"></i></a>`;",
          "582:                                 }",
          "583:                             }",
          "584:                             {{end}}",
          "585:                         }",
          "586:                         return \"\";",
          "587:                     }",
          "588:                 }",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "602:                 {",
          "603:                     \"targets\": [3, 4],",
          "604:                     \"searchable\": false",
          "605:                 }",
          "606:             ],",
          "607:             \"scrollX\": false,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "626:                 },",
          "627:                 {",
          "628:                     \"targets\": [5],",
          "629:                     \"orderable\": false,",
          "630:                     \"searchable\": false",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "630:                 {{if .CanAddFiles}}",
          "631:                 table.button().add(0, 'addFiles');",
          "632:                 {{end}}",
          "634:             },",
          "635:             \"orderFixed\": [1, 'asc'],",
          "636:             \"order\": [[2, 'asc']]",
          "",
          "[Removed Lines]",
          "633:                 table.buttons().container().appendTo('#dataTable_wrapper .col-md-6:eq(0)');",
          "",
          "[Added Lines]",
          "659:                 table.buttons().container().appendTo('.col-md-6:eq(0)', table.table().container());",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "0bb141960f832034d9386766fe6554448e1ab682",
      "candidate_info": {
        "commit_hash": "0bb141960f832034d9386766fe6554448e1ab682",
        "repo": "drakkan/sftpgo",
        "commit_url": "https://github.com/drakkan/sftpgo/commit/0bb141960f832034d9386766fe6554448e1ab682",
        "files": [
          "README.md",
          "common/connection.go",
          "dataprovider/dataprovider.go",
          "dataprovider/user.go",
          "go.mod",
          "go.sum",
          "httpd/httpd_test.go",
          "httpd/webadmin.go",
          "httpdtest/httpdtest.go",
          "openapi/openapi.yaml",
          "sdk/user.go",
          "templates/webadmin/admins.html",
          "templates/webadmin/folders.html",
          "templates/webadmin/user.html",
          "templates/webadmin/users.html",
          "templates/webclient/files.html",
          "util/util.go",
          "webdavd/internal_test.go"
        ],
        "message": "add support for different bandwidth limits based on client IP",
        "before_after_code_files": [
          "common/connection.go||common/connection.go",
          "dataprovider/dataprovider.go||dataprovider/dataprovider.go",
          "dataprovider/user.go||dataprovider/user.go",
          "go.mod||go.mod",
          "go.sum||go.sum",
          "httpd/httpd_test.go||httpd/httpd_test.go",
          "httpd/webadmin.go||httpd/webadmin.go",
          "httpdtest/httpdtest.go||httpdtest/httpdtest.go",
          "sdk/user.go||sdk/user.go",
          "templates/webadmin/admins.html||templates/webadmin/admins.html",
          "templates/webadmin/folders.html||templates/webadmin/folders.html",
          "templates/webadmin/user.html||templates/webadmin/user.html",
          "templates/webadmin/users.html||templates/webadmin/users.html",
          "templates/webclient/files.html||templates/webclient/files.html",
          "util/util.go||util/util.go",
          "webdavd/internal_test.go||webdavd/internal_test.go"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "templates/webclient/files.html||templates/webclient/files.html"
          ],
          "candidate": [
            "templates/webclient/files.html||templates/webclient/files.html"
          ]
        }
      },
      "candidate_diff": {
        "common/connection.go||common/connection.go": [
          "File: common/connection.go -> common/connection.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "47:  if util.IsStringInSlice(protocol, supportedProtocols) {",
          "48:   connID = fmt.Sprintf(\"%v_%v\", protocol, id)",
          "49:  }",
          "50:  return &BaseConnection{",
          "51:   ID:           connID,",
          "52:   User:         user,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "50:  user.UploadBandwidth, user.DownloadBandwidth = user.GetBandwidthForIP(util.GetIPFromRemoteAddress(remoteAddr), connID)",
          "",
          "---------------"
        ],
        "dataprovider/dataprovider.go||dataprovider/dataprovider.go": [
          "File: dataprovider/dataprovider.go -> dataprovider/dataprovider.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "1619:  }",
          "1620: }",
          "1624:  user.Filters.DeniedIP = util.RemoveDuplicates(user.Filters.DeniedIP)",
          "1625:  for _, IPMask := range user.Filters.DeniedIP {",
          "1626:   _, _, err := net.ParseCIDR(IPMask)",
          "1627:   if err != nil {",
          "1629:   }",
          "1630:  }",
          "1631:  user.Filters.AllowedIP = util.RemoveDuplicates(user.Filters.AllowedIP)",
          "1632:  for _, IPMask := range user.Filters.AllowedIP {",
          "1633:   _, _, err := net.ParseCIDR(IPMask)",
          "1634:   if err != nil {",
          "1636:   }",
          "1637:  }",
          "1638:  user.Filters.DeniedLoginMethods = util.RemoveDuplicates(user.Filters.DeniedLoginMethods)",
          "1639:  if len(user.Filters.DeniedLoginMethods) >= len(ValidLoginMethods) {",
          "1640:   return util.NewValidationError(\"invalid denied_login_methods\")",
          "",
          "[Removed Lines]",
          "1622: func validateFilters(user *User) error {",
          "1623:  checkEmptyFiltersStruct(user)",
          "1628:    return util.NewValidationError(fmt.Sprintf(\"could not parse denied IP/Mask %#v : %v\", IPMask, err))",
          "1635:    return util.NewValidationError(fmt.Sprintf(\"could not parse allowed IP/Mask %#v : %v\", IPMask, err))",
          "",
          "[Added Lines]",
          "1622: func validateIPFilters(user *User) error {",
          "1627:    return util.NewValidationError(fmt.Sprintf(\"could not parse denied IP/Mask %#v: %v\", IPMask, err))",
          "1634:    return util.NewValidationError(fmt.Sprintf(\"could not parse allowed IP/Mask %#v: %v\", IPMask, err))",
          "1637:  return nil",
          "1638: }",
          "1640: func validateBandwidthLimitFilters(user *User) error {",
          "1641:  for idx, bandwidthLimit := range user.Filters.BandwidthLimits {",
          "1642:   user.Filters.BandwidthLimits[idx].Sources = util.RemoveDuplicates(bandwidthLimit.Sources)",
          "1643:   if err := bandwidthLimit.Validate(); err != nil {",
          "1644:    return err",
          "1645:   }",
          "1646:   if bandwidthLimit.DownloadBandwidth < 0 {",
          "1647:    user.Filters.BandwidthLimits[idx].DownloadBandwidth = 0",
          "1648:   }",
          "1649:   if bandwidthLimit.UploadBandwidth < 0 {",
          "1650:    user.Filters.BandwidthLimits[idx].UploadBandwidth = 0",
          "1651:   }",
          "1652:  }",
          "1653:  return nil",
          "1654: }",
          "1656: func validateFilters(user *User) error {",
          "1657:  checkEmptyFiltersStruct(user)",
          "1658:  if err := validateIPFilters(user); err != nil {",
          "1659:   return err",
          "1660:  }",
          "1661:  if err := validateBandwidthLimitFilters(user); err != nil {",
          "1662:   return err",
          "1663:  }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1728:  if !filepath.IsAbs(user.HomeDir) {",
          "1729:   return util.NewValidationError(fmt.Sprintf(\"home_dir must be an absolute path, actual value: %v\", user.HomeDir))",
          "1730:  }",
          "1731:  return nil",
          "1732: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1758:  if user.DownloadBandwidth < 0 {",
          "1759:   user.DownloadBandwidth = 0",
          "1760:  }",
          "1761:  if user.UploadBandwidth < 0 {",
          "1762:   user.UploadBandwidth = 0",
          "1763:  }",
          "",
          "---------------"
        ],
        "dataprovider/user.go||dataprovider/user.go": [
          "File: dataprovider/user.go -> dataprovider/user.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "883:  return base64.StdEncoding.EncodeToString(signature[:])",
          "884: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "887: func (u *User) GetBandwidthForIP(clientIP, connectionID string) (int64, int64) {",
          "888:  if len(u.Filters.BandwidthLimits) > 0 {",
          "889:   ip := net.ParseIP(clientIP)",
          "890:   if ip != nil {",
          "891:    for _, bwLimit := range u.Filters.BandwidthLimits {",
          "892:     for _, source := range bwLimit.Sources {",
          "893:      _, ipNet, err := net.ParseCIDR(source)",
          "894:      if err == nil {",
          "895:       if ipNet.Contains(ip) {",
          "896:        logger.Debug(logSender, connectionID, \"override bandwidth limit for ip %#v, upload limit: %v KB/s, download limit: %v KB/s\",",
          "897:         clientIP, bwLimit.UploadBandwidth, bwLimit.DownloadBandwidth)",
          "898:        return bwLimit.UploadBandwidth, bwLimit.DownloadBandwidth",
          "899:       }",
          "900:      }",
          "901:     }",
          "902:    }",
          "903:   }",
          "904:  }",
          "905:  return u.UploadBandwidth, u.DownloadBandwidth",
          "906: }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1150:  filters.AllowAPIKeyAuth = u.Filters.AllowAPIKeyAuth",
          "1151:  filters.WebClient = make([]string, len(u.Filters.WebClient))",
          "1152:  copy(filters.WebClient, u.Filters.WebClient)",
          "1154:  for _, code := range u.Filters.RecoveryCodes {",
          "1155:   if code.Secret == nil {",
          "1156:    code.Secret = kms.NewEmptySecret()",
          "",
          "[Removed Lines]",
          "1153:  filters.RecoveryCodes = make([]sdk.RecoveryCode, 0)",
          "",
          "[Added Lines]",
          "1175:  filters.RecoveryCodes = make([]sdk.RecoveryCode, 0, len(u.Filters.RecoveryCodes))",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1160:    Used:   code.Used,",
          "1161:   })",
          "1162:  }",
          "1164:  return User{",
          "1165:   BaseUser: sdk.BaseUser{",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1185:  filters.BandwidthLimits = make([]sdk.BandwidthLimit, 0, len(u.Filters.BandwidthLimits))",
          "1186:  for _, limit := range u.Filters.BandwidthLimits {",
          "1187:   bwLimit := sdk.BandwidthLimit{",
          "1188:    UploadBandwidth:   limit.UploadBandwidth,",
          "1189:    DownloadBandwidth: limit.DownloadBandwidth,",
          "1190:    Sources:           make([]string, 0, len(limit.Sources)),",
          "1191:   }",
          "1192:   bwLimit.Sources = make([]string, len(limit.Sources))",
          "1193:   copy(bwLimit.Sources, limit.Sources)",
          "1194:   filters.BandwidthLimits = append(filters.BandwidthLimits, bwLimit)",
          "1195:  }",
          "",
          "---------------"
        ],
        "go.mod||go.mod": [
          "File: go.mod -> go.mod",
          "--- Hunk 1 ---",
          "[Context before]",
          "7:  github.com/Azure/azure-storage-blob-go v0.14.0",
          "8:  github.com/GehirnInc/crypt v0.0.0-20200316065508-bb7000b8a962",
          "9:  github.com/alexedwards/argon2id v0.0.0-20211130144151-3585854a6387",
          "12:  github.com/eikenb/pipeat v0.0.0-20210603033007-44fc3ffce52b",
          "13:  github.com/fclairamb/ftpserverlib v0.16.0",
          "14:  github.com/fclairamb/go-log v0.1.0",
          "",
          "[Removed Lines]",
          "10:  github.com/aws/aws-sdk-go v1.42.20",
          "11:  github.com/cockroachdb/cockroach-go/v2 v2.2.4",
          "",
          "[Added Lines]",
          "10:  github.com/aws/aws-sdk-go v1.42.22",
          "11:  github.com/cockroachdb/cockroach-go/v2 v2.2.5",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "52:  go.uber.org/automaxprocs v1.4.0",
          "53:  gocloud.dev v0.24.0",
          "54:  golang.org/x/crypto v0.0.0-20211202192323-5770296d904e",
          "57:  golang.org/x/time v0.0.0-20211116232009-f0f3c7e86c11",
          "59:  google.golang.org/grpc v1.42.0",
          "60:  google.golang.org/protobuf v1.27.1",
          "61:  gopkg.in/natefinch/lumberjack.v2 v2.0.0",
          "",
          "[Removed Lines]",
          "55:  golang.org/x/net v0.0.0-20211201190559-0a0e4e1bb54c",
          "56:  golang.org/x/sys v0.0.0-20211205182925-97ca703d548d",
          "58:  google.golang.org/api v0.61.0",
          "",
          "[Added Lines]",
          "55:  golang.org/x/net v0.0.0-20211209124913-491a49abca63",
          "56:  golang.org/x/sys v0.0.0-20211210111614-af8b64212486",
          "58:  google.golang.org/api v0.62.0",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "129:  golang.org/x/text v0.3.7 // indirect",
          "130:  golang.org/x/xerrors v0.0.0-20200804184101-5ec99f83aff1 // indirect",
          "131:  google.golang.org/appengine v1.6.7 // indirect",
          "133:  gopkg.in/ini.v1 v1.66.2 // indirect",
          "134:  gopkg.in/yaml.v2 v2.4.0 // indirect",
          "135:  gopkg.in/yaml.v3 v3.0.0-20210107192922-496545a6307b // indirect",
          "",
          "[Removed Lines]",
          "132:  google.golang.org/genproto v0.0.0-20211207154714-918901c715cf // indirect",
          "",
          "[Added Lines]",
          "132:  google.golang.org/genproto v0.0.0-20211208223120-3a66f561d7aa // indirect",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "140:  github.com/fclairamb/ftpserverlib => github.com/drakkan/ftpserverlib v0.0.0-20211107071448-34ff70e85dfb",
          "141:  github.com/jlaffaye/ftp => github.com/drakkan/ftp v0.0.0-20201114075148-9b9adce499a9",
          "142:  golang.org/x/crypto => github.com/drakkan/crypto v0.0.0-20211203175531-87c7ca02d2a9",
          "144: )",
          "",
          "[Removed Lines]",
          "143:  golang.org/x/net => github.com/drakkan/net v0.0.0-20211203175337-bdbe03411e23",
          "",
          "[Added Lines]",
          "143:  golang.org/x/net => github.com/drakkan/net v0.0.0-20211210172952-3f0f9446f73f",
          "",
          "---------------"
        ],
        "go.sum||go.sum": [
          "File: go.sum -> go.sum",
          "--- Hunk 1 ---",
          "[Context before]",
          "33: cloud.google.com/go v0.94.0/go.mod h1:qAlAugsXlC+JWO+Bke5vCtc9ONxjQT3drlTTnAplMW4=",
          "34: cloud.google.com/go v0.94.1/go.mod h1:qAlAugsXlC+JWO+Bke5vCtc9ONxjQT3drlTTnAplMW4=",
          "35: cloud.google.com/go v0.97.0/go.mod h1:GF7l59pYBVlXQIBLx3a761cZ41F9bBH3JUlihCt2Udc=",
          "36: cloud.google.com/go v0.99.0 h1:y/cM2iqGgGi5D5DQZl6D9STN/3dR/Vx5Mp8s752oJTY=",
          "37: cloud.google.com/go v0.99.0/go.mod h1:w0Xx2nLzqWJPuozYQX+hFfCSI8WioryfRDzkoI/Y2ZA=",
          "38: cloud.google.com/go/bigquery v1.0.1/go.mod h1:i/xbL2UlR5RvWAURpBYZTtm/cXjCha9lbfbpx4poX+o=",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "36: cloud.google.com/go v0.98.0/go.mod h1:ua6Ush4NALrHk5QXDWnjvZHN93OuF0HfuEPq9I1X0cM=",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "136: github.com/aws/aws-sdk-go v1.37.0/go.mod h1:hcU610XS61/+aQV88ixoOzUoG7v3b31pl2zKMmprdro=",
          "137: github.com/aws/aws-sdk-go v1.38.68/go.mod h1:hcU610XS61/+aQV88ixoOzUoG7v3b31pl2zKMmprdro=",
          "138: github.com/aws/aws-sdk-go v1.40.34/go.mod h1:585smgzpB/KqRA+K3y/NL/oYRqQvpNJYvLm+LY1U59Q=",
          "141: github.com/aws/aws-sdk-go-v2 v1.7.0/go.mod h1:tb9wi5s61kTDA5qCkcDbt3KRVV74GGslQkl/DRdX/P4=",
          "142: github.com/aws/aws-sdk-go-v2 v1.9.0/go.mod h1:cK/D0BBs0b/oWPIcX/Z/obahJK1TT7IPVjy53i/mX/4=",
          "143: github.com/aws/aws-sdk-go-v2/config v1.7.0/go.mod h1:w9+nMZ7soXCe5nT46Ri354SNhXDQ6v+V5wqDjnZE+GY=",
          "",
          "[Removed Lines]",
          "139: github.com/aws/aws-sdk-go v1.42.20 h1:nQkkmTWK5N2Ao1iVzoOx1HTIxwbSWErxyZ1eiwLJWc4=",
          "140: github.com/aws/aws-sdk-go v1.42.20/go.mod h1:585smgzpB/KqRA+K3y/NL/oYRqQvpNJYvLm+LY1U59Q=",
          "",
          "[Added Lines]",
          "140: github.com/aws/aws-sdk-go v1.42.22 h1:EwcM7/+Ytg6xK+jbeM2+f9OELHqPiEiEKetT/GgAr7I=",
          "141: github.com/aws/aws-sdk-go v1.42.22/go.mod h1:585smgzpB/KqRA+K3y/NL/oYRqQvpNJYvLm+LY1U59Q=",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "192: github.com/cncf/xds/go v0.0.0-20211130200136-a8f946100490 h1:KwaoQzs/WeUxxJqiJsZ4euOly1Az/IgZXXSxlD/UBNk=",
          "193: github.com/cncf/xds/go v0.0.0-20211130200136-a8f946100490/go.mod h1:eXthEFrGJvWHgFFCl3hGmgk+/aYT6PnTQLykKQRLhEs=",
          "194: github.com/cockroachdb/apd v1.1.0/go.mod h1:8Sl8LxpKi29FqWXR16WEFZRNSz3SoPzUzeMeY4+DwBQ=",
          "197: github.com/codahale/hdrhistogram v0.0.0-20161010025455-3a0bb77429bd/go.mod h1:sE/e/2PUdi/liOCUjSTXgM1o87ZssimdTWN964YiIeI=",
          "198: github.com/coreos/go-semver v0.3.0/go.mod h1:nnelYz7RCh+5ahJtPPxZlU+153eP4D4r3EedlOD2RNk=",
          "199: github.com/coreos/go-systemd v0.0.0-20190321100706-95778dfbb74e/go.mod h1:F5haX7vjVVG0kc13fIWeqUViNPyEJxv/OmvnBo0Yme4=",
          "",
          "[Removed Lines]",
          "195: github.com/cockroachdb/cockroach-go/v2 v2.2.4 h1:VuiBJKut2Imgrzl+TNk+U5+GxLOh3hnIFxU0EzjTCnI=",
          "196: github.com/cockroachdb/cockroach-go/v2 v2.2.4/go.mod h1:u3MiKYGupPPjkn3ozknpMUpxPaNLTFWAya419/zv6eI=",
          "",
          "[Added Lines]",
          "196: github.com/cockroachdb/cockroach-go/v2 v2.2.5 h1:tfPdGHO5YpmrpN2ikJZYpaSGgU8WALwwjH3s+msiTQ0=",
          "197: github.com/cockroachdb/cockroach-go/v2 v2.2.5/go.mod h1:q4ZRgO6CQpwNyEvEwSxwNrOSVchsmzrBnAv3HuZ3Abc=",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "224: github.com/drakkan/ftp v0.0.0-20201114075148-9b9adce499a9/go.mod h1:2lmrmq866uF2tnje75wQHzmPXhmSWUt7Gyx2vgK1RCU=",
          "225: github.com/drakkan/ftpserverlib v0.0.0-20211107071448-34ff70e85dfb h1:cT/w4XStm7m022JgVqmrXZLcZ4UjoUER1VW5/5gd6ec=",
          "226: github.com/drakkan/ftpserverlib v0.0.0-20211107071448-34ff70e85dfb/go.mod h1:fBiQ19WDhtvKArMu0Pifg71k+0xqRYn+F0d9AsjkZw8=",
          "229: github.com/drakkan/pipeat v0.0.0-20210805162858-70e57fa8a639 h1:8tfGdb4kg/YCvAbIrsMazgoNtnqdOqQVDKW12uUCuuU=",
          "230: github.com/drakkan/pipeat v0.0.0-20210805162858-70e57fa8a639/go.mod h1:kltMsfRMTHSFdMbK66XdS8mfMW77+FZA1fGY1xYMF84=",
          "231: github.com/dustin/go-humanize v1.0.0/go.mod h1:HtrtbFcZ19U5GC7JDqmcUSB87Iq5E25KnS6fMYU6eOk=",
          "",
          "[Removed Lines]",
          "227: github.com/drakkan/net v0.0.0-20211203175337-bdbe03411e23 h1:Ocx33vj+hqabIb/Adh03t4OWIB589lVpWvOODTADbBc=",
          "228: github.com/drakkan/net v0.0.0-20211203175337-bdbe03411e23/go.mod h1:9nx3DQGgdP8bBQD5qxJ1jj9UTztislL4KSBs9R2vV5Y=",
          "",
          "[Added Lines]",
          "228: github.com/drakkan/net v0.0.0-20211210172952-3f0f9446f73f h1:8XuTk84FMb6DGc5MxmPkswjO5m4XFqGoZomO/Q8CUwQ=",
          "229: github.com/drakkan/net v0.0.0-20211210172952-3f0f9446f73f/go.mod h1:9nx3DQGgdP8bBQD5qxJ1jj9UTztislL4KSBs9R2vV5Y=",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "990: golang.org/x/sys v0.0.0-20210927094055-39ccf1dd6fa6/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=",
          "991: golang.org/x/sys v0.0.0-20211013075003-97ac67df715c/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=",
          "992: golang.org/x/sys v0.0.0-20211124211545-fe61309f8881/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=",
          "994: golang.org/x/sys v0.0.0-20211205182925-97ca703d548d/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=",
          "995: golang.org/x/term v0.0.0-20201126162022-7de9c90e9dd1 h1:v+OssWQX+hTHEmOBgwxdZxK4zHq3yOs8F9J7mk0PY8E=",
          "996: golang.org/x/term v0.0.0-20201126162022-7de9c90e9dd1/go.mod h1:bj7SfCRtBDWHUb9snDiAeCFNEtKQo2Wmx5Cou7ajbmo=",
          "997: golang.org/x/text v0.0.0-20170915032832-14c0d48ead0c/go.mod h1:NqM8EUOU14njkJ3fqMW+pc6Ldnwhi/IjpwHt7yyuwOQ=",
          "",
          "[Removed Lines]",
          "993: golang.org/x/sys v0.0.0-20211205182925-97ca703d548d h1:FjkYO/PPp4Wi0EAUOVLxePm7qVW4r4ctbWpURyuOD0E=",
          "",
          "[Added Lines]",
          "995: golang.org/x/sys v0.0.0-20211210111614-af8b64212486 h1:5hpz5aRr+W1erYCL5JRhSUBJRph7l9XkNveoExlrKYk=",
          "996: golang.org/x/sys v0.0.0-20211210111614-af8b64212486/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "1119: google.golang.org/api v0.56.0/go.mod h1:38yMfeP1kfjsl8isn0tliTjIb1rJXcQi4UXlbqivdVE=",
          "1120: google.golang.org/api v0.57.0/go.mod h1:dVPlbZyBo2/OjBpmvNdpn2GRm6rPy75jyU7bmhdrMgI=",
          "1121: google.golang.org/api v0.58.0/go.mod h1:cAbP2FsxoGVNwtgNAmmn3y5G1TWAiVYRmg4yku3lv+E=",
          "1123: google.golang.org/api v0.61.0/go.mod h1:xQRti5UdCmoCEqFxcz93fTl338AVqDgyaDRuOZ3hg9I=",
          "1124: google.golang.org/appengine v1.1.0/go.mod h1:EbEs0AVv82hx2wNQdGPgUI5lhzA/G0D9YwlJXL52JkM=",
          "1125: google.golang.org/appengine v1.4.0/go.mod h1:xpcJRLb0r/rnEns0DIKYYv+WjYCduHsrkT7/EB5XEv4=",
          "1126: google.golang.org/appengine v1.5.0/go.mod h1:xpcJRLb0r/rnEns0DIKYYv+WjYCduHsrkT7/EB5XEv4=",
          "",
          "[Removed Lines]",
          "1122: google.golang.org/api v0.61.0 h1:TXXKS1slM3b2bZNJwD5DV/Tp6/M2cLzLOLh9PjDhrw8=",
          "",
          "[Added Lines]",
          "1125: google.golang.org/api v0.62.0 h1:PhGymJMXfGBzc4lBRmrx9+1w4w2wEzURHNGF/sD/xGc=",
          "1126: google.golang.org/api v0.62.0/go.mod h1:dKmwPCydfsad4qCH08MSdgWjfHOyfpd4VtDGgRFdavw=",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "1196: google.golang.org/genproto v0.0.0-20210924002016-3dee208752a0/go.mod h1:5CzLGKJ67TSI2B9POpiiyGha0AjJvZIUgRMt1dSmuhc=",
          "1197: google.golang.org/genproto v0.0.0-20211016002631-37fc39342514/go.mod h1:5CzLGKJ67TSI2B9POpiiyGha0AjJvZIUgRMt1dSmuhc=",
          "1198: google.golang.org/genproto v0.0.0-20211118181313-81c1377c94b1/go.mod h1:5CzLGKJ67TSI2B9POpiiyGha0AjJvZIUgRMt1dSmuhc=",
          "1199: google.golang.org/genproto v0.0.0-20211206160659-862468c7d6e0/go.mod h1:5CzLGKJ67TSI2B9POpiiyGha0AjJvZIUgRMt1dSmuhc=",
          "1202: google.golang.org/grpc v1.8.0/go.mod h1:yo6s7OP7yaDglbqo1J04qKzAhqBH6lvTonzMVmEdcZw=",
          "1203: google.golang.org/grpc v1.19.0/go.mod h1:mqu4LbDTu4XGKhr4mRzUsmM4RtVoemTSY81AxZiDr8c=",
          "1204: google.golang.org/grpc v1.20.1/go.mod h1:10oTOabMzJvdu6/UiuZezV6QK5dSlG84ov/aaiqXj38=",
          "",
          "[Removed Lines]",
          "1200: google.golang.org/genproto v0.0.0-20211207154714-918901c715cf h1:PSEM+IQFb9xdsj2CGhfqUTfsZvF8DScCVP1QZb2IiTQ=",
          "1201: google.golang.org/genproto v0.0.0-20211207154714-918901c715cf/go.mod h1:5CzLGKJ67TSI2B9POpiiyGha0AjJvZIUgRMt1dSmuhc=",
          "",
          "[Added Lines]",
          "1202: google.golang.org/genproto v0.0.0-20211129164237-f09f9a12af12/go.mod h1:5CzLGKJ67TSI2B9POpiiyGha0AjJvZIUgRMt1dSmuhc=",
          "1203: google.golang.org/genproto v0.0.0-20211203200212-54befc351ae9/go.mod h1:5CzLGKJ67TSI2B9POpiiyGha0AjJvZIUgRMt1dSmuhc=",
          "1205: google.golang.org/genproto v0.0.0-20211208223120-3a66f561d7aa h1:I0YcKz0I7OAhddo7ya8kMnvprhcWM045PmkBdMO9zN0=",
          "1206: google.golang.org/genproto v0.0.0-20211208223120-3a66f561d7aa/go.mod h1:5CzLGKJ67TSI2B9POpiiyGha0AjJvZIUgRMt1dSmuhc=",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "1225: google.golang.org/grpc v1.39.0/go.mod h1:PImNr+rS9TWYb2O4/emRugxiyHZ5JyHW5F+RPnDzfrE=",
          "1226: google.golang.org/grpc v1.39.1/go.mod h1:PImNr+rS9TWYb2O4/emRugxiyHZ5JyHW5F+RPnDzfrE=",
          "1227: google.golang.org/grpc v1.40.0/go.mod h1:ogyxbiOoUXAkP+4+xa6PZSE9DZgIHtSpzjDTB9KAK34=",
          "1228: google.golang.org/grpc v1.42.0 h1:XT2/MFpuPFsEX2fWh3YQtHkZ+WYZFQRfaUgLZYj/p6A=",
          "1229: google.golang.org/grpc v1.42.0/go.mod h1:k+4IHHFw41K8+bbowsex27ge2rCb65oeWqe4jJ590SU=",
          "1230: google.golang.org/grpc/cmd/protoc-gen-go-grpc v1.1.0/go.mod h1:6Kw0yEErY5E/yWrBtf03jp27GLLJujG4z/JK95pnjjw=",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1233: google.golang.org/grpc v1.40.1/go.mod h1:ogyxbiOoUXAkP+4+xa6PZSE9DZgIHtSpzjDTB9KAK34=",
          "",
          "---------------"
        ],
        "httpd/httpd_test.go||httpd/httpd_test.go": [
          "File: httpd/httpd_test.go -> httpd/httpd_test.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "502:  assert.NoError(t, err)",
          "503: }",
          "505: func TestUserTimestamps(t *testing.T) {",
          "506:  user, resp, err := httpdtest.AddUser(getTestUser(), http.StatusCreated)",
          "507:  assert.NoError(t, err, string(resp))",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "505: func TestUserBandwidthLimit(t *testing.T) {",
          "506:  u := getTestUser()",
          "507:  u.UploadBandwidth = 128",
          "508:  u.DownloadBandwidth = 96",
          "509:  u.Filters.BandwidthLimits = []sdk.BandwidthLimit{",
          "510:   {",
          "511:    Sources: []string{\"1\"},",
          "512:   },",
          "513:  }",
          "514:  _, resp, err := httpdtest.AddUser(u, http.StatusBadRequest)",
          "515:  assert.NoError(t, err, string(resp))",
          "516:  assert.Contains(t, string(resp), \"Validation error: could not parse bandwidth limit source\")",
          "517:  u.Filters.BandwidthLimits = []sdk.BandwidthLimit{",
          "518:   {",
          "519:    Sources:         []string{\"127.0.0.0/8\", \"::1/128\"},",
          "520:    UploadBandwidth: 256,",
          "521:   },",
          "522:   {",
          "523:    Sources:           []string{\"10.0.0.0/8\"},",
          "524:    UploadBandwidth:   512,",
          "525:    DownloadBandwidth: 256,",
          "526:   },",
          "527:  }",
          "528:  user, resp, err := httpdtest.AddUser(u, http.StatusCreated)",
          "529:  assert.NoError(t, err, string(resp))",
          "530:  assert.Len(t, user.Filters.BandwidthLimits, 2)",
          "531:  assert.Equal(t, u.Filters.BandwidthLimits, user.Filters.BandwidthLimits)",
          "533:  connID := xid.New().String()",
          "534:  localAddr := \"127.0.0.1\"",
          "535:  up, down := user.GetBandwidthForIP(\"127.0.1.1\", connID)",
          "536:  assert.Equal(t, int64(256), up)",
          "537:  assert.Equal(t, int64(0), down)",
          "538:  conn := common.NewBaseConnection(connID, common.ProtocolHTTP, localAddr, \"127.0.1.1\", user)",
          "539:  assert.Equal(t, int64(256), conn.User.UploadBandwidth)",
          "540:  assert.Equal(t, int64(0), conn.User.DownloadBandwidth)",
          "541:  up, down = user.GetBandwidthForIP(\"10.1.2.3\", connID)",
          "542:  assert.Equal(t, int64(512), up)",
          "543:  assert.Equal(t, int64(256), down)",
          "544:  conn = common.NewBaseConnection(connID, common.ProtocolHTTP, localAddr, \"10.2.1.4:1234\", user)",
          "545:  assert.Equal(t, int64(512), conn.User.UploadBandwidth)",
          "546:  assert.Equal(t, int64(256), conn.User.DownloadBandwidth)",
          "547:  up, down = user.GetBandwidthForIP(\"192.168.1.2\", connID)",
          "548:  assert.Equal(t, int64(128), up)",
          "549:  assert.Equal(t, int64(96), down)",
          "550:  conn = common.NewBaseConnection(connID, common.ProtocolHTTP, localAddr, \"172.16.0.1\", user)",
          "551:  assert.Equal(t, int64(128), conn.User.UploadBandwidth)",
          "552:  assert.Equal(t, int64(96), conn.User.DownloadBandwidth)",
          "553:  up, down = user.GetBandwidthForIP(\"invalid\", connID)",
          "554:  assert.Equal(t, int64(128), up)",
          "555:  assert.Equal(t, int64(96), down)",
          "556:  conn = common.NewBaseConnection(connID, common.ProtocolHTTP, localAddr, \"172.16.0\", user)",
          "557:  assert.Equal(t, int64(128), conn.User.UploadBandwidth)",
          "558:  assert.Equal(t, int64(96), conn.User.DownloadBandwidth)",
          "560:  user.Filters.BandwidthLimits = []sdk.BandwidthLimit{",
          "561:   {",
          "562:    Sources:           []string{\"10.0.0.0/24\"},",
          "563:    UploadBandwidth:   256,",
          "564:    DownloadBandwidth: 512,",
          "565:   },",
          "566:  }",
          "567:  user, resp, err = httpdtest.UpdateUser(user, http.StatusOK, \"\")",
          "568:  assert.NoError(t, err, string(resp))",
          "569:  if assert.Len(t, user.Filters.BandwidthLimits, 1) {",
          "570:   bwLimit := user.Filters.BandwidthLimits[0]",
          "571:   assert.Equal(t, []string{\"10.0.0.0/24\"}, bwLimit.Sources)",
          "572:   assert.Equal(t, int64(256), bwLimit.UploadBandwidth)",
          "573:   assert.Equal(t, int64(512), bwLimit.DownloadBandwidth)",
          "574:  }",
          "575:  up, down = user.GetBandwidthForIP(\"10.1.2.3\", connID)",
          "576:  assert.Equal(t, int64(128), up)",
          "577:  assert.Equal(t, int64(96), down)",
          "578:  conn = common.NewBaseConnection(connID, common.ProtocolHTTP, localAddr, \"172.16.0.2\", user)",
          "579:  assert.Equal(t, int64(128), conn.User.UploadBandwidth)",
          "580:  assert.Equal(t, int64(96), conn.User.DownloadBandwidth)",
          "581:  up, down = user.GetBandwidthForIP(\"10.0.0.26\", connID)",
          "582:  assert.Equal(t, int64(256), up)",
          "583:  assert.Equal(t, int64(512), down)",
          "584:  conn = common.NewBaseConnection(connID, common.ProtocolHTTP, localAddr, \"10.0.0.28\", user)",
          "585:  assert.Equal(t, int64(256), conn.User.UploadBandwidth)",
          "586:  assert.Equal(t, int64(512), conn.User.DownloadBandwidth)",
          "590:  user, resp, err = httpdtest.UpdateUser(user, http.StatusOK, \"\")",
          "591:  assert.NoError(t, err, string(resp))",
          "594:  err = os.RemoveAll(user.GetHomeDir())",
          "595:  assert.NoError(t, err)",
          "596:  _, err = httpdtest.RemoveUser(user, http.StatusOK)",
          "597:  assert.NoError(t, err)",
          "598: }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "12915:  checkResponseCode(t, http.StatusOK, rr)",
          "12916:  assert.Contains(t, rr.Body.String(), \"Validation error: invalid TLS username\")",
          "12917:  form.Set(\"tls_username\", string(sdk.TLSUsernameNone))",
          "12918:  form.Set(csrfFormToken, \"invalid form token\")",
          "12919:  b, contentType, _ = getMultipartFormData(form, \"\", \"\")",
          "12920:  req, _ = http.NewRequest(http.MethodPost, webUserPath, &b)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "13014:  form.Set(\"bandwidth_limit_sources0\", \"192.168.1.0/24, 192.168.2.0/25\")",
          "13015:  form.Set(\"upload_bandwidth_source0\", \"a\")",
          "13016:  form.Set(\"download_bandwidth_source0\", \"0\")",
          "13017:  b, contentType, _ = getMultipartFormData(form, \"\", \"\")",
          "13018:  req, _ = http.NewRequest(http.MethodPost, webUserPath, &b)",
          "13019:  setJWTCookieForReq(req, webToken)",
          "13020:  req.Header.Set(\"Content-Type\", contentType)",
          "13021:  rr = executeRequest(req)",
          "13022:  checkResponseCode(t, http.StatusOK, rr)",
          "13023:  assert.Contains(t, rr.Body.String(), \"invalid upload_bandwidth_source\")",
          "13025:  form.Set(\"upload_bandwidth_source0\", \"256\")",
          "13026:  form.Set(\"download_bandwidth_source0\", \"a\")",
          "13027:  b, contentType, _ = getMultipartFormData(form, \"\", \"\")",
          "13028:  req, _ = http.NewRequest(http.MethodPost, webUserPath, &b)",
          "13029:  setJWTCookieForReq(req, webToken)",
          "13030:  req.Header.Set(\"Content-Type\", contentType)",
          "13031:  rr = executeRequest(req)",
          "13032:  checkResponseCode(t, http.StatusOK, rr)",
          "13033:  assert.Contains(t, rr.Body.String(), \"invalid download_bandwidth_source\")",
          "13034:  form.Set(\"download_bandwidth_source0\", \"512\")",
          "13035:  form.Set(\"download_bandwidth_source1\", \"1024\")",
          "13036:  form.Set(\"bandwidth_limit_sources1\", \"1.1.1\")",
          "13037:  b, contentType, _ = getMultipartFormData(form, \"\", \"\")",
          "13038:  req, _ = http.NewRequest(http.MethodPost, webUserPath, &b)",
          "13039:  setJWTCookieForReq(req, webToken)",
          "13040:  req.Header.Set(\"Content-Type\", contentType)",
          "13041:  rr = executeRequest(req)",
          "13042:  checkResponseCode(t, http.StatusOK, rr)",
          "13043:  assert.Contains(t, rr.Body.String(), \"Validation error: could not parse bandwidth limit source\")",
          "13044:  form.Set(\"bandwidth_limit_sources1\", \"127.0.0.1/32\")",
          "13045:  form.Set(\"upload_bandwidth_source1\", \"-1\")",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "12999:    assert.True(t, util.IsStringInSlice(\"*.rar\", filter.DeniedPatterns))",
          "13000:   }",
          "13001:  }",
          "13002:  assert.Equal(t, sdk.TLSUsernameNone, newUser.Filters.TLSUsername)",
          "13003:  req, _ = http.NewRequest(http.MethodDelete, path.Join(userPath, newUser.Username), nil)",
          "13004:  setBearerForReq(req, apiToken)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "13130:  if assert.Len(t, newUser.Filters.BandwidthLimits, 2) {",
          "13131:   for _, bwLimit := range newUser.Filters.BandwidthLimits {",
          "13132:    if len(bwLimit.Sources) == 2 {",
          "13133:     assert.Equal(t, \"192.168.1.0/24\", bwLimit.Sources[0])",
          "13134:     assert.Equal(t, \"192.168.2.0/25\", bwLimit.Sources[1])",
          "13135:     assert.Equal(t, int64(256), bwLimit.UploadBandwidth)",
          "13136:     assert.Equal(t, int64(512), bwLimit.DownloadBandwidth)",
          "13137:    } else {",
          "13138:     assert.Equal(t, []string{\"127.0.0.1/32\"}, bwLimit.Sources)",
          "13139:     assert.Equal(t, int64(0), bwLimit.UploadBandwidth)",
          "13140:     assert.Equal(t, int64(1024), bwLimit.DownloadBandwidth)",
          "13141:    }",
          "13142:   }",
          "13143:  }",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "13018:  csrfToken, err := getCSRFToken(httpBaseURL + webLoginPath)",
          "13019:  assert.NoError(t, err)",
          "13020:  user := getTestUser()",
          "13021:  userAsJSON := getUserAsJSON(t, user)",
          "13022:  req, _ := http.NewRequest(http.MethodPost, userPath, bytes.NewBuffer(userAsJSON))",
          "13023:  setBearerForReq(req, apiToken)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "13164:  user.Filters.BandwidthLimits = []sdk.BandwidthLimit{",
          "13165:   {",
          "13166:    Sources:           []string{\"10.8.0.0/16\", \"192.168.1.0/25\"},",
          "13167:    UploadBandwidth:   256,",
          "13168:    DownloadBandwidth: 512,",
          "13169:   },",
          "13170:  }",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "13053:  user, _, err = httpdtest.GetUserByUsername(user.Username, http.StatusOK)",
          "13054:  assert.NoError(t, err)",
          "13055:  assert.True(t, user.Filters.TOTPConfig.Enabled)",
          "13057:  dbUser, err := dataprovider.UserExists(user.Username)",
          "13058:  assert.NoError(t, err)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "13206:  if assert.Len(t, user.Filters.BandwidthLimits, 1) {",
          "13207:   if assert.Len(t, user.Filters.BandwidthLimits[0].Sources, 2) {",
          "13208:    assert.Equal(t, \"10.8.0.0/16\", user.Filters.BandwidthLimits[0].Sources[0])",
          "13209:    assert.Equal(t, \"192.168.1.0/25\", user.Filters.BandwidthLimits[0].Sources[1])",
          "13210:   }",
          "13211:   assert.Equal(t, int64(256), user.Filters.BandwidthLimits[0].UploadBandwidth)",
          "13212:   assert.Equal(t, int64(512), user.Filters.BandwidthLimits[0].DownloadBandwidth)",
          "13213:  }",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "13178:  assert.True(t, util.IsStringInSlice(dataprovider.SSHLoginMethodKeyboardInteractive, updateUser.Filters.DeniedLoginMethods))",
          "13179:  assert.True(t, util.IsStringInSlice(common.ProtocolFTP, updateUser.Filters.DeniedProtocols))",
          "13180:  assert.True(t, util.IsStringInSlice(\"*.zip\", updateUser.Filters.FilePatterns[0].DeniedPatterns))",
          "13181:  req, err = http.NewRequest(http.MethodDelete, path.Join(userPath, user.Username), nil)",
          "13182:  assert.NoError(t, err)",
          "13183:  setBearerForReq(req, apiToken)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "13339:  assert.Len(t, updateUser.Filters.BandwidthLimits, 0)",
          "",
          "---------------"
        ],
        "httpd/webadmin.go||httpd/webadmin.go": [
          "File: httpd/webadmin.go -> httpd/webadmin.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "732:  return permissions",
          "733: }",
          "735: func getFilePatternsFromPostField(r *http.Request) []sdk.PatternsFilter {",
          "736:  var result []sdk.PatternsFilter",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "735: func getBandwidthLimitsFromPostFields(r *http.Request) ([]sdk.BandwidthLimit, error) {",
          "736:  var result []sdk.BandwidthLimit",
          "738:  for k := range r.Form {",
          "739:   if strings.HasPrefix(k, \"bandwidth_limit_sources\") {",
          "740:    sources := getSliceFromDelimitedValues(r.Form.Get(k), \",\")",
          "741:    if len(sources) > 0 {",
          "742:     bwLimit := sdk.BandwidthLimit{",
          "743:      Sources: sources,",
          "744:     }",
          "745:     idx := strings.TrimPrefix(k, \"bandwidth_limit_sources\")",
          "746:     ul := r.Form.Get(fmt.Sprintf(\"upload_bandwidth_source%v\", idx))",
          "747:     dl := r.Form.Get(fmt.Sprintf(\"download_bandwidth_source%v\", idx))",
          "748:     if ul != \"\" {",
          "749:      bandwidthUL, err := strconv.ParseInt(ul, 10, 64)",
          "750:      if err != nil {",
          "751:       return result, fmt.Errorf(\"invalid upload_bandwidth_source%v %#v: %w\", idx, ul, err)",
          "752:      }",
          "753:      bwLimit.UploadBandwidth = bandwidthUL",
          "754:     }",
          "755:     if dl != \"\" {",
          "756:      bandwidthDL, err := strconv.ParseInt(dl, 10, 64)",
          "757:      if err != nil {",
          "758:       return result, fmt.Errorf(\"invalid download_bandwidth_source%v %#v: %w\", idx, ul, err)",
          "759:      }",
          "760:      bwLimit.DownloadBandwidth = bandwidthDL",
          "761:     }",
          "762:     result = append(result, bwLimit)",
          "763:    }",
          "764:   }",
          "765:  }",
          "767:  return result, nil",
          "768: }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "786:  return result",
          "787: }",
          "790:  var filters sdk.UserFilters",
          "791:  filters.AllowedIP = getSliceFromDelimitedValues(r.Form.Get(\"allowed_ip\"), \",\")",
          "792:  filters.DeniedIP = getSliceFromDelimitedValues(r.Form.Get(\"denied_ip\"), \",\")",
          "793:  filters.DeniedLoginMethods = r.Form[\"ssh_login_methods\"]",
          "",
          "[Removed Lines]",
          "789: func getFiltersFromUserPostFields(r *http.Request) sdk.UserFilters {",
          "",
          "[Added Lines]",
          "824: func getFiltersFromUserPostFields(r *http.Request) (sdk.UserFilters, error) {",
          "826:  bwLimits, err := getBandwidthLimitsFromPostFields(r)",
          "827:  if err != nil {",
          "828:   return filters, err",
          "829:  }",
          "830:  filters.BandwidthLimits = bwLimits",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "807:  }",
          "808:  filters.DisableFsChecks = len(r.Form.Get(\"disable_fs_checks\")) > 0",
          "809:  filters.AllowAPIKeyAuth = len(r.Form.Get(\"allow_api_key_auth\")) > 0",
          "811: }",
          "813: func getSecretFromFormField(r *http.Request, field string) *kms.Secret {",
          "",
          "[Removed Lines]",
          "810:  return filters",
          "",
          "[Added Lines]",
          "850:  return filters, nil",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1143:  if err != nil {",
          "1144:   return user, err",
          "1145:  }",
          "1146:  user = dataprovider.User{",
          "1147:   BaseUser: sdk.BaseUser{",
          "1148:    Username:          r.Form.Get(\"username\"),",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1186:  filters, err := getFiltersFromUserPostFields(r)",
          "1187:  if err != nil {",
          "1188:   return user, err",
          "1189:  }",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1160:    DownloadBandwidth: bandwidthDL,",
          "1161:    Status:            status,",
          "1162:    ExpirationDate:    expirationDateMillis,",
          "1164:    AdditionalInfo:    r.Form.Get(\"additional_info\"),",
          "1165:    Description:       r.Form.Get(\"description\"),",
          "1166:   },",
          "",
          "[Removed Lines]",
          "1163:    Filters:           getFiltersFromUserPostFields(r),",
          "",
          "[Added Lines]",
          "1207:    Filters:           filters,",
          "",
          "---------------"
        ],
        "httpdtest/httpdtest.go||httpdtest/httpdtest.go": [
          "File: httpdtest/httpdtest.go -> httpdtest/httpdtest.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "1492:  if err := compareUserFilterSubStructs(expected, actual); err != nil {",
          "1493:   return err",
          "1494:  }",
          "1495:  return compareUserFilePatternsFilters(expected, actual)",
          "1496: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1495:  if err := compareUserBandwidthLimitFilters(expected, actual); err != nil {",
          "1496:   return err",
          "1497:  }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1507:  return true",
          "1508: }",
          "1510: func compareUserFilePatternsFilters(expected *dataprovider.User, actual *dataprovider.User) error {",
          "1511:  if len(expected.Filters.FilePatterns) != len(actual.Filters.FilePatterns) {",
          "1512:   return errors.New(\"file patterns mismatch\")",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1513: func compareUserBandwidthLimitFilters(expected *dataprovider.User, actual *dataprovider.User) error {",
          "1514:  if len(expected.Filters.BandwidthLimits) != len(actual.Filters.BandwidthLimits) {",
          "1515:   return errors.New(\"bandwidth filters mismatch\")",
          "1516:  }",
          "1518:  for idx, l := range expected.Filters.BandwidthLimits {",
          "1519:   if actual.Filters.BandwidthLimits[idx].UploadBandwidth != l.UploadBandwidth {",
          "1520:    return errors.New(\"bandwidth filters upload_bandwidth mismatch\")",
          "1521:   }",
          "1522:   if actual.Filters.BandwidthLimits[idx].DownloadBandwidth != l.DownloadBandwidth {",
          "1523:    return errors.New(\"bandwidth filters download_bandwidth mismatch\")",
          "1524:   }",
          "1525:   if len(actual.Filters.BandwidthLimits[idx].Sources) != len(l.Sources) {",
          "1526:    return errors.New(\"bandwidth filters sources mismatch\")",
          "1527:   }",
          "1528:   for _, source := range actual.Filters.BandwidthLimits[idx].Sources {",
          "1529:    if !util.IsStringInSlice(source, l.Sources) {",
          "1530:     return errors.New(\"bandwidth filters source mismatch\")",
          "1531:    }",
          "1532:   }",
          "1533:  }",
          "1535:  return nil",
          "1536: }",
          "",
          "---------------"
        ],
        "sdk/user.go||sdk/user.go": [
          "File: sdk/user.go -> sdk/user.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: package sdk",
          "3: import (",
          "4:  \"strings\"",
          "6:  \"github.com/drakkan/sftpgo/v2/kms\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "4:  \"fmt\"",
          "5:  \"net\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "125:  Protocols []string `json:\"protocols,omitempty\"`",
          "126: }",
          "130: type UserFilters struct {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "131: type BandwidthLimit struct {",
          "135:  Sources []string `json:\"sources\"`",
          "137:  UploadBandwidth int64 `json:\"upload_bandwidth,omitempty\"`",
          "139:  DownloadBandwidth int64 `json:\"download_bandwidth,omitempty\"`",
          "140: }",
          "143: func (l *BandwidthLimit) Validate() error {",
          "144:  for _, source := range l.Sources {",
          "145:   _, _, err := net.ParseCIDR(source)",
          "146:   if err != nil {",
          "147:    return util.NewValidationError(fmt.Sprintf(\"could not parse bandwidth limit source %#v: %v\", source, err))",
          "148:   }",
          "149:  }",
          "150:  return nil",
          "151: }",
          "154: func (l *BandwidthLimit) GetSourcesAsString() string {",
          "155:  return strings.Join(l.Sources, \",\")",
          "156: }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "175:  UserType string `json:\"user_type,omitempty\"`",
          "176: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "207:  BandwidthLimits []BandwidthLimit `json:\"bandwidth_limits,omitempty\"`",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "210:  Permissions map[string][]string `json:\"permissions\"`",
          "224:  CreatedAt int64 `json:\"created_at\"`",
          "",
          "[Removed Lines]",
          "212:  UsedQuotaSize int64 `json:\"used_quota_size\"`",
          "214:  UsedQuotaFiles int `json:\"used_quota_files\"`",
          "216:  LastQuotaUpdate int64 `json:\"last_quota_update\"`",
          "218:  UploadBandwidth int64 `json:\"upload_bandwidth\"`",
          "220:  DownloadBandwidth int64 `json:\"download_bandwidth\"`",
          "222:  LastLogin int64 `json:\"last_login\"`",
          "",
          "[Added Lines]",
          "244:  UsedQuotaSize int64 `json:\"used_quota_size,omitempty\"`",
          "246:  UsedQuotaFiles int `json:\"used_quota_files,omitempty\"`",
          "248:  LastQuotaUpdate int64 `json:\"last_quota_update,omitempty\"`",
          "251:  UploadBandwidth int64 `json:\"upload_bandwidth,omitempty\"`",
          "254:  DownloadBandwidth int64 `json:\"download_bandwidth,omitempty\"`",
          "256:  LastLogin int64 `json:\"last_login,omitempty\"`",
          "",
          "---------------"
        ],
        "templates/webadmin/admins.html||templates/webadmin/admins.html": [
          "File: templates/webadmin/admins.html -> templates/webadmin/admins.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "178:                 },",
          "179:                 {",
          "180:                     \"targets\": [3],",
          "182:                 }",
          "183:             ],",
          "184:             \"scrollX\": false,",
          "",
          "[Removed Lines]",
          "181:                     \"render\": $.fn.dataTable.render.ellipsis(40, true),",
          "",
          "[Added Lines]",
          "181:                     \"render\": $.fn.dataTable.render.ellipsis(40, true)",
          "",
          "---------------"
        ],
        "templates/webadmin/folders.html||templates/webadmin/folders.html": [
          "File: templates/webadmin/folders.html -> templates/webadmin/folders.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "228:             \"columnDefs\": [",
          "229:                 {",
          "230:                     \"targets\": [1],",
          "232:                 },",
          "233:                 {",
          "234:                     \"targets\": [2],",
          "236:                 },",
          "237:                 {",
          "238:                     \"targets\": [3],",
          "240:                 }",
          "241:             ],",
          "242:             \"scrollX\": false,",
          "",
          "[Removed Lines]",
          "231:                     \"render\": $.fn.dataTable.render.ellipsis(50, true),",
          "235:                     \"render\": $.fn.dataTable.render.ellipsis(60, true),",
          "239:                     \"render\": $.fn.dataTable.render.ellipsis(40, true),",
          "",
          "[Added Lines]",
          "231:                     \"render\": $.fn.dataTable.render.ellipsis(50, true)",
          "235:                     \"render\": $.fn.dataTable.render.ellipsis(60, true)",
          "239:                     \"render\": $.fn.dataTable.render.ellipsis(40, true)",
          "",
          "---------------"
        ],
        "templates/webadmin/user.html||templates/webadmin/user.html": [
          "File: templates/webadmin/user.html -> templates/webadmin/user.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "364:                 </div>",
          "365:             </div>",
          "367:             <div class=\"form-group row\">",
          "368:                 <label for=\"idQuotaSize\" class=\"col-sm-2 col-form-label\">Quota size (bytes)</label>",
          "369:                 <div class=\"col-sm-3\">",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "367:             <div class=\"form-group row\">",
          "368:                 <label for=\"idUID\" class=\"col-sm-2 col-form-label\">UID</label>",
          "369:                 <div class=\"col-sm-3\">",
          "370:                     <input type=\"number\" class=\"form-control\" id=\"idUID\" name=\"uid\" placeholder=\"\" value=\"{{.User.UID}}\"",
          "371:                         min=\"0\" max=\"2147483647\">",
          "372:                 </div>",
          "373:                 <div class=\"col-sm-2\"></div>",
          "374:                 <label for=\"idGID\" class=\"col-sm-2 col-form-label\">GID</label>",
          "375:                 <div class=\"col-sm-3\">",
          "376:                     <input type=\"number\" class=\"form-control\" id=\"idGID\" name=\"gid\" placeholder=\"\" value=\"{{.User.GID}}\"",
          "377:                         min=\"0\" max=\"2147483647\">",
          "378:                 </div>",
          "379:             </div>",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "425:                 </div>",
          "426:             </div>",
          "433:                 </div>",
          "439:                 </div>",
          "440:             </div>",
          "",
          "[Removed Lines]",
          "428:             <div class=\"form-group row\">",
          "429:                 <label for=\"idUID\" class=\"col-sm-2 col-form-label\">UID</label>",
          "430:                 <div class=\"col-sm-3\">",
          "431:                     <input type=\"number\" class=\"form-control\" id=\"idUID\" name=\"uid\" placeholder=\"\" value=\"{{.User.UID}}\"",
          "432:                         min=\"0\" max=\"2147483647\">",
          "434:                 <div class=\"col-sm-2\"></div>",
          "435:                 <label for=\"idGID\" class=\"col-sm-2 col-form-label\">GID</label>",
          "436:                 <div class=\"col-sm-3\">",
          "437:                     <input type=\"number\" class=\"form-control\" id=\"idGID\" name=\"gid\" placeholder=\"\" value=\"{{.User.GID}}\"",
          "438:                         min=\"0\" max=\"2147483647\">",
          "",
          "[Added Lines]",
          "442:             <div class=\"card bg-light mb-3\">",
          "443:                 <div class=\"card-header\">",
          "444:                     Per-source bandwidth limits",
          "446:                 <div class=\"card-body\">",
          "447:                     <div class=\"form-group row\">",
          "448:                         <div class=\"col-md-12 form_field_bwlimits_outer\">",
          "449:                             {{range $idx, $bwLimit := .User.Filters.BandwidthLimits -}}",
          "450:                             <div class=\"row form_field_bwlimits_outer_row\">",
          "451:                                 <div class=\"form-group col-md-8\">",
          "452:                                     <textarea class=\"form-control\" id=\"idBandwidthLimitSources{{$idx}}\" name=\"bandwidth_limit_sources{{$idx}}\" rows=\"4\" placeholder=\"\"",
          "453:                                             aria-describedby=\"bwLimitSourcesHelpBlock{{$idx}}\">{{$bwLimit.GetSourcesAsString}}</textarea>",
          "454:                                     <small id=\"bwLimitSourcesHelpBlock{{$idx}}\" class=\"form-text text-muted\">",
          "455:                                         Comma separated IP/Mask in CIDR format, for example \"192.168.1.0/24,10.8.0.100/32\"",
          "456:                                     </small>",
          "457:                                 </div>",
          "458:                                 <div class=\"col-md-3\">",
          "459:                                     <div class=\"form-group\">",
          "460:                                         <input type=\"number\" class=\"form-control\" id=\"idUploadBandwidthSource{{$idx}}\" name=\"upload_bandwidth_source{{$idx}}\"",
          "461:                                             placeholder=\"\" value=\"{{$bwLimit.UploadBandwidth}}\" min=\"0\" aria-describedby=\"ulHelpBlock{{$idx}}\">",
          "462:                                         <small id=\"ulHelpBlock{{$idx}}\" class=\"form-text text-muted\">",
          "463:                                             UL (KB/s). 0 means no limit",
          "464:                                         </small>",
          "465:                                     </div>",
          "466:                                     <div class=\"form-group\">",
          "467:                                         <input type=\"number\" class=\"form-control\" id=\"idDownloadBandwidthSource{{$idx}}\" name=\"download_bandwidth_source{{$idx}}\"",
          "468:                                             placeholder=\"\" value=\"{{$bwLimit.DownloadBandwidth}}\" min=\"0\" aria-describedby=\"dlHelpBlock{{$idx}}\">",
          "469:                                         <small id=\"dlHelpBlock{{$idx}}\" class=\"form-text text-muted\">",
          "470:                                             DL (KB/s). 0 means no limit",
          "471:                                         </small>",
          "472:                                     </div>",
          "473:                                 </div>",
          "475:                                 <div class=\"form-group col-md-1\">",
          "476:                                     <button class=\"btn btn-circle btn-danger remove_bwlimit_btn_frm_field\">",
          "477:                                         <i class=\"fas fa-trash\"></i>",
          "478:                                     </button>",
          "479:                                 </div>",
          "480:                             </div>",
          "481:                             {{else}}",
          "482:                             <div class=\"row form_field_bwlimits_outer_row\">",
          "483:                                 <div class=\"form-group col-md-8\">",
          "484:                                     <textarea class=\"form-control\" id=\"idBandwidthLimitSources0\" name=\"bandwidth_limit_sources0\" rows=\"4\" placeholder=\"\"",
          "485:                                             aria-describedby=\"bwLimitSourcesHelpBlock0\"></textarea>",
          "486:                                     <small id=\"bwLimitSourcesHelpBlock0\" class=\"form-text text-muted\">",
          "487:                                         Comma separated IP/Mask in CIDR format, for example \"192.168.1.0/24,10.8.0.100/32\"",
          "488:                                     </small>",
          "489:                                 </div>",
          "490:                                 <div class=\"col-md-3\">",
          "491:                                     <div class=\"form-group\">",
          "492:                                         <input type=\"number\" class=\"form-control\" id=\"idUploadBandwidthSource0\" name=\"upload_bandwidth_source0\"",
          "493:                                             placeholder=\"\" value=\"\" min=\"0\" aria-describedby=\"ulHelpBlock0\">",
          "494:                                         <small id=\"ulHelpBlock0\" class=\"form-text text-muted\">",
          "495:                                             UL (KB/s). 0 means no limit",
          "496:                                         </small>",
          "497:                                     </div>",
          "498:                                     <div class=\"form-group\">",
          "499:                                         <input type=\"number\" class=\"form-control\" id=\"idDownloadBandwidthSource0\" name=\"download_bandwidth_source0\"",
          "500:                                             placeholder=\"\" value=\"\" min=\"0\" aria-describedby=\"dlHelpBlock0\">",
          "501:                                         <small id=\"dlHelpBlock0\" class=\"form-text text-muted\">",
          "502:                                             DL (KB/s). 0 means no limit",
          "503:                                         </small>",
          "504:                                     </div>",
          "505:                                 </div>",
          "506:                                 <div class=\"form-group col-md-1\">",
          "507:                                     <button class=\"btn btn-circle btn-danger remove_bwlimit_btn_frm_field\">",
          "508:                                         <i class=\"fas fa-trash\"></i>",
          "509:                                     </button>",
          "510:                                 </div>",
          "511:                             </div>",
          "512:                             {{end}}",
          "513:                         </div>",
          "514:                     </div>",
          "516:                     <div class=\"row mx-1\">",
          "517:                         <button type=\"button\" class=\"btn btn-secondary add_new_bwlimit_field_btn\">",
          "518:                             <i class=\"fas fa-plus\"></i> Add new bandwidth limit",
          "519:                         </button>",
          "520:                     </div>",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "757:             $(this).closest(\".form_field_vfolder_outer_row\").remove();",
          "758:         });",
          "760:         $(\"body\").on(\"click\", \".add_new_pattern_field_btn\", function () {",
          "761:             var index = $(\".form_field_patterns_outer\").find(\".form_field_patterns_outer_row\").length;",
          "762:             while (document.getElementById(\"idPatternPath\"+index) != null){",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "842:         $(\"body\").on(\"click\", \".add_new_bwlimit_field_btn\", function () {",
          "843:             var index = $(\".form_field_bwlimits_outer\").find(\".form_field_bwlimits_outer_row\").length;",
          "844:             while (document.getElementById(\"idBandwidthLimitSources\"+index) != null){",
          "845:                 index++;",
          "846:             }",
          "847:             $(\".form_field_bwlimits_outer\").append(`",
          "848:                     <div class=\"row form_field_bwlimits_outer_row\">",
          "849:                         <div class=\"form-group col-md-8\">",
          "850:                             <textarea class=\"form-control\" id=\"idBandwidthLimitSources0\" name=\"bandwidth_limit_sources${index}\" rows=\"4\" placeholder=\"\"",
          "851:                                 aria-describedby=\"bwLimitSourcesHelpBlock${index}\"></textarea>",
          "852:                             <small id=\"bwLimitSourcesHelpBlock${index}\" class=\"form-text text-muted\">",
          "853:                                 Comma separated IP/Mask in CIDR format, for example \"192.168.1.0/24,10.8.0.100/32\"",
          "854:                             </small>",
          "855:                         </div>",
          "856:                         <div class=\"col-md-3\">",
          "857:                             <div class=\"form-group\">",
          "858:                                 <input type=\"number\" class=\"form-control\" id=\"idUploadBandwidthSource${index}\" name=\"upload_bandwidth_source${index}\"",
          "859:                                     placeholder=\"\" value=\"\" min=\"0\" aria-describedby=\"ulHelpBlock${index}\">",
          "860:                                 <small id=\"ulHelpBlock${index}\" class=\"form-text text-muted\">",
          "861:                                     UL (KB/s). 0 means no limit",
          "862:                                 </small>",
          "863:                             </div>",
          "864:                             <div class=\"form-group\">",
          "865:                                 <input type=\"number\" class=\"form-control\" id=\"idDownloadBandwidthSource${index}\" name=\"download_bandwidth_source${index}\"",
          "866:                                     placeholder=\"\" value=\"\" min=\"0\" aria-describedby=\"dlHelpBlock${index}\">",
          "867:                                 <small id=\"dlHelpBlock${index}\" class=\"form-text text-muted\">",
          "868:                                     DL (KB/s). 0 means no limit",
          "869:                                 </small>",
          "870:                             </div>",
          "871:                         </div>",
          "872:                         <div class=\"form-group col-md-1\">",
          "873:                             <button class=\"btn btn-circle btn-danger remove_bwlimit_btn_frm_field\">",
          "874:                                 <i class=\"fas fa-trash\"></i>",
          "875:                             </button>",
          "876:                         </div>",
          "877:                     </div>",
          "878:                 `);",
          "879:         });",
          "881:         $(\"body\").on(\"click\", \".remove_bwlimit_btn_frm_field\", function () {",
          "882:             $(this).closest(\".form_field_bwlimits_outer_row\").remove();",
          "883:         });",
          "",
          "---------------"
        ],
        "templates/webadmin/users.html||templates/webadmin/users.html": [
          "File: templates/webadmin/users.html -> templates/webadmin/users.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "255:                 },",
          "256:                 {",
          "257:                     \"targets\": [3],",
          "259:                 },",
          "260:                 {",
          "261:                     \"targets\": [4],",
          "263:                 }",
          "264:             ],",
          "265:             \"scrollX\": false,",
          "",
          "[Removed Lines]",
          "258:                     \"render\": $.fn.dataTable.render.ellipsis(40, true),",
          "262:                     \"render\": $.fn.dataTable.render.ellipsis(70, true),",
          "",
          "[Added Lines]",
          "258:                     \"render\": $.fn.dataTable.render.ellipsis(40, true)",
          "262:                     \"render\": $.fn.dataTable.render.ellipsis(70, true)",
          "",
          "---------------"
        ],
        "templates/webclient/files.html||templates/webclient/files.html": [
          "File: templates/webclient/files.html -> templates/webclient/files.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "386: <script type=\"text/javascript\">",
          "387:     var spinnerDone = false;",
          "389:     function getIconForFile(filename) {",
          "390:         var extension = filename.slice((filename.lastIndexOf(\".\") - 1 >>> 0) + 2).toLowerCase();",
          "391:         switch (extension) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "389:     var escapeHTML = function ( t ) {",
          "390:   return t",
          "391:    .replace( /&/g, '&amp;' )",
          "392:    .replace( /</g, '&lt;' )",
          "393:    .replace( />/g, '&gt;' )",
          "394:    .replace( /\"/g, '&quot;' );",
          "395:  };",
          "397:     function shortenData(d, cutoff) {",
          "398:         if ( typeof d !== 'string' ) {",
          "399:    return d;",
          "400:   }",
          "402:   if ( d.length <= cutoff ) {",
          "403:    return d;",
          "404:   }",
          "406:         var shortened = d.substr(0, cutoff-1);",
          "407:         return shortened+'&#8230;';",
          "408:     }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "651:                     try {",
          "652:                         var f = files[index];",
          "653:                         var uploadPath = '{{.FileURL}}?path={{.CurrentDir}}'+encodeURIComponent(\"/\"+f.name);",
          "654:                         response = await fetch(uploadPath, {",
          "655:                             method: 'POST',",
          "656:                             headers: {",
          "658:                                 'X-CSRF-TOKEN': '{{.CSRFToken}}'",
          "659:                             },",
          "660:                             credentials: 'same-origin',",
          "",
          "[Removed Lines]",
          "657:                                 'X-SFTPGO-MTIME': f.lastModified,",
          "",
          "[Added Lines]",
          "675:                         var lastModified;",
          "676:                         try {",
          "677:                             lastModified = f.lastModified;",
          "678:                         } catch (e) {",
          "679:                             console.log(\"unable to get last modified time from file: \"+e.message);",
          "680:                             lastModified = \"\";",
          "681:                         }",
          "685:                                 'X-SFTPGO-MTIME': lastModified,",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "886:                     \"data\": \"name\",",
          "887:                     \"render\": function (data, type, row) {",
          "888:                         if (type === 'display') {",
          "889:                             if (row[\"type\"] == \"1\") {",
          "891:                             }",
          "892:                             if (row[\"size\"] == \"\") {",
          "894:                             }",
          "895:                             var icon = getIconForFile(data);",
          "897:                         }",
          "898:                         return data;",
          "899:                     }",
          "",
          "[Removed Lines]",
          "890:                                 return `<i class=\"fas fa-folder\"></i>&nbsp;<a href=\"${row['url']}\">${data}</a>`;",
          "893:                                 return `<i class=\"fas fa-external-link-alt\"></i>&nbsp;<a href=\"${row['url']}\">${data}</a>`;",
          "896:                             return `<i class=\"${icon}\"></i>&nbsp;<a href=\"${row['url']}\">${data}</a>`;",
          "",
          "[Added Lines]",
          "917:                             var title = \"\";",
          "918:                             var cssClass = \"\";",
          "919:                             var shortened = shortenData(data, 70);",
          "920:                             if (shortened != data){",
          "921:                                 title = escapeHTML(data);",
          "922:                                 cssClass = \"ellipsis\";",
          "923:                             }",
          "926:                                 return `<i class=\"fas fa-folder\"></i>&nbsp;<a class=\"${cssClass}\" href=\"${row['url']}\" title=\"${title}\">${shortened}</a>`;",
          "929:                                 return `<i class=\"fas fa-external-link-alt\"></i>&nbsp;<a class=\"${cssClass}\" href=\"${row['url']}\" title=\"${title}\">${shortened}</a>`;",
          "932:                             return `<i class=\"${icon}\"></i>&nbsp;<a class=\"${cssClass}\" href=\"${row['url']}\" title=\"${title}\">${shortened}</a>`;",
          "",
          "---------------"
        ],
        "util/util.go||util/util.go": [
          "File: util/util.go -> util/util.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "492:  } else if clientIP := r.Header.Get(cfConnectingIP); clientIP != \"\" {",
          "493:   ip = clientIP",
          "494:  } else if xff := r.Header.Get(xForwardedFor); xff != \"\" {",
          "496:   if i == -1 {",
          "497:    i = len(xff)",
          "498:   }",
          "",
          "[Removed Lines]",
          "495:   i := strings.Index(xff, \", \")",
          "",
          "[Added Lines]",
          "495:   i := strings.Index(xff, \",\")",
          "",
          "---------------"
        ],
        "webdavd/internal_test.go||webdavd/internal_test.go": [
          "File: webdavd/internal_test.go -> webdavd/internal_test.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "460:  assert.Equal(t, remoteAddr2, ip)",
          "462:  req.RemoteAddr = remoteAddr2",
          "464:  ip = server.checkRemoteAddress(req)",
          "465:  assert.Equal(t, \"12.34.56.78\", ip)",
          "466:  assert.Equal(t, ip, req.RemoteAddr)",
          "",
          "[Removed Lines]",
          "463:  req.Header.Set(\"X-Forwarded-For\", fmt.Sprintf(\"%v, %v\", \"12.34.56.78\", \"172.16.2.4\"))",
          "",
          "[Added Lines]",
          "463:  req.Header.Set(\"X-Forwarded-For\", fmt.Sprintf(\"%v,%v\", \"12.34.56.78\", \"172.16.2.4\"))",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "1e0b3a2a8c1e48852ccb37ee035946be0a36bb69",
      "candidate_info": {
        "commit_hash": "1e0b3a2a8c1e48852ccb37ee035946be0a36bb69",
        "repo": "drakkan/sftpgo",
        "commit_url": "https://github.com/drakkan/sftpgo/commit/1e0b3a2a8c1e48852ccb37ee035946be0a36bb69",
        "files": [
          "cmd/genman.go",
          "dataprovider/share.go",
          "ftpd/ftpd_test.go",
          "ftpd/internal_test.go",
          "httpd/api_http_user.go",
          "httpd/api_shares.go",
          "httpd/api_utils.go",
          "httpd/httpd_test.go",
          "httpd/internal_test.go",
          "httpd/webclient.go",
          "logger/logger.go",
          "sftpd/server.go",
          "sftpd/sftpd_test.go",
          "templates/webadmin/mfa.html",
          "templates/webclient/mfa.html",
          "templates/webclient/share.html",
          "templates/webclient/sharefiles.html",
          "util/util.go",
          "vfs/osfs.go",
          "vfs/sftpfs.go",
          "webdavd/internal_test.go",
          "webdavd/webdavd_test.go"
        ],
        "message": "web client: add share mode read/write\n\nSigned-off-by: Nicola Murino <nicola.murino@gmail.com>",
        "before_after_code_files": [
          "cmd/genman.go||cmd/genman.go",
          "dataprovider/share.go||dataprovider/share.go",
          "ftpd/ftpd_test.go||ftpd/ftpd_test.go",
          "ftpd/internal_test.go||ftpd/internal_test.go",
          "httpd/api_http_user.go||httpd/api_http_user.go",
          "httpd/api_shares.go||httpd/api_shares.go",
          "httpd/api_utils.go||httpd/api_utils.go",
          "httpd/httpd_test.go||httpd/httpd_test.go",
          "httpd/internal_test.go||httpd/internal_test.go",
          "httpd/webclient.go||httpd/webclient.go",
          "logger/logger.go||logger/logger.go",
          "sftpd/server.go||sftpd/server.go",
          "sftpd/sftpd_test.go||sftpd/sftpd_test.go",
          "templates/webadmin/mfa.html||templates/webadmin/mfa.html",
          "templates/webclient/mfa.html||templates/webclient/mfa.html",
          "templates/webclient/share.html||templates/webclient/share.html",
          "templates/webclient/sharefiles.html||templates/webclient/sharefiles.html",
          "util/util.go||util/util.go",
          "vfs/osfs.go||vfs/osfs.go",
          "vfs/sftpfs.go||vfs/sftpfs.go",
          "webdavd/internal_test.go||webdavd/internal_test.go",
          "webdavd/webdavd_test.go||webdavd/webdavd_test.go"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "templates/webclient/sharefiles.html||templates/webclient/sharefiles.html"
          ],
          "candidate": [
            "templates/webclient/sharefiles.html||templates/webclient/sharefiles.html"
          ]
        }
      },
      "candidate_diff": {
        "cmd/genman.go||cmd/genman.go": [
          "File: cmd/genman.go -> cmd/genman.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: package cmd",
          "3: import (",
          "4:  \"fmt\"",
          "5:  \"os\"",
          "7:  \"github.com/rs/zerolog\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "4:  \"errors\"",
          "6:  \"io/fs\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "25:   Run: func(cmd *cobra.Command, args []string) {",
          "26:    logger.DisableLogger()",
          "27:    logger.EnableConsoleLogger(zerolog.DebugLevel)",
          "29:     err = os.MkdirAll(manDir, os.ModePerm)",
          "30:     if err != nil {",
          "31:      logger.WarnToConsole(\"Unable to generate man page files: %v\", err)",
          "",
          "[Removed Lines]",
          "28:    if _, err := os.Stat(manDir); os.IsNotExist(err) {",
          "",
          "[Added Lines]",
          "30:    if _, err := os.Stat(manDir); errors.Is(err, fs.ErrNotExist) {",
          "",
          "---------------"
        ],
        "dataprovider/share.go||dataprovider/share.go": [
          "File: dataprovider/share.go -> dataprovider/share.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "21: const (",
          "22:  ShareScopeRead ShareScope = iota + 1",
          "23:  ShareScopeWrite",
          "24: )",
          "26: const (",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "24:  ShareScopeReadWrite",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "65: func (s *Share) GetScopeAsString() string {",
          "66:  switch s.Scope {",
          "70:   return \"Write\"",
          "71:  }",
          "72: }",
          "",
          "[Removed Lines]",
          "67:  case ShareScopeRead:",
          "68:   return \"Read\"",
          "69:  default:",
          "",
          "[Added Lines]",
          "68:  case ShareScopeWrite:",
          "70:  case ShareScopeReadWrite:",
          "71:   return \"Read/Write\"",
          "72:  default:",
          "73:   return \"Read\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "194:   s.Paths[idx] = util.CleanPath(s.Paths[idx])",
          "195:  }",
          "196:  s.Paths = util.RemoveDuplicates(s.Paths)",
          "198:   return util.NewValidationError(\"the write share scope requires exactly one path\")",
          "199:  }",
          "",
          "[Removed Lines]",
          "197:  if s.Scope == ShareScopeWrite && len(s.Paths) != 1 {",
          "",
          "[Added Lines]",
          "200:  if s.Scope >= ShareScopeWrite && len(s.Paths) != 1 {",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "220:  if s.Name == \"\" {",
          "221:   return util.NewValidationError(\"name is mandatory\")",
          "222:  }",
          "224:   return util.NewValidationError(fmt.Sprintf(\"invalid scope: %v\", s.Scope))",
          "225:  }",
          "226:  if err := s.validatePaths(); err != nil {",
          "",
          "[Removed Lines]",
          "223:  if s.Scope != ShareScopeRead && s.Scope != ShareScopeWrite {",
          "",
          "[Added Lines]",
          "226:  if s.Scope < ShareScopeRead || s.Scope > ShareScopeReadWrite {",
          "",
          "---------------"
        ],
        "ftpd/ftpd_test.go||ftpd/ftpd_test.go": [
          "File: ftpd/ftpd_test.go -> ftpd/ftpd_test.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "6:  \"crypto/tls\"",
          "7:  \"encoding/hex\"",
          "8:  \"encoding/json\"",
          "9:  \"fmt\"",
          "10:  \"io\"",
          "11:  \"net\"",
          "12:  \"net/http\"",
          "13:  \"os\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "9:  \"errors\"",
          "12:  \"io/fs\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "3464: func createTestFile(path string, size int64) error {",
          "3465:  baseDir := filepath.Dir(path)",
          "3467:   err = os.MkdirAll(baseDir, os.ModePerm)",
          "3468:   if err != nil {",
          "3469:    return err",
          "",
          "[Removed Lines]",
          "3466:  if _, err := os.Stat(baseDir); os.IsNotExist(err) {",
          "",
          "[Added Lines]",
          "3468:  if _, err := os.Stat(baseDir); errors.Is(err, fs.ErrNotExist) {",
          "",
          "---------------"
        ],
        "ftpd/internal_test.go||ftpd/internal_test.go": [
          "File: ftpd/internal_test.go -> ftpd/internal_test.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: import (",
          "4:  \"crypto/tls\"",
          "5:  \"crypto/x509\"",
          "6:  \"fmt\"",
          "7:  \"net\"",
          "8:  \"os\"",
          "9:  \"path/filepath\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "6:  \"errors\"",
          "8:  \"io/fs\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "735:  assert.NoError(t, err)",
          "736:  _, err = connection.GetAvailableSpace(\"/missing-path\")",
          "737:  assert.Error(t, err)",
          "739: }",
          "741: func TestUploadOverwriteErrors(t *testing.T) {",
          "",
          "[Removed Lines]",
          "738:  assert.True(t, os.IsNotExist(err))",
          "",
          "[Added Lines]",
          "740:  assert.True(t, errors.Is(err, fs.ErrNotExist))",
          "",
          "---------------"
        ],
        "httpd/api_http_user.go||httpd/api_http_user.go": [
          "File: httpd/api_http_user.go -> httpd/api_http_user.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "290:   }",
          "291:   defer file.Close()",
          "294:   writer, err := connection.getFileWriter(filePath)",
          "295:   if err != nil {",
          "296:    sendAPIResponse(w, r, err, fmt.Sprintf(\"Unable to write file %#v\", f.Filename), getMappedStatusCode(err))",
          "",
          "[Removed Lines]",
          "293:   filePath := path.Join(parentDir, f.Filename)",
          "",
          "[Added Lines]",
          "293:   filePath := path.Join(parentDir, path.Base(util.CleanPath(f.Filename)))",
          "",
          "---------------"
        ],
        "httpd/api_shares.go||httpd/api_shares.go": [
          "File: httpd/api_shares.go -> httpd/api_shares.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "154: func (s *httpdServer) readBrowsableShareContents(w http.ResponseWriter, r *http.Request) {",
          "155:  r.Body = http.MaxBytesReader(w, r.Body, maxRequestSize)",
          "157:  if err != nil {",
          "158:   return",
          "159:  }",
          "",
          "[Removed Lines]",
          "156:  share, connection, err := s.checkPublicShare(w, r, dataprovider.ShareScopeRead, false)",
          "",
          "[Added Lines]",
          "156:  validScopes := []dataprovider.ShareScope{dataprovider.ShareScopeRead, dataprovider.ShareScopeReadWrite}",
          "157:  share, connection, err := s.checkPublicShare(w, r, validScopes, false)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "184: func (s *httpdServer) downloadBrowsableSharedFile(w http.ResponseWriter, r *http.Request) {",
          "185:  r.Body = http.MaxBytesReader(w, r.Body, maxRequestSize)",
          "187:  if err != nil {",
          "188:   return",
          "189:  }",
          "",
          "[Removed Lines]",
          "186:  share, connection, err := s.checkPublicShare(w, r, dataprovider.ShareScopeRead, false)",
          "",
          "[Added Lines]",
          "187:  validScopes := []dataprovider.ShareScope{dataprovider.ShareScopeRead, dataprovider.ShareScopeReadWrite}",
          "188:  share, connection, err := s.checkPublicShare(w, r, validScopes, false)",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "233: func (s *httpdServer) downloadFromShare(w http.ResponseWriter, r *http.Request) {",
          "234:  r.Body = http.MaxBytesReader(w, r.Body, maxRequestSize)",
          "236:  if err != nil {",
          "237:   return",
          "238:  }",
          "",
          "[Removed Lines]",
          "235:  share, connection, err := s.checkPublicShare(w, r, dataprovider.ShareScopeRead, false)",
          "",
          "[Added Lines]",
          "237:  validScopes := []dataprovider.ShareScope{dataprovider.ShareScopeRead, dataprovider.ShareScopeReadWrite}",
          "238:  share, connection, err := s.checkPublicShare(w, r, validScopes, false)",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "264:    connection.Log(logger.LevelInfo, \"denying share read due to quota limits\")",
          "265:    sendAPIResponse(w, r, err, \"\", getMappedStatusCode(err))",
          "266:   }",
          "268:   renderCompressedFiles(w, connection, \"/\", share.Paths, &share)",
          "269:   return",
          "270:  }",
          "",
          "[Removed Lines]",
          "267:   w.Header().Set(\"Content-Disposition\", fmt.Sprintf(\"attachment; filename=\\\"share-%v.zip\\\"\", share.ShareID))",
          "",
          "[Added Lines]",
          "270:   w.Header().Set(\"Content-Disposition\", fmt.Sprintf(\"attachment; filename=\\\"share-%v.zip\\\"\", share.Name))",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "287:   r.Body = http.MaxBytesReader(w, r.Body, maxUploadFileSize)",
          "288:  }",
          "289:  name := getURLParam(r, \"name\")",
          "291:  if err != nil {",
          "292:   return",
          "293:  }",
          "296:   sendAPIResponse(w, r, err, \"Uploading outside the share is not allowed\", http.StatusForbidden)",
          "297:   return",
          "298:  }",
          "",
          "[Removed Lines]",
          "290:  share, connection, err := s.checkPublicShare(w, r, dataprovider.ShareScopeWrite, false)",
          "294:  filePath := path.Join(share.Paths[0], name)",
          "295:  if path.Dir(filePath) != share.Paths[0] {",
          "",
          "[Added Lines]",
          "293:  validScopes := []dataprovider.ShareScope{dataprovider.ShareScopeWrite, dataprovider.ShareScopeReadWrite}",
          "294:  share, connection, err := s.checkPublicShare(w, r, validScopes, false)",
          "298:  filePath := util.CleanPath(path.Join(share.Paths[0], name))",
          "299:  expectedPrefix := share.Paths[0]",
          "300:  if !strings.HasSuffix(expectedPrefix, \"/\") {",
          "301:   expectedPrefix += \"/\"",
          "302:  }",
          "303:  if !strings.HasPrefix(filePath, expectedPrefix) {",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "312:  if maxUploadFileSize > 0 {",
          "313:   r.Body = http.MaxBytesReader(w, r.Body, maxUploadFileSize)",
          "314:  }",
          "316:  if err != nil {",
          "317:   return",
          "318:  }",
          "",
          "[Removed Lines]",
          "315:  share, connection, err := s.checkPublicShare(w, r, dataprovider.ShareScopeWrite, false)",
          "",
          "[Added Lines]",
          "323:  validScopes := []dataprovider.ShareScope{dataprovider.ShareScopeWrite, dataprovider.ShareScopeReadWrite}",
          "324:  share, connection, err := s.checkPublicShare(w, r, validScopes, false)",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "361:  }",
          "362: }",
          "365:  isWebClient bool,",
          "366: ) (dataprovider.Share, *Connection, error) {",
          "367:  renderError := func(err error, message string, statusCode int) {",
          "",
          "[Removed Lines]",
          "364: func (s *httpdServer) checkPublicShare(w http.ResponseWriter, r *http.Request, shareShope dataprovider.ShareScope,",
          "",
          "[Added Lines]",
          "373: func (s *httpdServer) checkPublicShare(w http.ResponseWriter, r *http.Request, validScopes []dataprovider.ShareScope,",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "382:   renderError(err, \"\", statusCode)",
          "383:   return share, nil, err",
          "384:  }",
          "386:   renderError(nil, \"Invalid share scope\", http.StatusForbidden)",
          "387:   return share, nil, errors.New(\"invalid share scope\")",
          "388:  }",
          "",
          "[Removed Lines]",
          "385:  if share.Scope != shareShope {",
          "",
          "[Added Lines]",
          "394:  if !util.Contains(validScopes, share.Scope) {",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "406:    return share, nil, dataprovider.ErrInvalidCredentials",
          "407:   }",
          "408:  }",
          "410:  if err != nil {",
          "411:   renderError(err, \"\", getRespStatus(err))",
          "412:   return share, nil, err",
          "413:  }",
          "419:  connID := xid.New().String()",
          "420:  connection := &Connection{",
          "421:   BaseConnection: common.NewBaseConnection(connID, common.ProtocolHTTPShare, util.GetHTTPLocalAddress(r),",
          "",
          "[Removed Lines]",
          "409:  user, err := dataprovider.GetUserWithGroupSettings(share.Username)",
          "414:  if user.MustSetSecondFactorForProtocol(common.ProtocolHTTP) {",
          "415:   err := util.NewMethodDisabledError(\"two-factor authentication requirements not met\")",
          "416:   renderError(err, \"\", getRespStatus(err))",
          "417:   return share, nil, err",
          "418:  }",
          "",
          "[Added Lines]",
          "418:  user, err := getUserForShare(share)",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "426:  return share, connection, nil",
          "427: }",
          "429: func validateBrowsableShare(share dataprovider.Share, connection *Connection) error {",
          "430:  if len(share.Paths) != 1 {",
          "431:   return util.NewValidationError(\"a share with multiple paths is not browsable\")",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "433: func getUserForShare(share dataprovider.Share) (dataprovider.User, error) {",
          "434:  user, err := dataprovider.GetUserWithGroupSettings(share.Username)",
          "435:  if err != nil {",
          "436:   return user, err",
          "437:  }",
          "438:  if !user.CanManageShares() {",
          "439:   return user, util.NewRecordNotFoundError(\"this share does not exist\")",
          "440:  }",
          "441:  if share.Password == \"\" && util.Contains(user.Filters.WebClient, sdk.WebClientShareNoPasswordDisabled) {",
          "442:   return user, fmt.Errorf(\"sharing without a password was disabled: %w\", os.ErrPermission)",
          "443:  }",
          "444:  if user.MustSetSecondFactorForProtocol(common.ProtocolHTTP) {",
          "445:   return user, util.NewMethodDisabledError(\"two-factor authentication requirements not met\")",
          "446:  }",
          "447:  return user, nil",
          "448: }",
          "",
          "---------------"
        ],
        "httpd/api_utils.go||httpd/api_utils.go": [
          "File: httpd/api_utils.go -> httpd/api_utils.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "6:  \"errors\"",
          "7:  \"fmt\"",
          "8:  \"io\"",
          "9:  \"mime\"",
          "10:  \"net/http\"",
          "11:  \"net/url\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "9:  \"io/fs\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "79:  if _, ok := err.(*util.RecordNotFoundError); ok {",
          "80:   return http.StatusNotFound",
          "81:  }",
          "83:   return http.StatusBadRequest",
          "84:  }",
          "86:   return http.StatusForbidden",
          "87:  }",
          "88:  if errors.Is(err, plugin.ErrNoSearcher) || errors.Is(err, dataprovider.ErrNotImplemented) {",
          "",
          "[Removed Lines]",
          "82:  if os.IsNotExist(err) {",
          "85:  if os.IsPermission(err) || errors.Is(err, dataprovider.ErrLoginNotAllowedFromIP) {",
          "",
          "[Added Lines]",
          "83:  if errors.Is(err, fs.ErrNotExist) {",
          "86:  if errors.Is(err, fs.ErrPermission) || errors.Is(err, dataprovider.ErrLoginNotAllowedFromIP) {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "241:   return err",
          "242:  }",
          "243:  if info.IsDir() {",
          "245:   if err != nil {",
          "246:    conn.Log(logger.LevelDebug, \"unable to create zip entry %#v: %v\", entryPath, err)",
          "247:    return err",
          "",
          "[Removed Lines]",
          "244:   _, err := wr.Create(getZipEntryName(entryPath, baseDir) + \"/\")",
          "",
          "[Added Lines]",
          "245:   _, err := wr.CreateHeader(&zip.FileHeader{",
          "246:    Name:     getZipEntryName(entryPath, baseDir) + \"/\",",
          "247:    Method:   zip.Deflate,",
          "248:    Modified: info.ModTime(),",
          "249:   })",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "271:  }",
          "272:  defer reader.Close()",
          "275:  if err != nil {",
          "276:   conn.Log(logger.LevelDebug, \"unable to create zip entry %#v: %v\", entryPath, err)",
          "277:   return err",
          "",
          "[Removed Lines]",
          "274:  f, err := wr.Create(getZipEntryName(entryPath, baseDir))",
          "",
          "[Added Lines]",
          "279:  f, err := wr.CreateHeader(&zip.FileHeader{",
          "280:   Name:     getZipEntryName(entryPath, baseDir),",
          "281:   Method:   zip.Deflate,",
          "282:   Modified: info.ModTime(),",
          "283:  })",
          "",
          "---------------"
        ],
        "httpd/httpd_test.go||httpd/httpd_test.go": [
          "File: httpd/httpd_test.go -> httpd/httpd_test.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "7:  \"errors\"",
          "8:  \"fmt\"",
          "9:  \"io\"",
          "10:  \"math\"",
          "11:  \"mime/multipart\"",
          "12:  \"net\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "10:  \"io/fs\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "8561:  waitForUsersQuotaScan(t, token)",
          "8563:  _, err = os.Stat(user.HomeDir)",
          "8565:   err = os.MkdirAll(user.HomeDir, os.ModePerm)",
          "8566:   assert.NoError(t, err)",
          "8567:  }",
          "",
          "[Removed Lines]",
          "8564:  if err != nil && os.IsNotExist(err) {",
          "",
          "[Added Lines]",
          "8565:  if err != nil && errors.Is(err, fs.ErrNotExist) {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "8725:  assert.True(t, common.QuotaScans.RemoveVFolderQuotaScan(folderName))",
          "8727:  _, err = os.Stat(mappedPath)",
          "8729:   err = os.MkdirAll(mappedPath, os.ModePerm)",
          "8730:   assert.NoError(t, err)",
          "8731:  }",
          "",
          "[Removed Lines]",
          "8728:  if err != nil && os.IsNotExist(err) {",
          "",
          "[Added Lines]",
          "8729:  if err != nil && errors.Is(err, fs.ErrNotExist) {",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "10137:  checkResponseCode(t, http.StatusForbidden, rr)",
          "10138:  assert.Contains(t, rr.Body.String(), \"permission denied\")",
          "10140:  body = new(bytes.Buffer)",
          "10141:  writer = multipart.NewWriter(body)",
          "10142:  part, err := writer.CreateFormFile(\"filename\", \"file1.txt\")",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "10141:  user.Permissions[\"/\"] = []string{dataprovider.PermAny}",
          "10142:  user, _, err = httpdtest.UpdateUser(user, http.StatusOK, \"\")",
          "10143:  assert.NoError(t, err)",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "10155:  checkResponseCode(t, http.StatusBadRequest, rr)",
          "10156:  assert.Contains(t, rr.Body.String(), \"No files uploaded!\")",
          "10159:  share.Paths = []string{\"/missing\"}",
          "10160:  err = dataprovider.UpdateShare(&share, user.Username, \"\")",
          "10161:  assert.NoError(t, err)",
          "",
          "[Removed Lines]",
          "10158:  share.Scope = dataprovider.ShareScopeRead",
          "",
          "[Added Lines]",
          "10163:  user.Filters.WebClient = []string{sdk.WebClientSharesDisabled}",
          "10164:  user, _, err = httpdtest.UpdateUser(user, http.StatusOK, \"\")",
          "10165:  assert.NoError(t, err)",
          "10167:  req, err = http.NewRequest(http.MethodPost, sharesPath+\"/\"+objectID, reader)",
          "10168:  assert.NoError(t, err)",
          "10169:  req.Header.Add(\"Content-Type\", writer.FormDataContentType())",
          "10170:  req.SetBasicAuth(defaultUsername, defaultPassword)",
          "10171:  rr = executeRequest(req)",
          "10172:  checkResponseCode(t, http.StatusNotFound, rr)",
          "10174:  user.Filters.WebClient = []string{sdk.WebClientShareNoPasswordDisabled}",
          "10175:  user, _, err = httpdtest.UpdateUser(user, http.StatusOK, \"\")",
          "10176:  assert.NoError(t, err)",
          "10177:  share.Password = \"\"",
          "10178:  err = dataprovider.UpdateShare(&share, user.Username, \"\")",
          "10179:  assert.NoError(t, err)",
          "10181:  req, err = http.NewRequest(http.MethodPost, sharesPath+\"/\"+objectID, reader)",
          "10182:  assert.NoError(t, err)",
          "10183:  req.Header.Add(\"Content-Type\", writer.FormDataContentType())",
          "10184:  req.SetBasicAuth(defaultUsername, defaultPassword)",
          "10185:  rr = executeRequest(req)",
          "10186:  checkResponseCode(t, http.StatusForbidden, rr)",
          "10187:  assert.Contains(t, rr.Body.String(), \"sharing without a password was disabled\")",
          "10189:  user.Filters.WebClient = []string{sdk.WebClientInfoChangeDisabled}",
          "10190:  user, _, err = httpdtest.UpdateUser(user, http.StatusOK, \"\")",
          "10191:  assert.NoError(t, err)",
          "10193:  share.Scope = dataprovider.ShareScopeReadWrite",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "10347:  if assert.NoError(t, err) {",
          "10348:   assert.InDelta(t, util.GetTimeAsMsSinceEpoch(time.Now()), util.GetTimeAsMsSinceEpoch(info.ModTime()), float64(3000))",
          "10349:  }",
          "10357:  req, err = http.NewRequest(http.MethodPost, path.Join(sharesPath, objectID, \"dir\", \"file.dat\"), bytes.NewBuffer(content))",
          "10358:  assert.NoError(t, err)",
          "",
          "[Removed Lines]",
          "10351:  req, err = http.NewRequest(http.MethodPost, path.Join(sharesPath, objectID, \"%2Fdir%2Ffile1.txt\"), bytes.NewBuffer(content))",
          "10352:  assert.NoError(t, err)",
          "10353:  req.SetBasicAuth(defaultUsername, defaultPassword)",
          "10354:  rr = executeRequest(req)",
          "10355:  checkResponseCode(t, http.StatusForbidden, rr)",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "10391:  checkResponseCode(t, http.StatusNotFound, rr)",
          "10392: }",
          "10394: func TestShareUncompressed(t *testing.T) {",
          "10395:  user, _, err := httpdtest.AddUser(getTestUser(), http.StatusCreated)",
          "10396:  assert.NoError(t, err)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "10423: func TestShareReadWrite(t *testing.T) {",
          "10424:  u := getTestUser()",
          "10425:  u.Filters.StartDirectory = path.Join(\"/start\", \"dir\")",
          "10426:  user, _, err := httpdtest.AddUser(u, http.StatusCreated)",
          "10427:  assert.NoError(t, err)",
          "10428:  token, err := getJWTAPIUserTokenFromTestServer(defaultUsername, defaultPassword)",
          "10429:  assert.NoError(t, err)",
          "10430:  testFileName := \"test.txt\"",
          "10432:  share := dataprovider.Share{",
          "10433:   Name:      \"test share rw\",",
          "10434:   Scope:     dataprovider.ShareScopeReadWrite,",
          "10435:   Paths:     []string{user.Filters.StartDirectory},",
          "10436:   Password:  defaultPassword,",
          "10437:   MaxTokens: 0,",
          "10438:  }",
          "10439:  asJSON, err := json.Marshal(share)",
          "10440:  assert.NoError(t, err)",
          "10441:  req, err := http.NewRequest(http.MethodPost, userSharesPath, bytes.NewBuffer(asJSON))",
          "10442:  assert.NoError(t, err)",
          "10443:  setBearerForReq(req, token)",
          "10444:  rr := executeRequest(req)",
          "10445:  checkResponseCode(t, http.StatusCreated, rr)",
          "10446:  objectID := rr.Header().Get(\"X-Object-ID\")",
          "10447:  assert.NotEmpty(t, objectID)",
          "10449:  content := []byte(\"shared rw content\")",
          "10450:  req, err = http.NewRequest(http.MethodPost, path.Join(sharesPath, objectID, testFileName), bytes.NewBuffer(content))",
          "10451:  assert.NoError(t, err)",
          "10452:  req.SetBasicAuth(defaultUsername, defaultPassword)",
          "10453:  rr = executeRequest(req)",
          "10454:  checkResponseCode(t, http.StatusCreated, rr)",
          "10455:  assert.FileExists(t, filepath.Join(user.GetHomeDir(), user.Filters.StartDirectory, testFileName))",
          "10457:  req, err = http.NewRequest(http.MethodGet, path.Join(webClientPubSharesPath, objectID, \"browse?path=%2F\"), nil)",
          "10458:  assert.NoError(t, err)",
          "10459:  req.SetBasicAuth(defaultUsername, defaultPassword)",
          "10460:  rr = executeRequest(req)",
          "10461:  checkResponseCode(t, http.StatusOK, rr)",
          "10463:  req, err = http.NewRequest(http.MethodGet, path.Join(webClientPubSharesPath, objectID, \"browse?path=\"+testFileName), nil)",
          "10464:  assert.NoError(t, err)",
          "10465:  req.SetBasicAuth(defaultUsername, defaultPassword)",
          "10466:  rr = executeRequest(req)",
          "10467:  checkResponseCode(t, http.StatusOK, rr)",
          "10468:  contentDisposition := rr.Header().Get(\"Content-Disposition\")",
          "10469:  assert.NotEmpty(t, contentDisposition)",
          "10471:  req, err = http.NewRequest(http.MethodPost, path.Join(sharesPath, objectID)+\"/\"+url.PathEscape(\"../\"+testFileName),",
          "10472:   bytes.NewBuffer(content))",
          "10473:  assert.NoError(t, err)",
          "10474:  req.SetBasicAuth(defaultUsername, defaultPassword)",
          "10475:  rr = executeRequest(req)",
          "10476:  checkResponseCode(t, http.StatusForbidden, rr)",
          "10477:  assert.Contains(t, rr.Body.String(), \"Uploading outside the share is not allowed\")",
          "10479:  req, err = http.NewRequest(http.MethodPost, path.Join(sharesPath, objectID)+\"/\"+url.PathEscape(\"/../../\"+testFileName),",
          "10480:   bytes.NewBuffer(content))",
          "10481:  assert.NoError(t, err)",
          "10482:  req.SetBasicAuth(defaultUsername, defaultPassword)",
          "10483:  rr = executeRequest(req)",
          "10484:  checkResponseCode(t, http.StatusForbidden, rr)",
          "10485:  assert.Contains(t, rr.Body.String(), \"Uploading outside the share is not allowed\")",
          "10487:  _, err = httpdtest.RemoveUser(user, http.StatusOK)",
          "10488:  assert.NoError(t, err)",
          "10489:  err = os.RemoveAll(user.GetHomeDir())",
          "10490:  assert.NoError(t, err)",
          "10491: }",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "10799:  req, err = http.NewRequest(http.MethodGet, path.Join(sharesPath, objectID, \"dirs\"), nil)",
          "10800:  assert.NoError(t, err)",
          "10801:  rr = executeRequest(req)",
          "10803:  assert.Contains(t, rr.Body.String(), \"unable to check the share directory\")",
          "10805:  share = dataprovider.Share{",
          "",
          "[Removed Lines]",
          "10802:  checkResponseCode(t, http.StatusInternalServerError, rr)",
          "",
          "[Added Lines]",
          "10901:  checkResponseCode(t, http.StatusBadRequest, rr)",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "10868:  rr = executeRequest(req)",
          "10869:  checkResponseCode(t, http.StatusForbidden, rr)",
          "10870:  assert.Contains(t, rr.Body.String(), \"two-factor authentication requirements not met\")",
          "10872:  _, err = httpdtest.RemoveUser(user, http.StatusOK)",
          "10873:  assert.NoError(t, err)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "10970:  user.Filters.TwoFactorAuthProtocols = []string{common.ProtocolSSH}",
          "10971:  _, _, err = httpdtest.UpdateUser(user, http.StatusOK, \"\")",
          "10972:  assert.NoError(t, err)",
          "10974:  share.Scope = dataprovider.ShareScopeReadWrite",
          "10975:  asJSON, err = json.Marshal(share)",
          "10976:  assert.NoError(t, err)",
          "10977:  req, err = http.NewRequest(http.MethodPost, userSharesPath, bytes.NewBuffer(asJSON))",
          "10978:  assert.NoError(t, err)",
          "10979:  setBearerForReq(req, token)",
          "10980:  rr = executeRequest(req)",
          "10981:  checkResponseCode(t, http.StatusCreated, rr)",
          "10982:  objectID = rr.Header().Get(\"X-Object-ID\")",
          "10983:  assert.NotEmpty(t, objectID)",
          "10984:  req, err = http.NewRequest(http.MethodGet, path.Join(webClientPubSharesPath, objectID, \"browse?path=%2F\"), nil)",
          "10985:  assert.NoError(t, err)",
          "10986:  rr = executeRequest(req)",
          "10987:  checkResponseCode(t, http.StatusOK, rr)",
          "10989:  req, err = http.NewRequest(http.MethodGet, path.Join(webClientPubSharesPath, objectID, \"upload\"), nil)",
          "10990:  assert.NoError(t, err)",
          "10991:  req.SetBasicAuth(defaultUsername, defaultPassword)",
          "10992:  rr = executeRequest(req)",
          "10993:  checkResponseCode(t, http.StatusFound, rr)",
          "10994:  location := rr.Header().Get(\"Location\")",
          "10995:  assert.Equal(t, path.Join(webClientPubSharesPath, objectID, \"browse\"), location)",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "18854: func createTestFile(path string, size int64) error {",
          "18855:  baseDir := filepath.Dir(path)",
          "18857:   err = os.MkdirAll(baseDir, os.ModePerm)",
          "18858:   if err != nil {",
          "18859:    return err",
          "",
          "[Removed Lines]",
          "18856:  if _, err := os.Stat(baseDir); os.IsNotExist(err) {",
          "",
          "[Added Lines]",
          "18981:  if _, err := os.Stat(baseDir); errors.Is(err, fs.ErrNotExist) {",
          "",
          "---------------"
        ],
        "httpd/internal_test.go||httpd/internal_test.go": [
          "File: httpd/internal_test.go -> httpd/internal_test.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "2292: func TestBrowsableSharePaths(t *testing.T) {",
          "2293:  share := dataprovider.Share{",
          "2295:  }",
          "2296:  req, err := http.NewRequest(http.MethodGet, \"/share\", nil)",
          "2297:  require.NoError(t, err)",
          "",
          "[Removed Lines]",
          "2294:   Paths: []string{\"/\"},",
          "",
          "[Added Lines]",
          "2294:   Paths:    []string{\"/\"},",
          "2295:   Username: defaultAdminUsername,",
          "2296:  }",
          "2297:  _, err := getUserForShare(share)",
          "2298:  if assert.Error(t, err) {",
          "2299:   _, ok := err.(*util.RecordNotFoundError)",
          "2300:   assert.True(t, ok)",
          "",
          "---------------"
        ],
        "httpd/webclient.go||httpd/webclient.go": [
          "File: httpd/webclient.go -> httpd/webclient.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "144: type shareFilesPage struct {",
          "145:  baseClientPage",
          "152: }",
          "154: type shareUploadPage struct {",
          "",
          "[Removed Lines]",
          "146:  CurrentDir  string",
          "147:  DirsURL     string",
          "148:  FilesURL    string",
          "149:  DownloadURL string",
          "150:  Error       string",
          "151:  Paths       []dirMapping",
          "",
          "[Added Lines]",
          "146:  CurrentDir    string",
          "147:  DirsURL       string",
          "148:  FilesURL      string",
          "149:  DownloadURL   string",
          "150:  UploadBaseURL string",
          "151:  Error         string",
          "152:  Paths         []dirMapping",
          "153:  Scope         dataprovider.ShareScope",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "512:   DirsURL:        path.Join(webClientPubSharesPath, share.ShareID, \"dirs\"),",
          "513:   FilesURL:       currentURL,",
          "514:   DownloadURL:    path.Join(webClientPubSharesPath, share.ShareID),",
          "515:   Error:          error,",
          "516:   Paths:          getDirMapping(dirName, currentURL),",
          "517:  }",
          "518:  renderClientTemplate(w, templateShareFiles, data)",
          "519: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "517:   UploadBaseURL:  path.Join(webClientPubSharesPath, share.ShareID, url.PathEscape(dirName)),",
          "520:   Scope:          share.Scope,",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "626: func (s *httpdServer) handleShareGetDirContents(w http.ResponseWriter, r *http.Request) {",
          "627:  r.Body = http.MaxBytesReader(w, r.Body, maxRequestSize)",
          "629:  if err != nil {",
          "630:   return",
          "631:  }",
          "",
          "[Removed Lines]",
          "628:  share, connection, err := s.checkPublicShare(w, r, dataprovider.ShareScopeRead, true)",
          "",
          "[Added Lines]",
          "632:  validScopes := []dataprovider.ShareScope{dataprovider.ShareScopeRead, dataprovider.ShareScopeReadWrite}",
          "633:  share, connection, err := s.checkPublicShare(w, r, validScopes, true)",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "675: func (s *httpdServer) handleClientUploadToShare(w http.ResponseWriter, r *http.Request) {",
          "676:  r.Body = http.MaxBytesReader(w, r.Body, maxRequestSize)",
          "678:  if err != nil {",
          "679:   return",
          "680:  }",
          "681:  s.renderUploadToSharePage(w, r, share)",
          "682: }",
          "684: func (s *httpdServer) handleShareGetFiles(w http.ResponseWriter, r *http.Request) {",
          "685:  r.Body = http.MaxBytesReader(w, r.Body, maxRequestSize)",
          "687:  if err != nil {",
          "688:   return",
          "689:  }",
          "",
          "[Removed Lines]",
          "677:  share, _, err := s.checkPublicShare(w, r, dataprovider.ShareScopeWrite, true)",
          "686:  share, connection, err := s.checkPublicShare(w, r, dataprovider.ShareScopeRead, true)",
          "",
          "[Added Lines]",
          "682:  validScopes := []dataprovider.ShareScope{dataprovider.ShareScopeWrite, dataprovider.ShareScopeReadWrite}",
          "683:  share, _, err := s.checkPublicShare(w, r, validScopes, true)",
          "687:  if share.Scope == dataprovider.ShareScopeReadWrite {",
          "688:   http.Redirect(w, r, path.Join(webClientPubSharesPath, share.ShareID, \"browse\"), http.StatusFound)",
          "689:   return",
          "690:  }",
          "696:  validScopes := []dataprovider.ShareScope{dataprovider.ShareScopeRead, dataprovider.ShareScopeReadWrite}",
          "697:  share, connection, err := s.checkPublicShare(w, r, validScopes, true)",
          "",
          "---------------"
        ],
        "logger/logger.go||logger/logger.go": [
          "File: logger/logger.go -> logger/logger.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "11: import (",
          "12:  \"errors\"",
          "13:  \"fmt\"",
          "14:  \"os\"",
          "15:  \"path/filepath\"",
          "16:  \"time\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "14:  \"io/fs\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "57:  SetLogTime(logUTCTime)",
          "58:  if isLogFilePathValid(logFilePath) {",
          "59:   logDir := filepath.Dir(logFilePath)",
          "61:    err = os.MkdirAll(logDir, os.ModePerm)",
          "62:    if err != nil {",
          "63:     fmt.Printf(\"unable to create log dir %#v: %v\", logDir, err)",
          "",
          "[Removed Lines]",
          "60:   if _, err := os.Stat(logDir); os.IsNotExist(err) {",
          "",
          "[Added Lines]",
          "61:   if _, err := os.Stat(logDir); errors.Is(err, fs.ErrNotExist) {",
          "",
          "---------------"
        ],
        "sftpd/server.go||sftpd/server.go": [
          "File: sftpd/server.go -> sftpd/server.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "7:  \"errors\"",
          "8:  \"fmt\"",
          "9:  \"io\"",
          "10:  \"net\"",
          "11:  \"os\"",
          "12:  \"path\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "10:  \"io/fs\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "755:  defaultHostKeys := []string{defaultPrivateRSAKeyName, defaultPrivateECDSAKeyName, defaultPrivateEd25519KeyName}",
          "756:  for _, k := range defaultHostKeys {",
          "757:   autoFile := filepath.Join(configDir, k)",
          "759:    logger.Info(logSender, \"\", \"No host keys configured and %#v does not exist; try to create a new host key\", autoFile)",
          "760:    logger.InfoToConsole(\"No host keys configured and %#v does not exist; try to create a new host key\", autoFile)",
          "761:    if k == defaultPrivateRSAKeyName {",
          "",
          "[Removed Lines]",
          "758:   if _, err = os.Stat(autoFile); os.IsNotExist(err) {",
          "",
          "[Added Lines]",
          "759:   if _, err = os.Stat(autoFile); errors.Is(err, fs.ErrNotExist) {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "780: func (c *Configuration) checkHostKeyAutoGeneration(configDir string) error {",
          "781:  for _, k := range c.HostKeys {",
          "782:   if filepath.IsAbs(k) {",
          "784:     keyName := filepath.Base(k)",
          "785:     switch keyName {",
          "786:     case defaultPrivateRSAKeyName:",
          "",
          "[Removed Lines]",
          "783:    if _, err := os.Stat(k); os.IsNotExist(err) {",
          "",
          "[Added Lines]",
          "784:    if _, err := os.Stat(k); errors.Is(err, fs.ErrNotExist) {",
          "",
          "---------------"
        ],
        "sftpd/sftpd_test.go||sftpd/sftpd_test.go": [
          "File: sftpd/sftpd_test.go -> sftpd/sftpd_test.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "10:  \"encoding/base64\"",
          "11:  \"encoding/binary\"",
          "12:  \"encoding/json\"",
          "13:  \"fmt\"",
          "14:  \"hash\"",
          "15:  \"io\"",
          "16:  \"math\"",
          "17:  \"net\"",
          "18:  \"net/http\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "13:  \"errors\"",
          "17:  \"io/fs\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1463:    assert.NoError(t, err)",
          "1464:    _, err = client.Stat(testFileName)",
          "1465:    assert.NoError(t, err)",
          "1467:    _, err = client.Stat(\"missing path\")",
          "1469:    _, err = client.Lstat(\"missing path\")",
          "1472:    newPerm := os.FileMode(0666)",
          "1473:    err = client.Chmod(testFileName, newPerm)",
          "",
          "[Removed Lines]",
          "1468:    assert.True(t, os.IsNotExist(err))",
          "1470:    assert.True(t, os.IsNotExist(err))",
          "",
          "[Added Lines]",
          "1470:    assert.True(t, errors.Is(err, fs.ErrNotExist))",
          "1472:    assert.True(t, errors.Is(err, fs.ErrNotExist))",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "6924:   err = os.Chmod(filepath.Join(user.GetHomeDir(), testDir), 0000)",
          "6925:   assert.NoError(t, err)",
          "6926:   err = client.Rename(testFileName, path.Join(testDir, testFileName))",
          "6928:   err = os.Chmod(filepath.Join(user.GetHomeDir(), testDir), os.ModePerm)",
          "6929:   assert.NoError(t, err)",
          "6930:   err = os.Remove(localDownloadPath)",
          "",
          "[Removed Lines]",
          "6927:   assert.True(t, os.IsPermission(err))",
          "",
          "[Added Lines]",
          "6929:   assert.True(t, errors.Is(err, fs.ErrPermission))",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "7253:   err = sftpUploadFile(testFilePath, testFileName, testFileSize, client)",
          "7254:   assert.NoError(t, err)",
          "7255:   err = client.Rename(testFileName, testFileName+\".rename\")",
          "7257:   _, err = client.Stat(testFileName)",
          "7258:   assert.NoError(t, err)",
          "7259:   err = os.Remove(testFilePath)",
          "",
          "[Removed Lines]",
          "7256:   assert.True(t, os.IsPermission(err))",
          "",
          "[Added Lines]",
          "7258:   assert.True(t, errors.Is(err, fs.ErrPermission))",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "7289:   err = sftpUploadFile(testFilePath, testFileName, testFileSize, client)",
          "7290:   assert.NoError(t, err)",
          "7291:   err = client.Rename(testFileName, testFileName+\".rename\")",
          "7293:   err = client.Remove(testFileName)",
          "7294:   assert.NoError(t, err)",
          "7295:   err = os.Remove(testFilePath)",
          "",
          "[Removed Lines]",
          "7292:   assert.True(t, os.IsPermission(err))",
          "",
          "[Added Lines]",
          "7294:   assert.True(t, errors.Is(err, fs.ErrPermission))",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "7474:   err = sftpUploadFile(testFilePath, testFileName, testFileSize, client)",
          "7475:   assert.NoError(t, err)",
          "7476:   err = sftpUploadFile(testFilePath, testFileNameSub, testFileSize, client)",
          "7478:   err = client.Symlink(testFileName, testFileNameSub+\".link\")",
          "7480:   err = client.Symlink(testFileName, testFileName+\".link\")",
          "7481:   assert.NoError(t, err)",
          "7482:   err = client.Rename(testFileName, testFileNameSub+\".rename\")",
          "7484:   err = client.Rename(testFileName, testFileName+\".rename\")",
          "7485:   assert.NoError(t, err)",
          "7486:   err = sftpUploadFile(testFilePath, testFileName, testFileSize, client)",
          "",
          "[Removed Lines]",
          "7477:   assert.True(t, os.IsPermission(err))",
          "7479:   assert.True(t, os.IsPermission(err))",
          "7483:   assert.True(t, os.IsPermission(err))",
          "",
          "[Added Lines]",
          "7479:   assert.True(t, errors.Is(err, fs.ErrPermission))",
          "7481:   assert.True(t, errors.Is(err, fs.ErrPermission))",
          "7485:   assert.True(t, errors.Is(err, fs.ErrPermission))",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "7500:   err = client.Remove(testDir)",
          "7501:   assert.NoError(t, err)",
          "7502:   err = client.Remove(path.Join(\"/subdir\", \"file.dat\"))",
          "7504:   err = client.Remove(testFileName + \".rename\")",
          "7505:   assert.NoError(t, err)",
          "7506:   err = os.Remove(testFilePath)",
          "",
          "[Removed Lines]",
          "7503:   assert.True(t, os.IsPermission(err))",
          "",
          "[Added Lines]",
          "7505:   assert.True(t, errors.Is(err, fs.ErrPermission))",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "7532:   err = createTestFile(testFileSFTPPath, 16384)",
          "7533:   assert.NoError(t, err)",
          "7534:   err = sftpUploadFile(testFilePath, testFileName+\".new\", testFileSize, client)",
          "7536:   err = sftpUploadFile(testFilePath, testFileName, testFileSize, client)",
          "7537:   assert.NoError(t, err)",
          "7538:   err = os.Remove(testFilePath)",
          "",
          "[Removed Lines]",
          "7535:   assert.True(t, os.IsPermission(err))",
          "",
          "[Added Lines]",
          "7537:   assert.True(t, errors.Is(err, fs.ErrPermission))",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "7566:   assert.NoError(t, err)",
          "7567:   localDownloadPath := filepath.Join(homeBasePath, testDLFileName)",
          "7568:   err = sftpDownloadFile(testFileName, localDownloadPath, testFileSize, client)",
          "7570:   err = sftpUploadFile(testFilePath, testFileName, testFileSize, client)",
          "7572:   err = client.Chtimes(testFileName, time.Now(), time.Now())",
          "7574:   err = client.Rename(testFileName, testFileName+\".rename\")",
          "7576:   err = client.Symlink(testFileName, testFileName+\".link\")",
          "7578:   err = client.Remove(testFileName)",
          "7580:   err = os.Remove(localDownloadPath)",
          "7581:   assert.NoError(t, err)",
          "7582:   err = os.Remove(testFilePath)",
          "",
          "[Removed Lines]",
          "7569:   assert.True(t, os.IsPermission(err))",
          "7571:   assert.True(t, os.IsPermission(err))",
          "7573:   assert.True(t, os.IsPermission(err))",
          "7575:   assert.True(t, os.IsPermission(err))",
          "7577:   assert.True(t, os.IsPermission(err))",
          "7579:   assert.True(t, os.IsPermission(err))",
          "",
          "[Added Lines]",
          "7571:   assert.True(t, errors.Is(err, fs.ErrPermission))",
          "7573:   assert.True(t, errors.Is(err, fs.ErrPermission))",
          "7575:   assert.True(t, errors.Is(err, fs.ErrPermission))",
          "7577:   assert.True(t, errors.Is(err, fs.ErrPermission))",
          "7579:   assert.True(t, errors.Is(err, fs.ErrPermission))",
          "7581:   assert.True(t, errors.Is(err, fs.ErrPermission))",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "7611:   err = sftpUploadFile(testFilePath, testFileName, testFileSize, client)",
          "7612:   assert.NoError(t, err)",
          "7613:   err = client.Chtimes(\"/subdir/\", time.Now(), time.Now())",
          "7615:   err = client.Chtimes(\"subdir/\", time.Now(), time.Now())",
          "7617:   err = client.Chtimes(testFileName, time.Now(), time.Now())",
          "7618:   assert.NoError(t, err)",
          "7619:   err = os.Remove(testFilePath)",
          "",
          "[Removed Lines]",
          "7614:   assert.True(t, os.IsPermission(err))",
          "7616:   assert.True(t, os.IsPermission(err))",
          "",
          "[Added Lines]",
          "7616:   assert.True(t, errors.Is(err, fs.ErrPermission))",
          "7618:   assert.True(t, errors.Is(err, fs.ErrPermission))",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "7674:   _, err = client.ReadDir(\"/\")",
          "7675:   assert.NoError(t, err)",
          "7676:   _, err = client.ReadDir(\"/subdir\")",
          "7678:   err = client.RemoveDirectory(\"/subdir/dir\")",
          "7680:   err = client.Mkdir(\"/subdir/otherdir/dir\")",
          "7682:   err = client.Mkdir(\"/otherdir\")",
          "7683:   assert.NoError(t, err)",
          "7684:   err = client.Mkdir(\"/subdir/otherdir\")",
          "7685:   assert.NoError(t, err)",
          "7686:   err = client.Rename(\"/otherdir\", \"/subdir/otherdir/adir\")",
          "7688:   err = client.Symlink(\"/otherdir\", \"/subdir/otherdir\")",
          "7690:   err = client.Symlink(\"/otherdir\", \"/otherdir_link\")",
          "7691:   assert.NoError(t, err)",
          "7692:   err = client.Rename(\"/otherdir\", \"/otherdir1\")",
          "",
          "[Removed Lines]",
          "7677:   assert.True(t, os.IsPermission(err))",
          "7679:   assert.True(t, os.IsPermission(err))",
          "7681:   assert.True(t, os.IsPermission(err))",
          "7687:   assert.True(t, os.IsPermission(err))",
          "7689:   assert.True(t, os.IsPermission(err))",
          "",
          "[Added Lines]",
          "7679:   assert.True(t, errors.Is(err, fs.ErrPermission))",
          "7681:   assert.True(t, errors.Is(err, fs.ErrPermission))",
          "7683:   assert.True(t, errors.Is(err, fs.ErrPermission))",
          "7689:   assert.True(t, errors.Is(err, fs.ErrPermission))",
          "7691:   assert.True(t, errors.Is(err, fs.ErrPermission))",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "7718:    defer conn.Close()",
          "7719:    defer client.Close()",
          "7720:    err = client.Rename(\"/\", \"rootdir\")",
          "7722:    err = client.Symlink(\"/\", \"rootdir\")",
          "7724:    err = client.RemoveDirectory(\"/\")",
          "7726:   }",
          "7727:   if user.Username == defaultUsername {",
          "7728:    err = os.RemoveAll(user.GetHomeDir())",
          "",
          "[Removed Lines]",
          "7721:    assert.True(t, os.IsPermission(err))",
          "7723:    assert.True(t, os.IsPermission(err))",
          "7725:    assert.True(t, os.IsPermission(err))",
          "",
          "[Added Lines]",
          "7723:    assert.True(t, errors.Is(err, fs.ErrPermission))",
          "7725:    assert.True(t, errors.Is(err, fs.ErrPermission))",
          "7727:    assert.True(t, errors.Is(err, fs.ErrPermission))",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "8201:   _, err = client.StatVFS(\"missing-path\")",
          "8202:   assert.Error(t, err)",
          "8204:  }",
          "8205:  user.QuotaFiles = 100",
          "8206:  user.Filters.DisableFsChecks = true",
          "",
          "[Removed Lines]",
          "8203:   assert.True(t, os.IsNotExist(err))",
          "",
          "[Added Lines]",
          "8205:   assert.True(t, errors.Is(err, fs.ErrNotExist))",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "10525: func createTestFile(path string, size int64) error {",
          "10526:  baseDir := filepath.Dir(path)",
          "10528:   err = os.MkdirAll(baseDir, os.ModePerm)",
          "10529:   if err != nil {",
          "10530:    return err",
          "",
          "[Removed Lines]",
          "10527:  if _, err := os.Stat(baseDir); os.IsNotExist(err) {",
          "",
          "[Added Lines]",
          "10529:  if _, err := os.Stat(baseDir); errors.Is(err, fs.ErrNotExist) {",
          "",
          "---------------"
        ],
        "templates/webadmin/mfa.html||templates/webadmin/mfa.html": [
          "File: templates/webadmin/mfa.html -> templates/webadmin/mfa.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: {{define \"title\"}}{{.Title}}{{end}}",
          "5: {{define \"page_body\"}}",
          "7: <div class=\"card shadow mb-4\">",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "5: {{define \"extra_css\"}}",
          "6: <link href=\"{{.StaticURL}}/vendor/bootstrap-select/css/bootstrap-select.min.css\" rel=\"stylesheet\">",
          "7: {{end}}",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "26:         <div class=\"form-group row\">",
          "27:             <label for=\"idConfig\" class=\"col-sm-2 col-form-label\">Configuration</label>",
          "28:             <div class=\"col-sm-10\">",
          "30:                     <option value=\"\">None</option>",
          "31:                     {{range .TOTPConfigs}}",
          "32:                     <option value=\"{{.}}\" {{if eq . $.TOTPConfig.ConfigName}}selected{{end}}>{{.}}</option>",
          "",
          "[Removed Lines]",
          "29:                 <select class=\"form-control\" id=\"idConfig\" name=\"config_name\">",
          "",
          "[Added Lines]",
          "33:                 <select class=\"form-control selectpicker\" id=\"idConfig\" name=\"config_name\">",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "127: {{end}}",
          "129: {{define \"extra_js\"}}",
          "130: <script type=\"text/javascript\">",
          "132:     function totpGenerate() {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "134: <script src=\"{{.StaticURL}}/vendor/bootstrap-select/js/bootstrap-select.min.js\"></script>",
          "",
          "---------------"
        ],
        "templates/webclient/mfa.html||templates/webclient/mfa.html": [
          "File: templates/webclient/mfa.html -> templates/webclient/mfa.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: {{define \"title\"}}{{.Title}}{{end}}",
          "5: {{define \"page_body\"}}",
          "7: <div class=\"card shadow mb-4\">",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "5: {{define \"extra_css\"}}",
          "6: <link href=\"{{.StaticURL}}/vendor/bootstrap-select/css/bootstrap-select.min.css\" rel=\"stylesheet\">",
          "7: {{end}}",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "33:         <div class=\"form-group row totpProtocols\">",
          "34:             <label for=\"idProtocols\" class=\"col-sm-3 col-form-label\">Require two-factor auth for</label>",
          "35:             <div class=\"col-sm-9\">",
          "37:                     {{range $protocol := .Protocols}}",
          "38:                     <option value=\"{{$protocol}}\" {{range $p :=$.TOTPConfig.Protocols }}{{if eq $p $protocol}}selected{{end}}{{end}}>{{$protocol}}",
          "39:                     </option>",
          "",
          "[Removed Lines]",
          "36:                 <select class=\"form-control\" id=\"idProtocols\" name=\"multi_factor_protocols\" multiple>",
          "",
          "[Added Lines]",
          "40:                 <select class=\"form-control selectpicker\" id=\"idProtocols\" name=\"multi_factor_protocols\" multiple>",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "51:         <div class=\"form-group row\">",
          "52:             <label for=\"idConfig\" class=\"col-sm-3 col-form-label\">Configuration</label>",
          "53:             <div class=\"col-sm-9\">",
          "55:                     <option value=\"\">None</option>",
          "56:                     {{range .TOTPConfigs}}",
          "57:                     <option value=\"{{.}}\" {{if eq . $.TOTPConfig.ConfigName}}selected{{end}}>{{.}}</option>",
          "",
          "[Removed Lines]",
          "54:                 <select class=\"form-control\" id=\"idConfig\" name=\"config_name\">",
          "",
          "[Added Lines]",
          "58:                 <select class=\"form-control selectpicker\" id=\"idConfig\" name=\"config_name\">",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "152: {{end}}",
          "154: {{define \"extra_js\"}}",
          "155: <script type=\"text/javascript\">",
          "157:     function totpGenerate() {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "159: <script src=\"{{.StaticURL}}/vendor/bootstrap-select/js/bootstrap-select.min.js\"></script>",
          "",
          "---------------"
        ],
        "templates/webclient/share.html||templates/webclient/share.html": [
          "File: templates/webclient/share.html -> templates/webclient/share.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: {{define \"extra_css\"}}",
          "6: <link href=\"{{.StaticURL}}/vendor/tempusdominus/css/tempusdominus-bootstrap-4.min.css\" rel=\"stylesheet\">",
          "7: {{end}}",
          "9: {{define \"page_body\"}}",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "7: <link href=\"{{.StaticURL}}/vendor/bootstrap-select/css/bootstrap-select.min.css\" rel=\"stylesheet\">",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "29:             <div class=\"form-group row\">",
          "30:                 <label for=\"idScope\" class=\"col-sm-2 col-form-label\">Scope</label>",
          "31:                 <div class=\"col-sm-10\">",
          "33:                         <option value=\"1\" {{if eq .Share.Scope 1 }}selected{{end}}>Read</option>",
          "34:                         <option value=\"2\" {{if eq .Share.Scope 2 }}selected{{end}}>Write</option>",
          "35:                     </select>",
          "36:                     <small id=\"scopeHelpBlock\" class=\"form-text text-muted\">",
          "38:                     </small>",
          "39:                 </div>",
          "40:             </div>",
          "",
          "[Removed Lines]",
          "32:                     <select class=\"form-control\" id=\"idScope\" name=\"scope\" aria-describedby=\"scopeHelpBlock\">",
          "37:                         For scope \"Write\" you have to define one path and it must be a directory",
          "",
          "[Added Lines]",
          "33:                     <select class=\"form-control selectpicker\" id=\"idScope\" name=\"scope\" aria-describedby=\"scopeHelpBlock\">",
          "36:                         <option value=\"3\" {{if eq .Share.Scope 3 }}selected{{end}}>Read/Write</option>",
          "39:                         For scope \"Write\" and \"Read&Write\" you have to define one path and it must be a directory",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "144: {{define \"extra_js\"}}",
          "145: <script src=\"{{.StaticURL}}/vendor/moment/js/moment.min.js\"></script>",
          "146: <script src=\"{{.StaticURL}}/vendor/tempusdominus/js/tempusdominus-bootstrap-4.min.js\"></script>",
          "147: <script type=\"text/javascript\">",
          "148:     $(document).ready(function () {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "149: <script src=\"{{.StaticURL}}/vendor/bootstrap-select/js/bootstrap-select.min.js\"></script>",
          "",
          "---------------"
        ],
        "templates/webclient/sharefiles.html||templates/webclient/sharefiles.html": [
          "File: templates/webclient/sharefiles.html -> templates/webclient/sharefiles.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "38:     </div>",
          "39: </div>",
          "40: {{end}}",
          "42: {{define \"extra_js\"}}",
          "43: <script src=\"{{.StaticURL}}/vendor/datatables/jquery.dataTables.min.js\"></script>",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "41: {{define \"dialog\"}}",
          "42: <div class=\"modal fade\" id=\"uploadFilesModal\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"uploadFilesModalLabel\"",
          "43:     aria-hidden=\"true\">",
          "44:     <div class=\"modal-dialog\" role=\"document\">",
          "45:         <div class=\"modal-content\">",
          "46:             <div class=\"modal-header\">",
          "47:                 <h5 class=\"modal-title\" id=\"uploadFilesModalLabel\">",
          "48:                     Upload one or more files",
          "49:                 </h5>",
          "50:                 <button class=\"close\" type=\"button\" data-dismiss=\"modal\" aria-label=\"Close\">",
          "51:                     <span aria-hidden=\"true\">&times;</span>",
          "52:                 </button>",
          "53:             </div>",
          "54:             <form id=\"upload_files_form\" action=\"{{.FilesURL}}?path={{.CurrentDir}}\" method=\"POST\" enctype=\"multipart/form-data\">",
          "55:                  <div class=\"modal-body\">",
          "56:                     <input type=\"file\" class=\"form-control-file\" id=\"files_name\" name=\"filenames\" required multiple>",
          "57:                 </div>",
          "58:                 <div class=\"modal-footer\">",
          "59:                     <button class=\"btn btn-secondary\" type=\"button\" data-dismiss=\"modal\">Cancel</button>",
          "60:                     <button type=\"submit\" class=\"btn btn-primary\">Submit</button>",
          "61:                 </div>",
          "62:             </form>",
          "63:         </div>",
          "64:     </div>",
          "65: </div>",
          "66: <div class=\"modal fade\" id=\"spinnerModal\" tabindex=\"-1\" role=\"dialog\" data-keyboard=\"false\" data-backdrop=\"static\">",
          "67:     <div class=\"modal-dialog modal-dialog-centered justify-content-center\" role=\"document\">",
          "68:         <span style=\"color: #333333;\" class=\"fa fa-spinner fa-spin fa-3x\"></span>",
          "69:     </div>",
          "70: </div>",
          "71: {{end}}",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "171:     }",
          "173:     $(document).ready(function () {",
          "174:         $.fn.dataTable.ext.buttons.refresh = {",
          "175:             text: '<i class=\"fas fa-sync-alt\"></i>',",
          "176:             name: 'refresh',",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "205:         $('#spinnerModal').on('shown.bs.modal', function () {",
          "206:             if (spinnerDone){",
          "207:                 $('#spinnerModal').modal('hide');",
          "208:             }",
          "209:         });",
          "211:         $(\"#upload_files_form\").submit(function (event){",
          "212:             event.preventDefault();",
          "213:             var files = $(\"#files_name\")[0].files;",
          "214:             var has_errors = false;",
          "215:             var index = 0;",
          "216:             var success = 0;",
          "217:             spinnerDone = false;",
          "219:             $('#uploadFilesModal').modal('hide');",
          "220:             $('#spinnerModal').modal('show');",
          "222:             function uploadFile() {",
          "223:                 if (index >= files.length || has_errors){",
          "224:                     $('#spinnerModal').modal('hide');",
          "225:                     spinnerDone = true;",
          "226:                     if (!has_errors){",
          "227:                         location.reload();",
          "228:                     }",
          "229:                     return;",
          "230:                 }",
          "232:                 async function saveFile() {",
          "233:                     var errorMessage = \"Error uploading files\";",
          "234:                     let response;",
          "235:                     try {",
          "236:                         var f = files[index];",
          "237:                         var uploadPath = '{{.UploadBaseURL}}'+fixedEncodeURIComponent(\"/\"+f.name);",
          "238:                         var lastModified;",
          "239:                         try {",
          "240:                             lastModified = f.lastModified;",
          "241:                         } catch (e) {",
          "242:                             console.log(\"unable to get last modified time from file: \"+e.message);",
          "243:                             lastModified = \"\";",
          "244:                         }",
          "245:                         response = await fetch(uploadPath, {",
          "246:                             method: 'POST',",
          "247:                             headers: {",
          "248:                                 'X-SFTPGO-MTIME': lastModified",
          "249:                             },",
          "250:                             credentials: 'same-origin',",
          "251:                             redirect: 'error',",
          "252:                             body: f",
          "253:                         });",
          "254:                     } catch (e){",
          "255:                         throw Error(errorMessage+\": \" +e.message);",
          "256:                     }",
          "257:                     if (response.status == 201){",
          "258:                         index++;",
          "259:                         success++;",
          "260:                         uploadFile();",
          "261:                     } else {",
          "262:                         let jsonResponse;",
          "263:                         try {",
          "264:                             jsonResponse = await response.json();",
          "265:                         } catch(e){",
          "266:                             throw Error(errorMessage);",
          "267:                         }",
          "268:                         if (jsonResponse.message) {",
          "269:                             errorMessage = jsonResponse.message;",
          "270:                         }",
          "271:                         if (jsonResponse.error) {",
          "272:                             errorMessage += \": \" + jsonResponse.error;",
          "273:                         }",
          "274:                         throw Error(errorMessage);",
          "275:                     }",
          "276:                 }",
          "278:                 saveFile().catch(function(error){",
          "279:                     index++;",
          "280:                     has_errors = true;",
          "281:                     $('#errorTxt').text(error.message);",
          "282:                     $('#errorMsg').show();",
          "283:                     setTimeout(function () {",
          "284:                         $('#errorMsg').hide();",
          "285:                     }, 10000);",
          "286:                     uploadFile();",
          "287:                 });",
          "288:             }",
          "290:             uploadFile();",
          "291:         });",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "191:             }",
          "192:         };",
          "194:         var table = $('#dataTable').DataTable({",
          "195:             \"ajax\": {",
          "196:                 \"url\": \"{{.DirsURL}}?path={{.CurrentDir}}\",",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "313:         $.fn.dataTable.ext.buttons.addFiles = {",
          "314:             text: '<i class=\"fas fa-file-upload\"></i>',",
          "315:             name: 'addFiles',",
          "316:             titleAttr: \"Upload files\",",
          "317:             action: function (e, dt, node, config) {",
          "318:                 document.getElementById(\"files_name\").value = null;",
          "319:                 $('#uploadFilesModal').modal('show');",
          "320:             },",
          "321:             enabled: true",
          "322:         };",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "283:                 table.button().add(0, 'refresh');",
          "284:                 table.button().add(0, 'pageLength');",
          "285:                 table.button().add(0, 'download');",
          "286:                 table.buttons().container().appendTo('.col-md-6:eq(0)', table.table().container());",
          "287:             },",
          "288:             \"orderFixed\": [0, 'asc'],",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "416:                 {{if gt .Scope 1}}",
          "417:                 table.button().add(0, 'addFiles');",
          "418:                 {{end}}",
          "",
          "---------------"
        ],
        "util/util.go||util/util.go": [
          "File: util/util.go -> util/util.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "15:  \"fmt\"",
          "16:  \"html/template\"",
          "17:  \"io\"",
          "18:  \"net\"",
          "19:  \"net/http\"",
          "20:  \"net/url\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "18:  \"io/fs\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "45:  trueClientIP   = http.CanonicalHeaderKey(\"True-Client-IP\")",
          "46: )",
          "49: func IsStringInSlice(obj string, list []string) bool {",
          "50:  for i := 0; i < len(list); i++ {",
          "51:   if list[i] == obj {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "50: func Contains[T comparable](elems []T, v T) bool {",
          "51:  for _, s := range elems {",
          "52:   if v == s {",
          "53:    return true",
          "54:   }",
          "55:  }",
          "56:  return false",
          "57: }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "391: func createDirPathIfMissing(file string, perm os.FileMode) error {",
          "392:  dirPath := filepath.Dir(file)",
          "394:   err = os.MkdirAll(dirPath, perm)",
          "395:   if err != nil {",
          "396:    return err",
          "",
          "[Removed Lines]",
          "393:  if _, err := os.Stat(dirPath); os.IsNotExist(err) {",
          "",
          "[Added Lines]",
          "405:  if _, err := os.Stat(dirPath); errors.Is(err, fs.ErrNotExist) {",
          "",
          "---------------"
        ],
        "vfs/osfs.go||vfs/osfs.go": [
          "File: vfs/osfs.go -> vfs/osfs.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: package vfs",
          "3: import (",
          "4:  \"fmt\"",
          "5:  \"io\"",
          "6:  \"net/http\"",
          "7:  \"os\"",
          "8:  \"path\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "4:  \"errors\"",
          "7:  \"io/fs\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "202: func (*OsFs) IsNotExist(err error) bool {",
          "204: }",
          "",
          "[Removed Lines]",
          "203:  return os.IsNotExist(err)",
          "",
          "[Added Lines]",
          "205:  return errors.Is(err, fs.ErrNotExist)",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "209:  if _, ok := err.(*pathResolutionError); ok {",
          "210:   return true",
          "211:  }",
          "214: }",
          "",
          "[Removed Lines]",
          "213:  return os.IsPermission(err)",
          "",
          "[Added Lines]",
          "214:  return errors.Is(err, fs.ErrPermission)",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "297:  if isInvalidNameError(err) {",
          "298:   err = os.ErrNotExist",
          "299:  }",
          "301:   return \"\", err",
          "305:   _, err = fs.findFirstExistingDir(r)",
          "",
          "[Removed Lines]",
          "300:  if err != nil && !os.IsNotExist(err) {",
          "302:  } else if os.IsNotExist(err) {",
          "",
          "[Added Lines]",
          "301:  isNotExist := fs.IsNotExist(err)",
          "302:  if err != nil && !isNotExist {",
          "304:  } else if isNotExist {",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "349:  parent := filepath.Dir(cleanPath)",
          "350:  _, err := os.Stat(parent)",
          "353:   results = append(results, parent)",
          "354:   parent = filepath.Dir(parent)",
          "355:   _, err = os.Stat(parent)",
          "",
          "[Removed Lines]",
          "352:  for os.IsNotExist(err) {",
          "",
          "[Added Lines]",
          "354:  for fs.IsNotExist(err) {",
          "",
          "---------------"
        ],
        "vfs/sftpfs.go||vfs/sftpfs.go": [
          "File: vfs/sftpfs.go -> vfs/sftpfs.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "5:  \"errors\"",
          "6:  \"fmt\"",
          "7:  \"io\"",
          "8:  \"net\"",
          "9:  \"net/http\"",
          "10:  \"os\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "8:  \"io/fs\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "433: func (*SFTPFs) IsNotExist(err error) bool {",
          "435: }",
          "",
          "[Removed Lines]",
          "434:  return os.IsNotExist(err)",
          "",
          "[Added Lines]",
          "435:  return errors.Is(err, fs.ErrNotExist)",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "440:  if _, ok := err.(*pathResolutionError); ok {",
          "441:   return true",
          "442:  }",
          "444: }",
          "",
          "[Removed Lines]",
          "443:  return os.IsPermission(err)",
          "",
          "[Added Lines]",
          "444:  return errors.Is(err, fs.ErrPermission)",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "559:   var validatedPath string",
          "560:   var err error",
          "561:   validatedPath, err = fs.getRealPath(fsPath)",
          "563:    fsLog(fs, logger.LevelError, \"Invalid path resolution, original path %v resolved %#v err: %v\",",
          "564:     virtualPath, fsPath, err)",
          "565:    return \"\", err",
          "568:     validatedPath = path.Dir(validatedPath)",
          "569:     if validatedPath == \"/\" {",
          "570:      err = nil",
          "",
          "[Removed Lines]",
          "562:   if err != nil && !os.IsNotExist(err) {",
          "566:   } else if os.IsNotExist(err) {",
          "567:    for os.IsNotExist(err) {",
          "",
          "[Added Lines]",
          "563:   isNotExist := fs.IsNotExist(err)",
          "564:   if err != nil && !isNotExist {",
          "568:   } else if isNotExist {",
          "569:    for fs.IsNotExist(err) {",
          "",
          "---------------"
        ],
        "webdavd/internal_test.go||webdavd/internal_test.go": [
          "File: webdavd/internal_test.go -> webdavd/internal_test.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "644:  p := filepath.Join(user.HomeDir, \"adir\", \"missing\")",
          "645:  err := connection.removeDirTree(fs, p, vpath)",
          "646:  if assert.Error(t, err) {",
          "648:  }",
          "650:  fs = newMockOsFs(nil, false, \"mockID\", user.HomeDir, nil)",
          "651:  err = connection.removeDirTree(fs, p, vpath)",
          "652:  if assert.Error(t, err) {",
          "654:  }",
          "656:  errFake := errors.New(\"fake err\")",
          "",
          "[Removed Lines]",
          "647:   assert.True(t, os.IsNotExist(err))",
          "653:   assert.True(t, os.IsNotExist(err), \"unexpected error: %v\", err)",
          "",
          "[Added Lines]",
          "647:   assert.True(t, fs.IsNotExist(err))",
          "653:   assert.True(t, fs.IsNotExist(err), \"unexpected error: %v\", err)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "663:  fs = newMockOsFs(errWalkDir, true, \"mockID\", user.HomeDir, nil)",
          "664:  err = connection.removeDirTree(fs, p, vpath)",
          "665:  if assert.Error(t, err) {",
          "667:  }",
          "669:  fs = newMockOsFs(errWalkFile, false, \"mockID\", user.HomeDir, nil)",
          "",
          "[Removed Lines]",
          "666:   assert.True(t, os.IsPermission(err), \"unexpected error: %v\", err)",
          "",
          "[Added Lines]",
          "666:   assert.True(t, fs.IsPermission(err), \"unexpected error: %v\", err)",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "766:   common.TransferDownload, 0, 0, 0, 0, false, fs, dataprovider.TransferQuota{})",
          "767:  davFile = newWebDavFile(baseTransfer, nil, nil)",
          "768:  _, err = davFile.Read(p)",
          "770:  _, err = davFile.Stat()",
          "773:  baseTransfer = common.NewBaseTransfer(nil, connection.BaseConnection, nil, testFilePath, testFilePath, testFile,",
          "774:   common.TransferDownload, 0, 0, 0, 0, false, fs, dataprovider.TransferQuota{})",
          "",
          "[Removed Lines]",
          "769:  assert.True(t, os.IsNotExist(err))",
          "771:  assert.True(t, os.IsNotExist(err))",
          "",
          "[Added Lines]",
          "769:  assert.True(t, fs.IsNotExist(err))",
          "771:  assert.True(t, fs.IsNotExist(err))",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "852:   common.TransferDownload, 0, 0, 0, 0, false, fs, dataprovider.TransferQuota{AllowedTotalSize: 100})",
          "853:  davFile = newWebDavFile(baseTransfer, nil, nil)",
          "854:  _, err = davFile.Seek(0, io.SeekCurrent)",
          "856:  davFile.Connection.RemoveTransfer(davFile.BaseTransfer)",
          "858:  err = os.WriteFile(testFilePath, testFileContents, os.ModePerm)",
          "",
          "[Removed Lines]",
          "855:  assert.True(t, os.IsNotExist(err))",
          "",
          "[Added Lines]",
          "855:  assert.True(t, fs.IsNotExist(err))",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "888:   common.TransferDownload, 0, 0, 0, 0, false, fs, dataprovider.TransferQuota{AllowedTotalSize: 100})",
          "889:  davFile = newWebDavFile(baseTransfer, nil, nil)",
          "890:  _, err = davFile.Seek(0, io.SeekEnd)",
          "892:  davFile.Connection.RemoveTransfer(davFile.BaseTransfer)",
          "894:  baseTransfer = common.NewBaseTransfer(nil, connection.BaseConnection, nil, testFilePath, testFilePath, testFile,",
          "",
          "[Removed Lines]",
          "891:  assert.True(t, os.IsNotExist(err))",
          "",
          "[Added Lines]",
          "891:  assert.True(t, fs.IsNotExist(err))",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "912:  davFile = newWebDavFile(baseTransfer, nil, nil)",
          "913:  davFile.Fs = newMockOsFs(nil, true, fs.ConnectionID(), user.GetHomeDir(), nil)",
          "914:  res, err = davFile.Seek(2, io.SeekEnd)",
          "916:  assert.Equal(t, int64(0), res)",
          "918:  assert.Len(t, common.Connections.GetStats(), 0)",
          "",
          "[Removed Lines]",
          "915:  assert.True(t, os.IsNotExist(err))",
          "",
          "[Added Lines]",
          "915:  assert.True(t, fs.IsNotExist(err))",
          "",
          "---------------"
        ],
        "webdavd/webdavd_test.go||webdavd/webdavd_test.go": [
          "File: webdavd/webdavd_test.go -> webdavd/webdavd_test.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "6:  \"crypto/rand\"",
          "7:  \"crypto/tls\"",
          "8:  \"encoding/json\"",
          "9:  \"fmt\"",
          "10:  \"io\"",
          "11:  \"net\"",
          "12:  \"net/http\"",
          "13:  \"os\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "9:  \"errors\"",
          "12:  \"io/fs\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2917: func createTestFile(path string, size int64) error {",
          "2918:  baseDir := filepath.Dir(path)",
          "2920:   err = os.MkdirAll(baseDir, os.ModePerm)",
          "2921:   if err != nil {",
          "2922:    return err",
          "",
          "[Removed Lines]",
          "2919:  if _, err := os.Stat(baseDir); os.IsNotExist(err) {",
          "",
          "[Added Lines]",
          "2921:  if _, err := os.Stat(baseDir); errors.Is(err, fs.ErrNotExist) {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "d34446e6e925348ee2ce5fe70f066efd3da3763c",
      "candidate_info": {
        "commit_hash": "d34446e6e925348ee2ce5fe70f066efd3da3763c",
        "repo": "drakkan/sftpgo",
        "commit_url": "https://github.com/drakkan/sftpgo/commit/d34446e6e925348ee2ce5fe70f066efd3da3763c",
        "files": [
          "dataprovider/user.go",
          "go.mod",
          "go.sum",
          "httpd/api_utils.go",
          "httpd/httpd_test.go",
          "static/vendor/video-js/video-js.min.css",
          "static/vendor/video-js/video.min.js",
          "templates/webclient/files.html",
          "templates/webclient/sharefiles.html",
          "vfs/sftpfs.go"
        ],
        "message": "web client: add HTML5 player\n\nSigned-off-by: Nicola Murino <nicola.murino@gmail.com>",
        "before_after_code_files": [
          "dataprovider/user.go||dataprovider/user.go",
          "go.mod||go.mod",
          "go.sum||go.sum",
          "httpd/api_utils.go||httpd/api_utils.go",
          "httpd/httpd_test.go||httpd/httpd_test.go",
          "static/vendor/video-js/video-js.min.css||static/vendor/video-js/video-js.min.css",
          "static/vendor/video-js/video.min.js||static/vendor/video-js/video.min.js",
          "templates/webclient/files.html||templates/webclient/files.html",
          "templates/webclient/sharefiles.html||templates/webclient/sharefiles.html",
          "vfs/sftpfs.go||vfs/sftpfs.go"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "templates/webclient/files.html||templates/webclient/files.html",
            "templates/webclient/sharefiles.html||templates/webclient/sharefiles.html"
          ],
          "candidate": [
            "templates/webclient/files.html||templates/webclient/files.html",
            "templates/webclient/sharefiles.html||templates/webclient/sharefiles.html"
          ]
        }
      },
      "candidate_diff": {
        "dataprovider/user.go||dataprovider/user.go": [
          "File: dataprovider/user.go -> dataprovider/user.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "208:  return nil",
          "209: }",
          "211: func (u *User) checkRootPath(connectionID string) error {",
          "212:  fs, err := u.GetFilesystemForPath(\"/\", connectionID)",
          "213:  if err != nil {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "211: func (u *User) checkLocalHomeDir(connectionID string) {",
          "212:  switch u.FsConfig.Provider {",
          "213:  case sdk.LocalFilesystemProvider, sdk.CryptedFilesystemProvider:",
          "214:   return",
          "215:  default:",
          "216:   osFs := vfs.NewOsFs(connectionID, u.GetHomeDir(), \"\")",
          "217:   osFs.CheckRootPath(u.Username, u.GetUID(), u.GetGID())",
          "218:  }",
          "219: }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "233:  }",
          "234:  if isLastActivityRecent(u.LastLogin, delay) {",
          "235:   if u.LastLogin > u.UpdatedAt {",
          "238:    }",
          "239:    return nil",
          "240:   }",
          "",
          "[Removed Lines]",
          "236:    if u.FsConfig.Provider != sdk.LocalFilesystemProvider && config.IsShared == 1 {",
          "237:     return u.checkRootPath(connectionID)",
          "",
          "[Added Lines]",
          "246:    if config.IsShared == 1 {",
          "247:     u.checkLocalHomeDir(connectionID)",
          "",
          "---------------"
        ],
        "go.mod||go.mod": [
          "File: go.mod -> go.mod",
          "--- Hunk 1 ---",
          "[Context before]",
          "65:  go.etcd.io/bbolt v1.3.6",
          "66:  go.uber.org/automaxprocs v1.5.1",
          "67:  gocloud.dev v0.25.0",
          "70:  golang.org/x/oauth2 v0.0.0-20220722155238-128564f6959c",
          "71:  golang.org/x/sys v0.0.0-20220722155257-8c9f86f7a55f",
          "72:  golang.org/x/time v0.0.0-20220722155302-e5dcc9cfc0b9",
          "",
          "[Removed Lines]",
          "68:  golang.org/x/crypto v0.0.0-20220622213112-05595931fe9d",
          "69:  golang.org/x/net v0.0.0-20220624214902-1bab6f366d9e",
          "",
          "[Added Lines]",
          "68:  golang.org/x/crypto v0.0.0-20220722155217-630584e8d5aa",
          "69:  golang.org/x/net v0.0.0-20220722155237-a158d28d115b",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "166: replace (",
          "167:  github.com/jlaffaye/ftp => github.com/drakkan/ftp v0.0.0-20201114075148-9b9adce499a9",
          "170: )",
          "",
          "[Removed Lines]",
          "168:  golang.org/x/crypto => github.com/drakkan/crypto v0.0.0-20220624102318-5fdf29404a2d",
          "169:  golang.org/x/net => github.com/drakkan/net v0.0.0-20220628152131-9c7397602ad7",
          "",
          "[Added Lines]",
          "168:  golang.org/x/crypto => github.com/drakkan/crypto v0.0.0-20220723134236-2c43acbc2436",
          "169:  golang.org/x/net => github.com/drakkan/net v0.0.0-20220723134121-37f73db6d7c4",
          "",
          "---------------"
        ],
        "go.sum||go.sum": [
          "File: go.sum -> go.sum",
          "--- Hunk 1 ---",
          "[Context before]",
          "259: github.com/dimchansky/utfbom v1.1.1/go.mod h1:SxdoEBH5qIqFocHMyGOXVAybYJdr71b1Q/j0mACtrfE=",
          "260: github.com/dnaeon/go-vcr v1.2.0 h1:zHCHvJYTMh1N7xnV7zf1m1GPBF9Ad0Jk/whtQ1663qI=",
          "261: github.com/dnaeon/go-vcr v1.2.0/go.mod h1:R4UdLID7HZT3taECzJs4YgbbH6PIGXB6W/sc5OLb6RQ=",
          "264: github.com/drakkan/ftp v0.0.0-20201114075148-9b9adce499a9 h1:LPH1dEblAOO/LoG7yHPMtBLXhQmjaga91/DDjWk9jWA=",
          "265: github.com/drakkan/ftp v0.0.0-20201114075148-9b9adce499a9/go.mod h1:2lmrmq866uF2tnje75wQHzmPXhmSWUt7Gyx2vgK1RCU=",
          "268: github.com/eikenb/pipeat v0.0.0-20210730190139-06b3e6902001 h1:/ZshrfQzayqRSBDodmp3rhNCHJCff+utvgBuWRbiqu4=",
          "269: github.com/eikenb/pipeat v0.0.0-20210730190139-06b3e6902001/go.mod h1:kltMsfRMTHSFdMbK66XdS8mfMW77+FZA1fGY1xYMF84=",
          "270: github.com/envoyproxy/go-control-plane v0.9.0/go.mod h1:YTl/9mNaCwkRvm6d1a2C3ymFceY/DCBVvsKhRF0iEA4=",
          "",
          "[Removed Lines]",
          "262: github.com/drakkan/crypto v0.0.0-20220624102318-5fdf29404a2d h1:VLfi41ryCFZIcCC4jZGAa1zLmF3Mu/GpplwXIuYV8/k=",
          "263: github.com/drakkan/crypto v0.0.0-20220624102318-5fdf29404a2d/go.mod h1:SiM6ypd8Xu1xldObYtbDztuUU7xUzMnUULfphXFZmro=",
          "266: github.com/drakkan/net v0.0.0-20220628152131-9c7397602ad7 h1:/KuSaF3lQkzeeNsXiTPhnI2w4PlH3hbxN6h8tfKAc5E=",
          "267: github.com/drakkan/net v0.0.0-20220628152131-9c7397602ad7/go.mod h1:XRhObCWvk6IyKnWLug+ECip1KBveYUHfp+8e9klMJ9c=",
          "",
          "[Added Lines]",
          "262: github.com/drakkan/crypto v0.0.0-20220723134236-2c43acbc2436 h1:cctYUw+d5DrSgUhRSZF/GzDZtvNswdduqIkZM1Wi+qg=",
          "263: github.com/drakkan/crypto v0.0.0-20220723134236-2c43acbc2436/go.mod h1:SiM6ypd8Xu1xldObYtbDztuUU7xUzMnUULfphXFZmro=",
          "266: github.com/drakkan/net v0.0.0-20220723134121-37f73db6d7c4 h1:NbZDB/9nbn6i9XYsOfeu15vVw8bSnm3tRTVwgkP8OiQ=",
          "267: github.com/drakkan/net v0.0.0-20220723134121-37f73db6d7c4/go.mod h1:XRhObCWvk6IyKnWLug+ECip1KBveYUHfp+8e9klMJ9c=",
          "",
          "---------------"
        ],
        "httpd/api_utils.go||httpd/api_utils.go": [
          "File: httpd/api_utils.go -> httpd/api_utils.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "443:  if err != nil {",
          "444:   return condFalse",
          "445:  }",
          "447:   return condTrue",
          "448:  }",
          "449:  return condFalse",
          "",
          "[Removed Lines]",
          "446:  if modtime.Add(60 * time.Second).Before(t) {",
          "",
          "[Added Lines]",
          "446:  if modtime.Unix() == t.Unix() {",
          "",
          "---------------"
        ],
        "httpd/httpd_test.go||httpd/httpd_test.go": [
          "File: httpd/httpd_test.go -> httpd/httpd_test.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "11885:  rr = executeRequest(req)",
          "11886:  checkResponseCode(t, http.StatusPartialContent, rr)",
          "11887:  assert.Equal(t, testFileContents[2:], rr.Body.Bytes())",
          "11889:  req, _ = http.NewRequest(http.MethodGet, webClientFilesPath+\"?path=\"+testFileName, nil)",
          "11890:  req.Header.Set(\"Range\", \"bytes=-2\")",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "11888:  lastModified, err := http.ParseTime(rr.Header().Get(\"Last-Modified\"))",
          "11889:  assert.NoError(t, err)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "11914:  req, _ = http.NewRequest(http.MethodHead, webClientFilesPath+\"?path=\"+testFileName, nil)",
          "11915:  req.Header.Set(\"Range\", \"bytes=2-\")",
          "11917:  setJWTCookieForReq(req, webToken)",
          "11918:  rr = executeRequest(req)",
          "11919:  checkResponseCode(t, http.StatusPartialContent, rr)",
          "11921:  req, _ = http.NewRequest(http.MethodHead, webClientFilesPath+\"?path=\"+testFileName, nil)",
          "11922:  req.Header.Set(\"Range\", \"bytes=2-\")",
          "11924:  setJWTCookieForReq(req, webToken)",
          "11925:  rr = executeRequest(req)",
          "11926:  checkResponseCode(t, http.StatusOK, rr)",
          "11928:  req, _ = http.NewRequest(http.MethodHead, webClientFilesPath+\"?path=\"+testFileName, nil)",
          "11930:  setJWTCookieForReq(req, webToken)",
          "11931:  rr = executeRequest(req)",
          "11932:  checkResponseCode(t, http.StatusOK, rr)",
          "11934:  req, _ = http.NewRequest(http.MethodHead, webClientFilesPath+\"?path=\"+testFileName, nil)",
          "11936:  setJWTCookieForReq(req, webToken)",
          "11937:  rr = executeRequest(req)",
          "11938:  checkResponseCode(t, http.StatusNotModified, rr)",
          "11940:  req, _ = http.NewRequest(http.MethodHead, webClientFilesPath+\"?path=\"+testFileName, nil)",
          "11942:  setJWTCookieForReq(req, webToken)",
          "11943:  rr = executeRequest(req)",
          "11944:  checkResponseCode(t, http.StatusPreconditionFailed, rr)",
          "11946:  req, _ = http.NewRequest(http.MethodHead, userFilesPath+\"?path=\"+testFileName, nil)",
          "11948:  setBearerForReq(req, webAPIToken)",
          "11949:  rr = executeRequest(req)",
          "11950:  checkResponseCode(t, http.StatusPreconditionFailed, rr)",
          "11952:  req, _ = http.NewRequest(http.MethodHead, webClientFilesPath+\"?path=\"+testFileName, nil)",
          "11954:  setJWTCookieForReq(req, webToken)",
          "11955:  rr = executeRequest(req)",
          "11956:  checkResponseCode(t, http.StatusOK, rr)",
          "",
          "[Removed Lines]",
          "11916:  req.Header.Set(\"If-Range\", time.Now().UTC().Add(120*time.Second).Format(http.TimeFormat))",
          "11923:  req.Header.Set(\"If-Range\", time.Now().UTC().Add(-120*time.Second).Format(http.TimeFormat))",
          "11929:  req.Header.Set(\"If-Modified-Since\", time.Now().UTC().Add(-120*time.Second).Format(http.TimeFormat))",
          "11935:  req.Header.Set(\"If-Modified-Since\", time.Now().UTC().Add(120*time.Second).Format(http.TimeFormat))",
          "11941:  req.Header.Set(\"If-Unmodified-Since\", time.Now().UTC().Add(-120*time.Second).Format(http.TimeFormat))",
          "11947:  req.Header.Set(\"If-Unmodified-Since\", time.Now().UTC().Add(-120*time.Second).Format(http.TimeFormat))",
          "11953:  req.Header.Set(\"If-Unmodified-Since\", time.Now().UTC().Add(120*time.Second).Format(http.TimeFormat))",
          "",
          "[Added Lines]",
          "11918:  req.Header.Set(\"If-Range\", lastModified.UTC().Format(http.TimeFormat))",
          "11925:  req.Header.Set(\"If-Range\", lastModified.UTC().Add(-120*time.Second).Format(http.TimeFormat))",
          "11931:  req.Header.Set(\"If-Modified-Since\", lastModified.UTC().Add(-120*time.Second).Format(http.TimeFormat))",
          "11937:  req.Header.Set(\"If-Modified-Since\", lastModified.UTC().Add(120*time.Second).Format(http.TimeFormat))",
          "11943:  req.Header.Set(\"If-Unmodified-Since\", lastModified.UTC().Add(-120*time.Second).Format(http.TimeFormat))",
          "11949:  req.Header.Set(\"If-Unmodified-Since\", lastModified.UTC().Add(-120*time.Second).Format(http.TimeFormat))",
          "11955:  req.Header.Set(\"If-Unmodified-Since\", lastModified.UTC().Add(120*time.Second).Format(http.TimeFormat))",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "13342:  user, _, err := httpdtest.AddUser(getTestUser(), http.StatusCreated)",
          "13343:  assert.NoError(t, err)",
          "13344:  u := getTestSFTPUser()",
          "13345:  u.FsConfig.SFTPConfig.BufferSize = 2",
          "13346:  u.Permissions[\"/adir\"] = nil",
          "13347:  u.Permissions[\"/adir1\"] = []string{dataprovider.PermListItems}",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "13347:  u.HomeDir = filepath.Clean(os.TempDir())",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "13351:    DeniedPatterns: []string{\"*.txt\"},",
          "13352:   },",
          "13353:  }",
          "13355:  assert.NoError(t, err)",
          "13357:  testFileName := \"testsftpfile\"",
          "",
          "[Removed Lines]",
          "13354:  sftpUser, _, err := httpdtest.AddUser(u, http.StatusCreated)",
          "",
          "[Added Lines]",
          "13357:  sftpUserBuffered, _, err := httpdtest.AddUser(u, http.StatusCreated)",
          "13358:  assert.NoError(t, err)",
          "13359:  u.Username += \"_unbuffered\"",
          "13360:  u.FsConfig.SFTPConfig.BufferSize = 0",
          "13361:  sftpUserUnbuffered, _, err := httpdtest.AddUser(u, http.StatusCreated)",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "13369:  assert.NoError(t, err)",
          "13370:  err = os.WriteFile(filepath.Join(user.GetHomeDir(), \"adir2\", \"afile.txt\"), testFileContents, os.ModePerm)",
          "13371:  assert.NoError(t, err)",
          "13424:  _, err = httpdtest.RemoveUser(user, http.StatusOK)",
          "13425:  assert.NoError(t, err)",
          "13426:  err = os.RemoveAll(user.GetHomeDir())",
          "",
          "[Removed Lines]",
          "13372:  webToken, err := getJWTWebClientTokenFromTestServer(sftpUser.Username, defaultPassword)",
          "13373:  assert.NoError(t, err)",
          "13374:  req, _ := http.NewRequest(http.MethodGet, webClientFilesPath, nil)",
          "13375:  setJWTCookieForReq(req, webToken)",
          "13376:  rr := executeRequest(req)",
          "13377:  checkResponseCode(t, http.StatusOK, rr)",
          "13379:  req, _ = http.NewRequest(http.MethodGet, webClientFilesPath+\"?path=\"+path.Join(testDir, \"sub\"), nil)",
          "13380:  setJWTCookieForReq(req, webToken)",
          "13381:  rr = executeRequest(req)",
          "13382:  checkResponseCode(t, http.StatusOK, rr)",
          "13384:  req, _ = http.NewRequest(http.MethodGet, webClientFilesPath+\"?path=\"+path.Join(testDir, \"missing\"), nil)",
          "13385:  setJWTCookieForReq(req, webToken)",
          "13386:  rr = executeRequest(req)",
          "13387:  checkResponseCode(t, http.StatusOK, rr)",
          "13388:  assert.Contains(t, rr.Body.String(), \"card-body text-form-error\")",
          "13389:  req, _ = http.NewRequest(http.MethodGet, webClientFilesPath+\"?path=adir/sub\", nil)",
          "13390:  setJWTCookieForReq(req, webToken)",
          "13391:  rr = executeRequest(req)",
          "13392:  checkResponseCode(t, http.StatusOK, rr)",
          "13393:  assert.Contains(t, rr.Body.String(), \"card-body text-form-error\")",
          "13395:  req, _ = http.NewRequest(http.MethodGet, webClientFilesPath+\"?path=adir1/afile\", nil)",
          "13396:  setJWTCookieForReq(req, webToken)",
          "13397:  rr = executeRequest(req)",
          "13398:  checkResponseCode(t, http.StatusOK, rr)",
          "13399:  assert.Contains(t, rr.Body.String(), \"card-body text-form-error\")",
          "13401:  req, _ = http.NewRequest(http.MethodGet, webClientFilesPath+\"?path=adir2/afile.txt\", nil)",
          "13402:  setJWTCookieForReq(req, webToken)",
          "13403:  rr = executeRequest(req)",
          "13404:  checkResponseCode(t, http.StatusOK, rr)",
          "13405:  assert.Contains(t, rr.Body.String(), \"card-body text-form-error\")",
          "13407:  req, _ = http.NewRequest(http.MethodGet, webClientFilesPath+\"?path=\"+testFileName, nil)",
          "13408:  setJWTCookieForReq(req, webToken)",
          "13409:  rr = executeRequest(req)",
          "13410:  checkResponseCode(t, http.StatusOK, rr)",
          "13411:  assert.Equal(t, testFileContents, rr.Body.Bytes())",
          "13413:  req, _ = http.NewRequest(http.MethodGet, webClientFilesPath+\"?path=\"+testFileName, nil)",
          "13414:  req.Header.Set(\"Range\", \"bytes=2-\")",
          "13415:  setJWTCookieForReq(req, webToken)",
          "13416:  rr = executeRequest(req)",
          "13417:  checkResponseCode(t, http.StatusPartialContent, rr)",
          "13418:  assert.Equal(t, testFileContents[2:], rr.Body.Bytes())",
          "13420:  _, err = httpdtest.RemoveUser(sftpUser, http.StatusOK)",
          "13421:  assert.NoError(t, err)",
          "13422:  err = os.RemoveAll(sftpUser.GetHomeDir())",
          "13423:  assert.NoError(t, err)",
          "",
          "[Added Lines]",
          "13379:  for _, sftpUser := range []dataprovider.User{sftpUserBuffered, sftpUserUnbuffered} {",
          "13380:   webToken, err := getJWTWebClientTokenFromTestServer(sftpUser.Username, defaultPassword)",
          "13381:   assert.NoError(t, err)",
          "13382:   req, _ := http.NewRequest(http.MethodGet, webClientFilesPath, nil)",
          "13383:   setJWTCookieForReq(req, webToken)",
          "13384:   rr := executeRequest(req)",
          "13385:   checkResponseCode(t, http.StatusOK, rr)",
          "13387:   req, _ = http.NewRequest(http.MethodGet, webClientFilesPath+\"?path=\"+path.Join(testDir, \"sub\"), nil)",
          "13388:   setJWTCookieForReq(req, webToken)",
          "13389:   rr = executeRequest(req)",
          "13390:   checkResponseCode(t, http.StatusOK, rr)",
          "13392:   req, _ = http.NewRequest(http.MethodGet, webClientFilesPath+\"?path=\"+path.Join(testDir, \"missing\"), nil)",
          "13393:   setJWTCookieForReq(req, webToken)",
          "13394:   rr = executeRequest(req)",
          "13395:   checkResponseCode(t, http.StatusOK, rr)",
          "13396:   assert.Contains(t, rr.Body.String(), \"card-body text-form-error\")",
          "13397:   req, _ = http.NewRequest(http.MethodGet, webClientFilesPath+\"?path=adir/sub\", nil)",
          "13398:   setJWTCookieForReq(req, webToken)",
          "13399:   rr = executeRequest(req)",
          "13400:   checkResponseCode(t, http.StatusOK, rr)",
          "13401:   assert.Contains(t, rr.Body.String(), \"card-body text-form-error\")",
          "13403:   req, _ = http.NewRequest(http.MethodGet, webClientFilesPath+\"?path=adir1/afile\", nil)",
          "13404:   setJWTCookieForReq(req, webToken)",
          "13405:   rr = executeRequest(req)",
          "13406:   checkResponseCode(t, http.StatusOK, rr)",
          "13407:   assert.Contains(t, rr.Body.String(), \"card-body text-form-error\")",
          "13409:   req, _ = http.NewRequest(http.MethodGet, webClientFilesPath+\"?path=adir2/afile.txt\", nil)",
          "13410:   setJWTCookieForReq(req, webToken)",
          "13411:   rr = executeRequest(req)",
          "13412:   checkResponseCode(t, http.StatusOK, rr)",
          "13413:   assert.Contains(t, rr.Body.String(), \"card-body text-form-error\")",
          "13415:   req, _ = http.NewRequest(http.MethodGet, webClientFilesPath+\"?path=\"+testFileName, nil)",
          "13416:   setJWTCookieForReq(req, webToken)",
          "13417:   rr = executeRequest(req)",
          "13418:   checkResponseCode(t, http.StatusOK, rr)",
          "13419:   assert.Equal(t, testFileContents, rr.Body.Bytes())",
          "13421:   req, _ = http.NewRequest(http.MethodGet, webClientFilesPath+\"?path=\"+testFileName, nil)",
          "13422:   req.Header.Set(\"Range\", \"bytes=2-\")",
          "13423:   setJWTCookieForReq(req, webToken)",
          "13424:   rr = executeRequest(req)",
          "13425:   checkResponseCode(t, http.StatusPartialContent, rr)",
          "13426:   assert.Equal(t, testFileContents[2:], rr.Body.Bytes())",
          "13428:   _, err = httpdtest.RemoveUser(sftpUser, http.StatusOK)",
          "13429:   assert.NoError(t, err)",
          "13430:  }",
          "",
          "---------------"
        ],
        "static/vendor/video-js/video-js.min.css||static/vendor/video-js/video-js.min.css": [
          "File: static/vendor/video-js/video-js.min.css -> static/vendor/video-js/video-js.min.css",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: @charset \"UTF-8\";.video-js .vjs-big-play-button .vjs-icon-placeholder:before,.video-js .vjs-modal-dialog,.vjs-button>.vjs-icon-placeholder:before,.vjs-modal-dialog .vjs-modal-dialog-content{position:absolute;top:0;left:0;width:100%;height:100%}.video-js .vjs-big-play-button .vjs-icon-placeholder:before,.vjs-button>.vjs-icon-placeholder:before{text-align:center}@font-face{font-family:VideoJS;src:url(data:application/font-woff;charset=utf-8;base64,d09GRgABAAAAABDkAAsAAAAAG6gAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAADsAAABUIIslek9TLzIAAAFEAAAAPgAAAFZRiV3hY21hcAAAAYQAAADaAAADPv749/pnbHlmAAACYAAAC3AAABHQZg6OcWhlYWQAAA3QAAAAKwAAADYZw251aGhlYQAADfwAAAAdAAAAJA+RCLFobXR4AAAOHAAAABMAAACM744AAGxvY2EAAA4wAAAASAAAAEhF6kqubWF4cAAADngAAAAfAAAAIAE0AIFuYW1lAAAOmAAAASUAAAIK1cf1oHBvc3QAAA/AAAABJAAAAdPExYuNeJxjYGRgYOBiMGCwY2BycfMJYeDLSSzJY5BiYGGAAJA8MpsxJzM9kYEDxgPKsYBpDiBmg4gCACY7BUgAeJxjYGS7wTiBgZWBgaWQ5RkDA8MvCM0cwxDOeI6BgYmBlZkBKwhIc01hcPjI+FGJHcRdyA4RZgQRADK3CxEAAHic7dFZbsMgAEXRS0ycyZnnOeG7y+qC8pU1dHusIOXxuoxaOlwZYWQB0Aea4quIEN4E9LzKbKjzDeM6H/mua6Lmc/p8yhg0lvdYx15ZG8uOLQOGjMp3EzqmzJizYMmKNRu27Nhz4MiJMxeu3Ljz4Ekqm7T8P52G8PP3lnTOVk++Z6iN6QZzNN1F7ptuN7eGOjDUoaGODHVsuvU8MdTO9Hd5aqgzQ50b6sJQl4a6MtS1oW4MdWuoO0PdG+rBUI+GejLUs6FeDPVqqDdDvRvqw1CfhpqM9At0iFLaAAB4nJ1YDXBTVRZ+5/22TUlJ8we0pHlJm7RJf5O8F2j6EymlSPkpxaL8U2xpa3DKj0CBhc2IW4eWKSokIoLsuMqssM64f+jA4HSdWXXXscBq67IOs3FXZ1ZYWVyRFdo899yXtIBQZ90k7717zz3v3HPPOfd854YCCj9cL9dL0RQFOqCbGJnrHb5EayiKIWN8iA/hWBblo6hUWm8TtCDwE80WMJus/irwyxOdxeB0MDb14VNJHnXYoLLSl6FfCUYO9nYPTA8Epg9090LprfbBbZ2hY0UlJUXHQp3/vtWkS6EBv8+rPMq5u9692f/dNxJNiqwC1xPE9TCUgCsSdQWgE3XQD25lkG4CN2xmTcOXWBOyser6RN6KnGbKSbmQ3+d0OI1m2W8QzLLkI2sykrWAgJJEtA8vGGW/2Q+CmT3n8zS9wZwu2DCvtuZKZN3xkrLh36yCZuUomQSqGpY8t/25VfHVhw8z4ebGBtfLb0ya9PCaDc+8dGTvk2dsh6z7WzvowlXKUSWo9MJ15a3KrEP2loOr2Ojhw6iW6hf2BDdEccQvZGpaAy7YovSwq8kr7HGllxpd71rkS6G0Sf11sl9OvMK1+jwPPODxjUwkOim9CU3ix1wNjXDfmJSEn618Bs6lpWwUpU+8PCqLMY650zjq8VhCIP17NEKTx3eaLL+s5Pi6yJWaWjTHLR1jYzPSV9VF/6Ojdb/1kO3Mk3uhHC0x6gc1BjlKQ+nQFxTYdaJkZ7ySVxLBbhR1dsboNXp1tCYKW2LRaEzpYcIx2BKNxaL0ZaUnSqfFoiNhHKR/GkX6PWUSAaJelQaqZL1EpoHNsajSEyPSoJ9IjhIxTdjHLmwZvhRDOiFTY/YeQnvrVZmiTQtGncECXtFTBZLOVwwMRgoXHAkXzMzPn1nAJJ8jYSbMDaqN2waGLzNhih/bZynUBMpIWSg7VYi7DRx2m8ALkIdRCJwI6ArJx2EI8kaDWeTQKeAFk9fjl/1AvwktjQ1P7NjyMGQyfd4vjipX6M/i52D7Cq80kqlcxEcGXRr/FEcgs0u5uGgB4VWuMFfpdn2Re6Hi3PqzmxWKsz6+ae2Pn9hXXw/fqM859UiGC0oKYYILJBqJrsn1Z1E5qOs9rQCiUQRREjm8yJcbHF5cUJufX1vAHlefw0XgUoboS3ETfQlTxBC4SOtuE8VPRJTBSCQSjZCpk7Gqzu+masaZ2y7Zjehho4F3g82BNDkAHpORG4+OCS+f6JTPmtRn/PH1kch6d04sp7AQb25aQ/pqUyXeQ8vrebG8OYQdXOQ+585u0sdW9rqalzRURiJ+9F4MweRFrKUjl1GUYhH1A27WOHw5cTFSFPMo9EeUIGnQTZHIaJ7AHLaOKsOODaNF9jkBjYG2QEsQ2xjMUAx2bBEbeTBWMHwskBjngq56S/yfgkBnWBa4K9sqKtq2t1UI8S9He5XuBRbawAdatrQEAi30Aks2+LM8WeCbalVZkWNylvJ+dqJnzVb+OHlSoKW8nPCP7Rd+CcZ2DdWAGqJ2CBFOphgywFFCFBNtfAbGtNPBCwxvygHeYMZMY9ZboBqwq/pVrsbgN5tkv152ODlbMfiqwGMBgxa4Exz3QhovRIUp6acqZmQzRq0ypDXS2TPLT02YIkQETnOE445oOGxOmXAqUJNNG7XgupMjPq2ua9asrj5yY/yuKteO1Kx0YNJTufrirLe1mZnat7OL6rnUdCWenpW6I8mAnbsY8KWs1PuSovCW9A/Z25PQ24a7cNOqgmTkLmBMgh4THgc4b9k2IVv1/g/F5nGljwPLfOgHAzJzh45V/4+WenTzmMtR5Z7us2Tys909UHqrPY7KbckoxRvRHhmVc3cJGE97uml0R1S0jdULVl7EvZtDFVBF35N9cEdjpgmAiOlFZ+Dtoh93+D3zzHr8RRNZQhnCNMNbcegOvpEwZoL+06cJQ07h+th3fZ/7PVbVC6ngTAV/KoLFuO6+2KFcU651gEb5ugPSIb1D+Xp8V4+k3sEIGnw5mYe4If4k1lFYr6SCzmM2EQ8iWtmwjnBI9kTwe1TlfAmXh7H02by9fW2gsjKwtv0aaURKil4OdV7rDL1MXIFNrhdxohcZXYTnq47WisrKitaObbf5+yvkLi5J6lCNZZ+B6GC38VNBZBDidSS/+mSvh6s+srgC8pyKMvDtt+de3c9fU76ZPfuM8ud4Kv0fyP/LqfepMT/3oZxSqpZaTa1DaQYLY8TFsHYbWYsPoRhRWfL5eSSQbhUGgGC3YLbVMk6PitTFNGpAsNrC6D1VNBKgBHMejaiuRWEWGgsSDBTJjqWIl8kJLlsaLJ2tXDr6xGfT85bM2Q06a46x2HTgvdnV8z5YDy/27J4zt6x2VtkzjoYpkq36kaBr4eQSg7tyiVweWubXZugtadl58ydapfbORfKsDTuZ0OBgx4cfdjCf5tbWNITnL120fdOi1RV1C3uKGzNdwYLcMvZ3BxoPyTOCD1XvXTp7U10gWCVmTV9b3r2z0SkGWovb2hp9I89O8a2smlyaO8muMU+dRmtzp60IzAoFpjLr1n388boLyf0dRvxhsHZ0qbWqDkwqvvpkj4l0fY6EIXRi5sQSrAvsVYwXRy4qJ2EVtD1AN7a0HWth9ymvL1xc3WTUKK/TAHA/bXDVtVWfOMfuGxGZv4Ln/jVr9jc3j1yMv0tndmyt9Vq88Y9gH1wtLX3KWjot5++jWHgAoZZkQ14wGQ20Fli71UmKJAy4xKMSTGbVdybW7FDDAut9XpD5AzWrYO7zQ8qffqF8+Ynd/clrHcdyxGy3a/3+mfNnzC/cBsveTjnTvXf1o6vzOlZw7WtqtdmPK/Errz/6NNtD72zmNOZfbmYdTGHfoofqI79Oc+R2n1lrnL6pOm0Up7kwxhTW12Amm7WYkXR2qYrF2AmgmbAsxZjwy1xpg/m1Je2vrp8v/nz2xpmlBg4E9hrMU341wVpTOh/OfmGvAnra8q6uctr60ZQHV3Q+WMQJykMj8ZsWn2QBOmmHMB+m5pDIpTFonYigiaKAhGEiAHF7EliVnQkjoLVIMPtJpBKHYd3A8GYH9jJzrWwmHx5Qjp7vDAX0suGRym1vtm/9W1/HyR8vczfMs6Sk8DSv855/5dlX9oQq52hT8syyp2rx5Id17IAyAM3wIjQPMOHzytEB64q6D5zT91yNbnx3V/nqnd017S9Y0605k3izoXLpsxde2n38yoOV9s1LcjwzNjbdX6asnBVaBj/6/DwKwPkpcqbDG7BnsXoSqWnUAmottYF6jMSdVyYZh3zVXCjwTiwwHH6sGuRiEHQGzuRX6whZkp123oy1BWE2mEfJ/tvIRtM4ZM5bDXiMsPMaAKOTyc5uL57rqyyc5y5JE5pm1i2S2iUX0CcaQ6lC6Zog7JqSqZmYlosl2K6pwNA84zRnQW6SaALYZQGW5lhCtU/W34N6o+bKfZ8cf3/Cl/+iTX3wBzpOY4mRkeNf3rptycGSshQWgGbYt5jFc2e0+DglIrwl6DVWQ7BuwaJ3Xk1J4VL5urnLl/Wf+gHU/hZoZdKNym6lG+I34FaNeZKcSpJIo2IeCVvpdsDGfKvzJnAwmeD37Ow65ZWwSowpgwX5T69s/rB55dP5BcpgDKFV8p7q2sn/1uc93bVzT/w6UrCqDTWvfCq/oCD/qZXNoUj8BL5Kp6GU017frfNXkAtiiyf/SOCEeLqnd8R/Ql9GlCRfctS6k5chvIBuQ1zCCjoCHL2DHNHIXxMJ3kQeO8lbsUXONeSfA5EjcG6/E+KdhN4bP04vBhdi883+BFBzQbxFbvZzQeY9LNBZc0FNfn5NwfDn6rCTnTw6R8o+gfpf5hCom33cRuiTlss3KHmZjD+BPN+5gXuA2ziS/Q73mLxUkpbKN/eqwz5uK0X9F3h2d1V4nGNgZGBgAOJd776+iue3+crAzc4AAje5Bfcg0xz9YHEOBiYQBQA8FQlFAHicY2BkYGBnAAGOPgaG//85+hkYGVCBMgBGGwNYAAAAeJxjYGBgYB8EmKOPgQEAQ04BfgAAAAAAAA4AaAB+AMwA4AECAUIBbAGYAcICGAJYArQC4AMwA7AD3gQwBJYE3AUkBWYFigYgBmYGtAbqB1gIEghYCG4IhAi2COh4nGNgZGBgUGYoZWBnAAEmIOYCQgaG/2A+AwAYCQG2AHicXZBNaoNAGIZfE5PQCKFQ2lUps2oXBfOzzAESyDKBQJdGR2NQR3QSSE/QE/QEPUUPUHqsvsrXjTMw83zPvPMNCuAWP3DQDAejdm1GjzwS7pMmwi75XngAD4/CQ/oX4TFe4Qt7uMMbOzjuDc0EmXCP/C7cJ38Iu+RP4QEe8CU8pP8WHmOPX2EPz87TPo202ey2OjlnQSXV/6arOjWFmvszMWtd6CqwOlKHq6ovycLaWMWVydXKFFZnmVFlZU46tP7R2nI5ncbi/dDkfDtFBA2DDXbYkhKc+V0Bqs5Zt9JM1HQGBRTm/EezTmZNKtpcAMs9Yu6AK9caF76zoLWIWcfMGOSkVduvSWechqZsz040Ib2PY3urxBJTzriT95lipz+TN1fmAAAAeJxtkMl2wjAMRfOAhABlKm2h80C3+ajgCKKDY6cegP59TYBzukAL+z1Zsq8ctaJTTKPrsUQLbXQQI0EXKXroY4AbDDHCGBNMcYsZ7nCPB8yxwCOe8IwXvOIN7/jAJ76wxHfUqWX+OzgumWAjJMV17i0Ndlr6irLKO+qftdT7i6y4uFSUvCknay+lFYZIZaQcmfH/xIFdYn98bqhra1aKTM/6lWMnyaYirx1rFUQZFBkb2zJUtoXeJCeg0WnLtHeSFc3OtrnozNwqi0TkSpBMDB1nSde5oJXW23hTS2/T0LilglXX7dmFVxLnq5U0vYATHFk3zX3BOisoQHNDFDeZnqKDy9hRNawN7Vh727hFzcJ5c8TILrKZfH7tIPxAFP0BpLeJPA==) format(\"woff\");font-weight:400;font-style:normal}.video-js .vjs-big-play-button .vjs-icon-placeholder:before,.video-js .vjs-play-control .vjs-icon-placeholder,.vjs-icon-play{font-family:VideoJS;font-weight:400;font-style:normal}.video-js .vjs-big-play-button .vjs-icon-placeholder:before,.video-js .vjs-play-control .vjs-icon-placeholder:before,.vjs-icon-play:before{content:\"\\f101\"}.vjs-icon-play-circle{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-play-circle:before{content:\"\\f102\"}.video-js .vjs-play-control.vjs-playing .vjs-icon-placeholder,.vjs-icon-pause{font-family:VideoJS;font-weight:400;font-style:normal}.video-js .vjs-play-control.vjs-playing .vjs-icon-placeholder:before,.vjs-icon-pause:before{content:\"\\f103\"}.video-js .vjs-mute-control.vjs-vol-0 .vjs-icon-placeholder,.vjs-icon-volume-mute{font-family:VideoJS;font-weight:400;font-style:normal}.video-js .vjs-mute-control.vjs-vol-0 .vjs-icon-placeholder:before,.vjs-icon-volume-mute:before{content:\"\\f104\"}.video-js .vjs-mute-control.vjs-vol-1 .vjs-icon-placeholder,.vjs-icon-volume-low{font-family:VideoJS;font-weight:400;font-style:normal}.video-js .vjs-mute-control.vjs-vol-1 .vjs-icon-placeholder:before,.vjs-icon-volume-low:before{content:\"\\f105\"}.video-js .vjs-mute-control.vjs-vol-2 .vjs-icon-placeholder,.vjs-icon-volume-mid{font-family:VideoJS;font-weight:400;font-style:normal}.video-js .vjs-mute-control.vjs-vol-2 .vjs-icon-placeholder:before,.vjs-icon-volume-mid:before{content:\"\\f106\"}.video-js .vjs-mute-control .vjs-icon-placeholder,.vjs-icon-volume-high{font-family:VideoJS;font-weight:400;font-style:normal}.video-js .vjs-mute-control .vjs-icon-placeholder:before,.vjs-icon-volume-high:before{content:\"\\f107\"}.video-js .vjs-fullscreen-control .vjs-icon-placeholder,.vjs-icon-fullscreen-enter{font-family:VideoJS;font-weight:400;font-style:normal}.video-js .vjs-fullscreen-control .vjs-icon-placeholder:before,.vjs-icon-fullscreen-enter:before{content:\"\\f108\"}.video-js.vjs-fullscreen .vjs-fullscreen-control .vjs-icon-placeholder,.vjs-icon-fullscreen-exit{font-family:VideoJS;font-weight:400;font-style:normal}.video-js.vjs-fullscreen .vjs-fullscreen-control .vjs-icon-placeholder:before,.vjs-icon-fullscreen-exit:before{content:\"\\f109\"}.vjs-icon-square{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-square:before{content:\"\\f10a\"}.vjs-icon-spinner{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-spinner:before{content:\"\\f10b\"}.video-js .vjs-subs-caps-button .vjs-icon-placeholder,.video-js .vjs-subtitles-button .vjs-icon-placeholder,.video-js.video-js:lang(en-AU) .vjs-subs-caps-button .vjs-icon-placeholder,.video-js.video-js:lang(en-GB) .vjs-subs-caps-button .vjs-icon-placeholder,.video-js.video-js:lang(en-IE) .vjs-subs-caps-button .vjs-icon-placeholder,.video-js.video-js:lang(en-NZ) .vjs-subs-caps-button .vjs-icon-placeholder,.vjs-icon-subtitles{font-family:VideoJS;font-weight:400;font-style:normal}.video-js .vjs-subs-caps-button .vjs-icon-placeholder:before,.video-js .vjs-subtitles-button .vjs-icon-placeholder:before,.video-js.video-js:lang(en-AU) .vjs-subs-caps-button .vjs-icon-placeholder:before,.video-js.video-js:lang(en-GB) .vjs-subs-caps-button .vjs-icon-placeholder:before,.video-js.video-js:lang(en-IE) .vjs-subs-caps-button .vjs-icon-placeholder:before,.video-js.video-js:lang(en-NZ) .vjs-subs-caps-button .vjs-icon-placeholder:before,.vjs-icon-subtitles:before{content:\"\\f10c\"}.video-js .vjs-captions-button .vjs-icon-placeholder,.video-js:lang(en) .vjs-subs-caps-button .vjs-icon-placeholder,.video-js:lang(fr-CA) .vjs-subs-caps-button .vjs-icon-placeholder,.vjs-icon-captions{font-family:VideoJS;font-weight:400;font-style:normal}.video-js .vjs-captions-button .vjs-icon-placeholder:before,.video-js:lang(en) .vjs-subs-caps-button .vjs-icon-placeholder:before,.video-js:lang(fr-CA) .vjs-subs-caps-button .vjs-icon-placeholder:before,.vjs-icon-captions:before{content:\"\\f10d\"}.video-js .vjs-chapters-button .vjs-icon-placeholder,.vjs-icon-chapters{font-family:VideoJS;font-weight:400;font-style:normal}.video-js .vjs-chapters-button .vjs-icon-placeholder:before,.vjs-icon-chapters:before{content:\"\\f10e\"}.vjs-icon-share{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-share:before{content:\"\\f10f\"}.vjs-icon-cog{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-cog:before{content:\"\\f110\"}.video-js .vjs-play-progress,.video-js .vjs-volume-level,.vjs-icon-circle,.vjs-seek-to-live-control .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.video-js .vjs-play-progress:before,.video-js .vjs-volume-level:before,.vjs-icon-circle:before,.vjs-seek-to-live-control .vjs-icon-placeholder:before{content:\"\\f111\"}.vjs-icon-circle-outline{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-circle-outline:before{content:\"\\f112\"}.vjs-icon-circle-inner-circle{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-circle-inner-circle:before{content:\"\\f113\"}.vjs-icon-hd{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-hd:before{content:\"\\f114\"}.video-js .vjs-control.vjs-close-button .vjs-icon-placeholder,.vjs-icon-cancel{font-family:VideoJS;font-weight:400;font-style:normal}.video-js .vjs-control.vjs-close-button .vjs-icon-placeholder:before,.vjs-icon-cancel:before{content:\"\\f115\"}.video-js .vjs-play-control.vjs-ended .vjs-icon-placeholder,.vjs-icon-replay{font-family:VideoJS;font-weight:400;font-style:normal}.video-js .vjs-play-control.vjs-ended .vjs-icon-placeholder:before,.vjs-icon-replay:before{content:\"\\f116\"}.vjs-icon-facebook{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-facebook:before{content:\"\\f117\"}.vjs-icon-gplus{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-gplus:before{content:\"\\f118\"}.vjs-icon-linkedin{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-linkedin:before{content:\"\\f119\"}.vjs-icon-twitter{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-twitter:before{content:\"\\f11a\"}.vjs-icon-tumblr{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-tumblr:before{content:\"\\f11b\"}.vjs-icon-pinterest{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-pinterest:before{content:\"\\f11c\"}.video-js .vjs-descriptions-button .vjs-icon-placeholder,.vjs-icon-audio-description{font-family:VideoJS;font-weight:400;font-style:normal}.video-js .vjs-descriptions-button .vjs-icon-placeholder:before,.vjs-icon-audio-description:before{content:\"\\f11d\"}.video-js .vjs-audio-button .vjs-icon-placeholder,.vjs-icon-audio{font-family:VideoJS;font-weight:400;font-style:normal}.video-js .vjs-audio-button .vjs-icon-placeholder:before,.vjs-icon-audio:before{content:\"\\f11e\"}.vjs-icon-next-item{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-next-item:before{content:\"\\f11f\"}.vjs-icon-previous-item{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-previous-item:before{content:\"\\f120\"}.video-js .vjs-picture-in-picture-control .vjs-icon-placeholder,.vjs-icon-picture-in-picture-enter{font-family:VideoJS;font-weight:400;font-style:normal}.video-js .vjs-picture-in-picture-control .vjs-icon-placeholder:before,.vjs-icon-picture-in-picture-enter:before{content:\"\\f121\"}.video-js.vjs-picture-in-picture .vjs-picture-in-picture-control .vjs-icon-placeholder,.vjs-icon-picture-in-picture-exit{font-family:VideoJS;font-weight:400;font-style:normal}.video-js.vjs-picture-in-picture .vjs-picture-in-picture-control .vjs-icon-placeholder:before,.vjs-icon-picture-in-picture-exit:before{content:\"\\f122\"}.video-js{display:block;vertical-align:top;box-sizing:border-box;color:#fff;background-color:#000;position:relative;padding:0;font-size:10px;line-height:1;font-weight:400;font-style:normal;font-family:Arial,Helvetica,sans-serif;word-break:initial}.video-js:-moz-full-screen{position:absolute}.video-js:-webkit-full-screen{width:100%!important;height:100%!important}.video-js[tabindex=\"-1\"]{outline:0}.video-js *,.video-js :after,.video-js :before{box-sizing:inherit}.video-js ul{font-family:inherit;font-size:inherit;line-height:inherit;list-style-position:outside;margin-left:0;margin-right:0;margin-top:0;margin-bottom:0}.video-js.vjs-1-1,.video-js.vjs-16-9,.video-js.vjs-4-3,.video-js.vjs-9-16,.video-js.vjs-fluid{width:100%;max-width:100%}.video-js.vjs-1-1:not(.vjs-audio-only-mode),.video-js.vjs-16-9:not(.vjs-audio-only-mode),.video-js.vjs-4-3:not(.vjs-audio-only-mode),.video-js.vjs-9-16:not(.vjs-audio-only-mode),.video-js.vjs-fluid:not(.vjs-audio-only-mode){height:0}.video-js.vjs-16-9:not(.vjs-audio-only-mode){padding-top:56.25%}.video-js.vjs-4-3:not(.vjs-audio-only-mode){padding-top:75%}.video-js.vjs-9-16:not(.vjs-audio-only-mode){padding-top:177.7777777778%}.video-js.vjs-1-1:not(.vjs-audio-only-mode){padding-top:100%}.video-js.vjs-fill:not(.vjs-audio-only-mode){width:100%;height:100%}.video-js .vjs-tech{position:absolute;top:0;left:0;width:100%;height:100%}.video-js.vjs-audio-only-mode .vjs-tech{display:none}body.vjs-full-window{padding:0;margin:0;height:100%}.vjs-full-window .video-js.vjs-fullscreen{position:fixed;overflow:hidden;z-index:1000;left:0;top:0;bottom:0;right:0}.video-js.vjs-fullscreen:not(.vjs-ios-native-fs){width:100%!important;height:100%!important;padding-top:0!important}.video-js.vjs-fullscreen.vjs-user-inactive{cursor:none}.vjs-hidden{display:none!important}.vjs-disabled{opacity:.5;cursor:default}.video-js .vjs-offscreen{height:1px;left:-9999px;position:absolute;top:0;width:1px}.vjs-lock-showing{display:block!important;opacity:1!important;visibility:visible!important}.vjs-no-js{padding:20px;color:#fff;background-color:#000;font-size:18px;font-family:Arial,Helvetica,sans-serif;text-align:center;width:300px;height:150px;margin:0 auto}.vjs-no-js a,.vjs-no-js a:visited{color:#66a8cc}.video-js .vjs-big-play-button{font-size:3em;line-height:1.5em;height:1.63332em;width:3em;display:block;position:absolute;top:10px;left:10px;padding:0;cursor:pointer;opacity:1;border:.06666em solid #fff;background-color:#2b333f;background-color:rgba(43,51,63,.7);border-radius:.3em;transition:all .4s}.vjs-big-play-centered .vjs-big-play-button{top:50%;left:50%;margin-top:-.81666em;margin-left:-1.5em}.video-js .vjs-big-play-button:focus,.video-js:hover .vjs-big-play-button{border-color:#fff;background-color:#73859f;background-color:rgba(115,133,159,.5);transition:all 0s}.vjs-controls-disabled .vjs-big-play-button,.vjs-error .vjs-big-play-button,.vjs-has-started .vjs-big-play-button,.vjs-using-native-controls .vjs-big-play-button{display:none}.vjs-has-started.vjs-paused.vjs-show-big-play-button-on-pause .vjs-big-play-button{display:block}.video-js button{background:0 0;border:none;color:inherit;display:inline-block;font-size:inherit;line-height:inherit;text-transform:none;text-decoration:none;transition:none;-webkit-appearance:none;-moz-appearance:none;appearance:none}.vjs-control .vjs-button{width:100%;height:100%}.video-js .vjs-control.vjs-close-button{cursor:pointer;height:3em;position:absolute;right:0;top:.5em;z-index:2}.video-js .vjs-modal-dialog{background:rgba(0,0,0,.8);background:linear-gradient(180deg,rgba(0,0,0,.8),rgba(255,255,255,0));overflow:auto}.video-js .vjs-modal-dialog>*{box-sizing:border-box}.vjs-modal-dialog .vjs-modal-dialog-content{font-size:1.2em;line-height:1.5;padding:20px 24px;z-index:1}.vjs-menu-button{cursor:pointer}.vjs-menu-button.vjs-disabled{cursor:default}.vjs-workinghover .vjs-menu-button.vjs-disabled:hover .vjs-menu{display:none}.vjs-menu .vjs-menu-content{display:block;padding:0;margin:0;font-family:Arial,Helvetica,sans-serif;overflow:auto}.vjs-menu .vjs-menu-content>*{box-sizing:border-box}.vjs-scrubbing .vjs-control.vjs-menu-button:hover .vjs-menu{display:none}.vjs-menu li{list-style:none;margin:0;padding:.2em 0;line-height:1.4em;font-size:1.2em;text-align:center;text-transform:lowercase}.js-focus-visible .vjs-menu li.vjs-menu-item:hover,.vjs-menu li.vjs-menu-item:focus,.vjs-menu li.vjs-menu-item:hover{background-color:#73859f;background-color:rgba(115,133,159,.5)}.js-focus-visible .vjs-menu li.vjs-selected:hover,.vjs-menu li.vjs-selected,.vjs-menu li.vjs-selected:focus,.vjs-menu li.vjs-selected:hover{background-color:#fff;color:#2b333f}.js-focus-visible .vjs-menu :not(.vjs-selected):focus:not(.focus-visible),.video-js .vjs-menu :not(.vjs-selected):focus:not(:focus-visible){background:0 0}.vjs-menu li.vjs-menu-title{text-align:center;text-transform:uppercase;font-size:1em;line-height:2em;padding:0;margin:0 0 .3em 0;font-weight:700;cursor:default}.vjs-menu-button-popup .vjs-menu{display:none;position:absolute;bottom:0;width:10em;left:-3em;height:0;margin-bottom:1.5em;border-top-color:rgba(43,51,63,.7)}.vjs-menu-button-popup .vjs-menu .vjs-menu-content{background-color:#2b333f;background-color:rgba(43,51,63,.7);position:absolute;width:100%;bottom:1.5em;max-height:15em}.vjs-layout-tiny .vjs-menu-button-popup .vjs-menu .vjs-menu-content,.vjs-layout-x-small .vjs-menu-button-popup .vjs-menu .vjs-menu-content{max-height:5em}.vjs-layout-small .vjs-menu-button-popup .vjs-menu .vjs-menu-content{max-height:10em}.vjs-layout-medium .vjs-menu-button-popup .vjs-menu .vjs-menu-content{max-height:14em}.vjs-layout-huge .vjs-menu-button-popup .vjs-menu .vjs-menu-content,.vjs-layout-large .vjs-menu-button-popup .vjs-menu .vjs-menu-content,.vjs-layout-x-large .vjs-menu-button-popup .vjs-menu .vjs-menu-content{max-height:25em}.vjs-menu-button-popup .vjs-menu.vjs-lock-showing,.vjs-workinghover .vjs-menu-button-popup.vjs-hover .vjs-menu{display:block}.video-js .vjs-menu-button-inline{transition:all .4s;overflow:hidden}.video-js .vjs-menu-button-inline:before{width:2.222222222em}.video-js .vjs-menu-button-inline.vjs-slider-active,.video-js .vjs-menu-button-inline:focus,.video-js .vjs-menu-button-inline:hover,.video-js.vjs-no-flex .vjs-menu-button-inline{width:12em}.vjs-menu-button-inline .vjs-menu{opacity:0;height:100%;width:auto;position:absolute;left:4em;top:0;padding:0;margin:0;transition:all .4s}.vjs-menu-button-inline.vjs-slider-active .vjs-menu,.vjs-menu-button-inline:focus .vjs-menu,.vjs-menu-button-inline:hover .vjs-menu{display:block;opacity:1}.vjs-no-flex .vjs-menu-button-inline .vjs-menu{display:block;opacity:1;position:relative;width:auto}.vjs-no-flex .vjs-menu-button-inline.vjs-slider-active .vjs-menu,.vjs-no-flex .vjs-menu-button-inline:focus .vjs-menu,.vjs-no-flex .vjs-menu-button-inline:hover .vjs-menu{width:auto}.vjs-menu-button-inline .vjs-menu-content{width:auto;height:100%;margin:0;overflow:hidden}.video-js .vjs-control-bar{display:none;width:100%;position:absolute;bottom:0;left:0;right:0;height:3em;background-color:#2b333f;background-color:rgba(43,51,63,.7)}.vjs-audio-only-mode .vjs-control-bar,.vjs-has-started .vjs-control-bar{display:flex;visibility:visible;opacity:1;transition:visibility .1s,opacity .1s}.vjs-has-started.vjs-user-inactive.vjs-playing .vjs-control-bar{visibility:visible;opacity:0;pointer-events:none;transition:visibility 1s,opacity 1s}.vjs-controls-disabled .vjs-control-bar,.vjs-error .vjs-control-bar,.vjs-using-native-controls .vjs-control-bar{display:none!important}.vjs-audio-only-mode.vjs-has-started.vjs-user-inactive.vjs-playing .vjs-control-bar,.vjs-audio.vjs-has-started.vjs-user-inactive.vjs-playing .vjs-control-bar{opacity:1;visibility:visible}.vjs-has-started.vjs-no-flex .vjs-control-bar{display:table}.video-js .vjs-control{position:relative;text-align:center;margin:0;padding:0;height:100%;width:4em;flex:none}.video-js .vjs-control.vjs-visible-text{width:auto;padding-left:1em;padding-right:1em}.vjs-button>.vjs-icon-placeholder:before{font-size:1.8em;line-height:1.67}.vjs-button>.vjs-icon-placeholder{display:block}.video-js .vjs-control:focus,.video-js .vjs-control:focus:before,.video-js .vjs-control:hover:before{text-shadow:0 0 1em #fff}.video-js :not(.vjs-visible-text)>.vjs-control-text{border:0;clip:rect(0 0 0 0);height:1px;overflow:hidden;padding:0;position:absolute;width:1px}.vjs-no-flex .vjs-control{display:table-cell;vertical-align:middle}.video-js .vjs-custom-control-spacer{display:none}.video-js .vjs-progress-control{cursor:pointer;flex:auto;display:flex;align-items:center;min-width:4em;touch-action:none}.video-js .vjs-progress-control.disabled{cursor:default}.vjs-live .vjs-progress-control{display:none}.vjs-liveui .vjs-progress-control{display:flex;align-items:center}.vjs-no-flex .vjs-progress-control{width:auto}.video-js .vjs-progress-holder{flex:auto;transition:all .2s;height:.3em}.video-js .vjs-progress-control .vjs-progress-holder{margin:0 10px}.video-js .vjs-progress-control:hover .vjs-progress-holder{font-size:1.6666666667em}.video-js .vjs-progress-control:hover .vjs-progress-holder.disabled{font-size:1em}.video-js .vjs-progress-holder .vjs-load-progress,.video-js .vjs-progress-holder .vjs-load-progress div,.video-js .vjs-progress-holder .vjs-play-progress{position:absolute;display:block;height:100%;margin:0;padding:0;width:0}.video-js .vjs-play-progress{background-color:#fff}.video-js .vjs-play-progress:before{font-size:.9em;position:absolute;right:-.5em;top:-.3333333333em;z-index:1}.video-js .vjs-load-progress{background:rgba(115,133,159,.5)}.video-js .vjs-load-progress div{background:rgba(115,133,159,.75)}.video-js .vjs-time-tooltip{background-color:#fff;background-color:rgba(255,255,255,.8);border-radius:.3em;color:#000;float:right;font-family:Arial,Helvetica,sans-serif;font-size:1em;padding:6px 8px 8px 8px;pointer-events:none;position:absolute;top:-3.4em;visibility:hidden;z-index:1}.video-js .vjs-progress-holder:focus .vjs-time-tooltip{display:none}.video-js .vjs-progress-control:hover .vjs-progress-holder:focus .vjs-time-tooltip,.video-js .vjs-progress-control:hover .vjs-time-tooltip{display:block;font-size:.6em;visibility:visible}.video-js .vjs-progress-control.disabled:hover .vjs-time-tooltip{font-size:1em}.video-js .vjs-progress-control .vjs-mouse-display{display:none;position:absolute;width:1px;height:100%;background-color:#000;z-index:1}.vjs-no-flex .vjs-progress-control .vjs-mouse-display{z-index:0}.video-js .vjs-progress-control:hover .vjs-mouse-display{display:block}.video-js.vjs-user-inactive .vjs-progress-control .vjs-mouse-display{visibility:hidden;opacity:0;transition:visibility 1s,opacity 1s}.video-js.vjs-user-inactive.vjs-no-flex .vjs-progress-control .vjs-mouse-display{display:none}.vjs-mouse-display .vjs-time-tooltip{color:#fff;background-color:#000;background-color:rgba(0,0,0,.8)}.video-js .vjs-slider{position:relative;cursor:pointer;padding:0;margin:0 .45em 0 .45em;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;background-color:#73859f;background-color:rgba(115,133,159,.5)}.video-js .vjs-slider.disabled{cursor:default}.video-js .vjs-slider:focus{text-shadow:0 0 1em #fff;box-shadow:0 0 1em #fff}.video-js .vjs-mute-control{cursor:pointer;flex:none}.video-js .vjs-volume-control{cursor:pointer;margin-right:1em;display:flex}.video-js .vjs-volume-control.vjs-volume-horizontal{width:5em}.video-js .vjs-volume-panel .vjs-volume-control{visibility:visible;opacity:0;width:1px;height:1px;margin-left:-1px}.video-js .vjs-volume-panel{transition:width 1s}.video-js .vjs-volume-panel .vjs-volume-control.vjs-slider-active,.video-js .vjs-volume-panel .vjs-volume-control:active,.video-js .vjs-volume-panel.vjs-hover .vjs-mute-control~.vjs-volume-control,.video-js .vjs-volume-panel.vjs-hover .vjs-volume-control,.video-js .vjs-volume-panel:active .vjs-volume-control,.video-js .vjs-volume-panel:focus .vjs-volume-control{visibility:visible;opacity:1;position:relative;transition:visibility .1s,opacity .1s,height .1s,width .1s,left 0s,top 0s}.video-js .vjs-volume-panel .vjs-volume-control.vjs-slider-active.vjs-volume-horizontal,.video-js .vjs-volume-panel .vjs-volume-control:active.vjs-volume-horizontal,.video-js .vjs-volume-panel.vjs-hover .vjs-mute-control~.vjs-volume-control.vjs-volume-horizontal,.video-js .vjs-volume-panel.vjs-hover .vjs-volume-control.vjs-volume-horizontal,.video-js .vjs-volume-panel:active .vjs-volume-control.vjs-volume-horizontal,.video-js .vjs-volume-panel:focus .vjs-volume-control.vjs-volume-horizontal{width:5em;height:3em;margin-right:0}.video-js .vjs-volume-panel .vjs-volume-control.vjs-slider-active.vjs-volume-vertical,.video-js .vjs-volume-panel .vjs-volume-control:active.vjs-volume-vertical,.video-js .vjs-volume-panel.vjs-hover .vjs-mute-control~.vjs-volume-control.vjs-volume-vertical,.video-js .vjs-volume-panel.vjs-hover .vjs-volume-control.vjs-volume-vertical,.video-js .vjs-volume-panel:active .vjs-volume-control.vjs-volume-vertical,.video-js .vjs-volume-panel:focus .vjs-volume-control.vjs-volume-vertical{left:-3.5em;transition:left 0s}.video-js .vjs-volume-panel.vjs-volume-panel-horizontal.vjs-hover,.video-js .vjs-volume-panel.vjs-volume-panel-horizontal.vjs-slider-active,.video-js .vjs-volume-panel.vjs-volume-panel-horizontal:active{width:10em;transition:width .1s}.video-js .vjs-volume-panel.vjs-volume-panel-horizontal.vjs-mute-toggle-only{width:4em}.video-js .vjs-volume-panel .vjs-volume-control.vjs-volume-vertical{height:8em;width:3em;left:-3000em;transition:visibility 1s,opacity 1s,height 1s 1s,width 1s 1s,left 1s 1s,top 1s 1s}.video-js .vjs-volume-panel .vjs-volume-control.vjs-volume-horizontal{transition:visibility 1s,opacity 1s,height 1s 1s,width 1s,left 1s 1s,top 1s 1s}.video-js.vjs-no-flex .vjs-volume-panel .vjs-volume-control.vjs-volume-horizontal{width:5em;height:3em;visibility:visible;opacity:1;position:relative;transition:none}.video-js.vjs-no-flex .vjs-volume-control.vjs-volume-vertical,.video-js.vjs-no-flex .vjs-volume-panel .vjs-volume-control.vjs-volume-vertical{position:absolute;bottom:3em;left:.5em}.video-js .vjs-volume-panel{display:flex}.video-js .vjs-volume-bar{margin:1.35em .45em}.vjs-volume-bar.vjs-slider-horizontal{width:5em;height:.3em}.vjs-volume-bar.vjs-slider-vertical{width:.3em;height:5em;margin:1.35em auto}.video-js .vjs-volume-level{position:absolute;bottom:0;left:0;background-color:#fff}.video-js .vjs-volume-level:before{position:absolute;font-size:.9em;z-index:1}.vjs-slider-vertical .vjs-volume-level{width:.3em}.vjs-slider-vertical .vjs-volume-level:before{top:-.5em;left:-.3em;z-index:1}.vjs-slider-horizontal .vjs-volume-level{height:.3em}.vjs-slider-horizontal .vjs-volume-level:before{top:-.3em;right:-.5em}.video-js .vjs-volume-panel.vjs-volume-panel-vertical{width:4em}.vjs-volume-bar.vjs-slider-vertical .vjs-volume-level{height:100%}.vjs-volume-bar.vjs-slider-horizontal .vjs-volume-level{width:100%}.video-js .vjs-volume-vertical{width:3em;height:8em;bottom:8em;background-color:#2b333f;background-color:rgba(43,51,63,.7)}.video-js .vjs-volume-horizontal .vjs-menu{left:-2em}.video-js .vjs-volume-tooltip{background-color:#fff;background-color:rgba(255,255,255,.8);border-radius:.3em;color:#000;float:right;font-family:Arial,Helvetica,sans-serif;font-size:1em;padding:6px 8px 8px 8px;pointer-events:none;position:absolute;top:-3.4em;visibility:hidden;z-index:1}.video-js .vjs-volume-control:hover .vjs-progress-holder:focus .vjs-volume-tooltip,.video-js .vjs-volume-control:hover .vjs-volume-tooltip{display:block;font-size:1em;visibility:visible}.video-js .vjs-volume-vertical:hover .vjs-progress-holder:focus .vjs-volume-tooltip,.video-js .vjs-volume-vertical:hover .vjs-volume-tooltip{left:1em;top:-12px}.video-js .vjs-volume-control.disabled:hover .vjs-volume-tooltip{font-size:1em}.video-js .vjs-volume-control .vjs-mouse-display{display:none;position:absolute;width:100%;height:1px;background-color:#000;z-index:1}.video-js .vjs-volume-horizontal .vjs-mouse-display{width:1px;height:100%}.vjs-no-flex .vjs-volume-control .vjs-mouse-display{z-index:0}.video-js .vjs-volume-control:hover .vjs-mouse-display{display:block}.video-js.vjs-user-inactive .vjs-volume-control .vjs-mouse-display{visibility:hidden;opacity:0;transition:visibility 1s,opacity 1s}.video-js.vjs-user-inactive.vjs-no-flex .vjs-volume-control .vjs-mouse-display{display:none}.vjs-mouse-display .vjs-volume-tooltip{color:#fff;background-color:#000;background-color:rgba(0,0,0,.8)}.vjs-poster{display:inline-block;vertical-align:middle;background-repeat:no-repeat;background-position:50% 50%;background-size:contain;background-color:#000;cursor:pointer;margin:0;padding:0;position:absolute;top:0;right:0;bottom:0;left:0;height:100%}.vjs-has-started .vjs-poster,.vjs-using-native-controls .vjs-poster{display:none}.vjs-audio.vjs-has-started .vjs-poster,.vjs-has-started.vjs-audio-poster-mode .vjs-poster{display:block}.video-js .vjs-live-control{display:flex;align-items:flex-start;flex:auto;font-size:1em;line-height:3em}.vjs-no-flex .vjs-live-control{display:table-cell;width:auto;text-align:left}.video-js.vjs-liveui .vjs-live-control,.video-js:not(.vjs-live) .vjs-live-control{display:none}.video-js .vjs-seek-to-live-control{align-items:center;cursor:pointer;flex:none;display:inline-flex;height:100%;padding-left:.5em;padding-right:.5em;font-size:1em;line-height:3em;width:auto;min-width:4em}.vjs-no-flex .vjs-seek-to-live-control{display:table-cell;width:auto;text-align:left}.video-js.vjs-live:not(.vjs-liveui) .vjs-seek-to-live-control,.video-js:not(.vjs-live) .vjs-seek-to-live-control{display:none}.vjs-seek-to-live-control.vjs-control.vjs-at-live-edge{cursor:auto}.vjs-seek-to-live-control .vjs-icon-placeholder{margin-right:.5em;color:#888}.vjs-seek-to-live-control.vjs-control.vjs-at-live-edge .vjs-icon-placeholder{color:red}.video-js .vjs-time-control{flex:none;font-size:1em;line-height:3em;min-width:2em;width:auto;padding-left:1em;padding-right:1em}.vjs-live .vjs-time-control{display:none}.video-js .vjs-current-time,.vjs-no-flex .vjs-current-time{display:none}.video-js .vjs-duration,.vjs-no-flex .vjs-duration{display:none}.vjs-time-divider{display:none;line-height:3em}.vjs-live .vjs-time-divider{display:none}.video-js .vjs-play-control{cursor:pointer}.video-js .vjs-play-control .vjs-icon-placeholder{flex:none}.vjs-text-track-display{position:absolute;bottom:3em;left:0;right:0;top:0;pointer-events:none}.video-js.vjs-controls-disabled .vjs-text-track-display,.video-js.vjs-user-inactive.vjs-playing .vjs-text-track-display{bottom:1em}.video-js .vjs-text-track{font-size:1.4em;text-align:center;margin-bottom:.1em}.vjs-subtitles{color:#fff}.vjs-captions{color:#fc6}.vjs-tt-cue{display:block}video::-webkit-media-text-track-display{transform:translateY(-3em)}.video-js.vjs-controls-disabled video::-webkit-media-text-track-display,.video-js.vjs-user-inactive.vjs-playing video::-webkit-media-text-track-display{transform:translateY(-1.5em)}.video-js .vjs-picture-in-picture-control{cursor:pointer;flex:none}.video-js.vjs-audio-only-mode .vjs-picture-in-picture-control{display:none}.video-js .vjs-fullscreen-control{cursor:pointer;flex:none}.video-js.vjs-audio-only-mode .vjs-fullscreen-control{display:none}.vjs-playback-rate .vjs-playback-rate-value,.vjs-playback-rate>.vjs-menu-button{position:absolute;top:0;left:0;width:100%;height:100%}.vjs-playback-rate .vjs-playback-rate-value{pointer-events:none;font-size:1.5em;line-height:2;text-align:center}.vjs-playback-rate .vjs-menu{width:4em;left:0}.vjs-error .vjs-error-display .vjs-modal-dialog-content{font-size:1.4em;text-align:center}.vjs-error .vjs-error-display:before{color:#fff;content:\"X\";font-family:Arial,Helvetica,sans-serif;font-size:4em;left:0;line-height:1;margin-top:-.5em;position:absolute;text-shadow:.05em .05em .1em #000;text-align:center;top:50%;vertical-align:middle;width:100%}.vjs-loading-spinner{display:none;position:absolute;top:50%;left:50%;margin:-25px 0 0 -25px;opacity:.85;text-align:left;border:6px solid rgba(43,51,63,.7);box-sizing:border-box;background-clip:padding-box;width:50px;height:50px;border-radius:25px;visibility:hidden}.vjs-seeking .vjs-loading-spinner,.vjs-waiting .vjs-loading-spinner{display:block;-webkit-animation:vjs-spinner-show 0s linear .3s forwards;animation:vjs-spinner-show 0s linear .3s forwards}.vjs-loading-spinner:after,.vjs-loading-spinner:before{content:\"\";position:absolute;margin:-6px;box-sizing:inherit;width:inherit;height:inherit;border-radius:inherit;opacity:1;border:inherit;border-color:transparent;border-top-color:#fff}.vjs-seeking .vjs-loading-spinner:after,.vjs-seeking .vjs-loading-spinner:before,.vjs-waiting .vjs-loading-spinner:after,.vjs-waiting .vjs-loading-spinner:before{-webkit-animation:vjs-spinner-spin 1.1s cubic-bezier(.6,.2,0,.8) infinite,vjs-spinner-fade 1.1s linear infinite;animation:vjs-spinner-spin 1.1s cubic-bezier(.6,.2,0,.8) infinite,vjs-spinner-fade 1.1s linear infinite}.vjs-seeking .vjs-loading-spinner:before,.vjs-waiting .vjs-loading-spinner:before{border-top-color:#fff}.vjs-seeking .vjs-loading-spinner:after,.vjs-waiting .vjs-loading-spinner:after{border-top-color:#fff;-webkit-animation-delay:.44s;animation-delay:.44s}@keyframes vjs-spinner-show{to{visibility:visible}}@-webkit-keyframes vjs-spinner-show{to{visibility:visible}}@keyframes vjs-spinner-spin{100%{transform:rotate(360deg)}}@-webkit-keyframes vjs-spinner-spin{100%{-webkit-transform:rotate(360deg)}}@keyframes vjs-spinner-fade{0%{border-top-color:#73859f}20%{border-top-color:#73859f}35%{border-top-color:#fff}60%{border-top-color:#73859f}100%{border-top-color:#73859f}}@-webkit-keyframes vjs-spinner-fade{0%{border-top-color:#73859f}20%{border-top-color:#73859f}35%{border-top-color:#fff}60%{border-top-color:#73859f}100%{border-top-color:#73859f}}.video-js.vjs-audio-only-mode .vjs-captions-button{display:none}.vjs-chapters-button .vjs-menu ul{width:24em}.video-js.vjs-audio-only-mode .vjs-descriptions-button{display:none}.video-js .vjs-subs-caps-button+.vjs-menu .vjs-captions-menu-item .vjs-menu-item-text .vjs-icon-placeholder{vertical-align:middle;display:inline-block;margin-bottom:-.1em}.video-js .vjs-subs-caps-button+.vjs-menu .vjs-captions-menu-item .vjs-menu-item-text .vjs-icon-placeholder:before{font-family:VideoJS;content:\"\uf10d\";font-size:1.5em;line-height:inherit}.video-js.vjs-audio-only-mode .vjs-subs-caps-button{display:none}.video-js .vjs-audio-button+.vjs-menu .vjs-main-desc-menu-item .vjs-menu-item-text .vjs-icon-placeholder{vertical-align:middle;display:inline-block;margin-bottom:-.1em}.video-js .vjs-audio-button+.vjs-menu .vjs-main-desc-menu-item .vjs-menu-item-text .vjs-icon-placeholder:before{font-family:VideoJS;content:\" \uf11d\";font-size:1.5em;line-height:inherit}.video-js.vjs-layout-small .vjs-current-time,.video-js.vjs-layout-small .vjs-duration,.video-js.vjs-layout-small .vjs-playback-rate,.video-js.vjs-layout-small .vjs-remaining-time,.video-js.vjs-layout-small .vjs-time-divider,.video-js.vjs-layout-small .vjs-volume-control,.video-js.vjs-layout-tiny .vjs-current-time,.video-js.vjs-layout-tiny .vjs-duration,.video-js.vjs-layout-tiny .vjs-playback-rate,.video-js.vjs-layout-tiny .vjs-remaining-time,.video-js.vjs-layout-tiny .vjs-time-divider,.video-js.vjs-layout-tiny .vjs-volume-control,.video-js.vjs-layout-x-small .vjs-current-time,.video-js.vjs-layout-x-small .vjs-duration,.video-js.vjs-layout-x-small .vjs-playback-rate,.video-js.vjs-layout-x-small .vjs-remaining-time,.video-js.vjs-layout-x-small .vjs-time-divider,.video-js.vjs-layout-x-small .vjs-volume-control{display:none}.video-js.vjs-layout-small .vjs-volume-panel.vjs-volume-panel-horizontal.vjs-hover,.video-js.vjs-layout-small .vjs-volume-panel.vjs-volume-panel-horizontal.vjs-slider-active,.video-js.vjs-layout-small .vjs-volume-panel.vjs-volume-panel-horizontal:active,.video-js.vjs-layout-small .vjs-volume-panel.vjs-volume-panel-horizontal:hover,.video-js.vjs-layout-tiny .vjs-volume-panel.vjs-volume-panel-horizontal.vjs-hover,.video-js.vjs-layout-tiny .vjs-volume-panel.vjs-volume-panel-horizontal.vjs-slider-active,.video-js.vjs-layout-tiny .vjs-volume-panel.vjs-volume-panel-horizontal:active,.video-js.vjs-layout-tiny .vjs-volume-panel.vjs-volume-panel-horizontal:hover,.video-js.vjs-layout-x-small .vjs-volume-panel.vjs-volume-panel-horizontal.vjs-hover,.video-js.vjs-layout-x-small .vjs-volume-panel.vjs-volume-panel-horizontal.vjs-slider-active,.video-js.vjs-layout-x-small .vjs-volume-panel.vjs-volume-panel-horizontal:active,.video-js.vjs-layout-x-small .vjs-volume-panel.vjs-volume-panel-horizontal:hover{width:auto;width:initial}.video-js.vjs-layout-tiny .vjs-progress-control,.video-js.vjs-layout-x-small .vjs-progress-control{display:none}.video-js.vjs-layout-x-small .vjs-custom-control-spacer{flex:auto;display:block}.video-js.vjs-layout-x-small.vjs-no-flex .vjs-custom-control-spacer{width:auto}.vjs-modal-dialog.vjs-text-track-settings{background-color:#2b333f;background-color:rgba(43,51,63,.75);color:#fff;height:70%}.vjs-text-track-settings .vjs-modal-dialog-content{display:table}.vjs-text-track-settings .vjs-track-settings-colors,.vjs-text-track-settings .vjs-track-settings-controls,.vjs-text-track-settings .vjs-track-settings-font{display:table-cell}.vjs-text-track-settings .vjs-track-settings-controls{text-align:right;vertical-align:bottom}@supports (display:grid){.vjs-text-track-settings .vjs-modal-dialog-content{display:grid;grid-template-columns:1fr 1fr;grid-template-rows:1fr;padding:20px 24px 0 24px}.vjs-track-settings-controls .vjs-default-button{margin-bottom:20px}.vjs-text-track-settings .vjs-track-settings-controls{grid-column:1/-1}.vjs-layout-small .vjs-text-track-settings .vjs-modal-dialog-content,.vjs-layout-tiny .vjs-text-track-settings .vjs-modal-dialog-content,.vjs-layout-x-small .vjs-text-track-settings .vjs-modal-dialog-content{grid-template-columns:1fr}}.vjs-track-setting>select{margin-right:1em;margin-bottom:.5em}.vjs-text-track-settings fieldset{margin:5px;padding:3px;border:none}.vjs-text-track-settings fieldset span{display:inline-block}.vjs-text-track-settings fieldset span>select{max-width:7.3em}.vjs-text-track-settings legend{color:#fff;margin:0 0 5px 0}.vjs-text-track-settings .vjs-label{position:absolute;clip:rect(1px 1px 1px 1px);clip:rect(1px,1px,1px,1px);display:block;margin:0 0 5px 0;padding:0;border:0;height:1px;width:1px;overflow:hidden}.vjs-track-settings-controls button:active,.vjs-track-settings-controls button:focus{outline-style:solid;outline-width:medium;background-image:linear-gradient(0deg,#fff 88%,#73859f 100%)}.vjs-track-settings-controls button:hover{color:rgba(43,51,63,.75)}.vjs-track-settings-controls button{background-color:#fff;background-image:linear-gradient(-180deg,#fff 88%,#73859f 100%);color:#2b333f;cursor:pointer;border-radius:2px}.vjs-track-settings-controls .vjs-default-button{margin-right:1em}@media print{.video-js>:not(.vjs-tech):not(.vjs-poster){visibility:hidden}}.vjs-resize-manager{position:absolute;top:0;left:0;width:100%;height:100%;border:none;z-index:-1000}.js-focus-visible .video-js :focus:not(.focus-visible){outline:0}.video-js :focus:not(:focus-visible){outline:0}",
          "",
          "---------------"
        ],
        "static/vendor/video-js/video.min.js||static/vendor/video-js/video.min.js": [
          "File: static/vendor/video-js/video.min.js -> static/vendor/video-js/video.min.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "12: !function(e,t){\"object\"==typeof exports&&\"undefined\"!=typeof module?module.exports=t():\"function\"==typeof define&&define.amd?define(t):(e=\"undefined\"!=typeof globalThis?globalThis:e||self).videojs=t()}(this,function(){\"use strict\";for(var e,u=\"7.20.1\",i={},a=function(e,t){return i[e]=i[e]||[],t&&(i[e]=i[e].concat(t)),i[e]},n=function(e,t){t=a(e).indexOf(t);return!(t<=-1)&&(i[e]=i[e].slice(),i[e].splice(t,1),!0)},l={prefixed:!0},t=[[\"requestFullscreen\",\"exitFullscreen\",\"fullscreenElement\",\"fullscreenEnabled\",\"fullscreenchange\",\"fullscreenerror\",\"fullscreen\"],[\"webkitRequestFullscreen\",\"webkitExitFullscreen\",\"webkitFullscreenElement\",\"webkitFullscreenEnabled\",\"webkitfullscreenchange\",\"webkitfullscreenerror\",\"-webkit-full-screen\"],[\"mozRequestFullScreen\",\"mozCancelFullScreen\",\"mozFullScreenElement\",\"mozFullScreenEnabled\",\"mozfullscreenchange\",\"mozfullscreenerror\",\"-moz-full-screen\"],[\"msRequestFullscreen\",\"msExitFullscreen\",\"msFullscreenElement\",\"msFullscreenEnabled\",\"MSFullscreenChange\",\"MSFullscreenError\",\"-ms-fullscreen\"]],r=t[0],s=0;s<t.length;s++)if(t[s][1]in document){e=t[s];break}if(e){for(var o=0;o<e.length;o++)l[r[o]]=e[o];l.prefixed=e[0]!==r[0]}var c=[],d=function(a,s){return function(e,t,i){var n,r=s.levels[t],t=new RegExp(\"^(\"+r+\")$\");\"log\"!==e&&i.unshift(e.toUpperCase()+\":\"),i.unshift(a+\":\"),c&&(c.push([].concat(i)),n=c.length-1e3,c.splice(0,0<n?n:0)),!window.console||(n=!(n=window.console[e])&&\"debug\"===e?window.console.info||window.console.log:n)&&r&&t.test(e)&&n[Array.isArray(i)?\"apply\":\"call\"](window.console,i)}};var h=function t(i){function n(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];a(\"log\",r,t)}var r=\"info\",a=d(i,n);return n.createLogger=function(e){return t(i+\": \"+e)},n.levels={all:\"debug|log|warn|error\",off:\"\",debug:\"debug|log|warn|error\",info:\"log|warn|error\",warn:\"warn|error\",error:\"error\",DEFAULT:r},n.level=function(e){if(\"string\"==typeof e){if(!n.levels.hasOwnProperty(e))throw new Error('\"'+e+'\" in not a valid log level');r=e}return r},(n.history=function(){return c?[].concat(c):[]}).filter=function(t){return(c||[]).filter(function(e){return new RegExp(\".*\"+t+\".*\").test(e[0])})},n.history.clear=function(){c&&(c.length=0)},n.history.disable=function(){null!==c&&(c.length=0,c=null)},n.history.enable=function(){null===c&&(c=[])},n.error=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return a(\"error\",r,t)},n.warn=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return a(\"warn\",r,t)},n.debug=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return a(\"debug\",r,t)},n}(\"VIDEOJS\"),p=h.createLogger,f=\"undefined\"!=typeof globalThis?globalThis:\"undefined\"!=typeof window?window:\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:{};function m(e,t){return e(t={exports:{}},t.exports),t.exports}var g=m(function(e){function t(){return e.exports=t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i,n=arguments[t];for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},t.apply(this,arguments)}e.exports=t}),y=Object.prototype.toString,v=function(e){return T(e)?Object.keys(e):[]};function _(t,i){v(t).forEach(function(e){return i(t[e],e)})}function b(i){for(var e=arguments.length,t=new Array(1<e?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return Object.assign?g.apply(void 0,[i].concat(t)):(t.forEach(function(e){e&&_(e,function(e,t){i[t]=e})}),i)}function T(e){return!!e&&\"object\"==typeof e}function S(e){return T(e)&&\"[object Object]\"===y.call(e)&&e.constructor===Object}function w(e,t){if(!e||!t)return\"\";if(\"function\"!=typeof window.getComputedStyle)return\"\";var i;try{i=window.getComputedStyle(e)}catch(e){return\"\"}return i?i.getPropertyValue(t)||i[t]:\"\"}var E=window.navigator&&window.navigator.userAgent||\"\",k=/AppleWebKit\\/([\\d.]+)/i.exec(E),C=k?parseFloat(k.pop()):null,I=/iPod/i.test(E),x=(jt=E.match(/OS (\\d+)_/i))&&jt[1]?jt[1]:null,A=/Android/i.test(E),P=function(){var e=E.match(/Android (\\d+)(?:\\.(\\d+))?(?:\\.(\\d+))*/i);if(!e)return null;var t=e[1]&&parseFloat(e[1]),i=e[2]&&parseFloat(e[2]);return t&&i?parseFloat(e[1]+\".\"+e[2]):t||null}(),L=A&&P<5&&C<537,D=/Firefox/i.test(E),O=/Edg/i.test(E),M=!O&&(/Chrome/i.test(E)||/CriOS/i.test(E)),R=(zt=E.match(/(Chrome|CriOS)\\/(\\d+)/))&&zt[2]?parseFloat(zt[2]):null,N=Xt=!(Xt=(Xt=/MSIE\\s(\\d+)\\.\\d/.exec(E))&&parseFloat(Xt[1]))&&/Trident\\/7.0/i.test(E)&&/rv:11.0/.test(E)?11:Xt,U=/Safari/i.test(E)&&!M&&!A&&!O,B=/Windows/i.test(E),F=Boolean(X()&&(\"ontouchstart\"in window||window.navigator.maxTouchPoints||window.DocumentTouch&&window.document instanceof window.DocumentTouch)),j=/iPad/i.test(E)||U&&F&&!/iPhone/i.test(E),H=/iPhone/i.test(E)&&!j,q=H||j||I,V=(U||q)&&!M,W=Object.freeze({__proto__:null,IS_IPOD:I,IOS_VERSION:x,IS_ANDROID:A,ANDROID_VERSION:P,IS_NATIVE_ANDROID:L,IS_FIREFOX:D,IS_EDGE:O,IS_CHROME:M,CHROME_VERSION:R,IE_VERSION:N,IS_SAFARI:U,IS_WINDOWS:B,TOUCH_ENABLED:F,IS_IPAD:j,IS_IPHONE:H,IS_IOS:q,IS_ANY_SAFARI:V});function G(e){return\"string\"==typeof e&&Boolean(e.trim())}function z(e){if(0<=e.indexOf(\" \"))throw new Error(\"class has illegal whitespace characters\")}function X(){return document===window.document}function K(e){return T(e)&&1===e.nodeType}function Y(){try{return window.parent!==window.self}catch(e){return!0}}function Q(i){return function(e,t){if(!G(e))return document[i](null);t=K(t=G(t)?document.querySelector(t):t)?t:document;return t[i]&&t[i](e)}}function $(e,i,t,n){void 0===e&&(e=\"div\"),void 0===i&&(i={}),void 0===t&&(t={});var r=document.createElement(e);return Object.getOwnPropertyNames(i).forEach(function(e){var t=i[e];-1!==e.indexOf(\"aria-\")||\"role\"===e||\"type\"===e?(h.warn(\"Setting attributes in the second argument of createEl()\\nhas been deprecated. Use the third argument instead.\\ncreateEl(type, properties, attributes). Attempting to set \"+e+\" to \"+t+\".\"),r.setAttribute(e,t)):\"textContent\"===e?J(r,t):r[e]===t&&\"tabIndex\"!==e||(r[e]=t)}),Object.getOwnPropertyNames(t).forEach(function(e){r.setAttribute(e,t[e])}),n&&ye(r,n),r}function J(e,t){return\"undefined\"==typeof e.textContent?e.innerText=t:e.textContent=t,e}function Z(e,t){t.firstChild?t.insertBefore(e,t.firstChild):t.appendChild(e)}function ee(e,t){return z(t),e.classList?e.classList.contains(t):new RegExp(\"(^|\\\\s)\"+t+\"($|\\\\s)\").test(e.className)}function te(e,t){return e.classList?e.classList.add(t):ee(e,t)||(e.className=(e.className+\" \"+t).trim()),e}function ie(e,t){return e?(e.classList?e.classList.remove(t):(z(t),e.className=e.className.split(/\\s+/).filter(function(e){return e!==t}).join(\" \")),e):(h.warn(\"removeClass was called with an element that doesn't exist\"),null)}function ne(e,t,i){var n=ee(e,t);if((i=\"boolean\"!=typeof(i=\"function\"==typeof i?i(e,t):i)?!n:i)!==n)return(i?te:ie)(e,t),e}function re(i,n){Object.getOwnPropertyNames(n).forEach(function(e){var t=n[e];null===t||\"undefined\"==typeof t||!1===t?i.removeAttribute(e):i.setAttribute(e,!0===t?\"\":t)})}function ae(e){var t={},i=\",autoplay,controls,playsinline,loop,muted,default,defaultMuted,\";if(e&&e.attributes&&0<e.attributes.length)for(var n=e.attributes,r=n.length-1;0<=r;r--){var a=n[r].name,s=n[r].value;\"boolean\"!=typeof e[a]&&-1===i.indexOf(\",\"+a+\",\")||(s=null!==s),t[a]=s}return t}function se(e,t){return e.getAttribute(t)}function oe(e,t,i){e.setAttribute(t,i)}function ue(e,t){e.removeAttribute(t)}function le(){document.body.focus(),document.onselectstart=function(){return!1}}function ce(){document.onselectstart=function(){return!0}}function de(e){if(e&&e.getBoundingClientRect&&e.parentNode){var t=e.getBoundingClientRect(),i={};return[\"bottom\",\"height\",\"left\",\"right\",\"top\",\"width\"].forEach(function(e){void 0!==t[e]&&(i[e]=t[e])}),i.height||(i.height=parseFloat(w(e,\"height\"))),i.width||(i.width=parseFloat(w(e,\"width\"))),i}}function he(e){if(!e||e&&!e.offsetParent)return{left:0,top:0,width:0,height:0};for(var t=e.offsetWidth,i=e.offsetHeight,n=0,r=0;e.offsetParent&&e!==document[l.fullscreenElement];)n+=e.offsetLeft,r+=e.offsetTop,e=e.offsetParent;return{left:n,top:r,width:t,height:i}}function pe(e,t){var i={x:0,y:0};if(q)for(var n=e;n&&\"html\"!==n.nodeName.toLowerCase();){var r,a=w(n,\"transform\");/^matrix/.test(a)?(r=a.slice(7,-1).split(/,\\s/).map(Number),i.x+=r[4],i.y+=r[5]):/^matrix3d/.test(a)&&(a=a.slice(9,-1).split(/,\\s/).map(Number),i.x+=a[12],i.y+=a[13]),n=n.parentNode}var s={},o=he(t.target),u=he(e),l=u.width,c=u.height,e=t.offsetY-(u.top-o.top),o=t.offsetX-(u.left-o.left);return t.changedTouches&&(o=t.changedTouches[0].pageX-u.left,e=t.changedTouches[0].pageY+u.top,q&&(o-=i.x,e-=i.y)),s.y=1-Math.max(0,Math.min(1,e/c)),s.x=Math.max(0,Math.min(1,o/l)),s}function fe(e){return T(e)&&3===e.nodeType}function me(e){for(;e.firstChild;)e.removeChild(e.firstChild);return e}function ge(e){return\"function\"==typeof e&&(e=e()),(Array.isArray(e)?e:[e]).map(function(e){return K(e=\"function\"==typeof e?e():e)||fe(e)?e:\"string\"==typeof e&&/\\S/.test(e)?document.createTextNode(e):void 0}).filter(function(e){return e})}function ye(t,e){return ge(e).forEach(function(e){return t.appendChild(e)}),t}function ve(e,t){return ye(me(e),t)}function _e(e){return void 0===e.button&&void 0===e.buttons||(0===e.button&&void 0===e.buttons||(\"mouseup\"===e.type&&0===e.button&&0===e.buttons||0===e.button&&1===e.buttons))}var be,Te=Q(\"querySelector\"),Se=Q(\"querySelectorAll\"),we=Object.freeze({__proto__:null,isReal:X,isEl:K,isInFrame:Y,createEl:$,textContent:J,prependTo:Z,hasClass:ee,addClass:te,removeClass:ie,toggleClass:ne,setAttributes:re,getAttributes:ae,getAttribute:se,setAttribute:oe,removeAttribute:ue,blockTextSelection:le,unblockTextSelection:ce,getBoundingClientRect:de,findPosition:he,getPointerPosition:pe,isTextNode:fe,emptyEl:me,normalizeContent:ge,appendContent:ye,insertContent:ve,isSingleLeftClick:_e,$:Te,$$:Se}),Ee=!1,ke=function(){if(!1!==be.options.autoSetup){var e=Array.prototype.slice.call(document.getElementsByTagName(\"video\")),t=Array.prototype.slice.call(document.getElementsByTagName(\"audio\")),i=Array.prototype.slice.call(document.getElementsByTagName(\"video-js\")),n=e.concat(t,i);if(n&&0<n.length)for(var r=0,a=n.length;r<a;r++){var s=n[r];if(!s||!s.getAttribute){Ce(1);break}void 0===s.player&&null!==s.getAttribute(\"data-setup\")&&be(s)}else Ee||Ce(1)}};function Ce(e,t){X()&&(t&&(be=t),window.setTimeout(ke,e))}function Ie(){Ee=!0,window.removeEventListener(\"load\",Ie)}X()&&(\"complete\"===document.readyState?Ie():window.addEventListener(\"load\",Ie));function xe(e){var t=document.createElement(\"style\");return t.className=e,t}function Ae(e,t){e.styleSheet?e.styleSheet.cssText=t:e.textContent=t}var Pe=3;window.WeakMap||(ui=function(){function e(){this.vdata=\"vdata\"+Math.floor(window.performance&&window.performance.now()||Date.now()),this.data={}}var t=e.prototype;return t.set=function(e,t){var i=e[this.vdata]||Pe++;return e[this.vdata]||(e[this.vdata]=i),this.data[i]=t,this},t.get=function(e){var t=e[this.vdata];if(t)return this.data[t];h(\"We have no data for this element\",e)},t.has=function(e){return e[this.vdata]in this.data},t.delete=function(e){var t=e[this.vdata];t&&(delete this.data[t],delete e[this.vdata])},e}());var Le,De=new(window.WeakMap?WeakMap:ui);function Oe(e,t){var i;De.has(e)&&(0===(i=De.get(e)).handlers[t].length&&(delete i.handlers[t],e.removeEventListener?e.removeEventListener(t,i.dispatcher,!1):e.detachEvent&&e.detachEvent(\"on\"+t,i.dispatcher)),Object.getOwnPropertyNames(i.handlers).length<=0&&(delete i.handlers,delete i.dispatcher,delete i.disabled),0===Object.getOwnPropertyNames(i).length&&De.delete(e))}function Me(t,i,e,n){e.forEach(function(e){t(i,e,n)})}function Re(e){if(e.fixed_)return e;function t(){return!0}function i(){return!1}if(!e||!e.isPropagationStopped||!e.isImmediatePropagationStopped){var n,r,a,s=e||window.event;for(n in e={},s)\"layerX\"!==n&&\"layerY\"!==n&&\"keyLocation\"!==n&&\"webkitMovementX\"!==n&&\"webkitMovementY\"!==n&&\"path\"!==n&&(\"returnValue\"===n&&s.preventDefault||(e[n]=s[n]));e.target||(e.target=e.srcElement||document),e.relatedTarget||(e.relatedTarget=e.fromElement===e.target?e.toElement:e.fromElement),e.preventDefault=function(){s.preventDefault&&s.preventDefault(),e.returnValue=!1,s.returnValue=!1,e.defaultPrevented=!0},e.defaultPrevented=!1,e.stopPropagation=function(){s.stopPropagation&&s.stopPropagation(),e.cancelBubble=!0,s.cancelBubble=!0,e.isPropagationStopped=t},e.isPropagationStopped=i,e.stopImmediatePropagation=function(){s.stopImmediatePropagation&&s.stopImmediatePropagation(),e.isImmediatePropagationStopped=t,e.stopPropagation()},e.isImmediatePropagationStopped=i,null!==e.clientX&&void 0!==e.clientX&&(r=document.documentElement,a=document.body,e.pageX=e.clientX+(r&&r.scrollLeft||a&&a.scrollLeft||0)-(r&&r.clientLeft||a&&a.clientLeft||0),e.pageY=e.clientY+(r&&r.scrollTop||a&&a.scrollTop||0)-(r&&r.clientTop||a&&a.clientTop||0)),e.which=e.charCode||e.keyCode,null!==e.button&&void 0!==e.button&&(e.button=1&e.button?0:4&e.button?1:2&e.button?2:0)}return e.fixed_=!0,e}var Ne=function(){if(\"boolean\"!=typeof Le){Le=!1;try{var e=Object.defineProperty({},\"passive\",{get:function(){Le=!0}});window.addEventListener(\"test\",null,e),window.removeEventListener(\"test\",null,e)}catch(e){}}return Le},Ue=[\"touchstart\",\"touchmove\"];function Be(s,e,t){if(Array.isArray(e))return Me(Be,s,e,t);De.has(s)||De.set(s,{});var o=De.get(s);o.handlers||(o.handlers={}),o.handlers[e]||(o.handlers[e]=[]),t.guid||(t.guid=Pe++),o.handlers[e].push(t),o.dispatcher||(o.disabled=!1,o.dispatcher=function(e,t){if(!o.disabled){e=Re(e);var i=o.handlers[e.type];if(i)for(var n=i.slice(0),r=0,a=n.length;r<a&&!e.isImmediatePropagationStopped();r++)try{n[r].call(s,e,t)}catch(e){h.error(e)}}}),1===o.handlers[e].length&&(s.addEventListener?(t=!1,Ne()&&-1<Ue.indexOf(e)&&(t={passive:!0}),s.addEventListener(e,o.dispatcher,t)):s.attachEvent&&s.attachEvent(\"on\"+e,o.dispatcher))}function Fe(e,t,i){if(De.has(e)){var n=De.get(e);if(n.handlers){if(Array.isArray(t))return Me(Fe,e,t,i);var r=function(e,t){n.handlers[t]=[],Oe(e,t)};if(void 0!==t){var a=n.handlers[t];if(a)if(i){if(i.guid)for(var s=0;s<a.length;s++)a[s].guid===i.guid&&a.splice(s--,1);Oe(e,t)}else r(e,t)}else for(var o in n.handlers)Object.prototype.hasOwnProperty.call(n.handlers||{},o)&&r(e,o)}}}function je(e,t,i){var n=De.has(e)?De.get(e):{},r=e.parentNode||e.ownerDocument;return\"string\"==typeof t?t={type:t,target:e}:t.target||(t.target=e),t=Re(t),n.dispatcher&&n.dispatcher.call(e,t,i),r&&!t.isPropagationStopped()&&!0===t.bubbles?je.call(null,r,t,i):!r&&!t.defaultPrevented&&t.target&&t.target[t.type]&&(De.has(t.target)||De.set(t.target,{}),r=De.get(t.target),t.target[t.type]&&(r.disabled=!0,\"function\"==typeof t.target[t.type]&&t.target[t.type](),r.disabled=!1)),!t.defaultPrevented}function He(e,t,i){if(Array.isArray(t))return Me(He,e,t,i);function n(){Fe(e,t,n),i.apply(this,arguments)}n.guid=i.guid=i.guid||Pe++,Be(e,t,n)}function qe(e,t,i){function n(){Fe(e,t,n),i.apply(this,arguments)}n.guid=i.guid=i.guid||Pe++,Be(e,t,n)}function Ve(e,t,i){return t.guid||(t.guid=Pe++),(e=t.bind(e)).guid=i?i+\"_\"+t.guid:t.guid,e}function We(t,i){var n=window.performance.now();return function(){var e=window.performance.now();i<=e-n&&(t.apply(void 0,arguments),n=e)}}function Ge(n,r,a,s){var o;function e(){var e=this,t=arguments,i=function(){i=o=null,a||n.apply(e,t)};!o&&a&&n.apply(e,t),s.clearTimeout(o),o=s.setTimeout(i,r)}return void 0===s&&(s=window),e.cancel=function(){s.clearTimeout(o),o=null},e}function ze(){}var Xe,Ke=Object.freeze({__proto__:null,fixEvent:Re,on:Be,off:Fe,trigger:je,one:He,any:qe});ze.prototype.allowedEvents_={},ze.prototype.addEventListener=ze.prototype.on=function(e,t){var i=this.addEventListener;this.addEventListener=function(){},Be(this,e,t),this.addEventListener=i},ze.prototype.removeEventListener=ze.prototype.off=function(e,t){Fe(this,e,t)},ze.prototype.one=function(e,t){var i=this.addEventListener;this.addEventListener=function(){},He(this,e,t),this.addEventListener=i},ze.prototype.any=function(e,t){var i=this.addEventListener;this.addEventListener=function(){},qe(this,e,t),this.addEventListener=i},ze.prototype.dispatchEvent=ze.prototype.trigger=function(e){var t=e.type||e;e=Re(e=\"string\"==typeof e?{type:t}:e),this.allowedEvents_[t]&&this[\"on\"+t]&&this[\"on\"+t](e),je(this,e)},ze.prototype.queueTrigger=function(e){var t=this;Xe=Xe||new Map;var i=e.type||e,n=Xe.get(this);n||(n=new Map,Xe.set(this,n));var r=n.get(i);n.delete(i),window.clearTimeout(r);r=window.setTimeout(function(){0===n.size&&(n=null,Xe.delete(t)),t.trigger(e)},0);n.set(i,r)};function Ye(e){return\"function\"==typeof e.name?e.name():\"string\"==typeof e.name?e.name:e.name_||(e.constructor&&e.constructor.name?e.constructor.name:typeof e)}function Qe(e){return\"string\"==typeof e&&/\\S/.test(e)||Array.isArray(e)&&!!e.length}function $e(e,t,i){if(!e||!e.nodeName&&!it(e))throw new Error(\"Invalid target for \"+Ye(t)+\"#\"+i+\"; must be a DOM node or evented object.\")}function Je(e,t,i){if(!Qe(e))throw new Error(\"Invalid event type for \"+Ye(t)+\"#\"+i+\"; must be a non-empty string or array.\")}function Ze(e,t,i){if(\"function\"!=typeof e)throw new Error(\"Invalid listener for \"+Ye(t)+\"#\"+i+\"; must be a function.\")}function et(e,t,i){var n,r,a=t.length<3||t[0]===e||t[0]===e.eventBusEl_,t=a?(n=e.eventBusEl_,3<=t.length&&t.shift(),r=t[0],t[1]):(n=t[0],r=t[1],t[2]);return $e(n,e,i),Je(r,e,i),Ze(t,e,i),{isTargetingSelf:a,target:n,type:r,listener:t=Ve(e,t)}}function tt(e,t,i,n){$e(e,e,t),e.nodeName?Ke[t](e,i,n):e[t](i,n)}var it=function(t){return t instanceof ze||!!t.eventBusEl_&&[\"on\",\"one\",\"off\",\"trigger\"].every(function(e){return\"function\"==typeof t[e]})},nt={on:function(){for(var e=this,t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];var r,a=et(this,i,\"on\"),s=a.isTargetingSelf,o=a.target,u=a.type,l=a.listener;tt(o,\"on\",u,l),s||((r=function(){return e.off(o,u,l)}).guid=l.guid,(s=function(){return e.off(\"dispose\",r)}).guid=l.guid,tt(this,\"on\",\"dispose\",r),tt(o,\"on\",\"dispose\",s))},one:function(){for(var r=this,e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var n=et(this,t,\"one\"),a=n.isTargetingSelf,s=n.target,o=n.type,u=n.listener;a?tt(s,\"one\",o,u):((a=function e(){r.off(s,o,e);for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];u.apply(null,i)}).guid=u.guid,tt(s,\"one\",o,a))},any:function(){for(var r=this,e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var n=et(this,t,\"any\"),a=n.isTargetingSelf,s=n.target,o=n.type,u=n.listener;a?tt(s,\"any\",o,u):((a=function e(){r.off(s,o,e);for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];u.apply(null,i)}).guid=u.guid,tt(s,\"any\",o,a))},off:function(e,t,i){!e||Qe(e)?Fe(this.eventBusEl_,e,t):(t=t,$e(e=e,this,\"off\"),Je(t,this,\"off\"),Ze(i,this,\"off\"),i=Ve(this,i),this.off(\"dispose\",i),e.nodeName?(Fe(e,t,i),Fe(e,\"dispose\",i)):it(e)&&(e.off(t,i),e.off(\"dispose\",i)))},trigger:function(e,t){$e(this.eventBusEl_,this,\"trigger\");var i=e&&\"string\"!=typeof e?e.type:e;if(!Qe(i)){i=\"Invalid event type for \"+Ye(this)+\"#trigger; must be a non-empty string or object with a type key that has a non-empty value.\";if(!e)throw new Error(i);(this.log||h).error(i)}return je(this.eventBusEl_,e,t)}};function rt(e,t){t=(t=void 0===t?{}:t).eventBusKey;if(t){if(!e[t].nodeName)throw new Error('The eventBusKey \"'+t+'\" does not refer to an element.');e.eventBusEl_=e[t]}else e.eventBusEl_=$(\"span\",{className:\"vjs-event-bus\"});return b(e,nt),e.eventedCallbacks&&e.eventedCallbacks.forEach(function(e){e()}),e.on(\"dispose\",function(){e.off(),[e,e.el_,e.eventBusEl_].forEach(function(e){e&&De.has(e)&&De.delete(e)}),window.setTimeout(function(){e.eventBusEl_=null},0)}),e}var at={state:{},setState:function(e){var i,n=this;return _(e=\"function\"==typeof e?e():e,function(e,t){n.state[t]!==e&&((i=i||{})[t]={from:n.state[t],to:e}),n.state[t]=e}),i&&it(this)&&this.trigger({changes:i,type:\"statechanged\"}),i}};function st(e,t){return b(e,at),e.state=b({},e.state,t),\"function\"==typeof e.handleStateChanged&&it(e)&&e.on(\"statechanged\",e.handleStateChanged),e}function ot(e){return\"string\"!=typeof e?e:e.replace(/./,function(e){return e.toLowerCase()})}function ut(e){return\"string\"!=typeof e?e:e.replace(/./,function(e){return e.toUpperCase()})}function lt(){for(var i={},e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.forEach(function(e){e&&_(e,function(e,t){S(e)?(S(i[t])||(i[t]={}),i[t]=lt(i[t],e)):i[t]=e})}),i}var ct=window.Map||function(){function e(){this.map_={}}var t=e.prototype;return t.has=function(e){return e in this.map_},t.delete=function(e){var t=this.has(e);return delete this.map_[e],t},t.set=function(e,t){return this.map_[e]=t,this},t.forEach=function(e,t){for(var i in this.map_)e.call(t,this.map_[i],i,this)},e}(),dt=window.Set||function(){function e(){this.set_={}}var t=e.prototype;return t.has=function(e){return e in this.set_},t.delete=function(e){var t=this.has(e);return delete this.set_[e],t},t.add=function(e){return this.set_[e]=1,this},t.forEach=function(e,t){for(var i in this.set_)e.call(t,i,i,this)},e}(),ht=m(function(e,t){function i(e){if(!e||\"object\"!=typeof e||(t=e.which||e.keyCode||e.charCode)&&(e=t),\"number\"==typeof e)return o[e];var t=String(e),e=n[t.toLowerCase()];return e||((e=r[t.toLowerCase()])?e:1===t.length?t.charCodeAt(0):void 0)}i.isEventKey=function(e,t){if(e&&\"object\"==typeof e){var i=e.which||e.keyCode||e.charCode;if(null==i)return!1;if(\"string\"==typeof t){e=n[t.toLowerCase()];if(e)return e===i;if(e=r[t.toLowerCase()])return e===i}else if(\"number\"==typeof t)return t===i;return!1}};for(var n=(t=e.exports=i).code=t.codes={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,\"pause/break\":19,\"caps lock\":20,esc:27,space:32,\"page up\":33,\"page down\":34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46,command:91,\"left command\":91,\"right command\":93,\"numpad *\":106,\"numpad +\":107,\"numpad -\":109,\"numpad .\":110,\"numpad /\":111,\"num lock\":144,\"scroll lock\":145,\"my computer\":182,\"my calculator\":183,\";\":186,\"=\":187,\",\":188,\"-\":189,\".\":190,\"/\":191,\"`\":192,\"[\":219,\"\\\\\":220,\"]\":221,\"'\":222},r=t.aliases={windows:91,\"\u21e7\":16,\"\u2325\":18,\"\u2303\":17,\"\u2318\":91,ctl:17,control:17,option:18,pause:19,break:19,caps:20,return:13,escape:27,spc:32,spacebar:32,pgup:33,pgdn:34,ins:45,del:46,cmd:91},a=97;a<123;a++)n[String.fromCharCode(a)]=a-32;for(var a=48;a<58;a++)n[a-48]=a;for(a=1;a<13;a++)n[\"f\"+a]=a+111;for(a=0;a<10;a++)n[\"numpad \"+a]=a+96;var s,o=t.names=t.title={};for(a in n)o[n[a]]=a;for(s in r)n[s]=r[s]});ht.code,ht.codes,ht.aliases,ht.names,ht.title;var pt=function(){function s(e,t,i){var n=this;!e&&this.play?this.player_=e=this:this.player_=e,this.isDisposed_=!1,this.parentComponent_=null,this.options_=lt({},this.options_),t=this.options_=lt(this.options_,t),this.id_=t.id||t.el&&t.el.id,this.id_||(e=e&&e.id&&e.id()||\"no_player\",this.id_=e+\"_component_\"+Pe++),this.name_=t.name||null,t.el?this.el_=t.el:!1!==t.createEl&&(this.el_=this.createEl()),t.className&&this.el_&&t.className.split(\" \").forEach(function(e){return n.addClass(e)}),!1!==t.evented&&(rt(this,{eventBusKey:this.el_?\"el_\":null}),this.handleLanguagechange=this.handleLanguagechange.bind(this),this.on(this.player_,\"languagechange\",this.handleLanguagechange)),st(this,this.constructor.defaultState),this.children_=[],this.childIndex_={},this.childNameIndex_={},this.setTimeoutIds_=new dt,this.setIntervalIds_=new dt,this.rafIds_=new dt,this.namedRafs_=new ct,(this.clearingTimersOnDispose_=!1)!==t.initChildren&&this.initChildren(),this.ready(i),!1!==t.reportTouchActivity&&this.enableTouchActivity()}var e=s.prototype;return e.dispose=function(e){if(void 0===e&&(e={}),!this.isDisposed_){if(this.readyQueue_&&(this.readyQueue_.length=0),this.trigger({type:\"dispose\",bubbles:!1}),this.isDisposed_=!0,this.children_)for(var t=this.children_.length-1;0<=t;t--)this.children_[t].dispose&&this.children_[t].dispose();this.children_=null,this.childIndex_=null,this.childNameIndex_=null,this.parentComponent_=null,this.el_&&(this.el_.parentNode&&(e.restoreEl?this.el_.parentNode.replaceChild(e.restoreEl,this.el_):this.el_.parentNode.removeChild(this.el_)),this.el_=null),this.player_=null}},e.isDisposed=function(){return Boolean(this.isDisposed_)},e.player=function(){return this.player_},e.options=function(e){return e&&(this.options_=lt(this.options_,e)),this.options_},e.el=function(){return this.el_},e.createEl=function(e,t,i){return $(e,t,i)},e.localize=function(e,i,t){void 0===t&&(t=e);var n=this.player_.language&&this.player_.language(),r=this.player_.languages&&this.player_.languages(),a=r&&r[n],n=n&&n.split(\"-\")[0],n=r&&r[n],t=t;return a&&a[e]?t=a[e]:n&&n[e]&&(t=n[e]),t=i?t.replace(/\\{(\\d+)\\}/g,function(e,t){t=i[t-1];return\"undefined\"==typeof t?e:t}):t},e.handleLanguagechange=function(){},e.contentEl=function(){return this.contentEl_||this.el_},e.id=function(){return this.id_},e.name=function(){return this.name_},e.children=function(){return this.children_},e.getChildById=function(e){return this.childIndex_[e]},e.getChild=function(e){if(e)return this.childNameIndex_[e]},e.getDescendant=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];for(var t=t.reduce(function(e,t){return e.concat(t)},[]),n=this,r=0;r<t.length;r++)if(!(n=n.getChild(t[r]))||!n.getChild)return;return n},e.addChild=function(e,t,i){if(void 0===t&&(t={}),void 0===i&&(i=this.children_.length),\"string\"==typeof e){var n=ut(e),r=t.componentClass||n;t.name=n;var a=s.getComponent(r);if(!a)throw new Error(\"Component \"+r+\" does not exist\");if(\"function\"!=typeof a)return null;a=new a(this.player_||this,t)}else a=e;return a.parentComponent_&&a.parentComponent_.removeChild(a),this.children_.splice(i,0,a),a.parentComponent_=this,\"function\"==typeof a.id&&(this.childIndex_[a.id()]=a),(n=n||a.name&&ut(a.name()))&&(this.childNameIndex_[n]=a,this.childNameIndex_[ot(n)]=a),\"function\"==typeof a.el&&a.el()&&(n=null,this.children_[i+1]&&(this.children_[i+1].el_?n=this.children_[i+1].el_:K(this.children_[i+1])&&(n=this.children_[i+1])),this.contentEl().insertBefore(a.el(),n)),a},e.removeChild=function(e){if((e=\"string\"==typeof e?this.getChild(e):e)&&this.children_){for(var t,i=!1,n=this.children_.length-1;0<=n;n--)if(this.children_[n]===e){i=!0,this.children_.splice(n,1);break}i&&(e.parentComponent_=null,this.childIndex_[e.id()]=null,this.childNameIndex_[ut(e.name())]=null,this.childNameIndex_[ot(e.name())]=null,(t=e.el())&&t.parentNode===this.contentEl()&&this.contentEl().removeChild(e.el()))}},e.initChildren=function(){var i,t,e,n=this,r=this.options_.children;r&&(i=this.options_,t=s.getComponent(\"Tech\"),(e=Array.isArray(r)?r:Object.keys(r)).concat(Object.keys(this.options_).filter(function(t){return!e.some(function(e){return\"string\"==typeof e?t===e:t===e.name})})).map(function(e){var t,e=\"string\"==typeof e?r[t=e]||n.options_[t]||{}:(t=e.name,e);return{name:t,opts:e}}).filter(function(e){e=s.getComponent(e.opts.componentClass||ut(e.name));return e&&!t.isTech(e)}).forEach(function(e){var t=e.name,e=e.opts;!1!==(e=void 0!==i[t]?i[t]:e)&&((e=!0===e?{}:e).playerOptions=n.options_.playerOptions,(e=n.addChild(t,e))&&(n[t]=e))}))},e.buildCSSClass=function(){return\"\"},e.ready=function(e,t){if(void 0===t&&(t=!1),e)return this.isReady_?void(t?e.call(this):this.setTimeout(e,1)):(this.readyQueue_=this.readyQueue_||[],void this.readyQueue_.push(e))},e.triggerReady=function(){this.isReady_=!0,this.setTimeout(function(){var e=this.readyQueue_;this.readyQueue_=[],e&&0<e.length&&e.forEach(function(e){e.call(this)},this),this.trigger(\"ready\")},1)},e.$=function(e,t){return Te(e,t||this.contentEl())},e.$$=function(e,t){return Se(e,t||this.contentEl())},e.hasClass=function(e){return ee(this.el_,e)},e.addClass=function(e){te(this.el_,e)},e.removeClass=function(e){ie(this.el_,e)},e.toggleClass=function(e,t){ne(this.el_,e,t)},e.show=function(){this.removeClass(\"vjs-hidden\")},e.hide=function(){this.addClass(\"vjs-hidden\")},e.lockShowing=function(){this.addClass(\"vjs-lock-showing\")},e.unlockShowing=function(){this.removeClass(\"vjs-lock-showing\")},e.getAttribute=function(e){return se(this.el_,e)},e.setAttribute=function(e,t){oe(this.el_,e,t)},e.removeAttribute=function(e){ue(this.el_,e)},e.width=function(e,t){return this.dimension(\"width\",e,t)},e.height=function(e,t){return this.dimension(\"height\",e,t)},e.dimensions=function(e,t){this.width(e,!0),this.height(t)},e.dimension=function(e,t,i){if(void 0!==t)return-1!==(\"\"+(t=null===t||t!=t?0:t)).indexOf(\"%\")||-1!==(\"\"+t).indexOf(\"px\")?this.el_.style[e]=t:this.el_.style[e]=\"auto\"===t?\"\":t+\"px\",void(i||this.trigger(\"componentresize\"));if(!this.el_)return 0;t=this.el_.style[e],i=t.indexOf(\"px\");return-1!==i?parseInt(t.slice(0,i),10):parseInt(this.el_[\"offset\"+ut(e)],10)},e.currentDimension=function(e){var t=0;if(\"width\"!==e&&\"height\"!==e)throw new Error(\"currentDimension only accepts width or height value\");return t=w(this.el_,e),0!==(t=parseFloat(t))&&!isNaN(t)||(e=\"offset\"+ut(e),t=this.el_[e]),t},e.currentDimensions=function(){return{width:this.currentDimension(\"width\"),height:this.currentDimension(\"height\")}},e.currentWidth=function(){return this.currentDimension(\"width\")},e.currentHeight=function(){return this.currentDimension(\"height\")},e.focus=function(){this.el_.focus()},e.blur=function(){this.el_.blur()},e.handleKeyDown=function(e){this.player_&&(ht.isEventKey(e,\"Tab\")||e.stopPropagation(),this.player_.handleKeyDown(e))},e.handleKeyPress=function(e){this.handleKeyDown(e)},e.emitTapEvents=function(){var i,t=0,n=null;this.on(\"touchstart\",function(e){1===e.touches.length&&(n={pageX:e.touches[0].pageX,pageY:e.touches[0].pageY},t=window.performance.now(),i=!0)}),this.on(\"touchmove\",function(e){var t;1<e.touches.length?i=!1:n&&(t=e.touches[0].pageX-n.pageX,e=e.touches[0].pageY-n.pageY,10<Math.sqrt(t*t+e*e)&&(i=!1))});function e(){i=!1}this.on(\"touchleave\",e),this.on(\"touchcancel\",e),this.on(\"touchend\",function(e){!(n=null)===i&&window.performance.now()-t<200&&(e.preventDefault(),this.trigger(\"tap\"))})},e.enableTouchActivity=function(){var t,i,e;this.player()&&this.player().reportUserActivity&&(t=Ve(this.player(),this.player().reportUserActivity),this.on(\"touchstart\",function(){t(),this.clearInterval(i),i=this.setInterval(t,250)}),e=function(e){t(),this.clearInterval(i)},this.on(\"touchmove\",t),this.on(\"touchend\",e),this.on(\"touchcancel\",e))},e.setTimeout=function(e,t){var i,n=this;return e=Ve(this,e),this.clearTimersOnDispose_(),i=window.setTimeout(function(){n.setTimeoutIds_.has(i)&&n.setTimeoutIds_.delete(i),e()},t),this.setTimeoutIds_.add(i),i},e.clearTimeout=function(e){return this.setTimeoutIds_.has(e)&&(this.setTimeoutIds_.delete(e),window.clearTimeout(e)),e},e.setInterval=function(e,t){e=Ve(this,e),this.clearTimersOnDispose_();t=window.setInterval(e,t);return this.setIntervalIds_.add(t),t},e.clearInterval=function(e){return this.setIntervalIds_.has(e)&&(this.setIntervalIds_.delete(e),window.clearInterval(e)),e},e.requestAnimationFrame=function(e){var t,i=this;return this.supportsRaf_?(this.clearTimersOnDispose_(),e=Ve(this,e),t=window.requestAnimationFrame(function(){i.rafIds_.has(t)&&i.rafIds_.delete(t),e()}),this.rafIds_.add(t),t):this.setTimeout(e,1e3/60)},e.requestNamedAnimationFrame=function(e,t){var i=this;if(!this.namedRafs_.has(e)){this.clearTimersOnDispose_(),t=Ve(this,t);var n=this.requestAnimationFrame(function(){t(),i.namedRafs_.has(e)&&i.namedRafs_.delete(e)});return this.namedRafs_.set(e,n),e}},e.cancelNamedAnimationFrame=function(e){this.namedRafs_.has(e)&&(this.cancelAnimationFrame(this.namedRafs_.get(e)),this.namedRafs_.delete(e))},e.cancelAnimationFrame=function(e){return this.supportsRaf_?(this.rafIds_.has(e)&&(this.rafIds_.delete(e),window.cancelAnimationFrame(e)),e):this.clearTimeout(e)},e.clearTimersOnDispose_=function(){var n=this;this.clearingTimersOnDispose_||(this.clearingTimersOnDispose_=!0,this.one(\"dispose\",function(){[[\"namedRafs_\",\"cancelNamedAnimationFrame\"],[\"rafIds_\",\"cancelAnimationFrame\"],[\"setTimeoutIds_\",\"clearTimeout\"],[\"setIntervalIds_\",\"clearInterval\"]].forEach(function(e){var t=e[0],i=e[1];n[t].forEach(function(e,t){return n[i](t)})}),n.clearingTimersOnDispose_=!1}))},s.registerComponent=function(e,t){if(\"string\"!=typeof e||!e)throw new Error('Illegal component name, \"'+e+'\"; must be a non-empty string.');var i=s.getComponent(\"Tech\"),n=i&&i.isTech(t),i=s===t||s.prototype.isPrototypeOf(t.prototype);if(n||!i){var r=n?\"techs must be registered using Tech.registerTech()\":\"must be a Component subclass\";throw new Error('Illegal component, \"'+e+'\"; '+r+\".\")}e=ut(e),s.components_||(s.components_={});r=s.getComponent(\"Player\");if(\"Player\"===e&&r&&r.players){var a=r.players,r=Object.keys(a);if(a&&0<r.length&&r.map(function(e){return a[e]}).every(Boolean))throw new Error(\"Can not register Player component after player has been created.\")}return s.components_[e]=t,s.components_[ot(e)]=t},s.getComponent=function(e){if(e&&s.components_)return s.components_[e]},s}();pt.prototype.supportsRaf_=\"function\"==typeof window.requestAnimationFrame&&\"function\"==typeof window.cancelAnimationFrame,pt.registerComponent(\"Component\",pt);var ft=function(e){if(void 0===e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return e};var mt=function(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t};function gt(e,t,i,n){return function(e,t,i){if(\"number\"!=typeof t||t<0||i<t)throw new Error(\"Failed to execute '\"+e+\"' on 'TimeRanges': The index provided (\"+t+\") is non-numeric or out of bounds (0-\"+i+\").\")}(e,n,i.length-1),i[n][t]}function yt(e){var t=void 0===e||0===e.length?{length:0,start:function(){throw new Error(\"This TimeRanges object is empty\")},end:function(){throw new Error(\"This TimeRanges object is empty\")}}:{length:e.length,start:gt.bind(null,\"start\",0,e),end:gt.bind(null,\"end\",1,e)};return window.Symbol&&window.Symbol.iterator&&(t[window.Symbol.iterator]=function(){return(e||[]).values()}),t}function vt(e,t){return Array.isArray(e)?yt(e):void 0===e||void 0===t?yt():yt([[e,t]])}function _t(e,t){var i,n,r=0;if(!t)return 0;e&&e.length||(e=vt(0,0));for(var a=0;a<e.length;a++)i=e.start(a),r+=(n=t<(n=e.end(a))?t:n)-i;return r/t}function bt(e){if(e instanceof bt)return e;\"number\"==typeof e?this.code=e:\"string\"==typeof e?this.message=e:T(e)&&(\"number\"==typeof e.code&&(this.code=e.code),b(this,e)),this.message||(this.message=bt.defaultMessages[this.code]||\"\")}bt.prototype.code=0,bt.prototype.message=\"\",bt.prototype.status=null,bt.errorTypes=[\"MEDIA_ERR_CUSTOM\",\"MEDIA_ERR_ABORTED\",\"MEDIA_ERR_NETWORK\",\"MEDIA_ERR_DECODE\",\"MEDIA_ERR_SRC_NOT_SUPPORTED\",\"MEDIA_ERR_ENCRYPTED\"],bt.defaultMessages={1:\"You aborted the media playback\",2:\"A network error caused the media download to fail part-way.\",3:\"The media playback was aborted due to a corruption problem or because the media used features your browser did not support.\",4:\"The media could not be loaded, either because the server or network failed or because the format is not supported.\",5:\"The media is encrypted and we do not have the keys to decrypt it.\"};for(var Tt=0;Tt<bt.errorTypes.length;Tt++)bt[bt.errorTypes[Tt]]=Tt,bt.prototype[bt.errorTypes[Tt]]=Tt;var St=function(e,t){var i,n=null;try{i=JSON.parse(e,t)}catch(e){n=e}return[n,i]};function wt(e){return null!=e&&\"function\"==typeof e.then}function Et(e){wt(e)&&e.then(null,function(e){})}function kt(n){return[\"kind\",\"label\",\"language\",\"id\",\"inBandMetadataTrackDispatchType\",\"mode\",\"src\"].reduce(function(e,t,i){return n[t]&&(e[t]=n[t]),e},{cues:n.cues&&Array.prototype.map.call(n.cues,function(e){return{startTime:e.startTime,endTime:e.endTime,text:e.text,id:e.id}})})}var Ct=function(e){var t=e.$$(\"track\"),i=Array.prototype.map.call(t,function(e){return e.track});return Array.prototype.map.call(t,function(e){var t=kt(e.track);return e.src&&(t.src=e.src),t}).concat(Array.prototype.filter.call(e.textTracks(),function(e){return-1===i.indexOf(e)}).map(kt))},It=function(e,i){return e.forEach(function(e){var t=i.addRemoteTextTrack(e).track;!e.src&&e.cues&&e.cues.forEach(function(e){return t.addCue(e)})}),i.textTracks()},xt=\"vjs-modal-dialog\",At=function(n){function e(e,t){var i=n.call(this,e,t)||this;return i.handleKeyDown_=function(e){return i.handleKeyDown(e)},i.close_=function(e){return i.close(e)},i.opened_=i.hasBeenOpened_=i.hasBeenFilled_=!1,i.closeable(!i.options_.uncloseable),i.content(i.options_.content),i.contentEl_=$(\"div\",{className:xt+\"-content\"},{role:\"document\"}),i.descEl_=$(\"p\",{className:xt+\"-description vjs-control-text\",id:i.el().getAttribute(\"aria-describedby\")}),J(i.descEl_,i.description()),i.el_.appendChild(i.descEl_),i.el_.appendChild(i.contentEl_),i}mt(e,n);var t=e.prototype;return t.createEl=function(){return n.prototype.createEl.call(this,\"div\",{className:this.buildCSSClass(),tabIndex:-1},{\"aria-describedby\":this.id()+\"_description\",\"aria-hidden\":\"true\",\"aria-label\":this.label(),role:\"dialog\"})},t.dispose=function(){this.contentEl_=null,this.descEl_=null,this.previouslyActiveEl_=null,n.prototype.dispose.call(this)},t.buildCSSClass=function(){return xt+\" vjs-hidden \"+n.prototype.buildCSSClass.call(this)},t.label=function(){return this.localize(this.options_.label||\"Modal Window\")},t.description=function(){var e=this.options_.description||this.localize(\"This is a modal window.\");return this.closeable()&&(e+=\" \"+this.localize(\"This modal can be closed by pressing the Escape key or activating the close button.\")),e},t.open=function(){var e;this.opened_||(e=this.player(),this.trigger(\"beforemodalopen\"),this.opened_=!0,!this.options_.fillAlways&&(this.hasBeenOpened_||this.hasBeenFilled_)||this.fill(),this.wasPlaying_=!e.paused(),this.options_.pauseOnOpen&&this.wasPlaying_&&e.pause(),this.on(\"keydown\",this.handleKeyDown_),this.hadControls_=e.controls(),e.controls(!1),this.show(),this.conditionalFocus_(),this.el().setAttribute(\"aria-hidden\",\"false\"),this.trigger(\"modalopen\"),this.hasBeenOpened_=!0)},t.opened=function(e){return\"boolean\"==typeof e&&this[e?\"open\":\"close\"](),this.opened_},t.close=function(){var e;this.opened_&&(e=this.player(),this.trigger(\"beforemodalclose\"),this.opened_=!1,this.wasPlaying_&&this.options_.pauseOnOpen&&e.play(),this.off(\"keydown\",this.handleKeyDown_),this.hadControls_&&e.controls(!0),this.hide(),this.el().setAttribute(\"aria-hidden\",\"true\"),this.trigger(\"modalclose\"),this.conditionalBlur_(),this.options_.temporary&&this.dispose())},t.closeable=function(e){var t,i;return\"boolean\"==typeof e&&(t=this.closeable_=!!e,i=this.getChild(\"closeButton\"),t&&!i&&(e=this.contentEl_,this.contentEl_=this.el_,i=this.addChild(\"closeButton\",{controlText:\"Close Modal Dialog\"}),this.contentEl_=e,this.on(i,\"close\",this.close_)),!t&&i&&(this.off(i,\"close\",this.close_),this.removeChild(i),i.dispose())),this.closeable_},t.fill=function(){this.fillWith(this.content())},t.fillWith=function(e){var t=this.contentEl(),i=t.parentNode,n=t.nextSibling;this.trigger(\"beforemodalfill\"),this.hasBeenFilled_=!0,i.removeChild(t),this.empty(),ve(t,e),this.trigger(\"modalfill\"),n?i.insertBefore(t,n):i.appendChild(t);t=this.getChild(\"closeButton\");t&&i.appendChild(t.el_)},t.empty=function(){this.trigger(\"beforemodalempty\"),me(this.contentEl()),this.trigger(\"modalempty\")},t.content=function(e){return\"undefined\"!=typeof e&&(this.content_=e),this.content_},t.conditionalFocus_=function(){var e=document.activeElement,t=this.player_.el_;this.previouslyActiveEl_=null,!t.contains(e)&&t!==e||(this.previouslyActiveEl_=e,this.focus())},t.conditionalBlur_=function(){this.previouslyActiveEl_&&(this.previouslyActiveEl_.focus(),this.previouslyActiveEl_=null)},t.handleKeyDown=function(e){if(e.stopPropagation(),ht.isEventKey(e,\"Escape\")&&this.closeable())return e.preventDefault(),void this.close();if(ht.isEventKey(e,\"Tab\")){for(var t,i=this.focusableEls_(),n=this.el_.querySelector(\":focus\"),r=0;r<i.length;r++)if(n===i[r]){t=r;break}document.activeElement===this.el_&&(t=0),e.shiftKey&&0===t?(i[i.length-1].focus(),e.preventDefault()):e.shiftKey||t!==i.length-1||(i[0].focus(),e.preventDefault())}},t.focusableEls_=function(){var e=this.el_.querySelectorAll(\"*\");return Array.prototype.filter.call(e,function(e){return(e instanceof window.HTMLAnchorElement||e instanceof window.HTMLAreaElement)&&e.hasAttribute(\"href\")||(e instanceof window.HTMLInputElement||e instanceof window.HTMLSelectElement||e instanceof window.HTMLTextAreaElement||e instanceof window.HTMLButtonElement)&&!e.hasAttribute(\"disabled\")||e instanceof window.HTMLIFrameElement||e instanceof window.HTMLObjectElement||e instanceof window.HTMLEmbedElement||e.hasAttribute(\"tabindex\")&&-1!==e.getAttribute(\"tabindex\")||e.hasAttribute(\"contenteditable\")})},e}(pt);At.prototype.options_={pauseOnOpen:!0,temporary:!0},pt.registerComponent(\"ModalDialog\",At);var Pt,Lt=function(n){function e(e){var t;void 0===e&&(e=[]),(t=n.call(this)||this).tracks_=[],Object.defineProperty(ft(t),\"length\",{get:function(){return this.tracks_.length}});for(var i=0;i<e.length;i++)t.addTrack(e[i]);return t}mt(e,n);var t=e.prototype;return t.addTrack=function(e){var t=this,i=this.tracks_.length;\"\"+i in this||Object.defineProperty(this,i,{get:function(){return this.tracks_[i]}}),-1===this.tracks_.indexOf(e)&&(this.tracks_.push(e),this.trigger({track:e,type:\"addtrack\",target:this})),e.labelchange_=function(){t.trigger({track:e,type:\"labelchange\",target:t})},it(e)&&e.addEventListener(\"labelchange\",e.labelchange_)},t.removeTrack=function(e){for(var t,i=0,n=this.length;i<n;i++)if(this[i]===e){(t=this[i]).off&&t.off(),this.tracks_.splice(i,1);break}t&&this.trigger({track:t,type:\"removetrack\",target:this})},t.getTrackById=function(e){for(var t=null,i=0,n=this.length;i<n;i++){var r=this[i];if(r.id===e){t=r;break}}return t},e}(ze);for(Pt in Lt.prototype.allowedEvents_={change:\"change\",addtrack:\"addtrack\",removetrack:\"removetrack\",labelchange:\"labelchange\"},Lt.prototype.allowedEvents_)Lt.prototype[\"on\"+Pt]=null;function Dt(e,t){for(var i=0;i<e.length;i++)Object.keys(e[i]).length&&t.id!==e[i].id&&(e[i].enabled=!1)}function Ot(e,t){for(var i=0;i<e.length;i++)Object.keys(e[i]).length&&t.id!==e[i].id&&(e[i].selected=!1)}function Mt(e){var t=[\"protocol\",\"hostname\",\"port\",\"pathname\",\"search\",\"hash\",\"host\"],i=document.createElement(\"a\");i.href=e;for(var n={},r=0;r<t.length;r++)n[t[r]]=i[t[r]];return\"http:\"===n.protocol&&(n.host=n.host.replace(/:80$/,\"\")),\"https:\"===n.protocol&&(n.host=n.host.replace(/:443$/,\"\")),n.protocol||(n.protocol=window.location.protocol),n.host||(n.host=window.location.host),n}function Rt(e){var t;return e.match(/^https?:\\/\\//)||((t=document.createElement(\"a\")).href=e,e=t.href),e}function Nt(e){if(\"string\"==typeof e){e=/^(\\/?)([\\s\\S]*?)((?:\\.{1,2}|[^\\/]+?)(\\.([^\\.\\/\\?]+)))(?:[\\/]*|[\\?].*)$/.exec(e);if(e)return e.pop().toLowerCase()}return\"\"}function Ut(e,t){return void 0===t&&(t=window.location),(\":\"===(e=Mt(e)).protocol?t:e).protocol+e.host!==t.protocol+t.host}var Bt=function(n){function e(e){for(var t,i=(e=void 0===e?[]:e).length-1;0<=i;i--)if(e[i].enabled){Dt(e,e[i]);break}return(t=n.call(this,e)||this).changing_=!1,t}mt(e,n);var t=e.prototype;return t.addTrack=function(e){var t=this;e.enabled&&Dt(this,e),n.prototype.addTrack.call(this,e),e.addEventListener&&(e.enabledChange_=function(){t.changing_||(t.changing_=!0,Dt(t,e),t.changing_=!1,t.trigger(\"change\"))},e.addEventListener(\"enabledchange\",e.enabledChange_))},t.removeTrack=function(e){n.prototype.removeTrack.call(this,e),e.removeEventListener&&e.enabledChange_&&(e.removeEventListener(\"enabledchange\",e.enabledChange_),e.enabledChange_=null)},e}(Lt),Ft=function(n){function e(e){for(var t,i=(e=void 0===e?[]:e).length-1;0<=i;i--)if(e[i].selected){Ot(e,e[i]);break}return(t=n.call(this,e)||this).changing_=!1,Object.defineProperty(ft(t),\"selectedIndex\",{get:function(){for(var e=0;e<this.length;e++)if(this[e].selected)return e;return-1},set:function(){}}),t}mt(e,n);var t=e.prototype;return t.addTrack=function(e){var t=this;e.selected&&Ot(this,e),n.prototype.addTrack.call(this,e),e.addEventListener&&(e.selectedChange_=function(){t.changing_||(t.changing_=!0,Ot(t,e),t.changing_=!1,t.trigger(\"change\"))},e.addEventListener(\"selectedchange\",e.selectedChange_))},t.removeTrack=function(e){n.prototype.removeTrack.call(this,e),e.removeEventListener&&e.selectedChange_&&(e.removeEventListener(\"selectedchange\",e.selectedChange_),e.selectedChange_=null)},e}(Lt),k=function(i){function e(){return i.apply(this,arguments)||this}mt(e,i);var t=e.prototype;return t.addTrack=function(e){var t=this;i.prototype.addTrack.call(this,e),this.queueChange_||(this.queueChange_=function(){return t.queueTrigger(\"change\")}),this.triggerSelectedlanguagechange||(this.triggerSelectedlanguagechange_=function(){return t.trigger(\"selectedlanguagechange\")}),e.addEventListener(\"modechange\",this.queueChange_);-1===[\"metadata\",\"chapters\"].indexOf(e.kind)&&e.addEventListener(\"modechange\",this.triggerSelectedlanguagechange_)},t.removeTrack=function(e){i.prototype.removeTrack.call(this,e),e.removeEventListener&&(this.queueChange_&&e.removeEventListener(\"modechange\",this.queueChange_),this.selectedlanguagechange_&&e.removeEventListener(\"modechange\",this.triggerSelectedlanguagechange_))},e}(Lt),jt=function(){function e(e){void 0===e&&(e=[]),this.trackElements_=[],Object.defineProperty(this,\"length\",{get:function(){return this.trackElements_.length}});for(var t=0,i=e.length;t<i;t++)this.addTrackElement_(e[t])}var t=e.prototype;return t.addTrackElement_=function(e){var t=this.trackElements_.length;\"\"+t in this||Object.defineProperty(this,t,{get:function(){return this.trackElements_[t]}}),-1===this.trackElements_.indexOf(e)&&this.trackElements_.push(e)},t.getTrackElementByTrack_=function(e){for(var t,i=0,n=this.trackElements_.length;i<n;i++)if(e===this.trackElements_[i].track){t=this.trackElements_[i];break}return t},t.removeTrackElement_=function(e){for(var t=0,i=this.trackElements_.length;t<i;t++)if(e===this.trackElements_[t]){this.trackElements_[t].track&&\"function\"==typeof this.trackElements_[t].track.off&&this.trackElements_[t].track.off(),\"function\"==typeof this.trackElements_[t].off&&this.trackElements_[t].off(),this.trackElements_.splice(t,1);break}},e}(),Ht=function(){function t(e){t.prototype.setCues_.call(this,e),Object.defineProperty(this,\"length\",{get:function(){return this.length_}})}var e=t.prototype;return e.setCues_=function(e){var t=this.length||0,i=0,n=e.length;this.cues_=e,this.length_=e.length;function r(e){\"\"+e in this||Object.defineProperty(this,\"\"+e,{get:function(){return this.cues_[e]}})}if(t<n)for(i=t;i<n;i++)r.call(this,i)},e.getCueById=function(e){for(var t=null,i=0,n=this.length;i<n;i++){var r=this[i];if(r.id===e){t=r;break}}return t},t}(),qt={alternative:\"alternative\",captions:\"captions\",main:\"main\",sign:\"sign\",subtitles:\"subtitles\",commentary:\"commentary\"},Vt={alternative:\"alternative\",descriptions:\"descriptions\",main:\"main\",\"main-desc\":\"main-desc\",translation:\"translation\",commentary:\"commentary\"},Wt={subtitles:\"subtitles\",captions:\"captions\",descriptions:\"descriptions\",chapters:\"chapters\",metadata:\"metadata\"},Gt={disabled:\"disabled\",hidden:\"hidden\",showing:\"showing\"},C=function(a){function e(e){void 0===e&&(e={});var t,i=a.call(this)||this,n={id:e.id||\"vjs_track_\"+Pe++,kind:e.kind||\"\",language:e.language||\"\"},r=e.label||\"\";for(t in n)!function(e){Object.defineProperty(ft(i),e,{get:function(){return n[e]},set:function(){}})}(t);return Object.defineProperty(ft(i),\"label\",{get:function(){return r},set:function(e){e!==r&&(r=e,this.trigger(\"labelchange\"))}}),i}return mt(e,a),e}(ze),zt=Object.freeze({__proto__:null,parseUrl:Mt,getAbsoluteURL:Rt,getFileExtension:Nt,isCrossOrigin:Ut}),Xt=\"undefined\"!=typeof window?window:\"undefined\"!=typeof f?f:\"undefined\"!=typeof self?self:{},Kt=Xt,Yt=function(e){if(!e)return!1;var t=Qt.call(e);return\"[object Function]\"===t||\"function\"==typeof e&&\"[object RegExp]\"!==t||\"undefined\"!=typeof window&&(e===window.setTimeout||e===window.alert||e===window.confirm||e===window.prompt)},Qt=Object.prototype.toString;ei.httpHandler=function(n,r){return void 0===r&&(r=!1),function(e,t,i){if(e)n(e);else if(400<=t.statusCode&&t.statusCode<=599){e=i;if(r)if(Kt.TextDecoder){t=function(e){void 0===e&&(e=\"\");return e.toLowerCase().split(\";\").reduce(function(e,t){var i=t.split(\"=\"),t=i[0],i=i[1];return\"charset\"===t.trim()?i.trim():e},\"utf-8\")}(t.headers&&t.headers[\"content-type\"]);try{e=new TextDecoder(t).decode(i)}catch(e){}}else e=String.fromCharCode.apply(null,new Uint8Array(i));n({cause:e})}else n(null,i)}};",
          "20: var $t=function(e){var n={};return e&&e.trim().split(\"\\n\").forEach(function(e){var t=e.indexOf(\":\"),i=e.slice(0,t).trim().toLowerCase(),t=e.slice(t+1).trim();\"undefined\"==typeof n[i]?n[i]=t:Array.isArray(n[i])?n[i].push(t):n[i]=[n[i],t]}),n},Jt=ei,I=ei;function Zt(e,t,i){var n=e;return Yt(t)?(i=t,\"string\"==typeof e&&(n={uri:e})):n=g({},t,{uri:e}),n.callback=i,n}function ei(e,t,i){return ti(t=Zt(e,t,i))}function ti(n){if(\"undefined\"==typeof n.callback)throw new Error(\"callback argument missing\");var r=!1,a=function(e,t,i){r||(r=!0,n.callback(e,t,i))};function s(){var e=void 0,e=l.response||l.responseText||function(e){try{if(\"document\"===e.responseType)return e.responseXML;var t=e.responseXML&&\"parsererror\"===e.responseXML.documentElement.nodeName;if(\"\"===e.responseType&&!t)return e.responseXML}catch(e){}return null}(l);if(m)try{e=JSON.parse(e)}catch(e){}return e}function t(e){return clearTimeout(u),(e=!(e instanceof Error)?new Error(\"\"+(e||\"Unknown XMLHttpRequest Error\")):e).statusCode=0,a(e,g)}function e(){if(!o){clearTimeout(u);var e=n.useXDR&&void 0===l.status?200:1223===l.status?204:l.status,t=g,i=null;return 0!==e?(t={body:s(),statusCode:e,method:d,headers:{},url:c,rawRequest:l},l.getAllResponseHeaders&&(t.headers=$t(l.getAllResponseHeaders()))):i=new Error(\"Internal XMLHttpRequest Error\"),a(i,t,t.body)}}var i,o,u,l=n.xhr||null,c=(l=l||new(n.cors||n.useXDR?ei.XDomainRequest:ei.XMLHttpRequest)).url=n.uri||n.url,d=l.method=n.method||\"GET\",h=n.body||n.data,p=l.headers=n.headers||{},f=!!n.sync,m=!1,g={body:void 0,headers:{},statusCode:0,method:d,url:c,rawRequest:l};if(\"json\"in n&&!1!==n.json&&(m=!0,p.accept||p.Accept||(p.Accept=\"application/json\"),\"GET\"!==d&&\"HEAD\"!==d&&(p[\"content-type\"]||p[\"Content-Type\"]||(p[\"Content-Type\"]=\"application/json\"),h=JSON.stringify(!0===n.json?h:n.json))),l.onreadystatechange=function(){4===l.readyState&&setTimeout(e,0)},l.onload=e,l.onerror=t,l.onprogress=function(){},l.onabort=function(){o=!0},l.ontimeout=t,l.open(d,c,!f,n.username,n.password),f||(l.withCredentials=!!n.withCredentials),!f&&0<n.timeout&&(u=setTimeout(function(){var e;o||(o=!0,l.abort(\"timeout\"),(e=new Error(\"XMLHttpRequest timeout\")).code=\"ETIMEDOUT\",t(e))},n.timeout)),l.setRequestHeader)for(i in p)p.hasOwnProperty(i)&&l.setRequestHeader(i,p[i]);else if(n.headers&&!function(e){for(var t in e)if(e.hasOwnProperty(t))return;return 1}(n.headers))throw new Error(\"Headers cannot be set on an XDomainRequest object\");return\"responseType\"in n&&(l.responseType=n.responseType),\"beforeSend\"in n&&\"function\"==typeof n.beforeSend&&n.beforeSend(l),l.send(h||null),l}ei.XMLHttpRequest=Kt.XMLHttpRequest||function(){},ei.XDomainRequest=\"withCredentials\"in new ei.XMLHttpRequest?ei.XMLHttpRequest:Kt.XDomainRequest,function(e,t){for(var i=0;i<e.length;i++)t(e[i])}([\"get\",\"put\",\"post\",\"patch\",\"head\",\"delete\"],function(n){ei[\"delete\"===n?\"del\":n]=function(e,t,i){return(t=Zt(e,t,i)).method=n.toUpperCase(),ti(t)}}),Jt.default=I;function ii(e,t){var i=new window.WebVTT.Parser(window,window.vttjs,window.WebVTT.StringDecoder()),n=[];i.oncue=function(e){t.addCue(e)},i.onparsingerror=function(e){n.push(e)},i.onflush=function(){t.trigger({type:\"loadeddata\",target:t})},i.parse(e),0<n.length&&(window.console&&window.console.groupCollapsed&&window.console.groupCollapsed(\"Text Track parsing errors for \"+t.src),n.forEach(function(e){return h.error(e)}),window.console&&window.console.groupEnd&&window.console.groupEnd()),i.flush()}function ni(e,n){var t={uri:e};(e=Ut(e))&&(t.cors=e),(e=\"use-credentials\"===n.tech_.crossOrigin())&&(t.withCredentials=e),Jt(t,Ve(this,function(e,t,i){return e?h.error(e,t):(n.loaded_=!0,void(\"function\"!=typeof window.WebVTT?n.tech_&&n.tech_.any([\"vttjsloaded\",\"vttjserror\"],function(e){return\"vttjserror\"!==e.type?ii(i,n):void h.error(\"vttjs failed to load, stopping trying to process \"+n.src)}):ii(i,n)))}))}var ri=function(a){function e(e){var t;if(!(e=void 0===e?{}:e).tech)throw new Error(\"A tech was not provided.\");var e=lt(e,{kind:Wt[e.kind]||\"subtitles\",language:e.language||e.srclang||\"\"}),i=Gt[e.mode]||\"disabled\",n=e.default;\"metadata\"!==e.kind&&\"chapters\"!==e.kind||(i=\"hidden\"),(t=a.call(this,e)||this).tech_=e.tech,t.cues_=[],t.activeCues_=[],t.preload_=!1!==t.tech_.preloadTextTracks;var r=new Ht(t.cues_),s=new Ht(t.activeCues_),o=!1;t.timeupdateHandler=Ve(ft(t),function(){this.tech_.isDisposed()||(this.tech_.isReady_&&(this.activeCues=this.activeCues,o&&(this.trigger(\"cuechange\"),o=!1)),this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler))});return t.tech_.one(\"dispose\",function(){t.stopTracking()}),\"disabled\"!==i&&t.startTracking(),Object.defineProperties(ft(t),{default:{get:function(){return n},set:function(){}},mode:{get:function(){return i},set:function(e){Gt[e]&&i!==e&&(i=e,this.preload_||\"disabled\"===i||0!==this.cues.length||ni(this.src,this),this.stopTracking(),\"disabled\"!==i&&this.startTracking(),this.trigger(\"modechange\"))}},cues:{get:function(){return this.loaded_?r:null},set:function(){}},activeCues:{get:function(){if(!this.loaded_)return null;if(0===this.cues.length)return s;for(var e=this.tech_.currentTime(),t=[],i=0,n=this.cues.length;i<n;i++){var r=this.cues[i];(r.startTime<=e&&r.endTime>=e||r.startTime===r.endTime&&r.startTime<=e&&r.startTime+.5>=e)&&t.push(r)}if(o=!1,t.length!==this.activeCues_.length)o=!0;else for(var a=0;a<t.length;a++)-1===this.activeCues_.indexOf(t[a])&&(o=!0);return this.activeCues_=t,s.setCues_(this.activeCues_),s},set:function(){}}}),e.src?(t.src=e.src,t.preload_||(t.loaded_=!0),(t.preload_||\"subtitles\"!==e.kind&&\"captions\"!==e.kind)&&ni(t.src,ft(t))):t.loaded_=!0,t}mt(e,a);var t=e.prototype;return t.startTracking=function(){this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler)},t.stopTracking=function(){this.rvf_&&(this.tech_.cancelVideoFrameCallback(this.rvf_),this.rvf_=void 0)},t.addCue=function(e){var t=e;if(window.vttjs&&!(e instanceof window.vttjs.VTTCue)){for(var i in t=new window.vttjs.VTTCue(e.startTime,e.endTime,e.text),e)i in t||(t[i]=e[i]);t.id=e.id,t.originalCue_=e}for(var n=this.tech_.textTracks(),r=0;r<n.length;r++)n[r]!==this&&n[r].removeCue(t);this.cues_.push(t),this.cues.setCues_(this.cues_)},t.removeCue=function(e){for(var t=this.cues_.length;t--;){var i=this.cues_[t];if(i===e||i.originalCue_&&i.originalCue_===e){this.cues_.splice(t,1),this.cues.setCues_(this.cues_);break}}},e}(C);ri.prototype.allowedEvents_={cuechange:\"cuechange\"};x=function(n){function e(e){var t=lt(e=void 0===e?{}:e,{kind:Vt[e.kind]||\"\"}),e=n.call(this,t)||this,i=!1;return Object.defineProperty(ft(e),\"enabled\",{get:function(){return i},set:function(e){\"boolean\"==typeof e&&e!==i&&(i=e,this.trigger(\"enabledchange\"))}}),t.enabled&&(e.enabled=t.enabled),e.loaded_=!0,e}return mt(e,n),e}(C),U=function(n){function e(e){var t=lt(e=void 0===e?{}:e,{kind:qt[e.kind]||\"\"}),e=n.call(this,t)||this,i=!1;return Object.defineProperty(ft(e),\"selected\",{get:function(){return i},set:function(e){\"boolean\"==typeof e&&e!==i&&(i=e,this.trigger(\"selectedchange\"))}}),t.selected&&(e.selected=t.selected),e}return mt(e,n),e}(C),j=function(r){function e(e){var t;void 0===e&&(e={});var i=r.call(this)||this,n=new ri(e);return i.kind=n.kind,i.src=n.src,i.srclang=n.language,i.label=n.label,i.default=n.default,Object.defineProperties(ft(i),{readyState:{get:function(){return t}},track:{get:function(){return n}}}),t=0,n.addEventListener(\"loadeddata\",function(){t=2,i.trigger({type:\"load\",target:ft(i)})}),i}return mt(e,r),e}(ze);j.prototype.allowedEvents_={load:\"load\"},j.NONE=0,j.LOADING=1,j.LOADED=2,j.ERROR=3;var ai={audio:{ListClass:Bt,TrackClass:x,capitalName:\"Audio\"},video:{ListClass:Ft,TrackClass:U,capitalName:\"Video\"},text:{ListClass:k,TrackClass:ri,capitalName:\"Text\"}};Object.keys(ai).forEach(function(e){ai[e].getterName=e+\"Tracks\",ai[e].privateName=e+\"Tracks_\"});var si={remoteText:{ListClass:k,TrackClass:ri,capitalName:\"RemoteText\",getterName:\"remoteTextTracks\",privateName:\"remoteTextTracks_\"},remoteTextEl:{ListClass:jt,TrackClass:j,capitalName:\"RemoteTextTrackEls\",getterName:\"remoteTextTrackEls\",privateName:\"remoteTextTrackEls_\"}},oi=g({},ai,si);si.names=Object.keys(si),ai.names=Object.keys(ai),oi.names=[].concat(si.names).concat(ai.names);var ui=\"undefined\"!=typeof f?f:\"undefined\"!=typeof window?window:{},li=\"undefined\"!=typeof document?document:(li=ui[\"__GLOBAL_DOCUMENT_CACHE@4\"])||(ui[\"__GLOBAL_DOCUMENT_CACHE@4\"]={}),Xt=li,ci=Object.create||function(e){if(1!==arguments.length)throw new Error(\"Object.create shim only accepts one parameter.\");return di.prototype=e,new di};function di(){}function hi(e,t){this.name=\"ParsingError\",this.code=e.code,this.message=t||e.message}function pi(e){function t(e,t,i,n){return 3600*(0|e)+60*(0|t)+(0|i)+(0|n)/1e3}e=e.match(/^(\\d+):(\\d{1,2})(:\\d{1,2})?\\.(\\d{3})/);return e?e[3]?t(e[1],e[2],e[3].replace(\":\",\"\"),e[4]):59<e[1]?t(e[1],e[2],0,e[4]):t(0,e[1],e[2],e[4]):null}function fi(){this.values=ci(null)}function mi(e,t,i,n){var r,a,s=n?e.split(n):[e];for(r in s)\"string\"==typeof s[r]&&(2===(a=s[r].split(i)).length&&t(a[0],a[1]))}function gi(t,e,s){var i=t;function n(){var e=pi(t);if(null===e)throw new hi(hi.Errors.BadTimeStamp,\"Malformed timestamp: \"+i);return t=t.replace(/^[^\\sa-zA-Z-]+/,\"\"),e}function r(){t=t.replace(/^\\s+/,\"\")}if(r(),e.startTime=n(),r(),\"--\\x3e\"!==t.substr(0,3))throw new hi(hi.Errors.BadTimeStamp,\"Malformed time stamp (time stamps must be separated by '--\\x3e'): \"+i);t=t.substr(3),r(),e.endTime=n(),r(),function(e,t){var a=new fi;mi(e,function(e,t){switch(e){case\"region\":for(var i=s.length-1;0<=i;i--)if(s[i].id===t){a.set(e,s[i].region);break}break;case\"vertical\":a.alt(e,t,[\"rl\",\"lr\"]);break;case\"line\":var n=t.split(\",\"),r=n[0];a.integer(e,r),a.percent(e,r)&&a.set(\"snapToLines\",!1),a.alt(e,r,[\"auto\"]),2===n.length&&a.alt(\"lineAlign\",n[1],[\"start\",\"center\",\"end\"]);break;case\"position\":n=t.split(\",\"),a.percent(e,n[0]),2===n.length&&a.alt(\"positionAlign\",n[1],[\"start\",\"center\",\"end\"]);break;case\"size\":a.percent(e,t);break;case\"align\":a.alt(e,t,[\"start\",\"center\",\"end\",\"left\",\"right\"])}},/:/,/\\s/),t.region=a.get(\"region\",null),t.vertical=a.get(\"vertical\",\"\");try{t.line=a.get(\"line\",\"auto\")}catch(e){}t.lineAlign=a.get(\"lineAlign\",\"start\"),t.snapToLines=a.get(\"snapToLines\",!0),t.size=a.get(\"size\",100);try{t.align=a.get(\"align\",\"center\")}catch(e){t.align=a.get(\"align\",\"middle\")}try{t.position=a.get(\"position\",\"auto\")}catch(e){t.position=a.get(\"position\",{start:0,left:0,center:50,middle:50,end:100,right:100},t.align)}t.positionAlign=a.get(\"positionAlign\",{start:\"start\",left:\"start\",center:\"center\",middle:\"center\",end:\"end\",right:\"end\"},t.align)}(t,e)}((hi.prototype=ci(Error.prototype)).constructor=hi).Errors={BadSignature:{code:0,message:\"Malformed WebVTT signature.\"},BadTimeStamp:{code:1,message:\"Malformed time stamp.\"}},fi.prototype={set:function(e,t){this.get(e)||\"\"===t||(this.values[e]=t)},get:function(e,t,i){return i?this.has(e)?this.values[e]:t[i]:this.has(e)?this.values[e]:t},has:function(e){return e in this.values},alt:function(e,t,i){for(var n=0;n<i.length;++n)if(t===i[n]){this.set(e,t);break}},integer:function(e,t){/^-?\\d+$/.test(t)&&this.set(e,parseInt(t,10))},percent:function(e,t){return!!(t.match(/^([\\d]{1,3})(\\.[\\d]*)?%$/)&&0<=(t=parseFloat(t))&&t<=100)&&(this.set(e,t),!0)}};var yi=Xt.createElement&&Xt.createElement(\"textarea\"),vi={c:\"span\",i:\"i\",b:\"b\",u:\"u\",ruby:\"ruby\",rt:\"rt\",v:\"span\",lang:\"span\"},_i={white:\"rgba(255,255,255,1)\",lime:\"rgba(0,255,0,1)\",cyan:\"rgba(0,255,255,1)\",red:\"rgba(255,0,0,1)\",yellow:\"rgba(255,255,0,1)\",magenta:\"rgba(255,0,255,1)\",blue:\"rgba(0,0,255,1)\",black:\"rgba(0,0,0,1)\"},bi={v:\"title\",lang:\"lang\"},Ti={rt:\"ruby\"};function Si(e,t){for(var i,n,r,a,s,o,u,l,c,d,h=e.document.createElement(\"div\"),p=h,f=[];null!==(i=function(){if(!t)return null;var e=t.match(/^([^<]*)(<[^>]*>?)?/);return e=e[1]||e[2],t=t.substr(e.length),e}());)\"<\"!==i[0]?p.appendChild(e.document.createTextNode((s=i,yi.innerHTML=s,s=yi.textContent,yi.textContent=\"\",s))):\"/\"!==i[1]?(a=pi(i.substr(1,i.length-2)))?(n=e.document.createProcessingInstruction(\"timestamp\",a),p.appendChild(n)):(r=i.match(/^<([^.\\s/0-9>]+)(\\.[^\\s\\\\>]+)?([^>\\\\]+)?(\\\\?)>?$/))&&(l=r[1],c=r[3],d=void 0,d=vi[l],(n=d?(d=e.document.createElement(d),(l=bi[l])&&c&&(d[l]=c.trim()),d):null)&&(o=p,Ti[(u=n).localName]&&Ti[u.localName]!==o.localName||(r[2]&&((a=r[2].split(\".\")).forEach(function(e){var t=/^bg_/.test(e),e=t?e.slice(3):e;_i.hasOwnProperty(e)&&(e=_i[e],n.style[t?\"background-color\":\"color\"]=e)}),n.className=a.join(\" \")),f.push(r[1]),p.appendChild(n),p=n))):f.length&&f[f.length-1]===i.substr(2).replace(\">\",\"\")&&(f.pop(),p=p.parentNode);return h}var wi=[[1470,1470],[1472,1472],[1475,1475],[1478,1478],[1488,1514],[1520,1524],[1544,1544],[1547,1547],[1549,1549],[1563,1563],[1566,1610],[1645,1647],[1649,1749],[1765,1766],[1774,1775],[1786,1805],[1807,1808],[1810,1839],[1869,1957],[1969,1969],[1984,2026],[2036,2037],[2042,2042],[2048,2069],[2074,2074],[2084,2084],[2088,2088],[2096,2110],[2112,2136],[2142,2142],[2208,2208],[2210,2220],[8207,8207],[64285,64285],[64287,64296],[64298,64310],[64312,64316],[64318,64318],[64320,64321],[64323,64324],[64326,64449],[64467,64829],[64848,64911],[64914,64967],[65008,65020],[65136,65140],[65142,65276],[67584,67589],[67592,67592],[67594,67637],[67639,67640],[67644,67644],[67647,67669],[67671,67679],[67840,67867],[67872,67897],[67903,67903],[67968,68023],[68030,68031],[68096,68096],[68112,68115],[68117,68119],[68121,68147],[68160,68167],[68176,68184],[68192,68223],[68352,68405],[68416,68437],[68440,68466],[68472,68479],[68608,68680],[126464,126467],[126469,126495],[126497,126498],[126500,126500],[126503,126503],[126505,126514],[126516,126519],[126521,126521],[126523,126523],[126530,126530],[126535,126535],[126537,126537],[126539,126539],[126541,126543],[126545,126546],[126548,126548],[126551,126551],[126553,126553],[126555,126555],[126557,126557],[126559,126559],[126561,126562],[126564,126564],[126567,126570],[126572,126578],[126580,126583],[126585,126588],[126590,126590],[126592,126601],[126603,126619],[126625,126627],[126629,126633],[126635,126651],[1114109,1114109]];function Ei(e){var t=[],i=\"\";if(!e||!e.childNodes)return\"ltr\";function a(e,t){for(var i=t.childNodes.length-1;0<=i;i--)e.push(t.childNodes[i])}for(a(t,e);i=function e(t){if(!t||!t.length)return null;var i=t.pop(),n=i.textContent||i.innerText;if(n){var r=n.match(/^.*(\\n|\\r)/);return r?r[t.length=0]:n}return\"ruby\"===i.tagName?e(t):i.childNodes?(a(t,i),e(t)):void 0}(t);)for(var n=0;n<i.length;n++)if(function(e){for(var t=0;t<wi.length;t++){var i=wi[t];if(e>=i[0]&&e<=i[1])return 1}}(i.charCodeAt(n)))return\"rtl\";return\"ltr\"}function ki(){}function Ci(e,t,i){ki.call(this),this.cue=t,this.cueDiv=Si(e,t.text);var n={color:\"rgba(255, 255, 255, 1)\",backgroundColor:\"rgba(0, 0, 0, 0.8)\",position:\"relative\",left:0,right:0,top:0,bottom:0,display:\"inline\",writingMode:\"\"===t.vertical?\"horizontal-tb\":\"lr\"===t.vertical?\"vertical-lr\":\"vertical-rl\",unicodeBidi:\"plaintext\"};this.applyStyles(n,this.cueDiv),this.div=e.document.createElement(\"div\"),n={direction:Ei(this.cueDiv),writingMode:\"\"===t.vertical?\"horizontal-tb\":\"lr\"===t.vertical?\"vertical-lr\":\"vertical-rl\",unicodeBidi:\"plaintext\",textAlign:\"middle\"===t.align?\"center\":t.align,font:i.font,whiteSpace:\"pre-line\",position:\"absolute\"},this.applyStyles(n),this.div.appendChild(this.cueDiv);var r=0;switch(t.positionAlign){case\"start\":r=t.position;break;case\"center\":r=t.position-t.size/2;break;case\"end\":r=t.position-t.size}\"\"===t.vertical?this.applyStyles({left:this.formatStyle(r,\"%\"),width:this.formatStyle(t.size,\"%\")}):this.applyStyles({top:this.formatStyle(r,\"%\"),height:this.formatStyle(t.size,\"%\")}),this.move=function(e){this.applyStyles({top:this.formatStyle(e.top,\"px\"),bottom:this.formatStyle(e.bottom,\"px\"),left:this.formatStyle(e.left,\"px\"),right:this.formatStyle(e.right,\"px\"),height:this.formatStyle(e.height,\"px\"),width:this.formatStyle(e.width,\"px\")})}}function Ii(e){var t,i,n,r;e.div&&(t=e.div.offsetHeight,i=e.div.offsetWidth,n=e.div.offsetTop,r=(r=e.div.childNodes)&&(r=r[0])&&r.getClientRects&&r.getClientRects(),e=e.div.getBoundingClientRect(),r=r?Math.max(r[0]&&r[0].height||0,e.height/r.length):0),this.left=e.left,this.right=e.right,this.top=e.top||n,this.height=e.height||t,this.bottom=e.bottom||n+(e.height||t),this.width=e.width||i,this.lineHeight=void 0!==r?r:e.lineHeight}function xi(e,t,o,u){var i,n=new Ii(t),r=t.cue,a=function(e){if(\"number\"==typeof e.line&&(e.snapToLines||0<=e.line&&e.line<=100))return e.line;if(!e.track||!e.track.textTrackList||!e.track.textTrackList.mediaElement)return-1;for(var t=e.track,i=t.textTrackList,n=0,r=0;r<i.length&&i[r]!==t;r++)\"showing\"===i[r].mode&&n++;return-1*++n}(r),s=[];if(r.snapToLines){switch(r.vertical){case\"\":s=[\"+y\",\"-y\"],i=\"height\";break;case\"rl\":s=[\"+x\",\"-x\"],i=\"width\";break;case\"lr\":s=[\"-x\",\"+x\"],i=\"width\"}var l=n.lineHeight,c=l*Math.round(a),d=o[i]+l,h=s[0];Math.abs(c)>d&&(c=c<0?-1:1,c*=Math.ceil(d/l)*l),a<0&&(c+=\"\"===r.vertical?o.height:o.width,s=s.reverse()),n.move(h,c)}else{var p=n.lineHeight/o.height*100;switch(r.lineAlign){case\"center\":a-=p/2;break;case\"end\":a-=p}switch(r.vertical){case\"\":t.applyStyles({top:t.formatStyle(a,\"%\")});break;case\"rl\":t.applyStyles({left:t.formatStyle(a,\"%\")});break;case\"lr\":t.applyStyles({right:t.formatStyle(a,\"%\")})}s=[\"+y\",\"-x\",\"+x\",\"-y\"],n=new Ii(t)}n=function(e,t){for(var i,n=new Ii(e),r=1,a=0;a<t.length;a++){for(;e.overlapsOppositeAxis(o,t[a])||e.within(o)&&e.overlapsAny(u);)e.move(t[a]);if(e.within(o))return e;var s=e.intersectPercentage(o);s<r&&(i=new Ii(e),r=s),e=new Ii(n)}return i||n}(n,s);t.move(n.toCSSCompatValues(o))}function Ai(){}ki.prototype.applyStyles=function(e,t){for(var i in t=t||this.div,e)e.hasOwnProperty(i)&&(t.style[i]=e[i])},ki.prototype.formatStyle=function(e,t){return 0===e?0:e+t},(Ci.prototype=ci(ki.prototype)).constructor=Ci,Ii.prototype.move=function(e,t){switch(t=void 0!==t?t:this.lineHeight,e){case\"+x\":this.left+=t,this.right+=t;break;case\"-x\":this.left-=t,this.right-=t;break;case\"+y\":this.top+=t,this.bottom+=t;break;case\"-y\":this.top-=t,this.bottom-=t}},Ii.prototype.overlaps=function(e){return this.left<e.right&&this.right>e.left&&this.top<e.bottom&&this.bottom>e.top},Ii.prototype.overlapsAny=function(e){for(var t=0;t<e.length;t++)if(this.overlaps(e[t]))return!0;return!1},Ii.prototype.within=function(e){return this.top>=e.top&&this.bottom<=e.bottom&&this.left>=e.left&&this.right<=e.right},Ii.prototype.overlapsOppositeAxis=function(e,t){switch(t){case\"+x\":return this.left<e.left;case\"-x\":return this.right>e.right;case\"+y\":return this.top<e.top;case\"-y\":return this.bottom>e.bottom}},Ii.prototype.intersectPercentage=function(e){return Math.max(0,Math.min(this.right,e.right)-Math.max(this.left,e.left))*Math.max(0,Math.min(this.bottom,e.bottom)-Math.max(this.top,e.top))/(this.height*this.width)},Ii.prototype.toCSSCompatValues=function(e){return{top:this.top-e.top,bottom:e.bottom-this.bottom,left:this.left-e.left,right:e.right-this.right,height:this.height,width:this.width}},Ii.getSimpleBoxPosition=function(e){var t=e.div?e.div.offsetHeight:e.tagName?e.offsetHeight:0,i=e.div?e.div.offsetWidth:e.tagName?e.offsetWidth:0,n=e.div?e.div.offsetTop:e.tagName?e.offsetTop:0;return{left:(e=e.div?e.div.getBoundingClientRect():e.tagName?e.getBoundingClientRect():e).left,right:e.right,top:e.top||n,height:e.height||t,bottom:e.bottom||n+(e.height||t),width:e.width||i}},Ai.StringDecoder=function(){return{decode:function(e){if(!e)return\"\";if(\"string\"!=typeof e)throw new Error(\"Error - expected string data.\");return decodeURIComponent(encodeURIComponent(e))}}},Ai.convertCueToDOMTree=function(e,t){return e&&t?Si(e,t):null};Ai.processCues=function(n,r,e){if(!n||!r||!e)return null;for(;e.firstChild;)e.removeChild(e.firstChild);var a=n.document.createElement(\"div\");if(a.style.position=\"absolute\",a.style.left=\"0\",a.style.right=\"0\",a.style.top=\"0\",a.style.bottom=\"0\",a.style.margin=\"1.5%\",e.appendChild(a),function(e){for(var t=0;t<e.length;t++)if(e[t].hasBeenReset||!e[t].displayState)return 1}(r)){var s=[],o=Ii.getSimpleBoxPosition(a),u={font:Math.round(.05*o.height*100)/100+\"px sans-serif\"};!function(){for(var e,t,i=0;i<r.length;i++)t=r[i],e=new Ci(n,t,u),a.appendChild(e.div),xi(0,e,o,s),t.displayState=e.div,s.push(Ii.getSimpleBoxPosition(e))}()}else for(var t=0;t<r.length;t++)a.appendChild(r[t].displayState)},(Ai.Parser=function(e,t,i){i||(i=t,t={}),t=t||{},this.window=e,this.vttjs=t,this.state=\"INITIAL\",this.buffer=\"\",this.decoder=i||new TextDecoder(\"utf8\"),this.regionList=[]}).prototype={reportOrThrowError:function(e){if(!(e instanceof hi))throw e;this.onparsingerror&&this.onparsingerror(e)},parse:function(e){var n=this;function t(){for(var e=n.buffer,t=0;t<e.length&&\"\\r\"!==e[t]&&\"\\n\"!==e[t];)++t;var i=e.substr(0,t);return\"\\r\"===e[t]&&++t,\"\\n\"===e[t]&&++t,n.buffer=e.substr(t),i}function i(e){e.match(/X-TIMESTAMP-MAP/)?mi(e,function(e,t){var i;\"X-TIMESTAMP-MAP\"===e&&(t=t,i=new fi,mi(t,function(e,t){switch(e){case\"MPEGT\":i.integer(e+\"S\",t);break;case\"LOCA\":i.set(e+\"L\",pi(t))}},/[^\\d]:/,/,/),n.ontimestampmap&&n.ontimestampmap({MPEGTS:i.get(\"MPEGTS\"),LOCAL:i.get(\"LOCAL\")}))},/=/):mi(e,function(e,t){var r;\"Region\"===e&&(t=t,r=new fi,mi(t,function(e,t){switch(e){case\"id\":r.set(e,t);break;case\"width\":r.percent(e,t);break;case\"lines\":r.integer(e,t);break;case\"regionanchor\":case\"viewportanchor\":var i=t.split(\",\");if(2!==i.length)break;var n=new fi;if(n.percent(\"x\",i[0]),n.percent(\"y\",i[1]),!n.has(\"x\")||!n.has(\"y\"))break;r.set(e+\"X\",n.get(\"x\")),r.set(e+\"Y\",n.get(\"y\"));break;case\"scroll\":r.alt(e,t,[\"up\"])}},/=/,/\\s/),r.has(\"id\")&&((t=new(n.vttjs.VTTRegion||n.window.VTTRegion)).width=r.get(\"width\",100),t.lines=r.get(\"lines\",3),t.regionAnchorX=r.get(\"regionanchorX\",0),t.regionAnchorY=r.get(\"regionanchorY\",100),t.viewportAnchorX=r.get(\"viewportanchorX\",0),t.viewportAnchorY=r.get(\"viewportanchorY\",100),t.scroll=r.get(\"scroll\",\"\"),n.onregion&&n.onregion(t),n.regionList.push({id:r.get(\"id\"),region:t})))},/:/)}e&&(n.buffer+=n.decoder.decode(e,{stream:!0}));try{if(\"INITIAL\"===n.state){if(!/\\r\\n|\\n/.test(n.buffer))return this;var r,a=(r=t()).match(/^WEBVTT([ \\t].*)?$/);if(!a||!a[0])throw new hi(hi.Errors.BadSignature);n.state=\"HEADER\"}for(var s=!1;n.buffer;){if(!/\\r\\n|\\n/.test(n.buffer))return this;switch(s?s=!1:r=t(),n.state){case\"HEADER\":/:/.test(r)?i(r):r||(n.state=\"ID\");continue;case\"NOTE\":r||(n.state=\"ID\");continue;case\"ID\":if(/^NOTE($|[ \\t])/.test(r)){n.state=\"NOTE\";break}if(!r)continue;n.cue=new(n.vttjs.VTTCue||n.window.VTTCue)(0,0,\"\");try{n.cue.align=\"center\"}catch(e){n.cue.align=\"middle\"}if(n.state=\"CUE\",-1===r.indexOf(\"--\\x3e\")){n.cue.id=r;continue}case\"CUE\":try{gi(r,n.cue,n.regionList)}catch(e){n.reportOrThrowError(e),n.cue=null,n.state=\"BADCUE\";continue}n.state=\"CUETEXT\";continue;case\"CUETEXT\":var o=-1!==r.indexOf(\"--\\x3e\");if(!r||o&&(s=!0)){n.oncue&&n.oncue(n.cue),n.cue=null,n.state=\"ID\";continue}n.cue.text&&(n.cue.text+=\"\\n\"),n.cue.text+=r.replace(/\\u2028/g,\"\\n\").replace(/u2029/g,\"\\n\");continue;case\"BADCUE\":r||(n.state=\"ID\");continue}}}catch(e){n.reportOrThrowError(e),\"CUETEXT\"===n.state&&n.cue&&n.oncue&&n.oncue(n.cue),n.cue=null,n.state=\"INITIAL\"===n.state?\"BADWEBVTT\":\"BADCUE\"}return this},flush:function(){var t=this;try{if(t.buffer+=t.decoder.decode(),!t.cue&&\"HEADER\"!==t.state||(t.buffer+=\"\\n\\n\",t.parse()),\"INITIAL\"===t.state)throw new hi(hi.Errors.BadSignature)}catch(e){t.reportOrThrowError(e)}return t.onflush&&t.onflush(),this}};var Pi=Ai,Li={\"\":1,lr:1,rl:1},Di={start:1,center:1,end:1,left:1,right:1,auto:1,\"line-left\":1,\"line-right\":1};function Oi(e){return\"string\"==typeof e&&(!!Di[e.toLowerCase()]&&e.toLowerCase())}function Mi(e,t,i){this.hasBeenReset=!1;var n=\"\",r=!1,a=e,s=t,o=i,u=null,l=\"\",c=!0,d=\"auto\",h=\"start\",p=\"auto\",f=\"auto\",m=100,g=\"center\";Object.defineProperties(this,{id:{enumerable:!0,get:function(){return n},set:function(e){n=\"\"+e}},pauseOnExit:{enumerable:!0,get:function(){return r},set:function(e){r=!!e}},startTime:{enumerable:!0,get:function(){return a},set:function(e){if(\"number\"!=typeof e)throw new TypeError(\"Start time must be set to a number.\");a=e,this.hasBeenReset=!0}},endTime:{enumerable:!0,get:function(){return s},set:function(e){if(\"number\"!=typeof e)throw new TypeError(\"End time must be set to a number.\");s=e,this.hasBeenReset=!0}},text:{enumerable:!0,get:function(){return o},set:function(e){o=\"\"+e,this.hasBeenReset=!0}},region:{enumerable:!0,get:function(){return u},set:function(e){u=e,this.hasBeenReset=!0}},vertical:{enumerable:!0,get:function(){return l},set:function(e){e=\"string\"==typeof(e=e)&&(!!Li[e.toLowerCase()]&&e.toLowerCase());if(!1===e)throw new SyntaxError(\"Vertical: an invalid or illegal direction string was specified.\");l=e,this.hasBeenReset=!0}},snapToLines:{enumerable:!0,get:function(){return c},set:function(e){c=!!e,this.hasBeenReset=!0}},line:{enumerable:!0,get:function(){return d},set:function(e){if(\"number\"!=typeof e&&\"auto\"!==e)throw new SyntaxError(\"Line: an invalid number or illegal string was specified.\");d=e,this.hasBeenReset=!0}},lineAlign:{enumerable:!0,get:function(){return h},set:function(e){e=Oi(e);e&&(h=e,this.hasBeenReset=!0)}},position:{enumerable:!0,get:function(){return p},set:function(e){if(e<0||100<e)throw new Error(\"Position must be between 0 and 100.\");p=e,this.hasBeenReset=!0}},positionAlign:{enumerable:!0,get:function(){return f},set:function(e){e=Oi(e);e&&(f=e,this.hasBeenReset=!0)}},size:{enumerable:!0,get:function(){return m},set:function(e){if(e<0||100<e)throw new Error(\"Size must be between 0 and 100.\");m=e,this.hasBeenReset=!0}},align:{enumerable:!0,get:function(){return g},set:function(e){e=Oi(e);if(!e)throw new SyntaxError(\"align: an invalid or illegal alignment string was specified.\");g=e,this.hasBeenReset=!0}}}),this.displayState=void 0}Mi.prototype.getCueAsHTML=function(){return WebVTT.convertCueToDOMTree(window,this.text)};var Ri=Mi,Ni={\"\":!0,up:!0};function Ui(e){return\"number\"==typeof e&&0<=e&&e<=100}function Bi(){var t=100,i=3,n=0,r=100,a=0,s=100,o=\"\";Object.defineProperties(this,{width:{enumerable:!0,get:function(){return t},set:function(e){if(!Ui(e))throw new Error(\"Width must be between 0 and 100.\");t=e}},lines:{enumerable:!0,get:function(){return i},set:function(e){if(\"number\"!=typeof e)throw new TypeError(\"Lines must be set to a number.\");i=e}},regionAnchorY:{enumerable:!0,get:function(){return r},set:function(e){if(!Ui(e))throw new Error(\"RegionAnchorX must be between 0 and 100.\");r=e}},regionAnchorX:{enumerable:!0,get:function(){return n},set:function(e){if(!Ui(e))throw new Error(\"RegionAnchorY must be between 0 and 100.\");n=e}},viewportAnchorY:{enumerable:!0,get:function(){return s},set:function(e){if(!Ui(e))throw new Error(\"ViewportAnchorY must be between 0 and 100.\");s=e}},viewportAnchorX:{enumerable:!0,get:function(){return a},set:function(e){if(!Ui(e))throw new Error(\"ViewportAnchorX must be between 0 and 100.\");a=e}},scroll:{enumerable:!0,get:function(){return o},set:function(e){e=\"string\"==typeof(e=e)&&(!!Ni[e.toLowerCase()]&&e.toLowerCase());!1===e||(o=e)}}})}var Fi=m(function(e){e=e.exports={WebVTT:Pi,VTTCue:Ri,VTTRegion:Bi};Kt.vttjs=e,Kt.WebVTT=e.WebVTT;var t=e.VTTCue,i=e.VTTRegion,n=Kt.VTTCue,r=Kt.VTTRegion;e.shim=function(){Kt.VTTCue=t,Kt.VTTRegion=i},e.restore=function(){Kt.VTTCue=n,Kt.VTTRegion=r},Kt.VTTCue||e.shim()});Fi.WebVTT,Fi.VTTCue,Fi.VTTRegion;var ji=function(n){function i(t,e){var i;return void 0===e&&(e=function(){}),(t=void 0===t?{}:t).reportTouchActivity=!1,(i=n.call(this,null,t,e)||this).onDurationChange_=function(e){return i.onDurationChange(e)},i.trackProgress_=function(e){return i.trackProgress(e)},i.trackCurrentTime_=function(e){return i.trackCurrentTime(e)},i.stopTrackingCurrentTime_=function(e){return i.stopTrackingCurrentTime(e)},i.disposeSourceHandler_=function(e){return i.disposeSourceHandler(e)},i.queuedHanders_=new Set,i.hasStarted_=!1,i.on(\"playing\",function(){this.hasStarted_=!0}),i.on(\"loadstart\",function(){this.hasStarted_=!1}),oi.names.forEach(function(e){e=oi[e];t&&t[e.getterName]&&(i[e.privateName]=t[e.getterName])}),i.featuresProgressEvents||i.manualProgressOn(),i.featuresTimeupdateEvents||i.manualTimeUpdatesOn(),[\"Text\",\"Audio\",\"Video\"].forEach(function(e){!1===t[\"native\"+e+\"Tracks\"]&&(i[\"featuresNative\"+e+\"Tracks\"]=!1)}),!1===t.nativeCaptions||!1===t.nativeTextTracks?i.featuresNativeTextTracks=!1:!0!==t.nativeCaptions&&!0!==t.nativeTextTracks||(i.featuresNativeTextTracks=!0),i.featuresNativeTextTracks||i.emulateTextTracks(),i.preloadTextTracks=!1!==t.preloadTextTracks,i.autoRemoteTextTracks_=new oi.text.ListClass,i.initTrackListeners(),t.nativeControlsForTouch||i.emitTapEvents(),i.constructor&&(i.name_=i.constructor.name||\"Unknown Tech\"),i}mt(i,n);var e=i.prototype;return e.triggerSourceset=function(e){var t=this;this.isReady_||this.one(\"ready\",function(){return t.setTimeout(function(){return t.triggerSourceset(e)},1)}),this.trigger({src:e,type:\"sourceset\"})},e.manualProgressOn=function(){this.on(\"durationchange\",this.onDurationChange_),this.manualProgress=!0,this.one(\"ready\",this.trackProgress_)},e.manualProgressOff=function(){this.manualProgress=!1,this.stopTrackingProgress(),this.off(\"durationchange\",this.onDurationChange_)},e.trackProgress=function(e){this.stopTrackingProgress(),this.progressInterval=this.setInterval(Ve(this,function(){var e=this.bufferedPercent();this.bufferedPercent_!==e&&this.trigger(\"progress\"),1===(this.bufferedPercent_=e)&&this.stopTrackingProgress()}),500)},e.onDurationChange=function(e){this.duration_=this.duration()},e.buffered=function(){return vt(0,0)},e.bufferedPercent=function(){return _t(this.buffered(),this.duration_)},e.stopTrackingProgress=function(){this.clearInterval(this.progressInterval)},e.manualTimeUpdatesOn=function(){this.manualTimeUpdates=!0,this.on(\"play\",this.trackCurrentTime_),this.on(\"pause\",this.stopTrackingCurrentTime_)},e.manualTimeUpdatesOff=function(){this.manualTimeUpdates=!1,this.stopTrackingCurrentTime(),this.off(\"play\",this.trackCurrentTime_),this.off(\"pause\",this.stopTrackingCurrentTime_)},e.trackCurrentTime=function(){this.currentTimeInterval&&this.stopTrackingCurrentTime(),this.currentTimeInterval=this.setInterval(function(){this.trigger({type:\"timeupdate\",target:this,manuallyTriggered:!0})},250)},e.stopTrackingCurrentTime=function(){this.clearInterval(this.currentTimeInterval),this.trigger({type:\"timeupdate\",target:this,manuallyTriggered:!0})},e.dispose=function(){this.clearTracks(ai.names),this.manualProgress&&this.manualProgressOff(),this.manualTimeUpdates&&this.manualTimeUpdatesOff(),n.prototype.dispose.call(this)},e.clearTracks=function(e){var r=this;(e=[].concat(e)).forEach(function(e){for(var t=r[e+\"Tracks\"]()||[],i=t.length;i--;){var n=t[i];\"text\"===e&&r.removeRemoteTextTrack(n),t.removeTrack(n)}})},e.cleanupAutoTextTracks=function(){for(var e=this.autoRemoteTextTracks_||[],t=e.length;t--;){var i=e[t];this.removeRemoteTextTrack(i)}},e.reset=function(){},e.crossOrigin=function(){},e.setCrossOrigin=function(){},e.error=function(e){return void 0!==e&&(this.error_=new bt(e),this.trigger(\"error\")),this.error_},e.played=function(){return this.hasStarted_?vt(0,0):vt()},e.play=function(){},e.setScrubbing=function(){},e.scrubbing=function(){},e.setCurrentTime=function(){this.manualTimeUpdates&&this.trigger({type:\"timeupdate\",target:this,manuallyTriggered:!0})},e.initTrackListeners=function(){var r=this;ai.names.forEach(function(e){function t(){r.trigger(e+\"trackchange\")}var i=ai[e],n=r[i.getterName]();n.addEventListener(\"removetrack\",t),n.addEventListener(\"addtrack\",t),r.on(\"dispose\",function(){n.removeEventListener(\"removetrack\",t),n.removeEventListener(\"addtrack\",t)})})},e.addWebVttScript_=function(){var e,t=this;window.WebVTT||(document.body.contains(this.el())?!this.options_[\"vtt.js\"]&&S(Fi)&&0<Object.keys(Fi).length?this.trigger(\"vttjsloaded\"):((e=document.createElement(\"script\")).src=this.options_[\"vtt.js\"]||\"https://vjs.zencdn.net/vttjs/0.14.1/vtt.min.js\",e.onload=function(){t.trigger(\"vttjsloaded\")},e.onerror=function(){t.trigger(\"vttjserror\")},this.on(\"dispose\",function(){e.onload=null,e.onerror=null}),window.WebVTT=!0,this.el().parentNode.appendChild(e)):this.ready(this.addWebVttScript_))},e.emulateTextTracks=function(){function t(e){return n.addTrack(e.track)}function i(e){return n.removeTrack(e.track)}var e=this,n=this.textTracks(),r=this.remoteTextTracks();r.on(\"addtrack\",t),r.on(\"removetrack\",i),this.addWebVttScript_();function a(){return e.trigger(\"texttrackchange\")}function s(){a();for(var e=0;e<n.length;e++){var t=n[e];t.removeEventListener(\"cuechange\",a),\"showing\"===t.mode&&t.addEventListener(\"cuechange\",a)}}s(),n.addEventListener(\"change\",s),n.addEventListener(\"addtrack\",s),n.addEventListener(\"removetrack\",s),this.on(\"dispose\",function(){r.off(\"addtrack\",t),r.off(\"removetrack\",i),n.removeEventListener(\"change\",s),n.removeEventListener(\"addtrack\",s),n.removeEventListener(\"removetrack\",s);for(var e=0;e<n.length;e++)n[e].removeEventListener(\"cuechange\",a)})},e.addTextTrack=function(e,t,i){if(!e)throw new Error(\"TextTrack kind is required but was not provided\");return function(e,t,i,n,r){void 0===r&&(r={});var a=e.textTracks();return r.kind=t,i&&(r.label=i),n&&(r.language=n),r.tech=e,r=new oi.text.TrackClass(r),a.addTrack(r),r}(this,e,t,i)},e.createRemoteTextTrack=function(e){e=lt(e,{tech:this});return new si.remoteTextEl.TrackClass(e)},e.addRemoteTextTrack=function(e,t){var i=this,n=this.createRemoteTextTrack(e=void 0===e?{}:e);return!0!==t&&!1!==t&&(h.warn('Calling addRemoteTextTrack without explicitly setting the \"manualCleanup\" parameter to `true` is deprecated and default to `false` in future version of video.js'),t=!0),this.remoteTextTrackEls().addTrackElement_(n),this.remoteTextTracks().addTrack(n.track),!0!==t&&this.ready(function(){return i.autoRemoteTextTracks_.addTrack(n.track)}),n},e.removeRemoteTextTrack=function(e){var t=this.remoteTextTrackEls().getTrackElementByTrack_(e);this.remoteTextTrackEls().removeTrackElement_(t),this.remoteTextTracks().removeTrack(e),this.autoRemoteTextTracks_.removeTrack(e)},e.getVideoPlaybackQuality=function(){return{}},e.requestPictureInPicture=function(){var e=this.options_.Promise||window.Promise;if(e)return e.reject()},e.disablePictureInPicture=function(){return!0},e.setDisablePictureInPicture=function(){},e.requestVideoFrameCallback=function(e){var t=this,i=Pe++;return this.paused()?(this.queuedHanders_.add(i),this.one(\"playing\",function(){t.queuedHanders_.has(i)&&(t.queuedHanders_.delete(i),e())})):this.requestNamedAnimationFrame(i,e),i},e.cancelVideoFrameCallback=function(e){this.queuedHanders_.has(e)?this.queuedHanders_.delete(e):this.cancelNamedAnimationFrame(e)},e.setPoster=function(){},e.playsinline=function(){},e.setPlaysinline=function(){},e.overrideNativeAudioTracks=function(){},e.overrideNativeVideoTracks=function(){},e.canPlayType=function(){return\"\"},i.canPlayType=function(){return\"\"},i.canPlaySource=function(e,t){return i.canPlayType(e.type)},i.isTech=function(e){return e.prototype instanceof i||e instanceof i||e===i},i.registerTech=function(e,t){if(i.techs_||(i.techs_={}),!i.isTech(t))throw new Error(\"Tech \"+e+\" must be a Tech\");if(!i.canPlayType)throw new Error(\"Techs must have a static canPlayType method on them\");if(!i.canPlaySource)throw new Error(\"Techs must have a static canPlaySource method on them\");return e=ut(e),i.techs_[e]=t,i.techs_[ot(e)]=t,\"Tech\"!==e&&i.defaultTechOrder_.push(e),t},i.getTech=function(e){if(e)return i.techs_&&i.techs_[e]?i.techs_[e]:(e=ut(e),window&&window.videojs&&window.videojs[e]?(h.warn(\"The \"+e+\" tech was added to the videojs object when it should be registered using videojs.registerTech(name, tech)\"),window.videojs[e]):void 0)},i}(pt);oi.names.forEach(function(e){var t=oi[e];ji.prototype[t.getterName]=function(){return this[t.privateName]=this[t.privateName]||new t.ListClass,this[t.privateName]}}),ji.prototype.featuresVolumeControl=!0,ji.prototype.featuresMuteControl=!0,ji.prototype.featuresFullscreenResize=!1,ji.prototype.featuresPlaybackRate=!1,ji.prototype.featuresProgressEvents=!1,ji.prototype.featuresSourceset=!1,ji.prototype.featuresTimeupdateEvents=!1,ji.prototype.featuresNativeTextTracks=!1,ji.prototype.featuresVideoFrameCallback=!1,ji.withSourceHandlers=function(r){r.registerSourceHandler=function(e,t){var i=(i=r.sourceHandlers)||(r.sourceHandlers=[]);void 0===t&&(t=i.length),i.splice(t,0,e)},r.canPlayType=function(e){for(var t,i=r.sourceHandlers||[],n=0;n<i.length;n++)if(t=i[n].canPlayType(e))return t;return\"\"},r.selectSourceHandler=function(e,t){for(var i=r.sourceHandlers||[],n=0;n<i.length;n++)if(i[n].canHandleSource(e,t))return i[n];return null},r.canPlaySource=function(e,t){var i=r.selectSourceHandler(e,t);return i?i.canHandleSource(e,t):\"\"};[\"seekable\",\"seeking\",\"duration\"].forEach(function(e){var t=this[e];\"function\"==typeof t&&(this[e]=function(){return this.sourceHandler_&&this.sourceHandler_[e]?this.sourceHandler_[e].apply(this.sourceHandler_,arguments):t.apply(this,arguments)})},r.prototype),r.prototype.setSource=function(e){var t=r.selectSourceHandler(e,this.options_);t||(r.nativeSourceHandler?t=r.nativeSourceHandler:h.error(\"No source handler found for the current source.\")),this.disposeSourceHandler(),this.off(\"dispose\",this.disposeSourceHandler_),t!==r.nativeSourceHandler&&(this.currentSource_=e),this.sourceHandler_=t.handleSource(e,this,this.options_),this.one(\"dispose\",this.disposeSourceHandler_)},r.prototype.disposeSourceHandler=function(){this.currentSource_&&(this.clearTracks([\"audio\",\"video\"]),this.currentSource_=null),this.cleanupAutoTextTracks(),this.sourceHandler_&&(this.sourceHandler_.dispose&&this.sourceHandler_.dispose(),this.sourceHandler_=null)}},pt.registerComponent(\"Tech\",ji),ji.registerTech(\"Tech\",ji),ji.defaultTechOrder_=[];var Hi={},qi={},Vi={};function Wi(e,t,i){e.setTimeout(function(){return function i(n,e,r,a,s,o){void 0===n&&(n={});void 0===e&&(e=[]);void 0===s&&(s=[]);void 0===o&&(o=!1);var t=e,e=t[0],u=t.slice(1);if(\"string\"==typeof e)i(n,Hi[e],r,a,s,o);else if(e){var l=Qi(a,e);if(!l.setSource)return s.push(l),i(n,u,r,a,s,o);l.setSource(b({},n),function(e,t){return e?i(n,u,r,a,s,o):(s.push(l),void i(t,n.type===t.type?u:Hi[t.type],r,a,s,o))})}else u.length?i(n,u,r,a,s,o):o?r(n,s):i(n,Hi[\"*\"],r,a,s,!0)}(t,Hi[t.type],i,e)},1)}function Gi(e,t,i,n){void 0===n&&(n=null);var r=\"call\"+ut(i),r=e.reduce(Yi(r),n),n=r===Vi,r=n?null:t[i](r);return function(e,t,i,n){for(var r=e.length-1;0<=r;r--){var a=e[r];a[t]&&a[t](n,i)}}(e,i,r,n),r}var zi={buffered:1,currentTime:1,duration:1,muted:1,played:1,paused:1,seekable:1,volume:1,ended:1},Xi={setCurrentTime:1,setMuted:1,setVolume:1},Ki={play:1,pause:1};function Yi(i){return function(e,t){return e===Vi?Vi:t[i]?t[i](e):e}}function Qi(e,t){var i=qi[e.id()],n=null;if(null==i)return n=t(e),qi[e.id()]=[[t,n]],n;for(var r=0;r<i.length;r++){var a=i[r],s=a[0],a=a[1];s===t&&(n=a)}return null===n&&(n=t(e),i.push([t,n])),n}function $i(e){return e=Nt(e=void 0===e?\"\":e),Zi[e.toLowerCase()]||\"\"}function Ji(e){var t;return e=Array.isArray(e)?(t=[],e.forEach(function(e){e=Ji(e),Array.isArray(e)?t=t.concat(e):T(e)&&t.push(e)}),t):\"string\"==typeof e&&e.trim()?[en({src:e})]:T(e)&&\"string\"==typeof e.src&&e.src&&e.src.trim()?[en(e)]:[]}var Zi={opus:\"video/ogg\",ogv:\"video/ogg\",mp4:\"video/mp4\",mov:\"video/mp4\",m4v:\"video/mp4\",mkv:\"video/x-matroska\",m4a:\"audio/mp4\",mp3:\"audio/mpeg\",aac:\"audio/aac\",caf:\"audio/x-caf\",flac:\"audio/flac\",oga:\"audio/ogg\",wav:\"audio/wav\",m3u8:\"application/x-mpegURL\",mpd:\"application/dash+xml\",jpg:\"image/jpeg\",jpeg:\"image/jpeg\",gif:\"image/gif\",png:\"image/png\",svg:\"image/svg+xml\",webp:\"image/webp\"};function en(e){var t;return e.type||(t=$i(e.src))&&(e.type=t),e}I=function(u){function e(e,t,i){var n=lt({createEl:!1},t),i=u.call(this,e,n,i)||this;if(t.playerOptions.sources&&0!==t.playerOptions.sources.length)e.src(t.playerOptions.sources);else for(var r=0,a=t.playerOptions.techOrder;r<a.length;r++){var s=ut(a[r]),o=ji.getTech(s);if((o=!s?pt.getComponent(s):o)&&o.isSupported()){e.loadTech_(s);break}}return i}return mt(e,u),e}(pt);pt.registerComponent(\"MediaLoader\",I);C=function(n){function e(e,t){var i=n.call(this,e,t)||this;return i.options_.controlText&&i.controlText(i.options_.controlText),i.handleMouseOver_=function(e){return i.handleMouseOver(e)},i.handleMouseOut_=function(e){return i.handleMouseOut(e)},i.handleClick_=function(e){return i.handleClick(e)},i.handleKeyDown_=function(e){return i.handleKeyDown(e)},i.emitTapEvents(),i.enable(),i}mt(e,n);var t=e.prototype;return t.createEl=function(e,t,i){void 0===e&&(e=\"div\"),void 0===t&&(t={}),void 0===i&&(i={}),t=b({className:this.buildCSSClass(),tabIndex:0},t),\"button\"===e&&h.error(\"Creating a ClickableComponent with an HTML element of \"+e+\" is not supported; use a Button instead.\"),i=b({role:\"button\"},i),this.tabIndex_=t.tabIndex;i=$(e,t,i);return i.appendChild($(\"span\",{className:\"vjs-icon-placeholder\"},{\"aria-hidden\":!0})),this.createControlTextEl(i),i},t.dispose=function(){this.controlTextEl_=null,n.prototype.dispose.call(this)},t.createControlTextEl=function(e){return this.controlTextEl_=$(\"span\",{className:\"vjs-control-text\"},{\"aria-live\":\"polite\"}),e&&e.appendChild(this.controlTextEl_),this.controlText(this.controlText_,e),this.controlTextEl_},t.controlText=function(e,t){if(void 0===t&&(t=this.el()),void 0===e)return this.controlText_||\"Need Text\";var i=this.localize(e);this.controlText_=e,J(this.controlTextEl_,i),this.nonIconControl||this.player_.options_.noUITitleAttributes||t.setAttribute(\"title\",i)},t.buildCSSClass=function(){return\"vjs-control vjs-button \"+n.prototype.buildCSSClass.call(this)},t.enable=function(){this.enabled_||(this.enabled_=!0,this.removeClass(\"vjs-disabled\"),this.el_.setAttribute(\"aria-disabled\",\"false\"),\"undefined\"!=typeof this.tabIndex_&&this.el_.setAttribute(\"tabIndex\",this.tabIndex_),this.on([\"tap\",\"click\"],this.handleClick_),this.on(\"keydown\",this.handleKeyDown_))},t.disable=function(){this.enabled_=!1,this.addClass(\"vjs-disabled\"),this.el_.setAttribute(\"aria-disabled\",\"true\"),\"undefined\"!=typeof this.tabIndex_&&this.el_.removeAttribute(\"tabIndex\"),this.off(\"mouseover\",this.handleMouseOver_),this.off(\"mouseout\",this.handleMouseOut_),this.off([\"tap\",\"click\"],this.handleClick_),this.off(\"keydown\",this.handleKeyDown_)},t.handleLanguagechange=function(){this.controlText(this.controlText_)},t.handleClick=function(e){this.options_.clickHandler&&this.options_.clickHandler.call(this,arguments)},t.handleKeyDown=function(e){ht.isEventKey(e,\"Space\")||ht.isEventKey(e,\"Enter\")?(e.preventDefault(),e.stopPropagation(),this.trigger(\"click\")):n.prototype.handleKeyDown.call(this,e)},e}(pt);pt.registerComponent(\"ClickableComponent\",C),pt.registerComponent(\"PosterImage\",function(n){function e(e,t){var i=n.call(this,e,t)||this;return i.update(),i.update_=function(e){return i.update(e)},e.on(\"posterchange\",i.update_),i}mt(e,n);var t=e.prototype;return t.dispose=function(){this.player().off(\"posterchange\",this.update_),n.prototype.dispose.call(this)},t.createEl=function(){return $(\"div\",{className:\"vjs-poster\",tabIndex:-1})},t.update=function(e){var t=this.player().poster();this.setSrc(t),t?this.show():this.hide()},t.setSrc=function(e){this.el_.style.backgroundImage=e?'url(\"'+e+'\")':\"\"},t.handleClick=function(e){var t;this.player_.controls()&&(t=this.player_.usingPlugin(\"eme\")&&this.player_.eme.sessions&&0<this.player_.eme.sessions.length,!this.player_.tech(!0)||(N||O)&&t||this.player_.tech(!0).focus(),this.player_.paused()?Et(this.player_.play()):this.player_.pause())},e}(C));var tn=\"#222\",nn={monospace:\"monospace\",sansSerif:\"sans-serif\",serif:\"serif\",monospaceSansSerif:'\"Andale Mono\", \"Lucida Console\", monospace',monospaceSerif:'\"Courier New\", monospace',proportionalSansSerif:\"sans-serif\",proportionalSerif:\"serif\",casual:'\"Comic Sans MS\", Impact, fantasy',script:'\"Monotype Corsiva\", cursive',smallcaps:'\"Andale Mono\", \"Lucida Console\", monospace, sans-serif'};function rn(e,t){var i;if(4===e.length)i=e[1]+e[1]+e[2]+e[2]+e[3]+e[3];else{if(7!==e.length)throw new Error(\"Invalid color code provided, \"+e+\"; must be formatted as e.g. #f0e or #f604e2.\");i=e.slice(1)}return\"rgba(\"+parseInt(i.slice(0,2),16)+\",\"+parseInt(i.slice(2,4),16)+\",\"+parseInt(i.slice(4,6),16)+\",\"+t+\")\"}function an(e,t,i){try{e.style[t]=i}catch(e){return}}pt.registerComponent(\"TextTrackDisplay\",function(a){function e(i,e,t){function n(e){return r.updateDisplay(e)}var r=a.call(this,i,e,t)||this;return i.on(\"loadstart\",function(e){return r.toggleDisplay(e)}),i.on(\"texttrackchange\",n),i.on(\"loadedmetadata\",function(e){return r.preselectTrack(e)}),i.ready(Ve(ft(r),function(){if(i.tech_&&i.tech_.featuresNativeTextTracks)this.hide();else{i.on(\"fullscreenchange\",n),i.on(\"playerresize\",n),window.addEventListener(\"orientationchange\",n),i.on(\"dispose\",function(){return window.removeEventListener(\"orientationchange\",n)});for(var e=this.options_.playerOptions.tracks||[],t=0;t<e.length;t++)this.player_.addRemoteTextTrack(e[t],!0);this.preselectTrack()}})),r}mt(e,a);var t=e.prototype;return t.preselectTrack=function(){for(var e,t,i,n={captions:1,subtitles:1},r=this.player_.textTracks(),a=this.player_.cache_.selectedLanguage,s=0;s<r.length;s++){var o=r[s];a&&a.enabled&&a.language&&a.language===o.language&&o.kind in n?i=o.kind!==a.kind&&i||o:a&&!a.enabled?t=e=i=null:o.default&&(\"descriptions\"!==o.kind||e?o.kind in n&&!t&&(t=o):e=o)}i?i.mode=\"showing\":t?t.mode=\"showing\":e&&(e.mode=\"showing\")},t.toggleDisplay=function(){this.player_.tech_&&this.player_.tech_.featuresNativeTextTracks?this.hide():this.show()},t.createEl=function(){return a.prototype.createEl.call(this,\"div\",{className:\"vjs-text-track-display\"},{translate:\"yes\",\"aria-live\":\"off\",\"aria-atomic\":\"true\"})},t.clearDisplay=function(){\"function\"==typeof window.WebVTT&&window.WebVTT.processCues(window,[],this.el_)},t.updateDisplay=function(){var e=this.player_.textTracks(),t=this.options_.allowMultipleShowingTracks;if(this.clearDisplay(),t){for(var i=[],n=0;n<e.length;++n){var r=e[n];\"showing\"===r.mode&&i.push(r)}this.updateForTrack(i)}else{for(var a=null,s=null,o=e.length;o--;){var u=e[o];\"showing\"===u.mode&&(\"descriptions\"===u.kind?a=u:s=u)}s?(\"off\"!==this.getAttribute(\"aria-live\")&&this.setAttribute(\"aria-live\",\"off\"),this.updateForTrack(s)):a&&(\"assertive\"!==this.getAttribute(\"aria-live\")&&this.setAttribute(\"aria-live\",\"assertive\"),this.updateForTrack(a))}},t.updateDisplayState=function(e){for(var t=this.player_.textTrackSettings.getValues(),i=e.activeCues,n=i.length;n--;){var r,a=i[n];a&&(r=a.displayState,t.color&&(r.firstChild.style.color=t.color),t.textOpacity&&an(r.firstChild,\"color\",rn(t.color||\"#fff\",t.textOpacity)),t.backgroundColor&&(r.firstChild.style.backgroundColor=t.backgroundColor),t.backgroundOpacity&&an(r.firstChild,\"backgroundColor\",rn(t.backgroundColor||\"#000\",t.backgroundOpacity)),t.windowColor&&(t.windowOpacity?an(r,\"backgroundColor\",rn(t.windowColor,t.windowOpacity)):r.style.backgroundColor=t.windowColor),t.edgeStyle&&(\"dropshadow\"===t.edgeStyle?r.firstChild.style.textShadow=\"2px 2px 3px #222, 2px 2px 4px #222, 2px 2px 5px \"+tn:\"raised\"===t.edgeStyle?r.firstChild.style.textShadow=\"1px 1px #222, 2px 2px #222, 3px 3px \"+tn:\"depressed\"===t.edgeStyle?r.firstChild.style.textShadow=\"1px 1px #ccc, 0 1px #ccc, -1px -1px #222, 0 -1px \"+tn:\"uniform\"===t.edgeStyle&&(r.firstChild.style.textShadow=\"0 0 4px #222, 0 0 4px #222, 0 0 4px #222, 0 0 4px \"+tn)),t.fontPercent&&1!==t.fontPercent&&(a=window.parseFloat(r.style.fontSize),r.style.fontSize=a*t.fontPercent+\"px\",r.style.height=\"auto\",r.style.top=\"auto\"),t.fontFamily&&\"default\"!==t.fontFamily&&(\"small-caps\"===t.fontFamily?r.firstChild.style.fontVariant=\"small-caps\":r.firstChild.style.fontFamily=nn[t.fontFamily]))}},t.updateForTrack=function(e){if(Array.isArray(e)||(e=[e]),\"function\"==typeof window.WebVTT&&!e.every(function(e){return!e.activeCues})){for(var t=[],i=0;i<e.length;++i)for(var n=e[i],r=0;r<n.activeCues.length;++r)t.push(n.activeCues[r]);window.WebVTT.processCues(window,t,this.el_);for(var a=0;a<e.length;++a){for(var s=e[a],o=0;o<s.activeCues.length;++o){var u=s.activeCues[o].displayState;te(u,\"vjs-text-track-cue\"),te(u,\"vjs-text-track-cue-\"+(s.language||a)),s.language&&oe(u,\"lang\",s.language)}this.player_.textTrackSettings&&this.updateDisplayState(s)}}},e}(pt)),pt.registerComponent(\"LoadingSpinner\",function(i){function e(){return i.apply(this,arguments)||this}return mt(e,i),e.prototype.createEl=function(){var e=this.player_.isAudio(),t=this.localize(e?\"Audio Player\":\"Video Player\"),e=$(\"span\",{className:\"vjs-control-text\",textContent:this.localize(\"{1} is loading.\",[t])}),t=i.prototype.createEl.call(this,\"div\",{className:\"vjs-loading-spinner\",dir:\"ltr\"});return t.appendChild(e),t},e}(pt));var sn=function(t){function e(){return t.apply(this,arguments)||this}mt(e,t);var i=e.prototype;return i.createEl=function(e,t,i){void 0===t&&(t={}),void 0===i&&(i={});i=$(\"button\",t=b({className:this.buildCSSClass()},t),i=b({type:\"button\"},i));return i.appendChild($(\"span\",{className:\"vjs-icon-placeholder\"},{\"aria-hidden\":!0})),this.createControlTextEl(i),i},i.addChild=function(e,t){void 0===t&&(t={});var i=this.constructor.name;return h.warn(\"Adding an actionable (user controllable) child to a Button (\"+i+\") is not supported; use a ClickableComponent instead.\"),pt.prototype.addChild.call(this,e,t)},i.enable=function(){t.prototype.enable.call(this),this.el_.removeAttribute(\"disabled\")},i.disable=function(){t.prototype.disable.call(this),this.el_.setAttribute(\"disabled\",\"disabled\")},i.handleKeyDown=function(e){ht.isEventKey(e,\"Space\")||ht.isEventKey(e,\"Enter\")?e.stopPropagation():t.prototype.handleKeyDown.call(this,e)},e}(C);pt.registerComponent(\"Button\",sn);Bt=function(n){function e(e,t){var i=n.call(this,e,t)||this;return i.mouseused_=!1,i.on(\"mousedown\",function(e){return i.handleMouseDown(e)}),i}mt(e,n);var t=e.prototype;return t.buildCSSClass=function(){return\"vjs-big-play-button\"},t.handleClick=function(e){var t=this.player_.play();if(this.mouseused_&&e.clientX&&e.clientY){var i=this.player_.usingPlugin(\"eme\")&&this.player_.eme.sessions&&0<this.player_.eme.sessions.length;return Et(t),void(!this.player_.tech(!0)||(N||O)&&i||this.player_.tech(!0).focus())}var i=this.player_.getChild(\"controlBar\"),n=i&&i.getChild(\"playToggle\");n?(i=function(){return n.focus()},wt(t)?t.then(i,function(){}):this.setTimeout(i,1)):this.player_.tech(!0).focus()},t.handleKeyDown=function(e){this.mouseused_=!1,n.prototype.handleKeyDown.call(this,e)},t.handleMouseDown=function(e){this.mouseused_=!0},e}(sn);Bt.prototype.controlText_=\"Play Video\",pt.registerComponent(\"BigPlayButton\",Bt),pt.registerComponent(\"CloseButton\",function(i){function e(e,t){e=i.call(this,e,t)||this;return e.controlText(t&&t.controlText||e.localize(\"Close\")),e}mt(e,i);var t=e.prototype;return t.buildCSSClass=function(){return\"vjs-close-button \"+i.prototype.buildCSSClass.call(this)},t.handleClick=function(e){this.trigger({type:\"close\",bubbles:!1})},t.handleKeyDown=function(e){ht.isEventKey(e,\"Esc\")?(e.preventDefault(),e.stopPropagation(),this.trigger(\"click\")):i.prototype.handleKeyDown.call(this,e)},e}(sn));Ft=function(n){function e(e,t){var i=n.call(this,e,t=void 0===t?{}:t)||this;return t.replay=void 0===t.replay||t.replay,i.on(e,\"play\",function(e){return i.handlePlay(e)}),i.on(e,\"pause\",function(e){return i.handlePause(e)}),t.replay&&i.on(e,\"ended\",function(e){return i.handleEnded(e)}),i}mt(e,n);var t=e.prototype;return t.buildCSSClass=function(){return\"vjs-play-control \"+n.prototype.buildCSSClass.call(this)},t.handleClick=function(e){this.player_.paused()?Et(this.player_.play()):this.player_.pause()},t.handleSeeked=function(e){this.removeClass(\"vjs-ended\"),this.player_.paused()?this.handlePause(e):this.handlePlay(e)},t.handlePlay=function(e){this.removeClass(\"vjs-ended\"),this.removeClass(\"vjs-paused\"),this.addClass(\"vjs-playing\"),this.controlText(\"Pause\")},t.handlePause=function(e){this.removeClass(\"vjs-playing\"),this.addClass(\"vjs-paused\"),this.controlText(\"Play\")},t.handleEnded=function(e){var t=this;this.removeClass(\"vjs-playing\"),this.addClass(\"vjs-ended\"),this.controlText(\"Replay\"),this.one(this.player_,\"seeked\",function(e){return t.handleSeeked(e)})},e}(sn);Ft.prototype.controlText_=\"Play\",pt.registerComponent(\"PlayToggle\",Ft);function on(e,t){e=e<0?0:e;var i=Math.floor(e%60),n=Math.floor(e/60%60),r=Math.floor(e/3600),a=Math.floor(t/60%60),t=Math.floor(t/3600);return(r=0<(r=isNaN(e)||e===1/0?n=i=\"-\":r)||0<t?r+\":\":\"\")+(n=((r||10<=a)&&n<10?\"0\"+n:n)+\":\")+(i=i<10?\"0\"+i:i)}var un=on;function ln(e,t){return un(e,t=void 0===t?e:t)}k=function(n){function e(e,t){var i=n.call(this,e,t)||this;return i.on(e,[\"timeupdate\",\"ended\"],function(e){return i.updateContent(e)}),i.updateTextNode_(),i}mt(e,n);var t=e.prototype;return t.createEl=function(){var e=this.buildCSSClass(),t=n.prototype.createEl.call(this,\"div\",{className:e+\" vjs-time-control vjs-control\"}),i=$(\"span\",{className:\"vjs-control-text\",textContent:this.localize(this.labelText_)+\"\u00a0\"},{role:\"presentation\"});return t.appendChild(i),this.contentEl_=$(\"span\",{className:e+\"-display\"},{\"aria-live\":\"off\",role:\"presentation\"}),t.appendChild(this.contentEl_),t},t.dispose=function(){this.contentEl_=null,this.textNode_=null,n.prototype.dispose.call(this)},t.updateTextNode_=function(e){var t=this;e=ln(e=void 0===e?0:e),this.formattedTime_!==e&&(this.formattedTime_=e,this.requestNamedAnimationFrame(\"TimeDisplay#updateTextNode_\",function(){var e;t.contentEl_&&((e=t.textNode_)&&t.contentEl_.firstChild!==e&&(e=null,h.warn(\"TimeDisplay#updateTextnode_: Prevented replacement of text node element since it was no longer a child of this node. Appending a new node instead.\")),t.textNode_=document.createTextNode(t.formattedTime_),t.textNode_&&(e?t.contentEl_.replaceChild(t.textNode_,e):t.contentEl_.appendChild(t.textNode_)))}))},t.updateContent=function(e){},e}(pt);k.prototype.labelText_=\"Time\",k.prototype.controlText_=\"Time\",pt.registerComponent(\"TimeDisplay\",k);jt=function(e){function t(){return e.apply(this,arguments)||this}mt(t,e);var i=t.prototype;return i.buildCSSClass=function(){return\"vjs-current-time\"},i.updateContent=function(e){var t=this.player_.ended()?this.player_.duration():this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime();this.updateTextNode_(t)},t}(k);jt.prototype.labelText_=\"Current Time\",jt.prototype.controlText_=\"Current Time\",pt.registerComponent(\"CurrentTimeDisplay\",jt);j=function(n){function e(e,t){var i=n.call(this,e,t)||this,t=function(e){return i.updateContent(e)};return i.on(e,\"durationchange\",t),i.on(e,\"loadstart\",t),i.on(e,\"loadedmetadata\",t),i}mt(e,n);var t=e.prototype;return t.buildCSSClass=function(){return\"vjs-duration\"},t.updateContent=function(e){var t=this.player_.duration();this.updateTextNode_(t)},e}(k);j.prototype.labelText_=\"Duration\",j.prototype.controlText_=\"Duration\",pt.registerComponent(\"DurationDisplay\",j),pt.registerComponent(\"TimeDivider\",function(n){function e(){return n.apply(this,arguments)||this}return mt(e,n),e.prototype.createEl=function(){var e=n.prototype.createEl.call(this,\"div\",{className:\"vjs-time-control vjs-time-divider\"},{\"aria-hidden\":!0}),t=n.prototype.createEl.call(this,\"div\"),i=n.prototype.createEl.call(this,\"span\",{textContent:\"/\"});return t.appendChild(i),e.appendChild(t),e},e}(pt));f=function(n){function e(e,t){var i=n.call(this,e,t)||this;return i.on(e,\"durationchange\",function(e){return i.updateContent(e)}),i}mt(e,n);var t=e.prototype;return t.buildCSSClass=function(){return\"vjs-remaining-time\"},t.createEl=function(){var e=n.prototype.createEl.call(this);return!1!==this.options_.displayNegative&&e.insertBefore($(\"span\",{},{\"aria-hidden\":!0},\"-\"),this.contentEl_),e},t.updateContent=function(e){var t;\"number\"==typeof this.player_.duration()&&(t=this.player_.ended()?0:this.player_.remainingTimeDisplay?this.player_.remainingTimeDisplay():this.player_.remainingTime(),this.updateTextNode_(t))},e}(k);f.prototype.labelText_=\"Remaining Time\",f.prototype.controlText_=\"Remaining Time\",pt.registerComponent(\"RemainingTimeDisplay\",f),pt.registerComponent(\"LiveDisplay\",function(n){function e(e,t){var i=n.call(this,e,t)||this;return i.updateShowing(),i.on(i.player(),\"durationchange\",function(e){return i.updateShowing(e)}),i}mt(e,n);var t=e.prototype;return t.createEl=function(){var e=n.prototype.createEl.call(this,\"div\",{className:\"vjs-live-control vjs-control\"});return this.contentEl_=$(\"div\",{className:\"vjs-live-display\"},{\"aria-live\":\"off\"}),this.contentEl_.appendChild($(\"span\",{className:\"vjs-control-text\",textContent:this.localize(\"Stream Type\")+\"\u00a0\"})),this.contentEl_.appendChild(document.createTextNode(this.localize(\"LIVE\"))),e.appendChild(this.contentEl_),e},t.dispose=function(){this.contentEl_=null,n.prototype.dispose.call(this)},t.updateShowing=function(e){this.player().duration()===1/0?this.show():this.hide()},e}(pt));ui=function(n){function e(e,t){var i=n.call(this,e,t)||this;return i.updateLiveEdgeStatus(),i.player_.liveTracker&&(i.updateLiveEdgeStatusHandler_=function(e){return i.updateLiveEdgeStatus(e)},i.on(i.player_.liveTracker,\"liveedgechange\",i.updateLiveEdgeStatusHandler_)),i}mt(e,n);var t=e.prototype;return t.createEl=function(){var e=n.prototype.createEl.call(this,\"button\",{className:\"vjs-seek-to-live-control vjs-control\"});return this.textEl_=$(\"span\",{className:\"vjs-seek-to-live-text\",textContent:this.localize(\"LIVE\")},{\"aria-hidden\":\"true\"}),e.appendChild(this.textEl_),e},t.updateLiveEdgeStatus=function(){!this.player_.liveTracker||this.player_.liveTracker.atLiveEdge()?(this.setAttribute(\"aria-disabled\",!0),this.addClass(\"vjs-at-live-edge\"),this.controlText(\"Seek to live, currently playing live\")):(this.setAttribute(\"aria-disabled\",!1),this.removeClass(\"vjs-at-live-edge\"),this.controlText(\"Seek to live, currently behind live\"))},t.handleClick=function(){this.player_.liveTracker.seekToLiveEdge()},t.dispose=function(){this.player_.liveTracker&&this.off(this.player_.liveTracker,\"liveedgechange\",this.updateLiveEdgeStatusHandler_),this.textEl_=null,n.prototype.dispose.call(this)},e}(sn);ui.prototype.controlText_=\"Seek to live, currently playing live\",pt.registerComponent(\"SeekToLive\",ui);function cn(e,t,i){return e=Number(e),Math.min(i,Math.max(t,isNaN(e)?t:e))}li=function(n){function e(e,t){var i=n.call(this,e,t)||this;return i.handleMouseDown_=function(e){return i.handleMouseDown(e)},i.handleMouseUp_=function(e){return i.handleMouseUp(e)},i.handleKeyDown_=function(e){return i.handleKeyDown(e)},i.handleClick_=function(e){return i.handleClick(e)},i.handleMouseMove_=function(e){return i.handleMouseMove(e)},i.update_=function(e){return i.update(e)},i.bar=i.getChild(i.options_.barName),i.vertical(!!i.options_.vertical),i.enable(),i}mt(e,n);var t=e.prototype;return t.enabled=function(){return this.enabled_},t.enable=function(){this.enabled()||(this.on(\"mousedown\",this.handleMouseDown_),this.on(\"touchstart\",this.handleMouseDown_),this.on(\"keydown\",this.handleKeyDown_),this.on(\"click\",this.handleClick_),this.on(this.player_,\"controlsvisible\",this.update),this.playerEvent&&this.on(this.player_,this.playerEvent,this.update),this.removeClass(\"disabled\"),this.setAttribute(\"tabindex\",0),this.enabled_=!0)},t.disable=function(){var e;this.enabled()&&(e=this.bar.el_.ownerDocument,this.off(\"mousedown\",this.handleMouseDown_),this.off(\"touchstart\",this.handleMouseDown_),this.off(\"keydown\",this.handleKeyDown_),this.off(\"click\",this.handleClick_),this.off(this.player_,\"controlsvisible\",this.update_),this.off(e,\"mousemove\",this.handleMouseMove_),this.off(e,\"mouseup\",this.handleMouseUp_),this.off(e,\"touchmove\",this.handleMouseMove_),this.off(e,\"touchend\",this.handleMouseUp_),this.removeAttribute(\"tabindex\"),this.addClass(\"disabled\"),this.playerEvent&&this.off(this.player_,this.playerEvent,this.update),this.enabled_=!1)},t.createEl=function(e,t,i){return void 0===i&&(i={}),(t=void 0===t?{}:t).className=t.className+\" vjs-slider\",t=b({tabIndex:0},t),i=b({role:\"slider\",\"aria-valuenow\":0,\"aria-valuemin\":0,\"aria-valuemax\":100,tabIndex:0},i),n.prototype.createEl.call(this,e,t,i)},t.handleMouseDown=function(e){var t=this.bar.el_.ownerDocument;\"mousedown\"===e.type&&e.preventDefault(),\"touchstart\"!==e.type||M||e.preventDefault(),le(),this.addClass(\"vjs-sliding\"),this.trigger(\"slideractive\"),this.on(t,\"mousemove\",this.handleMouseMove_),this.on(t,\"mouseup\",this.handleMouseUp_),this.on(t,\"touchmove\",this.handleMouseMove_),this.on(t,\"touchend\",this.handleMouseUp_),this.handleMouseMove(e,!0)},t.handleMouseMove=function(e){},t.handleMouseUp=function(){var e=this.bar.el_.ownerDocument;ce(),this.removeClass(\"vjs-sliding\"),this.trigger(\"sliderinactive\"),this.off(e,\"mousemove\",this.handleMouseMove_),this.off(e,\"mouseup\",this.handleMouseUp_),this.off(e,\"touchmove\",this.handleMouseMove_),this.off(e,\"touchend\",this.handleMouseUp_),this.update()},t.update=function(){var t=this;if(this.el_&&this.bar){var i=this.getProgress();return i===this.progress_?i:(this.progress_=i,this.requestNamedAnimationFrame(\"Slider#update\",function(){var e=t.vertical()?\"height\":\"width\";t.bar.el().style[e]=(100*i).toFixed(2)+\"%\"}),i)}},t.getProgress=function(){return Number(cn(this.getPercent(),0,1).toFixed(4))},t.calculateDistance=function(e){e=pe(this.el_,e);return this.vertical()?e.y:e.x},t.handleKeyDown=function(e){ht.isEventKey(e,\"Left\")||ht.isEventKey(e,\"Down\")?(e.preventDefault(),e.stopPropagation(),this.stepBack()):ht.isEventKey(e,\"Right\")||ht.isEventKey(e,\"Up\")?(e.preventDefault(),e.stopPropagation(),this.stepForward()):n.prototype.handleKeyDown.call(this,e)},t.handleClick=function(e){e.stopPropagation(),e.preventDefault()},t.vertical=function(e){if(void 0===e)return this.vertical_||!1;this.vertical_=!!e,this.vertical_?this.addClass(\"vjs-slider-vertical\"):this.addClass(\"vjs-slider-horizontal\")},e}(pt);pt.registerComponent(\"Slider\",li);function dn(e,t){return cn(e/t*100,0,100).toFixed(2)+\"%\"}pt.registerComponent(\"LoadProgressBar\",function(r){function e(e,t){var i=r.call(this,e,t)||this;return i.partEls_=[],i.on(e,\"progress\",function(e){return i.update(e)}),i}mt(e,r);var t=e.prototype;return t.createEl=function(){var e=r.prototype.createEl.call(this,\"div\",{className:\"vjs-load-progress\"}),t=$(\"span\",{className:\"vjs-control-text\"}),i=$(\"span\",{textContent:this.localize(\"Loaded\")}),n=document.createTextNode(\": \");return this.percentageEl_=$(\"span\",{className:\"vjs-control-text-loaded-percentage\",textContent:\"0%\"}),e.appendChild(t),t.appendChild(i),t.appendChild(n),t.appendChild(this.percentageEl_),e},t.dispose=function(){this.partEls_=null,this.percentageEl_=null,r.prototype.dispose.call(this)},t.update=function(e){var l=this;this.requestNamedAnimationFrame(\"LoadProgressBar#update\",function(){var e=l.player_.liveTracker,t=l.player_.buffered(),e=e&&e.isLive()?e.seekableEnd():l.player_.duration(),i=l.player_.bufferedEnd(),n=l.partEls_,e=dn(i,e);l.percent_!==e&&(l.el_.style.width=e,J(l.percentageEl_,e),l.percent_=e);for(var r=0;r<t.length;r++){var a=t.start(r),s=t.end(r),o=n[r];o||(o=l.el_.appendChild($()),n[r]=o),o.dataset.start===a&&o.dataset.end===s||(o.dataset.start=a,o.dataset.end=s,o.style.left=dn(a,i),o.style.width=dn(s-a,i))}for(var u=n.length;u>t.length;u--)l.el_.removeChild(n[u-1]);n.length=t.length})},e}(pt)),pt.registerComponent(\"TimeTooltip\",function(i){function e(e,t){t=i.call(this,e,t)||this;return t.update=We(Ve(ft(t),t.update),30),t}mt(e,i);var t=e.prototype;return t.createEl=function(){return i.prototype.createEl.call(this,\"div\",{className:\"vjs-time-tooltip\"},{\"aria-hidden\":\"true\"})},t.update=function(e,t,i){var n=he(this.el_),r=de(this.player_.el()),a=e.width*t;r&&n&&(t=e.left-r.left+a,r=e.width-a+(r.right-e.right),t<(e=n.width/2)?e+=e-t:r<e&&(e=r),e<0?e=0:e>n.width&&(e=n.width),e=Math.round(e),this.el_.style.right=\"-\"+e+\"px\",this.write(i))},t.write=function(e){J(this.el_,e)},t.updateTime=function(n,r,a,s){var o=this;this.requestNamedAnimationFrame(\"TimeTooltip#updateTime\",function(){var e,t,i=o.player_.duration();i=o.player_.liveTracker&&o.player_.liveTracker.isLive()?((t=(e=o.player_.liveTracker.liveWindow())-r*e)<1?\"\":\"-\")+ln(t,e):ln(a,i),o.update(n,r,i),s&&s()})},e}(pt));Xt=function(i){function e(e,t){t=i.call(this,e,t)||this;return t.update=We(Ve(ft(t),t.update),30),t}mt(e,i);var t=e.prototype;return t.createEl=function(){return i.prototype.createEl.call(this,\"div\",{className:\"vjs-play-progress vjs-slider-bar\"},{\"aria-hidden\":\"true\"})},t.update=function(e,t){var i,n=this.getChild(\"timeTooltip\");n&&(i=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime(),n.updateTime(e,t,i))},e}(pt);Xt.prototype.options_={children:[]},q||A||Xt.prototype.options_.children.push(\"timeTooltip\"),pt.registerComponent(\"PlayProgressBar\",Xt);I=function(i){function e(e,t){t=i.call(this,e,t)||this;return t.update=We(Ve(ft(t),t.update),30),t}mt(e,i);var t=e.prototype;return t.createEl=function(){return i.prototype.createEl.call(this,\"div\",{className:\"vjs-mouse-display\"})},t.update=function(e,t){var i=this,n=t*this.player_.duration();this.getChild(\"timeTooltip\").updateTime(e,t,n,function(){i.el_.style.left=e.width*t+\"px\"})},e}(pt);I.prototype.options_={children:[\"timeTooltip\"]},pt.registerComponent(\"MouseTimeDisplay\",I);Bt=function(a){function e(e,t){t=a.call(this,e,t)||this;return t.setEventHandlers_(),t}mt(e,a);var t=e.prototype;return t.setEventHandlers_=function(){var t=this;this.update_=Ve(this,this.update),this.update=We(this.update_,30),this.on(this.player_,[\"ended\",\"durationchange\",\"timeupdate\"],this.update),this.player_.liveTracker&&this.on(this.player_.liveTracker,\"liveedgechange\",this.update),this.updateInterval=null,this.enableIntervalHandler_=function(e){return t.enableInterval_(e)},this.disableIntervalHandler_=function(e){return t.disableInterval_(e)},this.on(this.player_,[\"playing\"],this.enableIntervalHandler_),this.on(this.player_,[\"ended\",\"pause\",\"waiting\"],this.disableIntervalHandler_),\"hidden\"in document&&\"visibilityState\"in document&&this.on(document,\"visibilitychange\",this.toggleVisibility_)},t.toggleVisibility_=function(e){\"hidden\"===document.visibilityState?(this.cancelNamedAnimationFrame(\"SeekBar#update\"),this.cancelNamedAnimationFrame(\"Slider#update\"),this.disableInterval_(e)):(this.player_.ended()||this.player_.paused()||this.enableInterval_(),this.update())},t.enableInterval_=function(){this.updateInterval||(this.updateInterval=this.setInterval(this.update,30))},t.disableInterval_=function(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&e&&\"ended\"!==e.type||this.updateInterval&&(this.clearInterval(this.updateInterval),this.updateInterval=null)},t.createEl=function(){return a.prototype.createEl.call(this,\"div\",{className:\"vjs-progress-holder\"},{\"aria-label\":this.localize(\"Progress Bar\")})},t.update=function(e){var n=this;if(\"hidden\"!==document.visibilityState){var r=a.prototype.update.call(this);return this.requestNamedAnimationFrame(\"SeekBar#update\",function(){var e=n.player_.ended()?n.player_.duration():n.getCurrentTime_(),t=n.player_.liveTracker,i=n.player_.duration();t&&t.isLive()&&(i=n.player_.liveTracker.liveCurrentTime()),n.percent_!==r&&(n.el_.setAttribute(\"aria-valuenow\",(100*r).toFixed(2)),n.percent_=r),n.currentTime_===e&&n.duration_===i||(n.el_.setAttribute(\"aria-valuetext\",n.localize(\"progress bar timing: currentTime={1} duration={2}\",[ln(e,i),ln(i,i)],\"{1} of {2}\")),n.currentTime_=e,n.duration_=i),n.bar&&n.bar.update(de(n.el()),n.getProgress())}),r}},t.userSeek_=function(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&this.player_.liveTracker.nextSeekedFromUser(),this.player_.currentTime(e)},t.getCurrentTime_=function(){return this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime()},t.getPercent=function(){var e,t=this.getCurrentTime_(),i=this.player_.liveTracker;return i&&i.isLive()?(e=(t-i.seekableStart())/i.liveWindow(),i.atLiveEdge()&&(e=1)):e=t/this.player_.duration(),e},t.handleMouseDown=function(e){_e(e)&&(e.stopPropagation(),this.videoWasPlaying=!this.player_.paused(),this.player_.pause(),a.prototype.handleMouseDown.call(this,e))},t.handleMouseMove=function(e,t){if(void 0===t&&(t=!1),_e(e)){t||this.player_.scrubbing()||this.player_.scrubbing(!0);var i=this.calculateDistance(e),n=this.player_.liveTracker;if(n&&n.isLive()){if(.99<=i)return void n.seekToLiveEdge();var r,t=n.seekableStart(),e=n.liveCurrentTime();if((r=(r=e<=(r=t+i*n.liveWindow())?e:r)<=t?t+.1:r)===1/0)return}else(r=i*this.player_.duration())===this.player_.duration()&&(r-=.1);this.userSeek_(r)}},t.enable=function(){a.prototype.enable.call(this);var e=this.getChild(\"mouseTimeDisplay\");e&&e.show()},t.disable=function(){a.prototype.disable.call(this);var e=this.getChild(\"mouseTimeDisplay\");e&&e.hide()},t.handleMouseUp=function(e){a.prototype.handleMouseUp.call(this,e),e&&e.stopPropagation(),this.player_.scrubbing(!1),this.player_.trigger({type:\"timeupdate\",target:this,manuallyTriggered:!0}),this.videoWasPlaying?Et(this.player_.play()):this.update_()},t.stepForward=function(){this.userSeek_(this.player_.currentTime()+5)},t.stepBack=function(){this.userSeek_(this.player_.currentTime()-5)},t.handleAction=function(e){this.player_.paused()?this.player_.play():this.player_.pause()},t.handleKeyDown=function(e){var t,i=this.player_.liveTracker;ht.isEventKey(e,\"Space\")||ht.isEventKey(e,\"Enter\")?(e.preventDefault(),e.stopPropagation(),this.handleAction(e)):ht.isEventKey(e,\"Home\")?(e.preventDefault(),e.stopPropagation(),this.userSeek_(0)):ht.isEventKey(e,\"End\")?(e.preventDefault(),e.stopPropagation(),i&&i.isLive()?this.userSeek_(i.liveCurrentTime()):this.userSeek_(this.player_.duration())):/^[0-9]$/.test(ht(e))?(e.preventDefault(),e.stopPropagation(),t=10*(ht.codes[ht(e)]-ht.codes[0])/100,i&&i.isLive()?this.userSeek_(i.seekableStart()+i.liveWindow()*t):this.userSeek_(this.player_.duration()*t)):ht.isEventKey(e,\"PgDn\")?(e.preventDefault(),e.stopPropagation(),this.userSeek_(this.player_.currentTime()-60)):ht.isEventKey(e,\"PgUp\")?(e.preventDefault(),e.stopPropagation(),this.userSeek_(this.player_.currentTime()+60)):a.prototype.handleKeyDown.call(this,e)},t.dispose=function(){this.disableInterval_(),this.off(this.player_,[\"ended\",\"durationchange\",\"timeupdate\"],this.update),this.player_.liveTracker&&this.off(this.player_.liveTracker,\"liveedgechange\",this.update),this.off(this.player_,[\"playing\"],this.enableIntervalHandler_),this.off(this.player_,[\"ended\",\"pause\",\"waiting\"],this.disableIntervalHandler_),\"hidden\"in document&&\"visibilityState\"in document&&this.off(document,\"visibilitychange\",this.toggleVisibility_),a.prototype.dispose.call(this)},e}(li);Bt.prototype.options_={children:[\"loadProgressBar\",\"playProgressBar\"],barName:\"playProgressBar\"},q||A||Bt.prototype.options_.children.splice(1,0,\"mouseTimeDisplay\"),pt.registerComponent(\"SeekBar\",Bt);Ft=function(n){function e(e,t){var i=n.call(this,e,t)||this;return i.handleMouseMove=We(Ve(ft(i),i.handleMouseMove),30),i.throttledHandleMouseSeek=We(Ve(ft(i),i.handleMouseSeek),30),i.handleMouseUpHandler_=function(e){return i.handleMouseUp(e)},i.handleMouseDownHandler_=function(e){return i.handleMouseDown(e)},i.enable(),i}mt(e,n);var t=e.prototype;return t.createEl=function(){return n.prototype.createEl.call(this,\"div\",{className:\"vjs-progress-control vjs-control\"})},t.handleMouseMove=function(e){var t,i,n,r,a=this.getChild(\"seekBar\");a&&(t=a.getChild(\"playProgressBar\"),i=a.getChild(\"mouseTimeDisplay\"),(t||i)&&(r=he(n=a.el()),e=pe(n,e).x,e=cn(e,0,1),i&&i.update(r,e),t&&t.update(r,a.getProgress())))},t.handleMouseSeek=function(e){var t=this.getChild(\"seekBar\");t&&t.handleMouseMove(e)},t.enabled=function(){return this.enabled_},t.disable=function(){var e;this.children().forEach(function(e){return e.disable&&e.disable()}),this.enabled()&&(this.off([\"mousedown\",\"touchstart\"],this.handleMouseDownHandler_),this.off(this.el_,\"mousemove\",this.handleMouseMove),this.removeListenersAddedOnMousedownAndTouchstart(),this.addClass(\"disabled\"),this.enabled_=!1,this.player_.scrubbing()&&(e=this.getChild(\"seekBar\"),this.player_.scrubbing(!1),e.videoWasPlaying&&Et(this.player_.play())))},t.enable=function(){this.children().forEach(function(e){return e.enable&&e.enable()}),this.enabled()||(this.on([\"mousedown\",\"touchstart\"],this.handleMouseDownHandler_),this.on(this.el_,\"mousemove\",this.handleMouseMove),this.removeClass(\"disabled\"),this.enabled_=!0)},t.removeListenersAddedOnMousedownAndTouchstart=function(){var e=this.el_.ownerDocument;this.off(e,\"mousemove\",this.throttledHandleMouseSeek),this.off(e,\"touchmove\",this.throttledHandleMouseSeek),this.off(e,\"mouseup\",this.handleMouseUpHandler_),this.off(e,\"touchend\",this.handleMouseUpHandler_)},t.handleMouseDown=function(e){var t=this.el_.ownerDocument,i=this.getChild(\"seekBar\");i&&i.handleMouseDown(e),this.on(t,\"mousemove\",this.throttledHandleMouseSeek),this.on(t,\"touchmove\",this.throttledHandleMouseSeek),this.on(t,\"mouseup\",this.handleMouseUpHandler_),this.on(t,\"touchend\",this.handleMouseUpHandler_)},t.handleMouseUp=function(e){var t=this.getChild(\"seekBar\");t&&t.handleMouseUp(e),this.removeListenersAddedOnMousedownAndTouchstart()},e}(pt);Ft.prototype.options_={children:[\"seekBar\"]},pt.registerComponent(\"ProgressControl\",Ft);jt=function(n){function e(e,t){var i=n.call(this,e,t)||this;return i.on(e,[\"enterpictureinpicture\",\"leavepictureinpicture\"],function(e){return i.handlePictureInPictureChange(e)}),i.on(e,[\"disablepictureinpicturechanged\",\"loadedmetadata\"],function(e){return i.handlePictureInPictureEnabledChange(e)}),i.on(e,[\"loadedmetadata\",\"audioonlymodechange\",\"audiopostermodechange\"],function(){\"audio\"===e.currentType().substring(0,5)||e.audioPosterMode()||e.audioOnlyMode()?(e.isInPictureInPicture()&&e.exitPictureInPicture(),i.hide()):i.show()}),i.disable(),i}mt(e,n);var t=e.prototype;return t.buildCSSClass=function(){return\"vjs-picture-in-picture-control \"+n.prototype.buildCSSClass.call(this)},t.handlePictureInPictureEnabledChange=function(){document.pictureInPictureEnabled&&!1===this.player_.disablePictureInPicture()?this.enable():this.disable()},t.handlePictureInPictureChange=function(e){this.player_.isInPictureInPicture()?this.controlText(\"Exit Picture-in-Picture\"):this.controlText(\"Picture-in-Picture\"),this.handlePictureInPictureEnabledChange()},t.handleClick=function(e){this.player_.isInPictureInPicture()?this.player_.exitPictureInPicture():this.player_.requestPictureInPicture()},e}(sn);jt.prototype.controlText_=\"Picture-in-Picture\",pt.registerComponent(\"PictureInPictureToggle\",jt);j=function(n){function e(e,t){var i=n.call(this,e,t)||this;return i.on(e,\"fullscreenchange\",function(e){return i.handleFullscreenChange(e)}),!1===document[e.fsApi_.fullscreenEnabled]&&i.disable(),i}mt(e,n);var t=e.prototype;return t.buildCSSClass=function(){return\"vjs-fullscreen-control \"+n.prototype.buildCSSClass.call(this)},t.handleFullscreenChange=function(e){this.player_.isFullscreen()?this.controlText(\"Non-Fullscreen\"):this.controlText(\"Fullscreen\")},t.handleClick=function(e){this.player_.isFullscreen()?this.player_.exitFullscreen():this.player_.requestFullscreen()},e}(sn);j.prototype.controlText_=\"Fullscreen\",pt.registerComponent(\"FullscreenToggle\",j);pt.registerComponent(\"VolumeLevel\",function(t){function e(){return t.apply(this,arguments)||this}return mt(e,t),e.prototype.createEl=function(){var e=t.prototype.createEl.call(this,\"div\",{className:\"vjs-volume-level\"});return e.appendChild(t.prototype.createEl.call(this,\"span\",{className:\"vjs-control-text\"})),e},e}(pt)),pt.registerComponent(\"VolumeLevelTooltip\",function(i){function e(e,t){t=i.call(this,e,t)||this;return t.update=We(Ve(ft(t),t.update),30),t}mt(e,i);var t=e.prototype;return t.createEl=function(){return i.prototype.createEl.call(this,\"div\",{className:\"vjs-volume-tooltip\"},{\"aria-hidden\":\"true\"})},t.update=function(e,t,i,n){if(!i){var r=de(this.el_),a=de(this.player_.el()),i=e.width*t;if(!a||!r)return;t=e.left-a.left+i,a=e.width-i+(a.right-e.right),e=r.width/2;t<e?e+=e-t:a<e&&(e=a),e<0?e=0:e>r.width&&(e=r.width),this.el_.style.right=\"-\"+e+\"px\"}this.write(n+\"%\")},t.write=function(e){J(this.el_,e)},t.updateVolume=function(e,t,i,n,r){var a=this;this.requestNamedAnimationFrame(\"VolumeLevelTooltip#updateVolume\",function(){a.update(e,t,i,n.toFixed(0)),r&&r()})},e}(pt));k=function(i){function e(e,t){t=i.call(this,e,t)||this;return t.update=We(Ve(ft(t),t.update),30),t}mt(e,i);var t=e.prototype;return t.createEl=function(){return i.prototype.createEl.call(this,\"div\",{className:\"vjs-mouse-display\"})},t.update=function(e,t,i){var n=this,r=100*t;this.getChild(\"volumeLevelTooltip\").updateVolume(e,t,i,r,function(){i?n.el_.style.bottom=e.height*t+\"px\":n.el_.style.left=e.width*t+\"px\"})},e}(pt);k.prototype.options_={children:[\"volumeLevelTooltip\"]},pt.registerComponent(\"MouseVolumeLevelDisplay\",k);f=function(n){function e(e,t){var i=n.call(this,e,t)||this;return i.on(\"slideractive\",function(e){return i.updateLastVolume_(e)}),i.on(e,\"volumechange\",function(e){return i.updateARIAAttributes(e)}),e.ready(function(){return i.updateARIAAttributes()}),i}mt(e,n);var t=e.prototype;return t.createEl=function(){return n.prototype.createEl.call(this,\"div\",{className:\"vjs-volume-bar vjs-slider-bar\"},{\"aria-label\":this.localize(\"Volume Level\"),\"aria-live\":\"polite\"})},t.handleMouseDown=function(e){_e(e)&&n.prototype.handleMouseDown.call(this,e)},t.handleMouseMove=function(e){var t,i,n,r=this.getChild(\"mouseVolumeLevelDisplay\");r&&(t=de(n=this.el()),i=this.vertical(),n=pe(n,e),n=i?n.y:n.x,n=cn(n,0,1),r.update(t,n,i)),_e(e)&&(this.checkMuted(),this.player_.volume(this.calculateDistance(e)))},t.checkMuted=function(){this.player_.muted()&&this.player_.muted(!1)},t.getPercent=function(){return this.player_.muted()?0:this.player_.volume()},t.stepForward=function(){this.checkMuted(),this.player_.volume(this.player_.volume()+.1)},t.stepBack=function(){this.checkMuted(),this.player_.volume(this.player_.volume()-.1)},t.updateARIAAttributes=function(e){var t=this.player_.muted()?0:this.volumeAsPercentage_();this.el_.setAttribute(\"aria-valuenow\",t),this.el_.setAttribute(\"aria-valuetext\",t+\"%\")},t.volumeAsPercentage_=function(){return Math.round(100*this.player_.volume())},t.updateLastVolume_=function(){var e=this,t=this.player_.volume();this.one(\"sliderinactive\",function(){0===e.player_.volume()&&e.player_.lastVolume_(t)})},e}(li);f.prototype.options_={children:[\"volumeLevel\"],barName:\"volumeLevel\"},q||A||f.prototype.options_.children.splice(0,0,\"mouseVolumeLevelDisplay\"),f.prototype.playerEvent=\"volumechange\",pt.registerComponent(\"VolumeBar\",f);ui=function(a){function e(e,t){var i,n,r;return(t=void 0===t?{}:t).vertical=t.vertical||!1,\"undefined\"!=typeof t.volumeBar&&!S(t.volumeBar)||(t.volumeBar=t.volumeBar||{},t.volumeBar.vertical=t.vertical),i=a.call(this,e,t)||this,n=ft(i),(r=e).tech_&&!r.tech_.featuresVolumeControl&&n.addClass(\"vjs-hidden\"),n.on(r,\"loadstart\",function(){r.tech_.featuresVolumeControl?n.removeClass(\"vjs-hidden\"):n.addClass(\"vjs-hidden\")}),i.throttledHandleMouseMove=We(Ve(ft(i),i.handleMouseMove),30),i.handleMouseUpHandler_=function(e){return i.handleMouseUp(e)},i.on(\"mousedown\",function(e){return i.handleMouseDown(e)}),i.on(\"touchstart\",function(e){return i.handleMouseDown(e)}),i.on(\"mousemove\",function(e){return i.handleMouseMove(e)}),i.on(i.volumeBar,[\"focus\",\"slideractive\"],function(){i.volumeBar.addClass(\"vjs-slider-active\"),i.addClass(\"vjs-slider-active\"),i.trigger(\"slideractive\")}),i.on(i.volumeBar,[\"blur\",\"sliderinactive\"],function(){i.volumeBar.removeClass(\"vjs-slider-active\"),i.removeClass(\"vjs-slider-active\"),i.trigger(\"sliderinactive\")}),i}mt(e,a);var t=e.prototype;return t.createEl=function(){var e=\"vjs-volume-horizontal\";return this.options_.vertical&&(e=\"vjs-volume-vertical\"),a.prototype.createEl.call(this,\"div\",{className:\"vjs-volume-control vjs-control \"+e})},t.handleMouseDown=function(e){var t=this.el_.ownerDocument;this.on(t,\"mousemove\",this.throttledHandleMouseMove),this.on(t,\"touchmove\",this.throttledHandleMouseMove),this.on(t,\"mouseup\",this.handleMouseUpHandler_),this.on(t,\"touchend\",this.handleMouseUpHandler_)},t.handleMouseUp=function(e){var t=this.el_.ownerDocument;this.off(t,\"mousemove\",this.throttledHandleMouseMove),this.off(t,\"touchmove\",this.throttledHandleMouseMove),this.off(t,\"mouseup\",this.handleMouseUpHandler_),this.off(t,\"touchend\",this.handleMouseUpHandler_)},t.handleMouseMove=function(e){this.volumeBar.handleMouseMove(e)},e}(pt);ui.prototype.options_={children:[\"volumeBar\"]},pt.registerComponent(\"VolumeControl\",ui);Xt=function(a){function e(e,t){var i,n,r=a.call(this,e,t)||this;return i=ft(r),(n=e).tech_&&!n.tech_.featuresMuteControl&&i.addClass(\"vjs-hidden\"),i.on(n,\"loadstart\",function(){n.tech_.featuresMuteControl?i.removeClass(\"vjs-hidden\"):i.addClass(\"vjs-hidden\")}),r.on(e,[\"loadstart\",\"volumechange\"],function(e){return r.update(e)}),r}mt(e,a);var t=e.prototype;return t.buildCSSClass=function(){return\"vjs-mute-control \"+a.prototype.buildCSSClass.call(this)},t.handleClick=function(e){var t=this.player_.volume(),i=this.player_.lastVolume_();0===t?(this.player_.volume(i<.1?.1:i),this.player_.muted(!1)):this.player_.muted(!this.player_.muted())},t.update=function(e){this.updateIcon_(),this.updateControlText_()},t.updateIcon_=function(){var e=this.player_.volume(),t=3;q&&this.player_.tech_&&this.player_.tech_.el_&&this.player_.muted(this.player_.tech_.el_.muted),0===e||this.player_.muted()?t=0:e<.33?t=1:e<.67&&(t=2);for(var i=0;i<4;i++)ie(this.el_,\"vjs-vol-\"+i);te(this.el_,\"vjs-vol-\"+t)},t.updateControlText_=function(){var e=this.player_.muted()||0===this.player_.volume()?\"Unmute\":\"Mute\";this.controlText()!==e&&this.controlText(e)},e}(sn);Xt.prototype.controlText_=\"Mute\",pt.registerComponent(\"MuteToggle\",Xt);I=function(n){function e(e,t){var i;return\"undefined\"!=typeof(t=void 0===t?{}:t).inline?t.inline=t.inline:t.inline=!0,\"undefined\"!=typeof t.volumeControl&&!S(t.volumeControl)||(t.volumeControl=t.volumeControl||{},t.volumeControl.vertical=!t.inline),(i=n.call(this,e,t)||this).handleKeyPressHandler_=function(e){return i.handleKeyPress(e)},i.on(e,[\"loadstart\"],function(e){return i.volumePanelState_(e)}),i.on(i.muteToggle,\"keyup\",function(e){return i.handleKeyPress(e)}),i.on(i.volumeControl,\"keyup\",function(e){return i.handleVolumeControlKeyUp(e)}),i.on(\"keydown\",function(e){return i.handleKeyPress(e)}),i.on(\"mouseover\",function(e){return i.handleMouseOver(e)}),i.on(\"mouseout\",function(e){return i.handleMouseOut(e)}),i.on(i.volumeControl,[\"slideractive\"],i.sliderActive_),i.on(i.volumeControl,[\"sliderinactive\"],i.sliderInactive_),i}mt(e,n);var t=e.prototype;return t.sliderActive_=function(){this.addClass(\"vjs-slider-active\")},t.sliderInactive_=function(){this.removeClass(\"vjs-slider-active\")},t.volumePanelState_=function(){this.volumeControl.hasClass(\"vjs-hidden\")&&this.muteToggle.hasClass(\"vjs-hidden\")&&this.addClass(\"vjs-hidden\"),this.volumeControl.hasClass(\"vjs-hidden\")&&!this.muteToggle.hasClass(\"vjs-hidden\")&&this.addClass(\"vjs-mute-toggle-only\")},t.createEl=function(){var e=\"vjs-volume-panel-horizontal\";return this.options_.inline||(e=\"vjs-volume-panel-vertical\"),n.prototype.createEl.call(this,\"div\",{className:\"vjs-volume-panel vjs-control \"+e})},t.dispose=function(){this.handleMouseOut(),n.prototype.dispose.call(this)},t.handleVolumeControlKeyUp=function(e){ht.isEventKey(e,\"Esc\")&&this.muteToggle.focus()},t.handleMouseOver=function(e){this.addClass(\"vjs-hover\"),Be(document,\"keyup\",this.handleKeyPressHandler_)},t.handleMouseOut=function(e){this.removeClass(\"vjs-hover\"),Fe(document,\"keyup\",this.handleKeyPressHandler_)},t.handleKeyPress=function(e){ht.isEventKey(e,\"Esc\")&&this.handleMouseOut()},e}(pt);I.prototype.options_={children:[\"muteToggle\",\"volumeControl\"]},pt.registerComponent(\"VolumePanel\",I);var hn=function(n){function e(e,t){var i=n.call(this,e,t)||this;return t&&(i.menuButton_=t.menuButton),i.focusedChild_=-1,i.on(\"keydown\",function(e){return i.handleKeyDown(e)}),i.boundHandleBlur_=function(e){return i.handleBlur(e)},i.boundHandleTapClick_=function(e){return i.handleTapClick(e)},i}mt(e,n);var t=e.prototype;return t.addEventListenerForItem=function(e){e instanceof pt&&(this.on(e,\"blur\",this.boundHandleBlur_),this.on(e,[\"tap\",\"click\"],this.boundHandleTapClick_))},t.removeEventListenerForItem=function(e){e instanceof pt&&(this.off(e,\"blur\",this.boundHandleBlur_),this.off(e,[\"tap\",\"click\"],this.boundHandleTapClick_))},t.removeChild=function(e){\"string\"==typeof e&&(e=this.getChild(e)),this.removeEventListenerForItem(e),n.prototype.removeChild.call(this,e)},t.addItem=function(e){e=this.addChild(e);e&&this.addEventListenerForItem(e)},t.createEl=function(){var e=this.options_.contentElType||\"ul\";this.contentEl_=$(e,{className:\"vjs-menu-content\"}),this.contentEl_.setAttribute(\"role\",\"menu\");e=n.prototype.createEl.call(this,\"div\",{append:this.contentEl_,className:\"vjs-menu\"});return e.appendChild(this.contentEl_),Be(e,\"click\",function(e){e.preventDefault(),e.stopImmediatePropagation()}),e},t.dispose=function(){this.contentEl_=null,this.boundHandleBlur_=null,this.boundHandleTapClick_=null,n.prototype.dispose.call(this)},t.handleBlur=function(e){var t=e.relatedTarget||document.activeElement;this.children().some(function(e){return e.el()===t})||(e=this.menuButton_)&&e.buttonPressed_&&t!==e.el().firstChild&&e.unpressButton()},t.handleTapClick=function(t){var e;this.menuButton_&&(this.menuButton_.unpressButton(),e=this.children(),!Array.isArray(e)||(e=e.filter(function(e){return e.el()===t.target})[0])&&\"CaptionSettingsMenuItem\"!==e.name()&&this.menuButton_.focus())},t.handleKeyDown=function(e){ht.isEventKey(e,\"Left\")||ht.isEventKey(e,\"Down\")?(e.preventDefault(),e.stopPropagation(),this.stepForward()):(ht.isEventKey(e,\"Right\")||ht.isEventKey(e,\"Up\"))&&(e.preventDefault(),e.stopPropagation(),this.stepBack())},t.stepForward=function(){var e=0;void 0!==this.focusedChild_&&(e=this.focusedChild_+1),this.focus(e)},t.stepBack=function(){var e=0;void 0!==this.focusedChild_&&(e=this.focusedChild_-1),this.focus(e)},t.focus=function(e){void 0===e&&(e=0);var t=this.children().slice();t.length&&t[0].hasClass(\"vjs-menu-title\")&&t.shift(),0<t.length&&(e<0?e=0:e>=t.length&&(e=t.length-1),t[this.focusedChild_=e].el_.focus())},e}(pt);pt.registerComponent(\"Menu\",hn);Bt=function(n){function e(e,t){var i;(i=n.call(this,e,t=void 0===t?{}:t)||this).menuButton_=new sn(e,t),i.menuButton_.controlText(i.controlText_),i.menuButton_.el_.setAttribute(\"aria-haspopup\",\"true\");t=sn.prototype.buildCSSClass();i.menuButton_.el_.className=i.buildCSSClass()+\" \"+t,i.menuButton_.removeClass(\"vjs-control\"),i.addChild(i.menuButton_),i.update(),i.enabled_=!0;t=function(e){return i.handleClick(e)};return i.handleMenuKeyUp_=function(e){return i.handleMenuKeyUp(e)},i.on(i.menuButton_,\"tap\",t),i.on(i.menuButton_,\"click\",t),i.on(i.menuButton_,\"keydown\",function(e){return i.handleKeyDown(e)}),i.on(i.menuButton_,\"mouseenter\",function(){i.addClass(\"vjs-hover\"),i.menu.show(),Be(document,\"keyup\",i.handleMenuKeyUp_)}),i.on(\"mouseleave\",function(e){return i.handleMouseLeave(e)}),i.on(\"keydown\",function(e){return i.handleSubmenuKeyDown(e)}),i}mt(e,n);var t=e.prototype;return t.update=function(){var e=this.createMenu();this.menu&&(this.menu.dispose(),this.removeChild(this.menu)),this.menu=e,this.addChild(e),this.buttonPressed_=!1,this.menuButton_.el_.setAttribute(\"aria-expanded\",\"false\"),this.items&&this.items.length<=this.hideThreshold_?(this.hide(),this.menu.contentEl_.removeAttribute(\"role\")):(this.show(),this.menu.contentEl_.setAttribute(\"role\",\"menu\"))},t.createMenu=function(){var e,t=new hn(this.player_,{menuButton:this});if(this.hideThreshold_=0,this.options_.title&&(e=$(\"li\",{className:\"vjs-menu-title\",textContent:ut(this.options_.title),tabIndex:-1}),e=new pt(this.player_,{el:e}),t.addItem(e)),this.items=this.createItems(),this.items)for(var i=0;i<this.items.length;i++)t.addItem(this.items[i]);return t},t.createItems=function(){},t.createEl=function(){return n.prototype.createEl.call(this,\"div\",{className:this.buildWrapperCSSClass()},{})},t.buildWrapperCSSClass=function(){var e=\"vjs-menu-button\";return!0===this.options_.inline?e+=\"-inline\":e+=\"-popup\",\"vjs-menu-button \"+e+\" \"+sn.prototype.buildCSSClass()+\" \"+n.prototype.buildCSSClass.call(this)},t.buildCSSClass=function(){var e=\"vjs-menu-button\";return!0===this.options_.inline?e+=\"-inline\":e+=\"-popup\",\"vjs-menu-button \"+e+\" \"+n.prototype.buildCSSClass.call(this)},t.controlText=function(e,t){return void 0===t&&(t=this.menuButton_.el()),this.menuButton_.controlText(e,t)},t.dispose=function(){this.handleMouseLeave(),n.prototype.dispose.call(this)},t.handleClick=function(e){this.buttonPressed_?this.unpressButton():this.pressButton()},t.handleMouseLeave=function(e){this.removeClass(\"vjs-hover\"),Fe(document,\"keyup\",this.handleMenuKeyUp_)},t.focus=function(){this.menuButton_.focus()},t.blur=function(){this.menuButton_.blur()},t.handleKeyDown=function(e){ht.isEventKey(e,\"Esc\")||ht.isEventKey(e,\"Tab\")?(this.buttonPressed_&&this.unpressButton(),ht.isEventKey(e,\"Tab\")||(e.preventDefault(),this.menuButton_.focus())):(ht.isEventKey(e,\"Up\")||ht.isEventKey(e,\"Down\"))&&(this.buttonPressed_||(e.preventDefault(),this.pressButton()))},t.handleMenuKeyUp=function(e){(ht.isEventKey(e,\"Esc\")||ht.isEventKey(e,\"Tab\"))&&this.removeClass(\"vjs-hover\")},t.handleSubmenuKeyPress=function(e){this.handleSubmenuKeyDown(e)},t.handleSubmenuKeyDown=function(e){(ht.isEventKey(e,\"Esc\")||ht.isEventKey(e,\"Tab\"))&&(this.buttonPressed_&&this.unpressButton(),ht.isEventKey(e,\"Tab\")||(e.preventDefault(),this.menuButton_.focus()))},t.pressButton=function(){this.enabled_&&(this.buttonPressed_=!0,this.menu.show(),this.menu.lockShowing(),this.menuButton_.el_.setAttribute(\"aria-expanded\",\"true\"),q&&Y()||this.menu.focus())},t.unpressButton=function(){this.enabled_&&(this.buttonPressed_=!1,this.menu.unlockShowing(),this.menu.hide(),this.menuButton_.el_.setAttribute(\"aria-expanded\",\"false\"))},t.disable=function(){this.unpressButton(),this.enabled_=!1,this.addClass(\"vjs-disabled\"),this.menuButton_.disable()},t.enable=function(){this.enabled_=!0,this.removeClass(\"vjs-disabled\"),this.menuButton_.enable()},e}(pt);pt.registerComponent(\"MenuButton\",Bt);Ft=function(r){function e(e,t){var i=t.tracks,t=r.call(this,e,t)||this;if(t.items.length<=1&&t.hide(),!i)return ft(t);var n=Ve(ft(t),t.update);return i.addEventListener(\"removetrack\",n),i.addEventListener(\"addtrack\",n),i.addEventListener(\"labelchange\",n),t.player_.on(\"ready\",n),t.player_.on(\"dispose\",function(){i.removeEventListener(\"removetrack\",n),i.removeEventListener(\"addtrack\",n),i.removeEventListener(\"labelchange\",n)}),t}return mt(e,r),e}(Bt);pt.registerComponent(\"TrackButton\",Ft);var pn=[\"Tab\",\"Esc\",\"Up\",\"Down\",\"Right\",\"Left\"],jt=function(n){function e(e,t){e=n.call(this,e,t)||this;return e.selectable=t.selectable,e.isSelected_=t.selected||!1,e.multiSelectable=t.multiSelectable,e.selected(e.isSelected_),e.selectable?e.multiSelectable?e.el_.setAttribute(\"role\",\"menuitemcheckbox\"):e.el_.setAttribute(\"role\",\"menuitemradio\"):e.el_.setAttribute(\"role\",\"menuitem\"),e}mt(e,n);var t=e.prototype;return t.createEl=function(e,t,i){this.nonIconControl=!0;i=n.prototype.createEl.call(this,\"li\",b({className:\"vjs-menu-item\",tabIndex:-1},t),i);return i.replaceChild($(\"span\",{className:\"vjs-menu-item-text\",textContent:this.localize(this.options_.label)}),i.querySelector(\".vjs-icon-placeholder\")),i},t.handleKeyDown=function(t){pn.some(function(e){return ht.isEventKey(t,e)})||n.prototype.handleKeyDown.call(this,t)},t.handleClick=function(e){this.selected(!0)},t.selected=function(e){this.selectable&&(e?(this.addClass(\"vjs-selected\"),this.el_.setAttribute(\"aria-checked\",\"true\"),this.controlText(\", selected\"),this.isSelected_=!0):(this.removeClass(\"vjs-selected\"),this.el_.setAttribute(\"aria-checked\",\"false\"),this.controlText(\"\"),this.isSelected_=!1))},e}(C);pt.registerComponent(\"MenuItem\",jt);var fn=function(u){function e(e,t){var n,i=t.track,r=e.textTracks();t.label=i.label||i.language||\"Unknown\",t.selected=\"showing\"===i.mode,(n=u.call(this,e,t)||this).track=i,n.kinds=(t.kinds||[t.kind||n.track.kind]).filter(Boolean);function a(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];n.handleTracksChange.apply(ft(n),t)}function s(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];n.handleSelectedLanguageChange.apply(ft(n),t)}var o;return e.on([\"loadstart\",\"texttrackchange\"],a),r.addEventListener(\"change\",a),r.addEventListener(\"selectedlanguagechange\",s),n.on(\"dispose\",function(){e.off([\"loadstart\",\"texttrackchange\"],a),r.removeEventListener(\"change\",a),r.removeEventListener(\"selectedlanguagechange\",s)}),void 0===r.onchange&&n.on([\"tap\",\"click\"],function(){if(\"object\"!=typeof window.Event)try{o=new window.Event(\"change\")}catch(e){}o||(o=document.createEvent(\"Event\")).initEvent(\"change\",!0,!0),r.dispatchEvent(o)}),n.handleTracksChange(),n}mt(e,u);var t=e.prototype;return t.handleClick=function(e){var t=this.track,i=this.player_.textTracks();if(u.prototype.handleClick.call(this,e),i)for(var n=0;n<i.length;n++){var r=i[n];-1!==this.kinds.indexOf(r.kind)&&(r===t?\"showing\"!==r.mode&&(r.mode=\"showing\"):\"disabled\"!==r.mode&&(r.mode=\"disabled\"))}},t.handleTracksChange=function(e){var t=\"showing\"===this.track.mode;t!==this.isSelected_&&this.selected(t)},t.handleSelectedLanguageChange=function(e){var t;\"showing\"===this.track.mode&&((t=this.player_.cache_.selectedLanguage)&&t.enabled&&t.language===this.track.language&&t.kind!==this.track.kind||(this.player_.cache_.selectedLanguage={enabled:!0,language:this.track.language,kind:this.track.kind}))},t.dispose=function(){this.track=null,u.prototype.dispose.call(this)},e}(jt);pt.registerComponent(\"TextTrackMenuItem\",fn);var mn=function(i){function e(e,t){return t.track={player:e,kind:t.kind,kinds:t.kinds,default:!1,mode:\"disabled\"},t.kinds||(t.kinds=[t.kind]),t.label?t.track.label=t.label:t.track.label=t.kinds.join(\" and \")+\" off\",t.selectable=!0,t.multiSelectable=!1,i.call(this,e,t)||this}mt(e,i);var t=e.prototype;return t.handleTracksChange=function(e){for(var t=this.player().textTracks(),i=!0,n=0,r=t.length;n<r;n++){var a=t[n];if(-1<this.options_.kinds.indexOf(a.kind)&&\"showing\"===a.mode){i=!1;break}}i!==this.isSelected_&&this.selected(i)},t.handleSelectedLanguageChange=function(e){for(var t=this.player().textTracks(),i=!0,n=0,r=t.length;n<r;n++){var a=t[n];if(-1<[\"captions\",\"descriptions\",\"subtitles\"].indexOf(a.kind)&&\"showing\"===a.mode){i=!1;break}}i&&(this.player_.cache_.selectedLanguage={enabled:!1})},e}(fn);pt.registerComponent(\"OffTextTrackMenuItem\",mn);j=function(i){function e(e,t){return(t=void 0===t?{}:t).tracks=e.textTracks(),i.call(this,e,t)||this}return mt(e,i),e.prototype.createItems=function(e,t){var i;void 0===t&&(t=fn),this.label_&&(i=this.label_+\" off\"),(e=void 0===e?[]:e).push(new mn(this.player_,{kinds:this.kinds_,kind:this.kind_,label:i})),this.hideThreshold_+=1;var n=this.player_.textTracks();Array.isArray(this.kinds_)||(this.kinds_=[this.kind_]);for(var r=0;r<n.length;r++){var a,s=n[r];-1<this.kinds_.indexOf(s.kind)&&((a=new t(this.player_,{track:s,kinds:this.kinds_,kind:this.kind_,selectable:!0,multiSelectable:!1})).addClass(\"vjs-\"+s.kind+\"-menu-item\"),e.push(a))}return e},e}(Ft);pt.registerComponent(\"TextTrackButton\",j);var gn=function(a){function e(e,t){var i=t.track,n=t.cue,r=e.currentTime();return t.selectable=!0,t.multiSelectable=!1,t.label=n.text,t.selected=n.startTime<=r&&r<n.endTime,(t=a.call(this,e,t)||this).track=i,t.cue=n,t}return mt(e,a),e.prototype.handleClick=function(e){a.prototype.handleClick.call(this),this.player_.currentTime(this.cue.startTime)},e}(jt);pt.registerComponent(\"ChaptersTrackMenuItem\",gn);k=function(r){function e(e,t,i){var n=r.call(this,e,t,i)||this;return n.selectCurrentItem_=function(){n.items.forEach(function(e){e.selected(n.track_.activeCues[0]===e.cue)})},n}mt(e,r);var t=e.prototype;return t.buildCSSClass=function(){return\"vjs-chapters-button \"+r.prototype.buildCSSClass.call(this)},t.buildWrapperCSSClass=function(){return\"vjs-chapters-button \"+r.prototype.buildWrapperCSSClass.call(this)},t.update=function(e){e&&e.track&&\"chapters\"!==e.track.kind||((e=this.findChaptersTrack())!==this.track_?(this.setTrack(e),r.prototype.update.call(this)):(!this.items||e&&e.cues&&e.cues.length!==this.items.length)&&r.prototype.update.call(this))},t.setTrack=function(e){var t;this.track_!==e&&(this.updateHandler_||(this.updateHandler_=this.update.bind(this)),this.track_&&((t=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_))&&t.removeEventListener(\"load\",this.updateHandler_),this.track_.removeEventListener(\"cuechange\",this.selectCurrentItem_),this.track_=null),this.track_=e,this.track_&&(this.track_.mode=\"hidden\",(e=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_))&&e.addEventListener(\"load\",this.updateHandler_),this.track_.addEventListener(\"cuechange\",this.selectCurrentItem_)))},t.findChaptersTrack=function(){for(var e=this.player_.textTracks()||[],t=e.length-1;0<=t;t--){var i=e[t];if(i.kind===this.kind_)return i}},t.getMenuCaption=function(){return this.track_&&this.track_.label?this.track_.label:this.localize(ut(this.kind_))},t.createMenu=function(){return this.options_.title=this.getMenuCaption(),r.prototype.createMenu.call(this)},t.createItems=function(){var e=[];if(!this.track_)return e;var t=this.track_.cues;if(!t)return e;for(var i=0,n=t.length;i<n;i++){var r=t[i],r=new gn(this.player_,{track:this.track_,cue:r});e.push(r)}return e},e}(j);k.prototype.kind_=\"chapters\",k.prototype.controlText_=\"Chapters\",pt.registerComponent(\"ChaptersButton\",k);li=function(a){function e(e,t,i){var i=a.call(this,e,t,i)||this,n=e.textTracks(),r=Ve(ft(i),i.handleTracksChange);return n.addEventListener(\"change\",r),i.on(\"dispose\",function(){n.removeEventListener(\"change\",r)}),i}mt(e,a);var t=e.prototype;return t.handleTracksChange=function(e){for(var t=this.player().textTracks(),i=!1,n=0,r=t.length;n<r;n++){var a=t[n];if(a.kind!==this.kind_&&\"showing\"===a.mode){i=!0;break}}i?this.disable():this.enable()},t.buildCSSClass=function(){return\"vjs-descriptions-button \"+a.prototype.buildCSSClass.call(this)},t.buildWrapperCSSClass=function(){return\"vjs-descriptions-button \"+a.prototype.buildWrapperCSSClass.call(this)},e}(j);li.prototype.kind_=\"descriptions\",li.prototype.controlText_=\"Descriptions\",pt.registerComponent(\"DescriptionsButton\",li);f=function(n){function e(e,t,i){return n.call(this,e,t,i)||this}mt(e,n);var t=e.prototype;return t.buildCSSClass=function(){return\"vjs-subtitles-button \"+n.prototype.buildCSSClass.call(this)},t.buildWrapperCSSClass=function(){return\"vjs-subtitles-button \"+n.prototype.buildWrapperCSSClass.call(this)},e}(j);f.prototype.kind_=\"subtitles\",f.prototype.controlText_=\"Subtitles\",pt.registerComponent(\"SubtitlesButton\",f);var yn=function(i){function e(e,t){return t.track={player:e,kind:t.kind,label:t.kind+\" settings\",selectable:!1,default:!1,mode:\"disabled\"},t.selectable=!1,t.name=\"CaptionSettingsMenuItem\",(e=i.call(this,e,t)||this).addClass(\"vjs-texttrack-settings\"),e.controlText(\", opens \"+t.kind+\" settings dialog\"),e}return mt(e,i),e.prototype.handleClick=function(e){this.player().getChild(\"textTrackSettings\").open()},e}(fn);pt.registerComponent(\"CaptionSettingsMenuItem\",yn);ui=function(n){function e(e,t,i){return n.call(this,e,t,i)||this}mt(e,n);var t=e.prototype;return t.buildCSSClass=function(){return\"vjs-captions-button \"+n.prototype.buildCSSClass.call(this)},t.buildWrapperCSSClass=function(){return\"vjs-captions-button \"+n.prototype.buildWrapperCSSClass.call(this)},t.createItems=function(){var e=[];return this.player().tech_&&this.player().tech_.featuresNativeTextTracks||!this.player().getChild(\"textTrackSettings\")||(e.push(new yn(this.player_,{kind:this.kind_})),this.hideThreshold_+=1),n.prototype.createItems.call(this,e)},e}(j);ui.prototype.kind_=\"captions\",ui.prototype.controlText_=\"Captions\",pt.registerComponent(\"CaptionsButton\",ui);var vn=function(n){function e(){return n.apply(this,arguments)||this}return mt(e,n),e.prototype.createEl=function(e,t,i){t=n.prototype.createEl.call(this,e,t,i),i=t.querySelector(\".vjs-menu-item-text\");return\"captions\"===this.options_.track.kind&&(i.appendChild($(\"span\",{className:\"vjs-icon-placeholder\"},{\"aria-hidden\":!0})),i.appendChild($(\"span\",{className:\"vjs-control-text\",textContent:\" \"+this.localize(\"Captions\")}))),t},e}(fn);pt.registerComponent(\"SubsCapsMenuItem\",vn);Xt=function(i){function e(e,t){return(t=i.call(this,e,t=void 0===t?{}:t)||this).label_=\"subtitles\",-1<[\"en\",\"en-us\",\"en-ca\",\"fr-ca\"].indexOf(t.player_.language_)&&(t.label_=\"captions\"),t.menuButton_.controlText(ut(t.label_)),t}mt(e,i);var t=e.prototype;return t.buildCSSClass=function(){return\"vjs-subs-caps-button \"+i.prototype.buildCSSClass.call(this)},t.buildWrapperCSSClass=function(){return\"vjs-subs-caps-button \"+i.prototype.buildWrapperCSSClass.call(this)},t.createItems=function(){var e=[];return this.player().tech_&&this.player().tech_.featuresNativeTextTracks||!this.player().getChild(\"textTrackSettings\")||(e.push(new yn(this.player_,{kind:this.label_})),this.hideThreshold_+=1),e=i.prototype.createItems.call(this,e,vn)},e}(j);Xt.prototype.kinds_=[\"captions\",\"subtitles\"],Xt.prototype.controlText_=\"Subtitles\",pt.registerComponent(\"SubsCapsButton\",Xt);var _n=function(s){function e(e,t){var n,i=t.track,r=e.audioTracks();t.label=i.label||i.language||\"Unknown\",t.selected=i.enabled,(n=s.call(this,e,t)||this).track=i,n.addClass(\"vjs-\"+i.kind+\"-menu-item\");function a(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];n.handleTracksChange.apply(ft(n),t)}return r.addEventListener(\"change\",a),n.on(\"dispose\",function(){r.removeEventListener(\"change\",a)}),n}mt(e,s);var t=e.prototype;return t.createEl=function(e,t,i){t=s.prototype.createEl.call(this,e,t,i),i=t.querySelector(\".vjs-menu-item-text\");return\"main-desc\"===this.options_.track.kind&&(i.appendChild($(\"span\",{className:\"vjs-icon-placeholder\"},{\"aria-hidden\":!0})),i.appendChild($(\"span\",{className:\"vjs-control-text\",textContent:\" \"+this.localize(\"Descriptions\")}))),t},t.handleClick=function(e){if(s.prototype.handleClick.call(this,e),this.track.enabled=!0,this.player_.tech_.featuresNativeAudioTracks)for(var t=this.player_.audioTracks(),i=0;i<t.length;i++){var n=t[i];n!==this.track&&(n.enabled=n===this.track)}},t.handleTracksChange=function(e){this.selected(this.track.enabled)},e}(jt);pt.registerComponent(\"AudioTrackMenuItem\",_n);I=function(i){function e(e,t){return(t=void 0===t?{}:t).tracks=e.audioTracks(),i.call(this,e,t)||this}mt(e,i);var t=e.prototype;return t.buildCSSClass=function(){return\"vjs-audio-button \"+i.prototype.buildCSSClass.call(this)},t.buildWrapperCSSClass=function(){return\"vjs-audio-button \"+i.prototype.buildWrapperCSSClass.call(this)},t.createItems=function(e){void 0===e&&(e=[]),this.hideThreshold_=1;for(var t=this.player_.audioTracks(),i=0;i<t.length;i++){var n=t[i];e.push(new _n(this.player_,{track:n,selectable:!0,multiSelectable:!1}))}return e},e}(Ft);I.prototype.controlText_=\"Audio Track\",pt.registerComponent(\"AudioTrackButton\",I);var bn=function(a){function e(e,t){var i,n=t.rate,r=parseFloat(n,10);return t.label=n,t.selected=r===e.playbackRate(),t.selectable=!0,t.multiSelectable=!1,(i=a.call(this,e,t)||this).label=n,i.rate=r,i.on(e,\"ratechange\",function(e){return i.update(e)}),i}mt(e,a);var t=e.prototype;return t.handleClick=function(e){a.prototype.handleClick.call(this),this.player().playbackRate(this.rate)},t.update=function(e){this.selected(this.player().playbackRate()===this.rate)},e}(jt);bn.prototype.contentElType=\"button\",pt.registerComponent(\"PlaybackRateMenuItem\",bn);C=function(n){function e(e,t){var i=n.call(this,e,t)||this;return i.menuButton_.el_.setAttribute(\"aria-describedby\",i.labelElId_),i.updateVisibility(),i.updateLabel(),i.on(e,\"loadstart\",function(e){return i.updateVisibility(e)}),i.on(e,\"ratechange\",function(e){return i.updateLabel(e)}),i.on(e,\"playbackrateschange\",function(e){return i.handlePlaybackRateschange(e)}),i}mt(e,n);var t=e.prototype;return t.createEl=function(){var e=n.prototype.createEl.call(this);return this.labelElId_=\"vjs-playback-rate-value-label-\"+this.id_,this.labelEl_=$(\"div\",{className:\"vjs-playback-rate-value\",id:this.labelElId_,textContent:\"1x\"}),e.appendChild(this.labelEl_),e},t.dispose=function(){this.labelEl_=null,n.prototype.dispose.call(this)},t.buildCSSClass=function(){return\"vjs-playback-rate \"+n.prototype.buildCSSClass.call(this)},t.buildWrapperCSSClass=function(){return\"vjs-playback-rate \"+n.prototype.buildWrapperCSSClass.call(this)},t.createItems=function(){for(var e=this.playbackRates(),t=[],i=e.length-1;0<=i;i--)t.push(new bn(this.player(),{rate:e[i]+\"x\"}));return t},t.updateARIAAttributes=function(){this.el().setAttribute(\"aria-valuenow\",this.player().playbackRate())},t.handleClick=function(e){var t=this.player().playbackRate(),i=this.playbackRates(),t=(i.indexOf(t)+1)%i.length;this.player().playbackRate(i[t])},t.handlePlaybackRateschange=function(e){this.update()},t.playbackRates=function(){var e=this.player();return e.playbackRates&&e.playbackRates()||[]},t.playbackRateSupported=function(){return this.player().tech_&&this.player().tech_.featuresPlaybackRate&&this.playbackRates()&&0<this.playbackRates().length},t.updateVisibility=function(e){this.playbackRateSupported()?this.removeClass(\"vjs-hidden\"):this.addClass(\"vjs-hidden\")},t.updateLabel=function(e){this.playbackRateSupported()&&(this.labelEl_.textContent=this.player().playbackRate()+\"x\")},e}(Bt);C.prototype.controlText_=\"Playback Rate\",pt.registerComponent(\"PlaybackRateMenuButton\",C);k=function(n){function e(){return n.apply(this,arguments)||this}mt(e,n);var t=e.prototype;return t.buildCSSClass=function(){return\"vjs-spacer \"+n.prototype.buildCSSClass.call(this)},t.createEl=function(e,t,i){return void 0===e&&(e=\"div\"),void 0===i&&(i={}),(t=void 0===t?{}:t).className||(t.className=this.buildCSSClass()),n.prototype.createEl.call(this,e,t,i)},e}(pt);pt.registerComponent(\"Spacer\",k),pt.registerComponent(\"CustomControlSpacer\",function(e){function t(){return e.apply(this,arguments)||this}mt(t,e);var i=t.prototype;return i.buildCSSClass=function(){return\"vjs-custom-control-spacer \"+e.prototype.buildCSSClass.call(this)},i.createEl=function(){return e.prototype.createEl.call(this,\"div\",{className:this.buildCSSClass(),textContent:\"\u00a0\"})},t}(k));li=function(e){function t(){return e.apply(this,arguments)||this}return mt(t,e),t.prototype.createEl=function(){return e.prototype.createEl.call(this,\"div\",{className:\"vjs-control-bar\",dir:\"ltr\"})},t}(pt);li.prototype.options_={children:[\"playToggle\",\"volumePanel\",\"currentTimeDisplay\",\"timeDivider\",\"durationDisplay\",\"progressControl\",\"liveDisplay\",\"seekToLive\",\"remainingTimeDisplay\",\"customControlSpacer\",\"playbackRateMenuButton\",\"chaptersButton\",\"descriptionsButton\",\"subsCapsButton\",\"audioTrackButton\",\"fullscreenToggle\"]},\"exitPictureInPicture\"in document&&li.prototype.options_.children.splice(li.prototype.options_.children.length-1,0,\"pictureInPictureToggle\"),pt.registerComponent(\"ControlBar\",li);f=function(n){function e(e,t){var i=n.call(this,e,t)||this;return i.on(e,\"error\",function(e){return i.open(e)}),i}mt(e,n);var t=e.prototype;return t.buildCSSClass=function(){return\"vjs-error-display \"+n.prototype.buildCSSClass.call(this)},t.content=function(){var e=this.player().error();return e?this.localize(e.message):\"\"},e}(At);f.prototype.options_=g({},At.prototype.options_,{pauseOnOpen:!1,fillAlways:!0,temporary:!1,uncloseable:!0}),pt.registerComponent(\"ErrorDisplay\",f);var Tn=\"vjs-text-track-settings\",ui=[\"#000\",\"Black\"],j=[\"#00F\",\"Blue\"],Xt=[\"#0FF\",\"Cyan\"],Ft=[\"#0F0\",\"Green\"],I=[\"#F0F\",\"Magenta\"],jt=[\"#F00\",\"Red\"],Bt=[\"#FFF\",\"White\"],C=[\"#FF0\",\"Yellow\"],k=[\"1\",\"Opaque\"],li=[\"0.5\",\"Semi-Transparent\"],f=[\"0\",\"Transparent\"],Sn={backgroundColor:{selector:\".vjs-bg-color > select\",id:\"captions-background-color-%s\",label:\"Color\",options:[ui,Bt,jt,Ft,j,C,I,Xt]},backgroundOpacity:{selector:\".vjs-bg-opacity > select\",id:\"captions-background-opacity-%s\",label:\"Transparency\",options:[k,li,f]},color:{selector:\".vjs-fg-color > select\",id:\"captions-foreground-color-%s\",label:\"Color\",options:[Bt,ui,jt,Ft,j,C,I,Xt]},edgeStyle:{selector:\".vjs-edge-style > select\",id:\"%s\",label:\"Text Edge Style\",options:[[\"none\",\"None\"],[\"raised\",\"Raised\"],[\"depressed\",\"Depressed\"],[\"uniform\",\"Uniform\"],[\"dropshadow\",\"Dropshadow\"]]},fontFamily:{selector:\".vjs-font-family > select\",id:\"captions-font-family-%s\",label:\"Font Family\",options:[[\"proportionalSansSerif\",\"Proportional Sans-Serif\"],[\"monospaceSansSerif\",\"Monospace Sans-Serif\"],[\"proportionalSerif\",\"Proportional Serif\"],[\"monospaceSerif\",\"Monospace Serif\"],[\"casual\",\"Casual\"],[\"script\",\"Script\"],[\"small-caps\",\"Small Caps\"]]},fontPercent:{selector:\".vjs-font-percent > select\",id:\"captions-font-size-%s\",label:\"Font Size\",options:[[\"0.50\",\"50%\"],[\"0.75\",\"75%\"],[\"1.00\",\"100%\"],[\"1.25\",\"125%\"],[\"1.50\",\"150%\"],[\"1.75\",\"175%\"],[\"2.00\",\"200%\"],[\"3.00\",\"300%\"],[\"4.00\",\"400%\"]],default:2,parser:function(e){return\"1.00\"===e?null:Number(e)}},textOpacity:{selector:\".vjs-text-opacity > select\",id:\"captions-foreground-opacity-%s\",label:\"Transparency\",options:[k,li]},windowColor:{selector:\".vjs-window-color > select\",id:\"captions-window-color-%s\",label:\"Color\"},windowOpacity:{selector:\".vjs-window-opacity > select\",id:\"captions-window-opacity-%s\",label:\"Transparency\",options:[f,li,k]}};function wn(e,t){if((e=t?t(e):e)&&\"none\"!==e)return e}Sn.windowColor.options=Sn.backgroundColor.options,pt.registerComponent(\"TextTrackSettings\",function(n){function e(e,t){var i;return t.temporary=!1,(i=n.call(this,e,t)||this).updateDisplay=i.updateDisplay.bind(ft(i)),i.fill(),i.hasBeenOpened_=i.hasBeenFilled_=!0,i.endDialog=$(\"p\",{className:\"vjs-control-text\",textContent:i.localize(\"End of dialog window.\")}),i.el().appendChild(i.endDialog),i.setDefaults(),void 0===t.persistTextTrackSettings&&(i.options_.persistTextTrackSettings=i.options_.playerOptions.persistTextTrackSettings),i.on(i.$(\".vjs-done-button\"),\"click\",function(){i.saveSettings(),i.close()}),i.on(i.$(\".vjs-default-button\"),\"click\",function(){i.setDefaults(),i.updateDisplay()}),_(Sn,function(e){i.on(i.$(e.selector),\"change\",i.updateDisplay)}),i.options_.persistTextTrackSettings&&i.restoreSettings(),i}mt(e,n);var t=e.prototype;return t.dispose=function(){this.endDialog=null,n.prototype.dispose.call(this)},t.createElSelect_=function(e,t,i){var n=this;void 0===t&&(t=\"\"),void 0===i&&(i=\"label\");var e=Sn[e],r=e.id.replace(\"%s\",this.id_),a=[t,r].join(\" \").trim();return[\"<\"+i+' id=\"'+r+'\" class=\"'+(\"label\"===i?\"vjs-label\":\"\")+'\">',this.localize(e.label),\"</\"+i+\">\",'<select aria-labelledby=\"'+a+'\">'].concat(e.options.map(function(e){var t=r+\"-\"+e[1].replace(/\\W+/g,\"\");return['<option id=\"'+t+'\" value=\"'+e[0]+'\" ','aria-labelledby=\"'+a+\" \"+t+'\">',n.localize(e[1]),\"</option>\"].join(\"\")})).concat(\"</select>\").join(\"\")},t.createElFgColor_=function(){var e=\"captions-text-legend-\"+this.id_;return['<fieldset class=\"vjs-fg-color vjs-track-setting\">','<legend id=\"'+e+'\">',this.localize(\"Text\"),\"</legend>\",this.createElSelect_(\"color\",e),'<span class=\"vjs-text-opacity vjs-opacity\">',this.createElSelect_(\"textOpacity\",e),\"</span>\",\"</fieldset>\"].join(\"\")},t.createElBgColor_=function(){var e=\"captions-background-\"+this.id_;return['<fieldset class=\"vjs-bg-color vjs-track-setting\">','<legend id=\"'+e+'\">',this.localize(\"Background\"),\"</legend>\",this.createElSelect_(\"backgroundColor\",e),'<span class=\"vjs-bg-opacity vjs-opacity\">',this.createElSelect_(\"backgroundOpacity\",e),\"</span>\",\"</fieldset>\"].join(\"\")},t.createElWinColor_=function(){var e=\"captions-window-\"+this.id_;return['<fieldset class=\"vjs-window-color vjs-track-setting\">','<legend id=\"'+e+'\">',this.localize(\"Window\"),\"</legend>\",this.createElSelect_(\"windowColor\",e),'<span class=\"vjs-window-opacity vjs-opacity\">',this.createElSelect_(\"windowOpacity\",e),\"</span>\",\"</fieldset>\"].join(\"\")},t.createElColors_=function(){return $(\"div\",{className:\"vjs-track-settings-colors\",innerHTML:[this.createElFgColor_(),this.createElBgColor_(),this.createElWinColor_()].join(\"\")})},t.createElFont_=function(){return $(\"div\",{className:\"vjs-track-settings-font\",innerHTML:['<fieldset class=\"vjs-font-percent vjs-track-setting\">',this.createElSelect_(\"fontPercent\",\"\",\"legend\"),\"</fieldset>\",'<fieldset class=\"vjs-edge-style vjs-track-setting\">',this.createElSelect_(\"edgeStyle\",\"\",\"legend\"),\"</fieldset>\",'<fieldset class=\"vjs-font-family vjs-track-setting\">',this.createElSelect_(\"fontFamily\",\"\",\"legend\"),\"</fieldset>\"].join(\"\")})},t.createElControls_=function(){var e=this.localize(\"restore all settings to the default values\");return $(\"div\",{className:\"vjs-track-settings-controls\",innerHTML:['<button type=\"button\" class=\"vjs-default-button\" title=\"'+e+'\">',this.localize(\"Reset\"),'<span class=\"vjs-control-text\"> '+e+\"</span>\",\"</button>\",'<button type=\"button\" class=\"vjs-done-button\">'+this.localize(\"Done\")+\"</button>\"].join(\"\")})},t.content=function(){return[this.createElColors_(),this.createElFont_(),this.createElControls_()]},t.label=function(){return this.localize(\"Caption Settings Dialog\")},t.description=function(){return this.localize(\"Beginning of dialog window. Escape will cancel and close the window.\")},t.buildCSSClass=function(){return n.prototype.buildCSSClass.call(this)+\" vjs-text-track-settings\"},t.getValues=function(){var i,n,e,r=this;return n=function(e,t,i){var n,t=(n=r.$(t.selector),t=t.parser,wn(n.options[n.options.selectedIndex].value,t));return void 0!==t&&(e[i]=t),e},void 0===(e={})&&(e=0),v(i=Sn).reduce(function(e,t){return n(e,i[t],t)},e)},t.setValues=function(i){var n=this;_(Sn,function(e,t){!function(e,t,i){if(t)for(var n=0;n<e.options.length;n++)if(wn(e.options[n].value,i)===t){e.selectedIndex=n;break}}(n.$(e.selector),i[t],e.parser)})},t.setDefaults=function(){var i=this;_(Sn,function(e){var t=e.hasOwnProperty(\"default\")?e.default:0;i.$(e.selector).selectedIndex=t})},t.restoreSettings=function(){var e;try{e=JSON.parse(window.localStorage.getItem(Tn))}catch(e){h.warn(e)}e&&this.setValues(e)},t.saveSettings=function(){if(this.options_.persistTextTrackSettings){var e=this.getValues();try{Object.keys(e).length?window.localStorage.setItem(Tn,JSON.stringify(e)):window.localStorage.removeItem(Tn)}catch(e){h.warn(e)}}},t.updateDisplay=function(){var e=this.player_.getChild(\"textTrackDisplay\");e&&e.updateDisplay()},t.conditionalBlur_=function(){this.previouslyActiveEl_=null;var e=this.player_.controlBar,t=e&&e.subsCapsButton,e=e&&e.captionsButton;t?t.focus():e&&e.focus()},e}(At)),pt.registerComponent(\"ResizeManager\",function(a){function e(e,t){var i,n=t.ResizeObserver||window.ResizeObserver,r=lt({createEl:!(n=null===t.ResizeObserver?!1:n),reportTouchActivity:!1},t);return(i=a.call(this,e,r)||this).ResizeObserver=t.ResizeObserver||window.ResizeObserver,i.loadListener_=null,i.resizeObserver_=null,i.debouncedHandler_=Ge(function(){i.resizeHandler()},100,!1,ft(i)),n?(i.resizeObserver_=new i.ResizeObserver(i.debouncedHandler_),i.resizeObserver_.observe(e.el())):(i.loadListener_=function(){var e,t;i.el_&&i.el_.contentWindow&&(e=i.debouncedHandler_,t=i.unloadListener_=function(){Fe(this,\"resize\",e),Fe(this,\"unload\",t),t=null},Be(i.el_.contentWindow,\"unload\",t),Be(i.el_.contentWindow,\"resize\",e))},i.one(\"load\",i.loadListener_)),i}mt(e,a);var t=e.prototype;return t.createEl=function(){return a.prototype.createEl.call(this,\"iframe\",{className:\"vjs-resize-manager\",tabIndex:-1,title:this.localize(\"No content\")},{\"aria-hidden\":\"true\"})},t.resizeHandler=function(){this.player_&&this.player_.trigger&&this.player_.trigger(\"playerresize\")},t.dispose=function(){this.debouncedHandler_&&this.debouncedHandler_.cancel(),this.resizeObserver_&&(this.player_.el()&&this.resizeObserver_.unobserve(this.player_.el()),this.resizeObserver_.disconnect()),this.loadListener_&&this.off(\"load\",this.loadListener_),this.el_&&this.el_.contentWindow&&this.unloadListener_&&this.unloadListener_.call(this.el_.contentWindow),this.ResizeObserver=null,this.resizeObserver=null,this.debouncedHandler_=null,this.loadListener_=null,a.prototype.dispose.call(this)},e}(pt));var En={trackingThreshold:20,liveTolerance:15};pt.registerComponent(\"LiveTracker\",function(n){function e(e,t){var t=lt(En,t,{createEl:!1}),i=n.call(this,e,t)||this;return i.handleVisibilityChange_=function(e){return i.handleVisibilityChange(e)},i.trackLiveHandler_=function(){return i.trackLive_()},i.handlePlay_=function(e){return i.handlePlay(e)},i.handleFirstTimeupdate_=function(e){return i.handleFirstTimeupdate(e)},i.handleSeeked_=function(e){return i.handleSeeked(e)},i.seekToLiveEdge_=function(e){return i.seekToLiveEdge(e)},i.reset_(),i.on(i.player_,\"durationchange\",function(e){return i.handleDurationchange(e)}),i.on(i.player_,\"canplay\",function(){return i.toggleTracking()}),N&&\"hidden\"in document&&\"visibilityState\"in document&&i.on(document,\"visibilitychange\",i.handleVisibilityChange_),i}mt(e,n);var t=e.prototype;return t.handleVisibilityChange=function(){this.player_.duration()===1/0&&(document.hidden?this.stopTracking():this.startTracking())},t.trackLive_=function(){var e,t=this.player_.seekable();t&&t.length&&(e=Number(window.performance.now().toFixed(4)),t=-1===this.lastTime_?0:(e-this.lastTime_)/1e3,this.lastTime_=e,this.pastSeekEnd_=this.pastSeekEnd()+t,e=this.liveCurrentTime(),t=this.player_.currentTime(),t=this.player_.paused()||this.seekedBehindLive_||Math.abs(e-t)>this.options_.liveTolerance,(t=!this.timeupdateSeen_||e===1/0?!1:t)!==this.behindLiveEdge_&&(this.behindLiveEdge_=t,this.trigger(\"liveedgechange\")))},t.handleDurationchange=function(){this.toggleTracking()},t.toggleTracking=function(){this.player_.duration()===1/0&&this.liveWindow()>=this.options_.trackingThreshold?(this.player_.options_.liveui&&this.player_.addClass(\"vjs-liveui\"),this.startTracking()):(this.player_.removeClass(\"vjs-liveui\"),this.stopTracking())},t.startTracking=function(){this.isTracking()||(this.timeupdateSeen_||(this.timeupdateSeen_=this.player_.hasStarted()),this.trackingInterval_=this.setInterval(this.trackLiveHandler_,30),this.trackLive_(),this.on(this.player_,[\"play\",\"pause\"],this.trackLiveHandler_),this.timeupdateSeen_?this.on(this.player_,\"seeked\",this.handleSeeked_):(this.one(this.player_,\"play\",this.handlePlay_),this.one(this.player_,\"timeupdate\",this.handleFirstTimeupdate_)))},t.handleFirstTimeupdate=function(){this.timeupdateSeen_=!0,this.on(this.player_,\"seeked\",this.handleSeeked_)},t.handleSeeked=function(){var e=Math.abs(this.liveCurrentTime()-this.player_.currentTime());this.seekedBehindLive_=this.nextSeekedFromUser_&&2<e,this.nextSeekedFromUser_=!1,this.trackLive_()},t.handlePlay=function(){this.one(this.player_,\"timeupdate\",this.seekToLiveEdge_)},t.reset_=function(){this.lastTime_=-1,this.pastSeekEnd_=0,this.lastSeekEnd_=-1,this.behindLiveEdge_=!0,this.timeupdateSeen_=!1,this.seekedBehindLive_=!1,this.nextSeekedFromUser_=!1,this.clearInterval(this.trackingInterval_),this.trackingInterval_=null,this.off(this.player_,[\"play\",\"pause\"],this.trackLiveHandler_),this.off(this.player_,\"seeked\",this.handleSeeked_),this.off(this.player_,\"play\",this.handlePlay_),this.off(this.player_,\"timeupdate\",this.handleFirstTimeupdate_),this.off(this.player_,\"timeupdate\",this.seekToLiveEdge_)},t.nextSeekedFromUser=function(){this.nextSeekedFromUser_=!0},t.stopTracking=function(){this.isTracking()&&(this.reset_(),this.trigger(\"liveedgechange\"))},t.seekableEnd=function(){for(var e=this.player_.seekable(),t=[],i=e?e.length:0;i--;)t.push(e.end(i));return t.length?t.sort()[t.length-1]:1/0},t.seekableStart=function(){for(var e=this.player_.seekable(),t=[],i=e?e.length:0;i--;)t.push(e.start(i));return t.length?t.sort()[0]:0},t.liveWindow=function(){var e=this.liveCurrentTime();return e===1/0?0:e-this.seekableStart()},t.isLive=function(){return this.isTracking()},t.atLiveEdge=function(){return!this.behindLiveEdge()},t.liveCurrentTime=function(){return this.pastSeekEnd()+this.seekableEnd()},t.pastSeekEnd=function(){var e=this.seekableEnd();return-1!==this.lastSeekEnd_&&e!==this.lastSeekEnd_&&(this.pastSeekEnd_=0),this.lastSeekEnd_=e,this.pastSeekEnd_},t.behindLiveEdge=function(){return this.behindLiveEdge_},t.isTracking=function(){return\"number\"==typeof this.trackingInterval_},t.seekToLiveEdge=function(){this.seekedBehindLive_=!1,this.atLiveEdge()||(this.nextSeekedFromUser_=!1,this.player_.currentTime(this.liveCurrentTime()))},t.dispose=function(){this.off(document,\"visibilitychange\",this.handleVisibilityChange_),this.stopTracking(),n.prototype.dispose.call(this)},e}(pt));function kn(e){if((n=e.el()).hasAttribute(\"src\"))return e.triggerSourceset(n.src),1;var t=e.$$(\"source\"),i=[],n=\"\";if(t.length){for(var r=0;r<t.length;r++){var a=t[r].src;a&&-1===i.indexOf(a)&&i.push(a)}return!!i.length&&(1===i.length&&(n=i[0]),e.triggerSourceset(n),!0)}}function Cn(e,t){for(var i={},n=0;n<e.length&&!((i=Object.getOwnPropertyDescriptor(e[n],t))&&i.set&&i.get);n++);return i.enumerable=!0,i.configurable=!0,i}function In(a){var t,e,i,s=a.el();s.resetSourceWatch_||(t={},e=Cn([a.el(),window.HTMLMediaElement.prototype,window.Element.prototype,Ln],\"innerHTML\"),i=function(r){return function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var n=r.apply(s,t);return kn(a),n}},[\"append\",\"appendChild\",\"insertAdjacentHTML\"].forEach(function(e){s[e]&&(t[e]=s[e],s[e]=i(t[e]))}),Object.defineProperty(s,\"innerHTML\",lt(e,{set:i(e.set)})),s.resetSourceWatch_=function(){s.resetSourceWatch_=null,Object.keys(t).forEach(function(e){s[e]=t[e]}),Object.defineProperty(s,\"innerHTML\",e)},a.one(\"sourceset\",s.resetSourceWatch_))}function xn(i){var n,t,r,a;i.featuresSourceset&&((n=i.el()).resetSourceset_||(t=Cn([i.el(),window.HTMLMediaElement.prototype,Dn],\"src\"),r=n.setAttribute,a=n.load,Object.defineProperty(n,\"src\",lt(t,{set:function(e){e=t.set.call(n,e);return i.triggerSourceset(n.src),e}})),n.setAttribute=function(e,t){t=r.call(n,e,t);return/src/i.test(e)&&i.triggerSourceset(n.src),t},n.load=function(){var e=a.call(n);return kn(i)||(i.triggerSourceset(\"\"),In(i)),e},n.currentSrc?i.triggerSourceset(n.currentSrc):kn(i)||In(i),n.resetSourceset_=function(){n.resetSourceset_=null,n.load=a,n.setAttribute=r,Object.defineProperty(n,\"src\",t),n.resetSourceWatch_&&n.resetSourceWatch_()}))}function An(t,i,n,e){function r(e){return Object.defineProperty(t,i,{value:e,enumerable:!0,writable:!0})}var a={configurable:!0,enumerable:!0,get:function(){var e=n();return r(e),e}};return(e=void 0===e?!0:e)&&(a.set=r),Object.defineProperty(t,i,a)}var Pn,Ln=Object.defineProperty({},\"innerHTML\",{get:function(){return this.cloneNode(!0).innerHTML},set:function(e){var t=document.createElement(this.nodeName.toLowerCase());t.innerHTML=e;for(var i=document.createDocumentFragment();t.childNodes.length;)i.appendChild(t.childNodes[0]);return this.innerText=\"\",window.Element.prototype.appendChild.call(this,i),this.innerHTML}}),Dn=Object.defineProperty({},\"src\",{get:function(){return this.hasAttribute(\"src\")?Rt(window.Element.prototype.getAttribute.call(this,\"src\")):\"\"},set:function(e){return window.Element.prototype.setAttribute.call(this,\"src\",e),e}}),On=function(l){function s(e,t){var i=l.call(this,e,t)||this,t=e.source,n=!1;if(t&&(i.el_.currentSrc!==t.src||e.tag&&3===e.tag.initNetworkState_)?i.setSource(t):i.handleLateInit_(i.el_),e.enableSourceset&&i.setupSourcesetHandling_(),i.isScrubbing_=!1,i.el_.hasChildNodes()){for(var r=i.el_.childNodes,a=r.length,s=[];a--;){var o=r[a];\"track\"===o.nodeName.toLowerCase()&&(i.featuresNativeTextTracks?(i.remoteTextTrackEls().addTrackElement_(o),i.remoteTextTracks().addTrack(o.track),i.textTracks().addTrack(o.track),n||i.el_.hasAttribute(\"crossorigin\")||!Ut(o.src)||(n=!0)):s.push(o))}for(var u=0;u<s.length;u++)i.el_.removeChild(s[u])}return i.proxyNativeTracks_(),i.featuresNativeTextTracks&&n&&h.warn(\"Text Tracks are being loaded from another origin but the crossorigin attribute isn't used.\\nThis may prevent text tracks from loading.\"),i.restoreMetadataTracksInIOSNativePlayer_(),(F||H||L)&&!0===e.nativeControlsForTouch&&i.setControls(!0),i.proxyWebkitFullscreen_(),i.featuresVideoFrameCallback=i.featuresVideoFrameCallback&&\"VIDEO\"===i.el_.tagName,i.triggerReady(),i}mt(s,l);var e=s.prototype;return e.dispose=function(){this.el_&&this.el_.resetSourceset_&&this.el_.resetSourceset_(),s.disposeMediaElement(this.el_),this.options_=null,l.prototype.dispose.call(this)},e.setupSourcesetHandling_=function(){xn(this)},e.restoreMetadataTracksInIOSNativePlayer_=function(){function e(){i=[];for(var e=0;e<n.length;e++){var t=n[e];\"metadata\"===t.kind&&i.push({track:t,storedMode:t.mode})}}var i,n=this.textTracks();e(),n.addEventListener(\"change\",e),this.on(\"dispose\",function(){return n.removeEventListener(\"change\",e)});function r(){for(var e=0;e<i.length;e++){var t=i[e];\"disabled\"===t.track.mode&&t.track.mode!==t.storedMode&&(t.track.mode=t.storedMode)}n.removeEventListener(\"change\",r)}this.on(\"webkitbeginfullscreen\",function(){n.removeEventListener(\"change\",e),n.removeEventListener(\"change\",r),n.addEventListener(\"change\",r)}),this.on(\"webkitendfullscreen\",function(){n.removeEventListener(\"change\",e),n.addEventListener(\"change\",e),n.removeEventListener(\"change\",r)})},e.overrideNative_=function(e,t){var i,n=this;t===this[\"featuresNative\"+e+\"Tracks\"]&&(this[(i=e.toLowerCase())+\"TracksListeners_\"]&&Object.keys(this[i+\"TracksListeners_\"]).forEach(function(e){n.el()[i+\"Tracks\"].removeEventListener(e,n[i+\"TracksListeners_\"][e])}),this[\"featuresNative\"+e+\"Tracks\"]=!t,this[i+\"TracksListeners_\"]=null,this.proxyNativeTracksForType_(i))},e.overrideNativeAudioTracks=function(e){this.overrideNative_(\"Audio\",e)},e.overrideNativeVideoTracks=function(e){this.overrideNative_(\"Video\",e)},e.proxyNativeTracksForType_=function(i){var e,t,n=this,r=ai[i],a=this.el()[r.getterName],s=this[r.getterName]();this[\"featuresNative\"+r.capitalName+\"Tracks\"]&&a&&a.addEventListener&&(t=function(){for(var e=[],t=0;t<s.length;t++){for(var i=!1,n=0;n<a.length;n++)if(a[n]===s[t]){i=!0;break}i||e.push(s[t])}for(;e.length;)s.removeTrack(e.shift())},this[r.getterName+\"Listeners_\"]=e={change:function(e){var t={type:\"change\",target:s,currentTarget:s,srcElement:s};s.trigger(t),\"text\"===i&&n[si.remoteText.getterName]().trigger(t)},addtrack:function(e){s.addTrack(e.track)},removetrack:function(e){s.removeTrack(e.track)}},Object.keys(e).forEach(function(t){var i=e[t];a.addEventListener(t,i),n.on(\"dispose\",function(e){return a.removeEventListener(t,i)})}),this.on(\"loadstart\",t),this.on(\"dispose\",function(e){return n.off(\"loadstart\",t)}))},e.proxyNativeTracks_=function(){var t=this;ai.names.forEach(function(e){t.proxyNativeTracksForType_(e)})},e.createEl=function(){var e,t=this.options_.tag;t&&(this.options_.playerElIngest||this.movingMediaElementInDOM)||(t?(e=t.cloneNode(!0),t.parentNode&&t.parentNode.insertBefore(e,t),s.disposeMediaElement(t),t=e):(t=document.createElement(\"video\"),e=lt({},this.options_.tag&&ae(this.options_.tag)),F&&!0===this.options_.nativeControlsForTouch||delete e.controls,re(t,b(e,{id:this.options_.techId,class:\"vjs-tech\"}))),t.playerId=this.options_.playerId),\"undefined\"!=typeof this.options_.preload&&oe(t,\"preload\",this.options_.preload),void 0!==this.options_.disablePictureInPicture&&(t.disablePictureInPicture=this.options_.disablePictureInPicture);for(var i=[\"loop\",\"muted\",\"playsinline\",\"autoplay\"],n=0;n<i.length;n++){var r=i[n],a=this.options_[r];\"undefined\"!=typeof a&&(a?oe(t,r,r):ue(t,r),t[r]=a)}return t},e.handleLateInit_=function(e){if(0!==e.networkState&&3!==e.networkState){if(0===e.readyState){var t=!1,i=function(){t=!0};this.on(\"loadstart\",i);var n=function(){t||this.trigger(\"loadstart\")};return this.on(\"loadedmetadata\",n),void this.ready(function(){this.off(\"loadstart\",i),this.off(\"loadedmetadata\",n),t||this.trigger(\"loadstart\")})}var r=[\"loadstart\"];r.push(\"loadedmetadata\"),2<=e.readyState&&r.push(\"loadeddata\"),3<=e.readyState&&r.push(\"canplay\"),4<=e.readyState&&r.push(\"canplaythrough\"),this.ready(function(){r.forEach(function(e){this.trigger(e)},this)})}},e.setScrubbing=function(e){this.isScrubbing_=e},e.scrubbing=function(){return this.isScrubbing_},e.setCurrentTime=function(e){try{this.isScrubbing_&&this.el_.fastSeek&&V?this.el_.fastSeek(e):this.el_.currentTime=e}catch(e){h(e,\"Video is not ready. (Video.js)\")}},e.duration=function(){var t=this;return this.el_.duration===1/0&&A&&M&&0===this.el_.currentTime?(this.on(\"timeupdate\",function e(){0<t.el_.currentTime&&(t.el_.duration===1/0&&t.trigger(\"durationchange\"),t.off(\"timeupdate\",e))}),NaN):this.el_.duration||NaN},e.width=function(){return this.el_.offsetWidth},e.height=function(){return this.el_.offsetHeight},e.proxyWebkitFullscreen_=function(){var e,t,i=this;\"webkitDisplayingFullscreen\"in this.el_&&(e=function(){this.trigger(\"fullscreenchange\",{isFullscreen:!1}),this.el_.controls&&!this.options_.nativeControlsForTouch&&this.controls()&&(this.el_.controls=!1)},t=function(){\"webkitPresentationMode\"in this.el_&&\"picture-in-picture\"!==this.el_.webkitPresentationMode&&(this.one(\"webkitendfullscreen\",e),this.trigger(\"fullscreenchange\",{isFullscreen:!0,nativeIOSFullscreen:!0}))},this.on(\"webkitbeginfullscreen\",t),this.on(\"dispose\",function(){i.off(\"webkitbeginfullscreen\",t),i.off(\"webkitendfullscreen\",e)}))},e.supportsFullScreen=function(){if(\"function\"==typeof this.el_.webkitEnterFullScreen){var e=window.navigator&&window.navigator.userAgent||\"\";if(/Android/.test(e)||!/Chrome|Mac OS X 10.5/.test(e))return!0}return!1},e.enterFullScreen=function(){var e=this.el_;if(e.paused&&e.networkState<=e.HAVE_METADATA)Et(this.el_.play()),this.setTimeout(function(){e.pause();try{e.webkitEnterFullScreen()}catch(e){this.trigger(\"fullscreenerror\",e)}},0);else try{e.webkitEnterFullScreen()}catch(e){this.trigger(\"fullscreenerror\",e)}},e.exitFullScreen=function(){this.el_.webkitDisplayingFullscreen?this.el_.webkitExitFullScreen():this.trigger(\"fullscreenerror\",new Error(\"The video is not fullscreen\"))},e.requestPictureInPicture=function(){return this.el_.requestPictureInPicture()},e.requestVideoFrameCallback=function(e){return this.featuresVideoFrameCallback?this.el_.requestVideoFrameCallback(e):l.prototype.requestVideoFrameCallback.call(this,e)},e.cancelVideoFrameCallback=function(e){this.featuresVideoFrameCallback?this.el_.cancelVideoFrameCallback(e):l.prototype.cancelVideoFrameCallback.call(this,e)},e.src=function(e){if(void 0===e)return this.el_.src;this.setSrc(e)},e.reset=function(){s.resetMediaElement(this.el_)},e.currentSrc=function(){return this.currentSource_?this.currentSource_.src:this.el_.currentSrc},e.setControls=function(e){this.el_.controls=!!e},e.addTextTrack=function(e,t,i){return this.featuresNativeTextTracks?this.el_.addTextTrack(e,t,i):l.prototype.addTextTrack.call(this,e,t,i)},e.createRemoteTextTrack=function(e){if(!this.featuresNativeTextTracks)return l.prototype.createRemoteTextTrack.call(this,e);var t=document.createElement(\"track\");return e.kind&&(t.kind=e.kind),e.label&&(t.label=e.label),(e.language||e.srclang)&&(t.srclang=e.language||e.srclang),e.default&&(t.default=e.default),e.id&&(t.id=e.id),e.src&&(t.src=e.src),t},e.addRemoteTextTrack=function(e,t){t=l.prototype.addRemoteTextTrack.call(this,e,t);return this.featuresNativeTextTracks&&this.el().appendChild(t),t},e.removeRemoteTextTrack=function(e){if(l.prototype.removeRemoteTextTrack.call(this,e),this.featuresNativeTextTracks)for(var t=this.$$(\"track\"),i=t.length;i--;)e!==t[i]&&e!==t[i].track||this.el().removeChild(t[i])},e.getVideoPlaybackQuality=function(){if(\"function\"==typeof this.el().getVideoPlaybackQuality)return this.el().getVideoPlaybackQuality();var e={};return\"undefined\"!=typeof this.el().webkitDroppedFrameCount&&\"undefined\"!=typeof this.el().webkitDecodedFrameCount&&(e.droppedVideoFrames=this.el().webkitDroppedFrameCount,e.totalVideoFrames=this.el().webkitDecodedFrameCount),window.performance&&\"function\"==typeof window.performance.now?e.creationTime=window.performance.now():window.performance&&window.performance.timing&&\"number\"==typeof window.performance.timing.navigationStart&&(e.creationTime=window.Date.now()-window.performance.timing.navigationStart),e},s}(ji);An(On,\"TEST_VID\",function(){if(X()){var e=document.createElement(\"video\"),t=document.createElement(\"track\");return t.kind=\"captions\",t.srclang=\"en\",t.label=\"English\",e.appendChild(t),e}}),On.isSupported=function(){try{On.TEST_VID.volume=.5}catch(e){return!1}return!(!On.TEST_VID||!On.TEST_VID.canPlayType)},On.canPlayType=function(e){return On.TEST_VID.canPlayType(e)},On.canPlaySource=function(e,t){return On.canPlayType(e.type)},On.canControlVolume=function(){try{var e=On.TEST_VID.volume;On.TEST_VID.volume=e/2+.1;var t=e!==On.TEST_VID.volume;return t&&q?(window.setTimeout(function(){On&&On.prototype&&(On.prototype.featuresVolumeControl=e!==On.TEST_VID.volume)}),!1):t}catch(e){return!1}},On.canMuteVolume=function(){try{var e=On.TEST_VID.muted;return On.TEST_VID.muted=!e,On.TEST_VID.muted?oe(On.TEST_VID,\"muted\",\"muted\"):ue(On.TEST_VID,\"muted\"),e!==On.TEST_VID.muted}catch(e){return!1}},On.canControlPlaybackRate=function(){if(A&&M&&R<58)return!1;try{var e=On.TEST_VID.playbackRate;return On.TEST_VID.playbackRate=e/2+.1,e!==On.TEST_VID.playbackRate}catch(e){return!1}},On.canOverrideAttributes=function(){try{var e=function(){};Object.defineProperty(document.createElement(\"video\"),\"src\",{get:e,set:e}),Object.defineProperty(document.createElement(\"audio\"),\"src\",{get:e,set:e}),Object.defineProperty(document.createElement(\"video\"),\"innerHTML\",{get:e,set:e}),Object.defineProperty(document.createElement(\"audio\"),\"innerHTML\",{get:e,set:e})}catch(e){return!1}return!0},On.supportsNativeTextTracks=function(){return V||q&&M},On.supportsNativeVideoTracks=function(){return!(!On.TEST_VID||!On.TEST_VID.videoTracks)},On.supportsNativeAudioTracks=function(){return!(!On.TEST_VID||!On.TEST_VID.audioTracks)},On.Events=[\"loadstart\",\"suspend\",\"abort\",\"error\",\"emptied\",\"stalled\",\"loadedmetadata\",\"loadeddata\",\"canplay\",\"canplaythrough\",\"playing\",\"waiting\",\"seeking\",\"seeked\",\"ended\",\"durationchange\",\"timeupdate\",\"progress\",\"play\",\"pause\",\"ratechange\",\"resize\",\"volumechange\"],[[\"featuresMuteControl\",\"canMuteVolume\"],[\"featuresPlaybackRate\",\"canControlPlaybackRate\"],[\"featuresSourceset\",\"canOverrideAttributes\"],[\"featuresNativeTextTracks\",\"supportsNativeTextTracks\"],[\"featuresNativeVideoTracks\",\"supportsNativeVideoTracks\"],[\"featuresNativeAudioTracks\",\"supportsNativeAudioTracks\"]].forEach(function(e){var t=e[0],i=e[1];An(On.prototype,t,function(){return On[i]()},!0)}),On.prototype.featuresVolumeControl=On.canControlVolume(),On.prototype.movingMediaElementInDOM=!q,On.prototype.featuresFullscreenResize=!0,On.prototype.featuresProgressEvents=!0,On.prototype.featuresTimeupdateEvents=!0,On.prototype.featuresVideoFrameCallback=!(!On.TEST_VID||!On.TEST_VID.requestVideoFrameCallback),On.patchCanPlayType=function(){4<=P&&!D&&!M&&(Pn=On.TEST_VID&&On.TEST_VID.constructor.prototype.canPlayType,On.TEST_VID.constructor.prototype.canPlayType=function(e){return e&&/^application\\/(?:x-|vnd\\.apple\\.)mpegurl/i.test(e)?\"maybe\":Pn.call(this,e)})},On.unpatchCanPlayType=function(){var e=On.TEST_VID.constructor.prototype.canPlayType;return Pn&&(On.TEST_VID.constructor.prototype.canPlayType=Pn),e},On.patchCanPlayType(),On.disposeMediaElement=function(e){if(e){for(e.parentNode&&e.parentNode.removeChild(e);e.hasChildNodes();)e.removeChild(e.firstChild);e.removeAttribute(\"src\"),\"function\"==typeof e.load&&function(){try{e.load()}catch(e){}}()}},On.resetMediaElement=function(e){if(e){for(var t=e.querySelectorAll(\"source\"),i=t.length;i--;)e.removeChild(t[i]);e.removeAttribute(\"src\"),\"function\"==typeof e.load&&function(){try{e.load()}catch(e){}}()}},[\"muted\",\"defaultMuted\",\"autoplay\",\"controls\",\"loop\",\"playsinline\"].forEach(function(e){On.prototype[e]=function(){return this.el_[e]||this.el_.hasAttribute(e)}}),[\"muted\",\"defaultMuted\",\"autoplay\",\"loop\",\"playsinline\"].forEach(function(t){On.prototype[\"set\"+ut(t)]=function(e){(this.el_[t]=e)?this.el_.setAttribute(t,t):this.el_.removeAttribute(t)}}),[\"paused\",\"currentTime\",\"buffered\",\"volume\",\"poster\",\"preload\",\"error\",\"seeking\",\"seekable\",\"ended\",\"playbackRate\",\"defaultPlaybackRate\",\"disablePictureInPicture\",\"played\",\"networkState\",\"readyState\",\"videoWidth\",\"videoHeight\",\"crossOrigin\"].forEach(function(e){On.prototype[e]=function(){return this.el_[e]}}),[\"volume\",\"src\",\"poster\",\"preload\",\"playbackRate\",\"defaultPlaybackRate\",\"disablePictureInPicture\",\"crossOrigin\"].forEach(function(t){On.prototype[\"set\"+ut(t)]=function(e){this.el_[t]=e}}),[\"pause\",\"load\",\"play\"].forEach(function(e){On.prototype[e]=function(){return this.el_[e]()}}),ji.withSourceHandlers(On),On.nativeSourceHandler={},On.nativeSourceHandler.canPlayType=function(e){try{return On.TEST_VID.canPlayType(e)}catch(e){return\"\"}},On.nativeSourceHandler.canHandleSource=function(e,t){if(e.type)return On.nativeSourceHandler.canPlayType(e.type);if(e.src){e=Nt(e.src);return On.nativeSourceHandler.canPlayType(\"video/\"+e)}return\"\"},On.nativeSourceHandler.handleSource=function(e,t,i){t.setSrc(e.src)},On.nativeSourceHandler.dispose=function(){},On.registerSourceHandler(On.nativeSourceHandler),ji.registerTech(\"Html5\",On);var Mn=[\"progress\",\"abort\",\"suspend\",\"emptied\",\"stalled\",\"loadedmetadata\",\"loadeddata\",\"timeupdate\",\"resize\",\"volumechange\",\"texttrackchange\"],Rn={canplay:\"CanPlay\",canplaythrough:\"CanPlayThrough\",playing:\"Playing\",seeked:\"Seeked\"},Nn=[\"tiny\",\"xsmall\",\"small\",\"medium\",\"large\",\"xlarge\",\"huge\"],Un={};Nn.forEach(function(e){var t=\"x\"===e.charAt(0)?\"x-\"+e.substring(1):e;Un[e]=\"vjs-layout-\"+t});var Bn={tiny:210,xsmall:320,small:425,medium:768,large:1440,xlarge:2560,huge:1/0},Fn=function(c){function o(e,t,i){var n,r;if(e.id=e.id||t.id||\"vjs_video_\"+Pe++,(t=b(o.getTagSettings(e),t)).initChildren=!1,t.createEl=!1,t.evented=!1,t.reportTouchActivity=!1,!t.language)if(\"function\"==typeof e.closest){var a=e.closest(\"[lang]\");a&&a.getAttribute&&(t.language=a.getAttribute(\"lang\"))}else for(var s=e;s&&1===s.nodeType;){if(ae(s).hasOwnProperty(\"lang\")){t.language=s.getAttribute(\"lang\");break}s=s.parentNode}if((n=c.call(this,null,t,i)||this).boundDocumentFullscreenChange_=function(e){return n.documentFullscreenChange_(e)},n.boundFullWindowOnEscKey_=function(e){return n.fullWindowOnEscKey(e)},n.boundUpdateStyleEl_=function(e){return n.updateStyleEl_(e)},n.boundApplyInitTime_=function(e){return n.applyInitTime_(e)},n.boundUpdateCurrentBreakpoint_=function(e){return n.updateCurrentBreakpoint_(e)},n.boundHandleTechClick_=function(e){return n.handleTechClick_(e)},n.boundHandleTechDoubleClick_=function(e){return n.handleTechDoubleClick_(e)},n.boundHandleTechTouchStart_=function(e){return n.handleTechTouchStart_(e)},n.boundHandleTechTouchMove_=function(e){return n.handleTechTouchMove_(e)},n.boundHandleTechTouchEnd_=function(e){return n.handleTechTouchEnd_(e)},n.boundHandleTechTap_=function(e){return n.handleTechTap_(e)},n.isFullscreen_=!1,n.log=p(n.id_),n.fsApi_=l,n.isPosterFromTech_=!1,n.queuedCallbacks_=[],n.isReady_=!1,n.hasStarted_=!1,n.userActive_=!1,n.debugEnabled_=!1,n.audioOnlyMode_=!1,n.audioPosterMode_=!1,n.audioOnlyCache_={playerHeight:null,hiddenChildren:[]},!n.options_||!n.options_.techOrder||!n.options_.techOrder.length)throw new Error(\"No techOrder specified. Did you overwrite videojs.options instead of just changing the properties you want to override?\");n.tag=e,n.tagAttributes=e&&ae(e),n.language(n.options_.language),t.languages?(r={},Object.getOwnPropertyNames(t.languages).forEach(function(e){r[e.toLowerCase()]=t.languages[e]}),n.languages_=r):n.languages_=o.prototype.options_.languages,n.resetCache_(),n.poster_=t.poster||\"\",n.controls_=!!t.controls,e.controls=!1,e.removeAttribute(\"controls\"),n.changingSrc_=!1,n.playCallbacks_=[],n.playTerminatedQueue_=[],e.hasAttribute(\"autoplay\")?n.autoplay(!0):n.autoplay(n.options_.autoplay),t.plugins&&Object.keys(t.plugins).forEach(function(e){if(\"function\"!=typeof n[e])throw new Error('plugin \"'+e+'\" does not exist')}),n.scrubbing_=!1,n.el_=n.createEl(),rt(ft(n),{eventBusKey:\"el_\"}),n.fsApi_.requestFullscreen&&(Be(document,n.fsApi_.fullscreenchange,n.boundDocumentFullscreenChange_),n.on(n.fsApi_.fullscreenchange,n.boundDocumentFullscreenChange_)),n.fluid_&&n.on([\"playerreset\",\"resize\"],n.boundUpdateStyleEl_);i=lt(n.options_);t.plugins&&Object.keys(t.plugins).forEach(function(e){n[e](t.plugins[e])}),t.debug&&n.debug(!0),n.options_.playerOptions=i,n.middleware_=[],n.playbackRates(t.playbackRates),n.initChildren(),n.isAudio(\"audio\"===e.nodeName.toLowerCase()),n.controls()?n.addClass(\"vjs-controls-enabled\"):n.addClass(\"vjs-controls-disabled\"),n.el_.setAttribute(\"role\",\"region\"),n.isAudio()?n.el_.setAttribute(\"aria-label\",n.localize(\"Audio Player\")):n.el_.setAttribute(\"aria-label\",n.localize(\"Video Player\")),n.isAudio()&&n.addClass(\"vjs-audio\"),n.flexNotSupported_()&&n.addClass(\"vjs-no-flex\"),F&&n.addClass(\"vjs-touch-enabled\"),q||n.addClass(\"vjs-workinghover\"),o.players[n.id_]=ft(n);e=u.split(\".\")[0];return n.addClass(\"vjs-v\"+e),n.userActive(!0),n.reportUserActivity(),n.one(\"play\",function(e){return n.listenForUserActivity_(e)}),n.on(\"stageclick\",function(e){return n.handleStageClick_(e)}),n.on(\"keydown\",function(e){return n.handleKeyDown(e)}),n.on(\"languagechange\",function(e){return n.handleLanguagechange(e)}),n.breakpoints(n.options_.breakpoints),n.responsive(n.options_.responsive),n.on(\"ready\",function(){n.audioPosterMode(n.options_.audioPosterMode),n.audioOnlyMode(n.options_.audioOnlyMode)}),n}mt(o,c);var e=o.prototype;return e.dispose=function(){var t=this;this.trigger(\"dispose\"),this.off(\"dispose\"),Fe(document,this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_),Fe(document,\"keydown\",this.boundFullWindowOnEscKey_),this.styleEl_&&this.styleEl_.parentNode&&(this.styleEl_.parentNode.removeChild(this.styleEl_),this.styleEl_=null),o.players[this.id_]=null,this.tag&&this.tag.player&&(this.tag.player=null),this.el_&&this.el_.player&&(this.el_.player=null),this.tech_&&(this.tech_.dispose(),this.isPosterFromTech_=!1,this.poster_=\"\"),this.playerElIngest_&&(this.playerElIngest_=null),this.tag&&(this.tag=null),qi[this.id()]=null,oi.names.forEach(function(e){e=oi[e],e=t[e.getterName]();e&&e.off&&e.off()}),c.prototype.dispose.call(this,{restoreEl:this.options_.restoreEl})},e.createEl=function(){var t,i=this.tag,e=this.playerElIngest_=i.parentNode&&i.parentNode.hasAttribute&&i.parentNode.hasAttribute(\"data-vjs-player\"),n=\"video-js\"===this.tag.tagName.toLowerCase();e?t=this.el_=i.parentNode:n||(t=this.el_=c.prototype.createEl.call(this,\"div\"));var r,a,s=ae(i);if(n){for(t=this.el_=i,i=this.tag=document.createElement(\"video\");t.children.length;)i.appendChild(t.firstChild);ee(t,\"video-js\")||te(t,\"video-js\"),t.appendChild(i),e=this.playerElIngest_=t,Object.keys(t).forEach(function(e){try{i[e]=t[e]}catch(e){}})}i.setAttribute(\"tabindex\",\"-1\"),s.tabindex=\"-1\",(N||M&&B)&&(i.setAttribute(\"role\",\"application\"),s.role=\"application\"),i.removeAttribute(\"width\"),i.removeAttribute(\"height\"),\"width\"in s&&delete s.width,\"height\"in s&&delete s.height,Object.getOwnPropertyNames(s).forEach(function(e){n&&\"class\"===e||t.setAttribute(e,s[e]),n&&i.setAttribute(e,s[e])}),i.playerId=i.id,i.id+=\"_html5_api\",i.className=\"vjs-tech\",(i.player=t.player=this).addClass(\"vjs-paused\"),!0!==window.VIDEOJS_NO_DYNAMIC_STYLE&&(this.styleEl_=xe(\"vjs-styles-dimensions\"),r=Te(\".vjs-styles-defaults\"),(a=Te(\"head\")).insertBefore(this.styleEl_,r?r.nextSibling:a.firstChild)),this.fill_=!1,this.fluid_=!1,this.width(this.options_.width),this.height(this.options_.height),this.fill(this.options_.fill),this.fluid(this.options_.fluid),this.aspectRatio(this.options_.aspectRatio),this.crossOrigin(this.options_.crossOrigin||this.options_.crossorigin);for(var o=i.getElementsByTagName(\"a\"),u=0;u<o.length;u++){var l=o.item(u);te(l,\"vjs-hidden\"),l.setAttribute(\"hidden\",\"hidden\")}return i.initNetworkState_=i.networkState,i.parentNode&&!e&&i.parentNode.insertBefore(t,i),Z(i,t),this.children_.unshift(i),this.el_.setAttribute(\"lang\",this.language_),this.el_.setAttribute(\"translate\",\"no\"),this.el_=t},e.crossOrigin=function(e){if(!e)return this.techGet_(\"crossOrigin\");\"anonymous\"===e||\"use-credentials\"===e?this.techCall_(\"setCrossOrigin\",e):h.warn('crossOrigin must be \"anonymous\" or \"use-credentials\", given \"'+e+'\"')},e.width=function(e){return this.dimension(\"width\",e)},e.height=function(e){return this.dimension(\"height\",e)},e.dimension=function(e,t){var i=e+\"_\";if(void 0===t)return this[i]||0;if(\"\"===t||\"auto\"===t)return this[i]=void 0,void this.updateStyleEl_();var n=parseFloat(t);isNaN(n)?h.error('Improper value \"'+t+'\" supplied for for '+e):(this[i]=n,this.updateStyleEl_())},e.fluid=function(e){var t,i=this;if(void 0===e)return!!this.fluid_;this.fluid_=!!e,it(this)&&this.off([\"playerreset\",\"resize\"],this.boundUpdateStyleEl_),e?(this.addClass(\"vjs-fluid\"),this.fill(!1),t=function(){i.on([\"playerreset\",\"resize\"],i.boundUpdateStyleEl_)},it(e=this)?t():(e.eventedCallbacks||(e.eventedCallbacks=[]),e.eventedCallbacks.push(t))):this.removeClass(\"vjs-fluid\"),this.updateStyleEl_()},e.fill=function(e){if(void 0===e)return!!this.fill_;this.fill_=!!e,e?(this.addClass(\"vjs-fill\"),this.fluid(!1)):this.removeClass(\"vjs-fill\")},e.aspectRatio=function(e){if(void 0===e)return this.aspectRatio_;if(!/^\\d+\\:\\d+$/.test(e))throw new Error(\"Improper value supplied for aspect ratio. The format should be width:height, for example 16:9.\");this.aspectRatio_=e,this.fluid(!0),this.updateStyleEl_()},e.updateStyleEl_=function(){var e,t,i,n;!0!==window.VIDEOJS_NO_DYNAMIC_STYLE?(n=(i=(void 0!==this.aspectRatio_&&\"auto\"!==this.aspectRatio_?this.aspectRatio_:0<this.videoWidth()?this.videoWidth()+\":\"+this.videoHeight():\"16:9\").split(\":\"))[1]/i[0],e=void 0!==this.width_?this.width_:void 0!==this.height_?this.height_/n:this.videoWidth()||300,t=void 0!==this.height_?this.height_:e*n,i=/^[^a-zA-Z]/.test(this.id())?\"dimensions-\"+this.id():this.id()+\"-dimensions\",this.addClass(i),Ae(this.styleEl_,\"\\n      .\"+i+\" {\\n        width: \"+e+\"px;\\n        height: \"+t+\"px;\\n      }\\n\\n      .\"+i+\".vjs-fluid:not(.vjs-audio-only-mode) {\\n        padding-top: \"+100*n+\"%;\\n      }\\n    \")):(t=\"number\"==typeof this.width_?this.width_:this.options_.width,i=\"number\"==typeof this.height_?this.height_:this.options_.height,(n=this.tech_&&this.tech_.el())&&(0<=t&&(n.width=t),0<=i&&(n.height=i)))},e.loadTech_=function(e,t){var i=this;this.tech_&&this.unloadTech_();var n=ut(e),r=e.charAt(0).toLowerCase()+e.slice(1);\"Html5\"!==n&&this.tag&&(ji.getTech(\"Html5\").disposeMediaElement(this.tag),this.tag.player=null,this.tag=null),this.techName_=n,this.isReady_=!1;var a=this.autoplay(),s={source:t,autoplay:a=\"string\"==typeof this.autoplay()||!0===this.autoplay()&&this.options_.normalizeAutoplay?!1:a,nativeControlsForTouch:this.options_.nativeControlsForTouch,playerId:this.id(),techId:this.id()+\"_\"+r+\"_api\",playsinline:this.options_.playsinline,preload:this.options_.preload,loop:this.options_.loop,disablePictureInPicture:this.options_.disablePictureInPicture,muted:this.options_.muted,poster:this.poster(),language:this.language(),playerElIngest:this.playerElIngest_||!1,\"vtt.js\":this.options_[\"vtt.js\"],canOverridePoster:!!this.options_.techCanOverridePoster,enableSourceset:this.options_.enableSourceset,Promise:this.options_.Promise};oi.names.forEach(function(e){e=oi[e];s[e.getterName]=i[e.privateName]}),b(s,this.options_[n]),b(s,this.options_[r]),b(s,this.options_[e.toLowerCase()]),this.tag&&(s.tag=this.tag),t&&t.src===this.cache_.src&&0<this.cache_.currentTime&&(s.startTime=this.cache_.currentTime);e=ji.getTech(e);if(!e)throw new Error(\"No Tech named '\"+n+\"' exists! '\"+n+\"' should be registered using videojs.registerTech()'\");this.tech_=new e(s),this.tech_.ready(Ve(this,this.handleTechReady_),!0),It(this.textTracksJson_||[],this.tech_),Mn.forEach(function(t){i.on(i.tech_,t,function(e){return i[\"handleTech\"+ut(t)+\"_\"](e)})}),Object.keys(Rn).forEach(function(t){i.on(i.tech_,t,function(e){0===i.tech_.playbackRate()&&i.tech_.seeking()?i.queuedCallbacks_.push({callback:i[\"handleTech\"+Rn[t]+\"_\"].bind(i),event:e}):i[\"handleTech\"+Rn[t]+\"_\"](e)})}),this.on(this.tech_,\"loadstart\",function(e){return i.handleTechLoadStart_(e)}),this.on(this.tech_,\"sourceset\",function(e){return i.handleTechSourceset_(e)}),this.on(this.tech_,\"waiting\",function(e){return i.handleTechWaiting_(e)}),this.on(this.tech_,\"ended\",function(e){return i.handleTechEnded_(e)}),this.on(this.tech_,\"seeking\",function(e){return i.handleTechSeeking_(e)}),this.on(this.tech_,\"play\",function(e){return i.handleTechPlay_(e)}),this.on(this.tech_,\"firstplay\",function(e){return i.handleTechFirstPlay_(e)}),this.on(this.tech_,\"pause\",function(e){return i.handleTechPause_(e)}),this.on(this.tech_,\"durationchange\",function(e){return i.handleTechDurationChange_(e)}),this.on(this.tech_,\"fullscreenchange\",function(e,t){return i.handleTechFullscreenChange_(e,t)}),this.on(this.tech_,\"fullscreenerror\",function(e,t){return i.handleTechFullscreenError_(e,t)}),this.on(this.tech_,\"enterpictureinpicture\",function(e){return i.handleTechEnterPictureInPicture_(e)}),this.on(this.tech_,\"leavepictureinpicture\",function(e){return i.handleTechLeavePictureInPicture_(e)}),this.on(this.tech_,\"error\",function(e){return i.handleTechError_(e)}),this.on(this.tech_,\"posterchange\",function(e){return i.handleTechPosterChange_(e)}),this.on(this.tech_,\"textdata\",function(e){return i.handleTechTextData_(e)}),this.on(this.tech_,\"ratechange\",function(e){return i.handleTechRateChange_(e)}),this.on(this.tech_,\"loadedmetadata\",this.boundUpdateStyleEl_),this.usingNativeControls(this.techGet_(\"controls\")),this.controls()&&!this.usingNativeControls()&&this.addTechControlsListeners_(),this.tech_.el().parentNode===this.el()||\"Html5\"===n&&this.tag||Z(this.tech_.el(),this.el()),this.tag&&(this.tag.player=null,this.tag=null)},e.unloadTech_=function(){var t=this;oi.names.forEach(function(e){e=oi[e];t[e.privateName]=t[e.getterName]()}),this.textTracksJson_=Ct(this.tech_),this.isReady_=!1,this.tech_.dispose(),this.tech_=!1,this.isPosterFromTech_&&(this.poster_=\"\",this.trigger(\"posterchange\")),this.isPosterFromTech_=!1},e.tech=function(e){return void 0===e&&h.warn(\"Using the tech directly can be dangerous. I hope you know what you're doing.\\nSee https://github.com/videojs/video.js/issues/2617 for more info.\\n\"),this.tech_},e.addTechControlsListeners_=function(){this.removeTechControlsListeners_(),this.on(this.tech_,\"click\",this.boundHandleTechClick_),this.on(this.tech_,\"dblclick\",this.boundHandleTechDoubleClick_),this.on(this.tech_,\"touchstart\",this.boundHandleTechTouchStart_),this.on(this.tech_,\"touchmove\",this.boundHandleTechTouchMove_),this.on(this.tech_,\"touchend\",this.boundHandleTechTouchEnd_),this.on(this.tech_,\"tap\",this.boundHandleTechTap_)},e.removeTechControlsListeners_=function(){this.off(this.tech_,\"tap\",this.boundHandleTechTap_),this.off(this.tech_,\"touchstart\",this.boundHandleTechTouchStart_),this.off(this.tech_,\"touchmove\",this.boundHandleTechTouchMove_),this.off(this.tech_,\"touchend\",this.boundHandleTechTouchEnd_),this.off(this.tech_,\"click\",this.boundHandleTechClick_),this.off(this.tech_,\"dblclick\",this.boundHandleTechDoubleClick_)},e.handleTechReady_=function(){this.triggerReady(),this.cache_.volume&&this.techCall_(\"setVolume\",this.cache_.volume),this.handleTechPosterChange_(),this.handleTechDurationChange_()},e.handleTechLoadStart_=function(){this.removeClass(\"vjs-ended\"),this.removeClass(\"vjs-seeking\"),this.error(null),this.handleTechDurationChange_(),this.paused()?(this.hasStarted(!1),this.trigger(\"loadstart\")):(this.trigger(\"loadstart\"),this.trigger(\"firstplay\")),this.manualAutoplay_(!0===this.autoplay()&&this.options_.normalizeAutoplay?\"play\":this.autoplay())},e.manualAutoplay_=function(e){var n=this;if(this.tech_&&\"string\"==typeof e){var t,i=function(){var e=n.muted();n.muted(!0);function t(){n.muted(e)}n.playTerminatedQueue_.push(t);var i=n.play();if(wt(i))return i.catch(function(e){throw t(),new Error(\"Rejection at manualAutoplay. Restoring muted value. \"+(e||\"\"))})};if(\"any\"!==e||this.muted()?t=\"muted\"!==e||this.muted()?this.play():i():wt(t=this.play())&&(t=t.catch(i)),wt(t))return t.then(function(){n.trigger({type:\"autoplay-success\",autoplay:e})}).catch(function(){n.trigger({type:\"autoplay-failure\",autoplay:e})})}},e.updateSourceCaches_=function(e){var t=e=void 0===e?\"\":e,i=\"\";\"string\"!=typeof t&&(t=e.src,i=e.type),this.cache_.source=this.cache_.source||{},this.cache_.sources=this.cache_.sources||[],t&&!i&&(i=function(e,t){if(!t)return\"\";if(e.cache_.source.src===t&&e.cache_.source.type)return e.cache_.source.type;var i=e.cache_.sources.filter(function(e){return e.src===t});if(i.length)return i[0].type;for(var n=e.$$(\"source\"),r=0;r<n.length;r++){var a=n[r];if(a.type&&a.src&&a.src===t)return a.type}return $i(t)}(this,t)),this.cache_.source=lt({},e,{src:t,type:i});for(var i=this.cache_.sources.filter(function(e){return e.src&&e.src===t}),n=[],r=this.$$(\"source\"),a=[],s=0;s<r.length;s++){var o=ae(r[s]);n.push(o),o.src&&o.src===t&&a.push(o.src)}a.length&&!i.length?this.cache_.sources=n:i.length||(this.cache_.sources=[this.cache_.source]),this.cache_.src=t},e.handleTechSourceset_=function(e){var t,i,n,r=this;this.changingSrc_||(t=function(e){return r.updateSourceCaches_(e)},i=this.currentSource().src,n=e.src,i&&!/^blob:/.test(i)&&/^blob:/.test(n)&&(this.lastSource_&&(this.lastSource_.tech===n||this.lastSource_.player===i)||(t=function(){})),t(n),e.src||this.tech_.any([\"sourceset\",\"loadstart\"],function(e){\"sourceset\"!==e.type&&(e=r.techGet(\"currentSrc\"),r.lastSource_.tech=e,r.updateSourceCaches_(e))})),this.lastSource_={player:this.currentSource().src,tech:e.src},this.trigger({src:e.src,type:\"sourceset\"})},e.hasStarted=function(e){if(void 0===e)return this.hasStarted_;e!==this.hasStarted_&&(this.hasStarted_=e,this.hasStarted_?(this.addClass(\"vjs-has-started\"),this.trigger(\"firstplay\")):this.removeClass(\"vjs-has-started\"))},e.handleTechPlay_=function(){this.removeClass(\"vjs-ended\"),this.removeClass(\"vjs-paused\"),this.addClass(\"vjs-playing\"),this.hasStarted(!0),this.trigger(\"play\")},e.handleTechRateChange_=function(){0<this.tech_.playbackRate()&&0===this.cache_.lastPlaybackRate&&(this.queuedCallbacks_.forEach(function(e){return e.callback(e.event)}),this.queuedCallbacks_=[]),this.cache_.lastPlaybackRate=this.tech_.playbackRate(),this.trigger(\"ratechange\")},e.handleTechWaiting_=function(){var t=this;this.addClass(\"vjs-waiting\"),this.trigger(\"waiting\");var i=this.currentTime();this.on(\"timeupdate\",function e(){i!==t.currentTime()&&(t.removeClass(\"vjs-waiting\"),t.off(\"timeupdate\",e))})},e.handleTechCanPlay_=function(){this.removeClass(\"vjs-waiting\"),this.trigger(\"canplay\")},e.handleTechCanPlayThrough_=function(){this.removeClass(\"vjs-waiting\"),this.trigger(\"canplaythrough\")},e.handleTechPlaying_=function(){this.removeClass(\"vjs-waiting\"),this.trigger(\"playing\")},e.handleTechSeeking_=function(){this.addClass(\"vjs-seeking\"),this.trigger(\"seeking\")},e.handleTechSeeked_=function(){this.removeClass(\"vjs-seeking\"),this.removeClass(\"vjs-ended\"),this.trigger(\"seeked\")},e.handleTechFirstPlay_=function(){this.options_.starttime&&(h.warn(\"Passing the `starttime` option to the player will be deprecated in 6.0\"),this.currentTime(this.options_.starttime)),this.addClass(\"vjs-has-started\"),this.trigger(\"firstplay\")},e.handleTechPause_=function(){this.removeClass(\"vjs-playing\"),this.addClass(\"vjs-paused\"),this.trigger(\"pause\")},e.handleTechEnded_=function(){this.addClass(\"vjs-ended\"),this.removeClass(\"vjs-waiting\"),this.options_.loop?(this.currentTime(0),this.play()):this.paused()||this.pause(),this.trigger(\"ended\")},e.handleTechDurationChange_=function(){this.duration(this.techGet_(\"duration\"))},e.handleTechClick_=function(e){this.controls_&&(void 0!==this.options_&&void 0!==this.options_.userActions&&void 0!==this.options_.userActions.click&&!1===this.options_.userActions.click||(void 0!==this.options_&&void 0!==this.options_.userActions&&\"function\"==typeof this.options_.userActions.click?this.options_.userActions.click.call(this,e):this.paused()?Et(this.play()):this.pause()))},e.handleTechDoubleClick_=function(t){this.controls_&&(Array.prototype.some.call(this.$$(\".vjs-control-bar, .vjs-modal-dialog\"),function(e){return e.contains(t.target)})||void 0!==this.options_&&void 0!==this.options_.userActions&&void 0!==this.options_.userActions.doubleClick&&!1===this.options_.userActions.doubleClick||(void 0!==this.options_&&void 0!==this.options_.userActions&&\"function\"==typeof this.options_.userActions.doubleClick?this.options_.userActions.doubleClick.call(this,t):this.isFullscreen()?this.exitFullscreen():this.requestFullscreen()))},e.handleTechTap_=function(){this.userActive(!this.userActive())},e.handleTechTouchStart_=function(){this.userWasActive=this.userActive()},e.handleTechTouchMove_=function(){this.userWasActive&&this.reportUserActivity()},e.handleTechTouchEnd_=function(e){e.cancelable&&e.preventDefault()},e.handleStageClick_=function(){this.reportUserActivity()},e.toggleFullscreenClass_=function(){this.isFullscreen()?this.addClass(\"vjs-fullscreen\"):this.removeClass(\"vjs-fullscreen\")},e.documentFullscreenChange_=function(e){var t=e.target.player;t&&t!==this||(e=this.el(),!(t=document[this.fsApi_.fullscreenElement]===e)&&e.matches?t=e.matches(\":\"+this.fsApi_.fullscreen):!t&&e.msMatchesSelector&&(t=e.msMatchesSelector(\":\"+this.fsApi_.fullscreen)),this.isFullscreen(t))},e.handleTechFullscreenChange_=function(e,t){var i=this;t&&(t.nativeIOSFullscreen&&(this.addClass(\"vjs-ios-native-fs\"),this.tech_.one(\"webkitendfullscreen\",function(){i.removeClass(\"vjs-ios-native-fs\")})),this.isFullscreen(t.isFullscreen))},e.handleTechFullscreenError_=function(e,t){this.trigger(\"fullscreenerror\",t)},e.togglePictureInPictureClass_=function(){this.isInPictureInPicture()?this.addClass(\"vjs-picture-in-picture\"):this.removeClass(\"vjs-picture-in-picture\")},e.handleTechEnterPictureInPicture_=function(e){this.isInPictureInPicture(!0)},e.handleTechLeavePictureInPicture_=function(e){this.isInPictureInPicture(!1)},e.handleTechError_=function(){var e=this.tech_.error();this.error(e)},e.handleTechTextData_=function(){this.trigger(\"textdata\",1<arguments.length?arguments[1]:null)},e.getCache=function(){return this.cache_},e.resetCache_=function(){this.cache_={currentTime:0,initTime:0,inactivityTimeout:this.options_.inactivityTimeout,duration:NaN,lastVolume:1,lastPlaybackRate:this.defaultPlaybackRate(),media:null,src:\"\",source:{},sources:[],playbackRates:[],volume:1}},e.techCall_=function(n,r){this.ready(function(){if(n in Xi)return e=this.middleware_,t=this.tech_,i=r,t[t=n](e.reduce(Yi(t),i));if(n in Ki)return Gi(this.middleware_,this.tech_,n,r);var e,t,i;try{this.tech_&&this.tech_[n](r)}catch(e){throw h(e),e}},!0)},e.techGet_=function(t){if(this.tech_&&this.tech_.isReady_){if(t in zi)return e=this.middleware_,i=this.tech_,n=t,e.reduceRight(Yi(n),i[n]());if(t in Ki)return Gi(this.middleware_,this.tech_,t);var e,i,n;try{return this.tech_[t]()}catch(e){if(void 0===this.tech_[t])throw h(\"Video.js: \"+t+\" method not defined for \"+this.techName_+\" playback technology.\",e),e;if(\"TypeError\"===e.name)throw h(\"Video.js: \"+t+\" unavailable on \"+this.techName_+\" playback technology element.\",e),this.tech_.isReady_=!1,e;throw h(e),e}}},e.play=function(){var t=this,e=this.options_.Promise||window.Promise;return e?new e(function(e){t.play_(e)}):this.play_()},e.play_=function(e){var t=this;this.playCallbacks_.push(e=void 0===e?Et:e);e=Boolean(!this.changingSrc_&&(this.src()||this.currentSrc()));if(this.waitToPlay_&&(this.off([\"ready\",\"loadstart\"],this.waitToPlay_),this.waitToPlay_=null),!this.isReady_||!e)return this.waitToPlay_=function(e){t.play_()},this.one([\"ready\",\"loadstart\"],this.waitToPlay_),void(e||!V&&!q||this.load());e=this.techGet_(\"play\");null===e?this.runPlayTerminatedQueue_():this.runPlayCallbacks_(e)},e.runPlayTerminatedQueue_=function(){var e=this.playTerminatedQueue_.slice(0);this.playTerminatedQueue_=[],e.forEach(function(e){e()})},e.runPlayCallbacks_=function(t){var e=this.playCallbacks_.slice(0);this.playCallbacks_=[],this.playTerminatedQueue_=[],e.forEach(function(e){e(t)})},e.pause=function(){this.techCall_(\"pause\")},e.paused=function(){return!1!==this.techGet_(\"paused\")},e.played=function(){return this.techGet_(\"played\")||vt(0,0)},e.scrubbing=function(e){if(\"undefined\"==typeof e)return this.scrubbing_;this.scrubbing_=!!e,this.techCall_(\"setScrubbing\",this.scrubbing_),e?this.addClass(\"vjs-scrubbing\"):this.removeClass(\"vjs-scrubbing\")},e.currentTime=function(e){return\"undefined\"!=typeof e?(e<0&&(e=0),this.isReady_&&!this.changingSrc_&&this.tech_&&this.tech_.isReady_?(this.techCall_(\"setCurrentTime\",e),void(this.cache_.initTime=0)):(this.cache_.initTime=e,this.off(\"canplay\",this.boundApplyInitTime_),void this.one(\"canplay\",this.boundApplyInitTime_))):(this.cache_.currentTime=this.techGet_(\"currentTime\")||0,this.cache_.currentTime)},e.applyInitTime_=function(){this.currentTime(this.cache_.initTime)},e.duration=function(e){if(void 0===e)return void 0!==this.cache_.duration?this.cache_.duration:NaN;(e=(e=parseFloat(e))<0?1/0:e)!==this.cache_.duration&&((this.cache_.duration=e)===1/0?this.addClass(\"vjs-live\"):this.removeClass(\"vjs-live\"),isNaN(e)||this.trigger(\"durationchange\"))},e.remainingTime=function(){return this.duration()-this.currentTime()},e.remainingTimeDisplay=function(){return Math.floor(this.duration())-Math.floor(this.currentTime())},e.buffered=function(){var e;return e=!(e=this.techGet_(\"buffered\"))||!e.length?vt(0,0):e},e.bufferedPercent=function(){return _t(this.buffered(),this.duration())},e.bufferedEnd=function(){var e=this.buffered(),t=this.duration(),e=e.end(e.length-1);return e=t<e?t:e},e.volume=function(e){var t;return void 0!==e?(t=Math.max(0,Math.min(1,parseFloat(e))),this.cache_.volume=t,this.techCall_(\"setVolume\",t),void(0<t&&this.lastVolume_(t))):(t=parseFloat(this.techGet_(\"volume\")),isNaN(t)?1:t)},e.muted=function(e){if(void 0===e)return this.techGet_(\"muted\")||!1;this.techCall_(\"setMuted\",e)},e.defaultMuted=function(e){return void 0!==e?this.techCall_(\"setDefaultMuted\",e):this.techGet_(\"defaultMuted\")||!1},e.lastVolume_=function(e){if(void 0===e||0===e)return this.cache_.lastVolume;this.cache_.lastVolume=e},e.supportsFullScreen=function(){return this.techGet_(\"supportsFullScreen\")||!1},e.isFullscreen=function(e){if(void 0===e)return this.isFullscreen_;var t=this.isFullscreen_;this.isFullscreen_=Boolean(e),this.isFullscreen_!==t&&this.fsApi_.prefixed&&this.trigger(\"fullscreenchange\"),this.toggleFullscreenClass_()},e.requestFullscreen=function(s){var e=this.options_.Promise||window.Promise;if(e){var o=this;return new e(function(e,i){function n(){o.off(\"fullscreenerror\",r),o.off(\"fullscreenchange\",t)}function t(){n(),e()}function r(e,t){n(),i(t)}o.one(\"fullscreenchange\",t),o.one(\"fullscreenerror\",r);var a=o.requestFullscreenHelper_(s);a&&(a.then(n,n),a.then(e,i))})}return this.requestFullscreenHelper_()},e.requestFullscreenHelper_=function(e){var t=this;if(this.fsApi_.prefixed||(i=this.options_.fullscreen&&this.options_.fullscreen.options||{},void 0!==e&&(i=e)),this.fsApi_.requestFullscreen){var i=this.el_[this.fsApi_.requestFullscreen](i);return i&&i.then(function(){return t.isFullscreen(!0)},function(){return t.isFullscreen(!1)}),i}this.tech_.supportsFullScreen()&&!0==!this.options_.preferFullWindow?this.techCall_(\"enterFullScreen\"):this.enterFullWindow()},e.exitFullscreen=function(){var e=this.options_.Promise||window.Promise;if(e){var s=this;return new e(function(e,i){function n(){s.off(\"fullscreenerror\",r),s.off(\"fullscreenchange\",t)}function t(){n(),e()}function r(e,t){n(),i(t)}s.one(\"fullscreenchange\",t),s.one(\"fullscreenerror\",r);var a=s.exitFullscreenHelper_();a&&(a.then(n,n),a.then(e,i))})}return this.exitFullscreenHelper_()},e.exitFullscreenHelper_=function(){var e=this;if(this.fsApi_.requestFullscreen){var t=document[this.fsApi_.exitFullscreen]();return t&&Et(t.then(function(){return e.isFullscreen(!1)})),t}this.tech_.supportsFullScreen()&&!0==!this.options_.preferFullWindow?this.techCall_(\"exitFullScreen\"):this.exitFullWindow()},e.enterFullWindow=function(){this.isFullscreen(!0),this.isFullWindow=!0,this.docOrigOverflow=document.documentElement.style.overflow,Be(document,\"keydown\",this.boundFullWindowOnEscKey_),document.documentElement.style.overflow=\"hidden\",te(document.body,\"vjs-full-window\"),this.trigger(\"enterFullWindow\")},e.fullWindowOnEscKey=function(e){ht.isEventKey(e,\"Esc\")&&!0===this.isFullscreen()&&(this.isFullWindow?this.exitFullWindow():this.exitFullscreen())},e.exitFullWindow=function(){this.isFullscreen(!1),this.isFullWindow=!1,Fe(document,\"keydown\",this.boundFullWindowOnEscKey_),document.documentElement.style.overflow=this.docOrigOverflow,ie(document.body,\"vjs-full-window\"),this.trigger(\"exitFullWindow\")},e.disablePictureInPicture=function(e){if(void 0===e)return this.techGet_(\"disablePictureInPicture\");this.techCall_(\"setDisablePictureInPicture\",e),this.options_.disablePictureInPicture=e,this.trigger(\"disablepictureinpicturechanged\")},e.isInPictureInPicture=function(e){return void 0!==e?(this.isInPictureInPicture_=!!e,void this.togglePictureInPictureClass_()):!!this.isInPictureInPicture_},e.requestPictureInPicture=function(){if(\"pictureInPictureEnabled\"in document&&!1===this.disablePictureInPicture())return this.techGet_(\"requestPictureInPicture\")},e.exitPictureInPicture=function(){if(\"pictureInPictureEnabled\"in document)return document.exitPictureInPicture()},e.handleKeyDown=function(e){var t=this.options_.userActions;t&&t.hotkeys&&(function(e){var t=e.tagName.toLowerCase();if(e.isContentEditable)return!0;if(\"input\"===t)return-1===[\"button\",\"checkbox\",\"hidden\",\"radio\",\"reset\",\"submit\"].indexOf(e.type);return-1!==[\"textarea\"].indexOf(t)}(this.el_.ownerDocument.activeElement)||(\"function\"==typeof t.hotkeys?t.hotkeys.call(this,e):this.handleHotkeys(e)))},e.handleHotkeys=function(e){var t=this.options_.userActions?this.options_.userActions.hotkeys:{},i=t.fullscreenKey,n=t.muteKey,n=void 0===n?function(e){return ht.isEventKey(e,\"m\")}:n,t=t.playPauseKey,t=void 0===t?function(e){return ht.isEventKey(e,\"k\")||ht.isEventKey(e,\"Space\")}:t;(void 0===i?function(e){return ht.isEventKey(e,\"f\")}:i).call(this,e)?(e.preventDefault(),e.stopPropagation(),i=pt.getComponent(\"FullscreenToggle\"),!1!==document[this.fsApi_.fullscreenEnabled]&&i.prototype.handleClick.call(this,e)):n.call(this,e)?(e.preventDefault(),e.stopPropagation(),pt.getComponent(\"MuteToggle\").prototype.handleClick.call(this,e)):t.call(this,e)&&(e.preventDefault(),e.stopPropagation(),pt.getComponent(\"PlayToggle\").prototype.handleClick.call(this,e))},e.canPlayType=function(e){for(var t,i=0,n=this.options_.techOrder;i<n.length;i++){var r=n[i],a=ji.getTech(r);if(a=a||pt.getComponent(r)){if(a.isSupported()&&(t=a.canPlayType(e)))return t}else h.error('The \"'+r+'\" tech is undefined. Skipped browser support check for that tech.')}return\"\"},e.selectSource=function(e){function t(e,i,n){var r;return e.some(function(t){return i.some(function(e){if(r=n(t,e))return!0})}),r}var i,n=this,r=this.options_.techOrder.map(function(e){return[e,ji.getTech(e)]}).filter(function(e){var t=e[0],e=e[1];return e?e.isSupported():(h.error('The \"'+t+'\" tech is undefined. Skipped browser support check for that tech.'),!1)}),a=function(e,t){var i=e[0];if(e[1].canPlaySource(t,n.options_[i.toLowerCase()]))return{source:t,tech:i}},a=this.options_.sourceOrder?t(e,r,(i=a,function(e,t){return i(t,e)})):t(r,e,a);return a||!1},e.handleSrc_=function(e,n){var r=this;if(\"undefined\"==typeof e)return this.cache_.src||\"\";this.resetRetryOnError_&&this.resetRetryOnError_();var t,i,a=Ji(e);a.length?(this.changingSrc_=!0,n||(this.cache_.sources=a),this.updateSourceCaches_(a[0]),Wi(this,a[0],function(e,t){var i;return r.middleware_=t,n||(r.cache_.sources=a),r.updateSourceCaches_(e),r.src_(e)?1<a.length?r.handleSrc_(a.slice(1)):(r.changingSrc_=!1,r.setTimeout(function(){this.error({code:4,message:this.options_.notSupportedMessage})},0),void r.triggerReady()):(t=t,i=r.tech_,void t.forEach(function(e){return e.setTech&&e.setTech(i)}))}),this.options_.retryOnError&&1<a.length&&(i=function(){r.off(\"error\",t)},this.one(\"error\",t=function(){r.error(null),r.handleSrc_(a.slice(1),!0)}),this.one(\"playing\",i),this.resetRetryOnError_=function(){r.off(\"error\",t),r.off(\"playing\",i)})):this.setTimeout(function(){this.error({code:4,message:this.options_.notSupportedMessage})},0)},e.src=function(e){return this.handleSrc_(e,!1)},e.src_=function(e){var t,i,n=this,r=this.selectSource([e]);return!r||(t=r.tech,i=this.techName_,ut(t)!==ut(i)?(this.changingSrc_=!0,this.loadTech_(r.tech,r.source),this.tech_.ready(function(){n.changingSrc_=!1})):this.ready(function(){this.tech_.constructor.prototype.hasOwnProperty(\"setSource\")?this.techCall_(\"setSource\",e):this.techCall_(\"src\",e.src),this.changingSrc_=!1},!0),!1)},e.load=function(){this.techCall_(\"load\")},e.reset=function(){var e=this,t=this.options_.Promise||window.Promise;this.paused()||!t?this.doReset_():Et(this.play().then(function(){return e.doReset_()}))},e.doReset_=function(){this.tech_&&this.tech_.clearTracks(\"text\"),this.resetCache_(),this.poster(\"\"),this.loadTech_(this.options_.techOrder[0],null),this.techCall_(\"reset\"),this.resetControlBarUI_(),it(this)&&this.trigger(\"playerreset\")},e.resetControlBarUI_=function(){this.resetProgressBar_(),this.resetPlaybackRate_(),this.resetVolumeBar_()},e.resetProgressBar_=function(){this.currentTime(0);var e=this.controlBar||{},t=e.durationDisplay,e=e.remainingTimeDisplay;t&&t.updateContent(),e&&e.updateContent()},e.resetPlaybackRate_=function(){this.playbackRate(this.defaultPlaybackRate()),this.handleTechRateChange_()},e.resetVolumeBar_=function(){this.volume(1),this.trigger(\"volumechange\")},e.currentSources=function(){var e=this.currentSource(),t=[];return 0!==Object.keys(e).length&&t.push(e),this.cache_.sources||t},e.currentSource=function(){return this.cache_.source||{}},e.currentSrc=function(){return this.currentSource()&&this.currentSource().src||\"\"},e.currentType=function(){return this.currentSource()&&this.currentSource().type||\"\"},e.preload=function(e){return void 0!==e?(this.techCall_(\"setPreload\",e),void(this.options_.preload=e)):this.techGet_(\"preload\")},e.autoplay=function(e){if(void 0===e)return this.options_.autoplay||!1;var t;\"string\"==typeof e&&/(any|play|muted)/.test(e)||!0===e&&this.options_.normalizeAutoplay?(this.options_.autoplay=e,this.manualAutoplay_(\"string\"==typeof e?e:\"play\"),t=!1):this.options_.autoplay=!!e,t=\"undefined\"==typeof t?this.options_.autoplay:t,this.tech_&&this.techCall_(\"setAutoplay\",t)},e.playsinline=function(e){return void 0!==e?(this.techCall_(\"setPlaysinline\",e),this.options_.playsinline=e,this):this.techGet_(\"playsinline\")},e.loop=function(e){return void 0!==e?(this.techCall_(\"setLoop\",e),void(this.options_.loop=e)):this.techGet_(\"loop\")},e.poster=function(e){if(void 0===e)return this.poster_;(e=e||\"\")!==this.poster_&&(this.poster_=e,this.techCall_(\"setPoster\",e),this.isPosterFromTech_=!1,this.trigger(\"posterchange\"))},e.handleTechPosterChange_=function(){var e;this.poster_&&!this.options_.techCanOverridePoster||!this.tech_||!this.tech_.poster||(e=this.tech_.poster()||\"\")!==this.poster_&&(this.poster_=e,this.isPosterFromTech_=!0,this.trigger(\"posterchange\"))},e.controls=function(e){if(void 0===e)return!!this.controls_;this.controls_!==(e=!!e)&&(this.controls_=e,this.usingNativeControls()&&this.techCall_(\"setControls\",e),this.controls_?(this.removeClass(\"vjs-controls-disabled\"),this.addClass(\"vjs-controls-enabled\"),this.trigger(\"controlsenabled\"),this.usingNativeControls()||this.addTechControlsListeners_()):(this.removeClass(\"vjs-controls-enabled\"),this.addClass(\"vjs-controls-disabled\"),this.trigger(\"controlsdisabled\"),this.usingNativeControls()||this.removeTechControlsListeners_()))},e.usingNativeControls=function(e){if(void 0===e)return!!this.usingNativeControls_;this.usingNativeControls_!==(e=!!e)&&(this.usingNativeControls_=e,this.usingNativeControls_?(this.addClass(\"vjs-using-native-controls\"),this.trigger(\"usingnativecontrols\")):(this.removeClass(\"vjs-using-native-controls\"),this.trigger(\"usingcustomcontrols\")))},e.error=function(t){var i=this;if(void 0===t)return this.error_||null;if(a(\"beforeerror\").forEach(function(e){e=e(i,t);T(e)&&!Array.isArray(e)||\"string\"==typeof e||\"number\"==typeof e||null===e?t=e:i.log.error(\"please return a value that MediaError expects in beforeerror hooks\")}),this.options_.suppressNotSupportedError&&t&&4===t.code){var e=function(){this.error(t)};return this.options_.suppressNotSupportedError=!1,this.any([\"click\",\"touchstart\"],e),void this.one(\"loadstart\",function(){this.off([\"click\",\"touchstart\"],e)})}if(null===t)return this.error_=t,this.removeClass(\"vjs-error\"),void(this.errorDisplay&&this.errorDisplay.close());this.error_=new bt(t),this.addClass(\"vjs-error\"),h.error(\"(CODE:\"+this.error_.code+\" \"+bt.errorTypes[this.error_.code]+\")\",this.error_.message,this.error_),this.trigger(\"error\"),a(\"error\").forEach(function(e){return e(i,i.error_)})},e.reportUserActivity=function(e){this.userActivity_=!0},e.userActive=function(e){if(void 0===e)return this.userActive_;if((e=!!e)!==this.userActive_){if(this.userActive_=e,this.userActive_)return this.userActivity_=!0,this.removeClass(\"vjs-user-inactive\"),this.addClass(\"vjs-user-active\"),void this.trigger(\"useractive\");this.tech_&&this.tech_.one(\"mousemove\",function(e){e.stopPropagation(),e.preventDefault()}),this.userActivity_=!1,this.removeClass(\"vjs-user-active\"),this.addClass(\"vjs-user-inactive\"),this.trigger(\"userinactive\")}},e.listenForUserActivity_=function(){var t,i,n,r=Ve(this,this.reportUserActivity),e=function(e){r(),this.clearInterval(t)};this.on(\"mousedown\",function(){r(),this.clearInterval(t),t=this.setInterval(r,250)}),this.on(\"mousemove\",function(e){e.screenX===i&&e.screenY===n||(i=e.screenX,n=e.screenY,r())}),this.on(\"mouseup\",e),this.on(\"mouseleave\",e);var a,e=this.getChild(\"controlBar\");!e||q||A||(e.on(\"mouseenter\",function(e){0!==this.player().options_.inactivityTimeout&&(this.player().cache_.inactivityTimeout=this.player().options_.inactivityTimeout),this.player().options_.inactivityTimeout=0}),e.on(\"mouseleave\",function(e){this.player().options_.inactivityTimeout=this.player().cache_.inactivityTimeout})),this.on(\"keydown\",r),this.on(\"keyup\",r),this.setInterval(function(){var e;this.userActivity_&&(this.userActivity_=!1,this.userActive(!0),this.clearTimeout(a),(e=this.options_.inactivityTimeout)<=0||(a=this.setTimeout(function(){this.userActivity_||this.userActive(!1)},e)))},250)},e.playbackRate=function(e){if(void 0===e)return this.tech_&&this.tech_.featuresPlaybackRate?this.cache_.lastPlaybackRate||this.techGet_(\"playbackRate\"):1;this.techCall_(\"setPlaybackRate\",e)},e.defaultPlaybackRate=function(e){return void 0!==e?this.techCall_(\"setDefaultPlaybackRate\",e):this.tech_&&this.tech_.featuresPlaybackRate?this.techGet_(\"defaultPlaybackRate\"):1},e.isAudio=function(e){if(void 0===e)return!!this.isAudio_;this.isAudio_=!!e},e.enableAudioOnlyUI_=function(){var t=this;this.addClass(\"vjs-audio-only-mode\");var e=this.children(),i=this.getChild(\"ControlBar\"),n=i&&i.currentHeight();e.forEach(function(e){e!==i&&e.el_&&!e.hasClass(\"vjs-hidden\")&&(e.hide(),t.audioOnlyCache_.hiddenChildren.push(e))}),this.audioOnlyCache_.playerHeight=this.currentHeight(),this.height(n),this.trigger(\"audioonlymodechange\")},e.disableAudioOnlyUI_=function(){this.removeClass(\"vjs-audio-only-mode\"),this.audioOnlyCache_.hiddenChildren.forEach(function(e){return e.show()}),this.height(this.audioOnlyCache_.playerHeight),this.trigger(\"audioonlymodechange\")},e.audioOnlyMode=function(e){var t=this;if(\"boolean\"!=typeof e||e===this.audioOnlyMode_)return this.audioOnlyMode_;this.audioOnlyMode_=e;var i=this.options_.Promise||window.Promise;if(i){if(e){var n=[];return this.isInPictureInPicture()&&n.push(this.exitPictureInPicture()),this.isFullscreen()&&n.push(this.exitFullscreen()),this.audioPosterMode()&&n.push(this.audioPosterMode(!1)),i.all(n).then(function(){return t.enableAudioOnlyUI_()})}return i.resolve().then(function(){return t.disableAudioOnlyUI_()})}e?(this.isInPictureInPicture()&&this.exitPictureInPicture(),this.isFullscreen()&&this.exitFullscreen(),this.enableAudioOnlyUI_()):this.disableAudioOnlyUI_()},e.enablePosterModeUI_=function(){(this.tech_&&this.tech_).hide(),this.addClass(\"vjs-audio-poster-mode\"),this.trigger(\"audiopostermodechange\")},e.disablePosterModeUI_=function(){(this.tech_&&this.tech_).show(),this.removeClass(\"vjs-audio-poster-mode\"),this.trigger(\"audiopostermodechange\")},e.audioPosterMode=function(e){var t=this;if(\"boolean\"!=typeof e||e===this.audioPosterMode_)return this.audioPosterMode_;this.audioPosterMode_=e;var i=this.options_.Promise||window.Promise;return i?e?(this.audioOnlyMode()?this.audioOnlyMode(!1):i.resolve()).then(function(){t.enablePosterModeUI_()}):i.resolve().then(function(){t.disablePosterModeUI_()}):e?(this.audioOnlyMode()&&this.audioOnlyMode(!1),void this.enablePosterModeUI_()):void this.disablePosterModeUI_()},e.addTextTrack=function(e,t,i){if(this.tech_)return this.tech_.addTextTrack(e,t,i)},e.addRemoteTextTrack=function(e,t){if(this.tech_)return this.tech_.addRemoteTextTrack(e,t)},e.removeRemoteTextTrack=function(e){var t=(t=(e=void 0===e?{}:e).track)||e;if(this.tech_)return this.tech_.removeRemoteTextTrack(t)},e.getVideoPlaybackQuality=function(){return this.techGet_(\"getVideoPlaybackQuality\")},e.videoWidth=function(){return this.tech_&&this.tech_.videoWidth&&this.tech_.videoWidth()||0},e.videoHeight=function(){return this.tech_&&this.tech_.videoHeight&&this.tech_.videoHeight()||0},e.language=function(e){if(void 0===e)return this.language_;this.language_!==String(e).toLowerCase()&&(this.language_=String(e).toLowerCase(),it(this)&&this.trigger(\"languagechange\"))},e.languages=function(){return lt(o.prototype.options_.languages,this.languages_)},e.toJSON=function(){var e=lt(this.options_),t=e.tracks;e.tracks=[];for(var i=0;i<t.length;i++){var n=t[i];(n=lt(n)).player=void 0,e.tracks[i]=n}return e},e.createModal=function(e,t){var i=this;(t=t||{}).content=e||\"\";var n=new At(this,t);return this.addChild(n),n.on(\"dispose\",function(){i.removeChild(n)}),n.open(),n},e.updateCurrentBreakpoint_=function(){if(this.responsive())for(var e=this.currentBreakpoint(),t=this.currentWidth(),i=0;i<Nn.length;i++){var n=Nn[i];if(t<=this.breakpoints_[n]){if(e===n)return;e&&this.removeClass(Un[e]),this.addClass(Un[n]),this.breakpoint_=n;break}}},e.removeCurrentBreakpoint_=function(){var e=this.currentBreakpointClass();this.breakpoint_=\"\",e&&this.removeClass(e)},e.breakpoints=function(e){return void 0===e||(this.breakpoint_=\"\",this.breakpoints_=b({},Bn,e),this.updateCurrentBreakpoint_()),b(this.breakpoints_)},e.responsive=function(e){return void 0===e?this.responsive_:(e=Boolean(e))!==this.responsive_?((this.responsive_=e)?(this.on(\"playerresize\",this.boundUpdateCurrentBreakpoint_),this.updateCurrentBreakpoint_()):(this.off(\"playerresize\",this.boundUpdateCurrentBreakpoint_),this.removeCurrentBreakpoint_()),e):void 0},e.currentBreakpoint=function(){return this.breakpoint_},e.currentBreakpointClass=function(){return Un[this.breakpoint_]||\"\"},e.loadMedia=function(e,t){var i,n,r,a=this;e&&\"object\"==typeof e&&(this.reset(),this.cache_.media=lt(e),i=(r=this.cache_.media).artwork,n=r.poster,e=r.src,r=r.textTracks,!i&&n&&(this.cache_.media.artwork=[{src:n,type:$i(n)}]),e&&this.src(e),n&&this.poster(n),Array.isArray(r)&&r.forEach(function(e){return a.addRemoteTextTrack(e,!1)}),this.ready(t))},e.getMedia=function(){if(this.cache_.media)return lt(this.cache_.media);var e=this.poster(),t={src:this.currentSources(),textTracks:Array.prototype.map.call(this.remoteTextTracks(),function(e){return{kind:e.kind,label:e.label,language:e.language,src:e.src}})};return e&&(t.poster=e,t.artwork=[{src:t.poster,type:$i(t.poster)}]),t},o.getTagSettings=function(e){var t,i={sources:[],tracks:[]},n=ae(e),r=n[\"data-setup\"];if(ee(e,\"vjs-fill\")&&(n.fill=!0),ee(e,\"vjs-fluid\")&&(n.fluid=!0),null!==r&&(r=(t=St(r||\"{}\"))[0],t=t[1],r&&h.error(r),b(n,t)),b(i,n),e.hasChildNodes())for(var a=e.childNodes,s=0,o=a.length;s<o;s++){var u=a[s],l=u.nodeName.toLowerCase();\"source\"===l?i.sources.push(ae(u)):\"track\"===l&&i.tracks.push(ae(u))}return i},e.flexNotSupported_=function(){var e=document.createElement(\"i\");return!(\"flexBasis\"in e.style||\"webkitFlexBasis\"in e.style||\"mozFlexBasis\"in e.style||\"msFlexBasis\"in e.style||\"msFlexOrder\"in e.style)},e.debug=function(e){if(void 0===e)return this.debugEnabled_;e?(this.trigger(\"debugon\"),this.previousLogLevel_=this.log.level,this.log.level(\"debug\"),this.debugEnabled_=!0):(this.trigger(\"debugoff\"),this.log.level(this.previousLogLevel_),this.previousLogLevel_=void 0,this.debugEnabled_=!1)},e.playbackRates=function(e){if(void 0===e)return this.cache_.playbackRates;Array.isArray(e)&&e.every(function(e){return\"number\"==typeof e})&&(this.cache_.playbackRates=e,this.trigger(\"playbackrateschange\"))},o}(pt);oi.names.forEach(function(e){var t=oi[e];Fn.prototype[t.getterName]=function(){return this.tech_?this.tech_[t.getterName]():(this[t.privateName]=this[t.privateName]||new t.ListClass,this[t.privateName])}}),Fn.prototype.crossorigin=Fn.prototype.crossOrigin,Fn.players={};k=window.navigator;Fn.prototype.options_={techOrder:ji.defaultTechOrder_,html5:{},inactivityTimeout:2e3,playbackRates:[],liveui:!1,children:[\"mediaLoader\",\"posterImage\",\"textTrackDisplay\",\"loadingSpinner\",\"bigPlayButton\",\"liveTracker\",\"controlBar\",\"errorDisplay\",\"textTrackSettings\",\"resizeManager\"],language:k&&(k.languages&&k.languages[0]||k.userLanguage||k.language)||\"en\",languages:{},notSupportedMessage:\"No compatible source was found for this media.\",normalizeAutoplay:!1,fullscreen:{options:{navigationUI:\"hide\"}},breakpoints:{},responsive:!1,audioOnlyMode:!1,audioPosterMode:!1},[\"ended\",\"seeking\",\"seekable\",\"networkState\",\"readyState\"].forEach(function(e){Fn.prototype[e]=function(){return this.techGet_(e)}}),Mn.forEach(function(e){Fn.prototype[\"handleTech\"+ut(e)+\"_\"]=function(){return this.trigger(e)}}),pt.registerComponent(\"Player\",Fn);var jn=m(function(i){function n(e,t){return i.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(e,t)}i.exports=n});function Hn(e){return Qn.hasOwnProperty(e)}function qn(e){return Hn(e)?Qn[e]:void 0}function Vn(e,t,i){i=(i?\"before\":\"\")+\"pluginsetup\",e.trigger(i,t),e.trigger(i+\":\"+t.name,t)}function Wn(t,i){function n(){Vn(this,{name:t,plugin:i,instance:null},!0);var e=i.apply(this,arguments);return $n(this,t),Vn(this,{name:t,plugin:i,instance:e}),e}return Object.keys(i).forEach(function(e){n[e]=i[e]}),n}function Gn(r,a){return a.prototype.name=r,function(){Vn(this,{name:r,plugin:a,instance:null},!0);for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var n=Xn(a,[this].concat(t));return this[r]=function(){return n},Vn(this,n.getEventHash()),n}}var zn=function(){if(\"undefined\"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if(\"function\"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}},Xn=m(function(n){function r(e,t,i){return zn()?n.exports=r=Reflect.construct:n.exports=r=function(e,t,i){var n=[null];n.push.apply(n,t);n=new(Function.bind.apply(e,n));return i&&jn(n,i.prototype),n},r.apply(null,arguments)}n.exports=r}),Kn=\"plugin\",Yn=\"activePlugins_\",Qn={},$n=function(e,t){e[Yn]=e[Yn]||{},e[Yn][t]=!0},Jn=function(){function i(e){if(this.constructor===i)throw new Error(\"Plugin must be sub-classed; not directly instantiated.\");this.player=e,this.log||(this.log=this.player.log.createLogger(this.name)),rt(this),delete this.trigger,st(this,this.constructor.defaultState),$n(e,this.name),this.dispose=this.dispose.bind(this),e.on(\"dispose\",this.dispose)}var e=i.prototype;return e.version=function(){return this.constructor.VERSION},e.getEventHash=function(e){return(e=void 0===e?{}:e).name=this.name,e.plugin=this.constructor,e.instance=this,e},e.trigger=function(e,t){return je(this.eventBusEl_,e,this.getEventHash(t=void 0===t?{}:t))},e.handleStateChanged=function(e){},e.dispose=function(){var e=this.name,t=this.player;this.trigger(\"dispose\"),this.off(),t.off(\"dispose\",this.dispose),t[Yn][e]=!1,this.player=this.state=null,t[e]=Gn(e,Qn[e])},i.isBasic=function(e){e=\"string\"==typeof e?qn(e):e;return\"function\"==typeof e&&!i.prototype.isPrototypeOf(e.prototype)},i.registerPlugin=function(e,t){if(\"string\"!=typeof e)throw new Error('Illegal plugin name, \"'+e+'\", must be a string, was '+typeof e+\".\");if(Hn(e))h.warn('A plugin named \"'+e+'\" already exists. You may want to avoid re-registering plugins!');else if(Fn.prototype.hasOwnProperty(e))throw new Error('Illegal plugin name, \"'+e+'\", cannot share a name with an existing player method!');if(\"function\"!=typeof t)throw new Error('Illegal plugin for \"'+e+'\", must be a function, was '+typeof t+\".\");return Qn[e]=t,e!==Kn&&(i.isBasic(t)?Fn.prototype[e]=Wn(e,t):Fn.prototype[e]=Gn(e,t)),t},i.deregisterPlugin=function(e){if(e===Kn)throw new Error(\"Cannot de-register base plugin.\");Hn(e)&&(delete Qn[e],delete Fn.prototype[e])},i.getPlugins=function(e){var i;return(e=void 0===e?Object.keys(Qn):e).forEach(function(e){var t=qn(e);t&&((i=i||{})[e]=t)}),i},i.getPluginVersion=function(e){e=qn(e);return e&&e.VERSION||\"\"},i}();Jn.getPlugin=qn,Jn.BASE_PLUGIN_NAME=Kn,Jn.registerPlugin(Kn,Jn),Fn.prototype.usingPlugin=function(e){return!!this[Yn]&&!0===this[Yn][e]},Fn.prototype.hasPlugin=function(e){return!!Hn(e)};var Zn=function(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function\");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&jn(e,t)},er=function(e){return 0===e.indexOf(\"#\")?e.slice(1):e};function tr(e,t,i){if(r=tr.getPlayer(e))return t&&h.warn('Player \"'+e+'\" is already initialised. Options will not be applied.'),i&&r.ready(i),r;var n=\"string\"==typeof e?Te(\"#\"+er(e)):e;if(!K(n))throw new TypeError(\"The element or ID supplied is not valid. (videojs)\");n.ownerDocument.defaultView&&n.ownerDocument.body.contains(n)||h.warn(\"The element supplied is not included in the DOM\"),!0===(t=t||{}).restoreEl&&(t.restoreEl=(n.parentNode&&n.parentNode.hasAttribute(\"data-vjs-player\")?n.parentNode:n).cloneNode(!0)),a(\"beforesetup\").forEach(function(e){e=e(n,lt(t));T(e)&&!Array.isArray(e)?t=lt(t,e):h.error(\"please return an object in beforesetup hooks\")});var r=new(pt.getComponent(\"Player\"))(n,t,i);return a(\"setup\").forEach(function(e){return e(r)}),r}tr.hooks_=i,tr.hooks=a,tr.hook=function(e,t){a(e,t)},tr.hookOnce=function(i,e){a(i,[].concat(e).map(function(t){return function e(){return n(i,e),t.apply(void 0,arguments)}}))},tr.removeHook=n,!0!==window.VIDEOJS_NO_DYNAMIC_STYLE&&X()&&((ar=Te(\".vjs-styles-defaults\"))||(ar=xe(\"vjs-styles-defaults\"),(k=Te(\"head\"))&&k.insertBefore(ar,k.firstChild),Ae(ar,\"\\n      .video-js {\\n        width: 300px;\\n        height: 150px;\\n      }\\n\\n      .vjs-fluid:not(.vjs-audio-only-mode) {\\n        padding-top: 56.25%\\n      }\\n    \"))),Ce(1,tr),tr.VERSION=u,tr.options=Fn.prototype.options_,tr.getPlayers=function(){return Fn.players},tr.getPlayer=function(e){var t=Fn.players;if(\"string\"==typeof e){var i=er(e),n=t[i];if(n)return n;i=Te(\"#\"+i)}else i=e;if(K(i)){e=i.player,i=i.playerId;if(e||t[i])return e||t[i]}},tr.getAllPlayers=function(){return Object.keys(Fn.players).map(function(e){return Fn.players[e]}).filter(Boolean)},tr.players=Fn.players,tr.getComponent=pt.getComponent,tr.registerComponent=function(e,t){ji.isTech(t)&&h.warn(\"The \"+e+\" tech was registered as a component. It should instead be registered using videojs.registerTech(name, tech)\"),pt.registerComponent.call(pt,e,t)},tr.getTech=ji.getTech,tr.registerTech=ji.registerTech,tr.use=function(e,t){Hi[e]=Hi[e]||[],Hi[e].push(t)},Object.defineProperty(tr,\"middleware\",{value:{},writeable:!1,enumerable:!0}),Object.defineProperty(tr.middleware,\"TERMINATOR\",{value:Vi,writeable:!1,enumerable:!0}),tr.browser=W,tr.TOUCH_ENABLED=F,tr.extend=function(e,t){var i,n=function(){e.apply(this,arguments)},r={};for(i in\"object\"==typeof(t=void 0===t?{}:t)?(t.constructor!==Object.prototype.constructor&&(n=t.constructor),r=t):\"function\"==typeof t&&(n=t),Zn(n,e),e&&(n.super_=e),r)r.hasOwnProperty(i)&&(n.prototype[i]=r[i]);return n},tr.mergeOptions=lt,tr.bind=Ve,tr.registerPlugin=Jn.registerPlugin,tr.deregisterPlugin=Jn.deregisterPlugin,tr.plugin=function(e,t){return h.warn(\"videojs.plugin() is deprecated; use videojs.registerPlugin() instead\"),Jn.registerPlugin(e,t)},tr.getPlugins=Jn.getPlugins,tr.getPlugin=Jn.getPlugin,tr.getPluginVersion=Jn.getPluginVersion,tr.addLanguage=function(e,t){var i;return e=(\"\"+e).toLowerCase(),tr.options.languages=lt(tr.options.languages,((i={})[e]=t,i)),tr.options.languages[e]},tr.log=h,tr.createLogger=p,tr.createTimeRange=tr.createTimeRanges=vt,tr.formatTime=ln,tr.setFormatTime=function(e){un=e},tr.resetFormatTime=function(){un=on},tr.parseUrl=Mt,tr.isCrossOrigin=Ut,tr.EventTarget=ze,tr.on=Be,tr.one=He,tr.off=Fe,tr.trigger=je,tr.xhr=Jt,tr.TextTrack=ri,tr.AudioTrack=x,tr.VideoTrack=U,[\"isEl\",\"isTextNode\",\"createEl\",\"hasClass\",\"addClass\",\"removeClass\",\"toggleClass\",\"setAttributes\",\"getAttributes\",\"emptyEl\",\"appendContent\",\"insertContent\"].forEach(function(e){tr[e]=function(){return h.warn(\"videojs.\"+e+\"() is deprecated; use videojs.dom.\"+e+\"() instead\"),we[e].apply(null,arguments)}}),tr.computedStyle=w,tr.dom=we,tr.url=zt,tr.defineLazyProperty=An,tr.addLanguage(\"en\",{\"Non-Fullscreen\":\"Exit Fullscreen\"});function ir(e,t){if(/^[a-z]+:/i.test(t))return t;/^data:/.test(e)&&(e=window.location&&window.location.href||\"\");var i=\"function\"==typeof window.URL,n=/^\\/\\//.test(e),r=!window.location&&!/\\/\\//i.test(e);if(i?e=new window.URL(e,window.location||rr):/\\/\\//i.test(e)||(e=nr.buildAbsoluteURL(window.location&&window.location.href||\"\",e)),i){i=new URL(t,e);return r?i.href.slice(rr.length):n?i.href.slice(i.protocol.length):i.href}return nr.buildAbsoluteURL(e,t)}var nr=m(function(e,t){var i,a,n,r,s;i=/^((?:[a-zA-Z0-9+\\-.]+:)?)(\\/\\/[^\\/?#]*)?((?:[^\\/?#]*\\/)*[^;?#]*)?(;[^?#]*)?(\\?[^#]*)?(#[^]*)?$/,a=/^([^\\/?#]*)([^]*)$/,n=/(?:\\/|^)\\.(?=\\/)/g,r=/(?:\\/|^)\\.\\.\\/(?!\\.\\.\\/)[^\\/]*(?=\\/)/g,s={buildAbsoluteURL:function(e,t,i){if(i=i||{},e=e.trim(),!(t=t.trim())){if(!i.alwaysNormalize)return e;var n=s.parseURL(e);if(!n)throw new Error(\"Error trying to parse base URL.\");return n.path=s.normalizePath(n.path),s.buildURLFromParts(n)}n=s.parseURL(t);if(!n)throw new Error(\"Error trying to parse relative URL.\");if(n.scheme)return i.alwaysNormalize?(n.path=s.normalizePath(n.path),s.buildURLFromParts(n)):t;t=s.parseURL(e);if(!t)throw new Error(\"Error trying to parse base URL.\");!t.netLoc&&t.path&&\"/\"!==t.path[0]&&(r=a.exec(t.path),t.netLoc=r[1],t.path=r[2]),t.netLoc&&!t.path&&(t.path=\"/\");var r,e={scheme:t.scheme,netLoc:n.netLoc,path:null,params:n.params,query:n.query,fragment:n.fragment};return n.netLoc||(e.netLoc=t.netLoc,\"/\"!==n.path[0]&&(n.path?(r=(r=t.path).substring(0,r.lastIndexOf(\"/\")+1)+n.path,e.path=s.normalizePath(r)):(e.path=t.path,n.params||(e.params=t.params,n.query||(e.query=t.query))))),null===e.path&&(e.path=i.alwaysNormalize?s.normalizePath(n.path):n.path),s.buildURLFromParts(e)},parseURL:function(e){e=i.exec(e);return e?{scheme:e[1]||\"\",netLoc:e[2]||\"\",path:e[3]||\"\",params:e[4]||\"\",query:e[5]||\"\",fragment:e[6]||\"\"}:null},normalizePath:function(e){for(e=e.split(\"\").reverse().join(\"\").replace(n,\"\");e.length!==(e=e.replace(r,\"\")).length;);return e.split(\"\").reverse().join(\"\")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},e.exports=s}),rr=\"http://example.com\",ar=function(){function e(){this.listeners={}}var t=e.prototype;return t.on=function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},t.off=function(e,t){if(!this.listeners[e])return!1;t=this.listeners[e].indexOf(t);return this.listeners[e]=this.listeners[e].slice(0),this.listeners[e].splice(t,1),-1<t},t.trigger=function(e){var t=this.listeners[e];if(t)if(2===arguments.length)for(var i=t.length,n=0;n<i;++n)t[n].call(this,arguments[1]);else for(var r=Array.prototype.slice.call(arguments,1),a=t.length,s=0;s<a;++s)t[s].apply(this,r)},t.dispose=function(){this.listeners={}},t.pipe=function(t){this.on(\"data\",function(e){t.push(e)})},e}(),sr=function(e){return window.atob?window.atob(e):Buffer.from(e,\"base64\").toString(\"binary\")};function or(e){for(var t=sr(e),i=new Uint8Array(t.length),n=0;n<t.length;n++)i[n]=t.charCodeAt(n);return i}",
          "23: var c=null,m=function(){function e(e){var t,i,n;c=c||function(){for(var e,t,i,n,r,a,s,o=[[[],[],[],[],[]],[[],[],[],[],[]]],u=o[0],l=o[1],c=u[4],d=l[4],h=[],p=[],f=0;f<256;f++)p[(h[f]=f<<1^283*(f>>7))^f]=f;for(e=t=0;!c[e];e^=i||1,t=p[t]||1)for(s=16843009*h[n=h[i=h[d[c[e]=r=(r=t^t<<1^t<<2^t<<3^t<<4)>>8^255&r^99]=e]]]^65537*n^257*i^16843008*e,a=257*h[r]^16843008*r,f=0;f<4;f++)u[f][e]=a=a<<24^a>>>8,l[f][r]=s=s<<24^s>>>8;for(f=0;f<5;f++)u[f]=u[f].slice(0),l[f]=l[f].slice(0);return o}(),this._tables=[[c[0][0].slice(),c[0][1].slice(),c[0][2].slice(),c[0][3].slice(),c[0][4].slice()],[c[1][0].slice(),c[1][1].slice(),c[1][2].slice(),c[1][3].slice(),c[1][4].slice()]];var r=this._tables[0][4],a=this._tables[1],s=e.length,o=1;if(4!==s&&6!==s&&8!==s)throw new Error(\"Invalid aes key size\");var u=e.slice(0),l=[];for(this._key=[u,l],t=s;t<4*s+28;t++)n=u[t-1],(t%s==0||8===s&&t%s==4)&&(n=r[n>>>24]<<24^r[n>>16&255]<<16^r[n>>8&255]<<8^r[255&n],t%s==0&&(n=n<<8^n>>>24^o<<24,o=o<<1^283*(o>>7))),u[t]=u[t-s]^n;for(i=0;t;i++,t--)n=u[3&i?t:t-4],l[i]=t<=4||i<4?n:a[0][r[n>>>24]]^a[1][r[n>>16&255]]^a[2][r[n>>8&255]]^a[3][r[255&n]]}return e.prototype.decrypt=function(e,t,i,n,r,a){for(var s,o,u,l=this._key[1],c=e^l[0],d=n^l[1],h=i^l[2],p=t^l[3],f=l.length/4-2,m=4,t=this._tables[1],g=t[0],y=t[1],v=t[2],_=t[3],b=t[4],T=0;T<f;T++)s=g[c>>>24]^y[d>>16&255]^v[h>>8&255]^_[255&p]^l[m],o=g[d>>>24]^y[h>>16&255]^v[p>>8&255]^_[255&c]^l[m+1],u=g[h>>>24]^y[p>>16&255]^v[c>>8&255]^_[255&d]^l[m+2],p=g[p>>>24]^y[c>>16&255]^v[d>>8&255]^_[255&h]^l[m+3],m+=4,c=s,d=o,h=u;for(T=0;T<4;T++)r[(3&-T)+a]=b[c>>>24]<<24^b[d>>16&255]<<16^b[h>>8&255]<<8^b[255&p]^l[m++],s=c,c=d,d=h,h=p,p=s},e}(),l=function(t){function e(){var e=t.call(this,a)||this;return e.jobs=[],e.delay=1,e.timeout_=null,e}r(e,t);var i=e.prototype;return i.processJob_=function(){this.jobs.shift()(),this.jobs.length?this.timeout_=setTimeout(this.processJob_.bind(this),this.delay):this.timeout_=null},i.push=function(e){this.jobs.push(e),this.timeout_||(this.timeout_=setTimeout(this.processJob_.bind(this),this.delay))},e}(a),g=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},s=function(){function u(e,t,i,n){var r=u.STEP,a=new Int32Array(e.buffer),s=new Uint8Array(e.byteLength),o=0;for(this.asyncStream_=new l,this.asyncStream_.push(this.decryptChunk_(a.subarray(o,o+r),t,i,s)),o=r;o<a.length;o+=r)i=new Uint32Array([g(a[o-4]),g(a[o-3]),g(a[o-2]),g(a[o-1])]),this.asyncStream_.push(this.decryptChunk_(a.subarray(o,o+r),t,i,s));this.asyncStream_.push(function(){",
          "25: var e;n(null,(e=s).subarray(0,e.byteLength-e[e.byteLength-1]))})}return u.prototype.decryptChunk_=function(t,i,n,r){return function(){var e=function(e,t,i){for(var n,r,a,s,o=new Int32Array(e.buffer,e.byteOffset,e.byteLength>>2),u=new m(Array.prototype.slice.call(t)),e=new Uint8Array(e.byteLength),l=new Int32Array(e.buffer),c=i[0],d=i[1],h=i[2],p=i[3],f=0;f<o.length;f+=4)n=g(o[f]),r=g(o[f+1]),a=g(o[f+2]),s=g(o[f+3]),u.decrypt(n,r,a,s,l,f),l[f]=g(l[f]^c),l[f+1]=g(l[f+1]^d),l[f+2]=g(l[f+2]^h),l[f+3]=g(l[f+3]^p),c=n,d=r,h=a,p=s;return e}(t,i,n);r.set(e,t.byteOffset)}},i(u,null,[{key:\"STEP\",get:function(){return 32e3}}]),u}(),e=\"undefined\"!=typeof window?window:\"undefined\"!=typeof e?e:\"undefined\"!=typeof self?self:{},e=e.BigInt||Number;e(\"0x1\"),e(\"0x100\"),e(\"0x10000\"),e(\"0x1000000\"),e(\"0x100000000\"),e(\"0x10000000000\"),e(\"0x1000000000000\"),e(\"0x100000000000000\"),e(\"0x10000000000000000\");function o(n){var r={};return Object.keys(n).forEach(function(e){var t,i=n[e];t=i,(\"function\"===ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer)?r[e]={bytes:i.buffer,byteOffset:i.byteOffset,byteLength:i.byteLength}:r[e]=i}),r}self.onmessage=function(e){var i=e.data,t=new Uint8Array(i.encrypted.bytes,i.encrypted.byteOffset,i.encrypted.byteLength),n=new Uint32Array(i.key.bytes,i.key.byteOffset,i.key.byteLength/4),e=new Uint32Array(i.iv.bytes,i.iv.byteOffset,i.iv.byteLength/4);new s(t,n,e,function(e,t){self.postMessage(o({source:i.source,decrypted:t}),[t.buffer])})}}))),mc={AUDIO:function(s,o){return function(){var e=o.segmentLoaders[s],t=o.mediaTypes[s],i=o.blacklistCurrentPlaylist;Wl(e,t);var n=t.activeTrack(),e=t.activeGroup(),e=(e.filter(function(e){return e.default})[0]||e[0]).id,r=t.tracks[e];if(n!==r){for(var a in tr.log.warn(\"Problem encountered loading the alternate audio track.Switching back to default.\"),t.tracks)t.tracks[a].enabled=t.tracks[a]===r;t.onTrackChanged()}else i({message:\"Problem encountered loading the default audio track.\"})}},SUBTITLES:function(i,n){return function(){var e=n.segmentLoaders[i],t=n.mediaTypes[i];tr.log.warn(\"Problem encountered loading the subtitle track.Disabling subtitle track.\"),Wl(e,t);e=t.activeTrack();e&&(e.mode=\"disabled\"),t.onTrackChanged()}}},gc={AUDIO:function(e,t,i){var n,r,a;t&&(n=i.tech,r=i.requestOptions,a=i.segmentLoaders[e],t.on(\"loadedmetadata\",function(){var e=t.media();a.playlist(e,r),(!n.paused()||e.endList&&\"none\"!==n.preload())&&a.load()}),t.on(\"loadedplaylist\",function(){a.playlist(t.media(),r),n.paused()||a.load()}),t.on(\"error\",mc[e](e,i)))},SUBTITLES:function(e,t,i){var n=i.tech,r=i.requestOptions,a=i.segmentLoaders[e],s=i.mediaTypes[e];t.on(\"loadedmetadata\",function(){var e=t.media();a.playlist(e,r),a.track(s.activeTrack()),(!n.paused()||e.endList&&\"none\"!==n.preload())&&a.load()}),t.on(\"loadedplaylist\",function(){a.playlist(t.media(),r),n.paused()||a.load()}),t.on(\"error\",mc[e](e,i))}},yc={AUDIO:function(e,t){var i,n,r=t.vhs,a=t.sourceType,s=t.segmentLoaders[e],o=t.requestOptions,u=t.master.mediaGroups,l=t.mediaTypes[e],c=l.groups,d=l.tracks,h=l.logger_,p=t.masterPlaylistLoader,f=au(p.master);for(i in u[e]&&0!==Object.keys(u[e]).length||(u[e]={main:{default:{default:!0}}},f&&(u[e].main.default.playlists=p.master.playlists)),u[e])for(var m in c[i]||(c[i]=[]),u[e][i]){var g=u[e][i][m],y=void 0,y=f?(h(\"AUDIO group '\"+i+\"' label '\"+m+\"' is a master playlist\"),g.isMasterPlaylist=!0,null):\"vhs-json\"===a&&g.playlists?new _l(g.playlists[0],r,o):g.resolvedUri?new _l(g.resolvedUri,r,o):g.playlists&&\"dash\"===a?new wl(g.playlists[0],r,o,p):null,g=tr.mergeOptions({id:m,playlistLoader:y},g);gc[e](e,g.playlistLoader,t),c[i].push(g),\"undefined\"==typeof d[m]&&(g=new tr.AudioTrack({id:m,kind:(n=void 0,n=(y=g).default?\"main\":\"alternative\",n=y.characteristics&&0<=y.characteristics.indexOf(\"public.accessibility.describes-video\")?\"main-desc\":n),enabled:!1,language:g.language,default:g.default,label:m}),d[m]=g)}s.on(\"error\",mc[e](e,t))},SUBTITLES:function(e,t){var i,n=t.tech,r=t.vhs,a=t.sourceType,s=t.segmentLoaders[e],o=t.requestOptions,u=t.master.mediaGroups,l=t.mediaTypes[e],c=l.groups,d=l.tracks,h=t.masterPlaylistLoader;for(i in u[e])for(var p in c[i]||(c[i]=[]),u[e][i])if(!u[e][i][p].forced){var f=u[e][i][p],m=void 0;if(\"hls\"===a)m=new _l(f.resolvedUri,r,o);else if(\"dash\"===a){if(!f.playlists.filter(function(e){return e.excludeUntil!==1/0}).length)return;m=new wl(f.playlists[0],r,o,h)}else\"vhs-json\"===a&&(m=new _l(f.playlists?f.playlists[0]:f.resolvedUri,r,o));f=tr.mergeOptions({id:p,playlistLoader:m},f),gc[e](e,f.playlistLoader,t),c[i].push(f),\"undefined\"==typeof d[p]&&(f=n.addRemoteTextTrack({id:p,kind:\"subtitles\",default:f.default&&f.autoselect,language:f.language,label:p},!1).track,d[p]=f)}s.on(\"error\",mc[e](e,t))},\"CLOSED-CAPTIONS\":function(e,t){var i,n=t.tech,r=t.master.mediaGroups,t=t.mediaTypes[e],a=t.groups,s=t.tracks;for(i in r[e])for(var o in a[i]||(a[i]=[]),r[e][i]){var u,l,c=r[e][i][o];/^(?:CC|SERVICE)/.test(c.instreamId)&&(void 0===(l=(u=n.options_.vhs&&n.options_.vhs.captionServices||{})[(l={label:o,language:c.language,instreamId:c.instreamId,default:c.default&&c.autoselect}).instreamId]?tr.mergeOptions(l,u[l.instreamId]):l).default&&delete l.default,a[i].push(tr.mergeOptions({id:o},c)),\"undefined\"==typeof s[o]&&(l=n.addRemoteTextTrack({id:l.instreamId,kind:\"captions\",default:l.default,language:l.language,label:l.label},!1).track,s[o]=l))}}},vc={AUDIO:function(i,n){return function(){var e,t=n.mediaTypes[i].tracks;for(e in t)if(t[e].enabled)return t[e];return null}},SUBTITLES:function(i,n){return function(){var e,t=n.mediaTypes[i].tracks;for(e in t)if(\"showing\"===t[e].mode||\"hidden\"===t[e].mode)return t[e];return null}}},_c=[\"mediaRequests\",\"mediaRequestsAborted\",\"mediaRequestsTimedout\",\"mediaRequestsErrored\",\"mediaTransferDuration\",\"mediaBytesTransferred\",\"mediaAppends\"],bc=function(v){function e(e){var t=v.call(this)||this,i=e.src,n=e.handleManifestRedirects,r=e.withCredentials,a=e.tech,s=e.bandwidth,o=e.externVhs,u=e.useCueTags,l=e.blacklistDuration,c=e.enableLowInitialPlaylist,d=e.sourceType,h=e.cacheEncryptionKeys,p=e.experimentalBufferBasedABR,f=e.experimentalLeastPixelDiffSelector,m=e.captionServices;if(!i)throw new Error(\"A non-empty playlist URL or JSON manifest string is required\");var g,y=e.maxPlaylistRetries;null!==y&&\"undefined\"!=typeof y||(y=1/0),Ql=o,t.experimentalBufferBasedABR=Boolean(p),t.experimentalLeastPixelDiffSelector=Boolean(f),t.withCredentials=r,t.tech_=a,t.vhs_=a.vhs,t.sourceType_=d,t.useCueTags_=u,t.blacklistDuration=l,t.maxPlaylistRetries=y,t.enableLowInitialPlaylist=c,t.useCueTags_&&(t.cueTagsTrack_=t.tech_.addTextTrack(\"metadata\",\"ad-cues\"),t.cueTagsTrack_.inBandMetadataTrackDispatchType=\"\"),t.requestOptions_={withCredentials:r,handleManifestRedirects:n,maxPlaylistRetries:y,timeout:null},t.on(\"error\",t.pauseLoading),t.mediaTypes_=(g={},[\"AUDIO\",\"SUBTITLES\",\"CLOSED-CAPTIONS\"].forEach(function(e){g[e]={groups:{},tracks:{},activePlaylistLoader:null,activeGroup:Rl,activeTrack:Rl,getActiveGroup:Rl,onGroupChanged:Rl,onTrackChanged:Rl,lastTrack_:null,logger_:Ro(\"MediaGroups[\"+e+\"]\")}}),g),t.mediaSource=new window.MediaSource,t.handleDurationChange_=t.handleDurationChange_.bind(ft(t)),t.handleSourceOpen_=t.handleSourceOpen_.bind(ft(t)),t.handleSourceEnded_=t.handleSourceEnded_.bind(ft(t)),t.mediaSource.addEventListener(\"durationchange\",t.handleDurationChange_),t.mediaSource.addEventListener(\"sourceopen\",t.handleSourceOpen_),t.mediaSource.addEventListener(\"sourceended\",t.handleSourceEnded_),t.seekable_=tr.createTimeRanges(),t.hasPlayed_=!1,t.syncController_=new hc(e),t.segmentMetadataTrack_=a.addRemoteTextTrack({kind:\"metadata\",label:\"segment-metadata\"},!1).track,t.decrypter_=new fc,t.sourceUpdater_=new uc(t.mediaSource),t.inbandTextTracks_={},t.timelineChangeController_=new pc;h={vhs:t.vhs_,parse708captions:e.parse708captions,useDtsForTimestampOffset:e.useDtsForTimestampOffset,captionServices:m,mediaSource:t.mediaSource,currentTime:t.tech_.currentTime.bind(t.tech_),seekable:function(){return t.seekable()},seeking:function(){return t.tech_.seeking()},duration:function(){return t.duration()},hasPlayed:function(){return t.hasPlayed_},goalBufferLength:function(){return t.goalBufferLength()},bandwidth:s,syncController:t.syncController_,decrypter:t.decrypter_,sourceType:t.sourceType_,inbandTextTracks:t.inbandTextTracks_,cacheEncryptionKeys:h,sourceUpdater:t.sourceUpdater_,timelineChangeController:t.timelineChangeController_,experimentalExactManifestTimings:e.experimentalExactManifestTimings};t.masterPlaylistLoader_=new(\"dash\"===t.sourceType_?wl:_l)(i,t.vhs_,t.requestOptions_),t.setupMasterPlaylistLoaderListeners_(),t.mainSegmentLoader_=new Ml(tr.mergeOptions(h,{segmentMetadataTrack:t.segmentMetadataTrack_,loaderType:\"main\"}),e),t.audioSegmentLoader_=new Ml(tr.mergeOptions(h,{loaderType:\"audio\"}),e),t.subtitleSegmentLoader_=new cc(tr.mergeOptions(h,{loaderType:\"vtt\",featuresNativeTextTracks:t.tech_.featuresNativeTextTracks}),e),t.setupSegmentLoaderListeners_(),t.experimentalBufferBasedABR&&(t.masterPlaylistLoader_.one(\"loadedplaylist\",function(){return t.startABRTimer_()}),t.tech_.on(\"pause\",function(){return t.stopABRTimer_()}),t.tech_.on(\"play\",function(){return t.startABRTimer_()})),_c.forEach(function(e){t[e+\"_\"]=function(e){return this.audioSegmentLoader_[e]+this.mainSegmentLoader_[e]}.bind(ft(t),e)}),t.logger_=Ro(\"MPC\"),t.triggeredFmp4Usage=!1,\"none\"===t.tech_.preload()?(t.loadOnPlay_=function(){t.loadOnPlay_=null,t.masterPlaylistLoader_.load()},t.tech_.one(\"play\",t.loadOnPlay_)):t.masterPlaylistLoader_.load(),t.timeToLoadedData__=-1,t.mainAppendsToLoadedData__=-1,t.audioAppendsToLoadedData__=-1;e=\"none\"===t.tech_.preload()?\"play\":\"loadstart\";return t.tech_.one(e,function(){var e=Date.now();t.tech_.one(\"loadeddata\",function(){t.timeToLoadedData__=Date.now()-e,t.mainAppendsToLoadedData__=t.mainSegmentLoader_.mediaAppends,t.audioAppendsToLoadedData__=t.audioSegmentLoader_.mediaAppends})}),t}mt(e,v);var t=e.prototype;return t.mainAppendsToLoadedData_=function(){return this.mainAppendsToLoadedData__},t.audioAppendsToLoadedData_=function(){return this.audioAppendsToLoadedData__},t.appendsToLoadedData_=function(){var e=this.mainAppendsToLoadedData_(),t=this.audioAppendsToLoadedData_();return-1===e||-1===t?-1:e+t},t.timeToLoadedData_=function(){return this.timeToLoadedData__},t.checkABR_=function(){var e=this.selectPlaylist();e&&this.shouldSwitchToMedia_(e)&&this.switchMedia_(e,\"abr\")},t.switchMedia_=function(e,t,i){var n=this.media(),r=n&&(n.id||n.uri),n=e.id||e.uri;r&&r!==n&&(this.logger_(\"switch media \"+r+\" -> \"+n+\" from \"+t),this.tech_.trigger({type:\"usage\",name:\"vhs-rendition-change-\"+t})),this.masterPlaylistLoader_.media(e,i)},t.startABRTimer_=function(){var e=this;this.stopABRTimer_(),this.abrTimer_=window.setInterval(function(){return e.checkABR_()},250)},t.stopABRTimer_=function(){this.tech_.scrubbing&&this.tech_.scrubbing()||(window.clearInterval(this.abrTimer_),this.abrTimer_=null)},t.getAudioTrackPlaylists_=function(){var e=this.master(),t=e&&e.playlists||[];if(!e||!e.mediaGroups||!e.mediaGroups.AUDIO)return t;var i,n=e.mediaGroups.AUDIO,r=Object.keys(n);if(Object.keys(this.mediaTypes_.AUDIO.groups).length)i=this.mediaTypes_.AUDIO.activeTrack();else{var a,s=n.main||r.length&&n[r[0]];for(a in s)if(s[a].default){i={label:a};break}}if(!i)return t;var o,u=[];for(o in n)if(n[o][i.label]){var l=n[o][i.label];if(l.playlists&&l.playlists.length)u.push.apply(u,l.playlists);else if(l.uri)u.push(l);else if(e.playlists.length)for(var c=0;c<e.playlists.length;c++){var d=e.playlists[c];d.attributes&&d.attributes.AUDIO&&d.attributes.AUDIO===o&&u.push(d)}}return u.length?u:t},t.setupMasterPlaylistLoaderListeners_=function(){var i=this;this.masterPlaylistLoader_.on(\"loadedmetadata\",function(){var e=i.masterPlaylistLoader_.media(),t=1.5*e.targetDuration*1e3;iu(i.masterPlaylistLoader_.master,i.masterPlaylistLoader_.media())?i.requestOptions_.timeout=0:i.requestOptions_.timeout=t,e.endList&&\"none\"!==i.tech_.preload()&&(i.mainSegmentLoader_.playlist(e,i.requestOptions_),i.mainSegmentLoader_.load()),Xl({sourceType:i.sourceType_,segmentLoaders:{AUDIO:i.audioSegmentLoader_,SUBTITLES:i.subtitleSegmentLoader_,main:i.mainSegmentLoader_},tech:i.tech_,requestOptions:i.requestOptions_,masterPlaylistLoader:i.masterPlaylistLoader_,vhs:i.vhs_,master:i.master(),mediaTypes:i.mediaTypes_,blacklistCurrentPlaylist:i.blacklistCurrentPlaylist.bind(i)}),i.triggerPresenceUsage_(i.master(),e),i.setupFirstPlay(),!i.mediaTypes_.AUDIO.activePlaylistLoader||i.mediaTypes_.AUDIO.activePlaylistLoader.media()?i.trigger(\"selectedinitialmedia\"):i.mediaTypes_.AUDIO.activePlaylistLoader.one(\"loadedmetadata\",function(){i.trigger(\"selectedinitialmedia\")})}),this.masterPlaylistLoader_.on(\"loadedplaylist\",function(){i.loadOnPlay_&&i.tech_.off(\"play\",i.loadOnPlay_);var e,t=i.masterPlaylistLoader_.media();if(!t){if(i.excludeUnsupportedVariants_(),!(e=(e=i.enableLowInitialPlaylist?i.selectInitialPlaylist():e)||i.selectPlaylist())||!i.shouldSwitchToMedia_(e))return;if(i.initialMedia_=e,i.switchMedia_(i.initialMedia_,\"initial\"),!(\"vhs-json\"===i.sourceType_&&i.initialMedia_.segments))return;t=i.initialMedia_}i.handleUpdatedMediaPlaylist(t)}),this.masterPlaylistLoader_.on(\"error\",function(){i.blacklistCurrentPlaylist(i.masterPlaylistLoader_.error)}),this.masterPlaylistLoader_.on(\"mediachanging\",function(){i.mainSegmentLoader_.abort(),i.mainSegmentLoader_.pause()}),this.masterPlaylistLoader_.on(\"mediachange\",function(){var e=i.masterPlaylistLoader_.media(),t=1.5*e.targetDuration*1e3;iu(i.masterPlaylistLoader_.master,i.masterPlaylistLoader_.media())?i.requestOptions_.timeout=0:i.requestOptions_.timeout=t,i.mainSegmentLoader_.playlist(e,i.requestOptions_),i.mainSegmentLoader_.load(),i.tech_.trigger({type:\"mediachange\",bubbles:!0})}),this.masterPlaylistLoader_.on(\"playlistunchanged\",function(){var e=i.masterPlaylistLoader_.media();\"playlist-unchanged\"!==e.lastExcludeReason_&&i.stuckAtPlaylistEnd_(e)&&(i.blacklistCurrentPlaylist({message:\"Playlist no longer updating.\",reason:\"playlist-unchanged\"}),i.tech_.trigger(\"playliststuck\"))}),this.masterPlaylistLoader_.on(\"renditiondisabled\",function(){i.tech_.trigger({type:\"usage\",name:\"vhs-rendition-disabled\"}),i.tech_.trigger({type:\"usage\",name:\"hls-rendition-disabled\"})}),this.masterPlaylistLoader_.on(\"renditionenabled\",function(){i.tech_.trigger({type:\"usage\",name:\"vhs-rendition-enabled\"}),i.tech_.trigger({type:\"usage\",name:\"hls-rendition-enabled\"})})},t.handleUpdatedMediaPlaylist=function(e){this.useCueTags_&&this.updateAdCues_(e),this.mainSegmentLoader_.playlist(e,this.requestOptions_),this.updateDuration(!e.endList),this.tech_.paused()||(this.mainSegmentLoader_.load(),this.audioSegmentLoader_&&this.audioSegmentLoader_.load())},t.triggerPresenceUsage_=function(e,t){var i,n=e.mediaGroups||{},r=!0,e=Object.keys(n.AUDIO);for(i in n.AUDIO)for(var a in n.AUDIO[i])n.AUDIO[i][a].uri||(r=!1);r&&(this.tech_.trigger({type:\"usage\",name:\"vhs-demuxed\"}),this.tech_.trigger({type:\"usage\",name:\"hls-demuxed\"})),Object.keys(n.SUBTITLES).length&&(this.tech_.trigger({type:\"usage\",name:\"vhs-webvtt\"}),this.tech_.trigger({type:\"usage\",name:\"hls-webvtt\"})),Ql.Playlist.isAes(t)&&(this.tech_.trigger({type:\"usage\",name:\"vhs-aes\"}),this.tech_.trigger({type:\"usage\",name:\"hls-aes\"})),e.length&&1<Object.keys(n.AUDIO[e[0]]).length&&(this.tech_.trigger({type:\"usage\",name:\"vhs-alternate-audio\"}),this.tech_.trigger({type:\"usage\",name:\"hls-alternate-audio\"})),this.useCueTags_&&(this.tech_.trigger({type:\"usage\",name:\"vhs-playlist-cue-tags\"}),this.tech_.trigger({type:\"usage\",name:\"hls-playlist-cue-tags\"}))},t.shouldSwitchToMedia_=function(e){var t=this.masterPlaylistLoader_.media()||this.masterPlaylistLoader_.pendingMedia_,i=this.tech_.currentTime(),n=this.bufferLowWaterLine(),r=this.bufferHighWaterLine();return function(e){var t=e.currentPlaylist,i=e.buffered,n=e.currentTime,r=e.nextPlaylist,a=e.bufferLowWaterLine,s=e.bufferHighWaterLine,o=e.duration,u=e.experimentalBufferBasedABR,l=e.log;if(!r)return tr.log.warn(\"We received no playlist to switch to. Please check your stream.\"),!1;var c=\"allowing switch \"+(t&&t.id||\"null\")+\" -> \"+r.id;if(!t)return l(c+\" as current playlist is not set\"),!0;if(r.id===t.id)return!1;e=Boolean(Uo(i,n).length);if(!t.endList)return e||\"number\"!=typeof t.partTargetDuration?(l(c+\" as current playlist is live\"),!0):(l(\"not \"+c+\" as current playlist is live llhls, but currentTime isn't in buffered.\"),!1);i=qo(i,n),n=u?El.EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE:El.MAX_BUFFER_LOW_WATER_LINE;if(o<n)return l(c+\" as duration < max low water line (\"+o+\" < \"+n+\")\"),!0;n=r.attributes.BANDWIDTH,r=t.attributes.BANDWIDTH;if(n<r&&(!u||i<s)){t=c+\" as next bandwidth < current bandwidth (\"+n+\" < \"+r+\")\";return u&&(t+=\" and forwardBuffer < bufferHighWaterLine (\"+i+\" < \"+s+\")\"),l(t),!0}if((!u||r<n)&&a<=i){a=c+\" as forwardBuffer >= bufferLowWaterLine (\"+i+\" >= \"+a+\")\";return u&&(a+=\" and next bandwidth > current bandwidth (\"+n+\" > \"+r+\")\"),l(a),!0}return l(\"not \"+c+\" as no switching criteria met\"),!1}({buffered:this.tech_.buffered(),currentTime:i,currentPlaylist:t,nextPlaylist:e,bufferLowWaterLine:n,bufferHighWaterLine:r,duration:this.duration(),experimentalBufferBasedABR:this.experimentalBufferBasedABR,log:this.logger_})},t.setupSegmentLoaderListeners_=function(){var t=this;this.experimentalBufferBasedABR||(this.mainSegmentLoader_.on(\"bandwidthupdate\",function(){var e=t.selectPlaylist();t.shouldSwitchToMedia_(e)&&t.switchMedia_(e,\"bandwidthupdate\"),t.tech_.trigger(\"bandwidthupdate\")}),this.mainSegmentLoader_.on(\"progress\",function(){t.trigger(\"progress\")})),this.mainSegmentLoader_.on(\"error\",function(){t.blacklistCurrentPlaylist(t.mainSegmentLoader_.error())}),this.mainSegmentLoader_.on(\"appenderror\",function(){t.error=t.mainSegmentLoader_.error_,t.trigger(\"error\")}),this.mainSegmentLoader_.on(\"syncinfoupdate\",function(){t.onSyncInfoUpdate_()}),this.mainSegmentLoader_.on(\"timestampoffset\",function(){t.tech_.trigger({type:\"usage\",name:\"vhs-timestamp-offset\"}),t.tech_.trigger({type:\"usage\",name:\"hls-timestamp-offset\"})}),this.audioSegmentLoader_.on(\"syncinfoupdate\",function(){t.onSyncInfoUpdate_()}),this.audioSegmentLoader_.on(\"appenderror\",function(){t.error=t.audioSegmentLoader_.error_,t.trigger(\"error\")}),this.mainSegmentLoader_.on(\"ended\",function(){t.logger_(\"main segment loader ended\"),t.onEndOfStream()}),this.mainSegmentLoader_.on(\"earlyabort\",function(e){t.experimentalBufferBasedABR||(t.delegateLoaders_(\"all\",[\"abort\"]),t.blacklistCurrentPlaylist({message:\"Aborted early because there isn't enough bandwidth to complete the request without rebuffering.\"},120))});function e(){if(!t.sourceUpdater_.hasCreatedSourceBuffers())return t.tryToCreateSourceBuffers_();var e=t.getCodecsOrExclude_();e&&t.sourceUpdater_.addOrChangeSourceBuffers(e)}this.mainSegmentLoader_.on(\"trackinfo\",e),this.audioSegmentLoader_.on(\"trackinfo\",e),this.mainSegmentLoader_.on(\"fmp4\",function(){t.triggeredFmp4Usage||(t.tech_.trigger({type:\"usage\",name:\"vhs-fmp4\"}),t.tech_.trigger({type:\"usage\",name:\"hls-fmp4\"}),t.triggeredFmp4Usage=!0)}),this.audioSegmentLoader_.on(\"fmp4\",function(){t.triggeredFmp4Usage||(t.tech_.trigger({type:\"usage\",name:\"vhs-fmp4\"}),t.tech_.trigger({type:\"usage\",name:\"hls-fmp4\"}),t.triggeredFmp4Usage=!0)}),this.audioSegmentLoader_.on(\"ended\",function(){t.logger_(\"audioSegmentLoader ended\"),t.onEndOfStream()})},t.mediaSecondsLoaded_=function(){return Math.max(this.audioSegmentLoader_.mediaSecondsLoaded+this.mainSegmentLoader_.mediaSecondsLoaded)},t.load=function(){this.mainSegmentLoader_.load(),this.mediaTypes_.AUDIO.activePlaylistLoader&&this.audioSegmentLoader_.load(),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&this.subtitleSegmentLoader_.load()},t.smoothQualityChange_=function(e){void 0===e&&(e=this.selectPlaylist()),this.fastQualityChange_(e)},t.fastQualityChange_=function(e){var t=this;(e=void 0===e?this.selectPlaylist():e)!==this.masterPlaylistLoader_.media()?(this.switchMedia_(e,\"fast-quality\"),this.mainSegmentLoader_.resetEverything(function(){tr.browser.IE_VERSION||tr.browser.IS_EDGE?t.tech_.setCurrentTime(t.tech_.currentTime()+.04):t.tech_.setCurrentTime(t.tech_.currentTime())})):this.logger_(\"skipping fastQualityChange because new media is same as old\")},t.play=function(){if(!this.setupFirstPlay()){this.tech_.ended()&&this.tech_.setCurrentTime(0),this.hasPlayed_&&this.load();var e=this.tech_.seekable();return this.tech_.duration()===1/0&&this.tech_.currentTime()<e.start(0)?this.tech_.setCurrentTime(e.end(e.length-1)):void 0}},t.setupFirstPlay=function(){var e=this,t=this.masterPlaylistLoader_.media();if(!t||this.tech_.paused()||this.hasPlayed_)return!1;if(!t.endList){var i=this.seekable();if(!i.length)return!1;if(tr.browser.IE_VERSION&&0===this.tech_.readyState())return this.tech_.one(\"loadedmetadata\",function(){e.trigger(\"firstplay\"),e.tech_.setCurrentTime(i.end(0)),e.hasPlayed_=!0}),!1;this.trigger(\"firstplay\"),this.tech_.setCurrentTime(i.end(0))}return this.hasPlayed_=!0,this.load(),!0},t.handleSourceOpen_=function(){var e;this.tryToCreateSourceBuffers_(),!this.tech_.autoplay()||\"undefined\"!=typeof(e=this.tech_.play())&&\"function\"==typeof e.then&&e.then(null,function(e){}),this.trigger(\"sourceopen\")},t.handleSourceEnded_=function(){var e,t;!this.inbandTextTracks_.metadataTrack_||(e=this.inbandTextTracks_.metadataTrack_.cues)&&e.length&&(t=this.duration(),e[e.length-1].endTime=isNaN(t)||Math.abs(t)===1/0?Number.MAX_VALUE:t)},t.handleDurationChange_=function(){this.tech_.trigger(\"durationchange\")},t.onEndOfStream=function(){var e,t=this.mainSegmentLoader_.ended_;(t=this.mediaTypes_.AUDIO.activePlaylistLoader?((e=this.mainSegmentLoader_.getCurrentMediaInfo_())&&!e.hasVideo||t)&&this.audioSegmentLoader_.ended_:t)&&(this.stopABRTimer_(),this.sourceUpdater_.endOfStream())},t.stuckAtPlaylistEnd_=function(e){if(!this.seekable().length)return!1;var t=this.syncController_.getExpiredTime(e,this.duration());if(null===t)return!1;var i=Ql.Playlist.playlistEnd(e,t),e=this.tech_.currentTime(),t=this.tech_.buffered();if(!t.length)return i-e<=.1;t=t.end(t.length-1);return t-e<=.1&&i-t<=.1},t.blacklistCurrentPlaylist=function(e,t){var i=(e=void 0===e?{}:e).playlist||this.masterPlaylistLoader_.media();if(t=t||e.blacklistDuration||this.blacklistDuration,!i)return this.error=e,void(\"open\"!==this.mediaSource.readyState?this.trigger(\"error\"):this.sourceUpdater_.endOfStream(\"network\"));i.playlistErrors_++;var n,r=this.masterPlaylistLoader_.master.playlists,a=r.filter(eu),s=1===a.length&&a[0]===i;if(1===r.length&&t!==1/0)return tr.log.warn(\"Problem encountered with playlist \"+i.id+\". Trying again since it is the only playlist.\"),this.tech_.trigger(\"retryplaylist\"),this.masterPlaylistLoader_.load(s);s&&(n=!1,r.forEach(function(e){var t;e===i||\"undefined\"!=typeof(t=e.excludeUntil)&&t!==1/0&&(n=!0,delete e.excludeUntil)}),n&&(tr.log.warn(\"Removing other playlists from the exclusion list because the last rendition is about to be excluded.\"),this.tech_.trigger(\"retryplaylist\"))),a=i.playlistErrors_>this.maxPlaylistRetries?1/0:Date.now()+1e3*t,i.excludeUntil=a,e.reason&&(i.lastExcludeReason_=e.reason),this.tech_.trigger(\"blacklistplaylist\"),this.tech_.trigger({type:\"usage\",name:\"vhs-rendition-blacklisted\"}),this.tech_.trigger({type:\"usage\",name:\"hls-rendition-blacklisted\"});r=this.selectPlaylist();if(!r)return this.error=\"Playback cannot continue. No available working or supported playlists.\",void this.trigger(\"error\");t=e.internal?this.logger_:tr.log.warn,a=e.message?\" \"+e.message:\"\";t((e.internal?\"Internal problem\":\"Problem\")+\" encountered with playlist \"+i.id+\".\"+a+\" Switching to playlist \"+r.id+\".\"),r.attributes.AUDIO!==i.attributes.AUDIO&&this.delegateLoaders_(\"audio\",[\"abort\",\"pause\"]),r.attributes.SUBTITLES!==i.attributes.SUBTITLES&&this.delegateLoaders_(\"subtitle\",[\"abort\",\"pause\"]),this.delegateLoaders_(\"main\",[\"abort\",\"pause\"]);a=r.targetDuration/2*1e3||5e3,a=\"number\"==typeof r.lastRequest&&Date.now()-r.lastRequest<=a;return this.switchMedia_(r,\"exclude\",s||a)},t.pauseLoading=function(){this.delegateLoaders_(\"all\",[\"abort\",\"pause\"]),this.stopABRTimer_()},t.delegateLoaders_=function(i,e){var n=this,r=[],t=\"all\"===i;!t&&\"main\"!==i||r.push(this.masterPlaylistLoader_);var a=[];!t&&\"audio\"!==i||a.push(\"AUDIO\"),!t&&\"subtitle\"!==i||(a.push(\"CLOSED-CAPTIONS\"),a.push(\"SUBTITLES\")),a.forEach(function(e){e=n.mediaTypes_[e]&&n.mediaTypes_[e].activePlaylistLoader;e&&r.push(e)}),[\"main\",\"audio\",\"subtitle\"].forEach(function(e){var t=n[e+\"SegmentLoader_\"];!t||i!==e&&\"all\"!==i||r.push(t)}),r.forEach(function(t){return e.forEach(function(e){\"function\"==typeof t[e]&&t[e]()})})},t.setCurrentTime=function(e){var t=Uo(this.tech_.buffered(),e);return this.masterPlaylistLoader_&&this.masterPlaylistLoader_.media()&&this.masterPlaylistLoader_.media().segments?t&&t.length?e:(this.mainSegmentLoader_.resetEverything(),this.mainSegmentLoader_.abort(),this.mediaTypes_.AUDIO.activePlaylistLoader&&(this.audioSegmentLoader_.resetEverything(),this.audioSegmentLoader_.abort()),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&(this.subtitleSegmentLoader_.resetEverything(),this.subtitleSegmentLoader_.abort()),void this.load()):0},t.duration=function(){if(!this.masterPlaylistLoader_)return 0;var e=this.masterPlaylistLoader_.media();return e?e.endList?this.mediaSource?this.mediaSource.duration:Ql.Playlist.duration(e):1/0:0},t.seekable=function(){return this.seekable_},t.onSyncInfoUpdate_=function(){var e;if(this.masterPlaylistLoader_){var t=this.masterPlaylistLoader_.media();if(t){var i=this.syncController_.getExpiredTime(t,this.duration());if(null!==i){var n,r,a=this.masterPlaylistLoader_.master,s=Ql.Playlist.seekable(t,i,Ql.Playlist.liveEdgeDelay(a,t));if(0!==s.length){if(this.mediaTypes_.AUDIO.activePlaylistLoader){if(t=this.mediaTypes_.AUDIO.activePlaylistLoader.media(),null===(i=this.syncController_.getExpiredTime(t,this.duration())))return;if(0===(e=Ql.Playlist.seekable(t,i,Ql.Playlist.liveEdgeDelay(a,t))).length)return}this.seekable_&&this.seekable_.length&&(n=this.seekable_.end(0),r=this.seekable_.start(0)),!e||e.start(0)>s.end(0)||s.start(0)>e.end(0)?this.seekable_=s:this.seekable_=tr.createTimeRanges([[(e.start(0)>s.start(0)?e:s).start(0),(e.end(0)<s.end(0)?e:s).end(0)]]),this.seekable_&&this.seekable_.length&&this.seekable_.end(0)===n&&this.seekable_.start(0)===r||(this.logger_(\"seekable updated [\"+Fo(this.seekable_)+\"]\"),this.tech_.trigger(\"seekablechanged\"))}}}}},t.updateDuration=function(e){if(this.updateDuration_&&(this.mediaSource.removeEventListener(\"sourceopen\",this.updateDuration_),this.updateDuration_=null),\"open\"!==this.mediaSource.readyState)return this.updateDuration_=this.updateDuration.bind(this,e),void this.mediaSource.addEventListener(\"sourceopen\",this.updateDuration_);if(e){var t=this.seekable();return t.length?void((isNaN(this.mediaSource.duration)||this.mediaSource.duration<t.end(t.length-1))&&this.sourceUpdater_.setDuration(t.end(t.length-1))):void 0}e=this.tech_.buffered(),t=Ql.Playlist.duration(this.masterPlaylistLoader_.media());0<e.length&&(t=Math.max(t,e.end(e.length-1))),this.mediaSource.duration!==t&&this.sourceUpdater_.setDuration(t)},t.dispose=function(){var n=this;this.trigger(\"dispose\"),this.decrypter_.terminate(),this.masterPlaylistLoader_.dispose(),this.mainSegmentLoader_.dispose(),this.loadOnPlay_&&this.tech_.off(\"play\",this.loadOnPlay_),[\"AUDIO\",\"SUBTITLES\"].forEach(function(e){var t,i=n.mediaTypes_[e].groups;for(t in i)i[t].forEach(function(e){e.playlistLoader&&e.playlistLoader.dispose()})}),this.audioSegmentLoader_.dispose(),this.subtitleSegmentLoader_.dispose(),this.sourceUpdater_.dispose(),this.timelineChangeController_.dispose(),this.stopABRTimer_(),this.updateDuration_&&this.mediaSource.removeEventListener(\"sourceopen\",this.updateDuration_),this.mediaSource.removeEventListener(\"durationchange\",this.handleDurationChange_),this.mediaSource.removeEventListener(\"sourceopen\",this.handleSourceOpen_),this.mediaSource.removeEventListener(\"sourceended\",this.handleSourceEnded_),this.off()},t.master=function(){return this.masterPlaylistLoader_.master},t.media=function(){return this.masterPlaylistLoader_.media()||this.initialMedia_},t.areMediaTypesKnown_=function(){var e=!!this.mediaTypes_.AUDIO.activePlaylistLoader,t=!!this.mainSegmentLoader_.getCurrentMediaInfo_(),e=!e||!!this.audioSegmentLoader_.getCurrentMediaInfo_();return t&&e},t.getCodecsOrExclude_=function(){var n=this,r={main:this.mainSegmentLoader_.getCurrentMediaInfo_()||{},audio:this.audioSegmentLoader_.getCurrentMediaInfo_()||{}};r.video=r.main;var e=$u(this.master(),this.media()),a={},t=!!this.mediaTypes_.AUDIO.activePlaylistLoader;if(r.main.hasVideo&&(a.video=e.video||r.main.videoCodec||\"avc1.4d400d\"),r.main.isMuxed&&(a.video+=\",\"+(e.audio||r.main.audioCodec||Lr)),(r.main.hasAudio&&!r.main.isMuxed||r.audio.hasAudio||t)&&(a.audio=e.audio||r.main.audioCodec||r.audio.audioCodec||Lr,r.audio.isFmp4=(r.main.hasAudio&&!r.main.isMuxed?r.main:r.audio).isFmp4),a.audio||a.video){var s,i,o={};if([\"video\",\"audio\"].forEach(function(e){var t,i;a.hasOwnProperty(e)&&(t=r[e].isFmp4,i=a[e],!(t?gr:yr)(i))&&(i=r[e].isFmp4?\"browser\":\"muxer\",o[i]=o[i]||[],o[i].push(a[e]),\"audio\"===e&&(s=i))}),t&&s&&this.media().attributes.AUDIO&&(i=this.media().attributes.AUDIO,this.master().playlists.forEach(function(e){(e.attributes&&e.attributes.AUDIO)===i&&e!==n.media()&&(e.excludeUntil=1/0)}),this.logger_(\"excluding audio group \"+i+\" as \"+s+' does not support codec(s): \"'+a.audio+'\"')),!Object.keys(o).length){if(this.sourceUpdater_.hasCreatedSourceBuffers()&&!this.sourceUpdater_.canChangeType()){var u=[];if([\"video\",\"audio\"].forEach(function(e){var t=(pr(n.sourceUpdater_.codecs[e]||\"\")[0]||{}).type,i=(pr(a[e]||\"\")[0]||{}).type;t&&i&&t.toLowerCase()!==i.toLowerCase()&&u.push('\"'+n.sourceUpdater_.codecs[e]+'\" -> \"'+a[e]+'\"')}),u.length)return void this.blacklistCurrentPlaylist({playlist:this.media(),message:\"Codec switching not supported: \"+u.join(\", \")+\".\",blacklistDuration:1/0,internal:!0})}return a}t=Object.keys(o).reduce(function(e,t){return e&&(e+=\", \"),e+=t+' does not support codec(s): \"'+o[t].join(\",\")+'\"'},\"\")+\".\";this.blacklistCurrentPlaylist({playlist:this.media(),internal:!0,message:t,blacklistDuration:1/0})}else this.blacklistCurrentPlaylist({playlist:this.media(),message:\"Could not determine codecs for playlist.\",blacklistDuration:1/0})},t.tryToCreateSourceBuffers_=function(){var e;\"open\"!==this.mediaSource.readyState||this.sourceUpdater_.hasCreatedSourceBuffers()||!this.areMediaTypesKnown_()||(e=this.getCodecsOrExclude_())&&(this.sourceUpdater_.createSourceBuffers(e),e=[e.video,e.audio].filter(Boolean).join(\",\"),this.excludeIncompatibleVariants_(e))},t.excludeUnsupportedVariants_=function(){var n=this,r=this.master().playlists,a=[];Object.keys(r).forEach(function(e){var t,i=r[e];-1===a.indexOf(i.id)&&(a.push(i.id),t=[],!(e=$u(n.master,i)).audio||yr(e.audio)||gr(e.audio)||t.push(\"audio codec \"+e.audio),!e.video||yr(e.video)||gr(e.video)||t.push(\"video codec \"+e.video),e.text&&\"stpp.ttml.im1t\"===e.text&&t.push(\"text codec \"+e.text),t.length&&(i.excludeUntil=1/0,n.logger_(\"excluding \"+i.id+\" for unsupported: \"+t.join(\", \"))))})},t.excludeIncompatibleVariants_=function(e){var r=this,a=[],s=this.master().playlists,e=Yu(pr(e)),o=Qu(e),u=e.video&&pr(e.video)[0]||null,l=e.audio&&pr(e.audio)[0]||null;Object.keys(s).forEach(function(e){var t,i,n=s[e];-1===a.indexOf(n.id)&&n.excludeUntil!==1/0&&(a.push(n.id),t=[],i=$u(r.masterPlaylistLoader_.master,n),e=Qu(i),(i.audio||i.video)&&(e!==o&&t.push('codec count \"'+e+'\" !== \"'+o+'\"'),r.sourceUpdater_.canChangeType()||(e=i.video&&pr(i.video)[0]||null,i=i.audio&&pr(i.audio)[0]||null,e&&u&&e.type.toLowerCase()!==u.type.toLowerCase()&&t.push('video codec \"'+e.type+'\" !== \"'+u.type+'\"'),i&&l&&i.type.toLowerCase()!==l.type.toLowerCase()&&t.push('audio codec \"'+i.type+'\" !== \"'+l.type+'\"')),t.length&&(n.excludeUntil=1/0,r.logger_(\"blacklisting \"+n.id+\": \"+t.join(\" && \")))))})},t.updateAdCues_=function(e){var t=0,i=this.seekable();i.length&&(t=i.start(0)),function(e,t,i){if(void 0===i&&(i=0),e.segments)for(var n=i,r=0;r<e.segments.length;r++){var a,s,o,u=e.segments[r];if(o=o||function(e,t){for(var i=e.cues,n=0;n<i.length;n++){var r=i[n];if(t>=r.adStartTime&&t<=r.adEndTime)return r}return null}(t,n+u.duration/2)){if(\"cueIn\"in u){o.endTime=n,o.adEndTime=n,n+=u.duration,o=null;continue}if(n<o.endTime){n+=u.duration;continue}o.endTime+=u.duration}else\"cueOut\"in u&&((o=new window.VTTCue(n,n+u.duration,u.cueOut)).adStartTime=n,o.adEndTime=n+parseFloat(u.cueOut),t.addCue(o)),\"cueOutCont\"in u&&(a=(s=u.cueOutCont.split(\"/\").map(parseFloat))[0],s=s[1],(o=new window.VTTCue(n,n+u.duration,\"\")).adStartTime=n-a,o.adEndTime=o.adStartTime+s,t.addCue(o));n+=u.duration}}(e,this.cueTagsTrack_,t)},t.goalBufferLength=function(){var e=this.tech_.currentTime(),t=El.GOAL_BUFFER_LENGTH,i=El.GOAL_BUFFER_LENGTH_RATE,n=Math.max(t,El.MAX_GOAL_BUFFER_LENGTH);return Math.min(t+e*i,n)},t.bufferLowWaterLine=function(){var e=this.tech_.currentTime(),t=El.BUFFER_LOW_WATER_LINE,i=El.BUFFER_LOW_WATER_LINE_RATE,n=Math.max(t,El.MAX_BUFFER_LOW_WATER_LINE),r=Math.max(t,El.EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE);return Math.min(t+e*i,this.experimentalBufferBasedABR?r:n)},t.bufferHighWaterLine=function(){return El.BUFFER_HIGH_WATER_LINE},e}(tr.EventTarget),Tc=[\"seeking\",\"seeked\",\"pause\",\"playing\",\"error\"],Sc=function(){function e(e){var i=this;this.masterPlaylistController_=e.masterPlaylistController,this.tech_=e.tech,this.seekable=e.seekable,this.allowSeeksWithinUnsafeLiveWindow=e.allowSeeksWithinUnsafeLiveWindow,this.liveRangeSafeTimeDelta=e.liveRangeSafeTimeDelta,this.media=e.media,this.consecutiveUpdates=0,this.lastRecordedTime=null,this.timer_=null,this.checkCurrentTimeTimeout_=null,this.logger_=Ro(\"PlaybackWatcher\"),this.logger_(\"initialize\");function t(){return i.monitorCurrentTime_()}function n(){return i.monitorCurrentTime_()}function r(){return i.techWaiting_()}function a(){return i.cancelTimer_()}var s=this.masterPlaylistController_,o=[\"main\",\"subtitle\",\"audio\"],u={};o.forEach(function(e){u[e]={reset:function(){return i.resetSegmentDownloads_(e)},updateend:function(){return i.checkSegmentDownloads_(e)}},s[e+\"SegmentLoader_\"].on(\"appendsdone\",u[e].updateend),s[e+\"SegmentLoader_\"].on(\"playlistupdate\",u[e].reset),i.tech_.on([\"seeked\",\"seeking\"],u[e].reset)});function l(t){[\"main\",\"audio\"].forEach(function(e){s[e+\"SegmentLoader_\"][t](\"appended\",i.seekingAppendCheck_)})}this.seekingAppendCheck_=function(){i.fixesBadSeeks_()&&(i.consecutiveUpdates=0,i.lastRecordedTime=i.tech_.currentTime(),l(\"off\"))},this.clearSeekingAppendCheck_=function(){return l(\"off\")},this.watchForBadSeeking_=function(){i.clearSeekingAppendCheck_(),l(\"on\")},this.tech_.on(\"seeked\",this.clearSeekingAppendCheck_),this.tech_.on(\"seeking\",this.watchForBadSeeking_),this.tech_.on(\"waiting\",r),this.tech_.on(Tc,a),this.tech_.on(\"canplay\",n),this.tech_.one(\"play\",t),this.dispose=function(){i.clearSeekingAppendCheck_(),i.logger_(\"dispose\"),i.tech_.off(\"waiting\",r),i.tech_.off(Tc,a),i.tech_.off(\"canplay\",n),i.tech_.off(\"play\",t),i.tech_.off(\"seeking\",i.watchForBadSeeking_),i.tech_.off(\"seeked\",i.clearSeekingAppendCheck_),o.forEach(function(e){s[e+\"SegmentLoader_\"].off(\"appendsdone\",u[e].updateend),s[e+\"SegmentLoader_\"].off(\"playlistupdate\",u[e].reset),i.tech_.off([\"seeked\",\"seeking\"],u[e].reset)}),i.checkCurrentTimeTimeout_&&window.clearTimeout(i.checkCurrentTimeTimeout_),i.cancelTimer_()}}var t=e.prototype;return t.monitorCurrentTime_=function(){this.checkCurrentTime_(),this.checkCurrentTimeTimeout_&&window.clearTimeout(this.checkCurrentTimeTimeout_),this.checkCurrentTimeTimeout_=window.setTimeout(this.monitorCurrentTime_.bind(this),250)},t.resetSegmentDownloads_=function(e){var t=this.masterPlaylistController_[e+\"SegmentLoader_\"];0<this[e+\"StalledDownloads_\"]&&this.logger_(\"resetting possible stalled download count for \"+e+\" loader\"),this[e+\"StalledDownloads_\"]=0,this[e+\"Buffered_\"]=t.buffered_()},t.checkSegmentDownloads_=function(e){var t=this.masterPlaylistController_,i=t[e+\"SegmentLoader_\"],n=i.buffered_(),r=function(e,t){if(e===t)return!1;if(!e&&t||!t&&e)return!0;if(e.length!==t.length)return!0;for(var i=0;i<e.length;i++)if(e.start(i)!==t.start(i)||e.end(i)!==t.end(i))return!0;return!1}(this[e+\"Buffered_\"],n);this[e+\"Buffered_\"]=n,r?this.resetSegmentDownloads_(e):(this[e+\"StalledDownloads_\"]++,this.logger_(\"found #\"+this[e+\"StalledDownloads_\"]+\" \"+e+\" appends that did not increase buffer (possible stalled download)\",{playlistId:i.playlist_&&i.playlist_.id,buffered:jo(n)}),this[e+\"StalledDownloads_\"]<10||(this.logger_(e+\" loader stalled download exclusion\"),this.resetSegmentDownloads_(e),this.tech_.trigger({type:\"usage\",name:\"vhs-\"+e+\"-download-exclusion\"}),\"subtitle\"!==e&&t.blacklistCurrentPlaylist({message:\"Excessive \"+e+\" segment downloading detected.\"},1/0)))},t.checkCurrentTime_=function(){if(!this.tech_.paused()&&!this.tech_.seeking()){var e=this.tech_.currentTime(),t=this.tech_.buffered();if(this.lastRecordedTime===e&&(!t.length||e+.1>=t.end(t.length-1)))return this.techWaiting_();5<=this.consecutiveUpdates&&e===this.lastRecordedTime?(this.consecutiveUpdates++,this.waiting_()):e===this.lastRecordedTime?this.consecutiveUpdates++:(this.consecutiveUpdates=0,this.lastRecordedTime=e)}},t.cancelTimer_=function(){this.consecutiveUpdates=0,this.timer_&&(this.logger_(\"cancelTimer_\"),clearTimeout(this.timer_)),this.timer_=null},t.fixesBadSeeks_=function(){if(!this.tech_.seeking())return!1;var e,t=this.seekable(),i=this.tech_.currentTime();if(this.afterSeekableWindow_(t,i,this.media(),this.allowSeeksWithinUnsafeLiveWindow)&&(e=t.end(t.length-1)),\"undefined\"!=typeof(e=this.beforeSeekableWindow_(t,i)?(a=t.start(0))+(a===t.end(0)?0:.1):e))return this.logger_(\"Trying to seek outside of seekable at time \"+i+\" with seekable range \"+Fo(t)+\". Seeking to \"+e+\".\"),this.tech_.setCurrentTime(e),!0;for(var n=this.masterPlaylistController_.sourceUpdater_,r=this.tech_.buffered(),a=n.audioBuffer?n.audioBuffered():null,t=n.videoBuffer?n.videoBuffered():null,n=this.media(),s=n.partTargetDuration||2*(n.targetDuration-fl),o=[a,t],u=0;u<o.length;u++)if(o[u])if(qo(o[u],i)<s)return!1;r=Bo(r,i);return 0!==r.length&&(e=r.start(0)+.1,this.logger_(\"Buffered region starts (\"+r.start(0)+\")  just beyond seek point (\"+i+\"). Seeking to \"+e+\".\"),this.tech_.setCurrentTime(e),!0)},t.waiting_=function(){var e,t;this.techWaiting_()||(e=this.tech_.currentTime(),t=this.tech_.buffered(),(t=Uo(t,e)).length&&e+3<=t.end(0)&&(this.cancelTimer_(),this.tech_.setCurrentTime(e),this.logger_(\"Stopped at \"+e+\" while inside a buffered region [\"+t.start(0)+\" -> \"+t.end(0)+\"]. Attempting to resume playback by seeking to the current time.\"),this.tech_.trigger({type:\"usage\",name:\"vhs-unknown-waiting\"}),this.tech_.trigger({type:\"usage\",name:\"hls-unknown-waiting\"})))},t.techWaiting_=function(){var e=this.seekable(),t=this.tech_.currentTime();if(this.tech_.seeking()||null!==this.timer_)return!0;if(this.beforeSeekableWindow_(e,t)){var i=e.end(e.length-1);return this.logger_(\"Fell out of live window at time \"+t+\". Seeking to live point (seekable end) \"+i),this.cancelTimer_(),this.tech_.setCurrentTime(i),this.tech_.trigger({type:\"usage\",name:\"vhs-live-resync\"}),this.tech_.trigger({type:\"usage\",name:\"hls-live-resync\"}),!0}e=this.tech_.vhs.masterPlaylistController_.sourceUpdater_,i=this.tech_.buffered();if(this.videoUnderflow_({audioBuffered:e.audioBuffered(),videoBuffered:e.videoBuffered(),currentTime:t}))return this.cancelTimer_(),this.tech_.setCurrentTime(t),this.tech_.trigger({type:\"usage\",name:\"vhs-video-underflow\"}),this.tech_.trigger({type:\"usage\",name:\"hls-video-underflow\"}),!0;e=Bo(i,t);if(0<e.length){i=e.start(0)-t;return this.logger_(\"Stopped at \"+t+\", setting timer for \"+i+\", seeking to \"+e.start(0)),this.cancelTimer_(),this.timer_=setTimeout(this.skipTheGap_.bind(this),1e3*i,t),!0}return!1},t.afterSeekableWindow_=function(e,t,i,n){if(void 0===n&&(n=!1),!e.length)return!1;var r=e.end(e.length-1)+.1;return(r=!i.endList&&n?e.end(e.length-1)+3*i.targetDuration:r)<t},t.beforeSeekableWindow_=function(e,t){return!!(e.length&&0<e.start(0)&&t<e.start(0)-this.liveRangeSafeTimeDelta)},t.videoUnderflow_=function(e){var t,i,n=e.videoBuffered,r=e.audioBuffered,a=e.currentTime;if(n)return n.length&&r.length?(i=Uo(n,a-3),e=Uo(n,a),(r=Uo(r,a)).length&&!e.length&&i.length&&(t={start:i.end(0),end:r.end(0)})):Bo(n,a).length||(t=this.gapFromVideoUnderflow_(n,a)),!!t&&(this.logger_(\"Encountered a gap in video from \"+t.start+\" to \"+t.end+\". Seeking to current time \"+a),!0)},t.skipTheGap_=function(e){var t=this.tech_.buffered(),i=this.tech_.currentTime(),t=Bo(t,i);this.cancelTimer_(),0!==t.length&&i===e&&(this.logger_(\"skipTheGap_:\",\"currentTime:\",i,\"scheduled currentTime:\",e,\"nextRange start:\",t.start(0)),this.tech_.setCurrentTime(t.start(0)+fl),this.tech_.trigger({type:\"usage\",name:\"vhs-gap-skip\"}),this.tech_.trigger({type:\"usage\",name:\"hls-gap-skip\"}))},t.gapFromVideoUnderflow_=function(e,t){for(var i=function(e){if(e.length<2)return tr.createTimeRanges();for(var t=[],i=1;i<e.length;i++){var n=e.end(i-1),r=e.start(i);t.push([n,r])}return tr.createTimeRanges(t)}(e),n=0;n<i.length;n++){var r=i.start(n),a=i.end(n);if(t-r<4&&2<t-r)return{start:r,end:a}}return null},e}(),wc={errorInterval:30,getSource:function(e){return e(this.tech({IWillNotUseThisInPlugins:!0}).currentSource_||this.currentSource())}},Ec={PlaylistLoader:_l,Playlist:gl,utils:zt,STANDARD_PLAYLIST_SELECTOR:ar,INITIAL_PLAYLIST_SELECTOR:function(){var t=this,e=this.playlists.master.playlists.filter(gl.isEnabled);return el(e,tl),e.filter(function(e){return!!$u(t.playlists.master,e).video})[0]||null},lastBandwidthSelector:ar,movingAverageBandwidthSelector:function(t){var i=-1,n=-1;if(t<0||1<t)throw new Error(\"Moving average bandwidth decay must be between 0 and 1.\");return function(){var e=this.useDevicePixelRatio&&window.devicePixelRatio||1;return i<0&&(i=this.systemBandwidth,n=this.systemBandwidth),0<this.systemBandwidth&&this.systemBandwidth!==n&&(i=t*this.systemBandwidth+(1-t)*i,n=this.systemBandwidth),il(this.playlists.master,i,parseInt(Zu(this.tech_.el(),\"width\"),10)*e,parseInt(Zu(this.tech_.el(),\"height\"),10)*e,this.limitRenditionByPlayerDimensions,this.masterPlaylistController_)}},comparePlaylistBandwidth:tl,comparePlaylistResolution:function(e,t){var i,n;return(i=(i=e.attributes.RESOLUTION&&e.attributes.RESOLUTION.width?e.attributes.RESOLUTION.width:i)||window.Number.MAX_VALUE)===(n=(n=t.attributes.RESOLUTION&&t.attributes.RESOLUTION.width?t.attributes.RESOLUTION.width:n)||window.Number.MAX_VALUE)&&e.attributes.BANDWIDTH&&t.attributes.BANDWIDTH?e.attributes.BANDWIDTH-t.attributes.BANDWIDTH:i-n},xhr:yu()};Object.keys(El).forEach(function(t){Object.defineProperty(Ec,t,{get:function(){return tr.log.warn(\"using Vhs.\"+t+\" is UNSAFE be sure you know what you are doing\"),El[t]},set:function(e){tr.log.warn(\"using Vhs.\"+t+\" is UNSAFE be sure you know what you are doing\"),\"number\"!=typeof e||e<0?tr.log.warn(\"value of Vhs.\"+t+\" must be greater than or equal to 0\"):El[t]=e}})});function kc(e,t){for(var i=t.media(),n=-1,r=0;r<e.length;r++)if(e[r].id===i.id){n=r;break}e.selectedIndex_=n,e.trigger({selectedIndex:n,type:\"change\"})}var Cc=\"videojs-vhs\";Ec.canPlaySource=function(){return tr.log.warn(\"HLS is no longer a tech. Please remove it from your player's techOrder.\")};function Ic(e){var n=e.player,t=e.sourceKeySystems,i=e.audioMedia,e=e.mainPlaylists;if(!n.eme.initializeMediaKeys)return Promise.resolve();var r,e=(e=e=i?e.concat([i]):e,r=Object.keys(t),e.reduce(function(e,n){if(!n.contentProtection)return e;var t=r.reduce(function(e,t){var i=n.contentProtection[t];return i&&i.pssh&&(e[t]={pssh:i.pssh}),e},{});return Object.keys(t).length&&e.push(t),e},[])),a=[],s=[];return e.forEach(function(e){s.push(new Promise(function(e,t){n.tech_.one(\"keysessioncreated\",e)})),a.push(new Promise(function(t,i){n.eme.initializeMediaKeys({keySystems:e},function(e){e?i(e):t()})}))}),Promise.race([Promise.all(a),Promise.race(s)])}function xc(e){var t=e.player;return!!(e=function(e,t,i){if(!e)return e;var n={};t&&t.attributes&&t.attributes.CODECS&&(n=Yu(pr(t.attributes.CODECS))),i&&i.attributes&&i.attributes.CODECS&&(n.audio=i.attributes.CODECS);var r,a=mr(n.video),s=mr(n.audio),o={};for(r in e)o[r]={},s&&(o[r].audioContentType=s),a&&(o[r].videoContentType=a),t.contentProtection&&t.contentProtection[r]&&t.contentProtection[r].pssh&&(o[r].pssh=t.contentProtection[r].pssh),\"string\"==typeof e[r]&&(o[r].url=e[r]);return tr.mergeOptions(e,o)}(e.sourceKeySystems,e.media,e.audioMedia))&&(!((t.currentSource().keySystems=e)&&!t.eme)||(tr.log.warn(\"DRM encrypted source cannot be decrypted without a DRM plugin\"),!1))}function Ac(){if(!window.localStorage)return null;var e=window.localStorage.getItem(Cc);if(!e)return null;try{return JSON.parse(e)}catch(e){return null}}Ec.supportsNativeHls=function(){if(!document||!document.createElement)return!1;var t=document.createElement(\"video\");if(!tr.getTech(\"Html5\").isSupported())return!1;return[\"application/vnd.apple.mpegurl\",\"audio/mpegurl\",\"audio/x-mpegurl\",\"application/x-mpegurl\",\"video/x-mpegurl\",\"video/mpegurl\",\"application/mpegurl\"].some(function(e){return/maybe|probably/i.test(t.canPlayType(e))})}(),Ec.supportsNativeDash=!!(document&&document.createElement&&tr.getTech(\"Html5\").isSupported())&&/maybe|probably/i.test(document.createElement(\"video\").canPlayType(\"application/dash+xml\")),Ec.supportsTypeNatively=function(e){return\"hls\"===e?Ec.supportsNativeHls:\"dash\"===e&&Ec.supportsNativeDash},Ec.isSupported=function(){return tr.log.warn(\"HLS is no longer a tech. Please remove it from your player's techOrder.\")};var Pc=function(r){function e(e,t,i){var n=r.call(this,t,tr.mergeOptions(i.hls,i.vhs))||this;if(i.hls&&Object.keys(i.hls).length&&tr.log.warn(\"Using hls options is deprecated. Please rename `hls` to `vhs` in your options object.\"),\"number\"==typeof i.initialBandwidth&&(n.options_.bandwidth=i.initialBandwidth),n.logger_=Ro(\"VhsHandler\"),t.options_&&t.options_.playerId&&((i=tr(t.options_.playerId)).hasOwnProperty(\"hls\")||Object.defineProperty(i,\"hls\",{get:function(){return tr.log.warn(\"player.hls is deprecated. Use player.tech().vhs instead.\"),t.trigger({type:\"usage\",name:\"hls-player-access\"}),ft(n)},configurable:!0}),i.hasOwnProperty(\"vhs\")||Object.defineProperty(i,\"vhs\",{get:function(){return tr.log.warn(\"player.vhs is deprecated. Use player.tech().vhs instead.\"),t.trigger({type:\"usage\",name:\"vhs-player-access\"}),ft(n)},configurable:!0}),i.hasOwnProperty(\"dash\")||Object.defineProperty(i,\"dash\",{get:function(){return tr.log.warn(\"player.dash is deprecated. Use player.tech().vhs instead.\"),ft(n)},configurable:!0}),n.player_=i),n.tech_=t,n.source_=e,n.stats={},n.ignoreNextSeekingEvent_=!1,n.setOptions_(),n.options_.overrideNative&&t.overrideNativeAudioTracks&&t.overrideNativeVideoTracks)t.overrideNativeAudioTracks(!0),t.overrideNativeVideoTracks(!0);else if(n.options_.overrideNative&&(t.featuresNativeVideoTracks||t.featuresNativeAudioTracks))throw new Error(\"Overriding native HLS requires emulated tracks. See https://git.io/vMpjB\");return n.on(document,[\"fullscreenchange\",\"webkitfullscreenchange\",\"mozfullscreenchange\",\"MSFullscreenChange\"],function(e){var t=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;t&&t.contains(n.tech_.el())?n.masterPlaylistController_.fastQualityChange_():n.masterPlaylistController_.checkABR_()}),n.on(n.tech_,\"seeking\",function(){this.ignoreNextSeekingEvent_?this.ignoreNextSeekingEvent_=!1:this.setCurrentTime(this.tech_.currentTime())}),n.on(n.tech_,\"error\",function(){this.tech_.error()&&this.masterPlaylistController_&&this.masterPlaylistController_.pauseLoading()}),n.on(n.tech_,\"play\",n.play),n}mt(e,r);var t=e.prototype;return t.setOptions_=function(){var e,t=this;this.options_.withCredentials=this.options_.withCredentials||!1,this.options_.handleManifestRedirects=!1!==this.options_.handleManifestRedirects,this.options_.limitRenditionByPlayerDimensions=!1!==this.options_.limitRenditionByPlayerDimensions,this.options_.useDevicePixelRatio=this.options_.useDevicePixelRatio||!1,this.options_.smoothQualityChange=this.options_.smoothQualityChange||!1,this.options_.useBandwidthFromLocalStorage=\"undefined\"!=typeof this.source_.useBandwidthFromLocalStorage?this.source_.useBandwidthFromLocalStorage:this.options_.useBandwidthFromLocalStorage||!1,this.options_.useNetworkInformationApi=this.options_.useNetworkInformationApi||!1,this.options_.useDtsForTimestampOffset=this.options_.useDtsForTimestampOffset||!1,this.options_.customTagParsers=this.options_.customTagParsers||[],this.options_.customTagMappers=this.options_.customTagMappers||[],this.options_.cacheEncryptionKeys=this.options_.cacheEncryptionKeys||!1,\"number\"!=typeof this.options_.blacklistDuration&&(this.options_.blacklistDuration=300),\"number\"!=typeof this.options_.bandwidth&&this.options_.useBandwidthFromLocalStorage&&((e=Ac())&&e.bandwidth&&(this.options_.bandwidth=e.bandwidth,this.tech_.trigger({type:\"usage\",name:\"vhs-bandwidth-from-local-storage\"}),this.tech_.trigger({type:\"usage\",name:\"hls-bandwidth-from-local-storage\"})),e&&e.throughput&&(this.options_.throughput=e.throughput,this.tech_.trigger({type:\"usage\",name:\"vhs-throughput-from-local-storage\"}),this.tech_.trigger({type:\"usage\",name:\"hls-throughput-from-local-storage\"}))),\"number\"!=typeof this.options_.bandwidth&&(this.options_.bandwidth=El.INITIAL_BANDWIDTH),this.options_.enableLowInitialPlaylist=this.options_.enableLowInitialPlaylist&&this.options_.bandwidth===El.INITIAL_BANDWIDTH,[\"withCredentials\",\"useDevicePixelRatio\",\"limitRenditionByPlayerDimensions\",\"bandwidth\",\"smoothQualityChange\",\"customTagParsers\",\"customTagMappers\",\"handleManifestRedirects\",\"cacheEncryptionKeys\",\"playlistSelector\",\"initialPlaylistSelector\",\"experimentalBufferBasedABR\",\"liveRangeSafeTimeDelta\",\"experimentalLLHLS\",\"useNetworkInformationApi\",\"useDtsForTimestampOffset\",\"experimentalExactManifestTimings\",\"experimentalLeastPixelDiffSelector\"].forEach(function(e){\"undefined\"!=typeof t.source_[e]&&(t.options_[e]=t.source_[e])}),this.limitRenditionByPlayerDimensions=this.options_.limitRenditionByPlayerDimensions,this.useDevicePixelRatio=this.options_.useDevicePixelRatio},t.src=function(e,t){var n=this;e&&(this.setOptions_(),this.options_.src=0===(e=this.source_.src).toLowerCase().indexOf(\"data:application/vnd.videojs.vhs+json,\")?JSON.parse(e.substring(e.indexOf(\",\")+1)):e,this.options_.tech=this.tech_,this.options_.externVhs=Ec,this.options_.sourceType=vr(t),this.options_.seekTo=function(e){n.tech_.setCurrentTime(e)},this.options_.smoothQualityChange&&tr.log.warn(\"smoothQualityChange is deprecated and will be removed in the next major version\"),this.masterPlaylistController_=new bc(this.options_),t=tr.mergeOptions({liveRangeSafeTimeDelta:.1},this.options_,{seekable:function(){return n.seekable()},media:function(){return n.masterPlaylistController_.media()},masterPlaylistController:this.masterPlaylistController_}),this.playbackWatcher_=new Sc(t),this.masterPlaylistController_.on(\"error\",function(){var e=tr.players[n.tech_.options_.playerId],t=n.masterPlaylistController_.error;\"object\"!=typeof t||t.code?\"string\"==typeof t&&(t={message:t,code:3}):t.code=3,e.error(t)}),t=this.options_.experimentalBufferBasedABR?Ec.movingAverageBandwidthSelector(.55):Ec.STANDARD_PLAYLIST_SELECTOR,this.masterPlaylistController_.selectPlaylist=(this.selectPlaylist||t).bind(this),this.masterPlaylistController_.selectInitialPlaylist=Ec.INITIAL_PLAYLIST_SELECTOR.bind(this),this.playlists=this.masterPlaylistController_.masterPlaylistLoader_,this.mediaSource=this.masterPlaylistController_.mediaSource,Object.defineProperties(this,{selectPlaylist:{get:function(){return this.masterPlaylistController_.selectPlaylist},set:function(e){this.masterPlaylistController_.selectPlaylist=e.bind(this)}},throughput:{get:function(){return this.masterPlaylistController_.mainSegmentLoader_.throughput.rate},set:function(e){this.masterPlaylistController_.mainSegmentLoader_.throughput.rate=e,this.masterPlaylistController_.mainSegmentLoader_.throughput.count=1}},bandwidth:{get:function(){var e=this.masterPlaylistController_.mainSegmentLoader_.bandwidth,t=window.navigator.connection||window.navigator.mozConnection||window.navigator.webkitConnection;return e=this.options_.useNetworkInformationApi&&t?1e7<=(t=1e3*t.downlink*1e3)&&1e7<=e?Math.max(e,t):t:e},set:function(e){this.masterPlaylistController_.mainSegmentLoader_.bandwidth=e,this.masterPlaylistController_.mainSegmentLoader_.throughput={rate:0,count:0}}},systemBandwidth:{get:function(){var e=1/(this.bandwidth||1),t=0<this.throughput?1/this.throughput:0;return Math.floor(1/(e+t))},set:function(){tr.log.error('The \"systemBandwidth\" property is read-only')}}}),this.options_.bandwidth&&(this.bandwidth=this.options_.bandwidth),this.options_.throughput&&(this.throughput=this.options_.throughput),Object.defineProperties(this.stats,{bandwidth:{get:function(){return n.bandwidth||0},enumerable:!0},mediaRequests:{get:function(){return n.masterPlaylistController_.mediaRequests_()||0},enumerable:!0},mediaRequestsAborted:{get:function(){return n.masterPlaylistController_.mediaRequestsAborted_()||0},enumerable:!0},mediaRequestsTimedout:{get:function(){return n.masterPlaylistController_.mediaRequestsTimedout_()||0},enumerable:!0},mediaRequestsErrored:{get:function(){return n.masterPlaylistController_.mediaRequestsErrored_()||0},enumerable:!0},mediaTransferDuration:{get:function(){return n.masterPlaylistController_.mediaTransferDuration_()||0},enumerable:!0},mediaBytesTransferred:{get:function(){return n.masterPlaylistController_.mediaBytesTransferred_()||0},enumerable:!0},mediaSecondsLoaded:{get:function(){return n.masterPlaylistController_.mediaSecondsLoaded_()||0},enumerable:!0},mediaAppends:{get:function(){return n.masterPlaylistController_.mediaAppends_()||0},enumerable:!0},mainAppendsToLoadedData:{get:function(){return n.masterPlaylistController_.mainAppendsToLoadedData_()||0},enumerable:!0},audioAppendsToLoadedData:{get:function(){return n.masterPlaylistController_.audioAppendsToLoadedData_()||0},enumerable:!0},appendsToLoadedData:{get:function(){return n.masterPlaylistController_.appendsToLoadedData_()||0},enumerable:!0},timeToLoadedData:{get:function(){return n.masterPlaylistController_.timeToLoadedData_()||0},enumerable:!0},buffered:{get:function(){return jo(n.tech_.buffered())},enumerable:!0},currentTime:{get:function(){return n.tech_.currentTime()},enumerable:!0},currentSource:{get:function(){return n.tech_.currentSource_},enumerable:!0},currentTech:{get:function(){return n.tech_.name_},enumerable:!0},duration:{get:function(){return n.tech_.duration()},enumerable:!0},master:{get:function(){return n.playlists.master},enumerable:!0},playerDimensions:{get:function(){return n.tech_.currentDimensions()},enumerable:!0},seekable:{get:function(){return jo(n.tech_.seekable())},enumerable:!0},timestamp:{get:function(){return Date.now()},enumerable:!0},videoPlaybackQuality:{get:function(){return n.tech_.getVideoPlaybackQuality()},enumerable:!0}}),this.tech_.one(\"canplay\",this.masterPlaylistController_.setupFirstPlay.bind(this.masterPlaylistController_)),this.tech_.on(\"bandwidthupdate\",function(){n.options_.useBandwidthFromLocalStorage&&function(e){if(!window.localStorage)return;var t=(t=Ac())?tr.mergeOptions(t,e):e;try{window.localStorage.setItem(Cc,JSON.stringify(t))}catch(e){return}}({bandwidth:n.bandwidth,throughput:Math.round(n.throughput)})}),this.masterPlaylistController_.on(\"selectedinitialmedia\",function(){var i;(i=n).representations=function(){var e=i.masterPlaylistController_.master(),e=au(e)?i.masterPlaylistController_.getAudioTrackPlaylists_():e.playlists;return e?e.filter(function(e){return!Zo(e)}).map(function(e,t){return new Kl(i,e,e.id)}):[]}}),this.masterPlaylistController_.sourceUpdater_.on(\"createdsourcebuffers\",function(){n.setupEme_()}),this.on(this.masterPlaylistController_,\"progress\",function(){this.tech_.trigger(\"progress\")}),this.on(this.masterPlaylistController_,\"firstplay\",function(){this.ignoreNextSeekingEvent_=!0}),this.setupQualityLevels_(),this.tech_.el()&&(this.mediaSourceUrl_=window.URL.createObjectURL(this.masterPlaylistController_.mediaSource),this.tech_.src(this.mediaSourceUrl_)))},t.createKeySessions_=function(){var t=this,e=this.masterPlaylistController_.mediaTypes_.AUDIO.activePlaylistLoader;this.logger_(\"waiting for EME key session creation\"),Ic({player:this.player_,sourceKeySystems:this.source_.keySystems,audioMedia:e&&e.media(),mainPlaylists:this.playlists.master.playlists}).then(function(){t.logger_(\"created EME key session\"),t.masterPlaylistController_.sourceUpdater_.initializedEme()}).catch(function(e){t.logger_(\"error while creating EME key session\",e),t.player_.error({message:\"Failed to initialize media keys for EME\",code:3})})},t.handleWaitingForKey_=function(){this.logger_(\"waitingforkey fired, attempting to create any new key sessions\"),this.createKeySessions_()},t.setupEme_=function(){var t=this,e=this.masterPlaylistController_.mediaTypes_.AUDIO.activePlaylistLoader,e=xc({player:this.player_,sourceKeySystems:this.source_.keySystems,media:this.playlists.media(),audioMedia:e&&e.media()});this.player_.tech_.on(\"keystatuschange\",function(e){\"output-restricted\"===e.status&&t.masterPlaylistController_.blacklistCurrentPlaylist({playlist:t.masterPlaylistController_.media(),message:\"DRM keystatus changed to \"+e.status+\". Playlist will fail to play. Check for HDCP content.\",blacklistDuration:1/0})}),this.handleWaitingForKey_=this.handleWaitingForKey_.bind(this),this.player_.tech_.on(\"waitingforkey\",this.handleWaitingForKey_),11!==tr.browser.IE_VERSION&&e?this.createKeySessions_():this.masterPlaylistController_.sourceUpdater_.initializedEme()},t.setupQualityLevels_=function(){var i=this,e=tr.players[this.tech_.options_.playerId];e&&e.qualityLevels&&!this.qualityLevels_&&(this.qualityLevels_=e.qualityLevels(),this.masterPlaylistController_.on(\"selectedinitialmedia\",function(){var t,e;t=i.qualityLevels_,(e=i).representations().forEach(function(e){t.addQualityLevel(e)}),kc(t,e.playlists)}),this.playlists.on(\"mediachange\",function(){kc(i.qualityLevels_,i.playlists)}))},e.version=function(){return{\"@videojs/http-streaming\":\"2.14.2\",\"mux.js\":\"6.0.1\",\"mpd-parser\":\"0.21.1\",\"m3u8-parser\":\"4.7.1\",\"aes-decrypter\":\"3.1.3\"}},t.version=function(){return this.constructor.version()},t.canChangeType=function(){return uc.canChangeType()},t.play=function(){this.masterPlaylistController_.play()},t.setCurrentTime=function(e){this.masterPlaylistController_.setCurrentTime(e)},t.duration=function(){return this.masterPlaylistController_.duration()},t.seekable=function(){return this.masterPlaylistController_.seekable()},t.dispose=function(){this.playbackWatcher_&&this.playbackWatcher_.dispose(),this.masterPlaylistController_&&this.masterPlaylistController_.dispose(),this.qualityLevels_&&this.qualityLevels_.dispose(),this.player_&&(delete this.player_.vhs,delete this.player_.dash,delete this.player_.hls),this.tech_&&this.tech_.vhs&&delete this.tech_.vhs,this.tech_&&delete this.tech_.hls,this.mediaSourceUrl_&&window.URL.revokeObjectURL&&(window.URL.revokeObjectURL(this.mediaSourceUrl_),this.mediaSourceUrl_=null),this.tech_&&this.tech_.off(\"waitingforkey\",this.handleWaitingForKey_),r.prototype.dispose.call(this)},t.convertToProgramTime=function(e,t){return ku({playlist:this.masterPlaylistController_.media(),time:e,callback:t})},t.seekToProgramTime=function(e,t,i,n){return void 0===i&&(i=!0),void 0===n&&(n=2),Cu({programTime:e,playlist:this.masterPlaylistController_.media(),retryCount:n,pauseAfterSeek:i,seekTo:this.options_.seekTo,tech:this.options_.tech,callback:t})},e}(tr.getComponent(\"Component\")),Lc={name:\"videojs-http-streaming\",VERSION:\"2.14.2\",canHandleSource:function(e,t){t=tr.mergeOptions(tr.options,t=void 0===t?{}:t);return Lc.canPlayType(e.type,t)},handleSource:function(e,t,i){i=tr.mergeOptions(tr.options,i=void 0===i?{}:i);return t.vhs=new Pc(e,t,i),tr.hasOwnProperty(\"hls\")||Object.defineProperty(t,\"hls\",{get:function(){return tr.log.warn(\"player.tech().hls is deprecated. Use player.tech().vhs instead.\"),t.vhs},configurable:!0}),t.vhs.xhr=yu(),t.vhs.src(e.src,e.type),t.vhs},canPlayType:function(e,t){var i=tr.mergeOptions(tr.options,t=void 0===t?{}:t),t=i.vhs,t=(t=void 0===t?{}:t).overrideNative,t=void 0===t?!tr.browser.IS_ANY_SAFARI:t,i=i.hls,i=(i=void 0===i?{}:i).overrideNative,i=void 0!==i&&i,e=vr(e);return e&&(!Ec.supportsTypeNatively(e)||i||t)?\"maybe\":\"\"}};return gr(\"avc1.4d400d,mp4a.40.2\")&&tr.getTech(\"Html5\").registerSourceHandler(Lc,0),tr.VhsHandler=Pc,Object.defineProperty(tr,\"HlsHandler\",{get:function(){return tr.log.warn(\"videojs.HlsHandler is deprecated. Use videojs.VhsHandler instead.\"),Pc},configurable:!0}),tr.VhsSourceHandler=Lc,Object.defineProperty(tr,\"HlsSourceHandler\",{get:function(){return tr.log.warn(\"videojs.HlsSourceHandler is deprecated. Use videojs.VhsSourceHandler instead.\"),Lc},configurable:!0}),tr.Vhs=Ec,Object.defineProperty(tr,\"Hls\",{get:function(){return tr.log.warn(\"videojs.Hls is deprecated. Use videojs.Vhs instead.\"),Ec},configurable:!0}),tr.use||(tr.registerComponent(\"Hls\",Ec),tr.registerComponent(\"Vhs\",Ec)),tr.options.vhs=tr.options.vhs||{},tr.options.hls=tr.options.hls||{},tr.getPlugin&&tr.getPlugin(\"reloadSourceOnError\")||(tr.registerPlugin||tr.plugin)(\"reloadSourceOnError\",function(e){Yl(this,e)}),tr});",
          "",
          "---------------"
        ],
        "templates/webclient/files.html||templates/webclient/files.html": [
          "File: templates/webclient/files.html -> templates/webclient/files.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "24: <link href=\"{{.StaticURL}}/vendor/datatables/responsive.bootstrap4.min.css\" rel=\"stylesheet\">",
          "25: <link href=\"{{.StaticURL}}/vendor/datatables/dataTables.checkboxes.css\" rel=\"stylesheet\">",
          "26: <link href=\"{{.StaticURL}}/vendor/lightbox2/css/lightbox.min.css\" rel=\"stylesheet\">",
          "27: <style>",
          "28:     div.dataTables_wrapper span.selected-info,",
          "29:     div.dataTables_wrapper span.selected-item {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "27: <link href=\"{{.StaticURL}}/vendor/video-js/video-js.min.css\" rel=\"stylesheet\" />",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "185:     </div>",
          "186: </div>",
          "188: <div class=\"modal fade\" id=\"spinnerModal\" tabindex=\"-1\" role=\"dialog\" data-keyboard=\"false\" data-backdrop=\"static\">",
          "189:     <div class=\"modal-dialog modal-dialog-centered justify-content-center\" role=\"document\">",
          "190:         <span style=\"color: #333333;\" class=\"fa fa-spinner fa-spin fa-3x\"></span>",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "189: <div class=\"modal fade\" id=\"videoModal\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"videoModalLabel\"",
          "190:     aria-hidden=\"true\">",
          "191:     <div class=\"modal-dialog modal-lg\" role=\"document\">",
          "192:         <div class=\"modal-content\">",
          "193:             <div class=\"modal-header\">",
          "194:                 <h5 class=\"modal-title\" id=\"videoModalLabel\">",
          "195:                     <span id=\"video_title\"></span>",
          "196:                 </h5>",
          "197:                 <button class=\"close\" type=\"button\" data-dismiss=\"modal\" aria-label=\"Close\">",
          "198:                     <span aria-hidden=\"true\">&times;</span>",
          "199:                 </button>",
          "200:             </div>",
          "201:             <div class=\"modal-body\">",
          "202:                 <video id=\"video_player\" class=\"video-js vjs-big-play-centered vjs-fluid\">",
          "203:                     <p class=\"vjs-no-js\">To view this video please enable JavaScript, and consider upgrading to a web browser that supports HTML5 video</p>",
          "204:                   </video>",
          "205:             </div>",
          "206:         </div>",
          "207:     </div>",
          "208: </div>",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "206: <script src=\"{{.StaticURL}}/vendor/pdfobject/pdfobject.min.js\"></script>",
          "207: <script src=\"{{.StaticURL}}/vendor/codemirror/codemirror.js\"></script>",
          "208: <script src=\"{{.StaticURL}}/vendor/codemirror/meta.js\"></script>",
          "209: {{if .HasIntegrations}}",
          "210: <script type=\"text/javascript\">",
          "211:     var childReference = null;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "231: <script src=\"{{.StaticURL}}/vendor/video-js/video.min.js\"></script>",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "407: {{end}}",
          "408: <script type=\"text/javascript\">",
          "409:     var spinnerDone = false;",
          "411:     var escapeHTML = function ( t ) {",
          "412:   return t",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "433:     var player;",
          "434:     var playerKeepAlive;",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "429:         return shortened+'&#8230;';",
          "430:     }",
          "432:     function getIconForFile(filename) {",
          "433:         var extension = filename.slice((filename.lastIndexOf(\".\") - 1 >>> 0) + 2).toLowerCase();",
          "434:         switch (extension) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "457:     function openVideoPlayer(name, url, videoType){",
          "458:         $(\"#video_title\").text(name);",
          "459:         $('#videoModal').modal('show');",
          "460:         player.src({",
          "461:             type: videoType,",
          "462:             src: url",
          "463:         });",
          "464:         keepAlive();",
          "465:         playerKeepAlive = setInterval(keepAlive, 300000);",
          "466:     }",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "460:             case \"mpeg\":",
          "461:             case \"mpv\":",
          "462:             case \"3gp\":",
          "463:                 return \"far fa-file-video\";",
          "464:             case \"jpeg\":",
          "465:             case \"jpg\":",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "499:             case \"mp4\":",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "622:     }",
          "624:     $(document).ready(function () {",
          "625:         $('#spinnerModal').on('shown.bs.modal', function () {",
          "626:             if (spinnerDone){",
          "627:                 $('#spinnerModal').modal('hide');",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "662:         player = videojs('video_player', {",
          "663:             controls: true,",
          "664:             autoplay: false,",
          "665:             preload: 'auto'",
          "666:         });",
          "667:         $('#videoModal').on('hide.bs.modal', function () {",
          "668:             player.pause();",
          "669:             player.reset();",
          "670:             if (playerKeepAlive != null){",
          "671:                 clearInterval(playerKeepAlive);",
          "672:             }",
          "673:         });",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "998:                                     case \"ico\":",
          "999:                                         var view_url = row['url']+\"&inline=1\";",
          "1000:                                         return `<a href=\"${view_url}\" data-lightbox=\"${filename}\" data-title=\"${filename}\"><i class=\"fas fa-eye\"></i></a>`;",
          "1001:                                     case \"pdf\":",
          "1002:                                         if (PDFObject.supportsPDFs){",
          "1003:                                             var view_url = row['url'];",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1051:                                     case \"mp4\":",
          "1052:                                     case \"mov\":",
          "1053:                                         return `<a href=\"#\" onclick=\"openVideoPlayer('${row[\"name\"]}', '${row['url']}', 'video/mp4');\"><i class=\"fas fa-eye\"></i></a>`;",
          "1054:                                     case \"webm\":",
          "1055:                                         return `<a href=\"#\" onclick=\"openVideoPlayer('${row[\"name\"]}', '${row['url']}', 'video/webm');\"><i class=\"fas fa-eye\"></i></a>`;",
          "1056:                                     case \"ogv\":",
          "1057:                                     case \"ogg\":",
          "1058:                                         return `<a href=\"#\" onclick=\"openVideoPlayer('${row[\"name\"]}', '${row['url']}', 'video/ogg');\"><i class=\"fas fa-eye\"></i></a>`;",
          "",
          "---------------"
        ],
        "templates/webclient/sharefiles.html||templates/webclient/sharefiles.html": [
          "File: templates/webclient/sharefiles.html -> templates/webclient/sharefiles.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "147:             case \"mpeg\":",
          "148:             case \"mpv\":",
          "149:             case \"3gp\":",
          "150:                 return \"far fa-file-video\";",
          "151:             case \"jpeg\":",
          "152:             case \"jpg\":",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "150:             case \"mp4\":",
          "",
          "---------------"
        ],
        "vfs/sftpfs.go||vfs/sftpfs.go": [
          "File: vfs/sftpfs.go -> vfs/sftpfs.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "295:  if err != nil {",
          "296:   return nil, nil, nil, err",
          "297:  }",
          "301:  if offset > 0 {",
          "302:   _, err = f.Seek(offset, io.SeekStart)",
          "303:   if err != nil {",
          "",
          "[Removed Lines]",
          "298:  if fs.config.BufferSize == 0 {",
          "299:   return f, nil, nil, err",
          "300:  }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "305:    return nil, nil, nil, err",
          "306:   }",
          "307:  }",
          "308:  r, w, err := pipeat.PipeInDir(fs.localTempDir)",
          "309:  if err != nil {",
          "310:   f.Close()",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "305:  if fs.config.BufferSize == 0 {",
          "306:   return f, nil, nil, nil",
          "307:  }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "509: func (fs *SFTPFs) CheckRootPath(username string, uid int, gid int) bool {",
          "515:  if fs.config.Prefix == \"/\" {",
          "516:   return true",
          "517:  }",
          "",
          "[Removed Lines]",
          "510:  if fs.config.BufferSize > 0 {",
          "512:   osFs := NewOsFs(fs.ConnectionID(), fs.localTempDir, \"\")",
          "513:   osFs.CheckRootPath(username, uid, gid)",
          "514:  }",
          "",
          "[Added Lines]",
          "511:  osFs := NewOsFs(fs.ConnectionID(), fs.localTempDir, \"\")",
          "512:  osFs.CheckRootPath(username, uid, gid)",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "bedc8e288b1200fbc6c2d100d0dd7ee0065d4deb",
      "candidate_info": {
        "commit_hash": "bedc8e288b1200fbc6c2d100d0dd7ee0065d4deb",
        "repo": "drakkan/sftpgo",
        "commit_url": "https://github.com/drakkan/sftpgo/commit/bedc8e288b1200fbc6c2d100d0dd7ee0065d4deb",
        "files": [
          "config/config.go",
          "config/config_test.go",
          "docs/full-configuration.md",
          "examples/webclient-integrations/test.html",
          "httpd/httpd.go",
          "httpd/httpd_test.go",
          "httpd/internal_test.go",
          "httpd/server.go",
          "httpd/webclient.go",
          "sftpgo.json",
          "templates/webclient/editfile.html",
          "templates/webclient/files.html",
          "windows-installer/README.txt",
          "windows-installer/sftpgo.iss"
        ],
        "message": "web client: add support for integrating external viewers/editors",
        "before_after_code_files": [
          "config/config.go||config/config.go",
          "config/config_test.go||config/config_test.go",
          "examples/webclient-integrations/test.html||examples/webclient-integrations/test.html",
          "httpd/httpd.go||httpd/httpd.go",
          "httpd/httpd_test.go||httpd/httpd_test.go",
          "httpd/internal_test.go||httpd/internal_test.go",
          "httpd/server.go||httpd/server.go",
          "httpd/webclient.go||httpd/webclient.go",
          "templates/webclient/editfile.html||templates/webclient/editfile.html",
          "templates/webclient/files.html||templates/webclient/files.html",
          "windows-installer/sftpgo.iss||windows-installer/sftpgo.iss"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "templates/webclient/files.html||templates/webclient/files.html"
          ],
          "candidate": [
            "templates/webclient/files.html||templates/webclient/files.html"
          ]
        }
      },
      "candidate_diff": {
        "config/config.go||config/config.go": [
          "File: config/config.go -> config/config.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "70:   ProxyAllowed:    nil,",
          "71:  }",
          "72:  defaultHTTPDBinding = httpd.Binding{",
          "83:  }",
          "84:  defaultRateLimiter = common.RateLimiterConfig{",
          "85:   Average:                0,",
          "",
          "[Removed Lines]",
          "73:   Address:         \"127.0.0.1\",",
          "74:   Port:            8080,",
          "75:   EnableWebAdmin:  true,",
          "76:   EnableWebClient: true,",
          "77:   EnableHTTPS:     false,",
          "78:   ClientAuthType:  0,",
          "79:   TLSCipherSuites: nil,",
          "80:   ProxyAllowed:    nil,",
          "81:   HideLoginURL:    0,",
          "82:   RenderOpenAPI:   true,",
          "",
          "[Added Lines]",
          "73:   Address:               \"127.0.0.1\",",
          "74:   Port:                  8080,",
          "75:   EnableWebAdmin:        true,",
          "76:   EnableWebClient:       true,",
          "77:   EnableHTTPS:           false,",
          "78:   ClientAuthType:        0,",
          "79:   TLSCipherSuites:       nil,",
          "80:   ProxyAllowed:          nil,",
          "81:   HideLoginURL:          0,",
          "82:   RenderOpenAPI:         true,",
          "83:   WebClientIntegrations: nil,",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1022:  }",
          "1023: }",
          "1025: func getHTTPDBindingFromEnv(idx int) {",
          "1026:  binding := httpd.Binding{",
          "1027:   EnableWebAdmin:  true,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1026: func getHTTPDWebClientIntegrationsFromEnv(idx int) []httpd.WebClientIntegration {",
          "1027:  var integrations []httpd.WebClientIntegration",
          "1029:  for subIdx := 0; subIdx < 10; subIdx++ {",
          "1030:   var integration httpd.WebClientIntegration",
          "1032:   url, ok := os.LookupEnv(fmt.Sprintf(\"SFTPGO_HTTPD__BINDINGS__%v__WEB_CLIENT_INTEGRATIONS__%v__URL\", idx, subIdx))",
          "1033:   if ok {",
          "1034:    integration.URL = url",
          "1035:   }",
          "1037:   extensions, ok := lookupStringListFromEnv(fmt.Sprintf(\"SFTPGO_HTTPD__BINDINGS__%v__WEB_CLIENT_INTEGRATIONS__%v__FILE_EXTENSIONS\",",
          "1038:    idx, subIdx))",
          "1039:   if ok {",
          "1040:    integration.FileExtensions = extensions",
          "1041:   }",
          "1043:   if url != \"\" && len(extensions) > 0 {",
          "1044:    integrations = append(integrations, integration)",
          "1045:   }",
          "1046:  }",
          "1048:  return integrations",
          "1049: }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1064:   isSet = true",
          "1065:  }",
          "1067:  enableHTTPS, ok := lookupBoolFromEnv(fmt.Sprintf(\"SFTPGO_HTTPD__BINDINGS__%v__ENABLE_HTTPS\", idx))",
          "1068:  if ok {",
          "1069:   binding.EnableHTTPS = enableHTTPS",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1093:  webClientIntegrations := getHTTPDWebClientIntegrationsFromEnv(idx)",
          "1094:  if len(webClientIntegrations) > 0 {",
          "1095:   binding.WebClientIntegrations = webClientIntegrations",
          "1096:   isSet = true",
          "1097:  }",
          "",
          "---------------"
        ],
        "config/config_test.go||config/config_test.go": [
          "File: config/config_test.go -> config/config_test.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "770:  os.Setenv(\"SFTPGO_HTTPD__BINDINGS__2__TLS_CIPHER_SUITES\", \" TLS_AES_256_GCM_SHA384 , TLS_CHACHA20_POLY1305_SHA256\")",
          "771:  os.Setenv(\"SFTPGO_HTTPD__BINDINGS__2__PROXY_ALLOWED\", \" 192.168.9.1 , 172.16.25.0/24\")",
          "772:  os.Setenv(\"SFTPGO_HTTPD__BINDINGS__2__HIDE_LOGIN_URL\", \"3\")",
          "773:  t.Cleanup(func() {",
          "774:   os.Unsetenv(\"SFTPGO_HTTPD__BINDINGS__0__ADDRESS\")",
          "775:   os.Unsetenv(\"SFTPGO_HTTPD__BINDINGS__0__PORT\")",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "773:  os.Setenv(\"SFTPGO_HTTPD__BINDINGS__2__WEB_CLIENT_INTEGRATIONS__1__URL\", \"http://127.0.0.1/\")",
          "774:  os.Setenv(\"SFTPGO_HTTPD__BINDINGS__2__WEB_CLIENT_INTEGRATIONS__1__FILE_EXTENSIONS\", \".pdf, .txt\")",
          "775:  os.Setenv(\"SFTPGO_HTTPD__BINDINGS__2__WEB_CLIENT_INTEGRATIONS__2__URL\", \"http://127.0.1.1/\")",
          "776:  os.Setenv(\"SFTPGO_HTTPD__BINDINGS__2__WEB_CLIENT_INTEGRATIONS__3__FILE_EXTENSIONS\", \".jpg, .txt\")",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "788:   os.Unsetenv(\"SFTPGO_HTTPD__BINDINGS__2__TLS_CIPHER_SUITES\")",
          "789:   os.Unsetenv(\"SFTPGO_HTTPD__BINDINGS__2__PROXY_ALLOWED\")",
          "790:   os.Unsetenv(\"SFTPGO_HTTPD__BINDINGS__2__HIDE_LOGIN_URL\")",
          "791:  })",
          "793:  configDir := \"..\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "795:   os.Unsetenv(\"SFTPGO_HTTPD__BINDINGS__2__WEB_CLIENT_INTEGRATIONS__1__URL\")",
          "796:   os.Unsetenv(\"SFTPGO_HTTPD__BINDINGS__2__WEB_CLIENT_INTEGRATIONS__1__FILE_EXTENSIONS\")",
          "797:   os.Unsetenv(\"SFTPGO_HTTPD__BINDINGS__2__WEB_CLIENT_INTEGRATIONS__2__URL\")",
          "798:   os.Unsetenv(\"SFTPGO_HTTPD__BINDINGS__2__WEB_CLIENT_INTEGRATIONS__3__FILE_EXTENSIONS\")",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "827:  require.Equal(t, \"192.168.9.1\", bindings[2].ProxyAllowed[0])",
          "828:  require.Equal(t, \"172.16.25.0/24\", bindings[2].ProxyAllowed[1])",
          "829:  require.Equal(t, 3, bindings[2].HideLoginURL)",
          "830: }",
          "832: func TestHTTPClientCertificatesFromEnv(t *testing.T) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "838:  require.Len(t, bindings[2].WebClientIntegrations, 1)",
          "839:  require.Equal(t, \"http://127.0.0.1/\", bindings[2].WebClientIntegrations[0].URL)",
          "840:  require.Equal(t, []string{\".pdf\", \".txt\"}, bindings[2].WebClientIntegrations[0].FileExtensions)",
          "",
          "---------------"
        ],
        "examples/webclient-integrations/test.html||examples/webclient-integrations/test.html": [
          "File: examples/webclient-integrations/test.html -> examples/webclient-integrations/test.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: <!DOCTYPE html>",
          "2: <html lang=\"en\">",
          "4: <head>",
          "5:     <meta charset=\"utf-8\">",
          "6:     <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">",
          "7:     <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\">",
          "9:     <title>SFTPGo WebClient - External integration test</title>",
          "10: </head>",
          "12: <body>",
          "13:     <textarea id=\"textarea_test\" name=\"textarea_test\" rows=\"6\" cols=\"80\">The text here will be sent to SFTPGo as blob</textarea>",
          "14:     <br>",
          "15:     <button onclick=\"saveBlob(false);\">Save</button>",
          "16:     <br>",
          "17:     <button onclick=\"saveBlob(true);\">Save binary file</button>",
          "19:     <script src=\"https://code.jquery.com/jquery-3.6.0.min.js\"></script>",
          "20:     <script type=\"text/javascript\">",
          "21:         var fileName;",
          "22:         var sftpgoUser;",
          "25:         $(document).ready(function () {",
          "26:             if (window.opener == null || window.opener.closed) {",
          "27:                 console.log(\"windows opener gone!\");",
          "28:                 return;",
          "29:             }",
          "31:             window.opener.postMessage({type: 'ready'},\"*\");",
          "32:         });",
          "34:         window.addEventListener('message', (event) => {",
          "35:             if (window.opener == null || window.opener.closed) {",
          "36:                 console.log(\"windows opener gone!\");",
          "37:                 return;",
          "38:             }",
          "40:             console.log(\"new message: \"+JSON.stringify(event.data));",
          "41:             switch (event.data.type){",
          "42:                 case 'readyResponse':",
          "45:                     fileName = event.data.file_name;",
          "46:                     sftpgoUser = event.data.user;",
          "47:                     console.log(\"ready response received, file name: \" + fileName+\" SFTPGo user: \"+sftpgoUser);",
          "49:                     window.opener.postMessage({type: 'sendBlob'}, \"*\");",
          "50:                     break;",
          "51:                 case 'blobDownloadStart':",
          "54:                     console.log(\"blob download start received, file name: \" + fileName+\" SFTPGo user: \"+sftpgoUser);",
          "55:                     break;",
          "56:                 case 'blob':",
          "58:                     var extension = fileName.slice((fileName.lastIndexOf(\".\") - 1 >>> 0) + 2).toLowerCase();",
          "59:                     console.log(\"blob received, file name: \" + fileName+\" extension: \"+extension+\" SFTPGo user: \"+sftpgoUser);",
          "60:                     if (extension == \"txt\"){",
          "61:                         event.data.file.text().then(function(text){",
          "62:                             $(\"#textarea_test\").val(text);",
          "63:                         });",
          "64:                     }",
          "65:                     break;",
          "66:                 case 'blobSaveResult':",
          "68:                     console.log(\"blob save status: \"+event.data.status+\", message: \"+event.data.message);",
          "69:                     if (event.data.status == \"OK\"){",
          "70:                         console.log(\"blob saved, I'm useless now, close me\");",
          "71:                     }",
          "72:                     break;",
          "73:                 default:",
          "74:                     console.log(\"Unsupported message: \" + JSON.stringify(event.data));",
          "75:             }",
          "76:         });",
          "78:         function saveBlob(binary){",
          "80:             console.log(\"save blob, binary? \"+binary);",
          "81:             if (binary){",
          "83:                 fetch('https://raw.githubusercontent.com/drakkan/sftpgo/main/docs/howto/img/logo.png')",
          "84:                     .then(response => response.blob())",
          "85:                     .then(function(responseBlob){",
          "86:                         var blob = new File([responseBlob], fileName);",
          "87:                         window.opener.postMessage({",
          "88:                             type: 'saveBlob',",
          "89:                             file: blob",
          "90:                         },\"*\");",
          "91:                     });",
          "92:             } else {",
          "93:                 var blob = new Blob([$(\"#textarea_test\").val()]);",
          "94:                 window.opener.postMessage({",
          "95:                     type: 'saveBlob',",
          "96:                     file: blob",
          "97:                 },\"*\");",
          "98:             }",
          "99:         }",
          "100:     </script>",
          "101: </body>",
          "",
          "---------------"
        ],
        "httpd/httpd.go||httpd/httpd.go": [
          "File: httpd/httpd.go -> httpd/httpd.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "223:  updateWebClientURLs(\"\")",
          "224: }",
          "227: type Binding struct {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "227: type WebClientIntegration struct {",
          "229:  FileExtensions []string `json:\"file_extensions\" mapstructure:\"file_extensions\"`",
          "231:  URL string `json:\"url\" mapstructure:\"url\"`",
          "232: }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "263:  HideLoginURL int `json:\"hide_login_url\" mapstructure:\"hide_login_url\"`",
          "267: }",
          "269: func (b *Binding) parseAllowedProxy() error {",
          "",
          "[Removed Lines]",
          "265:  RenderOpenAPI    bool `json:\"render_openapi\" mapstructure:\"render_openapi\"`",
          "266:  allowHeadersFrom []func(net.IP) bool",
          "",
          "[Added Lines]",
          "273:  RenderOpenAPI bool `json:\"render_openapi\" mapstructure:\"render_openapi\"`",
          "276:  WebClientIntegrations []WebClientIntegration `json:\"web_client_integrations\" mapstructure:\"web_client_integrations\"`",
          "277:  allowHeadersFrom      []func(net.IP) bool",
          "278: }",
          "280: func (b *Binding) checkWebClientIntegrations() {",
          "281:  var integrations []WebClientIntegration",
          "282:  for _, integration := range b.WebClientIntegrations {",
          "283:   if integration.URL != \"\" && len(integration.FileExtensions) > 0 {",
          "284:    integrations = append(integrations, integration)",
          "285:   }",
          "286:  }",
          "287:  b.WebClientIntegrations = integrations",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "477:   if err := binding.parseAllowedProxy(); err != nil {",
          "478:    return err",
          "479:   }",
          "481:   go func(b Binding) {",
          "482:    server := newHttpdServer(b, staticFilesPath, c.SigningPassphrase, c.Cors, openAPIPath)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "501:   binding.checkWebClientIntegrations()",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "618: }",
          "629:  server := newHttpdServer(b, \"../static\", \"\", CorsConfig{}, \"../openapi\")",
          "630:  server.initializeRouter()",
          "631:  return server.router",
          "",
          "[Removed Lines]",
          "621: func GetHTTPRouter() http.Handler {",
          "622:  b := Binding{",
          "623:   Address:         \"\",",
          "624:   Port:            8080,",
          "625:   EnableWebAdmin:  true,",
          "626:   EnableWebClient: true,",
          "627:   RenderOpenAPI:   true,",
          "628:  }",
          "",
          "[Added Lines]",
          "643: func GetHTTPRouter(b Binding) http.Handler {",
          "",
          "---------------"
        ],
        "httpd/httpd_test.go||httpd/httpd_test.go": [
          "File: httpd/httpd_test.go -> httpd/httpd_test.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "262:  os.Setenv(\"SFTPGO_DATA_PROVIDER__CREATE_DEFAULT_ADMIN\", \"1\")",
          "263:  os.Setenv(\"SFTPGO_DEFAULT_ADMIN_USERNAME\", \"admin\")",
          "264:  os.Setenv(\"SFTPGO_DEFAULT_ADMIN_PASSWORD\", \"password\")",
          "265:  err := config.LoadConfig(configDir, \"\")",
          "266:  if err != nil {",
          "267:   logger.WarnToConsole(\"error loading configuration: %v\", err)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "265:  os.Setenv(\"SFTPGO_HTTPD__BINDINGS__0__WEB_CLIENT_INTEGRATIONS__0__URL\", \"http://127.0.0.1/test.html\")",
          "266:  os.Setenv(\"SFTPGO_HTTPD__BINDINGS__0__WEB_CLIENT_INTEGRATIONS__0__FILE_EXTENSIONS\", \".pdf,.txt\")",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "393:  waitTCPListening(httpdConf.Bindings[0].GetAddress())",
          "394:  httpd.ReloadCertificateMgr() //nolint:errcheck",
          "397:  defer testServer.Close()",
          "399:  exitCode := m.Run()",
          "",
          "[Removed Lines]",
          "396:  testServer = httptest.NewServer(httpd.GetHTTPRouter())",
          "",
          "[Added Lines]",
          "398:  testServer = httptest.NewServer(httpd.GetHTTPRouter(httpdConf.Bindings[0]))",
          "",
          "---------------"
        ],
        "httpd/internal_test.go||httpd/internal_test.go": [
          "File: httpd/internal_test.go -> httpd/internal_test.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "664:   assert.Contains(t, err.Error(), \"form token is not valid\")",
          "665:  }",
          "668:  fn := verifyCSRFHeader(r)",
          "669:  rr := httptest.NewRecorder()",
          "670:  req, _ := http.NewRequest(http.MethodDelete, path.Join(userPath, \"username\"), nil)",
          "",
          "[Removed Lines]",
          "667:  r := GetHTTPRouter()",
          "",
          "[Added Lines]",
          "667:  r := GetHTTPRouter(Binding{",
          "668:   Address:         \"\",",
          "669:   Port:            8080,",
          "670:   EnableWebAdmin:  true,",
          "671:   EnableWebClient: true,",
          "672:   RenderOpenAPI:   true,",
          "673:  })",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "883: }",
          "885: func TestAPIKeyAuthForbidden(t *testing.T) {",
          "887:  fn := forbidAPIKeyAuthentication(r)",
          "888:  rr := httptest.NewRecorder()",
          "889:  req, _ := http.NewRequest(http.MethodGet, versionPath, nil)",
          "",
          "[Removed Lines]",
          "886:  r := GetHTTPRouter()",
          "",
          "[Added Lines]",
          "892:  r := GetHTTPRouter(Binding{",
          "893:   Address:         \"\",",
          "894:   Port:            8080,",
          "895:   EnableWebAdmin:  true,",
          "896:   EnableWebClient: true,",
          "897:   RenderOpenAPI:   true,",
          "898:  })",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "900:  token, _, err := tokenAuth.Encode(claims)",
          "901:  assert.NoError(t, err)",
          "904:  fn := jwtAuthenticatorAPI(r)",
          "905:  rr := httptest.NewRecorder()",
          "906:  req, _ := http.NewRequest(http.MethodGet, userPath, nil)",
          "",
          "[Removed Lines]",
          "903:  r := GetHTTPRouter()",
          "",
          "[Added Lines]",
          "915:  r := GetHTTPRouter(Binding{",
          "916:   Address:         \"\",",
          "917:   Port:            8080,",
          "918:   EnableWebAdmin:  true,",
          "919:   EnableWebClient: true,",
          "920:   RenderOpenAPI:   true,",
          "921:  })",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1913:  req, _ := http.NewRequest(http.MethodGet, webClientFilesPath, nil)",
          "1914:  req.Header.Set(\"Cookie\", fmt.Sprintf(\"jwt=%v\", token[\"access_token\"]))",
          "1916:  assert.Equal(t, http.StatusForbidden, rr.Code)",
          "1917:  assert.Contains(t, rr.Body.String(), \"Invalid token claims\")",
          "1919:  rr = httptest.NewRecorder()",
          "1920:  req, _ = http.NewRequest(http.MethodGet, webClientDirsPath, nil)",
          "1921:  req.Header.Set(\"Cookie\", fmt.Sprintf(\"jwt=%v\", token[\"access_token\"]))",
          "1923:  assert.Equal(t, http.StatusForbidden, rr.Code)",
          "1924:  assert.Contains(t, rr.Body.String(), \"invalid token claims\")",
          "",
          "[Removed Lines]",
          "1915:  handleClientGetFiles(rr, req)",
          "1922:  handleClientGetDirContents(rr, req)",
          "",
          "[Added Lines]",
          "1933:  server.handleClientGetFiles(rr, req)",
          "1940:  server.handleClientGetDirContents(rr, req)",
          "",
          "---------------"
        ],
        "httpd/server.go||httpd/server.go": [
          "File: httpd/server.go -> httpd/server.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "1222:    router.Use(jwtAuthenticatorWebClient)",
          "1224:    router.Get(webClientLogoutPath, handleWebClientLogout)",
          "1226:    router.With(s.refreshCookie).Get(webClientViewPDFPath, handleClientViewPDF)",
          "1227:    router.With(checkHTTPUserPerm(sdk.WebClientWriteDisabled), verifyCSRFHeader).",
          "1228:     Post(webClientFilesPath, uploadUserFiles)",
          "",
          "[Removed Lines]",
          "1225:    router.With(s.refreshCookie).Get(webClientFilesPath, handleClientGetFiles)",
          "",
          "[Added Lines]",
          "1225:    router.With(s.refreshCookie).Get(webClientFilesPath, s.handleClientGetFiles)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1231:     Patch(webClientFilesPath, renameUserFile)",
          "1232:    router.With(checkHTTPUserPerm(sdk.WebClientWriteDisabled), verifyCSRFHeader).",
          "1233:     Delete(webClientFilesPath, deleteUserFile)",
          "1235:    router.With(checkHTTPUserPerm(sdk.WebClientWriteDisabled), verifyCSRFHeader).",
          "1236:     Post(webClientDirsPath, createUserDir)",
          "1237:    router.With(checkHTTPUserPerm(sdk.WebClientWriteDisabled), verifyCSRFHeader).",
          "",
          "[Removed Lines]",
          "1234:    router.With(compressor.Handler, s.refreshCookie).Get(webClientDirsPath, handleClientGetDirContents)",
          "",
          "[Added Lines]",
          "1234:    router.With(compressor.Handler, s.refreshCookie).Get(webClientDirsPath, s.handleClientGetDirContents)",
          "",
          "---------------"
        ],
        "httpd/webclient.go||httpd/webclient.go": [
          "File: httpd/webclient.go -> httpd/webclient.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "118: type filesPage struct {",
          "119:  baseClientPage",
          "132: }",
          "134: type clientMessagePage struct {",
          "",
          "[Removed Lines]",
          "120:  CurrentDir    string",
          "121:  DirsURL       string",
          "122:  DownloadURL   string",
          "123:  ViewPDFURL    string",
          "124:  CanAddFiles   bool",
          "125:  CanCreateDirs bool",
          "126:  CanRename     bool",
          "127:  CanDelete     bool",
          "128:  CanDownload   bool",
          "129:  CanShare      bool",
          "130:  Error         string",
          "131:  Paths         []dirMapping",
          "",
          "[Added Lines]",
          "120:  CurrentDir      string",
          "121:  DirsURL         string",
          "122:  DownloadURL     string",
          "123:  ViewPDFURL      string",
          "124:  CanAddFiles     bool",
          "125:  CanCreateDirs   bool",
          "126:  CanRename       bool",
          "127:  CanDelete       bool",
          "128:  CanDownload     bool",
          "129:  CanShare        bool",
          "130:  Error           string",
          "131:  Paths           []dirMapping",
          "132:  HasIntegrations bool",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "436:  renderClientTemplate(w, templateClientShare, data)",
          "437: }",
          "440:  data := filesPage{",
          "453:  }",
          "454:  paths := []dirMapping{}",
          "455:  if dirName != \"/\" {",
          "",
          "[Removed Lines]",
          "439: func renderFilesPage(w http.ResponseWriter, r *http.Request, dirName, error string, user dataprovider.User) {",
          "441:   baseClientPage: getBaseClientPageData(pageClientFilesTitle, webClientFilesPath, r),",
          "442:   Error:          error,",
          "443:   CurrentDir:     url.QueryEscape(dirName),",
          "444:   DownloadURL:    webClientDownloadZipPath,",
          "445:   ViewPDFURL:     webClientViewPDFPath,",
          "446:   DirsURL:        webClientDirsPath,",
          "447:   CanAddFiles:    user.CanAddFilesFromWeb(dirName),",
          "448:   CanCreateDirs:  user.CanAddDirsFromWeb(dirName),",
          "449:   CanRename:      user.CanRenameFromWeb(dirName, dirName),",
          "450:   CanDelete:      user.CanDeleteFromWeb(dirName),",
          "451:   CanDownload:    user.HasPerm(dataprovider.PermDownload, dirName),",
          "452:   CanShare:       user.CanManageShares(),",
          "",
          "[Added Lines]",
          "440: func renderFilesPage(w http.ResponseWriter, r *http.Request, dirName, error string, user dataprovider.User,",
          "441:  hasIntegrations bool,",
          "442: ) {",
          "444:   baseClientPage:  getBaseClientPageData(pageClientFilesTitle, webClientFilesPath, r),",
          "445:   Error:           error,",
          "446:   CurrentDir:      url.QueryEscape(dirName),",
          "447:   DownloadURL:     webClientDownloadZipPath,",
          "448:   ViewPDFURL:      webClientViewPDFPath,",
          "449:   DirsURL:         webClientDirsPath,",
          "450:   CanAddFiles:     user.CanAddFilesFromWeb(dirName),",
          "451:   CanCreateDirs:   user.CanAddDirsFromWeb(dirName),",
          "452:   CanRename:       user.CanRenameFromWeb(dirName, dirName),",
          "453:   CanDelete:       user.CanDeleteFromWeb(dirName),",
          "454:   CanDownload:     user.HasPerm(dataprovider.PermDownload, dirName),",
          "455:   CanShare:        user.CanManageShares(),",
          "456:   HasIntegrations: hasIntegrations,",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "552:  renderCompressedFiles(w, connection, name, filesList, nil)",
          "553: }",
          "556:  r.Body = http.MaxBytesReader(w, r.Body, maxRequestSize)",
          "557:  claims, err := getTokenClaims(r)",
          "558:  if err != nil || claims.Username == \"\" {",
          "",
          "[Removed Lines]",
          "555: func handleClientGetDirContents(w http.ResponseWriter, r *http.Request) {",
          "",
          "[Added Lines]",
          "559: func (s *httpdServer) handleClientGetDirContents(w http.ResponseWriter, r *http.Request) {",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "595:  for _, info := range contents {",
          "596:   res := make(map[string]string)",
          "597:   res[\"url\"] = getFileObjectURL(name, info.Name())",
          "599:   if info.IsDir() {",
          "600:    res[\"type\"] = \"1\"",
          "601:    res[\"size\"] = \"\"",
          "",
          "[Removed Lines]",
          "598:   editURL := \"\"",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "606:    } else {",
          "607:     res[\"size\"] = util.ByteCountIEC(info.Size())",
          "608:     if info.Size() < httpdMaxEditFileSize {",
          "610:     }",
          "611:    }",
          "612:   }",
          "613:   res[\"meta\"] = fmt.Sprintf(\"%v_%v\", res[\"type\"], info.Name())",
          "614:   res[\"name\"] = info.Name()",
          "615:   res[\"last_modified\"] = getFileObjectModTime(info.ModTime())",
          "617:   results = append(results, res)",
          "618:  }",
          "620:  render.JSON(w, r, results)",
          "621: }",
          "624:  r.Body = http.MaxBytesReader(w, r.Body, maxRequestSize)",
          "625:  claims, err := getTokenClaims(r)",
          "626:  if err != nil || claims.Username == \"\" {",
          "",
          "[Removed Lines]",
          "609:      editURL = strings.Replace(res[\"url\"], webClientFilesPath, webClientEditFilePath, 1)",
          "616:   res[\"edit_url\"] = editURL",
          "623: func handleClientGetFiles(w http.ResponseWriter, r *http.Request) {",
          "",
          "[Added Lines]",
          "612:      res[\"edit_url\"] = strings.Replace(res[\"url\"], webClientFilesPath, webClientEditFilePath, 1)",
          "613:     }",
          "614:     if len(s.binding.WebClientIntegrations) > 0 {",
          "615:      extension := path.Ext(info.Name())",
          "616:      for idx := range s.binding.WebClientIntegrations {",
          "617:       if util.IsStringInSlice(extension, s.binding.WebClientIntegrations[idx].FileExtensions) {",
          "618:        res[\"ext_url\"] = s.binding.WebClientIntegrations[idx].URL",
          "619:        break",
          "620:       }",
          "621:      }",
          "634: func (s *httpdServer) handleClientGetFiles(w http.ResponseWriter, r *http.Request) {",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "659:   info, err = connection.Stat(name, 0)",
          "660:  }",
          "661:  if err != nil {",
          "663:   return",
          "664:  }",
          "665:  if info.IsDir() {",
          "667:   return",
          "668:  }",
          "669:  inline := r.URL.Query().Get(\"inline\") != \"\"",
          "",
          "[Removed Lines]",
          "662:   renderFilesPage(w, r, path.Dir(name), fmt.Sprintf(\"unable to stat file %#v: %v\", name, err), user)",
          "666:   renderFilesPage(w, r, name, \"\", user)",
          "",
          "[Added Lines]",
          "673:   renderFilesPage(w, r, path.Dir(name), fmt.Sprintf(\"unable to stat file %#v: %v\", name, err),",
          "674:    user, len(s.binding.WebClientIntegrations) > 0)",
          "678:   renderFilesPage(w, r, name, \"\", user, len(s.binding.WebClientIntegrations) > 0)",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "673:     renderClientMessagePage(w, r, http.StatusText(status), \"\", status, err, \"\")",
          "674:     return",
          "675:    }",
          "677:   }",
          "678:  }",
          "679: }",
          "",
          "[Removed Lines]",
          "676:    renderFilesPage(w, r, path.Dir(name), err.Error(), user)",
          "",
          "[Added Lines]",
          "688:    renderFilesPage(w, r, path.Dir(name), err.Error(), user, len(s.binding.WebClientIntegrations) > 0)",
          "",
          "---------------"
        ],
        "templates/webclient/editfile.html||templates/webclient/editfile.html": [
          "File: templates/webclient/editfile.html -> templates/webclient/editfile.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "121:             cm.setOption(\"mode\", mode.mode);",
          "122:         }",
          "123:         cm.setValue(\"{{.Data}}\");",
          "125:     });",
          "127:     function keepAlive() {",
          "",
          "[Removed Lines]",
          "124:         setInterval(keepAlive, 90000);",
          "",
          "[Added Lines]",
          "124:         setInterval(keepAlive, 180000);",
          "",
          "---------------"
        ],
        "templates/webclient/files.html||templates/webclient/files.html": [
          "File: templates/webclient/files.html -> templates/webclient/files.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "42:                         <th>Size</th>",
          "43:                         <th>Last modified</th>",
          "44:                         <th></th>",
          "45:                     </tr>",
          "46:                 </thead>",
          "47:             </table>",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "45:                         <th></th>",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "183: <script src=\"{{.StaticURL}}/vendor/pdfobject/pdfobject.min.js\"></script>",
          "184: <script src=\"{{.StaticURL}}/vendor/codemirror/codemirror.js\"></script>",
          "185: <script src=\"{{.StaticURL}}/vendor/codemirror/meta.js\"></script>",
          "186: <script type=\"text/javascript\">",
          "187:     var spinnerDone = false;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "187: {{if .HasIntegrations}}",
          "188: <script type=\"text/javascript\">",
          "189:     var childReference = null;",
          "190:     var checkerStarted = false;",
          "191:     const childProps = new Map();",
          "193:     function openExternalURL(url, fileLink, fileName){",
          "194:         if (childReference == null || childReference.closed) {",
          "195:             childProps.set('link', fileLink);",
          "196:             childProps.set('url', url);",
          "197:             childProps.set('file_name', fileName);",
          "198:             childReference = window.open(url, '_blank');",
          "199:             if (!checkerStarted){",
          "200:                 keepAlive();",
          "201:                 setInterval(checkExternalWindow, 180000);",
          "202:                 checkerStarted = true;",
          "203:             }",
          "204:         } else {",
          "205:             $('#errorTxt').text('An external window is already open, please close it before trying to open a new one');",
          "206:             $('#errorMsg').show();",
          "207:             setTimeout(function () {",
          "208:                 $('#errorMsg').hide();",
          "209:             }, 8000);",
          "210:         }",
          "211:     }",
          "213:     function notifySave(status, message){",
          "214:         if (childReference == null || childReference.closed) {",
          "215:             console.log(\"external windows null or closed, cannot notify save\");",
          "216:             return;",
          "217:         }",
          "219:         childReference.postMessage({",
          "220:             type: 'blobSaveResult',",
          "221:             status: status,",
          "222:             message: message",
          "223:         }, childProps.get('url'));",
          "224:     }",
          "226:     window.addEventListener('message', (event) => {",
          "227:         var url = childProps.get('url');",
          "228:         if (!url || !url.startsWith(event.origin)){",
          "229:             console.log(\"origin: \"+event.origin+\" does not match the expected one: \"+url+\" refusing message\");",
          "230:             return;",
          "231:         }",
          "232:         if (childReference == null || childReference.closed) {",
          "233:             console.log(\"external windows null or closed, refusing message\");",
          "234:             return;",
          "235:         }",
          "236:         switch (event.data.type){",
          "237:             case 'ready':",
          "239:                 childReference.postMessage({",
          "240:                     type: 'readyResponse',",
          "241:                     user: '{{.LoggedUser.Username}}',",
          "242:                     file_name: childProps.get('file_name')",
          "243:                 }, childProps.get('url'));",
          "244:                 break;",
          "245:             case 'sendBlob':",
          "249:                 childReference.postMessage({",
          "250:                     type: 'blobDownloadStart'",
          "251:                 }, childProps.get('url'));",
          "253:                 fetch(childProps.get('link'))",
          "254:                     .then(response => response.blob())",
          "255:                     .then(function(responseBlob){",
          "256:                         let fileBlob = new File([responseBlob], childProps.get('file_name'), {type: responseBlob.type, lastModified: \"\"});",
          "257:                         childReference.postMessage({",
          "258:                             type: 'blob',",
          "259:                             file: fileBlob",
          "260:                         }, childProps.get('url'));",
          "261:                     });",
          "262:                 break;",
          "263:             case 'saveBlob':",
          "265:                 var path = '{{.FilesURL}}?path={{.CurrentDir}}';",
          "266:                 spinnerDone = false;",
          "267:                 var file = new File([event.data.file], childProps.get('file_name'));",
          "268:                 var data = new FormData();",
          "269:                 data.append('filenames', file);",
          "271:                 $.ajax({",
          "272:                     url: path,",
          "273:                     type: 'POST',",
          "274:                     data: data,",
          "275:                     processData: false,",
          "276:                     contentType: false,",
          "277:                     headers: { 'X-CSRF-TOKEN': '{{.CSRFToken}}' },",
          "278:                     timeout: 0,",
          "279:                     beforeSend: function () {",
          "280:                         $('#spinnerModal').modal('show');",
          "281:                     },",
          "282:                     success: function (result) {",
          "283:                         $('#spinnerModal').modal('hide');",
          "284:                         notifySave(\"OK\", \"\");",
          "285:                         setTimeout(function () {",
          "286:                             location.reload();",
          "287:                         }, 2000);",
          "288:                     },",
          "289:                     error: function ($xhr, textStatus, errorThrown) {",
          "290:                         $('#spinnerModal').modal('hide');",
          "291:                         var txt = \"Error saving external file\";",
          "292:                         if ($xhr) {",
          "293:                             var json = $xhr.responseJSON;",
          "294:                             if (json) {",
          "295:                                 if (json.message) {",
          "296:                                     txt = json.message;",
          "297:                                 }",
          "298:                                 if (json.error) {",
          "299:                                     txt += \": \" + json.error;",
          "300:                                 }",
          "301:                             }",
          "302:                         }",
          "303:                         notifySave(\"KO\", txt);",
          "304:                         $('#errorTxt').text(txt);",
          "305:                         $('#errorMsg').show();",
          "306:                         setTimeout(function () {",
          "307:                             $('#errorMsg').hide();",
          "308:                         }, 5000);",
          "309:                     }",
          "310:                 });",
          "312:                 break;",
          "313:             default:",
          "314:                 console.log(\"Unsupported message: \"+JSON.stringify(event.data));",
          "315:         }",
          "316:     });",
          "318:     function checkExternalWindow() {",
          "319:         if (childReference == null || childReference.closed) {",
          "320:             return;",
          "321:         }",
          "322:         keepAlive();",
          "323:     }",
          "324: </script>",
          "325: {{end}}",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "421:         $(\"#upload_files_form\").submit(function (event){",
          "422:             event.preventDefault();",
          "424:             var path = '{{.FilesURL}}?path={{.CurrentDir}}';",
          "426:             var files = $(\"#files_name\")[0].files;",
          "",
          "[Removed Lines]",
          "423:             var keepAliveTimer = setInterval(keepAlive, 90000);",
          "",
          "[Added Lines]",
          "563:             keepAlive();",
          "564:             var keepAliveTimer = setInterval(keepAlive, 180000);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "683:                         if (type === 'display') {",
          "684:                             var filename = row[\"name\"];",
          "685:                             var extension = filename.slice((filename.lastIndexOf(\".\") - 1 >>> 0) + 2).toLowerCase();",
          "687:                                 if (extension == \"csv\" || extension == \"bat\" || CodeMirror.findModeByExtension(extension) != null){",
          "688:                                     {{if .CanAddFiles}}",
          "689:                                     return `<a href=\"${data}\"><i class=\"fas fa-edit\"></i></a>`;",
          "",
          "[Removed Lines]",
          "686:                             if (data != \"\"){",
          "",
          "[Added Lines]",
          "827:                             if (data){",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "715:                         }",
          "716:                         return \"\";",
          "717:                     }",
          "718:                 }",
          "719:             ],",
          "720:             \"buttons\": [],",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "859:                 },",
          "860:                 { \"data\": \"ext_url\",",
          "861:                     \"render\": function (data, type, row) {",
          "862:                         {{if .HasIntegrations}}",
          "863:                         if (type === 'display') {",
          "864:                             if (data){",
          "865:                                 return `<a href=\"#\" onclick=\"openExternalURL('${data}', '${row[\"url\"]}', '${row[\"name\"]}');\"><i class=\"fas fa-external-link-alt\"></i></a>`;",
          "866:                             }",
          "867:                         }",
          "868:                         {{end}}",
          "869:                         return \"\";",
          "870:                     }",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "760:                     \"searchable\": false",
          "761:                 },",
          "762:                 {",
          "764:                     \"orderable\": false,",
          "765:                     \"searchable\": false",
          "766:                 }",
          "",
          "[Removed Lines]",
          "763:                     \"targets\": [5],",
          "",
          "[Added Lines]",
          "916:                     \"targets\": [5, 6],",
          "",
          "---------------"
        ],
        "windows-installer/sftpgo.iss||windows-installer/sftpgo.iss": [
          "File: windows-installer/sftpgo.iss -> windows-installer/sftpgo.iss",
          "--- Hunk 1 ---",
          "[Context before]",
          "64: Source: \"{#MyAppDir}\\sftpgo.db\"; DestDir: \"{commonappdata}\\{#MyAppName}\"; Flags: onlyifdoesntexist uninsneveruninstall",
          "65: Source: \"{#MyAppDir}\\LICENSE.txt\"; DestDir: \"{app}\"; Flags: ignoreversion",
          "66: Source: \"{#MyAppDir}\\sftpgo.json\"; DestDir: \"{commonappdata}\\{#MyAppName}\"; Flags: onlyifdoesntexist uninsneveruninstall",
          "67: Source: \"{#MyAppDir}\\templates\\*\"; DestDir: \"{commonappdata}\\{#MyAppName}\\templates\"; Flags: ignoreversion recursesubdirs createallsubdirs",
          "68: Source: \"{#MyAppDir}\\static\\*\"; DestDir: \"{commonappdata}\\{#MyAppName}\\static\"; Flags: ignoreversion recursesubdirs createallsubdirs",
          "69: Source: \"{#MyAppDir}\\openapi\\*\"; DestDir: \"{commonappdata}\\{#MyAppName}\\openapi\"; Flags: ignoreversion recursesubdirs createallsubdirs",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "67: Source: \"{#MyAppDir}\\sftpgo.json\"; DestDir: \"{commonappdata}\\{#MyAppName}\"; DestName: \"sftpgo.json.default\"; Flags: ignoreversion",
          "",
          "---------------"
        ]
      }
    }
  ]
}