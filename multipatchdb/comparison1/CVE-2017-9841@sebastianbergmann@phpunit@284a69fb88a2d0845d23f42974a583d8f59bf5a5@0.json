{
  "cve_id": "CVE-2017-9841",
  "cve_desc": "Util/PHP/eval-stdin.php in PHPUnit before 4.8.28 and 5.x before 5.6.3 allows remote attackers to execute arbitrary PHP code via HTTP POST data beginning with a \"<?php \" substring, as demonstrated by an attack on a site with an exposed /vendor folder, i.e., external access to the /vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php URI.",
  "repo": "sebastianbergmann/phpunit",
  "patch_hash": "284a69fb88a2d0845d23f42974a583d8f59bf5a5",
  "patch_info": {
    "commit_hash": "284a69fb88a2d0845d23f42974a583d8f59bf5a5",
    "repo": "sebastianbergmann/phpunit",
    "commit_url": "https://github.com/sebastianbergmann/phpunit/commit/284a69fb88a2d0845d23f42974a583d8f59bf5a5",
    "files": [
      "src/Util/PHP/Template/TestCaseMethod.tpl.dist",
      "src/Util/PHP/eval-stdin.php"
    ],
    "message": "Correct fix for #1956",
    "before_after_code_files": [
      "src/Util/PHP/Template/TestCaseMethod.tpl.dist||src/Util/PHP/Template/TestCaseMethod.tpl.dist",
      "src/Util/PHP/eval-stdin.php||src/Util/PHP/eval-stdin.php"
    ]
  },
  "patch_diff": {
    "src/Util/PHP/Template/TestCaseMethod.tpl.dist||src/Util/PHP/Template/TestCaseMethod.tpl.dist": [
      "File: src/Util/PHP/Template/TestCaseMethod.tpl.dist -> src/Util/PHP/Template/TestCaseMethod.tpl.dist",
      "--- Hunk 1 ---",
      "[Context before]",
      "55:         $output = $test->getActualOutput();",
      "56:     }",
      "59:     if ($stdout = stream_get_contents(STDOUT)) {",
      "60:         $output = $stdout . $output;",
      "61:     }",
      "",
      "[Removed Lines]",
      "58:     rewind(STDOUT);",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ],
    "src/Util/PHP/eval-stdin.php||src/Util/PHP/eval-stdin.php": [
      "File: src/Util/PHP/eval-stdin.php -> src/Util/PHP/eval-stdin.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "1: <?php",
      "",
      "[Removed Lines]",
      "3: eval('?>' . file_get_contents('php://input'));",
      "",
      "[Added Lines]",
      "3: eval('?>' . file_get_contents('php://stdin'));",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "0c1ae1b5324fa10f96129c5679b788cc1ca9468e",
      "candidate_info": {
        "commit_hash": "0c1ae1b5324fa10f96129c5679b788cc1ca9468e",
        "repo": "sebastianbergmann/phpunit",
        "commit_url": "https://github.com/sebastianbergmann/phpunit/commit/0c1ae1b5324fa10f96129c5679b788cc1ca9468e",
        "files": [
          "src/Util/PHP/Template/TestCaseMethod.tpl.dist",
          "src/Util/PHP/eval-stdin.php"
        ],
        "message": "Correct fix for #1956",
        "before_after_code_files": [
          "src/Util/PHP/Template/TestCaseMethod.tpl.dist||src/Util/PHP/Template/TestCaseMethod.tpl.dist",
          "src/Util/PHP/eval-stdin.php||src/Util/PHP/eval-stdin.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_issue": 1,
        "olp_code_files": {
          "patch": [
            "src/Util/PHP/Template/TestCaseMethod.tpl.dist||src/Util/PHP/Template/TestCaseMethod.tpl.dist",
            "src/Util/PHP/eval-stdin.php||src/Util/PHP/eval-stdin.php"
          ],
          "candidate": [
            "src/Util/PHP/Template/TestCaseMethod.tpl.dist||src/Util/PHP/Template/TestCaseMethod.tpl.dist",
            "src/Util/PHP/eval-stdin.php||src/Util/PHP/eval-stdin.php"
          ]
        }
      },
      "candidate_diff": {
        "src/Util/PHP/Template/TestCaseMethod.tpl.dist||src/Util/PHP/Template/TestCaseMethod.tpl.dist": [
          "File: src/Util/PHP/Template/TestCaseMethod.tpl.dist -> src/Util/PHP/Template/TestCaseMethod.tpl.dist",
          "--- Hunk 1 ---",
          "[Context before]",
          "58:         $output = $test->getActualOutput();",
          "59:     }",
          "62:     if ($stdout = stream_get_contents(STDOUT)) {",
          "63:         $output = $stdout . $output;",
          "64:     }",
          "",
          "[Removed Lines]",
          "61:     rewind(STDOUT);",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/Util/PHP/eval-stdin.php||src/Util/PHP/eval-stdin.php": [
          "File: src/Util/PHP/eval-stdin.php -> src/Util/PHP/eval-stdin.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: <?php",
          "",
          "[Removed Lines]",
          "3: eval('?>' . file_get_contents('php://input'));",
          "",
          "[Added Lines]",
          "3: eval('?>' . file_get_contents('php://stdin'));",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "c820f915bfae34e5a836f94967a2a5ea5ef34f21",
      "candidate_info": {
        "commit_hash": "c820f915bfae34e5a836f94967a2a5ea5ef34f21",
        "repo": "sebastianbergmann/phpunit",
        "commit_url": "https://github.com/sebastianbergmann/phpunit/commit/c820f915bfae34e5a836f94967a2a5ea5ef34f21",
        "files": [
          "src/Framework/TestCase.php",
          "src/Util/PHP/Default.php",
          "src/Util/PHP/eval-stdin.php"
        ],
        "message": "Fix CS/WS issues",
        "before_after_code_files": [
          "src/Framework/TestCase.php||src/Framework/TestCase.php",
          "src/Util/PHP/Default.php||src/Util/PHP/Default.php",
          "src/Util/PHP/eval-stdin.php||src/Util/PHP/eval-stdin.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/Util/PHP/eval-stdin.php||src/Util/PHP/eval-stdin.php"
          ],
          "candidate": [
            "src/Util/PHP/eval-stdin.php||src/Util/PHP/eval-stdin.php"
          ]
        }
      },
      "candidate_diff": {
        "src/Framework/TestCase.php||src/Framework/TestCase.php": [
          "File: src/Framework/TestCase.php -> src/Framework/TestCase.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "2063:                     $this->snapshot,",
          "2064:                     $this->createGlobalStateSnapshot($backupGlobals)",
          "2065:                 );",
          "2070:             }",
          "2071:         }",
          "",
          "[Removed Lines]",
          "2066:             }",
          "2068:             catch (PHPUnit_Framework_RiskyTestError $rte) {",
          "",
          "[Added Lines]",
          "2066:             } catch (PHPUnit_Framework_RiskyTestError $rte) {",
          "",
          "---------------"
        ],
        "src/Util/PHP/Default.php||src/Util/PHP/Default.php": [
          "File: src/Util/PHP/Default.php -> src/Util/PHP/Default.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "33:         $runtime = $runtime->getBinary() . $this->settingsToParameters($settings);",
          "35:         if ('phpdbg' === PHP_SAPI) {",
          "37:         }",
          "39:         $process = proc_open(",
          "",
          "[Removed Lines]",
          "36:             $runtime .= ' -qrr '.escapeshellarg(__DIR__ . '/eval-stdin.php');",
          "",
          "[Added Lines]",
          "36:             $runtime .= ' -qrr ' . escapeshellarg(__DIR__ . '/eval-stdin.php');",
          "",
          "---------------"
        ],
        "src/Util/PHP/eval-stdin.php||src/Util/PHP/eval-stdin.php": [
          "File: src/Util/PHP/eval-stdin.php -> src/Util/PHP/eval-stdin.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: <?php",
          "",
          "[Removed Lines]",
          "3: eval('?>'.file_get_contents('php://input'));",
          "",
          "[Added Lines]",
          "3: eval('?>' . file_get_contents('php://input'));",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "3aaddb1c5bd9b9b8d070b4cf120e71c36fd08412",
      "candidate_info": {
        "commit_hash": "3aaddb1c5bd9b9b8d070b4cf120e71c36fd08412",
        "repo": "sebastianbergmann/phpunit",
        "commit_url": "https://github.com/sebastianbergmann/phpunit/commit/3aaddb1c5bd9b9b8d070b4cf120e71c36fd08412",
        "files": [
          "src/Util/PHP/Default.php",
          "src/Util/PHP/eval-stdin.php"
        ],
        "message": "Fix insulated tests with phpdbg",
        "before_after_code_files": [
          "src/Util/PHP/Default.php||src/Util/PHP/Default.php",
          "src/Util/PHP/eval-stdin.php||src/Util/PHP/eval-stdin.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/Util/PHP/eval-stdin.php||src/Util/PHP/eval-stdin.php"
          ],
          "candidate": [
            "src/Util/PHP/eval-stdin.php||src/Util/PHP/eval-stdin.php"
          ]
        }
      },
      "candidate_diff": {
        "src/Util/PHP/Default.php||src/Util/PHP/Default.php": [
          "File: src/Util/PHP/Default.php -> src/Util/PHP/Default.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "30:     public function runJob($job, array $settings = array())",
          "31:     {",
          "32:         $runtime = new Runtime;",
          "34:         $process = proc_open(",
          "36:             array(",
          "37:             0 => array('pipe', 'r'),",
          "38:             1 => array('pipe', 'w'),",
          "",
          "[Removed Lines]",
          "35:             $runtime->getBinary() . $this->settingsToParameters($settings),",
          "",
          "[Added Lines]",
          "33:         $runtime = $runtime->getBinary() . $this->settingsToParameters($settings);",
          "35:         if ('phpdbg' === PHP_SAPI) {",
          "36:             $runtime .= ' -qrr '.escapeshellarg(__DIR__ . '/eval-stdin.php');",
          "37:         }",
          "40:             $runtime,",
          "",
          "---------------"
        ],
        "src/Util/PHP/eval-stdin.php||src/Util/PHP/eval-stdin.php": [
          "File: src/Util/PHP/eval-stdin.php -> src/Util/PHP/eval-stdin.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: <?php",
          "3: eval('?>'.file_get_contents('php://input'));",
          "",
          "---------------"
        ]
      }
    }
  ]
}