{
  "cve_id": "CVE-2022-23517",
  "cve_desc": "rails-html-sanitizer is responsible for sanitizing HTML fragments in Rails applications. Certain configurations of rails-html-sanitizer < 1.4.4 use an inefficient regular expression that is susceptible to excessive backtracking when attempting to sanitize certain SVG attributes. This may lead to a denial of service through CPU resource consumption. This issue has been patched in version 1.4.4.",
  "repo": "rails/rails-html-sanitizer",
  "patch_hash": "56c61c0cebd1e493e8ad7bca2a0191609a4a6979",
  "patch_info": {
    "commit_hash": "56c61c0cebd1e493e8ad7bca2a0191609a4a6979",
    "repo": "rails/rails-html-sanitizer",
    "commit_url": "https://github.com/rails/rails-html-sanitizer/commit/56c61c0cebd1e493e8ad7bca2a0191609a4a6979",
    "files": [
      "lib/rails/html/scrubbers.rb",
      "test/sanitizer_test.rb"
    ],
    "message": "fix: replace slow regex attribute check with Loofah method\n\nwhich uses the Crass parser",
    "before_after_code_files": [
      "lib/rails/html/scrubbers.rb||lib/rails/html/scrubbers.rb",
      "test/sanitizer_test.rb||test/sanitizer_test.rb"
    ]
  },
  "patch_diff": {
    "lib/rails/html/scrubbers.rb||lib/rails/html/scrubbers.rb": [
      "File: lib/rails/html/scrubbers.rb -> lib/rails/html/scrubbers.rb",
      "--- Hunk 1 ---",
      "[Context before]",
      "146:             attr_node.remove",
      "147:           end",
      "148:         end",
      "149:         if Loofah::HTML5::SafeList::SVG_ATTR_VAL_ALLOWS_REF.include?(attr_name)",
      "151:         end",
      "152:         if Loofah::HTML5::SafeList::SVG_ALLOW_LOCAL_HREF.include?(node.name) && attr_name == 'xlink:href' && attr_node.value =~ /^\\s*[^#\\s].*/m",
      "153:           attr_node.remove",
      "154:         end",
      "",
      "[Removed Lines]",
      "150:           attr_node.value = attr_node.value.gsub(/url\\s*\\(\\s*[^#\\s][^)]+?\\)/m, ' ') if attr_node.value",
      "",
      "[Added Lines]",
      "151:           Loofah::HTML5::Scrub.scrub_attribute_that_allows_local_ref(attr_node)",
      "",
      "---------------"
    ],
    "test/sanitizer_test.rb||test/sanitizer_test.rb": [
      "File: test/sanitizer_test.rb -> test/sanitizer_test.rb",
      "--- Hunk 1 ---",
      "[Context before]",
      "606:     refute_includes(sanitized, \"style\")",
      "607:   end",
      "609: protected",
      "611:   def xpath_sanitize(input, options = {})",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "609:   def test_scrubbing_svg_attr_values_that_allow_ref",
      "610:     input = %Q(<div fill=\"yellow url(http://bad.com/) #fff\">hey</div>)",
      "611:     expected = %Q(<div fill=\"yellow #fff\">hey</div>)",
      "612:     actual = scope_allowed_attributes %w(fill) do",
      "613:       safe_list_sanitize(input)",
      "614:     end",
      "616:     assert_equal(expected, actual)",
      "617:   end",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "bb6dfcbaaf9c5c8c4f77555557693c08d4d4ab48",
      "candidate_info": {
        "commit_hash": "bb6dfcbaaf9c5c8c4f77555557693c08d4d4ab48",
        "repo": "rails/rails-html-sanitizer",
        "commit_url": "https://github.com/rails/rails-html-sanitizer/commit/bb6dfcbaaf9c5c8c4f77555557693c08d4d4ab48",
        "files": [
          "lib/rails/html/scrubbers.rb",
          "test/sanitizer_test.rb"
        ],
        "message": "fix: use Loofah's scrub_uri_attribute method\n\nwhich correctly sanitizes data URL mediatypes",
        "before_after_code_files": [
          "lib/rails/html/scrubbers.rb||lib/rails/html/scrubbers.rb",
          "test/sanitizer_test.rb||test/sanitizer_test.rb"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/rails/rails-html-sanitizer/pull/147"
        ],
        "olp_code_files": {
          "patch": [
            "lib/rails/html/scrubbers.rb||lib/rails/html/scrubbers.rb",
            "test/sanitizer_test.rb||test/sanitizer_test.rb"
          ],
          "candidate": [
            "lib/rails/html/scrubbers.rb||lib/rails/html/scrubbers.rb",
            "test/sanitizer_test.rb||test/sanitizer_test.rb"
          ]
        }
      },
      "candidate_diff": {
        "lib/rails/html/scrubbers.rb||lib/rails/html/scrubbers.rb": [
          "File: lib/rails/html/scrubbers.rb -> lib/rails/html/scrubbers.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "140:                     end",
          "142:         if Loofah::HTML5::SafeList::ATTR_VAL_IS_URI.include?(attr_name)",
          "148:         end",
          "150:         if Loofah::HTML5::SafeList::SVG_ATTR_VAL_ALLOWS_REF.include?(attr_name)",
          "",
          "[Removed Lines]",
          "143:           # this block lifted nearly verbatim from HTML5 sanitization",
          "144:           val_unescaped = CGI.unescapeHTML(attr_node.value).gsub(Loofah::HTML5::Scrub::CONTROL_CHARACTERS,'').downcase",
          "145:           if val_unescaped =~ /^[a-z0-9][-+.a-z0-9]*:/ && ! Loofah::HTML5::SafeList::ALLOWED_PROTOCOLS.include?(val_unescaped.split(Loofah::HTML5::SafeList::PROTOCOL_SEPARATOR)[0])",
          "146:             attr_node.remove",
          "147:           end",
          "",
          "[Added Lines]",
          "143:           return if Loofah::HTML5::Scrub.scrub_uri_attribute(attr_node)",
          "",
          "---------------"
        ],
        "test/sanitizer_test.rb||test/sanitizer_test.rb": [
          "File: test/sanitizer_test.rb -> test/sanitizer_test.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "606:     refute_includes(sanitized, \"style\")",
          "607:   end",
          "609:   def test_scrubbing_svg_attr_values_that_allow_ref",
          "610:     input = %Q(<div fill=\"yellow url(http://bad.com/) #fff\">hey</div>)",
          "611:     expected = %Q(<div fill=\"yellow #fff\">hey</div>)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "609:   %w[text/plain text/css image/png image/gif image/jpeg].each do |mediatype|",
          "610:     define_method \"test_mediatype_#{mediatype}_allowed\" do",
          "611:       input = %Q(<img src=\"data:#{mediatype};base64,PHNjcmlwdD5hbGVydCgnWFNTJyk8L3NjcmlwdD4=\">)",
          "612:       expected = input",
          "613:       actual = safe_list_sanitize(input)",
          "614:       assert_equal(expected, actual)",
          "616:       input = %Q(<img src=\"DATA:#{mediatype};base64,PHNjcmlwdD5hbGVydCgnWFNTJyk8L3NjcmlwdD4=\">)",
          "617:       expected = input",
          "618:       actual = safe_list_sanitize(input)",
          "619:       assert_equal(expected, actual)",
          "620:     end",
          "621:   end",
          "623:   def test_mediatype_text_html_disallowed",
          "624:     input = %q(<img src=\"data:text/html;base64,PHNjcmlwdD5hbGVydCgnWFNTJyk8L3NjcmlwdD4=\">)",
          "625:     expected = %q(<img>)",
          "626:     actual = safe_list_sanitize(input)",
          "627:     assert_equal(expected, actual)",
          "629:     input = %q(<img src=\"DATA:text/html;base64,PHNjcmlwdD5hbGVydCgnWFNTJyk8L3NjcmlwdD4=\">)",
          "630:     expected = %q(<img>)",
          "631:     actual = safe_list_sanitize(input)",
          "632:     assert_equal(expected, actual)",
          "633:   end",
          "635:   def test_mediatype_image_svg_xml_disallowed",
          "636:     input = %q(<img src=\"data:image/svg+xml;base64,PHNjcmlwdD5hbGVydCgnWFNTJyk8L3NjcmlwdD4=\">)",
          "637:     expected = %q(<img>)",
          "638:     actual = safe_list_sanitize(input)",
          "639:     assert_equal(expected, actual)",
          "641:     input = %q(<img src=\"DATA:image/svg+xml;base64,PHNjcmlwdD5hbGVydCgnWFNTJyk8L3NjcmlwdD4=\">)",
          "642:     expected = %q(<img>)",
          "643:     actual = safe_list_sanitize(input)",
          "644:     assert_equal(expected, actual)",
          "645:   end",
          "647:   def test_mediatype_other_disallowed",
          "648:     input = %q(<a href=\"data:foo;base64,PHNjcmlwdD5hbGVydCgnWFNTJyk8L3NjcmlwdD4=\">foo</a>)",
          "649:     expected = %q(<a>foo</a>)",
          "650:     actual = safe_list_sanitize(input)",
          "651:     assert_equal(expected, actual)",
          "653:     input = %q(<a href=\"DATA:foo;base64,PHNjcmlwdD5hbGVydCgnWFNTJyk8L3NjcmlwdD4=\">foo</a>)",
          "654:     expected = %q(<a>foo</a>)",
          "655:     actual = safe_list_sanitize(input)",
          "656:     assert_equal(expected, actual)",
          "657:   end",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "9ef5975c969949750806cd684ce719ad6d6a08cf",
      "candidate_info": {
        "commit_hash": "9ef5975c969949750806cd684ce719ad6d6a08cf",
        "repo": "rails/rails-html-sanitizer",
        "commit_url": "https://github.com/rails/rails-html-sanitizer/commit/9ef5975c969949750806cd684ce719ad6d6a08cf",
        "files": [
          "lib/rails/html/sanitizer/version.rb"
        ],
        "message": "dev: set version to 1.5.0.dev",
        "before_after_code_files": [
          "lib/rails/html/sanitizer/version.rb||lib/rails/html/sanitizer/version.rb"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/rails/rails-html-sanitizer/pull/147"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "lib/rails/html/sanitizer/version.rb||lib/rails/html/sanitizer/version.rb": [
          "File: lib/rails/html/sanitizer/version.rb -> lib/rails/html/sanitizer/version.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: module Rails",
          "2:   module Html",
          "3:     class Sanitizer",
          "5:     end",
          "6:   end",
          "7: end",
          "",
          "[Removed Lines]",
          "4:       VERSION = \"1.4.2\"",
          "",
          "[Added Lines]",
          "4:       VERSION = \"1.5.0.dev\"",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "e8cbe25634fc7455b80a5f8569b82e5c93dd580c",
      "candidate_info": {
        "commit_hash": "e8cbe25634fc7455b80a5f8569b82e5c93dd580c",
        "repo": "rails/rails-html-sanitizer",
        "commit_url": "https://github.com/rails/rails-html-sanitizer/commit/e8cbe25634fc7455b80a5f8569b82e5c93dd580c",
        "files": [
          "rails-html-sanitizer.gemspec"
        ],
        "message": "dep: bump dependency on loofah\n\nv2.19.1 has the new methods we're using:\n\n- Loofah::HTML5::Scrub.cdata_needs_escaping?\n- Loofah::HTML5::Scrub.cdata_escape\n- Loofah::HTML5::Scrub.scrub_uri_attribute\n- Loofah::HTML5::Scrub.scrub_attribute_that_allows_local_ref\n\navoiding code duplication in this gem.",
        "before_after_code_files": [
          "rails-html-sanitizer.gemspec||rails-html-sanitizer.gemspec"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/rails/rails-html-sanitizer/pull/147"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "rails-html-sanitizer.gemspec||rails-html-sanitizer.gemspec": [
          "File: rails-html-sanitizer.gemspec -> rails-html-sanitizer.gemspec",
          "--- Hunk 1 ---",
          "[Context before]",
          "27:   # NOTE: There's no need to update this dependency for Loofah CVEs",
          "28:   # in minor releases when users can simply run `bundle update loofah`.",
          "31:   spec.add_development_dependency \"bundler\", \">= 1.3\"",
          "32:   spec.add_development_dependency \"rake\"",
          "",
          "[Removed Lines]",
          "29:   spec.add_dependency \"loofah\", \"~> 2.3\"",
          "",
          "[Added Lines]",
          "29:   spec.add_dependency \"loofah\", \"~> 2.19\", \">= 2.19.1\"",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "373fc6295918c4b0aad02111e869f4e0c6fc788b",
      "candidate_info": {
        "commit_hash": "373fc6295918c4b0aad02111e869f4e0c6fc788b",
        "repo": "rails/rails-html-sanitizer",
        "commit_url": "https://github.com/rails/rails-html-sanitizer/commit/373fc6295918c4b0aad02111e869f4e0c6fc788b",
        "files": [
          "lib/rails/html/scrubbers.rb",
          "test/sanitizer_test.rb"
        ],
        "message": "fix: escape CDATA nodes using Loofah's escaping methods\n\nAlso, notably, document the decisions behind this approach in a\ndecision record.",
        "before_after_code_files": [
          "lib/rails/html/scrubbers.rb||lib/rails/html/scrubbers.rb",
          "test/sanitizer_test.rb||test/sanitizer_test.rb"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/rails/rails-html-sanitizer/pull/147"
        ],
        "olp_code_files": {
          "patch": [
            "lib/rails/html/scrubbers.rb||lib/rails/html/scrubbers.rb",
            "test/sanitizer_test.rb||test/sanitizer_test.rb"
          ],
          "candidate": [
            "lib/rails/html/scrubbers.rb||lib/rails/html/scrubbers.rb",
            "test/sanitizer_test.rb||test/sanitizer_test.rb"
          ]
        }
      },
      "candidate_diff": {
        "lib/rails/html/scrubbers.rb||lib/rails/html/scrubbers.rb": [
          "File: lib/rails/html/scrubbers.rb -> lib/rails/html/scrubbers.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "62:       end",
          "64:       def scrub(node)",
          "68:           return CONTINUE",
          "69:         end",
          "70:         return CONTINUE if skip_node?(node)",
          "",
          "[Removed Lines]",
          "65:         if node.cdata?",
          "66:           text = node.document.create_text_node node.text",
          "67:           node.replace text",
          "",
          "[Added Lines]",
          "65:         if Loofah::HTML5::Scrub.cdata_needs_escaping?(node)",
          "66:           replacement = Loofah::HTML5::Scrub.cdata_escape(node)",
          "67:           node.replace(replacement)",
          "",
          "---------------"
        ],
        "test/sanitizer_test.rb||test/sanitizer_test.rb": [
          "File: test/sanitizer_test.rb -> test/sanitizer_test.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "647:     assert_equal(expected, actual)",
          "648:   end",
          "650: protected",
          "652:   def xpath_sanitize(input, options = {})",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "650:   def test_style_with_css_payload",
          "651:     input, tags = \"<style>div > span { background: \\\"red\\\"; }</style>\", [\"style\"]",
          "652:     expected = \"<style>div &gt; span { background: \\\"red\\\"; }</style>\"",
          "653:     actual = safe_list_sanitize(input, tags: tags)",
          "655:     assert_equal(expected, actual)",
          "656:   end",
          "658:   def test_combination_of_select_and_style_with_css_payload",
          "659:     input, tags = \"<select><style>div > span { background: \\\"red\\\"; }</style></select>\", [\"select\", \"style\"]",
          "660:     expected = \"<select><style>div &gt; span { background: \\\"red\\\"; }</style></select>\"",
          "661:     actual = safe_list_sanitize(input, tags: tags)",
          "663:     assert_equal(expected, actual)",
          "664:   end",
          "666:   def test_combination_of_select_and_style_with_script_payload",
          "667:     input, tags = \"<select><style><script>alert(1)</script></style></select>\", [\"select\", \"style\"]",
          "668:     expected = \"<select><style>&lt;script&gt;alert(1)&lt;/script&gt;</style></select>\"",
          "669:     actual = safe_list_sanitize(input, tags: tags)",
          "671:     assert_equal(expected, actual)",
          "672:   end",
          "674:   def test_combination_of_svg_and_style_with_script_payload",
          "675:     input, tags = \"<svg><style><script>alert(1)</script></style></svg>\", [\"svg\", \"style\"]",
          "676:     expected = \"<svg><style>&lt;script&gt;alert(1)&lt;/script&gt;</style></svg>\"",
          "677:     actual = safe_list_sanitize(input, tags: tags)",
          "679:     assert_equal(expected, actual)",
          "680:   end",
          "682:   def test_combination_of_math_and_style_with_img_payload",
          "683:     input, tags = \"<math><style><img src=x onerror=alert(1)></style></math>\", [\"math\", \"style\"]",
          "684:     expected = \"<math><style>&lt;img src=x onerror=alert(1)&gt;</style></math>\"",
          "685:     actual = safe_list_sanitize(input, tags: tags)",
          "687:     assert_equal(expected, actual)",
          "689:     input, tags = \"<math><style><img src=x onerror=alert(1)></style></math>\", [\"math\", \"style\", \"img\"]",
          "690:     expected = \"<math><style>&lt;img src=x onerror=alert(1)&gt;</style></math>\"",
          "691:     actual = safe_list_sanitize(input, tags: tags)",
          "693:     assert_equal(expected, actual)",
          "694:   end",
          "696:   def test_combination_of_svg_and_style_with_img_payload",
          "697:     input, tags = \"<svg><style><img src=x onerror=alert(1)></style></svg>\", [\"svg\", \"style\"]",
          "698:     expected = \"<svg><style>&lt;img src=x onerror=alert(1)&gt;</style></svg>\"",
          "699:     actual = safe_list_sanitize(input, tags: tags)",
          "701:     assert_equal(expected, actual)",
          "703:     input, tags = \"<svg><style><img src=x onerror=alert(1)></style></svg>\", [\"svg\", \"style\", \"img\"]",
          "704:     expected = \"<svg><style>&lt;img src=x onerror=alert(1)&gt;</style></svg>\"",
          "705:     actual = safe_list_sanitize(input, tags: tags)",
          "707:     assert_equal(expected, actual)",
          "708:   end",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "68ccf7e1dbaa425cc4a8651d5f583e754ef5061c",
      "candidate_info": {
        "commit_hash": "68ccf7e1dbaa425cc4a8651d5f583e754ef5061c",
        "repo": "rails/rails-html-sanitizer",
        "commit_url": "https://github.com/rails/rails-html-sanitizer/commit/68ccf7e1dbaa425cc4a8651d5f583e754ef5061c",
        "files": [
          "lib/rails/html/sanitizer.rb",
          "test/sanitizer_test.rb"
        ],
        "message": "revert 45a5c10\n\nto prepare for a better fix",
        "before_after_code_files": [
          "lib/rails/html/sanitizer.rb||lib/rails/html/sanitizer.rb",
          "test/sanitizer_test.rb||test/sanitizer_test.rb"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/rails/rails-html-sanitizer/pull/147"
        ],
        "olp_code_files": {
          "patch": [
            "test/sanitizer_test.rb||test/sanitizer_test.rb"
          ],
          "candidate": [
            "test/sanitizer_test.rb||test/sanitizer_test.rb"
          ]
        }
      },
      "candidate_diff": {
        "lib/rails/html/sanitizer.rb||lib/rails/html/sanitizer.rb": [
          "File: lib/rails/html/sanitizer.rb -> lib/rails/html/sanitizer.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "142:       private",
          "157:       def allowed_tags(options)",
          "163:       end",
          "165:       def allowed_attributes(options)",
          "",
          "[Removed Lines]",
          "144:       def loofah_using_html5?",
          "145:         # future-proofing, see https://github.com/flavorjones/loofah/pull/239",
          "146:         Loofah.respond_to?(:html5_mode?) && Loofah.html5_mode?",
          "147:       end",
          "149:       def remove_safelist_tag_combinations(tags)",
          "150:         if !loofah_using_html5? && tags.include?(\"select\") && tags.include?(\"style\")",
          "151:           warn(\"WARNING: #{self.class}: removing 'style' from safelist, should not be combined with 'select'\")",
          "152:           tags.delete(\"style\")",
          "153:         end",
          "154:         tags",
          "155:       end",
          "158:         if options[:tags]",
          "159:           remove_safelist_tag_combinations(options[:tags])",
          "160:         else",
          "161:           self.class.allowed_tags",
          "162:         end",
          "",
          "[Added Lines]",
          "145:         options[:tags] || self.class.allowed_tags",
          "",
          "---------------"
        ],
        "test/sanitizer_test.rb||test/sanitizer_test.rb": [
          "File: test/sanitizer_test.rb -> test/sanitizer_test.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "587:     assert_equal(\"<div>text</div><b>text</b>\", safe_list_sanitize(\"<div>text</div><!-- comment --><b>text</b>\"))",
          "588:   end",
          "609:   %w[text/plain text/css image/png image/gif image/jpeg].each do |mediatype|",
          "610:     define_method \"test_mediatype_#{mediatype}_allowed\" do",
          "611:       input = %Q(<img src=\"data:#{mediatype};base64,PHNjcmlwdD5hbGVydCgnWFNTJyk8L3NjcmlwdD4=\">)",
          "",
          "[Removed Lines]",
          "590:   def test_disallow_the_dangerous_safelist_combination_of_select_and_style",
          "591:     input = \"<select><style><script>alert(1)</script></style></select>\"",
          "592:     tags = [\"select\", \"style\"]",
          "593:     warning = /WARNING: Rails::Html::SafeListSanitizer: removing 'style' from safelist/",
          "594:     sanitized = nil",
          "595:     invocation = Proc.new { sanitized = safe_list_sanitize(input, tags: tags) }",
          "597:     if html5_mode?",
          "598:       # if Loofah is using an HTML5 parser,",
          "599:       #   then \"style\" should be removed by the parser as an invalid child of \"select\"",
          "600:       assert_silent(&invocation)",
          "601:     else",
          "602:       # if Loofah is using an HTML4 parser,",
          "603:       #   then SafeListSanitizer should remove \"style\" from the safelist",
          "604:       assert_output(nil, warning, &invocation)",
          "605:     end",
          "606:     refute_includes(sanitized, \"style\")",
          "607:   end",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "733:     # then reverted in 2.10.0, see https://gitlab.gnome.org/GNOME/libxml2/-/issues/380",
          "734:     Nokogiri.method(:uses_libxml?).arity == -1 && Nokogiri.uses_libxml?(\"= 2.9.14\")",
          "735:   end",
          "740: end",
          "",
          "[Removed Lines]",
          "737:   def html5_mode?",
          "738:     ::Loofah.respond_to?(:html5_mode?) && ::Loofah.html5_mode?",
          "739:   end",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    }
  ]
}