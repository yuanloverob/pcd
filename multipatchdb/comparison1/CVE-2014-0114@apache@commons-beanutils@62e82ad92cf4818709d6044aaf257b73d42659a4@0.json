{
  "cve_id": "CVE-2014-0114",
  "cve_desc": "Apache Commons BeanUtils, as distributed in lib/commons-beanutils-1.8.0.jar in Apache Struts 1.x through 1.3.10 and in other products requiring commons-beanutils through 1.9.2, does not suppress the class property, which allows remote attackers to \"manipulate\" the ClassLoader and execute arbitrary code via the class parameter, as demonstrated by the passing of this parameter to the getClass method of the ActionForm object in Struts 1.",
  "repo": "apache/commons-beanutils",
  "patch_hash": "62e82ad92cf4818709d6044aaf257b73d42659a4",
  "patch_info": {
    "commit_hash": "62e82ad92cf4818709d6044aaf257b73d42659a4",
    "repo": "apache/commons-beanutils",
    "commit_url": "https://github.com/apache/commons-beanutils/commit/62e82ad92cf4818709d6044aaf257b73d42659a4",
    "files": [
      "pom.xml",
      "src/changes/changes.xml",
      "src/main/java/org/apache/commons/beanutils/PropertyUtilsBean.java",
      "src/test/java/org/apache/commons/beanutils/BeanIntrospectionDataTestCase.java",
      "src/test/java/org/apache/commons/beanutils/bugs/Jira157TestCase.java",
      "src/test/java/org/apache/commons/beanutils/bugs/Jira520TestCase.java"
    ],
    "message": "BEANUTILS-520: mitigation for CVE-2014-0114",
    "before_after_code_files": [
      "src/main/java/org/apache/commons/beanutils/PropertyUtilsBean.java||src/main/java/org/apache/commons/beanutils/PropertyUtilsBean.java",
      "src/test/java/org/apache/commons/beanutils/BeanIntrospectionDataTestCase.java||src/test/java/org/apache/commons/beanutils/BeanIntrospectionDataTestCase.java",
      "src/test/java/org/apache/commons/beanutils/bugs/Jira157TestCase.java||src/test/java/org/apache/commons/beanutils/bugs/Jira157TestCase.java",
      "src/test/java/org/apache/commons/beanutils/bugs/Jira520TestCase.java||src/test/java/org/apache/commons/beanutils/bugs/Jira520TestCase.java"
    ]
  },
  "patch_diff": {
    "src/main/java/org/apache/commons/beanutils/PropertyUtilsBean.java||src/main/java/org/apache/commons/beanutils/PropertyUtilsBean.java": [
      "File: src/main/java/org/apache/commons/beanutils/PropertyUtilsBean.java -> src/main/java/org/apache/commons/beanutils/PropertyUtilsBean.java",
      "--- Hunk 1 ---",
      "[Context before]",
      "188:     public final void resetBeanIntrospectors() {",
      "189:         introspectors.clear();",
      "190:         introspectors.add(DefaultBeanIntrospector.INSTANCE);",
      "191:     }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "191:         introspectors.add(SuppressPropertiesBeanIntrospector.SUPPRESS_CLASS);",
      "",
      "---------------"
    ],
    "src/test/java/org/apache/commons/beanutils/BeanIntrospectionDataTestCase.java||src/test/java/org/apache/commons/beanutils/BeanIntrospectionDataTestCase.java": [
      "File: src/test/java/org/apache/commons/beanutils/BeanIntrospectionDataTestCase.java -> src/test/java/org/apache/commons/beanutils/BeanIntrospectionDataTestCase.java",
      "--- Hunk 1 ---",
      "[Context before]",
      "43:     private static PropertyDescriptor[] fetchDescriptors() {",
      "44:         final PropertyUtilsBean pub = new PropertyUtilsBean();",
      "45:         pub.addBeanIntrospector(new FluentPropertyBeanIntrospector());",
      "46:         return pub.getPropertyDescriptors(BEAN_CLASS);",
      "47:     }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "45:         pub.removeBeanIntrospector(SuppressPropertiesBeanIntrospector.SUPPRESS_CLASS);",
      "",
      "---------------"
    ],
    "src/test/java/org/apache/commons/beanutils/bugs/Jira157TestCase.java||src/test/java/org/apache/commons/beanutils/bugs/Jira157TestCase.java": [
      "File: src/test/java/org/apache/commons/beanutils/bugs/Jira157TestCase.java -> src/test/java/org/apache/commons/beanutils/bugs/Jira157TestCase.java",
      "--- Hunk 1 ---",
      "[Context before]",
      "24: import junit.framework.TestSuite;",
      "26: import org.apache.commons.beanutils.BeanUtils;",
      "27: import org.apache.commons.logging.Log;",
      "28: import org.apache.commons.logging.LogFactory;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "27: import org.apache.commons.beanutils.BeanUtilsBean;",
      "28: import org.apache.commons.beanutils.SuppressPropertiesBeanIntrospector;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "74:     @Override",
      "75:     protected void setUp() throws Exception {",
      "76:         super.setUp();",
      "77:     }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "79:         BeanUtilsBean custom = new BeanUtilsBean();",
      "80:         custom.getPropertyUtils().removeBeanIntrospector(SuppressPropertiesBeanIntrospector.SUPPRESS_CLASS);",
      "81:         BeanUtilsBean.setInstance(custom);",
      "",
      "---------------"
    ],
    "src/test/java/org/apache/commons/beanutils/bugs/Jira520TestCase.java||src/test/java/org/apache/commons/beanutils/bugs/Jira520TestCase.java": [
      "File: src/test/java/org/apache/commons/beanutils/bugs/Jira520TestCase.java -> src/test/java/org/apache/commons/beanutils/bugs/Jira520TestCase.java",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "17: package org.apache.commons.beanutils.bugs;",
      "19: import org.apache.commons.beanutils.AlphaBean;",
      "20: import org.apache.commons.beanutils.BeanUtilsBean;",
      "21: import org.apache.commons.beanutils.SuppressPropertiesBeanIntrospector;",
      "23: import junit.framework.TestCase;",
      "30: public class Jira520TestCase extends TestCase {",
      "34:     public void testSuppressClassPropertyByDefault() throws Exception {",
      "35:         final BeanUtilsBean bub = new BeanUtilsBean();",
      "36:         final AlphaBean bean = new AlphaBean();",
      "37:         try {",
      "38:             bub.getProperty(bean, \"class\");",
      "39:             fail(\"Could access class property!\");",
      "40:         } catch (final NoSuchMethodException ex) {",
      "42:         }",
      "43:     }",
      "48:     public void testAllowAccessToClassProperty() throws Exception {",
      "49:         final BeanUtilsBean bub = new BeanUtilsBean();",
      "50:         bub.getPropertyUtils().removeBeanIntrospector(SuppressPropertiesBeanIntrospector.SUPPRESS_CLASS);",
      "51:         final AlphaBean bean = new AlphaBean();",
      "52:         String result = bub.getProperty(bean, \"class\");",
      "53:         assertEquals(\"Class property should have been accessed\", \"class org.apache.commons.beanutils.AlphaBean\", result);",
      "54:     }",
      "55: }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "dd48f4e589462a8cdb1f29bbbccb35d6b0291d58",
      "candidate_info": {
        "commit_hash": "dd48f4e589462a8cdb1f29bbbccb35d6b0291d58",
        "repo": "apache/commons-beanutils",
        "commit_url": "https://github.com/apache/commons-beanutils/commit/dd48f4e589462a8cdb1f29bbbccb35d6b0291d58",
        "files": [
          "src/main/java/org/apache/commons/beanutils2/PropertyUtilsBean.java",
          "src/test/java/org/apache/commons/beanutils2/BeanIntrospectionDataTestCase.java",
          "src/test/java/org/apache/commons/beanutils2/bugs/Jira157TestCase.java",
          "src/test/java/org/apache/commons/beanutils2/bugs/Jira520TestCase.java"
        ],
        "message": "BEANUTILS-520: Mitigate CVE-2014-0114 by enabling SuppressPropertiesBeanIntrospector.SUPPRESS_CLASS by default. (#7)\n\nSquash and merge.",
        "before_after_code_files": [
          "src/main/java/org/apache/commons/beanutils2/PropertyUtilsBean.java||src/main/java/org/apache/commons/beanutils2/PropertyUtilsBean.java",
          "src/test/java/org/apache/commons/beanutils2/BeanIntrospectionDataTestCase.java||src/test/java/org/apache/commons/beanutils2/BeanIntrospectionDataTestCase.java",
          "src/test/java/org/apache/commons/beanutils2/bugs/Jira157TestCase.java||src/test/java/org/apache/commons/beanutils2/bugs/Jira157TestCase.java",
          "src/test/java/org/apache/commons/beanutils2/bugs/Jira520TestCase.java||src/test/java/org/apache/commons/beanutils2/bugs/Jira520TestCase.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_olp_changes": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/main/java/org/apache/commons/beanutils2/PropertyUtilsBean.java||src/main/java/org/apache/commons/beanutils2/PropertyUtilsBean.java": [
          "File: src/main/java/org/apache/commons/beanutils2/PropertyUtilsBean.java -> src/main/java/org/apache/commons/beanutils2/PropertyUtilsBean.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "185:     public final void resetBeanIntrospectors() {",
          "186:         introspectors.clear();",
          "187:         introspectors.add(DefaultBeanIntrospector.INSTANCE);",
          "188:     }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "188:         introspectors.add(SuppressPropertiesBeanIntrospector.SUPPRESS_CLASS);",
          "",
          "---------------"
        ],
        "src/test/java/org/apache/commons/beanutils2/BeanIntrospectionDataTestCase.java||src/test/java/org/apache/commons/beanutils2/BeanIntrospectionDataTestCase.java": [
          "File: src/test/java/org/apache/commons/beanutils2/BeanIntrospectionDataTestCase.java -> src/test/java/org/apache/commons/beanutils2/BeanIntrospectionDataTestCase.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "42:     private static PropertyDescriptor[] fetchDescriptors() {",
          "43:         final PropertyUtilsBean pub = new PropertyUtilsBean();",
          "44:         pub.addBeanIntrospector(new FluentPropertyBeanIntrospector());",
          "45:         return pub.getPropertyDescriptors(BEAN_CLASS);",
          "46:     }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "44:         pub.removeBeanIntrospector(SuppressPropertiesBeanIntrospector.SUPPRESS_CLASS);",
          "",
          "---------------"
        ],
        "src/test/java/org/apache/commons/beanutils2/bugs/Jira157TestCase.java||src/test/java/org/apache/commons/beanutils2/bugs/Jira157TestCase.java": [
          "File: src/test/java/org/apache/commons/beanutils2/bugs/Jira157TestCase.java -> src/test/java/org/apache/commons/beanutils2/bugs/Jira157TestCase.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "20: import java.util.Map;",
          "22: import org.apache.commons.beanutils2.BeanUtils;",
          "23: import org.apache.commons.logging.Log;",
          "24: import org.apache.commons.logging.LogFactory;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "23: import org.apache.commons.beanutils2.BeanUtilsBean;",
          "24: import org.apache.commons.beanutils2.PropertyUtilsBean;",
          "25: import org.apache.commons.beanutils2.SuppressPropertiesBeanIntrospector;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "73:     @Override",
          "74:     protected void setUp() throws Exception {",
          "75:         super.setUp();",
          "76:     }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "80:         BeanUtilsBean custom = new BeanUtilsBean();",
          "81:      custom.getPropertyUtils().removeBeanIntrospector(SuppressPropertiesBeanIntrospector.SUPPRESS_CLASS);",
          "82:      BeanUtilsBean.setInstance(custom);",
          "",
          "---------------"
        ],
        "src/test/java/org/apache/commons/beanutils2/bugs/Jira520TestCase.java||src/test/java/org/apache/commons/beanutils2/bugs/Jira520TestCase.java": [
          "File: src/test/java/org/apache/commons/beanutils2/bugs/Jira520TestCase.java -> src/test/java/org/apache/commons/beanutils2/bugs/Jira520TestCase.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "17: package org.apache.commons.beanutils2.bugs;",
          "19: import org.apache.commons.beanutils2.AlphaBean;",
          "20: import org.apache.commons.beanutils2.BeanUtilsBean;",
          "21: import org.apache.commons.beanutils2.SuppressPropertiesBeanIntrospector;",
          "23: import junit.framework.TestCase;",
          "30: public class Jira520TestCase extends TestCase {",
          "34:     public void testSuppressClassPropertyByDefault() throws Exception {",
          "35:         final BeanUtilsBean bub = new BeanUtilsBean();",
          "36:         final AlphaBean bean = new AlphaBean();",
          "37:         try {",
          "38:             bub.getProperty(bean, \"class\");",
          "39:             fail(\"Could access class property!\");",
          "40:         } catch (final NoSuchMethodException ex) {",
          "42:         }",
          "43:     }",
          "48:     public void testAllowAccessToClassProperty() throws Exception {",
          "49:         final BeanUtilsBean bub = new BeanUtilsBean();",
          "50:         bub.getPropertyUtils().removeBeanIntrospector(SuppressPropertiesBeanIntrospector.SUPPRESS_CLASS);",
          "51:         final AlphaBean bean = new AlphaBean();",
          "52:         String result = bub.getProperty(bean, \"class\");",
          "53:         assertEquals(\"Class property should have been accessed\", \"class org.apache.commons.beanutils2.AlphaBean\", result);",
          "54:     }",
          "55: }",
          "",
          "---------------"
        ]
      }
    }
  ]
}