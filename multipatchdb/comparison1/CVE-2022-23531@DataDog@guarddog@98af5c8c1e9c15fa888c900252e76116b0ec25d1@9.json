{
  "cve_id": "CVE-2022-23531",
  "cve_desc": "GuardDog is a CLI tool to identify malicious PyPI packages. Versions prior to 0.1.5 are vulnerable to Relative Path Traversal when scanning a specially-crafted local PyPI package. Running GuardDog against a specially-crafted package can allow an attacker to write an arbitrary file on the machine where GuardDog is executed due to a path traversal vulnerability when extracting the .tar.gz file of the package being scanned, which exists by design in the tarfile.TarFile.extractall function. This issue is patched in version 0.1.5.",
  "repo": "DataDog/guarddog",
  "patch_hash": "98af5c8c1e9c15fa888c900252e76116b0ec25d1",
  "patch_info": {
    "commit_hash": "98af5c8c1e9c15fa888c900252e76116b0ec25d1",
    "repo": "DataDog/guarddog",
    "commit_url": "https://github.com/DataDog/guarddog/commit/98af5c8c1e9c15fa888c900252e76116b0ec25d1",
    "files": [
      "guarddog/scanners/package_scanner.py",
      "poetry.lock",
      "pyproject.toml",
      "requirements.txt"
    ],
    "message": "Use tarsafe instead of built-in tarfile to extract archives (#89)\n\n* Use tarsafe instead of built-in tarfile to extract archives\n\n* Bump down Semgrep version to 0.112.1\n\nSee also https://github.com/returntocorp/semgrep/issues/6631",
    "before_after_code_files": [
      "guarddog/scanners/package_scanner.py||guarddog/scanners/package_scanner.py",
      "poetry.lock||poetry.lock"
    ]
  },
  "patch_diff": {
    "guarddog/scanners/package_scanner.py||guarddog/scanners/package_scanner.py": [
      "File: guarddog/scanners/package_scanner.py -> guarddog/scanners/package_scanner.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "2: import os",
      "3: import shutil",
      "4: import sys",
      "6: import tempfile",
      "7: import requests",
      "",
      "[Removed Lines]",
      "5: import tarfile",
      "",
      "[Added Lines]",
      "5: import tarsafe",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "44:         if os.path.exists(path):",
      "45:             if path.endswith('.tar.gz'):",
      "46:                 with tempfile.TemporaryDirectory() as tmpdirname:",
      "48:                     return self.analyzer.analyze_sourcecode(tmpdirname, rules=rules)",
      "49:             elif os.path.isdir(path):",
      "50:                 return self.analyzer.analyze_sourcecode(path, rules=rules)",
      "",
      "[Removed Lines]",
      "47:                     tarfile.open(path).extractall(tmpdirname)",
      "",
      "[Added Lines]",
      "47:                     tarsafe.open(path).extractall(tmpdirname)",
      "",
      "---------------"
    ],
    "poetry.lock||poetry.lock": [
      "File: poetry.lock -> poetry.lock",
      "--- Hunk 1 ---",
      "[Context before]",
      "477: [[package]]",
      "478: name = \"semgrep\"",
      "480: description = \"Lightweight static analysis for many languages. Find bug variants with patterns that look like source code.\"",
      "481: category = \"main\"",
      "482: optional = false",
      "",
      "[Removed Lines]",
      "479: version = \"0.122.0\"",
      "",
      "[Added Lines]",
      "479: version = \"0.112.1\"",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "496: python-lsp-jsonrpc = \">=1.0.0,<1.1.0\"",
      "497: requests = \">=2.22,<3.0\"",
      "498: \"ruamel.yaml\" = \">=0.16.0,<0.18\"",
      "500: tqdm = \">=4.46,<5.0\"",
      "501: typing-extensions = \">=4.2,<5.0\"",
      "502: urllib3 = \">=1.26,<2.0\"",
      "",
      "[Removed Lines]",
      "499: tomli = \">=2.0.1,<2.1.0\"",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "526: optional = false",
      "527: python-versions = \">=2.7, !=3.0.*, !=3.1.*, !=3.2.*\"",
      "529: [[package]]",
      "530: name = \"termcolor\"",
      "531: version = \"2.1.1\"",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "528: [[package]]",
      "529: name = \"tarsafe\"",
      "530: version = \"0.0.4\"",
      "531: description = \"A safe subclass of the TarFile class for interacting with tar files. Can be used as a direct drop-in replacement for safe usage of extractall()\"",
      "532: category = \"main\"",
      "533: optional = false",
      "534: python-versions = \">=3.6\"",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "618: [metadata]",
      "619: lock-version = \"1.1\"",
      "620: python-versions = \">=3.9, <4\"",
      "623: [metadata.files]",
      "624: attrs = [",
      "",
      "[Removed Lines]",
      "621: content-hash = \"a2ee2a3bf8cdebfd91939977044d2a626e5b54500965da9d66a70c3c9b71ca2c\"",
      "",
      "[Added Lines]",
      "628: content-hash = \"0faf892801caefce1e994f6fdee7254ac4e2e95ad947d7459b75113af80eed74\"",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "867:     {file = \"ruamel.yaml.clib-0.2.7.tar.gz\", hash = \"sha256:1f08fd5a2bea9c4180db71678e850b995d2a5f4537be0e94557668cf0f5f9497\"},",
      "868: ]",
      "869: semgrep = [",
      "874: ]",
      "875: setuptools = [",
      "876:     {file = \"setuptools-65.6.3-py3-none-any.whl\", hash = \"sha256:57f6f22bde4e042978bcd50176fdb381d7c21a9efa4041202288d3737a0c6a54\"},",
      "",
      "[Removed Lines]",
      "870:     {file = \"semgrep-0.122.0-cp37.cp38.cp39.py37.py38.py39-none-any.whl\", hash = \"sha256:c7002b9aba97deb6677f4cabfa5dcc8faef2808ce6a6f28ecdd70cd8e90b01b5\"},",
      "871:     {file = \"semgrep-0.122.0-cp37.cp38.cp39.py37.py38.py39-none-macosx_10_14_x86_64.whl\", hash = \"sha256:e3fb9956e2bb926cfeff52deafe4cec24d5f1e91fe6d3fc4f81e86ec452b2ad5\"},",
      "872:     {file = \"semgrep-0.122.0-cp37.cp38.cp39.py37.py38.py39-none-macosx_11_0_arm64.whl\", hash = \"sha256:6116391b0c8c87581d9d72113702b6f8c2938d799cdae7d71a845ec89249566c\"},",
      "873:     {file = \"semgrep-0.122.0.tar.gz\", hash = \"sha256:a4c7400eb8bec9fe8df25520d1ffcb5d78b87c73dc654f1c2aec1195789bc611\"},",
      "",
      "[Added Lines]",
      "877:     {file = \"semgrep-0.112.1-cp37.cp38.cp39.py37.py38.py39-none-any.whl\", hash = \"sha256:2a62bc6321d371dadc41df2c68678e87df807ddfa3d1faafb40bd0998abfe503\"},",
      "878:     {file = \"semgrep-0.112.1-cp37.cp38.cp39.py37.py38.py39-none-macosx_10_14_x86_64.whl\", hash = \"sha256:b690a84cbaa6a4670ff6c11a674818b8ad99736e89520a3c47d1542cc45e6d05\"},",
      "879:     {file = \"semgrep-0.112.1-cp37.cp38.cp39.py37.py38.py39-none-macosx_11_0_arm64.whl\", hash = \"sha256:bc2437f12e41ac5e28a303e463098565a3d948c7744f6745bdb0fea341ccdae1\"},",
      "880:     {file = \"semgrep-0.112.1.tar.gz\", hash = \"sha256:2140a0fd16f3ac0a0e330980613ba65fe58faea7808a965e219c4199bab96102\"},",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "880:     {file = \"six-1.16.0-py2.py3-none-any.whl\", hash = \"sha256:8abb2f1d86890a2dfb989f9a77cfcfd3e47c2a354b01111771326f8aa26e0254\"},",
      "881:     {file = \"six-1.16.0.tar.gz\", hash = \"sha256:1e61c37477a1626458e36f7b1d82aa5c9b094fa4802892072e49de9c60c4c926\"},",
      "882: ]",
      "883: termcolor = [",
      "884:     {file = \"termcolor-2.1.1-py3-none-any.whl\", hash = \"sha256:fa852e957f97252205e105dd55bbc23b419a70fec0085708fc0515e399f304fd\"},",
      "885:     {file = \"termcolor-2.1.1.tar.gz\", hash = \"sha256:67cee2009adc6449c650f6bcf3bdeed00c8ba53a8cda5362733c53e0a39fb70b\"},",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "890: tarsafe = [",
      "891:     {file = \"tarsafe-0.0.4-py3-none-any.whl\", hash = \"sha256:12903a81f2612c09d22117115301ea510944af5caa1e358636e0fc1d0e6134df\"},",
      "892:     {file = \"tarsafe-0.0.4.tar.gz\", hash = \"sha256:a376f4138005298c11c30cb60a5081fa2c09f44384c966106fbaeee3059e9ec5\"},",
      "893: ]",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "30cb42da86f90a62ee3352fa9ab4ca954fdc4bb0",
      "candidate_info": {
        "commit_hash": "30cb42da86f90a62ee3352fa9ab4ca954fdc4bb0",
        "repo": "DataDog/guarddog",
        "commit_url": "https://github.com/DataDog/guarddog/commit/30cb42da86f90a62ee3352fa9ab4ca954fdc4bb0",
        "files": [
          "poetry.lock",
          "pyproject.toml"
        ],
        "message": "Bump pathspec from 0.9.0 to 0.11.0\n\nBumps [pathspec](https://github.com/cpburnz/python-pathspec) from 0.9.0 to 0.11.0.\n- [Release notes](https://github.com/cpburnz/python-pathspec/releases)\n- [Changelog](https://github.com/cpburnz/python-pathspec/blob/master/CHANGES.rst)\n- [Commits](https://github.com/cpburnz/python-pathspec/compare/v0.9.0...v0.11.0)\n\n---\nupdated-dependencies:\n- dependency-name: pathspec\n  dependency-type: direct:production\n  update-type: version-update:semver-minor\n...\n\nSigned-off-by: dependabot[bot] <support@github.com>",
        "before_after_code_files": [
          "poetry.lock||poetry.lock"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "poetry.lock||poetry.lock"
          ],
          "candidate": [
            "poetry.lock||poetry.lock"
          ]
        }
      },
      "candidate_diff": {
        "poetry.lock||poetry.lock": [
          "File: poetry.lock -> poetry.lock",
          "--- Hunk 1 ---",
          "[Context before]",
          "468: [[package]]",
          "469: name = \"pathspec\"",
          "471: description = \"Utility library for gitignore style pattern matching of file paths.\"",
          "472: category = \"main\"",
          "473: optional = false",
          "475: files = [",
          "478: ]",
          "480: [[package]]",
          "",
          "[Removed Lines]",
          "470: version = \"0.9.0\"",
          "474: python-versions = \"!=3.0.*,!=3.1.*,!=3.2.*,!=3.3.*,!=3.4.*,>=2.7\"",
          "476:     {file = \"pathspec-0.9.0-py2.py3-none-any.whl\", hash = \"sha256:7d15c4ddb0b5c802d161efc417ec1a2558ea2653c2e8ad9c19098201dc1c993a\"},",
          "477:     {file = \"pathspec-0.9.0.tar.gz\", hash = \"sha256:e564499435a2673d586f6b2130bb5b95f04a3ba06f81b8f895b651a3c76aabb1\"},",
          "",
          "[Added Lines]",
          "470: version = \"0.11.0\"",
          "474: python-versions = \">=3.7\"",
          "476:     {file = \"pathspec-0.11.0-py3-none-any.whl\", hash = \"sha256:3a66eb970cbac598f9e5ccb5b2cf58930cd8e3ed86d393d541eaf2d8b1705229\"},",
          "477:     {file = \"pathspec-0.11.0.tar.gz\", hash = \"sha256:64d338d4e0914e91c1792321e6907b5a593f1ab1851de7fc269557a21b30ebbc\"},",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1239: [metadata]",
          "1240: lock-version = \"2.0\"",
          "1241: python-versions = \">=3.10,<4\"",
          "",
          "[Removed Lines]",
          "1242: content-hash = \"bfd02664c4c2dcda2418ff28dd3515da532f994e2a51c1eb6170e4186266389d\"",
          "",
          "[Added Lines]",
          "1242: content-hash = \"415a8036c048ec47b5914cb3817ffa36400600b6747fdb12a634701c11e2a051\"",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "473804a2a7c807323e86c356729bdecb3185d782",
      "candidate_info": {
        "commit_hash": "473804a2a7c807323e86c356729bdecb3185d782",
        "repo": "DataDog/guarddog",
        "commit_url": "https://github.com/DataDog/guarddog/commit/473804a2a7c807323e86c356729bdecb3185d782",
        "files": [
          "poetry.lock",
          "pyproject.toml"
        ],
        "message": "Bump jsonschema from 4.9.1 to 4.17.3\n\nBumps [jsonschema](https://github.com/python-jsonschema/jsonschema) from 4.9.1 to 4.17.3.\n- [Release notes](https://github.com/python-jsonschema/jsonschema/releases)\n- [Changelog](https://github.com/python-jsonschema/jsonschema/blob/main/CHANGELOG.rst)\n- [Commits](https://github.com/python-jsonschema/jsonschema/compare/v4.9.1...v4.17.3)\n\n---\nupdated-dependencies:\n- dependency-name: jsonschema\n  dependency-type: direct:production\n  update-type: version-update:semver-minor\n...\n\nSigned-off-by: dependabot[bot] <support@github.com>",
        "before_after_code_files": [
          "poetry.lock||poetry.lock"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "poetry.lock||poetry.lock"
          ],
          "candidate": [
            "poetry.lock||poetry.lock"
          ]
        }
      },
      "candidate_diff": {
        "poetry.lock||poetry.lock": [
          "File: poetry.lock -> poetry.lock",
          "--- Hunk 1 ---",
          "[Context before]",
          "363: [[package]]",
          "364: name = \"jsonschema\"",
          "366: description = \"An implementation of JSON Schema validation for Python\"",
          "367: category = \"main\"",
          "368: optional = false",
          "369: python-versions = \">=3.7\"",
          "370: files = [",
          "373: ]",
          "375: [package.dependencies]",
          "",
          "[Removed Lines]",
          "365: version = \"4.9.1\"",
          "371:     {file = \"jsonschema-4.9.1-py3-none-any.whl\", hash = \"sha256:8ebad55894c002585271af2d327d99339ef566fb085d9129b69e2623867c4106\"},",
          "372:     {file = \"jsonschema-4.9.1.tar.gz\", hash = \"sha256:408c4c8ed0dede3b268f7a441784f74206380b04f93eb2d537c7befb3df3099f\"},",
          "",
          "[Added Lines]",
          "365: version = \"4.17.3\"",
          "371:     {file = \"jsonschema-4.17.3-py3-none-any.whl\", hash = \"sha256:a870ad254da1a8ca84b6a2905cac29d265f805acc57af304784962a2aa6508f6\"},",
          "372:     {file = \"jsonschema-4.17.3.tar.gz\", hash = \"sha256:0f864437ab8b6076ba6707453ef8f98a6a0d512a80e93f8abdb676f737ecb60d\"},",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1237: [metadata]",
          "1238: lock-version = \"2.0\"",
          "1239: python-versions = \">=3.10,<4\"",
          "",
          "[Removed Lines]",
          "1240: content-hash = \"be534099d906385de7599ee098a164c6610874b88287541908f4196115d3f9fc\"",
          "",
          "[Added Lines]",
          "1240: content-hash = \"075478c3dae0caf3288238072b0ff32a2487d076ba58f99b462470b7753a776f\"",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "81fe3fdc69b4e58b6e1004e43d6813290f72264a",
      "candidate_info": {
        "commit_hash": "81fe3fdc69b4e58b6e1004e43d6813290f72264a",
        "repo": "DataDog/guarddog",
        "commit_url": "https://github.com/DataDog/guarddog/commit/81fe3fdc69b4e58b6e1004e43d6813290f72264a",
        "files": [
          "poetry.lock",
          "pyproject.toml"
        ],
        "message": "Bump mypy-extensions from 0.4.3 to 1.0.0\n\nBumps [mypy-extensions](https://github.com/python/mypy_extensions) from 0.4.3 to 1.0.0.\n- [Release notes](https://github.com/python/mypy_extensions/releases)\n- [Commits](https://github.com/python/mypy_extensions/compare/0.4.3...1.0.0)\n\n---\nupdated-dependencies:\n- dependency-name: mypy-extensions\n  dependency-type: direct:production\n  update-type: version-update:semver-major\n...\n\nSigned-off-by: dependabot[bot] <support@github.com>",
        "before_after_code_files": [
          "poetry.lock||poetry.lock"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "poetry.lock||poetry.lock"
          ],
          "candidate": [
            "poetry.lock||poetry.lock"
          ]
        }
      },
      "candidate_diff": {
        "poetry.lock||poetry.lock": [
          "File: poetry.lock -> poetry.lock",
          "--- Hunk 1 ---",
          "[Context before]",
          "423: [[package]]",
          "424: name = \"mypy-extensions\"",
          "427: category = \"main\"",
          "428: optional = false",
          "430: files = [",
          "433: ]",
          "435: [[package]]",
          "",
          "[Removed Lines]",
          "425: version = \"0.4.3\"",
          "426: description = \"Experimental type system extensions for programs checked with the mypy typechecker.\"",
          "429: python-versions = \"*\"",
          "431:     {file = \"mypy_extensions-0.4.3-py2.py3-none-any.whl\", hash = \"sha256:090fedd75945a69ae91ce1303b5824f428daf5a028d2f6ab8a299250a846f15d\"},",
          "432:     {file = \"mypy_extensions-0.4.3.tar.gz\", hash = \"sha256:2d82818f5bb3e369420cb3c4060a7970edba416647068eb4c5343488a6c604a8\"},",
          "",
          "[Added Lines]",
          "425: version = \"1.0.0\"",
          "426: description = \"Type system extensions for programs checked with the mypy type checker.\"",
          "429: python-versions = \">=3.5\"",
          "431:     {file = \"mypy_extensions-1.0.0-py3-none-any.whl\", hash = \"sha256:4392f6c0eb8a5668a69e23d168ffa70f0be9ccfd32b5cc2d26a34ae5b844552d\"},",
          "432:     {file = \"mypy_extensions-1.0.0.tar.gz\", hash = \"sha256:75dbf8955dc00442a438fc4d0666508a9a97b6bd41aa2f0ffe9d2f2725af0782\"},",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1237: [metadata]",
          "1238: lock-version = \"2.0\"",
          "1239: python-versions = \">=3.10,<4\"",
          "",
          "[Removed Lines]",
          "1240: content-hash = \"919b2daa8acae847ec759a188a59c6705e998233a25a84339deedc5edc63e81c\"",
          "",
          "[Added Lines]",
          "1240: content-hash = \"fdd0b22a8faaf9491ef4a4564b0a924c009b3023503577f989d72d2262d92510\"",
          "",
          "---------------"
        ]
      }
    }
  ]
}