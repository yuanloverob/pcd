{
  "cve_id": "CVE-2021-27906",
  "cve_desc": "A carefully crafted PDF file can trigger an OutOfMemory-Exception while loading the file. This issue affects Apache PDFBox version 2.0.22 and prior 2.0.x versions.",
  "repo": "apache/pdfbox",
  "patch_hash": "8c47be1011c11dc47300faecffd8ab32fba3646f",
  "patch_info": {
    "commit_hash": "8c47be1011c11dc47300faecffd8ab32fba3646f",
    "repo": "apache/pdfbox",
    "commit_url": "https://github.com/apache/pdfbox/commit/8c47be1011c11dc47300faecffd8ab32fba3646f",
    "files": [
      "pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java"
    ],
    "message": "PDFBOX-5112: SonarCube fix, throw NoSuchElementException if no more elements are available\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1887295 13f79535-47bb-0310-9956-ffa450edef68",
    "before_after_code_files": [
      "pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java||pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java"
    ]
  },
  "patch_diff": {
    "pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java||pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java": [
      "File: pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java -> pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFXrefStreamParser.java",
      "--- Hunk 1 ---",
      "[Context before]",
      "19: import java.io.IOException;",
      "20: import java.util.Arrays;",
      "21: import java.util.Iterator;",
      "23: import org.apache.pdfbox.cos.COSArray;",
      "24: import org.apache.pdfbox.cos.COSBase;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "22: import java.util.NoSuchElementException;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "212:         @Override",
      "213:         public Long next()",
      "214:         {",
      "215:             if (currentNumber < currentEnd)",
      "216:             {",
      "217:                 return currentNumber++;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "216:             if (currentNumber >= maxValue)",
      "217:             {",
      "218:                 throw new NoSuchElementException();",
      "219:             }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "026751fb43575279d244ed6a814c1ae993a8ac40",
      "candidate_info": {
        "commit_hash": "026751fb43575279d244ed6a814c1ae993a8ac40",
        "repo": "apache/pdfbox",
        "commit_url": "https://github.com/apache/pdfbox/commit/026751fb43575279d244ed6a814c1ae993a8ac40",
        "files": [
          "pdfbox/src/main/java/org/apache/pdfbox/rendering/PageDrawer.java"
        ],
        "message": "PDFBOX-4892: performance improvements, as suggested by valerybokov\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1887861 13f79535-47bb-0310-9956-ffa450edef68",
        "before_after_code_files": [
          "pdfbox/src/main/java/org/apache/pdfbox/rendering/PageDrawer.java||pdfbox/src/main/java/org/apache/pdfbox/rendering/PageDrawer.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/pdfbox/pull/104"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "pdfbox/src/main/java/org/apache/pdfbox/rendering/PageDrawer.java||pdfbox/src/main/java/org/apache/pdfbox/rendering/PageDrawer.java": [
          "File: pdfbox/src/main/java/org/apache/pdfbox/rendering/PageDrawer.java -> pdfbox/src/main/java/org/apache/pdfbox/rendering/PageDrawer.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "34: import java.awt.geom.AffineTransform;",
          "35: import java.awt.geom.Area;",
          "36: import java.awt.geom.GeneralPath;",
          "37: import java.awt.geom.PathIterator;",
          "38: import java.awt.geom.Point2D;",
          "39: import java.awt.geom.Rectangle2D;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "37: import java.awt.geom.Path2D;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "444:         {",
          "448:             for (Shape shape : textClippings)",
          "449:             {",
          "450:                 path.append(shape, false);",
          "",
          "[Removed Lines]",
          "447:             GeneralPath path = new GeneralPath();",
          "",
          "[Added Lines]",
          "448:             GeneralPath path = new GeneralPath(Path2D.WIND_NON_ZERO, textClippings.size());",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1425:     {",
          "1426:         lastClip = null;",
          "1427:         int deviceType = -1;",
          "1430:         {",
          "1432:         }",
          "1433:         if (deviceType == GraphicsDevice.TYPE_PRINTER && !annotation.isPrinted())",
          "1434:         {",
          "",
          "[Removed Lines]",
          "1428:         if (graphics.getDeviceConfiguration() != null &&",
          "1429:             graphics.getDeviceConfiguration().getDevice() != null)",
          "1431:             deviceType = graphics.getDeviceConfiguration().getDevice().getType();",
          "",
          "[Added Lines]",
          "1429:         GraphicsConfiguration graphicsConfiguration = graphics.getDeviceConfiguration();",
          "1430:         if (graphicsConfiguration != null)",
          "1432:             GraphicsDevice graphicsDevice = graphicsConfiguration.getDevice();",
          "1433:             if (graphicsDevice != null)",
          "1434:             {",
          "1435:                 deviceType = graphicsDevice.getType();",
          "1436:             }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "a6dfd24eb13476d984371a2a734d0410514e1eb8",
      "candidate_info": {
        "commit_hash": "a6dfd24eb13476d984371a2a734d0410514e1eb8",
        "repo": "apache/pdfbox",
        "commit_url": "https://github.com/apache/pdfbox/commit/a6dfd24eb13476d984371a2a734d0410514e1eb8",
        "files": [
          "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/PDMeshBasedShadingType.java",
          "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/PDShadingType4.java",
          "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/PDTriangleBasedShadingType.java",
          "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/TriangleBasedShadingContext.java"
        ],
        "message": "PDFBOX-5134: Sonar fix\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1888293 13f79535-47bb-0310-9956-ffa450edef68",
        "before_after_code_files": [
          "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/PDMeshBasedShadingType.java||pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/PDMeshBasedShadingType.java",
          "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/PDShadingType4.java||pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/PDShadingType4.java",
          "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/PDTriangleBasedShadingType.java||pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/PDTriangleBasedShadingType.java",
          "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/TriangleBasedShadingContext.java||pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/TriangleBasedShadingContext.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/pdfbox/pull/104"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/PDMeshBasedShadingType.java||pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/PDMeshBasedShadingType.java": [
          "File: pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/PDMeshBasedShadingType.java -> pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/PDMeshBasedShadingType.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "179:     {",
          "180:         float[][] color = new float[4][getNumberOfColorComponents()];",
          "181:         Point2D[] points = new Point2D[controlPoints];",
          "183:         if (isFree)",
          "184:         {",
          "185:             pStart = 0;",
          "",
          "[Removed Lines]",
          "182:         int pStart = 4, cStart = 2;",
          "",
          "[Added Lines]",
          "182:         int pStart = 4;",
          "183:         int cStart = 2;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "240:     abstract Patch generatePatch(Point2D[] points, float[][] color);",
          "242:     @Override",
          "245:     Rectangle2D getBounds(AffineTransform xform, Matrix matrix, int controlPoints)",
          "246:             throws IOException",
          "",
          "[Removed Lines]",
          "243:     abstract public Rectangle2D getBounds(AffineTransform xform, Matrix matrix) throws IOException;",
          "",
          "[Added Lines]",
          "244:     public abstract Rectangle2D getBounds(AffineTransform xform, Matrix matrix) throws IOException;",
          "",
          "---------------"
        ],
        "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/PDShadingType4.java||pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/PDShadingType4.java": [
          "File: pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/PDShadingType4.java -> pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/PDShadingType4.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "130:             boolean eof = false;",
          "131:             while (!eof)",
          "132:             {",
          "134:                 Point2D[] ps;",
          "135:                 float[][] cs;",
          "136:                 int lastIndex;",
          "",
          "[Removed Lines]",
          "133:                 Vertex p0, p1, p2;",
          "",
          "[Added Lines]",
          "133:                 Vertex p0;",
          "134:                 Vertex p1;",
          "135:                 Vertex p2;",
          "",
          "---------------"
        ],
        "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/PDTriangleBasedShadingType.java||pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/PDTriangleBasedShadingType.java": [
          "File: pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/PDTriangleBasedShadingType.java -> pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/PDTriangleBasedShadingType.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "42:     private COSArray decode = null;",
          "46:     private int bitsPerCoordinate = -1;",
          "47:     private int bitsPerColorComponent = -1;",
          "",
          "[Removed Lines]",
          "44:     private static final Log LOG = LogFactory.getLog(TriangleBasedShadingContext.class);",
          "",
          "[Added Lines]",
          "44:     private static final Log LOG = LogFactory.getLog(PDTriangleBasedShadingType.class);",
          "",
          "---------------"
        ],
        "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/TriangleBasedShadingContext.java||pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/TriangleBasedShadingContext.java": [
          "File: pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/TriangleBasedShadingContext.java -> pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/TriangleBasedShadingContext.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "25: import java.io.IOException;",
          "26: import java.util.List;",
          "27: import java.util.Map;",
          "30: import org.apache.pdfbox.util.Matrix;",
          "",
          "[Removed Lines]",
          "28: import org.apache.commons.logging.Log;",
          "29: import org.apache.commons.logging.LogFactory;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "56faff7e215e55dbd2578218f48dc73939c64d9f",
      "candidate_info": {
        "commit_hash": "56faff7e215e55dbd2578218f48dc73939c64d9f",
        "repo": "apache/pdfbox",
        "commit_url": "https://github.com/apache/pdfbox/commit/56faff7e215e55dbd2578218f48dc73939c64d9f",
        "files": [
          "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/interactive/form/PDNonTerminalField.java"
        ],
        "message": "PDFBOX-4892: avoid ClassCastException and NullPointerException\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1884359 13f79535-47bb-0310-9956-ffa450edef68",
        "before_after_code_files": [
          "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/interactive/form/PDNonTerminalField.java||pdfbox/src/main/java/org/apache/pdfbox/pdmodel/interactive/form/PDNonTerminalField.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/pdfbox/pull/104"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/interactive/form/PDNonTerminalField.java||pdfbox/src/main/java/org/apache/pdfbox/pdmodel/interactive/form/PDNonTerminalField.java": [
          "File: pdfbox/src/main/java/org/apache/pdfbox/pdmodel/interactive/form/PDNonTerminalField.java -> pdfbox/src/main/java/org/apache/pdfbox/pdmodel/interactive/form/PDNonTerminalField.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "129:     public List<PDField> getChildren()",
          "130:     {",
          "131:         List<PDField> children = new ArrayList<PDField>();",
          "133:         for (int i = 0; i < kids.size(); i++)",
          "134:         {",
          "135:             COSBase kid = kids.getObject(i);",
          "",
          "[Removed Lines]",
          "132:         COSArray kids = (COSArray)getCOSObject().getDictionaryObject(COSName.KIDS);",
          "",
          "[Added Lines]",
          "132:         COSArray kids = getCOSObject().getCOSArray(COSName.KIDS);",
          "133:         if (kids == null)",
          "134:         {",
          "135:             return children;",
          "136:         }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "207bd5d76c74c7d4a1963554638117d84edf8601",
      "candidate_info": {
        "commit_hash": "207bd5d76c74c7d4a1963554638117d84edf8601",
        "repo": "apache/pdfbox",
        "commit_url": "https://github.com/apache/pdfbox/commit/207bd5d76c74c7d4a1963554638117d84edf8601",
        "files": [
          "examples/src/test/java/org/apache/pdfbox/examples/pdmodel/TestCreateSignature.java"
        ],
        "message": "PDFBOX-4892: adjust language\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1892716 13f79535-47bb-0310-9956-ffa450edef68",
        "before_after_code_files": [
          "examples/src/test/java/org/apache/pdfbox/examples/pdmodel/TestCreateSignature.java||examples/src/test/java/org/apache/pdfbox/examples/pdmodel/TestCreateSignature.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/pdfbox/pull/104"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "examples/src/test/java/org/apache/pdfbox/examples/pdmodel/TestCreateSignature.java||examples/src/test/java/org/apache/pdfbox/examples/pdmodel/TestCreateSignature.java": [
          "File: examples/src/test/java/org/apache/pdfbox/examples/pdmodel/TestCreateSignature.java -> examples/src/test/java/org/apache/pdfbox/examples/pdmodel/TestCreateSignature.java"
        ]
      }
    },
    {
      "candidate_hash": "37fd049eaaa19855c30bc50aefe571ac350bc45a",
      "candidate_info": {
        "commit_hash": "37fd049eaaa19855c30bc50aefe571ac350bc45a",
        "repo": "apache/pdfbox",
        "commit_url": "https://github.com/apache/pdfbox/commit/37fd049eaaa19855c30bc50aefe571ac350bc45a",
        "files": [
          "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/interactive/annotation/PDBorderStyleDictionary.java"
        ],
        "message": "PDFBOX-4892: remove unneeded code, as suggested by valerybokov\n\ngit-svn-id: https://svn.apache.org/repos/asf/pdfbox/branches/2.0@1887860 13f79535-47bb-0310-9956-ffa450edef68",
        "before_after_code_files": [
          "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/interactive/annotation/PDBorderStyleDictionary.java||pdfbox/src/main/java/org/apache/pdfbox/pdmodel/interactive/annotation/PDBorderStyleDictionary.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/pdfbox/pull/104"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "pdfbox/src/main/java/org/apache/pdfbox/pdmodel/interactive/annotation/PDBorderStyleDictionary.java||pdfbox/src/main/java/org/apache/pdfbox/pdmodel/interactive/annotation/PDBorderStyleDictionary.java": [
          "File: pdfbox/src/main/java/org/apache/pdfbox/pdmodel/interactive/annotation/PDBorderStyleDictionary.java -> pdfbox/src/main/java/org/apache/pdfbox/pdmodel/interactive/annotation/PDBorderStyleDictionary.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "160:     public void setDashStyle(COSArray dashArray)",
          "161:     {",
          "168:     }",
          "",
          "[Removed Lines]",
          "162:         COSArray array = null;",
          "163:         if (dashArray != null)",
          "164:         {",
          "165:             array = dashArray;",
          "166:         }",
          "167:         getCOSObject().setItem(COSName.D, array);",
          "",
          "[Added Lines]",
          "162:         getCOSObject().setItem(COSName.D, dashArray);",
          "",
          "---------------"
        ]
      }
    }
  ]
}