{
  "cve_id": "CVE-2021-41745",
  "cve_desc": "ShowDoc 2.8.3 ihas a file upload vulnerability, where attackers can use the vulnerability to obtain server permissions.",
  "repo": "star7th/showdoc",
  "patch_hash": "aec3df841958059c1db9ab1af25acc2af81e4e0e",
  "patch_info": {
    "commit_hash": "aec3df841958059c1db9ab1af25acc2af81e4e0e",
    "repo": "star7th/showdoc",
    "commit_url": "https://github.com/star7th/showdoc/commit/aec3df841958059c1db9ab1af25acc2af81e4e0e",
    "files": [
      "server/Application/Api/Controller/AttachmentController.class.php",
      "server/Application/Api/Controller/CommonController.class.php",
      "server/Application/Api/Controller/PageController.class.php",
      "server/Application/Api/Controller/UpdateController.class.php",
      "server/Application/Api/Model/AttachmentModel.class.php",
      "server/Application/Api/Model/PageModel.class.php",
      "web_src/.prettierrc.json",
      "web_src/src/components/admin/Index.vue",
      "web_src/src/components/admin/attachment/Index.vue",
      "web_src/src/components/attachment/Index.vue",
      "web_src/src/components/item/Index.vue",
      "web_src/src/router/index.js",
      "web_src/static/css/common.css",
      "web_src/static/lang/en.js",
      "web_src/static/lang/zh-CN.js"
    ],
    "message": "Attachment management \u9644\u4ef6\u7ba1\u7406",
    "before_after_code_files": [
      "server/Application/Api/Controller/AttachmentController.class.php||server/Application/Api/Controller/AttachmentController.class.php",
      "server/Application/Api/Controller/CommonController.class.php||server/Application/Api/Controller/CommonController.class.php",
      "server/Application/Api/Controller/PageController.class.php||server/Application/Api/Controller/PageController.class.php",
      "server/Application/Api/Controller/UpdateController.class.php||server/Application/Api/Controller/UpdateController.class.php",
      "server/Application/Api/Model/AttachmentModel.class.php||server/Application/Api/Model/AttachmentModel.class.php",
      "server/Application/Api/Model/PageModel.class.php||server/Application/Api/Model/PageModel.class.php",
      "web_src/src/components/admin/Index.vue||web_src/src/components/admin/Index.vue",
      "web_src/src/components/admin/attachment/Index.vue||web_src/src/components/admin/attachment/Index.vue",
      "web_src/src/components/attachment/Index.vue||web_src/src/components/attachment/Index.vue",
      "web_src/src/components/item/Index.vue||web_src/src/components/item/Index.vue",
      "web_src/src/router/index.js||web_src/src/router/index.js",
      "web_src/static/css/common.css||web_src/static/css/common.css",
      "web_src/static/lang/en.js||web_src/static/lang/en.js",
      "web_src/static/lang/zh-CN.js||web_src/static/lang/zh-CN.js"
    ]
  },
  "patch_diff": {
    "server/Application/Api/Controller/AttachmentController.class.php||server/Application/Api/Controller/AttachmentController.class.php": [
      "File: server/Application/Api/Controller/AttachmentController.class.php -> server/Application/Api/Controller/AttachmentController.class.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: <?php",
      "3: namespace Api\\Controller;",
      "4: use Think\\Controller;",
      "5: class AttachmentController extends BaseController {",
      "7:     public function index(){",
      "9:         echo 'Attachment';",
      "11:     }",
      "14:     public function visitFile(){",
      "15:       $sign = I(\"sign\");",
      "16:       $imageView2 = I(\"imageView2\");",
      "17:       $d = D(\"UploadFile\") ;",
      "18:       $ret = $d->where(\" sign = '%s' \",array($sign))->find();",
      "19:       if ($ret) {",
      "20:             $beyond_the_quota = 0 ;",
      "21:             $days = ceil(( time() -$ret['addtime'])/86400);//\u81ea\u6dfb\u52a0\u56fe\u7247\u4ee5\u6765\u7684\u5929\u6570",
      "22:             $adv_day_times = $ret['visit_times'] / $days  ; //\u5e73\u5747\u6bcf\u5929\u7684\u8bbf\u95ee\u6b21\u6570",
      "23:             $flow_rate = ( $ret['file_size'] * $ret['visit_times'] ) / $days ; //\u65e5\u5747\u6d41\u91cf",
      "27:             if ( strpos($_SERVER['HTTP_USER_AGENT'], 'MicroMessenger') !== false  && strpos($ret['real_url'] , '.apk') !== false ) {",
      "28:                 header(\"Content-type: text/html; charset=utf-8\");",
      "29:                 echo \"<head><title>\u6e29\u99a8\u63d0\u793a</title></head>\";",
      "30:                 echo \"<br><h1>\u5fae\u4fe1\u4e0d\u652f\u6301\u76f4\u63a5\u4e0b\u8f7d\uff0c\u8bf7\u70b9\u51fb\u53f3\u4e0a\u89d2\u201c---\u201d\u5728\u5916\u90e8\u6d4f\u89c8\u5668\u4e2d\u6253\u5f00</h1>\";",
      "31:                 return ;",
      "33:             }",
      "35:           $d->where(\" sign = '%s' \",array($sign))->save(array(\"visit_times\" => $ret['visit_times'] + 1  ,\"last_visit_time\"=>time()));",
      "37:             D(\"Attachment\")->recordUserFlow($ret['uid'] , $ret['file_size']) ;",
      "40:             if ($ret['cache_url']) {",
      "41:                 $url = $ret['cache_url'] ;",
      "42:             }else{",
      "43:                 $url = $ret['real_url']  ;",
      "44:             }",
      "46:         header(\"location:{$url}\");",
      "47:       }else{",
      "48:         echo \"www.showdoc.cc\";",
      "49:       }",
      "50:     }",
      "53:     public function uploadImg(){",
      "54:         $login_user = $this->checkLogin();",
      "55:         $item_id = I(\"item_id/d\") ? I(\"item_id/d\") : 0 ;",
      "56:         $page_id = I(\"page_id/d\") ? I(\"page_id/d\") : 0 ;",
      "59:         if ($_FILES['editormd-image-file']['name'] == 'blob') {",
      "60:             $_FILES['editormd-image-file']['name'] .= '.jpg';",
      "61:         }",
      "63:         if (!$_FILES['editormd-image-file']) {",
      "64:            return false;",
      "65:         }",
      "67:         if (strstr(strip_tags(strtolower($_FILES['editormd-image-file']['name'])), \".php\") ) {",
      "68:             return false;",
      "69:         }",
      "71:         $oss_open = D(\"Options\")->get(\"oss_open\" ) ;",
      "72:         if ($oss_open) {",
      "73:             $uploadFile = $_FILES['editormd-image-file'] ;",
      "74:             $url = upload_oss($uploadFile);",
      "75:             if ($url) {",
      "76:                 $sign = md5($url.time().rand()) ;",
      "77:                 $insert = array(",
      "78:                 \"sign\" => $sign,",
      "79:                 \"uid\" => $login_user['uid'],",
      "80:                 \"item_id\" => $item_id,",
      "81:                 \"page_id\" => $page_id,",
      "82:                 \"display_name\" => $uploadFile['name'],",
      "83:                 \"file_type\" => $uploadFile['type'],",
      "84:                 \"file_size\" => $uploadFile['size'],",
      "85:                 \"real_url\" => $url,",
      "86:                 \"addtime\" => time(),",
      "87:                 );",
      "88:                 $ret = D(\"UploadFile\")->add($insert);",
      "89:                 $url = get_domain().U(\"api/attachment/visitFile\",array(\"sign\" => $sign)).\"&showdoc=.jpg\";",
      "90:                 echo json_encode(array(\"url\"=>$url,\"success\"=>1));",
      "91:             }",
      "92:             return ;",
      "93:         }",
      "95:         $upload = new \\Think\\Upload();// \u5b9e\u4f8b\u5316\u4e0a\u4f20\u7c7b",
      "96:         $upload->maxSize  = 1003145728 ;// \u8bbe\u7f6e\u9644\u4ef6\u4e0a\u4f20\u5927\u5c0f",
      "97:         $upload->allowExts  = array('jpg', 'gif', 'png', 'jpeg');// \u8bbe\u7f6e\u9644\u4ef6\u4e0a\u4f20\u7c7b\u578b",
      "98:         $upload->rootPath = './../Public/Uploads/';// \u8bbe\u7f6e\u9644\u4ef6\u4e0a\u4f20\u76ee\u5f55",
      "99:         $upload->savePath = '';// \u8bbe\u7f6e\u9644\u4ef6\u4e0a\u4f20\u5b50\u76ee\u5f55",
      "100:         $info = $upload->uploadOne($_FILES['editormd-image-file']) ;",
      "101:         if(!$info) {// \u4e0a\u4f20\u9519\u8bef\u63d0\u793a\u9519\u8bef\u4fe1\u606f",
      "102:           $this->error($upload->getError());",
      "103:           return;",
      "104:         }else{// \u4e0a\u4f20\u6210\u529f \u83b7\u53d6\u4e0a\u4f20\u6587\u4ef6\u4fe1\u606f",
      "105:           $url = get_domain().__ROOT__.substr($upload->rootPath,1).$info['savepath'].$info['savename'] ;",
      "106:           $sign = md5($url.time().rand()) ;",
      "107:           $uploadFile = $_FILES['editormd-image-file'] ;",
      "108:           $insert = array(",
      "109:             \"sign\" => $sign,",
      "110:             \"uid\" => $login_user['uid'],",
      "111:             \"item_id\" => $item_id,",
      "112:             \"page_id\" => $page_id,",
      "113:             \"display_name\" => $uploadFile['name'],",
      "114:             \"file_type\" => $uploadFile['type'],",
      "115:             \"file_size\" => $uploadFile['size'],",
      "116:             \"real_url\" => $url,",
      "117:             \"addtime\" => time(),",
      "118:             );",
      "119:           $ret = D(\"UploadFile\")->add($insert);",
      "120:           $url = get_domain().U(\"api/attachment/visitFile\",array(\"sign\" => $sign)).\"&showdoc=.jpg\";",
      "121:           echo json_encode(array(\"url\"=>$url,\"success\"=>1));",
      "122:         }",
      "124:     }",
      "127:     public function pageAttachmentUpload(){",
      "128:         $login_user = $this->checkLogin();",
      "129:         $item_id = I(\"item_id/d\") ? I(\"item_id/d\") : 0 ;",
      "130:         $page_id = I(\"page_id/d\") ? I(\"page_id/d\") : 0 ;",
      "131:         $uploadFile = $_FILES['file'] ;",
      "133:         if (!$page_id) {",
      "134:             $this->sendError(10103,\"\u8bf7\u81f3\u5c11\u5148\u4fdd\u5b58\u4e00\u6b21\u9875\u9762\u5185\u5bb9\");",
      "135:             return;",
      "136:         }",
      "137:         if (!$this->checkItemPermn($login_user['uid'] , $item_id)) {",
      "138:             $this->sendError(10103);",
      "139:             return;",
      "140:         }",
      "142:         if (!$uploadFile) {",
      "143:            return false;",
      "144:         }",
      "146:         if (strstr(strip_tags(strtolower($uploadFile['name'])), \".php\") ) {",
      "147:             return false;",
      "148:         }",
      "150:         $oss_open = D(\"Options\")->get(\"oss_open\" ) ;",
      "151:         if ($oss_open) {",
      "152:             $url = upload_oss($uploadFile);",
      "153:             if ($url) {",
      "154:                 $sign = md5($url.time().rand()) ;",
      "155:                 $insert = array(",
      "156:                 \"sign\" => $sign,",
      "157:                 \"uid\" => $login_user['uid'],",
      "158:                 \"item_id\" => $item_id,",
      "159:                 \"page_id\" => $page_id,",
      "160:                 \"display_name\" => $uploadFile['name'],",
      "161:                 \"file_type\" => $uploadFile['type'],",
      "162:                 \"file_size\" => $uploadFile['size'],",
      "163:                 \"real_url\" => $url,",
      "164:                 \"addtime\" => time(),",
      "165:                 );",
      "166:                 $ret = D(\"UploadFile\")->add($insert);",
      "167:                 $url = get_domain().U(\"api/attachment/visitFile\",array(\"sign\" => $sign));",
      "168:                 echo json_encode(array(\"url\"=>$url,\"success\"=>1));",
      "169:             }",
      "170:             return ;",
      "171:         }",
      "173:         $upload = new \\Think\\Upload();// \u5b9e\u4f8b\u5316\u4e0a\u4f20\u7c7b",
      "174:         $upload->maxSize  = 4145728000 ;// \u8bbe\u7f6e\u9644\u4ef6\u4e0a\u4f20\u5927\u5c0f",
      "175:         $upload->rootPath = './../Public/Uploads/';// \u8bbe\u7f6e\u9644\u4ef6\u4e0a\u4f20\u76ee\u5f55",
      "176:         $upload->savePath = '';// \u8bbe\u7f6e\u9644\u4ef6\u4e0a\u4f20\u5b50\u76ee\u5f55",
      "177:         $info = $upload->uploadOne($uploadFile) ;",
      "178:         if(!$info) {// \u4e0a\u4f20\u9519\u8bef\u63d0\u793a\u9519\u8bef\u4fe1\u606f",
      "179:           $this->error($upload->getError());",
      "180:           return;",
      "181:         }else{// \u4e0a\u4f20\u6210\u529f \u83b7\u53d6\u4e0a\u4f20\u6587\u4ef6\u4fe1\u606f",
      "182:           $url = get_domain().__ROOT__.substr($upload->rootPath,1).$info['savepath'].$info['savename'] ;",
      "183:           $sign = md5($url.time().rand()) ;",
      "184:           $insert = array(",
      "185:             \"sign\" => $sign,",
      "186:             \"uid\" => $login_user['uid'],",
      "187:             \"item_id\" => $item_id,",
      "188:             \"page_id\" => $page_id,",
      "189:             \"display_name\" => $uploadFile['name'],",
      "190:             \"file_type\" => $uploadFile['type'],",
      "191:             \"file_size\" => $uploadFile['size'],",
      "192:             \"real_url\" => $url,",
      "193:             \"addtime\" => time(),",
      "194:             );",
      "195:           $ret = D(\"UploadFile\")->add($insert);",
      "196:           $url = get_domain().U(\"api/attachment/visitFile\",array(\"sign\" => $sign));",
      "197:           echo json_encode(array(\"url\"=>$url,\"success\"=>1));",
      "198:         }",
      "200:     }",
      "202:     public function pageAttachmentUploadList(){",
      "203:         $login_user = $this->checkLogin();",
      "204:         $item_id = I(\"item_id/d\") ? I(\"item_id/d\") : 0 ;",
      "205:         $page_id = I(\"page_id/d\") ? I(\"page_id/d\") : 0 ;",
      "206:         if (!$page_id) {",
      "207:             $this->sendError(10103,\"\u8bf7\u81f3\u5c11\u5148\u4fdd\u5b58\u4e00\u6b21\u9875\u9762\u5185\u5bb9\");",
      "208:             return;",
      "209:         }",
      "210:         $return = array() ;",
      "211:         $files = D(\"UploadFile\")->where(\"page_id = '$page_id' \")->order(\"addtime desc\")->select();",
      "212:         if ($files) {",
      "213:             $item_id = $files[0]['item_id'] ;",
      "214:             if (!$this->checkItemVisit($login_user['uid'] , $item_id)) {",
      "215:                 $this->sendError(10103);",
      "216:                 return;",
      "217:             }",
      "218:             foreach ($files as $key => $value) {",
      "219:                 $return[] = array(",
      "220:                     \"file_id\"=>$value['file_id'],",
      "221:                     \"display_name\"=>$value['display_name'],",
      "222:                     \"url\"=>get_domain().U(\"api/attachment/visitFile\",array(\"sign\" => $value['sign'])),",
      "223:                     \"addtime\"=> date(\"Y-m-d H:i:s\" , $value['addtime'] ),",
      "224:                     );",
      "225:             }",
      "227:         }",
      "228:         $this->sendResult($return);",
      "230:     }",
      "233:     public function deletePageUploadFile(){",
      "234:         $login_user = $this->checkLogin();",
      "235:         $file_id = I(\"file_id/d\") ? I(\"file_id/d\") : 0 ;",
      "237:         $file = D(\"UploadFile\")->where(\"file_id = '$file_id' \")->find();",
      "238:         $item_id = $file['item_id'] ;",
      "239:         if (!$this->checkItemPermn($login_user['uid'] , $item_id)) {",
      "240:             $this->sendError(10103);",
      "241:             return;",
      "242:         }",
      "243:         $ret = D(\"Page\")->deleteFile($file_id);",
      "244:         if ($ret) {",
      "245:             $this->sendResult(array());",
      "246:         }else{",
      "247:             $this->sendError(10101,\"\u5220\u9664\u5931\u8d25\");",
      "248:         }",
      "249:     }",
      "252:     public function getAllList(){",
      "253:         $login_user = $this->checkLogin();",
      "254:         $this->checkAdmin(); //\u91cd\u8981\uff0c\u6821\u9a8c\u7ba1\u7406\u5458\u8eab\u4efd",
      "255:         $page = I(\"page/d\");",
      "256:         $count = I(\"count/d\");",
      "257:         $attachment_type = I(\"attachment_type/d\");",
      "258:         $display_name = I(\"display_name\");",
      "259:         $username = I(\"username\");",
      "260:         $return = array() ;",
      "261:         $where = ' 1 = 1 ';",
      "262:         if($attachment_type == 1 ){",
      "263:             $where .=\" and file_type like '%image%' \" ;",
      "264:         }",
      "265:         if($attachment_type == 2 ){",
      "266:             $where .=\" and file_type not like '%image%' \" ;",
      "267:         }",
      "268:         if($display_name){",
      "269:             $display_name =  \\SQLite3::escapeString($display_name) ;",
      "270:             $where .=\" and display_name  like '%{$display_name}%' \" ;",
      "271:         }",
      "272:         if($username){",
      "273:             $username =  \\SQLite3::escapeString($username) ;",
      "274:             $uid = D(\"User\")->where(\" username = '{$username}' \")->getField('uid') ;",
      "275:             $uid = $uid ? $uid  : -99 ;",
      "276:             $where .=\" and uid  = '{$uid}' \" ;",
      "277:         }",
      "278:         $files = D(\"UploadFile\")->where($where)->order(\"addtime desc\")->page($page ,$count)->select();",
      "279:         if ($files) {",
      "280:             foreach ($files as $key => $value) {",
      "281:                 $username = '';",
      "282:                 if($value['uid']){",
      "283:                     $username = D(\"User\")->where(\" uid = {$value['uid']} \")->getField('username') ;",
      "284:                 }",
      "285:                 $return['list'][] = array(",
      "286:                     \"file_id\"=>$value['file_id'],",
      "287:                     \"username\"=>$username,",
      "288:                     \"uid\"=>$value['uid'],",
      "289:                     \"file_type\"=>$value['file_type'],",
      "290:                     \"visit_times\"=>$value['visit_times'],",
      "291:                     \"file_size\"=>$value['file_size'],",
      "292:                     \"item_id\"=>$value['item_id'],",
      "293:                     \"page_id\"=>$value['page_id'],",
      "294:                     \"file_size_m\"=>round( $value['file_size']/(1024*1024),3),",
      "295:                     \"display_name\"=>$value['display_name']?$value['display_name']:'',",
      "296:                     \"url\"=>get_domain().U(\"api/attachment/visitFile\",array(\"sign\" => $value['sign'])),",
      "297:                     \"addtime\"=> date(\"Y-m-d H:i:s\" , $value['addtime'] ),",
      "298:                     \"last_visit_time\"=> date(\"Y-m-d H:i:s\" , $value['last_visit_time'] ),",
      "299:                     );",
      "300:             }",
      "302:         }",
      "303:         $return['total'] = D(\"UploadFile\")->where($where)->count();",
      "304:         $used = D(\"UploadFile\")->where($where)->getField('sum(file_size)');",
      "305:         $return['used'] = $used ;",
      "306:         $return['used_m'] = round( $used/(1024*1024),3) ;",
      "307:         $this->sendResult($return);",
      "308:     }",
      "311:     public function deleteAttachment(){",
      "312:         $login_user = $this->checkLogin();",
      "313:         $this->checkAdmin(); //\u91cd\u8981\uff0c\u6821\u9a8c\u7ba1\u7406\u5458\u8eab\u4efd",
      "314:         $file_id = I(\"file_id/d\") ? I(\"file_id/d\") : 0 ;",
      "316:         $file = D(\"UploadFile\")->where(\"file_id = '$file_id' \")->find();",
      "318:         $ret = D(\"Page\")->deleteFile($file_id);",
      "319:         if ($ret) {",
      "320:             $this->sendResult(array());",
      "321:         }else{",
      "322:             $this->sendError(10101,\"\u5220\u9664\u5931\u8d25\");",
      "323:         }",
      "324:     }",
      "327:     public function getMyList(){",
      "328:         $login_user = $this->checkLogin();",
      "329:         $page = I(\"page/d\");",
      "330:         $count = I(\"count/d\");",
      "331:         $attachment_type = I(\"attachment_type/d\");",
      "332:         $display_name = I(\"display_name\");",
      "333:         $username = I(\"username\");",
      "334:         $return = array() ;",
      "335:         $where = \" uid  = '{$login_user[uid]}' \";",
      "336:         if($attachment_type == 1 ){",
      "337:             $where .=\" and file_type like '%image%' \" ;",
      "338:         }",
      "339:         if($attachment_type == 2 ){",
      "340:             $where .=\" and file_type not like '%image%' \" ;",
      "341:         }",
      "342:         if($display_name){",
      "343:             $display_name =  \\SQLite3::escapeString($display_name) ;",
      "344:             $where .=\" and display_name  like '%{$display_name}%' \" ;",
      "345:         }",
      "346:         $files = D(\"UploadFile\")->where($where)->order(\"addtime desc\")->page($page ,$count)->select();",
      "347:         if ($files) {",
      "348:             foreach ($files as $key => $value) {",
      "349:                 $username = '';",
      "350:                 $return['list'][] = array(",
      "351:                     \"file_id\"=>$value['file_id'],",
      "352:                     \"uid\"=>$value['uid'],",
      "353:                     \"file_type\"=>$value['file_type'],",
      "354:                     \"visit_times\"=>$value['visit_times'],",
      "355:                     \"file_size\"=>$value['file_size'],",
      "356:                     \"item_id\"=>$value['item_id'],",
      "357:                     \"page_id\"=>$value['page_id'],",
      "358:                     \"file_size_m\"=>round( $value['file_size']/(1024*1024),3),",
      "359:                     \"display_name\"=>$value['display_name']?$value['display_name']:'',",
      "360:                     \"url\"=>get_domain().U(\"api/attachment/visitFile\",array(\"sign\" => $value['sign'])),",
      "361:                     \"addtime\"=> date(\"Y-m-d H:i:s\" , $value['addtime'] ),",
      "362:                     \"last_visit_time\"=> date(\"Y-m-d H:i:s\" , $value['last_visit_time'] ),",
      "363:                     );",
      "364:             }",
      "366:         }",
      "367:         $return['total'] = D(\"UploadFile\")->where($where)->count();",
      "368:         $used = D(\"UploadFile\")->where($where)->getField('sum(file_size)');",
      "369:         $return['used'] = $used ;",
      "370:         $return['used_m'] = round( $used/(1024*1024),3) ;",
      "371:         $used_flow =  D(\"Attachment\")->getUserFlow($login_user['uid']) ; ; //\u8be5\u7528\u6237\u7684\u672c\u6708\u4f7f\u7528\u6d41\u91cf",
      "372:         $return['used_flow_m'] = round( $used_flow/(1024*1024),3) ;",
      "374:         $this->sendResult($return);",
      "375:     }",
      "378:     public function deleteMyAttachment(){",
      "379:         $login_user = $this->checkLogin();",
      "380:         $file_id = I(\"file_id/d\") ? I(\"file_id/d\") : 0 ;",
      "382:         $file = D(\"UploadFile\")->where(\"file_id = '$file_id' and uid ='$login_user[uid]' \")->find();",
      "384:         if($file){",
      "385:             $ret = D(\"Page\")->deleteFile($file_id);",
      "386:             if ($ret) {",
      "387:                 $this->sendResult(array());",
      "388:                 return ;",
      "389:             }",
      "390:         }",
      "391:         $this->sendError(10101,\"\u5220\u9664\u5931\u8d25\");",
      "392:     }",
      "394: }",
      "",
      "---------------"
    ],
    "server/Application/Api/Controller/CommonController.class.php||server/Application/Api/Controller/CommonController.class.php": [
      "File: server/Application/Api/Controller/CommonController.class.php -> server/Application/Api/Controller/CommonController.class.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "95:       $json = json_decode($file , 1 );",
      "96:       $this->sendResult(array(\"version\"=>$json['version']));",
      "97:     }",
      "99: }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "100:     public function visitFile(){",
      "101:        R(\"Attachment/visitFile\");",
      "102:     }",
      "",
      "---------------"
    ],
    "server/Application/Api/Controller/PageController.class.php||server/Application/Api/Controller/PageController.class.php": [
      "File: server/Application/Api/Controller/PageController.class.php -> server/Application/Api/Controller/PageController.class.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "212:     public function uploadImg(){",
      "254:     }",
      "257:     public function upload(){",
      "325:     }",
      "327:     public function uploadList(){",
      "355:     }",
      "358:     public function deleteUploadFile(){",
      "374:     }",
      "",
      "[Removed Lines]",
      "213:         $login_user = $this->checkLogin();",
      "214:         $item_id = I(\"item_id/d\") ? I(\"item_id/d\") : 0 ;",
      "215:         $page_id = I(\"page_id/d\") ? I(\"page_id/d\") : 0 ;",
      "218:         if ($_FILES['editormd-image-file']['name'] == 'blob') {",
      "219:             $_FILES['editormd-image-file']['name'] .= '.jpg';",
      "220:         }",
      "222:         if (!$_FILES['editormd-image-file']) {",
      "223:            return false;",
      "224:         }",
      "226:         if (strstr(strip_tags(strtolower($_FILES['editormd-image-file']['name'])), \".php\") ) {",
      "227:             return false;",
      "228:         }",
      "230:         $oss_open = D(\"Options\")->get(\"oss_open\" ) ;",
      "231:         if ($oss_open) {",
      "232:             $uploadFile = $_FILES['editormd-image-file'] ;",
      "233:             $url = upload_oss($uploadFile);",
      "234:             if ($url) {",
      "235:                 echo json_encode(array(\"url\"=>$url,\"success\"=>1));",
      "236:             }",
      "237:             return ;",
      "238:         }",
      "240:         $upload = new \\Think\\Upload();// \u5b9e\u4f8b\u5316\u4e0a\u4f20\u7c7b",
      "241:         $upload->maxSize  = 1003145728 ;// \u8bbe\u7f6e\u9644\u4ef6\u4e0a\u4f20\u5927\u5c0f",
      "242:         $upload->allowExts  = array('jpg', 'gif', 'png', 'jpeg');// \u8bbe\u7f6e\u9644\u4ef6\u4e0a\u4f20\u7c7b\u578b",
      "243:         $upload->rootPath = './../Public/Uploads/';// \u8bbe\u7f6e\u9644\u4ef6\u4e0a\u4f20\u76ee\u5f55",
      "244:         $upload->savePath = '';// \u8bbe\u7f6e\u9644\u4ef6\u4e0a\u4f20\u5b50\u76ee\u5f55",
      "245:         $info = $upload->uploadOne($_FILES['editormd-image-file']) ;",
      "246:         if(!$info) {// \u4e0a\u4f20\u9519\u8bef\u63d0\u793a\u9519\u8bef\u4fe1\u606f",
      "247:           $this->error($upload->getError());",
      "248:           return;",
      "249:         }else{// \u4e0a\u4f20\u6210\u529f \u83b7\u53d6\u4e0a\u4f20\u6587\u4ef6\u4fe1\u606f",
      "250:           $url = get_domain().__ROOT__.substr($upload->rootPath,1).$info['savepath'].$info['savename'] ;",
      "251:           echo json_encode(array(\"url\"=>$url,\"success\"=>1));",
      "252:         }",
      "258:         $login_user = $this->checkLogin();",
      "259:         $item_id = I(\"item_id/d\") ? I(\"item_id/d\") : 0 ;",
      "260:         $page_id = I(\"page_id/d\") ? I(\"page_id/d\") : 0 ;",
      "261:         $uploadFile = $_FILES['file'] ;",
      "263:         if (!$page_id) {",
      "264:             $this->sendError(10103,\"\u8bf7\u81f3\u5c11\u5148\u4fdd\u5b58\u4e00\u6b21\u9875\u9762\u5185\u5bb9\");",
      "265:             return;",
      "266:         }",
      "267:         if (!$this->checkItemPermn($login_user['uid'] , $item_id)) {",
      "268:             $this->sendError(10103);",
      "269:             return;",
      "270:         }",
      "272:         if (!$uploadFile) {",
      "273:            return false;",
      "274:         }",
      "276:         if (strstr(strip_tags(strtolower($uploadFile['name'])), \".php\") ) {",
      "277:             return false;",
      "278:         }",
      "280:         $oss_open = D(\"Options\")->get(\"oss_open\" ) ;",
      "281:         if ($oss_open) {",
      "282:             $url = upload_oss($uploadFile);",
      "283:             if ($url) {",
      "284:                 $insert = array(",
      "285:                 \"uid\" => $login_user['uid'],",
      "286:                 \"item_id\" => $item_id,",
      "287:                 \"page_id\" => $page_id,",
      "288:                 \"display_name\" => $uploadFile['name'],",
      "289:                 \"file_type\" => $uploadFile['type'],",
      "290:                 \"file_size\" => $uploadFile['size'],",
      "291:                 \"real_url\" => $url,",
      "292:                 \"addtime\" => time(),",
      "293:                 );",
      "294:                 $ret = D(\"UploadFile\")->add($insert);",
      "295:                 echo json_encode(array(\"url\"=>$url,\"success\"=>1));",
      "296:             }",
      "297:             return ;",
      "298:         }",
      "300:         $upload = new \\Think\\Upload();// \u5b9e\u4f8b\u5316\u4e0a\u4f20\u7c7b",
      "301:         $upload->maxSize  = 4145728000 ;// \u8bbe\u7f6e\u9644\u4ef6\u4e0a\u4f20\u5927\u5c0f",
      "302:         $upload->rootPath = './../Public/Uploads/';// \u8bbe\u7f6e\u9644\u4ef6\u4e0a\u4f20\u76ee\u5f55",
      "303:         $upload->savePath = '';// \u8bbe\u7f6e\u9644\u4ef6\u4e0a\u4f20\u5b50\u76ee\u5f55",
      "304:         $info = $upload->uploadOne($uploadFile) ;",
      "305:         if(!$info) {// \u4e0a\u4f20\u9519\u8bef\u63d0\u793a\u9519\u8bef\u4fe1\u606f",
      "306:           $this->error($upload->getError());",
      "307:           return;",
      "308:         }else{// \u4e0a\u4f20\u6210\u529f \u83b7\u53d6\u4e0a\u4f20\u6587\u4ef6\u4fe1\u606f",
      "309:           $url = get_domain().__ROOT__.substr($upload->rootPath,1).$info['savepath'].$info['savename'] ;",
      "310:           $insert = array(",
      "311:             \"uid\" => $login_user['uid'],",
      "312:             \"item_id\" => $item_id,",
      "313:             \"page_id\" => $page_id,",
      "314:             \"display_name\" => $uploadFile['name'],",
      "315:             \"file_type\" => $uploadFile['type'],",
      "316:             \"file_size\" => $uploadFile['size'],",
      "317:             \"real_url\" => $url,",
      "318:             \"addtime\" => time(),",
      "319:             );",
      "320:           $ret = D(\"UploadFile\")->add($insert);",
      "322:           echo json_encode(array(\"url\"=>$url,\"success\"=>1));",
      "323:         }",
      "328:         $login_user = $this->checkLogin();",
      "329:         $item_id = I(\"item_id/d\") ? I(\"item_id/d\") : 0 ;",
      "330:         $page_id = I(\"page_id/d\") ? I(\"page_id/d\") : 0 ;",
      "331:         if (!$page_id) {",
      "332:             $this->sendError(10103,\"\u8bf7\u81f3\u5c11\u5148\u4fdd\u5b58\u4e00\u6b21\u9875\u9762\u5185\u5bb9\");",
      "333:             return;",
      "334:         }",
      "335:         $return = array() ;",
      "336:         $files = D(\"UploadFile\")->where(\"page_id = '$page_id' \")->order(\"addtime desc\")->select();",
      "337:         if ($files) {",
      "338:             $item_id = $files[0]['item_id'] ;",
      "339:             if (!$this->checkItemVisit($login_user['uid'] , $item_id)) {",
      "340:                 $this->sendError(10103);",
      "341:                 return;",
      "342:             }",
      "343:             foreach ($files as $key => $value) {",
      "344:                 $return[] = array(",
      "345:                     \"file_id\"=>$value['file_id'],",
      "346:                     \"display_name\"=>$value['display_name'],",
      "347:                     \"url\"=>$value['real_url'],",
      "348:                     \"addtime\"=> date(\"Y-m-d H:i:s\" , $value['addtime'] ),",
      "349:                     );",
      "350:             }",
      "352:         }",
      "353:         $this->sendResult($return);",
      "359:         $login_user = $this->checkLogin();",
      "360:         $file_id = I(\"file_id/d\") ? I(\"file_id/d\") : 0 ;",
      "362:         $file = D(\"UploadFile\")->where(\"file_id = '$file_id' \")->find();",
      "363:         $item_id = $file['item_id'] ;",
      "364:         if (!$this->checkItemPermn($login_user['uid'] , $item_id)) {",
      "365:             $this->sendError(10103);",
      "366:             return;",
      "367:         }",
      "368:         $ret = D(\"Page\")->deleteFile($file_id);",
      "369:         if ($ret) {",
      "370:             $this->sendResult(array());",
      "371:         }else{",
      "372:             $this->sendError(10101,\"\u5220\u9664\u5931\u8d25\");",
      "373:         }",
      "",
      "[Added Lines]",
      "214:         R(\"Attachment/uploadImg\");",
      "220:         R(\"Attachment/pageAttachmentUpload\");",
      "225:         R(\"Attachment/pageAttachmentUploadList\");",
      "231:         R(\"Attachment/deletePageUploadFile\");",
      "",
      "---------------"
    ],
    "server/Application/Api/Controller/UpdateController.class.php||server/Application/Api/Controller/UpdateController.class.php": [
      "File: server/Application/Api/Controller/UpdateController.class.php -> server/Application/Api/Controller/UpdateController.class.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "274:             )\";",
      "275:         D(\"User\")->execute($sql);",
      "278:         return true ;",
      "279:     }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "278:         $sql = \"CREATE TABLE IF NOT EXISTS `file_flow` (",
      "279:             `id`  INTEGER PRIMARY KEY ,",
      "280:             `uid` int(11) NOT NULL DEFAULT '0',",
      "281:             `used` int(11) NOT NULL DEFAULT '0',",
      "282:             `date_month` CHAR(2000) NOT NULL DEFAULT ''",
      "283:             )\";",
      "284:         D(\"User\")->execute($sql);",
      "",
      "---------------"
    ],
    "server/Application/Api/Model/AttachmentModel.class.php||server/Application/Api/Model/AttachmentModel.class.php": [
      "File: server/Application/Api/Model/AttachmentModel.class.php -> server/Application/Api/Model/AttachmentModel.class.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: <?php",
      "2: namespace Api\\Model;",
      "3: use Api\\Model\\BaseModel;",
      "8: class AttachmentModel extends BaseModel {",
      "10:  Protected $autoCheckFields = false;  //\u4e00\u5b9a\u8981\u5173\u95ed\u5b57\u6bb5\u7f13\u5b58\uff0c\u4e0d\u7136\u4f1a\u62a5\u627e\u4e0d\u5230\u8868\u7684\u9519\u8bef",
      "13:  public function getUserFlow($uid){",
      "14:   $month = Date(\"Y-m\") ;",
      "15:   $file_flow = D(\"FileFlow\")->where(\" uid = '%s'  and date_month = '$month' \" , array($uid))->find() ;",
      "16:   if($file_flow){",
      "17:    return intval($file_flow['used']) ;",
      "18:   }else{",
      "19:    D(\"FileFlow\")->add(array(",
      "20:     \"uid\" => $uid ,",
      "21:     \"used\" => 0  ,",
      "22:     \"date_month\" => $month ,",
      "24:    ));",
      "25:    return 0 ;",
      "26:   }",
      "27:  }",
      "30:  public function recordUserFlow($uid , $file_size){",
      "31:   $month = Date(\"Y-m\") ;",
      "32:   $used = $this->getUserFlow($uid) ;",
      "33:   return D(\"FileFlow\")->where(\" uid = '%s'  and date_month = '$month' \" , array($uid))->save(array(",
      "34:    \"used\" => $used + intval($file_size)",
      "35:   ));",
      "36:  }",
      "38:  public function deleteFile($file_id){",
      "40:   $file = D(\"UploadFile\")->where(\"file_id = '$file_id' \")->find();",
      "41:   $real_url = $file['real_url'] ;",
      "42:   $array = explode(\"/Public/Uploads/\", $real_url) ;",
      "43:   $file_path = \"../Public/Uploads/\".$array[1] ;",
      "44:   if (file_exists($file_path)) {",
      "45:    @unlink($file_path);",
      "46:   }",
      "47:   D(\"UploadFile\")->where(\" file_id = '$file_id' \")->delete();",
      "48:   return true ;",
      "50:  }",
      "52: }",
      "",
      "---------------"
    ],
    "server/Application/Api/Model/PageModel.class.php||server/Application/Api/Model/PageModel.class.php": [
      "File: server/Application/Api/Model/PageModel.class.php -> server/Application/Api/Model/PageModel.class.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "148:    }",
      "150:    public function deleteFile($file_id){",
      "160:     }",
      "162: }",
      "",
      "[Removed Lines]",
      "151:       $file = D(\"UploadFile\")->where(\"file_id = '$file_id' \")->find();",
      "152:       $real_url = $file['real_url'] ;",
      "153:       $array = explode(\"/Public/Uploads/\", $real_url) ;",
      "154:       $file_path = \"../Public/Uploads/\".$array[1] ;",
      "155:       if (file_exists($file_path)) {",
      "156:         unlink($file_path);",
      "157:       }",
      "158:       D(\"UploadFile\")->where(\" file_id = '$file_id' \")->delete();",
      "159:       return true ;",
      "",
      "[Added Lines]",
      "151:         return D(\"Attachment\")->deleteFile($file_id) ;",
      "",
      "---------------"
    ],
    "web_src/src/components/admin/Index.vue||web_src/src/components/admin/Index.vue": [
      "File: web_src/src/components/admin/Index.vue -> web_src/src/components/admin/Index.vue",
      "--- Hunk 1 ---",
      "[Context before]",
      "23:               <i class=\"el-icon-tickets\"></i>",
      "24:               <span slot=\"title\">{{$t('item_manage')}}</span>",
      "25:             </el-menu-item>",
      "26:             <el-menu-item index=\"3\">",
      "27:               <i class=\"el-icon-tickets\"></i>",
      "28:               <span slot=\"title\">{{$t('web_setting')}}</span>",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "26:             <el-menu-item index=\"5\">",
      "27:               <i class=\"el-icon-tickets\"></i>",
      "28:               <span slot=\"title\">{{$t('attachment_manage')}}</span>",
      "29:             </el-menu-item>",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "34:             <User v-if=\"open_menu_index == 1 \"></User>",
      "35:             <Item v-if=\"open_menu_index == 2 \"></Item>",
      "36:             <Setting v-if=\"open_menu_index == 3 \"></Setting>",
      "37:           </el-main>",
      "38:           <el-footer>",
      "39:             <!-- something -->",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "41:             <Attachment v-if=\"open_menu_index == 5 \"></Attachment>",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "113: import Item from '@/components/admin/item/Index'",
      "114: import User from '@/components/admin/user/Index'",
      "115: import Setting from '@/components/admin/setting/Index'",
      "117: export default {",
      "118:   data() {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "121: import Attachment from '@/components/admin/attachment/Index'",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "123:   components: {",
      "124:     Item,",
      "125:     User,",
      "127:   },",
      "128:   methods: {",
      "129:     select_menu(index, indexPath) {",
      "",
      "[Removed Lines]",
      "126:     Setting",
      "",
      "[Added Lines]",
      "132:     Setting,",
      "133:     Attachment",
      "",
      "---------------"
    ],
    "web_src/src/components/admin/attachment/Index.vue||web_src/src/components/admin/attachment/Index.vue": [
      "File: web_src/src/components/admin/attachment/Index.vue -> web_src/src/components/admin/attachment/Index.vue",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: <template>",
      "2:   <div class=\"hello\">",
      "3:     <el-form :inline=\"true\" class=\"demo-form-inline\">",
      "4:       <el-form-item label>",
      "5:         <el-input v-model=\"display_name\" :placeholder=\"$t('display_name')\"></el-input>",
      "6:       </el-form-item>",
      "7:       <el-form-item label>",
      "8:         <el-select v-model=\"attachment_type\" placeholder>",
      "9:           <el-option :label=\"$t('all_attachment_type')\" value=\"-1\"></el-option>",
      "10:           <el-option :label=\"$t('image')\" value=\"1\"></el-option>",
      "11:           <el-option :label=\"$t('general_attachment')\" value=\"2\"></el-option>",
      "12:         </el-select>",
      "13:       </el-form-item>",
      "14:       <el-form-item label>",
      "15:         <el-input v-model=\"username\" :placeholder=\"$t('uploader')\"></el-input>",
      "16:       </el-form-item>",
      "17:       <el-form-item>",
      "18:         <el-button @click=\"onSubmit\">{{$t('search')}}</el-button>",
      "19:       </el-form-item>",
      "20:     </el-form>",
      "21:     <P>\u7d2f\u8ba1\u5df2\u4f7f\u7528 {{used}}M \u7a7a\u95f4</P>",
      "22:     <el-table :data=\"dataList\" style=\"width: 100%\">",
      "23:       <el-table-column prop=\"file_id\" :label=\"$t('file_id')\"></el-table-column>",
      "24:       <el-table-column prop=\"display_name\" :label=\"$t('display_name')\"></el-table-column>",
      "25:       <el-table-column prop=\"file_type\" :label=\"$t('file_type')\" width=\"140\"></el-table-column>",
      "26:       <el-table-column prop=\"file_size_m\" :label=\"$t('file_size_m')\" width=\"140\"></el-table-column>",
      "27:       <el-table-column prop=\"visit_times\" :label=\"$t('visit_times')\"></el-table-column>",
      "28:       <el-table-column prop=\"username\" :label=\"$t('uploader')\"></el-table-column>",
      "29:       <el-table-column prop=\"addtime\" :label=\"$t('add_time')\" width=\"160\"></el-table-column>",
      "30:       <el-table-column prop :label=\"operation\">",
      "31:         <template slot-scope=\"scope\">",
      "32:           <el-button @click=\"visit(scope.row)\" type=\"text\" size=\"small\">{{$t('visit')}}</el-button>",
      "33:           <el-button @click=\"delete_row(scope.row)\" type=\"text\" size=\"small\">{{$t('delete')}}</el-button>",
      "34:         </template>",
      "35:       </el-table-column>",
      "36:     </el-table>",
      "38:     <div class=\"block\">",
      "39:       <span class=\"demonstration\"></span>",
      "40:       <el-pagination",
      "41:         @current-change=\"handleCurrentChange\"",
      "42:         :page-size=\"count\"",
      "43:         layout=\"total, prev, pager, next\"",
      "44:         :total=\"total\"",
      "45:       ></el-pagination>",
      "46:     </div>",
      "47:   </div>",
      "48: </template>",
      "50: <style scoped>",
      "51: </style>",
      "53: <script>",
      "54: export default {",
      "55:   data() {",
      "56:     return {",
      "57:       page: 1,",
      "58:       count: 7,",
      "59:       display_name: '',",
      "60:       username: '',",
      "61:       dataList: [],",
      "62:       total: 0,",
      "63:       positive_type: '1',",
      "64:       attachment_type: '-1',",
      "65:       used: 0",
      "66:     }",
      "67:   },",
      "68:   methods: {",
      "69:     getList() {",
      "70:       this.request('/api/attachment/getAllList', {",
      "71:         page: this.page,",
      "72:         count: this.count,",
      "73:         attachment_type: this.attachment_type,",
      "74:         display_name: this.display_name,",
      "75:         username: this.username",
      "76:       }).then(data => {",
      "77:         var json = data.data",
      "78:         this.dataList = json.list",
      "79:         this.total = parseInt(json.total)",
      "80:         this.used = json.used_m",
      "81:       })",
      "82:     },",
      "84:     jump_to_item(row) {",
      "85:       let url = '/' + row.item_id",
      "86:       window.open(url)",
      "87:     },",
      "88:     handleCurrentChange(currentPage) {",
      "89:       this.page = currentPage",
      "90:       this.getList()",
      "91:     },",
      "92:     onSubmit() {",
      "93:       this.page = 1",
      "94:       this.getList()",
      "95:     },",
      "96:     visit(row) {",
      "97:       window.open(row.url)",
      "98:     },",
      "99:     delete_row(row) {",
      "100:       this.$confirm(this.$t('confirm_delete'), ' ', {",
      "101:         confirmButtonText: this.$t('confirm'),",
      "102:         cancelButtonText: this.$t('cancel'),",
      "103:         type: 'warning'",
      "104:       }).then(() => {",
      "105:         this.request('/api/attachment/deleteAttachment', {",
      "106:           file_id: row.file_id",
      "107:         }).then(data => {",
      "108:           this.$message.success(this.$t('op_success'))",
      "109:           this.getList()",
      "110:         })",
      "111:       })",
      "112:     }",
      "113:   },",
      "114:   mounted() {",
      "115:     this.getList()",
      "116:   },",
      "117:   beforeDestroy() {",
      "118:     this.$message.closeAll()",
      "119:   }",
      "120: }",
      "121: </script>",
      "",
      "---------------"
    ],
    "web_src/src/components/attachment/Index.vue||web_src/src/components/attachment/Index.vue": [
      "File: web_src/src/components/attachment/Index.vue -> web_src/src/components/attachment/Index.vue",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: <template>",
      "2:   <div class=\"hello\">",
      "3:     <Header></Header>",
      "5:     <el-container>",
      "6:       <el-card class=\"hor-center-card\">",
      "7:         <el-button type=\"text\" @click=\"goback\" class=\"goback-btn\">",
      "8:           <i class=\"el-icon-back\"></i>",
      "9:         </el-button>",
      "10:         <el-form :inline=\"true\" class=\"demo-form-inline\">",
      "11:           <el-form-item label>",
      "12:             <el-input v-model=\"display_name\" :placeholder=\"$t('display_name')\"></el-input>",
      "13:           </el-form-item>",
      "14:           <el-form-item label>",
      "15:             <el-select v-model=\"attachment_type\" placeholder>",
      "16:               <el-option :label=\"$t('all_attachment_type')\" value=\"-1\"></el-option>",
      "17:               <el-option :label=\"$t('image')\" value=\"1\"></el-option>",
      "18:               <el-option :label=\"$t('general_attachment')\" value=\"2\"></el-option>",
      "19:             </el-select>",
      "20:           </el-form-item>",
      "21:           <el-form-item>",
      "22:             <el-button @click=\"onSubmit\">{{$t('search')}}</el-button>",
      "23:           </el-form-item>",
      "24:         </el-form>",
      "25:         <P>{{$t('accumulated_used_sapce')}} {{used}}M , {{$t('month_flow')}} {{used_flow}}M</P>",
      "26:         <el-table :data=\"dataList\" style=\"width: 100%\">",
      "27:           <el-table-column prop=\"file_id\" :label=\"$t('file_id')\"></el-table-column>",
      "28:           <el-table-column prop=\"display_name\" :label=\"$t('display_name')\"></el-table-column>",
      "29:           <el-table-column prop=\"file_type\" :label=\"$t('file_type')\" width=\"160\"></el-table-column>",
      "30:           <el-table-column prop=\"file_size_m\" :label=\"$t('file_size_m')\" width=\"160\"></el-table-column>",
      "31:           <el-table-column prop=\"visit_times\" :label=\"$t('visit_times')\"></el-table-column>",
      "32:           <el-table-column prop=\"addtime\" :label=\"$t('add_time')\" width=\"160\"></el-table-column>",
      "33:           <el-table-column prop :label=\"operation\">",
      "34:             <template slot-scope=\"scope\">",
      "35:               <el-button @click=\"visit(scope.row)\" type=\"text\" size=\"small\">{{$t('visit')}}</el-button>",
      "36:               <el-button @click=\"delete_row(scope.row)\" type=\"text\" size=\"small\">{{$t('delete')}}</el-button>",
      "37:             </template>",
      "38:           </el-table-column>",
      "39:         </el-table>",
      "41:         <div class=\"block\">",
      "42:           <span class=\"demonstration\"></span>",
      "43:           <el-pagination",
      "44:             @current-change=\"handleCurrentChange\"",
      "45:             :page-size=\"count\"",
      "46:             layout=\"total, prev, pager, next\"",
      "47:             :total=\"total\"",
      "48:           ></el-pagination>",
      "49:         </div>",
      "50:       </el-card>",
      "51:     </el-container>",
      "53:     <Footer></Footer>",
      "54:   </div>",
      "55: </template>",
      "57: <script>",
      "58: export default {",
      "59:   name: '',",
      "60:   components: {},",
      "61:   data() {",
      "62:     return {",
      "63:       page: 1,",
      "64:       count: 6,",
      "65:       display_name: '',",
      "66:       username: '',",
      "67:       dataList: [],",
      "68:       total: 0,",
      "69:       positive_type: '1',",
      "70:       attachment_type: '-1',",
      "71:       used: 0,",
      "72:       used_flow: 0",
      "73:     }",
      "74:   },",
      "75:   methods: {",
      "76:     getList() {",
      "77:       this.request('/api/attachment/getMyList', {",
      "78:         page: this.page,",
      "79:         count: this.count,",
      "80:         attachment_type: this.attachment_type,",
      "81:         display_name: this.display_name,",
      "82:         username: this.username",
      "83:       }).then(data => {",
      "84:         var json = data.data",
      "85:         this.dataList = json.list",
      "86:         this.total = parseInt(json.total)",
      "87:         this.used = json.used_m",
      "88:         this.used_flow = json.used_flow_m",
      "89:       })",
      "90:     },",
      "92:     jump_to_item(row) {",
      "93:       let url = '/' + row.item_id",
      "94:       window.open(url)",
      "95:     },",
      "96:     handleCurrentChange(currentPage) {",
      "97:       this.page = currentPage",
      "98:       this.getList()",
      "99:     },",
      "100:     onSubmit() {",
      "101:       this.page = 1",
      "102:       this.getList()",
      "103:     },",
      "104:     visit(row) {",
      "105:       window.open(row.url)",
      "106:     },",
      "107:     delete_row(row) {",
      "108:       this.$confirm(this.$t('confirm_delete'), ' ', {",
      "109:         confirmButtonText: this.$t('confirm'),",
      "110:         cancelButtonText: this.$t('cancel'),",
      "111:         type: 'warning'",
      "112:       }).then(() => {",
      "113:         this.request('/api/attachment/deleteMyAttachment', {",
      "114:           file_id: row.file_id",
      "115:         }).then(data => {",
      "116:           this.$message.success(this.$t('op_success'))",
      "117:           this.getList()",
      "118:         })",
      "119:       })",
      "120:     },",
      "121:     goback() {",
      "122:       this.$router.push({ path: '/item/index' })",
      "123:     }",
      "124:   },",
      "126:   mounted() {",
      "127:     this.getList()",
      "128:   },",
      "129:   beforeDestroy() {}",
      "130: }",
      "131: </script>",
      "133: <!-- Add \"scoped\" attribute to limit CSS to this component only -->",
      "134: <style scoped>",
      "135: .hor-center-card a {",
      "136:   font-size: 12px;",
      "137: }",
      "139: .hor-center-card {",
      "140:   width: 1000px;",
      "141: }",
      "143: .goback-btn {",
      "144:   font-size: 18px;",
      "145:   margin-right: 800px;",
      "146:   margin-bottom: 5px;",
      "147: }",
      "149: </style>",
      "",
      "---------------"
    ],
    "web_src/src/components/item/Index.vue||web_src/src/components/item/Index.vue": [
      "File: web_src/src/components/item/Index.vue -> web_src/src/components/item/Index.vue",
      "--- Hunk 1 ---",
      "[Context before]",
      "66:                 <el-dropdown-item>",
      "67:                   <router-link to=\"/user/setting\">{{$t(\"Logged\")}}:{{username}}</router-link>",
      "68:                 </el-dropdown-item>",
      "69:                 <el-dropdown-item :command=\"logout\">{{$t(\"logout\")}}</el-dropdown-item>",
      "70:               </el-dropdown-menu>",
      "71:             </el-dropdown>",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "69:                 <el-dropdown-item>",
      "70:                   <router-link to=\"/attachment/index\">{{$t(\"my_attachment\")}}</router-link>",
      "71:                 </el-dropdown-item>",
      "",
      "---------------"
    ],
    "web_src/src/router/index.js||web_src/src/router/index.js": [
      "File: web_src/src/router/index.js -> web_src/src/router/index.js",
      "--- Hunk 1 ---",
      "[Context before]",
      "21: import Team from '@/components/team/Index'",
      "22: import TeamMember from '@/components/team/Member'",
      "23: import TeamItem from '@/components/team/Item'",
      "25: Vue.use(Router)",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "24: import Attachment from '@/components/attachment/Index'",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "135:       path: '/team/item/:team_id',",
      "136:       name: 'TeamItem',",
      "137:       component: TeamItem",
      "138:     }",
      "139:   ]",
      "140: })",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "139:     },",
      "140:     {",
      "141:       path: '/attachment/index',",
      "142:       name: 'Attachment',",
      "143:       component: Attachment",
      "",
      "---------------"
    ],
    "web_src/static/css/common.css||web_src/static/css/common.css": [
      "File: web_src/static/css/common.css -> web_src/static/css/common.css",
      "--- Hunk 1 ---",
      "[Context before]",
      "27:   box-sizing: border-box;",
      "28: }",
      "30: .pull-right {",
      "31:   float: right;",
      "32: }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "31: .hor-center-card {",
      "32:   width: 700px;",
      "33:   margin: 20px auto;",
      "34:   padding-top: 0px;",
      "35:   padding-left: 15px;",
      "36:   padding-right: 15px;",
      "37:   padding-bottom: 0px;",
      "38:   box-sizing: border-box;",
      "39: }",
      "",
      "---------------"
    ],
    "web_src/static/lang/en.js||web_src/static/lang/en.js": [
      "File: web_src/static/lang/en.js -> web_src/static/lang/en.js",
      "--- Hunk 1 ---",
      "[Context before]",
      "373:   update_pwd_tips: 'Password, leave blank if not changed',",
      "375:   import_excel: 'You can choose to import excel file',",
      "377: }",
      "",
      "[Removed Lines]",
      "376:   table: 'table'",
      "",
      "[Added Lines]",
      "376:   table: 'table',",
      "378:   attachment_manage: 'Attachment',",
      "379:   op_success: 'success',",
      "380:   display_name: 'display name',",
      "381:   all_attachment_type: 'all type',",
      "382:   image: 'image',",
      "383:   general_attachment: 'general attachment',",
      "384:   uploader: 'uploader',",
      "385:   file_id: 'file id',",
      "386:   file_type: 'type',",
      "387:   file_size_m: 'size/mb',",
      "388:   visit: 'visit',",
      "389:   visit_times: 'visit times',",
      "390:   my_attachment: 'My attachment',",
      "391:   accumulated_used_sapce: 'Accumulated used space',",
      "392:   month_flow: 'Traffic has been used this month'",
      "",
      "---------------"
    ],
    "web_src/static/lang/zh-CN.js||web_src/static/lang/zh-CN.js": [
      "File: web_src/static/lang/zh-CN.js -> web_src/static/lang/zh-CN.js",
      "--- Hunk 1 ---",
      "[Context before]",
      "364:   update_pwd_tips: '\u5bc6\u7801\uff0c\u4e0d\u4fee\u6539\u5219\u7559\u7a7a',",
      "366:   import_excel: '\u4f60\u53ef\u4ee5\u9009\u62e9Excel\u6587\u4ef6\u5bfc\u5165',",
      "368: }",
      "",
      "[Removed Lines]",
      "367:   table: '\u8868\u683c'",
      "",
      "[Added Lines]",
      "367:   table: '\u8868\u683c',",
      "369:   attachment_manage: '\u9644\u4ef6\u7ba1\u7406',",
      "370:   op_success: '\u64cd\u4f5c\u6210\u529f',",
      "371:   display_name: '\u5c55\u793a\u540d\u5b57',",
      "372:   all_attachment_type: '\u5168\u90e8\u9644\u4ef6\u7c7b\u578b',",
      "373:   image: '\u56fe\u7247',",
      "374:   general_attachment: '\u666e\u901a\u9644\u4ef6',",
      "375:   uploader: '\u4e0a\u4f20\u8005',",
      "376:   file_id: '\u6587\u4ef6id',",
      "377:   file_type: '\u6587\u4ef6\u7c7b\u578b',",
      "378:   file_size_m: '\u6587\u4ef6\u5927\u5c0f/mb',",
      "379:   visit: '\u67e5\u770b',",
      "380:   visit_times: '\u8bbf\u95ee\u6b21\u6570',",
      "381:   my_attachment: '\u6211\u7684\u9644\u4ef6',",
      "382:   accumulated_used_sapce: '\u7d2f\u8ba1\u5df2\u4f7f\u7528\u7a7a\u95f4',",
      "383:   month_flow: '\u672c\u6708\u5df2\u4f7f\u7528\u6d41\u91cf'",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "8c59a72ab966ae73056458bf18a4f6fbb1ffbecc",
      "candidate_info": {
        "commit_hash": "8c59a72ab966ae73056458bf18a4f6fbb1ffbecc",
        "repo": "star7th/showdoc",
        "commit_url": "https://github.com/star7th/showdoc/commit/8c59a72ab966ae73056458bf18a4f6fbb1ffbecc",
        "files": [
          "server/Application/Api/Controller/MockController.class.php",
          "web_src/src/components/admin/attachment/Index.vue",
          "web_src/src/components/attachment/Index.vue",
          "web_src/src/components/item/show/show_regular_item/LeftMenu.vue",
          "web_src/src/components/page/edit/Filehub.vue"
        ],
        "message": "bug",
        "before_after_code_files": [
          "server/Application/Api/Controller/MockController.class.php||server/Application/Api/Controller/MockController.class.php",
          "web_src/src/components/admin/attachment/Index.vue||web_src/src/components/admin/attachment/Index.vue",
          "web_src/src/components/attachment/Index.vue||web_src/src/components/attachment/Index.vue",
          "web_src/src/components/item/show/show_regular_item/LeftMenu.vue||web_src/src/components/item/show/show_regular_item/LeftMenu.vue",
          "web_src/src/components/page/edit/Filehub.vue||web_src/src/components/page/edit/Filehub.vue"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "web_src/src/components/admin/attachment/Index.vue||web_src/src/components/admin/attachment/Index.vue",
            "web_src/src/components/attachment/Index.vue||web_src/src/components/attachment/Index.vue"
          ],
          "candidate": [
            "web_src/src/components/admin/attachment/Index.vue||web_src/src/components/admin/attachment/Index.vue",
            "web_src/src/components/attachment/Index.vue||web_src/src/components/attachment/Index.vue"
          ]
        }
      },
      "candidate_diff": {
        "server/Application/Api/Controller/MockController.class.php||server/Application/Api/Controller/MockController.class.php": [
          "File: server/Application/Api/Controller/MockController.class.php -> server/Application/Api/Controller/MockController.class.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "66:     public function infoByKey(){",
          "68:         $page = D(\"Mock\")->where(\" unique_key = '%s' \",array($unique_key))->find();",
          "69:         $template = $page['template'] ;",
          "70:         $res = http_post(\"http://127.0.0.1:7123/mock\",array(",
          "",
          "[Removed Lines]",
          "67:         $unique_key = I(\"unique_key\");",
          "",
          "[Added Lines]",
          "67:         $unique_key = $_REQUEST[\"unique_key\"];",
          "",
          "---------------"
        ],
        "web_src/src/components/admin/attachment/Index.vue||web_src/src/components/admin/attachment/Index.vue": [
          "File: web_src/src/components/admin/attachment/Index.vue -> web_src/src/components/admin/attachment/Index.vue",
          "--- Hunk 1 ---",
          "[Context before]",
          "27:       <el-table-column prop=\"visit_times\" :label=\"$t('visit_times')\"></el-table-column>",
          "28:       <el-table-column prop=\"username\" :label=\"$t('uploader')\"></el-table-column>",
          "29:       <el-table-column prop=\"addtime\" :label=\"$t('add_time')\" width=\"160\"></el-table-column>",
          "31:         <template slot-scope=\"scope\">",
          "32:           <el-button @click=\"visit(scope.row)\" type=\"text\" size=\"small\">{{$t('visit')}}</el-button>",
          "33:           <el-button @click=\"delete_row(scope.row)\" type=\"text\" size=\"small\">{{$t('delete')}}</el-button>",
          "",
          "[Removed Lines]",
          "30:       <el-table-column prop :label=\"operation\">",
          "",
          "[Added Lines]",
          "30:       <el-table-column prop :label=\"$t('operation')\">",
          "",
          "---------------"
        ],
        "web_src/src/components/attachment/Index.vue||web_src/src/components/attachment/Index.vue": [
          "File: web_src/src/components/attachment/Index.vue -> web_src/src/components/attachment/Index.vue",
          "--- Hunk 1 ---",
          "[Context before]",
          "41:           <el-table-column prop=\"file_size_m\" :label=\"$t('file_size_m')\" width=\"160\"></el-table-column>",
          "42:           <el-table-column prop=\"visit_times\" :label=\"$t('visit_times')\"></el-table-column>",
          "43:           <el-table-column prop=\"addtime\" :label=\"$t('add_time')\" width=\"160\"></el-table-column>",
          "45:             <template slot-scope=\"scope\">",
          "46:               <el-button @click=\"visit(scope.row)\" type=\"text\" size=\"small\">{{$t('visit')}}</el-button>",
          "47:               <el-button @click=\"delete_row(scope.row)\" type=\"text\" size=\"small\">{{$t('delete')}}</el-button>",
          "",
          "[Removed Lines]",
          "44:           <el-table-column prop :label=\"operation\">",
          "",
          "[Added Lines]",
          "44:           <el-table-column prop :label=\"$t('operation')\">",
          "",
          "---------------"
        ],
        "web_src/src/components/item/show/show_regular_item/LeftMenu.vue||web_src/src/components/item/show/show_regular_item/LeftMenu.vue": [
          "File: web_src/src/components/item/show/show_regular_item/LeftMenu.vue -> web_src/src/components/item/show/show_regular_item/LeftMenu.vue",
          "--- Hunk 1 ---",
          "[Context before]",
          "40:         <template v-if=\"menu.pages && menu.pages.length \">",
          "41:           <el-menu-item v-for=\"(page ) in menu.pages\" :index=\"page.page_id\" :key=\"page.page_id\">",
          "42:             <i class=\"el-icon-document\"></i>",
          "44:           </el-menu-item>",
          "45:         </template>",
          "",
          "[Removed Lines]",
          "43:             <span :title=\"page.page_title\">{{page.page_title}}</span>",
          "",
          "[Added Lines]",
          "43:             <span :title=\"page.page_title\" :id=\"'left_page_'+page.page_id\">{{page.page_title}}</span>",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "95:     change_url(page_id) {",
          "96:       var domain = this.item_info.item_domain",
          "97:         ? this.item_info.item_domain",
          "98:         : this.item_info.item_id",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "96:       if (page_id > 0 && page_id == this.$route.query.page_id) {",
          "97:         return",
          "98:       }",
          "",
          "---------------"
        ],
        "web_src/src/components/page/edit/Filehub.vue||web_src/src/components/page/edit/Filehub.vue": [
          "File: web_src/src/components/page/edit/Filehub.vue -> web_src/src/components/page/edit/Filehub.vue",
          "--- Hunk 1 ---",
          "[Context before]",
          "44:           <el-table-column prop=\"file_size_m\" :label=\"$t('file_size_m')\" width=\"160\"></el-table-column>",
          "45:           <el-table-column prop=\"visit_times\" :label=\"$t('visit_times')\"></el-table-column>",
          "46:           <el-table-column prop=\"addtime\" :label=\"$t('add_time')\" width=\"160\"></el-table-column>",
          "48:             <template slot-scope=\"scope\">",
          "49:               <el-button @click=\"select(scope.row)\" type=\"text\" size=\"small\">{{$t('select')}}</el-button>",
          "50:               <el-button @click=\"visit(scope.row)\" type=\"text\" size=\"small\">{{$t('visit')}}</el-button>",
          "",
          "[Removed Lines]",
          "47:           <el-table-column prop :label=\"operation\">",
          "",
          "[Added Lines]",
          "47:           <el-table-column prop :label=\"$t('operation')\">",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "3908fb0a46ec0bd2c0f18b3ff3a23fc1966838db",
      "candidate_info": {
        "commit_hash": "3908fb0a46ec0bd2c0f18b3ff3a23fc1966838db",
        "repo": "star7th/showdoc",
        "commit_url": "https://github.com/star7th/showdoc/commit/3908fb0a46ec0bd2c0f18b3ff3a23fc1966838db",
        "files": [
          "server/Application/Api/Controller/ItemVariableController.class.php",
          "web_src/src/components/admin/Index.vue",
          "web_src/src/components/admin/attachment/Index.vue",
          "web_src/src/components/admin/user/Index.vue",
          "web_src/static/lang/en.js",
          "web_src/static/lang/zh-CN.js"
        ],
        "message": "Perfect translation  / \u5b8c\u5584\u7ffb\u8bd1",
        "before_after_code_files": [
          "server/Application/Api/Controller/ItemVariableController.class.php||server/Application/Api/Controller/ItemVariableController.class.php",
          "web_src/src/components/admin/Index.vue||web_src/src/components/admin/Index.vue",
          "web_src/src/components/admin/attachment/Index.vue||web_src/src/components/admin/attachment/Index.vue",
          "web_src/src/components/admin/user/Index.vue||web_src/src/components/admin/user/Index.vue",
          "web_src/static/lang/en.js||web_src/static/lang/en.js",
          "web_src/static/lang/zh-CN.js||web_src/static/lang/zh-CN.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "web_src/src/components/admin/Index.vue||web_src/src/components/admin/Index.vue",
            "web_src/src/components/admin/attachment/Index.vue||web_src/src/components/admin/attachment/Index.vue",
            "web_src/static/lang/en.js||web_src/static/lang/en.js",
            "web_src/static/lang/zh-CN.js||web_src/static/lang/zh-CN.js"
          ],
          "candidate": [
            "web_src/src/components/admin/Index.vue||web_src/src/components/admin/Index.vue",
            "web_src/src/components/admin/attachment/Index.vue||web_src/src/components/admin/attachment/Index.vue",
            "web_src/static/lang/en.js||web_src/static/lang/en.js",
            "web_src/static/lang/zh-CN.js||web_src/static/lang/zh-CN.js"
          ]
        }
      },
      "candidate_diff": {
        "server/Application/Api/Controller/ItemVariableController.class.php||server/Application/Api/Controller/ItemVariableController.class.php": [
          "File: server/Application/Api/Controller/ItemVariableController.class.php -> server/Application/Api/Controller/ItemVariableController.class.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "15:         if(!$this->checkItemPermn($uid , $item_id)){",
          "16:             $this->sendError(10303);",
          "17:             return ;",
          "29:         if (!$id) {",
          "30:             $this->sendError(10101);",
          "",
          "[Removed Lines]",
          "18:         }",
          "19:         $data = array() ;",
          "20:         $data['var_name'] = $var_name ;",
          "21:         $data['uid'] = $uid ;",
          "22:         $data['env_id'] = $env_id ;",
          "23:         $data['var_value'] = $var_value ;",
          "24:         $data['item_id'] = $item_id ;",
          "25:         $data['addtime'] = time() ;",
          "27:         $id = D(\"ItemVariable\")->add($data);",
          "",
          "[Added Lines]",
          "18:         }",
          "20:         $id = 0 ;",
          "21:         $res = D(\"ItemVariable\")->where(\" item_id = '{$item_id}' and env_id = '{$env_id}' and var_name = '%s'   \" ,array($var_name) )->find() ;",
          "22:         if($res){",
          "23:             $id = $res['id'] ;",
          "24:             D(\"ItemVariable\")->where(\" id = '{$id}' \")->save(array(\"var_value\"=>$var_value));",
          "25:         }else{",
          "26:             $data = array() ;",
          "27:             $data['var_name'] = $var_name ;",
          "28:             $data['uid'] = $uid ;",
          "29:             $data['var_value'] = $var_value ;",
          "30:             $data['item_id'] = $item_id ;",
          "31:             $data['env_id'] = $env_id ;",
          "32:             $data['addtime'] = time() ;",
          "33:             $id = D(\"ItemVariable\")->add($data);",
          "34:         }",
          "",
          "---------------"
        ],
        "web_src/src/components/admin/Index.vue||web_src/src/components/admin/Index.vue": [
          "File: web_src/src/components/admin/Index.vue -> web_src/src/components/admin/Index.vue",
          "--- Hunk 1 ---",
          "[Context before]",
          "108: .header_title {",
          "109:   float: left;",
          "112:   font-size: 20px;",
          "113:   background-color: rgb(84, 92, 100);",
          "114:   color: #fff;",
          "",
          "[Removed Lines]",
          "110:   padding-right: 35px;",
          "111:   padding-left: 25px;",
          "",
          "[Added Lines]",
          "110:   width: 150px;",
          "",
          "---------------"
        ],
        "web_src/src/components/admin/attachment/Index.vue||web_src/src/components/admin/attachment/Index.vue": [
          "File: web_src/src/components/admin/attachment/Index.vue -> web_src/src/components/admin/attachment/Index.vue",
          "--- Hunk 1 ---",
          "[Context before]",
          "21:         <el-button @click=\"onSubmit\">{{ $t('search') }}</el-button>",
          "22:       </el-form-item>",
          "23:     </el-form>",
          "25:     <el-table :data=\"dataList\" style=\"width: 100%\">",
          "26:       <el-table-column prop=\"file_id\" :label=\"$t('file_id')\"></el-table-column>",
          "27:       <el-table-column",
          "",
          "[Removed Lines]",
          "24:     <P>\u7d2f\u8ba1\u5df2\u4f7f\u7528 {{ used }}M \u7a7a\u95f4</P>",
          "",
          "[Added Lines]",
          "24:     <P>{{ $t('used_space') }} {{ used }}M</P>",
          "",
          "---------------"
        ],
        "web_src/src/components/admin/user/Index.vue||web_src/src/components/admin/user/Index.vue": [
          "File: web_src/src/components/admin/user/Index.vue -> web_src/src/components/admin/user/Index.vue",
          "--- Hunk 1 ---",
          "[Context before]",
          "2:   <div class=\"hello\">",
          "3:     <el-form :inline=\"true\" class=\"demo-form-inline\">",
          "4:       <el-form-item label>",
          "6:       </el-form-item>",
          "7:       <el-form-item>",
          "8:         <el-button @click=\"onSubmit\">{{ $t('search') }}</el-button>",
          "",
          "[Removed Lines]",
          "5:         <el-input v-model=\"username\" placeholder=\"\u7528\u6237\u540d\"></el-input>",
          "",
          "[Added Lines]",
          "5:         <el-input v-model=\"username\" :placeholder=\"$t('username')\"></el-input>",
          "",
          "---------------"
        ],
        "web_src/static/lang/en.js||web_src/static/lang/en.js": [
          "File: web_src/static/lang/en.js -> web_src/static/lang/en.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "421:   copy_or_mv_cat: 'Copy or move catalog',",
          "422:   copy_to: 'Copy To',",
          "423:   move_to: 'Move To',",
          "426: }",
          "",
          "[Removed Lines]",
          "424:   remark: 'remark'",
          "",
          "[Added Lines]",
          "424:   remark: 'remark',",
          "426:   used_space: 'Used pace'",
          "",
          "---------------"
        ],
        "web_src/static/lang/zh-CN.js||web_src/static/lang/zh-CN.js": [
          "File: web_src/static/lang/zh-CN.js -> web_src/static/lang/zh-CN.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "411:   copy_or_mv_cat: '\u590d\u5236\u6216\u79fb\u52a8\u76ee\u5f55',",
          "412:   copy_to: '\u590d\u5236\u5230',",
          "413:   move_to: '\u79fb\u52a8\u5230',",
          "415: }",
          "",
          "[Removed Lines]",
          "414:   remark: '\u5907\u6ce8'",
          "",
          "[Added Lines]",
          "414:   remark: '\u5907\u6ce8',",
          "416:   used_space: '\u5df2\u4f7f\u7528\u7a7a\u95f4'",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "5874db77c839f0618b8e3b331f5fcfd48034c7d7",
      "candidate_info": {
        "commit_hash": "5874db77c839f0618b8e3b331f5fcfd48034c7d7",
        "repo": "star7th/showdoc",
        "commit_url": "https://github.com/star7th/showdoc/commit/5874db77c839f0618b8e3b331f5fcfd48034c7d7",
        "files": [
          "web_src/src/components/team/Index.vue",
          "web_src/src/components/team/Item.vue",
          "web_src/src/components/team/Member.vue",
          "web_src/static/lang/en.js",
          "web_src/static/lang/zh-CN.js"
        ],
        "message": "UI for optimizing team management / \u4f18\u5316\u56e2\u961f\u7ba1\u7406\u7684UI",
        "before_after_code_files": [
          "web_src/src/components/team/Index.vue||web_src/src/components/team/Index.vue",
          "web_src/src/components/team/Item.vue||web_src/src/components/team/Item.vue",
          "web_src/src/components/team/Member.vue||web_src/src/components/team/Member.vue",
          "web_src/static/lang/en.js||web_src/static/lang/en.js",
          "web_src/static/lang/zh-CN.js||web_src/static/lang/zh-CN.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "web_src/static/lang/en.js||web_src/static/lang/en.js",
            "web_src/static/lang/zh-CN.js||web_src/static/lang/zh-CN.js"
          ],
          "candidate": [
            "web_src/static/lang/en.js||web_src/static/lang/en.js",
            "web_src/static/lang/zh-CN.js||web_src/static/lang/zh-CN.js"
          ]
        }
      },
      "candidate_diff": {
        "web_src/src/components/team/Index.vue||web_src/src/components/team/Index.vue": [
          "File: web_src/src/components/team/Index.vue -> web_src/src/components/team/Index.vue",
          "--- Hunk 1 ---",
          "[Context before]",
          "5:     <el-container>",
          "6:       <el-card class=\"center-card\">",
          "13:         <el-table",
          "14:           align=\"left\"",
          "15:           :empty-text=\"$t('empty_team_tips')\"",
          "",
          "[Removed Lines]",
          "7:         <el-button type=\"text\" class=\"add-cat\" @click=\"addTeam\">{{",
          "8:           $t('add_team')",
          "9:         }}</el-button>",
          "10:         <el-button type=\"text\" class=\"goback-btn\" @click=\"goback\">{{",
          "11:           $t('goback')",
          "12:         }}</el-button>",
          "",
          "[Added Lines]",
          "7:         <el-button type=\"text\" class=\"goback-btn\" @click=\"goback\"",
          "8:           ><i class=\"el-icon-back\"></i>&nbsp;{{ $t('goback') }}</el-button",
          "9:         >",
          "10:         <el-button type=\"text\" class=\"add-cat\" @click=\"addTeam\"",
          "11:           ><i class=\"el-icon-plus\"></i>&nbsp;{{ $t('add_team') }}</el-button",
          "12:         >",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "21:             prop=\"team_name\"",
          "22:             :label=\"$t('team_name')\"",
          "23:           ></el-table-column>",
          "25:             <template slot-scope=\"scope\">",
          "26:               <router-link :to=\"'/team/member/' + scope.row.id\">{{",
          "27:                 scope.row.memberCount",
          "28:               }}</router-link>",
          "29:             </template>",
          "30:           </el-table-column>",
          "32:             <template slot-scope=\"scope\">",
          "33:               <router-link :to=\"'/team/item/' + scope.row.id\">{{",
          "34:                 scope.row.itemCount",
          "",
          "[Removed Lines]",
          "24:           <el-table-column prop=\"memberCount\" :label=\"$t('memberCount')\">",
          "31:           <el-table-column prop=\"itemCount\" :label=\"$t('itemCount')\">",
          "",
          "[Added Lines]",
          "24:           <el-table-column",
          "25:             prop=\"memberCount\"",
          "26:             width=\"100\"",
          "27:             :label=\"$t('memberCount')\"",
          "28:           >",
          "35:           <el-table-column",
          "36:             prop=\"itemCount\"",
          "37:             width=\"100\"",
          "38:             :label=\"$t('itemCount')\"",
          "39:           >",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "52:               <el-button @click=\"edit(scope.row)\" type=\"text\" size=\"small\">{{",
          "53:                 $t('edit')",
          "54:               }}</el-button>",
          "56:               <el-button",
          "57:                 @click=\"attornDialog(scope.row)\"",
          "58:                 type=\"text\"",
          "",
          "[Removed Lines]",
          "55:               <br />",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "113:             ></el-input>",
          "114:           </el-form-item>",
          "115:         </el-form>",
          "117:         <div slot=\"footer\" class=\"dialog-footer\">",
          "118:           <el-button @click=\"dialogAttornVisible = false\">{{",
          "119:             $t('cancel')",
          "",
          "[Removed Lines]",
          "116:         <p class=\"tips\">{{ $t('attornTeamTips') }}</p>",
          "",
          "[Added Lines]",
          "123:         <p class=\"tips\">",
          "124:           <small>{{ $t('attornTeamTips') }}</small>",
          "125:         </p>",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "259: }",
          "261: .add-cat {",
          "263: }",
          "265: .center-card {",
          "266:   text-align: left;",
          "268:   height: 600px;",
          "269: }",
          "271: .goback-btn {",
          "272:   z-index: 999;",
          "274: }",
          "275: </style>",
          "",
          "[Removed Lines]",
          "262:   margin-left: 10px;",
          "267:   width: 800px;",
          "273:   margin-left: 600px;",
          "",
          "[Added Lines]",
          "271:   float: right;",
          "272:   margin-right: 15px;",
          "273:   font-size: 14px;",
          "278:   width: 750px;",
          "284:   font-size: 14px;",
          "",
          "---------------"
        ],
        "web_src/src/components/team/Item.vue||web_src/src/components/team/Item.vue": [
          "File: web_src/src/components/team/Item.vue -> web_src/src/components/team/Item.vue",
          "--- Hunk 1 ---",
          "[Context before]",
          "5:     <el-container>",
          "6:       <el-card class=\"center-card\">",
          "13:         <el-table align=\"left\" :data=\"list\" height=\"400\" style=\"width: 100%\">",
          "14:           <el-table-column",
          "15:             prop=\"item_name\"",
          "",
          "[Removed Lines]",
          "7:         <el-button type=\"text\" class=\"add-cat\" @click=\"addTeamItem\">{{",
          "8:           $t('distribution_to_team')",
          "9:         }}</el-button>",
          "10:         <el-button type=\"text\" class=\"goback-btn\" @click=\"goback\">{{",
          "11:           $t('back_to_team')",
          "12:         }}</el-button>",
          "",
          "[Added Lines]",
          "7:         <el-button type=\"text\" class=\"goback-btn\" @click=\"goback\"",
          "8:           ><i class=\"el-icon-back\"></i>&nbsp;{{ $t('goback') }}</el-button",
          "9:         >",
          "10:         <el-button type=\"text\" class=\"add-cat\" @click=\"addTeamItem\"",
          "11:           ><i class=\"el-icon-plus\"></i>&nbsp;{{ $t('binding_item') }}</el-button",
          "12:         >",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "330: }",
          "332: .add-cat {",
          "334: }",
          "336: .center-card {",
          "",
          "[Removed Lines]",
          "333:   margin-left: 10px;",
          "",
          "[Added Lines]",
          "333:   float: right;",
          "334:   margin-right: 15px;",
          "335:   font-size: 14px;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "342: .goback-btn {",
          "343:   z-index: 999;",
          "345: }",
          "346: </style>",
          "",
          "[Removed Lines]",
          "344:   margin-left: 500px;",
          "",
          "[Added Lines]",
          "346:   font-size: 14px;",
          "",
          "---------------"
        ],
        "web_src/src/components/team/Member.vue||web_src/src/components/team/Member.vue": [
          "File: web_src/src/components/team/Member.vue -> web_src/src/components/team/Member.vue",
          "--- Hunk 1 ---",
          "[Context before]",
          "5:     <el-container>",
          "6:       <el-card class=\"center-card\">",
          "13:         <el-table align=\"left\" :data=\"list\" height=\"400\" style=\"width: 100%\">",
          "14:           <el-table-column",
          "15:             prop=\"member_username\"",
          "",
          "[Removed Lines]",
          "7:         <el-button type=\"text\" class=\"add-cat\" @click=\"addTeamMember\">{{",
          "8:           $t('add_member')",
          "9:         }}</el-button>",
          "10:         <el-button type=\"text\" class=\"goback-btn\" @click=\"goback\">{{",
          "11:           $t('back_to_team')",
          "12:         }}</el-button>",
          "",
          "[Added Lines]",
          "7:         <el-button type=\"text\" class=\"goback-btn\" @click=\"goback\"",
          "8:           ><i class=\"el-icon-back\"></i>&nbsp;{{ $t('goback') }}</el-button",
          "9:         >",
          "10:         <el-button type=\"text\" class=\"add-cat\" @click=\"addTeamMember\"",
          "11:           ><i class=\"el-icon-plus\"></i>&nbsp;{{ $t('add_member') }}</el-button",
          "12:         >",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "18:           <el-table-column prop=\"name\" :label=\"$t('name')\"></el-table-column>",
          "19:           <el-table-column",
          "20:             prop=\"addtime\"",
          "21:             :label=\"$t('addtime')\"",
          "22:           ></el-table-column>",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "21:             width=\"160\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "210: }",
          "212: .add-cat {",
          "214: }",
          "216: .center-card {",
          "217:   text-align: left;",
          "219:   height: 600px;",
          "220: }",
          "222: .goback-btn {",
          "223:   z-index: 999;",
          "225: }",
          "226: </style>",
          "",
          "[Removed Lines]",
          "213:   margin-left: 10px;",
          "218:   width: 800px;",
          "224:   margin-left: 550px;",
          "",
          "[Added Lines]",
          "214:   float: right;",
          "215:   margin-right: 15px;",
          "216:   font-size: 14px;",
          "221:   width: 700px;",
          "227:   font-size: 14px;",
          "",
          "---------------"
        ],
        "web_src/static/lang/en.js||web_src/static/lang/en.js": [
          "File: web_src/static/lang/en.js -> web_src/static/lang/en.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "423:   move_to: 'Move To',",
          "424:   remark: 'remark',",
          "428: }",
          "",
          "[Removed Lines]",
          "426:   qcloud: 'qcloud'",
          "",
          "[Added Lines]",
          "426:   qcloud: 'qcloud',",
          "427:   binding_item: 'Binding item',",
          "428:   addtime: 'addtime'",
          "",
          "---------------"
        ],
        "web_src/static/lang/zh-CN.js||web_src/static/lang/zh-CN.js": [
          "File: web_src/static/lang/zh-CN.js -> web_src/static/lang/zh-CN.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "413:   move_to: '\u79fb\u52a8\u5230',",
          "414:   remark: '\u5907\u6ce8',",
          "417: }",
          "",
          "[Removed Lines]",
          "416:   qcloud: '\u817e\u8baf\u4e91'",
          "",
          "[Added Lines]",
          "416:   qcloud: '\u817e\u8baf\u4e91',",
          "417:   binding_item: '\u7ed1\u5b9a\u9879\u76ee',",
          "418:   addtime: '\u6dfb\u52a0\u65f6\u95f4'",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "8209db271d5fab9480ffdbb98772c4c11e99bb54",
      "candidate_info": {
        "commit_hash": "8209db271d5fab9480ffdbb98772c4c11e99bb54",
        "repo": "star7th/showdoc",
        "commit_url": "https://github.com/star7th/showdoc/commit/8209db271d5fab9480ffdbb98772c4c11e99bb54",
        "files": [
          "server/Application/Api/Controller/PageController.class.php",
          "web_src/src/components/page/edit/HistoryVersion.vue",
          "web_src/static/lang/en.js",
          "web_src/static/lang/zh-CN.js"
        ],
        "message": "You can edit the notes of the historical version of the page / \u53ef\u4ee5\u7f16\u8f91\u9875\u9762\u5386\u53f2\u7248\u672c\u7684\u5907\u6ce8\u4fe1\u606f",
        "before_after_code_files": [
          "server/Application/Api/Controller/PageController.class.php||server/Application/Api/Controller/PageController.class.php",
          "web_src/src/components/page/edit/HistoryVersion.vue||web_src/src/components/page/edit/HistoryVersion.vue",
          "web_src/static/lang/en.js||web_src/static/lang/en.js",
          "web_src/static/lang/zh-CN.js||web_src/static/lang/zh-CN.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "server/Application/Api/Controller/PageController.class.php||server/Application/Api/Controller/PageController.class.php",
            "web_src/static/lang/en.js||web_src/static/lang/en.js",
            "web_src/static/lang/zh-CN.js||web_src/static/lang/zh-CN.js"
          ],
          "candidate": [
            "server/Application/Api/Controller/PageController.class.php||server/Application/Api/Controller/PageController.class.php",
            "web_src/static/lang/en.js||web_src/static/lang/en.js",
            "web_src/static/lang/zh-CN.js||web_src/static/lang/zh-CN.js"
          ]
        }
      },
      "candidate_diff": {
        "server/Application/Api/Controller/PageController.class.php||server/Application/Api/Controller/PageController.class.php": [
          "File: server/Application/Api/Controller/PageController.class.php -> server/Application/Api/Controller/PageController.class.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "182:     }",
          "185:     public function diff(){",
          "186:         $page_id = I(\"page_id/d\");",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "186:     public function updateHistoryComments(){",
          "187:         $login_user = $this->checkLogin(false);",
          "188:         $page_id = I(\"page_id/d\") ? I(\"page_id/d\") : 0 ;",
          "189:         $page_comments = I(\"page_comments\") ;",
          "190:         $page_history_id = I(\"page_history_id/d\") ? I(\"page_history_id/d\") : 0 ;",
          "191:         $page = M(\"Page\")->where(\" page_id = '$page_id' \")->find();",
          "192:         if (!$this->checkItemPermn($login_user['uid'] , $page['item_id'])) {",
          "193:             $this->sendError(10103);",
          "194:             return;",
          "195:         }",
          "196:         $res = D(\"PageHistory\")->where(\" page_history_id = '$page_history_id' \")->save(array(",
          "197:             \"page_comments\"=>$page_comments",
          "198:         ));",
          "199:         $this->sendResult($res);",
          "200:     }",
          "",
          "---------------"
        ],
        "web_src/src/components/page/edit/HistoryVersion.vue||web_src/src/components/page/edit/HistoryVersion.vue": [
          "File: web_src/src/components/page/edit/HistoryVersion.vue -> web_src/src/components/page/edit/HistoryVersion.vue",
          "--- Hunk 1 ---",
          "[Context before]",
          "11:         :close-on-click-modal=\"false\"",
          "12:       >",
          "13:         <el-table :data=\"content\">",
          "16:           <el-table-column label=\"\u64cd\u4f5c\" width=\"150\">",
          "17:             <template slot-scope=\"scope\">",
          "18:               <el-button",
          "19:                 @click=\"preview_diff(scope.row)\"",
          "20:                 type=\"text\"",
          "21:                 size=\"small\"",
          "23:               <el-button",
          "24:                 v-if=\"is_show_recover_btn\"",
          "25:                 type=\"text\"",
          "26:                 size=\"small\"",
          "27:                 @click=\"recover(scope.row)\"",
          "29:             </template>",
          "30:           </el-table-column>",
          "31:         </el-table>",
          "",
          "[Removed Lines]",
          "14:           <el-table-column property=\"addtime\" :label=\"$t('update_time')\" width=\"170\"></el-table-column>",
          "15:           <el-table-column property=\"author_username\" :label=\"$t('update_by_who')\"></el-table-column>",
          "22:               >{{$t('overview')}}</el-button>",
          "28:               >{{$t('recover_to_this_version')}}</el-button>",
          "",
          "[Added Lines]",
          "14:           <el-table-column",
          "15:             property=\"addtime\"",
          "16:             :label=\"$t('update_time')\"",
          "17:             width=\"170\"",
          "18:           ></el-table-column>",
          "19:           <el-table-column",
          "20:             property=\"author_username\"",
          "21:             :label=\"$t('update_by_who')\"",
          "22:           ></el-table-column>",
          "23:           <el-table-column property=\"page_comments\" :label=\"$t('remark')\">",
          "24:             <template slot-scope=\"scope\">",
          "25:               {{ scope.row.page_comments }}",
          "26:               <el-button",
          "27:                 v-if=\"is_show_recover_btn\"",
          "28:                 @click=\"editComments(scope.row)\"",
          "29:                 type=\"text\"",
          "30:                 size=\"small\"",
          "31:                 >{{ $t('edit') }}</el-button",
          "32:               >",
          "33:             </template>",
          "34:           </el-table-column>",
          "41:                 >{{ $t('overview') }}</el-button",
          "42:               >",
          "48:                 >{{ $t('recover_to_this_version') }}</el-button",
          "49:               >",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "36:   </div>",
          "37: </template>",
          "42: <script>",
          "43: export default {",
          "",
          "[Removed Lines]",
          "39: <style>",
          "40: </style>",
          "",
          "[Added Lines]",
          "60: <style></style>",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "97:       let page_id = this.page_id ? this.page_id : this.$route.params.page_id",
          "98:       var url = '#/page/diff/' + page_id + '/' + page_history_id",
          "99:       window.open(url)",
          "100:     }",
          "101:   },",
          "102:   mounted() {}",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "120:     },",
          "121:     editComments(row) {",
          "122:       let page_id = this.page_id ? this.page_id : this.$route.params.page_id",
          "123:       this.$prompt('', ' ', {}).then(data => {",
          "124:         this.request('/api/page/updateHistoryComments', {",
          "125:           page_id: page_id,",
          "126:           page_history_id: row.page_history_id,",
          "127:           page_comments: data.value",
          "128:         }).then(() => {",
          "129:           this.get_content()",
          "130:         })",
          "131:       })",
          "",
          "---------------"
        ],
        "web_src/static/lang/en.js||web_src/static/lang/en.js": [
          "File: web_src/static/lang/en.js -> web_src/static/lang/en.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "421:   copy_or_mv_cat: 'Copy or move catalog',",
          "422:   copy_to: 'Copy To',",
          "425: }",
          "",
          "[Removed Lines]",
          "423:   move_to: 'Move To'",
          "",
          "[Added Lines]",
          "423:   move_to: 'Move To',",
          "424:   remark: 'remark'",
          "",
          "---------------"
        ],
        "web_src/static/lang/zh-CN.js||web_src/static/lang/zh-CN.js": [
          "File: web_src/static/lang/zh-CN.js -> web_src/static/lang/zh-CN.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "411:   copy_or_mv_cat: '\u590d\u5236\u6216\u79fb\u52a8\u76ee\u5f55',",
          "412:   copy_to: '\u590d\u5236\u5230',",
          "414: }",
          "",
          "[Removed Lines]",
          "413:   move_to: '\u79fb\u52a8\u5230'",
          "",
          "[Added Lines]",
          "413:   move_to: '\u79fb\u52a8\u5230',",
          "414:   remark: '\u5907\u6ce8'",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "4e2787afe15a3f3cfeb15f8af57e00fe1c4b747c",
      "candidate_info": {
        "commit_hash": "4e2787afe15a3f3cfeb15f8af57e00fe1c4b747c",
        "repo": "star7th/showdoc",
        "commit_url": "https://github.com/star7th/showdoc/commit/4e2787afe15a3f3cfeb15f8af57e00fe1c4b747c",
        "files": [
          "server/Application/Api/Controller/PageController.class.php"
        ],
        "message": "Update PageController.class.php",
        "before_after_code_files": [
          "server/Application/Api/Controller/PageController.class.php||server/Application/Api/Controller/PageController.class.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "server/Application/Api/Controller/PageController.class.php||server/Application/Api/Controller/PageController.class.php"
          ],
          "candidate": [
            "server/Application/Api/Controller/PageController.class.php||server/Application/Api/Controller/PageController.class.php"
          ]
        }
      },
      "candidate_diff": {
        "server/Application/Api/Controller/PageController.class.php||server/Application/Api/Controller/PageController.class.php": [
          "File: server/Application/Api/Controller/PageController.class.php -> server/Application/Api/Controller/PageController.class.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "242:             $upload->allowExts  = array('jpg', 'gif', 'png', 'jpeg');// \u8bbe\u7f6e\u9644\u4ef6\u4e0a\u4f20\u7c7b\u578b",
          "243:             $upload->rootPath = './../Public/Uploads/';// \u8bbe\u7f6e\u9644\u4ef6\u4e0a\u4f20\u76ee\u5f55",
          "244:             $upload->savePath = '';// \u8bbe\u7f6e\u9644\u4ef6\u4e0a\u4f20\u5b50\u76ee\u5f55",
          "246:             if(!$info) {// \u4e0a\u4f20\u9519\u8bef\u63d0\u793a\u9519\u8bef\u4fe1\u606f",
          "247:               $this->error($upload->getError());",
          "248:               return;",
          "249:             }else{// \u4e0a\u4f20\u6210\u529f \u83b7\u53d6\u4e0a\u4f20\u6587\u4ef6\u4fe1\u606f",
          "251:               echo json_encode(array(\"url\"=>$url,\"success\"=>1));",
          "252:             }",
          "253:         }",
          "",
          "[Removed Lines]",
          "245:             $info = $upload->upload() ;",
          "250:               $url = get_domain().__ROOT__.substr($upload->rootPath,1).$info['editormd-image-file']['savepath'].$info['editormd-image-file']['savename'] ;",
          "",
          "[Added Lines]",
          "245:             $info = $upload->uploadOne($_FILES['editormd-image-file']) ;",
          "250:               $url = get_domain().__ROOT__.substr($upload->rootPath,1).$info['savepath'].$info['savename'] ;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "282:         $upload->maxSize  = 4145728000 ;// \u8bbe\u7f6e\u9644\u4ef6\u4e0a\u4f20\u5927\u5c0f",
          "283:         $upload->rootPath = './../Public/Uploads/';// \u8bbe\u7f6e\u9644\u4ef6\u4e0a\u4f20\u76ee\u5f55",
          "284:         $upload->savePath = '';// \u8bbe\u7f6e\u9644\u4ef6\u4e0a\u4f20\u5b50\u76ee\u5f55",
          "286:         if(!$info) {// \u4e0a\u4f20\u9519\u8bef\u63d0\u793a\u9519\u8bef\u4fe1\u606f",
          "287:           $this->error($upload->getError());",
          "288:           return;",
          "289:         }else{// \u4e0a\u4f20\u6210\u529f \u83b7\u53d6\u4e0a\u4f20\u6587\u4ef6\u4fe1\u606f",
          "291:           $insert = array(",
          "292:             \"uid\" => $login_user['uid'],",
          "293:             \"item_id\" => $item_id,",
          "",
          "[Removed Lines]",
          "285:         $info = $upload->upload() ;",
          "290:           $url = get_domain().__ROOT__.substr($upload->rootPath,1).$info['file']['savepath'].$info['file']['savename'] ;",
          "",
          "[Added Lines]",
          "285:         $info = $upload->uploadOne($uploadFile) ;",
          "290:           $url = get_domain().__ROOT__.substr($upload->rootPath,1).$info['savepath'].$info['savename'] ;",
          "",
          "---------------"
        ]
      }
    }
  ]
}