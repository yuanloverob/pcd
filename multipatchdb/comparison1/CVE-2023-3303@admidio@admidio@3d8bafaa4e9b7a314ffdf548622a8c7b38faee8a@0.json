{
  "cve_id": "CVE-2023-3303",
  "cve_desc": "Improper Access Control in GitHub repository admidio/admidio prior to 4.2.9.",
  "repo": "admidio/admidio",
  "patch_hash": "3d8bafaa4e9b7a314ffdf548622a8c7b38faee8a",
  "patch_info": {
    "commit_hash": "3d8bafaa4e9b7a314ffdf548622a8c7b38faee8a",
    "repo": "admidio/admidio",
    "commit_url": "https://github.com/admidio/admidio/commit/3d8bafaa4e9b7a314ffdf548622a8c7b38faee8a",
    "files": [
      "adm_program/modules/ecards/ecard_send.php",
      "adm_program/modules/ecards/ecards.php",
      "adm_program/modules/photos/photos.php",
      "adm_program/system/classes/TablePhotos.php"
    ],
    "message": "ecard could sent if album is logged #1432",
    "before_after_code_files": [
      "adm_program/modules/ecards/ecard_send.php||adm_program/modules/ecards/ecard_send.php",
      "adm_program/modules/ecards/ecards.php||adm_program/modules/ecards/ecards.php",
      "adm_program/modules/photos/photos.php||adm_program/modules/photos/photos.php",
      "adm_program/system/classes/TablePhotos.php||adm_program/system/classes/TablePhotos.php"
    ]
  },
  "patch_diff": {
    "adm_program/modules/ecards/ecard_send.php||adm_program/modules/ecards/ecard_send.php": [
      "File: adm_program/modules/ecards/ecard_send.php -> adm_program/modules/ecards/ecard_send.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "11: require_once(__DIR__ . '/../../system/common.php');",
      "12: require_once(__DIR__ . '/ecard_function.php');",
      "15: $postTemplateName = admFuncVariableIsValid($_POST, 'ecard_template', 'file', array('requireValue' => true));",
      "16: $postPhotoUuid    = admFuncVariableIsValid($_POST, 'photo_uuid', 'string', array('requireValue' => true));",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "15: if (!$gSettingsManager->getBool('enable_ecard_module')) {",
      "16:     $gMessage->show($gL10n->get('SYS_MODULE_DISABLED'));",
      "18: }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "34: }",
      "40: }",
      "45: }",
      "",
      "[Removed Lines]",
      "37: if (!$gSettingsManager->getBool('enable_ecard_module')) {",
      "38:     $gMessage->show($gL10n->get('SYS_MODULE_DISABLED'));",
      "42: if (!$gValidLogin) {",
      "43:     $gMessage->show($gL10n->get('SYS_INVALID_PAGE_VIEW'));",
      "",
      "[Added Lines]",
      "43: if (!$photoAlbum->isVisible()) {",
      "44:     $gMessage->show($gL10n->get('SYS_INVALID_PAGE_VIEW'));",
      "49: if ($gValidLogin && $gCurrentUser->getValue('EMAIL') === '') {",
      "50:     $gMessage->show($gL10n->get('SYS_CURRENT_USER_NO_EMAIL', array('<a href=\"'.ADMIDIO_URL.FOLDER_MODULES.'/profile/profile.php\">', '</a>')));",
      "",
      "---------------"
    ],
    "adm_program/modules/ecards/ecards.php||adm_program/modules/ecards/ecards.php": [
      "File: adm_program/modules/ecards/ecards.php -> adm_program/modules/ecards/ecards.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "19: require(__DIR__ . '/../../system/login_valid.php');",
      "23: $getUserUuid  = admFuncVariableIsValid($_GET, 'user_uuid', 'string');",
      "24: $getPhotoNr   = admFuncVariableIsValid($_GET, 'photo_nr', 'int', array('requireValue' => true));",
      "25: $showPage     = admFuncVariableIsValid($_GET, 'show_page', 'int', array('defaultValue' => 1));",
      "",
      "[Removed Lines]",
      "22: $getPhotoUuid = admFuncVariableIsValid($_GET, 'photo_uuid', 'string');",
      "",
      "[Added Lines]",
      "22: $getPhotoUuid = admFuncVariableIsValid($_GET, 'photo_uuid', 'string', array('requireValue' => true));",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "36: }",
      "39: $gNavigation->addUrl(CURRENT_URL, $headline);",
      "42: if (isset($_SESSION['photo_album']) && (int) $_SESSION['photo_album']->getValue('pho_uuid') === $getPhotoUuid) {",
      "43:     $photoAlbum =& $_SESSION['photo_album'];",
      "44: } else {",
      "46:     $photoAlbum = new TablePhotos($gDb);",
      "51:     $_SESSION['photo_album'] = $photoAlbum;",
      "52: }",
      "56:     $gMessage->show($gL10n->get('SYS_INVALID_PAGE_VIEW'));",
      "58: }",
      "60: if ($gValidLogin && $gCurrentUser->getValue('EMAIL') === '') {",
      "63:     $gMessage->show($gL10n->get('SYS_CURRENT_USER_NO_EMAIL', array('<a href=\"'.ADMIDIO_URL.FOLDER_MODULES.'/profile/profile.php\">', '</a>')));",
      "65: }",
      "67: if ($getUserUuid !== '') {",
      "69:     $user = new User($gDb, $gProfileFields);",
      "70:     $user->readDataByUuid($getUserUuid);",
      "73:     if ((!$gCurrentUser->editUsers() && !isMember((int) $user->getValue('usr_id'))) || strlen($user->getValue('usr_id')) === 0) {",
      "74:         $gMessage->show($gL10n->get('SYS_USER_ID_NOT_FOUND'));",
      "76:     }",
      "79:     if (!StringUtils::strValidCharacters($user->getValue('EMAIL'), 'email')) {",
      "80:         $gMessage->show($gL10n->get('SYS_USER_NO_EMAIL', array($user->getValue('FIRST_NAME').' '.$user->getValue('LAST_NAME'))));",
      "",
      "[Removed Lines]",
      "47:     if ($getPhotoUuid !== '') {",
      "48:         $photoAlbum->readDataByUuid($getPhotoUuid);",
      "49:     }",
      "55: if ($getPhotoUuid !== '' && (int) $photoAlbum->getValue('pho_org_id') !== $gCurrentOrgId) {",
      "",
      "[Added Lines]",
      "46:     $photoAlbum->readDataByUuid($getPhotoUuid);",
      "52: if (!$photoAlbum->isVisible()) {",
      "",
      "---------------"
    ],
    "adm_program/modules/photos/photos.php||adm_program/modules/photos/photos.php": [
      "File: adm_program/modules/photos/photos.php -> adm_program/modules/photos/photos.php"
    ],
    "adm_program/system/classes/TablePhotos.php||adm_program/system/classes/TablePhotos.php": [
      "File: adm_program/system/classes/TablePhotos.php -> adm_program/system/classes/TablePhotos.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "232:             return false;",
      "233:         }",
      "236:             return false;",
      "237:         }",
      "",
      "[Removed Lines]",
      "235:         elseif ((int) $this->getValue('pho_locked') === 1 && !$GLOBALS['gCurrentUser']->editPhotoRight()) {",
      "",
      "[Added Lines]",
      "235:         elseif ($this->getValue('pho_locked') && !$GLOBALS['gCurrentUser']->editPhotoRight()) {",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "6c21ac3c5f9bd7cbe78c8523dd9bb4e0ef7863e6",
      "candidate_info": {
        "commit_hash": "6c21ac3c5f9bd7cbe78c8523dd9bb4e0ef7863e6",
        "repo": "admidio/admidio",
        "commit_url": "https://github.com/admidio/admidio/commit/6c21ac3c5f9bd7cbe78c8523dd9bb4e0ef7863e6",
        "files": [
          "adm_plugins/random_photo/random_photo.php",
          "adm_program/installation/db_scripts/preferences.php",
          "adm_program/installation/db_scripts/update_4_3.xml",
          "adm_program/modules/ecards/ecard_preview.php",
          "adm_program/modules/ecards/ecard_send.php",
          "adm_program/modules/ecards/ecards.php",
          "adm_program/modules/groups-roles/groups_roles.php",
          "adm_program/modules/groups-roles/groups_roles_new.php",
          "adm_program/modules/photos/photo_album_function.php",
          "adm_program/modules/photos/photo_album_new.php",
          "adm_program/modules/photos/photo_download.php",
          "adm_program/modules/photos/photo_function.php",
          "adm_program/modules/photos/photo_presenter.php",
          "adm_program/modules/photos/photo_show.php",
          "adm_program/modules/photos/photos.php",
          "adm_program/modules/photos/rss_photos.php",
          "adm_program/modules/preferences/preferences.php",
          "adm_program/modules/preferences/preferences_function.php",
          "adm_program/modules/profile/profile.php",
          "adm_program/system/classes/Component.php",
          "adm_program/system/classes/ECard.php",
          "adm_program/system/file_upload.php"
        ],
        "message": "rename ecard preferences",
        "before_after_code_files": [
          "adm_plugins/random_photo/random_photo.php||adm_plugins/random_photo/random_photo.php",
          "adm_program/installation/db_scripts/preferences.php||adm_program/installation/db_scripts/preferences.php",
          "adm_program/modules/ecards/ecard_preview.php||adm_program/modules/ecards/ecard_preview.php",
          "adm_program/modules/ecards/ecard_send.php||adm_program/modules/ecards/ecard_send.php",
          "adm_program/modules/ecards/ecards.php||adm_program/modules/ecards/ecards.php",
          "adm_program/modules/groups-roles/groups_roles.php||adm_program/modules/groups-roles/groups_roles.php",
          "adm_program/modules/groups-roles/groups_roles_new.php||adm_program/modules/groups-roles/groups_roles_new.php",
          "adm_program/modules/photos/photo_album_function.php||adm_program/modules/photos/photo_album_function.php",
          "adm_program/modules/photos/photo_album_new.php||adm_program/modules/photos/photo_album_new.php",
          "adm_program/modules/photos/photo_download.php||adm_program/modules/photos/photo_download.php",
          "adm_program/modules/photos/photo_function.php||adm_program/modules/photos/photo_function.php",
          "adm_program/modules/photos/photo_presenter.php||adm_program/modules/photos/photo_presenter.php",
          "adm_program/modules/photos/photo_show.php||adm_program/modules/photos/photo_show.php",
          "adm_program/modules/photos/photos.php||adm_program/modules/photos/photos.php",
          "adm_program/modules/photos/rss_photos.php||adm_program/modules/photos/rss_photos.php",
          "adm_program/modules/preferences/preferences.php||adm_program/modules/preferences/preferences.php",
          "adm_program/modules/preferences/preferences_function.php||adm_program/modules/preferences/preferences_function.php",
          "adm_program/modules/profile/profile.php||adm_program/modules/profile/profile.php",
          "adm_program/system/classes/Component.php||adm_program/system/classes/Component.php",
          "adm_program/system/classes/ECard.php||adm_program/system/classes/ECard.php",
          "adm_program/system/file_upload.php||adm_program/system/file_upload.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "adm_program/modules/ecards/ecard_send.php||adm_program/modules/ecards/ecard_send.php",
            "adm_program/modules/ecards/ecards.php||adm_program/modules/ecards/ecards.php",
            "adm_program/modules/photos/photos.php||adm_program/modules/photos/photos.php"
          ],
          "candidate": [
            "adm_program/modules/ecards/ecard_send.php||adm_program/modules/ecards/ecard_send.php",
            "adm_program/modules/ecards/ecards.php||adm_program/modules/ecards/ecards.php",
            "adm_program/modules/photos/photos.php||adm_program/modules/photos/photos.php"
          ]
        }
      },
      "candidate_diff": {
        "adm_plugins/random_photo/random_photo.php||adm_plugins/random_photo/random_photo.php": [
          "File: adm_plugins/random_photo/random_photo.php -> adm_plugins/random_photo/random_photo.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "55:     $plg_show_headline = 1;",
          "56: }",
          "59:     echo '<div id=\"plugin_'. $pluginFolder. '\" class=\"admidio-plugin-content\">';",
          "60:     if ($plg_show_headline) {",
          "61:         echo '<h3>'.$gL10n->get('SYS_PHOTOS').'</h3>';",
          "62:     }",
          "67:         $sql = 'SELECT *",
          "68:                   FROM '.TBL_PHOTOS.'",
          "",
          "[Removed Lines]",
          "58: if ($gSettingsManager->getInt('enable_photo_module') > 0) {",
          "64:     if ($gSettingsManager->getInt('enable_photo_module') === 1",
          "65:     || ($gSettingsManager->getInt('enable_photo_module') === 2 && $gValidLogin)) {",
          "",
          "[Added Lines]",
          "58: if ($gSettingsManager->getInt('photo_module_enabled') > 0) {",
          "64:     if ($gSettingsManager->getInt('photo_module_enabled') === 1",
          "65:     || ($gSettingsManager->getInt('photo_module_enabled') === 2 && $gValidLogin)) {",
          "",
          "---------------"
        ],
        "adm_program/installation/db_scripts/preferences.php||adm_program/installation/db_scripts/preferences.php": [
          "File: adm_program/installation/db_scripts/preferences.php -> adm_program/installation/db_scripts/preferences.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "97:     'max_file_upload_size'          => '3',",
          "102:     'photo_albums_per_page'  => '24',",
          "107:     'photo_image_text'       => '\u00a9 '.DOMAIN,",
          "108:     'photo_image_text_size'  => '40',",
          "109:     'photo_keep_original'    => '0',",
          "113:     'enable_guestbook_module'        => '0',",
          "",
          "[Removed Lines]",
          "100:     'enable_photo_module'    => '1',",
          "101:     'photo_show_mode'        => '1',",
          "103:     'photo_thumbs_page'      => '16',",
          "104:     'photo_thumbs_scale'     => '200',",
          "105:     'photo_show_width'       => '1000',",
          "106:     'photo_show_height'      => '800',",
          "110:     'photo_download_enabled' => '0',",
          "",
          "[Added Lines]",
          "101:     'photo_download_enabled' => '0',",
          "102:     'photo_ecard_enabled'    => '1',",
          "103:     'photo_ecard_scale'      => '500',",
          "104:     'photo_ecard_template'   => 'postcard.tpl',",
          "108:     'photo_module_enabled'   => '1',",
          "109:     'photo_show_width'       => '1000',",
          "110:     'photo_show_height'      => '800',",
          "111:     'photo_show_mode'        => '1',",
          "112:     'photo_thumbs_page'      => '16',",
          "113:     'photo_thumbs_scale'     => '200',",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "141:     'mail_template'               => 'default.html',",
          "142:     'max_email_attachment_size'   => '1',",
          "150:     'profile_log_edit_fields'   => '1',",
          "151:     'profile_show_map_link'     => '0',",
          "",
          "[Removed Lines]",
          "145:     'enable_ecard_module'       => '1',",
          "146:     'ecard_thumbs_scale'        => '500',",
          "147:     'ecard_template'            => 'postcard.tpl',",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "adm_program/modules/ecards/ecard_preview.php||adm_program/modules/ecards/ecard_preview.php": [
          "File: adm_program/modules/ecards/ecard_preview.php -> adm_program/modules/ecards/ecard_preview.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "14: require_once(__DIR__ . '/../../system/common.php');",
          "16: $gMessage->showThemeBody(false);",
          "17: $gMessage->showInModalWindow();",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "17: if (!$gSettingsManager->getBool('photo_ecard_enabled')) {",
          "18:     $gMessage->show($gL10n->get('SYS_MODULE_DISABLED'));",
          "20: }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "38: $emailRecipient   = admFuncVariableIsValid($_POST, 'email_recipient', 'string');",
          "39: $ecardMessage     = admFuncVariableIsValid($_POST, 'ecard_message', 'html');",
          "43: $funcClass = new ECard($gL10n);",
          "",
          "[Removed Lines]",
          "41: $imageUrl = SecurityUtils::encodeUrl(ADMIDIO_URL.FOLDER_MODULES.'/photos/photo_show.php', array('photo_uuid' => $postPhotoUuid, 'photo_nr' => $postPhotoNr, 'max_width' => $gSettingsManager->getInt('ecard_thumbs_scale'), 'max_height' => $gSettingsManager->getInt('ecard_thumbs_scale')));",
          "",
          "[Added Lines]",
          "47: $imageUrl = SecurityUtils::encodeUrl(ADMIDIO_URL.FOLDER_MODULES.'/photos/photo_show.php', array('photo_uuid' => $postPhotoUuid, 'photo_nr' => $postPhotoNr, 'max_width' => $gSettingsManager->getInt('photo_ecard_scale'), 'max_height' => $gSettingsManager->getInt('photo_ecard_scale')));",
          "",
          "---------------"
        ],
        "adm_program/modules/ecards/ecard_send.php||adm_program/modules/ecards/ecard_send.php": [
          "File: adm_program/modules/ecards/ecard_send.php -> adm_program/modules/ecards/ecard_send.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "11: require_once(__DIR__ . '/../../system/common.php');",
          "15:     $gMessage->show($gL10n->get('SYS_MODULE_DISABLED'));",
          "17: }",
          "",
          "[Removed Lines]",
          "14: if (!$gSettingsManager->getBool('enable_ecard_module')) {",
          "",
          "[Added Lines]",
          "14: if (!$gSettingsManager->getBool('photo_ecard_enabled')) {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "25: $funcClass       = new ECard($gL10n);",
          "26: $photoAlbum      = new TablePhotos($gDb);",
          "27: $photoAlbum->readDataByUuid($postPhotoUuid);",
          "29: $imageServerPath = ADMIDIO_PATH . FOLDER_DATA . '/photos/'.$photoAlbum->getValue('pho_begin', 'Y-m-d').'_'.$photoAlbum->getValue('pho_id').'/'.$postPhotoNr.'.jpg';",
          "31: $_SESSION['ecard_request'] = $_POST;",
          "",
          "[Removed Lines]",
          "28: $imageUrl        = SecurityUtils::encodeUrl(ADMIDIO_URL.FOLDER_MODULES.'/photos/photo_show.php', array('photo_uuid' => $postPhotoUuid, 'photo_nr' => $postPhotoNr, 'max_width' => $gSettingsManager->getInt('ecard_thumbs_scale'), 'max_height' => $gSettingsManager->getInt('ecard_thumbs_scale')));",
          "",
          "[Added Lines]",
          "28: $imageUrl        = SecurityUtils::encodeUrl(ADMIDIO_URL.FOLDER_MODULES.'/photos/photo_show.php', array('photo_uuid' => $postPhotoUuid, 'photo_nr' => $postPhotoNr, 'max_width' => $gSettingsManager->getInt('photo_ecard_scale'), 'max_height' => $gSettingsManager->getInt('photo_ecard_scale')));",
          "",
          "---------------"
        ],
        "adm_program/modules/ecards/ecards.php||adm_program/modules/ecards/ecards.php": [
          "File: adm_program/modules/ecards/ecards.php -> adm_program/modules/ecards/ecards.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "17: require_once(__DIR__ . '/../../system/common.php');",
          "18: require(__DIR__ . '/../../system/login_valid.php');",
          "21: $getPhotoUuid = admFuncVariableIsValid($_GET, 'photo_uuid', 'string', array('requireValue' => true));",
          "22: $getUserUuid  = admFuncVariableIsValid($_GET, 'user_uuid', 'string');",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "21: if (!$gSettingsManager->getBool('photo_ecard_enabled')) {",
          "22:     $gMessage->show($gL10n->get('SYS_MODULE_DISABLED'));",
          "24: }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "28: $templates = $funcClass->getFileNames(ADMIDIO_PATH . FOLDER_DATA . '/ecard_templates');",
          "29: $headline  = $gL10n->get('SYS_SEND_GREETING_CARD');",
          "38: $gNavigation->addUrl(CURRENT_URL, $headline);",
          "",
          "[Removed Lines]",
          "32: if (!$gSettingsManager->getBool('enable_ecard_module')) {",
          "33:     $gMessage->show($gL10n->get('SYS_MODULE_DISABLED'));",
          "35: }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "84:     $recipients = $_SESSION['ecard_request']['ecard_recipients'];",
          "85:     $message    = $_SESSION['ecard_request']['ecard_message'];",
          "86: } else {",
          "88:     $recipients = null;",
          "89:     $message    = '';",
          "90: }",
          "",
          "[Removed Lines]",
          "87:     $template   = $gSettingsManager->getString('ecard_template');",
          "",
          "[Added Lines]",
          "87:     $template   = $gSettingsManager->getString('photo_ecard_template');",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "131: $form->addCustomContent($gL10n->get('SYS_PHOTO'), '",
          "132:     <a data-toggle=\"lightbox\" data-type=\"image\" data-title=\"'.$gL10n->get('SYS_PREVIEW').'\"",
          "133:         href=\"'.SecurityUtils::encodeUrl(ADMIDIO_URL.FOLDER_MODULES.'/photos/photo_show.php', array('photo_uuid' => $getPhotoUuid, 'photo_nr' => $getPhotoNr, 'max_width' => $gSettingsManager->getInt('photo_show_width'), 'max_height' => $gSettingsManager->getInt('photo_show_height'))).'\"><img",
          "135:         class=\"imageFrame\" alt=\"'.$gL10n->get('SYS_VIEW_PICTURE_FULL_SIZED').'\"  title=\"'.$gL10n->get('SYS_VIEW_PICTURE_FULL_SIZED').'\" />",
          "136:     </a>');",
          "137: $templates = array_keys(FileSystemUtils::getDirectoryContent(ADMIDIO_PATH . FOLDER_DATA . '/ecard_templates', false, false, array(FileSystemUtils::CONTENT_TYPE_FILE)));",
          "",
          "[Removed Lines]",
          "134:         src=\"'.SecurityUtils::encodeUrl(ADMIDIO_URL.FOLDER_MODULES.'/photos/photo_show.php', array('photo_uuid' => $getPhotoUuid, 'photo_nr' => $getPhotoNr, 'max_width' => $gSettingsManager->getInt('ecard_thumbs_scale'), 'max_height' => $gSettingsManager->getInt('ecard_thumbs_scale'))).'\"",
          "",
          "[Added Lines]",
          "134:         src=\"'.SecurityUtils::encodeUrl(ADMIDIO_URL.FOLDER_MODULES.'/photos/photo_show.php', array('photo_uuid' => $getPhotoUuid, 'photo_nr' => $getPhotoNr, 'max_width' => $gSettingsManager->getInt('photo_ecard_scale'), 'max_height' => $gSettingsManager->getInt('photo_ecard_scale'))).'\"",
          "",
          "---------------"
        ],
        "adm_program/modules/groups-roles/groups_roles.php||adm_program/modules/groups-roles/groups_roles.php": [
          "File: adm_program/modules/groups-roles/groups_roles.php -> adm_program/modules/groups-roles/groups_roles.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "410:         if ($role->getValue('rol_dates') == 1 && (int) $gSettingsManager->get('enable_dates_module') > 0) {",
          "411:             $assignRoles .= '<i class=\"admidio-icon-chain fas fa-calendar-alt\" data-toggle=\"tooltip\" title=\"'.$gL10n->get('SYS_RIGHT_DATES').'\"></i>';",
          "412:         }",
          "414:             $assignRoles .= '<i class=\"admidio-icon-chain fas fa-image\" data-toggle=\"tooltip\" title=\"'.$gL10n->get('SYS_RIGHT_PHOTOS').'\"></i>';",
          "415:         }",
          "416:         if ($role->getValue('rol_documents_files') == 1 && (int) $gSettingsManager->getBool('documents_files_enable_module')) {",
          "",
          "[Removed Lines]",
          "413:         if ($role->getValue('rol_photo') == 1 && (int) $gSettingsManager->get('enable_photo_module') > 0) {",
          "",
          "[Added Lines]",
          "413:         if ($role->getValue('rol_photo') == 1 && (int) $gSettingsManager->get('photo_module_enabled') > 0) {",
          "",
          "---------------"
        ],
        "adm_program/modules/groups-roles/groups_roles_new.php||adm_program/modules/groups-roles/groups_roles_new.php": [
          "File: adm_program/modules/groups-roles/groups_roles_new.php -> adm_program/modules/groups-roles/groups_roles_new.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "308:             array('helpTextIdLabel' => 'SYS_ROLES_MODULE_ADMINISTRATORS_DESC', 'icon' => 'fa-calendar-alt')",
          "309:         );",
          "310:     }",
          "312:         $form->addCheckbox(",
          "313:             'rol_photo',",
          "314:             $gL10n->get('SYS_RIGHT_PHOTOS'),",
          "",
          "[Removed Lines]",
          "311:     if ((int) $gSettingsManager->get('enable_photo_module') > 0) {",
          "",
          "[Added Lines]",
          "311:     if ((int) $gSettingsManager->get('photo_module_enabled') > 0) {",
          "",
          "---------------"
        ],
        "adm_program/modules/photos/photo_album_function.php||adm_program/modules/photos/photo_album_function.php": [
          "File: adm_program/modules/photos/photo_album_function.php -> adm_program/modules/photos/photo_album_function.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "25: $getMode      = admFuncVariableIsValid($_GET, 'mode', 'string', array('requireValue' => true, 'validValues' => array('new', 'change', 'delete', 'lock', 'unlock')));",
          "30:     $gMessage->show($gL10n->get('SYS_MODULE_DISABLED'));",
          "",
          "[Removed Lines]",
          "28: if ((int) $gSettingsManager->get('enable_photo_module') === 0) {",
          "",
          "[Added Lines]",
          "28: if ((int) $gSettingsManager->get('photo_module_enabled') === 0) {",
          "",
          "---------------"
        ],
        "adm_program/modules/photos/photo_album_new.php||adm_program/modules/photos/photo_album_new.php": [
          "File: adm_program/modules/photos/photo_album_new.php -> adm_program/modules/photos/photo_album_new.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "23: $photoAlbumsArray = array('ALL' => $gL10n->get('PHO_PHOTO_ALBUMS'));",
          "27:     $gMessage->show($gL10n->get('SYS_MODULE_DISABLED'));",
          "29: }",
          "",
          "[Removed Lines]",
          "26: if ((int) $gSettingsManager->get('enable_photo_module') === 0) {",
          "",
          "[Added Lines]",
          "26: if ((int) $gSettingsManager->get('photo_module_enabled') === 0) {",
          "",
          "---------------"
        ],
        "adm_program/modules/photos/photo_download.php||adm_program/modules/photos/photo_download.php": [
          "File: adm_program/modules/photos/photo_download.php -> adm_program/modules/photos/photo_download.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "27: $getPhotoNr   = admFuncVariableIsValid($_GET, 'photo_nr', 'int');",
          "31:     $gMessage->show($gL10n->get('SYS_MODULE_DISABLED'));",
          "35:     require(__DIR__ . '/../../system/login_valid.php');",
          "36: }",
          "",
          "[Removed Lines]",
          "30: if ((int) $gSettingsManager->get('enable_photo_module') === 0) {",
          "33: } elseif ((int) $gSettingsManager->get('enable_photo_module') === 2) {",
          "",
          "[Added Lines]",
          "30: if ((int) $gSettingsManager->get('photo_module_enabled') === 0) {",
          "33: } elseif ((int) $gSettingsManager->get('photo_module_enabled') === 2) {",
          "",
          "---------------"
        ],
        "adm_program/modules/photos/photo_function.php||adm_program/modules/photos/photo_function.php": [
          "File: adm_program/modules/photos/photo_function.php -> adm_program/modules/photos/photo_function.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "26: $getPhotoNr   = admFuncVariableIsValid($_GET, 'photo_nr', 'int', array('requireValue' => true));",
          "27: $getDirection = admFuncVariableIsValid($_GET, 'direction', 'string', array('validValues' => array('left', 'right')));",
          "31:     $gMessage->show($gL10n->get('SYS_MODULE_DISABLED'));",
          "",
          "[Removed Lines]",
          "29: if ((int) $gSettingsManager->get('enable_photo_module') === 0) {",
          "",
          "[Added Lines]",
          "29: if ((int) $gSettingsManager->get('photo_module_enabled') === 0) {",
          "",
          "---------------"
        ],
        "adm_program/modules/photos/photo_presenter.php||adm_program/modules/photos/photo_presenter.php": [
          "File: adm_program/modules/photos/photo_presenter.php -> adm_program/modules/photos/photo_presenter.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "24: $getPhotoNr   = admFuncVariableIsValid($_GET, 'photo_nr', 'int', array('requireValue' => true));",
          "28:     $gMessage->show($gL10n->get('SYS_MODULE_DISABLED'));",
          "32:     require(__DIR__ . '/../../system/login_valid.php');",
          "33: }",
          "",
          "[Removed Lines]",
          "27: if ((int) $gSettingsManager->get('enable_photo_module') === 0) {",
          "30: } elseif ((int) $gSettingsManager->get('enable_photo_module') === 2) {",
          "",
          "[Added Lines]",
          "27: if ((int) $gSettingsManager->get('photo_module_enabled') === 0) {",
          "30: } elseif ((int) $gSettingsManager->get('photo_module_enabled') === 2) {",
          "",
          "---------------"
        ],
        "adm_program/modules/photos/photo_show.php||adm_program/modules/photos/photo_show.php": [
          "File: adm_program/modules/photos/photo_show.php -> adm_program/modules/photos/photo_show.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "34: $image        = null;",
          "38:     $gMessage->show($gL10n->get('SYS_MODULE_DISABLED'));",
          "42:     require(__DIR__ . '/../../system/login_valid.php');",
          "43: }",
          "",
          "[Removed Lines]",
          "37: if ((int) $gSettingsManager->get('enable_photo_module') === 0) {",
          "40: } elseif ((int) $gSettingsManager->get('enable_photo_module') === 2) {",
          "",
          "[Added Lines]",
          "37: if ((int) $gSettingsManager->get('photo_module_enabled') === 0) {",
          "40: } elseif ((int) $gSettingsManager->get('photo_module_enabled') === 2) {",
          "",
          "---------------"
        ],
        "adm_program/modules/photos/photos.php||adm_program/modules/photos/photos.php": [
          "File: adm_program/modules/photos/photos.php -> adm_program/modules/photos/photos.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "19: require_once(__DIR__ . '/../../system/common.php');",
          "23:     $gMessage->show($gL10n->get('SYS_MODULE_DISABLED'));",
          "27:     require(__DIR__ . '/../../system/login_valid.php');",
          "28: }",
          "",
          "[Removed Lines]",
          "22: if ((int) $gSettingsManager->get('enable_photo_module') === 0) {",
          "25: } elseif ((int) $gSettingsManager->get('enable_photo_module') === 2) {",
          "",
          "[Added Lines]",
          "22: if ((int) $gSettingsManager->get('photo_module_enabled') === 0) {",
          "25: } elseif ((int) $gSettingsManager->get('photo_module_enabled') === 2) {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "228:                         </a>';",
          "229:             }",
          "232:                 $photoThumbnailTable .= '<div id=\"image_preferences_'.$actThumbnail.'\" class=\"text-center\" style=\"width: ' . $gSettingsManager->getInt('photo_thumbs_scale') . 'px\">';",
          "233:             }",
          "237:                 $photoThumbnailTable .= '",
          "238:                         <a class=\"admidio-icon-link\" href=\"'.SecurityUtils::encodeUrl(ADMIDIO_URL.FOLDER_MODULES.'/ecards/ecards.php', array('photo_nr' => $actThumbnail, 'photo_uuid' => $getPhotoUuid, 'show_page' => $getPhotoNr)).'\">",
          "239:                             <i class=\"fas fa-envelope\" data-toggle=\"tooltip\" title=\"'.$gL10n->get('PHO_PHOTO_SEND_ECARD').'\"></i></a>';",
          "",
          "[Removed Lines]",
          "231:             if ($gCurrentUser->editPhotoRight() || ($gValidLogin && $gSettingsManager->getBool('enable_ecard_module')) || $gSettingsManager->getBool('photo_download_enabled')) {",
          "236:             if ($gValidLogin && $gSettingsManager->getBool('enable_ecard_module')) {",
          "",
          "[Added Lines]",
          "231:             if ($gCurrentUser->editPhotoRight() || ($gValidLogin && $gSettingsManager->getBool('photo_ecard_enabled')) || $gSettingsManager->getBool('photo_download_enabled')) {",
          "236:             if ($gValidLogin && $gSettingsManager->getBool('photo_ecard_enabled')) {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "259:                             <i class=\"fas fa-trash-alt\" data-toggle=\"tooltip\" title=\"'.$gL10n->get('SYS_DELETE').'\"></i></a>';",
          "260:             }",
          "263:                 $photoThumbnailTable .= '</div>';",
          "264:             }",
          "265:             $photoThumbnailTable .= '</div>';",
          "",
          "[Removed Lines]",
          "262:             if ($gCurrentUser->editPhotoRight() || ($gValidLogin && $gSettingsManager->getBool('enable_ecard_module')) || $gSettingsManager->getBool('photo_download_enabled')) {",
          "",
          "[Added Lines]",
          "262:             if ($gCurrentUser->editPhotoRight() || ($gValidLogin && $gSettingsManager->getBool('photo_ecard_enabled')) || $gSettingsManager->getBool('photo_download_enabled')) {",
          "",
          "---------------"
        ],
        "adm_program/modules/photos/rss_photos.php||adm_program/modules/photos/rss_photos.php": [
          "File: adm_program/modules/photos/rss_photos.php -> adm_program/modules/photos/rss_photos.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "31: }",
          "35:     $gMessage->show($gL10n->get('SYS_MODULE_DISABLED'));",
          "39:     require(__DIR__ . '/../../system/login_valid.php');",
          "40: }",
          "",
          "[Removed Lines]",
          "34: if ((int) $gSettingsManager->get('enable_photo_module') === 0) {",
          "37: } elseif ((int) $gSettingsManager->get('enable_photo_module') === 2) {",
          "",
          "[Added Lines]",
          "34: if ((int) $gSettingsManager->get('photo_module_enabled') === 0) {",
          "37: } elseif ((int) $gSettingsManager->get('photo_module_enabled') === 2) {",
          "",
          "---------------"
        ],
        "adm_program/modules/preferences/preferences.php||adm_program/modules/preferences/preferences.php": [
          "File: adm_program/modules/preferences/preferences.php -> adm_program/modules/preferences/preferences.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "1179:     '2' => $gL10n->get('ORG_ONLY_FOR_REGISTERED_USER')",
          "1180: );",
          "1181: $formPhotos->addSelectBox(",
          "1183:     $gL10n->get('ORG_ACCESS_TO_MODULE'),",
          "1184:     $selectBoxEntries,",
          "1186: );",
          "1187: $selectBoxEntries = array(",
          "1188:     '1' => $gL10n->get('PHO_MODAL_WINDOW'),",
          "",
          "[Removed Lines]",
          "1182:     'enable_photo_module',",
          "1185:     array('defaultValue' => $formValues['enable_photo_module'], 'showContextDependentFirstEntry' => false, 'helpTextIdInline' => 'ORG_ACCESS_TO_MODULE_DESC')",
          "",
          "[Added Lines]",
          "1182:     'photo_module_enabled',",
          "1185:     array('defaultValue' => $formValues['photo_module_enabled'], 'showContextDependentFirstEntry' => false, 'helpTextIdInline' => 'ORG_ACCESS_TO_MODULE_DESC')",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1336: );",
          "1338: $formEcards->addCheckbox(",
          "1340:     $gL10n->get('SYS_ENABLE_GREETING_CARDS'),",
          "1342:     array('helpTextIdInline' => 'SYS_ENABLE_GREETING_CARDS_DESC')",
          "1343: );",
          "1344: $formEcards->addInput(",
          "1346:     $gL10n->get('PHO_SCALE_THUMBNAILS'),",
          "1348:     array('type' => 'number', 'minNumber' => 1, 'maxNumber' => 9999, 'step' => 1, 'helpTextIdInline' => array('SYS_ECARD_MAX_PHOTO_SIZE_DESC', array(500)))",
          "1349: );",
          "",
          "[Removed Lines]",
          "1339:     'enable_ecard_module',",
          "1341:     (bool) $formValues['enable_ecard_module'],",
          "1345:     'ecard_thumbs_scale',",
          "1347:     $formValues['ecard_thumbs_scale'],",
          "",
          "[Added Lines]",
          "1339:     'photo_ecard_enabled',",
          "1341:     (bool) $formValues['photo_ecard_enabled'],",
          "1345:     'photo_ecard_scale',",
          "1347:     $formValues['photo_ecard_scale'],",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1361: unset($templateName);",
          "1363: $formEcards->addSelectBox(",
          "1365:     $gL10n->get('SYS_TEMPLATE'),",
          "1366:     $ecardTemplatesFiles,",
          "1368: );",
          "1369: $formEcards->addSubmitButton(",
          "1370:     'btn_save_ecards',",
          "",
          "[Removed Lines]",
          "1364:     'ecard_template',",
          "1367:     array('defaultValue' => $formValues['ecard_template'], 'showContextDependentFirstEntry' => false, 'firstEntry' => $gL10n->get('SYS_NO_TEMPLATE'), 'arrayKeyIsNotValue' => true, 'helpTextIdInline' => 'SYS_TEMPLATE_DESC')",
          "",
          "[Added Lines]",
          "1364:     'photo_ecard_template',",
          "1367:     array('defaultValue' => $formValues['photo_ecard_template'], 'showContextDependentFirstEntry' => false, 'firstEntry' => $gL10n->get('SYS_NO_TEMPLATE'), 'arrayKeyIsNotValue' => true, 'helpTextIdInline' => 'SYS_TEMPLATE_DESC')",
          "",
          "---------------"
        ],
        "adm_program/modules/preferences/preferences_function.php||adm_program/modules/preferences/preferences_function.php": [
          "File: adm_program/modules/preferences/preferences_function.php -> adm_program/modules/preferences/preferences_function.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "164:                     break;",
          "166:                 case 'ecards':",
          "168:                     break;",
          "170:                 case 'groups-roles':",
          "",
          "[Removed Lines]",
          "167:                     $checkboxes = array('enable_ecard_module');",
          "",
          "[Added Lines]",
          "167:                     $checkboxes = array('photo_ecard_enabled');",
          "",
          "---------------"
        ],
        "adm_program/modules/profile/profile.php||adm_program/modules/profile/profile.php": [
          "File: adm_program/modules/profile/profile.php -> adm_program/modules/profile/profile.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "590:                 'icon'  => 'fa-calendar-alt'",
          "591:             );",
          "592:         }",
          "594:             $profileRightsArray[] = array(",
          "595:                 'roles' => $rightsOrigin['rol_photo'],",
          "596:                 'right' => $gL10n->get('SYS_RIGHT_PHOTOS'),",
          "",
          "[Removed Lines]",
          "593:         if ($user->checkRolesRight('rol_photo') && (int) $gSettingsManager->get('enable_photo_module') > 0) {",
          "",
          "[Added Lines]",
          "593:         if ($user->checkRolesRight('rol_photo') && (int) $gSettingsManager->get('photo_module_enabled') > 0) {",
          "",
          "---------------"
        ],
        "adm_program/system/classes/Component.php||adm_program/system/classes/Component.php": [
          "File: adm_program/system/classes/Component.php -> adm_program/system/classes/Component.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "280:                 break;",
          "282:             case 'PHOTOS':",
          "285:                     return true;",
          "286:                 }",
          "287:                 break;",
          "",
          "[Removed Lines]",
          "283:                 if ((int) $gSettingsManager->get('enable_photo_module') === 1",
          "284:                 || ((int) $gSettingsManager->get('enable_photo_module') === 2 && $gValidLogin)) {",
          "",
          "[Added Lines]",
          "283:                 if ((int) $gSettingsManager->get('photo_module_enabled') === 1",
          "284:                 || ((int) $gSettingsManager->get('photo_module_enabled') === 2 && $gValidLogin)) {",
          "",
          "---------------"
        ],
        "adm_program/system/classes/ECard.php||adm_program/system/classes/ECard.php": [
          "File: adm_program/system/classes/ECard.php -> adm_program/system/classes/ECard.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "197:                     $imgPhotoPath  = $imgServerPath;",
          "199:                     $imageSized = new Image($photoServerPath);",
          "201:                     $imageSized->copyToFile(null, $imgServerPath);",
          "202:                 }",
          "",
          "[Removed Lines]",
          "200:                     $imageSized->scale($gSettingsManager->getInt('ecard_thumbs_scale'), $gSettingsManager->getInt('ecard_thumbs_scale'));",
          "",
          "[Added Lines]",
          "200:                     $imageSized->scale($gSettingsManager->getInt('photo_ecard_scale'), $gSettingsManager->getInt('photo_ecard_scale'));",
          "",
          "---------------"
        ],
        "adm_program/system/file_upload.php||adm_program/system/file_upload.php": [
          "File: adm_program/system/file_upload.php -> adm_program/system/file_upload.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "33: if ($getModule === 'photos') {",
          "36:         $gMessage->show($gL10n->get('SYS_MODULE_DISABLED'));",
          "38:     }",
          "",
          "[Removed Lines]",
          "35:     if ((int) $gSettingsManager->get('enable_photo_module') === 0) {",
          "",
          "[Added Lines]",
          "35:     if ((int) $gSettingsManager->get('photo_module_enabled') === 0) {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "54e28814a33ffc2315dfa901a44978a7632bfc78",
      "candidate_info": {
        "commit_hash": "54e28814a33ffc2315dfa901a44978a7632bfc78",
        "repo": "admidio/admidio",
        "commit_url": "https://github.com/admidio/admidio/commit/54e28814a33ffc2315dfa901a44978a7632bfc78",
        "files": [
          "adm_program/modules/ecards/ecard_send.php",
          "adm_program/modules/ecards/ecards.php",
          "adm_program/modules/photos/photos.php",
          "adm_program/system/classes/TablePhotos.php"
        ],
        "message": "ecard could sent if album is logged #1432",
        "before_after_code_files": [
          "adm_program/modules/ecards/ecard_send.php||adm_program/modules/ecards/ecard_send.php",
          "adm_program/modules/ecards/ecards.php||adm_program/modules/ecards/ecards.php",
          "adm_program/modules/photos/photos.php||adm_program/modules/photos/photos.php",
          "adm_program/system/classes/TablePhotos.php||adm_program/system/classes/TablePhotos.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "adm_program/modules/ecards/ecard_send.php||adm_program/modules/ecards/ecard_send.php",
            "adm_program/modules/ecards/ecards.php||adm_program/modules/ecards/ecards.php",
            "adm_program/modules/photos/photos.php||adm_program/modules/photos/photos.php",
            "adm_program/system/classes/TablePhotos.php||adm_program/system/classes/TablePhotos.php"
          ],
          "candidate": [
            "adm_program/modules/ecards/ecard_send.php||adm_program/modules/ecards/ecard_send.php",
            "adm_program/modules/ecards/ecards.php||adm_program/modules/ecards/ecards.php",
            "adm_program/modules/photos/photos.php||adm_program/modules/photos/photos.php",
            "adm_program/system/classes/TablePhotos.php||adm_program/system/classes/TablePhotos.php"
          ]
        }
      },
      "candidate_diff": {
        "adm_program/modules/ecards/ecard_send.php||adm_program/modules/ecards/ecard_send.php": [
          "File: adm_program/modules/ecards/ecard_send.php -> adm_program/modules/ecards/ecard_send.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "11: require_once(__DIR__ . '/../../system/common.php');",
          "12: require_once(__DIR__ . '/ecard_function.php');",
          "15: $postTemplateName = admFuncVariableIsValid($_POST, 'ecard_template', 'file', array('requireValue' => true));",
          "16: $postPhotoUuid    = admFuncVariableIsValid($_POST, 'photo_uuid', 'string', array('requireValue' => true));",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "15: if (!$gSettingsManager->getBool('enable_ecard_module')) {",
          "16:     $gMessage->show($gL10n->get('SYS_MODULE_DISABLED'));",
          "18: }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "34: }",
          "40: }",
          "45: }",
          "",
          "[Removed Lines]",
          "37: if (!$gSettingsManager->getBool('enable_ecard_module')) {",
          "38:     $gMessage->show($gL10n->get('SYS_MODULE_DISABLED'));",
          "42: if (!$gValidLogin) {",
          "43:     $gMessage->show($gL10n->get('SYS_INVALID_PAGE_VIEW'));",
          "",
          "[Added Lines]",
          "43: if (!$photoAlbum->isVisible()) {",
          "44:     $gMessage->show($gL10n->get('SYS_INVALID_PAGE_VIEW'));",
          "49: if ($gValidLogin && $gCurrentUser->getValue('EMAIL') === '') {",
          "50:     $gMessage->show($gL10n->get('SYS_CURRENT_USER_NO_EMAIL', array('<a href=\"'.ADMIDIO_URL.FOLDER_MODULES.'/profile/profile.php\">', '</a>')));",
          "",
          "---------------"
        ],
        "adm_program/modules/ecards/ecards.php||adm_program/modules/ecards/ecards.php": [
          "File: adm_program/modules/ecards/ecards.php -> adm_program/modules/ecards/ecards.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "19: require(__DIR__ . '/../../system/login_valid.php');",
          "23: $getUserUuid  = admFuncVariableIsValid($_GET, 'user_uuid', 'string');",
          "24: $getPhotoNr   = admFuncVariableIsValid($_GET, 'photo_nr', 'int', array('requireValue' => true));",
          "25: $showPage     = admFuncVariableIsValid($_GET, 'show_page', 'int', array('defaultValue' => 1));",
          "",
          "[Removed Lines]",
          "22: $getPhotoUuid = admFuncVariableIsValid($_GET, 'photo_uuid', 'string');",
          "",
          "[Added Lines]",
          "22: $getPhotoUuid = admFuncVariableIsValid($_GET, 'photo_uuid', 'string', array('requireValue' => true));",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "36: }",
          "39: $gNavigation->addUrl(CURRENT_URL, $headline);",
          "42: if (isset($_SESSION['photo_album']) && (int) $_SESSION['photo_album']->getValue('pho_uuid') === $getPhotoUuid) {",
          "43:     $photoAlbum =& $_SESSION['photo_album'];",
          "44: } else {",
          "46:     $photoAlbum = new TablePhotos($gDb);",
          "51:     $_SESSION['photo_album'] = $photoAlbum;",
          "52: }",
          "56:     $gMessage->show($gL10n->get('SYS_INVALID_PAGE_VIEW'));",
          "58: }",
          "60: if ($gValidLogin && $gCurrentUser->getValue('EMAIL') === '') {",
          "63:     $gMessage->show($gL10n->get('SYS_CURRENT_USER_NO_EMAIL', array('<a href=\"'.ADMIDIO_URL.FOLDER_MODULES.'/profile/profile.php\">', '</a>')));",
          "65: }",
          "67: if ($getUserUuid !== '') {",
          "69:     $user = new User($gDb, $gProfileFields);",
          "70:     $user->readDataByUuid($getUserUuid);",
          "73:     if ((!$gCurrentUser->editUsers() && !isMember((int) $user->getValue('usr_id'))) || strlen($user->getValue('usr_id')) === 0) {",
          "74:         $gMessage->show($gL10n->get('SYS_USER_ID_NOT_FOUND'));",
          "76:     }",
          "79:     if (!StringUtils::strValidCharacters($user->getValue('EMAIL'), 'email')) {",
          "80:         $gMessage->show($gL10n->get('SYS_USER_NO_EMAIL', array($user->getValue('FIRST_NAME').' '.$user->getValue('LAST_NAME'))));",
          "",
          "[Removed Lines]",
          "47:     if ($getPhotoUuid !== '') {",
          "48:         $photoAlbum->readDataByUuid($getPhotoUuid);",
          "49:     }",
          "55: if ($getPhotoUuid !== '' && (int) $photoAlbum->getValue('pho_org_id') !== $gCurrentOrgId) {",
          "",
          "[Added Lines]",
          "46:     $photoAlbum->readDataByUuid($getPhotoUuid);",
          "52: if (!$photoAlbum->isVisible()) {",
          "",
          "---------------"
        ],
        "adm_program/modules/photos/photos.php||adm_program/modules/photos/photos.php": [
          "File: adm_program/modules/photos/photos.php -> adm_program/modules/photos/photos.php"
        ],
        "adm_program/system/classes/TablePhotos.php||adm_program/system/classes/TablePhotos.php": [
          "File: adm_program/system/classes/TablePhotos.php -> adm_program/system/classes/TablePhotos.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "232:             return false;",
          "233:         }",
          "236:             return false;",
          "237:         }",
          "",
          "[Removed Lines]",
          "235:         elseif ((int) $this->getValue('pho_locked') === 1 && !$GLOBALS['gCurrentUser']->editPhotoRight()) {",
          "",
          "[Added Lines]",
          "235:         elseif ($this->getValue('pho_locked') && !$GLOBALS['gCurrentUser']->editPhotoRight()) {",
          "",
          "---------------"
        ]
      }
    }
  ]
}