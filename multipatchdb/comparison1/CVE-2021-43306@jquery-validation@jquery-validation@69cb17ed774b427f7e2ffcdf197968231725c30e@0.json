{
  "cve_id": "CVE-2021-43306",
  "cve_desc": "An exponential ReDoS (Regular Expression Denial of Service) can be triggered in the jquery-validation npm package, when an attacker is able to supply arbitrary input to the url2 method",
  "repo": "jquery-validation/jquery-validation",
  "patch_hash": "69cb17ed774b427f7e2ffcdf197968231725c30e",
  "patch_info": {
    "commit_hash": "69cb17ed774b427f7e2ffcdf197968231725c30e",
    "repo": "jquery-validation/jquery-validation",
    "commit_url": "https://github.com/jquery-validation/jquery-validation/commit/69cb17ed774b427f7e2ffcdf197968231725c30e",
    "files": [
      "src/additional/url2.js",
      "test/methods.js"
    ],
    "message": "Core: fix ReDoS vulnerability in url2 (#2428)",
    "before_after_code_files": [
      "src/additional/url2.js||src/additional/url2.js",
      "test/methods.js||test/methods.js"
    ]
  },
  "patch_diff": {
    "src/additional/url2.js||src/additional/url2.js": [
      "File: src/additional/url2.js -> src/additional/url2.js",
      "--- Hunk 1 ---",
      "[Context before]",
      "2: $.validator.addMethod( \"url2\", function( value, element ) {",
      "4: }, $.validator.messages.url );",
      "",
      "[Removed Lines]",
      "3:  return this.optional( element ) || /^(https?|ftp):\\/\\/(((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:)*@)?(((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5]))|((([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.)*(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.?)(:\\d*)?)(\\/((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)+(\\/(([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)*)*)?)?(\\?((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)|[\\uE000-\\uF8FF]|\\/|\\?)*)?(#((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)|\\/|\\?)*)?$/i.test( value );",
      "",
      "[Added Lines]",
      "3:  return this.optional( element ) || /^(?:(?:(?:https?|ftp):)?\\/\\/)(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z0-9\\u00a1-\\uffff][a-z0-9\\u00a1-\\uffff_-]{0,62})?[a-z0-9\\u00a1-\\uffff]\\.?)+(?:[a-z\\u00a1-\\uffff]{2,}\\.?))(?::\\d{2,5})?(?:[/?#]\\S*)?$/i.test( value );",
      "",
      "---------------"
    ],
    "test/methods.js||test/methods.js": [
      "File: test/methods.js -> test/methods.js",
      "--- Hunk 1 ---",
      "[Context before]",
      "122:  assert.ok( method( \"ftp://bassistance.de/jquery/plugin.php?bla=blu\" ), \"Valid url\" );",
      "123:  assert.ok( method( \"http://www.f\u00f8tex.dk/\" ), \"Valid url, danish unicode characters\" );",
      "124:  assert.ok( method( \"http://b\u00f6sendorfer.de/\" ), \"Valid url, german unicode characters\" );",
      "126:  assert.ok( !method( \"http://192.168.8.\" ), \"Invalid IP Address\" );",
      "127:  assert.ok( method( \"http://bassistance\" ), \"Invalid url\" );",
      "128:  assert.ok( method( \"http://bassistance.\" ), \"Invalid url\" );",
      "",
      "[Removed Lines]",
      "125:  assert.ok( method( \"http://192.168.8.5\" ), \"Valid IP Address\" );",
      "",
      "[Added Lines]",
      "125:  assert.ok( method( \"http://142.42.1.1\" ), \"Valid IP Address\" );",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "5bbd80d27fc6b607d2f7f106c89522051a9fb0dd",
      "candidate_info": {
        "commit_hash": "5bbd80d27fc6b607d2f7f106c89522051a9fb0dd",
        "repo": "jquery-validation/jquery-validation",
        "commit_url": "https://github.com/jquery-validation/jquery-validation/commit/5bbd80d27fc6b607d2f7f106c89522051a9fb0dd",
        "files": [
          "src/additional/url2.js",
          "src/core.js",
          "test/methods.js"
        ],
        "message": "Merge pull request from GHSA-ffmh-x56j-9rc3\n\n(cherry picked from commit a3908cc082465000a3afa4bed47418b6e02c14ed)",
        "before_after_code_files": [
          "src/additional/url2.js||src/additional/url2.js",
          "src/core.js||src/core.js",
          "test/methods.js||test/methods.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/additional/url2.js||src/additional/url2.js",
            "test/methods.js||test/methods.js"
          ],
          "candidate": [
            "src/additional/url2.js||src/additional/url2.js",
            "test/methods.js||test/methods.js"
          ]
        }
      },
      "candidate_diff": {
        "src/additional/url2.js||src/additional/url2.js": [
          "File: src/additional/url2.js -> src/additional/url2.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "2: $.validator.addMethod( \"url2\", function( value, element ) {",
          "4: }, $.validator.messages.url );",
          "",
          "[Removed Lines]",
          "3:  return this.optional( element ) || /^(?:(?:(?:https?|ftp):)?\\/\\/)(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z0-9\\u00a1-\\uffff][a-z0-9\\u00a1-\\uffff_-]{0,62})?[a-z0-9\\u00a1-\\uffff]\\.?)+(?:[a-z\\u00a1-\\uffff]{2,}\\.?))(?::\\d{2,5})?(?:[/?#]\\S*)?$/i.test( value );",
          "",
          "[Added Lines]",
          "3:  return this.optional( element ) || /^(?:(?:(?:https?|ftp):)?\\/\\/)(?:(?:[^\\]\\[?\\/<~#`!@$^&*()+=}|:\";',>{ ]|%[0-9A-Fa-f]{2})+(?::(?:[^\\]\\[?\\/<~#`!@$^&*()+=}|:\";',>{ ]|%[0-9A-Fa-f]{2})*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z0-9\\u00a1-\\uffff][a-z0-9\\u00a1-\\uffff_-]{0,62})?[a-z0-9\\u00a1-\\uffff]\\.)+(?:[a-z\\u00a1-\\uffff]{2,}\\.?)|(?:(?:[a-z0-9\\u00a1-\\uffff][a-z0-9\\u00a1-\\uffff_-]{0,62})?[a-z0-9\\u00a1-\\uffff])|(?:(?:[a-z0-9\\u00a1-\\uffff][a-z0-9\\u00a1-\\uffff_-]{0,62}\\.)))(?::\\d{2,5})?(?:[/?#]\\S*)?$/i.test( value );",
          "",
          "---------------"
        ],
        "src/core.js||src/core.js": [
          "File: src/core.js -> src/core.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "1420:   },",
          "",
          "[Removed Lines]",
          "1419:    return this.optional( element ) || /^(?:(?:(?:https?|ftp):)?\\/\\/)(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z0-9\\u00a1-\\uffff][a-z0-9\\u00a1-\\uffff_-]{0,62})?[a-z0-9\\u00a1-\\uffff]\\.)+(?:[a-z\\u00a1-\\uffff]{2,}\\.?))(?::\\d{2,5})?(?:[/?#]\\S*)?$/i.test( value );",
          "",
          "[Added Lines]",
          "1419:    return this.optional( element ) || /^(?:(?:(?:https?|ftp):)?\\/\\/)(?:(?:[^\\]\\[?\\/<~#`!@$^&*()+=}|:\";',>{ ]|%[0-9A-Fa-f]{2})+(?::(?:[^\\]\\[?\\/<~#`!@$^&*()+=}|:\";',>{ ]|%[0-9A-Fa-f]{2})*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z0-9\\u00a1-\\uffff][a-z0-9\\u00a1-\\uffff_-]{0,62})?[a-z0-9\\u00a1-\\uffff]\\.)+(?:[a-z\\u00a1-\\uffff]{2,}\\.?))(?::\\d{2,5})?(?:[/?#]\\S*)?$/i.test( value );",
          "",
          "---------------"
        ],
        "test/methods.js||test/methods.js": [
          "File: test/methods.js -> test/methods.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "123:  assert.ok( method( \"http://www.f\u00f8tex.dk/\" ), \"Valid url, danish unicode characters\" );",
          "124:  assert.ok( method( \"http://b\u00f6sendorfer.de/\" ), \"Valid url, german unicode characters\" );",
          "125:  assert.ok( method( \"http://142.42.1.1\" ), \"Valid IP Address\" );",
          "126:  assert.ok( !method( \"http://192.168.8.\" ), \"Invalid IP Address\" );",
          "129:  assert.ok( !method( \"http://bassistance,de\" ), \"Invalid url\" );",
          "130:  assert.ok( !method( \"http://bassistance;de\" ), \"Invalid url\" );",
          "131:  assert.ok( !method( \"http://.bassistancede\" ), \"Invalid url\" );",
          "",
          "[Removed Lines]",
          "127:  assert.ok( method( \"http://bassistance\" ), \"Invalid url\" );",
          "128:  assert.ok( method( \"http://bassistance.\" ), \"Invalid url\" );",
          "",
          "[Added Lines]",
          "126:  assert.ok( method( \"http://bassistance\" ), \"Valid URL (optional TLD)\" );",
          "127:  assert.ok( method( \"http://bassistance.\" ), \"Valid URL (optional TLD)\" );",
          "",
          "---------------"
        ]
      }
    }
  ]
}