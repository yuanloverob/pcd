{
  "cve_id": "CVE-2022-0256",
  "cve_desc": "pimcore is vulnerable to Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')",
  "repo": "pimcore/pimcore",
  "patch_hash": "dff1cb0c466abcd55f1268934de3ed937b7436a7",
  "patch_info": {
    "commit_hash": "dff1cb0c466abcd55f1268934de3ed937b7436a7",
    "repo": "pimcore/pimcore",
    "commit_url": "https://github.com/pimcore/pimcore/commit/dff1cb0c466abcd55f1268934de3ed937b7436a7",
    "files": [
      "bundles/AdminBundle/Controller/Reports/CustomReportController.php",
      "bundles/AdminBundle/Resources/public/js/pimcore/report/custom/item.js"
    ],
    "message": "[Custom Reports] Validate & escape CSS classes and names",
    "before_after_code_files": [
      "bundles/AdminBundle/Controller/Reports/CustomReportController.php||bundles/AdminBundle/Controller/Reports/CustomReportController.php",
      "bundles/AdminBundle/Resources/public/js/pimcore/report/custom/item.js||bundles/AdminBundle/Resources/public/js/pimcore/report/custom/item.js"
    ]
  },
  "patch_diff": {
    "bundles/AdminBundle/Controller/Reports/CustomReportController.php||bundles/AdminBundle/Controller/Reports/CustomReportController.php": [
      "File: bundles/AdminBundle/Controller/Reports/CustomReportController.php -> bundles/AdminBundle/Controller/Reports/CustomReportController.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "290:         foreach ($items as $report) {",
      "291:             $reports[] = [",
      "297:                 'menuShortcut' => $report->getMenuShortcut(),",
      "299:             ];",
      "300:         }",
      "",
      "[Removed Lines]",
      "292:                 'name' => $report->getName(),",
      "293:                 'niceName' => $report->getNiceName(),",
      "294:                 'iconClass' => $report->getIconClass(),",
      "295:                 'group' => $report->getGroup(),",
      "296:                 'groupIconClass' => $report->getGroupIconClass(),",
      "298:                 'reportClass' => $report->getReportClass(),",
      "",
      "[Added Lines]",
      "292:                 'name' => htmlspecialchars($report->getName()),",
      "293:                 'niceName' => htmlspecialchars($report->getNiceName()),",
      "294:                 'iconClass' => htmlspecialchars($report->getIconClass()),",
      "295:                 'group' => htmlspecialchars($report->getGroup()),",
      "296:                 'groupIconClass' => htmlspecialchars($report->getGroupIconClass()),",
      "298:                 'reportClass' => htmlspecialchars($report->getReportClass()),",
      "",
      "---------------"
    ],
    "bundles/AdminBundle/Resources/public/js/pimcore/report/custom/item.js||bundles/AdminBundle/Resources/public/js/pimcore/report/custom/item.js": [
      "File: bundles/AdminBundle/Resources/public/js/pimcore/report/custom/item.js -> bundles/AdminBundle/Resources/public/js/pimcore/report/custom/item.js",
      "--- Hunk 1 ---",
      "[Context before]",
      "895:     save: function () {",
      "899:         Ext.Ajax.request({",
      "900:             url: Routing.generate('pimcore_admin_reports_customreport_update'),",
      "",
      "[Removed Lines]",
      "897:         var m = this.getValues();",
      "",
      "[Added Lines]",
      "897:         let m = this.getValues();",
      "898:         let error = false;",
      "900:         ['group', 'groupIconClass', 'iconClass', 'niceName', 'reportClass'].forEach(function (name) {",
      "901:             if(m[name].length && !m[name].match(/^[_a-zA-Z]+[_a-zA-Z0-9-\\s]*$/)) {",
      "902:                 error = name;",
      "903:             }",
      "904:         });",
      "906:         if(error !== false) {",
      "907:             Ext.Msg.show({",
      "908:                 title: t(\"error\"),",
      "909:                 msg: t('class_field_name_error') + ': ' + error,",
      "910:                 buttons: Ext.Msg.OK,",
      "911:                 icon: Ext.MessageBox.ERROR",
      "912:             });",
      "914:             return;",
      "915:         }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "2d3ee3e34fd76b29046e6e297c1eb7498546a930",
      "candidate_info": {
        "commit_hash": "2d3ee3e34fd76b29046e6e297c1eb7498546a930",
        "repo": "pimcore/pimcore",
        "commit_url": "https://github.com/pimcore/pimcore/commit/2d3ee3e34fd76b29046e6e297c1eb7498546a930",
        "files": [
          "bundles/AdminBundle/Controller/Reports/CustomReportController.php",
          "bundles/AdminBundle/Resources/public/js/pimcore/report/custom/item.js"
        ],
        "message": "[Custom Reports] Validate & escape CSS classes and names",
        "before_after_code_files": [
          "bundles/AdminBundle/Controller/Reports/CustomReportController.php||bundles/AdminBundle/Controller/Reports/CustomReportController.php",
          "bundles/AdminBundle/Resources/public/js/pimcore/report/custom/item.js||bundles/AdminBundle/Resources/public/js/pimcore/report/custom/item.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "bundles/AdminBundle/Controller/Reports/CustomReportController.php||bundles/AdminBundle/Controller/Reports/CustomReportController.php",
            "bundles/AdminBundle/Resources/public/js/pimcore/report/custom/item.js||bundles/AdminBundle/Resources/public/js/pimcore/report/custom/item.js"
          ],
          "candidate": [
            "bundles/AdminBundle/Controller/Reports/CustomReportController.php||bundles/AdminBundle/Controller/Reports/CustomReportController.php",
            "bundles/AdminBundle/Resources/public/js/pimcore/report/custom/item.js||bundles/AdminBundle/Resources/public/js/pimcore/report/custom/item.js"
          ]
        }
      },
      "candidate_diff": {
        "bundles/AdminBundle/Controller/Reports/CustomReportController.php||bundles/AdminBundle/Controller/Reports/CustomReportController.php": [
          "File: bundles/AdminBundle/Controller/Reports/CustomReportController.php -> bundles/AdminBundle/Controller/Reports/CustomReportController.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "290:         foreach ($items as $report) {",
          "291:             $reports[] = [",
          "297:                 'menuShortcut' => $report->getMenuShortcut(),",
          "299:             ];",
          "300:         }",
          "",
          "[Removed Lines]",
          "292:                 'name' => $report->getName(),",
          "293:                 'niceName' => $report->getNiceName(),",
          "294:                 'iconClass' => $report->getIconClass(),",
          "295:                 'group' => $report->getGroup(),",
          "296:                 'groupIconClass' => $report->getGroupIconClass(),",
          "298:                 'reportClass' => $report->getReportClass(),",
          "",
          "[Added Lines]",
          "292:                 'name' => htmlspecialchars($report->getName()),",
          "293:                 'niceName' => htmlspecialchars($report->getNiceName()),",
          "294:                 'iconClass' => htmlspecialchars($report->getIconClass()),",
          "295:                 'group' => htmlspecialchars($report->getGroup()),",
          "296:                 'groupIconClass' => htmlspecialchars($report->getGroupIconClass()),",
          "298:                 'reportClass' => htmlspecialchars($report->getReportClass()),",
          "",
          "---------------"
        ],
        "bundles/AdminBundle/Resources/public/js/pimcore/report/custom/item.js||bundles/AdminBundle/Resources/public/js/pimcore/report/custom/item.js": [
          "File: bundles/AdminBundle/Resources/public/js/pimcore/report/custom/item.js -> bundles/AdminBundle/Resources/public/js/pimcore/report/custom/item.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "895:     save: function () {",
          "899:         Ext.Ajax.request({",
          "900:             url: Routing.generate('pimcore_admin_reports_customreport_update'),",
          "",
          "[Removed Lines]",
          "897:         var m = this.getValues();",
          "",
          "[Added Lines]",
          "897:         let m = this.getValues();",
          "898:         let error = false;",
          "900:         ['group', 'groupIconClass', 'iconClass', 'niceName', 'reportClass'].forEach(function (name) {",
          "901:             if(m[name].length && !m[name].match(/^[_a-zA-Z]+[_a-zA-Z0-9-\\s]*$/)) {",
          "902:                 error = name;",
          "903:             }",
          "904:         });",
          "906:         if(error !== false) {",
          "907:             Ext.Msg.show({",
          "908:                 title: t(\"error\"),",
          "909:                 msg: t('class_field_name_error') + ': ' + error,",
          "910:                 buttons: Ext.Msg.OK,",
          "911:                 icon: Ext.MessageBox.ERROR",
          "912:             });",
          "914:             return;",
          "915:         }",
          "",
          "---------------"
        ]
      }
    }
  ]
}