{
  "cve_id": "CVE-2019-3808",
  "cve_desc": "A flaw was found in Moodle versions 3.6 to 3.6.1, 3.5 to 3.5.3, 3.4 to 3.4.6, 3.1 to 3.1.15 and earlier unsupported versions. The 'manage groups' capability did not have the 'XSS risk' flag assigned to it, but does have that access in certain places. Note that the capability is intended for use by trusted users, and is only assigned to teachers and managers by default.",
  "repo": "moodle/moodle",
  "patch_hash": "6360f87cdca744a6a71c315853f6d811a3e54e26",
  "patch_info": {
    "commit_hash": "6360f87cdca744a6a71c315853f6d811a3e54e26",
    "repo": "moodle/moodle",
    "commit_url": "https://github.com/moodle/moodle/commit/6360f87cdca744a6a71c315853f6d811a3e54e26",
    "files": [
      "lib/db/access.php",
      "version.php"
    ],
    "message": "MDL-64395 groups: Added XSS Risk to the manage groups capability",
    "before_after_code_files": [
      "lib/db/access.php||lib/db/access.php",
      "version.php||version.php"
    ]
  },
  "patch_diff": {
    "lib/db/access.php||lib/db/access.php": [
      "File: lib/db/access.php -> lib/db/access.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "1123:     ),",
      "1125:     'moodle/course:managegroups' => array(",
      "1127:         'captype' => 'write',",
      "1128:         'contextlevel' => CONTEXT_COURSE,",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1126:         'riskbitmask' => RISK_XSS,",
      "",
      "---------------"
    ],
    "version.php||version.php": [
      "File: version.php -> version.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "30: defined('MOODLE_INTERNAL') || die();",
      "",
      "[Removed Lines]",
      "32: $version  = 2018122000.01;              // YYYYMMDD      = weekly release date of this DEV branch.",
      "",
      "[Added Lines]",
      "32: $version  = 2018122000.02;              // YYYYMMDD      = weekly release date of this DEV branch.",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "aac11a3c4beac3b24b5a769e83b0ced2a044e243",
      "candidate_info": {
        "commit_hash": "aac11a3c4beac3b24b5a769e83b0ced2a044e243",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/aac11a3c4beac3b24b5a769e83b0ced2a044e243",
        "files": [
          "version.php"
        ],
        "message": "weekly release 3.7.2+",
        "before_after_code_files": [
          "version.php||version.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.php||version.php"
          ],
          "candidate": [
            "version.php||version.php"
          ]
        }
      },
      "candidate_diff": {
        "version.php||version.php": [
          "File: version.php -> version.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "30: defined('MOODLE_INTERNAL') || die();",
          "38: $branch   = '37';                       // This version's branch.",
          "39: $maturity = MATURITY_STABLE;             // This version's maturity level.",
          "",
          "[Removed Lines]",
          "32: $version  = 2019052002.09;              // 20190520      = branching date YYYYMMDD - do not modify!",
          "36: $release  = '3.7.2+ (Build: 20191016)'; // Human-friendly version name",
          "",
          "[Added Lines]",
          "32: $version  = 2019052002.10;              // 20190520      = branching date YYYYMMDD - do not modify!",
          "36: $release  = '3.7.2+ (Build: 20191018)'; // Human-friendly version name",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "d2c4ff10bfd99c7ffd2862931b5feea599e33037",
      "candidate_info": {
        "commit_hash": "d2c4ff10bfd99c7ffd2862931b5feea599e33037",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/d2c4ff10bfd99c7ffd2862931b5feea599e33037",
        "files": [
          "lib/db/upgrade.php",
          "version.php"
        ],
        "message": "MDL-61132 Questions: Upgrade step to add Top to existing contexts\n\nUpgrade script to add a \"Top\" category as a real category to the question bank",
        "before_after_code_files": [
          "lib/db/upgrade.php||lib/db/upgrade.php",
          "version.php||version.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.php||version.php"
          ],
          "candidate": [
            "version.php||version.php"
          ]
        }
      },
      "candidate_diff": {
        "lib/db/upgrade.php||lib/db/upgrade.php": [
          "File: lib/db/upgrade.php -> lib/db/upgrade.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "1935:         upgrade_main_savepoint(true, 2017122200.01);",
          "1936:     }",
          "1938:     return true;",
          "1939: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1938:     if ($oldversion < 2018020500.00) {",
          "1940:         $topcategory = new stdClass();",
          "1941:         $topcategory->name = 'top'; // A non-real name for the top category. It will be localised at the display time.",
          "1942:         $topcategory->info = '';",
          "1943:         $topcategory->parent = 0;",
          "1944:         $topcategory->sortorder = 0;",
          "1947:         $total = $DB->count_records_sql(\"SELECT COUNT(DISTINCT contextid) FROM {question_categories} WHERE parent = 0\");",
          "1950:         $rs = $DB->get_recordset_sql(\"SELECT DISTINCT contextid FROM {question_categories} WHERE parent = 0\");",
          "1953:         $i = 0;",
          "1954:         $pbar = new progress_bar('createtopquestioncategories', 500, true);",
          "1955:         foreach ($rs as $contextid => $notused) {",
          "1956:             $topcategory->contextid = $contextid;",
          "1957:             $topcategory->stamp = make_unique_id_code();",
          "1959:             $topcategoryid = $DB->insert_record('question_categories', $topcategory);",
          "1961:             $DB->set_field_select('question_categories', 'parent', $topcategoryid,",
          "1962:                     'contextid = ? AND id <> ? AND parent = 0',",
          "1963:                     array($contextid, $topcategoryid));",
          "1966:             $i++;",
          "1967:             $pbar->update($i, $total, \"Creating top-level question categories - $i/$total.\");",
          "1968:         }",
          "1970:         $rs->close();",
          "1973:         upgrade_main_savepoint(true, 2018020500.00);",
          "1974:     }",
          "",
          "---------------"
        ],
        "version.php||version.php": [
          "File: version.php -> version.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "30: defined('MOODLE_INTERNAL') || die();",
          "38: $branch   = '35';                       // This version's branch.",
          "39: $maturity = MATURITY_ALPHA;             // This version's maturity level.",
          "",
          "[Removed Lines]",
          "32: $version  = 2018020100.00;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "36: $release  = '3.5dev (Build: 20180201)'; // Human-friendly version name",
          "",
          "[Added Lines]",
          "32: $version  = 2018020500.00;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "36: $release  = '3.5dev (Build: 20180205)'; // Human-friendly version name",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "8471a0db4205dcfa4dc215331de05d0d32e09be7",
      "candidate_info": {
        "commit_hash": "8471a0db4205dcfa4dc215331de05d0d32e09be7",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/8471a0db4205dcfa4dc215331de05d0d32e09be7",
        "files": [
          "admin/settings/appearance.php",
          "admin/tool/monitor/lib.php",
          "enrol/tests/enrollib_test.php",
          "lang/en/admin.php",
          "lib/enrollib.php",
          "version.php"
        ],
        "message": "MDL-61804 admin: Add setting for course visibility sorting",
        "before_after_code_files": [
          "admin/settings/appearance.php||admin/settings/appearance.php",
          "admin/tool/monitor/lib.php||admin/tool/monitor/lib.php",
          "enrol/tests/enrollib_test.php||enrol/tests/enrollib_test.php",
          "lang/en/admin.php||lang/en/admin.php",
          "lib/enrollib.php||lib/enrollib.php",
          "version.php||version.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.php||version.php"
          ],
          "candidate": [
            "version.php||version.php"
          ]
        }
      },
      "candidate_diff": {
        "admin/settings/appearance.php||admin/settings/appearance.php": [
          "File: admin/settings/appearance.php -> admin/settings/appearance.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "197:         'idnumber' => new lang_string('sort_idnumber', 'admin'),",
          "198:     );",
          "199:     $temp->add(new admin_setting_configselect('navsortmycoursessort', new lang_string('navsortmycoursessort', 'admin'), new lang_string('navsortmycoursessort_help', 'admin'), 'sortorder', $sortoptions));",
          "200:     $temp->add(new admin_setting_configtext('navcourselimit', new lang_string('navcourselimit', 'admin'),",
          "201:         new lang_string('confignavcourselimit', 'admin'), 10, PARAM_INT));",
          "202:     $temp->add(new admin_setting_configcheckbox('usesitenameforsitepages', new lang_string('usesitenameforsitepages', 'admin'), new lang_string('configusesitenameforsitepages', 'admin'), 0));",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "200:     $temp->add(new admin_setting_configcheckbox('navsortmycourseshiddenlast',",
          "201:             new lang_string('navsortmycourseshiddenlast', 'admin'),",
          "202:             new lang_string('navsortmycourseshiddenlast_help', 'admin'),",
          "203:             1));",
          "",
          "---------------"
        ],
        "admin/tool/monitor/lib.php||admin/tool/monitor/lib.php": [
          "File: admin/tool/monitor/lib.php -> admin/tool/monitor/lib.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "121: function tool_monitor_get_user_courses() {",
          "123:     $options = array();",
          "124:     if (has_capability('tool/monitor:subscribe', context_system::instance())) {",
          "125:         $options[0] = get_string('site');",
          "",
          "[Removed Lines]",
          "122:     $orderby = 'visible DESC, sortorder ASC';",
          "",
          "[Added Lines]",
          "123:     $sort = enrol_get_courses_sortingsql();",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "134:         );",
          "136:     $fields = implode(', ', $fieldlist);",
          "138:         foreach ($courses as $course) {",
          "139:             context_helper::preload_from_record($course);",
          "140:             $coursectx = context_course::instance($course->id);",
          "",
          "[Removed Lines]",
          "137:     if ($courses = get_user_capability_course('tool/monitor:subscribe', null, true, $fields, $orderby)) {",
          "",
          "[Added Lines]",
          "139:     if ($courses = get_user_capability_course('tool/monitor:subscribe', null, true, $fields, $sort)) {",
          "",
          "---------------"
        ],
        "enrol/tests/enrollib_test.php||enrol/tests/enrollib_test.php": [
          "File: enrol/tests/enrollib_test.php -> enrol/tests/enrollib_test.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "59:         $course1 = $this->getDataGenerator()->create_course(array(",
          "60:             'shortname' => 'Z',",
          "61:             'category' => $category1->id,",
          "62:         ));",
          "63:         $course2 = $this->getDataGenerator()->create_course(array(",
          "64:             'shortname' => 'X',",
          "65:             'category' => $category2->id,",
          "66:         ));",
          "67:         $course3 = $this->getDataGenerator()->create_course(array(",
          "68:             'shortname' => 'Y',",
          "69:             'category' => $category2->id,",
          "70:             'visible' => 0,",
          "71:         ));",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "61:             'idnumber' => '123',",
          "66:             'idnumber' => '789',",
          "71:             'idnumber' => '456',",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "163:         $this->assertTrue(property_exists($course, 'timecreated'));",
          "165:         $courses = enrol_get_all_users_courses($user2->id, false, null, 'id DESC');",
          "",
          "[Removed Lines]",
          "166:         $this->assertEquals(array($course3->id, $course2->id, $course1->id), array_keys($courses));",
          "",
          "[Added Lines]",
          "169:         $this->assertEquals(array($course2->id, $course3->id, $course1->id), array_keys($courses));",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "177:         $courses = enrol_get_all_users_courses($user1->id, false, null, 'shortname DESC');",
          "178:         $this->assertEquals(array($course1->id, $course3->id, $course2->id), array_keys($courses));",
          "179:     }",
          "181:     public function test_enrol_user_sees_own_courses() {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "181:         $this->assertEquals(array($course2->id, $course1->id, $course3->id), array_keys($courses));",
          "185:         $CFG->navsortmycoursessort = 'sortorder';",
          "186:         $CFG->navsortmycourseshiddenlast = true;",
          "187:         $courses = enrol_get_all_users_courses($user1->id);",
          "188:         $this->assertEquals(array($course2->id, $course1->id, $course3->id), array_keys($courses));",
          "190:         $CFG->navsortmycoursessort = 'sortorder';",
          "191:         $CFG->navsortmycourseshiddenlast = false;",
          "192:         $courses = enrol_get_all_users_courses($user1->id);",
          "193:         $this->assertEquals(array($course1->id, $course3->id, $course2->id), array_keys($courses));",
          "195:         $CFG->navsortmycoursessort = 'fullname';",
          "196:         $CFG->navsortmycourseshiddenlast = true;",
          "197:         $courses = enrol_get_all_users_courses($user1->id);",
          "198:         $this->assertEquals(array($course2->id, $course1->id, $course3->id), array_keys($courses));",
          "200:         $CFG->navsortmycoursessort = 'fullname';",
          "201:         $CFG->navsortmycourseshiddenlast = false;",
          "202:         $courses = enrol_get_all_users_courses($user1->id);",
          "203:         $this->assertEquals(array($course1->id, $course2->id, $course3->id), array_keys($courses));",
          "205:         $CFG->navsortmycoursessort = 'shortname';",
          "206:         $CFG->navsortmycourseshiddenlast = true;",
          "207:         $courses = enrol_get_all_users_courses($user1->id);",
          "208:         $this->assertEquals(array($course2->id, $course3->id, $course1->id), array_keys($courses));",
          "210:         $CFG->navsortmycoursessort = 'shortname';",
          "211:         $CFG->navsortmycourseshiddenlast = false;",
          "212:         $courses = enrol_get_all_users_courses($user1->id);",
          "213:         $this->assertEquals(array($course2->id, $course3->id, $course1->id), array_keys($courses));",
          "215:         $CFG->navsortmycoursessort = 'idnumber';",
          "216:         $CFG->navsortmycourseshiddenlast = true;",
          "217:         $courses = enrol_get_all_users_courses($user1->id);",
          "218:         $this->assertEquals(array($course2->id, $course1->id, $course3->id), array_keys($courses));",
          "220:         $CFG->navsortmycoursessort = 'idnumber';",
          "221:         $CFG->navsortmycourseshiddenlast = false;",
          "222:         $courses = enrol_get_all_users_courses($user1->id);",
          "227:         $courses = enrol_get_all_users_courses($user1->id, false, null, 'visible DESC, shortname DESC');",
          "228:         $this->assertEquals(array($course2->id, $course1->id, $course3->id), array_keys($courses));",
          "",
          "---------------"
        ],
        "lang/en/admin.php||lang/en/admin.php": [
          "File: lang/en/admin.php -> lang/en/admin.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "822: $string['navshowcategories'] = 'Show course categories';",
          "823: $string['navshowmycoursecategories'] = 'Show my course categories';",
          "824: $string['navshowmycoursecategories_help'] = 'If enabled courses in the users my courses branch will be shown in categories.';",
          "825: $string['navsortmycoursessort'] = 'Sort my courses';",
          "826: $string['navsortmycoursessort_help'] = 'This determines whether courses are listed under My courses according to the sort order (i.e. the order set in Site administration > Courses > Manage courses and categories) or alphabetically by course setting.';",
          "827: $string['never'] = 'Never';",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "825: $string['navsortmycourseshiddenlast'] = 'Sort my hidden courses last';",
          "826: $string['navsortmycourseshiddenlast_help'] = 'If enabled, any hidden courses will be listed after visible courses (for users who can view hidden courses). Otherwise, all courses, regardless of their visibility, will be listed according to the \\'Sort my courses\\' setting.';",
          "",
          "---------------"
        ],
        "lib/enrollib.php||lib/enrollib.php": [
          "File: lib/enrollib.php -> lib/enrollib.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "567:     $offset = 0, $excludecourses = []) {",
          "568:     global $DB, $USER, $CFG;",
          "579:     if (!$allaccessible && (isguestuser() or !isloggedin())) {",
          "",
          "[Removed Lines]",
          "570:     if ($sort === null) {",
          "571:         if (empty($CFG->navsortmycoursessort)) {",
          "572:             $sort = 'visible DESC, sortorder ASC';",
          "573:         } else {",
          "574:             $sort = 'visible DESC, '.$CFG->navsortmycoursessort.' ASC';",
          "575:         }",
          "576:     }",
          "",
          "[Added Lines]",
          "571:     $sort = enrol_get_courses_sortingsql($sort);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "804:     return $icons;",
          "805: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "808: function enrol_get_courses_sortingsql($sort = null) {",
          "809:     global $CFG;",
          "812:     $visible = '';",
          "814:     if ($sort === null || strpos($sort, 'visible') === false) {",
          "817:         if (!isset($CFG->navsortmycourseshiddenlast) || $CFG->navsortmycourseshiddenlast == true) {",
          "818:             $visible = 'visible DESC, ';",
          "819:         }",
          "820:     }",
          "823:     if ($sort === null) {",
          "825:         if (!empty($CFG->navsortmycoursessort)) {",
          "826:             $sort = $CFG->navsortmycoursessort . ' ASC';",
          "829:         } else {",
          "830:             $sort = 'sortorder ASC';",
          "831:         }",
          "832:     }",
          "834:     return $visible . $sort;",
          "835: }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "957: function enrol_get_all_users_courses($userid, $onlyactive = false, $fields = null, $sort = null) {",
          "969:     if (isguestuser($userid) or empty($userid)) {",
          "",
          "[Removed Lines]",
          "958:     global $CFG, $DB;",
          "960:     if ($sort === null) {",
          "961:         if (empty($CFG->navsortmycoursessort)) {",
          "962:             $sort = 'visible DESC, sortorder ASC';",
          "963:         } else {",
          "964:             $sort = 'visible DESC, '.$CFG->navsortmycoursessort.' ASC';",
          "965:         }",
          "966:     }",
          "",
          "[Added Lines]",
          "988:     global $DB;",
          "991:     $sort = enrol_get_courses_sortingsql($sort);",
          "",
          "---------------"
        ],
        "version.php||version.php": [
          "File: version.php -> version.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "30: defined('MOODLE_INTERNAL') || die();",
          "",
          "[Removed Lines]",
          "32: $version  = 2019100800.00;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "",
          "[Added Lines]",
          "32: $version  = 2019100800.01;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "bbbf9667c048871eb4f1c25c85de8425571dc265",
      "candidate_info": {
        "commit_hash": "bbbf9667c048871eb4f1c25c85de8425571dc265",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/bbbf9667c048871eb4f1c25c85de8425571dc265",
        "files": [
          "blocks/recentlyaccesseditems/amd/build/main.min.js",
          "blocks/recentlyaccesseditems/amd/build/repository.min.js",
          "blocks/recentlyaccesseditems/amd/src/main.js",
          "blocks/recentlyaccesseditems/amd/src/repository.js",
          "blocks/recentlyaccesseditems/block_recentlyaccesseditems.php",
          "blocks/recentlyaccesseditems/classes/external.php",
          "blocks/recentlyaccesseditems/classes/external/recentlyaccesseditems_item_exporter.php",
          "blocks/recentlyaccesseditems/classes/helper.php",
          "blocks/recentlyaccesseditems/classes/observer.php",
          "blocks/recentlyaccesseditems/classes/output/main.php",
          "blocks/recentlyaccesseditems/classes/output/renderer.php",
          "blocks/recentlyaccesseditems/classes/privacy/provider.php",
          "blocks/recentlyaccesseditems/db/access.php",
          "blocks/recentlyaccesseditems/db/events.php",
          "blocks/recentlyaccesseditems/db/install.xml",
          "blocks/recentlyaccesseditems/db/services.php",
          "blocks/recentlyaccesseditems/lang/en/block_recentlyaccesseditems.php",
          "blocks/recentlyaccesseditems/pix/items.svg",
          "blocks/recentlyaccesseditems/templates/main.mustache",
          "blocks/recentlyaccesseditems/templates/no-items.mustache",
          "blocks/recentlyaccesseditems/templates/placeholder-item.mustache",
          "blocks/recentlyaccesseditems/templates/recentlyaccesseditems-view.mustache",
          "blocks/recentlyaccesseditems/templates/view-cards.mustache",
          "blocks/recentlyaccesseditems/tests/behat/block_recentlyaccesseditems_dashboard.feature",
          "blocks/recentlyaccesseditems/tests/externallib_test.php",
          "blocks/recentlyaccesseditems/tests/observer_test.php",
          "blocks/recentlyaccesseditems/version.php",
          "lib/classes/plugin_manager.php",
          "theme/boost/scss/moodle/blocks.scss",
          "theme/boost/style/moodle.css",
          "theme/bootstrapbase/less/moodle/blocks.less",
          "theme/bootstrapbase/style/moodle.css",
          "version.php"
        ],
        "message": "Merge branch 'MDL-63063-master-block' of https://github.com/vmdef/moodle",
        "before_after_code_files": [
          "blocks/recentlyaccesseditems/amd/src/main.js||blocks/recentlyaccesseditems/amd/src/main.js",
          "blocks/recentlyaccesseditems/amd/src/repository.js||blocks/recentlyaccesseditems/amd/src/repository.js",
          "blocks/recentlyaccesseditems/block_recentlyaccesseditems.php||blocks/recentlyaccesseditems/block_recentlyaccesseditems.php",
          "blocks/recentlyaccesseditems/classes/external.php||blocks/recentlyaccesseditems/classes/external.php",
          "blocks/recentlyaccesseditems/classes/external/recentlyaccesseditems_item_exporter.php||blocks/recentlyaccesseditems/classes/external/recentlyaccesseditems_item_exporter.php",
          "blocks/recentlyaccesseditems/classes/helper.php||blocks/recentlyaccesseditems/classes/helper.php",
          "blocks/recentlyaccesseditems/classes/observer.php||blocks/recentlyaccesseditems/classes/observer.php",
          "blocks/recentlyaccesseditems/classes/output/main.php||blocks/recentlyaccesseditems/classes/output/main.php",
          "blocks/recentlyaccesseditems/classes/output/renderer.php||blocks/recentlyaccesseditems/classes/output/renderer.php",
          "blocks/recentlyaccesseditems/classes/privacy/provider.php||blocks/recentlyaccesseditems/classes/privacy/provider.php",
          "blocks/recentlyaccesseditems/db/access.php||blocks/recentlyaccesseditems/db/access.php",
          "blocks/recentlyaccesseditems/db/events.php||blocks/recentlyaccesseditems/db/events.php",
          "blocks/recentlyaccesseditems/db/services.php||blocks/recentlyaccesseditems/db/services.php",
          "blocks/recentlyaccesseditems/lang/en/block_recentlyaccesseditems.php||blocks/recentlyaccesseditems/lang/en/block_recentlyaccesseditems.php",
          "blocks/recentlyaccesseditems/templates/main.mustache||blocks/recentlyaccesseditems/templates/main.mustache",
          "blocks/recentlyaccesseditems/templates/no-items.mustache||blocks/recentlyaccesseditems/templates/no-items.mustache",
          "blocks/recentlyaccesseditems/templates/placeholder-item.mustache||blocks/recentlyaccesseditems/templates/placeholder-item.mustache",
          "blocks/recentlyaccesseditems/templates/recentlyaccesseditems-view.mustache||blocks/recentlyaccesseditems/templates/recentlyaccesseditems-view.mustache",
          "blocks/recentlyaccesseditems/templates/view-cards.mustache||blocks/recentlyaccesseditems/templates/view-cards.mustache",
          "blocks/recentlyaccesseditems/tests/behat/block_recentlyaccesseditems_dashboard.feature||blocks/recentlyaccesseditems/tests/behat/block_recentlyaccesseditems_dashboard.feature",
          "blocks/recentlyaccesseditems/tests/externallib_test.php||blocks/recentlyaccesseditems/tests/externallib_test.php",
          "blocks/recentlyaccesseditems/tests/observer_test.php||blocks/recentlyaccesseditems/tests/observer_test.php",
          "blocks/recentlyaccesseditems/version.php||blocks/recentlyaccesseditems/version.php",
          "lib/classes/plugin_manager.php||lib/classes/plugin_manager.php",
          "theme/boost/scss/moodle/blocks.scss||theme/boost/scss/moodle/blocks.scss",
          "theme/boost/style/moodle.css||theme/boost/style/moodle.css",
          "theme/bootstrapbase/less/moodle/blocks.less||theme/bootstrapbase/less/moodle/blocks.less",
          "theme/bootstrapbase/style/moodle.css||theme/bootstrapbase/style/moodle.css",
          "version.php||version.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.php||version.php"
          ],
          "candidate": [
            "version.php||version.php"
          ]
        }
      },
      "candidate_diff": {
        "blocks/recentlyaccesseditems/amd/src/main.js||blocks/recentlyaccesseditems/amd/src/main.js": [
          "File: blocks/recentlyaccesseditems/amd/src/main.js -> blocks/recentlyaccesseditems/amd/src/main.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "26: define(",
          "27:     [",
          "28:         'jquery',",
          "29:         'block_recentlyaccesseditems/repository',",
          "30:         'core/templates',",
          "31:         'core/notification'",
          "32:     ],",
          "33:     function(",
          "34:         $,",
          "35:         Repository,",
          "36:         Templates,",
          "37:         Notification",
          "38:     ) {",
          "40:         var NUM_ITEMS = 9;",
          "42:         var SELECTORS = {",
          "43:             CARDDECK_CONTAINER: '[data-region=\"recentlyaccesseditems-view\"]',",
          "44:             CARDDECK: '[data-region=\"recentlyaccesseditems-view-content\"]',",
          "45:         };",
          "54:         var getRecentItems = function(limit) {",
          "55:             return Repository.getRecentItems(limit);",
          "56:         };",
          "66:         var renderItems = function(root, items) {",
          "67:             if (items.length > 0) {",
          "68:                 return Templates.render('block_recentlyaccesseditems/view-cards', {",
          "69:                     items: items",
          "70:                 });",
          "71:             } else {",
          "72:                 var noitemsimgurl = root.attr('data-noitemsimgurl');",
          "73:                 return Templates.render('block_recentlyaccesseditems/no-items', {",
          "74:                     noitemsimgurl: noitemsimgurl",
          "75:                 });",
          "76:             }",
          "77:         };",
          "84:         var init = function(root) {",
          "85:             root = $(root);",
          "87:             var itemsContainer = root.find(SELECTORS.CARDDECK_CONTAINER);",
          "88:             var itemsContent = root.find(SELECTORS.CARDDECK);",
          "90:             var itemsPromise = getRecentItems(NUM_ITEMS);",
          "92:             itemsPromise.then(function(items) {",
          "93:                 var pageContentPromise = renderItems(itemsContainer, items);",
          "95:                 pageContentPromise.then(function(html, js) {",
          "96:                     return Templates.replaceNodeContents(itemsContent, html, js);",
          "97:                 }).catch(Notification.exception);",
          "98:                 return itemsPromise;",
          "99:             }).catch(Notification.exception);",
          "100:         };",
          "102:         return {",
          "103:             init: init",
          "104:         };",
          "105:     });",
          "",
          "---------------"
        ],
        "blocks/recentlyaccesseditems/amd/src/repository.js||blocks/recentlyaccesseditems/amd/src/repository.js": [
          "File: blocks/recentlyaccesseditems/amd/src/repository.js -> blocks/recentlyaccesseditems/amd/src/repository.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "24: define(['core/ajax'], function(Ajax) {",
          "33:     var getRecentItems = function(limit) {",
          "34:         var args = {};",
          "35:         if (typeof limit !== 'undefined') {",
          "36:             args.limit = limit;",
          "37:         }",
          "38:         var request = {",
          "39:             methodname: 'block_recentlyaccesseditems_get_recent_items',",
          "40:             args: args",
          "41:         };",
          "42:         return Ajax.call([request])[0];",
          "43:     };",
          "44:     return {",
          "45:         getRecentItems: getRecentItems",
          "46:     };",
          "47: });",
          "",
          "---------------"
        ],
        "blocks/recentlyaccesseditems/block_recentlyaccesseditems.php||blocks/recentlyaccesseditems/block_recentlyaccesseditems.php": [
          "File: blocks/recentlyaccesseditems/block_recentlyaccesseditems.php -> blocks/recentlyaccesseditems/block_recentlyaccesseditems.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: <?php",
          "23: defined('MOODLE_INTERNAL') || die();",
          "31: class block_recentlyaccesseditems extends block_base {",
          "35:     public function init() {",
          "36:         $this->title = get_string('pluginname', 'block_recentlyaccesseditems');",
          "37:     }",
          "44:     public function get_content() {",
          "45:         if (isset($this->content)) {",
          "46:             return $this->content;",
          "47:         }",
          "48:         $renderable = new block_recentlyaccesseditems\\output\\main();",
          "49:         $renderer = $this->page->get_renderer('block_recentlyaccesseditems');",
          "51:         $this->content = new stdClass();",
          "52:         $this->content->text = $renderer->render($renderable);",
          "53:         $this->content->footer = '';",
          "54:         return $this->content;",
          "55:     }",
          "62:     public function applicable_formats() {",
          "63:         return array('my' => true);",
          "64:     }",
          "65: }",
          "",
          "---------------"
        ],
        "blocks/recentlyaccesseditems/classes/external.php||blocks/recentlyaccesseditems/classes/external.php": [
          "File: blocks/recentlyaccesseditems/classes/external.php -> blocks/recentlyaccesseditems/classes/external.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: <?php",
          "24: namespace block_recentlyaccesseditems;",
          "25: defined('MOODLE_INTERNAL') || die();",
          "27: require_once(\"$CFG->libdir/externallib.php\");",
          "29: use block_recentlyaccesseditems\\external\\recentlyaccesseditems_item_exporter;",
          "30: use external_api;",
          "31: use external_function_parameters;",
          "32: use external_value;",
          "33: use external_multiple_structure;",
          "34: use context_user;",
          "35: use context_module;",
          "44: class external extends external_api {",
          "50:     public static function get_recent_items_parameters() {",
          "51:         return new external_function_parameters(",
          "52:                 array(",
          "53:                         'limit' => new external_value(PARAM_INT, 'result set limit', VALUE_DEFAULT, 0)",
          "54:                 )",
          "55:         );",
          "56:     }",
          "65:     public static function get_recent_items(int $limit = 0) {",
          "66:         global $USER, $PAGE;",
          "68:         $userid = $USER->id;",
          "70:         $params = self::validate_parameters(self::get_recent_items_parameters(),",
          "71:             array(",
          "72:                 'limit' => $limit,",
          "73:             )",
          "74:         );",
          "76:         $limit = $params['limit'];",
          "78:         self::validate_context(context_user::instance($userid));",
          "80:         $items = helper::get_recent_items($limit);",
          "82:         $renderer = $PAGE->get_renderer('core');",
          "83:         $recentitems = array_map(function($item) use ($renderer) {",
          "84:             $context = context_module::instance($item->cmid);",
          "85:             $exporter = new recentlyaccesseditems_item_exporter($item, ['context' => $context]);",
          "86:             return $exporter->export($renderer);",
          "87:         }, $items);",
          "89:         return $recentitems;",
          "90:     }",
          "98:     public static function get_recent_items_returns() {",
          "99:         return new external_multiple_structure(recentlyaccesseditems_item_exporter::get_read_structure(),",
          "100:                 'The most recently accessed activities/resources by the logged user');",
          "101:     }",
          "102: }",
          "",
          "---------------"
        ],
        "blocks/recentlyaccesseditems/classes/external/recentlyaccesseditems_item_exporter.php||blocks/recentlyaccesseditems/classes/external/recentlyaccesseditems_item_exporter.php": [
          "File: blocks/recentlyaccesseditems/classes/external/recentlyaccesseditems_item_exporter.php -> blocks/recentlyaccesseditems/classes/external/recentlyaccesseditems_item_exporter.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: <?php",
          "23: namespace block_recentlyaccesseditems\\external;",
          "24: defined('MOODLE_INTERNAL') || die();",
          "26: use renderer_base;",
          "27: use moodle_url;",
          "35: class recentlyaccesseditems_item_exporter extends \\core\\external\\exporter {",
          "40:     protected static function define_related() {",
          "42:         return array('context' => '\\\\context');",
          "43:     }",
          "51:     protected function get_other_values(renderer_base $output) {",
          "52:         global $OUTPUT;",
          "54:         return array(",
          "55:                 'viewurl' => (new moodle_url('/mod/'.$this->data->modname.'/view.php',",
          "56:                         array('id' => $this->data->cmid)))->out(false),",
          "57:                 'courseviewurl' => (new moodle_url('/course/view.php', array('id' => $this->data->courseid)))->out(false),",
          "58:                 'icon' => $OUTPUT->image_icon('icon', get_string('pluginname', $this->data->modname), $this->data->modname)",
          "59:         );",
          "60:     }",
          "67:     public static function define_properties() {",
          "68:         return array(",
          "69:             'id' => array(",
          "70:                 'type' => PARAM_INT,",
          "71:             ),",
          "72:             'courseid' => array(",
          "73:                 'type' => PARAM_INT,",
          "74:             ),",
          "75:             'cmid' => array(",
          "76:                 'type' => PARAM_INT,",
          "77:             ),",
          "78:             'userid' => array(",
          "79:                 'type' => PARAM_INT,",
          "80:             ),",
          "81:             'modname' => array(",
          "82:                 'type' => PARAM_TEXT,",
          "83:             ),",
          "84:             'name' => array(",
          "85:                     'type' => PARAM_TEXT,",
          "86:             ),",
          "87:             'coursename' => array(",
          "88:                 'type' => PARAM_TEXT,",
          "89:             ),",
          "90:             'timeaccess' => array(",
          "91:                 'type' => PARAM_INT,",
          "92:             )",
          "93:         );",
          "94:     }",
          "101:     public static function define_other_properties() {",
          "102:         return array(",
          "103:             'viewurl' => array(",
          "104:                 'type' => PARAM_TEXT,",
          "105:             ),",
          "106:             'courseviewurl' => array(",
          "107:                     'type' => PARAM_URL,",
          "108:             ),",
          "109:             'icon' => array(",
          "110:                 'type' => PARAM_RAW,",
          "111:             )",
          "112:         );",
          "113:     }",
          "114: }",
          "",
          "---------------"
        ],
        "blocks/recentlyaccesseditems/classes/helper.php||blocks/recentlyaccesseditems/classes/helper.php": [
          "File: blocks/recentlyaccesseditems/classes/helper.php -> blocks/recentlyaccesseditems/classes/helper.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: <?php",
          "25: namespace block_recentlyaccesseditems;",
          "27: defined('MOODLE_INTERNAL') || die();",
          "36: class helper {",
          "43:     public static function get_recent_items(int $limit = 0) {",
          "44:         global $USER, $DB;",
          "46:         $userid = $USER->id;",
          "48:         $courses = array();",
          "49:         $recentitems = array();",
          "51:         if (!isloggedin() or \\core\\session\\manager::is_loggedinas() or isguestuser()) {",
          "53:             return $recentitems;",
          "54:         }",
          "57:         $sort = 'timeaccess DESC';",
          "59:         $paramsql = array('userid' => $userid);",
          "60:         $records = $DB->get_records('block_recentlyaccesseditems', $paramsql, $sort);",
          "61:         $order = 0;",
          "64:         foreach ($records as $record) {",
          "65:             $courses[$record->courseid][$order++] = $record;",
          "66:         }",
          "69:         foreach ($courses as $key => $items) {",
          "70:             $modinfo = get_fast_modinfo($key);",
          "71:             foreach ($items as $key => $item) {",
          "73:                 if (!$modinfo->cms[$item->cmid]->uservisible) {",
          "74:                     continue;",
          "75:                 }",
          "76:                 $item->modname = $modinfo->cms[$item->cmid]->modname;",
          "77:                 $item->name = $modinfo->cms[$item->cmid]->name;",
          "78:                 $item->coursename = get_course_display_name_for_list($modinfo->get_course());",
          "79:                 $recentitems[$key] = $item;",
          "80:             }",
          "81:         }",
          "83:         ksort($recentitems);",
          "86:         if (!$limit) {",
          "87:             $limit = count($recentitems);",
          "88:         }",
          "89:         $recentitems = array_slice($recentitems, 0, $limit);",
          "91:         return $recentitems;",
          "92:     }",
          "93: }",
          "",
          "---------------"
        ],
        "blocks/recentlyaccesseditems/classes/observer.php||blocks/recentlyaccesseditems/classes/observer.php": [
          "File: blocks/recentlyaccesseditems/classes/observer.php -> blocks/recentlyaccesseditems/classes/observer.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: <?php",
          "25: namespace block_recentlyaccesseditems;",
          "27: defined('MOODLE_INTERNAL') || die();",
          "38: class observer {",
          "43:     private static $table = 'block_recentlyaccesseditems';",
          "53:     public static function store(\\core\\event\\base $event) {",
          "54:         global $DB;",
          "56:         if (!isloggedin() or \\core\\session\\manager::is_loggedinas() or isguestuser()) {",
          "58:             return;",
          "59:         }",
          "61:         $conditions = [",
          "62:             'userid' => $event->userid",
          "63:         ];",
          "65:         $records = $DB->get_records(self::$table, $conditions, \"timeaccess DESC\");",
          "67:         foreach ($records as $record) {",
          "68:             if (($record->userid == $event->userid) && ($record->cmid == $event->contextinstanceid)) {",
          "69:                 $conditions = [",
          "70:                         'userid' => $event->userid,",
          "71:                         'cmid' => $event->contextinstanceid",
          "72:                 ];",
          "73:                 $DB->set_field(self::$table, 'timeaccess', $event->timecreated, $conditions);",
          "74:                 return;",
          "75:             }",
          "76:         }",
          "78:         if (count($records) >= 9) {",
          "79:             $conditions = [",
          "80:                     'id' => end($records)->id,",
          "81:             ];",
          "82:             $DB->delete_records(self::$table, $conditions);",
          "83:         }",
          "85:         $eventdata = new \\stdClass();",
          "87:         $eventdata->cmid = $event->contextinstanceid;",
          "88:         $eventdata->timeaccess = $event->timecreated;",
          "89:         $eventdata->courseid = $event->courseid;",
          "90:         $eventdata->userid = $event->userid;",
          "92:         $DB->insert_record(self::$table, $eventdata);",
          "93:     }",
          "100:     public static function remove(\\core\\event\\base $event) {",
          "101:         global $DB;",
          "103:         $DB->delete_records(self::$table, array('cmid' => $event->contextinstanceid));",
          "104:     }",
          "105: }",
          "",
          "---------------"
        ],
        "blocks/recentlyaccesseditems/classes/output/main.php||blocks/recentlyaccesseditems/classes/output/main.php": [
          "File: blocks/recentlyaccesseditems/classes/output/main.php -> blocks/recentlyaccesseditems/classes/output/main.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: <?php",
          "24: namespace block_recentlyaccesseditems\\output;",
          "25: defined('MOODLE_INTERNAL') || die();",
          "27: use renderable;",
          "28: use renderer_base;",
          "29: use templatable;",
          "38: class main implements renderable, templatable {",
          "45:     public function export_for_template(renderer_base $output) {",
          "47:         $noitemsimgurl = $output->image_url('items', 'block_recentlyaccesseditems')->out();",
          "49:         return [",
          "50:             'noitemsimgurl' => $noitemsimgurl",
          "51:         ];",
          "52:     }",
          "53: }",
          "",
          "---------------"
        ],
        "blocks/recentlyaccesseditems/classes/output/renderer.php||blocks/recentlyaccesseditems/classes/output/renderer.php": [
          "File: blocks/recentlyaccesseditems/classes/output/renderer.php -> blocks/recentlyaccesseditems/classes/output/renderer.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: <?php",
          "23: namespace block_recentlyaccesseditems\\output;",
          "25: defined('MOODLE_INTERNAL') || die;",
          "27: use plugin_renderer_base;",
          "36: class renderer extends plugin_renderer_base {",
          "43:     public function render_recentlyaccesseditems(renderer_base $main) {",
          "44:         return $this->render_from_template('block_recentlyaccesseditems/main', $main->export_for_template($this));",
          "45:     }",
          "46: }",
          "",
          "---------------"
        ],
        "blocks/recentlyaccesseditems/classes/privacy/provider.php||blocks/recentlyaccesseditems/classes/privacy/provider.php": [
          "File: blocks/recentlyaccesseditems/classes/privacy/provider.php -> blocks/recentlyaccesseditems/classes/privacy/provider.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: <?php",
          "25: namespace block_recentlyaccesseditems\\privacy;",
          "27: defined('MOODLE_INTERNAL') || die();",
          "29: use \\core_privacy\\local\\metadata\\collection;",
          "30: use \\core_privacy\\local\\request\\transform;",
          "31: use \\core_privacy\\local\\request\\contextlist;",
          "32: use \\core_privacy\\local\\request\\approved_contextlist;",
          "33: use \\core_privacy\\local\\request\\writer;",
          "42: class provider implements \\core_privacy\\local\\metadata\\provider, \\core_privacy\\local\\request\\subsystem\\provider {",
          "50:     public static function get_metadata(collection $collection) : collection {",
          "51:         $recentitems = [",
          "52:                 'userid' => 'privacy:metadata:userid',",
          "53:                 'courseid' => 'privacy:metadata:courseid',",
          "54:                 'cmid' => 'privacy:metadata:cmid',",
          "55:                 'timeaccess' => 'privacy:metadata:timeaccess'",
          "56:         ];",
          "58:         $collection->add_database_table('block_recentlyaccesseditems', $recentitems,",
          "59:                 'privacy:metadata:block_recentlyaccesseditemstablesummary');",
          "61:         return $collection;",
          "62:     }",
          "70:     public static function get_contexts_for_userid(int $userid) : contextlist {",
          "71:         $params = ['userid' => $userid, 'contextuser' => CONTEXT_USER];",
          "72:         $sql = \"SELECT id",
          "73:                   FROM {context}",
          "74:                  WHERE instanceid = :userid and contextlevel = :contextuser\";",
          "75:         $contextlist = new contextlist();",
          "76:         $contextlist->add_from_sql($sql, $params);",
          "77:         return $contextlist;",
          "78:     }",
          "85:     public static function export_user_data(approved_contextlist $contextlist) {",
          "86:         $context = $contextlist->current();",
          "87:         $user = \\core_user::get_user($contextlist->get_user()->id);",
          "88:         static::export_recentitems($user->id, $context);",
          "89:     }",
          "97:     protected static function export_recentitems(int $userid, \\context $context) {",
          "98:         global $DB;",
          "99:         $sql = \"SELECT ra.id, c.fullname, ra.timeaccess, m.name, ra.cmid",
          "100:                   FROM {block_recentlyaccesseditems} ra",
          "101:                   JOIN {course} c ON c.id = ra.courseid",
          "102:                   JOIN {course_modules} cm on cm.id = ra.cmid",
          "103:                   JOIN {modules} m ON m.id = cm.module",
          "104:                  WHERE ra.userid = :userid\";",
          "106:         $params = ['userid' => $userid];",
          "107:         $records = $DB->get_records_sql($sql, $params);",
          "108:         if (!empty($records)) {",
          "109:             $recentitems = (object) array_map(function($record) use($context) {",
          "110:                 return [",
          "111:                         'course_name' => format_string($record->fullname, true, ['context' => $context]),",
          "112:                         'module_name' => format_string($record->name),",
          "113:                         'timeaccess' => transform::datetime($record->timeaccess)",
          "114:                 ];",
          "115:             }, $records);",
          "116:             writer::with_context($context)->export_data([get_string('privacy:recentlyaccesseditemspath',",
          "117:                     'block_recentlyaccesseditems')], $recentitems);",
          "118:         }",
          "119:     }",
          "126:     public static function delete_data_for_all_users_in_context(\\context $context) {",
          "127:         global $DB;",
          "130:         if ($context->contextlevel == CONTEXT_USER) {",
          "132:             $DB->delete_records('block_recentlyaccesseditems', ['userid' => $context->instanceid]);",
          "133:         }",
          "134:     }",
          "141:     public static function delete_data_for_user(approved_contextlist $contextlist) {",
          "142:         global $DB;",
          "144:         foreach ($contextlist as $context) {",
          "146:             if ($context->contextlevel == CONTEXT_USER && $contextlist->get_user()->id == $context->instanceid) {",
          "147:                 $DB->delete_records('block_recentlyaccesseditems', ['userid' => $context->instanceid]);",
          "148:             }",
          "149:         }",
          "150:     }",
          "151: }",
          "",
          "---------------"
        ],
        "blocks/recentlyaccesseditems/db/access.php||blocks/recentlyaccesseditems/db/access.php": [
          "File: blocks/recentlyaccesseditems/db/access.php -> blocks/recentlyaccesseditems/db/access.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: <?php",
          "23: defined('MOODLE_INTERNAL') || die();",
          "24: $capabilities = array(",
          "25:         'block/recentlyaccesseditems:myaddinstance' => array(",
          "26:                 'captype' => 'write',",
          "27:                 'contextlevel' => CONTEXT_SYSTEM,",
          "28:                 'archetypes' => array(",
          "29:                         'user' => CAP_ALLOW",
          "30:                 ),",
          "31:                 'clonepermissionsfrom' => 'moodle/my:manageblocks'",
          "32:         ),",
          "33:         'block/recentlyaccesseditems:addinstance' => array(",
          "34:                 'captype' => 'write',",
          "35:                 'contextlevel' => CONTEXT_BLOCK,",
          "36:                 'archetypes' => array(",
          "37:                         'manager' => CAP_ALLOW",
          "38:                 ),",
          "39:                 'clonepermissionsfrom' => 'moodle/site:manageblocks'",
          "40:         )",
          "41: );",
          "",
          "---------------"
        ],
        "blocks/recentlyaccesseditems/db/events.php||blocks/recentlyaccesseditems/db/events.php": [
          "File: blocks/recentlyaccesseditems/db/events.php -> blocks/recentlyaccesseditems/db/events.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: <?php",
          "26: defined('MOODLE_INTERNAL') || die();",
          "28: $observers = array (",
          "29:     array(",
          "30:             'eventname'   => '\\core\\event\\course_module_viewed',",
          "31:             'callback'    => 'block_recentlyaccesseditems\\observer::store',",
          "32:     ),",
          "33:     array(",
          "34:             'eventname'   => '\\core\\event\\course_module_deleted',",
          "35:             'callback'    => 'block_recentlyaccesseditems\\observer::remove'",
          "36:     ),",
          "37: );",
          "",
          "---------------"
        ],
        "blocks/recentlyaccesseditems/db/services.php||blocks/recentlyaccesseditems/db/services.php": [
          "File: blocks/recentlyaccesseditems/db/services.php -> blocks/recentlyaccesseditems/db/services.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: <?php",
          "26: defined('MOODLE_INTERNAL') || die();",
          "28: $functions = array(",
          "29:     'block_recentlyaccesseditems_get_recent_items' => array(",
          "30:         'classname' => 'block_recentlyaccesseditems\\external',",
          "31:         'methodname' => 'get_recent_items',",
          "32:         'classpath' => '',",
          "33:         'description' => 'List of items a user has accessed most recently.',",
          "34:         'type' => 'read',",
          "35:         'ajax' => true,",
          "36:         'services' => array(MOODLE_OFFICIAL_MOBILE_SERVICE),",
          "37:     ),",
          "38: );",
          "",
          "---------------"
        ],
        "blocks/recentlyaccesseditems/lang/en/block_recentlyaccesseditems.php||blocks/recentlyaccesseditems/lang/en/block_recentlyaccesseditems.php": [
          "File: blocks/recentlyaccesseditems/lang/en/block_recentlyaccesseditems.php -> blocks/recentlyaccesseditems/lang/en/block_recentlyaccesseditems.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: <?php",
          "23: $string['noitems'] = 'No recent items';",
          "24: $string['pluginname'] = 'Recently accessed items';",
          "25: $string['privacy:metadata:cmid'] = 'The course module id';",
          "26: $string['privacy:metadata:courseid'] = 'Course the item belongs to';",
          "27: $string['privacy:metadata:block_recentlyaccesseditemstablesummary'] = 'Information about the last time a user accessed an item.';",
          "28: $string['privacy:metadata:timeaccess'] = 'The time of the last access to the item by the user.';",
          "29: $string['privacy:metadata:userid'] = 'User who accessed the item';",
          "30: $string['privacy:recentlyaccesseditemspath'] = 'Recently accessed items';",
          "31: $string['recentlyaccesseditems:addinstance'] = 'Add a new recently accessed items block';",
          "32: $string['recentlyaccesseditems:myaddinstance'] = 'Add a new recently accessed items block to Dashboard';",
          "",
          "---------------"
        ],
        "blocks/recentlyaccesseditems/templates/main.mustache||blocks/recentlyaccesseditems/templates/main.mustache": [
          "File: blocks/recentlyaccesseditems/templates/main.mustache -> blocks/recentlyaccesseditems/templates/main.mustache",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: {{!",
          "2:     This file is part of Moodle - http://moodle.org/",
          "4:     Moodle is free software: you can redistribute it and/or modify",
          "5:     it under the terms of the GNU General Public License as published by",
          "6:     the Free Software Foundation, either version 3 of the License, or",
          "7:     (at your option) any later version.",
          "9:     Moodle is distributed in the hope that it will be useful,",
          "10:     but WITHOUT ANY WARRANTY; without even the implied warranty of",
          "11:     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the",
          "12:     GNU General Public License for more details.",
          "14:     You should have received a copy of the GNU General Public License",
          "15:     along with Moodle.  If not, see <http://www.gnu.org/licenses/>.",
          "16: }}",
          "17: {{!",
          "18:     @template block_recentlyaccesseditems/main",
          "20:     This template renders the main content area for the Recently accessed itemes block.",
          "22:     Example context (json):",
          "23:     {}",
          "24: }}",
          "26: <div id=\"block-recentlyaccesseditems-{{uniqid}}\" class=\"block-  recentlyaccesseditems\" data-region=\"recentlyaccesseditems\">",
          "27:     <div class=\"container-fluid p-0\">",
          "28:         {{> block_recentlyaccesseditems/recentlyaccesseditems-view }}",
          "29:     </div>",
          "30: </div>",
          "31: {{#js}}",
          "32: require(",
          "33: [",
          "34:     'jquery',",
          "35:     'block_recentlyaccesseditems/main',",
          "36: ],",
          "37: function(",
          "38:     $,",
          "39:     Main",
          "40: ) {",
          "41:     var root = $('#block-recentlyaccesseditems-{{uniqid}}');",
          "43:     Main.init(root);",
          "44: });",
          "45: {{/js}}",
          "",
          "---------------"
        ],
        "blocks/recentlyaccesseditems/templates/no-items.mustache||blocks/recentlyaccesseditems/templates/no-items.mustache": [
          "File: blocks/recentlyaccesseditems/templates/no-items.mustache -> blocks/recentlyaccesseditems/templates/no-items.mustache",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: {{!",
          "2:     This file is part of Moodle - http://moodle.org/",
          "4:     Moodle is free software: you can redistribute it and/or modify",
          "5:     it under the terms of the GNU General Public License as published by",
          "6:     the Free Software Foundation, either version 3 of the License, or",
          "7:     (at your option) any later version.",
          "9:     Moodle is distributed in the hope that it will be useful,",
          "10:     but WITHOUT ANY WARRANTY; without even the implied warranty of",
          "11:     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the",
          "12:     GNU General Public License for more details.",
          "14:     You should have received a copy of the GNU General Public License",
          "15:     along with Moodle.  If not, see <http://www.gnu.org/licenses/>.",
          "16: }}",
          "17: {{!",
          "18:     @template block_recentlyaccesseditems/no-items",
          "20:     This template renders the no items message.",
          "22:     Example context (json):",
          "23:     {",
          "24:         \"noitemsimgurl\": \"https://moodlesite/theme/image.php/boost/block_recentlyaccesseditems/1535727318/items\"",
          "25:     }",
          "26: }}",
          "27: <div class=\"text-center mt-3\" data-region=\"empty-message\">",
          "28:     <img class=\"empty-placeholder-image-lg\"",
          "29:         src=\"{{noitemsimgurl}}\"",
          "30:         alt=\"{{#str}} noitems, block_recentlyaccesseditems {{/str}}\"",
          "31:         role=\"presentation\"",
          "32:     >",
          "33:     <p class=\"text-muted mt-3\">{{#str}} noitems, block_recentlyaccesseditems {{/str}}</p>",
          "34: </div>",
          "",
          "---------------"
        ],
        "blocks/recentlyaccesseditems/templates/placeholder-item.mustache||blocks/recentlyaccesseditems/templates/placeholder-item.mustache": [
          "File: blocks/recentlyaccesseditems/templates/placeholder-item.mustache -> blocks/recentlyaccesseditems/templates/placeholder-item.mustache",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: {{!",
          "2:     This file is part of Moodle - http://moodle.org/",
          "4:     Moodle is free software: you can redistribute it and/or modify",
          "5:     it under the terms of the GNU General Public License as published by",
          "6:     the Free Software Foundation, either version 3 of the License, or",
          "7:     (at your option) any later version.",
          "9:     Moodle is distributed in the hope that it will be useful,",
          "10:     but WITHOUT ANY WARRANTY; without even the implied warranty of",
          "11:     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the",
          "12:     GNU General Public License for more details.",
          "14:     You should have received a copy of the GNU General Public License",
          "15:     along with Moodle.  If not, see <http://www.gnu.org/licenses/>.",
          "16: }}",
          "17: {{!",
          "18:     @template block_recentlyaccesseditems/placeholder-item",
          "20:     This template renders a card item loading placeholder for the Recently accessed items block.",
          "22:     Example context (json):",
          "23:     {}",
          "24: }}",
          "25: <div class=\"card-body course-info-container\">",
          "26:     <div class=\"d-flex flex-row align-items-center\" style=\"height: 32px\">",
          "27:         <div class=\"bg-pulse-grey rounded-circle\" style=\"height: 32px; width: 32px;\"></div>",
          "28:         <div class=\"w-100 line-height-3 ml-1\">",
          "29:                 <div class=\"bg-pulse-grey w-100\" style=\"height: 15px;\"></div>",
          "30:                 <div class=\"bg-pulse-grey w-75 mt-1\" style=\"height: 10px;\"></div>",
          "31:         </div>",
          "32:     </div>",
          "33: </div>",
          "",
          "---------------"
        ],
        "blocks/recentlyaccesseditems/templates/recentlyaccesseditems-view.mustache||blocks/recentlyaccesseditems/templates/recentlyaccesseditems-view.mustache": [
          "File: blocks/recentlyaccesseditems/templates/recentlyaccesseditems-view.mustache -> blocks/recentlyaccesseditems/templates/recentlyaccesseditems-view.mustache",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: {{!",
          "2:     This file is part of Moodle - http://moodle.org/",
          "4:     Moodle is free software: you can redistribute it and/or modify",
          "5:     it under the terms of the GNU General Public License as published by",
          "6:     the Free Software Foundation, either version 3 of the License, or",
          "7:     (at your option) any later version.",
          "9:     Moodle is distributed in the hope that it will be useful,",
          "10:     but WITHOUT ANY WARRANTY; without even the implied warranty of",
          "11:     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the",
          "12:     GNU General Public License for more details.",
          "14:     You should have received a copy of the GNU General Public License",
          "15:     along with Moodle.  If not, see <http://www.gnu.org/licenses/>.",
          "16: }}",
          "17: {{!",
          "18:     @template block_recentlyaccesseditems/recentlyaccesseditems-view",
          "20:     This template renders the items view for the Recently accessed items block.",
          "22:     Example context (json):",
          "23:     {",
          "24:         \"noitemsimgurl\": \"https://moodlesite/theme/image.php/boost/block_recentactivities/1535727318/items\"",
          "25:     }",
          "26: }}",
          "27: <div id=\"recentlyaccesseditems-view-{{uniqid}}\"",
          "28:      data-region=\"recentlyaccesseditems-view\"",
          "29:      data-noitemsimgurl=\"{{noitemsimgurl}}\">",
          "30:     <div data-region=\"recentlyaccesseditems-view-content\">",
          "31:         <div data-region=\"recentlyaccesseditems-loading-placeholder\">",
          "32:             <div class=\"card-deck dashboard-card-deck\">",
          "33:                 {{> block_recentlyaccesseditems/placeholder-item }}",
          "34:                 {{> block_recentlyaccesseditems/placeholder-item }}",
          "35:                 {{> block_recentlyaccesseditems/placeholder-item }}",
          "36:             </div>",
          "37:         </div>",
          "38:     </div>",
          "39: </div>",
          "",
          "---------------"
        ],
        "blocks/recentlyaccesseditems/templates/view-cards.mustache||blocks/recentlyaccesseditems/templates/view-cards.mustache": [
          "File: blocks/recentlyaccesseditems/templates/view-cards.mustache -> blocks/recentlyaccesseditems/templates/view-cards.mustache",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: {{!",
          "2:     This file is part of Moodle - http://moodle.org/",
          "4:     Moodle is free software: you can redistribute it and/or modify",
          "5:     it under the terms of the GNU General Public License as published by",
          "6:     the Free Software Foundation, either version 3 of the License, or",
          "7:     (at your option) any later version.",
          "9:     Moodle is distributed in the hope that it will be useful,",
          "10:     but WITHOUT ANY WARRANTY; without even the implied warranty of",
          "11:     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the",
          "12:     GNU General Public License for more details.",
          "14:     You should have received a copy of the GNU General Public Licensebllsdsadfasfd",
          "15:     along with Moodle.  If not, see <http://www.gnu.org/licenses/>.",
          "16: }}",
          "17: {{!",
          "18:     @template block_recentlyaccesseditems/view-cards",
          "20:     This template renders the items cards of the Recently accessed items block.",
          "22:     Example context (json):",
          "23:     {",
          "24:         \"items\": [",
          "25:             {",
          "26:                 \"cmid\": 64,",
          "27:                 \"courseid\": 2,",
          "28:                 \"coursename\": \"Course\",",
          "29:                 \"courseviewurl\": \"https://moodlesite/course/view.php?id=2\",",
          "30:                 \"icon\": \"<img class=\\\"icon\\\" alt=\\\"Forum\\\" title=\\\"Forum\\\" src=\\\"http://moodlesite/theme/image.php/boost/forum/1539858121/icon\\\" />\",",
          "31:                 \"name\": \"Assignment due 1\",",
          "32:                 \"id\": 17,",
          "33:                 \"modname\": \"Forum\",",
          "34:                 \"name\": \"Forum\",",
          "35:                 \"timeaccess\": 1539848498,",
          "36:                 \"userid\": 2,",
          "37:                 \"viewurl\": \"http://moodlesite/mod/forum?id=64\"",
          "38:             }",
          "39:         ]",
          "40:     }",
          "41: }}",
          "43: <div class=\"card-deck dashboard-card-deck\" role=\"list\">",
          "44:     {{#items}}",
          "45:         <a",
          "46:                 class=\"card dashboard-card py-2 pl-0 pr-0\"",
          "47:                 href=\"{{{viewurl}}}\"",
          "48:                 title=\"{{name}}\"",
          "49:         >",
          "50:             <div class=\"card-body course-info-container\">",
          "51:                 <div class=\"d-flex\">",
          "52:                     <div class=\"icon-size-4 d-flex align-self-center\">",
          "53:                         {{{icon}}}",
          "54:                     </div>",
          "55:                     <div class=\"w-100 line-height-3 text-truncate\">",
          "56:                         <h6 class=\"mb-0\">{{{name}}}</h6>",
          "57:                         <small class=\"text-muted m-b-0\">{{{coursename}}}</small>",
          "58:                     </div>",
          "59:                 </div>",
          "60:             </div>",
          "61:         </a>",
          "62:     {{/items}}",
          "63: </div>",
          "",
          "---------------"
        ],
        "blocks/recentlyaccesseditems/tests/behat/block_recentlyaccesseditems_dashboard.feature||blocks/recentlyaccesseditems/tests/behat/block_recentlyaccesseditems_dashboard.feature": [
          "File: blocks/recentlyaccesseditems/tests/behat/block_recentlyaccesseditems_dashboard.feature -> blocks/recentlyaccesseditems/tests/behat/block_recentlyaccesseditems_dashboard.feature",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: @block @block_recentlyaccesseditems @javascript",
          "2: Feature: The recently accessed items block allows users to easily access their most recently visited items",
          "3:   In order to access the most recent items accessed",
          "4:   As a user",
          "5:   I can use the recently accessed items block in my dashboard",
          "7:   Background:",
          "8:     Given the following \"users\" exist:",
          "9:       | username | firstname | lastname | email                |",
          "10:       | student1 | Student   | 1        | student1@example.com |",
          "11:     And the following \"courses\" exist:",
          "12:       | fullname | shortname |",
          "13:       | Course 1 | C1        |",
          "14:       | Course 2 | C2        |",
          "15:     And the following \"course enrolments\" exist:",
          "16:       | user     | course | role    |",
          "17:       | student1 | C1     | student |",
          "18:       | student1 | C2     | student |",
          "19:     And I log in as \"admin\"",
          "20:     And I am on \"Course 1\" course homepage",
          "21:     And I turn editing mode on",
          "22:     And I add a \"Forum\" to section \"1\" and I fill the form with:",
          "23:       | Forum name | Test forum name |",
          "24:       | Forum type | Standard forum for general use |",
          "25:       | Description | Test forum description |",
          "26:     And I log out",
          "27:     And I log in as \"student1\"",
          "28:     When I press \"Customise this page\"",
          "29:     And I add the \"Recently accessed items\" block",
          "31:   Scenario: User has not accessed any item",
          "32:     Then I should see \"No recent items\" in the \"Recently accessed items\" \"block\"",
          "34:   Scenario: User has accessed some items",
          "35:     Given I am on \"Course 1\" course homepage",
          "36:     When  I follow \"Test forum name\"",
          "37:     And I follow \"Dashboard\" in the user menu",
          "38:     Then I should see \"Test forum name\" in the \"Recently accessed items\" \"block\"",
          "",
          "---------------"
        ],
        "blocks/recentlyaccesseditems/tests/externallib_test.php||blocks/recentlyaccesseditems/tests/externallib_test.php": [
          "File: blocks/recentlyaccesseditems/tests/externallib_test.php -> blocks/recentlyaccesseditems/tests/externallib_test.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: <?php",
          "27: defined('MOODLE_INTERNAL') || die();",
          "29: global $CFG;",
          "31: require_once($CFG->dirroot . '/webservice/tests/helpers.php');",
          "42: class block_recentlyaccesseditems_externallib_testcase extends externallib_advanced_testcase {",
          "47:     public function test_get_recent_items() {",
          "49:         $this->resetAfterTest();",
          "50:         $generator = $this->getDataGenerator();",
          "53:         $courses = array();",
          "54:         for ($i = 1; $i < 4; $i++) {",
          "55:             $courses[] = $generator->create_course();",
          "56:         };",
          "59:         $student = $generator->create_user();",
          "60:         $teacher = $generator->create_user();",
          "63:         foreach ($courses as $course) {",
          "64:             $generator->enrol_user($student->id, $course->id, 'student');",
          "65:             $forum[] = $this->getDataGenerator()->create_module('forum', array('course' => $course));",
          "66:             $glossary[] = $this->getDataGenerator()->create_module('glossary', array('course' => $course));",
          "67:             $chat[] = $this->getDataGenerator()->create_module('chat', array('course' => $course));",
          "68:         }",
          "69:         $generator->enrol_user($teacher->id, $courses[0]->id, 'teacher');",
          "71:         $this->setUser($student);",
          "74:         $result = \\block_recentlyaccesseditems\\external::get_recent_items();",
          "75:         $this->assertCount(0, $result);",
          "78:         foreach ($forum as $module) {",
          "79:             $event = \\mod_forum\\event\\course_module_viewed::create(array('context' => context_module::instance($module->cmid),",
          "80:                     'objectid' => $module->id));",
          "81:             $event->trigger();",
          "82:             $this->waitForSecond();",
          "83:         }",
          "86:         $result = \\block_recentlyaccesseditems\\external::get_recent_items();",
          "87:         $this->assertCount(count($forum), $result);",
          "90:         foreach ($chat as $module) {",
          "91:             $event = \\mod_chat\\event\\course_module_viewed::create(array('context' => context_module::instance($module->cmid),",
          "92:                     'objectid' => $module->id));",
          "93:             $event->trigger();",
          "94:             $this->waitForSecond();",
          "95:         }",
          "98:         $result = \\block_recentlyaccesseditems\\external::get_recent_items();",
          "99:         $this->assertCount((count($forum) + count($chat)), $result);",
          "100:         foreach ($result as $key => $record) {",
          "101:             if ($key == 0) {",
          "102:                 continue;",
          "103:             }",
          "104:             $this->assertTrue($record->timeaccess < $result[$key - 1]->timeaccess);",
          "105:         }",
          "106:     }",
          "107: }",
          "",
          "---------------"
        ],
        "blocks/recentlyaccesseditems/tests/observer_test.php||blocks/recentlyaccesseditems/tests/observer_test.php": [
          "File: blocks/recentlyaccesseditems/tests/observer_test.php -> blocks/recentlyaccesseditems/tests/observer_test.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: <?php",
          "26: defined('MOODLE_INTERNAL') || die();",
          "28: global $CFG;",
          "29: require_once($CFG->dirroot . '/mod/assign/tests/generator.php');",
          "39: class block_recentlyaccesseditems_observer_testcase extends advanced_testcase {",
          "40:     use mod_assign_test_generator;",
          "45:     public function setUp() {",
          "46:         global $DB;",
          "48:         $this->resetAfterTest();",
          "49:         $this->setAdminUser();",
          "52:         $this->table = \"block_recentlyaccesseditems\";",
          "55:         $this->course = $this->getDataGenerator()->create_course();",
          "58:         $this->student = self::getDataGenerator()->create_user();",
          "59:         $this->teacher = self::getDataGenerator()->create_user();",
          "62:         $this->studentrole = $DB->get_record('role', array('shortname' => 'student'));",
          "63:         $this->teacherrole = $DB->get_record('role', array('shortname' => 'editingteacher'));",
          "64:         $this->getDataGenerator()->enrol_user($this->student->id, $this->course->id, $this->studentrole->id, 'manual');",
          "65:         $this->getDataGenerator()->enrol_user($this->teacher->id, $this->course->id, $this->teacherrole->id, 'manual');",
          "68:         $this->forum = $this->getDataGenerator()->create_module('forum', array('course' => $this->course));",
          "69:         $this->glossary = $this->getDataGenerator()->create_module('glossary', array('course' => $this->course));",
          "70:         $this->chat = $this->getDataGenerator()->create_module('chat', array('course' => $this->course));",
          "71:     }",
          "78:     public function test_item_view_recorded_testcase() {",
          "79:         global $DB;",
          "82:         $records = $DB->count_records($this->table, array());",
          "83:         $this->assertEquals(0, $records);",
          "86:         $this->setUser($this->teacher);",
          "87:         $event = \\mod_forum\\event\\course_module_viewed::create(array('context' => context_module::instance($this->forum->cmid),",
          "88:                 'objectid' => $this->forum->id));",
          "89:         $event->trigger();",
          "92:         $this->setUser($this->student);",
          "93:         $event1 = \\mod_chat\\event\\course_module_viewed::create(array('context' => context_module::instance($this->chat->cmid),",
          "94:                 'objectid' => $this->chat->id));",
          "95:         $event1->trigger();",
          "97:         $records = $DB->count_records($this->table, array('userid' => $this->teacher->id, 'courseid' => $this->course->id,",
          "98:                 'cmid' => $this->forum->cmid));",
          "99:         $this->assertEquals(1, $records);",
          "101:         $records = $DB->count_records($this->table, array('userid' => $this->student->id, 'courseid' => $this->course->id, 'cmid' =>",
          "102:                 $this->chat->cmid));",
          "103:         $this->assertEquals(1, $records);",
          "105:         $this->waitForSecond();",
          "107:         $event2 = \\mod_chat\\event\\course_module_viewed::create(array('context' => context_module::instance($this->chat->cmid),",
          "108:                 'objectid' => $this->chat->id));",
          "109:         $event2->trigger();",
          "111:         $records = $DB->get_records($this->table, array('userid' => $this->student->id, 'courseid' => $this->course->id, 'cmid' =>",
          "112:                 $this->chat->cmid));",
          "113:         $this->assertCount(1, $records);",
          "114:         $this->assertEquals($event2->timecreated, array_shift($records)->timeaccess);",
          "116:     }",
          "123:     public function test_item_delete_record_testcase() {",
          "124:         global $DB;",
          "127:         $records = $DB->count_records($this->table, array());",
          "128:         $this->assertEquals(0, $records);",
          "131:         $this->setUser($this->teacher);",
          "132:         $event = \\mod_forum\\event\\course_module_viewed::create(array('context' => context_module::instance($this->forum->cmid),",
          "133:                 'objectid' => $this->forum->id));",
          "134:         $event->trigger();",
          "137:         $event = \\mod_chat\\event\\course_module_viewed::create(array('context' => context_module::instance($this->chat->cmid),",
          "138:                 'objectid' => $this->chat->id));",
          "139:         $event->trigger();",
          "142:         $this->setUser($this->student);",
          "143:         $event = \\mod_chat\\event\\course_module_viewed::create(array('context' => context_module::instance($this->chat->cmid),",
          "144:                 'objectid' => $this->chat->id));",
          "145:         $event->trigger();",
          "148:         $event = \\mod_forum\\event\\course_module_viewed::create(array('context' => context_module::instance($this->forum->cmid),",
          "149:                 'objectid' => $this->forum->id));",
          "150:         $event->trigger();",
          "152:         $records = $DB->count_records($this->table, array('cmid' => $this->forum->cmid));",
          "153:         $this->assertEquals(2, $records);",
          "154:         course_delete_module($this->forum->cmid);",
          "155:         $records = $DB->count_records($this->table, array('cmid' => $this->forum->cmid));",
          "156:         $this->assertEquals(0, $records);",
          "157:         $records = $DB->count_records($this->table, array('cmid' => $this->chat->cmid));",
          "158:         $this->assertEquals(2, $records);",
          "159:     }",
          "160: }",
          "",
          "---------------"
        ],
        "blocks/recentlyaccesseditems/version.php||blocks/recentlyaccesseditems/version.php": [
          "File: blocks/recentlyaccesseditems/version.php -> blocks/recentlyaccesseditems/version.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: <?php",
          "23: defined('MOODLE_INTERNAL') || die();",
          "25: $plugin->version   = 2018101705;            // The current plugin version (Date: YYYYMMDDXX).",
          "26: $plugin->requires  = 2018101900;            // Requires this Moodle version.",
          "27: $plugin->component = 'block_recentlyaccesseditems'; // Full name of the plugin (used for diagnostics).",
          "",
          "---------------"
        ],
        "lib/classes/plugin_manager.php||lib/classes/plugin_manager.php": [
          "File: lib/classes/plugin_manager.php -> lib/classes/plugin_manager.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "1718:                 'feedback', 'globalsearch', 'glossary_random', 'html',",
          "1719:                 'login', 'lp', 'mentees', 'mnet_hosts', 'myoverview', 'myprofile',",
          "1720:                 'navigation', 'news_items', 'online_users', 'participants',",
          "1722:                 'rss_client', 'search_forums', 'section_links',",
          "1723:                 'selfcompletion', 'settings', 'site_main_menu',",
          "1724:                 'social_activities', 'starredcourses', 'tag_flickr', 'tag_youtube', 'tags', 'timeline'",
          "",
          "[Removed Lines]",
          "1721:                 'private_files', 'quiz_results', 'recent_activity',",
          "",
          "[Added Lines]",
          "1721:                 'private_files', 'quiz_results', 'recent_activity', 'recentlyaccesseditems',",
          "",
          "---------------"
        ],
        "theme/boost/scss/moodle/blocks.scss||theme/boost/scss/moodle/blocks.scss": [
          "File: theme/boost/scss/moodle/blocks.scss -> theme/boost/scss/moodle/blocks.scss",
          "--- Hunk 1 ---",
          "[Context before]",
          "125:     background-size: cover;",
          "126: }",
          "128: .dashboard-card-deck .dashboard-card {",
          "129:     margin-bottom: $card-gutter;",
          "130:     flex-basis: 100%;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "128: [data-region=\"blocks-column\"] {",
          "129:     .block_recentlyaccesseditems {",
          "130:         .dashboard-card-deck {",
          "131:             height: unset;",
          "132:         }",
          "133:     }",
          "134: }",
          "136: .block_recentlyaccesseditems {",
          "137:     [data-region=\"recentlyaccesseditems-view-content\"] {",
          "138:         overflow-x: hidden;",
          "139:     }",
          "140:     .dashboard-card {",
          "141:         height: 75px;",
          "142:     }",
          "143:     .dashboard-card-deck {",
          "144:         @include media-breakpoint-up(sm) {",
          "145:             height: 75px;",
          "146:             overflow: hidden;",
          "147:         }",
          "148:     }",
          "149:     .course-info-container {",
          "150:         padding: 0.8rem;",
          "151:     }",
          "152:     .empty-placeholder-image-lg {",
          "153:         height: 125px;",
          "154:     }",
          "155:     a,",
          "156:     a:hover {",
          "157:         text-decoration: none;",
          "158:         color: unset;",
          "159:     }",
          "160:     .block-controls ~ .content {",
          "161:         margin-top: 2rem !important;",
          "162:     }",
          "163: }",
          "",
          "---------------"
        ],
        "theme/boost/style/moodle.css||theme/boost/style/moodle.css": [
          "File: theme/boost/style/moodle.css -> theme/boost/style/moodle.css",
          "--- Hunk 1 ---",
          "[Context before]",
          "11201:   background-position: center;",
          "11202:   background-size: cover; }",
          "11204: .dashboard-card-deck .dashboard-card {",
          "11205:   margin-bottom: 0.5rem;",
          "11206:   flex-basis: 100%;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "11204: [data-region=\"blocks-column\"] .block_recentlyaccesseditems .dashboard-card-deck {",
          "11205:   height: unset; }",
          "11207: .block_recentlyaccesseditems [data-region=\"recentlyaccesseditems-view-content\"] {",
          "11208:   overflow-x: hidden; }",
          "11210: .block_recentlyaccesseditems .dashboard-card {",
          "11211:   height: 75px; }",
          "11213: @media (min-width: 576px) {",
          "11214:   .block_recentlyaccesseditems .dashboard-card-deck {",
          "11215:     height: 75px;",
          "11216:     overflow: hidden; } }",
          "11218: .block_recentlyaccesseditems .course-info-container {",
          "11219:   padding: 0.8rem; }",
          "11221: .block_recentlyaccesseditems .empty-placeholder-image-lg {",
          "11222:   height: 125px; }",
          "11224: .block_recentlyaccesseditems a,",
          "11225: .block_recentlyaccesseditems a:hover {",
          "11226:   text-decoration: none;",
          "11227:   color: unset; }",
          "11229: .block_recentlyaccesseditems .block-controls ~ .content {",
          "11230:   margin-top: 2rem !important; }",
          "",
          "---------------"
        ],
        "theme/bootstrapbase/less/moodle/blocks.less||theme/bootstrapbase/less/moodle/blocks.less": [
          "File: theme/bootstrapbase/less/moodle/blocks.less -> theme/bootstrapbase/less/moodle/blocks.less",
          "--- Hunk 1 ---",
          "[Context before]",
          "395:     }",
          "396: }",
          "398: .dashboard-card-deck {",
          "399:     box-sizing: border-box;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "398: .block_recentlyaccesseditems {",
          "399:     [data-region=\"recentlyaccesseditems-view-content\"] {",
          "400:         overflow-x: hidden;",
          "401:     }",
          "402:     .dashboard-card {",
          "403:         height: 75px;",
          "404:     }",
          "405:     .dashboard-card-deck {",
          "406:         @media (min-width: 576px) {",
          "407:             height: 75px;",
          "408:             overflow: hidden;",
          "409:         }",
          "410:     }",
          "411:     .empty-placeholder-image-lg {",
          "412:         height: 125px;",
          "413:     }",
          "414:     .course-info-container {",
          "415:         flex: 1 1 auto;",
          "416:         padding: 0.8rem;",
          "417:     }",
          "418:     .icon-size-4 .icon {",
          "419:         height: auto;",
          "420:         width: auto;",
          "421:         background-image: unset;",
          "422:         box-sizing: unset;",
          "423:     }",
          "424:     .icon-size-4 {",
          "425:         background-image: unset;",
          "426:         height: unset;",
          "427:         width: unset;",
          "428:     }",
          "429:     .ml-1 {",
          "430:         margin-left: 10px;",
          "431:     }",
          "432:     h6 {",
          "433:         font-size: .9375rem;",
          "434:         margin-bottom: 0;",
          "435:     }",
          "436:     a,",
          "437:     a:hover {",
          "438:         text-decoration: none;",
          "439:         color: unset;",
          "440:     }",
          "441: }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "433: }",
          "435: @media (min-width: 768px) {",
          "437:         margin: 0;",
          "438:         .dashboard-card {",
          "439:             flex-basis: 100%;",
          "440:             margin-left: 0;",
          "",
          "[Removed Lines]",
          "436:     #block-region-side-post .dashboard-card-deck {",
          "",
          "[Added Lines]",
          "481:     #block-region-side-post .dashboard-card-deck,",
          "482:     #block-region-side-pre .dashboard-card-deck {",
          "484:         height: unset;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "459: .position-absolute {",
          "460:     position: absolute;",
          "",
          "[Removed Lines]",
          "461: }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "theme/bootstrapbase/style/moodle.css||theme/bootstrapbase/style/moodle.css": [
          "File: theme/bootstrapbase/style/moodle.css -> theme/bootstrapbase/style/moodle.css",
          "--- Hunk 1 ---",
          "[Context before]",
          "16610:   flex-flow: nowrap;",
          "16611:   overflow-y: scroll;",
          "16612: }",
          "16613: .dashboard-card-deck {",
          "16614:   box-sizing: border-box;",
          "16615:   display: flex;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "16613: .block_recentlyaccesseditems [data-region=\"recentlyaccesseditems-view-content\"] {",
          "16614:   overflow-x: hidden;",
          "16615: }",
          "16616: .block_recentlyaccesseditems .dashboard-card {",
          "16617:   height: 75px;",
          "16618: }",
          "16619: @media (min-width: 576px) {",
          "16620:   .block_recentlyaccesseditems .dashboard-card-deck {",
          "16621:     height: 75px;",
          "16622:     overflow: hidden;",
          "16623:   }",
          "16624: }",
          "16625: .block_recentlyaccesseditems .empty-placeholder-image-lg {",
          "16626:   height: 125px;",
          "16627: }",
          "16628: .block_recentlyaccesseditems .course-info-container {",
          "16629:   flex: 1 1 auto;",
          "16630:   padding: 0.8rem;",
          "16631: }",
          "16632: .block_recentlyaccesseditems .icon-size-4 .icon {",
          "16633:   height: auto;",
          "16634:   width: auto;",
          "16635:   background-image: unset;",
          "16636:   box-sizing: unset;",
          "16637: }",
          "16638: .block_recentlyaccesseditems .icon-size-4 {",
          "16639:   background-image: unset;",
          "16640:   height: unset;",
          "16641:   width: unset;",
          "16642: }",
          "16643: .block_recentlyaccesseditems .ml-1 {",
          "16644:   margin-left: 10px;",
          "16645: }",
          "16646: .block_recentlyaccesseditems h6 {",
          "16647:   font-size: .9375rem;",
          "16648:   margin-bottom: 0;",
          "16649: }",
          "16650: .block_recentlyaccesseditems a,",
          "16651: .block_recentlyaccesseditems a:hover {",
          "16652:   text-decoration: none;",
          "16653:   color: unset;",
          "16654: }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "16647:   }",
          "16648: }",
          "16649: @media (min-width: 768px) {",
          "16651:     margin: 0;",
          "16652:   }",
          "16654:     flex-basis: 100%;",
          "16655:     margin-left: 0;",
          "16656:     margin-right: 0;",
          "",
          "[Removed Lines]",
          "16650:   #block-region-side-post .dashboard-card-deck {",
          "16653:   #block-region-side-post .dashboard-card-deck .dashboard-card {",
          "",
          "[Added Lines]",
          "16692:   #block-region-side-post .dashboard-card-deck,",
          "16693:   #block-region-side-pre .dashboard-card-deck {",
          "16695:     height: unset;",
          "16697:   #block-region-side-post .dashboard-card-deck .dashboard-card,",
          "16698:   #block-region-side-pre .dashboard-card-deck .dashboard-card {",
          "",
          "---------------"
        ],
        "version.php||version.php": [
          "File: version.php -> version.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "30: defined('MOODLE_INTERNAL') || die();",
          "",
          "[Removed Lines]",
          "32: $version  = 2018110100.00;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "",
          "[Added Lines]",
          "32: $version  = 2018110100.01;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "6d6b14e8a4196b20763ed0f148b969963f87f5d6",
      "candidate_info": {
        "commit_hash": "6d6b14e8a4196b20763ed0f148b969963f87f5d6",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/6d6b14e8a4196b20763ed0f148b969963f87f5d6",
        "files": [
          "version.php"
        ],
        "message": "weekly release 3.8+",
        "before_after_code_files": [
          "version.php||version.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.php||version.php"
          ],
          "candidate": [
            "version.php||version.php"
          ]
        }
      },
      "candidate_diff": {
        "version.php||version.php": [
          "File: version.php -> version.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "30: defined('MOODLE_INTERNAL') || die();",
          "36: $branch   = '38';                       // This version's branch.",
          "37: $maturity = MATURITY_STABLE;             // This version's maturity level.",
          "",
          "[Removed Lines]",
          "32: $version  = 2019111800.01;              // 20191118      = branching date YYYYMMDD - do not modify!",
          "35: $release  = '3.8+ (Build: 20191122)'; // Human-friendly version name",
          "",
          "[Added Lines]",
          "32: $version  = 2019111800.02;              // 20191118      = branching date YYYYMMDD - do not modify!",
          "35: $release  = '3.8+ (Build: 20191129)'; // Human-friendly version name",
          "",
          "---------------"
        ]
      }
    }
  ]
}