{
  "cve_id": "CVE-2022-33157",
  "cve_desc": "The libconnect extension before 7.0.8 and 8.x before 8.1.0 for TYPO3 allows XSS.",
  "repo": "subhh/libconnect",
  "patch_hash": "8c582f3f6575f8744bf29f99bc1697ab8b7bd3af",
  "patch_info": {
    "commit_hash": "8c582f3f6575f8744bf29f99bc1697ab8b7bd3af",
    "repo": "subhh/libconnect",
    "commit_url": "https://github.com/subhh/libconnect/commit/8c582f3f6575f8744bf29f99bc1697ab8b7bd3af",
    "files": [
      "Classes/Controller/EzbController.php",
      "Resources/Private/Templates/Ezb/DisplayError.html"
    ],
    "message": "Fixed payload xss.",
    "before_after_code_files": [
      "Classes/Controller/EzbController.php||Classes/Controller/EzbController.php",
      "Resources/Private/Templates/Ezb/DisplayError.html||Resources/Private/Templates/Ezb/DisplayError.html"
    ]
  },
  "patch_diff": {
    "Classes/Controller/EzbController.php||Classes/Controller/EzbController.php": [
      "File: Classes/Controller/EzbController.php -> Classes/Controller/EzbController.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "434:             $params = \\TYPO3\\CMS\\Core\\Utility\\GeneralUtility::_GPmerged('libconnect');",
      "435:         }",
      "437:         $ParticipantsList =  $this->ezbRepository->getParticipantsList($params['jourid']);",
      "439:         $config['partnerPid'] = 0;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "438:         if(!is_numeric($params['jourid']) || is_empty($params['jourid'])){",
      "440:             $controllerContext = $this->buildControllerContext();",
      "441:             $controllerContext->getRequest()->setControllerActionName('displayError');",
      "442:             $this->view->setControllerContext($controllerContext);",
      "444:             $this->view->assign('error', 'Es wurde keine g\u00fcltige Journal-ID \u00fcbergeben.');",
      "446:             return;",
      "447:         }",
      "",
      "---------------"
    ],
    "Resources/Private/Templates/Ezb/DisplayError.html||Resources/Private/Templates/Ezb/DisplayError.html": [
      "File: Resources/Private/Templates/Ezb/DisplayError.html -> Resources/Private/Templates/Ezb/DisplayError.html",
      "--- Hunk 1 ---",
      "[Context before]",
      "3: <f:section name=\"main\">",
      "5: <f:asset.css identifier=\"ezb\" href=\"EXT:libconnect/Resources/Public/Css/ezb.css\" />",
      "6: </f:section>",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "5: {error}",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "991d8946a873ce209f161cb1ab756c9b3d00cf22",
      "candidate_info": {
        "commit_hash": "991d8946a873ce209f161cb1ab756c9b3d00cf22",
        "repo": "subhh/libconnect",
        "commit_url": "https://github.com/subhh/libconnect/commit/991d8946a873ce209f161cb1ab756c9b3d00cf22",
        "files": [
          "Classes/Controller/EzbController.php"
        ],
        "message": "Hot fix.",
        "before_after_code_files": [
          "Classes/Controller/EzbController.php||Classes/Controller/EzbController.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "Classes/Controller/EzbController.php||Classes/Controller/EzbController.php"
          ],
          "candidate": [
            "Classes/Controller/EzbController.php||Classes/Controller/EzbController.php"
          ]
        }
      },
      "candidate_diff": {
        "Classes/Controller/EzbController.php||Classes/Controller/EzbController.php": [
          "File: Classes/Controller/EzbController.php -> Classes/Controller/EzbController.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "204:         $config['listPid'] = $this->settings['flexform']['listPid'];",
          "209:             $controllerContext = $this->buildControllerContext();",
          "210:             $controllerContext->getRequest()->setControllerActionName('displayError');",
          "",
          "[Removed Lines]",
          "207:         if(!is_numeric($params['jourid']) || is_empty($params['jourid'])){",
          "",
          "[Added Lines]",
          "207:         if(!is_numeric($params['jourid']) || empty($params['jourid'])){",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "439:         }",
          "444:             $controllerContext = $this->buildControllerContext();",
          "445:             $controllerContext->getRequest()->setControllerActionName('displayError');",
          "",
          "[Removed Lines]",
          "442:         if(!is_numeric($params['jourid']) || is_empty($params['jourid'])){",
          "",
          "[Added Lines]",
          "442:         if(!is_numeric($params['jourid']) || empty($params['jourid'])){",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "2bbd0e82d535ab2e4250db2f7a3f8d2f9d471c61",
      "candidate_info": {
        "commit_hash": "2bbd0e82d535ab2e4250db2f7a3f8d2f9d471c61",
        "repo": "subhh/libconnect",
        "commit_url": "https://github.com/subhh/libconnect/commit/2bbd0e82d535ab2e4250db2f7a3f8d2f9d471c61",
        "files": [
          "Classes/Controller/DbisController.php",
          "Classes/Controller/EzbController.php"
        ],
        "message": "Replaced use of deprecated function buildControllerContext().",
        "before_after_code_files": [
          "Classes/Controller/DbisController.php||Classes/Controller/DbisController.php",
          "Classes/Controller/EzbController.php||Classes/Controller/EzbController.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "Classes/Controller/EzbController.php||Classes/Controller/EzbController.php"
          ],
          "candidate": [
            "Classes/Controller/EzbController.php||Classes/Controller/EzbController.php"
          ]
        }
      },
      "candidate_diff": {
        "Classes/Controller/DbisController.php||Classes/Controller/DbisController.php": [
          "File: Classes/Controller/DbisController.php -> Classes/Controller/DbisController.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "133:             $list =  $this->dbisRepository->loadSearch($params['search'], $config);",
          "141:             $list['access_infos'] = $this->setAccessInformation($list['access_infos']);",
          "",
          "[Removed Lines]",
          "136:             $controllerContext = $this->buildControllerContext();",
          "137:             $controllerContext->getRequest()->setControllerActionName('displaySearch');",
          "138:             $this->view->setControllerContext($controllerContext);",
          "",
          "[Added Lines]",
          "136:             $this->view->setTemplatePathAndFilename(",
          "137:                 'typo3conf/ext/' .",
          "138:                 $this->request->getControllerExtensionKey() .",
          "139:                 '/Resources/Private/Templates/Dbis/DisplaySearch.html'",
          "140:             );",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "146:             $list =  $this->dbisRepository->loadOverview();",
          "154:             $this->view->assign('list', $list);",
          "",
          "[Removed Lines]",
          "149:             $controllerContext = $this->buildControllerContext();",
          "150:             $controllerContext->getRequest()->setControllerActionName('displayOverview');",
          "151:             $this->view->setControllerContext($controllerContext);",
          "",
          "[Added Lines]",
          "151:             $this->view->setTemplatePathAndFilename(",
          "152:                 'typo3conf/ext/' .",
          "153:                 $this->request->getControllerExtensionKey() .",
          "154:                 '/Resources/Private/Templates/Dbis/DisplayOverview.html'",
          "155:             );",
          "",
          "---------------"
        ],
        "Classes/Controller/EzbController.php||Classes/Controller/EzbController.php": [
          "File: Classes/Controller/EzbController.php -> Classes/Controller/EzbController.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "164:             $journals =  $this->ezbRepository->loadSearch($params, $colors, $config);",
          "172:             $listURL = $GLOBALS['TSFE']->cObj->getTypolink_URL($Pid);",
          "",
          "[Removed Lines]",
          "167:             $controllerContext = $this->buildControllerContext();",
          "168:             $controllerContext->getRequest()->setControllerActionName('displaySearch');",
          "169:             $this->view->setControllerContext($controllerContext);",
          "",
          "[Added Lines]",
          "167:             $this->view->setTemplatePathAndFilename(",
          "168:                 'typo3conf/ext/' .",
          "169:                 $this->request->getControllerExtensionKey() .",
          "170:                 '/Resources/Private/Templates/Ezb/DisplaySearch.html'",
          "171:             );",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "181:             $journals =  $this->ezbRepository->loadOverview();",
          "189:             $this->view->assign('list', $journals);",
          "",
          "[Removed Lines]",
          "184:             $controllerContext = $this->buildControllerContext();",
          "185:             $controllerContext->getRequest()->setControllerActionName('displayOverview');",
          "186:             $this->view->setControllerContext($controllerContext);",
          "",
          "[Added Lines]",
          "187:             $this->view->setTemplatePathAndFilename(",
          "188:                 'typo3conf/ext/' .",
          "189:                 $this->request->getControllerExtensionKey() .",
          "190:                 '/Resources/Private/Templates/Ezb/DisplayOverview.html'",
          "191:             );",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "207:         if(!is_numeric($params['jourid']) || empty($params['jourid'])){",
          "213:             return;",
          "214:         }",
          "",
          "[Removed Lines]",
          "209:             $controllerContext = $this->buildControllerContext();",
          "210:             $controllerContext->getRequest()->setControllerActionName('displayError');",
          "211:             $this->view->setControllerContext($controllerContext);",
          "",
          "[Added Lines]",
          "214:             $this->view->setTemplatePathAndFilename(",
          "215:                 'typo3conf/ext/' .",
          "216:                 $this->request->getControllerExtensionKey() .",
          "217:                 '/Resources/Private/Templates/Ezb/DisplayError.html'",
          "218:             );",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "442:         if(!is_numeric($params['jourid']) || empty($params['jourid'])){",
          "448:             return;",
          "449:         }",
          "",
          "[Removed Lines]",
          "444:             $controllerContext = $this->buildControllerContext();",
          "445:             $controllerContext->getRequest()->setControllerActionName('displayError');",
          "446:             $this->view->setControllerContext($controllerContext);",
          "",
          "[Added Lines]",
          "451:             $this->view->setTemplatePathAndFilename(",
          "452:                 'typo3conf/ext/' .",
          "453:                 $this->request->getControllerExtensionKey() .",
          "454:                 '/Resources/Private/Templates/Ezb/DisplayError.html'",
          "455:             );",
          "",
          "---------------"
        ]
      }
    }
  ]
}