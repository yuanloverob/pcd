{
  "cve_id": "CVE-2019-3808",
  "cve_desc": "A flaw was found in Moodle versions 3.6 to 3.6.1, 3.5 to 3.5.3, 3.4 to 3.4.6, 3.1 to 3.1.15 and earlier unsupported versions. The 'manage groups' capability did not have the 'XSS risk' flag assigned to it, but does have that access in certain places. Note that the capability is intended for use by trusted users, and is only assigned to teachers and managers by default.",
  "repo": "moodle/moodle",
  "patch_hash": "6360f87cdca744a6a71c315853f6d811a3e54e26",
  "patch_info": {
    "commit_hash": "6360f87cdca744a6a71c315853f6d811a3e54e26",
    "repo": "moodle/moodle",
    "commit_url": "https://github.com/moodle/moodle/commit/6360f87cdca744a6a71c315853f6d811a3e54e26",
    "files": [
      "lib/db/access.php",
      "version.php"
    ],
    "message": "MDL-64395 groups: Added XSS Risk to the manage groups capability",
    "before_after_code_files": [
      "lib/db/access.php||lib/db/access.php",
      "version.php||version.php"
    ]
  },
  "patch_diff": {
    "lib/db/access.php||lib/db/access.php": [
      "File: lib/db/access.php -> lib/db/access.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "1123:     ),",
      "1125:     'moodle/course:managegroups' => array(",
      "1127:         'captype' => 'write',",
      "1128:         'contextlevel' => CONTEXT_COURSE,",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1126:         'riskbitmask' => RISK_XSS,",
      "",
      "---------------"
    ],
    "version.php||version.php": [
      "File: version.php -> version.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "30: defined('MOODLE_INTERNAL') || die();",
      "",
      "[Removed Lines]",
      "32: $version  = 2018122000.01;              // YYYYMMDD      = weekly release date of this DEV branch.",
      "",
      "[Added Lines]",
      "32: $version  = 2018122000.02;              // YYYYMMDD      = weekly release date of this DEV branch.",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "0d575a542afe03f354a6dc5d313cad5595faef3a",
      "candidate_info": {
        "commit_hash": "0d575a542afe03f354a6dc5d313cad5595faef3a",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/0d575a542afe03f354a6dc5d313cad5595faef3a",
        "files": [
          "admin/tool/analytics/cli/guess_course_start_and_end.php",
          "analytics/tests/fixtures/db_analytics_php/no_teaching.php",
          "analytics/tests/manager_test.php",
          "analytics/tests/model_test.php",
          "analytics/tests/stats_test.php",
          "course/classes/analytics/target/course_competencies.php",
          "course/classes/analytics/target/course_completion.php",
          "course/classes/analytics/target/course_dropout.php",
          "course/classes/analytics/target/course_enrolments.php",
          "course/classes/analytics/target/course_gradetopass.php",
          "course/classes/analytics/target/no_teaching.php",
          "lang/en/analytics.php",
          "lang/en/course.php",
          "lang/en/moodle.php",
          "lib/db/analytics.php",
          "lib/db/renamedclasses.php",
          "lib/db/upgrade.php",
          "lib/tests/targets_test.php",
          "version.php"
        ],
        "message": "Merge branch 'MDL-65248_master' of git://github.com/dmonllao/moodle",
        "before_after_code_files": [
          "admin/tool/analytics/cli/guess_course_start_and_end.php||admin/tool/analytics/cli/guess_course_start_and_end.php",
          "analytics/tests/fixtures/db_analytics_php/no_teaching.php||analytics/tests/fixtures/db_analytics_php/no_teaching.php",
          "analytics/tests/manager_test.php||analytics/tests/manager_test.php",
          "analytics/tests/model_test.php||analytics/tests/model_test.php",
          "analytics/tests/stats_test.php||analytics/tests/stats_test.php",
          "lib/classes/analytics/target/course_competencies.php||course/classes/analytics/target/course_competencies.php",
          "lib/classes/analytics/target/course_completion.php||course/classes/analytics/target/course_completion.php",
          "lib/classes/analytics/target/course_dropout.php||course/classes/analytics/target/course_dropout.php",
          "lib/classes/analytics/target/course_enrolments.php||course/classes/analytics/target/course_enrolments.php",
          "lib/classes/analytics/target/course_gradetopass.php||course/classes/analytics/target/course_gradetopass.php",
          "lib/classes/analytics/target/no_teaching.php||course/classes/analytics/target/no_teaching.php",
          "lang/en/analytics.php||lang/en/analytics.php",
          "lang/en/course.php||lang/en/course.php",
          "lang/en/moodle.php||lang/en/moodle.php",
          "lib/db/analytics.php||lib/db/analytics.php",
          "lib/db/renamedclasses.php||lib/db/renamedclasses.php",
          "lib/db/upgrade.php||lib/db/upgrade.php",
          "lib/tests/targets_test.php||lib/tests/targets_test.php",
          "version.php||version.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.php||version.php"
          ],
          "candidate": [
            "version.php||version.php"
          ]
        }
      },
      "candidate_diff": {
        "admin/tool/analytics/cli/guess_course_start_and_end.php||admin/tool/analytics/cli/guess_course_start_and_end.php": [
          "File: admin/tool/analytics/cli/guess_course_start_and_end.php -> admin/tool/analytics/cli/guess_course_start_and_end.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "205:                 $updateit = false;",
          "206:                 if ($course->enddate < $course->startdate) {",
          "208:                 } else if ($course->startdate + (YEARSECS + (WEEKSECS * 4)) > $course->enddate) {",
          "210:                 } else {",
          "211:                     $notification .= PHP_EOL . '  ' . get_string('enddate') . ': ' . userdate($course->enddate);",
          "212:                     $updateit = true;",
          "",
          "[Removed Lines]",
          "207:                     $notification .= PHP_EOL . '  ' . get_string('errorendbeforestart', 'analytics', userdate($course->enddate));",
          "209:                     $notification .= PHP_EOL . '  ' . get_string('coursetoolong', 'analytics');",
          "",
          "[Added Lines]",
          "207:                     $notification .= PHP_EOL . '  ' . get_string('errorendbeforestart', 'course', userdate($course->enddate));",
          "209:                     $notification .= PHP_EOL . '  ' . get_string('coursetoolong', 'course');",
          "",
          "---------------"
        ],
        "analytics/tests/fixtures/db_analytics_php/no_teaching.php||analytics/tests/fixtures/db_analytics_php/no_teaching.php": [
          "File: analytics/tests/fixtures/db_analytics_php/no_teaching.php -> analytics/tests/fixtures/db_analytics_php/no_teaching.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "28: $models = [",
          "29:     [",
          "31:         'indicators' => [",
          "32:             '\\core_course\\analytics\\indicator\\no_teacher',",
          "33:             '\\core_course\\analytics\\indicator\\no_student',",
          "",
          "[Removed Lines]",
          "30:         'target' => '\\core\\analytics\\target\\no_teaching',",
          "",
          "[Added Lines]",
          "30:         'target' => '\\core_course\\analytics\\target\\no_teaching',",
          "",
          "---------------"
        ],
        "analytics/tests/manager_test.php||analytics/tests/manager_test.php": [
          "File: analytics/tests/manager_test.php -> analytics/tests/manager_test.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "360:         $this->resetAfterTest();",
          "361:         $this->setAdminuser();",
          "365:         $upcomingactivities = \\core_analytics\\manager::get_target('\\core_user\\analytics\\target\\upcoming_activities_due');",
          "367:         $this->assertTrue(\\core_analytics\\model::exists($noteaching));",
          "",
          "[Removed Lines]",
          "363:         $noteaching = \\core_analytics\\manager::get_target('\\core\\analytics\\target\\no_teaching');",
          "364:         $dropout = \\core_analytics\\manager::get_target('\\core\\analytics\\target\\course_dropout');",
          "",
          "[Added Lines]",
          "363:         $noteaching = \\core_analytics\\manager::get_target('\\core_course\\analytics\\target\\no_teaching');",
          "364:         $dropout = \\core_analytics\\manager::get_target('\\core_course\\analytics\\target\\course_dropout');",
          "",
          "---------------"
        ],
        "analytics/tests/model_test.php||analytics/tests/model_test.php": [
          "File: analytics/tests/model_test.php -> analytics/tests/model_test.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "71:     public function test_create() {",
          "72:         $this->resetAfterTest(true);",
          "75:         $indicators = array(",
          "76:             \\core_analytics\\manager::get_indicator('\\core\\analytics\\indicator\\any_write_action'),",
          "77:             \\core_analytics\\manager::get_indicator('\\core\\analytics\\indicator\\read_actions')",
          "",
          "[Removed Lines]",
          "74:         $target = \\core_analytics\\manager::get_target('\\core\\analytics\\target\\course_dropout');",
          "",
          "[Added Lines]",
          "74:         $target = \\core_analytics\\manager::get_target('\\core_course\\analytics\\target\\course_dropout');",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "272:     public function test_exists() {",
          "273:         $this->resetAfterTest(true);",
          "276:         $this->assertTrue(\\core_analytics\\model::exists($target));",
          "278:         foreach (\\core_analytics\\manager::get_all_models() as $model) {",
          "",
          "[Removed Lines]",
          "275:         $target = \\core_analytics\\manager::get_target('\\core\\analytics\\target\\no_teaching');",
          "",
          "[Added Lines]",
          "275:         $target = \\core_analytics\\manager::get_target('\\core_course\\analytics\\target\\no_teaching');",
          "",
          "---------------"
        ],
        "analytics/tests/stats_test.php||analytics/tests/stats_test.php": [
          "File: analytics/tests/stats_test.php -> analytics/tests/stats_test.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "52:         $this->resetAfterTest(true);",
          "55:         $this->assertEquals(1, \\core_analytics\\stats::enabled_models());",
          "57:         $model = \\core_analytics\\model::create(",
          "59:             [",
          "60:                 \\core_analytics\\manager::get_indicator('\\core\\analytics\\indicator\\any_write_action'),",
          "61:             ]",
          "",
          "[Removed Lines]",
          "58:             \\core_analytics\\manager::get_target('\\core\\analytics\\target\\course_dropout'),",
          "",
          "[Added Lines]",
          "58:             \\core_analytics\\manager::get_target('\\core_course\\analytics\\target\\course_dropout'),",
          "",
          "---------------"
        ],
        "lib/classes/analytics/target/course_competencies.php||course/classes/analytics/target/course_competencies.php": [
          "File: lib/classes/analytics/target/course_competencies.php -> course/classes/analytics/target/course_competencies.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "27: defined('MOODLE_INTERNAL') || die();",
          "",
          "[Removed Lines]",
          "25: namespace core\\analytics\\target;",
          "36: class course_competencies extends \\core\\analytics\\target\\course_enrolments {",
          "",
          "[Added Lines]",
          "25: namespace core_course\\analytics\\target;",
          "36: class course_competencies extends course_enrolments {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "71:     public static function get_name() : \\lang_string {",
          "73:     }",
          "",
          "[Removed Lines]",
          "72:         return new \\lang_string('target:coursecompetencies');",
          "",
          "[Added Lines]",
          "72:         return new \\lang_string('target:coursecompetencies', 'course');",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "80:     protected static function classes_description() {",
          "81:         return array(",
          "84:         );",
          "85:     }",
          "",
          "[Removed Lines]",
          "82:             get_string('targetlabelstudentcompetenciesno'),",
          "83:             get_string('targetlabelstudentcompetenciesyes'),",
          "",
          "[Added Lines]",
          "82:             get_string('targetlabelstudentcompetenciesno', 'course'),",
          "83:             get_string('targetlabelstudentcompetenciesyes', 'course'),",
          "",
          "---------------"
        ],
        "lib/classes/analytics/target/course_completion.php||course/classes/analytics/target/course_completion.php": [
          "File: lib/classes/analytics/target/course_completion.php -> course/classes/analytics/target/course_completion.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "27: defined('MOODLE_INTERNAL') || die();",
          "",
          "[Removed Lines]",
          "25: namespace core\\analytics\\target;",
          "",
          "[Added Lines]",
          "25: namespace core_course\\analytics\\target;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "40: class course_completion extends \\core\\analytics\\target\\course_enrolments {",
          "",
          "[Added Lines]",
          "40: class course_completion extends course_enrolments {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "49:     public static function get_name() : \\lang_string {",
          "51:     }",
          "",
          "[Removed Lines]",
          "50:         return new \\lang_string('target:coursecompletion');",
          "",
          "[Added Lines]",
          "50:         return new \\lang_string('target:coursecompletion', 'course');",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "58:     protected static function classes_description() {",
          "59:         return array(",
          "62:         );",
          "63:     }",
          "",
          "[Removed Lines]",
          "60:             get_string('targetlabelstudentcompletionno'),",
          "61:             get_string('targetlabelstudentcompletionyes')",
          "",
          "[Added Lines]",
          "60:             get_string('targetlabelstudentcompletionno', 'course'),",
          "61:             get_string('targetlabelstudentcompletionyes', 'course')",
          "",
          "---------------"
        ],
        "lib/classes/analytics/target/course_dropout.php||course/classes/analytics/target/course_dropout.php": [
          "File: lib/classes/analytics/target/course_dropout.php -> course/classes/analytics/target/course_dropout.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "27: defined('MOODLE_INTERNAL') || die();",
          "",
          "[Removed Lines]",
          "25: namespace core\\analytics\\target;",
          "",
          "[Added Lines]",
          "25: namespace core_course\\analytics\\target;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "41: class course_dropout extends \\core\\analytics\\target\\course_enrolments {",
          "",
          "[Added Lines]",
          "41: class course_dropout extends course_enrolments {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "50:     public static function get_name() : \\lang_string {",
          "52:     }",
          "",
          "[Removed Lines]",
          "51:         return new \\lang_string('target:coursedropout');",
          "",
          "[Added Lines]",
          "51:         return new \\lang_string('target:coursedropout', 'course');",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "59:     protected static function classes_description() {",
          "60:         return array(",
          "63:         );",
          "64:     }",
          "",
          "[Removed Lines]",
          "61:             get_string('targetlabelstudentdropoutno'),",
          "62:             get_string('targetlabelstudentdropoutyes')",
          "",
          "[Added Lines]",
          "61:             get_string('targetlabelstudentdropoutno', 'course'),",
          "62:             get_string('targetlabelstudentdropoutyes', 'course')",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "97:             $nstudents = count($this->students);",
          "98:             if ($nlogs / $nstudents < 10) {",
          "100:             }",
          "101:         }",
          "",
          "[Removed Lines]",
          "99:                 return get_string('nocourseactivity');",
          "",
          "[Added Lines]",
          "99:                 return get_string('nocourseactivity', 'course');",
          "",
          "---------------"
        ],
        "lib/classes/analytics/target/course_enrolments.php||course/classes/analytics/target/course_enrolments.php": [
          "File: lib/classes/analytics/target/course_enrolments.php -> course/classes/analytics/target/course_enrolments.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "27: defined('MOODLE_INTERNAL') || die();",
          "",
          "[Removed Lines]",
          "25: namespace core\\analytics\\target;",
          "",
          "[Added Lines]",
          "25: namespace core_course\\analytics\\target;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "60:     public function get_insight_subject(int $modelid, \\context $context) {",
          "62:     }",
          "",
          "[Removed Lines]",
          "61:         return get_string('studentsatriskincourse', 'moodle', $context->get_context_name(false));",
          "",
          "[Added Lines]",
          "61:         return get_string('studentsatriskincourse', 'course', $context->get_context_name(false));",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "71:     public function is_valid_analysable(\\core_analytics\\analysable $course, $fortraining = true) {",
          "73:         if (!$course->was_started()) {",
          "75:         }",
          "77:         if (!$this->students = $course->get_students()) {",
          "79:         }",
          "81:         if (!course_format_uses_sections($course->get_course_data()->format)) {",
          "84:         }",
          "86:         if ($course->get_end() == 0) {",
          "89:         }",
          "91:         if ($course->get_end() < $course->get_start()) {",
          "93:         }",
          "96:         if ($course->get_end() - $course->get_start() > (YEARSECS + (WEEKSECS * 4))) {",
          "98:         }",
          "101:         if (!$fortraining && $course->is_finished()) {",
          "103:         }",
          "105:         if ($fortraining) {",
          "107:             if (!$course->is_finished()) {",
          "109:             }",
          "110:         }",
          "",
          "[Removed Lines]",
          "74:             return get_string('coursenotyetstarted');",
          "78:             return get_string('nocoursestudents');",
          "83:             return get_string('nocoursesections');",
          "88:             return get_string('nocourseendtime');",
          "92:             return get_string('errorendbeforestart', 'analytics');",
          "97:             return get_string('coursetoolong', 'analytics');",
          "102:             return get_string('coursealreadyfinished');",
          "108:                 return get_string('coursenotyetfinished');",
          "",
          "[Added Lines]",
          "74:             return get_string('coursenotyetstarted', 'course');",
          "78:             return get_string('nocoursestudents', 'course');",
          "83:             return get_string('nocoursesections', 'course');",
          "88:             return get_string('nocourseendtime', 'course');",
          "92:             return get_string('errorendbeforestart', 'course');",
          "97:             return get_string('coursetoolong', 'course');",
          "102:             return get_string('coursealreadyfinished', 'course');",
          "108:                 return get_string('coursenotyetfinished', 'course');",
          "",
          "---------------"
        ],
        "lib/classes/analytics/target/course_gradetopass.php||course/classes/analytics/target/course_gradetopass.php": [
          "File: lib/classes/analytics/target/course_gradetopass.php -> course/classes/analytics/target/course_gradetopass.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "27: defined('MOODLE_INTERNAL') || die();",
          "",
          "[Removed Lines]",
          "25: namespace core\\analytics\\target;",
          "",
          "[Added Lines]",
          "25: namespace core_course\\analytics\\target;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "37: class course_gradetopass extends \\core\\analytics\\target\\course_enrolments {",
          "",
          "[Added Lines]",
          "37: class course_gradetopass extends course_enrolments {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "116:     public static function get_name() : \\lang_string {",
          "118:     }",
          "",
          "[Removed Lines]",
          "117:         return new \\lang_string('target:coursegradetopass');",
          "",
          "[Added Lines]",
          "117:         return new \\lang_string('target:coursegradetopass', 'course');",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "125:     protected static function classes_description() {",
          "126:         return array(",
          "129:         );",
          "130:     }",
          "",
          "[Removed Lines]",
          "127:             get_string('targetlabelstudentgradetopassno'),",
          "128:             get_string('targetlabelstudentgradetopassyes')",
          "",
          "[Added Lines]",
          "127:             get_string('targetlabelstudentgradetopassno', 'course'),",
          "128:             get_string('targetlabelstudentgradetopassyes', 'course')",
          "",
          "---------------"
        ],
        "lib/classes/analytics/target/no_teaching.php||course/classes/analytics/target/no_teaching.php": [
          "File: lib/classes/analytics/target/no_teaching.php -> course/classes/analytics/target/no_teaching.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "27: defined('MOODLE_INTERNAL') || die();",
          "",
          "[Removed Lines]",
          "25: namespace core\\analytics\\target;",
          "",
          "[Added Lines]",
          "25: namespace core_course\\analytics\\target;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "54:     public static function get_name() : \\lang_string {",
          "56:     }",
          "",
          "[Removed Lines]",
          "55:         return new \\lang_string('target:noteachingactivity');",
          "",
          "[Added Lines]",
          "55:         return new \\lang_string('target:noteachingactivity', 'course');",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "112:     protected static function classes_description() {",
          "113:         return array(",
          "116:         );",
          "117:     }",
          "",
          "[Removed Lines]",
          "114:             get_string('targetlabelteachingyes'),",
          "115:             get_string('targetlabelteachingno'),",
          "",
          "[Added Lines]",
          "114:             get_string('targetlabelteachingyes', 'course'),",
          "115:             get_string('targetlabelteachingno', 'course'),",
          "",
          "---------------"
        ],
        "lang/en/analytics.php||lang/en/analytics.php": [
          "File: lang/en/analytics.php -> lang/en/analytics.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "29: $string['analyticslogstore'] = 'Log store used for analytics';",
          "30: $string['analyticslogstore_help'] = 'The log store that will be used by the analytics API to read users\\' activity';",
          "31: $string['analyticssettings'] = 'Analytics settings';",
          "33: $string['defaulttimesplittingmethods'] = 'Default time-splitting methods for model\\'s evaluation';",
          "34: $string['defaulttimesplittingmethods_help'] = 'The time-splitting method divides the course duration into parts; the predictions engine will run at the end of these parts. The model evaluation process will iterate through these time-splitting methods unless a specific time-splitting method is specified (the ability to specify a time-splitting method is only available when evaluating models using the command line script).';",
          "35: $string['defaultpredictionsprocessor'] = 'Default predictions processor';",
          "",
          "[Removed Lines]",
          "32: $string['coursetoolong'] = 'The course is too long';",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "38: $string['erroralreadypredict'] = 'File {$a} has already been used to generate predictions.';",
          "39: $string['errorcannotreaddataset'] = 'Dataset file {$a} can not be read';",
          "40: $string['errorcannotwritedataset'] = 'Dataset file {$a} cannot be written';",
          "42: $string['errorexportmodelresult'] = 'The machine learning model can not be exported.';",
          "43: $string['errorimport'] = 'Error importing the provided json file.';",
          "44: $string['errorimportmissingcomponents'] = 'The provided model requires the following plugins to be installed: {$a}. Note that the versions do not necessarily need to match with the versions installed in your system. To install the same or a newer version of the plugin should be enough in most cases.';",
          "",
          "[Removed Lines]",
          "41: $string['errorendbeforestart'] = 'The end date ({$a}) is before the course start date.';",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "lang/en/course.php||lang/en/course.php": [
          "File: lang/en/course.php -> lang/en/course.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "27: $string['aria:courseshortname'] = 'Course short name';",
          "28: $string['aria:coursename'] = 'Course name';",
          "29: $string['aria:favourite'] = 'Course is starred';",
          "30: $string['customfield_islocked'] = 'Locked';",
          "31: $string['customfield_islocked_help'] = 'If the field is locked, only users with the capability to change locked custom fields (by default users with the default role of manager only) will be able to change it in the course settings.';",
          "32: $string['customfield_notvisible'] = 'Nobody';",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "30: $string['coursealreadyfinished'] = 'Course already finished';",
          "31: $string['coursenotyetstarted'] = 'The course has not yet started';",
          "32: $string['coursenotyetfinished'] = 'The course has not yet finished';",
          "33: $string['coursetoolong'] = 'The course is too long';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "35: $string['customfield_visibletoall'] = 'Everyone';",
          "36: $string['customfield_visibletoteachers'] = 'Teachers';",
          "37: $string['customfieldsettings'] = 'Settings for course custom fields';",
          "38: $string['favourite'] = 'Starred course';",
          "39: $string['gradetopassnotset'] = 'This course does not have a grade to pass set. It may be set in the grade item of the course (Gradebook setup).';",
          "40: $string['privacy:perpage'] = 'The number of courses to show per page.';",
          "41: $string['privacy:completionpath'] = 'Course completion';",
          "42: $string['privacy:favouritespath'] = 'Course starred information';",
          "43: $string['privacy:metadata:completionsummary'] = 'The course contains completion information about the user.';",
          "44: $string['privacy:metadata:favouritessummary'] = 'The course contains information relating to the course being starred by the user.';",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "42: $string['errorendbeforestart'] = 'The end date ({$a}) is before the course start date.';",
          "45: $string['nocourseactivity'] = 'Not enough course activity between the start and the end of the course';",
          "46: $string['nocourseendtime'] = 'The course does not have an end time';",
          "47: $string['nocoursesections'] = 'No course sections';",
          "48: $string['nocoursestudents'] = 'No students';",
          "54: $string['studentsatriskincourse'] = 'Students at risk in {$a} course';",
          "55: $string['target:coursecompletion'] = 'Students at risk of not meeting the course completion conditions';",
          "56: $string['target:coursecompletion_help'] = 'This target describes whether the student is considered at risk of not meeting the course completion conditions.';",
          "57: $string['target:coursecompetencies'] = 'Students at risk of not achieving the competencies assigned to a course';",
          "58: $string['target:coursecompetencies_help'] = 'This target describes whether a student is at risk of not achieving the competencies assigned to a course. This target considers that all competencies assigned to the course must be achieved by the end of the course.';",
          "59: $string['target:coursedropout'] = 'Students at risk of dropping out';",
          "60: $string['target:coursedropout_help'] = 'This target describes whether the student is considered at risk of dropping out.';",
          "61: $string['target:coursegradetopass'] = 'Students at risk of not getting the minimum grade to pass the course.';",
          "62: $string['target:coursegradetopass_help'] = 'This target describes whether the student is at risk of not getting the minimum grade to pass the course.';",
          "63: $string['target:noteachingactivity'] = 'No teaching';",
          "64: $string['target:noteachingactivity_help'] = 'This target describes whether courses due to start in the coming week will have teaching activity.';",
          "65: $string['target:upcomingactivitiesdue'] = 'Upcoming activities due';",
          "66: $string['target:upcomingactivitiesdue_help'] = 'This target generates reminders for upcoming activities due.';",
          "67: $string['targetlabelstudentcompletionno'] = 'Student who is likely to meet the course completion conditions';",
          "68: $string['targetlabelstudentcompletionyes'] = 'Student at risk of not meeting the course completion conditions';",
          "69: $string['targetlabelstudentcompetenciesno'] = 'Student who is likely to achieve the competencies assigned to a course';",
          "70: $string['targetlabelstudentcompetenciesyes'] = 'Student at risk of not achieving the competencies assigned to a course';",
          "71: $string['targetlabelstudentdropoutyes'] = 'Student at risk of dropping out';",
          "72: $string['targetlabelstudentdropoutno'] = 'Not at risk';",
          "73: $string['targetlabelstudentgradetopassno'] = 'Student who is likely to meet the minimum grade to pass the course.';",
          "74: $string['targetlabelstudentgradetopassyes'] = 'Student at risk of not meeting the minimum grade to pass the course.';",
          "75: $string['targetlabelteachingyes'] = 'Users with teaching capabilities have access to the course';",
          "76: $string['targetlabelteachingno'] = 'No teaching';",
          "",
          "---------------"
        ],
        "lang/en/moodle.php||lang/en/moodle.php": [
          "File: lang/en/moodle.php -> lang/en/moodle.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "295: $string['country'] = 'Country';",
          "296: $string['course'] = 'Course';",
          "297: $string['courseadministration'] = 'Course administration';",
          "299: $string['courseapprovedemail'] = 'Your requested course, {$a->name}, has been approved and you have been made a {$a->teacher}.  To access your new course, go to {$a->url}';",
          "300: $string['courseapprovedemail2'] = 'Your requested course, {$a->name}, has been approved.  To access your new course, go to {$a->url}';",
          "301: $string['courseapprovedfailed'] = 'Failed to save the course as approved!';",
          "",
          "[Removed Lines]",
          "298: $string['coursealreadyfinished'] = 'Course already finished';",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "340: $string['coursehelpnumberweeks'] = 'Number of sections in the course (applies to certain course formats only).';",
          "341: $string['coursehelpshowgrades'] = 'Enable the display of the gradebook. It does not prevent grades from being displayed within the individual activities.';",
          "342: $string['coursehidden'] = 'This course is currently unavailable to students';",
          "345: $string['courseoverviewfiles'] = 'Course image';",
          "346: $string['courseoverviewfilesext'] = 'Course image file extensions';",
          "347: $string['courseoverviewfileslimit'] = 'Course image files limit';",
          "",
          "[Removed Lines]",
          "343: $string['coursenotyetstarted'] = 'The course has not yet started';",
          "344: $string['coursenotyetfinished'] = 'The course has not yet finished';",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1384: $string['no'] = 'No';",
          "1385: $string['noblockstoaddhere'] = 'There are no blocks that you can add to this page.';",
          "1386: $string['nobody'] = 'Nobody';",
          "1389: $string['nocourses'] = 'No courses';",
          "1391: $string['nocoursesfound'] = 'No courses were found with the words \\'{$a}\\'';",
          "1392: $string['nocoursestarttime'] = 'The course does not have a start date.';",
          "1394: $string['nocoursesyet'] = 'No courses in this category';",
          "1395: $string['nocomments'] = 'No comments';",
          "1396: $string['nodstpresets'] = 'The administrator has not enabled Daylight Savings Time support.';",
          "",
          "[Removed Lines]",
          "1387: $string['nocourseactivity'] = 'Not enough course activity between the start and the end of the course';",
          "1388: $string['nocourseendtime'] = 'The course does not have an end time';",
          "1390: $string['nocoursesections'] = 'No course sections';",
          "1393: $string['nocoursestudents'] = 'No students';",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1952: $string['studentnotallowed'] = 'Sorry, but you can not enter this course as \\'{$a}\\'';",
          "1953: $string['students'] = 'Students';",
          "1954: $string['studentsandteachers'] = 'Students and teachers';",
          "1956: $string['subcategories'] = 'Subcategories';",
          "1957: $string['subcategory'] = 'Subcategory';",
          "1958: $string['subcategoryof'] = 'Subcategory of {$a}';",
          "",
          "[Removed Lines]",
          "1955: $string['studentsatriskincourse'] = 'Students at risk in {$a} course';",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1976: $string['tagalready'] = 'This tag already exists';",
          "1977: $string['tagmanagement'] = 'Add/delete tags ...';",
          "1978: $string['tags'] = 'Tags';",
          "2001: $string['targetrole'] = 'Target role';",
          "2002: $string['teacheronly'] = 'for the {$a} only';",
          "2003: $string['teacherroles'] = '{$a} roles';",
          "",
          "[Removed Lines]",
          "1979: $string['target:coursecompletion'] = 'Students at risk of not meeting the course completion conditions';",
          "1980: $string['target:coursecompletion_help'] = 'This target describes whether the student is considered at risk of not meeting the course completion conditions.';",
          "1981: $string['target:coursecompetencies'] = 'Students at risk of not achieving the competencies assigned to a course';",
          "1982: $string['target:coursecompetencies_help'] = 'This target describes whether a student is at risk of not achieving the competencies assigned to a course. This target considers that all competencies assigned to the course must be achieved by the end of the course.';",
          "1983: $string['target:coursedropout'] = 'Students at risk of dropping out';",
          "1984: $string['target:coursedropout_help'] = 'This target describes whether the student is considered at risk of dropping out.';",
          "1985: $string['target:coursegradetopass'] = 'Students at risk of not getting the minimum grade to pass the course.';",
          "1986: $string['target:coursegradetopass_help'] = 'This target describes whether the student is at risk of not getting the minimum grade to pass the course.';",
          "1987: $string['target:noteachingactivity'] = 'No teaching';",
          "1988: $string['target:noteachingactivity_help'] = 'This target describes whether courses due to start in the coming week will have teaching activity.';",
          "1989: $string['target:upcomingactivitiesdue'] = 'Upcoming activities due';",
          "1990: $string['target:upcomingactivitiesdue_help'] = 'This target generates reminders for upcoming activities due.';",
          "1991: $string['targetlabelstudentcompletionno'] = 'Student who is likely to meet the course completion conditions';",
          "1992: $string['targetlabelstudentcompletionyes'] = 'Student at risk of not meeting the course completion conditions';",
          "1993: $string['targetlabelstudentcompetenciesno'] = 'Student who is likely to achieve the competencies assigned to a course';",
          "1994: $string['targetlabelstudentcompetenciesyes'] = 'Student at risk of not achieving the competencies assigned to a course';",
          "1995: $string['targetlabelstudentdropoutyes'] = 'Student at risk of dropping out';",
          "1996: $string['targetlabelstudentdropoutno'] = 'Not at risk';",
          "1997: $string['targetlabelstudentgradetopassno'] = 'Student who is likely to meet the minimum grade to pass the course.';",
          "1998: $string['targetlabelstudentgradetopassyes'] = 'Student at risk of not meeting the minimum grade to pass the course.';",
          "1999: $string['targetlabelteachingyes'] = 'Users with teaching capabilities have access to the course';",
          "2000: $string['targetlabelteachingno'] = 'No teaching';",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "lib/db/analytics.php||lib/db/analytics.php": [
          "File: lib/db/analytics.php -> lib/db/analytics.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "28: $models = [",
          "29:     [",
          "31:         'indicators' => [",
          "32:             '\\core\\analytics\\indicator\\any_access_after_end',",
          "33:             '\\core\\analytics\\indicator\\any_access_before_start',",
          "",
          "[Removed Lines]",
          "30:         'target' => '\\core\\analytics\\target\\course_dropout',",
          "",
          "[Added Lines]",
          "30:         'target' => '\\core_course\\analytics\\target\\course_dropout',",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "81:         ],",
          "82:     ],",
          "83:     [",
          "85:         'indicators' => [",
          "86:             '\\core_course\\analytics\\indicator\\no_teacher',",
          "87:             '\\core_course\\analytics\\indicator\\no_student',",
          "",
          "[Removed Lines]",
          "84:         'target' => '\\core\\analytics\\target\\no_teaching',",
          "",
          "[Added Lines]",
          "84:         'target' => '\\core_course\\analytics\\target\\no_teaching',",
          "",
          "---------------"
        ],
        "lib/db/renamedclasses.php||lib/db/renamedclasses.php": [
          "File: lib/db/renamedclasses.php -> lib/db/renamedclasses.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "38: $renamedclasses = array(",
          "39:     'course_in_list' => 'core_course_list_element',",
          "40:     'coursecat' => 'core_course_category',",
          "41: );",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "41:     'core\\\\analytics\\\\target\\\\course_dropout' => 'core_course\\\\analytics\\\\target\\\\course_dropout',",
          "42:     'core\\\\analytics\\\\target\\\\course_competencies' => 'core_course\\\\analytics\\\\target\\\\course_competencies',",
          "43:     'core\\\\analytics\\\\target\\\\course_completion' => 'core_course\\\\analytics\\\\target\\\\course_completion',",
          "44:     'core\\\\analytics\\\\target\\\\course_gradetopass' => 'core_course\\\\analytics\\\\target\\\\course_gradetopass',",
          "45:     'core\\\\analytics\\\\target\\\\no_teaching' => 'core_course\\\\analytics\\\\target\\\\no_teaching',",
          "",
          "---------------"
        ],
        "lib/db/upgrade.php||lib/db/upgrade.php": [
          "File: lib/db/upgrade.php -> lib/db/upgrade.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "3184:         upgrade_main_savepoint(true, 2019041800.01);",
          "3185:     }",
          "3187:     return true;",
          "3188: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3187:     if ($oldversion < 2019041900.00) {",
          "3189:         $params = [",
          "3190:             'target' => '\\core\\analytics\\target\\no_teaching',",
          "3191:         ];",
          "3192:         $models = $DB->get_records('analytics_models', $params);",
          "3193:         foreach ($models as $model) {",
          "3194:             $model->target = '\\core_course\\analytics\\target\\no_teaching';",
          "3195:             $DB->update_record('analytics_models', $model);",
          "3196:         }",
          "3198:         $params = [",
          "3199:             'target' => '\\core\\analytics\\target\\course_dropout',",
          "3200:         ];",
          "3201:         $models = $DB->get_records('analytics_models', $params);",
          "3202:         foreach ($models as $model) {",
          "3203:             $model->target = '\\core_course\\analytics\\target\\course_dropout';",
          "3204:             $DB->update_record('analytics_models', $model);",
          "3205:         }",
          "3208:         upgrade_main_savepoint(true, 2019041900.00);",
          "3209:     }",
          "",
          "---------------"
        ],
        "lib/tests/targets_test.php||lib/tests/targets_test.php": [
          "File: lib/tests/targets_test.php -> lib/tests/targets_test.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "60:                     'enablecompletion' => 1,",
          "61:                     'startdate' => mktime(0, 0, 0, 10, 24, $year + 1)",
          "62:                 ],",
          "64:             ],",
          "65:             'coursenostudents' => [",
          "66:                 'params' => [",
          "",
          "[Removed Lines]",
          "63:                 'isvalid' => get_string('coursenotyetstarted')",
          "",
          "[Added Lines]",
          "63:                 'isvalid' => get_string('coursenotyetstarted', 'course')",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "68:                     'startdate' => mktime(0, 0, 0, 10, 24, $year - 2),",
          "69:                     'enddate' => mktime(0, 0, 0, 10, 24, $year - 1)",
          "70:                 ],",
          "72:             ],",
          "73:             'coursenosections' => [",
          "74:                 'params' => [",
          "",
          "[Removed Lines]",
          "71:                 'isvalid' => get_string('nocoursestudents')",
          "",
          "[Added Lines]",
          "71:                 'isvalid' => get_string('nocoursestudents', 'course')",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "76:                     'format' => 'social',",
          "77:                     'students' => true",
          "78:                 ],",
          "80:             ],",
          "81:             'coursenoendtime' => [",
          "82:                 'params' => [",
          "",
          "[Removed Lines]",
          "79:                 'isvalid' => get_string('nocoursesections')",
          "",
          "[Added Lines]",
          "79:                 'isvalid' => get_string('nocoursesections', 'course')",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "85:                     'enddate' => 0,",
          "86:                     'students' => true",
          "87:                 ],",
          "89:             ],",
          "90:             'courseendbeforestart' => [",
          "91:                 'params' => [",
          "",
          "[Removed Lines]",
          "88:                 'isvalid' => get_string('nocourseendtime')",
          "",
          "[Added Lines]",
          "88:                 'isvalid' => get_string('nocourseendtime', 'course')",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "93:                     'enddate' => mktime(0, 0, 0, 10, 23, $year - 2),",
          "94:                     'students' => true",
          "95:                 ],",
          "97:             ],",
          "98:             'coursetoolong' => [",
          "99:                 'params' => [",
          "",
          "[Removed Lines]",
          "96:                 'isvalid' => get_string('errorendbeforestart', 'analytics')",
          "",
          "[Added Lines]",
          "96:                 'isvalid' => get_string('errorendbeforestart', 'course')",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "102:                     'enddate' => mktime(0, 0, 0, 10, 23, $year),",
          "103:                     'students' => true",
          "104:                 ],",
          "106:             ],",
          "107:             'coursealreadyfinished' => [",
          "108:                 'params' => [",
          "",
          "[Removed Lines]",
          "105:                 'isvalid' => get_string('coursetoolong', 'analytics')",
          "",
          "[Added Lines]",
          "105:                 'isvalid' => get_string('coursetoolong', 'course')",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "111:                     'enddate' => mktime(0, 0, 0, 10, 23, $year - 1),",
          "112:                     'students' => true",
          "113:                 ],",
          "115:                 'fortraining' => false",
          "116:             ],",
          "117:             'coursenotyetfinished' => [",
          "",
          "[Removed Lines]",
          "114:                 'isvalid' => get_string('coursealreadyfinished'),",
          "",
          "[Added Lines]",
          "114:                 'isvalid' => get_string('coursealreadyfinished', 'course'),",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "121:                     'enddate' => mktime(0, 0, 0, $month + 2, 23, $year),",
          "122:                     'students' => true",
          "123:                 ],",
          "125:             ],",
          "126:             'coursenocompletion' => [",
          "127:                 'params' => [",
          "",
          "[Removed Lines]",
          "124:                 'isvalid' => get_string('coursenotyetfinished')",
          "",
          "[Added Lines]",
          "124:                 'isvalid' => get_string('coursenotyetfinished', 'course')",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "207:             $criterion->update_config($criteriadata);",
          "208:         }",
          "",
          "[Removed Lines]",
          "210:         $target = new \\core\\analytics\\target\\course_completion();",
          "",
          "[Added Lines]",
          "210:         $target = new \\core_course\\analytics\\target\\course_completion();",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "242:         $course = $this->getDataGenerator()->create_course($courserecord);",
          "243:         $this->getDataGenerator()->enrol_user($user->id, $course->id, null, 'manual', $timestart, $timeend);",
          "246:         $analyser = new \\core\\analytics\\analyser\\student_enrolments(1, $target, [], [], []);",
          "247:         $analysable = new \\core_analytics\\course($course);",
          "",
          "[Removed Lines]",
          "245:         $target = new \\core\\analytics\\target\\course_completion();",
          "",
          "[Added Lines]",
          "245:         $target = new \\core_course\\analytics\\target\\course_completion();",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "303:         $data = $this->setup_competencies_environment();",
          "305:         $analysable = new \\core_analytics\\course($data['course']);",
          "308:         $this->assertTrue($target->is_valid_analysable($analysable));",
          "",
          "[Removed Lines]",
          "306:         $target = new \\core\\analytics\\target\\course_competencies();",
          "",
          "[Added Lines]",
          "306:         $target = new \\core_course\\analytics\\target\\course_competencies();",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "319:         $data = $this->setup_competencies_environment();",
          "322:         $analyser = new \\core\\analytics\\analyser\\student_enrolments(1, $target, [], [], []);",
          "323:         $analysable = new \\core_analytics\\course($data['course']);",
          "",
          "[Removed Lines]",
          "321:         $target = new \\core\\analytics\\target\\course_competencies();",
          "",
          "[Added Lines]",
          "321:         $target = new \\core_course\\analytics\\target\\course_competencies();",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "330:         $target->add_sample_data($samplesdata);",
          "331:         $sampleid = reset($sampleids);",
          "334:         $method = $class->getMethod('calculate_sample');",
          "335:         $method->setAccessible(true);",
          "",
          "[Removed Lines]",
          "333:         $class = new ReflectionClass('\\core\\analytics\\target\\course_competencies');",
          "",
          "[Added Lines]",
          "333:         $class = new ReflectionClass('\\core_course\\analytics\\target\\course_competencies');",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "364:         $dg->enrol_user($student1->id, $course1->id, $studentrole->id);",
          "366:         $analysable = new \\core_analytics\\course($course1);",
          "368:         $this->assertEquals(get_string('gradetopassnotset', 'course'), $target->is_valid_analysable($analysable));",
          "",
          "[Removed Lines]",
          "367:         $target = new \\core\\analytics\\target\\course_gradetopass();",
          "",
          "[Added Lines]",
          "367:         $target = new \\core_course\\analytics\\target\\course_gradetopass();",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "372:         $courseitem->gradepass = 50;",
          "373:         $DB->update_record('grade_items', $courseitem);",
          "376:         $this->assertTrue($target->is_valid_analysable($analysable));",
          "378:     }",
          "",
          "[Removed Lines]",
          "375:         $target = new \\core\\analytics\\target\\course_gradetopass();",
          "",
          "[Added Lines]",
          "375:         $target = new \\core_course\\analytics\\target\\course_gradetopass();",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "416:         $courseitem->gradepass = 50;",
          "417:         $DB->update_record('grade_items', $courseitem);",
          "420:         $analyser = new \\core\\analytics\\analyser\\student_enrolments(1, $target, [], [], []);",
          "421:         $analysable = new \\core_analytics\\course($course1);",
          "",
          "[Removed Lines]",
          "419:         $target = new \\core\\analytics\\target\\course_gradetopass();",
          "",
          "[Added Lines]",
          "419:         $target = new \\core_course\\analytics\\target\\course_gradetopass();",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "427:         list($sampleids, $samplesdata) = $method->invoke($analyser, $analysable);",
          "428:         $target->add_sample_data($samplesdata);",
          "431:         $method = $class->getMethod('calculate_sample');",
          "432:         $method->setAccessible(true);",
          "",
          "[Removed Lines]",
          "430:         $class = new ReflectionClass('\\core\\analytics\\target\\course_gradetopass');",
          "",
          "[Added Lines]",
          "430:         $class = new ReflectionClass('\\core_course\\analytics\\target\\course_gradetopass');",
          "",
          "---------------"
        ],
        "version.php||version.php": [
          "File: version.php -> version.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "30: defined('MOODLE_INTERNAL') || die();",
          "",
          "[Removed Lines]",
          "32: $version  = 2019041800.02;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "",
          "[Added Lines]",
          "32: $version  = 2019041900.00;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "14cdf51189f059373bbff381147687ae6ca64494",
      "candidate_info": {
        "commit_hash": "14cdf51189f059373bbff381147687ae6ca64494",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/14cdf51189f059373bbff381147687ae6ca64494",
        "files": [
          "version.php"
        ],
        "message": "on-demand release 3.7dev+",
        "before_after_code_files": [
          "version.php||version.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.php||version.php"
          ],
          "candidate": [
            "version.php||version.php"
          ]
        }
      },
      "candidate_diff": {
        "version.php||version.php": [
          "File: version.php -> version.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "30: defined('MOODLE_INTERNAL') || die();",
          "38: $branch   = '37';                       // This version's branch.",
          "39: $maturity = MATURITY_ALPHA;             // This version's maturity level.",
          "",
          "[Removed Lines]",
          "32: $version  = 2019042300.03;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "36: $release  = '3.7dev+ (Build: 20190423)'; // Human-friendly version name",
          "",
          "[Added Lines]",
          "32: $version  = 2019042700.00;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "36: $release  = '3.7dev+ (Build: 20190427)'; // Human-friendly version name",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "b198428e41b0f2fafe4bb0e6db6e53f5b9eda212",
      "candidate_info": {
        "commit_hash": "b198428e41b0f2fafe4bb0e6db6e53f5b9eda212",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/b198428e41b0f2fafe4bb0e6db6e53f5b9eda212",
        "files": [
          "version.php"
        ],
        "message": "Moodle release 3.7.1",
        "before_after_code_files": [
          "version.php||version.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.php||version.php"
          ],
          "candidate": [
            "version.php||version.php"
          ]
        }
      },
      "candidate_diff": {
        "version.php||version.php": [
          "File: version.php -> version.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "30: defined('MOODLE_INTERNAL') || die();",
          "38: $branch   = '37';                       // This version's branch.",
          "39: $maturity = MATURITY_STABLE;             // This version's maturity level.",
          "",
          "[Removed Lines]",
          "32: $version  = 2019052000.07;              // 20190520      = branching date YYYYMMDD - do not modify!",
          "36: $release  = '3.7+ (Build: 20190704)'; // Human-friendly version name",
          "",
          "[Added Lines]",
          "32: $version  = 2019052001.00;              // 20190520      = branching date YYYYMMDD - do not modify!",
          "36: $release  = '3.7.1 (Build: 20190708)'; // Human-friendly version name",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "07a4698d0ade41425241eb38999fbc612f1cb169",
      "candidate_info": {
        "commit_hash": "07a4698d0ade41425241eb38999fbc612f1cb169",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/07a4698d0ade41425241eb38999fbc612f1cb169",
        "files": [
          "lib/db/upgrade.php",
          "version.php"
        ],
        "message": "MDL-64568 core: upgrade step to remove orphaned group conversations",
        "before_after_code_files": [
          "lib/db/upgrade.php||lib/db/upgrade.php",
          "version.php||version.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.php||version.php"
          ],
          "candidate": [
            "version.php||version.php"
          ]
        }
      },
      "candidate_diff": {
        "lib/db/upgrade.php||lib/db/upgrade.php": [
          "File: lib/db/upgrade.php -> lib/db/upgrade.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "2806:         upgrade_main_savepoint(true, 2019030800.00);",
          "2807:     }",
          "2809:     return true;",
          "2810: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2809:     if ($oldversion < 2019030800.02) {",
          "2811:         $sql = \"SELECT mc.id",
          "2812:                   FROM {message_conversations} mc",
          "2813:              LEFT JOIN {groups} g",
          "2814:                     ON mc.itemid = g.id",
          "2815:                  WHERE mc.component = :component",
          "2816:                    AND mc.itemtype = :itemtype",
          "2817:                    AND g.id is NULL\";",
          "2818:         $conversations = $DB->get_records_sql($sql, ['component' => 'core_group', 'itemtype' => 'groups']);",
          "2820:         if ($conversations) {",
          "2821:             $conversationids = array_keys($conversations);",
          "2823:             $DB->delete_records_list('message_conversations', 'id', $conversationids);",
          "2824:             $DB->delete_records_list('message_conversation_members', 'conversationid', $conversationids);",
          "2825:             $DB->delete_records_list('message_conversation_actions', 'conversationid', $conversationids);",
          "2828:             foreach ($conversationids as $conversationid) {",
          "2829:                 if ($messages = $DB->get_records('messages', ['conversationid' => $conversationid])) {",
          "2830:                     $messageids = array_keys($messages);",
          "2833:                     list($insql, $inparams) = $DB->get_in_or_equal($messageids);",
          "2834:                     $DB->delete_records_select('message_user_actions', \"messageid $insql\", $inparams);",
          "2837:                     $DB->delete_records('messages', ['conversationid' => $conversationid]);",
          "2838:                 }",
          "2839:             }",
          "2840:         }",
          "2843:         upgrade_main_savepoint(true, 2019030800.02);",
          "2844:     }",
          "",
          "---------------"
        ],
        "version.php||version.php": [
          "File: version.php -> version.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "30: defined('MOODLE_INTERNAL') || die();",
          "",
          "[Removed Lines]",
          "32: $version  = 2019030800.01;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "",
          "[Added Lines]",
          "32: $version  = 2019030800.02;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "9b3580f43c9c60ae5cd9df5403fb40cd914ab2b6",
      "candidate_info": {
        "commit_hash": "9b3580f43c9c60ae5cd9df5403fb40cd914ab2b6",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/9b3580f43c9c60ae5cd9df5403fb40cd914ab2b6",
        "files": [
          "lib/db/upgrade.php",
          "version.php"
        ],
        "message": "MDL-61585 analytics: Include missing indicators",
        "before_after_code_files": [
          "lib/db/upgrade.php||lib/db/upgrade.php",
          "version.php||version.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.php||version.php"
          ],
          "candidate": [
            "version.php||version.php"
          ]
        }
      },
      "candidate_diff": {
        "lib/db/upgrade.php||lib/db/upgrade.php": [
          "File: lib/db/upgrade.php -> lib/db/upgrade.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "2753:         upgrade_main_savepoint(true, 2019030100.01);",
          "2754:     }",
          "2756:     return true;",
          "2757: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2756:     if ($oldversion < 2019030700.01) {",
          "2759:         $params = [",
          "2760:             'target' => '\\core\\analytics\\target\\course_dropout',",
          "2761:             'trained' => 0,",
          "2762:             'enabled' => 0,",
          "2763:         ];",
          "2764:         $models = $DB->get_records('analytics_models', $params);",
          "2765:         foreach ($models as $model) {",
          "2766:             $indicators = json_decode($model->indicators);",
          "2768:             $potentiallymissingindicators = [",
          "2769:                 '\\core_course\\analytics\\indicator\\completion_enabled',",
          "2770:                 '\\core_course\\analytics\\indicator\\potential_cognitive_depth',",
          "2771:                 '\\core_course\\analytics\\indicator\\potential_social_breadth',",
          "2772:                 '\\core\\analytics\\indicator\\any_access_after_end',",
          "2773:                 '\\core\\analytics\\indicator\\any_access_before_start',",
          "2774:                 '\\core\\analytics\\indicator\\any_write_action_in_course',",
          "2775:                 '\\core\\analytics\\indicator\\read_actions'",
          "2776:             ];",
          "2778:             $missing = false;",
          "2779:             foreach ($potentiallymissingindicators as $potentiallymissingindicator) {",
          "2780:                 if (!in_array($potentiallymissingindicator, $indicators)) {",
          "2782:                     $indicators[] = $potentiallymissingindicator;",
          "2783:                     $missing = true;",
          "2784:                 }",
          "2785:             }",
          "2787:             if ($missing) {",
          "2788:                 $model->indicators = json_encode($indicators);",
          "2789:                 $model->version = time();",
          "2790:                 $model->timemodified = time();",
          "2791:                 $DB->update_record('analytics_models', $model);",
          "2792:             }",
          "2793:         }",
          "2796:         $params = [",
          "2797:             'target' => '\\core\\analytics\\target\\no_teaching',",
          "2798:         ];",
          "2799:         $models = $DB->get_records('analytics_models', $params);",
          "2800:         foreach ($models as $model) {",
          "2801:             $indicators = json_decode($model->indicators);",
          "2802:             if (!in_array('\\core_course\\analytics\\indicator\\no_student', $indicators)) {",
          "2805:                 $indicators[] = '\\core_course\\analytics\\indicator\\no_student';",
          "2807:                 $model->indicators = json_encode($indicators);",
          "2808:                 $model->version = time();",
          "2809:                 $model->timemodified = time();",
          "2810:                 $DB->update_record('analytics_models', $model);",
          "2811:             }",
          "2812:         }",
          "2815:         upgrade_main_savepoint(true, 2019030700.01);",
          "2816:     }",
          "",
          "---------------"
        ],
        "version.php||version.php": [
          "File: version.php -> version.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "30: defined('MOODLE_INTERNAL') || die();",
          "",
          "[Removed Lines]",
          "32: $version  = 2019030700.00;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "",
          "[Added Lines]",
          "32: $version  = 2019030700.01;              // YYYYMMDD      = weekly release date of this DEV branch.",
          "",
          "---------------"
        ]
      }
    }
  ]
}