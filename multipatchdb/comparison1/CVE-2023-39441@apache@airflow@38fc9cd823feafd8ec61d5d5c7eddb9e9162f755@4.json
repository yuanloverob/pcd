{
  "cve_id": "CVE-2023-39441",
  "cve_desc": "Apache Airflow SMTP Provider before 1.3.0, Apache Airflow IMAP Provider before 3.3.0, and\u00a0Apache Airflow before 2.7.0 are affected by the\u00a0Validation of OpenSSL Certificate vulnerability.\n\nThe default SSL context with SSL library did not check a server's X.509\u00a0certificate.\u00a0 Instead, the code accepted any certificate, which could\u00a0result in the disclosure of mail server credentials or mail contents\u00a0when the client connects to an attacker in a MITM position.\n\nUsers are strongly advised to upgrade to Apache Airflow version 2.7.0 or newer, Apache Airflow IMAP Provider version 3.3.0 or newer, and Apache Airflow SMTP Provider version 1.3.0 or newer to mitigate the risk associated with this vulnerability",
  "repo": "apache/airflow",
  "patch_hash": "38fc9cd823feafd8ec61d5d5c7eddb9e9162f755",
  "patch_info": {
    "commit_hash": "38fc9cd823feafd8ec61d5d5c7eddb9e9162f755",
    "repo": "apache/airflow",
    "commit_url": "https://github.com/apache/airflow/commit/38fc9cd823feafd8ec61d5d5c7eddb9e9162f755",
    "files": [
      "airflow/providers/imap/CHANGELOG.rst",
      "airflow/providers/imap/hooks/imap.py",
      "airflow/providers/imap/provider.yaml",
      "docs/apache-airflow-providers-imap/configurations-ref.rst",
      "docs/apache-airflow-providers-imap/index.rst",
      "docs/apache-airflow/configurations-ref.rst",
      "tests/providers/imap/hooks/test_imap.py"
    ],
    "message": "Allows to choose SSL context for IMAP provider (#33108)\n\n* Allows to choose SSL context for IMAP provider\n\nThis change add two options to choose from when SSL IMAP connection is created:\n\n* default - for balance between compatibility and security\n* none - in case compatibility with existing infrastructure is preferred\n\nThe fallback is:\n\n* The Airflow \"email\", \"ssl_context\"\n* \"default\"\n\nCo-authored-by: Ephraim Anierobi <splendidzigy24@gmail.com>\n(cherry picked from commit 52ca7bfc988f4c9b608f544bc3e9524fd6564639)",
    "before_after_code_files": [
      "airflow/providers/imap/hooks/imap.py||airflow/providers/imap/hooks/imap.py",
      "tests/providers/imap/hooks/test_imap.py||tests/providers/imap/hooks/test_imap.py"
    ]
  },
  "patch_diff": {
    "airflow/providers/imap/hooks/imap.py||airflow/providers/imap/hooks/imap.py": [
      "File: airflow/providers/imap/hooks/imap.py -> airflow/providers/imap/hooks/imap.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "26: import imaplib",
      "27: import os",
      "28: import re",
      "29: from typing import Any, Iterable",
      "31: from airflow.exceptions import AirflowException",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "29: import ssl",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "78:         return self",
      "80:     def _build_client(self, conn: Connection) -> imaplib.IMAP4_SSL | imaplib.IMAP4:",
      "84:         else:",
      "92:         return mail_client",
      "",
      "[Removed Lines]",
      "81:         IMAP: type[imaplib.IMAP4_SSL] | type[imaplib.IMAP4]",
      "82:         if conn.extra_dejson.get(\"use_ssl\", True):",
      "83:             IMAP = imaplib.IMAP4_SSL",
      "85:             IMAP = imaplib.IMAP4",
      "87:         if conn.port:",
      "88:             mail_client = IMAP(conn.host, conn.port)",
      "89:         else:",
      "90:             mail_client = IMAP(conn.host)",
      "",
      "[Added Lines]",
      "82:         mail_client: imaplib.IMAP4_SSL | imaplib.IMAP4",
      "83:         use_ssl = conn.extra_dejson.get(\"use_ssl\", True)",
      "84:         if use_ssl:",
      "85:             from airflow.configuration import conf",
      "87:             ssl_context_string = conf.get(\"imap\", \"SSL_CONTEXT\", fallback=None)",
      "88:             if ssl_context_string is None:",
      "89:                 ssl_context_string = conf.get(\"email\", \"SSL_CONTEXT\", fallback=None)",
      "90:             if ssl_context_string is None:",
      "91:                 ssl_context_string = \"default\"",
      "92:             if ssl_context_string == \"default\":",
      "93:                 ssl_context = ssl.create_default_context()",
      "94:             elif ssl_context_string == \"none\":",
      "95:                 ssl_context = None",
      "96:             else:",
      "97:                 raise RuntimeError(",
      "98:                     f\"The email.ssl_context configuration variable must \"",
      "99:                     f\"be set to 'default' or 'none' and is '{ssl_context_string}'.\"",
      "100:                 )",
      "101:             if conn.port:",
      "102:                 mail_client = imaplib.IMAP4_SSL(conn.host, conn.port, ssl_context=ssl_context)",
      "103:             else:",
      "104:                 mail_client = imaplib.IMAP4_SSL(conn.host, ssl_context=ssl_context)",
      "106:             if conn.port:",
      "107:                 mail_client = imaplib.IMAP4(conn.host, conn.port)",
      "108:             else:",
      "109:                 mail_client = imaplib.IMAP4(conn.host)",
      "",
      "---------------"
    ],
    "tests/providers/imap/hooks/test_imap.py||tests/providers/imap/hooks/test_imap.py": [
      "File: tests/providers/imap/hooks/test_imap.py -> tests/providers/imap/hooks/test_imap.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "27: from airflow.models import Connection",
      "28: from airflow.providers.imap.hooks.imap import ImapHook",
      "29: from airflow.utils import db",
      "31: imaplib_string = \"airflow.providers.imap.hooks.imap.imaplib\"",
      "32: open_string = \"airflow.providers.imap.hooks.imap.open\"",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "30: from tests.test_utils.config import conf_vars",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "85:         )",
      "87:     @patch(imaplib_string)",
      "89:         mock_conn = _create_fake_imap(mock_imaplib)",
      "91:         with ImapHook():",
      "92:             pass",
      "95:         mock_conn.login.assert_called_once_with(\"imap_user\", \"imap_password\")",
      "96:         assert mock_conn.logout.call_count == 1",
      "",
      "[Removed Lines]",
      "88:     def test_connect_and_disconnect(self, mock_imaplib):",
      "94:         mock_imaplib.IMAP4_SSL.assert_called_once_with(\"imap_server_address\", 1993)",
      "",
      "[Added Lines]",
      "89:     @patch(\"ssl.create_default_context\")",
      "90:     def test_connect_and_disconnect(self, create_default_context, mock_imaplib):",
      "96:         assert create_default_context.called",
      "97:         mock_imaplib.IMAP4_SSL.assert_called_once_with(",
      "98:             \"imap_server_address\", 1993, ssl_context=create_default_context.return_value",
      "99:         )",
      "100:         mock_conn.login.assert_called_once_with(\"imap_user\", \"imap_password\")",
      "101:         assert mock_conn.logout.call_count == 1",
      "103:     @patch(imaplib_string)",
      "104:     @patch(\"ssl.create_default_context\")",
      "105:     def test_connect_and_disconnect_imap_ssl_context_none(self, create_default_context, mock_imaplib):",
      "106:         mock_conn = _create_fake_imap(mock_imaplib)",
      "108:         with conf_vars({(\"imap\", \"ssl_context\"): \"none\"}):",
      "109:             with ImapHook():",
      "110:                 pass",
      "112:         assert not create_default_context.called",
      "113:         mock_imaplib.IMAP4_SSL.assert_called_once_with(\"imap_server_address\", 1993, ssl_context=None)",
      "114:         mock_conn.login.assert_called_once_with(\"imap_user\", \"imap_password\")",
      "115:         assert mock_conn.logout.call_count == 1",
      "117:     @patch(imaplib_string)",
      "118:     @patch(\"ssl.create_default_context\")",
      "119:     def test_connect_and_disconnect_imap_ssl_context_default(self, create_default_context, mock_imaplib):",
      "120:         mock_conn = _create_fake_imap(mock_imaplib)",
      "122:         with conf_vars({(\"imap\", \"ssl_context\"): \"default\"}):",
      "123:             with ImapHook():",
      "124:                 pass",
      "126:         assert create_default_context.called",
      "127:         mock_imaplib.IMAP4_SSL.assert_called_once_with(",
      "128:             \"imap_server_address\", 1993, ssl_context=create_default_context.return_value",
      "129:         )",
      "130:         mock_conn.login.assert_called_once_with(\"imap_user\", \"imap_password\")",
      "131:         assert mock_conn.logout.call_count == 1",
      "133:     @patch(imaplib_string)",
      "134:     @patch(\"ssl.create_default_context\")",
      "135:     def test_connect_and_disconnect_email_ssl_context_none(self, create_default_context, mock_imaplib):",
      "136:         mock_conn = _create_fake_imap(mock_imaplib)",
      "138:         with conf_vars({(\"email\", \"ssl_context\"): \"none\"}):",
      "139:             with ImapHook():",
      "140:                 pass",
      "142:         assert not create_default_context.called",
      "143:         mock_imaplib.IMAP4_SSL.assert_called_once_with(\"imap_server_address\", 1993, ssl_context=None)",
      "144:         mock_conn.login.assert_called_once_with(\"imap_user\", \"imap_password\")",
      "145:         assert mock_conn.logout.call_count == 1",
      "147:     @patch(imaplib_string)",
      "148:     @patch(\"ssl.create_default_context\")",
      "149:     def test_connect_and_disconnect_imap_ssl_context_override(self, create_default_context, mock_imaplib):",
      "150:         mock_conn = _create_fake_imap(mock_imaplib)",
      "152:         with conf_vars({(\"email\", \"ssl_context\"): \"none\", (\"imap\", \"ssl_context\"): \"default\"}):",
      "153:             with ImapHook():",
      "154:                 pass",
      "156:         assert create_default_context.called",
      "157:         mock_imaplib.IMAP4_SSL.assert_called_once_with(",
      "158:             \"imap_server_address\", 1993, ssl_context=create_default_context.return_value",
      "159:         )",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "af98c605540e5b9f654e1102e46ccff5d9499462",
      "candidate_info": {
        "commit_hash": "af98c605540e5b9f654e1102e46ccff5d9499462",
        "repo": "apache/airflow",
        "commit_url": "https://github.com/apache/airflow/commit/af98c605540e5b9f654e1102e46ccff5d9499462",
        "files": [
          "dev/provider_packages/publish_provider_documentation.sh"
        ],
        "message": "Fix mistakenly used \"release-mangement build-docs\" command (#33195)\n\nThe #32495 mistakeny replaced the \"build\" script with a\n\"release-management build-docs\" command where there is no such\ncommand - there is just \"build-docs\"\n\n(cherry picked from commit 199c604d3841797b97bd4b813b36379910a532a8)",
        "before_after_code_files": [
          "dev/provider_packages/publish_provider_documentation.sh||dev/provider_packages/publish_provider_documentation.sh"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/airflow/pull/33247"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "dev/provider_packages/publish_provider_documentation.sh||dev/provider_packages/publish_provider_documentation.sh": [
          "File: dev/provider_packages/publish_provider_documentation.sh -> dev/provider_packages/publish_provider_documentation.sh",
          "--- Hunk 1 ---",
          "[Context before]",
          "28:     provider_filters+=(\"--package-filter\" \"apache-airflow-providers-${provider//./-}\")",
          "29: done",
          "34: cd \"${AIRFLOW_SITE_DIRECTORY}\"",
          "",
          "[Removed Lines]",
          "31: breeze release-management build-docs \\",
          "32:     \"${provider_filters[@]}\"",
          "",
          "[Added Lines]",
          "31: breeze build-docs \"${provider_filters[@]}\"",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "2ff8d4d6133300b1c8017ed8f5d9e981921b95c9",
      "candidate_info": {
        "commit_hash": "2ff8d4d6133300b1c8017ed8f5d9e981921b95c9",
        "repo": "apache/airflow",
        "commit_url": "https://github.com/apache/airflow/commit/2ff8d4d6133300b1c8017ed8f5d9e981921b95c9",
        "files": [
          "airflow/migrations/versions/0128_2_7_0_add_include_deferred_column_to_pool.py",
          "docs/apache-airflow/img/airflow_erd.sha256"
        ],
        "message": "Change type of defualts for include_deferred (#33271)\n\nWe should change the defaults to client defaults for MSSQL compatibility\nThe change in #32709 was not liked by MSSQL\n\nCo-authored-by: Ephraim Anierobi <splendidzigy24@gmail.com>\n(cherry picked from commit d989e9dba5899e87780df9a8c5994ed1e3f8a776)",
        "before_after_code_files": [
          "airflow/migrations/versions/0128_2_7_0_add_include_deferred_column_to_pool.py||airflow/migrations/versions/0128_2_7_0_add_include_deferred_column_to_pool.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/airflow/pull/33247"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "airflow/migrations/versions/0128_2_7_0_add_include_deferred_column_to_pool.py||airflow/migrations/versions/0128_2_7_0_add_include_deferred_column_to_pool.py": [
          "File: airflow/migrations/versions/0128_2_7_0_add_include_deferred_column_to_pool.py -> airflow/migrations/versions/0128_2_7_0_add_include_deferred_column_to_pool.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "39: def upgrade():",
          "40:     \"\"\"Apply add include_deferred column to pool\"\"\"",
          "41:     with op.batch_alter_table(\"slot_pool\") as batch_op:",
          "47: def downgrade():",
          "",
          "[Removed Lines]",
          "42:         batch_op.add_column(",
          "43:             sa.Column(\"include_deferred\", sa.Boolean, nullable=False, server_default=sa.false())",
          "44:         )",
          "",
          "[Added Lines]",
          "42:         batch_op.add_column(sa.Column(\"include_deferred\", sa.Boolean, default=False))",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "9536fad87b44003502d65c28dd4b581b225d921e",
      "candidate_info": {
        "commit_hash": "9536fad87b44003502d65c28dd4b581b225d921e",
        "repo": "apache/airflow",
        "commit_url": "https://github.com/apache/airflow/commit/9536fad87b44003502d65c28dd4b581b225d921e",
        "files": [
          "setup.cfg"
        ],
        "message": "For now limit Pydantic to < 2.0.0 (#33235)\n\n* For now limit Pydantic to < 2.0.0\n\nPydantic 2 adds few warnings/deprecations and until AWS dependencies\nare updated, we cannot move to it anyway.\n\nLimiting Pydantic to <2 for now should prevent the warnings and\nheep our dependencies in check.\n\n* Update setup.cfg\n\nCo-authored-by: Jed Cunningham <66968678+jedcunningham@users.noreply.github.com>\n\n---------\n\nCo-authored-by: Jed Cunningham <66968678+jedcunningham@users.noreply.github.com>\n(cherry picked from commit a752c902861d9a829d7451cc69d1343cbe5b54dc)",
        "before_after_code_files": [
          "setup.cfg||setup.cfg"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/airflow/pull/33247"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "setup.cfg||setup.cfg": [
          "File: setup.cfg -> setup.cfg",
          "--- Hunk 1 ---",
          "[Context before]",
          "126:     pendulum>=2.0",
          "127:     pluggy>=1.0",
          "128:     psutil>=4.2.0",
          "130:     pygments>=2.0.1",
          "131:     pyjwt>=2.0.0",
          "132:     python-daemon>=3.0.0",
          "",
          "[Removed Lines]",
          "129:     pydantic>=1.10.0",
          "",
          "[Added Lines]",
          "129:     # We limit Pydantic to <2.0.0 until we can upgrade - there are limitation for Pydantic in AWS provider",
          "130:     # dependency (aws-sam-translator) - also we need to change orm-mode to from_attributes in definitions",
          "131:     # of the ORM models. See for the previous attempt https://github.com/apache/airflow/pull/33220",
          "132:     pydantic>=1.10.0,<2.0.0",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "197789e19d841ad352dfe4065e1f7eeeec65e280",
      "candidate_info": {
        "commit_hash": "197789e19d841ad352dfe4065e1f7eeeec65e280",
        "repo": "apache/airflow",
        "commit_url": "https://github.com/apache/airflow/commit/197789e19d841ad352dfe4065e1f7eeeec65e280",
        "files": [
          "tests/models/test_xcom_arg_map.py"
        ],
        "message": "Give the the test_xcom_ar_map test opportunity to flush the data (#33153)\n\nUsing same session in different steps of the same test has the\npotential of not flishing/committing the changes between.\n\nSeems that the #33150 traded one flakiness with another. Attempting to\nmake sure that the flash/commit is executed before the second run.\n\nError:\n\nThe test RuntimeError: number of values in row (0) differ from number of\ncolumn processors (29)\n\nThe error is strange however and indicates a bug in sqlite library.\n\n(cherry picked from commit 6b21b79f33e245ff1612b1970d05ef692c41f15c)",
        "before_after_code_files": [
          "tests/models/test_xcom_arg_map.py||tests/models/test_xcom_arg_map.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/airflow/pull/33247"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "tests/models/test_xcom_arg_map.py||tests/models/test_xcom_arg_map.py": [
          "File: tests/models/test_xcom_arg_map.py -> tests/models/test_xcom_arg_map.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "256:     session.flush()",
          "257:     session.commit()",
          "259:     # Now \"pull\" should apply the mapping functions in order.",
          "260:     decision = dr.task_instance_scheduling_decisions(session=session)",
          "261:     for ti in decision.schedulable_tis:",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "259:     session.flush()",
          "260:     session.commit()",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "63789436209db9ab0f612581381d46bb18eb8f82",
      "candidate_info": {
        "commit_hash": "63789436209db9ab0f612581381d46bb18eb8f82",
        "repo": "apache/airflow",
        "commit_url": "https://github.com/apache/airflow/commit/63789436209db9ab0f612581381d46bb18eb8f82",
        "files": [
          "airflow/config_templates/unit_tests.cfg",
          "airflow/jobs/job.py",
          "tests/jobs/test_base_job.py",
          "tests/utils/test_helpers.py"
        ],
        "message": "Don't just default to scheduler heartbeat in jobs (#33084)\n\n(cherry picked from commit c39359eafb7da21c098c07202c2bfe155c1db9ed)",
        "before_after_code_files": [
          "airflow/config_templates/unit_tests.cfg||airflow/config_templates/unit_tests.cfg",
          "airflow/jobs/job.py||airflow/jobs/job.py",
          "tests/jobs/test_base_job.py||tests/jobs/test_base_job.py",
          "tests/utils/test_helpers.py||tests/utils/test_helpers.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/apache/airflow/pull/33247"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "airflow/config_templates/unit_tests.cfg||airflow/config_templates/unit_tests.cfg": [
          "File: airflow/config_templates/unit_tests.cfg -> airflow/config_templates/unit_tests.cfg",
          "--- Hunk 1 ---",
          "[Context before]",
          "92: parsing_processes = 2",
          "93: dag_dir_list_interval = 0",
          "95: [example_section]",
          "96: # This section is used to test coercions of configuration values retrieval",
          "97: string_value = 21600",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "95: [triggerer]",
          "96: # Those values are set so that during unit tests things run faster than usual.",
          "97: # Triggerer heartbeat intentionally different from scheduler to catch bad assumptions in code",
          "98: # that they are the same which by default they are in production but they can be configured differently",
          "99: # by users.",
          "100: job_heartbeat_sec = 2",
          "",
          "---------------"
        ],
        "airflow/jobs/job.py||airflow/jobs/job.py": [
          "File: airflow/jobs/job.py -> airflow/jobs/job.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "97:     Only makes sense for SchedulerJob and BackfillJob instances.",
          "98:     \"\"\"",
          "102:     def __init__(self, executor=None, heartrate=None, **kwargs):",
          "103:         # Save init parameters as DB fields",
          "104:         self.hostname = get_hostname()",
          "",
          "[Removed Lines]",
          "100:     heartrate = conf.getfloat(\"scheduler\", \"JOB_HEARTBEAT_SEC\")",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "117:     def executor(self):",
          "118:         return ExecutorLoader.get_default_executor()",
          "120:     def is_alive(self, grace_multiplier=2.1):",
          "121:         \"\"\"",
          "122:         Is this job currently alive.",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "118:     @cached_property",
          "119:     def heartrate(self):",
          "120:         if self.job_type == \"TriggererJob\":",
          "121:             return conf.getfloat(\"triggerer\", \"JOB_HEARTBEAT_SEC\")",
          "122:         else:",
          "123:             # Heartrate used to be hardcoded to scheduler, so in all other",
          "124:             # cases continue to use that value for back compat",
          "125:             return conf.getfloat(\"scheduler\", \"JOB_HEARTBEAT_SEC\")",
          "",
          "---------------"
        ],
        "tests/jobs/test_base_job.py||tests/jobs/test_base_job.py": [
          "File: tests/jobs/test_base_job.py -> tests/jobs/test_base_job.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "32: from airflow.utils.state import State",
          "33: from tests.listeners import lifecycle_listener",
          "34: from tests.test_utils.config import conf_vars",
          "38: class TestJob:",
          "",
          "[Removed Lines]",
          "35: from tests.utils.test_helpers import MockJobRunner",
          "",
          "[Added Lines]",
          "35: from tests.utils.test_helpers import MockJobRunner, SchedulerJobRunner, TriggererJobRunner",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "90:         assert job.state == State.FAILED",
          "91:         assert job.end_date is not None",
          "93:     def test_most_recent_job(self):",
          "94:         with create_session() as session:",
          "95:             old_job = Job(heartrate=10)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "93:     @pytest.mark.parametrize(",
          "94:         \"job_runner, job_type,job_heartbeat_sec\",",
          "95:         [(SchedulerJobRunner, \"scheduler\", \"11\"), (TriggererJobRunner, \"triggerer\", \"9\")],",
          "96:     )",
          "97:     def test_heart_rate_after_fetched_from_db(self, job_runner, job_type, job_heartbeat_sec):",
          "98:         \"\"\"Ensure heartrate is set correctly after jobs are queried from the DB\"\"\"",
          "99:         with create_session() as session, conf_vars(",
          "100:             {(job_type.lower(), \"job_heartbeat_sec\"): job_heartbeat_sec}",
          "101:         ):",
          "102:             job = Job()",
          "103:             job_runner(job=job)",
          "104:             session.add(job)",
          "105:             session.flush()",
          "107:             most_recent = most_recent_job(job_runner.job_type, session=session)",
          "108:             assert most_recent.heartrate == float(job_heartbeat_sec)",
          "110:             session.rollback()",
          "112:     @pytest.mark.parametrize(",
          "113:         \"job_runner, job_type,job_heartbeat_sec\",",
          "114:         [(SchedulerJobRunner, \"scheduler\", \"11\"), (TriggererJobRunner, \"triggerer\", \"9\")],",
          "115:     )",
          "116:     def test_heart_rate_via_constructor_persists(self, job_runner, job_type, job_heartbeat_sec):",
          "117:         \"\"\"Ensure heartrate passed via constructor is set correctly\"\"\"",
          "118:         with conf_vars({(job_type.lower(), \"job_heartbeat_sec\"): job_heartbeat_sec}):",
          "119:             job = Job(heartrate=12)",
          "120:             job_runner(job)",
          "121:             # heartrate should be 12 since we passed that to the constructor directly",
          "122:             assert job.heartrate == 12",
          "",
          "---------------"
        ],
        "tests/utils/test_helpers.py||tests/utils/test_helpers.py": [
          "File: tests/utils/test_helpers.py -> tests/utils/test_helpers.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "343:         if self.func is not None:",
          "344:             return self.func()",
          "345:         return None",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "348: class SchedulerJobRunner(MockJobRunner):",
          "349:     job_type = \"SchedulerJob\"",
          "352: class TriggererJobRunner(MockJobRunner):",
          "353:     job_type = \"TriggererJob\"",
          "",
          "---------------"
        ]
      }
    }
  ]
}