{
  "cve_id": "CVE-2022-0282",
  "cve_desc": "Cross-site Scripting in Packagist microweber/microweber prior to 1.2.11.\n\n",
  "repo": "microweber/microweber",
  "patch_hash": "51b5a4e3ef01e587797c0109159a8ad9d2bac77a",
  "patch_info": {
    "commit_hash": "51b5a4e3ef01e587797c0109159a8ad9d2bac77a",
    "repo": "microweber/microweber",
    "commit_url": "https://github.com/microweber/microweber/commit/51b5a4e3ef01e587797c0109159a8ad9d2bac77a",
    "files": [
      "src/MicroweberPackages/Comment/Models/Comment.php",
      "src/MicroweberPackages/Comment/Models/CommentsCrud.php",
      "src/MicroweberPackages/Comment/resources/views/admin/comments/comment_item.blade.php",
      "userfiles/modules/comments/src/Controllers/Admin.php"
    ],
    "message": "fix comments xss",
    "before_after_code_files": [
      "src/MicroweberPackages/Comment/Models/Comment.php||src/MicroweberPackages/Comment/Models/Comment.php",
      "src/MicroweberPackages/Comment/Models/CommentsCrud.php||src/MicroweberPackages/Comment/Models/CommentsCrud.php",
      "src/MicroweberPackages/Comment/resources/views/admin/comments/comment_item.blade.php||src/MicroweberPackages/Comment/resources/views/admin/comments/comment_item.blade.php",
      "userfiles/modules/comments/src/Controllers/Admin.php||userfiles/modules/comments/src/Controllers/Admin.php"
    ]
  },
  "patch_diff": {
    "src/MicroweberPackages/Comment/Models/Comment.php||src/MicroweberPackages/Comment/Models/Comment.php": [
      "File: src/MicroweberPackages/Comment/Models/Comment.php -> src/MicroweberPackages/Comment/Models/Comment.php"
    ],
    "src/MicroweberPackages/Comment/Models/CommentsCrud.php||src/MicroweberPackages/Comment/Models/CommentsCrud.php": [
      "File: src/MicroweberPackages/Comment/Models/CommentsCrud.php -> src/MicroweberPackages/Comment/Models/CommentsCrud.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "54:                 if (isset($item['comment_body']) and ($item['comment_body'] != '')) {",
      "55:                     $surl = site_url();",
      "56:                     $item['comment_body'] = str_replace('{SITE_URL}', $surl, $item['comment_body']);",
      "58:                 }",
      "60:                 if (isset($params['single'])) {",
      "",
      "[Removed Lines]",
      "57:                     $comments[$i]['comment_body'] = $item['comment_body']; // mw()->format->autolink($item['comment_body']);",
      "",
      "[Added Lines]",
      "57:                     $comments[$i]['comment_body'] = htmlentities($item['comment_body']);",
      "",
      "---------------"
    ],
    "src/MicroweberPackages/Comment/resources/views/admin/comments/comment_item.blade.php||src/MicroweberPackages/Comment/resources/views/admin/comments/comment_item.blade.php": [
      "File: src/MicroweberPackages/Comment/resources/views/admin/comments/comment_item.blade.php -> src/MicroweberPackages/Comment/resources/views/admin/comments/comment_item.blade.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "55:                         </h6>",
      "57:                     <div class=\"mb-3\">",
      "59:                         <span class=\"js-comment-body-textarea\" style=\"display: none;\">",
      "60:                             <small class=\"text-muted\">Comment:</small>",
      "62:                         </span>",
      "63:                     </div>",
      "",
      "[Removed Lines]",
      "58:                         <div class=\"js-comment-body-text\"><?php print $comment['comment_body']; ?></div>",
      "61:                             <textarea name=\"comment_body\" class=\"form-control\"><?php print $comment['comment_body']; ?></textarea>",
      "",
      "[Added Lines]",
      "58:                         <div class=\"js-comment-body-text\">{{ $comment['comment_body'] }}</div>",
      "61:                             <textarea name=\"comment_body\" class=\"form-control\">{{ $comment['comment_body'] }}</textarea>",
      "",
      "---------------"
    ],
    "userfiles/modules/comments/src/Controllers/Admin.php||userfiles/modules/comments/src/Controllers/Admin.php": [
      "File: userfiles/modules/comments/src/Controllers/Admin.php -> userfiles/modules/comments/src/Controllers/Admin.php"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "8e42417d598f5a1a792e805698143d6adc9ef570",
      "candidate_info": {
        "commit_hash": "8e42417d598f5a1a792e805698143d6adc9ef570",
        "repo": "microweber/microweber",
        "commit_url": "https://github.com/microweber/microweber/commit/8e42417d598f5a1a792e805698143d6adc9ef570",
        "files": [
          "src/MicroweberPackages/Comment/Models/CommentsCrud.php",
          "src/MicroweberPackages/Helper/AntiXSS.php",
          "src/MicroweberPackages/Helper/HTMLClean.php"
        ],
        "message": "update",
        "before_after_code_files": [
          "src/MicroweberPackages/Comment/Models/CommentsCrud.php||src/MicroweberPackages/Comment/Models/CommentsCrud.php",
          "src/MicroweberPackages/Helper/AntiXSS.php||src/MicroweberPackages/Helper/HTMLClean.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/MicroweberPackages/Comment/Models/CommentsCrud.php||src/MicroweberPackages/Comment/Models/CommentsCrud.php"
          ],
          "candidate": [
            "src/MicroweberPackages/Comment/Models/CommentsCrud.php||src/MicroweberPackages/Comment/Models/CommentsCrud.php"
          ]
        }
      },
      "candidate_diff": {
        "src/MicroweberPackages/Comment/Models/CommentsCrud.php||src/MicroweberPackages/Comment/Models/CommentsCrud.php": [
          "File: src/MicroweberPackages/Comment/Models/CommentsCrud.php -> src/MicroweberPackages/Comment/Models/CommentsCrud.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: namespace MicroweberPackages\\Comment\\Models;",
          "5: use MicroweberPackages\\Database\\Crud;",
          "6: use voku\\helper\\AntiXSS;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "6: use MicroweberPackages\\Helper\\HTMLClean;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "56:                     $surl = site_url();",
          "57:                     $item['comment_body'] = str_replace('{SITE_URL}', $surl, $item['comment_body']);",
          "61:                 }",
          "63:                 if (isset($params['single'])) {",
          "",
          "[Removed Lines]",
          "59:                     $antiXss = new AntiXSS();",
          "60:                     $comments[$i]['comment_body'] = $antiXss->xss_clean($item['comment_body']);",
          "",
          "[Added Lines]",
          "60:                     $clearInput = new HTMLClean();",
          "61:                     $comments[$i]['comment_body'] = $clearInput->clean($item['comment_body']);",
          "",
          "---------------"
        ],
        "src/MicroweberPackages/Helper/AntiXSS.php||src/MicroweberPackages/Helper/HTMLClean.php": [
          "File: src/MicroweberPackages/Helper/AntiXSS.php -> src/MicroweberPackages/Helper/HTMLClean.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: namespace MicroweberPackages\\Helper;",
          "6: {",
          "9:         $antiXss = new \\voku\\helper\\AntiXSS();",
          "10:         $html = $antiXss->xss_clean($html);",
          "",
          "[Removed Lines]",
          "5: class AntiXSS",
          "7:     public function clear($html) {",
          "",
          "[Added Lines]",
          "5: class HTMLClean",
          "7:     public function clean($html) {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "cad3df99b7bb5cc89617ae1c0b2132ec98800f84",
      "candidate_info": {
        "commit_hash": "cad3df99b7bb5cc89617ae1c0b2132ec98800f84",
        "repo": "microweber/microweber",
        "commit_url": "https://github.com/microweber/microweber/commit/cad3df99b7bb5cc89617ae1c0b2132ec98800f84",
        "files": [
          "src/MicroweberPackages/Comment/Models/Comment.php",
          "src/MicroweberPackages/Comment/Models/CommentsCrud.php"
        ],
        "message": "update",
        "before_after_code_files": [
          "src/MicroweberPackages/Comment/Models/Comment.php||src/MicroweberPackages/Comment/Models/Comment.php",
          "src/MicroweberPackages/Comment/Models/CommentsCrud.php||src/MicroweberPackages/Comment/Models/CommentsCrud.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/MicroweberPackages/Comment/Models/Comment.php||src/MicroweberPackages/Comment/Models/Comment.php",
            "src/MicroweberPackages/Comment/Models/CommentsCrud.php||src/MicroweberPackages/Comment/Models/CommentsCrud.php"
          ],
          "candidate": [
            "src/MicroweberPackages/Comment/Models/Comment.php||src/MicroweberPackages/Comment/Models/Comment.php",
            "src/MicroweberPackages/Comment/Models/CommentsCrud.php||src/MicroweberPackages/Comment/Models/CommentsCrud.php"
          ]
        }
      },
      "candidate_diff": {
        "src/MicroweberPackages/Comment/Models/Comment.php||src/MicroweberPackages/Comment/Models/Comment.php": [
          "File: src/MicroweberPackages/Comment/Models/Comment.php -> src/MicroweberPackages/Comment/Models/Comment.php"
        ],
        "src/MicroweberPackages/Comment/Models/CommentsCrud.php||src/MicroweberPackages/Comment/Models/CommentsCrud.php": [
          "File: src/MicroweberPackages/Comment/Models/CommentsCrud.php -> src/MicroweberPackages/Comment/Models/CommentsCrud.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: namespace MicroweberPackages\\Comment\\Models;",
          "5: use MicroweberPackages\\Database\\Crud;",
          "8: class CommentsCrud extends Crud",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "6: use voku\\helper\\AntiXSS;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "54:                 if (isset($item['comment_body']) and ($item['comment_body'] != '')) {",
          "55:                     $surl = site_url();",
          "56:                     $item['comment_body'] = str_replace('{SITE_URL}', $surl, $item['comment_body']);",
          "58:                 }",
          "60:                 if (isset($params['single'])) {",
          "",
          "[Removed Lines]",
          "57:                     $comments[$i]['comment_body'] = htmlentities($item['comment_body']);",
          "",
          "[Added Lines]",
          "59:                     $antiXss = new AntiXSS();",
          "60:                     $comments[$i]['comment_body'] = $antiXss->xss_clean($item['comment_body']);",
          "",
          "---------------"
        ]
      }
    }
  ]
}