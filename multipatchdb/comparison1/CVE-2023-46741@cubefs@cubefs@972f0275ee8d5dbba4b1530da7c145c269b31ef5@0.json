{
  "cve_id": "CVE-2023-46741",
  "cve_desc": "CubeFS is an open-source cloud-native file storage system. A vulnerability was found in CubeFS prior to version 3.3.1 that could allow users to read sensitive data from the logs which could allow them escalate privileges. CubeFS leaks configuration keys in plaintext format in the logs. These keys could allow anyone to carry out operations on blobs that they otherwise do not have permissions for. For example, an attacker that has succesfully retrieved a secret key from the logs can delete blogs from the blob store. The attacker can either be an internal user with limited privileges to read the log, or they can be an external user who has escalated privileges sufficiently to access the logs. The vulnerability has been patched in v3.3.1. There is no other mitigation than upgrading.\n",
  "repo": "cubefs/cubefs",
  "patch_hash": "972f0275ee8d5dbba4b1530da7c145c269b31ef5",
  "patch_info": {
    "commit_hash": "972f0275ee8d5dbba4b1530da7c145c269b31ef5",
    "repo": "cubefs/cubefs",
    "commit_url": "https://github.com/cubefs/cubefs/commit/972f0275ee8d5dbba4b1530da7c145c269b31ef5",
    "files": [
      "blobstore/access/server.go"
    ],
    "message": "fix(security): leaks magic secret key when starting blobstore access service\n\nsee more in cubefs advisories:\nhttps://github.com/cubefs/cubefs/security/advisories/GHSA-8h2x-gr2c-c275\n\nSigned-off-by: slasher <shenjie1@oppo.com>",
    "before_after_code_files": [
      "blobstore/access/server.go||blobstore/access/server.go"
    ]
  },
  "patch_diff": {
    "blobstore/access/server.go||blobstore/access/server.go": [
      "File: blobstore/access/server.go -> blobstore/access/server.go",
      "--- Hunk 1 ---",
      "[Context before]",
      "78:   log.Warn(\"no region magic setting, using default secret keys for checksum\")",
      "79:   return",
      "80:  }",
      "83:  b := sha1.Sum([]byte(regionMagic))",
      "84:  initTokenSecret(b[:8])",
      "85:  initLocationSecret(b[:8])",
      "",
      "[Removed Lines]",
      "82:  log.Info(\"using magic secret keys for checksum with:\", regionMagic)",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "cea7ed299fd499ee020d6292f4cf805960843f26",
      "candidate_info": {
        "commit_hash": "cea7ed299fd499ee020d6292f4cf805960843f26",
        "repo": "cubefs/cubefs",
        "commit_url": "https://github.com/cubefs/cubefs/commit/cea7ed299fd499ee020d6292f4cf805960843f26",
        "files": [
          "blobstore/access/server.go"
        ],
        "message": "fix(security): leaks magic secret key when starting blobstore access service\n\nsee more in cubefs advisories:\nhttps://github.com/cubefs/cubefs/security/advisories/GHSA-8h2x-gr2c-c275\n\nSigned-off-by: slasher <shenjie1@oppo.com>",
        "before_after_code_files": [
          "blobstore/access/server.go||blobstore/access/server.go"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "blobstore/access/server.go||blobstore/access/server.go"
          ],
          "candidate": [
            "blobstore/access/server.go||blobstore/access/server.go"
          ]
        }
      },
      "candidate_diff": {
        "blobstore/access/server.go||blobstore/access/server.go": [
          "File: blobstore/access/server.go -> blobstore/access/server.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "78:   log.Warn(\"no region magic setting, using default secret keys for checksum\")",
          "79:   return",
          "80:  }",
          "83:  b := sha1.Sum([]byte(regionMagic))",
          "84:  initTokenSecret(b[:8])",
          "85:  initLocationSecret(b[:8])",
          "",
          "[Removed Lines]",
          "82:  log.Info(\"using magic secret keys for checksum with:\", regionMagic)",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    }
  ]
}