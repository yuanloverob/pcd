{
  "cve_id": "CVE-2022-36108",
  "cve_desc": "TYPO3 is an open source PHP based web content management system released under the GNU GPL. It has been discovered that the `f:asset.css` view helper is vulnerable to cross-site scripting when user input is passed as variables to the CSS. Update to TYPO3 version 10.4.32 or 11.5.16 that fix the problem. There are no known workarounds for this issue.",
  "repo": "TYPO3/typo3",
  "patch_hash": "c62e16fac031c270d9759c7261e504c7e25405df",
  "patch_info": {
    "commit_hash": "c62e16fac031c270d9759c7261e504c7e25405df",
    "repo": "TYPO3/typo3",
    "commit_url": "https://github.com/TYPO3/typo3/commit/c62e16fac031c270d9759c7261e504c7e25405df",
    "files": [
      "typo3/sysext/fluid/Classes/ViewHelpers/Asset/CssViewHelper.php",
      "typo3/sysext/fluid/Tests/Functional/ViewHelpers/Asset/CssViewHelperTest.php"
    ],
    "message": "[SECURITY] Encode child node variables in f:asset.css view helper\n\nVariables in child nodes like `<f:asset.css>{value}</f:asset.css>`\nwere not encoded and allow cross-site scripting. In case values shall\nbe taken as is, corresponding `f:format.raw` instruction has to be used.\n\nResolves: #97900\nReleases: main, 11.5, 10.4\nChange-Id: Id843a41c42bbe1f74cdc4efbc117b24d20026b97\nSecurity-Bulletin: TYPO3-CORE-SA-2022-010\nSecurity-References: CVE-2022-36108\nReviewed-on: https://review.typo3.org/c/Packages/TYPO3.CMS/+/75713\nTested-by: Oliver Hader <oliver.hader@typo3.org>\nReviewed-by: Oliver Hader <oliver.hader@typo3.org>",
    "before_after_code_files": [
      "typo3/sysext/fluid/Classes/ViewHelpers/Asset/CssViewHelper.php||typo3/sysext/fluid/Classes/ViewHelpers/Asset/CssViewHelper.php",
      "typo3/sysext/fluid/Tests/Functional/ViewHelpers/Asset/CssViewHelperTest.php||typo3/sysext/fluid/Tests/Functional/ViewHelpers/Asset/CssViewHelperTest.php"
    ]
  },
  "patch_diff": {
    "typo3/sysext/fluid/Classes/ViewHelpers/Asset/CssViewHelper.php||typo3/sysext/fluid/Classes/ViewHelpers/Asset/CssViewHelper.php": [
      "File: typo3/sysext/fluid/Classes/ViewHelpers/Asset/CssViewHelper.php -> typo3/sysext/fluid/Classes/ViewHelpers/Asset/CssViewHelper.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "54:     protected $escapeChildren = false;",
      "",
      "[Added Lines]",
      "54:     protected $escapeChildren = true;",
      "",
      "---------------"
    ],
    "typo3/sysext/fluid/Tests/Functional/ViewHelpers/Asset/CssViewHelperTest.php||typo3/sysext/fluid/Tests/Functional/ViewHelpers/Asset/CssViewHelperTest.php": [
      "File: typo3/sysext/fluid/Tests/Functional/ViewHelpers/Asset/CssViewHelperTest.php -> typo3/sysext/fluid/Tests/Functional/ViewHelpers/Asset/CssViewHelperTest.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "18: namespace TYPO3\\CMS\\Fluid\\Tests\\Functional\\ViewHelpers\\Asset;",
      "20: use TYPO3\\CMS\\Core\\Page\\AssetCollector;",
      "21: use TYPO3\\CMS\\Fluid\\ViewHelpers\\Asset\\CssViewHelper;",
      "22: use TYPO3\\TestingFramework\\Core\\Functional\\FunctionalTestCase;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "21: use TYPO3\\CMS\\Core\\Utility\\GeneralUtility;",
      "22: use TYPO3\\CMS\\Fluid\\View\\StandaloneView;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "82:         self::assertSame($collectedJavaScripts['test']['source'], 'my.css');",
      "83:         self::assertSame($collectedJavaScripts['test']['attributes'], ['disabled' => 'disabled']);",
      "84:     }",
      "85: }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "88:     public static function childNodeRenderingIsCorrectDataProvider(): array",
      "89:     {",
      "90:         return [",
      "92:             'variable with double quotes is encoded' => [",
      "93:                 '</style>/* \" ', // variable value",
      "94:                 'body { color: #{color}; }', // inner template source",
      "95:                 'body { color: #&lt;/style&gt;/* &quot; ; }', // expectation",
      "96:             ],",
      "97:             'variable with double quotes is encoded in single quotes' => [",
      "98:                 '</style>/* \" ', // variable value",
      "99:                 'body { color: \\'#{color}\\'; }', // inner template source",
      "100:                 'body { color: \\'#&lt;/style&gt;/* &quot; \\'; }', // expectation",
      "101:             ],",
      "102:             'variable with double quotes is encoded in double quotes' => [",
      "103:                 '</style>/* \" ', // variable value",
      "104:                 'body { color: \"#{color}\"; }', // inner template source",
      "105:                 'body { color: \"#&lt;/style&gt;/* &quot; \"; }', // expectation",
      "106:             ],",
      "108:             'variable with single quotes is encoded' => [",
      "109:                 '</style>/* \\' ', // variable value",
      "110:                 'body { color: #{color}; }', // inner template source",
      "111:                 'body { color: #&lt;/style&gt;/* &#039; ; }', // expectation",
      "112:             ],",
      "113:             'variable with single quotes is encoded in single quotes' => [",
      "114:                 '</style>/* \\' ', // variable value",
      "115:                 'body { color: \\'#{color}\\'; }', // inner template source",
      "116:                 'body { color: \\'#&lt;/style&gt;/* &#039; \\'; }', // expectation",
      "117:             ],",
      "118:             'variable with single quotes is encoded in double quotes' => [",
      "119:                 '</style>/* \\' ', // variable value",
      "120:                 'body { color: \"#{color}\"; }', // inner template source",
      "121:                 'body { color: \"#&lt;/style&gt;/* &#039; \"; }', // expectation",
      "122:             ],",
      "124:             'raw instruction is passed' => [",
      "125:                 '</style>/* \" ',",
      "126:                 'body { color: #{color -> f:format.raw()}; }',",
      "127:                 'body { color: #</style>/* \" ; }',",
      "128:             ],",
      "129:             'raw instruction is passed in sigle quotes' => [",
      "130:                 '</style>/* \" ',",
      "131:                 'body { color: \\'#{color -> f:format.raw()}\\'; }',",
      "132:                 'body { color: \\'#</style>/* \" \\'; }',",
      "133:             ],",
      "134:             'raw instruction is passed in double quotes' => [",
      "135:                 '</style>/* \" ',",
      "136:                 'body { color: \"#{color -> f:format.raw()}\"; }',",
      "137:                 'body { color: \"#</style>/* \" \"; }',",
      "138:             ],",
      "139:         ];",
      "140:     }",
      "146:     public function childNodeRenderingIsCorrect(string $value, string $source, string $expectation): void",
      "147:     {",
      "148:         $assetCollector = new AssetCollector();",
      "149:         GeneralUtility::setSingletonInstance(AssetCollector::class, $assetCollector);",
      "151:         $view = new StandaloneView();",
      "152:         $view->setTemplateSource(sprintf('<f:asset.css identifier=\"test\">%s</f:asset.css>', $source));",
      "153:         $view->assign('color', $value);",
      "154:         $view->render();",
      "155:         GeneralUtility::removeSingletonInstance(AssetCollector::class, $assetCollector);",
      "157:         self::assertSame($expectation, $assetCollector->getInlineStyleSheets()['test']['source']);",
      "158:     }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "d8c9d5abdd05201eb54d3a93b2485e07e7fc9e87",
      "candidate_info": {
        "commit_hash": "d8c9d5abdd05201eb54d3a93b2485e07e7fc9e87",
        "repo": "TYPO3/typo3",
        "commit_url": "https://github.com/TYPO3/typo3/commit/d8c9d5abdd05201eb54d3a93b2485e07e7fc9e87",
        "files": [
          "typo3/sysext/fluid/Classes/ViewHelpers/Asset/CssViewHelper.php",
          "typo3/sysext/fluid/Classes/ViewHelpers/Asset/ScriptViewHelper.php",
          "typo3/sysext/fluid/Tests/Functional/ViewHelpers/Asset/CssViewHelperTest.php",
          "typo3/sysext/fluid/Tests/Functional/ViewHelpers/Asset/ScriptViewHelperTest.php"
        ],
        "message": "[BUGFIX] Do not HTML encode attributes in Script and Asset VH\n\nScriptViewHelper and AssetViewHelper do not directly output any tag,\nbut only pass the arguments to AssetCollector.\n\nTherefore the tag attribute values must not be HTML encoded.\nTo achieve that, we use a subclass of TagBuilder before the tag\nis initialised, which does never encode attribute values.\n\nThe tag view helper inheritance is kept because the tag builder\nnicely abstracts attribute handling, which otherwise would have to\nbe duplicated.\n\nAlso ensure that rendered children will not be encoded as this string\nis used as CSS or JavaScript, where HTML encoding won't help or rather\nbreak the code.\n\nResolves: #92706\nRelated: #92284\nReleases: master, 10.4\nChange-Id: I823ad167ccbd52e9e0f3ad9bb3d54f554a985fef\nReviewed-on: https://review.typo3.org/c/Packages/TYPO3.CMS/+/66284\nTested-by: core-ci <typo3@b13.com>\nTested-by: Georg Ringer <georg.ringer@gmail.com>\nTested-by: Benni Mack <benni@typo3.org>\nReviewed-by: Georg Ringer <georg.ringer@gmail.com>\nReviewed-by: Wouter Wolters <typo3@wouterwolters.nl>\nReviewed-by: Benni Mack <benni@typo3.org>",
        "before_after_code_files": [
          "typo3/sysext/fluid/Classes/ViewHelpers/Asset/CssViewHelper.php||typo3/sysext/fluid/Classes/ViewHelpers/Asset/CssViewHelper.php",
          "typo3/sysext/fluid/Classes/ViewHelpers/Asset/ScriptViewHelper.php||typo3/sysext/fluid/Classes/ViewHelpers/Asset/ScriptViewHelper.php",
          "typo3/sysext/fluid/Tests/Functional/ViewHelpers/Asset/CssViewHelperTest.php||typo3/sysext/fluid/Tests/Functional/ViewHelpers/Asset/CssViewHelperTest.php",
          "typo3/sysext/fluid/Tests/Functional/ViewHelpers/Asset/ScriptViewHelperTest.php||typo3/sysext/fluid/Tests/Functional/ViewHelpers/Asset/ScriptViewHelperTest.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "typo3/sysext/fluid/Classes/ViewHelpers/Asset/CssViewHelper.php||typo3/sysext/fluid/Classes/ViewHelpers/Asset/CssViewHelper.php",
            "typo3/sysext/fluid/Tests/Functional/ViewHelpers/Asset/CssViewHelperTest.php||typo3/sysext/fluid/Tests/Functional/ViewHelpers/Asset/CssViewHelperTest.php"
          ],
          "candidate": [
            "typo3/sysext/fluid/Classes/ViewHelpers/Asset/CssViewHelper.php||typo3/sysext/fluid/Classes/ViewHelpers/Asset/CssViewHelper.php",
            "typo3/sysext/fluid/Tests/Functional/ViewHelpers/Asset/CssViewHelperTest.php||typo3/sysext/fluid/Tests/Functional/ViewHelpers/Asset/CssViewHelperTest.php"
          ]
        }
      },
      "candidate_diff": {
        "typo3/sysext/fluid/Classes/ViewHelpers/Asset/CssViewHelper.php||typo3/sysext/fluid/Classes/ViewHelpers/Asset/CssViewHelper.php": [
          "File: typo3/sysext/fluid/Classes/ViewHelpers/Asset/CssViewHelper.php -> typo3/sysext/fluid/Classes/ViewHelpers/Asset/CssViewHelper.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "20: use TYPO3\\CMS\\Core\\Page\\AssetCollector;",
          "21: use TYPO3Fluid\\Fluid\\Core\\ViewHelper\\AbstractTagBasedViewHelper;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "22: use TYPO3Fluid\\Fluid\\Core\\ViewHelper\\TagBuilder;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "38: class CssViewHelper extends AbstractTagBasedViewHelper",
          "39: {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "46:     protected $escapeOutput = false;",
          "54:     protected $escapeChildren = false;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "51:         $this->assetCollector = $assetCollector;",
          "52:     }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "69:     public function initialize()",
          "70:     {",
          "72:         $this->setTagBuilder(",
          "73:             new class() extends TagBuilder {",
          "74:                 public function addAttribute($attributeName, $attributeValue, $escapeSpecialCharacters = false): void",
          "75:                 {",
          "76:                     parent::addAttribute($attributeName, $attributeValue, false);",
          "77:                 }",
          "78:             }",
          "79:         );",
          "80:         parent::initialize();",
          "81:     }",
          "",
          "---------------"
        ],
        "typo3/sysext/fluid/Classes/ViewHelpers/Asset/ScriptViewHelper.php||typo3/sysext/fluid/Classes/ViewHelpers/Asset/ScriptViewHelper.php": [
          "File: typo3/sysext/fluid/Classes/ViewHelpers/Asset/ScriptViewHelper.php -> typo3/sysext/fluid/Classes/ViewHelpers/Asset/ScriptViewHelper.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "20: use TYPO3\\CMS\\Core\\Page\\AssetCollector;",
          "21: use TYPO3Fluid\\Fluid\\Core\\ViewHelper\\AbstractTagBasedViewHelper;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "22: use TYPO3Fluid\\Fluid\\Core\\ViewHelper\\TagBuilder;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "36: class ScriptViewHelper extends AbstractTagBasedViewHelper",
          "37: {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "44:     protected $escapeOutput = false;",
          "52:     protected $escapeChildren = false;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "49:         $this->assetCollector = $assetCollector;",
          "50:     }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "67:     public function initialize()",
          "68:     {",
          "70:         $this->setTagBuilder(",
          "71:             new class() extends TagBuilder {",
          "72:                 public function addAttribute($attributeName, $attributeValue, $escapeSpecialCharacters = false): void",
          "73:                 {",
          "74:                     parent::addAttribute($attributeName, $attributeValue, false);",
          "75:                 }",
          "76:             }",
          "77:         );",
          "78:         parent::initialize();",
          "79:     }",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "98:             'priority' => $this->arguments['priority'],",
          "99:         ];",
          "100:         if ($src !== null) {",
          "102:         } else {",
          "103:             $content = (string)$this->renderChildren();",
          "104:             if ($content !== '') {",
          "",
          "[Removed Lines]",
          "101:             $this->assetCollector->addJavaScript($identifier, html_entity_decode($src), $attributes, $options);",
          "",
          "[Added Lines]",
          "130:             $this->assetCollector->addJavaScript($identifier, $src, $attributes, $options);",
          "",
          "---------------"
        ],
        "typo3/sysext/fluid/Tests/Functional/ViewHelpers/Asset/CssViewHelperTest.php||typo3/sysext/fluid/Tests/Functional/ViewHelpers/Asset/CssViewHelperTest.php": [
          "File: typo3/sysext/fluid/Tests/Functional/ViewHelpers/Asset/CssViewHelperTest.php -> typo3/sysext/fluid/Tests/Functional/ViewHelpers/Asset/CssViewHelperTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: <?php",
          "3: declare(strict_types=1);",
          "18: namespace TYPO3\\CMS\\Fluid\\Tests\\Functional\\ViewHelpers\\Asset;",
          "20: use TYPO3\\CMS\\Core\\Page\\AssetCollector;",
          "21: use TYPO3\\CMS\\Fluid\\ViewHelpers\\Asset\\CssViewHelper;",
          "22: use TYPO3\\TestingFramework\\Core\\Functional\\FunctionalTestCase;",
          "24: class CssViewHelperTest extends FunctionalTestCase",
          "25: {",
          "29:     protected $initializeDatabase = false;",
          "34:     public function sourceDataProvider(): array",
          "35:     {",
          "36:         return [",
          "37:             'fileadmin reference' => ['fileadmin/StyleSheets/foo.css'],",
          "38:             'EXT: reference' => ['EXT:core/Resources/Public/StyleSheets/foo.css'],",
          "39:             'external reference' => ['https://typo3.com/foo.css'],",
          "40:             'external reference with 1 parameter' => ['https://typo3.com/foo.css?foo=bar'],",
          "41:             'external reference with 2 parameters' => ['https://typo3.com/foo.css?foo=bar&bar=baz'],",
          "42:         ];",
          "43:     }",
          "50:     public function sourceStringIsNotHtmlEncodedBeforePassedToAssetCollector(string $href): void",
          "51:     {",
          "52:         $assetCollector = new AssetCollector();",
          "53:         $viewHelper = new CssViewHelper();",
          "54:         $viewHelper->injectAssetCollector($assetCollector);",
          "55:         $viewHelper->setArguments([",
          "56:             'identifier' => 'test',",
          "57:             'href' => $href,",
          "58:             'priority' => false,",
          "59:         ]);",
          "60:         $viewHelper->initializeArgumentsAndRender();",
          "61:         $collectedJavaScripts = $assetCollector->getStyleSheets();",
          "62:         self::assertSame($collectedJavaScripts['test']['source'], $href);",
          "63:         self::assertSame($collectedJavaScripts['test']['attributes'], []);",
          "64:     }",
          "69:     public function booleanAttributesAreProperlyConverted(): void",
          "70:     {",
          "71:         $assetCollector = new AssetCollector();",
          "72:         $viewHelper = new CssViewHelper();",
          "73:         $viewHelper->injectAssetCollector($assetCollector);",
          "74:         $viewHelper->setArguments([",
          "75:             'identifier' => 'test',",
          "76:             'href' => 'my.css',",
          "77:             'disabled' => true,",
          "78:             'priority' => false,",
          "79:         ]);",
          "80:         $viewHelper->initializeArgumentsAndRender();",
          "81:         $collectedJavaScripts = $assetCollector->getStyleSheets();",
          "82:         self::assertSame($collectedJavaScripts['test']['source'], 'my.css');",
          "83:         self::assertSame($collectedJavaScripts['test']['attributes'], ['disabled' => 'disabled']);",
          "84:     }",
          "85: }",
          "",
          "---------------"
        ],
        "typo3/sysext/fluid/Tests/Functional/ViewHelpers/Asset/ScriptViewHelperTest.php||typo3/sysext/fluid/Tests/Functional/ViewHelpers/Asset/ScriptViewHelperTest.php": [
          "File: typo3/sysext/fluid/Tests/Functional/ViewHelpers/Asset/ScriptViewHelperTest.php -> typo3/sysext/fluid/Tests/Functional/ViewHelpers/Asset/ScriptViewHelperTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "18: namespace TYPO3\\CMS\\Fluid\\Tests\\Functional\\ViewHelpers\\Asset;",
          "22: use TYPO3\\CMS\\Core\\Page\\AssetCollector;",
          "23: use TYPO3\\CMS\\Fluid\\ViewHelpers\\Asset\\ScriptViewHelper;",
          "24: use TYPO3\\TestingFramework\\Core\\Functional\\FunctionalTestCase;",
          "26: class ScriptViewHelperTest extends FunctionalTestCase",
          "27: {",
          "33:     protected $initializeDatabase = false;",
          "36:     {",
          "37:         return [",
          "38:             'fileadmin reference' => ['fileadmin/JavaScript/foo.js'],",
          "",
          "[Removed Lines]",
          "20: use Prophecy\\Argument;",
          "21: use Prophecy\\PhpUnit\\ProphecyTrait;",
          "28:     use ProphecyTrait;",
          "35:     public function valueDataProvider(): array",
          "",
          "[Added Lines]",
          "31:     public function sourceDataProvider(): array",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "51:     {",
          "56:         $viewHelper = new ScriptViewHelper();",
          "58:         $viewHelper->setArguments([",
          "59:             'identifier' => 'test',",
          "60:             'src' => $src,",
          "61:             'priority' => false,",
          "62:         ]);",
          "63:         $viewHelper->initializeArgumentsAndRender();",
          "64:     }",
          "65: }",
          "",
          "[Removed Lines]",
          "50:     public function render(string $src): void",
          "52:         $assetCollector = $this->prophesize(AssetCollector::class);",
          "53:         $assetCollector",
          "54:             ->addJavaScript('test', $src, Argument::any(), Argument::any())",
          "55:             ->shouldBeCalled();",
          "57:         $viewHelper->injectAssetCollector($assetCollector->reveal());",
          "",
          "[Added Lines]",
          "46:     public function sourceStringIsNotHtmlEncodedBeforePassedToAssetCollector(string $src): void",
          "49:         $assetCollector = new AssetCollector();",
          "50:         $viewHelper->injectAssetCollector($assetCollector);",
          "57:         $collectedJavaScripts = $assetCollector->getJavaScripts();",
          "58:         self::assertSame($collectedJavaScripts['test']['source'], $src);",
          "59:         self::assertSame($collectedJavaScripts['test']['attributes'], []);",
          "60:     }",
          "65:     public function booleanAttributesAreProperlyConverted(): void",
          "66:     {",
          "67:         $viewHelper = new ScriptViewHelper();",
          "68:         $assetCollector = new AssetCollector();",
          "69:         $viewHelper->injectAssetCollector($assetCollector);",
          "70:         $viewHelper->setArguments([",
          "71:             'identifier' => 'test',",
          "72:             'src' => 'my.js',",
          "73:             'async' => true,",
          "74:             'defer' => true,",
          "75:             'nomodule' => true,",
          "76:             'priority' => false,",
          "77:         ]);",
          "78:         $viewHelper->initializeArgumentsAndRender();",
          "79:         $collectedJavaScripts = $assetCollector->getJavaScripts();",
          "80:         self::assertSame($collectedJavaScripts['test']['source'], 'my.js');",
          "81:         self::assertSame($collectedJavaScripts['test']['attributes'], ['async' => 'async', 'defer' => 'defer', 'nomodule' => 'nomodule']);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "ffb89e079266edea4f77a61331cef32b472c1ce1",
      "candidate_info": {
        "commit_hash": "ffb89e079266edea4f77a61331cef32b472c1ce1",
        "repo": "TYPO3/typo3",
        "commit_url": "https://github.com/TYPO3/typo3/commit/ffb89e079266edea4f77a61331cef32b472c1ce1",
        "files": [
          "typo3/sysext/fluid/Classes/ViewHelpers/Asset/CssViewHelper.php",
          "typo3/sysext/fluid/Tests/Functional/ViewHelpers/Asset/CssViewHelperTest.php"
        ],
        "message": "[SECURITY] Encode child node variables in f:asset.css view helper\n\nVariables in child nodes like `<f:asset.css>{value}</f:asset.css>`\nwere not encoded and allow cross-site scripting. In case values shall\nbe taken as is, corresponding `f:format.raw` instruction has to be used.\n\nResolves: #97900\nReleases: main, 11.5, 10.4\nChange-Id: Id843a41c42bbe1f74cdc4efbc117b24d20026b97\nSecurity-Bulletin: TYPO3-CORE-SA-2022-010\nSecurity-References: CVE-2022-36108\nReviewed-on: https://review.typo3.org/c/Packages/TYPO3.CMS/+/75707\nTested-by: Oliver Hader <oliver.hader@typo3.org>\nReviewed-by: Oliver Hader <oliver.hader@typo3.org>",
        "before_after_code_files": [
          "typo3/sysext/fluid/Classes/ViewHelpers/Asset/CssViewHelper.php||typo3/sysext/fluid/Classes/ViewHelpers/Asset/CssViewHelper.php",
          "typo3/sysext/fluid/Tests/Functional/ViewHelpers/Asset/CssViewHelperTest.php||typo3/sysext/fluid/Tests/Functional/ViewHelpers/Asset/CssViewHelperTest.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_olp_changes": 1,
        "olp_code_files": {
          "patch": [
            "typo3/sysext/fluid/Classes/ViewHelpers/Asset/CssViewHelper.php||typo3/sysext/fluid/Classes/ViewHelpers/Asset/CssViewHelper.php",
            "typo3/sysext/fluid/Tests/Functional/ViewHelpers/Asset/CssViewHelperTest.php||typo3/sysext/fluid/Tests/Functional/ViewHelpers/Asset/CssViewHelperTest.php"
          ],
          "candidate": [
            "typo3/sysext/fluid/Classes/ViewHelpers/Asset/CssViewHelper.php||typo3/sysext/fluid/Classes/ViewHelpers/Asset/CssViewHelper.php",
            "typo3/sysext/fluid/Tests/Functional/ViewHelpers/Asset/CssViewHelperTest.php||typo3/sysext/fluid/Tests/Functional/ViewHelpers/Asset/CssViewHelperTest.php"
          ]
        }
      },
      "candidate_diff": {
        "typo3/sysext/fluid/Classes/ViewHelpers/Asset/CssViewHelper.php||typo3/sysext/fluid/Classes/ViewHelpers/Asset/CssViewHelper.php": [
          "File: typo3/sysext/fluid/Classes/ViewHelpers/Asset/CssViewHelper.php -> typo3/sysext/fluid/Classes/ViewHelpers/Asset/CssViewHelper.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "54:     protected $escapeChildren = false;",
          "",
          "[Added Lines]",
          "54:     protected $escapeChildren = true;",
          "",
          "---------------"
        ],
        "typo3/sysext/fluid/Tests/Functional/ViewHelpers/Asset/CssViewHelperTest.php||typo3/sysext/fluid/Tests/Functional/ViewHelpers/Asset/CssViewHelperTest.php": [
          "File: typo3/sysext/fluid/Tests/Functional/ViewHelpers/Asset/CssViewHelperTest.php -> typo3/sysext/fluid/Tests/Functional/ViewHelpers/Asset/CssViewHelperTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "18: namespace TYPO3\\CMS\\Fluid\\Tests\\Functional\\ViewHelpers\\Asset;",
          "20: use TYPO3\\CMS\\Core\\Page\\AssetCollector;",
          "21: use TYPO3\\CMS\\Fluid\\ViewHelpers\\Asset\\CssViewHelper;",
          "22: use TYPO3\\TestingFramework\\Core\\Functional\\FunctionalTestCase;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "21: use TYPO3\\CMS\\Core\\Utility\\GeneralUtility;",
          "22: use TYPO3\\CMS\\Fluid\\View\\StandaloneView;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "82:         self::assertSame($collectedJavaScripts['test']['source'], 'my.css');",
          "83:         self::assertSame($collectedJavaScripts['test']['attributes'], ['disabled' => 'disabled']);",
          "84:     }",
          "85: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "88:     public static function childNodeRenderingIsCorrectDataProvider(): array",
          "89:     {",
          "90:         return [",
          "92:             'variable with double quotes is encoded' => [",
          "93:                 '</style>/* \" ', // variable value",
          "94:                 'body { color: #{color}; }', // inner template source",
          "95:                 'body { color: #&lt;/style&gt;/* &quot; ; }', // expectation",
          "96:             ],",
          "97:             'variable with double quotes is encoded in single quotes' => [",
          "98:                 '</style>/* \" ', // variable value",
          "99:                 'body { color: \\'#{color}\\'; }', // inner template source",
          "100:                 'body { color: \\'#&lt;/style&gt;/* &quot; \\'; }', // expectation",
          "101:             ],",
          "102:             'variable with double quotes is encoded in double quotes' => [",
          "103:                 '</style>/* \" ', // variable value",
          "104:                 'body { color: \"#{color}\"; }', // inner template source",
          "105:                 'body { color: \"#&lt;/style&gt;/* &quot; \"; }', // expectation",
          "106:             ],",
          "108:             'variable with single quotes is encoded' => [",
          "109:                 '</style>/* \\' ', // variable value",
          "110:                 'body { color: #{color}; }', // inner template source",
          "111:                 'body { color: #&lt;/style&gt;/* &#039; ; }', // expectation",
          "112:             ],",
          "113:             'variable with single quotes is encoded in single quotes' => [",
          "114:                 '</style>/* \\' ', // variable value",
          "115:                 'body { color: \\'#{color}\\'; }', // inner template source",
          "116:                 'body { color: \\'#&lt;/style&gt;/* &#039; \\'; }', // expectation",
          "117:             ],",
          "118:             'variable with single quotes is encoded in double quotes' => [",
          "119:                 '</style>/* \\' ', // variable value",
          "120:                 'body { color: \"#{color}\"; }', // inner template source",
          "121:                 'body { color: \"#&lt;/style&gt;/* &#039; \"; }', // expectation",
          "122:             ],",
          "124:             'raw instruction is passed' => [",
          "125:                 '</style>/* \" ',",
          "126:                 'body { color: #{color -> f:format.raw()}; }',",
          "127:                 'body { color: #</style>/* \" ; }',",
          "128:             ],",
          "129:             'raw instruction is passed in sigle quotes' => [",
          "130:                 '</style>/* \" ',",
          "131:                 'body { color: \\'#{color -> f:format.raw()}\\'; }',",
          "132:                 'body { color: \\'#</style>/* \" \\'; }',",
          "133:             ],",
          "134:             'raw instruction is passed in double quotes' => [",
          "135:                 '</style>/* \" ',",
          "136:                 'body { color: \"#{color -> f:format.raw()}\"; }',",
          "137:                 'body { color: \"#</style>/* \" \"; }',",
          "138:             ],",
          "139:         ];",
          "140:     }",
          "146:     public function childNodeRenderingIsCorrect(string $value, string $source, string $expectation): void",
          "147:     {",
          "148:         $assetCollector = new AssetCollector();",
          "149:         GeneralUtility::setSingletonInstance(AssetCollector::class, $assetCollector);",
          "151:         $view = new StandaloneView();",
          "152:         $view->setTemplateSource(sprintf('<f:asset.css identifier=\"test\">%s</f:asset.css>', $source));",
          "153:         $view->assign('color', $value);",
          "154:         $view->render();",
          "155:         GeneralUtility::removeSingletonInstance(AssetCollector::class, $assetCollector);",
          "157:         self::assertSame($expectation, $assetCollector->getInlineStyleSheets()['test']['source']);",
          "158:     }",
          "",
          "---------------"
        ]
      }
    }
  ]
}