{
  "cve_id": "CVE-2019-10912",
  "cve_desc": "In Symfony before 2.8.50, 3.x before 3.4.26, 4.x before 4.1.12, and 4.2.x before 4.2.7, it is possible to cache objects that may contain bad user input. On serialization or unserialization, this could result in the deletion of files that the current user has access to. This is related to symfony/cache and symfony/phpunit-bridge.",
  "repo": "symfony/symfony",
  "patch_hash": "4fb975281634b8d49ebf013af9e502e67c28816b",
  "patch_info": {
    "commit_hash": "4fb975281634b8d49ebf013af9e502e67c28816b",
    "repo": "symfony/symfony",
    "commit_url": "https://github.com/symfony/symfony/commit/4fb975281634b8d49ebf013af9e502e67c28816b",
    "files": [
      "src/Symfony/Bridge/PhpUnit/Legacy/SymfonyTestsListenerTrait.php",
      "src/Symfony/Bundle/FrameworkBundle/Tests/Kernel/ConcreteMicroKernel.php",
      "src/Symfony/Component/Cache/Traits/FilesystemCommonTrait.php"
    ],
    "message": "Prevent destructors with side-effects from being unserialized",
    "before_after_code_files": [
      "src/Symfony/Bridge/PhpUnit/Legacy/SymfonyTestsListenerTrait.php||src/Symfony/Bridge/PhpUnit/Legacy/SymfonyTestsListenerTrait.php",
      "src/Symfony/Bundle/FrameworkBundle/Tests/Kernel/ConcreteMicroKernel.php||src/Symfony/Bundle/FrameworkBundle/Tests/Kernel/ConcreteMicroKernel.php",
      "src/Symfony/Component/Cache/Traits/FilesystemCommonTrait.php||src/Symfony/Component/Cache/Traits/FilesystemCommonTrait.php"
    ]
  },
  "patch_diff": {
    "src/Symfony/Bridge/PhpUnit/Legacy/SymfonyTestsListenerTrait.php||src/Symfony/Bridge/PhpUnit/Legacy/SymfonyTestsListenerTrait.php": [
      "File: src/Symfony/Bridge/PhpUnit/Legacy/SymfonyTestsListenerTrait.php -> src/Symfony/Bridge/PhpUnit/Legacy/SymfonyTestsListenerTrait.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "83:         }",
      "84:     }",
      "86:     public function __destruct()",
      "87:     {",
      "88:         if (0 < $this->state) {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "86:     public function __sleep()",
      "87:     {",
      "88:         throw new \\BadMethodCallException('Cannot serialize '.__CLASS__);",
      "89:     }",
      "91:     public function __wakeup()",
      "92:     {",
      "93:         throw new \\BadMethodCallException('Cannot unserialize '.__CLASS__);",
      "94:     }",
      "",
      "---------------"
    ],
    "src/Symfony/Bundle/FrameworkBundle/Tests/Kernel/ConcreteMicroKernel.php||src/Symfony/Bundle/FrameworkBundle/Tests/Kernel/ConcreteMicroKernel.php": [
      "File: src/Symfony/Bundle/FrameworkBundle/Tests/Kernel/ConcreteMicroKernel.php -> src/Symfony/Bundle/FrameworkBundle/Tests/Kernel/ConcreteMicroKernel.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "64:         return $this->cacheDir;",
      "65:     }",
      "67:     public function __destruct()",
      "68:     {",
      "69:         $fs = new Filesystem();",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "67:     public function __sleep()",
      "68:     {",
      "69:         throw new \\BadMethodCallException('Cannot serialize '.__CLASS__);",
      "70:     }",
      "72:     public function __wakeup()",
      "73:     {",
      "74:         throw new \\BadMethodCallException('Cannot unserialize '.__CLASS__);",
      "75:     }",
      "",
      "---------------"
    ],
    "src/Symfony/Component/Cache/Traits/FilesystemCommonTrait.php||src/Symfony/Component/Cache/Traits/FilesystemCommonTrait.php": [
      "File: src/Symfony/Component/Cache/Traits/FilesystemCommonTrait.php -> src/Symfony/Component/Cache/Traits/FilesystemCommonTrait.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "116:         throw new \\ErrorException($message, 0, $type, $file, $line);",
      "117:     }",
      "119:     public function __destruct()",
      "120:     {",
      "121:         if (method_exists(parent::class, '__destruct')) {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "119:     public function __sleep()",
      "120:     {",
      "121:         throw new \\BadMethodCallException('Cannot serialize '.__CLASS__);",
      "122:     }",
      "124:     public function __wakeup()",
      "125:     {",
      "126:         throw new \\BadMethodCallException('Cannot unserialize '.__CLASS__);",
      "127:     }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "b224d4f012dbd8c53cecb22254642e7e1fb70f40",
      "candidate_info": {
        "commit_hash": "b224d4f012dbd8c53cecb22254642e7e1fb70f40",
        "repo": "symfony/symfony",
        "commit_url": "https://github.com/symfony/symfony/commit/b224d4f012dbd8c53cecb22254642e7e1fb70f40",
        "files": [
          "src/Symfony/Bridge/PhpUnit/Legacy/CoverageListenerTrait.php",
          "src/Symfony/Bridge/PhpUnit/Legacy/SymfonyTestsListenerTrait.php",
          "src/Symfony/Bundle/FrameworkBundle/Tests/Kernel/ConcreteMicroKernel.php",
          "src/Symfony/Component/Cache/Traits/FilesystemCommonTrait.php"
        ],
        "message": "security #cve-2019-10912 [Cache][PHPUnit Bridge] Prevent destructors with side-effects from being unserialized (nicolas-grekas)\n\nThis PR was merged into the 3.4 branch.\n\nDiscussion\n----------\n\n[Cache][PHPUnit Bridge] Prevent destructors with side-effects from being unserialized\n\n| Q             | A\n| ------------- | ---\n| Branch?       | 3.4\n| Bug fix?      | yes\n| New feature?  | no\n| BC breaks?    | no\n| Deprecations? | no\n| Tests pass?   | yes\n| Fixed tickets | -\n| License       | MIT\n| Doc PR        | -\n\nReported for `FilesystemCommonTrait` at https://www.intigriti.com/company/submission/CfDJ8Pja6NZvkpNCmx5vVyiGSn7yW8c1j4H0-cnAhIk6fbstOMm028X-XD1kmSuQkGB2n0cRyyVrA2yAiLN_I0EVilaKVLSiSa0UXZJGfN1h85vmk5c2dBBpu619r1YQEIjcXA\n\nCommits\n-------\n\n4fb9752816 Prevent destructors with side-effects from being unserialized",
        "before_after_code_files": [
          "src/Symfony/Bridge/PhpUnit/Legacy/CoverageListenerTrait.php||src/Symfony/Bridge/PhpUnit/Legacy/CoverageListenerTrait.php",
          "src/Symfony/Bridge/PhpUnit/Legacy/SymfonyTestsListenerTrait.php||src/Symfony/Bridge/PhpUnit/Legacy/SymfonyTestsListenerTrait.php",
          "src/Symfony/Bundle/FrameworkBundle/Tests/Kernel/ConcreteMicroKernel.php||src/Symfony/Bundle/FrameworkBundle/Tests/Kernel/ConcreteMicroKernel.php",
          "src/Symfony/Component/Cache/Traits/FilesystemCommonTrait.php||src/Symfony/Component/Cache/Traits/FilesystemCommonTrait.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_olp_changes": 1,
        "olp_code_files": {
          "patch": [
            "src/Symfony/Bridge/PhpUnit/Legacy/SymfonyTestsListenerTrait.php||src/Symfony/Bridge/PhpUnit/Legacy/SymfonyTestsListenerTrait.php",
            "src/Symfony/Bundle/FrameworkBundle/Tests/Kernel/ConcreteMicroKernel.php||src/Symfony/Bundle/FrameworkBundle/Tests/Kernel/ConcreteMicroKernel.php",
            "src/Symfony/Component/Cache/Traits/FilesystemCommonTrait.php||src/Symfony/Component/Cache/Traits/FilesystemCommonTrait.php"
          ],
          "candidate": [
            "src/Symfony/Bridge/PhpUnit/Legacy/SymfonyTestsListenerTrait.php||src/Symfony/Bridge/PhpUnit/Legacy/SymfonyTestsListenerTrait.php",
            "src/Symfony/Bundle/FrameworkBundle/Tests/Kernel/ConcreteMicroKernel.php||src/Symfony/Bundle/FrameworkBundle/Tests/Kernel/ConcreteMicroKernel.php",
            "src/Symfony/Component/Cache/Traits/FilesystemCommonTrait.php||src/Symfony/Component/Cache/Traits/FilesystemCommonTrait.php"
          ]
        }
      },
      "candidate_diff": {
        "src/Symfony/Bridge/PhpUnit/Legacy/CoverageListenerTrait.php||src/Symfony/Bridge/PhpUnit/Legacy/CoverageListenerTrait.php": [
          "File: src/Symfony/Bridge/PhpUnit/Legacy/CoverageListenerTrait.php -> src/Symfony/Bridge/PhpUnit/Legacy/CoverageListenerTrait.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "102:         return $sutFqcn;",
          "103:     }",
          "105:     public function __destruct()",
          "106:     {",
          "107:         if (!$this->warnings) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "105:     public function __sleep()",
          "106:     {",
          "107:         throw new \\BadMethodCallException('Cannot serialize '.__CLASS__);",
          "108:     }",
          "110:     public function __wakeup()",
          "111:     {",
          "112:         throw new \\BadMethodCallException('Cannot unserialize '.__CLASS__);",
          "113:     }",
          "",
          "---------------"
        ],
        "src/Symfony/Bridge/PhpUnit/Legacy/SymfonyTestsListenerTrait.php||src/Symfony/Bridge/PhpUnit/Legacy/SymfonyTestsListenerTrait.php": [
          "File: src/Symfony/Bridge/PhpUnit/Legacy/SymfonyTestsListenerTrait.php -> src/Symfony/Bridge/PhpUnit/Legacy/SymfonyTestsListenerTrait.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "74:         }",
          "75:     }",
          "77:     public function __destruct()",
          "78:     {",
          "79:         if (0 < $this->state) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "77:     public function __sleep()",
          "78:     {",
          "79:         throw new \\BadMethodCallException('Cannot serialize '.__CLASS__);",
          "80:     }",
          "82:     public function __wakeup()",
          "83:     {",
          "84:         throw new \\BadMethodCallException('Cannot unserialize '.__CLASS__);",
          "85:     }",
          "",
          "---------------"
        ],
        "src/Symfony/Bundle/FrameworkBundle/Tests/Kernel/ConcreteMicroKernel.php||src/Symfony/Bundle/FrameworkBundle/Tests/Kernel/ConcreteMicroKernel.php": [
          "File: src/Symfony/Bundle/FrameworkBundle/Tests/Kernel/ConcreteMicroKernel.php -> src/Symfony/Bundle/FrameworkBundle/Tests/Kernel/ConcreteMicroKernel.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "64:         return $this->cacheDir;",
          "65:     }",
          "67:     public function __destruct()",
          "68:     {",
          "69:         $fs = new Filesystem();",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "67:     public function __sleep()",
          "68:     {",
          "69:         throw new \\BadMethodCallException('Cannot serialize '.__CLASS__);",
          "70:     }",
          "72:     public function __wakeup()",
          "73:     {",
          "74:         throw new \\BadMethodCallException('Cannot unserialize '.__CLASS__);",
          "75:     }",
          "",
          "---------------"
        ],
        "src/Symfony/Component/Cache/Traits/FilesystemCommonTrait.php||src/Symfony/Component/Cache/Traits/FilesystemCommonTrait.php": [
          "File: src/Symfony/Component/Cache/Traits/FilesystemCommonTrait.php -> src/Symfony/Component/Cache/Traits/FilesystemCommonTrait.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "116:         throw new \\ErrorException($message, 0, $type, $file, $line);",
          "117:     }",
          "119:     public function __destruct()",
          "120:     {",
          "121:         if (method_exists(parent::class, '__destruct')) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "119:     public function __sleep()",
          "120:     {",
          "121:         throw new \\BadMethodCallException('Cannot serialize '.__CLASS__);",
          "122:     }",
          "124:     public function __wakeup()",
          "125:     {",
          "126:         throw new \\BadMethodCallException('Cannot unserialize '.__CLASS__);",
          "127:     }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "63eda69c32da713ab7ff5521f20fdc113880094a",
      "candidate_info": {
        "commit_hash": "63eda69c32da713ab7ff5521f20fdc113880094a",
        "repo": "symfony/symfony",
        "commit_url": "https://github.com/symfony/symfony/commit/63eda69c32da713ab7ff5521f20fdc113880094a",
        "files": [
          "src/Symfony/Bridge/PhpUnit/SymfonyTestsListener.php"
        ],
        "message": "security #cve-2019-10912 [PHPUnit Bridge] Prevent destructors with side-effects from being unserialized (nicolas-grekas)\n\nThis PR was merged into the 2.8 branch.\n\nDiscussion\n----------\n\n[PHPUnit Bridge] Prevent destructors with side-effects from being unserialized\n\n| Q             | A\n| ------------- | ---\n| Branch?       | 2.8\n| Bug fix?      | yes\n| New feature?  | no\n| BC breaks?    | no\n| Deprecations? | no\n| Tests pass?   | yes\n| Fixed tickets | -\n| License       | MIT\n| Doc PR        | -\n\nCommits\n-------\n\n908b64d17e [2.8][PHPUnit Bridge] Prevent destructors with side-effects from being unserialized - CVE-2019-10912",
        "before_after_code_files": [
          "src/Symfony/Bridge/PhpUnit/SymfonyTestsListener.php||src/Symfony/Bridge/PhpUnit/SymfonyTestsListener.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_olp_changes": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/Symfony/Bridge/PhpUnit/SymfonyTestsListener.php||src/Symfony/Bridge/PhpUnit/SymfonyTestsListener.php": [
          "File: src/Symfony/Bridge/PhpUnit/SymfonyTestsListener.php -> src/Symfony/Bridge/PhpUnit/SymfonyTestsListener.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "61:         }",
          "62:     }",
          "64:     public function __destruct()",
          "65:     {",
          "66:         if (0 < $this->state) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "64:     public function __sleep()",
          "65:     {",
          "66:         throw new \\BadMethodCallException('Cannot serialize '.__CLASS__);",
          "67:     }",
          "69:     public function __wakeup()",
          "70:     {",
          "71:         throw new \\BadMethodCallException('Cannot unserialize '.__CLASS__);",
          "72:     }",
          "",
          "---------------"
        ]
      }
    }
  ]
}