{
  "cve_id": "CVE-2023-23931",
  "cve_desc": "cryptography is a package designed to expose cryptographic primitives and recipes to Python developers. In affected versions `Cipher.update_into` would accept Python objects which implement the buffer protocol, but provide only immutable buffers. This would allow immutable objects (such as `bytes`) to be mutated, thus violating fundamental rules of Python and resulting in corrupted output. This now correctly raises an exception. This issue has been present since `update_into` was originally introduced in cryptography 1.8.",
  "repo": "pyca/cryptography",
  "patch_hash": "d6951dca25de45abd52da51b608055371fbcde4e",
  "patch_info": {
    "commit_hash": "d6951dca25de45abd52da51b608055371fbcde4e",
    "repo": "pyca/cryptography",
    "commit_url": "https://github.com/pyca/cryptography/commit/d6951dca25de45abd52da51b608055371fbcde4e",
    "files": [
      "CHANGELOG.rst",
      "src/cryptography/__about__.py",
      "src/cryptography/hazmat/backends/openssl/ciphers.py",
      "tests/hazmat/primitives/test_ciphers.py",
      "vectors/cryptography_vectors/__about__.py"
    ],
    "message": "changelog + security fix backport (#8231)\n\n* Don't allow update_into to mutate immutable objects (#8230)\n\n* add changelog for 39.0.1\n\n* oops\n\n* bump versions\n\n* remove circle\n\n---------\n\nCo-authored-by: Alex Gaynor <alex.gaynor@gmail.com>",
    "before_after_code_files": [
      "src/cryptography/__about__.py||src/cryptography/__about__.py",
      "src/cryptography/hazmat/backends/openssl/ciphers.py||src/cryptography/hazmat/backends/openssl/ciphers.py",
      "tests/hazmat/primitives/test_ciphers.py||tests/hazmat/primitives/test_ciphers.py",
      "vectors/cryptography_vectors/__about__.py||vectors/cryptography_vectors/__about__.py"
    ]
  },
  "patch_diff": {
    "src/cryptography/__about__.py||src/cryptography/__about__.py": [
      "File: src/cryptography/__about__.py -> src/cryptography/__about__.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "9:     \"__copyright__\",",
      "10: ]",
      "14: __author__ = \"The Python Cryptographic Authority and individual contributors\"",
      "15: __copyright__ = \"Copyright 2013-2022 {}\".format(__author__)",
      "",
      "[Removed Lines]",
      "12: __version__ = \"39.0.0\"",
      "",
      "[Added Lines]",
      "12: __version__ = \"39.0.1\"",
      "",
      "---------------"
    ],
    "src/cryptography/hazmat/backends/openssl/ciphers.py||src/cryptography/hazmat/backends/openssl/ciphers.py": [
      "File: src/cryptography/hazmat/backends/openssl/ciphers.py -> src/cryptography/hazmat/backends/openssl/ciphers.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "156:         data_processed = 0",
      "157:         total_out = 0",
      "158:         outlen = self._backend._ffi.new(\"int *\")",
      "160:         baseinbuf = self._backend._ffi.from_buffer(data)",
      "162:         while data_processed != total_data_len:",
      "",
      "[Removed Lines]",
      "159:         baseoutbuf = self._backend._ffi.from_buffer(buf)",
      "",
      "[Added Lines]",
      "159:         baseoutbuf = self._backend._ffi.from_buffer(buf, require_writable=True)",
      "",
      "---------------"
    ],
    "tests/hazmat/primitives/test_ciphers.py||tests/hazmat/primitives/test_ciphers.py": [
      "File: tests/hazmat/primitives/test_ciphers.py -> tests/hazmat/primitives/test_ciphers.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "318:         with pytest.raises(ValueError):",
      "319:             encryptor.update_into(b\"testing\", buf)",
      "321:     @pytest.mark.supported(",
      "322:         only_if=lambda backend: backend.cipher_supported(",
      "323:             AES(b\"\\x00\" * 16), modes.GCM(b\"\\x00\" * 12)",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "321:     def test_update_into_immutable(self, backend):",
      "322:         key = b\"\\x00\" * 16",
      "323:         c = ciphers.Cipher(AES(key), modes.ECB(), backend)",
      "324:         encryptor = c.encryptor()",
      "325:         buf = b\"\\x00\" * 32",
      "326:         with pytest.raises((TypeError, BufferError)):",
      "327:             encryptor.update_into(b\"testing\", buf)",
      "",
      "---------------"
    ],
    "vectors/cryptography_vectors/__about__.py||vectors/cryptography_vectors/__about__.py": [
      "File: vectors/cryptography_vectors/__about__.py -> vectors/cryptography_vectors/__about__.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "6:     \"__version__\",",
      "7: ]",
      "",
      "[Removed Lines]",
      "9: __version__ = \"39.0.0\"",
      "",
      "[Added Lines]",
      "9: __version__ = \"39.0.1\"",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "338a65a7df74e189f6b5d1d3a6315ffa911b21c2",
      "candidate_info": {
        "commit_hash": "338a65a7df74e189f6b5d1d3a6315ffa911b21c2",
        "repo": "pyca/cryptography",
        "commit_url": "https://github.com/pyca/cryptography/commit/338a65a7df74e189f6b5d1d3a6315ffa911b21c2",
        "files": [
          "CHANGELOG.rst",
          "src/cryptography/__about__.py",
          "vectors/cryptography_vectors/__about__.py"
        ],
        "message": "39.0.0 version bump (#7954)",
        "before_after_code_files": [
          "src/cryptography/__about__.py||src/cryptography/__about__.py",
          "vectors/cryptography_vectors/__about__.py||vectors/cryptography_vectors/__about__.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/cryptography/__about__.py||src/cryptography/__about__.py",
            "vectors/cryptography_vectors/__about__.py||vectors/cryptography_vectors/__about__.py"
          ],
          "candidate": [
            "src/cryptography/__about__.py||src/cryptography/__about__.py",
            "vectors/cryptography_vectors/__about__.py||vectors/cryptography_vectors/__about__.py"
          ]
        }
      },
      "candidate_diff": {
        "src/cryptography/__about__.py||src/cryptography/__about__.py": [
          "File: src/cryptography/__about__.py -> src/cryptography/__about__.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "9:     \"__copyright__\",",
          "10: ]",
          "14: __author__ = \"The Python Cryptographic Authority and individual contributors\"",
          "15: __copyright__ = \"Copyright 2013-2022 {}\".format(__author__)",
          "",
          "[Removed Lines]",
          "12: __version__ = \"39.0.0.dev1\"",
          "",
          "[Added Lines]",
          "12: __version__ = \"39.0.0\"",
          "",
          "---------------"
        ],
        "vectors/cryptography_vectors/__about__.py||vectors/cryptography_vectors/__about__.py": [
          "File: vectors/cryptography_vectors/__about__.py -> vectors/cryptography_vectors/__about__.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "6:     \"__version__\",",
          "7: ]",
          "",
          "[Removed Lines]",
          "9: __version__ = \"39.0.0.dev1\"",
          "",
          "[Added Lines]",
          "9: __version__ = \"39.0.0\"",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "e0f6f38433e3a1cb57509dec1bec9107cbbe827d",
      "candidate_info": {
        "commit_hash": "e0f6f38433e3a1cb57509dec1bec9107cbbe827d",
        "repo": "pyca/cryptography",
        "commit_url": "https://github.com/pyca/cryptography/commit/e0f6f38433e3a1cb57509dec1bec9107cbbe827d",
        "files": [
          "CHANGELOG.rst",
          "src/cryptography/__about__.py",
          "vectors/cryptography_vectors/__about__.py"
        ],
        "message": "version bump for 37 release (#7085)",
        "before_after_code_files": [
          "src/cryptography/__about__.py||src/cryptography/__about__.py",
          "vectors/cryptography_vectors/__about__.py||vectors/cryptography_vectors/__about__.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/cryptography/__about__.py||src/cryptography/__about__.py",
            "vectors/cryptography_vectors/__about__.py||vectors/cryptography_vectors/__about__.py"
          ],
          "candidate": [
            "src/cryptography/__about__.py||src/cryptography/__about__.py",
            "vectors/cryptography_vectors/__about__.py||vectors/cryptography_vectors/__about__.py"
          ]
        }
      },
      "candidate_diff": {
        "src/cryptography/__about__.py||src/cryptography/__about__.py": [
          "File: src/cryptography/__about__.py -> src/cryptography/__about__.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "9:     \"__copyright__\",",
          "10: ]",
          "14: __author__ = \"The Python Cryptographic Authority and individual contributors\"",
          "15: __copyright__ = \"Copyright 2013-2021 {}\".format(__author__)",
          "",
          "[Removed Lines]",
          "12: __version__ = \"37.0.0.dev1\"",
          "",
          "[Added Lines]",
          "12: __version__ = \"37.0.0\"",
          "",
          "---------------"
        ],
        "vectors/cryptography_vectors/__about__.py||vectors/cryptography_vectors/__about__.py": [
          "File: vectors/cryptography_vectors/__about__.py -> vectors/cryptography_vectors/__about__.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "6:     \"__version__\",",
          "7: ]",
          "",
          "[Removed Lines]",
          "9: __version__ = \"37.0.0.dev1\"",
          "",
          "[Added Lines]",
          "9: __version__ = \"37.0.0\"",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "88ecfa305e437163c18669a221551e614fcda1f0",
      "candidate_info": {
        "commit_hash": "88ecfa305e437163c18669a221551e614fcda1f0",
        "repo": "pyca/cryptography",
        "commit_url": "https://github.com/pyca/cryptography/commit/88ecfa305e437163c18669a221551e614fcda1f0",
        "files": [
          "CHANGELOG.rst",
          "src/cryptography/__about__.py",
          "vectors/cryptography_vectors/__about__.py"
        ],
        "message": "reopen for 38 development (#7118)",
        "before_after_code_files": [
          "src/cryptography/__about__.py||src/cryptography/__about__.py",
          "vectors/cryptography_vectors/__about__.py||vectors/cryptography_vectors/__about__.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/cryptography/__about__.py||src/cryptography/__about__.py",
            "vectors/cryptography_vectors/__about__.py||vectors/cryptography_vectors/__about__.py"
          ],
          "candidate": [
            "src/cryptography/__about__.py||src/cryptography/__about__.py",
            "vectors/cryptography_vectors/__about__.py||vectors/cryptography_vectors/__about__.py"
          ]
        }
      },
      "candidate_diff": {
        "src/cryptography/__about__.py||src/cryptography/__about__.py": [
          "File: src/cryptography/__about__.py -> src/cryptography/__about__.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "9:     \"__copyright__\",",
          "10: ]",
          "14: __author__ = \"The Python Cryptographic Authority and individual contributors\"",
          "15: __copyright__ = \"Copyright 2013-2021 {}\".format(__author__)",
          "",
          "[Removed Lines]",
          "12: __version__ = \"37.0.0\"",
          "",
          "[Added Lines]",
          "12: __version__ = \"38.0.0.dev1\"",
          "",
          "---------------"
        ],
        "vectors/cryptography_vectors/__about__.py||vectors/cryptography_vectors/__about__.py": [
          "File: vectors/cryptography_vectors/__about__.py -> vectors/cryptography_vectors/__about__.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "6:     \"__version__\",",
          "7: ]",
          "",
          "[Removed Lines]",
          "9: __version__ = \"37.0.0\"",
          "",
          "[Added Lines]",
          "9: __version__ = \"38.0.0.dev1\"",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "52d6f1a491f6ade379ace124b843ffba9fb4ab4f",
      "candidate_info": {
        "commit_hash": "52d6f1a491f6ade379ace124b843ffba9fb4ab4f",
        "repo": "pyca/cryptography",
        "commit_url": "https://github.com/pyca/cryptography/commit/52d6f1a491f6ade379ace124b843ffba9fb4ab4f",
        "files": [
          "CHANGELOG.rst",
          "src/cryptography/__about__.py",
          "vectors/cryptography_vectors/__about__.py"
        ],
        "message": "version bump for 38 release (#7567)",
        "before_after_code_files": [
          "src/cryptography/__about__.py||src/cryptography/__about__.py",
          "vectors/cryptography_vectors/__about__.py||vectors/cryptography_vectors/__about__.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/cryptography/__about__.py||src/cryptography/__about__.py",
            "vectors/cryptography_vectors/__about__.py||vectors/cryptography_vectors/__about__.py"
          ],
          "candidate": [
            "src/cryptography/__about__.py||src/cryptography/__about__.py",
            "vectors/cryptography_vectors/__about__.py||vectors/cryptography_vectors/__about__.py"
          ]
        }
      },
      "candidate_diff": {
        "src/cryptography/__about__.py||src/cryptography/__about__.py": [
          "File: src/cryptography/__about__.py -> src/cryptography/__about__.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "9:     \"__copyright__\",",
          "10: ]",
          "14: __author__ = \"The Python Cryptographic Authority and individual contributors\"",
          "15: __copyright__ = \"Copyright 2013-2022 {}\".format(__author__)",
          "",
          "[Removed Lines]",
          "12: __version__ = \"38.0.0.dev1\"",
          "",
          "[Added Lines]",
          "12: __version__ = \"38.0.0\"",
          "",
          "---------------"
        ],
        "vectors/cryptography_vectors/__about__.py||vectors/cryptography_vectors/__about__.py": [
          "File: vectors/cryptography_vectors/__about__.py -> vectors/cryptography_vectors/__about__.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "6:     \"__version__\",",
          "7: ]",
          "",
          "[Removed Lines]",
          "9: __version__ = \"38.0.0.dev1\"",
          "",
          "[Added Lines]",
          "9: __version__ = \"38.0.0\"",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "33c75539ff3f834f72ba9703b64df6d4888c2abc",
      "candidate_info": {
        "commit_hash": "33c75539ff3f834f72ba9703b64df6d4888c2abc",
        "repo": "pyca/cryptography",
        "commit_url": "https://github.com/pyca/cryptography/commit/33c75539ff3f834f72ba9703b64df6d4888c2abc",
        "files": [
          "CHANGELOG.rst",
          "src/cryptography/__about__.py",
          "vectors/cryptography_vectors/__about__.py"
        ],
        "message": "reopen main for 39 dev (#7568)",
        "before_after_code_files": [
          "src/cryptography/__about__.py||src/cryptography/__about__.py",
          "vectors/cryptography_vectors/__about__.py||vectors/cryptography_vectors/__about__.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/cryptography/__about__.py||src/cryptography/__about__.py",
            "vectors/cryptography_vectors/__about__.py||vectors/cryptography_vectors/__about__.py"
          ],
          "candidate": [
            "src/cryptography/__about__.py||src/cryptography/__about__.py",
            "vectors/cryptography_vectors/__about__.py||vectors/cryptography_vectors/__about__.py"
          ]
        }
      },
      "candidate_diff": {
        "src/cryptography/__about__.py||src/cryptography/__about__.py": [
          "File: src/cryptography/__about__.py -> src/cryptography/__about__.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "9:     \"__copyright__\",",
          "10: ]",
          "14: __author__ = \"The Python Cryptographic Authority and individual contributors\"",
          "15: __copyright__ = \"Copyright 2013-2022 {}\".format(__author__)",
          "",
          "[Removed Lines]",
          "12: __version__ = \"38.0.0\"",
          "",
          "[Added Lines]",
          "12: __version__ = \"39.0.0.dev1\"",
          "",
          "---------------"
        ],
        "vectors/cryptography_vectors/__about__.py||vectors/cryptography_vectors/__about__.py": [
          "File: vectors/cryptography_vectors/__about__.py -> vectors/cryptography_vectors/__about__.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "6:     \"__version__\",",
          "7: ]",
          "",
          "[Removed Lines]",
          "9: __version__ = \"38.0.0\"",
          "",
          "[Added Lines]",
          "9: __version__ = \"39.0.0.dev1\"",
          "",
          "---------------"
        ]
      }
    }
  ]
}