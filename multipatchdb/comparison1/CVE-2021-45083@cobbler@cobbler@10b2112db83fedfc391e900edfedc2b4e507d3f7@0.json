{
  "cve_id": "CVE-2021-45083",
  "cve_desc": "An issue was discovered in Cobbler before 3.3.1. Files in /etc/cobbler are world readable. Two of those files contain some sensitive information that can be exposed to a local user who has non-privileged access to the server. The users.digest file contains the sha2-512 digest of users in a Cobbler local installation. In the case of an easy-to-guess password, it's trivial to obtain the plaintext string. The settings.yaml file contains secrets such as the hashed default password.",
  "repo": "cobbler/cobbler",
  "patch_hash": "10b2112db83fedfc391e900edfedc2b4e507d3f7",
  "patch_info": {
    "commit_hash": "10b2112db83fedfc391e900edfedc2b4e507d3f7",
    "repo": "cobbler/cobbler",
    "commit_url": "https://github.com/cobbler/cobbler/commit/10b2112db83fedfc391e900edfedc2b4e507d3f7",
    "files": [
      "cobbler.spec",
      "cobbler/templar.py"
    ],
    "message": "Merge pull request #2945 from agraul/cve-patches-2022-02-16\n\nFix CVE-2021-45082 and CVE-2021-45083",
    "before_after_code_files": [
      "cobbler.spec||cobbler.spec",
      "cobbler/templar.py||cobbler/templar.py"
    ]
  },
  "patch_diff": {
    "cobbler.spec||cobbler.spec": [
      "File: cobbler.spec -> cobbler.spec",
      "--- Hunk 1 ---",
      "[Context before]",
      "361: %else",
      "362: %post",
      "363: %systemd_post cobblerd.service",
      "365: %preun",
      "366: %systemd_preun cobblerd.service",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "364: # Fixup permission for world readable settings files",
      "365: chmod 640 %{_sysconfdir}/cobbler/settings.yaml",
      "366: chmod 600 %{_sysconfdir}/cobbler/mongodb.conf",
      "367: chmod 600 %{_sysconfdir}/cobbler/modules.conf",
      "368: chmod 640 %{_sysconfdir}/cobbler/users.conf",
      "369: chmod 640 %{_sysconfdir}/cobbler/users.digest",
      "370: chmod 750 %{_sysconfdir}/cobbler/settings.d",
      "371: chmod 640 %{_sysconfdir}/cobbler/settings.d/*",
      "372: chgrp %{apache_group} %{_sysconfdir}/cobbler/settings",
      "373: chgrp %{apache_group} %{_sysconfdir}/cobbler/users.conf",
      "374: chgrp %{apache_group} %{_sysconfdir}/cobbler/users.digest",
      "375: chgrp %{apache_group} %{_sysconfdir}/cobbler/settings.d",
      "376: chgrp %{apache_group} %{_sysconfdir}/cobbler/settings.d/*",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "395: %dir %{_sysconfdir}/cobbler/iso",
      "396: %config(noreplace) %{_sysconfdir}/cobbler/iso/buildiso.template",
      "397: %config(noreplace) %{_sysconfdir}/cobbler/logging_config.conf",
      "400: %config(noreplace) %{_sysconfdir}/cobbler/named.template",
      "401: %config(noreplace) %{_sysconfdir}/cobbler/ndjbdns.template",
      "402: %dir %{_sysconfdir}/cobbler/reporting",
      "",
      "[Removed Lines]",
      "398: %config(noreplace) %{_sysconfdir}/cobbler/modules.conf",
      "399: %config(noreplace) %{_sysconfdir}/cobbler/mongodb.conf",
      "",
      "[Added Lines]",
      "412: %attr(600, root, root) %config(noreplace) %{_sysconfdir}/cobbler/modules.conf",
      "413: %attr(600, root, root) %config(noreplace) %{_sysconfdir}/cobbler/mongodb.conf",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "404: %config(noreplace) %{_sysconfdir}/cobbler/rsync.exclude",
      "405: %config(noreplace) %{_sysconfdir}/cobbler/rsync.template",
      "406: %config(noreplace) %{_sysconfdir}/cobbler/secondary.template",
      "415: %config(noreplace) %{_sysconfdir}/cobbler/version",
      "416: %config(noreplace) %{_sysconfdir}/cobbler/zone.template",
      "417: %dir %{_sysconfdir}/cobbler/zone_templates",
      "",
      "[Removed Lines]",
      "407: %config(noreplace) %{_sysconfdir}/cobbler/settings.yaml",
      "408: %dir %{_sysconfdir}/cobbler/settings.d",
      "409: %config(noreplace) %{_sysconfdir}/cobbler/settings.d/bind_manage_ipmi.settings",
      "410: %config(noreplace) %{_sysconfdir}/cobbler/settings.d/manage_genders.settings",
      "411: %config(noreplace) %{_sysconfdir}/cobbler/settings.d/nsupdate.settings",
      "412: %config(noreplace) %{_sysconfdir}/cobbler/settings.d/windows.settings",
      "413: %config(noreplace) %{_sysconfdir}/cobbler/users.conf",
      "414: %config(noreplace) %{_sysconfdir}/cobbler/users.digest",
      "",
      "[Added Lines]",
      "421: %attr(640, root, %{apache_group}) %config(noreplace) %{_sysconfdir}/cobbler/settings.yaml",
      "422: %attr(750, root, %{apache_group}) %dir %{_sysconfdir}/cobbler/settings.d",
      "423: %attr(640, root, %{apache_group}) %config(noreplace) %{_sysconfdir}/cobbler/settings.d/bind_manage_ipmi.settings",
      "424: %attr(640, root, %{apache_group}) %config(noreplace) %{_sysconfdir}/cobbler/settings.d/manage_genders.settings",
      "425: %attr(640, root, %{apache_group}) %config(noreplace) %{_sysconfdir}/cobbler/settings.d/nsupdate.settings",
      "426: %attr(640, root, %{apache_group}) %config(noreplace) %{_sysconfdir}/cobbler/settings.d/windows.settings",
      "427: %attr(640, root, %{apache_group}) %config(noreplace) %{_sysconfdir}/cobbler/users.conf",
      "428: %attr(640, root, %{apache_group}) %config(noreplace) %{_sysconfdir}/cobbler/users.digest",
      "",
      "---------------"
    ],
    "cobbler/templar.py||cobbler/templar.py": [
      "File: cobbler/templar.py -> cobbler/templar.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "75:         \"\"\"",
      "76:         lines = data.split(\"\\n\")",
      "77:         for line in lines:",
      "80:                 if self.settings and rest not in self.settings.cheetah_import_whitelist:",
      "83:     def render(self, data_input: Union[TextIO, str], search_table: dict, out_path: Optional[str],",
      "84:                template_type=\"default\") -> str:",
      "",
      "[Removed Lines]",
      "78:             if line.find(\"#import\") != -1:",
      "79:                 rest = line.replace(\"#import\", \"\").replace(\" \", \"\").strip()",
      "81:                     raise CX(\"potentially insecure import in template: %s\" % rest)",
      "",
      "[Added Lines]",
      "78:             if \"#import\" in line or \"#from\" in line:",
      "79:                 rest = line.replace(\"#import\", \"\").replace(\"#from\", \"\").replace(\"import\", \".\").replace(\" \", \"\").strip()",
      "81:                     raise CX(f\"Potentially insecure import in template: {rest}\")",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "c9a094541d81ce6d753f03888d763ff28b9ada72",
      "candidate_info": {
        "commit_hash": "c9a094541d81ce6d753f03888d763ff28b9ada72",
        "repo": "cobbler/cobbler",
        "commit_url": "https://github.com/cobbler/cobbler/commit/c9a094541d81ce6d753f03888d763ff28b9ada72",
        "files": [
          "cobbler/templar.py"
        ],
        "message": "Security: Fix incomplete template sanitization\n\nThis only affects Cheetah templating.\n\nWithout this commit, it is possible to evade the\n\"cheetah_import_whitelist\" and import arbitraty Python code.\n\nExample exploit: #from exploit import pwned\n\nCVE-ID: CVE-2021-45082",
        "before_after_code_files": [
          "cobbler/templar.py||cobbler/templar.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/cobbler/cobbler/pull/2945"
        ],
        "olp_code_files": {
          "patch": [
            "cobbler/templar.py||cobbler/templar.py"
          ],
          "candidate": [
            "cobbler/templar.py||cobbler/templar.py"
          ]
        }
      },
      "candidate_diff": {
        "cobbler/templar.py||cobbler/templar.py": [
          "File: cobbler/templar.py -> cobbler/templar.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "75:         \"\"\"",
          "76:         lines = data.split(\"\\n\")",
          "77:         for line in lines:",
          "80:                 if self.settings and rest not in self.settings.cheetah_import_whitelist:",
          "83:     def render(self, data_input: Union[TextIO, str], search_table: dict, out_path: Optional[str],",
          "84:                template_type=\"default\") -> str:",
          "",
          "[Removed Lines]",
          "78:             if line.find(\"#import\") != -1:",
          "79:                 rest = line.replace(\"#import\", \"\").replace(\" \", \"\").strip()",
          "81:                     raise CX(\"potentially insecure import in template: %s\" % rest)",
          "",
          "[Added Lines]",
          "78:             if \"#import\" in line or \"#from\" in line:",
          "79:                 rest = line.replace(\"#import\", \"\").replace(\"#from\", \"\").replace(\"import\", \".\").replace(\" \", \"\").strip()",
          "81:                     raise CX(f\"Potentially insecure import in template: {rest}\")",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "34e3417bcbb72d28c3c1c3332af85793ba077f75",
      "candidate_info": {
        "commit_hash": "34e3417bcbb72d28c3c1c3332af85793ba077f75",
        "repo": "cobbler/cobbler",
        "commit_url": "https://github.com/cobbler/cobbler/commit/34e3417bcbb72d28c3c1c3332af85793ba077f75",
        "files": [
          "cobbler.spec"
        ],
        "message": "Security: Restrict config file accessibility\n\nOnly root and apache (needed for serving the API) should be able to read\nsensitive configuration files.\n\nCVE-ID: CVE-2021-45083",
        "before_after_code_files": [
          "cobbler.spec||cobbler.spec"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/cobbler/cobbler/pull/2945"
        ],
        "olp_code_files": {
          "patch": [
            "cobbler.spec||cobbler.spec"
          ],
          "candidate": [
            "cobbler.spec||cobbler.spec"
          ]
        }
      },
      "candidate_diff": {
        "cobbler.spec||cobbler.spec": [
          "File: cobbler.spec -> cobbler.spec",
          "--- Hunk 1 ---",
          "[Context before]",
          "361: %else",
          "362: %post",
          "363: %systemd_post cobblerd.service",
          "365: %preun",
          "366: %systemd_preun cobblerd.service",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "364: # Fixup permission for world readable settings files",
          "365: chmod 640 %{_sysconfdir}/cobbler/settings.yaml",
          "366: chmod 600 %{_sysconfdir}/cobbler/mongodb.conf",
          "367: chmod 600 %{_sysconfdir}/cobbler/modules.conf",
          "368: chmod 640 %{_sysconfdir}/cobbler/users.conf",
          "369: chmod 640 %{_sysconfdir}/cobbler/users.digest",
          "370: chmod 750 %{_sysconfdir}/cobbler/settings.d",
          "371: chmod 640 %{_sysconfdir}/cobbler/settings.d/*",
          "372: chgrp %{apache_group} %{_sysconfdir}/cobbler/settings",
          "373: chgrp %{apache_group} %{_sysconfdir}/cobbler/users.conf",
          "374: chgrp %{apache_group} %{_sysconfdir}/cobbler/users.digest",
          "375: chgrp %{apache_group} %{_sysconfdir}/cobbler/settings.d",
          "376: chgrp %{apache_group} %{_sysconfdir}/cobbler/settings.d/*",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "395: %dir %{_sysconfdir}/cobbler/iso",
          "396: %config(noreplace) %{_sysconfdir}/cobbler/iso/buildiso.template",
          "397: %config(noreplace) %{_sysconfdir}/cobbler/logging_config.conf",
          "400: %config(noreplace) %{_sysconfdir}/cobbler/named.template",
          "401: %config(noreplace) %{_sysconfdir}/cobbler/ndjbdns.template",
          "402: %dir %{_sysconfdir}/cobbler/reporting",
          "",
          "[Removed Lines]",
          "398: %config(noreplace) %{_sysconfdir}/cobbler/modules.conf",
          "399: %config(noreplace) %{_sysconfdir}/cobbler/mongodb.conf",
          "",
          "[Added Lines]",
          "412: %attr(600, root, root) %config(noreplace) %{_sysconfdir}/cobbler/modules.conf",
          "413: %attr(600, root, root) %config(noreplace) %{_sysconfdir}/cobbler/mongodb.conf",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "404: %config(noreplace) %{_sysconfdir}/cobbler/rsync.exclude",
          "405: %config(noreplace) %{_sysconfdir}/cobbler/rsync.template",
          "406: %config(noreplace) %{_sysconfdir}/cobbler/secondary.template",
          "415: %config(noreplace) %{_sysconfdir}/cobbler/version",
          "416: %config(noreplace) %{_sysconfdir}/cobbler/zone.template",
          "417: %dir %{_sysconfdir}/cobbler/zone_templates",
          "",
          "[Removed Lines]",
          "407: %config(noreplace) %{_sysconfdir}/cobbler/settings.yaml",
          "408: %dir %{_sysconfdir}/cobbler/settings.d",
          "409: %config(noreplace) %{_sysconfdir}/cobbler/settings.d/bind_manage_ipmi.settings",
          "410: %config(noreplace) %{_sysconfdir}/cobbler/settings.d/manage_genders.settings",
          "411: %config(noreplace) %{_sysconfdir}/cobbler/settings.d/nsupdate.settings",
          "412: %config(noreplace) %{_sysconfdir}/cobbler/settings.d/windows.settings",
          "413: %config(noreplace) %{_sysconfdir}/cobbler/users.conf",
          "414: %config(noreplace) %{_sysconfdir}/cobbler/users.digest",
          "",
          "[Added Lines]",
          "421: %attr(640, root, %{apache_group}) %config(noreplace) %{_sysconfdir}/cobbler/settings.yaml",
          "422: %attr(750, root, %{apache_group}) %dir %{_sysconfdir}/cobbler/settings.d",
          "423: %attr(640, root, %{apache_group}) %config(noreplace) %{_sysconfdir}/cobbler/settings.d/bind_manage_ipmi.settings",
          "424: %attr(640, root, %{apache_group}) %config(noreplace) %{_sysconfdir}/cobbler/settings.d/manage_genders.settings",
          "425: %attr(640, root, %{apache_group}) %config(noreplace) %{_sysconfdir}/cobbler/settings.d/nsupdate.settings",
          "426: %attr(640, root, %{apache_group}) %config(noreplace) %{_sysconfdir}/cobbler/settings.d/windows.settings",
          "427: %attr(640, root, %{apache_group}) %config(noreplace) %{_sysconfdir}/cobbler/users.conf",
          "428: %attr(640, root, %{apache_group}) %config(noreplace) %{_sysconfdir}/cobbler/users.digest",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "10c12127317dd7b95a7ca4cd650a493c676f6bad",
      "candidate_info": {
        "commit_hash": "10c12127317dd7b95a7ca4cd650a493c676f6bad",
        "repo": "cobbler/cobbler",
        "commit_url": "https://github.com/cobbler/cobbler/commit/10c12127317dd7b95a7ca4cd650a493c676f6bad",
        "files": [
          "cobbler/templar.py"
        ],
        "message": "Security: Fix incomplete template sanitization\n\nThis only affects Cheetah templating.\n\nWithout this commit, it is possible to evade the\n\"cheetah_import_whitelist\" and import arbitraty Python code.\n\nExample exploit: #from exploit import pwned\n\nCVE-ID: CVE-2021-45082",
        "before_after_code_files": [
          "cobbler/templar.py||cobbler/templar.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_olp_changes": 1,
        "olp_code_files": {
          "patch": [
            "cobbler/templar.py||cobbler/templar.py"
          ],
          "candidate": [
            "cobbler/templar.py||cobbler/templar.py"
          ]
        }
      },
      "candidate_diff": {
        "cobbler/templar.py||cobbler/templar.py": [
          "File: cobbler/templar.py -> cobbler/templar.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "77:         \"\"\"",
          "78:         lines = data.split(\"\\n\")",
          "79:         for line in lines:",
          "82:                 if self.settings and rest not in self.settings.cheetah_import_whitelist:",
          "85:     def render(self, data_input: Union[TextIO, str], search_table: dict, out_path: Optional[str],",
          "86:                template_type=\"default\") -> str:",
          "",
          "[Removed Lines]",
          "80:             if line.find(\"#import\") != -1:",
          "81:                 rest = line.replace(\"#import\", \"\").replace(\" \", \"\").strip()",
          "83:                     raise CX(\"potentially insecure import in template: %s\" % rest)",
          "",
          "[Added Lines]",
          "80:             if \"#import\" in line or \"#from\" in line:",
          "81:                 rest = line.replace(\"#import\", \"\").replace(\"#from\", \"\").replace(\"import\", \".\").replace(\" \", \"\").strip()",
          "83:                     raise CX(f\"Potentially insecure import in template: {rest}\")",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "141080114b23790d6ba3ce49d1f9bb144f44405f",
      "candidate_info": {
        "commit_hash": "141080114b23790d6ba3ce49d1f9bb144f44405f",
        "repo": "cobbler/cobbler",
        "commit_url": "https://github.com/cobbler/cobbler/commit/141080114b23790d6ba3ce49d1f9bb144f44405f",
        "files": [
          "cobbler.spec"
        ],
        "message": "Security: Restrict config file accessibility\n\nOnly root and apache (needed for serving the API) should be able to read\nsensitive configuration files.\n\nCVE-ID: CVE-2021-45083",
        "before_after_code_files": [
          "cobbler.spec||cobbler.spec"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_olp_changes": 1,
        "olp_code_files": {
          "patch": [
            "cobbler.spec||cobbler.spec"
          ],
          "candidate": [
            "cobbler.spec||cobbler.spec"
          ]
        }
      },
      "candidate_diff": {
        "cobbler.spec||cobbler.spec": [
          "File: cobbler.spec -> cobbler.spec",
          "--- Hunk 1 ---",
          "[Context before]",
          "382: %{_datadir}/%{name}/bin/mkgrub.sh >/dev/null 2>&1",
          "383: %endif",
          "384: %systemd_post cobblerd.service",
          "386: %preun",
          "387: %systemd_preun cobblerd.service",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "385: # Fixup permission for world readable settings files",
          "386: chmod 640 %{_sysconfdir}/cobbler/settings.yaml",
          "387: chmod 600 %{_sysconfdir}/cobbler/mongodb.conf",
          "388: chmod 600 %{_sysconfdir}/cobbler/modules.conf",
          "389: chmod 640 %{_sysconfdir}/cobbler/users.conf",
          "390: chmod 640 %{_sysconfdir}/cobbler/users.digest",
          "391: chmod 750 %{_sysconfdir}/cobbler/settings.d",
          "392: chmod 640 %{_sysconfdir}/cobbler/settings.d/*",
          "393: chgrp %{apache_group} %{_sysconfdir}/cobbler/settings",
          "394: chgrp %{apache_group} %{_sysconfdir}/cobbler/users.conf",
          "395: chgrp %{apache_group} %{_sysconfdir}/cobbler/users.digest",
          "396: chgrp %{apache_group} %{_sysconfdir}/cobbler/settings.d",
          "397: chgrp %{apache_group} %{_sysconfdir}/cobbler/settings.d/*",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "461: %dir %{_sysconfdir}/cobbler/iso",
          "462: %config(noreplace) %{_sysconfdir}/cobbler/iso/buildiso.template",
          "463: %config(noreplace) %{_sysconfdir}/cobbler/logging_config.conf",
          "466: %config(noreplace) %{_sysconfdir}/cobbler/named.template",
          "467: %config(noreplace) %{_sysconfdir}/cobbler/ndjbdns.template",
          "468: %dir %{_sysconfdir}/cobbler/reporting",
          "",
          "[Removed Lines]",
          "464: %config(noreplace) %{_sysconfdir}/cobbler/modules.conf",
          "465: %config(noreplace) %{_sysconfdir}/cobbler/mongodb.conf",
          "",
          "[Added Lines]",
          "478: %attr(600, root, root) %config(noreplace) %{_sysconfdir}/cobbler/modules.conf",
          "479: %attr(600, root, root) %config(noreplace) %{_sysconfdir}/cobbler/mongodb.conf",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "470: %config(noreplace) %{_sysconfdir}/cobbler/rsync.exclude",
          "471: %config(noreplace) %{_sysconfdir}/cobbler/rsync.template",
          "472: %config(noreplace) %{_sysconfdir}/cobbler/secondary.template",
          "480: %config(noreplace) %{_sysconfdir}/cobbler/version",
          "481: %config(noreplace) %{_sysconfdir}/cobbler/zone.template",
          "482: %dir %{_sysconfdir}/cobbler/zone_templates",
          "",
          "[Removed Lines]",
          "473: %config(noreplace) %{_sysconfdir}/cobbler/settings.yaml",
          "474: %dir %{_sysconfdir}/cobbler/settings.d",
          "475: %config(noreplace) %{_sysconfdir}/cobbler/settings.d/bind_manage_ipmi.settings",
          "476: %config(noreplace) %{_sysconfdir}/cobbler/settings.d/manage_genders.settings",
          "477: %config(noreplace) %{_sysconfdir}/cobbler/settings.d/nsupdate.settings",
          "478: %config(noreplace) %{_sysconfdir}/cobbler/users.conf",
          "479: %config(noreplace) %{_sysconfdir}/cobbler/users.digest",
          "",
          "[Added Lines]",
          "487: %attr(640, root, %{apache_group}) %config(noreplace) %{_sysconfdir}/cobbler/settings.yaml",
          "488: %attr(750, root, %{apache_group}) %dir %{_sysconfdir}/cobbler/settings.d",
          "489: %attr(640, root, %{apache_group}) %config(noreplace) %{_sysconfdir}/cobbler/settings.d/bind_manage_ipmi.settings",
          "490: %attr(640, root, %{apache_group}) %config(noreplace) %{_sysconfdir}/cobbler/settings.d/manage_genders.settings",
          "491: %attr(640, root, %{apache_group}) %config(noreplace) %{_sysconfdir}/cobbler/settings.d/nsupdate.settings",
          "492: %attr(640, root, %{apache_group}) %config(noreplace) %{_sysconfdir}/cobbler/users.conf",
          "493: %attr(640, root, %{apache_group}) %config(noreplace) %{_sysconfdir}/cobbler/users.digest",
          "",
          "---------------"
        ]
      }
    }
  ]
}