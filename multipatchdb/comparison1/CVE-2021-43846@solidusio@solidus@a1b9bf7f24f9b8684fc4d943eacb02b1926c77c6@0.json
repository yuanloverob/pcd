{
  "cve_id": "CVE-2021-43846",
  "cve_desc": "`solidus_frontend` is the cart and storefront for the Solidus e-commerce project. Versions of `solidus_frontend` prior to 3.1.5, 3.0.5, and 2.11.14 contain a cross-site request forgery (CSRF) vulnerability that allows a malicious site to add an item to the user's cart without their knowledge. Versions 3.1.5, 3.0.5, and 2.11.14 contain a patch for this issue. The patch adds CSRF token verification to the \"Add to cart\" action. Adding forgery protection to a form that missed it can have some side effects. Other CSRF protection strategies as well as a workaround involving modifcation to config/application.rb` are available. More details on these mitigations are available in the GitHub Security Advisory.",
  "repo": "solidusio/solidus",
  "patch_hash": "a1b9bf7f24f9b8684fc4d943eacb02b1926c77c6",
  "patch_info": {
    "commit_hash": "a1b9bf7f24f9b8684fc4d943eacb02b1926c77c6",
    "repo": "solidusio/solidus",
    "commit_url": "https://github.com/solidusio/solidus/commit/a1b9bf7f24f9b8684fc4d943eacb02b1926c77c6",
    "files": [
      "frontend/app/controllers/spree/orders_controller.rb",
      "backend/app/controllers/spree/admin/tax_rates_controller.rb",
      "backend/app/views/spree/admin/tax_rates/index.html.erb",
      "backend/spec/features/admin/configuration/tax_rates_spec.rb",
      "backend/vendor/assets/javascripts/solidus_admin/select2_locales/select2_locale_en-CA.js",
      "core/app/models/spree/tax_rate.rb",
      "core/lib/spree/event/adapters/default.rb",
      "core/lib/spree/event/adapters/deprecation_handler.rb",
      "core/lib/spree/event/listener.rb",
      "core/lib/spree/event/subscriber.rb",
      "core/lib/spree/event/subscriber_registry.rb",
      "core/lib/spree/event/test_interface.rb",
      "core/spec/lib/spree/event/adapters/default_spec.rb",
      "core/spec/lib/spree/event/listener_spec.rb",
      "core/spec/lib/spree/event/subscriber_registry_spec.rb",
      "core/spec/lib/spree/event/subscriber_spec.rb",
      "core/spec/lib/spree/event/test_interface_spec.rb"
    ],
    "message": "Merge pull request from GHSA-h3fg-h5v3-vf8m\n\nProtect `Spree::OrdersController#populate` against CSRF attacks",
    "before_after_code_files": [
      "frontend/app/controllers/spree/orders_controller.rb||frontend/app/controllers/spree/orders_controller.rb"
    ]
  },
  "patch_diff": {
    "frontend/app/controllers/spree/orders_controller.rb||frontend/app/controllers/spree/orders_controller.rb": [
      "File: frontend/app/controllers/spree/orders_controller.rb -> frontend/app/controllers/spree/orders_controller.rb",
      "--- Hunk 1 ---",
      "[Context before]",
      "10:     before_action :assign_order, only: :update",
      "11:     # note: do not lock the #edit action because that's where we redirect when we fail to acquire a lock",
      "12:     around_action :lock_order, only: :update",
      "15:     def show",
      "16:       @order = Spree::Order.find_by!(number: params[:id])",
      "",
      "[Removed Lines]",
      "13:     skip_before_action :verify_authenticity_token, only: [:populate]",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "d7f0d6862e8c8578f1600b13bd7b1697013e4bf8",
      "candidate_info": {
        "commit_hash": "d7f0d6862e8c8578f1600b13bd7b1697013e4bf8",
        "repo": "solidusio/solidus",
        "commit_url": "https://github.com/solidusio/solidus/commit/d7f0d6862e8c8578f1600b13bd7b1697013e4bf8",
        "files": [
          "frontend/app/controllers/spree/orders_controller.rb"
        ],
        "message": "Merge pull request from GHSA-h3fg-h5v3-vf8m\n\nProtect `Spree::OrdersController#populate` against CSRF attacks",
        "before_after_code_files": [
          "frontend/app/controllers/spree/orders_controller.rb||frontend/app/controllers/spree/orders_controller.rb"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "frontend/app/controllers/spree/orders_controller.rb||frontend/app/controllers/spree/orders_controller.rb"
          ],
          "candidate": [
            "frontend/app/controllers/spree/orders_controller.rb||frontend/app/controllers/spree/orders_controller.rb"
          ]
        }
      },
      "candidate_diff": {
        "frontend/app/controllers/spree/orders_controller.rb||frontend/app/controllers/spree/orders_controller.rb": [
          "File: frontend/app/controllers/spree/orders_controller.rb -> frontend/app/controllers/spree/orders_controller.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "10:     before_action :assign_order, only: :update",
          "11:     # note: do not lock the #edit action because that's where we redirect when we fail to acquire a lock",
          "12:     around_action :lock_order, only: :update",
          "15:     def show",
          "16:       @order = Spree::Order.find_by!(number: params[:id])",
          "",
          "[Removed Lines]",
          "13:     skip_before_action :verify_authenticity_token, only: [:populate]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "8331a3112e2f325a8c0800dbdcd05d8421132198",
      "candidate_info": {
        "commit_hash": "8331a3112e2f325a8c0800dbdcd05d8421132198",
        "repo": "solidusio/solidus",
        "commit_url": "https://github.com/solidusio/solidus/commit/8331a3112e2f325a8c0800dbdcd05d8421132198",
        "files": [
          "frontend/app/controllers/spree/orders_controller.rb"
        ],
        "message": "Merge pull request from GHSA-h3fg-h5v3-vf8m\n\nProtect `Spree::OrdersController#populate` against CSRF attacks",
        "before_after_code_files": [
          "frontend/app/controllers/spree/orders_controller.rb||frontend/app/controllers/spree/orders_controller.rb"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "frontend/app/controllers/spree/orders_controller.rb||frontend/app/controllers/spree/orders_controller.rb"
          ],
          "candidate": [
            "frontend/app/controllers/spree/orders_controller.rb||frontend/app/controllers/spree/orders_controller.rb"
          ]
        }
      },
      "candidate_diff": {
        "frontend/app/controllers/spree/orders_controller.rb||frontend/app/controllers/spree/orders_controller.rb": [
          "File: frontend/app/controllers/spree/orders_controller.rb -> frontend/app/controllers/spree/orders_controller.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "11:     # note: do not lock the #edit action because that's where we redirect when we fail to acquire a lock",
          "12:     around_action :lock_order, only: :update",
          "13:     before_action :apply_coupon_code, only: :update",
          "16:     def show",
          "17:       @order = Spree::Order.find_by!(number: params[:id])",
          "",
          "[Removed Lines]",
          "14:     skip_before_action :verify_authenticity_token, only: [:populate]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    }
  ]
}