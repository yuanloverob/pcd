{
  "cve_id": "CVE-2023-5217",
  "cve_desc": "Heap buffer overflow in vp8 encoding in libvpx in Google Chrome prior to 117.0.5938.132 and libvpx 1.13.1 allowed a remote attacker to potentially exploit heap corruption via a crafted HTML page. (Chromium security severity: High)",
  "repo": "webmproject/libvpx",
  "patch_hash": "3fbd1dca6a4d2dad332a2110d646e4ffef36d590",
  "patch_info": {
    "commit_hash": "3fbd1dca6a4d2dad332a2110d646e4ffef36d590",
    "repo": "webmproject/libvpx",
    "commit_url": "https://github.com/webmproject/libvpx/commit/3fbd1dca6a4d2dad332a2110d646e4ffef36d590",
    "files": [
      "test/encode_api_test.cc",
      "vp8/encoder/onyx_if.c"
    ],
    "message": "VP8: disallow thread count changes\n\nCurrently allocations are done at encoder creation time. Going from\nthreaded to non-threaded would cause a crash.\n\nBug: chromium:1486441\nChange-Id: Ie301c2a70847dff2f0daae408fbef1e4d42e73d4",
    "before_after_code_files": [
      "test/encode_api_test.cc||test/encode_api_test.cc",
      "vp8/encoder/onyx_if.c||vp8/encoder/onyx_if.c"
    ]
  },
  "patch_diff": {
    "test/encode_api_test.cc||test/encode_api_test.cc": [
      "File: test/encode_api_test.cc -> test/encode_api_test.cc",
      "--- Hunk 1 ---",
      "[Context before]",
      "371:   for (const auto *iface : kCodecIfaces) {",
      "372:     SCOPED_TRACE(vpx_codec_iface_name(iface));",
      "377:     for (int i = 0; i < (IsVP9(iface) ? 2 : 1); ++i) {",
      "378:       vpx_codec_enc_cfg_t cfg = {};",
      "379:       struct Encoder {",
      "",
      "[Removed Lines]",
      "373:     if (!IsVP9(iface)) {",
      "374:       GTEST_SKIP() << \"TODO(https://crbug.com/1486441) remove this condition \"",
      "375:                       \"after VP8 is fixed.\";",
      "376:     }",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ],
    "vp8/encoder/onyx_if.c||vp8/encoder/onyx_if.c": [
      "File: vp8/encoder/onyx_if.c -> vp8/encoder/onyx_if.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1447:   last_h = cpi->oxcf.Height;",
      "1448:   prev_number_of_layers = cpi->oxcf.number_of_layers;",
      "1450:   cpi->oxcf = *oxcf;",
      "1452:   switch (cpi->oxcf.Mode) {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1450:   if (cpi->initial_width) {",
      "1453:     oxcf->multi_threaded = cpi->oxcf.multi_threaded;",
      "1454:   }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "84543a71a240b04911458fe457a47244a8f7e211",
      "candidate_info": {
        "commit_hash": "84543a71a240b04911458fe457a47244a8f7e211",
        "repo": "webmproject/libvpx",
        "commit_url": "https://github.com/webmproject/libvpx/commit/84543a71a240b04911458fe457a47244a8f7e211",
        "files": [
          "test/encode_api_test.cc",
          "vp8/encoder/onyx_if.c"
        ],
        "message": "VP8: disallow thread count changes\n\nCurrently allocations are done at encoder creation time. Going from\nthreaded to non-threaded would cause a crash.\n\nBug: chromium:1486441\nChange-Id: Ie301c2a70847dff2f0daae408fbef1e4d42e73d4\n(cherry picked from commit 3fbd1dca6a4d2dad332a2110d646e4ffef36d590)",
        "before_after_code_files": [
          "test/encode_api_test.cc||test/encode_api_test.cc",
          "vp8/encoder/onyx_if.c||vp8/encoder/onyx_if.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "test/encode_api_test.cc||test/encode_api_test.cc",
            "vp8/encoder/onyx_if.c||vp8/encoder/onyx_if.c"
          ],
          "candidate": [
            "test/encode_api_test.cc||test/encode_api_test.cc",
            "vp8/encoder/onyx_if.c||vp8/encoder/onyx_if.c"
          ]
        }
      },
      "candidate_diff": {
        "test/encode_api_test.cc||test/encode_api_test.cc": [
          "File: test/encode_api_test.cc -> test/encode_api_test.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "367:   for (const auto *iface : kCodecIfaces) {",
          "368:     SCOPED_TRACE(vpx_codec_iface_name(iface));",
          "373:     for (int i = 0; i < (IsVP9(iface) ? 2 : 1); ++i) {",
          "374:       vpx_codec_enc_cfg_t cfg = {};",
          "375:       struct Encoder {",
          "",
          "[Removed Lines]",
          "369:     if (!IsVP9(iface)) {",
          "370:       GTEST_SKIP() << \"TODO(https://crbug.com/1486441) remove this condition \"",
          "371:                       \"after VP8 is fixed.\";",
          "372:     }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "vp8/encoder/onyx_if.c||vp8/encoder/onyx_if.c": [
          "File: vp8/encoder/onyx_if.c -> vp8/encoder/onyx_if.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1443:   last_h = cpi->oxcf.Height;",
          "1444:   prev_number_of_layers = cpi->oxcf.number_of_layers;",
          "1446:   cpi->oxcf = *oxcf;",
          "1448:   switch (cpi->oxcf.Mode) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1446:   if (cpi->initial_width) {",
          "1449:     oxcf->multi_threaded = cpi->oxcf.multi_threaded;",
          "1450:   }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "38a707faef72eeff89d669c553e7bfe9e08dba8f",
      "candidate_info": {
        "commit_hash": "38a707faef72eeff89d669c553e7bfe9e08dba8f",
        "repo": "webmproject/libvpx",
        "commit_url": "https://github.com/webmproject/libvpx/commit/38a707faef72eeff89d669c553e7bfe9e08dba8f",
        "files": [
          "test/encode_api_test.cc",
          "vp8/encoder/onyx_if.c"
        ],
        "message": "VP8: disallow thread count changes\n\nCurrently allocations are done at encoder creation time. Going from\nthreaded to non-threaded would cause a crash.\n\nBug: chromium:1486441\nChange-Id: Ie301c2a70847dff2f0daae408fbef1e4d42e73d4\n(cherry picked from commit 3fbd1dca6a4d2dad332a2110d646e4ffef36d590)",
        "before_after_code_files": [
          "test/encode_api_test.cc||test/encode_api_test.cc",
          "vp8/encoder/onyx_if.c||vp8/encoder/onyx_if.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "test/encode_api_test.cc||test/encode_api_test.cc",
            "vp8/encoder/onyx_if.c||vp8/encoder/onyx_if.c"
          ],
          "candidate": [
            "test/encode_api_test.cc||test/encode_api_test.cc",
            "vp8/encoder/onyx_if.c||vp8/encoder/onyx_if.c"
          ]
        }
      },
      "candidate_diff": {
        "test/encode_api_test.cc||test/encode_api_test.cc": [
          "File: test/encode_api_test.cc -> test/encode_api_test.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "371:   for (const auto *iface : kCodecIfaces) {",
          "372:     SCOPED_TRACE(vpx_codec_iface_name(iface));",
          "377:     for (int i = 0; i < (IsVP9(iface) ? 2 : 1); ++i) {",
          "378:       vpx_codec_enc_cfg_t cfg = {};",
          "379:       struct Encoder {",
          "",
          "[Removed Lines]",
          "373:     if (!IsVP9(iface)) {",
          "374:       GTEST_SKIP() << \"TODO(https://crbug.com/1486441) remove this condition \"",
          "375:                       \"after VP8 is fixed.\";",
          "376:     }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "vp8/encoder/onyx_if.c||vp8/encoder/onyx_if.c": [
          "File: vp8/encoder/onyx_if.c -> vp8/encoder/onyx_if.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1447:   last_h = cpi->oxcf.Height;",
          "1448:   prev_number_of_layers = cpi->oxcf.number_of_layers;",
          "1450:   cpi->oxcf = *oxcf;",
          "1452:   switch (cpi->oxcf.Mode) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1450:   if (cpi->initial_width) {",
          "1453:     oxcf->multi_threaded = cpi->oxcf.multi_threaded;",
          "1454:   }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "278d0acd32c3fd544e6f99cbfd714df3430a6442",
      "candidate_info": {
        "commit_hash": "278d0acd32c3fd544e6f99cbfd714df3430a6442",
        "repo": "webmproject/libvpx",
        "commit_url": "https://github.com/webmproject/libvpx/commit/278d0acd32c3fd544e6f99cbfd714df3430a6442",
        "files": [
          "test/encode_api_test.cc",
          "vp8/encoder/onyx_if.c"
        ],
        "message": "VP8: disallow thread count changes\n\nCurrently allocations are done at encoder creation time. Going from\nthreaded to non-threaded would cause a crash.\n\nBug: chromium:1486441\nChange-Id: Ie301c2a70847dff2f0daae408fbef1e4d42e73d4\n(cherry picked from commit 3fbd1dca6a4d2dad332a2110d646e4ffef36d590)",
        "before_after_code_files": [
          "test/encode_api_test.cc||test/encode_api_test.cc",
          "vp8/encoder/onyx_if.c||vp8/encoder/onyx_if.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "test/encode_api_test.cc||test/encode_api_test.cc",
            "vp8/encoder/onyx_if.c||vp8/encoder/onyx_if.c"
          ],
          "candidate": [
            "test/encode_api_test.cc||test/encode_api_test.cc",
            "vp8/encoder/onyx_if.c||vp8/encoder/onyx_if.c"
          ]
        }
      },
      "candidate_diff": {
        "test/encode_api_test.cc||test/encode_api_test.cc": [
          "File: test/encode_api_test.cc -> test/encode_api_test.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "371:   for (const auto *iface : kCodecIfaces) {",
          "372:     SCOPED_TRACE(vpx_codec_iface_name(iface));",
          "377:     for (int i = 0; i < (IsVP9(iface) ? 2 : 1); ++i) {",
          "378:       vpx_codec_enc_cfg_t cfg = {};",
          "379:       struct Encoder {",
          "",
          "[Removed Lines]",
          "373:     if (!IsVP9(iface)) {",
          "374:       GTEST_SKIP() << \"TODO(https://crbug.com/1486441) remove this condition \"",
          "375:                       \"after VP8 is fixed.\";",
          "376:     }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "vp8/encoder/onyx_if.c||vp8/encoder/onyx_if.c": [
          "File: vp8/encoder/onyx_if.c -> vp8/encoder/onyx_if.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1447:   last_h = cpi->oxcf.Height;",
          "1448:   prev_number_of_layers = cpi->oxcf.number_of_layers;",
          "1450:   cpi->oxcf = *oxcf;",
          "1452:   switch (cpi->oxcf.Mode) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1450:   if (cpi->initial_width) {",
          "1453:     oxcf->multi_threaded = cpi->oxcf.multi_threaded;",
          "1454:   }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "91ba9ad08a45e2bd1e0f34658dd4d3fd101b047b",
      "candidate_info": {
        "commit_hash": "91ba9ad08a45e2bd1e0f34658dd4d3fd101b047b",
        "repo": "webmproject/libvpx",
        "commit_url": "https://github.com/webmproject/libvpx/commit/91ba9ad08a45e2bd1e0f34658dd4d3fd101b047b",
        "files": [
          "test/encode_api_test.cc",
          "vp8/encoder/onyx_if.c"
        ],
        "message": "VP8: disallow thread count changes\n\nCurrently allocations are done at encoder creation time. Going from\nthreaded to non-threaded would cause a crash.\n\nBug: chromium:1486441\nChange-Id: Ie301c2a70847dff2f0daae408fbef1e4d42e73d4\n(cherry picked from commit 3fbd1dca6a4d2dad332a2110d646e4ffef36d590)",
        "before_after_code_files": [
          "test/encode_api_test.cc||test/encode_api_test.cc",
          "vp8/encoder/onyx_if.c||vp8/encoder/onyx_if.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "test/encode_api_test.cc||test/encode_api_test.cc",
            "vp8/encoder/onyx_if.c||vp8/encoder/onyx_if.c"
          ],
          "candidate": [
            "test/encode_api_test.cc||test/encode_api_test.cc",
            "vp8/encoder/onyx_if.c||vp8/encoder/onyx_if.c"
          ]
        }
      },
      "candidate_diff": {
        "test/encode_api_test.cc||test/encode_api_test.cc": [
          "File: test/encode_api_test.cc -> test/encode_api_test.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "367:   for (const auto *iface : kCodecIfaces) {",
          "368:     SCOPED_TRACE(vpx_codec_iface_name(iface));",
          "373:     for (int i = 0; i < (IsVP9(iface) ? 2 : 1); ++i) {",
          "374:       vpx_codec_enc_cfg_t cfg = {};",
          "375:       struct Encoder {",
          "",
          "[Removed Lines]",
          "369:     if (!IsVP9(iface)) {",
          "370:       GTEST_SKIP() << \"TODO(https://crbug.com/1486441) remove this condition \"",
          "371:                       \"after VP8 is fixed.\";",
          "372:     }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "vp8/encoder/onyx_if.c||vp8/encoder/onyx_if.c": [
          "File: vp8/encoder/onyx_if.c -> vp8/encoder/onyx_if.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1443:   last_h = cpi->oxcf.Height;",
          "1444:   prev_number_of_layers = cpi->oxcf.number_of_layers;",
          "1446:   cpi->oxcf = *oxcf;",
          "1448:   switch (cpi->oxcf.Mode) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1446:   if (cpi->initial_width) {",
          "1449:     oxcf->multi_threaded = cpi->oxcf.multi_threaded;",
          "1450:   }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "7aaffe2df4c9426ab204a272ca5ca52286ca86d4",
      "candidate_info": {
        "commit_hash": "7aaffe2df4c9426ab204a272ca5ca52286ca86d4",
        "repo": "webmproject/libvpx",
        "commit_url": "https://github.com/webmproject/libvpx/commit/7aaffe2df4c9426ab204a272ca5ca52286ca86d4",
        "files": [
          "test/encode_api_test.cc",
          "vp8/encoder/onyx_if.c"
        ],
        "message": "VP8: disallow thread count changes\n\nCurrently allocations are done at encoder creation time. Going from\nthreaded to non-threaded would cause a crash.\n\nBug: chromium:1486441\nChange-Id: Ie301c2a70847dff2f0daae408fbef1e4d42e73d4\n(cherry picked from commit 3fbd1dca6a4d2dad332a2110d646e4ffef36d590)",
        "before_after_code_files": [
          "test/encode_api_test.cc||test/encode_api_test.cc",
          "vp8/encoder/onyx_if.c||vp8/encoder/onyx_if.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "test/encode_api_test.cc||test/encode_api_test.cc",
            "vp8/encoder/onyx_if.c||vp8/encoder/onyx_if.c"
          ],
          "candidate": [
            "test/encode_api_test.cc||test/encode_api_test.cc",
            "vp8/encoder/onyx_if.c||vp8/encoder/onyx_if.c"
          ]
        }
      },
      "candidate_diff": {
        "test/encode_api_test.cc||test/encode_api_test.cc": [
          "File: test/encode_api_test.cc -> test/encode_api_test.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "367:   for (const auto *iface : kCodecIfaces) {",
          "368:     SCOPED_TRACE(vpx_codec_iface_name(iface));",
          "373:     for (int i = 0; i < (IsVP9(iface) ? 2 : 1); ++i) {",
          "374:       vpx_codec_enc_cfg_t cfg = {};",
          "375:       struct Encoder {",
          "",
          "[Removed Lines]",
          "369:     if (!IsVP9(iface)) {",
          "370:       GTEST_SKIP() << \"TODO(https://crbug.com/1486441) remove this condition \"",
          "371:                       \"after VP8 is fixed.\";",
          "372:     }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "vp8/encoder/onyx_if.c||vp8/encoder/onyx_if.c": [
          "File: vp8/encoder/onyx_if.c -> vp8/encoder/onyx_if.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1443:   last_h = cpi->oxcf.Height;",
          "1444:   prev_number_of_layers = cpi->oxcf.number_of_layers;",
          "1446:   cpi->oxcf = *oxcf;",
          "1448:   switch (cpi->oxcf.Mode) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1446:   if (cpi->initial_width) {",
          "1449:     oxcf->multi_threaded = cpi->oxcf.multi_threaded;",
          "1450:   }",
          "",
          "---------------"
        ]
      }
    }
  ]
}