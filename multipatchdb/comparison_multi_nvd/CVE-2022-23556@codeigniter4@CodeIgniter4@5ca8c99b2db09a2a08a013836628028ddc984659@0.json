{
  "cve_id": "CVE-2022-23556",
  "cve_desc": "CodeIgniter is a PHP full-stack web framework. This vulnerability may allow attackers to spoof their IP address when the server is behind a reverse proxy. This issue has been patched, please upgrade to version 4.2.11 or later, and configure `Config\\App::$proxyIPs`. As a workaround, do not use `$request->getIPAddress()`.\n",
  "repo": "codeigniter4/CodeIgniter4",
  "patch_hash": "5ca8c99b2db09a2a08a013836628028ddc984659",
  "patch_info": {
    "commit_hash": "5ca8c99b2db09a2a08a013836628028ddc984659",
    "repo": "codeigniter4/CodeIgniter4",
    "commit_url": "https://github.com/codeigniter4/CodeIgniter4/commit/5ca8c99b2db09a2a08a013836628028ddc984659",
    "files": [
      "app/Config/App.php",
      "phpstan-baseline.neon.dist",
      "system/HTTP/Request.php",
      "system/HTTP/RequestTrait.php",
      "system/Test/Mock/MockAppConfig.php",
      "system/Test/Mock/MockCLIConfig.php",
      "tests/system/HTTP/IncomingRequestTest.php",
      "tests/system/HTTP/RequestTest.php",
      "user_guide_src/source/changelogs/v4.2.11.rst",
      "user_guide_src/source/incoming/request.rst",
      "user_guide_src/source/installation/upgrade_4211.rst"
    ],
    "message": "Merge pull request from GHSA-ghw3-5qvm-3mqc\n\nfix: proxyIPs",
    "before_after_code_files": [
      "app/Config/App.php||app/Config/App.php",
      "phpstan-baseline.neon.dist||phpstan-baseline.neon.dist",
      "system/HTTP/Request.php||system/HTTP/Request.php",
      "system/HTTP/RequestTrait.php||system/HTTP/RequestTrait.php",
      "system/Test/Mock/MockAppConfig.php||system/Test/Mock/MockAppConfig.php",
      "system/Test/Mock/MockCLIConfig.php||system/Test/Mock/MockCLIConfig.php",
      "tests/system/HTTP/IncomingRequestTest.php||tests/system/HTTP/IncomingRequestTest.php",
      "tests/system/HTTP/RequestTest.php||tests/system/HTTP/RequestTest.php"
    ]
  },
  "patch_diff": {
    "app/Config/App.php||app/Config/App.php": [
      "File: app/Config/App.php -> app/Config/App.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "346:     public $proxyIPs = '';",
      "",
      "[Added Lines]",
      "349:     public $proxyIPs = [];",
      "",
      "---------------"
    ],
    "phpstan-baseline.neon.dist||phpstan-baseline.neon.dist": [
      "File: phpstan-baseline.neon.dist -> phpstan-baseline.neon.dist",
      "--- Hunk 1 ---",
      "[Context before]",
      "500:    count: 1",
      "501:    path: system/HTTP/RedirectResponse.php",
      "508:   -",
      "509:    message: \"#^Property CodeIgniter\\\\\\\\HTTP\\\\\\\\Request\\\\:\\\\:\\\\$uri \\\\(CodeIgniter\\\\\\\\HTTP\\\\\\\\URI\\\\) in empty\\\\(\\\\) is not falsy\\\\.$#\"",
      "510:    count: 1",
      "",
      "[Removed Lines]",
      "503:   -",
      "504:    message: \"#^Property CodeIgniter\\\\\\\\HTTP\\\\\\\\Request\\\\:\\\\:\\\\$proxyIPs \\\\(array\\\\|string\\\\) on left side of \\\\?\\\\? is not nullable\\\\.$#\"",
      "505:    count: 1",
      "506:    path: system/HTTP/Request.php",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ],
    "system/HTTP/Request.php||system/HTTP/Request.php": [
      "File: system/HTTP/Request.php -> system/HTTP/Request.php"
    ],
    "system/HTTP/RequestTrait.php||system/HTTP/RequestTrait.php": [
      "File: system/HTTP/RequestTrait.php -> system/HTTP/RequestTrait.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "12: namespace CodeIgniter\\HTTP;",
      "14: use CodeIgniter\\Validation\\FormatRules;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "14: use CodeIgniter\\Exceptions\\ConfigException;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "62:         $proxyIPs = $this->proxyIPs ?? config('App')->proxyIPs;",
      "65:         }",
      "67:         $this->ipAddress = $this->getServer('REMOTE_ADDR');",
      "69:         if ($proxyIPs) {",
      "97:                             $this->ipAddress = $spoof;",
      "98:                             break;",
      "99:                         }",
      "102:                     }",
      "128:                         }",
      "131:                     }",
      "145:                     }",
      "149:                         $this->ipAddress = $spoof;",
      "150:                         break;",
      "151:                     }",
      "",
      "[Removed Lines]",
      "63:         if (! empty($proxyIPs) && ! is_array($proxyIPs)) {",
      "64:             $proxyIPs = explode(',', str_replace(' ', '', $proxyIPs));",
      "70:             foreach (['x-forwarded-for', 'client-ip', 'x-client-ip', 'x-cluster-client-ip'] as $header) {",
      "71:                 $spoof     = null;",
      "72:                 $headerObj = $this->header($header);",
      "74:                 if ($headerObj !== null) {",
      "75:                     $spoof = $headerObj->getValue();",
      "80:                     sscanf($spoof, '%[^,]', $spoof);",
      "82:                     if (! $ipValidator($spoof)) {",
      "83:                         $spoof = null;",
      "84:                     } else {",
      "85:                         break;",
      "86:                     }",
      "87:                 }",
      "88:             }",
      "90:             if ($spoof) {",
      "91:                 foreach ($proxyIPs as $proxyIP) {",
      "93:                     if (strpos($proxyIP, '/') === false) {",
      "96:                         if ($proxyIP === $this->ipAddress) {",
      "101:                         continue;",
      "105:                     if (! isset($separator)) {",
      "106:                         $separator = $ipValidator($this->ipAddress, 'ipv6') ? ':' : '.';",
      "107:                     }",
      "110:                     if (strpos($proxyIP, $separator) === false) {",
      "111:                         continue;",
      "112:                     }",
      "115:                     if (! isset($ip, $sprintf)) {",
      "116:                         if ($separator === ':') {",
      "118:                             $ip = explode(':', str_replace('::', str_repeat(':', 9 - substr_count($this->ipAddress, ':')), $this->ipAddress));",
      "120:                             for ($j = 0; $j < 8; $j++) {",
      "121:                                 $ip[$j] = intval($ip[$j], 16);",
      "122:                             }",
      "124:                             $sprintf = '%016b%016b%016b%016b%016b%016b%016b%016b';",
      "125:                         } else {",
      "126:                             $ip      = explode('.', $this->ipAddress);",
      "127:                             $sprintf = '%08b%08b%08b%08b';",
      "130:                         $ip = vsprintf($sprintf, $ip);",
      "134:                     sscanf($proxyIP, '%[^/]/%d', $netaddr, $masklen);",
      "137:                     if ($separator === ':') {",
      "138:                         $netaddr = explode(':', str_replace('::', str_repeat(':', 9 - substr_count($netaddr, ':')), $netaddr));",
      "140:                         for ($i = 0; $i < 8; $i++) {",
      "141:                             $netaddr[$i] = intval($netaddr[$i], 16);",
      "142:                         }",
      "143:                     } else {",
      "144:                         $netaddr = explode('.', $netaddr);",
      "148:                     if (strncmp($ip, vsprintf($sprintf, $netaddr), $masklen) === 0) {",
      "",
      "[Added Lines]",
      "67:         if (! empty($proxyIPs)) {",
      "69:             if (! is_array($proxyIPs) || is_int(array_key_first($proxyIPs))) {",
      "70:                 throw new ConfigException(",
      "71:                     'You must set an array with Proxy IP address key and HTTP header name value in Config\\App::$proxyIPs.'",
      "72:                 );",
      "73:             }",
      "80:             foreach ($proxyIPs as $proxyIP => $header) {",
      "82:                 if (strpos($proxyIP, '/') === false) {",
      "85:                     if ($proxyIP === $this->ipAddress) {",
      "86:                         $spoof = $this->getClientIP($header);",
      "88:                         if ($spoof !== null) {",
      "94:                     continue;",
      "95:                 }",
      "98:                 if (! isset($separator)) {",
      "99:                     $separator = $ipValidator($this->ipAddress, 'ipv6') ? ':' : '.';",
      "100:                 }",
      "103:                 if (strpos($proxyIP, $separator) === false) {",
      "104:                     continue;",
      "105:                 }",
      "108:                 if (! isset($ip, $sprintf)) {",
      "109:                     if ($separator === ':') {",
      "111:                         $ip = explode(':', str_replace('::', str_repeat(':', 9 - substr_count($this->ipAddress, ':')), $this->ipAddress));",
      "113:                         for ($j = 0; $j < 8; $j++) {",
      "114:                             $ip[$j] = intval($ip[$j], 16);",
      "117:                         $sprintf = '%016b%016b%016b%016b%016b%016b%016b%016b';",
      "118:                     } else {",
      "119:                         $ip      = explode('.', $this->ipAddress);",
      "120:                         $sprintf = '%08b%08b%08b%08b';",
      "123:                     $ip = vsprintf($sprintf, $ip);",
      "124:                 }",
      "127:                 sscanf($proxyIP, '%[^/]/%d', $netaddr, $masklen);",
      "130:                 if ($separator === ':') {",
      "131:                     $netaddr = explode(':', str_replace('::', str_repeat(':', 9 - substr_count($netaddr, ':')), $netaddr));",
      "133:                     for ($i = 0; $i < 8; $i++) {",
      "134:                         $netaddr[$i] = intval($netaddr[$i], 16);",
      "136:                 } else {",
      "137:                     $netaddr = explode('.', $netaddr);",
      "138:                 }",
      "141:                 if (strncmp($ip, vsprintf($sprintf, $netaddr), $masklen) === 0) {",
      "142:                     $spoof = $this->getClientIP($header);",
      "144:                     if ($spoof !== null) {",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "160:         return empty($this->ipAddress) ? '' : $this->ipAddress;",
      "161:     }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "162:     private function getClientIP(string $header): ?string",
      "163:     {",
      "164:         $ipValidator = [",
      "165:             new FormatRules(),",
      "166:             'valid_ip',",
      "167:         ];",
      "168:         $spoof     = null;",
      "169:         $headerObj = $this->header($header);",
      "171:         if ($headerObj !== null) {",
      "172:             $spoof = $headerObj->getValue();",
      "177:             sscanf($spoof, '%[^,]', $spoof);",
      "179:             if (! $ipValidator($spoof)) {",
      "180:                 $spoof = null;",
      "181:             }",
      "182:         }",
      "184:         return $spoof;",
      "185:     }",
      "",
      "---------------"
    ],
    "system/Test/Mock/MockAppConfig.php||system/Test/Mock/MockAppConfig.php": [
      "File: system/Test/Mock/MockAppConfig.php -> system/Test/Mock/MockAppConfig.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "23:     public $cookieSecure     = false;",
      "24:     public $cookieHTTPOnly   = false;",
      "25:     public $cookieSameSite   = 'Lax';",
      "27:     public $CSRFTokenName    = 'csrf_test_name';",
      "28:     public $CSRFHeaderName   = 'X-CSRF-TOKEN';",
      "29:     public $CSRFCookieName   = 'csrf_cookie_name';",
      "",
      "[Removed Lines]",
      "26:     public $proxyIPs         = '';",
      "",
      "[Added Lines]",
      "26:     public $proxyIPs         = [];",
      "",
      "---------------"
    ],
    "system/Test/Mock/MockCLIConfig.php||system/Test/Mock/MockCLIConfig.php": [
      "File: system/Test/Mock/MockCLIConfig.php -> system/Test/Mock/MockCLIConfig.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "23:     public $cookieSecure     = false;",
      "24:     public $cookieHTTPOnly   = false;",
      "25:     public $cookieSameSite   = 'Lax';",
      "27:     public $CSRFTokenName    = 'csrf_test_name';",
      "28:     public $CSRFCookieName   = 'csrf_cookie_name';",
      "29:     public $CSRFExpire       = 7200;",
      "",
      "[Removed Lines]",
      "26:     public $proxyIPs         = '';",
      "",
      "[Added Lines]",
      "26:     public $proxyIPs         = [];",
      "",
      "---------------"
    ],
    "tests/system/HTTP/IncomingRequestTest.php||tests/system/HTTP/IncomingRequestTest.php": [
      "File: tests/system/HTTP/IncomingRequestTest.php -> tests/system/HTTP/IncomingRequestTest.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "12: namespace CodeIgniter\\HTTP;",
      "14: use CodeIgniter\\HTTP\\Exceptions\\HTTPException;",
      "15: use CodeIgniter\\HTTP\\Files\\UploadedFile;",
      "16: use CodeIgniter\\Test\\CIUnitTestCase;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "14: use CodeIgniter\\Exceptions\\ConfigException;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "714:         $expected                        = '123.123.123.123';",
      "715:         $_SERVER['HTTP_X_FORWARDED_FOR'] = $expected;",
      "716:         $_SERVER['REMOTE_ADDR']          = '10.0.1.200';",
      "720:         $this->request = new Request($config);",
      "721:         $this->request->populateHeaders();",
      "",
      "[Removed Lines]",
      "717:         $config                          = new App();",
      "718:         $config->proxyIPs                = '10.0.1.200,192.168.5.0/24';",
      "",
      "[Added Lines]",
      "719:         $config           = new App();",
      "720:         $config->proxyIPs = [",
      "721:             '10.0.1.200'     => 'X-Forwarded-For',",
      "722:             '192.168.5.0/24' => 'X-Forwarded-For',",
      "723:         ];",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "724:         $this->assertSame($expected, $this->request->getIPAddress());",
      "725:     }",
      "728:     {",
      "729:         $_SERVER['HTTP_X_FORWARDED_FOR'] = '123.456.23.123';",
      "730:         $expected                        = '10.0.1.200';",
      "731:         $_SERVER['REMOTE_ADDR']          = $expected;",
      "735:         $this->request = new Request($config);",
      "736:         $this->request->populateHeaders();",
      "",
      "[Removed Lines]",
      "727:     public function testGetIPAddressThruProxyInvalid()",
      "732:         $config                          = new App();",
      "733:         $config->proxyIPs                = '10.0.1.200,192.168.5.0/24';",
      "",
      "[Added Lines]",
      "731:     public function testGetIPAddressThruProxyIPv6()",
      "732:     {",
      "733:         $expected                        = '123.123.123.123';",
      "734:         $_SERVER['HTTP_X_FORWARDED_FOR'] = $expected;",
      "735:         $_SERVER['REMOTE_ADDR']          = '2001:db8::2:1';",
      "737:         $config           = new App();",
      "738:         $config->proxyIPs = [",
      "739:             '2001:db8::2:1' => 'X-Forwarded-For',",
      "740:         ];",
      "741:         $this->request = new Request($config);",
      "742:         $this->request->populateHeaders();",
      "745:         $this->assertSame($expected, $this->request->getIPAddress());",
      "746:     }",
      "748:     public function testGetIPAddressThruProxyInvalidIPAddress()",
      "754:         $config           = new App();",
      "755:         $config->proxyIPs = [",
      "756:             '10.0.1.200'     => 'X-Forwarded-For',",
      "757:             '192.168.5.0/24' => 'X-Forwarded-For',",
      "758:         ];",
      "759:         $this->request = new Request($config);",
      "760:         $this->request->populateHeaders();",
      "763:         $this->assertSame($expected, $this->request->getIPAddress());",
      "764:     }",
      "766:     public function testGetIPAddressThruProxyInvalidIPAddressIPv6()",
      "767:     {",
      "768:         $_SERVER['HTTP_X_FORWARDED_FOR'] = '2001:xyz::1';",
      "769:         $expected                        = '2001:db8::2:1';",
      "770:         $_SERVER['REMOTE_ADDR']          = $expected;",
      "772:         $config           = new App();",
      "773:         $config->proxyIPs = [",
      "774:             '2001:db8::2:1' => 'X-Forwarded-For',",
      "775:         ];",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "744:         $expected                        = '10.10.1.200';",
      "745:         $_SERVER['REMOTE_ADDR']          = $expected;",
      "746:         $_SERVER['HTTP_X_FORWARDED_FOR'] = '123.456.23.123';",
      "750:         $this->request = new Request($config);",
      "751:         $this->request->populateHeaders();",
      "",
      "[Removed Lines]",
      "747:         $config                          = new App();",
      "748:         $config->proxyIPs                = '10.0.1.200,192.168.5.0/24';",
      "",
      "[Added Lines]",
      "789:         $config           = new App();",
      "790:         $config->proxyIPs = [",
      "791:             '10.0.1.200'     => 'X-Forwarded-For',",
      "792:             '192.168.5.0/24' => 'X-Forwarded-For',",
      "793:         ];",
      "794:         $this->request = new Request($config);",
      "795:         $this->request->populateHeaders();",
      "798:         $this->assertSame($expected, $this->request->getIPAddress());",
      "799:     }",
      "801:     public function testGetIPAddressThruProxyNotWhitelistedIPv6()",
      "802:     {",
      "803:         $expected                        = '2001:db8::2:2';",
      "804:         $_SERVER['REMOTE_ADDR']          = $expected;",
      "805:         $_SERVER['HTTP_X_FORWARDED_FOR'] = '123.456.23.123';",
      "807:         $config           = new App();",
      "808:         $config->proxyIPs = [",
      "809:             '2001:db8::2:1' => 'X-Forwarded-For',",
      "810:         ];",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "759:         $expected                        = '123.123.123.123';",
      "760:         $_SERVER['HTTP_X_FORWARDED_FOR'] = $expected;",
      "761:         $_SERVER['REMOTE_ADDR']          = '192.168.5.21';",
      "766:         $this->request->populateHeaders();",
      "769:         $this->assertSame($expected, $this->request->getIPAddress());",
      "770:     }",
      "773:     {",
      "774:         $expected                        = '192.168.5.21';",
      "775:         $_SERVER['REMOTE_ADDR']          = $expected;",
      "778:         $_SERVER['HTTP_X_FORWARDED_FOR'] = '123.123.123.123';",
      "780:         $this->request->populateHeaders();",
      "783:         $this->assertSame($expected, $this->request->getIPAddress());",
      "784:     }",
      "787: }",
      "",
      "[Removed Lines]",
      "762:         $config                          = new App();",
      "763:         $config->proxyIPs                = ['192.168.5.0/24'];",
      "765:         $this->request = new Request($config);",
      "772:     public function testGetIPAddressThruProxyOutofSubnet()",
      "776:         $config                          = new App();",
      "777:         $config->proxyIPs                = ['192.168.5.0/28'];",
      "779:         $this->request                   = new Request($config);",
      "",
      "[Added Lines]",
      "824:         $config           = new App();",
      "825:         $config->proxyIPs = ['192.168.5.0/24' => 'X-Forwarded-For'];",
      "826:         $this->request    = new Request($config);",
      "827:         $this->request->populateHeaders();",
      "830:         $this->assertSame($expected, $this->request->getIPAddress());",
      "831:     }",
      "833:     public function testGetIPAddressThruProxySubnetIPv6()",
      "834:     {",
      "835:         $expected                        = '123.123.123.123';",
      "836:         $_SERVER['HTTP_X_FORWARDED_FOR'] = $expected;",
      "837:         $_SERVER['REMOTE_ADDR']          = '2001:db8:1234:ffff:ffff:ffff:ffff:ffff';",
      "839:         $config           = new App();",
      "840:         $config->proxyIPs = ['2001:db8:1234::/48' => 'X-Forwarded-For'];",
      "841:         $this->request    = new Request($config);",
      "848:     public function testGetIPAddressThruProxyOutOfSubnet()",
      "854:         $config           = new App();",
      "855:         $config->proxyIPs = ['192.168.5.0/28' => 'X-Forwarded-For'];",
      "856:         $this->request    = new Request($config);",
      "857:         $this->request->populateHeaders();",
      "860:         $this->assertSame($expected, $this->request->getIPAddress());",
      "861:     }",
      "863:     public function testGetIPAddressThruProxyOutOfSubnetIPv6()",
      "864:     {",
      "865:         $expected                        = '2001:db8:1235:ffff:ffff:ffff:ffff:ffff';",
      "866:         $_SERVER['REMOTE_ADDR']          = $expected;",
      "867:         $_SERVER['HTTP_X_FORWARDED_FOR'] = '123.123.123.123';",
      "869:         $config           = new App();",
      "870:         $config->proxyIPs = ['2001:db8:1234::/48' => 'X-Forwarded-For'];",
      "871:         $this->request    = new Request($config);",
      "872:         $this->request->populateHeaders();",
      "875:         $this->assertSame($expected, $this->request->getIPAddress());",
      "876:     }",
      "878:     public function testGetIPAddressThruProxyBothIPv4AndIPv6()",
      "879:     {",
      "880:         $expected                        = '2001:db8:1235:ffff:ffff:ffff:ffff:ffff';",
      "881:         $_SERVER['REMOTE_ADDR']          = $expected;",
      "882:         $_SERVER['HTTP_X_FORWARDED_FOR'] = '123.123.123.123';",
      "884:         $config           = new App();",
      "885:         $config->proxyIPs = [",
      "886:             '192.168.5.0/28'     => 'X-Forwarded-For',",
      "887:             '2001:db8:1234::/48' => 'X-Forwarded-For',",
      "888:         ];",
      "889:         $this->request = new Request($config);",
      "896:     public function testGetIPAddressThruProxyInvalidConfigString()",
      "897:     {",
      "898:         $this->expectException(ConfigException::class);",
      "899:         $this->expectExceptionMessage(",
      "900:             'You must set an array with Proxy IP address key and HTTP header name value in Config\\App::$proxyIPs.'",
      "901:         );",
      "903:         $config           = new App();",
      "904:         $config->proxyIPs = '192.168.5.0/28';",
      "905:         $this->request    = new Request($config);",
      "906:         $this->request->populateHeaders();",
      "908:         $this->request->getIPAddress();",
      "909:     }",
      "911:     public function testGetIPAddressThruProxyInvalidConfigArray()",
      "912:     {",
      "913:         $this->expectException(ConfigException::class);",
      "914:         $this->expectExceptionMessage(",
      "915:             'You must set an array with Proxy IP address key and HTTP header name value in Config\\App::$proxyIPs.'",
      "916:         );",
      "918:         $config           = new App();",
      "919:         $config->proxyIPs = ['192.168.5.0/28'];",
      "920:         $this->request    = new Request($config);",
      "921:         $this->request->populateHeaders();",
      "923:         $this->request->getIPAddress();",
      "924:     }",
      "",
      "---------------"
    ],
    "tests/system/HTTP/RequestTest.php||tests/system/HTTP/RequestTest.php": [
      "File: tests/system/HTTP/RequestTest.php -> tests/system/HTTP/RequestTest.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "609:     {",
      "610:         $expected                        = '123.123.123.123';",
      "611:         $_SERVER['REMOTE_ADDR']          = '10.0.1.200';",
      "614:         $_SERVER['HTTP_X_FORWARDED_FOR'] = $expected;",
      "616:         $this->request->populateHeaders();",
      "",
      "[Removed Lines]",
      "612:         $config                          = new App();",
      "613:         $config->proxyIPs                = '10.0.1.200,192.168.5.0/24';",
      "615:         $this->request                   = new Request($config);",
      "",
      "[Added Lines]",
      "614:         $config           = new App();",
      "615:         $config->proxyIPs = [",
      "616:             '10.0.1.200'     => 'X-Forwarded-For',",
      "617:             '192.168.5.0/24' => 'X-Forwarded-For',",
      "618:         ];",
      "619:         $this->request = new Request($config);",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "623:     {",
      "624:         $expected                        = '123.456.23.123';",
      "625:         $_SERVER['REMOTE_ADDR']          = '10.0.1.200';",
      "628:         $_SERVER['HTTP_X_FORWARDED_FOR'] = $expected;",
      "630:         $this->request->populateHeaders();",
      "",
      "[Removed Lines]",
      "626:         $config                          = new App();",
      "627:         $config->proxyIPs                = '10.0.1.200,192.168.5.0/24';",
      "629:         $this->request                   = new Request($config);",
      "",
      "[Added Lines]",
      "631:         $config                          = new App();",
      "632:         $config->proxyIPs                = [",
      "633:             '10.0.1.200'     => 'X-Forwarded-For',",
      "634:             '192.168.5.0/24' => 'X-Forwarded-For',",
      "635:         ];",
      "637:         $this->request = new Request($config);",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "637:     {",
      "638:         $expected                        = '123.456.23.123';",
      "639:         $_SERVER['REMOTE_ADDR']          = '10.10.1.200';",
      "642:         $_SERVER['HTTP_X_FORWARDED_FOR'] = $expected;",
      "644:         $this->request->populateHeaders();",
      "",
      "[Removed Lines]",
      "640:         $config                          = new App();",
      "641:         $config->proxyIPs                = '10.0.1.200,192.168.5.0/24';",
      "643:         $this->request                   = new Request($config);",
      "",
      "[Added Lines]",
      "650:         $config           = new App();",
      "651:         $config->proxyIPs = [",
      "652:             '10.0.1.200'     => 'X-Forwarded-For',",
      "653:             '192.168.5.0/24' => 'X-Forwarded-For',",
      "654:         ];",
      "655:         $this->request = new Request($config);",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "651:     {",
      "652:         $expected                        = '123.123.123.123';",
      "653:         $_SERVER['REMOTE_ADDR']          = '192.168.5.21';",
      "656:         $_SERVER['HTTP_X_FORWARDED_FOR'] = $expected;",
      "658:         $this->request->populateHeaders();",
      "",
      "[Removed Lines]",
      "654:         $config                          = new App();",
      "655:         $config->proxyIPs                = ['192.168.5.0/24'];",
      "657:         $this->request                   = new Request($config);",
      "",
      "[Added Lines]",
      "668:         $config           = new App();",
      "669:         $config->proxyIPs = ['192.168.5.0/24' => 'X-Forwarded-For'];",
      "670:         $this->request    = new Request($config);",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "665:     {",
      "666:         $expected                        = '123.123.123.123';",
      "667:         $_SERVER['REMOTE_ADDR']          = '192.168.5.21';",
      "670:         $_SERVER['HTTP_X_FORWARDED_FOR'] = $expected;",
      "672:         $this->request->populateHeaders();",
      "",
      "[Removed Lines]",
      "668:         $config                          = new App();",
      "669:         $config->proxyIPs                = ['192.168.5.0/28'];",
      "671:         $this->request                   = new Request($config);",
      "",
      "[Added Lines]",
      "683:         $config           = new App();",
      "684:         $config->proxyIPs = ['192.168.5.0/28' => 'X-Forwarded-For'];",
      "685:         $this->request    = new Request($config);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "feab19b4cdd457cc739114c176803f10cd47a750",
      "candidate_info": {
        "commit_hash": "feab19b4cdd457cc739114c176803f10cd47a750",
        "repo": "codeigniter4/CodeIgniter4",
        "commit_url": "https://github.com/codeigniter4/CodeIgniter4/commit/feab19b4cdd457cc739114c176803f10cd47a750",
        "files": [
          "system/HTTP/RequestTrait.php"
        ],
        "message": "docs: add @TODO",
        "before_after_code_files": [
          "system/HTTP/RequestTrait.php||system/HTTP/RequestTrait.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/codeigniter4/CodeIgniter4/pull/7002"
        ],
        "olp_code_files": {
          "patch": [
            "system/HTTP/RequestTrait.php||system/HTTP/RequestTrait.php"
          ],
          "candidate": [
            "system/HTTP/RequestTrait.php||system/HTTP/RequestTrait.php"
          ]
        }
      },
      "candidate_diff": {
        "system/HTTP/RequestTrait.php||system/HTTP/RequestTrait.php": [
          "File: system/HTTP/RequestTrait.php -> system/HTTP/RequestTrait.php"
        ]
      }
    },
    {
      "candidate_hash": "caeb549a11443df6438564e29b021766b4466b4b",
      "candidate_info": {
        "commit_hash": "caeb549a11443df6438564e29b021766b4466b4b",
        "repo": "codeigniter4/CodeIgniter4",
        "commit_url": "https://github.com/codeigniter4/CodeIgniter4/commit/caeb549a11443df6438564e29b021766b4466b4b",
        "files": [
          "system/HTTP/RequestTrait.php"
        ],
        "message": "refactor: extract method",
        "before_after_code_files": [
          "system/HTTP/RequestTrait.php||system/HTTP/RequestTrait.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/codeigniter4/CodeIgniter4/pull/7002"
        ],
        "olp_code_files": {
          "patch": [
            "system/HTTP/RequestTrait.php||system/HTTP/RequestTrait.php"
          ],
          "candidate": [
            "system/HTTP/RequestTrait.php||system/HTTP/RequestTrait.php"
          ]
        }
      },
      "candidate_diff": {
        "system/HTTP/RequestTrait.php||system/HTTP/RequestTrait.php": [
          "File: system/HTTP/RequestTrait.php -> system/HTTP/RequestTrait.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "82:                     if ($proxyIP === $this->ipAddress) {",
          "100:                         }",
          "101:                     }",
          "",
          "[Removed Lines]",
          "83:                         $spoof     = null;",
          "84:                         $headerObj = $this->header($header);",
          "86:                         if ($headerObj !== null) {",
          "87:                             $spoof = $headerObj->getValue();",
          "92:                             sscanf($spoof, '%[^,]', $spoof);",
          "94:                             if (! $ipValidator($spoof)) {",
          "95:                                 $spoof = null;",
          "96:                             } else {",
          "97:                                 $this->ipAddress = $spoof;",
          "98:                                 break;",
          "99:                             }",
          "",
          "[Added Lines]",
          "83:                         $spoof = $this->getClientIP($header);",
          "85:                         if ($spoof !== null) {",
          "86:                             $this->ipAddress = $spoof;",
          "87:                             break;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "150:                 if (strncmp($ip, vsprintf($sprintf, $netaddr), $masklen) === 0) {",
          "168:                     }",
          "169:                 }",
          "170:             }",
          "",
          "[Removed Lines]",
          "151:                     $spoof     = null;",
          "152:                     $headerObj = $this->header($header);",
          "154:                     if ($headerObj !== null) {",
          "155:                         $spoof = $headerObj->getValue();",
          "160:                         sscanf($spoof, '%[^,]', $spoof);",
          "162:                         if (! $ipValidator($spoof)) {",
          "163:                             $spoof = null;",
          "164:                         } else {",
          "165:                             $this->ipAddress = $spoof;",
          "166:                             break;",
          "167:                         }",
          "",
          "[Added Lines]",
          "139:                     $spoof = $this->getClientIP($header);",
          "141:                     if ($spoof !== null) {",
          "142:                         $this->ipAddress = $spoof;",
          "143:                         break;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "177:         return empty($this->ipAddress) ? '' : $this->ipAddress;",
          "178:     }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "159:     private function getClientIP(string $header): ?string",
          "160:     {",
          "161:         $ipValidator = [",
          "162:             new FormatRules(),",
          "163:             'valid_ip',",
          "164:         ];",
          "165:         $spoof     = null;",
          "166:         $headerObj = $this->header($header);",
          "168:         if ($headerObj !== null) {",
          "169:             $spoof = $headerObj->getValue();",
          "174:             sscanf($spoof, '%[^,]', $spoof);",
          "176:             if (! $ipValidator($spoof)) {",
          "177:                 $spoof = null;",
          "178:             }",
          "179:         }",
          "181:         return $spoof;",
          "182:     }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "cb6d80161fc3f70b8d287064709d658ce8cd4ab3",
      "candidate_info": {
        "commit_hash": "cb6d80161fc3f70b8d287064709d658ce8cd4ab3",
        "repo": "codeigniter4/CodeIgniter4",
        "commit_url": "https://github.com/codeigniter4/CodeIgniter4/commit/cb6d80161fc3f70b8d287064709d658ce8cd4ab3",
        "files": [
          "app/Config/App.php",
          "phpstan-baseline.neon.dist",
          "system/HTTP/Request.php",
          "system/HTTP/RequestTrait.php",
          "system/Test/Mock/MockAppConfig.php",
          "system/Test/Mock/MockCLIConfig.php",
          "tests/system/HTTP/IncomingRequestTest.php",
          "tests/system/HTTP/RequestTest.php"
        ],
        "message": "fix: format of $proxyIPs\n\nSpecify HTTP header name for security reasons.",
        "before_after_code_files": [
          "app/Config/App.php||app/Config/App.php",
          "phpstan-baseline.neon.dist||phpstan-baseline.neon.dist",
          "system/HTTP/Request.php||system/HTTP/Request.php",
          "system/HTTP/RequestTrait.php||system/HTTP/RequestTrait.php",
          "system/Test/Mock/MockAppConfig.php||system/Test/Mock/MockAppConfig.php",
          "system/Test/Mock/MockCLIConfig.php||system/Test/Mock/MockCLIConfig.php",
          "tests/system/HTTP/IncomingRequestTest.php||tests/system/HTTP/IncomingRequestTest.php",
          "tests/system/HTTP/RequestTest.php||tests/system/HTTP/RequestTest.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/codeigniter4/CodeIgniter4/pull/7002"
        ],
        "olp_code_files": {
          "patch": [
            "app/Config/App.php||app/Config/App.php",
            "phpstan-baseline.neon.dist||phpstan-baseline.neon.dist",
            "system/HTTP/Request.php||system/HTTP/Request.php",
            "system/HTTP/RequestTrait.php||system/HTTP/RequestTrait.php",
            "system/Test/Mock/MockAppConfig.php||system/Test/Mock/MockAppConfig.php",
            "system/Test/Mock/MockCLIConfig.php||system/Test/Mock/MockCLIConfig.php",
            "tests/system/HTTP/IncomingRequestTest.php||tests/system/HTTP/IncomingRequestTest.php",
            "tests/system/HTTP/RequestTest.php||tests/system/HTTP/RequestTest.php"
          ],
          "candidate": [
            "app/Config/App.php||app/Config/App.php",
            "phpstan-baseline.neon.dist||phpstan-baseline.neon.dist",
            "system/HTTP/Request.php||system/HTTP/Request.php",
            "system/HTTP/RequestTrait.php||system/HTTP/RequestTrait.php",
            "system/Test/Mock/MockAppConfig.php||system/Test/Mock/MockAppConfig.php",
            "system/Test/Mock/MockCLIConfig.php||system/Test/Mock/MockCLIConfig.php",
            "tests/system/HTTP/IncomingRequestTest.php||tests/system/HTTP/IncomingRequestTest.php",
            "tests/system/HTTP/RequestTest.php||tests/system/HTTP/RequestTest.php"
          ]
        }
      },
      "candidate_diff": {
        "app/Config/App.php||app/Config/App.php": [
          "File: app/Config/App.php -> app/Config/App.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "346:     public $proxyIPs = '';",
          "",
          "[Added Lines]",
          "349:     public $proxyIPs = [];",
          "",
          "---------------"
        ],
        "phpstan-baseline.neon.dist||phpstan-baseline.neon.dist": [
          "File: phpstan-baseline.neon.dist -> phpstan-baseline.neon.dist",
          "--- Hunk 1 ---",
          "[Context before]",
          "500:    count: 1",
          "501:    path: system/HTTP/RedirectResponse.php",
          "508:   -",
          "509:    message: \"#^Property CodeIgniter\\\\\\\\HTTP\\\\\\\\Request\\\\:\\\\:\\\\$uri \\\\(CodeIgniter\\\\\\\\HTTP\\\\\\\\URI\\\\) in empty\\\\(\\\\) is not falsy\\\\.$#\"",
          "510:    count: 1",
          "",
          "[Removed Lines]",
          "503:   -",
          "504:    message: \"#^Property CodeIgniter\\\\\\\\HTTP\\\\\\\\Request\\\\:\\\\:\\\\$proxyIPs \\\\(array\\\\|string\\\\) on left side of \\\\?\\\\? is not nullable\\\\.$#\"",
          "505:    count: 1",
          "506:    path: system/HTTP/Request.php",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "system/HTTP/Request.php||system/HTTP/Request.php": [
          "File: system/HTTP/Request.php -> system/HTTP/Request.php"
        ],
        "system/HTTP/RequestTrait.php||system/HTTP/RequestTrait.php": [
          "File: system/HTTP/RequestTrait.php -> system/HTTP/RequestTrait.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "12: namespace CodeIgniter\\HTTP;",
          "14: use CodeIgniter\\Validation\\FormatRules;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "14: use CodeIgniter\\Exceptions\\ConfigException;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "62:         $proxyIPs = $this->proxyIPs ?? config('App')->proxyIPs;",
          "65:         }",
          "67:         $this->ipAddress = $this->getServer('REMOTE_ADDR');",
          "69:         if ($proxyIPs) {",
          "87:                 }",
          "112:                     }",
          "131:                     }",
          "151:                     }",
          "152:                 }",
          "153:             }",
          "",
          "[Removed Lines]",
          "63:         if (! empty($proxyIPs) && ! is_array($proxyIPs)) {",
          "64:             $proxyIPs = explode(',', str_replace(' ', '', $proxyIPs));",
          "70:             foreach (['x-forwarded-for', 'client-ip', 'x-client-ip', 'x-cluster-client-ip'] as $header) {",
          "71:                 $spoof     = null;",
          "72:                 $headerObj = $this->header($header);",
          "74:                 if ($headerObj !== null) {",
          "75:                     $spoof = $headerObj->getValue();",
          "80:                     sscanf($spoof, '%[^,]', $spoof);",
          "82:                     if (! $ipValidator($spoof)) {",
          "83:                         $spoof = null;",
          "84:                     } else {",
          "85:                         break;",
          "86:                     }",
          "88:             }",
          "90:             if ($spoof) {",
          "91:                 foreach ($proxyIPs as $proxyIP) {",
          "93:                     if (strpos($proxyIP, '/') === false) {",
          "96:                         if ($proxyIP === $this->ipAddress) {",
          "97:                             $this->ipAddress = $spoof;",
          "98:                             break;",
          "99:                         }",
          "101:                         continue;",
          "102:                     }",
          "105:                     if (! isset($separator)) {",
          "106:                         $separator = $ipValidator($this->ipAddress, 'ipv6') ? ':' : '.';",
          "107:                     }",
          "110:                     if (strpos($proxyIP, $separator) === false) {",
          "111:                         continue;",
          "115:                     if (! isset($ip, $sprintf)) {",
          "116:                         if ($separator === ':') {",
          "118:                             $ip = explode(':', str_replace('::', str_repeat(':', 9 - substr_count($this->ipAddress, ':')), $this->ipAddress));",
          "120:                             for ($j = 0; $j < 8; $j++) {",
          "121:                                 $ip[$j] = intval($ip[$j], 16);",
          "122:                             }",
          "124:                             $sprintf = '%016b%016b%016b%016b%016b%016b%016b%016b';",
          "125:                         } else {",
          "126:                             $ip      = explode('.', $this->ipAddress);",
          "127:                             $sprintf = '%08b%08b%08b%08b';",
          "128:                         }",
          "130:                         $ip = vsprintf($sprintf, $ip);",
          "134:                     sscanf($proxyIP, '%[^/]/%d', $netaddr, $masklen);",
          "137:                     if ($separator === ':') {",
          "138:                         $netaddr = explode(':', str_replace('::', str_repeat(':', 9 - substr_count($netaddr, ':')), $netaddr));",
          "140:                         for ($i = 0; $i < 8; $i++) {",
          "141:                             $netaddr[$i] = intval($netaddr[$i], 16);",
          "142:                         }",
          "143:                     } else {",
          "144:                         $netaddr = explode('.', $netaddr);",
          "145:                     }",
          "148:                     if (strncmp($ip, vsprintf($sprintf, $netaddr), $masklen) === 0) {",
          "149:                         $this->ipAddress = $spoof;",
          "150:                         break;",
          "",
          "[Added Lines]",
          "65:         if (! empty($proxyIPs)) {",
          "67:             if (! is_array($proxyIPs) || is_int(array_keys($proxyIPs)[0])) {",
          "68:                 throw new ConfigException(",
          "69:                     'You must set an array with Proxy IP address key and HTTP header name value in Config\\App::$proxyIPs.'",
          "70:                 );",
          "71:             }",
          "77:             foreach ($proxyIPs as $proxyIP => $header) {",
          "79:                 if (strpos($proxyIP, '/') === false) {",
          "82:                     if ($proxyIP === $this->ipAddress) {",
          "83:                         $spoof     = null;",
          "84:                         $headerObj = $this->header($header);",
          "86:                         if ($headerObj !== null) {",
          "87:                             $spoof = $headerObj->getValue();",
          "92:                             sscanf($spoof, '%[^,]', $spoof);",
          "94:                             if (! $ipValidator($spoof)) {",
          "95:                                 $spoof = null;",
          "96:                             } else {",
          "97:                                 $this->ipAddress = $spoof;",
          "98:                                 break;",
          "99:                             }",
          "100:                         }",
          "101:                     }",
          "103:                     continue;",
          "104:                 }",
          "107:                 if (! isset($separator)) {",
          "108:                     $separator = $ipValidator($this->ipAddress, 'ipv6') ? ':' : '.';",
          "112:                 if (strpos($proxyIP, $separator) === false) {",
          "113:                     continue;",
          "114:                 }",
          "117:                 if (! isset($ip, $sprintf)) {",
          "118:                     if ($separator === ':') {",
          "120:                         $ip = explode(':', str_replace('::', str_repeat(':', 9 - substr_count($this->ipAddress, ':')), $this->ipAddress));",
          "122:                         for ($j = 0; $j < 8; $j++) {",
          "123:                             $ip[$j] = intval($ip[$j], 16);",
          "124:                         }",
          "126:                         $sprintf = '%016b%016b%016b%016b%016b%016b%016b%016b';",
          "127:                     } else {",
          "128:                         $ip      = explode('.', $this->ipAddress);",
          "129:                         $sprintf = '%08b%08b%08b%08b';",
          "132:                     $ip = vsprintf($sprintf, $ip);",
          "133:                 }",
          "136:                 sscanf($proxyIP, '%[^/]/%d', $netaddr, $masklen);",
          "139:                 if ($separator === ':') {",
          "140:                     $netaddr = explode(':', str_replace('::', str_repeat(':', 9 - substr_count($netaddr, ':')), $netaddr));",
          "142:                     for ($i = 0; $i < 8; $i++) {",
          "143:                         $netaddr[$i] = intval($netaddr[$i], 16);",
          "145:                 } else {",
          "146:                     $netaddr = explode('.', $netaddr);",
          "147:                 }",
          "150:                 if (strncmp($ip, vsprintf($sprintf, $netaddr), $masklen) === 0) {",
          "151:                     $spoof     = null;",
          "152:                     $headerObj = $this->header($header);",
          "154:                     if ($headerObj !== null) {",
          "155:                         $spoof = $headerObj->getValue();",
          "160:                         sscanf($spoof, '%[^,]', $spoof);",
          "162:                         if (! $ipValidator($spoof)) {",
          "163:                             $spoof = null;",
          "164:                         } else {",
          "165:                             $this->ipAddress = $spoof;",
          "166:                             break;",
          "167:                         }",
          "",
          "---------------"
        ],
        "system/Test/Mock/MockAppConfig.php||system/Test/Mock/MockAppConfig.php": [
          "File: system/Test/Mock/MockAppConfig.php -> system/Test/Mock/MockAppConfig.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "23:     public $cookieSecure     = false;",
          "24:     public $cookieHTTPOnly   = false;",
          "25:     public $cookieSameSite   = 'Lax';",
          "27:     public $CSRFTokenName    = 'csrf_test_name';",
          "28:     public $CSRFHeaderName   = 'X-CSRF-TOKEN';",
          "29:     public $CSRFCookieName   = 'csrf_cookie_name';",
          "",
          "[Removed Lines]",
          "26:     public $proxyIPs         = '';",
          "",
          "[Added Lines]",
          "26:     public $proxyIPs         = [];",
          "",
          "---------------"
        ],
        "system/Test/Mock/MockCLIConfig.php||system/Test/Mock/MockCLIConfig.php": [
          "File: system/Test/Mock/MockCLIConfig.php -> system/Test/Mock/MockCLIConfig.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "23:     public $cookieSecure     = false;",
          "24:     public $cookieHTTPOnly   = false;",
          "25:     public $cookieSameSite   = 'Lax';",
          "27:     public $CSRFTokenName    = 'csrf_test_name';",
          "28:     public $CSRFCookieName   = 'csrf_cookie_name';",
          "29:     public $CSRFExpire       = 7200;",
          "",
          "[Removed Lines]",
          "26:     public $proxyIPs         = '';",
          "",
          "[Added Lines]",
          "26:     public $proxyIPs         = [];",
          "",
          "---------------"
        ],
        "tests/system/HTTP/IncomingRequestTest.php||tests/system/HTTP/IncomingRequestTest.php": [
          "File: tests/system/HTTP/IncomingRequestTest.php -> tests/system/HTTP/IncomingRequestTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "714:         $expected                        = '123.123.123.123';",
          "715:         $_SERVER['HTTP_X_FORWARDED_FOR'] = $expected;",
          "716:         $_SERVER['REMOTE_ADDR']          = '10.0.1.200';",
          "720:         $this->request = new Request($config);",
          "721:         $this->request->populateHeaders();",
          "",
          "[Removed Lines]",
          "717:         $config                          = new App();",
          "718:         $config->proxyIPs                = '10.0.1.200,192.168.5.0/24';",
          "",
          "[Added Lines]",
          "718:         $config           = new App();",
          "719:         $config->proxyIPs = [",
          "720:             '10.0.1.200'     => 'X-Forwarded-For',",
          "721:             '192.168.5.0/24' => 'X-Forwarded-For',",
          "722:         ];",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "729:         $_SERVER['HTTP_X_FORWARDED_FOR'] = '123.456.23.123';",
          "730:         $expected                        = '10.0.1.200';",
          "731:         $_SERVER['REMOTE_ADDR']          = $expected;",
          "735:         $this->request = new Request($config);",
          "736:         $this->request->populateHeaders();",
          "",
          "[Removed Lines]",
          "732:         $config                          = new App();",
          "733:         $config->proxyIPs                = '10.0.1.200,192.168.5.0/24';",
          "",
          "[Added Lines]",
          "736:         $config           = new App();",
          "737:         $config->proxyIPs = [",
          "738:             '10.0.1.200'     => 'X-Forwarded-For',",
          "739:             '192.168.5.0/24' => 'X-Forwarded-For',",
          "740:         ];",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "744:         $expected                        = '10.10.1.200';",
          "745:         $_SERVER['REMOTE_ADDR']          = $expected;",
          "746:         $_SERVER['HTTP_X_FORWARDED_FOR'] = '123.456.23.123';",
          "750:         $this->request = new Request($config);",
          "751:         $this->request->populateHeaders();",
          "",
          "[Removed Lines]",
          "747:         $config                          = new App();",
          "748:         $config->proxyIPs                = '10.0.1.200,192.168.5.0/24';",
          "",
          "[Added Lines]",
          "754:         $config           = new App();",
          "755:         $config->proxyIPs = [",
          "756:             '10.0.1.200'     => 'X-Forwarded-For',",
          "757:             '192.168.5.0/24' => 'X-Forwarded-For',",
          "758:         ];",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "759:         $expected                        = '123.123.123.123';",
          "760:         $_SERVER['HTTP_X_FORWARDED_FOR'] = $expected;",
          "761:         $_SERVER['REMOTE_ADDR']          = '192.168.5.21';",
          "766:         $this->request->populateHeaders();",
          "",
          "[Removed Lines]",
          "762:         $config                          = new App();",
          "763:         $config->proxyIPs                = ['192.168.5.0/24'];",
          "765:         $this->request = new Request($config);",
          "",
          "[Added Lines]",
          "772:         $config           = new App();",
          "773:         $config->proxyIPs = ['192.168.5.0/24' => 'X-Forwarded-For'];",
          "774:         $this->request    = new Request($config);",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "773:     {",
          "774:         $expected                        = '192.168.5.21';",
          "775:         $_SERVER['REMOTE_ADDR']          = $expected;",
          "778:         $_SERVER['HTTP_X_FORWARDED_FOR'] = '123.123.123.123';",
          "780:         $this->request->populateHeaders();",
          "",
          "[Removed Lines]",
          "776:         $config                          = new App();",
          "777:         $config->proxyIPs                = ['192.168.5.0/28'];",
          "779:         $this->request                   = new Request($config);",
          "",
          "[Added Lines]",
          "787:         $config           = new App();",
          "788:         $config->proxyIPs = ['192.168.5.0/28' => 'X-Forwarded-For'];",
          "789:         $this->request    = new Request($config);",
          "",
          "---------------"
        ],
        "tests/system/HTTP/RequestTest.php||tests/system/HTTP/RequestTest.php": [
          "File: tests/system/HTTP/RequestTest.php -> tests/system/HTTP/RequestTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "609:     {",
          "610:         $expected                        = '123.123.123.123';",
          "611:         $_SERVER['REMOTE_ADDR']          = '10.0.1.200';",
          "614:         $_SERVER['HTTP_X_FORWARDED_FOR'] = $expected;",
          "616:         $this->request->populateHeaders();",
          "",
          "[Removed Lines]",
          "612:         $config                          = new App();",
          "613:         $config->proxyIPs                = '10.0.1.200,192.168.5.0/24';",
          "615:         $this->request                   = new Request($config);",
          "",
          "[Added Lines]",
          "614:         $config           = new App();",
          "615:         $config->proxyIPs = [",
          "616:             '10.0.1.200'     => 'X-Forwarded-For',",
          "617:             '192.168.5.0/24' => 'X-Forwarded-For',",
          "618:         ];",
          "619:         $this->request = new Request($config);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "623:     {",
          "624:         $expected                        = '123.456.23.123';",
          "625:         $_SERVER['REMOTE_ADDR']          = '10.0.1.200';",
          "628:         $_SERVER['HTTP_X_FORWARDED_FOR'] = $expected;",
          "630:         $this->request->populateHeaders();",
          "",
          "[Removed Lines]",
          "626:         $config                          = new App();",
          "627:         $config->proxyIPs                = '10.0.1.200,192.168.5.0/24';",
          "629:         $this->request                   = new Request($config);",
          "",
          "[Added Lines]",
          "631:         $config                          = new App();",
          "632:         $config->proxyIPs                = [",
          "633:             '10.0.1.200'     => 'X-Forwarded-For',",
          "634:             '192.168.5.0/24' => 'X-Forwarded-For',",
          "635:         ];",
          "637:         $this->request = new Request($config);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "637:     {",
          "638:         $expected                        = '123.456.23.123';",
          "639:         $_SERVER['REMOTE_ADDR']          = '10.10.1.200';",
          "642:         $_SERVER['HTTP_X_FORWARDED_FOR'] = $expected;",
          "644:         $this->request->populateHeaders();",
          "",
          "[Removed Lines]",
          "640:         $config                          = new App();",
          "641:         $config->proxyIPs                = '10.0.1.200,192.168.5.0/24';",
          "643:         $this->request                   = new Request($config);",
          "",
          "[Added Lines]",
          "650:         $config           = new App();",
          "651:         $config->proxyIPs = [",
          "652:             '10.0.1.200'     => 'X-Forwarded-For',",
          "653:             '192.168.5.0/24' => 'X-Forwarded-For',",
          "654:         ];",
          "655:         $this->request = new Request($config);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "651:     {",
          "652:         $expected                        = '123.123.123.123';",
          "653:         $_SERVER['REMOTE_ADDR']          = '192.168.5.21';",
          "656:         $_SERVER['HTTP_X_FORWARDED_FOR'] = $expected;",
          "658:         $this->request->populateHeaders();",
          "",
          "[Removed Lines]",
          "654:         $config                          = new App();",
          "655:         $config->proxyIPs                = ['192.168.5.0/24'];",
          "657:         $this->request                   = new Request($config);",
          "",
          "[Added Lines]",
          "668:         $config           = new App();",
          "669:         $config->proxyIPs = ['192.168.5.0/24' => 'X-Forwarded-For'];",
          "670:         $this->request    = new Request($config);",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "665:     {",
          "666:         $expected                        = '123.123.123.123';",
          "667:         $_SERVER['REMOTE_ADDR']          = '192.168.5.21';",
          "670:         $_SERVER['HTTP_X_FORWARDED_FOR'] = $expected;",
          "672:         $this->request->populateHeaders();",
          "",
          "[Removed Lines]",
          "668:         $config                          = new App();",
          "669:         $config->proxyIPs                = ['192.168.5.0/28'];",
          "671:         $this->request                   = new Request($config);",
          "",
          "[Added Lines]",
          "683:         $config           = new App();",
          "684:         $config->proxyIPs = ['192.168.5.0/28' => 'X-Forwarded-For'];",
          "685:         $this->request    = new Request($config);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "fbc46bb9db67ffbc2fb0a70bb69dd33221b5f6fd",
      "candidate_info": {
        "commit_hash": "fbc46bb9db67ffbc2fb0a70bb69dd33221b5f6fd",
        "repo": "codeigniter4/CodeIgniter4",
        "commit_url": "https://github.com/codeigniter4/CodeIgniter4/commit/fbc46bb9db67ffbc2fb0a70bb69dd33221b5f6fd",
        "files": [
          "system/HTTP/RequestTrait.php"
        ],
        "message": "docs: add doc comment",
        "before_after_code_files": [
          "system/HTTP/RequestTrait.php||system/HTTP/RequestTrait.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/codeigniter4/CodeIgniter4/pull/7002"
        ],
        "olp_code_files": {
          "patch": [
            "system/HTTP/RequestTrait.php||system/HTTP/RequestTrait.php"
          ],
          "candidate": [
            "system/HTTP/RequestTrait.php||system/HTTP/RequestTrait.php"
          ]
        }
      },
      "candidate_diff": {
        "system/HTTP/RequestTrait.php||system/HTTP/RequestTrait.php": [
          "File: system/HTTP/RequestTrait.php -> system/HTTP/RequestTrait.php"
        ]
      }
    },
    {
      "candidate_hash": "900bc84f4aecc439f6a853ba32f023e6f6f88972",
      "candidate_info": {
        "commit_hash": "900bc84f4aecc439f6a853ba32f023e6f6f88972",
        "repo": "codeigniter4/CodeIgniter4",
        "commit_url": "https://github.com/codeigniter4/CodeIgniter4/commit/900bc84f4aecc439f6a853ba32f023e6f6f88972",
        "files": [
          "tests/system/HTTP/IncomingRequestTest.php"
        ],
        "message": "test: fix test names",
        "before_after_code_files": [
          "tests/system/HTTP/IncomingRequestTest.php||tests/system/HTTP/IncomingRequestTest.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/codeigniter4/CodeIgniter4/pull/7002"
        ],
        "olp_code_files": {
          "patch": [
            "tests/system/HTTP/IncomingRequestTest.php||tests/system/HTTP/IncomingRequestTest.php"
          ],
          "candidate": [
            "tests/system/HTTP/IncomingRequestTest.php||tests/system/HTTP/IncomingRequestTest.php"
          ]
        }
      },
      "candidate_diff": {
        "tests/system/HTTP/IncomingRequestTest.php||tests/system/HTTP/IncomingRequestTest.php": [
          "File: tests/system/HTTP/IncomingRequestTest.php -> tests/system/HTTP/IncomingRequestTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "728:         $this->assertSame($expected, $this->request->getIPAddress());",
          "729:     }",
          "732:     {",
          "733:         $_SERVER['HTTP_X_FORWARDED_FOR'] = '123.456.23.123';",
          "734:         $expected                        = '10.0.1.200';",
          "",
          "[Removed Lines]",
          "731:     public function testGetIPAddressThruProxyInvalid()",
          "",
          "[Added Lines]",
          "731:     public function testGetIPAddressThruProxyInvalidIPAddress()",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "779:         $this->assertSame($expected, $this->request->getIPAddress());",
          "780:     }",
          "783:     {",
          "784:         $expected                        = '192.168.5.21';",
          "785:         $_SERVER['REMOTE_ADDR']          = $expected;",
          "",
          "[Removed Lines]",
          "782:     public function testGetIPAddressThruProxyOutofSubnet()",
          "",
          "[Added Lines]",
          "782:     public function testGetIPAddressThruProxyOutOfSubnet()",
          "",
          "---------------"
        ]
      }
    }
  ]
}