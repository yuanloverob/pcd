{
  "cve_id": "CVE-2021-41143",
  "cve_desc": "OpenMage LTS is an e-commerce platform. Prior to versions 19.4.22 and 20.0.19, Magento admin users with access to the customer media could execute code on the server. Versions 19.4.22 and 20.0.19 contain a patch for this issue.\n\n",
  "repo": "OpenMage/magento-lts",
  "patch_hash": "45330ff50439984e806992fa22c3f96c4d660f91",
  "patch_info": {
    "commit_hash": "45330ff50439984e806992fa22c3f96c4d660f91",
    "repo": "OpenMage/magento-lts",
    "commit_url": "https://github.com/OpenMage/magento-lts/commit/45330ff50439984e806992fa22c3f96c4d660f91",
    "files": [
      "app/code/core/Mage/Cms/Model/Wysiwyg/Images/Storage.php"
    ],
    "message": "Merge pull request from GHSA-5vpv-xmcj-9q85\n\nCo-authored-by: Fabrizio Balliano <fabrizio.balliano@gmail.com>",
    "before_after_code_files": [
      "app/code/core/Mage/Cms/Model/Wysiwyg/Images/Storage.php||app/code/core/Mage/Cms/Model/Wysiwyg/Images/Storage.php"
    ]
  },
  "patch_diff": {
    "app/code/core/Mage/Cms/Model/Wysiwyg/Images/Storage.php||app/code/core/Mage/Cms/Model/Wysiwyg/Images/Storage.php": [
      "File: app/code/core/Mage/Cms/Model/Wysiwyg/Images/Storage.php -> app/code/core/Mage/Cms/Model/Wysiwyg/Images/Storage.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "233:                 $io->getFilteredPath($path)",
      "234:             ));",
      "235:         }",
      "237:         if (Mage::helper('core/file_storage_database')->checkDbUsage()) {",
      "238:             Mage::getModel('core/file_storage_directory_database')->deleteDirectory($path);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "236:         if (strpos($pathCmp, chr(0)) !== false",
      "237:             || preg_match('#(^|[\\\\\\\\/])\\.\\.($|[\\\\\\\\/])#', $pathCmp)",
      "238:         ) {",
      "239:             throw new Exception('Detected malicious path or filename input.');",
      "240:         }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "066de0de71611fffc6019395d6fabfd848c881c6",
      "candidate_info": {
        "commit_hash": "066de0de71611fffc6019395d6fabfd848c881c6",
        "repo": "OpenMage/magento-lts",
        "commit_url": "https://github.com/OpenMage/magento-lts/commit/066de0de71611fffc6019395d6fabfd848c881c6",
        "files": [
          "app/code/core/Mage/Cms/Model/Wysiwyg/Images/Storage.php"
        ],
        "message": "Merge pull request from GHSA-5vpv-xmcj-9q85\n\nCo-authored-by: Fabrizio Balliano <fabrizio.balliano@gmail.com>",
        "before_after_code_files": [
          "app/code/core/Mage/Cms/Model/Wysiwyg/Images/Storage.php||app/code/core/Mage/Cms/Model/Wysiwyg/Images/Storage.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "app/code/core/Mage/Cms/Model/Wysiwyg/Images/Storage.php||app/code/core/Mage/Cms/Model/Wysiwyg/Images/Storage.php"
          ],
          "candidate": [
            "app/code/core/Mage/Cms/Model/Wysiwyg/Images/Storage.php||app/code/core/Mage/Cms/Model/Wysiwyg/Images/Storage.php"
          ]
        }
      },
      "candidate_diff": {
        "app/code/core/Mage/Cms/Model/Wysiwyg/Images/Storage.php||app/code/core/Mage/Cms/Model/Wysiwyg/Images/Storage.php": [
          "File: app/code/core/Mage/Cms/Model/Wysiwyg/Images/Storage.php -> app/code/core/Mage/Cms/Model/Wysiwyg/Images/Storage.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "233:                 $io->getFilteredPath($path)",
          "234:             ));",
          "235:         }",
          "237:         if (Mage::helper('core/file_storage_database')->checkDbUsage()) {",
          "238:             Mage::getModel('core/file_storage_directory_database')->deleteDirectory($path);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "236:         if (strpos($pathCmp, chr(0)) !== false",
          "237:             || preg_match('#(^|[\\\\\\\\/])\\.\\.($|[\\\\\\\\/])#', $pathCmp)",
          "238:         ) {",
          "239:             throw new Exception('Detected malicious path or filename input.');",
          "240:         }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "d31571c5529346dcc74e3e30f36183ea0219bd18",
      "candidate_info": {
        "commit_hash": "d31571c5529346dcc74e3e30f36183ea0219bd18",
        "repo": "OpenMage/magento-lts",
        "commit_url": "https://github.com/OpenMage/magento-lts/commit/d31571c5529346dcc74e3e30f36183ea0219bd18",
        "files": [
          "app/code/core/Mage/Cms/Model/Wysiwyg/Images/Storage.php"
        ],
        "message": "Merge pull request from GHSA-5vpv-xmcj-9q85\n\nCo-authored-by: Fabrizio Balliano <fabrizio.balliano@gmail.com>",
        "before_after_code_files": [
          "app/code/core/Mage/Cms/Model/Wysiwyg/Images/Storage.php||app/code/core/Mage/Cms/Model/Wysiwyg/Images/Storage.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "app/code/core/Mage/Cms/Model/Wysiwyg/Images/Storage.php||app/code/core/Mage/Cms/Model/Wysiwyg/Images/Storage.php"
          ],
          "candidate": [
            "app/code/core/Mage/Cms/Model/Wysiwyg/Images/Storage.php||app/code/core/Mage/Cms/Model/Wysiwyg/Images/Storage.php"
          ]
        }
      },
      "candidate_diff": {
        "app/code/core/Mage/Cms/Model/Wysiwyg/Images/Storage.php||app/code/core/Mage/Cms/Model/Wysiwyg/Images/Storage.php": [
          "File: app/code/core/Mage/Cms/Model/Wysiwyg/Images/Storage.php -> app/code/core/Mage/Cms/Model/Wysiwyg/Images/Storage.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "230:                 $io->getFilteredPath($path)",
          "231:             ));",
          "232:         }",
          "234:         if (Mage::helper('core/file_storage_database')->checkDbUsage()) {",
          "235:             Mage::getModel('core/file_storage_directory_database')->deleteDirectory($path);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "232:         }",
          "233:         if (strpos($pathCmp, chr(0)) !== false",
          "234:             || preg_match('#(^|[\\\\\\\\/])\\.\\.($|[\\\\\\\\/])#', $pathCmp)",
          "235:         ) {",
          "236:             throw new Exception('Detected malicious path or filename input.');",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "0ef51ec1d49dc9273b6bd9c9c7ba500775fbcfaa",
      "candidate_info": {
        "commit_hash": "0ef51ec1d49dc9273b6bd9c9c7ba500775fbcfaa",
        "repo": "OpenMage/magento-lts",
        "commit_url": "https://github.com/OpenMage/magento-lts/commit/0ef51ec1d49dc9273b6bd9c9c7ba500775fbcfaa",
        "files": [
          "app/code/core/Mage/Cms/Model/Wysiwyg/Images/Storage.php"
        ],
        "message": "Merge pull request from GHSA-5vpv-xmcj-9q85\n\nCo-authored-by: Fabrizio Balliano <fabrizio.balliano@gmail.com>",
        "before_after_code_files": [
          "app/code/core/Mage/Cms/Model/Wysiwyg/Images/Storage.php||app/code/core/Mage/Cms/Model/Wysiwyg/Images/Storage.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "app/code/core/Mage/Cms/Model/Wysiwyg/Images/Storage.php||app/code/core/Mage/Cms/Model/Wysiwyg/Images/Storage.php"
          ],
          "candidate": [
            "app/code/core/Mage/Cms/Model/Wysiwyg/Images/Storage.php||app/code/core/Mage/Cms/Model/Wysiwyg/Images/Storage.php"
          ]
        }
      },
      "candidate_diff": {
        "app/code/core/Mage/Cms/Model/Wysiwyg/Images/Storage.php||app/code/core/Mage/Cms/Model/Wysiwyg/Images/Storage.php": [
          "File: app/code/core/Mage/Cms/Model/Wysiwyg/Images/Storage.php -> app/code/core/Mage/Cms/Model/Wysiwyg/Images/Storage.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "231:                 $io->getFilteredPath($path)",
          "232:             ));",
          "233:         }",
          "235:         if (Mage::helper('core/file_storage_database')->checkDbUsage()) {",
          "236:             Mage::getModel('core/file_storage_directory_database')->deleteDirectory($path);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "233:         }",
          "234:         if (strpos($pathCmp, chr(0)) !== false",
          "235:             || preg_match('#(^|[\\\\\\\\/])\\.\\.($|[\\\\\\\\/])#', $pathCmp)",
          "236:         ) {",
          "237:             throw new Exception('Detected malicious path or filename input.');",
          "",
          "---------------"
        ]
      }
    }
  ]
}