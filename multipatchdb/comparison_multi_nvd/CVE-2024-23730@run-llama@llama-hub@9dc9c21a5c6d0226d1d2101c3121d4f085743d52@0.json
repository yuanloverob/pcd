{
  "cve_id": "CVE-2024-23730",
  "cve_desc": "The OpenAPI and ChatGPT plugin loaders in LlamaHub (aka llama-hub) before 0.0.67 allow attackers to execute arbitrary code because safe_load is not used for YAML.",
  "repo": "run-llama/llama-hub",
  "patch_hash": "9dc9c21a5c6d0226d1d2101c3121d4f085743d52",
  "patch_info": {
    "commit_hash": "9dc9c21a5c6d0226d1d2101c3121d4f085743d52",
    "repo": "run-llama/llama-hub",
    "commit_url": "https://github.com/run-llama/llama-hub/commit/9dc9c21a5c6d0226d1d2101c3121d4f085743d52",
    "files": [
      "llama_hub/tools/chatgpt_plugin/README.md",
      "llama_hub/tools/chatgpt_plugin/base.py",
      "llama_hub/tools/notebooks/chatgpt_plugin.ipynb",
      "llama_hub/tools/notebooks/openapi_and_requests.ipynb",
      "llama_hub/tools/openapi/README.md",
      "llama_hub/tools/openapi/base.py"
    ],
    "message": "use safe_load for yaml",
    "before_after_code_files": [
      "llama_hub/tools/chatgpt_plugin/base.py||llama_hub/tools/chatgpt_plugin/base.py",
      "llama_hub/tools/notebooks/chatgpt_plugin.ipynb||llama_hub/tools/notebooks/chatgpt_plugin.ipynb",
      "llama_hub/tools/notebooks/openapi_and_requests.ipynb||llama_hub/tools/notebooks/openapi_and_requests.ipynb",
      "llama_hub/tools/openapi/base.py||llama_hub/tools/openapi/base.py"
    ]
  },
  "patch_diff": {
    "llama_hub/tools/chatgpt_plugin/base.py||llama_hub/tools/chatgpt_plugin/base.py": [
      "File: llama_hub/tools/chatgpt_plugin/base.py -> llama_hub/tools/chatgpt_plugin/base.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "31:             pass",
      "32:         elif manifest_url:",
      "33:             response = requests.get(manifest_url).text",
      "35:         else:",
      "36:             raise ValueError(\"You must provide either a manifest or a manifest_url\")",
      "",
      "[Removed Lines]",
      "34:             manifest = yaml.load(response, Loader=yaml.Loader)",
      "",
      "[Added Lines]",
      "34:             manifest = yaml.safe_load(response)",
      "",
      "---------------"
    ],
    "llama_hub/tools/notebooks/chatgpt_plugin.ipynb||llama_hub/tools/notebooks/chatgpt_plugin.ipynb": [
      "File: llama_hub/tools/notebooks/chatgpt_plugin.ipynb -> llama_hub/tools/notebooks/chatgpt_plugin.ipynb",
      "--- Hunk 1 ---",
      "[Context before]",
      "27:     \"f = requests.get(\\n\",",
      "28:     \"    \\\"https://raw.githubusercontent.com/sisbell/chatgpt-plugin-store/main/manifests/today-currency-converter.oiconma.repl.co.json\\\"\\n\",",
      "29:     \").text\\n\",",
      "31:    ]",
      "32:   },",
      "33:   {",
      "",
      "[Removed Lines]",
      "30:     \"manifest = yaml.load(f, Loader=yaml.Loader)\"",
      "",
      "[Added Lines]",
      "30:     \"manifest = yaml.safe_load(f)\"",
      "",
      "---------------"
    ],
    "llama_hub/tools/notebooks/openapi_and_requests.ipynb||llama_hub/tools/notebooks/openapi_and_requests.ipynb": [
      "File: llama_hub/tools/notebooks/openapi_and_requests.ipynb -> llama_hub/tools/notebooks/openapi_and_requests.ipynb",
      "--- Hunk 1 ---",
      "[Context before]",
      "28:     \"f = requests.get(\\n\",",
      "29:     \"    \\\"https://raw.githubusercontent.com/APIs-guru/openapi-directory/main/APIs/openai.com/1.2.0/openapi.yaml\\\"\\n\",",
      "30:     \").text\\n\",",
      "32:    ]",
      "33:   },",
      "34:   {",
      "",
      "[Removed Lines]",
      "31:     \"open_api_spec = yaml.load(f, Loader=yaml.Loader)\"",
      "",
      "[Added Lines]",
      "31:     \"open_api_spec = yaml.safe_load(f)\"",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "240:  },",
      "241:  \"nbformat\": 4,",
      "242:  \"nbformat_minor\": 5",
      "",
      "[Removed Lines]",
      "243: }",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ],
    "llama_hub/tools/openapi/base.py||llama_hub/tools/openapi/base.py": [
      "File: llama_hub/tools/openapi/base.py -> llama_hub/tools/openapi/base.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "26:             pass",
      "27:         elif url:",
      "28:             response = requests.get(url).text",
      "30:         else:",
      "31:             raise ValueError(\"You must provide a url or OpenAPI spec as a dict\")",
      "",
      "[Removed Lines]",
      "29:             spec = yaml.load(response, Loader=yaml.Loader)",
      "",
      "[Added Lines]",
      "29:             spec = yaml.safe_load(response)",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "c01416e737c7747a213a79881b8308c41d043515",
      "candidate_info": {
        "commit_hash": "c01416e737c7747a213a79881b8308c41d043515",
        "repo": "run-llama/llama-hub",
        "commit_url": "https://github.com/run-llama/llama-hub/commit/c01416e737c7747a213a79881b8308c41d043515",
        "files": [
          "llama_hub/tools/chatgpt_plugin/README.md",
          "llama_hub/tools/chatgpt_plugin/base.py",
          "llama_hub/tools/notebooks/chatgpt_plugin.ipynb",
          "llama_hub/tools/notebooks/openapi_and_requests.ipynb",
          "llama_hub/tools/openapi/README.md",
          "llama_hub/tools/openapi/base.py"
        ],
        "message": "use safe_load for yaml (#841)",
        "before_after_code_files": [
          "llama_hub/tools/chatgpt_plugin/base.py||llama_hub/tools/chatgpt_plugin/base.py",
          "llama_hub/tools/notebooks/chatgpt_plugin.ipynb||llama_hub/tools/notebooks/chatgpt_plugin.ipynb",
          "llama_hub/tools/notebooks/openapi_and_requests.ipynb||llama_hub/tools/notebooks/openapi_and_requests.ipynb",
          "llama_hub/tools/openapi/base.py||llama_hub/tools/openapi/base.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/run-llama/llama-hub/pull/841"
        ],
        "olp_code_files": {
          "patch": [
            "llama_hub/tools/chatgpt_plugin/base.py||llama_hub/tools/chatgpt_plugin/base.py",
            "llama_hub/tools/notebooks/chatgpt_plugin.ipynb||llama_hub/tools/notebooks/chatgpt_plugin.ipynb",
            "llama_hub/tools/notebooks/openapi_and_requests.ipynb||llama_hub/tools/notebooks/openapi_and_requests.ipynb",
            "llama_hub/tools/openapi/base.py||llama_hub/tools/openapi/base.py"
          ],
          "candidate": [
            "llama_hub/tools/chatgpt_plugin/base.py||llama_hub/tools/chatgpt_plugin/base.py",
            "llama_hub/tools/notebooks/chatgpt_plugin.ipynb||llama_hub/tools/notebooks/chatgpt_plugin.ipynb",
            "llama_hub/tools/notebooks/openapi_and_requests.ipynb||llama_hub/tools/notebooks/openapi_and_requests.ipynb",
            "llama_hub/tools/openapi/base.py||llama_hub/tools/openapi/base.py"
          ]
        }
      },
      "candidate_diff": {
        "llama_hub/tools/chatgpt_plugin/base.py||llama_hub/tools/chatgpt_plugin/base.py": [
          "File: llama_hub/tools/chatgpt_plugin/base.py -> llama_hub/tools/chatgpt_plugin/base.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "31:             pass",
          "32:         elif manifest_url:",
          "33:             response = requests.get(manifest_url).text",
          "35:         else:",
          "36:             raise ValueError(\"You must provide either a manifest or a manifest_url\")",
          "",
          "[Removed Lines]",
          "34:             manifest = yaml.load(response, Loader=yaml.Loader)",
          "",
          "[Added Lines]",
          "34:             manifest = yaml.safe_load(response)",
          "",
          "---------------"
        ],
        "llama_hub/tools/notebooks/chatgpt_plugin.ipynb||llama_hub/tools/notebooks/chatgpt_plugin.ipynb": [
          "File: llama_hub/tools/notebooks/chatgpt_plugin.ipynb -> llama_hub/tools/notebooks/chatgpt_plugin.ipynb",
          "--- Hunk 1 ---",
          "[Context before]",
          "27:     \"f = requests.get(\\n\",",
          "28:     \"    \\\"https://raw.githubusercontent.com/sisbell/chatgpt-plugin-store/main/manifests/today-currency-converter.oiconma.repl.co.json\\\"\\n\",",
          "29:     \").text\\n\",",
          "31:    ]",
          "32:   },",
          "33:   {",
          "",
          "[Removed Lines]",
          "30:     \"manifest = yaml.load(f, Loader=yaml.Loader)\"",
          "",
          "[Added Lines]",
          "30:     \"manifest = yaml.safe_load(f)\"",
          "",
          "---------------"
        ],
        "llama_hub/tools/notebooks/openapi_and_requests.ipynb||llama_hub/tools/notebooks/openapi_and_requests.ipynb": [
          "File: llama_hub/tools/notebooks/openapi_and_requests.ipynb -> llama_hub/tools/notebooks/openapi_and_requests.ipynb",
          "--- Hunk 1 ---",
          "[Context before]",
          "28:     \"f = requests.get(\\n\",",
          "29:     \"    \\\"https://raw.githubusercontent.com/APIs-guru/openapi-directory/main/APIs/openai.com/1.2.0/openapi.yaml\\\"\\n\",",
          "30:     \").text\\n\",",
          "32:    ]",
          "33:   },",
          "34:   {",
          "",
          "[Removed Lines]",
          "31:     \"open_api_spec = yaml.load(f, Loader=yaml.Loader)\"",
          "",
          "[Added Lines]",
          "31:     \"open_api_spec = yaml.safe_load(f)\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "240:  },",
          "241:  \"nbformat\": 4,",
          "242:  \"nbformat_minor\": 5",
          "",
          "[Removed Lines]",
          "243: }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "llama_hub/tools/openapi/base.py||llama_hub/tools/openapi/base.py": [
          "File: llama_hub/tools/openapi/base.py -> llama_hub/tools/openapi/base.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "26:             pass",
          "27:         elif url:",
          "28:             response = requests.get(url).text",
          "30:         else:",
          "31:             raise ValueError(\"You must provide a url or OpenAPI spec as a dict\")",
          "",
          "[Removed Lines]",
          "29:             spec = yaml.load(response, Loader=yaml.Loader)",
          "",
          "[Added Lines]",
          "29:             spec = yaml.safe_load(response)",
          "",
          "---------------"
        ]
      }
    }
  ]
}