{
  "cve_id": "CVE-2013-2506",
  "cve_desc": "app/models/spree/user.rb in spree_auth_devise in Spree 1.1.x before 1.1.6, 1.2.x, and 1.3.x does not perform mass assignment safely when updating a user, which allows remote authenticated users to assign arbitrary roles to themselves.",
  "repo": "spree/spree_auth_devise",
  "patch_hash": "038d74771d3b5c13d13b738b73dfda1033a99f65",
  "patch_info": {
    "commit_hash": "038d74771d3b5c13d13b738b73dfda1033a99f65",
    "repo": "spree/spree_auth_devise",
    "commit_url": "https://github.com/spree/spree_auth_devise/commit/038d74771d3b5c13d13b738b73dfda1033a99f65",
    "files": [
      "app/controllers/spree/admin/users_controller.rb",
      "app/models/spree/user.rb",
      "spec/controllers/spree/users_controller_spec.rb"
    ],
    "message": "Remove Mass Assignment of Role IDs",
    "before_after_code_files": [
      "app/controllers/spree/admin/users_controller.rb||app/controllers/spree/admin/users_controller.rb",
      "app/models/spree/user.rb||app/models/spree/user.rb",
      "spec/controllers/spree/users_controller_spec.rb||spec/controllers/spree/users_controller_spec.rb"
    ]
  },
  "patch_diff": {
    "app/controllers/spree/admin/users_controller.rb||app/controllers/spree/admin/users_controller.rb": [
      "File: app/controllers/spree/admin/users_controller.rb -> app/controllers/spree/admin/users_controller.rb",
      "--- Hunk 1 ---",
      "[Context before]",
      "16:         end",
      "17:       end",
      "19:       def generate_api_key",
      "20:         if @user.generate_spree_api_key!",
      "21:           flash.notice = t('key_generated', :scope => 'spree.api')",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "17:       end",
      "19:       def create",
      "20:         if params[:user]",
      "21:           roles = params[:user].delete(\"spree_role_ids\")",
      "22:         end",
      "24:         @user = Spree::User.new(params[:user])",
      "25:         if @user.save",
      "27:           if roles",
      "28:             @user.spree_roles = roles.reject(&:blank?).collect{|r| Spree::Role.find(r)}",
      "29:           end",
      "31:           flash.now[:notice] = t(:created_successfully)",
      "32:           render :edit",
      "33:         else",
      "34:           render :new",
      "35:         end",
      "36:       end",
      "38:       def update",
      "39:         if params[:user]",
      "40:           roles = params[:user].delete(\"spree_role_ids\")",
      "41:         end",
      "43:         if @user.update_attributes(params[:user])",
      "44:           if roles",
      "45:             @user.spree_roles = roles.reject(&:blank?).collect{|r| Spree::Role.find(r)}",
      "46:           end",
      "48:           if params[:user][:password].present?",
      "49:             # this logic needed b/c devise wants to log us out after password changes",
      "50:             user = Spree::User.reset_password_by_token(params[:user])",
      "51:             sign_in(@user, :event => :authentication, :bypass => !Spree::Auth::Config[:signout_after_password_change])",
      "52:           end",
      "53:           flash.now[:notice] = t(:account_updated)",
      "54:           render :edit",
      "55:         else",
      "56:           render :edit",
      "57:         end",
      "",
      "---------------"
    ],
    "app/models/spree/user.rb||app/models/spree/user.rb": [
      "File: app/models/spree/user.rb -> app/models/spree/user.rb",
      "--- Hunk 1 ---",
      "[Context before]",
      "14:     before_destroy :check_completed_orders",
      "16:     # Setup accessible (or protected) attributes for your model",
      "19:     users_table_name = User.table_name",
      "20:     roles_table_name = Role.table_name",
      "",
      "[Removed Lines]",
      "17:     attr_accessible :email, :password, :password_confirmation, :remember_me, :persistence_token, :login, :spree_role_ids",
      "",
      "[Added Lines]",
      "17:     attr_accessible :email, :password, :password_confirmation, :remember_me, :persistence_token, :login",
      "",
      "---------------"
    ],
    "spec/controllers/spree/users_controller_spec.rb||spec/controllers/spree/users_controller_spec.rb": [
      "File: spec/controllers/spree/users_controller_spec.rb -> spec/controllers/spree/users_controller_spec.rb",
      "--- Hunk 1 ---",
      "[Context before]",
      "3: describe Spree::UsersController do",
      "4:   let(:admin_user) { create(:user) }",
      "5:   let(:user) { create(:user) }",
      "7:   before do",
      "8:     controller.stub(:spree_current_user => user)",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "6:   let(:role) { create(:role) }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "23:         response.should redirect_to(spree.account_url(:only_path => true))",
      "24:       end",
      "25:     end",
      "26:   end",
      "27: end",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "28:     it 'should not update roles' do",
      "29:       expect { spree_put :update, { :user => { :spree_role_ids => [role.id] } }}.to raise_exception(ActiveModel::MassAssignmentSecurity::Error)",
      "30:     end",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "da9072fafaa9ac8f42d700779b0f01baf2eb6449",
      "candidate_info": {
        "commit_hash": "da9072fafaa9ac8f42d700779b0f01baf2eb6449",
        "repo": "spree/spree_auth_devise",
        "commit_url": "https://github.com/spree/spree_auth_devise/commit/da9072fafaa9ac8f42d700779b0f01baf2eb6449",
        "files": [
          "app/controllers/spree/admin/users_controller.rb",
          "app/controllers/spree/user_sessions_controller.rb",
          "app/controllers/spree/users_controller.rb",
          "app/mailers/spree/user_mailer.rb",
          "app/views/spree/admin/users/_form.html.erb",
          "app/views/spree/admin/users/edit.html.erb",
          "app/views/spree/admin/users/index.html.erb",
          "app/views/spree/admin/users/new.html.erb",
          "app/views/spree/admin/users/show.html.erb",
          "app/views/spree/layouts/admin/_login_nav.html.erb",
          "app/views/spree/shared/_login.html.erb",
          "app/views/spree/shared/_login_bar.html.erb",
          "app/views/spree/shared/_user_form.html.erb",
          "app/views/spree/user_passwords/edit.html.erb",
          "app/views/spree/user_passwords/new.html.erb",
          "app/views/spree/user_registrations/new.html.erb",
          "app/views/spree/user_sessions/authorization_failure.html.erb",
          "app/views/spree/user_sessions/new.html.erb",
          "app/views/spree/users/edit.html.erb",
          "app/views/spree/users/show.html.erb",
          "config/locales/en.yml",
          "spec/controllers/spree/checkout_controller_spec.rb"
        ],
        "message": "Switch to spree namespace for translations",
        "before_after_code_files": [
          "app/controllers/spree/admin/users_controller.rb||app/controllers/spree/admin/users_controller.rb",
          "app/controllers/spree/user_sessions_controller.rb||app/controllers/spree/user_sessions_controller.rb",
          "app/controllers/spree/users_controller.rb||app/controllers/spree/users_controller.rb",
          "app/mailers/spree/user_mailer.rb||app/mailers/spree/user_mailer.rb",
          "app/views/spree/admin/users/_form.html.erb||app/views/spree/admin/users/_form.html.erb",
          "app/views/spree/admin/users/edit.html.erb||app/views/spree/admin/users/edit.html.erb",
          "app/views/spree/admin/users/index.html.erb||app/views/spree/admin/users/index.html.erb",
          "app/views/spree/admin/users/new.html.erb||app/views/spree/admin/users/new.html.erb",
          "app/views/spree/admin/users/show.html.erb||app/views/spree/admin/users/show.html.erb",
          "app/views/spree/layouts/admin/_login_nav.html.erb||app/views/spree/layouts/admin/_login_nav.html.erb",
          "app/views/spree/shared/_login.html.erb||app/views/spree/shared/_login.html.erb",
          "app/views/spree/shared/_login_bar.html.erb||app/views/spree/shared/_login_bar.html.erb",
          "app/views/spree/shared/_user_form.html.erb||app/views/spree/shared/_user_form.html.erb",
          "app/views/spree/user_passwords/edit.html.erb||app/views/spree/user_passwords/edit.html.erb",
          "app/views/spree/user_passwords/new.html.erb||app/views/spree/user_passwords/new.html.erb",
          "app/views/spree/user_registrations/new.html.erb||app/views/spree/user_registrations/new.html.erb",
          "app/views/spree/user_sessions/authorization_failure.html.erb||app/views/spree/user_sessions/authorization_failure.html.erb",
          "app/views/spree/user_sessions/new.html.erb||app/views/spree/user_sessions/new.html.erb",
          "app/views/spree/users/edit.html.erb||app/views/spree/users/edit.html.erb",
          "app/views/spree/users/show.html.erb||app/views/spree/users/show.html.erb",
          "spec/controllers/spree/checkout_controller_spec.rb||spec/controllers/spree/checkout_controller_spec.rb"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "app/controllers/spree/admin/users_controller.rb||app/controllers/spree/admin/users_controller.rb"
          ],
          "candidate": [
            "app/controllers/spree/admin/users_controller.rb||app/controllers/spree/admin/users_controller.rb"
          ]
        }
      },
      "candidate_diff": {
        "app/controllers/spree/admin/users_controller.rb||app/controllers/spree/admin/users_controller.rb": [
          "File: app/controllers/spree/admin/users_controller.rb -> app/controllers/spree/admin/users_controller.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "28:             @user.spree_roles = roles.reject(&:blank?).collect{|r| Spree::Role.find(r)}",
          "29:           end",
          "32:           render :edit",
          "33:         else",
          "34:           render :new",
          "",
          "[Removed Lines]",
          "31:           flash.now[:notice] = t(:created_successfully)",
          "",
          "[Added Lines]",
          "31:           flash.now[:notice] = Spree.t(:created_successfully)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "50:             user = Spree::User.reset_password_by_token(params[:user])",
          "51:             sign_in(@user, :event => :authentication, :bypass => !Spree::Auth::Config[:signout_after_password_change])",
          "52:           end",
          "54:           render :edit",
          "55:         else",
          "56:           render :edit",
          "",
          "[Removed Lines]",
          "53:           flash.now[:notice] = t(:account_updated)",
          "",
          "[Added Lines]",
          "53:           flash.now[:notice] = Spree.t(:account_updated)",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "60:       def generate_api_key",
          "61:         if @user.generate_spree_api_key!",
          "63:         end",
          "64:         redirect_to edit_admin_user_path(@user)",
          "65:       end",
          "67:       def clear_api_key",
          "68:         if @user.clear_spree_api_key!",
          "70:         end",
          "71:         redirect_to edit_admin_user_path(@user)",
          "72:       end",
          "",
          "[Removed Lines]",
          "62:           flash.notice = t('key_generated', :scope => 'spree.api')",
          "69:           flash.notice = t('key_cleared', :scope => 'spree.api')",
          "",
          "[Added Lines]",
          "62:           flash.notice = Spree.t('key_generated', :scope => 'spree.api')",
          "69:           flash.notice = Spree.t('key_cleared', :scope => 'spree.api')",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "98:         # handling raise from Spree::Admin::ResourceController#destroy",
          "99:         def user_destroy_with_orders_error",
          "100:           invoke_callbacks(:destroy, :fails)",
          "102:         end",
          "104:         # Allow different formats of json data to suit different ajax calls",
          "",
          "[Removed Lines]",
          "101:           render :status => :forbidden, :text => t(:error_user_destroy_with_orders)",
          "",
          "[Added Lines]",
          "101:           render :status => :forbidden, :text => Spree.t(:error_user_destroy_with_orders)",
          "",
          "---------------"
        ],
        "app/controllers/spree/user_sessions_controller.rb||app/controllers/spree/user_sessions_controller.rb": [
          "File: app/controllers/spree/user_sessions_controller.rb -> app/controllers/spree/user_sessions_controller.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "18:     if user_signed_in?",
          "19:       respond_to do |format|",
          "20:         format.html {",
          "22:           redirect_back_or_default(after_sign_in_path_for(spree_current_user))",
          "23:         }",
          "24:         format.js {",
          "",
          "[Removed Lines]",
          "21:           flash[:success] = t(:logged_in_succesfully)",
          "",
          "[Added Lines]",
          "21:           flash[:success] = Spree.t(:logged_in_succesfully)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "27:         }",
          "28:       end",
          "29:     else",
          "31:       render :new",
          "32:     end",
          "33:   end",
          "",
          "[Removed Lines]",
          "30:       flash.now[:error] = t('devise.failure.invalid')",
          "",
          "[Added Lines]",
          "30:       flash.now[:error] = Spree.t('devise.failure.invalid')",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "45:   private",
          "46:     def accurate_title",
          "48:     end",
          "50:     def redirect_back_or_default(default)",
          "",
          "[Removed Lines]",
          "47:       t(:login)",
          "",
          "[Added Lines]",
          "47:       Spree.t(:login)",
          "",
          "---------------"
        ],
        "app/controllers/spree/users_controller.rb||app/controllers/spree/users_controller.rb": [
          "File: app/controllers/spree/users_controller.rb -> app/controllers/spree/users_controller.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "31:         user = Spree::User.reset_password_by_token(params[:user])",
          "32:         sign_in(@user, :event => :authentication, :bypass => !Spree::Auth::Config[:signout_after_password_change])",
          "33:       end",
          "35:     else",
          "36:       render :edit",
          "37:     end",
          "",
          "[Removed Lines]",
          "34:       redirect_to spree.account_url, :notice => t(:account_updated)",
          "",
          "[Added Lines]",
          "34:       redirect_to spree.account_url, :notice => Spree.t(:account_updated)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "48:     end",
          "50:     def accurate_title",
          "52:     end",
          "53: end",
          "",
          "[Removed Lines]",
          "51:       t(:my_account)",
          "",
          "[Added Lines]",
          "51:       Spree.t(:my_account)",
          "",
          "---------------"
        ],
        "app/mailers/spree/user_mailer.rb||app/mailers/spree/user_mailer.rb": [
          "File: app/mailers/spree/user_mailer.rb -> app/mailers/spree/user_mailer.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "3:     @edit_password_reset_url = spree.edit_user_password_url(:reset_password_token => user.reset_password_token)",
          "5:     mail(:to => user.email, :from => Spree::MailMethod.current.preferred_mails_from,",
          "7:   end",
          "8: end",
          "",
          "[Removed Lines]",
          "6:          :subject => Spree::Config[:site_name] + ' ' + I18n.t(:password_reset_instructions))",
          "",
          "[Added Lines]",
          "6:          :subject => Spree::Config[:site_name] + ' ' + Spree.t(:password_reset_instructions))",
          "",
          "---------------"
        ],
        "app/views/spree/admin/users/_form.html.erb||app/views/spree/admin/users/_form.html.erb": [
          "File: app/views/spree/admin/users/_form.html.erb -> app/views/spree/admin/users/_form.html.erb",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: <div data-hook=\"admin_user_form_fields\" class=\"row\">",
          "2:   <div class=\"alpha five columns\">",
          "3:     <%= f.field_container :email do %>",
          "5:       <%= f.email_field :email, :class => 'fullwidth' %>",
          "6:       <%= error_message_on :user, :email %>",
          "7:     <% end %>",
          "11:       <ul>",
          "12:         <% @roles.each do |role| %>",
          "13:           <li>",
          "14:             <%= check_box_tag 'user[spree_role_ids][]', role.id, @user.spree_roles.include?(role), :id => \"user_spree_role_#{role.name}\" %>",
          "16:           </li>",
          "18:       </ul>",
          "19:       <%= hidden_field_tag 'user[spree_role_ids][]', '' %>",
          "20:     </div>",
          "22:   </div>",
          "24:   <div class=\"omega five columns\">",
          "25:     <%= f.field_container :password do %>",
          "27:       <%= f.password_field :password, :class => 'fullwidth' %>",
          "28:       <%= f.error_message_on :password %>",
          "29:     <% end %>",
          "31:     <%= f.field_container :password do %>",
          "33:       <%= f.password_field :password_confirmation, :class => 'fullwidth' %>",
          "34:       <%= f.error_message_on :password_confirmation %>",
          "35:     <% end %>",
          "",
          "[Removed Lines]",
          "4:       <%= f.label :email, t(:email) %>",
          "9:     <div data-hook=\"admin_user_form_roles\" class=\"field\">",
          "10:       <%= label_tag nil, t(:roles) %>",
          "15:             <%= label_tag role.name %>",
          "17:         <% end %>",
          "26:       <%= f.label :password, t(:password) %>",
          "32:       <%= f.label :password_confirmation, t(:confirm_password) %>",
          "",
          "[Added Lines]",
          "4:       <%= f.label :email, Spree.t(:email) %>",
          "9:     <div data-hook=\"admin_user_form_roles\" class=\"field\">",
          "10:       <%= label_tag nil, Spree.t(:roles) %>",
          "15:             <%= label_tag role.name %>",
          "17:         <% end %>",
          "26:       <%= f.label :password, Spree.t(:password) %>",
          "32:       <%= f.label :password_confirmation, Spree.t(:confirm_password) %>",
          "",
          "---------------"
        ],
        "app/views/spree/admin/users/edit.html.erb||app/views/spree/admin/users/edit.html.erb": [
          "File: app/views/spree/admin/users/edit.html.erb -> app/views/spree/admin/users/edit.html.erb",
          "--- Hunk 1 ---",
          "[Context before]",
          "1:   <% content_for :page_title do %>",
          "3:   <% end %>",
          "5:   <% content_for :page_actions do %>",
          "6:     <li>",
          "8:     </li>",
          "9:   <% end %>",
          "11:   <fieldset data-hook=\"admin_user_edit_general_settings\" class=\"alpha ten columns\">",
          "14:     <div data-hook=\"admin_user_edit_form_header\">",
          "15:       <%= render :partial => 'spree/shared/error_messages', :locals => { :target => @user } %>",
          "",
          "[Removed Lines]",
          "2:     <%= t(:editing_user) %>",
          "7:       <%= button_link_to t(:back_to_users_list), spree.admin_users_path, :icon => 'icon-arrow-left' %>",
          "12:     <legend><%= t(:general_settings) %></legend>",
          "",
          "[Added Lines]",
          "2:     <%= Spree.t(:editing_user) %>",
          "7:       <%= button_link_to Spree.t(:back_to_users_list), spree.admin_users_path, :icon => 'icon-arrow-left' %>",
          "12:     <legend><%= Spree.t(:general_settings) %></legend>",
          "",
          "---------------"
        ],
        "app/views/spree/admin/users/index.html.erb||app/views/spree/admin/users/index.html.erb": [
          "File: app/views/spree/admin/users/index.html.erb -> app/views/spree/admin/users/index.html.erb",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: <% content_for :page_title do %>",
          "3: <% end %>",
          "5: <% content_for :page_actions do %>",
          "6:   <li>",
          "8:   </li>",
          "9: <% end %>",
          "",
          "[Removed Lines]",
          "2:   <%= t(:listing_users) %>",
          "7:     <%= button_link_to t(:new_user), new_object_url, :icon => 'icon-plus', :id => 'admin_new_user_link' %>",
          "",
          "[Added Lines]",
          "2:   <%= Spree.t(:listing_users) %>",
          "7:     <%= button_link_to Spree.t(:new_user), new_object_url, :icon => 'icon-plus', :id => 'admin_new_user_link' %>",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "15:   </colgroup>",
          "16:   <thead>",
          "17:     <tr data-hook=\"admin_users_index_headers\">",
          "19:       <th data-hook=\"admin_users_index_header_actions\" class=\"actions\"></th>",
          "20:     </tr>",
          "21:   </thead>",
          "",
          "[Removed Lines]",
          "18:       <th><%= sort_link @search,:email, t(:user), {}, {:title => 'users_email_title'} %></th>",
          "",
          "[Added Lines]",
          "18:       <th><%= sort_link @search,:email, Spree.t(:user), {}, {:title => 'users_email_title'} %></th>",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "35: <%= paginate @users %>",
          "37: <% content_for :sidebar_title do %>",
          "39: <% end %>",
          "41: <% content_for :sidebar do %>",
          "43:     <%= search_form_for [:admin, @search] do |f| %>",
          "44:       <div class=\"field\">",
          "46:         <%= f.text_field :email_cont, :class => 'fullwidth' %>",
          "47:       </div>",
          "48:       <div data-hook=\"admin_users_index_search_buttons\">",
          "50:       </div>",
          "51:     <% end %>",
          "52:   </div>",
          "",
          "[Removed Lines]",
          "38:   <%= t(:search) %>",
          "42:   <div class=\"box align-center\" data-hook=\"admin_users_index_search\">",
          "45:         <%= f.label t(:email) %> <br>",
          "49:         <%= button t(:search), 'icon-search' %>",
          "",
          "[Added Lines]",
          "38:   <%= Spree.t(:search) %>",
          "42:   <div class=\"box align-center\" data-hook=\"admin_users_index_search\">",
          "45:         <%= f.label Spree.t(:email) %> <br>",
          "49:         <%= button Spree.t(:search), 'icon-search' %>",
          "",
          "---------------"
        ],
        "app/views/spree/admin/users/new.html.erb||app/views/spree/admin/users/new.html.erb": [
          "File: app/views/spree/admin/users/new.html.erb -> app/views/spree/admin/users/new.html.erb",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: <% content_for :page_title do %>",
          "3: <% end %>",
          "5: <% content_for :page_actions do %>",
          "6:   <li>",
          "8:   </li>",
          "9: <% end %>",
          "",
          "[Removed Lines]",
          "2:   <%= t(:new_user) %>",
          "7:     <%= button_link_to t(:back_to_users_list), spree.admin_users_path, :icon => 'icon-arrow-left' %>",
          "",
          "[Added Lines]",
          "2:   <%= Spree.t(:new_user) %>",
          "7:     <%= button_link_to Spree.t(:back_to_users_list), spree.admin_users_path, :icon => 'icon-arrow-left' %>",
          "",
          "---------------"
        ],
        "app/views/spree/admin/users/show.html.erb||app/views/spree/admin/users/show.html.erb": [
          "File: app/views/spree/admin/users/show.html.erb -> app/views/spree/admin/users/show.html.erb",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: <% content_for :page_title do %>",
          "3: <% end %>",
          "5: <table>",
          "6:   <tr data-hook=\"email\">",
          "8:     <td>",
          "9:       <%= @user.email %>",
          "10:     </td>",
          "11:   </tr>",
          "12:   <tr data-hook=\"roles\">",
          "14:     <td>",
          "15:       <%= @user.spree_roles.pluck(:name).join(', ') %>",
          "16:     </td>",
          "",
          "[Removed Lines]",
          "2:   <%= t(:user_account) %>",
          "7:     <th><%= t(:email) %></th>",
          "13:     <th><%= t(:roles) %></th>",
          "",
          "[Added Lines]",
          "2:   <%= Spree.t(:user_account) %>",
          "7:     <th><%= Spree.t(:email) %></th>",
          "13:     <th><%= Spree.t(:roles) %></th>",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "18: </table>",
          "20: <p>",
          "23: </p>",
          "",
          "[Removed Lines]",
          "21:   <%= link_to_edit @user, :class => 'edit_user' %> <%= t(:or) %>",
          "22:   <%= link_to t(:back), collection_url %>",
          "",
          "[Added Lines]",
          "21:   <%= link_to_edit @user, :class => 'edit_user' %> <%= Spree.t(:or) %>",
          "22:   <%= link_to Spree.t(:back), collection_url %>",
          "",
          "---------------"
        ],
        "app/views/spree/layouts/admin/_login_nav.html.erb||app/views/spree/layouts/admin/_login_nav.html.erb": [
          "File: app/views/spree/layouts/admin/_login_nav.html.erb -> app/views/spree/layouts/admin/_login_nav.html.erb",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: <% if spree_current_user %>",
          "2:   <ul id=\"login-nav\" class=\"inline-menu\">",
          "7:   </ul>",
          "8: <% end %>",
          "",
          "[Removed Lines]",
          "3:     <li data-hook=\"user-logged-in-as\"><%= t(:logged_in_as) %>: <%= spree_current_user.email %></li>",
          "4:     <li data-hook=\"user-account-link\"><i class=\"icon-user\"></i><%= link_to t(:account), spree.edit_user_path(spree_current_user) %></li>",
          "5:     <li data-hook=\"user-logout-link\"><i class=\"icon-signout\"></i><%= link_to t(:logout), spree.destroy_user_session_path %></li>",
          "6:     <li data-hook=\"store-frontend-link\"><i class=\"icon-external-link\"></i><%= link_to t(:store), spree.root_path, :target => '_blank' %></li>",
          "",
          "[Added Lines]",
          "3:     <li data-hook=\"user-logged-in-as\"><%= Spree.t(:logged_in_as) %>: <%= spree_current_user.email %></li>",
          "4:     <li data-hook=\"user-account-link\"><i class=\"icon-user\"></i><%= link_to Spree.t(:account), spree.edit_user_path(spree_current_user) %></li>",
          "5:     <li data-hook=\"user-logout-link\"><i class=\"icon-signout\"></i><%= link_to Spree.t(:logout), spree.destroy_user_session_path %></li>",
          "6:     <li data-hook=\"store-frontend-link\"><i class=\"icon-external-link\"></i><%= link_to Spree.t(:store), spree.root_path, :target => '_blank' %></li>",
          "",
          "---------------"
        ],
        "app/views/spree/shared/_login.html.erb||app/views/spree/shared/_login.html.erb": [
          "File: app/views/spree/shared/_login.html.erb -> app/views/spree/shared/_login.html.erb",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: <%= form_for :user, :url => spree.user_session_path do |f| %>",
          "2:   <div id=\"password-credentials\">",
          "3:     <p>",
          "5:       <%= f.email_field :email, :class => 'title', :tabindex => 1 %>",
          "6:     </p>",
          "7:     <p>",
          "9:       <%= f.password_field :password, :class => 'title', :tabindex => 2 %>",
          "10:     </p>",
          "11:   </div>",
          "12:   <p>",
          "13:     <label>",
          "14:       <%= f.check_box :remember_me %>",
          "16:     </label>",
          "17:   </p>",
          "20: <% end %>",
          "",
          "[Removed Lines]",
          "4:       <%= f.label :email, t(:email) %><br />",
          "8:       <%= f.label :password, t(:password) %><br />",
          "15:       <%= f.label :remember_me, t(:remember_me) %>",
          "19:   <p><%= f.submit t(:login), :class => 'button primary', :tabindex => 3 %></p>",
          "",
          "[Added Lines]",
          "4:       <%= f.label :email, Spree.t(:email) %><br />",
          "8:       <%= f.label :password, Spree.t(:password) %><br />",
          "15:       <%= f.label :remember_me, Spree.t(:remember_me) %>",
          "19:   <p><%= f.submit Spree.t(:login), :class => 'button primary', :tabindex => 3 %></p>",
          "",
          "---------------"
        ],
        "app/views/spree/shared/_login_bar.html.erb||app/views/spree/shared/_login_bar.html.erb": [
          "File: app/views/spree/shared/_login_bar.html.erb -> app/views/spree/shared/_login_bar.html.erb",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: <% if spree_current_user %>",
          "4: <% else %>",
          "6: <% end %>",
          "",
          "[Removed Lines]",
          "2:   <li><%= link_to t(:my_account), spree.account_path %></li>",
          "3:   <li><%= link_to t(:logout), spree.destroy_user_session_path %></li>",
          "5:   <li id=\"link-to-login\"><%= link_to t(:login), spree.login_path %></li>",
          "",
          "[Added Lines]",
          "2:   <li><%= link_to Spree.t(:my_account), spree.account_path %></li>",
          "3:   <li><%= link_to Spree.t(:logout), spree.destroy_user_session_path %></li>",
          "5:   <li id=\"link-to-login\"><%= link_to Spree.t(:login), spree.login_path %></li>",
          "",
          "---------------"
        ],
        "app/views/spree/shared/_user_form.html.erb||app/views/spree/shared/_user_form.html.erb": [
          "File: app/views/spree/shared/_user_form.html.erb -> app/views/spree/shared/_user_form.html.erb",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: <p>",
          "3:   <%= f.email_field :email, :class => 'title' %>",
          "4: </p>",
          "5: <div id=\"password-credentials\">",
          "6:   <p>",
          "8:     <%= f.password_field :password, :class => 'title' %>",
          "9:   </p>",
          "11:   <p>",
          "13:     <%= f.password_field :password_confirmation, :class => 'title' %>",
          "14:   </p>",
          "15: </div>",
          "",
          "[Removed Lines]",
          "2:   <%= f.label :email, t(:email) %><br />",
          "7:     <%= f.label :password, t(:password) %><br />",
          "12:     <%= f.label :password_confirmation, t(:confirm_password) %><br />",
          "",
          "[Added Lines]",
          "2:   <%= f.label :email, Spree.t(:email) %><br />",
          "7:     <%= f.label :password, Spree.t(:password) %><br />",
          "12:     <%= f.label :password_confirmation, Spree.t(:confirm_password) %><br />",
          "",
          "---------------"
        ],
        "app/views/spree/user_passwords/edit.html.erb||app/views/spree/user_passwords/edit.html.erb": [
          "File: app/views/spree/user_passwords/edit.html.erb -> app/views/spree/user_passwords/edit.html.erb",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: <%= render :partial => 'spree/shared/error_messages', :locals => { :target => @user } %>",
          "4: <%= form_for @user, :url => spree.user_password_path, :method => :put do |f| %>",
          "5:   <p>",
          "7:     <%= f.password_field :password %><br />",
          "8:   </p>",
          "9:   <p>",
          "11:     <%= f.password_field :password_confirmation %><br />",
          "12:   </p>",
          "13:   <%= f.hidden_field :reset_password_token %>",
          "15: <% end %>",
          "",
          "[Removed Lines]",
          "2: <h2><%= t(:change_my_password) %></h2>",
          "6:     <%= f.label :password, t(:password) %><br />",
          "10:     <%= f.label :password_confirmation, t(:password_confirmation) %><br />",
          "14:   <%= f.submit t(:update_password), :class => 'button primary' %>",
          "",
          "[Added Lines]",
          "2: <h2><%= Spree.t(:change_my_password) %></h2>",
          "6:     <%= f.label :password, Spree.t(:password) %><br />",
          "10:     <%= f.label :password_confirmation, Spree.t(:password_confirmation) %><br />",
          "14:   <%= f.submit Spree.t(:update_password), :class => 'button primary' %>",
          "",
          "---------------"
        ],
        "app/views/spree/user_passwords/new.html.erb||app/views/spree/user_passwords/new.html.erb": [
          "File: app/views/spree/user_passwords/new.html.erb -> app/views/spree/user_passwords/new.html.erb",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: <%= render :partial => 'spree/shared/error_messages', :locals => { :target => @user } %>",
          "3: <div id=\"forgot-password\">",
          "8:   <%= form_for Spree::User.new, :as => :user, :url => spree.user_password_path do |f| %>",
          "9:     <p>",
          "11:       <%= f.email_field :email %>",
          "12:     </p>",
          "13:     <p>",
          "15:     </p>",
          "16:   <% end %>",
          "17: </div>",
          "",
          "[Removed Lines]",
          "4:   <h6><%= t(:forgot_password) %></h6>",
          "6:   <p><%= t(:instructions_to_reset_password) %></p>",
          "10:       <%= f.label :email, t(:email) %><br />",
          "14:       <%= f.submit t(:reset_password), :class => 'button primary' %>",
          "",
          "[Added Lines]",
          "4:   <h6><%= Spree.t(:forgot_password) %></h6>",
          "6:   <p><%= Spree.t(:instructions_to_reset_password) %></p>",
          "10:       <%= f.label :email, Spree.t(:email) %><br />",
          "14:       <%= f.submit Spree.t(:reset_password), :class => 'button primary' %>",
          "",
          "---------------"
        ],
        "app/views/spree/user_registrations/new.html.erb||app/views/spree/user_registrations/new.html.erb": [
          "File: app/views/spree/user_registrations/new.html.erb -> app/views/spree/user_registrations/new.html.erb",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: <%= render :partial => 'spree/shared/error_messages', :locals => { :target => @user } %>",
          "5: <div id=\"new-customer\">",
          "8:   <div data-hook=\"signup\">",
          "10:     <%= form_for :user, :url => spree.user_registration_path(@user) do |f| %>",
          "11:       <div data-hook=\"signup_inside_form\">",
          "12:         <%= render :partial => 'spree/shared/user_form', :locals => { :f => f } %>",
          "14:       </div>",
          "15:     <% end %>",
          "18:   </div>",
          "",
          "[Removed Lines]",
          "6:   <h6><%= t(:new_customer) %></h6>",
          "13:         <p><%= f.submit t(:create), :class => 'button primary' %></p>",
          "16:     <%= t(:or) %> <%= link_to t(:login_as_existing), spree.login_path %>",
          "",
          "[Added Lines]",
          "6:   <h6><%= Spree.t(:new_customer) %></h6>",
          "13:         <p><%= f.submit Spree.t(:create), :class => 'button primary' %></p>",
          "16:     <%= Spree.t(:or) %> <%= link_to Spree.t(:login_as_existing), spree.login_path %>",
          "",
          "---------------"
        ],
        "app/views/spree/user_sessions/authorization_failure.html.erb||app/views/spree/user_sessions/authorization_failure.html.erb": [
          "File: app/views/spree/user_sessions/authorization_failure.html.erb -> app/views/spree/user_sessions/authorization_failure.html.erb",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: <div style=\"height:50px; padding-top:20px;\">",
          "4: <!-- Add your own custom access denied message here if you like -->",
          "",
          "[Removed Lines]",
          "2:   <strong><%= t(:authorization_failure) %></strong>",
          "3: </div>",
          "",
          "[Added Lines]",
          "2:   <strong><%= Spree.t(:authorization_failure) %></strong>",
          "3: </div>",
          "",
          "---------------"
        ],
        "app/views/spree/user_sessions/new.html.erb||app/views/spree/user_sessions/new.html.erb": [
          "File: app/views/spree/user_sessions/new.html.erb -> app/views/spree/user_sessions/new.html.erb",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: <% @body_id = 'login' %>",
          "6: <div id=\"existing-customer\">",
          "8:   <div data-hook=\"login\">",
          "9:     <%= render :partial => 'spree/shared/login' %>",
          "11:   </div>",
          "12: </div>",
          "13: <div data-hook=\"login_extras\"></div>",
          "",
          "[Removed Lines]",
          "7:   <h6><%= t(:login_as_existing) %></h6>",
          "10:     <%= t(:or) %> <%= link_to t(:create_a_new_account), spree.signup_path %> | <%= link_to t(:forgot_password), spree.new_user_password_path %>",
          "",
          "[Added Lines]",
          "7:   <h6><%= Spree.t(:login_as_existing) %></h6>",
          "10:     <%= Spree.t(:or) %> <%= link_to Spree.t(:create_a_new_account), spree.signup_path %> | <%= link_to Spree.t(:forgot_password), spree.new_user_password_path %>",
          "",
          "---------------"
        ],
        "app/views/spree/users/edit.html.erb||app/views/spree/users/edit.html.erb": [
          "File: app/views/spree/users/edit.html.erb -> app/views/spree/users/edit.html.erb",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: <%= render :partial => 'spree/shared/error_messages', :locals => { :target => @user } %>",
          "5: <%= form_for @user, :url => spree.user_path(@user), :method => :put do |f| %>",
          "6:   <%= render :partial => 'spree/shared/user_form', :locals => { :f => f } %>",
          "7:   <p>",
          "9:   </p>",
          "10: <% end %>",
          "",
          "[Removed Lines]",
          "3: <h1><%= t(:editing_user) %></h1>",
          "8:     <%= f.submit t(:update), :class => 'button primary' %>",
          "",
          "[Added Lines]",
          "3: <h1><%= Spree.t(:editing_user) %></h1>",
          "8:     <%= f.submit Spree.t(:update), :class => 'button primary' %>",
          "",
          "---------------"
        ],
        "app/views/spree/users/show.html.erb||app/views/spree/users/show.html.erb": [
          "File: app/views/spree/users/show.html.erb -> app/views/spree/users/show.html.erb",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: <div data-hook=\"account_summary\" class=\"account-summary\">",
          "4:   <dl id=\"user-info\">",
          "7:   </dl>",
          "8: </div>",
          "10: <div data-hook=\"account_my_orders\" class=\"account-my-orders\">",
          "13:   <% if @orders.present? %>",
          "14:     <table class=\"order-summary\">",
          "15:       <thead>",
          "16:       <tr>",
          "23:       </tr>",
          "24:       </thead>",
          "25:       <tbody>",
          "",
          "[Removed Lines]",
          "5:     <dt><%= t(:email) %></dt>",
          "6:     <dd><%= @user.email %> (<%= link_to t(:edit), spree.edit_account_path %>)</dd>",
          "12:   <h3><%= t(:my_orders) %></h3>",
          "17:         <th class=\"order-number\"><%= t(:order_number) %></th>",
          "18:         <th class=\"order-date\"><%= t(:order_date) %></th>",
          "19:         <th class=\"order-status\"><%= t(:status) %></th>",
          "20:         <th class=\"order-payment-state\"><%= t(:payment_state) %></th>",
          "21:         <th class=\"order-shipment-state\"><%= t(:shipment_state) %></th>",
          "22:         <th class=\"order-total\"><%= t(:total) %></th>",
          "",
          "[Added Lines]",
          "5:     <dt><%= Spree.t(:email) %></dt>",
          "6:     <dd><%= @user.email %> (<%= link_to Spree.t(:edit), spree.edit_account_path %>)</dd>",
          "12:   <h3><%= Spree.t(:my_orders) %></h3>",
          "17:         <th class=\"order-number\"><%= Spree.t(:order_number) %></th>",
          "18:         <th class=\"order-date\"><%= Spree.t(:order_date) %></th>",
          "19:         <th class=\"order-status\"><%= Spree.t(:status) %></th>",
          "20:         <th class=\"order-payment-state\"><%= Spree.t(:payment_state) %></th>",
          "21:         <th class=\"order-shipment-state\"><%= Spree.t(:shipment_state) %></th>",
          "22:         <th class=\"order-total\"><%= Spree.t(:total) %></th>",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "28:           <td class=\"order-number\"><%= link_to order.number, order_url(order) %></td>",
          "29:           <td class=\"order-date\"><%= l order.completed_at.to_date %></td>",
          "30:           <td class=\"order-status\"><%= t(order.state).titleize %></td>",
          "33:           <td class=\"order-total\"><%= money order.total %></td>",
          "34:         </tr>",
          "35:       <% end %>",
          "36:       </tbody>",
          "37:     </table>",
          "38:   <% else %>",
          "40:   <% end %>",
          "41:   <br />",
          "",
          "[Removed Lines]",
          "31:           <td class=\"order-payment-state\"><%= t(\"payment_states.#{order.payment_state}\") if order.payment_state %></td>",
          "32:           <td class=\"order-shipment-state\"><%= t(\"shipment_states.#{order.shipment_state}\") if order.shipment_state %></td>",
          "39:     <p><%= t(:you_have_no_orders_yet) %></p>",
          "",
          "[Added Lines]",
          "31:           <td class=\"order-payment-state\"><%= Spree.t(\"payment_states.#{order.payment_state}\") if order.payment_state %></td>",
          "32:           <td class=\"order-shipment-state\"><%= Spree.t(\"shipment_states.#{order.shipment_state}\") if order.shipment_state %></td>",
          "39:     <p><%= Spree.t(:you_have_no_orders_yet) %></p>",
          "",
          "---------------"
        ],
        "spec/controllers/spree/checkout_controller_spec.rb||spec/controllers/spree/checkout_controller_spec.rb": [
          "File: spec/controllers/spree/checkout_controller_spec.rb -> spec/controllers/spree/checkout_controller_spec.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "21:         before { controller.stub :spree_current_user => user }",
          "23:         it 'should proceed to the first checkout step' do",
          "25:           response.should render_template :edit",
          "26:         end",
          "27:       end",
          "",
          "[Removed Lines]",
          "24:           spree_get :edit, { :state => 'address' }",
          "",
          "[Added Lines]",
          "24:           spree_get :edit, { :state => 'address' }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "78:         it 'should redirect to the tokenized order view' do",
          "79:           spree_post :update, { :state => 'confirm' }, { :access_token => \"ABC\" }",
          "80:           response.should redirect_to spree.token_order_path(order, 'ABC')",
          "82:         end",
          "83:       end",
          "",
          "[Removed Lines]",
          "81:           flash.notice.should == I18n.t(:order_processed_successfully)",
          "",
          "[Added Lines]",
          "81:           flash.notice.should == Spree.t(:order_processed_successfully)",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "66f46952c420128c384334e616d502e7b15c1bdc",
      "candidate_info": {
        "commit_hash": "66f46952c420128c384334e616d502e7b15c1bdc",
        "repo": "spree/spree_auth_devise",
        "commit_url": "https://github.com/spree/spree_auth_devise/commit/66f46952c420128c384334e616d502e7b15c1bdc",
        "files": [
          "app/controllers/spree/admin/users_controller.rb"
        ],
        "message": "Use success messages in admin/users_controller",
        "before_after_code_files": [
          "app/controllers/spree/admin/users_controller.rb||app/controllers/spree/admin/users_controller.rb"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "app/controllers/spree/admin/users_controller.rb||app/controllers/spree/admin/users_controller.rb"
          ],
          "candidate": [
            "app/controllers/spree/admin/users_controller.rb||app/controllers/spree/admin/users_controller.rb"
          ]
        }
      },
      "candidate_diff": {
        "app/controllers/spree/admin/users_controller.rb||app/controllers/spree/admin/users_controller.rb": [
          "File: app/controllers/spree/admin/users_controller.rb -> app/controllers/spree/admin/users_controller.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "28:             @user.spree_roles = roles.reject(&:blank?).collect{|r| Spree::Role.find(r)}",
          "29:           end",
          "32:           render :edit",
          "33:         else",
          "34:           render :new",
          "",
          "[Removed Lines]",
          "31:           flash.now[:notice] = t(:created_successfully)",
          "",
          "[Added Lines]",
          "31:           flash.now[:success] = t(:created_successfully)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "50:             user = Spree::User.reset_password_by_token(params[:user])",
          "51:             sign_in(@user, :event => :authentication, :bypass => !Spree::Auth::Config[:signout_after_password_change])",
          "52:           end",
          "54:           render :edit",
          "55:         else",
          "56:           render :edit",
          "",
          "[Removed Lines]",
          "53:           flash.now[:notice] = t(:account_updated)",
          "",
          "[Added Lines]",
          "53:           flash.now[:success] = t(:account_updated)",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "60:       def generate_api_key",
          "61:         if @user.generate_spree_api_key!",
          "63:         end",
          "64:         redirect_to edit_admin_user_path(@user)",
          "65:       end",
          "67:       def clear_api_key",
          "68:         if @user.clear_spree_api_key!",
          "70:         end",
          "71:         redirect_to edit_admin_user_path(@user)",
          "72:       end",
          "",
          "[Removed Lines]",
          "62:           flash.notice = t('key_generated', :scope => 'spree.api')",
          "69:           flash.notice = t('key_cleared', :scope => 'spree.api')",
          "",
          "[Added Lines]",
          "62:           flash[:success] = t('key_generated', :scope => 'spree.api')",
          "69:           flash[:success] = t('key_cleared', :scope => 'spree.api')",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "b6c91eb89ac8ae6ac7a9e6bcd58751cb747d3d8a",
      "candidate_info": {
        "commit_hash": "b6c91eb89ac8ae6ac7a9e6bcd58751cb747d3d8a",
        "repo": "spree/spree_auth_devise",
        "commit_url": "https://github.com/spree/spree_auth_devise/commit/b6c91eb89ac8ae6ac7a9e6bcd58751cb747d3d8a",
        "files": [
          "app/models/spree/user.rb",
          "config/initializers/devise.rb",
          "spree_auth_devise.gemspec"
        ],
        "message": "Depend on devise 3 rc for Rails 4 support",
        "before_after_code_files": [
          "app/models/spree/user.rb||app/models/spree/user.rb",
          "config/initializers/devise.rb||config/initializers/devise.rb",
          "spree_auth_devise.gemspec||spree_auth_devise.gemspec"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "app/models/spree/user.rb||app/models/spree/user.rb"
          ],
          "candidate": [
            "app/models/spree/user.rb||app/models/spree/user.rb"
          ]
        }
      },
      "candidate_diff": {
        "app/models/spree/user.rb||app/models/spree/user.rb": [
          "File: app/models/spree/user.rb -> app/models/spree/user.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "13:     before_destroy :check_completed_orders",
          "15:     # Setup accessible (or protected) attributes for your model",
          "18:     users_table_name = User.table_name",
          "19:     roles_table_name = Role.table_name",
          "",
          "[Removed Lines]",
          "16:     attr_accessible :email, :password, :password_confirmation, :remember_me, :persistence_token, :login",
          "",
          "[Added Lines]",
          "16:     # attr_accessible :email, :password, :password_confirmation, :remember_me, :persistence_token, :login",
          "",
          "---------------"
        ],
        "config/initializers/devise.rb||config/initializers/devise.rb": [
          "File: config/initializers/devise.rb -> config/initializers/devise.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "65:   # Range for password length",
          "66:   # config.password_length = 6..20",
          "71:   # ==> Configuration for :timeoutable",
          "72:   # The time you want to timeout the user session without activity. After this",
          "73:   # time the user will be asked for credentials again.",
          "",
          "[Removed Lines]",
          "68:   # Regex to use to validate the email address",
          "69:   config.email_regexp = /^([\\w\\.%\\+\\-]+)@([\\w\\-]+\\.)+([\\w]{2,})$/i",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "spree_auth_devise.gemspec||spree_auth_devise.gemspec": [
          "File: spree_auth_devise.gemspec -> spree_auth_devise.gemspec",
          "--- Hunk 1 ---",
          "[Context before]",
          "20:   s.add_dependency 'spree_core', spree_version",
          "21:   s.add_dependency 'spree_frontend', spree_version",
          "22:   s.add_dependency 'spree_backend', spree_version",
          "24:   s.add_dependency 'devise-encryptable', '0.1.2'",
          "25:   s.add_dependency 'cancan', '~> 1.6.7'",
          "26: end",
          "",
          "[Removed Lines]",
          "23:   s.add_dependency 'devise', '~> 2.2.5'",
          "",
          "[Added Lines]",
          "23:   s.add_dependency 'devise', '~> 3.0.0.rc'",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "8c4e7b40459cda4064a5c84dfd4ae50bd9484155",
      "candidate_info": {
        "commit_hash": "8c4e7b40459cda4064a5c84dfd4ae50bd9484155",
        "repo": "spree/spree_auth_devise",
        "commit_url": "https://github.com/spree/spree_auth_devise/commit/8c4e7b40459cda4064a5c84dfd4ae50bd9484155",
        "files": [
          "app/controllers/spree/admin/users_controller.rb",
          "app/controllers/spree/user_sessions_controller.rb",
          "app/controllers/spree/users_controller.rb",
          "app/mailers/spree/user_mailer.rb",
          "app/views/spree/admin/users/_form.html.erb",
          "app/views/spree/admin/users/edit.html.erb",
          "app/views/spree/admin/users/index.html.erb",
          "app/views/spree/admin/users/new.html.erb",
          "app/views/spree/admin/users/show.html.erb",
          "app/views/spree/layouts/admin/_login_nav.html.erb",
          "app/views/spree/shared/_login.html.erb",
          "app/views/spree/shared/_login_bar.html.erb",
          "app/views/spree/shared/_user_form.html.erb",
          "app/views/spree/user_passwords/edit.html.erb",
          "app/views/spree/user_passwords/new.html.erb",
          "app/views/spree/user_registrations/new.html.erb",
          "app/views/spree/user_sessions/authorization_failure.html.erb",
          "app/views/spree/user_sessions/new.html.erb",
          "app/views/spree/users/edit.html.erb",
          "app/views/spree/users/show.html.erb",
          "config/locales/en.yml",
          "spec/controllers/spree/checkout_controller_spec.rb",
          "spec/requests/account_spec.rb",
          "spec/requests/admin/users_spec.rb",
          "spec/requests/user_spec.rb"
        ],
        "message": "Switch to spree namespace for translations",
        "before_after_code_files": [
          "app/controllers/spree/admin/users_controller.rb||app/controllers/spree/admin/users_controller.rb",
          "app/controllers/spree/user_sessions_controller.rb||app/controllers/spree/user_sessions_controller.rb",
          "app/controllers/spree/users_controller.rb||app/controllers/spree/users_controller.rb",
          "app/mailers/spree/user_mailer.rb||app/mailers/spree/user_mailer.rb",
          "app/views/spree/admin/users/_form.html.erb||app/views/spree/admin/users/_form.html.erb",
          "app/views/spree/admin/users/edit.html.erb||app/views/spree/admin/users/edit.html.erb",
          "app/views/spree/admin/users/index.html.erb||app/views/spree/admin/users/index.html.erb",
          "app/views/spree/admin/users/new.html.erb||app/views/spree/admin/users/new.html.erb",
          "app/views/spree/admin/users/show.html.erb||app/views/spree/admin/users/show.html.erb",
          "app/views/spree/layouts/admin/_login_nav.html.erb||app/views/spree/layouts/admin/_login_nav.html.erb",
          "app/views/spree/shared/_login.html.erb||app/views/spree/shared/_login.html.erb",
          "app/views/spree/shared/_login_bar.html.erb||app/views/spree/shared/_login_bar.html.erb",
          "app/views/spree/shared/_user_form.html.erb||app/views/spree/shared/_user_form.html.erb",
          "app/views/spree/user_passwords/edit.html.erb||app/views/spree/user_passwords/edit.html.erb",
          "app/views/spree/user_passwords/new.html.erb||app/views/spree/user_passwords/new.html.erb",
          "app/views/spree/user_registrations/new.html.erb||app/views/spree/user_registrations/new.html.erb",
          "app/views/spree/user_sessions/authorization_failure.html.erb||app/views/spree/user_sessions/authorization_failure.html.erb",
          "app/views/spree/user_sessions/new.html.erb||app/views/spree/user_sessions/new.html.erb",
          "app/views/spree/users/edit.html.erb||app/views/spree/users/edit.html.erb",
          "app/views/spree/users/show.html.erb||app/views/spree/users/show.html.erb",
          "spec/controllers/spree/checkout_controller_spec.rb||spec/controllers/spree/checkout_controller_spec.rb",
          "spec/requests/account_spec.rb||spec/requests/account_spec.rb",
          "spec/requests/admin/users_spec.rb||spec/requests/admin/users_spec.rb",
          "spec/requests/user_spec.rb||spec/requests/user_spec.rb"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "app/controllers/spree/admin/users_controller.rb||app/controllers/spree/admin/users_controller.rb"
          ],
          "candidate": [
            "app/controllers/spree/admin/users_controller.rb||app/controllers/spree/admin/users_controller.rb"
          ]
        }
      },
      "candidate_diff": {
        "app/controllers/spree/admin/users_controller.rb||app/controllers/spree/admin/users_controller.rb": [
          "File: app/controllers/spree/admin/users_controller.rb -> app/controllers/spree/admin/users_controller.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "28:             @user.spree_roles = roles.reject(&:blank?).collect{|r| Spree::Role.find(r)}",
          "29:           end",
          "32:           render :edit",
          "33:         else",
          "34:           render :new",
          "",
          "[Removed Lines]",
          "31:           flash.now[:success] = t(:created_successfully)",
          "",
          "[Added Lines]",
          "31:           flash.now[:success] = Spree.t(:created_successfully)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "50:             user = Spree::User.reset_password_by_token(params[:user])",
          "51:             sign_in(@user, :event => :authentication, :bypass => !Spree::Auth::Config[:signout_after_password_change])",
          "52:           end",
          "54:           render :edit",
          "55:         else",
          "56:           render :edit",
          "",
          "[Removed Lines]",
          "53:           flash.now[:success] = t(:account_updated)",
          "",
          "[Added Lines]",
          "53:           flash.now[:success] = Spree.t(:account_updated)",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "60:       def generate_api_key",
          "61:         if @user.generate_spree_api_key!",
          "63:         end",
          "64:         redirect_to edit_admin_user_path(@user)",
          "65:       end",
          "67:       def clear_api_key",
          "68:         if @user.clear_spree_api_key!",
          "70:         end",
          "71:         redirect_to edit_admin_user_path(@user)",
          "72:       end",
          "",
          "[Removed Lines]",
          "62:           flash[:success] = t('key_generated', :scope => 'spree.api')",
          "69:           flash[:success] = t('key_cleared', :scope => 'spree.api')",
          "",
          "[Added Lines]",
          "62:           flash.success = Spree.t('api.key_generated')",
          "69:           flash.success = Spree.t('api.key_cleared')",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "98:         # handling raise from Spree::Admin::ResourceController#destroy",
          "99:         def user_destroy_with_orders_error",
          "100:           invoke_callbacks(:destroy, :fails)",
          "102:         end",
          "104:         # Allow different formats of json data to suit different ajax calls",
          "",
          "[Removed Lines]",
          "101:           render :status => :forbidden, :text => t(:error_user_destroy_with_orders)",
          "",
          "[Added Lines]",
          "101:           render :status => :forbidden, :text => Spree.t(:error_user_destroy_with_orders)",
          "",
          "---------------"
        ],
        "app/controllers/spree/user_sessions_controller.rb||app/controllers/spree/user_sessions_controller.rb": [
          "File: app/controllers/spree/user_sessions_controller.rb -> app/controllers/spree/user_sessions_controller.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "18:     if spree_user_signed_in?",
          "19:       respond_to do |format|",
          "20:         format.html {",
          "22:           redirect_back_or_default(after_sign_in_path_for(spree_current_user))",
          "23:         }",
          "24:         format.js {",
          "",
          "[Removed Lines]",
          "21:           flash[:success] = t(:logged_in_succesfully)",
          "",
          "[Added Lines]",
          "21:           flash[:success] = Spree.t(:logged_in_succesfully)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "45:   private",
          "46:     def accurate_title",
          "48:     end",
          "50:     def redirect_back_or_default(default)",
          "",
          "[Removed Lines]",
          "47:       t(:login)",
          "",
          "[Added Lines]",
          "47:       Spree.t(:login)",
          "",
          "---------------"
        ],
        "app/controllers/spree/users_controller.rb||app/controllers/spree/users_controller.rb": [
          "File: app/controllers/spree/users_controller.rb -> app/controllers/spree/users_controller.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "31:         user = Spree::User.reset_password_by_token(params[:user])",
          "32:         sign_in(@user, :event => :authentication, :bypass => !Spree::Auth::Config[:signout_after_password_change])",
          "33:       end",
          "35:     else",
          "36:       render :edit",
          "37:     end",
          "",
          "[Removed Lines]",
          "34:       redirect_to spree.account_url, :notice => t(:account_updated)",
          "",
          "[Added Lines]",
          "34:       redirect_to spree.account_url, :notice => Spree.t(:account_updated)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "48:     end",
          "50:     def accurate_title",
          "52:     end",
          "53: end",
          "",
          "[Removed Lines]",
          "51:       t(:my_account)",
          "",
          "[Added Lines]",
          "51:       Spree.t(:my_account)",
          "",
          "---------------"
        ],
        "app/mailers/spree/user_mailer.rb||app/mailers/spree/user_mailer.rb": [
          "File: app/mailers/spree/user_mailer.rb -> app/mailers/spree/user_mailer.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "3:     @edit_password_reset_url = spree.edit_spree_user_password_url(:reset_password_token => user.reset_password_token)",
          "5:     mail(:to => user.email, :from => from_address,",
          "7:   end",
          "8: end",
          "",
          "[Removed Lines]",
          "6:          :subject => Spree::Config[:site_name] + ' ' + I18n.t(:password_reset_instructions))",
          "",
          "[Added Lines]",
          "6:          :subject => Spree::Config[:site_name] + ' ' + Spree.t(:password_reset_instructions))",
          "",
          "---------------"
        ],
        "app/views/spree/admin/users/_form.html.erb||app/views/spree/admin/users/_form.html.erb": [
          "File: app/views/spree/admin/users/_form.html.erb -> app/views/spree/admin/users/_form.html.erb",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: <div data-hook=\"admin_user_form_fields\" class=\"row\">",
          "2:   <div class=\"alpha five columns\">",
          "3:     <%= f.field_container :email do %>",
          "5:       <%= f.email_field :email, :class => 'fullwidth' %>",
          "6:       <%= error_message_on :user, :email %>",
          "7:     <% end %>",
          "11:       <ul>",
          "12:         <% @roles.each do |role| %>",
          "13:           <li>",
          "14:             <%= check_box_tag 'user[spree_role_ids][]', role.id, @user.spree_roles.include?(role), :id => \"user_spree_role_#{role.name}\" %>",
          "16:           </li>",
          "18:       </ul>",
          "19:       <%= hidden_field_tag 'user[spree_role_ids][]', '' %>",
          "20:     </div>",
          "22:   </div>",
          "24:   <div class=\"omega five columns\">",
          "25:     <%= f.field_container :password do %>",
          "27:       <%= f.password_field :password, :class => 'fullwidth' %>",
          "28:       <%= f.error_message_on :password %>",
          "29:     <% end %>",
          "31:     <%= f.field_container :password do %>",
          "33:       <%= f.password_field :password_confirmation, :class => 'fullwidth' %>",
          "34:       <%= f.error_message_on :password_confirmation %>",
          "35:     <% end %>",
          "",
          "[Removed Lines]",
          "4:       <%= f.label :email, t(:email) %>",
          "9:     <div data-hook=\"admin_user_form_roles\" class=\"field\">",
          "10:       <%= label_tag nil, t(:roles) %>",
          "15:             <%= label_tag role.name %>",
          "17:         <% end %>",
          "26:       <%= f.label :password, t(:password) %>",
          "32:       <%= f.label :password_confirmation, t(:confirm_password) %>",
          "",
          "[Added Lines]",
          "4:       <%= f.label :email, Spree.t(:email) %>",
          "9:     <div data-hook=\"admin_user_form_roles\" class=\"field\">",
          "10:       <%= label_tag nil, Spree.t(:roles) %>",
          "15:             <%= label_tag role.name %>",
          "17:         <% end %>",
          "26:       <%= f.label :password, Spree.t(:password) %>",
          "32:       <%= f.label :password_confirmation, Spree.t(:confirm_password) %>",
          "",
          "---------------"
        ],
        "app/views/spree/admin/users/edit.html.erb||app/views/spree/admin/users/edit.html.erb": [
          "File: app/views/spree/admin/users/edit.html.erb -> app/views/spree/admin/users/edit.html.erb",
          "--- Hunk 1 ---",
          "[Context before]",
          "1:   <% content_for :page_title do %>",
          "3:   <% end %>",
          "5:   <% content_for :page_actions do %>",
          "6:     <li>",
          "8:     </li>",
          "9:   <% end %>",
          "11:   <fieldset data-hook=\"admin_user_edit_general_settings\" class=\"alpha ten columns\">",
          "14:     <div data-hook=\"admin_user_edit_form_header\">",
          "15:       <%= render :partial => 'spree/shared/error_messages', :locals => { :target => @user } %>",
          "",
          "[Removed Lines]",
          "2:     <%= t(:editing_user) %>",
          "7:       <%= button_link_to t(:back_to_users_list), spree.admin_users_path, :icon => 'icon-arrow-left' %>",
          "12:     <legend><%= t(:general_settings) %></legend>",
          "",
          "[Added Lines]",
          "2:     <%= Spree.t(:editing_user) %>",
          "7:       <%= button_link_to Spree.t(:back_to_users_list), spree.admin_users_path, :icon => 'icon-arrow-left' %>",
          "12:     <legend><%= Spree.t(:general_settings) %></legend>",
          "",
          "---------------"
        ],
        "app/views/spree/admin/users/index.html.erb||app/views/spree/admin/users/index.html.erb": [
          "File: app/views/spree/admin/users/index.html.erb -> app/views/spree/admin/users/index.html.erb",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: <% content_for :page_title do %>",
          "3: <% end %>",
          "5: <% content_for :page_actions do %>",
          "6:   <li>",
          "8:   </li>",
          "9: <% end %>",
          "",
          "[Removed Lines]",
          "2:   <%= t(:listing_users) %>",
          "7:     <%= button_link_to t(:new_user), new_object_url, :icon => 'icon-plus', :id => 'admin_new_user_link' %>",
          "",
          "[Added Lines]",
          "2:   <%= Spree.t(:listing_users) %>",
          "7:     <%= button_link_to Spree.t(:new_user), new_object_url, :icon => 'icon-plus', :id => 'admin_new_user_link' %>",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "15:   </colgroup>",
          "16:   <thead>",
          "17:     <tr data-hook=\"admin_users_index_headers\">",
          "19:       <th data-hook=\"admin_users_index_header_actions\" class=\"actions\"></th>",
          "20:     </tr>",
          "21:   </thead>",
          "",
          "[Removed Lines]",
          "18:       <th><%= sort_link @search,:email, t(:user), {}, {:title => 'users_email_title'} %></th>",
          "",
          "[Added Lines]",
          "18:       <th><%= sort_link @search,:email, Spree.t(:user), {}, {:title => 'users_email_title'} %></th>",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "35: <%= paginate @users %>",
          "37: <% content_for :sidebar_title do %>",
          "39: <% end %>",
          "41: <% content_for :sidebar do %>",
          "43:     <%= search_form_for [:admin, @search] do |f| %>",
          "44:       <div class=\"field\">",
          "46:         <%= f.text_field :email_cont, :class => 'fullwidth' %>",
          "47:       </div>",
          "48:       <div data-hook=\"admin_users_index_search_buttons\">",
          "50:       </div>",
          "51:     <% end %>",
          "52:   </div>",
          "",
          "[Removed Lines]",
          "38:   <%= t(:search) %>",
          "42:   <div class=\"box align-center\" data-hook=\"admin_users_index_search\">",
          "45:         <%= f.label t(:email) %> <br>",
          "49:         <%= button t(:search), 'icon-search' %>",
          "",
          "[Added Lines]",
          "38:   <%= Spree.t(:search) %>",
          "42:   <div class=\"box align-center\" data-hook=\"admin_users_index_search\">",
          "45:         <%= f.label Spree.t(:email) %> <br>",
          "49:         <%= button Spree.t(:search), 'icon-search' %>",
          "",
          "---------------"
        ],
        "app/views/spree/admin/users/new.html.erb||app/views/spree/admin/users/new.html.erb": [
          "File: app/views/spree/admin/users/new.html.erb -> app/views/spree/admin/users/new.html.erb",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: <% content_for :page_title do %>",
          "3: <% end %>",
          "5: <% content_for :page_actions do %>",
          "6:   <li>",
          "8:   </li>",
          "9: <% end %>",
          "",
          "[Removed Lines]",
          "2:   <%= t(:new_user) %>",
          "7:     <%= button_link_to t(:back_to_users_list), spree.admin_users_path, :icon => 'icon-arrow-left' %>",
          "",
          "[Added Lines]",
          "2:   <%= Spree.t(:new_user) %>",
          "7:     <%= button_link_to Spree.t(:back_to_users_list), spree.admin_users_path, :icon => 'icon-arrow-left' %>",
          "",
          "---------------"
        ],
        "app/views/spree/admin/users/show.html.erb||app/views/spree/admin/users/show.html.erb": [
          "File: app/views/spree/admin/users/show.html.erb -> app/views/spree/admin/users/show.html.erb",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: <% content_for :page_title do %>",
          "3: <% end %>",
          "5: <table>",
          "6:   <tr data-hook=\"email\">",
          "8:     <td>",
          "9:       <%= @user.email %>",
          "10:     </td>",
          "11:   </tr>",
          "12:   <tr data-hook=\"roles\">",
          "14:     <td>",
          "15:       <%= @user.spree_roles.pluck(:name).join(', ') %>",
          "16:     </td>",
          "",
          "[Removed Lines]",
          "2:   <%= t(:user_account) %>",
          "7:     <th><%= t(:email) %></th>",
          "13:     <th><%= t(:roles) %></th>",
          "",
          "[Added Lines]",
          "2:   <%= Spree.t(:user_account) %>",
          "7:     <th><%= Spree.t(:email) %></th>",
          "13:     <th><%= Spree.t(:roles) %></th>",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "18: </table>",
          "20: <p>",
          "23: </p>",
          "",
          "[Removed Lines]",
          "21:   <%= link_to_edit @user, :class => 'edit_user' %> <%= t(:or) %>",
          "22:   <%= link_to t(:back), collection_url %>",
          "",
          "[Added Lines]",
          "21:   <%= link_to_edit @user, :class => 'edit_user' %> <%= Spree.t(:or) %>",
          "22:   <%= link_to Spree.t(:back), collection_url %>",
          "",
          "---------------"
        ],
        "app/views/spree/layouts/admin/_login_nav.html.erb||app/views/spree/layouts/admin/_login_nav.html.erb": [
          "File: app/views/spree/layouts/admin/_login_nav.html.erb -> app/views/spree/layouts/admin/_login_nav.html.erb",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: <% if spree_current_user %>",
          "2:   <ul id=\"login-nav\" class=\"inline-menu\">",
          "7:   </ul>",
          "8: <% end %>",
          "",
          "[Removed Lines]",
          "3:     <li data-hook=\"user-logged-in-as\"><%= t(:logged_in_as) %>: <%= spree_current_user.email %></li>",
          "4:     <li data-hook=\"user-account-link\"><i class=\"icon-user\"></i><%= link_to t(:account), spree.edit_user_path(spree_current_user) %></li>",
          "5:     <li data-hook=\"user-logout-link\"><i class=\"icon-signout\"></i><%= link_to t(:logout), spree.destroy_spree_user_session_path %></li>",
          "6:     <li data-hook=\"store-frontend-link\"><i class=\"icon-external-link\"></i><%= link_to t(:store), spree.root_path, :target => '_blank' %></li>",
          "",
          "[Added Lines]",
          "3:     <li data-hook=\"user-logged-in-as\"><%= Spree.t(:logged_in_as) %>: <%= spree_current_user.email %></li>",
          "4:     <li data-hook=\"user-account-link\"><i class=\"icon-user\"></i><%= link_to Spree.t(:account), spree.edit_user_path(spree_current_user) %></li>",
          "5:     <li data-hook=\"user-logout-link\"><i class=\"icon-signout\"></i><%= link_to Spree.t(:logout), spree.destroy_spree_user_session_path %></li>",
          "6:     <li data-hook=\"store-frontend-link\"><i class=\"icon-external-link\"></i><%= link_to Spree.t(:store), spree.root_path, :target => '_blank' %></li>",
          "",
          "---------------"
        ],
        "app/views/spree/shared/_login.html.erb||app/views/spree/shared/_login.html.erb": [
          "File: app/views/spree/shared/_login.html.erb -> app/views/spree/shared/_login.html.erb",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: <%= form_for :spree_user, :url => spree.spree_user_session_path do |f| %>",
          "2:   <div id=\"password-credentials\">",
          "3:     <p>",
          "5:       <%= f.email_field :email, :class => 'title', :tabindex => 1 %>",
          "6:     </p>",
          "7:     <p>",
          "9:       <%= f.password_field :password, :class => 'title', :tabindex => 2 %>",
          "10:     </p>",
          "11:   </div>",
          "12:   <p>",
          "13:     <label>",
          "14:       <%= f.check_box :remember_me %>",
          "16:     </label>",
          "17:   </p>",
          "20: <% end %>",
          "",
          "[Removed Lines]",
          "4:       <%= f.label :email, t(:email) %><br />",
          "8:       <%= f.label :password, t(:password) %><br />",
          "15:       <%= f.label :remember_me, t(:remember_me) %>",
          "19:   <p><%= f.submit t(:login), :class => 'button primary', :tabindex => 3 %></p>",
          "",
          "[Added Lines]",
          "4:       <%= f.label :email, Spree.t(:email) %><br />",
          "8:       <%= f.label :password, Spree.t(:password) %><br />",
          "15:       <%= f.label :remember_me, Spree.t(:remember_me) %>",
          "19:   <p><%= f.submit Spree.t(:login), :class => 'button primary', :tabindex => 3 %></p>",
          "",
          "---------------"
        ],
        "app/views/spree/shared/_login_bar.html.erb||app/views/spree/shared/_login_bar.html.erb": [
          "File: app/views/spree/shared/_login_bar.html.erb -> app/views/spree/shared/_login_bar.html.erb",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: <% if spree_current_user %>",
          "4: <% else %>",
          "6: <% end %>",
          "",
          "[Removed Lines]",
          "2:   <li><%= link_to t(:my_account), spree.account_path %></li>",
          "3:   <li><%= link_to t(:logout), spree.destroy_spree_user_session_path %></li>",
          "5:   <li id=\"link-to-login\"><%= link_to t(:login), spree.login_path %></li>",
          "",
          "[Added Lines]",
          "2:   <li><%= link_to Spree.t(:my_account), spree.account_path %></li>",
          "3:   <li><%= link_to Spree.t(:logout), spree.destroy_spree_user_session_path %></li>",
          "5:   <li id=\"link-to-login\"><%= link_to Spree.t(:login), spree.login_path %></li>",
          "",
          "---------------"
        ],
        "app/views/spree/shared/_user_form.html.erb||app/views/spree/shared/_user_form.html.erb": [
          "File: app/views/spree/shared/_user_form.html.erb -> app/views/spree/shared/_user_form.html.erb",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: <p>",
          "3:   <%= f.email_field :email, :class => 'title' %>",
          "4: </p>",
          "5: <div id=\"password-credentials\">",
          "6:   <p>",
          "8:     <%= f.password_field :password, :class => 'title' %>",
          "9:   </p>",
          "11:   <p>",
          "13:     <%= f.password_field :password_confirmation, :class => 'title' %>",
          "14:   </p>",
          "15: </div>",
          "",
          "[Removed Lines]",
          "2:   <%= f.label :email, t(:email) %><br />",
          "7:     <%= f.label :password, t(:password) %><br />",
          "12:     <%= f.label :password_confirmation, t(:confirm_password) %><br />",
          "",
          "[Added Lines]",
          "2:   <%= f.label :email, Spree.t(:email) %><br />",
          "7:     <%= f.label :password, Spree.t(:password) %><br />",
          "12:     <%= f.label :password_confirmation, Spree.t(:confirm_password) %><br />",
          "",
          "---------------"
        ],
        "app/views/spree/user_passwords/edit.html.erb||app/views/spree/user_passwords/edit.html.erb": [
          "File: app/views/spree/user_passwords/edit.html.erb -> app/views/spree/user_passwords/edit.html.erb",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: <%= render :partial => 'spree/shared/error_messages', :locals => { :target => @spree_user } %>",
          "4: <%= form_for @spree_user, :as => :spree_user, :url => spree.spree_user_password_path, :method => :put do |f| %>",
          "5:   <p>",
          "7:     <%= f.password_field :password %><br />",
          "8:   </p>",
          "9:   <p>",
          "11:     <%= f.password_field :password_confirmation %><br />",
          "12:   </p>",
          "13:   <%= f.hidden_field :reset_password_token %>",
          "15: <% end %>",
          "",
          "[Removed Lines]",
          "2: <h2><%= t(:change_my_password) %></h2>",
          "6:     <%= f.label :password, t(:password) %><br />",
          "10:     <%= f.label :password_confirmation, t(:password_confirmation) %><br />",
          "14:   <%= f.submit t(:update_password), :class => 'button primary' %>",
          "",
          "[Added Lines]",
          "2: <h2><%= Spree.t(:change_my_password) %></h2>",
          "6:     <%= f.label :password, Spree.t(:password) %><br />",
          "10:     <%= f.label :password_confirmation, Spree.t(:password_confirmation) %><br />",
          "14:   <%= f.submit Spree.t(:update_password), :class => 'button primary' %>",
          "",
          "---------------"
        ],
        "app/views/spree/user_passwords/new.html.erb||app/views/spree/user_passwords/new.html.erb": [
          "File: app/views/spree/user_passwords/new.html.erb -> app/views/spree/user_passwords/new.html.erb",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: <%= render :partial => 'spree/shared/error_messages', :locals => { :target => @spree_user } %>",
          "3: <div id=\"forgot-password\">",
          "8:   <%= form_for Spree::User.new, :as => :spree_user, :url => spree.spree_user_password_path do |f| %>",
          "9:     <p>",
          "11:       <%= f.email_field :email %>",
          "12:     </p>",
          "13:     <p>",
          "15:     </p>",
          "16:   <% end %>",
          "17: </div>",
          "",
          "[Removed Lines]",
          "4:   <h6><%= t(:forgot_password) %></h6>",
          "6:   <p><%= t(:instructions_to_reset_password) %></p>",
          "10:       <%= f.label :email, t(:email) %><br />",
          "14:       <%= f.submit t(:reset_password), :class => 'button primary' %>",
          "",
          "[Added Lines]",
          "4:   <h6><%= Spree.t(:forgot_password) %></h6>",
          "6:   <p><%= Spree.t(:instructions_to_reset_password) %></p>",
          "10:       <%= f.label :email, Spree.t(:email) %><br />",
          "14:       <%= f.submit Spree.t(:reset_password), :class => 'button primary' %>",
          "",
          "---------------"
        ],
        "app/views/spree/user_registrations/new.html.erb||app/views/spree/user_registrations/new.html.erb": [
          "File: app/views/spree/user_registrations/new.html.erb -> app/views/spree/user_registrations/new.html.erb",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: <%= render :partial => 'spree/shared/error_messages', :locals => { :target => @user } %>",
          "5: <div id=\"new-customer\">",
          "8:   <div data-hook=\"signup\">",
          "10:     <%= form_for :spree_user, :url => spree.spree_user_registration_path(@user) do |f| %>",
          "11:       <div data-hook=\"signup_inside_form\">",
          "12:         <%= render :partial => 'spree/shared/user_form', :locals => { :f => f } %>",
          "14:       </div>",
          "15:     <% end %>",
          "18:   </div>",
          "",
          "[Removed Lines]",
          "6:   <h6><%= t(:new_customer) %></h6>",
          "13:         <p><%= f.submit t(:create), :class => 'button primary' %></p>",
          "16:     <%= t(:or) %> <%= link_to t(:login_as_existing), spree.login_path %>",
          "",
          "[Added Lines]",
          "6:   <h6><%= Spree.t(:new_customer) %></h6>",
          "13:         <p><%= f.submit Spree.t(:create), :class => 'button primary' %></p>",
          "16:     <%= Spree.t(:or) %> <%= link_to Spree.t(:login_as_existing), spree.login_path %>",
          "",
          "---------------"
        ],
        "app/views/spree/user_sessions/authorization_failure.html.erb||app/views/spree/user_sessions/authorization_failure.html.erb": [
          "File: app/views/spree/user_sessions/authorization_failure.html.erb -> app/views/spree/user_sessions/authorization_failure.html.erb",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: <div style=\"height:50px; padding-top:20px;\">",
          "4: <!-- Add your own custom access denied message here if you like -->",
          "",
          "[Removed Lines]",
          "2:   <strong><%= t(:authorization_failure) %></strong>",
          "3: </div>",
          "",
          "[Added Lines]",
          "2:   <strong><%= Spree.t(:authorization_failure) %></strong>",
          "3: </div>",
          "",
          "---------------"
        ],
        "app/views/spree/user_sessions/new.html.erb||app/views/spree/user_sessions/new.html.erb": [
          "File: app/views/spree/user_sessions/new.html.erb -> app/views/spree/user_sessions/new.html.erb",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: <% @body_id = 'login' %>",
          "6: <div id=\"existing-customer\">",
          "8:   <div data-hook=\"login\">",
          "9:     <%= render :partial => 'spree/shared/login' %>",
          "11:   </div>",
          "12: </div>",
          "13: <div data-hook=\"login_extras\"></div>",
          "",
          "[Removed Lines]",
          "7:   <h6><%= t(:login_as_existing) %></h6>",
          "10:     <%= t(:or) %> <%= link_to t(:create_a_new_account), spree.signup_path %> | <%= link_to t(:forgot_password), spree.new_spree_user_password_path %>",
          "",
          "[Added Lines]",
          "7:   <h6><%= Spree.t(:login_as_existing) %></h6>",
          "10:     <%= Spree.t(:or) %>",
          "11:     <%= link_to Spree.t(:create_a_new_account), spree.signup_path %> |",
          "12:     <%= link_to Spree.t(:forgot_password), spree.new_spree_user_password_path %>",
          "",
          "---------------"
        ],
        "app/views/spree/users/edit.html.erb||app/views/spree/users/edit.html.erb": [
          "File: app/views/spree/users/edit.html.erb -> app/views/spree/users/edit.html.erb",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: <%= render :partial => 'spree/shared/error_messages', :locals => { :target => @user } %>",
          "5: <%= form_for @user, :url => spree.user_path(@user), :method => :put do |f| %>",
          "6:   <%= render :partial => 'spree/shared/user_form', :locals => { :f => f } %>",
          "7:   <p>",
          "9:   </p>",
          "10: <% end %>",
          "",
          "[Removed Lines]",
          "3: <h1><%= t(:editing_user) %></h1>",
          "8:     <%= f.submit t(:update), :class => 'button primary' %>",
          "",
          "[Added Lines]",
          "3: <h1><%= Spree.t(:editing_user) %></h1>",
          "8:     <%= f.submit Spree.t(:update), :class => 'button primary' %>",
          "",
          "---------------"
        ],
        "app/views/spree/users/show.html.erb||app/views/spree/users/show.html.erb": [
          "File: app/views/spree/users/show.html.erb -> app/views/spree/users/show.html.erb",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: <div data-hook=\"account_summary\" class=\"account-summary\">",
          "4:   <dl id=\"user-info\">",
          "7:   </dl>",
          "8: </div>",
          "10: <div data-hook=\"account_my_orders\" class=\"account-my-orders\">",
          "13:   <% if @orders.present? %>",
          "14:     <table class=\"order-summary\">",
          "15:       <thead>",
          "16:       <tr>",
          "23:       </tr>",
          "24:       </thead>",
          "25:       <tbody>",
          "",
          "[Removed Lines]",
          "5:     <dt><%= t(:email) %></dt>",
          "6:     <dd><%= @user.email %> (<%= link_to t(:edit), spree.edit_account_path %>)</dd>",
          "12:   <h3><%= t(:my_orders) %></h3>",
          "17:         <th class=\"order-number\"><%= t(:order_number) %></th>",
          "18:         <th class=\"order-date\"><%= t(:order_date) %></th>",
          "19:         <th class=\"order-status\"><%= t(:status) %></th>",
          "20:         <th class=\"order-payment-state\"><%= t(:payment_state) %></th>",
          "21:         <th class=\"order-shipment-state\"><%= t(:shipment_state) %></th>",
          "22:         <th class=\"order-total\"><%= t(:total) %></th>",
          "",
          "[Added Lines]",
          "5:     <dt><%= Spree.t(:email) %></dt>",
          "6:     <dd><%= @user.email %> (<%= link_to Spree.t(:edit), spree.edit_account_path %>)</dd>",
          "12:   <h3><%= Spree.t(:my_orders) %></h3>",
          "17:         <th class=\"order-number\"><%= Spree.t(:order_number) %></th>",
          "18:         <th class=\"order-date\"><%= Spree.t(:order_date) %></th>",
          "19:         <th class=\"order-status\"><%= Spree.t(:status) %></th>",
          "20:         <th class=\"order-payment-state\"><%= Spree.t(:payment_state) %></th>",
          "21:         <th class=\"order-shipment-state\"><%= Spree.t(:shipment_state) %></th>",
          "22:         <th class=\"order-total\"><%= Spree.t(:total) %></th>",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "28:           <td class=\"order-number\"><%= link_to order.number, order_url(order) %></td>",
          "29:           <td class=\"order-date\"><%= l order.completed_at.to_date %></td>",
          "30:           <td class=\"order-status\"><%= t(order.state).titleize %></td>",
          "33:           <td class=\"order-total\"><%= money order.total %></td>",
          "34:         </tr>",
          "35:       <% end %>",
          "36:       </tbody>",
          "37:     </table>",
          "38:   <% else %>",
          "40:   <% end %>",
          "41:   <br />",
          "",
          "[Removed Lines]",
          "31:           <td class=\"order-payment-state\"><%= t(\"payment_states.#{order.payment_state}\") if order.payment_state %></td>",
          "32:           <td class=\"order-shipment-state\"><%= t(\"shipment_states.#{order.shipment_state}\") if order.shipment_state %></td>",
          "39:     <p><%= t(:you_have_no_orders_yet) %></p>",
          "",
          "[Added Lines]",
          "31:           <td class=\"order-payment-state\"><%= Spree.t(\"payment_states.#{order.payment_state}\") if order.payment_state %></td>",
          "32:           <td class=\"order-shipment-state\"><%= Spree.t(\"shipment_states.#{order.shipment_state}\") if order.shipment_state %></td>",
          "39:     <p><%= Spree.t(:you_have_no_orders_yet) %></p>",
          "",
          "---------------"
        ],
        "spec/controllers/spree/checkout_controller_spec.rb||spec/controllers/spree/checkout_controller_spec.rb": [
          "File: spec/controllers/spree/checkout_controller_spec.rb -> spec/controllers/spree/checkout_controller_spec.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "21:         before { controller.stub :spree_current_user => user }",
          "23:         it 'should proceed to the first checkout step' do",
          "25:           response.should render_template :edit",
          "26:         end",
          "27:       end",
          "",
          "[Removed Lines]",
          "24:           spree_get :edit, { :state => 'address' }",
          "",
          "[Added Lines]",
          "24:           spree_get :edit, { :state => 'address' }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "78:         it 'should redirect to the tokenized order view' do",
          "79:           spree_post :update, { :state => 'confirm' }, { :access_token => \"ABC\" }",
          "80:           response.should redirect_to spree.token_order_path(order, 'ABC')",
          "82:         end",
          "83:       end",
          "",
          "[Removed Lines]",
          "81:           flash.notice.should == I18n.t(:order_processed_successfully)",
          "",
          "[Added Lines]",
          "81:           flash.notice.should == Spree.t(:order_processed_successfully)",
          "",
          "---------------"
        ],
        "spec/requests/account_spec.rb||spec/requests/account_spec.rb": [
          "File: spec/requests/account_spec.rb -> spec/requests/account_spec.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "28:       fill_in \"Password Confirmation\", :with => \"foobar\"",
          "29:       click_button \"Update\"",
          "30:       page.should have_content(\"email@person.com\")",
          "32:     end",
          "34:     it \"should be able to edit an existing user account\" do",
          "",
          "[Removed Lines]",
          "31:       page.should have_content(\"Account updated!\")",
          "",
          "[Added Lines]",
          "31:       page.should have_content(\"Account updated\")",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "46:       fill_in \"Password Confirmation\", :with => \"foobar\"",
          "47:       click_button \"Update\"",
          "48:       page.should have_content(\"email@person.com\")",
          "50:     end",
          "51:   end",
          "52: end",
          "",
          "[Removed Lines]",
          "49:       page.should have_content(\"Account updated!\")",
          "",
          "[Added Lines]",
          "49:       page.should have_content(\"Account updated\")",
          "",
          "---------------"
        ],
        "spec/requests/admin/users_spec.rb||spec/requests/admin/users_spec.rb": [
          "File: spec/requests/admin/users_spec.rb -> spec/requests/admin/users_spec.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "53:       fill_in \"user_email\", :with => \"a@example.com99\"",
          "54:       click_button \"Update\"",
          "57:       find_field(\"user_email\").value.should == \"a@example.com99\"",
          "58:     end",
          "",
          "[Removed Lines]",
          "56:       page.should have_content(\"Account updated!\")",
          "",
          "[Added Lines]",
          "56:       page.should have_content(\"Account updated\")",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "62:       fill_in \"user_password_confirmation\", :with => \"welcome\"",
          "63:       click_button \"Update\"",
          "66:     end",
          "67:   end",
          "68: end",
          "",
          "[Removed Lines]",
          "65:       page.should have_content(\"Account updated!\")",
          "",
          "[Added Lines]",
          "65:       page.should have_content(\"Account updated\")",
          "",
          "---------------"
        ],
        "spec/requests/user_spec.rb||spec/requests/user_spec.rb": [
          "File: spec/requests/user_spec.rb -> spec/requests/user_spec.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "9:     fill_in \"Password\", :with => user.password",
          "10:     click_button \"Login\"",
          "11:     click_link \"Users\"",
          "13:     click_link \"Edit\"",
          "14:     page.should have_content(\"Editing User\")",
          "15:   end",
          "",
          "[Removed Lines]",
          "12:     within('table#listing_users td.Email') { click_link \"admin@person.com\" }",
          "",
          "[Added Lines]",
          "12:     within('table#listing_users td.user_email') { click_link \"admin@person.com\" }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "23:   it \"admin editing roles\" do",
          "24:     check \"user_spree_role_user\"",
          "25:     click_button \"Update\"",
          "27:     find_field('user_spree_role_user')['checked'].should be_true",
          "28:   end",
          "29: end",
          "",
          "[Removed Lines]",
          "26:     page.should have_content(\"Account updated!\")",
          "",
          "[Added Lines]",
          "26:     page.should have_content(\"Account updated\")",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "03df63b6e9b9792c8b30a4a0fad7cc020333df3d",
      "candidate_info": {
        "commit_hash": "03df63b6e9b9792c8b30a4a0fad7cc020333df3d",
        "repo": "spree/spree_auth_devise",
        "commit_url": "https://github.com/spree/spree_auth_devise/commit/03df63b6e9b9792c8b30a4a0fad7cc020333df3d",
        "files": [
          "app/controllers/spree/admin/users_controller.rb",
          "app/controllers/spree/checkout_controller_decorator.rb",
          "app/controllers/spree/user_registrations_controller.rb",
          "app/controllers/spree/users_controller.rb",
          "app/models/spree/user.rb",
          "spec/controllers/spree/admin/users_controller_spec.rb",
          "spec/controllers/spree/users_controller_spec.rb",
          "spec/features/checkout_spec.rb",
          "spec/features/promotion_adjustment_spec.rb"
        ],
        "message": "Fix ActiveModel::ForbiddenAttributes errors\n\nDown to 1 failing spec",
        "before_after_code_files": [
          "app/controllers/spree/admin/users_controller.rb||app/controllers/spree/admin/users_controller.rb",
          "app/controllers/spree/checkout_controller_decorator.rb||app/controllers/spree/checkout_controller_decorator.rb",
          "app/controllers/spree/user_registrations_controller.rb||app/controllers/spree/user_registrations_controller.rb",
          "app/controllers/spree/users_controller.rb||app/controllers/spree/users_controller.rb",
          "app/models/spree/user.rb||app/models/spree/user.rb",
          "spec/controllers/spree/admin/users_controller_spec.rb||spec/controllers/spree/admin/users_controller_spec.rb",
          "spec/controllers/spree/users_controller_spec.rb||spec/controllers/spree/users_controller_spec.rb",
          "spec/features/checkout_spec.rb||spec/features/checkout_spec.rb",
          "spec/features/promotion_adjustment_spec.rb||spec/features/promotion_adjustment_spec.rb"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "app/controllers/spree/admin/users_controller.rb||app/controllers/spree/admin/users_controller.rb",
            "app/models/spree/user.rb||app/models/spree/user.rb",
            "spec/controllers/spree/users_controller_spec.rb||spec/controllers/spree/users_controller_spec.rb"
          ],
          "candidate": [
            "app/controllers/spree/admin/users_controller.rb||app/controllers/spree/admin/users_controller.rb",
            "app/models/spree/user.rb||app/models/spree/user.rb",
            "spec/controllers/spree/users_controller_spec.rb||spec/controllers/spree/users_controller_spec.rb"
          ]
        }
      },
      "candidate_diff": {
        "app/controllers/spree/admin/users_controller.rb||app/controllers/spree/admin/users_controller.rb": [
          "File: app/controllers/spree/admin/users_controller.rb -> app/controllers/spree/admin/users_controller.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "21:           roles = params[:user].delete(\"spree_role_ids\")",
          "22:         end",
          "25:         if @user.save",
          "27:           if roles",
          "",
          "[Removed Lines]",
          "24:         @user = Spree::User.new(params[:user])",
          "",
          "[Added Lines]",
          "24:         @user = Spree::User.new(user_params)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "40:           roles = params[:user].delete(\"spree_role_ids\")",
          "41:         end",
          "44:           if roles",
          "45:             @user.spree_roles = roles.reject(&:blank?).collect{|r| Spree::Role.find(r)}",
          "46:           end",
          "",
          "[Removed Lines]",
          "43:         if @user.update_attributes(params[:user])",
          "",
          "[Added Lines]",
          "43:         if @user.update_attributes(user_params)",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "93:         end",
          "95:       private",
          "97:         # handling raise from Spree::Admin::ResourceController#destroy",
          "98:         def user_destroy_with_orders_error",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "96:         def user_params",
          "97:           params.require(:user).permit(:email, :password, :password_confirmation, :spree_role_ids)",
          "98:         end",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "122:         end",
          "124:         def load_roles",
          "126:         end",
          "127:     end",
          "128:   end",
          "",
          "[Removed Lines]",
          "125:           @roles = Spree::Role.scoped",
          "",
          "[Added Lines]",
          "128:           @roles = Spree::Role.all",
          "",
          "---------------"
        ],
        "app/controllers/spree/checkout_controller_decorator.rb||app/controllers/spree/checkout_controller_decorator.rb": [
          "File: app/controllers/spree/checkout_controller_decorator.rb -> app/controllers/spree/checkout_controller_decorator.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "13:     fire_event(\"spree.user.signup\", :order => current_order)",
          "14:     # hack - temporarily change the state to something other than cart so we can validate the order email address",
          "15:     current_order.state = current_order.checkout_steps.first",
          "17:       redirect_to checkout_path",
          "18:     else",
          "19:       @user = Spree::User.new",
          "",
          "[Removed Lines]",
          "16:     if current_order.update_attributes(params[:order])",
          "",
          "[Added Lines]",
          "16:     if current_order.update_attributes(order_params)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "22:   end",
          "24:   private",
          "26:     def skip_state_validation?",
          "27:       %w(registration update_registration).include?(params[:action])",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "25:     def order_params",
          "26:       if params[:order]",
          "27:         params.require(:order).permit(:email)",
          "28:       else",
          "29:         {}",
          "30:       end",
          "31:     end",
          "",
          "---------------"
        ],
        "app/controllers/spree/user_registrations_controller.rb||app/controllers/spree/user_registrations_controller.rb": [
          "File: app/controllers/spree/user_registrations_controller.rb -> app/controllers/spree/user_registrations_controller.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "22:   # POST /resource/sign_up",
          "23:   def create",
          "25:     if resource.save",
          "26:       set_flash_message(:notice, :signed_up)",
          "27:       sign_in(:spree_user, @user)",
          "",
          "[Removed Lines]",
          "24:     @user = build_resource(params[:spree_user])",
          "",
          "[Added Lines]",
          "24:     @user = build_resource(spree_user_params)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "63:       authorize!(:create, resource)",
          "64:     end",
          "66: end",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "66:   private",
          "67:     def spree_user_params",
          "68:       params.require(:spree_user).permit(:email, :password, :password_confirmation)",
          "69:     end",
          "",
          "---------------"
        ],
        "app/controllers/spree/users_controller.rb||app/controllers/spree/users_controller.rb": [
          "File: app/controllers/spree/users_controller.rb -> app/controllers/spree/users_controller.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "11:   end",
          "13:   def create",
          "15:     if @user.save",
          "17:       if current_order",
          "",
          "[Removed Lines]",
          "14:     @user = Spree::User.new(params[:user])",
          "",
          "[Added Lines]",
          "14:     @user = Spree::User.new(user_params)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "25:   end",
          "27:   def update",
          "29:       if params[:user][:password].present?",
          "30:         # this logic needed b/c devise wants to log us out after password changes",
          "31:         user = Spree::User.reset_password_by_token(params[:user])",
          "",
          "[Removed Lines]",
          "28:     if @user.update_attributes(params[:user])",
          "",
          "[Added Lines]",
          "28:     if @user.update_attributes(user_params)",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "38:   end",
          "40:   private",
          "41:     def load_object",
          "42:       @user ||= spree_current_user",
          "43:       authorize! params[:action].to_sym, @user",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "41:     def user_params",
          "42:       params.require(:user).permit(:email, :password, :password_confirmation)",
          "43:     end",
          "",
          "---------------"
        ],
        "app/models/spree/user.rb||app/models/spree/user.rb": [
          "File: app/models/spree/user.rb -> app/models/spree/user.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "19:     roles_table_name = Role.table_name",
          "21:     scope :admin, lambda { includes(:spree_roles).where(\"#{roles_table_name}.name\" => \"admin\") }",
          "24:     class DestroyWithOrdersError < StandardError; end",
          "",
          "[Removed Lines]",
          "22:     scope :registered, where(\"#{users_table_name}.email NOT LIKE ?\", \"%@example.net\")",
          "",
          "[Added Lines]",
          "22:     scope :registered, -> { where(\"#{users_table_name}.email NOT LIKE ?\", \"%@example.net\") }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "73:       def self.generate_token(column)",
          "74:         loop do",
          "75:           token = friendly_token",
          "77:         end",
          "78:       end",
          "79:   end",
          "",
          "[Removed Lines]",
          "76:           break token unless find(:first, :conditions => { column => token })",
          "",
          "[Added Lines]",
          "76:           break token unless where(column => token).first",
          "",
          "---------------"
        ],
        "spec/controllers/spree/admin/users_controller_spec.rb||spec/controllers/spree/admin/users_controller_spec.rb": [
          "File: spec/controllers/spree/admin/users_controller_spec.rb -> spec/controllers/spree/admin/users_controller_spec.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "15:     end",
          "17:     it 'should grant access to users with an admin role' do",
          "19:       spree_post :index",
          "20:       response.should render_template :index",
          "21:     end",
          "",
          "[Removed Lines]",
          "18:       user.spree_roles << Spree::Role.find_or_create_by_name('admin')",
          "",
          "[Added Lines]",
          "18:       user.spree_roles << Spree::Role.find_or_create_by(name: 'admin')",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "35:     end",
          "37:     it 'should deny access to users with an bar role' do",
          "39:       Spree::Ability.register_ability(BarAbility)",
          "40:       spree_post :index",
          "41:       response.should redirect_to('/unauthorized')",
          "42:     end",
          "44:     it 'should deny access to users with an bar role' do",
          "46:       Spree::Ability.register_ability(BarAbility)",
          "47:       spree_post :update, { :id => '9' }",
          "48:       response.should redirect_to('/unauthorized')",
          "",
          "[Removed Lines]",
          "38:       user.spree_roles << Spree::Role.find_or_create_by_name('bar')",
          "45:       user.spree_roles << Spree::Role.find_or_create_by_name('bar')",
          "",
          "[Added Lines]",
          "38:       user.spree_roles << Spree::Role.find_or_create_by(name: 'bar')",
          "45:       user.spree_roles << Spree::Role.find_or_create_by(name: 'bar')",
          "",
          "---------------"
        ],
        "spec/controllers/spree/users_controller_spec.rb||spec/controllers/spree/users_controller_spec.rb": [
          "File: spec/controllers/spree/users_controller_spec.rb -> spec/controllers/spree/users_controller_spec.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "26:     end",
          "28:     it 'should not update roles' do",
          "30:     end",
          "31:   end",
          "32: end",
          "",
          "[Removed Lines]",
          "29:       expect { spree_put :update, { :user => { :spree_role_ids => [role.id] } }}.to raise_exception(ActiveModel::MassAssignmentSecurity::Error)",
          "",
          "[Added Lines]",
          "29:       spree_put :update, :user => { :spree_role_ids => [role.id] }",
          "30:       expect(assigns[:user].spree_roles).to_not include role",
          "33:     pending \"figure out why ActiveModel::ForbiddenAttributesError is not raised when passing spree_role_ids\"",
          "",
          "---------------"
        ],
        "spec/features/checkout_spec.rb||spec/features/checkout_spec.rb": [
          "File: spec/features/checkout_spec.rb -> spec/features/checkout_spec.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "5:   let!(:state) { create(:state, :name => \"Maryland\", :country => country) }",
          "6:   let!(:shipping_method) do",
          "7:     shipping_method = create(:shipping_method)",
          "9:     shipping_method.calculator = calculator",
          "10:     shipping_method.tap(&:save)",
          "11:   end",
          "",
          "[Removed Lines]",
          "8:     calculator = Spree::Calculator::Shipping::PerItem.create!({:calculable => shipping_method, :preferred_amount => 10}, :without_protection => true)",
          "",
          "[Added Lines]",
          "8:     calculator = Spree::Calculator::Shipping::PerItem.create!(:calculable => shipping_method, :preferred_amount => 10)",
          "",
          "---------------"
        ],
        "spec/features/promotion_adjustment_spec.rb||spec/features/promotion_adjustment_spec.rb": [
          "File: spec/features/promotion_adjustment_spec.rb -> spec/features/promotion_adjustment_spec.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "6:   let!(:state) { create(:state, :name => \"Maryland\", :country => country) }",
          "7:   let!(:shipping_method) do",
          "8:     shipping_method = create(:shipping_method)",
          "10:     shipping_method.calculator = calculator",
          "11:     shipping_method.save",
          "",
          "[Removed Lines]",
          "9:     calculator = Spree::Calculator::Shipping::PerItem.create!({:calculable => shipping_method, :preferred_amount => 10}, :without_protection => true)",
          "",
          "[Added Lines]",
          "9:     calculator = Spree::Calculator::Shipping::PerItem.create!(:calculable => shipping_method, :preferred_amount => 10)",
          "",
          "---------------"
        ]
      }
    }
  ]
}