{
  "cve_id": "CVE-2022-23053",
  "cve_desc": "Openmct versions 1.3.0 to 1.7.7 are vulnerable against stored XSS via the \u201cCondition Widget\u201d element, that allows the injection of malicious JavaScript into the \u2018URL\u2019 field. This issue affects: nasa openmct 1.7.7 version and prior versions; 1.3.0 version and later versions.",
  "repo": "nasa/openmct",
  "patch_hash": "abc93d0ec4b104dac1ea5f8a615d06e3ab78934a",
  "patch_info": {
    "commit_hash": "abc93d0ec4b104dac1ea5f8a615d06e3ab78934a",
    "repo": "nasa/openmct",
    "commit_url": "https://github.com/nasa/openmct/commit/abc93d0ec4b104dac1ea5f8a615d06e3ab78934a",
    "files": [
      "src/plugins/conditionWidget/components/ConditionWidget.vue",
      "src/plugins/hyperlink/HyperlinkLayout.vue",
      "src/plugins/summaryWidget/src/SummaryWidget.js",
      "src/plugins/summaryWidget/src/views/SummaryWidgetView.js",
      "src/plugins/webPage/components/WebPage.vue"
    ],
    "message": "Add back urlDefined and remove null checks",
    "before_after_code_files": [
      "src/plugins/conditionWidget/components/ConditionWidget.vue||src/plugins/conditionWidget/components/ConditionWidget.vue",
      "src/plugins/hyperlink/HyperlinkLayout.vue||src/plugins/hyperlink/HyperlinkLayout.vue",
      "src/plugins/summaryWidget/src/SummaryWidget.js||src/plugins/summaryWidget/src/SummaryWidget.js",
      "src/plugins/summaryWidget/src/views/SummaryWidgetView.js||src/plugins/summaryWidget/src/views/SummaryWidgetView.js",
      "src/plugins/webPage/components/WebPage.vue||src/plugins/webPage/components/WebPage.vue"
    ]
  },
  "patch_diff": {
    "src/plugins/conditionWidget/components/ConditionWidget.vue||src/plugins/conditionWidget/components/ConditionWidget.vue": [
      "File: src/plugins/conditionWidget/components/ConditionWidget.vue -> src/plugins/conditionWidget/components/ConditionWidget.vue",
      "--- Hunk 1 ---",
      "[Context before]",
      "42:         };",
      "43:     },",
      "44:     computed: {",
      "45:         url() {",
      "53:         }",
      "54:     },",
      "55:     mounted() {",
      "",
      "[Removed Lines]",
      "46:             const urlDefined = this.internalDomainObject.url && this.internalDomainObject.url.length > 0;",
      "47:             let url = urlDefined ? this.internalDomainObject.url : null;",
      "48:             if (url) {",
      "49:                 url = sanitizeUrl(url);",
      "50:             }",
      "52:             return url;",
      "",
      "[Added Lines]",
      "45:         urlDefined() {",
      "46:             return this.internalDomainObject.url && this.internalDomainObject.url.length > 0;",
      "47:         },",
      "49:             return this.urlDefined ? sanitizeUrl(this.internalDomainObject.url) : null;",
      "",
      "---------------"
    ],
    "src/plugins/hyperlink/HyperlinkLayout.vue||src/plugins/hyperlink/HyperlinkLayout.vue": [
      "File: src/plugins/hyperlink/HyperlinkLayout.vue -> src/plugins/hyperlink/HyperlinkLayout.vue",
      "--- Hunk 1 ---",
      "[Context before]",
      "48:             return true;",
      "49:         },",
      "50:         url() {",
      "57:         }",
      "58:     }",
      "59: };",
      "",
      "[Removed Lines]",
      "51:             let url = this.domainObject.url;",
      "52:             if (url) {",
      "53:                 url = sanitizeUrl(url);",
      "54:             }",
      "56:             return url;",
      "",
      "[Added Lines]",
      "51:             return sanitizeUrl(this.domainObject.url);",
      "",
      "---------------"
    ],
    "src/plugins/summaryWidget/src/SummaryWidget.js||src/plugins/summaryWidget/src/SummaryWidget.js": [
      "File: src/plugins/summaryWidget/src/SummaryWidget.js -> src/plugins/summaryWidget/src/SummaryWidget.js",
      "--- Hunk 1 ---",
      "[Context before]",
      "117:     SummaryWidget.prototype.addHyperlink = function (url, openNewTab) {",
      "118:         if (url) {",
      "122:         } else {",
      "123:             this.widgetButton.removeAttr('href');",
      "124:         }",
      "",
      "[Removed Lines]",
      "119:             const sanitizeUrl = urlSanitizeLib.sanitizeUrl;",
      "120:             url = sanitizeUrl(url);",
      "121:             this.widgetButton.attr('href', url);",
      "",
      "[Added Lines]",
      "119:             this.widgetButton.attr('href', urlSanitizeLib.sanitizeUrl(url));",
      "",
      "---------------"
    ],
    "src/plugins/summaryWidget/src/views/SummaryWidgetView.js||src/plugins/summaryWidget/src/views/SummaryWidgetView.js": [
      "File: src/plugins/summaryWidget/src/views/SummaryWidgetView.js -> src/plugins/summaryWidget/src/views/SummaryWidgetView.js",
      "--- Hunk 1 ---",
      "[Context before]",
      "40:         let url = this.domainObject.url;",
      "41:         if (url) {",
      "45:         } else {",
      "46:             this.widget.removeAttribute('href');",
      "47:         }",
      "",
      "[Removed Lines]",
      "42:             const sanitizeUrl = urlSanitizeLib.sanitizeUrl;",
      "43:             url = sanitizeUrl(url);",
      "44:             this.widget.setAttribute('href', url);",
      "",
      "[Added Lines]",
      "42:             this.widget.setAttribute('href', urlSanitizeLib.sanitizeUrl(url));",
      "",
      "---------------"
    ],
    "src/plugins/webPage/components/WebPage.vue||src/plugins/webPage/components/WebPage.vue": [
      "File: src/plugins/webPage/components/WebPage.vue -> src/plugins/webPage/components/WebPage.vue",
      "--- Hunk 1 ---",
      "[Context before]",
      "16:     },",
      "17:     computed: {",
      "18:         url() {",
      "25:         }",
      "26:     }",
      "27: };",
      "",
      "[Removed Lines]",
      "19:             let url = this.currentDomainObject.url;",
      "20:             if (url) {",
      "21:                 url = sanitizeUrl(url);",
      "22:             }",
      "24:             return url;",
      "",
      "[Added Lines]",
      "19:             return sanitizeUrl(this.currentDomainObject.url);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "de5da9445b2d8944336f660246556f4f1f9008ac",
      "candidate_info": {
        "commit_hash": "de5da9445b2d8944336f660246556f4f1f9008ac",
        "repo": "nasa/openmct",
        "commit_url": "https://github.com/nasa/openmct/commit/de5da9445b2d8944336f660246556f4f1f9008ac",
        "files": [
          "package.json",
          "src/plugins/conditionWidget/components/ConditionWidget.vue",
          "src/plugins/hyperlink/HyperlinkLayout.vue",
          "src/plugins/summaryWidget/src/SummaryWidget.js",
          "src/plugins/summaryWidget/src/views/SummaryWidgetView.js",
          "src/plugins/webPage/components/WebPage.vue"
        ],
        "message": "Add braintree sanitize url lib and sanitize form urls (#4296)",
        "before_after_code_files": [
          "src/plugins/conditionWidget/components/ConditionWidget.vue||src/plugins/conditionWidget/components/ConditionWidget.vue",
          "src/plugins/hyperlink/HyperlinkLayout.vue||src/plugins/hyperlink/HyperlinkLayout.vue",
          "src/plugins/summaryWidget/src/SummaryWidget.js||src/plugins/summaryWidget/src/SummaryWidget.js",
          "src/plugins/summaryWidget/src/views/SummaryWidgetView.js||src/plugins/summaryWidget/src/views/SummaryWidgetView.js",
          "src/plugins/webPage/components/WebPage.vue||src/plugins/webPage/components/WebPage.vue"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/nasa/openmct/pull/4296"
        ],
        "olp_code_files": {
          "patch": [
            "src/plugins/conditionWidget/components/ConditionWidget.vue||src/plugins/conditionWidget/components/ConditionWidget.vue",
            "src/plugins/hyperlink/HyperlinkLayout.vue||src/plugins/hyperlink/HyperlinkLayout.vue",
            "src/plugins/summaryWidget/src/SummaryWidget.js||src/plugins/summaryWidget/src/SummaryWidget.js",
            "src/plugins/summaryWidget/src/views/SummaryWidgetView.js||src/plugins/summaryWidget/src/views/SummaryWidgetView.js",
            "src/plugins/webPage/components/WebPage.vue||src/plugins/webPage/components/WebPage.vue"
          ],
          "candidate": [
            "src/plugins/conditionWidget/components/ConditionWidget.vue||src/plugins/conditionWidget/components/ConditionWidget.vue",
            "src/plugins/hyperlink/HyperlinkLayout.vue||src/plugins/hyperlink/HyperlinkLayout.vue",
            "src/plugins/summaryWidget/src/SummaryWidget.js||src/plugins/summaryWidget/src/SummaryWidget.js",
            "src/plugins/summaryWidget/src/views/SummaryWidgetView.js||src/plugins/summaryWidget/src/views/SummaryWidgetView.js",
            "src/plugins/webPage/components/WebPage.vue||src/plugins/webPage/components/WebPage.vue"
          ]
        }
      },
      "candidate_diff": {
        "src/plugins/conditionWidget/components/ConditionWidget.vue||src/plugins/conditionWidget/components/ConditionWidget.vue": [
          "File: src/plugins/conditionWidget/components/ConditionWidget.vue -> src/plugins/conditionWidget/components/ConditionWidget.vue",
          "--- Hunk 1 ---",
          "[Context before]",
          "23: <template>",
          "24: <component :is=\"urlDefined ? 'a' : 'span'\"",
          "25:            class=\"c-condition-widget u-style-receiver js-style-receiver\"",
          "27: >",
          "28:     <div class=\"c-condition-widget__label\">",
          "29:         {{ internalDomainObject.label }}",
          "",
          "[Removed Lines]",
          "26:            :href=\"urlDefined ? internalDomainObject.url : null\"",
          "",
          "[Added Lines]",
          "26:            :href=\"url\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "32: </template>",
          "34: <script>",
          "35: export default {",
          "36:     inject: ['openmct', 'domainObject'],",
          "37:     data: function () {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "35: const sanitizeUrl = require(\"@braintree/sanitize-url\").sanitizeUrl;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "42:     computed: {",
          "43:         urlDefined() {",
          "44:             return this.internalDomainObject.url && this.internalDomainObject.url.length > 0;",
          "45:         }",
          "46:     },",
          "47:     mounted() {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "47:         },",
          "48:         url() {",
          "49:             return this.urlDefined ? sanitizeUrl(this.internalDomainObject.url) : null;",
          "",
          "---------------"
        ],
        "src/plugins/hyperlink/HyperlinkLayout.vue||src/plugins/hyperlink/HyperlinkLayout.vue": [
          "File: src/plugins/hyperlink/HyperlinkLayout.vue -> src/plugins/hyperlink/HyperlinkLayout.vue",
          "--- Hunk 1 ---",
          "[Context before]",
          "27:        'c-hyperlink--button' : isButton",
          "28:    }\"",
          "29:    :target=\"domainObject.linkTarget\"",
          "31: >",
          "32:     <span class=\"c-hyperlink__label\">{{ domainObject.displayText }}</span>",
          "33: </a>",
          "",
          "[Removed Lines]",
          "30:    :href=\"domainObject.url\"",
          "",
          "[Added Lines]",
          "30:    :href=\"url\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "35: </template>",
          "37: <script>",
          "39: export default {",
          "40:     inject: ['domainObject'],",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "38: const sanitizeUrl = require(\"@braintree/sanitize-url\").sanitizeUrl;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "45:             }",
          "47:             return true;",
          "48:         }",
          "49:     }",
          "50: };",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "49:         },",
          "50:         url() {",
          "51:             return sanitizeUrl(this.domainObject.url);",
          "",
          "---------------"
        ],
        "src/plugins/summaryWidget/src/SummaryWidget.js||src/plugins/summaryWidget/src/SummaryWidget.js": [
          "File: src/plugins/summaryWidget/src/SummaryWidget.js -> src/plugins/summaryWidget/src/SummaryWidget.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "7:     './eventHelpers',",
          "8:     'objectUtils',",
          "9:     'lodash',",
          "11: ], function (",
          "12:     widgetTemplate,",
          "13:     Rule,",
          "",
          "[Removed Lines]",
          "10:     'zepto'",
          "",
          "[Added Lines]",
          "10:     'zepto',",
          "11:     '@braintree/sanitize-url'",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "17:     eventHelpers,",
          "18:     objectUtils,",
          "19:     _,",
          "21: ) {",
          "",
          "[Removed Lines]",
          "20:     $",
          "",
          "[Added Lines]",
          "21:     $,",
          "22:     urlSanitizeLib",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "88:         function toggleTestData() {",
          "89:             self.outerWrapper.toggleClass('expanded-widget-test-data');",
          "90:             self.toggleTestDataControl.toggleClass('c-disclosure-triangle--expanded');",
          "93:         this.listenTo(this.toggleTestDataControl, 'click', toggleTestData);",
          "",
          "[Removed Lines]",
          "91:         }",
          "",
          "[Added Lines]",
          "93:         }",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "99:         function toggleRules() {",
          "100:             self.outerWrapper.toggleClass('expanded-widget-rules');",
          "101:             self.toggleRulesControl.toggleClass('c-disclosure-triangle--expanded');",
          "104:         this.listenTo(this.toggleRulesControl, 'click', toggleRules);",
          "",
          "[Removed Lines]",
          "102:         }",
          "",
          "[Added Lines]",
          "104:         }",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "115:     SummaryWidget.prototype.addHyperlink = function (url, openNewTab) {",
          "116:         if (url) {",
          "118:         } else {",
          "119:             this.widgetButton.removeAttr('href');",
          "120:         }",
          "",
          "[Removed Lines]",
          "117:             this.widgetButton.attr('href', url);",
          "",
          "[Added Lines]",
          "119:             this.widgetButton.attr('href', urlSanitizeLib.sanitizeUrl(url));",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "317:                 expanded: 'true'",
          "318:             };",
          "322:         ruleConfig = this.domainObject.configuration.ruleConfigById[ruleId];",
          "323:         this.rulesById[ruleId] = new Rule(ruleConfig, this.domainObject, this.openmct,",
          "",
          "[Removed Lines]",
          "320:         }",
          "",
          "[Added Lines]",
          "322:         }",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "345:             ruleOrder.splice(targetIndex + 1, 0, event.draggingId);",
          "346:             this.domainObject.configuration.ruleOrder = ruleOrder;",
          "347:             this.updateDomainObject();",
          "350:         this.refreshRules();",
          "351:     };",
          "",
          "[Removed Lines]",
          "348:         }",
          "",
          "[Added Lines]",
          "350:         }",
          "",
          "---------------"
        ],
        "src/plugins/summaryWidget/src/views/SummaryWidgetView.js||src/plugins/summaryWidget/src/views/SummaryWidgetView.js": [
          "File: src/plugins/summaryWidget/src/views/SummaryWidgetView.js -> src/plugins/summaryWidget/src/views/SummaryWidgetView.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: define([",
          "3: ], function (",
          "5: ) {",
          "6:     const WIDGET_ICON_CLASS = 'c-sw__icon js-sw__icon';",
          "",
          "[Removed Lines]",
          "2:     './summary-widget.html'",
          "4:     summaryWidgetTemplate",
          "",
          "[Added Lines]",
          "2:     './summary-widget.html',",
          "3:     '@braintree/sanitize-url'",
          "5:     summaryWidgetTemplate,",
          "6:     urlSanitizeLib",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "35:         this.icon = this.container.querySelector('#widgetIcon');",
          "36:         this.label = this.container.querySelector('.js-sw__label');",
          "40:         } else {",
          "41:             this.widget.removeAttribute('href');",
          "42:         }",
          "",
          "[Removed Lines]",
          "38:         if (this.domainObject.url) {",
          "39:             this.widget.setAttribute('href', this.domainObject.url);",
          "",
          "[Added Lines]",
          "40:         let url = this.domainObject.url;",
          "41:         if (url) {",
          "42:             this.widget.setAttribute('href', urlSanitizeLib.sanitizeUrl(url));",
          "",
          "---------------"
        ],
        "src/plugins/webPage/components/WebPage.vue||src/plugins/webPage/components/WebPage.vue": [
          "File: src/plugins/webPage/components/WebPage.vue -> src/plugins/webPage/components/WebPage.vue",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: <template>",
          "2: <div class=\"l-iframe abs\">",
          "4: </div>",
          "5: </template>",
          "7: <script>",
          "8: export default {",
          "9:     inject: ['openmct', 'domainObject'],",
          "10:     data: function () {",
          "11:         return {",
          "12:             currentDomainObject: this.domainObject",
          "13:         };",
          "14:     }",
          "15: };",
          "16: </script>",
          "",
          "[Removed Lines]",
          "3:     <iframe :src=\"currentDomainObject.url\"></iframe>",
          "",
          "[Added Lines]",
          "3:     <iframe :src=\"url\"></iframe>",
          "8: const sanitizeUrl = require(\"@braintree/sanitize-url\").sanitizeUrl;",
          "16:     },",
          "17:     computed: {",
          "18:         url() {",
          "19:             return sanitizeUrl(this.currentDomainObject.url);",
          "20:         }",
          "",
          "---------------"
        ]
      }
    }
  ]
}