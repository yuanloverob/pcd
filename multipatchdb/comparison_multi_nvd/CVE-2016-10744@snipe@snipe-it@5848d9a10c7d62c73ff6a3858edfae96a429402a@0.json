{
  "cve_id": "CVE-2016-10744",
  "cve_desc": "In Select2 through 4.0.5, as used in Snipe-IT and other products, rich selectlists allow XSS. This affects use cases with Ajax remote data loading when HTML templates are used to display listbox data.",
  "repo": "snipe/snipe-it",
  "patch_hash": "5848d9a10c7d62c73ff6a3858edfae96a429402a",
  "patch_info": {
    "commit_hash": "5848d9a10c7d62c73ff6a3858edfae96a429402a",
    "repo": "snipe/snipe-it",
    "commit_url": "https://github.com/snipe/snipe-it/pull/6831/commits/5848d9a10c7d62c73ff6a3858edfae96a429402a",
    "files": [
      "resources/assets/js/snipeit.js"
    ],
    "message": "Janky fix for Select2 bug",
    "before_after_code_files": [
      "resources/assets/js/snipeit.js||resources/assets/js/snipeit.js"
    ]
  },
  "patch_diff": {
    "resources/assets/js/snipeit.js||resources/assets/js/snipeit.js": [
      "File: resources/assets/js/snipeit.js -> resources/assets/js/snipeit.js",
      "--- Hunk 1 ---",
      "[Context before]",
      "260:     }",
      "262:     function formatDataSelection (datalist) {",
      "264:     }",
      "",
      "[Removed Lines]",
      "263:         return datalist.text;",
      "",
      "[Added Lines]",
      "271:         return datalist.text.replace(/>/g, '&gt;')",
      "272:             .replace(/</g, '&lt;')",
      "273:             .replace(/\"/g, '&quot;')",
      "274:             .replace(/'/g, '&#039;');",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "dee92cfc6c016986b341c57ed06f3d65e9d18d43",
      "candidate_info": {
        "commit_hash": "dee92cfc6c016986b341c57ed06f3d65e9d18d43",
        "repo": "snipe/snipe-it",
        "commit_url": "https://github.com/snipe/snipe-it/commit/dee92cfc6c016986b341c57ed06f3d65e9d18d43",
        "files": [
          "app/Http/Transformers/ActionlogsTransformer.php",
          "app/Http/Transformers/UsersTransformer.php",
          "public/css/build/all.css",
          "public/css/dist/all.css",
          "public/js/build/all.js",
          "public/js/build/vue.js",
          "public/js/build/vue.js.map",
          "public/js/dist/all.js",
          "public/mix-manifest.json",
          "resources/assets/js/components/importer/importer-file.vue",
          "resources/assets/js/snipeit.js"
        ],
        "message": "Fixes XSS vulnerabilities  (#6831)\n\n* Properly escape log_meta values\n\n* Vue syntax fix to allow npm run dev to work again\n\n* Janky fix for Select2 bug\n\n* Compiled production assets\n\n* Escape user\u2019s last name in API\n\n* Removed duplicate alertClass\n\n* Compiled production assets",
        "before_after_code_files": [
          "app/Http/Transformers/ActionlogsTransformer.php||app/Http/Transformers/ActionlogsTransformer.php",
          "app/Http/Transformers/UsersTransformer.php||app/Http/Transformers/UsersTransformer.php",
          "resources/assets/js/components/importer/importer-file.vue||resources/assets/js/components/importer/importer-file.vue",
          "resources/assets/js/snipeit.js||resources/assets/js/snipeit.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/grokability/snipe-it/pull/6831"
        ],
        "olp_code_files": {
          "patch": [
            "resources/assets/js/snipeit.js||resources/assets/js/snipeit.js"
          ],
          "candidate": [
            "resources/assets/js/snipeit.js||resources/assets/js/snipeit.js"
          ]
        }
      },
      "candidate_diff": {
        "app/Http/Transformers/ActionlogsTransformer.php||app/Http/Transformers/ActionlogsTransformer.php": [
          "File: app/Http/Transformers/ActionlogsTransformer.php -> app/Http/Transformers/ActionlogsTransformer.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "26:         if ($actionlog->filename!='') {",
          "27:             $icon =  e(\\App\\Helpers\\Helper::filetype_icon($actionlog->filename));",
          "28:         }",
          "29:         $array = [",
          "30:             'id'          => (int) $actionlog->id,",
          "31:             'icon'          => $icon,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "31:         if (($actionlog->log_meta) && ($actionlog->log_meta!='')) {",
          "32:             $meta_array = json_decode($actionlog->log_meta);",
          "33:             foreach ($meta_array as $key => $value) {",
          "34:                 foreach ($value as $meta_key => $meta_value) {",
          "35:                     $clean_meta[$key][$meta_key] = e($meta_value);",
          "36:                 }",
          "37:             }",
          "38:         }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "65:             'note'          => ($actionlog->note) ? e($actionlog->note): null,",
          "66:             'signature_file'   => ($actionlog->accept_signature) ? route('log.signature.view', ['filename' => $actionlog->accept_signature ]) : null,",
          "70:         ];",
          "",
          "[Removed Lines]",
          "67:             'log_meta'          => ($actionlog->log_meta) ? json_decode($actionlog->log_meta): null,",
          "",
          "[Added Lines]",
          "79:             'log_meta'          => ((isset($clean_meta)) && (is_array($clean_meta))) ? $clean_meta: null,",
          "",
          "---------------"
        ],
        "app/Http/Transformers/UsersTransformer.php||app/Http/Transformers/UsersTransformer.php": [
          "File: app/Http/Transformers/UsersTransformer.php -> app/Http/Transformers/UsersTransformer.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "24:         $array = [",
          "25:                 'id' => (int) $user->id,",
          "26:                 'avatar' => e($user->present()->gravatar),",
          "28:                 'first_name' => e($user->first_name),",
          "29:                 'last_name' => e($user->last_name),",
          "30:                 'username' => e($user->username),",
          "",
          "[Removed Lines]",
          "27:                 'name' => e($user->first_name).' '.($user->last_name),",
          "",
          "[Added Lines]",
          "27:                 'name' => e($user->first_name).' '.e($user->last_name),",
          "",
          "---------------"
        ],
        "resources/assets/js/components/importer/importer-file.vue||resources/assets/js/components/importer/importer-file.vue": [
          "File: resources/assets/js/components/importer/importer-file.vue -> resources/assets/js/components/importer/importer-file.vue",
          "--- Hunk 1 ---",
          "[Context before]",
          "40:                 </div>",
          "41:                 </div>",
          "42:             </div>",
          "44:                  :class=\"alertClass\"",
          "46:                  v-if=\"statusText\">",
          "47:                 {{ this.statusText }}",
          "48:             </div>",
          "",
          "[Removed Lines]",
          "43:             <div class=\"alert col-md-12\"",
          "45:                  style=\"text-align:left\"",
          "",
          "[Added Lines]",
          "43:             <div class=\"alert col-md-12\" style=\"text-align:left\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "85:                 <div class=\"alert col-md-12\" style=\"padding-top: 20px;\"",
          "86:                      :class=\"alertClass\"",
          "88:                      v-if=\"statusText\">",
          "89:                     {{ this.statusText }}",
          "90:                 </div>",
          "",
          "[Removed Lines]",
          "87:                      style=\"text-align:left\"",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "resources/assets/js/snipeit.js||resources/assets/js/snipeit.js": [
          "File: resources/assets/js/snipeit.js -> resources/assets/js/snipeit.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "260:     }",
          "262:     function formatDataSelection (datalist) {",
          "264:     }",
          "",
          "[Removed Lines]",
          "263:         return datalist.text;",
          "",
          "[Added Lines]",
          "271:         return datalist.text.replace(/>/g, '&gt;')",
          "272:             .replace(/</g, '&lt;')",
          "273:             .replace(/\"/g, '&quot;')",
          "274:             .replace(/'/g, '&#039;');",
          "",
          "---------------"
        ]
      }
    }
  ]
}