{
  "cve_id": "CVE-2022-23535",
  "cve_desc": "LiteDB is a small, fast and lightweight .NET NoSQL embedded database. Versions prior to 5.0.13 are subject to Deserialization of Untrusted Data. LiteDB uses a special field in JSON documents to cast different types from `BsonDocument` to POCO classes. When instances of an object are not the same of class, `BsonMapper` use a special field `_type` string info with full class name with assembly to be loaded and fit into your model. If your end-user can send to your app a plain JSON string, deserialization can load an unsafe  object to fit into your model. This issue is patched in version 5.0.13 with some basic fixes to avoid this, but is not 100% guaranteed when using `Object` type. The next major version will contain an allow-list to select what kind of Assembly can be loaded. Workarounds are detailed in the vendor advisory.",
  "repo": "mbdavid/LiteDB",
  "patch_hash": "4382ff4dd0dd8b8b16a4e37dfd29727c5f70f93f",
  "patch_info": {
    "commit_hash": "4382ff4dd0dd8b8b16a4e37dfd29727c5f70f93f",
    "repo": "mbdavid/LiteDB",
    "commit_url": "https://github.com/mbdavid/LiteDB/commit/4382ff4dd0dd8b8b16a4e37dfd29727c5f70f93f",
    "files": [
      "LiteDB.sln",
      "LiteDB/Client/Mapper/BsonMapper.Deserialize.cs",
      "LiteDB/LiteDB.csproj",
      "LiteDB/Utils/LiteException.cs"
    ],
    "message": "Adding testing for Process object deserializaion rule",
    "before_after_code_files": [
      "LiteDB.sln||LiteDB.sln",
      "LiteDB/Client/Mapper/BsonMapper.Deserialize.cs||LiteDB/Client/Mapper/BsonMapper.Deserialize.cs",
      "LiteDB/LiteDB.csproj||LiteDB/LiteDB.csproj",
      "LiteDB/Utils/LiteException.cs||LiteDB/Utils/LiteException.cs"
    ]
  },
  "patch_diff": {
    "LiteDB.sln||LiteDB.sln": [
      "File: LiteDB.sln -> LiteDB.sln",
      "--- Hunk 1 ---",
      "[Context before]",
      "1: \ufeff",
      "2: Microsoft Visual Studio Solution File, Format Version 12.00",
      "5: MinimumVisualStudioVersion = 10.0.40219.1",
      "6: Project(\"{9A19103F-16F7-4668-BE54-9A1E7A4F7556}\") = \"LiteDB\", \"LiteDB\\LiteDB.csproj\", \"{9497DA19-1FCA-4C2E-A1AB-8DFAACBC76E1}\"",
      "7: EndProject",
      "",
      "[Removed Lines]",
      "3: # Visual Studio Version 16",
      "4: VisualStudioVersion = 16.0.29609.76",
      "",
      "[Added Lines]",
      "3: # Visual Studio Version 17",
      "4: VisualStudioVersion = 17.1.32328.378",
      "",
      "---------------"
    ],
    "LiteDB/Client/Mapper/BsonMapper.Deserialize.cs||LiteDB/Client/Mapper/BsonMapper.Deserialize.cs": [
      "File: LiteDB/Client/Mapper/BsonMapper.Deserialize.cs -> LiteDB/Client/Mapper/BsonMapper.Deserialize.cs",
      "--- Hunk 1 ---",
      "[Context before]",
      "170:                     var actualType = _typeNameBinder.GetType(typeField.AsString);",
      "172:                     if (actualType == null) throw LiteException.InvalidTypedName(typeField.AsString);",
      "175:                     type = actualType;",
      "176:                 }",
      "",
      "[Removed Lines]",
      "173:                     if (!type.IsAssignableFrom(actualType)) throw LiteException.DataTypeNotAssignable(type.FullName, actualType.FullName);",
      "",
      "[Added Lines]",
      "175:                     if (!type.IsAssignableFrom(actualType))",
      "176:                     {",
      "177:                         throw LiteException.DataTypeNotAssignable(type.FullName, actualType.FullName);",
      "178:                     }",
      "182:                     if (actualType.FullName.Equals(\"System.Diagnostics.Process\", StringComparison.OrdinalIgnoreCase) &&",
      "183:                         actualType.Assembly.GetName().Name.Equals(\"System\", StringComparison.OrdinalIgnoreCase))",
      "184:                     {",
      "185:                         throw LiteException.AvoidUseOfProcess();",
      "186:                     }",
      "",
      "---------------"
    ],
    "LiteDB/LiteDB.csproj||LiteDB/LiteDB.csproj": [
      "File: LiteDB/LiteDB.csproj -> LiteDB/LiteDB.csproj",
      "--- Hunk 1 ---",
      "[Context before]",
      "1: \ufeff<Project Sdk=\"Microsoft.NET.Sdk\">",
      "3:   <PropertyGroup>",
      "5:     <AssemblyVersion>5.0.12</AssemblyVersion>",
      "6:     <FileVersion>5.0.12</FileVersion>",
      "7:     <VersionPrefix>5.0.12</VersionPrefix>",
      "",
      "[Removed Lines]",
      "4:     <TargetFrameworks>net45;netstandard1.3;netstandard2.0</TargetFrameworks>",
      "",
      "[Added Lines]",
      "4:     <TargetFrameworks>net4.5;netstandard1.3;netstandard2.0</TargetFrameworks>",
      "",
      "---------------"
    ],
    "LiteDB/Utils/LiteException.cs||LiteDB/Utils/LiteException.cs": [
      "File: LiteDB/Utils/LiteException.cs -> LiteDB/Utils/LiteException.cs",
      "--- Hunk 1 ---",
      "[Context before]",
      "52:         public const int INVALID_NULL_CHAR_STRING = 212;",
      "53:         public const int INVALID_FREE_SPACE_PAGE = 213;",
      "54:         public const int DATA_TYPE_NOT_ASSIGNABLE = 214;",
      "56:         #endregion",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "55:         public const int AVOID_USE_OF_PROCESS = 215;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "312:             return new LiteException(DATA_TYPE_NOT_ASSIGNABLE, $\"Data type {type1} is not assignable from data type {type2}\");",
      "313:         }",
      "315:         #endregion",
      "316:     }",
      "317: }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "316:         internal static LiteException AvoidUseOfProcess()",
      "317:         {",
      "318:             return new LiteException(AVOID_USE_OF_PROCESS, $\"LiteDB do not accept System.Diagnostics.Process class in deserialize mapper\");",
      "319:         }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "32d9eb8e2ee9ae005a9cacf4528ad7d33a8d6439",
      "candidate_info": {
        "commit_hash": "32d9eb8e2ee9ae005a9cacf4528ad7d33a8d6439",
        "repo": "mbdavid/LiteDB",
        "commit_url": "https://github.com/mbdavid/LiteDB/commit/32d9eb8e2ee9ae005a9cacf4528ad7d33a8d6439",
        "files": [
          "LiteDB/Client/Mapper/BsonMapper.Deserialize.cs",
          "LiteDB/LiteDB.csproj"
        ],
        "message": "Setting version to 5.0.13",
        "before_after_code_files": [
          "LiteDB/Client/Mapper/BsonMapper.Deserialize.cs||LiteDB/Client/Mapper/BsonMapper.Deserialize.cs",
          "LiteDB/LiteDB.csproj||LiteDB/LiteDB.csproj"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "LiteDB/Client/Mapper/BsonMapper.Deserialize.cs||LiteDB/Client/Mapper/BsonMapper.Deserialize.cs",
            "LiteDB/LiteDB.csproj||LiteDB/LiteDB.csproj"
          ],
          "candidate": [
            "LiteDB/Client/Mapper/BsonMapper.Deserialize.cs||LiteDB/Client/Mapper/BsonMapper.Deserialize.cs",
            "LiteDB/LiteDB.csproj||LiteDB/LiteDB.csproj"
          ]
        }
      },
      "candidate_diff": {
        "LiteDB/Client/Mapper/BsonMapper.Deserialize.cs||LiteDB/Client/Mapper/BsonMapper.Deserialize.cs": [
          "File: LiteDB/Client/Mapper/BsonMapper.Deserialize.cs -> LiteDB/Client/Mapper/BsonMapper.Deserialize.cs",
          "--- Hunk 1 ---",
          "[Context before]",
          "184:                     {",
          "185:                         throw LiteException.AvoidUseOfProcess();",
          "186:                     }",
          "",
          "[Removed Lines]",
          "182:                     if (actualType.FullName.Equals(\"System.Diagnostics.Process\", StringComparison.OrdinalIgnoreCase) &&",
          "183:                         actualType.Assembly.GetName().Name.Equals(\"System\", StringComparison.OrdinalIgnoreCase))",
          "",
          "[Added Lines]",
          "182:                     if (actualType.FullName.Equals(\"System.Diagnostics.Process\", StringComparison.OrdinalIgnoreCase))",
          "",
          "---------------"
        ],
        "LiteDB/LiteDB.csproj||LiteDB/LiteDB.csproj": [
          "File: LiteDB/LiteDB.csproj -> LiteDB/LiteDB.csproj",
          "--- Hunk 1 ---",
          "[Context before]",
          "3:   <PropertyGroup>",
          "4:     <TargetFrameworks>net4.5;netstandard1.3;netstandard2.0</TargetFrameworks>",
          "8:     <Authors>Maur\u00edcio David</Authors>",
          "9:     <Product>LiteDB</Product>",
          "10:     <Description>LiteDB - A lightweight embedded .NET NoSQL document store in a single datafile</Description>",
          "",
          "[Removed Lines]",
          "5:     <AssemblyVersion>5.0.12</AssemblyVersion>",
          "6:     <FileVersion>5.0.12</FileVersion>",
          "7:     <VersionPrefix>5.0.12</VersionPrefix>",
          "",
          "[Added Lines]",
          "5:     <AssemblyVersion>5.0.13</AssemblyVersion>",
          "6:     <FileVersion>5.0.13</FileVersion>",
          "7:     <VersionPrefix>5.0.13</VersionPrefix>",
          "",
          "---------------"
        ]
      }
    }
  ]
}