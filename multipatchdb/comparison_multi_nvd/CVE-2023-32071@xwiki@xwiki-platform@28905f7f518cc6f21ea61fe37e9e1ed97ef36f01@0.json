{
  "cve_id": "CVE-2023-32071",
  "cve_desc": "XWiki Platform is a generic wiki platform. Starting in versions 2.2-milestone-1 and prior to versions 14.4.8, 14.10.4, and 15.0-rc-1, it's possible to execute javascript with the right of any user by leading him to a special URL on the wiki targeting a page which contains an attachment. This has been patched in XWiki 15.0-rc-1, 14.10.4, and 14.4.8. The easiest possible workaround is to edit file `<xwiki app>/templates/importinline.vm` and apply the modification described in commit 28905f7f518cc6f21ea61fe37e9e1ed97ef36f01.",
  "repo": "xwiki/xwiki-platform",
  "patch_hash": "28905f7f518cc6f21ea61fe37e9e1ed97ef36f01",
  "patch_info": {
    "commit_hash": "28905f7f518cc6f21ea61fe37e9e1ed97ef36f01",
    "repo": "xwiki/xwiki-platform",
    "commit_url": "https://github.com/xwiki/xwiki-platform/commit/28905f7f518cc6f21ea61fe37e9e1ed97ef36f01",
    "files": [
      "xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/importinline.vm"
    ],
    "message": "XWIKI-20340: Improve import escaping",
    "before_after_code_files": [
      "xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/importinline.vm||xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/importinline.vm"
    ]
  },
  "patch_diff": {
    "xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/importinline.vm||xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/importinline.vm": [
      "File: xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/importinline.vm -> xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/importinline.vm",
      "--- Hunk 1 ---",
      "[Context before]",
      "50: ## to import from that XAR.",
      "51: ## ---------------------------------------------------------------------------",
      "52: #else",
      "54:   $xwiki.jsfx.use('js/xwiki/importer/import.js', true)##",
      "55:   $xwiki.ssfx.use('js/xwiki/importer/import.css', true)##",
      "56:   $xwiki.jsfx.use('uicomponents/widgets/upload.js', {'forceSkinAction': true, 'language': ${xcontext.locale}})##",
      "",
      "[Removed Lines]",
      "53:   #set($baseQueryString = \"editor=$!{request.editor}&amp;section=$!{request.section}\")",
      "",
      "[Added Lines]",
      "53:   #set($baseQueryString = \"editor=$!{escapetool.url($request.editor)}&amp;section=$!{escapetool.url($request.section)}\")",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "cfa5a9353c72b7ab40f667891584f6e4da401618",
      "candidate_info": {
        "commit_hash": "cfa5a9353c72b7ab40f667891584f6e4da401618",
        "repo": "xwiki/xwiki-platform",
        "commit_url": "https://github.com/xwiki/xwiki-platform/commit/cfa5a9353c72b7ab40f667891584f6e4da401618",
        "files": [
          "xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/importinline.vm"
        ],
        "message": "XWIKI-20340: Improve import escaping\n\n(cherry picked from commit 28905f7f518cc6f21ea61fe37e9e1ed97ef36f01)",
        "before_after_code_files": [
          "xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/importinline.vm||xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/importinline.vm"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/importinline.vm||xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/importinline.vm"
          ],
          "candidate": [
            "xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/importinline.vm||xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/importinline.vm"
          ]
        }
      },
      "candidate_diff": {
        "xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/importinline.vm||xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/importinline.vm": [
          "File: xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/importinline.vm -> xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/importinline.vm",
          "--- Hunk 1 ---",
          "[Context before]",
          "50: ## to import from that XAR.",
          "51: ## ---------------------------------------------------------------------------",
          "52: #else",
          "54:   $xwiki.jsfx.use('js/xwiki/importer/import.js', true)##",
          "55:   $xwiki.ssfx.use('js/xwiki/importer/import.css', true)##",
          "56:   $xwiki.jsfx.use('uicomponents/widgets/upload.js', {'forceSkinAction': true, 'language': ${xcontext.locale}})##",
          "",
          "[Removed Lines]",
          "53:   #set($baseQueryString = \"editor=$!{request.editor}&amp;section=$!{request.section}\")",
          "",
          "[Added Lines]",
          "53:   #set($baseQueryString = \"editor=$!{escapetool.url($request.editor)}&amp;section=$!{escapetool.url($request.section)}\")",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "53bc39fea741fe9ff94b370ae1eb96d579ad88ab",
      "candidate_info": {
        "commit_hash": "53bc39fea741fe9ff94b370ae1eb96d579ad88ab",
        "repo": "xwiki/xwiki-platform",
        "commit_url": "https://github.com/xwiki/xwiki-platform/commit/53bc39fea741fe9ff94b370ae1eb96d579ad88ab",
        "files": [
          "xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/importinline.vm"
        ],
        "message": "XWIKI-20340: Improve import escaping\n\n(cherry picked from commit 28905f7f518cc6f21ea61fe37e9e1ed97ef36f01)",
        "before_after_code_files": [
          "xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/importinline.vm||xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/importinline.vm"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/importinline.vm||xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/importinline.vm"
          ],
          "candidate": [
            "xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/importinline.vm||xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/importinline.vm"
          ]
        }
      },
      "candidate_diff": {
        "xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/importinline.vm||xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/importinline.vm": [
          "File: xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/importinline.vm -> xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/importinline.vm",
          "--- Hunk 1 ---",
          "[Context before]",
          "50: ## to import from that XAR.",
          "51: ## ---------------------------------------------------------------------------",
          "52: #else",
          "54:   $xwiki.jsfx.use('js/xwiki/importer/import.js', true)##",
          "55:   $xwiki.ssfx.use('js/xwiki/importer/import.css', true)##",
          "56:   $xwiki.jsfx.use('uicomponents/widgets/upload.js', {'forceSkinAction': true, 'language': ${xcontext.locale}})##",
          "",
          "[Removed Lines]",
          "53:   #set($baseQueryString = \"editor=$!{request.editor}&amp;section=$!{request.section}\")",
          "",
          "[Added Lines]",
          "53:   #set($baseQueryString = \"editor=$!{escapetool.url($request.editor)}&amp;section=$!{escapetool.url($request.section)}\")",
          "",
          "---------------"
        ]
      }
    }
  ]
}