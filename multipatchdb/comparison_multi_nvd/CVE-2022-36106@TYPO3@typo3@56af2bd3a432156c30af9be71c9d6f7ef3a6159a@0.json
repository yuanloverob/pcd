{
  "cve_id": "CVE-2022-36106",
  "cve_desc": "TYPO3 is an open source PHP based web content management system released under the GNU GPL. It has been discovered that the expiration time of a password reset link for TYPO3 backend users has never been evaluated. As a result, a password reset link could be used to perform a password reset even if the default expiry time of two hours has been exceeded. Update to TYPO3 version 10.4.32 or 11.5.16 that fix the problem. There are no known workarounds for this issue.",
  "repo": "TYPO3/typo3",
  "patch_hash": "56af2bd3a432156c30af9be71c9d6f7ef3a6159a",
  "patch_info": {
    "commit_hash": "56af2bd3a432156c30af9be71c9d6f7ef3a6159a",
    "repo": "TYPO3/typo3",
    "commit_url": "https://github.com/TYPO3/typo3/commit/56af2bd3a432156c30af9be71c9d6f7ef3a6159a",
    "files": [
      "typo3/sysext/backend/Classes/Authentication/PasswordReset.php"
    ],
    "message": "[SECURITY] Respect expiration time of password reset token\n\nWhen a TYPO3 backend user performs a password reset request, a\npassword reset link including an expiration time is sent to the\nuser. The expiration time is included in HMAC calculation of\nthe saved password reset hash, but it is never evaluated if the\nexpiration time is exceeded.\n\nThis change adds the missing validity check for the expiration\ntime included in the password reset link.\n\nResolves: #97998\nReleases: main, 11.5, 10.4\nChange-Id: I8a1730faf6489e5c5eebb44ff4f82606785bd637\nSecurity-Bulletin: TYPO3-CORE-SA-2022-008\nSecurity-References: CVE-2022-36106\nReviewed-on: https://review.typo3.org/c/Packages/TYPO3.CMS/+/75717\nTested-by: Oliver Hader <oliver.hader@typo3.org>\nReviewed-by: Oliver Hader <oliver.hader@typo3.org>",
    "before_after_code_files": [
      "typo3/sysext/backend/Classes/Authentication/PasswordReset.php||typo3/sysext/backend/Classes/Authentication/PasswordReset.php"
    ]
  },
  "patch_diff": {
    "typo3/sysext/backend/Classes/Authentication/PasswordReset.php||typo3/sysext/backend/Classes/Authentication/PasswordReset.php": [
      "File: typo3/sysext/backend/Classes/Authentication/PasswordReset.php -> typo3/sysext/backend/Classes/Authentication/PasswordReset.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "279:     protected function findValidUserForToken(string $token, string $identity, int $expirationTimestamp): ?array",
      "280:     {",
      "281:         $user = null;",
      "283:         $queryBuilder = $this->getPreparedQueryBuilder();",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "282:         if ($expirationTimestamp < time()) {",
      "283:             return null;",
      "284:         }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "dffc750623bce733414b28c1f236ac0112568f2f",
      "candidate_info": {
        "commit_hash": "dffc750623bce733414b28c1f236ac0112568f2f",
        "repo": "TYPO3/typo3",
        "commit_url": "https://github.com/TYPO3/typo3/commit/dffc750623bce733414b28c1f236ac0112568f2f",
        "files": [
          "typo3/sysext/backend/Classes/Authentication/PasswordReset.php"
        ],
        "message": "[SECURITY] Respect expiration time of password reset token\n\nWhen a TYPO3 backend user performs a password reset request, a\npassword reset link including an expiration time is sent to the\nuser. The expiration time is included in HMAC calculation of\nthe saved password reset hash, but it is never evaluated if the\nexpiration time is exceeded.\n\nThis change adds the missing validity check for the expiration\ntime included in the password reset link.\n\nResolves: #97998\nReleases: main, 11.5, 10.4\nChange-Id: I8a1730faf6489e5c5eebb44ff4f82606785bd637\nSecurity-Bulletin: TYPO3-CORE-SA-2022-008\nSecurity-References: CVE-2022-36106\nReviewed-on: https://review.typo3.org/c/Packages/TYPO3.CMS/+/75705\nTested-by: Oliver Hader <oliver.hader@typo3.org>\nReviewed-by: Oliver Hader <oliver.hader@typo3.org>",
        "before_after_code_files": [
          "typo3/sysext/backend/Classes/Authentication/PasswordReset.php||typo3/sysext/backend/Classes/Authentication/PasswordReset.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_olp_changes": 1,
        "olp_code_files": {
          "patch": [
            "typo3/sysext/backend/Classes/Authentication/PasswordReset.php||typo3/sysext/backend/Classes/Authentication/PasswordReset.php"
          ],
          "candidate": [
            "typo3/sysext/backend/Classes/Authentication/PasswordReset.php||typo3/sysext/backend/Classes/Authentication/PasswordReset.php"
          ]
        }
      },
      "candidate_diff": {
        "typo3/sysext/backend/Classes/Authentication/PasswordReset.php||typo3/sysext/backend/Classes/Authentication/PasswordReset.php": [
          "File: typo3/sysext/backend/Classes/Authentication/PasswordReset.php -> typo3/sysext/backend/Classes/Authentication/PasswordReset.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "282:     protected function findValidUserForToken(string $token, string $identity, int $expirationTimestamp): ?array",
          "283:     {",
          "284:         $user = null;",
          "286:         $queryBuilder = $this->getPreparedQueryBuilder();",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "285:         if ($expirationTimestamp < time()) {",
          "286:             return null;",
          "287:         }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "00b52a443b21baaaab35f8606dbb0ce427261bb5",
      "candidate_info": {
        "commit_hash": "00b52a443b21baaaab35f8606dbb0ce427261bb5",
        "repo": "TYPO3/typo3",
        "commit_url": "https://github.com/TYPO3/typo3/commit/00b52a443b21baaaab35f8606dbb0ce427261bb5",
        "files": [
          "typo3/sysext/backend/Classes/Authentication/PasswordReset.php"
        ],
        "message": "[SECURITY] Respect expiration time of password reset token\n\nWhen a TYPO3 backend user performs a password reset request, a\npassword reset link including an expiration time is sent to the\nuser. The expiration time is included in HMAC calculation of\nthe saved password reset hash, but it is never evaluated if the\nexpiration time is exceeded.\n\nThis change adds the missing validity check for the expiration\ntime included in the password reset link.\n\nResolves: #97998\nReleases: main, 11.5, 10.4\nChange-Id: I8a1730faf6489e5c5eebb44ff4f82606785bd637\nSecurity-Bulletin: TYPO3-CORE-SA-2022-008\nSecurity-References: CVE-2022-36106\nReviewed-on: https://review.typo3.org/c/Packages/TYPO3.CMS/+/75711\nTested-by: Oliver Hader <oliver.hader@typo3.org>\nReviewed-by: Oliver Hader <oliver.hader@typo3.org>",
        "before_after_code_files": [
          "typo3/sysext/backend/Classes/Authentication/PasswordReset.php||typo3/sysext/backend/Classes/Authentication/PasswordReset.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_olp_changes": 1,
        "olp_code_files": {
          "patch": [
            "typo3/sysext/backend/Classes/Authentication/PasswordReset.php||typo3/sysext/backend/Classes/Authentication/PasswordReset.php"
          ],
          "candidate": [
            "typo3/sysext/backend/Classes/Authentication/PasswordReset.php||typo3/sysext/backend/Classes/Authentication/PasswordReset.php"
          ]
        }
      },
      "candidate_diff": {
        "typo3/sysext/backend/Classes/Authentication/PasswordReset.php||typo3/sysext/backend/Classes/Authentication/PasswordReset.php": [
          "File: typo3/sysext/backend/Classes/Authentication/PasswordReset.php -> typo3/sysext/backend/Classes/Authentication/PasswordReset.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "279:     protected function findValidUserForToken(string $token, string $identity, int $expirationTimestamp): ?array",
          "280:     {",
          "281:         $user = null;",
          "283:         $queryBuilder = $this->getPreparedQueryBuilder();",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "282:         if ($expirationTimestamp < time()) {",
          "283:             return null;",
          "284:         }",
          "",
          "---------------"
        ]
      }
    }
  ]
}