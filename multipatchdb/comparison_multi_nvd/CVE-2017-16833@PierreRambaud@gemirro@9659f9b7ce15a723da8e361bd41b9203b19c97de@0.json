{
  "cve_id": "CVE-2017-16833",
  "cve_desc": "Stored cross-site scripting (XSS) vulnerability in Gemirro before 0.16.0 allows attackers to inject arbitrary web script via a crafted javascript: URL in the \"homepage\" value of a \".gemspec\" file.",
  "repo": "PierreRambaud/gemirro",
  "patch_hash": "9659f9b7ce15a723da8e361bd41b9203b19c97de",
  "patch_info": {
    "commit_hash": "9659f9b7ce15a723da8e361bd41b9203b19c97de",
    "repo": "PierreRambaud/gemirro",
    "commit_url": "https://github.com/PierreRambaud/gemirro/commit/9659f9b7ce15a723da8e361bd41b9203b19c97de",
    "files": [
      "Gemfile.lock",
      "lib/gemirro/server.rb",
      "views/gem.erb"
    ],
    "message": "Security Fix again, thanks to Yasin Soliman",
    "before_after_code_files": [
      "Gemfile.lock||Gemfile.lock",
      "lib/gemirro/server.rb||lib/gemirro/server.rb",
      "views/gem.erb||views/gem.erb"
    ]
  },
  "patch_diff": {
    "Gemfile.lock||Gemfile.lock": [
      "File: Gemfile.lock -> Gemfile.lock",
      "--- Hunk 1 ---",
      "[Context before]",
      "1: PATH",
      "2:   remote: .",
      "3:   specs:",
      "5:       builder (~> 3.2)",
      "6:       confstruct (~> 1.0)",
      "7:       erubis (~> 2.7)",
      "",
      "[Removed Lines]",
      "4:     gemirro (0.14.0)",
      "",
      "[Added Lines]",
      "4:     gemirro (0.15.0)",
      "",
      "---------------"
    ],
    "lib/gemirro/server.rb||lib/gemirro/server.rb": [
      "File: lib/gemirro/server.rb -> lib/gemirro/server.rb",
      "--- Hunk 1 ---",
      "[Context before]",
      "1: require 'sinatra/base'",
      "2: require 'thin'",
      "4: module Gemirro",
      "5:   ##",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "3: require 'uri'",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "271:       def escape(string)",
      "272:         Rack::Utils.escape_html(string)",
      "273:       end",
      "274:     end",
      "275:   end",
      "276: end",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "276:       ##",
      "277:       # Homepage link",
      "278:       #",
      "279:       # @param [Gem] spec",
      "280:       # @return [String]",
      "281:       #",
      "282:       def homepage(spec)",
      "283:         URI.parse(URI.escape(spec.homepage))",
      "284:       end",
      "",
      "---------------"
    ],
    "views/gem.erb||views/gem.erb": [
      "File: views/gem.erb -> views/gem.erb",
      "--- Hunk 1 ---",
      "[Context before]",
      "31:             <ul class=\"list-group\">",
      "32:               <% spec.authors.each do |author| %>",
      "33:                 <li class=\"list-group-item\">",
      "35:                 </li>",
      "36:               <% end %>",
      "37:             </ul>",
      "",
      "[Removed Lines]",
      "34:                   <a href=\"<%= escape(spec.homepage) %>\"><%= escape(author) %></a>",
      "",
      "[Added Lines]",
      "34:                   <a href=\"<%= homepage(spec) %>\"><%= escape(author) %></a>",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "9a6dca8092dcc82c1eed48c7c7035eaeecd25d04",
      "candidate_info": {
        "commit_hash": "9a6dca8092dcc82c1eed48c7c7035eaeecd25d04",
        "repo": "PierreRambaud/gemirro",
        "commit_url": "https://github.com/PierreRambaud/gemirro/commit/9a6dca8092dcc82c1eed48c7c7035eaeecd25d04",
        "files": [
          ".rubocop.yml",
          "Gemfile.lock",
          "gemirro.gemspec",
          "lib/gemirro.rb",
          "lib/gemirro/server.rb"
        ],
        "message": "Travis fixes",
        "before_after_code_files": [
          "Gemfile.lock||Gemfile.lock",
          "gemirro.gemspec||gemirro.gemspec",
          "lib/gemirro.rb||lib/gemirro.rb",
          "lib/gemirro/server.rb||lib/gemirro/server.rb"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "Gemfile.lock||Gemfile.lock",
            "lib/gemirro/server.rb||lib/gemirro/server.rb"
          ],
          "candidate": [
            "Gemfile.lock||Gemfile.lock",
            "lib/gemirro/server.rb||lib/gemirro/server.rb"
          ]
        }
      },
      "candidate_diff": {
        "Gemfile.lock||Gemfile.lock": [
          "File: Gemfile.lock -> Gemfile.lock",
          "--- Hunk 1 ---",
          "[Context before]",
          "2:   remote: .",
          "3:   specs:",
          "4:     gemirro (0.16.0)",
          "5:       builder (~> 3.2)",
          "6:       confstruct (~> 1.0)",
          "7:       erubis (~> 2.7)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "5:       addressable (~> 2.5)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "14: GEM",
          "15:   remote: https://rubygems.org/",
          "16:   specs:",
          "18:     builder (3.2.3)",
          "19:     confstruct (1.0.2)",
          "20:       hashie (~> 3.3)",
          "22:     diff-lcs (1.3)",
          "23:     docile (1.1.5)",
          "24:     erubis (2.7.0)",
          "25:     eventmachine (1.2.5)",
          "28:     httpclient (2.8.3)",
          "29:     json (2.1.0)",
          "30:     mustermann (1.0.1)",
          "32:     parser (2.4.0.2)",
          "33:       ast (~> 2.3)",
          "34:     powerpack (0.1.1)",
          "35:     rack (2.0.3)",
          "36:     rack-protection (2.0.0)",
          "37:       rack",
          "39:       rack (>= 1.0, < 3)",
          "43:     rspec (3.7.0)",
          "44:       rspec-core (~> 3.7.0)",
          "45:       rspec-expectations (~> 3.7.0)",
          "46:       rspec-mocks (~> 3.7.0)",
          "48:       rspec-support (~> 3.7.0)",
          "49:     rspec-expectations (3.7.0)",
          "50:       diff-lcs (>= 1.2.0, < 2.0)",
          "",
          "[Removed Lines]",
          "17:     ast (2.3.0)",
          "21:     daemons (1.2.5)",
          "26:     fakefs (0.11.3)",
          "27:     hashie (3.5.6)",
          "31:     parallel (1.12.0)",
          "38:     rack-test (0.7.0)",
          "40:     rainbow (2.2.2)",
          "41:       rake",
          "42:     rake (12.2.1)",
          "47:     rspec-core (3.7.0)",
          "",
          "[Added Lines]",
          "18:     addressable (2.5.2)",
          "19:       public_suffix (>= 2.0.2, < 4.0)",
          "20:     ast (2.4.0)",
          "24:     daemons (1.2.6)",
          "29:     fakefs (0.13.0)",
          "30:     hashie (3.5.7)",
          "34:     parallel (1.12.1)",
          "38:     public_suffix (3.0.1)",
          "42:     rack-test (0.8.2)",
          "44:     rainbow (3.0.0)",
          "45:     rake (12.3.0)",
          "50:     rspec-core (3.7.1)",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "52:     rspec-mocks (3.7.0)",
          "53:       diff-lcs (>= 1.2.0, < 2.0)",
          "54:       rspec-support (~> 3.7.0)",
          "57:       parallel (~> 1.10)",
          "59:       powerpack (~> 0.1)",
          "61:       ruby-progressbar (~> 1.7)",
          "62:       unicode-display_width (~> 1.0, >= 1.0.1)",
          "63:     ruby-progressbar (1.9.0)",
          "",
          "[Removed Lines]",
          "55:     rspec-support (3.7.0)",
          "56:     rubocop (0.51.0)",
          "58:       parser (>= 2.3.3.1, < 3.0)",
          "60:       rainbow (>= 2.2.2, < 3.0)",
          "",
          "[Added Lines]",
          "58:     rspec-support (3.7.1)",
          "59:     rubocop (0.52.1)",
          "61:       parser (>= 2.4.0.2, < 3.0)",
          "63:       rainbow (>= 2.2.2, < 4.0)",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "92:   simplecov (~> 0.15)",
          "94: BUNDLED WITH",
          "",
          "[Removed Lines]",
          "95:    1.15.4",
          "",
          "[Added Lines]",
          "98:    1.16.1",
          "",
          "---------------"
        ],
        "gemirro.gemspec||gemirro.gemspec": [
          "File: gemirro.gemspec -> gemirro.gemspec",
          "--- Hunk 1 ---",
          "[Context before]",
          "16:   s.files = File.read(File.expand_path('../MANIFEST', __FILE__)).split(\"\\n\")",
          "20:   s.add_dependency 'builder', '~>3.2'",
          "21:   s.add_dependency 'confstruct', '~>1.0'",
          "22:   s.add_dependency 'erubis', '~>2.7'",
          "",
          "[Removed Lines]",
          "18:   s.required_ruby_version = '>= 1.9.2'",
          "",
          "[Added Lines]",
          "18:   s.required_ruby_version = '>= 2.2'",
          "20:   s.add_dependency 'addressable', '~>2.5'",
          "",
          "---------------"
        ],
        "lib/gemirro.rb||lib/gemirro.rb": [
          "File: lib/gemirro.rb -> lib/gemirro.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "7: require 'confstruct'",
          "9: require 'httpclient'",
          "12: require 'json'",
          "13: require 'parallel'",
          "14: require 'tempfile'",
          "16: unless $LOAD_PATH.include?(File.expand_path('../', __FILE__))",
          "17:   $LOAD_PATH.unshift(File.expand_path('../', __FILE__))",
          "",
          "[Removed Lines]",
          "1: require 'rubygems'",
          "2: require 'rubygems/user_interaction'",
          "3: require 'rubygems/indexer'",
          "4: require 'slop'",
          "5: require 'fileutils'",
          "6: require 'digest/sha2'",
          "8: require 'zlib'",
          "10: require 'logger'",
          "11: require 'stringio'",
          "",
          "[Added Lines]",
          "2: require 'digest/sha2'",
          "3: require 'fileutils'",
          "6: require 'logger'",
          "8: require 'rubygems'",
          "9: require 'rubygems/indexer'",
          "10: require 'rubygems/user_interaction'",
          "11: require 'slop'",
          "12: require 'stringio'",
          "14: require 'zlib'",
          "",
          "---------------"
        ],
        "lib/gemirro/server.rb||lib/gemirro/server.rb": [
          "File: lib/gemirro/server.rb -> lib/gemirro/server.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: require 'sinatra/base'",
          "2: require 'thin'",
          "3: require 'uri'",
          "5: module Gemirro",
          "6:   ##",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "4: require 'addressable/uri'",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "280:       # @return [String]",
          "281:       #",
          "282:       def homepage(spec)",
          "284:       end",
          "285:     end",
          "286:   end",
          "",
          "[Removed Lines]",
          "283:         URI.parse(URI.escape(spec.homepage))",
          "",
          "[Added Lines]",
          "284:         URI.parse(Addressable::URI.escape(spec.homepage))",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "6a2196d3ff1dca4ea1b4464207df00a6cbb13d68",
      "candidate_info": {
        "commit_hash": "6a2196d3ff1dca4ea1b4464207df00a6cbb13d68",
        "repo": "PierreRambaud/gemirro",
        "commit_url": "https://github.com/PierreRambaud/gemirro/commit/6a2196d3ff1dca4ea1b4464207df00a6cbb13d68",
        "files": [
          "Gemfile.lock"
        ],
        "message": "Whoops missing gemfile.lock",
        "before_after_code_files": [
          "Gemfile.lock||Gemfile.lock"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "Gemfile.lock||Gemfile.lock"
          ],
          "candidate": [
            "Gemfile.lock||Gemfile.lock"
          ]
        }
      },
      "candidate_diff": {
        "Gemfile.lock||Gemfile.lock": [
          "File: Gemfile.lock -> Gemfile.lock",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: PATH",
          "2:   remote: .",
          "3:   specs:",
          "5:       builder (~> 3.2)",
          "6:       confstruct (~> 1.0)",
          "7:       erubis (~> 2.7)",
          "",
          "[Removed Lines]",
          "4:     gemirro (0.15.0)",
          "",
          "[Added Lines]",
          "4:     gemirro (0.16.0)",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "7eb4a689b73f3e2baa4b0c0924a2eeebadc0746e",
      "candidate_info": {
        "commit_hash": "7eb4a689b73f3e2baa4b0c0924a2eeebadc0746e",
        "repo": "PierreRambaud/gemirro",
        "commit_url": "https://github.com/PierreRambaud/gemirro/commit/7eb4a689b73f3e2baa4b0c0924a2eeebadc0746e",
        "files": [
          "Gemfile.lock",
          "lib/gemirro/version.rb"
        ],
        "message": "Bump to 1.1.1",
        "before_after_code_files": [
          "Gemfile.lock||Gemfile.lock",
          "lib/gemirro/version.rb||lib/gemirro/version.rb"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "Gemfile.lock||Gemfile.lock"
          ],
          "candidate": [
            "Gemfile.lock||Gemfile.lock"
          ]
        }
      },
      "candidate_diff": {
        "Gemfile.lock||Gemfile.lock": [
          "File: Gemfile.lock -> Gemfile.lock",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: PATH",
          "2:   remote: .",
          "3:   specs:",
          "5:       addressable (~> 2.5)",
          "6:       builder (~> 3.2)",
          "7:       confstruct (~> 1.0)",
          "",
          "[Removed Lines]",
          "4:     gemirro (1.1.0)",
          "",
          "[Added Lines]",
          "4:     gemirro (1.1.1)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "27:     erubis (2.7.0)",
          "28:     eventmachine (1.2.7)",
          "29:     fakefs (0.14.2)",
          "31:     httpclient (2.8.3)",
          "32:     json (2.1.0)",
          "34:     parallel (1.12.1)",
          "35:     parser (2.5.1.0)",
          "36:       ast (~> 2.4.0)",
          "37:     powerpack (0.1.1)",
          "39:     rack (2.0.5)",
          "41:       rack",
          "42:     rack-test (0.8.3)",
          "43:       rack (>= 1.0, < 3)",
          "",
          "[Removed Lines]",
          "30:     hashie (3.5.7)",
          "33:     mustermann (1.0.2)",
          "38:     public_suffix (3.0.2)",
          "40:     rack-protection (2.0.1)",
          "",
          "[Added Lines]",
          "30:     hashie (3.6.0)",
          "33:     mustermann (1.0.3)",
          "38:     public_suffix (3.0.3)",
          "40:     rack-protection (2.0.3)",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "69:       json (>= 1.8, < 3)",
          "70:       simplecov-html (~> 0.10.0)",
          "71:     simplecov-html (0.10.2)",
          "73:       mustermann (~> 1.0)",
          "74:       rack (~> 2.0)",
          "76:       tilt (~> 2.0)",
          "77:     slop (3.6.0)",
          "78:     thin (1.7.2)",
          "",
          "[Removed Lines]",
          "72:     sinatra (2.0.1)",
          "75:       rack-protection (= 2.0.1)",
          "",
          "[Added Lines]",
          "72:     sinatra (2.0.3)",
          "75:       rack-protection (= 2.0.3)",
          "",
          "---------------"
        ],
        "lib/gemirro/version.rb||lib/gemirro/version.rb": [
          "File: lib/gemirro/version.rb -> lib/gemirro/version.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: # Gemirro Version",
          "2: module Gemirro",
          "4: end",
          "",
          "[Removed Lines]",
          "3:   VERSION = '1.1.0'.freeze",
          "",
          "[Added Lines]",
          "3:   VERSION = '1.1.1'.freeze",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "40351f6c23722f022414e0c8cd5731f49b5e27b7",
      "candidate_info": {
        "commit_hash": "40351f6c23722f022414e0c8cd5731f49b5e27b7",
        "repo": "PierreRambaud/gemirro",
        "commit_url": "https://github.com/PierreRambaud/gemirro/commit/40351f6c23722f022414e0c8cd5731f49b5e27b7",
        "files": [
          "Gemfile.lock",
          "lib/gemirro/version.rb"
        ],
        "message": "Gemirro 1.0.0",
        "before_after_code_files": [
          "Gemfile.lock||Gemfile.lock",
          "lib/gemirro/version.rb||lib/gemirro/version.rb"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "Gemfile.lock||Gemfile.lock"
          ],
          "candidate": [
            "Gemfile.lock||Gemfile.lock"
          ]
        }
      },
      "candidate_diff": {
        "Gemfile.lock||Gemfile.lock": [
          "File: Gemfile.lock -> Gemfile.lock",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: PATH",
          "2:   remote: .",
          "3:   specs:",
          "5:       addressable (~> 2.5)",
          "6:       builder (~> 3.2)",
          "7:       confstruct (~> 1.0)",
          "",
          "[Removed Lines]",
          "4:     gemirro (0.16.0)",
          "",
          "[Added Lines]",
          "4:     gemirro (1.0.0)",
          "",
          "---------------"
        ],
        "lib/gemirro/version.rb||lib/gemirro/version.rb": [
          "File: lib/gemirro/version.rb -> lib/gemirro/version.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: # Gemirro Version",
          "2: module Gemirro",
          "4: end",
          "",
          "[Removed Lines]",
          "3:   VERSION = '0.16.0'.freeze",
          "",
          "[Added Lines]",
          "3:   VERSION = '1.0.0'.freeze",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "aaa8940e7386dbd34b17b45a890a1f758812e278",
      "candidate_info": {
        "commit_hash": "aaa8940e7386dbd34b17b45a890a1f758812e278",
        "repo": "PierreRambaud/gemirro",
        "commit_url": "https://github.com/PierreRambaud/gemirro/commit/aaa8940e7386dbd34b17b45a890a1f758812e278",
        "files": [
          "Gemfile.lock",
          "lib/gemirro/version.rb"
        ],
        "message": "Bump to 1.1.0",
        "before_after_code_files": [
          "Gemfile.lock||Gemfile.lock",
          "lib/gemirro/version.rb||lib/gemirro/version.rb"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "Gemfile.lock||Gemfile.lock"
          ],
          "candidate": [
            "Gemfile.lock||Gemfile.lock"
          ]
        }
      },
      "candidate_diff": {
        "Gemfile.lock||Gemfile.lock": [
          "File: Gemfile.lock -> Gemfile.lock",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: PATH",
          "2:   remote: .",
          "3:   specs:",
          "5:       addressable (~> 2.5)",
          "6:       builder (~> 3.2)",
          "7:       confstruct (~> 1.0)",
          "",
          "[Removed Lines]",
          "4:     gemirro (1.0.0)",
          "",
          "[Added Lines]",
          "4:     gemirro (1.1.0)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "23:       hashie (~> 3.3)",
          "24:     daemons (1.2.6)",
          "25:     diff-lcs (1.3)",
          "27:     erubis (2.7.0)",
          "30:     hashie (3.5.7)",
          "31:     httpclient (2.8.3)",
          "32:     json (2.1.0)",
          "",
          "[Removed Lines]",
          "26:     docile (1.3.0)",
          "28:     eventmachine (1.2.5)",
          "29:     fakefs (0.13.3)",
          "",
          "[Added Lines]",
          "26:     docile (1.3.1)",
          "28:     eventmachine (1.2.7)",
          "29:     fakefs (0.14.2)",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "36:       ast (~> 2.4.0)",
          "37:     powerpack (0.1.1)",
          "38:     public_suffix (3.0.2)",
          "40:     rack-protection (2.0.1)",
          "41:       rack",
          "42:     rack-test (0.8.3)",
          "",
          "[Removed Lines]",
          "39:     rack (2.0.4)",
          "",
          "[Added Lines]",
          "39:     rack (2.0.5)",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "56:       diff-lcs (>= 1.2.0, < 2.0)",
          "57:       rspec-support (~> 3.7.0)",
          "58:     rspec-support (3.7.1)",
          "60:       parallel (~> 1.10)",
          "61:       parser (>= 2.5)",
          "62:       powerpack (~> 0.1)",
          "",
          "[Removed Lines]",
          "59:     rubocop (0.55.0)",
          "",
          "[Added Lines]",
          "59:     rubocop (0.56.0)",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "80:       eventmachine (~> 1.0, >= 1.0.4)",
          "81:       rack (>= 1, < 3)",
          "82:     tilt (2.0.8)",
          "85: PLATFORMS",
          "86:   ruby",
          "",
          "[Removed Lines]",
          "83:     unicode-display_width (1.3.2)",
          "",
          "[Added Lines]",
          "83:     unicode-display_width (1.3.3)",
          "",
          "---------------"
        ],
        "lib/gemirro/version.rb||lib/gemirro/version.rb": [
          "File: lib/gemirro/version.rb -> lib/gemirro/version.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: # Gemirro Version",
          "2: module Gemirro",
          "4: end",
          "",
          "[Removed Lines]",
          "3:   VERSION = '1.0.0'.freeze",
          "",
          "[Added Lines]",
          "3:   VERSION = '1.1.0'.freeze",
          "",
          "---------------"
        ]
      }
    }
  ]
}