{
  "cve_id": "CVE-2024-32650",
  "cve_desc": "Rustls is a modern TLS library written in Rust. `rustls::ConnectionCommon::complete_io` could fall into an infinite loop based on network input. When using a blocking rustls server, if a client send a `close_notify` message immediately after `client_hello`, the server's `complete_io` will get in an infinite loop. This vulnerability is fixed in 0.23.5, 0.22.4, and 0.21.11.",
  "repo": "rustls/rustls",
  "patch_hash": "f45664fbded03d833dffd806503d3c8becd1b71e",
  "patch_info": {
    "commit_hash": "f45664fbded03d833dffd806503d3c8becd1b71e",
    "repo": "rustls/rustls",
    "commit_url": "https://github.com/rustls/rustls/commit/f45664fbded03d833dffd806503d3c8becd1b71e",
    "files": [
      "rustls/src/common_state.rs"
    ],
    "message": "Don't specially handle unauthenticated close_notify alerts",
    "before_after_code_files": [
      "rustls/src/common_state.rs||rustls/src/common_state.rs"
    ]
  },
  "patch_diff": {
    "rustls/src/common_state.rs||rustls/src/common_state.rs": [
      "File: rustls/src/common_state.rs -> rustls/src/common_state.rs",
      "--- Hunk 1 ---",
      "[Context before]",
      "431:         }",
      "436:             self.has_received_close_notify = true;",
      "437:             return Ok(());",
      "438:         }",
      "",
      "[Removed Lines]",
      "435:         if alert.description == AlertDescription::CloseNotify {",
      "",
      "[Added Lines]",
      "435:         if self.may_receive_application_data && alert.description == AlertDescription::CloseNotify {",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "14cb5d2eac709f6c9bd46c697f090bb1f1543db1",
      "candidate_info": {
        "commit_hash": "14cb5d2eac709f6c9bd46c697f090bb1f1543db1",
        "repo": "rustls/rustls",
        "commit_url": "https://github.com/rustls/rustls/commit/14cb5d2eac709f6c9bd46c697f090bb1f1543db1",
        "files": [
          "Cargo.lock",
          "fuzz/Cargo.lock",
          "rustls/Cargo.toml"
        ],
        "message": "Prepare 0.23.5",
        "before_after_code_files": [
          "Cargo.lock||Cargo.lock",
          "fuzz/Cargo.lock||fuzz/Cargo.lock"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/rustls/rustls/pull/1905"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "Cargo.lock||Cargo.lock": [
          "File: Cargo.lock -> Cargo.lock",
          "--- Hunk 1 ---",
          "[Context before]",
          "2176: [[package]]",
          "2177: name = \"rustls\"",
          "2179: dependencies = [",
          "2180:  \"aws-lc-rs\",",
          "2181:  \"base64 0.22.0\",",
          "",
          "[Removed Lines]",
          "2178: version = \"0.23.4\"",
          "",
          "[Added Lines]",
          "2178: version = \"0.23.5\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2209:  \"fxhash\",",
          "2210:  \"itertools\",",
          "2211:  \"rayon\",",
          "2213:  \"rustls-pemfile 2.1.2\",",
          "2214:  \"rustls-pki-types\",",
          "2215:  \"tikv-jemallocator\",",
          "",
          "[Removed Lines]",
          "2212:  \"rustls 0.23.4\",",
          "",
          "[Added Lines]",
          "2212:  \"rustls 0.23.5\",",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "2222:  \"hickory-resolver\",",
          "2223:  \"regex\",",
          "2224:  \"ring\",",
          "2226: ]",
          "2228: [[package]]",
          "",
          "[Removed Lines]",
          "2225:  \"rustls 0.23.4\",",
          "",
          "[Added Lines]",
          "2225:  \"rustls 0.23.5\",",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "2235:  \"log\",",
          "2236:  \"mio\",",
          "2237:  \"rcgen\",",
          "2239:  \"rustls-pemfile 2.1.2\",",
          "2240:  \"rustls-pki-types\",",
          "2241:  \"serde\",",
          "",
          "[Removed Lines]",
          "2238:  \"rustls 0.23.4\",",
          "",
          "[Added Lines]",
          "2238:  \"rustls 0.23.5\",",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "2253:  \"num-bigint\",",
          "2254:  \"once_cell\",",
          "2255:  \"openssl\",",
          "2257:  \"rustls-pemfile 2.1.2\",",
          "2258:  \"rustls-pki-types\",",
          "2259: ]",
          "",
          "[Removed Lines]",
          "2256:  \"rustls 0.23.4\",",
          "",
          "[Added Lines]",
          "2256:  \"rustls 0.23.5\",",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "2289: dependencies = [",
          "2290:  \"aws-lc-rs\",",
          "2291:  \"env_logger\",",
          "2293:  \"webpki-roots 0.26.1\",",
          "2294: ]",
          "",
          "[Removed Lines]",
          "2292:  \"rustls 0.23.4\",",
          "",
          "[Added Lines]",
          "2292:  \"rustls 0.23.5\",",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "2311:  \"rand_core\",",
          "2312:  \"rcgen\",",
          "2313:  \"rsa\",",
          "2315:  \"rustls-pki-types\",",
          "2316:  \"rustls-webpki 0.102.2\",",
          "2317:  \"serde\",",
          "",
          "[Removed Lines]",
          "2314:  \"rustls 0.23.4\",",
          "",
          "[Added Lines]",
          "2314:  \"rustls 0.23.5\",",
          "",
          "---------------"
        ],
        "fuzz/Cargo.lock||fuzz/Cargo.lock": [
          "File: fuzz/Cargo.lock -> fuzz/Cargo.lock",
          "--- Hunk 1 ---",
          "[Context before]",
          "361: [[package]]",
          "362: name = \"rustls\"",
          "364: dependencies = [",
          "365:  \"aws-lc-rs\",",
          "366:  \"log\",",
          "",
          "[Removed Lines]",
          "363: version = \"0.23.4\"",
          "",
          "[Added Lines]",
          "363: version = \"0.23.5\"",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "0c6cd7ef68656de958793c7472efe450c808e5d6",
      "candidate_info": {
        "commit_hash": "0c6cd7ef68656de958793c7472efe450c808e5d6",
        "repo": "rustls/rustls",
        "commit_url": "https://github.com/rustls/rustls/commit/0c6cd7ef68656de958793c7472efe450c808e5d6",
        "files": [
          "rustls/src/common_state.rs"
        ],
        "message": "Don't specially handle unauthenticated close_notify alerts",
        "before_after_code_files": [
          "rustls/src/common_state.rs||rustls/src/common_state.rs"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "rustls/src/common_state.rs||rustls/src/common_state.rs"
          ],
          "candidate": [
            "rustls/src/common_state.rs||rustls/src/common_state.rs"
          ]
        }
      },
      "candidate_diff": {
        "rustls/src/common_state.rs||rustls/src/common_state.rs": [
          "File: rustls/src/common_state.rs -> rustls/src/common_state.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "439:         }",
          "444:             self.has_received_close_notify = true;",
          "445:             return Ok(());",
          "446:         }",
          "",
          "[Removed Lines]",
          "443:         if alert.description == AlertDescription::CloseNotify {",
          "",
          "[Added Lines]",
          "443:         if self.may_receive_application_data && alert.description == AlertDescription::CloseNotify {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "2f2aae15a4293639669291ab2b257835a2d4bdca",
      "candidate_info": {
        "commit_hash": "2f2aae15a4293639669291ab2b257835a2d4bdca",
        "repo": "rustls/rustls",
        "commit_url": "https://github.com/rustls/rustls/commit/2f2aae15a4293639669291ab2b257835a2d4bdca",
        "files": [
          "rustls/src/common_state.rs"
        ],
        "message": "Don't specially handle unauthenticated close_notify alerts",
        "before_after_code_files": [
          "rustls/src/common_state.rs||rustls/src/common_state.rs"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "rustls/src/common_state.rs||rustls/src/common_state.rs"
          ],
          "candidate": [
            "rustls/src/common_state.rs||rustls/src/common_state.rs"
          ]
        }
      },
      "candidate_diff": {
        "rustls/src/common_state.rs||rustls/src/common_state.rs": [
          "File: rustls/src/common_state.rs -> rustls/src/common_state.rs",
          "--- Hunk 1 ---",
          "[Context before]",
          "445:         }",
          "450:             self.has_received_close_notify = true;",
          "451:             return Ok(());",
          "452:         }",
          "",
          "[Removed Lines]",
          "449:         if alert.description == AlertDescription::CloseNotify {",
          "",
          "[Added Lines]",
          "449:         if self.may_receive_application_data && alert.description == AlertDescription::CloseNotify {",
          "",
          "---------------"
        ]
      }
    }
  ]
}