{
  "cve_id": "CVE-2020-15248",
  "cve_desc": "October is a free, open-source, self-hosted CMS platform based on the Laravel PHP Framework. In October CMS from version 1.0.319 and before version 1.0.470, backend users with the default \"Publisher\" system role have access to create & manage users where they can choose which role the new user has. This means that a user with \"Publisher\" access has the ability to escalate their access to \"Developer\" access. Issue has been patched in Build 470 (v1.0.470) & v1.1.1.",
  "repo": "octobercms/october",
  "patch_hash": "78a37298a4ed4602b383522344a31e311402d829",
  "patch_info": {
    "commit_hash": "78a37298a4ed4602b383522344a31e311402d829",
    "repo": "octobercms/october",
    "commit_url": "https://github.com/octobercms/october/commit/78a37298a4ed4602b383522344a31e311402d829",
    "files": [
      "modules/backend/ServiceProvider.php",
      "modules/system/ServiceProvider.php"
    ],
    "message": "Tightened up the default permissions granted to the \"Publisher\" system role out of the box\n\n(cherry picked from commit 8a785e439395aa901d2b9d7bcb6a343a071c7870)",
    "before_after_code_files": [
      "modules/backend/ServiceProvider.php||modules/backend/ServiceProvider.php",
      "modules/system/ServiceProvider.php||modules/system/ServiceProvider.php"
    ]
  },
  "patch_diff": {
    "modules/backend/ServiceProvider.php||modules/backend/ServiceProvider.php": [
      "File: modules/backend/ServiceProvider.php -> modules/backend/ServiceProvider.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "140:             $manager->registerPermissions('October.Backend', [",
      "141:                 'backend.access_dashboard' => [",
      "142:                     'label' => 'system::lang.permissions.view_the_dashboard',",
      "144:                 ],",
      "145:                 'backend.manage_default_dashboard' => [",
      "146:                     'label' => 'system::lang.permissions.manage_default_dashboard',",
      "147:                     'tab'   => 'system::lang.permissions.name',",
      "148:                 ],",
      "149:                 'backend.manage_users' => [",
      "150:                     'label' => 'system::lang.permissions.manage_other_administrators',",
      "152:                 ],",
      "153:                 'backend.impersonate_users' => [",
      "154:                     'label' => 'system::lang.permissions.impersonate_users',",
      "155:                     'tab'   => 'system::lang.permissions.name',",
      "156:                 ],",
      "157:                 'backend.manage_preferences' => [",
      "158:                     'label' => 'system::lang.permissions.manage_preferences',",
      "160:                 ],",
      "161:                 'backend.manage_editor' => [",
      "162:                     'label' => 'system::lang.permissions.manage_editor',",
      "164:                 ],",
      "165:                 'backend.manage_branding' => [",
      "166:                     'label' => 'system::lang.permissions.manage_branding',",
      "168:                 ],",
      "169:                 'media.manage_media' => [",
      "170:                     'label' => 'backend::lang.permissions.manage_media',",
      "",
      "[Removed Lines]",
      "143:                     'tab'   => 'system::lang.permissions.name'",
      "151:                     'tab'   => 'system::lang.permissions.name'",
      "159:                     'tab'   => 'system::lang.permissions.name'",
      "163:                     'tab'   => 'system::lang.permissions.name'",
      "167:                     'tab'   => 'system::lang.permissions.name'",
      "",
      "[Added Lines]",
      "143:                     'tab'   => 'system::lang.permissions.name',",
      "148:                     'roles' => UserRole::CODE_DEVELOPER,",
      "152:                     'tab'   => 'system::lang.permissions.name',",
      "153:                     'roles' => UserRole::CODE_DEVELOPER,",
      "158:                     'roles' => UserRole::CODE_DEVELOPER,",
      "162:                     'tab'   => 'system::lang.permissions.name',",
      "166:                     'tab'   => 'system::lang.permissions.name',",
      "170:                     'tab'   => 'system::lang.permissions.name',",
      "",
      "---------------"
    ],
    "modules/system/ServiceProvider.php||modules/system/ServiceProvider.php": [
      "File: modules/system/ServiceProvider.php -> modules/system/ServiceProvider.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "9: use Request;",
      "10: use BackendMenu;",
      "11: use BackendAuth;",
      "12: use Twig\\Extension\\SandboxExtension;",
      "13: use Twig\\Environment as TwigEnvironment;",
      "14: use System\\Classes\\MailManager;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "12: use Backend\\Models\\UserRole;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "417:             $manager->registerPermissions('October.System', [",
      "418:                 'system.manage_updates' => [",
      "419:                     'label' => 'system::lang.permissions.manage_software_updates',",
      "421:                 ],",
      "422:                 'system.access_logs' => [",
      "423:                     'label' => 'system::lang.permissions.access_logs',",
      "425:                 ],",
      "426:                 'system.manage_mail_settings' => [",
      "427:                     'label' => 'system::lang.permissions.manage_mail_settings',",
      "429:                 ],",
      "430:                 'system.manage_mail_templates' => [",
      "431:                     'label' => 'system::lang.permissions.manage_mail_templates',",
      "433:                 ]",
      "434:             ]);",
      "435:         });",
      "",
      "[Removed Lines]",
      "420:                     'tab' => 'system::lang.permissions.name'",
      "424:                     'tab' => 'system::lang.permissions.name'",
      "428:                     'tab' => 'system::lang.permissions.name'",
      "432:                     'tab' => 'system::lang.permissions.name'",
      "",
      "[Added Lines]",
      "421:                     'tab' => 'system::lang.permissions.name',",
      "422:                     'roles' => UserRole::CODE_DEVELOPER,",
      "426:                     'tab' => 'system::lang.permissions.name',",
      "427:                     'roles' => UserRole::CODE_DEVELOPER,",
      "431:                     'tab' => 'system::lang.permissions.name',",
      "432:                     'roles' => UserRole::CODE_DEVELOPER,",
      "436:                     'tab' => 'system::lang.permissions.name',",
      "437:                     'roles' => UserRole::CODE_DEVELOPER,",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "618e2b58abd0beae01d5a291a840902d5e97c7d9",
      "candidate_info": {
        "commit_hash": "618e2b58abd0beae01d5a291a840902d5e97c7d9",
        "repo": "octobercms/october",
        "commit_url": "https://github.com/octobercms/october/commit/618e2b58abd0beae01d5a291a840902d5e97c7d9",
        "files": [
          "modules/system/classes/ImageResizer.php"
        ],
        "message": "Ignore images that can't be processed by the resizer",
        "before_after_code_files": [
          "modules/system/classes/ImageResizer.php||modules/system/classes/ImageResizer.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/octobercms/october/pull/5359"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "modules/system/classes/ImageResizer.php||modules/system/classes/ImageResizer.php": [
          "File: modules/system/classes/ImageResizer.php -> modules/system/classes/ImageResizer.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "612:             }",
          "613:         }",
          "616:             if (is_object($image)) {",
          "617:                 $image = get_class($image);",
          "618:             }",
          "",
          "[Removed Lines]",
          "615:         if (!$disk || !$path || !$selectedSource) {",
          "",
          "[Added Lines]",
          "615:         if (!$disk || !$path || !$selectedSource || (!in_array(FileHelper::extension($path), ['jpg', 'jpeg', 'png', 'webp', 'gif']))) {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "af6db51b7978aae874844e79e0103b0952d7b762",
      "candidate_info": {
        "commit_hash": "af6db51b7978aae874844e79e0103b0952d7b762",
        "repo": "octobercms/october",
        "commit_url": "https://github.com/octobercms/october/commit/af6db51b7978aae874844e79e0103b0952d7b762",
        "files": [
          "modules/backend/behaviors/RelationController.php"
        ],
        "message": "Allow \"no records\" message to be defined for relation widgets.\n\nBoth the \"view\" and \"manage\" widgets, in list mode, now support a custom message when no records are available. To maintain BC, if \"emptyMessage\" is provided in the relation config, this is still used for the \"view\" widget in list mode.\n\nFixes https://github.com/octobercms/october/issues/3594",
        "before_after_code_files": [
          "modules/backend/behaviors/RelationController.php||modules/backend/behaviors/RelationController.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/octobercms/october/pull/5359"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "modules/backend/behaviors/RelationController.php||modules/backend/behaviors/RelationController.php": [
          "File: modules/backend/behaviors/RelationController.php -> modules/backend/behaviors/RelationController.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "669:             $config->defaultSort = $this->getConfig('view[defaultSort]');",
          "670:             $config->recordsPerPage = $this->getConfig('view[recordsPerPage]');",
          "671:             $config->showCheckboxes = $this->getConfig('view[showCheckboxes]', !$this->readOnly);",
          "675:             $defaultOnClick = sprintf(",
          "676:                 \"$.oc.relationBehavior.clickViewListRecord(':%s', '%s', '%s')\",",
          "",
          "[Removed Lines]",
          "672:             $config->recordUrl = $this->getConfig('view[recordUrl]', null);",
          "673:             $config->customViewPath = $this->getConfig('view[customViewPath]', null);",
          "",
          "[Added Lines]",
          "672:             $config->recordUrl = $this->getConfig('view[recordUrl]');",
          "673:             $config->customViewPath = $this->getConfig('view[customViewPath]');",
          "674:             $config->noRecordsMessage = $this->getConfig('view[noRecordsMessage]');",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "818:             $config->showSorting = $this->getConfig('manage[showSorting]', !$isPivot);",
          "819:             $config->defaultSort = $this->getConfig('manage[defaultSort]');",
          "820:             $config->recordsPerPage = $this->getConfig('manage[recordsPerPage]');",
          "822:             if ($this->viewMode == 'single') {",
          "823:                 $config->showCheckboxes = false;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "822:             $config->noRecordsMessage = $this->getConfig('manage[noRecordsMessage]');",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "d34fb8ab51108495a9a651b841202d935f4e12f7",
      "candidate_info": {
        "commit_hash": "d34fb8ab51108495a9a651b841202d935f4e12f7",
        "repo": "octobercms/october",
        "commit_url": "https://github.com/octobercms/october/commit/d34fb8ab51108495a9a651b841202d935f4e12f7",
        "files": [
          "modules/system/twig/SecurityPolicy.php"
        ],
        "message": "Improve Twig security policy\n\nFollow up to https://github.com/octobercms/october/compare/106daa2930de4cebb18732732d47d4056f01dd5b...7cb148c1677373ac30ccfd3069d18098e403e1ca. Thanks to @ka1n4t for the additional review.",
        "before_after_code_files": [
          "modules/system/twig/SecurityPolicy.php||modules/system/twig/SecurityPolicy.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/octobercms/october/pull/5359"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "modules/system/twig/SecurityPolicy.php||modules/system/twig/SecurityPolicy.php": [
          "File: modules/system/twig/SecurityPolicy.php -> modules/system/twig/SecurityPolicy.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "20:     protected $blockedMethods = [",
          "21:         'addDynamicMethod',",
          "22:         'addDynamicProperty',",
          "23:     ];",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "23:         'bindEvent',",
          "24:         'bindEventOnce',",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "619be11d23b77da1eacefea4a215601ac715e1a7",
      "candidate_info": {
        "commit_hash": "619be11d23b77da1eacefea4a215601ac715e1a7",
        "repo": "octobercms/october",
        "commit_url": "https://github.com/octobercms/october/commit/619be11d23b77da1eacefea4a215601ac715e1a7",
        "files": [
          "modules/system/ServiceProvider.php"
        ],
        "message": "Make \"october:env\" command privileged.\n\nThis allows developers to use the command even if plugins are failing to boot due to missing configuration options (such as the DB configuration being incorrect). Previously, plugins which use the database in boot would prevent the command from running if the database details were incorrect.\n\nThis change removes a barrier from configuring your site correctly.",
        "before_after_code_files": [
          "modules/system/ServiceProvider.php||modules/system/ServiceProvider.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/octobercms/october/pull/5359"
        ],
        "olp_code_files": {
          "patch": [
            "modules/system/ServiceProvider.php||modules/system/ServiceProvider.php"
          ],
          "candidate": [
            "modules/system/ServiceProvider.php||modules/system/ServiceProvider.php"
          ]
        }
      },
      "candidate_diff": {
        "modules/system/ServiceProvider.php||modules/system/ServiceProvider.php": [
          "File: modules/system/ServiceProvider.php -> modules/system/ServiceProvider.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "135:     protected function registerPrivilegedActions()",
          "136:     {",
          "137:         $requests = ['/combine/', '@/system/updates', '@/system/install', '@/backend/auth'];",
          "",
          "[Removed Lines]",
          "138:         $commands = ['october:up', 'october:update', 'october:version'];",
          "",
          "[Added Lines]",
          "138:         $commands = ['october:up', 'october:update', 'october:env', 'october:version'];",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "789de0217d0c06c95097261b59aee8902bf19ed7",
      "candidate_info": {
        "commit_hash": "789de0217d0c06c95097261b59aee8902bf19ed7",
        "repo": "octobercms/october",
        "commit_url": "https://github.com/octobercms/october/commit/789de0217d0c06c95097261b59aee8902bf19ed7",
        "files": [
          "modules/backend/models/brandsetting/custom.less"
        ],
        "message": "Add styling for fancy breadcrumb based on Backend brand colors",
        "before_after_code_files": [
          "modules/backend/models/brandsetting/custom.less||modules/backend/models/brandsetting/custom.less"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/octobercms/october/pull/5359"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "modules/backend/models/brandsetting/custom.less||modules/backend/models/brandsetting/custom.less": [
          "File: modules/backend/models/brandsetting/custom.less -> modules/backend/models/brandsetting/custom.less",
          "--- Hunk 1 ---",
          "[Context before]",
          "193: .nav.selector-group li.active {",
          "194:     border-left-color: @brand-secondary;",
          "195: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "200: body.breadcrumb-fancy .control-breadcrumb,",
          "201: .control-breadcrumb.breadcrumb-fancy {",
          "202:     background-color: mix(black, saturate(@brand-secondary, 20%), 16%);",
          "204:     li {",
          "205:         background-color: mix(black, saturate(@brand-secondary, 20%), 31%);",
          "207:         &:last-child {",
          "208:             background-color: mix(black, saturate(@brand-secondary, 20%), 16%);",
          "210:             &::before {",
          "211:                 border-left-color: mix(black, saturate(@brand-secondary, 20%), 16%);",
          "212:             }",
          "213:         }",
          "215:         &::after {",
          "216:             border-left-color: mix(black, saturate(@brand-secondary, 20%), 31%);",
          "217:         }",
          "219:         &:not(:last-child)::before {",
          "220:             border-left-color: @brand-secondary;",
          "221:         }",
          "222:     }",
          "223: }",
          "",
          "---------------"
        ]
      }
    }
  ]
}