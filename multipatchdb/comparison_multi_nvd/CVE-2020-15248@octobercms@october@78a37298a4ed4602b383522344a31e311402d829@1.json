{
  "cve_id": "CVE-2020-15248",
  "cve_desc": "October is a free, open-source, self-hosted CMS platform based on the Laravel PHP Framework. In October CMS from version 1.0.319 and before version 1.0.470, backend users with the default \"Publisher\" system role have access to create & manage users where they can choose which role the new user has. This means that a user with \"Publisher\" access has the ability to escalate their access to \"Developer\" access. Issue has been patched in Build 470 (v1.0.470) & v1.1.1.",
  "repo": "octobercms/october",
  "patch_hash": "78a37298a4ed4602b383522344a31e311402d829",
  "patch_info": {
    "commit_hash": "78a37298a4ed4602b383522344a31e311402d829",
    "repo": "octobercms/october",
    "commit_url": "https://github.com/octobercms/october/commit/78a37298a4ed4602b383522344a31e311402d829",
    "files": [
      "modules/backend/ServiceProvider.php",
      "modules/system/ServiceProvider.php"
    ],
    "message": "Tightened up the default permissions granted to the \"Publisher\" system role out of the box\n\n(cherry picked from commit 8a785e439395aa901d2b9d7bcb6a343a071c7870)",
    "before_after_code_files": [
      "modules/backend/ServiceProvider.php||modules/backend/ServiceProvider.php",
      "modules/system/ServiceProvider.php||modules/system/ServiceProvider.php"
    ]
  },
  "patch_diff": {
    "modules/backend/ServiceProvider.php||modules/backend/ServiceProvider.php": [
      "File: modules/backend/ServiceProvider.php -> modules/backend/ServiceProvider.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "140:             $manager->registerPermissions('October.Backend', [",
      "141:                 'backend.access_dashboard' => [",
      "142:                     'label' => 'system::lang.permissions.view_the_dashboard',",
      "144:                 ],",
      "145:                 'backend.manage_default_dashboard' => [",
      "146:                     'label' => 'system::lang.permissions.manage_default_dashboard',",
      "147:                     'tab'   => 'system::lang.permissions.name',",
      "148:                 ],",
      "149:                 'backend.manage_users' => [",
      "150:                     'label' => 'system::lang.permissions.manage_other_administrators',",
      "152:                 ],",
      "153:                 'backend.impersonate_users' => [",
      "154:                     'label' => 'system::lang.permissions.impersonate_users',",
      "155:                     'tab'   => 'system::lang.permissions.name',",
      "156:                 ],",
      "157:                 'backend.manage_preferences' => [",
      "158:                     'label' => 'system::lang.permissions.manage_preferences',",
      "160:                 ],",
      "161:                 'backend.manage_editor' => [",
      "162:                     'label' => 'system::lang.permissions.manage_editor',",
      "164:                 ],",
      "165:                 'backend.manage_branding' => [",
      "166:                     'label' => 'system::lang.permissions.manage_branding',",
      "168:                 ],",
      "169:                 'media.manage_media' => [",
      "170:                     'label' => 'backend::lang.permissions.manage_media',",
      "",
      "[Removed Lines]",
      "143:                     'tab'   => 'system::lang.permissions.name'",
      "151:                     'tab'   => 'system::lang.permissions.name'",
      "159:                     'tab'   => 'system::lang.permissions.name'",
      "163:                     'tab'   => 'system::lang.permissions.name'",
      "167:                     'tab'   => 'system::lang.permissions.name'",
      "",
      "[Added Lines]",
      "143:                     'tab'   => 'system::lang.permissions.name',",
      "148:                     'roles' => UserRole::CODE_DEVELOPER,",
      "152:                     'tab'   => 'system::lang.permissions.name',",
      "153:                     'roles' => UserRole::CODE_DEVELOPER,",
      "158:                     'roles' => UserRole::CODE_DEVELOPER,",
      "162:                     'tab'   => 'system::lang.permissions.name',",
      "166:                     'tab'   => 'system::lang.permissions.name',",
      "170:                     'tab'   => 'system::lang.permissions.name',",
      "",
      "---------------"
    ],
    "modules/system/ServiceProvider.php||modules/system/ServiceProvider.php": [
      "File: modules/system/ServiceProvider.php -> modules/system/ServiceProvider.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "9: use Request;",
      "10: use BackendMenu;",
      "11: use BackendAuth;",
      "12: use Twig\\Extension\\SandboxExtension;",
      "13: use Twig\\Environment as TwigEnvironment;",
      "14: use System\\Classes\\MailManager;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "12: use Backend\\Models\\UserRole;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "417:             $manager->registerPermissions('October.System', [",
      "418:                 'system.manage_updates' => [",
      "419:                     'label' => 'system::lang.permissions.manage_software_updates',",
      "421:                 ],",
      "422:                 'system.access_logs' => [",
      "423:                     'label' => 'system::lang.permissions.access_logs',",
      "425:                 ],",
      "426:                 'system.manage_mail_settings' => [",
      "427:                     'label' => 'system::lang.permissions.manage_mail_settings',",
      "429:                 ],",
      "430:                 'system.manage_mail_templates' => [",
      "431:                     'label' => 'system::lang.permissions.manage_mail_templates',",
      "433:                 ]",
      "434:             ]);",
      "435:         });",
      "",
      "[Removed Lines]",
      "420:                     'tab' => 'system::lang.permissions.name'",
      "424:                     'tab' => 'system::lang.permissions.name'",
      "428:                     'tab' => 'system::lang.permissions.name'",
      "432:                     'tab' => 'system::lang.permissions.name'",
      "",
      "[Added Lines]",
      "421:                     'tab' => 'system::lang.permissions.name',",
      "422:                     'roles' => UserRole::CODE_DEVELOPER,",
      "426:                     'tab' => 'system::lang.permissions.name',",
      "427:                     'roles' => UserRole::CODE_DEVELOPER,",
      "431:                     'tab' => 'system::lang.permissions.name',",
      "432:                     'roles' => UserRole::CODE_DEVELOPER,",
      "436:                     'tab' => 'system::lang.permissions.name',",
      "437:                     'roles' => UserRole::CODE_DEVELOPER,",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "a9d54eaa97e4691f5df84ef56ddca6b83b801d9b",
      "candidate_info": {
        "commit_hash": "a9d54eaa97e4691f5df84ef56ddca6b83b801d9b",
        "repo": "octobercms/october",
        "commit_url": "https://github.com/octobercms/october/commit/a9d54eaa97e4691f5df84ef56ddca6b83b801d9b",
        "files": [
          "modules/system/classes/SystemController.php"
        ],
        "message": "Warn about unsupported cache drivers being used for image resizing",
        "before_after_code_files": [
          "modules/system/classes/SystemController.php||modules/system/classes/SystemController.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/octobercms/october/pull/5359"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "modules/system/classes/SystemController.php||modules/system/classes/SystemController.php": [
          "File: modules/system/classes/SystemController.php -> modules/system/classes/SystemController.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: <?php namespace System\\Classes;",
          "3: use Lang;",
          "4: use Response;",
          "5: use Exception;",
          "6: use SystemException;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "4: use Config;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "63:         } catch (SystemException $ex) {",
          "66:         } catch (Exception $ex) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "69:             if (Config::get('cache.default', 'file') === 'array') {",
          "70:                 throw new Exception('Image resizing requires a persistent cache driver, \"array\" is not supported. Try changing config/cache.php -> default to a persistent cache driver.');",
          "71:             }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "216b0d6004ec193263bdf2f535220d693f251508",
      "candidate_info": {
        "commit_hash": "216b0d6004ec193263bdf2f535220d693f251508",
        "repo": "octobercms/october",
        "commit_url": "https://github.com/octobercms/october/commit/216b0d6004ec193263bdf2f535220d693f251508",
        "files": [
          "modules/system/console/OctoberFresh.php"
        ],
        "message": "Remove errors from `october:fresh` and indicate which demo files were moved\n\nFollow-up work to fc9d6233a8da738b5b8bbdf2fb7e6fd67da12b66.",
        "before_after_code_files": [
          "modules/system/console/OctoberFresh.php||modules/system/console/OctoberFresh.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/octobercms/october/pull/5359"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "modules/system/console/OctoberFresh.php||modules/system/console/OctoberFresh.php": [
          "File: modules/system/console/OctoberFresh.php -> modules/system/console/OctoberFresh.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "35:         if (!$this->confirmToProceed('Are you sure?')) {",
          "36:             return;",
          "37:         }",
          "39:         $demoThemePath = themes_path().'/demo';",
          "40:         if (File::exists($demoThemePath)) {",
          "41:             File::deleteDirectory($demoThemePath);",
          "47:         }",
          "49:         $demoPluginPath = plugins_path().'/october/demo';",
          "50:         if (File::exists($demoPluginPath)) {",
          "51:             Artisan::call('plugin:remove', ['name' => 'October.Demo', '--force' => true]);",
          "53:             $this->info('Demo plugin has been removed! Enjoy a fresh start.');",
          "57:         }",
          "58:     }",
          "",
          "[Removed Lines]",
          "43:             $this->info('Demo theme has been removed! Enjoy a fresh start.');",
          "44:         }",
          "45:         else {",
          "46:             $this->error('Demo theme is already removed.');",
          "54:         }",
          "55:         else {",
          "56:             $this->error('Demo plugin is already removed.');",
          "",
          "[Added Lines]",
          "39:         $themeRemoved = false;",
          "40:         $pluginRemoved = false;",
          "45:             $themeRemoved = true;",
          "51:             $pluginRemoved = true;",
          "52:         }",
          "54:         if ($themeRemoved && $pluginRemoved) {",
          "55:             $this->info('Demo theme and plugin have been removed! Enjoy a fresh start.');",
          "56:         } elseif ($themeRemoved) {",
          "57:             $this->info('Demo theme has been removed! Enjoy a fresh start.');",
          "58:         } elseif ($pluginRemoved) {",
          "60:         } else {",
          "61:             $this->info('Demo theme and plugin have already been removed.');",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "11c93f0a3bf3bddc969847bbcc0da38132978f0d",
      "candidate_info": {
        "commit_hash": "11c93f0a3bf3bddc969847bbcc0da38132978f0d",
        "repo": "octobercms/october",
        "commit_url": "https://github.com/octobercms/october/commit/11c93f0a3bf3bddc969847bbcc0da38132978f0d",
        "files": [
          "modules/system/twig/Loader.php"
        ],
        "message": "Fixes View::make recursion\n\nThis logic is called via {% include %} (fixed) and as a custom .htm driver for View::make (broken). The previous change was too aggressive and broke the latter. This still fixes arbitrary file inclusion whilst retaining the original design. Both logic paths are now fixed and have been tested",
        "before_after_code_files": [
          "modules/system/twig/Loader.php||modules/system/twig/Loader.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/octobercms/october/pull/5359"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "modules/system/twig/Loader.php||modules/system/twig/Loader.php": [
          "File: modules/system/twig/Loader.php -> modules/system/twig/Loader.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: use App;",
          "4: use File;",
          "6: use Twig\\Source as TwigSource;",
          "7: use Twig\\Loader\\LoaderInterface as TwigLoaderInterface;",
          "8: use Exception;",
          "",
          "[Removed Lines]",
          "5: use View;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "16: class Loader implements TwigLoaderInterface",
          "17: {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "20:     protected $extension = 'htm';",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "33:             return $this->cache[$name];",
          "34:         }",
          "36:         $path = $finder->find($name);",
          "37:         return $this->cache[$name] = $path;",
          "38:     }",
          "40:     public function getSourceContext($name)",
          "41:     {",
          "43:     }",
          "45:     public function getCacheKey($name)",
          "",
          "[Removed Lines]",
          "42:         return new TwigSource((string) View::make($name), $name);",
          "",
          "[Added Lines]",
          "40:         $view = $name;",
          "41:         if (File::extension($view) === $this->extension) {",
          "42:             $view = substr($view, 0, -strlen($this->extension));",
          "43:         }",
          "51:         return new TwigSource(File::get($this->findTemplate($name)), $name);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "00849268ed2f3471729351b0224bbbe817f7f7d1",
      "candidate_info": {
        "commit_hash": "00849268ed2f3471729351b0224bbbe817f7f7d1",
        "repo": "octobercms/october",
        "commit_url": "https://github.com/octobercms/october/commit/00849268ed2f3471729351b0224bbbe817f7f7d1",
        "files": [
          "modules/backend/behaviors/ListController.php"
        ],
        "message": "Allow customised deletion messages in lists\n\nProvides the ability for developers to specify a custom message for bulk deletion actions, as well as a custom message when no records could be deleted due to missing selections or an altered query not finding any applicable records.",
        "before_after_code_files": [
          "modules/backend/behaviors/ListController.php||modules/backend/behaviors/ListController.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/octobercms/october/pull/5359"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "modules/backend/behaviors/ListController.php||modules/backend/behaviors/ListController.php": [
          "File: modules/backend/behaviors/ListController.php -> modules/backend/behaviors/ListController.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "297:             return call_user_func_array([$this->controller, 'onDelete'], func_get_args());",
          "298:         }",
          "",
          "[Removed Lines]",
          "303:         $checkedIds = post('checked');",
          "305:         if (!$checkedIds || !is_array($checkedIds) || !count($checkedIds)) {",
          "306:             Flash::error(Lang::get('backend::lang.list.delete_selected_empty'));",
          "307:             return $this->controller->listRefresh();",
          "308:         }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "319:         $listConfig = $this->controller->listGetConfig($definition);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "314:         $checkedIds = post('checked');",
          "316:         if (!$checkedIds || !is_array($checkedIds) || !count($checkedIds)) {",
          "317:             Flash::error(Lang::get(",
          "318:                 (!empty($listConfig->noRecordsDeletedMessage))",
          "319:                     ? $listConfig->noRecordsDeletedMessage",
          "320:                     : 'backend::lang.list.delete_selected_empty'",
          "321:             ));",
          "322:             return $this->controller->listRefresh();",
          "323:         }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "344:                 $record->delete();",
          "345:             }",
          "348:         }",
          "349:         else {",
          "351:         }",
          "353:         return $this->controller->listRefresh($definition);",
          "",
          "[Removed Lines]",
          "347:             Flash::success(Lang::get('backend::lang.list.delete_selected_success'));",
          "350:             Flash::error(Lang::get('backend::lang.list.delete_selected_empty'));",
          "",
          "[Added Lines]",
          "351:             Flash::success(Lang::get(",
          "352:                 (!empty($listConfig->deleteMessage))",
          "353:                     ? $listConfig->deleteMessage",
          "354:                     : 'backend::lang.list.delete_selected_success'",
          "355:             ));",
          "358:             Flash::error(Lang::get(",
          "359:                 (!empty($listConfig->noRecordsDeletedMessage))",
          "360:                     ? $listConfig->noRecordsDeletedMessage",
          "361:                     : 'backend::lang.list.delete_selected_empty'",
          "362:             ));",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "8a785e439395aa901d2b9d7bcb6a343a071c7870",
      "candidate_info": {
        "commit_hash": "8a785e439395aa901d2b9d7bcb6a343a071c7870",
        "repo": "octobercms/october",
        "commit_url": "https://github.com/octobercms/october/commit/8a785e439395aa901d2b9d7bcb6a343a071c7870",
        "files": [
          "modules/backend/ServiceProvider.php",
          "modules/system/ServiceProvider.php"
        ],
        "message": "Tightened up the default permissions granted to the \"Publisher\" system role out of the box",
        "before_after_code_files": [
          "modules/backend/ServiceProvider.php||modules/backend/ServiceProvider.php",
          "modules/system/ServiceProvider.php||modules/system/ServiceProvider.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/octobercms/october/pull/5359"
        ],
        "olp_code_files": {
          "patch": [
            "modules/backend/ServiceProvider.php||modules/backend/ServiceProvider.php",
            "modules/system/ServiceProvider.php||modules/system/ServiceProvider.php"
          ],
          "candidate": [
            "modules/backend/ServiceProvider.php||modules/backend/ServiceProvider.php",
            "modules/system/ServiceProvider.php||modules/system/ServiceProvider.php"
          ]
        }
      },
      "candidate_diff": {
        "modules/backend/ServiceProvider.php||modules/backend/ServiceProvider.php": [
          "File: modules/backend/ServiceProvider.php -> modules/backend/ServiceProvider.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "141:             $manager->registerPermissions('October.Backend', [",
          "142:                 'backend.access_dashboard' => [",
          "143:                     'label' => 'system::lang.permissions.view_the_dashboard',",
          "145:                 ],",
          "146:                 'backend.manage_default_dashboard' => [",
          "147:                     'label' => 'system::lang.permissions.manage_default_dashboard',",
          "148:                     'tab'   => 'system::lang.permissions.name',",
          "149:                 ],",
          "150:                 'backend.manage_users' => [",
          "151:                     'label' => 'system::lang.permissions.manage_other_administrators',",
          "153:                 ],",
          "154:                 'backend.impersonate_users' => [",
          "155:                     'label' => 'system::lang.permissions.impersonate_users',",
          "156:                     'tab'   => 'system::lang.permissions.name',",
          "157:                 ],",
          "158:                 'backend.manage_preferences' => [",
          "159:                     'label' => 'system::lang.permissions.manage_preferences',",
          "161:                 ],",
          "162:                 'backend.manage_editor' => [",
          "163:                     'label' => 'system::lang.permissions.manage_editor',",
          "165:                 ],",
          "166:                 'backend.manage_branding' => [",
          "167:                     'label' => 'system::lang.permissions.manage_branding',",
          "169:                 ],",
          "170:                 'media.manage_media' => [",
          "171:                     'label' => 'backend::lang.permissions.manage_media',",
          "",
          "[Removed Lines]",
          "144:                     'tab'   => 'system::lang.permissions.name'",
          "152:                     'tab'   => 'system::lang.permissions.name'",
          "160:                     'tab'   => 'system::lang.permissions.name'",
          "164:                     'tab'   => 'system::lang.permissions.name'",
          "168:                     'tab'   => 'system::lang.permissions.name'",
          "",
          "[Added Lines]",
          "144:                     'tab'   => 'system::lang.permissions.name',",
          "149:                     'roles' => UserRole::CODE_DEVELOPER,",
          "153:                     'tab'   => 'system::lang.permissions.name',",
          "154:                     'roles' => UserRole::CODE_DEVELOPER,",
          "159:                     'roles' => UserRole::CODE_DEVELOPER,",
          "163:                     'tab'   => 'system::lang.permissions.name',",
          "167:                     'tab'   => 'system::lang.permissions.name',",
          "171:                     'tab'   => 'system::lang.permissions.name',",
          "",
          "---------------"
        ],
        "modules/system/ServiceProvider.php||modules/system/ServiceProvider.php": [
          "File: modules/system/ServiceProvider.php -> modules/system/ServiceProvider.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "9: use Request;",
          "10: use BackendMenu;",
          "11: use BackendAuth;",
          "12: use Twig\\Extension\\SandboxExtension;",
          "13: use Twig\\Environment as TwigEnvironment;",
          "14: use System\\Classes\\MailManager;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "12: use Backend\\Models\\UserRole;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "420:             $manager->registerPermissions('October.System', [",
          "421:                 'system.manage_updates' => [",
          "422:                     'label' => 'system::lang.permissions.manage_software_updates',",
          "424:                 ],",
          "425:                 'system.access_logs' => [",
          "426:                     'label' => 'system::lang.permissions.access_logs',",
          "428:                 ],",
          "429:                 'system.manage_mail_settings' => [",
          "430:                     'label' => 'system::lang.permissions.manage_mail_settings',",
          "432:                 ],",
          "433:                 'system.manage_mail_templates' => [",
          "434:                     'label' => 'system::lang.permissions.manage_mail_templates',",
          "436:                 ]",
          "437:             ]);",
          "438:         });",
          "",
          "[Removed Lines]",
          "423:                     'tab' => 'system::lang.permissions.name'",
          "427:                     'tab' => 'system::lang.permissions.name'",
          "431:                     'tab' => 'system::lang.permissions.name'",
          "435:                     'tab' => 'system::lang.permissions.name'",
          "",
          "[Added Lines]",
          "424:                     'tab' => 'system::lang.permissions.name',",
          "425:                     'roles' => UserRole::CODE_DEVELOPER,",
          "429:                     'tab' => 'system::lang.permissions.name',",
          "430:                     'roles' => UserRole::CODE_DEVELOPER,",
          "434:                     'tab' => 'system::lang.permissions.name',",
          "435:                     'roles' => UserRole::CODE_DEVELOPER,",
          "439:                     'tab' => 'system::lang.permissions.name',",
          "440:                     'roles' => UserRole::CODE_DEVELOPER,",
          "",
          "---------------"
        ]
      }
    }
  ]
}