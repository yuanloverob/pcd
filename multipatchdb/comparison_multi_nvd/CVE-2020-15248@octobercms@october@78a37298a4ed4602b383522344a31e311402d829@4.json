{
  "cve_id": "CVE-2020-15248",
  "cve_desc": "October is a free, open-source, self-hosted CMS platform based on the Laravel PHP Framework. In October CMS from version 1.0.319 and before version 1.0.470, backend users with the default \"Publisher\" system role have access to create & manage users where they can choose which role the new user has. This means that a user with \"Publisher\" access has the ability to escalate their access to \"Developer\" access. Issue has been patched in Build 470 (v1.0.470) & v1.1.1.",
  "repo": "octobercms/october",
  "patch_hash": "78a37298a4ed4602b383522344a31e311402d829",
  "patch_info": {
    "commit_hash": "78a37298a4ed4602b383522344a31e311402d829",
    "repo": "octobercms/october",
    "commit_url": "https://github.com/octobercms/october/commit/78a37298a4ed4602b383522344a31e311402d829",
    "files": [
      "modules/backend/ServiceProvider.php",
      "modules/system/ServiceProvider.php"
    ],
    "message": "Tightened up the default permissions granted to the \"Publisher\" system role out of the box\n\n(cherry picked from commit 8a785e439395aa901d2b9d7bcb6a343a071c7870)",
    "before_after_code_files": [
      "modules/backend/ServiceProvider.php||modules/backend/ServiceProvider.php",
      "modules/system/ServiceProvider.php||modules/system/ServiceProvider.php"
    ]
  },
  "patch_diff": {
    "modules/backend/ServiceProvider.php||modules/backend/ServiceProvider.php": [
      "File: modules/backend/ServiceProvider.php -> modules/backend/ServiceProvider.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "140:             $manager->registerPermissions('October.Backend', [",
      "141:                 'backend.access_dashboard' => [",
      "142:                     'label' => 'system::lang.permissions.view_the_dashboard',",
      "144:                 ],",
      "145:                 'backend.manage_default_dashboard' => [",
      "146:                     'label' => 'system::lang.permissions.manage_default_dashboard',",
      "147:                     'tab'   => 'system::lang.permissions.name',",
      "148:                 ],",
      "149:                 'backend.manage_users' => [",
      "150:                     'label' => 'system::lang.permissions.manage_other_administrators',",
      "152:                 ],",
      "153:                 'backend.impersonate_users' => [",
      "154:                     'label' => 'system::lang.permissions.impersonate_users',",
      "155:                     'tab'   => 'system::lang.permissions.name',",
      "156:                 ],",
      "157:                 'backend.manage_preferences' => [",
      "158:                     'label' => 'system::lang.permissions.manage_preferences',",
      "160:                 ],",
      "161:                 'backend.manage_editor' => [",
      "162:                     'label' => 'system::lang.permissions.manage_editor',",
      "164:                 ],",
      "165:                 'backend.manage_branding' => [",
      "166:                     'label' => 'system::lang.permissions.manage_branding',",
      "168:                 ],",
      "169:                 'media.manage_media' => [",
      "170:                     'label' => 'backend::lang.permissions.manage_media',",
      "",
      "[Removed Lines]",
      "143:                     'tab'   => 'system::lang.permissions.name'",
      "151:                     'tab'   => 'system::lang.permissions.name'",
      "159:                     'tab'   => 'system::lang.permissions.name'",
      "163:                     'tab'   => 'system::lang.permissions.name'",
      "167:                     'tab'   => 'system::lang.permissions.name'",
      "",
      "[Added Lines]",
      "143:                     'tab'   => 'system::lang.permissions.name',",
      "148:                     'roles' => UserRole::CODE_DEVELOPER,",
      "152:                     'tab'   => 'system::lang.permissions.name',",
      "153:                     'roles' => UserRole::CODE_DEVELOPER,",
      "158:                     'roles' => UserRole::CODE_DEVELOPER,",
      "162:                     'tab'   => 'system::lang.permissions.name',",
      "166:                     'tab'   => 'system::lang.permissions.name',",
      "170:                     'tab'   => 'system::lang.permissions.name',",
      "",
      "---------------"
    ],
    "modules/system/ServiceProvider.php||modules/system/ServiceProvider.php": [
      "File: modules/system/ServiceProvider.php -> modules/system/ServiceProvider.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "9: use Request;",
      "10: use BackendMenu;",
      "11: use BackendAuth;",
      "12: use Twig\\Extension\\SandboxExtension;",
      "13: use Twig\\Environment as TwigEnvironment;",
      "14: use System\\Classes\\MailManager;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "12: use Backend\\Models\\UserRole;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "417:             $manager->registerPermissions('October.System', [",
      "418:                 'system.manage_updates' => [",
      "419:                     'label' => 'system::lang.permissions.manage_software_updates',",
      "421:                 ],",
      "422:                 'system.access_logs' => [",
      "423:                     'label' => 'system::lang.permissions.access_logs',",
      "425:                 ],",
      "426:                 'system.manage_mail_settings' => [",
      "427:                     'label' => 'system::lang.permissions.manage_mail_settings',",
      "429:                 ],",
      "430:                 'system.manage_mail_templates' => [",
      "431:                     'label' => 'system::lang.permissions.manage_mail_templates',",
      "433:                 ]",
      "434:             ]);",
      "435:         });",
      "",
      "[Removed Lines]",
      "420:                     'tab' => 'system::lang.permissions.name'",
      "424:                     'tab' => 'system::lang.permissions.name'",
      "428:                     'tab' => 'system::lang.permissions.name'",
      "432:                     'tab' => 'system::lang.permissions.name'",
      "",
      "[Added Lines]",
      "421:                     'tab' => 'system::lang.permissions.name',",
      "422:                     'roles' => UserRole::CODE_DEVELOPER,",
      "426:                     'tab' => 'system::lang.permissions.name',",
      "427:                     'roles' => UserRole::CODE_DEVELOPER,",
      "431:                     'tab' => 'system::lang.permissions.name',",
      "432:                     'roles' => UserRole::CODE_DEVELOPER,",
      "436:                     'tab' => 'system::lang.permissions.name',",
      "437:                     'roles' => UserRole::CODE_DEVELOPER,",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "a9a2c6e83b2d2455c62640075f5833ae953b7b02",
      "candidate_info": {
        "commit_hash": "a9a2c6e83b2d2455c62640075f5833ae953b7b02",
        "repo": "octobercms/october",
        "commit_url": "https://github.com/octobercms/october/commit/a9a2c6e83b2d2455c62640075f5833ae953b7b02",
        "files": [
          "modules/backend/layouts/_custom_styles.htm"
        ],
        "message": "Improve handling of custom editor styles in the backend",
        "before_after_code_files": [
          "modules/backend/layouts/_custom_styles.htm||modules/backend/layouts/_custom_styles.htm"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/octobercms/october/pull/5359"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "modules/backend/layouts/_custom_styles.htm||modules/backend/layouts/_custom_styles.htm": [
          "File: modules/backend/layouts/_custom_styles.htm -> modules/backend/layouts/_custom_styles.htm",
          "--- Hunk 1 ---",
          "[Context before]",
          "9: <?php endif ?>",
          "10: <?php if (EditorSetting::isConfigured()): ?>",
          "11:     <style>",
          "13:     </style>",
          "14: <?php endif ?>",
          "",
          "[Removed Lines]",
          "12:         <?= EditorSetting::renderCss() ?>",
          "",
          "[Added Lines]",
          "12:         <?= strip_tags(EditorSetting::renderCss()) ?>",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "fe2ca6c15eb04345448dd0674af4c5c8eb8ea8a8",
      "candidate_info": {
        "commit_hash": "fe2ca6c15eb04345448dd0674af4c5c8eb8ea8a8",
        "repo": "octobercms/october",
        "commit_url": "https://github.com/octobercms/october/commit/fe2ca6c15eb04345448dd0674af4c5c8eb8ea8a8",
        "files": [
          "modules/system/classes/ImageResizer.php"
        ],
        "message": "Fix issue where resized images were not correctly identified as already having been resized when atomic (blue/green) deployment strategies are used in conjunction with files being stored on the local filesystem in a shared symlinked storage folder.",
        "before_after_code_files": [
          "modules/system/classes/ImageResizer.php||modules/system/classes/ImageResizer.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/octobercms/october/pull/5359"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "modules/system/classes/ImageResizer.php||modules/system/classes/ImageResizer.php": [
          "File: modules/system/classes/ImageResizer.php -> modules/system/classes/ImageResizer.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "220:     public function getConfig()",
          "221:     {",
          "222:         $config = [",
          "223:             'image' => [",
          "225:                 'path' => $this->image['path'],",
          "226:                 'source' => $this->image['source'],",
          "227:             ],",
          "",
          "[Removed Lines]",
          "224:                 'disk' => $this->image['disk'],",
          "",
          "[Added Lines]",
          "222:         $disk = $this->image['disk'];",
          "227:         if (FileHelper::isLocalDisk($disk)) {",
          "228:             $realPath = realpath($disk->getAdapter()->getPathPrefix());",
          "229:             if ($realPath) {",
          "230:                 $disk->getAdapter()->setPathPrefix($realPath);",
          "231:             }",
          "232:         }",
          "236:                 'disk' => $disk,",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "e7b1862c441b8984a704bfd4c2e1e08b54de9b38",
      "candidate_info": {
        "commit_hash": "e7b1862c441b8984a704bfd4c2e1e08b54de9b38",
        "repo": "octobercms/october",
        "commit_url": "https://github.com/octobercms/october/commit/e7b1862c441b8984a704bfd4c2e1e08b54de9b38",
        "files": [
          "tests/fixtures/plugins/october/tester/updates/drop_blog_settings_table.php",
          "tests/fixtures/plugins/october/tester/updates/version.yaml",
          "tests/unit/system/classes/VersionManagerTest.php"
        ],
        "message": "Add unit tests for #5271",
        "before_after_code_files": [
          "tests/unit/system/classes/VersionManagerTest.php||tests/unit/system/classes/VersionManagerTest.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/octobercms/october/pull/5359"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "tests/unit/system/classes/VersionManagerTest.php||tests/unit/system/classes/VersionManagerTest.php": [
          "File: tests/unit/system/classes/VersionManagerTest.php -> tests/unit/system/classes/VersionManagerTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "24:         $result = self::callProtectedMethod($manager, 'getLatestFileVersion', ['\\October\\\\Tester']);",
          "26:         $this->assertNotNull($result);",
          "28:     }",
          "30:     public function testGetFileVersions()",
          "",
          "[Removed Lines]",
          "27:         $this->assertEquals('1.0.5', $result);",
          "",
          "[Added Lines]",
          "27:         $this->assertEquals('1.2.0', $result);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "32:         $manager = VersionManager::instance();",
          "33:         $result = self::callProtectedMethod($manager, 'getFileVersions', ['\\October\\\\Tester']);",
          "36:         $this->assertArrayHasKey('1.0.1', $result);",
          "37:         $this->assertArrayHasKey('1.0.2', $result);",
          "38:         $this->assertArrayHasKey('1.0.3', $result);",
          "39:         $this->assertArrayHasKey('1.0.4', $result);",
          "40:         $this->assertArrayHasKey('1.0.5', $result);",
          "42:         $sample = $result['1.0.1'];",
          "",
          "[Removed Lines]",
          "35:         $this->assertCount(5, $result);",
          "43:         $comment = array_shift($sample);",
          "44:         $this->assertEquals(\"Added some upgrade file and some seeding\", $comment);",
          "",
          "[Added Lines]",
          "35:         $this->assertCount(7, $result);",
          "41:         $this->assertArrayHasKey('1.1.0', $result);",
          "42:         $this->assertArrayHasKey('1.2.0', $result);",
          "45:         $this->assertEquals('Added some upgrade file and some seeding', $sample[0]);",
          "47:         $sample = $result['1.1.0'];",
          "48:         $this->assertEquals('!!! Drop support for blog settings', $sample[0]);",
          "49:         $this->assertEquals('drop_blog_settings_table.php', $sample[1]);",
          "51:         $sample = $result['1.2.0'];",
          "52:         $this->assertEquals('!!! Security update - see: https://octobercms.com', $sample[0]);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "70:         $manager = VersionManager::instance();",
          "71:         $result = self::callProtectedMethod($manager, 'getNewFileVersions', ['\\October\\\\Tester', '1.0.3']);",
          "74:         $this->assertArrayHasKey('1.0.4', $result);",
          "75:         $this->assertArrayHasKey('1.0.5', $result);",
          "",
          "[Removed Lines]",
          "73:         $this->assertCount(2, $result);",
          "",
          "[Added Lines]",
          "81:         $this->assertCount(4, $result);",
          "84:         $this->assertArrayHasKey('1.1.0', $result);",
          "85:         $this->assertArrayHasKey('1.2.0', $result);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "80:         $manager = VersionManager::instance();",
          "81:         $result = self::callProtectedMethod($manager, 'getNewFileVersions', ['\\October\\\\Tester']);",
          "84:         $this->assertArrayHasKey('1.0.1', $result);",
          "85:         $this->assertArrayHasKey('1.0.2', $result);",
          "86:         $this->assertArrayHasKey('1.0.3', $result);",
          "87:         $this->assertArrayHasKey('1.0.4', $result);",
          "88:         $this->assertArrayHasKey('1.0.5', $result);",
          "89:     }",
          "",
          "[Removed Lines]",
          "83:         $this->assertCount(5, $result);",
          "",
          "[Added Lines]",
          "93:         $this->assertCount(7, $result);",
          "99:         $this->assertArrayHasKey('1.1.0', $result);",
          "100:         $this->assertArrayHasKey('1.2.0', $result);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "fbb470c7eee87cc5a5afb8cb6a83d476094df445",
      "candidate_info": {
        "commit_hash": "fbb470c7eee87cc5a5afb8cb6a83d476094df445",
        "repo": "octobercms/october",
        "commit_url": "https://github.com/octobercms/october/commit/fbb470c7eee87cc5a5afb8cb6a83d476094df445",
        "files": [
          "modules/system/controllers/Updates.php"
        ],
        "message": "UX improvements for managing plugins.\n\nFixes #5127, also will force a page reload after changing the status of a plugin (remove, disable, enable, etc) so that the menu structure is accurately reflected.",
        "before_after_code_files": [
          "modules/system/controllers/Updates.php||modules/system/controllers/Updates.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/octobercms/october/pull/5359"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "modules/system/controllers/Updates.php||modules/system/controllers/Updates.php": [
          "File: modules/system/controllers/Updates.php -> modules/system/controllers/Updates.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "455:     {",
          "456:         try {",
          "457:             $manager = UpdateManager::instance();",
          "460:             $coreHash = array_get($result, 'core.hash', false);",
          "461:             $coreBuild = array_get($result, 'core.build', false);",
          "",
          "[Removed Lines]",
          "454:     public function onForceUpdate()",
          "458:             $result = $manager->requestUpdateList(true);",
          "",
          "[Added Lines]",
          "457:     public function onForceUpdate($force = true)",
          "461:             $result = $manager->requestUpdateList($force);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "706:                 'system::project.owner' => $result['owner'],",
          "707:             ]);",
          "710:         }",
          "711:         catch (Exception $ex) {",
          "712:             $this->handleError($ex);",
          "",
          "[Removed Lines]",
          "709:             return $this->onForceUpdate();",
          "",
          "[Added Lines]",
          "712:             return $this->onForceUpdate(false);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "878:         }",
          "880:         Flash::success(Lang::get(\"system::lang.plugins.{$bulkAction}_success\"));",
          "882:     }",
          "",
          "[Removed Lines]",
          "881:         return $this->listRefresh('manage');",
          "",
          "[Added Lines]",
          "884:         return redirect()->refresh();",
          "",
          "---------------"
        ]
      }
    }
  ]
}