{
  "cve_id": "CVE-2023-39533",
  "cve_desc": "go-libp2p is the Go implementation of the libp2p Networking Stack. Prior to versions 0.27.8, 0.28.2, and 0.29.1 malicious peer can use large RSA keys to run a resource exhaustion attack & force a node to spend time doing signature verification of the large key. This vulnerability is present in the core/crypto module of go-libp2p and can occur during the Noise handshake and the libp2p x509 extension verification step. To prevent this attack, go-libp2p versions 0.27.8, 0.28.2, and 0.29.1 restrict RSA keys to <= 8192 bits. To protect one's application, it is necessary to update to these patch releases and to use the updated Go compiler in 1.20.7 or 1.19.12. There are no known workarounds for this issue.",
  "repo": "libp2p/go-libp2p",
  "patch_hash": "445be526aea4ee0b1fa5388aa65d32b2816d3a00",
  "patch_info": {
    "commit_hash": "445be526aea4ee0b1fa5388aa65d32b2816d3a00",
    "repo": "libp2p/go-libp2p",
    "commit_url": "https://github.com/libp2p/go-libp2p/commit/445be526aea4ee0b1fa5388aa65d32b2816d3a00",
    "files": [
      "core/crypto/rsa_common.go",
      "core/crypto/rsa_go.go",
      "core/crypto/rsa_test.go"
    ],
    "message": "core/crypto: restrict RSA keys to <= 8192 bits (#2454)\n\n* Error if RSA key is too big\n\n* Update core/crypto/rsa_common.go\n\nCo-authored-by: Marten Seemann <martenseemann@gmail.com>\n\n* Update core/crypto/rsa_common.go\n\nCo-authored-by: Marten Seemann <martenseemann@gmail.com>\n\n* Fix rename\n\n* Make this var again so the tests work\n\n---------\n\nCo-authored-by: Marten Seemann <martenseemann@gmail.com>",
    "before_after_code_files": [
      "core/crypto/rsa_common.go||core/crypto/rsa_common.go",
      "core/crypto/rsa_go.go||core/crypto/rsa_go.go",
      "core/crypto/rsa_test.go||core/crypto/rsa_test.go"
    ]
  },
  "patch_diff": {
    "core/crypto/rsa_common.go||core/crypto/rsa_common.go": [
      "File: core/crypto/rsa_common.go -> core/crypto/rsa_common.go",
      "--- Hunk 1 ---",
      "[Context before]",
      "13: var MinRsaKeyBits = 2048",
      "17: var ErrRsaKeyTooSmall error",
      "19: func init() {",
      "20:  if _, ok := os.LookupEnv(WeakRsaKeyEnv); ok {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "15: var maxRsaKeyBits = 8192",
      "20: var ErrRsaKeyTooBig error = fmt.Errorf(\"rsa keys must be <= %d bits\", maxRsaKeyBits)",
      "",
      "---------------"
    ],
    "core/crypto/rsa_go.go||core/crypto/rsa_go.go": [
      "File: core/crypto/rsa_go.go -> core/crypto/rsa_go.go",
      "--- Hunk 1 ---",
      "[Context before]",
      "31:  if bits < MinRsaKeyBits {",
      "32:   return nil, nil, ErrRsaKeyTooSmall",
      "33:  }",
      "34:  priv, err := rsa.GenerateKey(src, bits)",
      "35:  if err != nil {",
      "36:   return nil, nil, err",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "34:  if bits > maxRsaKeyBits {",
      "35:   return nil, nil, ErrRsaKeyTooBig",
      "36:  }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "124:  if sk.N.BitLen() < MinRsaKeyBits {",
      "125:   return nil, ErrRsaKeyTooSmall",
      "126:  }",
      "127:  return &RsaPrivateKey{sk: *sk}, nil",
      "128: }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "130:  if sk.N.BitLen() > maxRsaKeyBits {",
      "131:   return nil, ErrRsaKeyTooBig",
      "132:  }",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "141:  if pk.N.BitLen() < MinRsaKeyBits {",
      "142:   return nil, ErrRsaKeyTooSmall",
      "143:  }",
      "145:  return &RsaPublicKey{k: *pk}, nil",
      "146: }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "150:  if pk.N.BitLen() > maxRsaKeyBits {",
      "151:   return nil, ErrRsaKeyTooBig",
      "152:  }",
      "",
      "---------------"
    ],
    "core/crypto/rsa_test.go||core/crypto/rsa_test.go": [
      "File: core/crypto/rsa_test.go -> core/crypto/rsa_test.go",
      "--- Hunk 1 ---",
      "[Context before]",
      "68:  }",
      "69: }",
      "71: func TestRSASignZero(t *testing.T) {",
      "72:  priv, pub, err := GenerateRSAKeyPair(2048, rand.Reader)",
      "73:  if err != nil {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "71: func TestRSABigKeyFailsToGenerate(t *testing.T) {",
      "72:  _, _, err := GenerateRSAKeyPair(maxRsaKeyBits*2, rand.Reader)",
      "73:  if err != ErrRsaKeyTooBig {",
      "74:   t.Fatal(\"should have refused to create too big RSA key\")",
      "75:  }",
      "76: }",
      "78: func TestRSABigKey(t *testing.T) {",
      "81:  origSize := maxRsaKeyBits",
      "82:  maxRsaKeyBits = 2048",
      "83:  defer func() { maxRsaKeyBits = origSize }() //",
      "85:  maxRsaKeyBits *= 2",
      "86:  badPriv, badPub, err := GenerateRSAKeyPair(maxRsaKeyBits, rand.Reader)",
      "87:  if err != nil {",
      "88:   t.Fatalf(\"should have succeeded, got: %s\", err)",
      "89:  }",
      "90:  pubBytes, err := MarshalPublicKey(badPub)",
      "91:  if err != nil {",
      "92:   t.Fatal(err)",
      "93:  }",
      "94:  privBytes, err := MarshalPrivateKey(badPriv)",
      "95:  if err != nil {",
      "96:   t.Fatal(err)",
      "97:  }",
      "98:  maxRsaKeyBits /= 2",
      "99:  _, err = UnmarshalPublicKey(pubBytes)",
      "100:  if err != ErrRsaKeyTooBig {",
      "101:   t.Fatal(\"should have refused to unmarshal a too big key\")",
      "102:  }",
      "103:  _, err = UnmarshalPrivateKey(privBytes)",
      "104:  if err != ErrRsaKeyTooBig {",
      "105:   t.Fatal(\"should have refused to unmarshal a too big key\")",
      "106:  }",
      "107: }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "b6adf15423ca2d9092aa0176661a439e53be186c",
      "candidate_info": {
        "commit_hash": "b6adf15423ca2d9092aa0176661a439e53be186c",
        "repo": "libp2p/go-libp2p",
        "commit_url": "https://github.com/libp2p/go-libp2p/commit/b6adf15423ca2d9092aa0176661a439e53be186c",
        "files": [
          "go.mod",
          "go.sum",
          "test-plans/go.mod",
          "test-plans/go.sum"
        ],
        "message": "manually bump qtls dependencies to fix RSA key size vulnerability",
        "before_after_code_files": [
          "go.mod||go.mod",
          "go.sum||go.sum",
          "test-plans/go.mod||test-plans/go.mod",
          "test-plans/go.sum||test-plans/go.sum"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/libp2p/go-libp2p/pull/2457"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "go.mod||go.mod": [
          "File: go.mod -> go.mod",
          "--- Hunk 1 ---",
          "[Context before]",
          "102:  github.com/prometheus/common v0.37.0 // indirect",
          "103:  github.com/prometheus/procfs v0.8.0 // indirect",
          "104:  github.com/quic-go/qpack v0.4.0 // indirect",
          "107:  github.com/spaolacci/murmur3 v1.1.0 // indirect",
          "108:  github.com/syndtr/goleveldb v1.0.0 // indirect",
          "109:  go.uber.org/atomic v1.11.0 // indirect",
          "",
          "[Removed Lines]",
          "105:  github.com/quic-go/qtls-go1-19 v0.3.2 // indirect",
          "106:  github.com/quic-go/qtls-go1-20 v0.2.2 // indirect",
          "",
          "[Added Lines]",
          "105:  github.com/quic-go/qtls-go1-19 v0.3.3 // indirect",
          "106:  github.com/quic-go/qtls-go1-20 v0.2.3 // indirect",
          "",
          "---------------"
        ],
        "go.sum||go.sum": [
          "File: go.sum -> go.sum",
          "--- Hunk 1 ---",
          "[Context before]",
          "432: github.com/prometheus/procfs v0.8.0/go.mod h1:z7EfXMXOkbkqb9IINtpCn86r/to3BnA0uaxHdg830/4=",
          "433: github.com/quic-go/qpack v0.4.0 h1:Cr9BXA1sQS2SmDUWjSofMPNKmvF6IiIfDRmgU0w1ZCo=",
          "434: github.com/quic-go/qpack v0.4.0/go.mod h1:UZVnYIfi5GRk+zI9UMaCPsmZ2xKJP7XBUvVyT1Knj9A=",
          "439: github.com/quic-go/quic-go v0.33.0 h1:ItNoTDN/Fm/zBlq769lLJc8ECe9gYaW40veHCCco7y0=",
          "440: github.com/quic-go/quic-go v0.33.0/go.mod h1:YMuhaAV9/jIu0XclDXwZPAsP/2Kgr5yMYhe9oxhhOFA=",
          "441: github.com/quic-go/webtransport-go v0.5.3 h1:5XMlzemqB4qmOlgIus5zB45AcZ2kCgCy2EptUrfOPWU=",
          "",
          "[Removed Lines]",
          "435: github.com/quic-go/qtls-go1-19 v0.3.2 h1:tFxjCFcTQzK+oMxG6Zcvp4Dq8dx4yD3dDiIiyc86Z5U=",
          "436: github.com/quic-go/qtls-go1-19 v0.3.2/go.mod h1:ySOI96ew8lnoKPtSqx2BlI5wCpUVPT05RMAlajtnyOI=",
          "437: github.com/quic-go/qtls-go1-20 v0.2.2 h1:WLOPx6OY/hxtTxKV1Zrq20FtXtDEkeY00CGQm8GEa3E=",
          "438: github.com/quic-go/qtls-go1-20 v0.2.2/go.mod h1:JKtK6mjbAVcUTN/9jZpvLbGxvdWIKS8uT7EiStoU1SM=",
          "",
          "[Added Lines]",
          "435: github.com/quic-go/qtls-go1-19 v0.3.3 h1:wznEHvJwd+2X3PqftRha0SUKmGsnb6dfArMhy9PeJVE=",
          "436: github.com/quic-go/qtls-go1-19 v0.3.3/go.mod h1:ySOI96ew8lnoKPtSqx2BlI5wCpUVPT05RMAlajtnyOI=",
          "437: github.com/quic-go/qtls-go1-20 v0.2.3 h1:m575dovXn1y2ATOb1XrRFcrv0F+EQmlowTkoraNkDPI=",
          "438: github.com/quic-go/qtls-go1-20 v0.2.3/go.mod h1:JKtK6mjbAVcUTN/9jZpvLbGxvdWIKS8uT7EiStoU1SM=",
          "",
          "---------------"
        ],
        "test-plans/go.mod||test-plans/go.mod": [
          "File: test-plans/go.mod -> test-plans/go.mod",
          "--- Hunk 1 ---",
          "[Context before]",
          "73:  github.com/prometheus/common v0.44.0 // indirect",
          "74:  github.com/prometheus/procfs v0.10.1 // indirect",
          "75:  github.com/quic-go/qpack v0.4.0 // indirect",
          "78:  github.com/quic-go/quic-go v0.33.0 // indirect",
          "79:  github.com/quic-go/webtransport-go v0.5.3 // indirect",
          "80:  github.com/raulk/go-watchdog v1.3.0 // indirect",
          "",
          "[Removed Lines]",
          "76:  github.com/quic-go/qtls-go1-19 v0.3.2 // indirect",
          "77:  github.com/quic-go/qtls-go1-20 v0.2.2 // indirect",
          "",
          "[Added Lines]",
          "76:  github.com/quic-go/qtls-go1-19 v0.3.3 // indirect",
          "77:  github.com/quic-go/qtls-go1-20 v0.2.3 // indirect",
          "",
          "---------------"
        ],
        "test-plans/go.sum||test-plans/go.sum": [
          "File: test-plans/go.sum -> test-plans/go.sum",
          "--- Hunk 1 ---",
          "[Context before]",
          "238: github.com/prometheus/procfs v0.10.1/go.mod h1:nwNm2aOCAYw8uTR/9bWRREkZFxAUcWzPHWJq+XBB/FM=",
          "239: github.com/quic-go/qpack v0.4.0 h1:Cr9BXA1sQS2SmDUWjSofMPNKmvF6IiIfDRmgU0w1ZCo=",
          "240: github.com/quic-go/qpack v0.4.0/go.mod h1:UZVnYIfi5GRk+zI9UMaCPsmZ2xKJP7XBUvVyT1Knj9A=",
          "245: github.com/quic-go/quic-go v0.33.0 h1:ItNoTDN/Fm/zBlq769lLJc8ECe9gYaW40veHCCco7y0=",
          "246: github.com/quic-go/quic-go v0.33.0/go.mod h1:YMuhaAV9/jIu0XclDXwZPAsP/2Kgr5yMYhe9oxhhOFA=",
          "247: github.com/quic-go/webtransport-go v0.5.3 h1:5XMlzemqB4qmOlgIus5zB45AcZ2kCgCy2EptUrfOPWU=",
          "",
          "[Removed Lines]",
          "241: github.com/quic-go/qtls-go1-19 v0.3.2 h1:tFxjCFcTQzK+oMxG6Zcvp4Dq8dx4yD3dDiIiyc86Z5U=",
          "242: github.com/quic-go/qtls-go1-19 v0.3.2/go.mod h1:ySOI96ew8lnoKPtSqx2BlI5wCpUVPT05RMAlajtnyOI=",
          "243: github.com/quic-go/qtls-go1-20 v0.2.2 h1:WLOPx6OY/hxtTxKV1Zrq20FtXtDEkeY00CGQm8GEa3E=",
          "244: github.com/quic-go/qtls-go1-20 v0.2.2/go.mod h1:JKtK6mjbAVcUTN/9jZpvLbGxvdWIKS8uT7EiStoU1SM=",
          "",
          "[Added Lines]",
          "241: github.com/quic-go/qtls-go1-19 v0.3.3 h1:wznEHvJwd+2X3PqftRha0SUKmGsnb6dfArMhy9PeJVE=",
          "242: github.com/quic-go/qtls-go1-19 v0.3.3/go.mod h1:ySOI96ew8lnoKPtSqx2BlI5wCpUVPT05RMAlajtnyOI=",
          "243: github.com/quic-go/qtls-go1-20 v0.2.3 h1:m575dovXn1y2ATOb1XrRFcrv0F+EQmlowTkoraNkDPI=",
          "244: github.com/quic-go/qtls-go1-20 v0.2.3/go.mod h1:JKtK6mjbAVcUTN/9jZpvLbGxvdWIKS8uT7EiStoU1SM=",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "cd68d43cbcd3b5529fb887aa058e68ce7ff018ae",
      "candidate_info": {
        "commit_hash": "cd68d43cbcd3b5529fb887aa058e68ce7ff018ae",
        "repo": "libp2p/go-libp2p",
        "commit_url": "https://github.com/libp2p/go-libp2p/commit/cd68d43cbcd3b5529fb887aa058e68ce7ff018ae",
        "files": [
          "p2p/net/swarm/swarm.go",
          "p2p/test/basichost/basic_host_test.go"
        ],
        "message": "swarm: don't open new streams over transient connections (#2450)",
        "before_after_code_files": [
          "p2p/net/swarm/swarm.go||p2p/net/swarm/swarm.go",
          "p2p/test/basichost/basic_host_test.go||p2p/test/basichost/basic_host_test.go"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/libp2p/go-libp2p/pull/2457"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "p2p/net/swarm/swarm.go||p2p/net/swarm/swarm.go": [
          "File: p2p/net/swarm/swarm.go -> p2p/net/swarm/swarm.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "706:  c.metricsTracer.ClosedConnection(c.dir, time.Since(c.opened), c.ConnState(), c.LocalMultiaddr())",
          "707:  return c.CapableConn.Close()",
          "708: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "710: func (c connWithMetrics) Stat() network.ConnStats {",
          "711:  if cs, ok := c.CapableConn.(network.ConnStat); ok {",
          "712:   return cs.Stat()",
          "713:  }",
          "714:  return network.ConnStats{}",
          "715: }",
          "717: var _ network.ConnStat = connWithMetrics{}",
          "",
          "---------------"
        ],
        "p2p/test/basichost/basic_host_test.go||p2p/test/basichost/basic_host_test.go": [
          "File: p2p/test/basichost/basic_host_test.go -> p2p/test/basichost/basic_host_test.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: package basichost",
          "3: import (",
          "4:  \"context\"",
          "5:  \"fmt\"",
          "6:  \"testing\"",
          "8:  \"github.com/libp2p/go-libp2p\"",
          "9:  \"github.com/libp2p/go-libp2p/core/network\"",
          "10:  \"github.com/libp2p/go-libp2p/core/peer\"",
          "11:  \"github.com/libp2p/go-libp2p/p2p/protocol/circuitv2/client\"",
          "12:  \"github.com/libp2p/go-libp2p/p2p/protocol/circuitv2/relay\"",
          "13:  ma \"github.com/multiformats/go-multiaddr\"",
          "14:  \"github.com/stretchr/testify/require\"",
          "15: )",
          "17: func TestNoStreamOverTransientConnection(t *testing.T) {",
          "18:  h1, err := libp2p.New(",
          "19:   libp2p.NoListenAddrs,",
          "20:   libp2p.EnableRelay(),",
          "21:  )",
          "22:  require.NoError(t, err)",
          "24:  h2, err := libp2p.New(",
          "25:   libp2p.NoListenAddrs,",
          "26:   libp2p.EnableRelay(),",
          "27:  )",
          "28:  require.NoError(t, err)",
          "30:  relay1, err := libp2p.New()",
          "31:  require.NoError(t, err)",
          "33:  _, err = relay.New(relay1)",
          "34:  require.NoError(t, err)",
          "36:  relay1info := peer.AddrInfo{",
          "37:   ID:    relay1.ID(),",
          "38:   Addrs: relay1.Addrs(),",
          "39:  }",
          "40:  err = h1.Connect(context.Background(), relay1info)",
          "41:  require.NoError(t, err)",
          "43:  err = h2.Connect(context.Background(), relay1info)",
          "44:  require.NoError(t, err)",
          "46:  h2.SetStreamHandler(\"/testprotocol\", func(s network.Stream) {",
          "47:   fmt.Println(\"testprotocol\")",
          "50:   s.Close()",
          "51:  })",
          "53:  _, err = client.Reserve(context.Background(), h2, relay1info)",
          "54:  require.NoError(t, err)",
          "56:  relayaddr := ma.StringCast(\"/p2p/\" + relay1info.ID.String() + \"/p2p-circuit/p2p/\" + h2.ID().String())",
          "58:  h2Info := peer.AddrInfo{",
          "59:   ID:    h2.ID(),",
          "60:   Addrs: []ma.Multiaddr{relayaddr},",
          "61:  }",
          "62:  err = h1.Connect(context.Background(), h2Info)",
          "63:  require.NoError(t, err)",
          "65:  ctx := network.WithNoDial(context.Background(), \"test\")",
          "66:  _, err = h1.NewStream(ctx, h2.ID(), \"/testprotocol\")",
          "68:  require.ErrorIs(t, err, network.ErrTransientConn)",
          "70:  _, err = h1.NewStream(network.WithUseTransient(context.Background(), \"test\"), h2.ID(), \"/testprotocol\")",
          "71:  require.NoError(t, err)",
          "72: }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "71a4e3e70f6a17c789298f1e660182e5bba6a3b3",
      "candidate_info": {
        "commit_hash": "71a4e3e70f6a17c789298f1e660182e5bba6a3b3",
        "repo": "libp2p/go-libp2p",
        "commit_url": "https://github.com/libp2p/go-libp2p/commit/71a4e3e70f6a17c789298f1e660182e5bba6a3b3",
        "files": [
          "go.mod",
          "go.sum",
          "test-plans/go.mod",
          "test-plans/go.sum"
        ],
        "message": "manually bump qtls dependencies to fix RSA key size vulnerability",
        "before_after_code_files": [
          "go.mod||go.mod",
          "go.sum||go.sum",
          "test-plans/go.mod||test-plans/go.mod",
          "test-plans/go.sum||test-plans/go.sum"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/libp2p/go-libp2p/pull/2457"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "go.mod||go.mod": [
          "File: go.mod -> go.mod",
          "--- Hunk 1 ---",
          "[Context before]",
          "102:  github.com/prometheus/common v0.37.0 // indirect",
          "103:  github.com/prometheus/procfs v0.8.0 // indirect",
          "104:  github.com/quic-go/qpack v0.4.0 // indirect",
          "107:  github.com/spaolacci/murmur3 v1.1.0 // indirect",
          "108:  github.com/syndtr/goleveldb v1.0.0 // indirect",
          "109:  go.uber.org/atomic v1.11.0 // indirect",
          "",
          "[Removed Lines]",
          "105:  github.com/quic-go/qtls-go1-19 v0.3.2 // indirect",
          "106:  github.com/quic-go/qtls-go1-20 v0.2.2 // indirect",
          "",
          "[Added Lines]",
          "105:  github.com/quic-go/qtls-go1-19 v0.3.3 // indirect",
          "106:  github.com/quic-go/qtls-go1-20 v0.2.3 // indirect",
          "",
          "---------------"
        ],
        "go.sum||go.sum": [
          "File: go.sum -> go.sum",
          "--- Hunk 1 ---",
          "[Context before]",
          "432: github.com/prometheus/procfs v0.8.0/go.mod h1:z7EfXMXOkbkqb9IINtpCn86r/to3BnA0uaxHdg830/4=",
          "433: github.com/quic-go/qpack v0.4.0 h1:Cr9BXA1sQS2SmDUWjSofMPNKmvF6IiIfDRmgU0w1ZCo=",
          "434: github.com/quic-go/qpack v0.4.0/go.mod h1:UZVnYIfi5GRk+zI9UMaCPsmZ2xKJP7XBUvVyT1Knj9A=",
          "439: github.com/quic-go/quic-go v0.33.0 h1:ItNoTDN/Fm/zBlq769lLJc8ECe9gYaW40veHCCco7y0=",
          "440: github.com/quic-go/quic-go v0.33.0/go.mod h1:YMuhaAV9/jIu0XclDXwZPAsP/2Kgr5yMYhe9oxhhOFA=",
          "441: github.com/quic-go/webtransport-go v0.5.3 h1:5XMlzemqB4qmOlgIus5zB45AcZ2kCgCy2EptUrfOPWU=",
          "",
          "[Removed Lines]",
          "435: github.com/quic-go/qtls-go1-19 v0.3.2 h1:tFxjCFcTQzK+oMxG6Zcvp4Dq8dx4yD3dDiIiyc86Z5U=",
          "436: github.com/quic-go/qtls-go1-19 v0.3.2/go.mod h1:ySOI96ew8lnoKPtSqx2BlI5wCpUVPT05RMAlajtnyOI=",
          "437: github.com/quic-go/qtls-go1-20 v0.2.2 h1:WLOPx6OY/hxtTxKV1Zrq20FtXtDEkeY00CGQm8GEa3E=",
          "438: github.com/quic-go/qtls-go1-20 v0.2.2/go.mod h1:JKtK6mjbAVcUTN/9jZpvLbGxvdWIKS8uT7EiStoU1SM=",
          "",
          "[Added Lines]",
          "435: github.com/quic-go/qtls-go1-19 v0.3.3 h1:wznEHvJwd+2X3PqftRha0SUKmGsnb6dfArMhy9PeJVE=",
          "436: github.com/quic-go/qtls-go1-19 v0.3.3/go.mod h1:ySOI96ew8lnoKPtSqx2BlI5wCpUVPT05RMAlajtnyOI=",
          "437: github.com/quic-go/qtls-go1-20 v0.2.3 h1:m575dovXn1y2ATOb1XrRFcrv0F+EQmlowTkoraNkDPI=",
          "438: github.com/quic-go/qtls-go1-20 v0.2.3/go.mod h1:JKtK6mjbAVcUTN/9jZpvLbGxvdWIKS8uT7EiStoU1SM=",
          "",
          "---------------"
        ],
        "test-plans/go.mod||test-plans/go.mod": [
          "File: test-plans/go.mod -> test-plans/go.mod",
          "--- Hunk 1 ---",
          "[Context before]",
          "73:  github.com/prometheus/common v0.44.0 // indirect",
          "74:  github.com/prometheus/procfs v0.10.1 // indirect",
          "75:  github.com/quic-go/qpack v0.4.0 // indirect",
          "78:  github.com/quic-go/quic-go v0.33.0 // indirect",
          "79:  github.com/quic-go/webtransport-go v0.5.3 // indirect",
          "80:  github.com/raulk/go-watchdog v1.3.0 // indirect",
          "",
          "[Removed Lines]",
          "76:  github.com/quic-go/qtls-go1-19 v0.3.2 // indirect",
          "77:  github.com/quic-go/qtls-go1-20 v0.2.2 // indirect",
          "",
          "[Added Lines]",
          "76:  github.com/quic-go/qtls-go1-19 v0.3.3 // indirect",
          "77:  github.com/quic-go/qtls-go1-20 v0.2.3 // indirect",
          "",
          "---------------"
        ],
        "test-plans/go.sum||test-plans/go.sum": [
          "File: test-plans/go.sum -> test-plans/go.sum",
          "--- Hunk 1 ---",
          "[Context before]",
          "238: github.com/prometheus/procfs v0.10.1/go.mod h1:nwNm2aOCAYw8uTR/9bWRREkZFxAUcWzPHWJq+XBB/FM=",
          "239: github.com/quic-go/qpack v0.4.0 h1:Cr9BXA1sQS2SmDUWjSofMPNKmvF6IiIfDRmgU0w1ZCo=",
          "240: github.com/quic-go/qpack v0.4.0/go.mod h1:UZVnYIfi5GRk+zI9UMaCPsmZ2xKJP7XBUvVyT1Knj9A=",
          "245: github.com/quic-go/quic-go v0.33.0 h1:ItNoTDN/Fm/zBlq769lLJc8ECe9gYaW40veHCCco7y0=",
          "246: github.com/quic-go/quic-go v0.33.0/go.mod h1:YMuhaAV9/jIu0XclDXwZPAsP/2Kgr5yMYhe9oxhhOFA=",
          "247: github.com/quic-go/webtransport-go v0.5.3 h1:5XMlzemqB4qmOlgIus5zB45AcZ2kCgCy2EptUrfOPWU=",
          "",
          "[Removed Lines]",
          "241: github.com/quic-go/qtls-go1-19 v0.3.2 h1:tFxjCFcTQzK+oMxG6Zcvp4Dq8dx4yD3dDiIiyc86Z5U=",
          "242: github.com/quic-go/qtls-go1-19 v0.3.2/go.mod h1:ySOI96ew8lnoKPtSqx2BlI5wCpUVPT05RMAlajtnyOI=",
          "243: github.com/quic-go/qtls-go1-20 v0.2.2 h1:WLOPx6OY/hxtTxKV1Zrq20FtXtDEkeY00CGQm8GEa3E=",
          "244: github.com/quic-go/qtls-go1-20 v0.2.2/go.mod h1:JKtK6mjbAVcUTN/9jZpvLbGxvdWIKS8uT7EiStoU1SM=",
          "",
          "[Added Lines]",
          "241: github.com/quic-go/qtls-go1-19 v0.3.3 h1:wznEHvJwd+2X3PqftRha0SUKmGsnb6dfArMhy9PeJVE=",
          "242: github.com/quic-go/qtls-go1-19 v0.3.3/go.mod h1:ySOI96ew8lnoKPtSqx2BlI5wCpUVPT05RMAlajtnyOI=",
          "243: github.com/quic-go/qtls-go1-20 v0.2.3 h1:m575dovXn1y2ATOb1XrRFcrv0F+EQmlowTkoraNkDPI=",
          "244: github.com/quic-go/qtls-go1-20 v0.2.3/go.mod h1:JKtK6mjbAVcUTN/9jZpvLbGxvdWIKS8uT7EiStoU1SM=",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "4fecebf401d67a8001b5a53869427cd653f33580",
      "candidate_info": {
        "commit_hash": "4fecebf401d67a8001b5a53869427cd653f33580",
        "repo": "libp2p/go-libp2p",
        "commit_url": "https://github.com/libp2p/go-libp2p/commit/4fecebf401d67a8001b5a53869427cd653f33580",
        "files": [
          "p2p/net/swarm/swarm.go",
          "p2p/test/basichost/basic_host_test.go"
        ],
        "message": "swarm: don't open new streams over transient connections (#2450)",
        "before_after_code_files": [
          "p2p/net/swarm/swarm.go||p2p/net/swarm/swarm.go",
          "p2p/test/basichost/basic_host_test.go||p2p/test/basichost/basic_host_test.go"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/libp2p/go-libp2p/pull/2457"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "p2p/net/swarm/swarm.go||p2p/net/swarm/swarm.go": [
          "File: p2p/net/swarm/swarm.go -> p2p/net/swarm/swarm.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "706:  c.metricsTracer.ClosedConnection(c.dir, time.Since(c.opened), c.ConnState(), c.LocalMultiaddr())",
          "707:  return c.CapableConn.Close()",
          "708: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "710: func (c connWithMetrics) Stat() network.ConnStats {",
          "711:  if cs, ok := c.CapableConn.(network.ConnStat); ok {",
          "712:   return cs.Stat()",
          "713:  }",
          "714:  return network.ConnStats{}",
          "715: }",
          "717: var _ network.ConnStat = connWithMetrics{}",
          "",
          "---------------"
        ],
        "p2p/test/basichost/basic_host_test.go||p2p/test/basichost/basic_host_test.go": [
          "File: p2p/test/basichost/basic_host_test.go -> p2p/test/basichost/basic_host_test.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: package basichost",
          "3: import (",
          "4:  \"context\"",
          "5:  \"fmt\"",
          "6:  \"testing\"",
          "8:  \"github.com/libp2p/go-libp2p\"",
          "9:  \"github.com/libp2p/go-libp2p/core/network\"",
          "10:  \"github.com/libp2p/go-libp2p/core/peer\"",
          "11:  \"github.com/libp2p/go-libp2p/p2p/protocol/circuitv2/client\"",
          "12:  \"github.com/libp2p/go-libp2p/p2p/protocol/circuitv2/relay\"",
          "13:  ma \"github.com/multiformats/go-multiaddr\"",
          "14:  \"github.com/stretchr/testify/require\"",
          "15: )",
          "17: func TestNoStreamOverTransientConnection(t *testing.T) {",
          "18:  h1, err := libp2p.New(",
          "19:   libp2p.NoListenAddrs,",
          "20:   libp2p.EnableRelay(),",
          "21:  )",
          "22:  require.NoError(t, err)",
          "24:  h2, err := libp2p.New(",
          "25:   libp2p.NoListenAddrs,",
          "26:   libp2p.EnableRelay(),",
          "27:  )",
          "28:  require.NoError(t, err)",
          "30:  relay1, err := libp2p.New()",
          "31:  require.NoError(t, err)",
          "33:  _, err = relay.New(relay1)",
          "34:  require.NoError(t, err)",
          "36:  relay1info := peer.AddrInfo{",
          "37:   ID:    relay1.ID(),",
          "38:   Addrs: relay1.Addrs(),",
          "39:  }",
          "40:  err = h1.Connect(context.Background(), relay1info)",
          "41:  require.NoError(t, err)",
          "43:  err = h2.Connect(context.Background(), relay1info)",
          "44:  require.NoError(t, err)",
          "46:  h2.SetStreamHandler(\"/testprotocol\", func(s network.Stream) {",
          "47:   fmt.Println(\"testprotocol\")",
          "50:   s.Close()",
          "51:  })",
          "53:  _, err = client.Reserve(context.Background(), h2, relay1info)",
          "54:  require.NoError(t, err)",
          "56:  relayaddr := ma.StringCast(\"/p2p/\" + relay1info.ID.String() + \"/p2p-circuit/p2p/\" + h2.ID().String())",
          "58:  h2Info := peer.AddrInfo{",
          "59:   ID:    h2.ID(),",
          "60:   Addrs: []ma.Multiaddr{relayaddr},",
          "61:  }",
          "62:  err = h1.Connect(context.Background(), h2Info)",
          "63:  require.NoError(t, err)",
          "65:  ctx := network.WithNoDial(context.Background(), \"test\")",
          "66:  _, err = h1.NewStream(ctx, h2.ID(), \"/testprotocol\")",
          "68:  require.ErrorIs(t, err, network.ErrTransientConn)",
          "70:  _, err = h1.NewStream(network.WithUseTransient(context.Background(), \"test\"), h2.ID(), \"/testprotocol\")",
          "71:  require.NoError(t, err)",
          "72: }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "9e01af883f0b559551cbae417d5d6f883f45f39c",
      "candidate_info": {
        "commit_hash": "9e01af883f0b559551cbae417d5d6f883f45f39c",
        "repo": "libp2p/go-libp2p",
        "commit_url": "https://github.com/libp2p/go-libp2p/commit/9e01af883f0b559551cbae417d5d6f883f45f39c",
        "files": [
          "core/crypto/rsa_common.go",
          "core/crypto/rsa_go.go",
          "core/crypto/rsa_test.go"
        ],
        "message": "core/crypto: restrict RSA keys to <= 8192 bits (#2454)\n\n* Error if RSA key is too big\n\n* Update core/crypto/rsa_common.go\n\nCo-authored-by: Marten Seemann <martenseemann@gmail.com>\n\n* Update core/crypto/rsa_common.go\n\nCo-authored-by: Marten Seemann <martenseemann@gmail.com>\n\n* Fix rename\n\n* Make this var again so the tests work\n\n---------\n\nCo-authored-by: Marten Seemann <martenseemann@gmail.com>",
        "before_after_code_files": [
          "core/crypto/rsa_common.go||core/crypto/rsa_common.go",
          "core/crypto/rsa_go.go||core/crypto/rsa_go.go",
          "core/crypto/rsa_test.go||core/crypto/rsa_test.go"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "core/crypto/rsa_common.go||core/crypto/rsa_common.go",
            "core/crypto/rsa_go.go||core/crypto/rsa_go.go",
            "core/crypto/rsa_test.go||core/crypto/rsa_test.go"
          ],
          "candidate": [
            "core/crypto/rsa_common.go||core/crypto/rsa_common.go",
            "core/crypto/rsa_go.go||core/crypto/rsa_go.go",
            "core/crypto/rsa_test.go||core/crypto/rsa_test.go"
          ]
        }
      },
      "candidate_diff": {
        "core/crypto/rsa_common.go||core/crypto/rsa_common.go": [
          "File: core/crypto/rsa_common.go -> core/crypto/rsa_common.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "13: var MinRsaKeyBits = 2048",
          "17: var ErrRsaKeyTooSmall error",
          "19: func init() {",
          "20:  if _, ok := os.LookupEnv(WeakRsaKeyEnv); ok {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "15: var maxRsaKeyBits = 8192",
          "20: var ErrRsaKeyTooBig error = fmt.Errorf(\"rsa keys must be <= %d bits\", maxRsaKeyBits)",
          "",
          "---------------"
        ],
        "core/crypto/rsa_go.go||core/crypto/rsa_go.go": [
          "File: core/crypto/rsa_go.go -> core/crypto/rsa_go.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "31:  if bits < MinRsaKeyBits {",
          "32:   return nil, nil, ErrRsaKeyTooSmall",
          "33:  }",
          "34:  priv, err := rsa.GenerateKey(src, bits)",
          "35:  if err != nil {",
          "36:   return nil, nil, err",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "34:  if bits > maxRsaKeyBits {",
          "35:   return nil, nil, ErrRsaKeyTooBig",
          "36:  }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "124:  if sk.N.BitLen() < MinRsaKeyBits {",
          "125:   return nil, ErrRsaKeyTooSmall",
          "126:  }",
          "127:  return &RsaPrivateKey{sk: *sk}, nil",
          "128: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "130:  if sk.N.BitLen() > maxRsaKeyBits {",
          "131:   return nil, ErrRsaKeyTooBig",
          "132:  }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "141:  if pk.N.BitLen() < MinRsaKeyBits {",
          "142:   return nil, ErrRsaKeyTooSmall",
          "143:  }",
          "145:  return &RsaPublicKey{k: *pk}, nil",
          "146: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "150:  if pk.N.BitLen() > maxRsaKeyBits {",
          "151:   return nil, ErrRsaKeyTooBig",
          "152:  }",
          "",
          "---------------"
        ],
        "core/crypto/rsa_test.go||core/crypto/rsa_test.go": [
          "File: core/crypto/rsa_test.go -> core/crypto/rsa_test.go",
          "--- Hunk 1 ---",
          "[Context before]",
          "68:  }",
          "69: }",
          "71: func TestRSASignZero(t *testing.T) {",
          "72:  priv, pub, err := GenerateRSAKeyPair(2048, rand.Reader)",
          "73:  if err != nil {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "71: func TestRSABigKeyFailsToGenerate(t *testing.T) {",
          "72:  _, _, err := GenerateRSAKeyPair(maxRsaKeyBits*2, rand.Reader)",
          "73:  if err != ErrRsaKeyTooBig {",
          "74:   t.Fatal(\"should have refused to create too big RSA key\")",
          "75:  }",
          "76: }",
          "78: func TestRSABigKey(t *testing.T) {",
          "81:  origSize := maxRsaKeyBits",
          "82:  maxRsaKeyBits = 2048",
          "83:  defer func() { maxRsaKeyBits = origSize }() //",
          "85:  maxRsaKeyBits *= 2",
          "86:  badPriv, badPub, err := GenerateRSAKeyPair(maxRsaKeyBits, rand.Reader)",
          "87:  if err != nil {",
          "88:   t.Fatalf(\"should have succeeded, got: %s\", err)",
          "89:  }",
          "90:  pubBytes, err := MarshalPublicKey(badPub)",
          "91:  if err != nil {",
          "92:   t.Fatal(err)",
          "93:  }",
          "94:  privBytes, err := MarshalPrivateKey(badPriv)",
          "95:  if err != nil {",
          "96:   t.Fatal(err)",
          "97:  }",
          "98:  maxRsaKeyBits /= 2",
          "99:  _, err = UnmarshalPublicKey(pubBytes)",
          "100:  if err != ErrRsaKeyTooBig {",
          "101:   t.Fatal(\"should have refused to unmarshal a too big key\")",
          "102:  }",
          "103:  _, err = UnmarshalPrivateKey(privBytes)",
          "104:  if err != ErrRsaKeyTooBig {",
          "105:   t.Fatal(\"should have refused to unmarshal a too big key\")",
          "106:  }",
          "107: }",
          "",
          "---------------"
        ]
      }
    }
  ]
}