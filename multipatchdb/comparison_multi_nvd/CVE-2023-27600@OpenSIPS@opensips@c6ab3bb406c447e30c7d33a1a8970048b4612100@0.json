{
  "cve_id": "CVE-2023-27600",
  "cve_desc": "OpenSIPS is a Session Initiation Protocol (SIP) server implementation. Prior to versions 3.1.7 and 3.2.4, OpenSIPS crashes when a malformed SDP body is received and is processed by the `delete_sdp_line` function in the sipmsgops module. This issue can be reproduced by calling the function with an SDP body that does not terminate by a line feed (i.e. `\\n`).\n\nThe vulnerability was found while performing black-box fuzzing against an OpenSIPS server running a configuration that made use of the functions `codec_delete_except_re` and `codec_delete_re`. The same issue was also discovered while performing coverage guided fuzzing on the function `codec_delete_except_re`. The crash happens because the function `delete_sdp_line` expects that an SDP line is terminated by a line feed (`\\n`).\n\nBy abusing this vulnerability, an attacker is able to crash the server. It affects configurations containing functions that rely on the affected code, such as the function `codec_delete_except_re`. Due to the sanity check that is performed in the `del_lump` function, exploitation of this issue will generate an `abort` in the lumps processing function, resulting in a Denial of Service. This issue is patched in versions 3.1.7 and 3.2.4.",
  "repo": "OpenSIPS/opensips",
  "patch_hash": "c6ab3bb406c447e30c7d33a1a8970048b4612100",
  "patch_info": {
    "commit_hash": "c6ab3bb406c447e30c7d33a1a8970048b4612100",
    "repo": "OpenSIPS/opensips",
    "commit_url": "https://github.com/OpenSIPS/opensips/commit/c6ab3bb406c447e30c7d33a1a8970048b4612100",
    "files": [
      "modules/sipmsgops/codecs.c"
    ],
    "message": "[sipmsgops] fix codec_delete_XX() parsing (2)\n\nIssue discovered during OpenSIPS Security Audit 2021,\n\tby Alfred Farrugia & Sandro Gauci (Enable Security)\n\nhttps://github.com/OpenSIPS/opensips/security/advisories/GHSA-67w7-g4j8-3wcx",
    "before_after_code_files": [
      "modules/sipmsgops/codecs.c||modules/sipmsgops/codecs.c"
    ]
  },
  "patch_diff": {
    "modules/sipmsgops/codecs.c||modules/sipmsgops/codecs.c": [
      "File: modules/sipmsgops/codecs.c -> modules/sipmsgops/codecs.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "367:  while(*end != '\\n' && end < (stream->body.s+stream->body.len) )",
      "368:   end++;",
      "372:  if( del_lump(msg, start - msg->buf, end - start,0) == NULL )",
      "",
      "[Removed Lines]",
      "369:  end++;",
      "",
      "[Added Lines]",
      "369:  if ( *end == '\\n')",
      "370:   end++;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "4ec0f086ccd6826d32dcb7aee843b47ba4c0b6ff",
      "candidate_info": {
        "commit_hash": "4ec0f086ccd6826d32dcb7aee843b47ba4c0b6ff",
        "repo": "OpenSIPS/opensips",
        "commit_url": "https://github.com/OpenSIPS/opensips/commit/4ec0f086ccd6826d32dcb7aee843b47ba4c0b6ff",
        "files": [
          "modules/sipmsgops/codecs.c"
        ],
        "message": "[sipmsgops] fix codec_delete_XX() parsing (2)\n\nIssue discovered during OpenSIPS Security Audit 2021,\n\tby Alfred Farrugia & Sandro Gauci (Enable Security)\n\nhttps://github.com/OpenSIPS/opensips/security/advisories/GHSA-67w7-g4j8-3wcx\n(cherry picked from commit c6ab3bb406c447e30c7d33a1a8970048b4612100)",
        "before_after_code_files": [
          "modules/sipmsgops/codecs.c||modules/sipmsgops/codecs.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "modules/sipmsgops/codecs.c||modules/sipmsgops/codecs.c"
          ],
          "candidate": [
            "modules/sipmsgops/codecs.c||modules/sipmsgops/codecs.c"
          ]
        }
      },
      "candidate_diff": {
        "modules/sipmsgops/codecs.c||modules/sipmsgops/codecs.c": [
          "File: modules/sipmsgops/codecs.c -> modules/sipmsgops/codecs.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "367:  while(*end != '\\n' && end < (stream->body.s+stream->body.len) )",
          "368:   end++;",
          "372:  if( del_lump(msg, start - msg->buf, end - start,0) == NULL )",
          "",
          "[Removed Lines]",
          "369:  end++;",
          "",
          "[Added Lines]",
          "369:  if ( *end == '\\n')",
          "370:   end++;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "a23908d30abf8eaa929075d3c29215d9e62801de",
      "candidate_info": {
        "commit_hash": "a23908d30abf8eaa929075d3c29215d9e62801de",
        "repo": "OpenSIPS/opensips",
        "commit_url": "https://github.com/OpenSIPS/opensips/commit/a23908d30abf8eaa929075d3c29215d9e62801de",
        "files": [
          "modules/sipmsgops/codecs.c"
        ],
        "message": "[sipmsgops] fix codec_delete_XX() parsing (2)\n\nIssue discovered during OpenSIPS Security Audit 2021,\n\tby Alfred Farrugia & Sandro Gauci (Enable Security)\n\nhttps://github.com/OpenSIPS/opensips/security/advisories/GHSA-67w7-g4j8-3wcx\n(cherry picked from commit c6ab3bb406c447e30c7d33a1a8970048b4612100)",
        "before_after_code_files": [
          "modules/sipmsgops/codecs.c||modules/sipmsgops/codecs.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "modules/sipmsgops/codecs.c||modules/sipmsgops/codecs.c"
          ],
          "candidate": [
            "modules/sipmsgops/codecs.c||modules/sipmsgops/codecs.c"
          ]
        }
      },
      "candidate_diff": {
        "modules/sipmsgops/codecs.c||modules/sipmsgops/codecs.c": [
          "File: modules/sipmsgops/codecs.c -> modules/sipmsgops/codecs.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "367:  while(*end != '\\n' && end < (stream->body.s+stream->body.len) )",
          "368:   end++;",
          "372:  if( del_lump(msg, start - msg->buf, end - start,0) == NULL )",
          "",
          "[Removed Lines]",
          "369:  end++;",
          "",
          "[Added Lines]",
          "369:  if ( *end == '\\n')",
          "370:   end++;",
          "",
          "---------------"
        ]
      }
    }
  ]
}