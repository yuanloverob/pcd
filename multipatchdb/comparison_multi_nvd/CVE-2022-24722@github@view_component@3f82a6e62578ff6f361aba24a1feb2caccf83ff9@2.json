{
  "cve_id": "CVE-2022-24722",
  "cve_desc": "VIewComponent is a framework for building view components in Ruby on Rails. Versions prior to 2.31.2 and 2.49.1 contain a cross-site scripting vulnerability that has the potential to impact anyone using translations with the view_component gem. Data received via user input and passed as an interpolation argument to the `translate` method is not properly sanitized before display. Versions 2.31.2 and 2.49.1 have been released and fully mitigate the vulnerability. As a workaround, avoid passing user input to the `translate` function, or sanitize the inputs before passing them.",
  "repo": "github/view_component",
  "patch_hash": "3f82a6e62578ff6f361aba24a1feb2caccf83ff9",
  "patch_info": {
    "commit_hash": "3f82a6e62578ff6f361aba24a1feb2caccf83ff9",
    "repo": "github/view_component",
    "commit_url": "https://github.com/github/view_component/commit/3f82a6e62578ff6f361aba24a1feb2caccf83ff9",
    "files": [
      "Gemfile.lock",
      "docs/CHANGELOG.md",
      "lib/view_component/translatable.rb",
      "test/sandbox/app/components/translatable_component.yml",
      "test/view_component/translatable_test.rb"
    ],
    "message": "Fix XSS vulnerability when using HTML-safe translations and interpolation arguments (#1295)",
    "before_after_code_files": [
      "Gemfile.lock||Gemfile.lock",
      "lib/view_component/translatable.rb||lib/view_component/translatable.rb",
      "test/view_component/translatable_test.rb||test/view_component/translatable_test.rb"
    ]
  },
  "patch_diff": {
    "Gemfile.lock||Gemfile.lock": [
      "File: Gemfile.lock -> Gemfile.lock",
      "--- Hunk 1 ---",
      "[Context before]",
      "1: PATH",
      "2:   remote: .",
      "3:   specs:",
      "5:       activesupport (>= 5.0.0, < 8.0)",
      "6:       method_source (~> 1.0)",
      "8: GEM",
      "9:   remote: https://rubygems.org/",
      "10:   specs:",
      "14:       nio4r (~> 2.0)",
      "15:       websocket-driver (>= 0.6.1)",
      "22:       mail (>= 2.7.1)",
      "23:       net-imap",
      "24:       net-pop",
      "25:       net-smtp",
      "31:       mail (~> 2.5, >= 2.5.4)",
      "32:       net-imap",
      "33:       net-pop",
      "34:       net-smtp",
      "35:       rails-dom-testing (~> 2.0)",
      "39:       rack (~> 2.0, >= 2.2.0)",
      "40:       rack-test (>= 0.6.3)",
      "41:       rails-dom-testing (~> 2.0)",
      "42:       rails-html-sanitizer (~> 1.0, >= 1.2.0)",
      "48:       globalid (>= 0.6.0)",
      "49:       nokogiri (>= 1.8.5)",
      "52:       builder (~> 3.1)",
      "53:       erubi (~> 1.4)",
      "54:       rails-dom-testing (~> 2.0)",
      "55:       rails-html-sanitizer (~> 1.1, >= 1.2.0)",
      "58:       globalid (>= 0.3.6)",
      "69:       marcel (~> 1.0)",
      "70:       mini_mime (>= 1.1.0)",
      "72:       concurrent-ruby (~> 1.0, >= 1.0.2)",
      "73:       i18n (>= 1.6, < 2)",
      "74:       minitest (>= 5.1)",
      "",
      "[Removed Lines]",
      "4:     view_component (2.48.0)",
      "11:     actioncable (7.0.1)",
      "12:       actionpack (= 7.0.1)",
      "13:       activesupport (= 7.0.1)",
      "16:     actionmailbox (7.0.1)",
      "17:       actionpack (= 7.0.1)",
      "18:       activejob (= 7.0.1)",
      "19:       activerecord (= 7.0.1)",
      "20:       activestorage (= 7.0.1)",
      "21:       activesupport (= 7.0.1)",
      "26:     actionmailer (7.0.1)",
      "27:       actionpack (= 7.0.1)",
      "28:       actionview (= 7.0.1)",
      "29:       activejob (= 7.0.1)",
      "30:       activesupport (= 7.0.1)",
      "36:     actionpack (7.0.1)",
      "37:       actionview (= 7.0.1)",
      "38:       activesupport (= 7.0.1)",
      "43:     actiontext (7.0.1)",
      "44:       actionpack (= 7.0.1)",
      "45:       activerecord (= 7.0.1)",
      "46:       activestorage (= 7.0.1)",
      "47:       activesupport (= 7.0.1)",
      "50:     actionview (7.0.1)",
      "51:       activesupport (= 7.0.1)",
      "56:     activejob (7.0.1)",
      "57:       activesupport (= 7.0.1)",
      "59:     activemodel (7.0.1)",
      "60:       activesupport (= 7.0.1)",
      "61:     activerecord (7.0.1)",
      "62:       activemodel (= 7.0.1)",
      "63:       activesupport (= 7.0.1)",
      "64:     activestorage (7.0.1)",
      "65:       actionpack (= 7.0.1)",
      "66:       activejob (= 7.0.1)",
      "67:       activerecord (= 7.0.1)",
      "68:       activesupport (= 7.0.1)",
      "71:     activesupport (7.0.1)",
      "",
      "[Added Lines]",
      "4:     view_component (2.49.0)",
      "11:     actioncable (7.0.2)",
      "12:       actionpack (= 7.0.2)",
      "13:       activesupport (= 7.0.2)",
      "16:     actionmailbox (7.0.2)",
      "17:       actionpack (= 7.0.2)",
      "18:       activejob (= 7.0.2)",
      "19:       activerecord (= 7.0.2)",
      "20:       activestorage (= 7.0.2)",
      "21:       activesupport (= 7.0.2)",
      "26:     actionmailer (7.0.2)",
      "27:       actionpack (= 7.0.2)",
      "28:       actionview (= 7.0.2)",
      "29:       activejob (= 7.0.2)",
      "30:       activesupport (= 7.0.2)",
      "36:     actionpack (7.0.2)",
      "37:       actionview (= 7.0.2)",
      "38:       activesupport (= 7.0.2)",
      "43:     actiontext (7.0.2)",
      "44:       actionpack (= 7.0.2)",
      "45:       activerecord (= 7.0.2)",
      "46:       activestorage (= 7.0.2)",
      "47:       activesupport (= 7.0.2)",
      "50:     actionview (7.0.2)",
      "51:       activesupport (= 7.0.2)",
      "56:     activejob (7.0.2)",
      "57:       activesupport (= 7.0.2)",
      "59:     activemodel (7.0.2)",
      "60:       activesupport (= 7.0.2)",
      "61:     activerecord (7.0.2)",
      "62:       activemodel (= 7.0.2)",
      "63:       activesupport (= 7.0.2)",
      "64:     activestorage (7.0.2)",
      "65:       actionpack (= 7.0.2)",
      "66:       activejob (= 7.0.2)",
      "67:       activerecord (= 7.0.2)",
      "68:       activesupport (= 7.0.2)",
      "71:     activesupport (7.0.2)",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "120:       temple (>= 0.8.0)",
      "121:       tilt",
      "122:     html_tokenizer (0.0.7)",
      "124:       concurrent-ruby (~> 1.0)",
      "125:     io-wait (0.2.1)",
      "126:     jbuilder (2.11.5)",
      "127:       actionview (>= 5.0.0)",
      "128:       activesupport (>= 5.0.0)",
      "130:       crass (~> 1.0.2)",
      "131:       nokogiri (>= 1.5.9)",
      "132:     mail (2.7.1)",
      "",
      "[Removed Lines]",
      "123:     i18n (1.8.11)",
      "129:     loofah (2.13.0)",
      "",
      "[Added Lines]",
      "123:     i18n (1.10.0)",
      "129:     loofah (2.14.0)",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "135:     matrix (0.4.2)",
      "136:     method_source (1.0.0)",
      "137:     mini_mime (1.1.2)",
      "139:     minitest (5.6.0)",
      "140:     net-imap (0.2.3)",
      "141:       digest",
      "",
      "[Removed Lines]",
      "138:     mini_portile2 (2.7.1)",
      "",
      "[Added Lines]",
      "138:     mini_portile2 (2.8.0)",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "153:       net-protocol",
      "154:       timeout",
      "155:     nio4r (2.5.8)",
      "158:       racc (~> 1.4)",
      "159:     parallel (1.21.0)",
      "161:       ast (~> 2.4.1)",
      "162:     pry (0.14.1)",
      "163:       coderay (~> 1.1)",
      "",
      "[Removed Lines]",
      "156:     nokogiri (1.13.1)",
      "157:       mini_portile2 (~> 2.7.0)",
      "160:     parser (3.1.0.0)",
      "",
      "[Added Lines]",
      "156:     nokogiri (1.13.3)",
      "157:       mini_portile2 (~> 2.8.0)",
      "160:     parser (3.1.1.0)",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "167:     rack (2.2.3)",
      "168:     rack-test (1.1.0)",
      "169:       rack (>= 1.0, < 3)",
      "182:       bundler (>= 1.15.0)",
      "184:     rails-dom-testing (2.0.3)",
      "185:       activesupport (>= 4.2.0)",
      "186:       nokogiri (>= 1.6)",
      "187:     rails-html-sanitizer (1.4.2)",
      "188:       loofah (~> 2.3)",
      "192:       method_source",
      "193:       rake (>= 12.2)",
      "194:       thor (~> 1.0)",
      "195:       zeitwerk (~> 2.5)",
      "196:     rainbow (3.1.1)",
      "197:     rake (13.0.6)",
      "199:     rexml (3.2.5)",
      "200:     rubocop (1.13.0)",
      "201:       parallel (~> 1.10)",
      "",
      "[Removed Lines]",
      "170:     rails (7.0.1)",
      "171:       actioncable (= 7.0.1)",
      "172:       actionmailbox (= 7.0.1)",
      "173:       actionmailer (= 7.0.1)",
      "174:       actionpack (= 7.0.1)",
      "175:       actiontext (= 7.0.1)",
      "176:       actionview (= 7.0.1)",
      "177:       activejob (= 7.0.1)",
      "178:       activemodel (= 7.0.1)",
      "179:       activerecord (= 7.0.1)",
      "180:       activestorage (= 7.0.1)",
      "181:       activesupport (= 7.0.1)",
      "183:       railties (= 7.0.1)",
      "189:     railties (7.0.1)",
      "190:       actionpack (= 7.0.1)",
      "191:       activesupport (= 7.0.1)",
      "198:     regexp_parser (2.2.0)",
      "",
      "[Added Lines]",
      "170:     rails (7.0.2)",
      "171:       actioncable (= 7.0.2)",
      "172:       actionmailbox (= 7.0.2)",
      "173:       actionmailer (= 7.0.2)",
      "174:       actionpack (= 7.0.2)",
      "175:       actiontext (= 7.0.2)",
      "176:       actionview (= 7.0.2)",
      "177:       activejob (= 7.0.2)",
      "178:       activemodel (= 7.0.2)",
      "179:       activerecord (= 7.0.2)",
      "180:       activestorage (= 7.0.2)",
      "181:       activesupport (= 7.0.2)",
      "183:       railties (= 7.0.2)",
      "189:     railties (7.0.2)",
      "190:       actionpack (= 7.0.2)",
      "191:       activesupport (= 7.0.2)",
      "198:     regexp_parser (2.2.1)",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "206:       rubocop-ast (>= 1.2.0, < 2.0)",
      "207:       ruby-progressbar (~> 1.7)",
      "208:       unicode-display_width (>= 1.4.0, < 3.0)",
      "211:     rubocop-github (0.16.2)",
      "212:       rubocop (<= 1.13.0)",
      "213:       rubocop-performance (<= 1.11.0)",
      "",
      "[Removed Lines]",
      "209:     rubocop-ast (1.15.1)",
      "210:       parser (>= 3.0.1.1)",
      "",
      "[Added Lines]",
      "209:     rubocop-ast (1.16.0)",
      "210:       parser (>= 3.1.1.0)",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "232:       temple (>= 0.7.6, < 0.9)",
      "233:       tilt (>= 2.0.6, < 2.1)",
      "234:     smart_properties (1.17.0)",
      "236:       concurrent-ruby (~> 1.0)",
      "237:       rack (> 1, < 3)",
      "238:     sprockets-rails (3.2.2)",
      "",
      "[Removed Lines]",
      "235:     sprockets (4.0.2)",
      "",
      "[Added Lines]",
      "235:     sprockets (4.0.3)",
      "",
      "---------------",
      "--- Hunk 8 ---",
      "[Context before]",
      "259:       webrick (~> 1.7.0)",
      "260:     yard-activesupport-concern (0.0.1)",
      "261:       yard (>= 0.8)",
      "264: PLATFORMS",
      "265:   ruby",
      "",
      "[Removed Lines]",
      "262:     zeitwerk (2.5.3)",
      "",
      "[Added Lines]",
      "262:     zeitwerk (2.5.4)",
      "",
      "---------------",
      "--- Hunk 9 ---",
      "[Context before]",
      "274:   haml (~> 5)",
      "275:   jbuilder (~> 2)",
      "276:   minitest (= 5.6.0)",
      "280:   pry (~> 0.13)",
      "282:   rake (~> 13.0)",
      "283:   rubocop-github (~> 0.16.1)",
      "284:   simplecov (~> 0.18.0)",
      "",
      "[Removed Lines]",
      "277:   net-imap",
      "278:   net-pop",
      "279:   net-smtp",
      "281:   rails (~> 7.0.0)",
      "",
      "[Added Lines]",
      "278:   rails (= 7.0.2)",
      "",
      "---------------"
    ],
    "lib/view_component/translatable.rb||lib/view_component/translatable.rb": [
      "File: lib/view_component/translatable.rb -> lib/view_component/translatable.rb",
      "--- Hunk 1 ---",
      "[Context before]",
      "1: # frozen_string_literal: true",
      "3: require \"set\"",
      "4: require \"i18n\"",
      "5: require \"action_view/helpers/translation_helper\"",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "3: require \"erb\"",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "70:       key = key&.to_s unless key.is_a?(String)",
      "71:       key = \"#{i18n_scope}#{key}\" if key.start_with?(\".\")",
      "73:       if key.start_with?(i18n_scope + \".\")",
      "74:         translated =",
      "75:           catch(:exception) do",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "74:       if HTML_SAFE_TRANSLATION_KEY.match?(key)",
      "75:         html_escape_translation_options!(options)",
      "76:       end",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "107:         translation.html_safe # rubocop:disable Rails/OutputSafety",
      "108:       end",
      "109:     end",
      "110:   end",
      "111: end",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "116:     private",
      "118:     def html_escape_translation_options!(options)",
      "119:       options.each do |name, value|",
      "120:         unless i18n_option?(name) || (name == :count && value.is_a?(Numeric))",
      "121:           options[name] = ERB::Util.html_escape(value.to_s)",
      "122:         end",
      "123:       end",
      "124:     end",
      "126:     def i18n_option?(name)",
      "127:       (@i18n_option_names ||= I18n::RESERVED_KEYS.to_set).include?(name)",
      "128:     end",
      "",
      "---------------"
    ],
    "test/view_component/translatable_test.rb||test/view_component/translatable_test.rb": [
      "File: test/view_component/translatable_test.rb -> test/view_component/translatable_test.rb",
      "--- Hunk 1 ---",
      "[Context before]",
      "58:     assert_predicate translate(\".hello_html\"), :html_safe?",
      "59:   end",
      "61:   def test_translate_uses_the_helper_when_no_sidecar_file_is_provided",
      "62:     # The cache needs to be kept clean for TranslatableComponent, otherwise it will rely on the",
      "63:     # already created i18n_backend.",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "61:   def test_translate_with_html_suffix_escapes_interpolated_arguments",
      "62:     translation = translate(\".interpolated_html\", horse_count: \"<script type='text/javascript'>alert('foo');</script>\")",
      "63:     assert_equal(",
      "64:       \"There are &lt;script type=&#39;text/javascript&#39;&gt;alert(&#39;foo&#39;);&lt;/script&gt; horses in the \"\\",
      "65:         \"<strong>barn</strong>!\",",
      "66:       translation",
      "67:     )",
      "68:   end",
      "70:   def test_translate_with_html_suffix_does_not_double_escape",
      "71:     translation = translate(\".interpolated_html\", horse_count: \"> 4\")",
      "72:     assert_equal(",
      "73:       \"There are &gt; 4 horses in the <strong>barn</strong>!\",",
      "74:       translation",
      "75:     )",
      "76:   end",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "4ef622e44d35e9310063979853e424f994b12f56",
      "candidate_info": {
        "commit_hash": "4ef622e44d35e9310063979853e424f994b12f56",
        "repo": "github/view_component",
        "commit_url": "https://github.com/github/view_component/commit/4ef622e44d35e9310063979853e424f994b12f56",
        "files": [
          "Gemfile.lock"
        ],
        "message": "Bump loofah from 2.19.0 to 2.19.1 (#1632)\n\nBumps [loofah](https://github.com/flavorjones/loofah) from 2.19.0 to 2.19.1.\n- [Release notes](https://github.com/flavorjones/loofah/releases)\n- [Changelog](https://github.com/flavorjones/loofah/blob/main/CHANGELOG.md)\n- [Commits](https://github.com/flavorjones/loofah/compare/v2.19.0...v2.19.1)\n\n---\nupdated-dependencies:\n- dependency-name: loofah\n  dependency-type: indirect\n...\n\nSigned-off-by: dependabot[bot] <support@github.com>\n\nSigned-off-by: dependabot[bot] <support@github.com>\nCo-authored-by: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>",
        "before_after_code_files": [
          "Gemfile.lock||Gemfile.lock"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "Gemfile.lock||Gemfile.lock"
          ],
          "candidate": [
            "Gemfile.lock||Gemfile.lock"
          ]
        }
      },
      "candidate_diff": {
        "Gemfile.lock||Gemfile.lock": [
          "File: Gemfile.lock -> Gemfile.lock",
          "--- Hunk 1 ---",
          "[Context before]",
          "136:       actionview (>= 5.0.0)",
          "137:       activesupport (>= 5.0.0)",
          "138:     json (2.6.2)",
          "140:       crass (~> 1.0.2)",
          "141:       nokogiri (>= 1.5.9)",
          "142:     m (1.6.1)",
          "",
          "[Removed Lines]",
          "139:     loofah (2.19.0)",
          "",
          "[Added Lines]",
          "139:     loofah (2.19.1)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "148:     matrix (0.4.2)",
          "149:     method_source (1.0.0)",
          "150:     mini_mime (1.1.2)",
          "152:     minitest (5.6.0)",
          "153:     net-imap (0.3.1)",
          "154:       net-protocol",
          "",
          "[Removed Lines]",
          "151:     mini_portile2 (2.8.0)",
          "",
          "[Added Lines]",
          "151:     mini_portile2 (2.8.1)",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "159:     net-smtp (0.3.3)",
          "160:       net-protocol",
          "161:     nio4r (2.5.8)",
          "163:       mini_portile2 (~> 2.8.0)",
          "164:       racc (~> 1.4)",
          "165:     parallel (1.22.1)",
          "",
          "[Removed Lines]",
          "162:     nokogiri (1.13.9)",
          "",
          "[Added Lines]",
          "162:     nokogiri (1.14.0)",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "171:     public_suffix (5.0.0)",
          "172:     puma (5.6.5)",
          "173:       nio4r (~> 2.0)",
          "175:     rack (2.2.4)",
          "176:     rack-test (2.0.2)",
          "177:       rack (>= 1.3)",
          "",
          "[Removed Lines]",
          "174:     racc (1.6.0)",
          "",
          "[Added Lines]",
          "174:     racc (1.6.2)",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "303:   jbuilder (~> 2)",
          "304:   m (~> 1)",
          "305:   minitest (= 5.6.0)",
          "306:   pry (~> 0.13)",
          "307:   puma (~> 5)",
          "308:   rails (~> 7.0.0)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "306:   net-imap",
          "307:   net-pop",
          "308:   net-smtp",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "5f41f38981663dd42ca709c872251fe1492353a0",
      "candidate_info": {
        "commit_hash": "5f41f38981663dd42ca709c872251fe1492353a0",
        "repo": "github/view_component",
        "commit_url": "https://github.com/github/view_component/commit/5f41f38981663dd42ca709c872251fe1492353a0",
        "files": [
          "Gemfile.lock",
          "lib/view_component/translatable.rb",
          "test/sandbox/app/components/translatable_component.yml",
          "test/view_component/translatable_test.rb"
        ],
        "message": "Fix XSS vulnerability when using HTML-safe translations and interpolation arguments",
        "before_after_code_files": [
          "Gemfile.lock||Gemfile.lock",
          "lib/view_component/translatable.rb||lib/view_component/translatable.rb",
          "test/view_component/translatable_test.rb||test/view_component/translatable_test.rb"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_olp_changes": 1,
        "olp_code_files": {
          "patch": [
            "Gemfile.lock||Gemfile.lock",
            "lib/view_component/translatable.rb||lib/view_component/translatable.rb",
            "test/view_component/translatable_test.rb||test/view_component/translatable_test.rb"
          ],
          "candidate": [
            "Gemfile.lock||Gemfile.lock",
            "lib/view_component/translatable.rb||lib/view_component/translatable.rb",
            "test/view_component/translatable_test.rb||test/view_component/translatable_test.rb"
          ]
        }
      },
      "candidate_diff": {
        "Gemfile.lock||Gemfile.lock": [
          "File: Gemfile.lock -> Gemfile.lock",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: PATH",
          "2:   remote: .",
          "3:   specs:",
          "5:       activesupport (>= 5.0.0, < 8.0)",
          "6:       method_source (~> 1.0)",
          "",
          "[Removed Lines]",
          "4:     view_component (2.48.0)",
          "",
          "[Added Lines]",
          "4:     view_component (2.49.1)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "274:   haml (~> 5)",
          "275:   jbuilder (~> 2)",
          "276:   minitest (= 5.6.0)",
          "280:   pry (~> 0.13)",
          "282:   rake (~> 13.0)",
          "283:   rubocop-github (~> 0.16.1)",
          "284:   simplecov (~> 0.18.0)",
          "",
          "[Removed Lines]",
          "277:   net-imap",
          "278:   net-pop",
          "279:   net-smtp",
          "281:   rails (~> 7.0.0)",
          "",
          "[Added Lines]",
          "278:   rails (= 7.0.1)",
          "",
          "---------------"
        ],
        "lib/view_component/translatable.rb||lib/view_component/translatable.rb": [
          "File: lib/view_component/translatable.rb -> lib/view_component/translatable.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: # frozen_string_literal: true",
          "3: require \"set\"",
          "4: require \"i18n\"",
          "5: require \"action_view/helpers/translation_helper\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3: require \"erb\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "70:       key = key&.to_s unless key.is_a?(String)",
          "71:       key = \"#{i18n_scope}#{key}\" if key.start_with?(\".\")",
          "73:       if key.start_with?(i18n_scope + \".\")",
          "74:         translated =",
          "75:           catch(:exception) do",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "74:       if HTML_SAFE_TRANSLATION_KEY.match?(key)",
          "75:         html_escape_translation_options!(options)",
          "76:       end",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "96:     def i18n_scope",
          "97:       self.class.i18n_scope",
          "98:     end",
          "99:   end",
          "100: end",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "105:     def html_safe_translation(translation)",
          "106:       if translation.respond_to?(:map)",
          "107:         translation.map { |element| html_safe_translation(element) }",
          "108:       else",
          "109:         # It's assumed here that objects loaded by the i18n backend will respond to `#html_safe?`.",
          "110:         # It's reasonable that if we're in Rails, `active_support/core_ext/string/output_safety.rb`",
          "111:         # will provide this to `Object`.",
          "112:         translation.html_safe # rubocop:disable Rails/OutputSafety",
          "113:       end",
          "114:     end",
          "116:     private",
          "118:     def html_escape_translation_options!(options)",
          "119:       options.each do |name, value|",
          "120:         unless i18n_option?(name) || (name == :count && value.is_a?(Numeric))",
          "121:           options[name] = ERB::Util.html_escape(value.to_s)",
          "122:         end",
          "123:       end",
          "124:     end",
          "126:     def i18n_option?(name)",
          "127:       (@i18n_option_names ||= I18n::RESERVED_KEYS.to_set).include?(name)",
          "128:     end",
          "",
          "---------------"
        ],
        "test/view_component/translatable_test.rb||test/view_component/translatable_test.rb": [
          "File: test/view_component/translatable_test.rb -> test/view_component/translatable_test.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "58:     assert_predicate translate(\".hello_html\"), :html_safe?",
          "59:   end",
          "61:   def test_translate_uses_the_helper_when_no_sidecar_file_is_provided",
          "62:     # The cache needs to be kept clean for TranslatableComponent, otherwise it will rely on the",
          "63:     # already created i18n_backend.",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "61:   def test_translate_with_html_suffix_escapes_interpolated_arguments",
          "62:     translation = translate(\".interpolated_html\", horse_count: \"<script type='text/javascript'>alert('foo');</script>\")",
          "63:     assert_equal(",
          "64:       \"There are &lt;script type=&#39;text/javascript&#39;&gt;alert(&#39;foo&#39;);&lt;/script&gt; horses in the \"\\",
          "65:         \"<strong>barn</strong>!\",",
          "66:       translation",
          "67:     )",
          "68:   end",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "8c8934b0436169b8a52bdcd2ab01961ff8b6c5c5",
      "candidate_info": {
        "commit_hash": "8c8934b0436169b8a52bdcd2ab01961ff8b6c5c5",
        "repo": "github/view_component",
        "commit_url": "https://github.com/github/view_component/commit/8c8934b0436169b8a52bdcd2ab01961ff8b6c5c5",
        "files": [
          "lib/view_component/translatable.rb",
          "test/app/components/translatable_component.yml",
          "test/view_component/translatable_test.rb"
        ],
        "message": "Fix XSS vulnerability when using HTML-safe translations and interpolation arguments",
        "before_after_code_files": [
          "lib/view_component/translatable.rb||lib/view_component/translatable.rb",
          "test/view_component/translatable_test.rb||test/view_component/translatable_test.rb"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_olp_changes": 1,
        "olp_code_files": {
          "patch": [
            "lib/view_component/translatable.rb||lib/view_component/translatable.rb",
            "test/view_component/translatable_test.rb||test/view_component/translatable_test.rb"
          ],
          "candidate": [
            "lib/view_component/translatable.rb||lib/view_component/translatable.rb",
            "test/view_component/translatable_test.rb||test/view_component/translatable_test.rb"
          ]
        }
      },
      "candidate_diff": {
        "lib/view_component/translatable.rb||lib/view_component/translatable.rb": [
          "File: lib/view_component/translatable.rb -> lib/view_component/translatable.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: # frozen_string_literal: true",
          "3: require \"set\"",
          "4: require \"i18n\"",
          "5: require \"action_view/helpers/translation_helper\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3: require \"erb\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "70:       key = key&.to_s unless key.is_a?(String)",
          "71:       key = \"#{i18n_scope}#{key}\" if key.start_with?(\".\")",
          "73:       translated = catch(:exception) do",
          "74:         i18n_backend.translate(locale, key, options)",
          "75:       end",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "74:       if HTML_SAFE_TRANSLATION_KEY.match?(key)",
          "75:         html_escape_translation_options!(options)",
          "76:       end",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "91:     def i18n_scope",
          "92:       self.class.i18n_scope",
          "93:     end",
          "94:   end",
          "95: end",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "100:     private",
          "102:     def html_escape_translation_options!(options)",
          "103:       options.each do |name, value|",
          "104:         unless i18n_option?(name) || (name == :count && value.is_a?(Numeric))",
          "105:           options[name] = ERB::Util.html_escape(value.to_s)",
          "106:         end",
          "107:       end",
          "108:     end",
          "110:     def i18n_option?(name)",
          "111:       (@i18n_option_names ||= I18n::RESERVED_KEYS.to_set).include?(name)",
          "112:     end",
          "",
          "---------------"
        ],
        "test/view_component/translatable_test.rb||test/view_component/translatable_test.rb": [
          "File: test/view_component/translatable_test.rb -> test/view_component/translatable_test.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "53:     assert_predicate translate(\".hello_html\"), :html_safe?",
          "54:   end",
          "56:   def test_translate_uses_the_helper_when_no_sidecar_file_is_provided",
          "57:     # The cache needs to be kept clean for TranslatableComponent, otherwise it will rely on the",
          "58:     # already created i18n_backend.",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "56:   def test_translate_with_html_suffix_escapes_interpolated_arguments",
          "57:     translation = translate(\".interpolated_html\", horse_count: \"<script type='text/javascript'>alert('foo');</script>\")",
          "58:     assert_equal(",
          "59:       \"There are &lt;script type=&#39;text/javascript&#39;&gt;alert(&#39;foo&#39;);&lt;/script&gt; horses in the \"\\",
          "60:         \"<strong>barn</strong>!\",",
          "61:       translation",
          "62:     )",
          "63:   end",
          "",
          "---------------"
        ]
      }
    }
  ]
}