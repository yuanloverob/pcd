{
  "cve_id": "CVE-2023-35153",
  "cve_desc": "XWiki Platform is a generic wiki platform. Starting in version 5.4.4 and prior to versions 14.4.8, 14.10.4, and 15.0, a stored cross-site scripting vulnerability can be exploited by users with edit rights by adding a `AppWithinMinutes.FormFieldCategoryClass` class on a page and setting the payload on the page title. Then, any user visiting `/xwiki/bin/view/AppWithinMinutes/ClassEditSheet` executes the payload. The issue has been patched in XWiki 14.4.8, 14.10.4, and 15.0. As a workaround, update `AppWithinMinutes.ClassEditSheet` with a patch.",
  "repo": "xwiki/xwiki-platform",
  "patch_hash": "1b87fec1e5b5ec00b7a8c3c3f94f6c5e22547392",
  "patch_info": {
    "commit_hash": "1b87fec1e5b5ec00b7a8c3c3f94f6c5e22547392",
    "repo": "xwiki/xwiki-platform",
    "commit_url": "https://github.com/xwiki/xwiki-platform/commit/1b87fec1e5b5ec00b7a8c3c3f94f6c5e22547392",
    "files": [
      "xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/pom.xml",
      "xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/main/resources/AppWithinMinutes/ClassEditSheet.xml",
      "xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/test/java/org/xwikiplatform/appwithinminutes/ClassEditSheetPageTest.java"
    ],
    "message": "XWIKI-20365: Improved ClassEditSheet escaping",
    "before_after_code_files": [
      "xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/test/java/org/xwikiplatform/appwithinminutes/ClassEditSheetPageTest.java||xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/test/java/org/xwikiplatform/appwithinminutes/ClassEditSheetPageTest.java"
    ]
  },
  "patch_diff": {
    "xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/test/java/org/xwikiplatform/appwithinminutes/ClassEditSheetPageTest.java||xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/test/java/org/xwikiplatform/appwithinminutes/ClassEditSheetPageTest.java": [
      "File: xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/test/java/org/xwikiplatform/appwithinminutes/ClassEditSheetPageTest.java -> xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/test/java/org/xwikiplatform/appwithinminutes/ClassEditSheetPageTest.java",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "20: package org.xwikiplatform.appwithinminutes;",
      "22: import java.util.List;",
      "24: import org.jsoup.nodes.Document;",
      "25: import org.junit.jupiter.api.BeforeEach;",
      "26: import org.junit.jupiter.api.Test;",
      "27: import org.mockito.Mock;",
      "28: import org.xwiki.groovy.internal.DefaultGroovyConfiguration;",
      "29: import org.xwiki.groovy.internal.GroovyScriptEngineFactory;",
      "30: import org.xwiki.model.reference.DocumentReference;",
      "31: import org.xwiki.query.Query;",
      "32: import org.xwiki.query.script.QueryManagerScriptService;",
      "33: import org.xwiki.rendering.internal.macro.groovy.GroovyMacro;",
      "34: import org.xwiki.rendering.syntax.Syntax;",
      "35: import org.xwiki.script.service.ScriptService;",
      "36: import org.xwiki.test.annotation.ComponentList;",
      "37: import org.xwiki.test.page.HTML50ComponentList;",
      "38: import org.xwiki.test.page.PageTest;",
      "39: import org.xwiki.test.page.XWikiSyntax21ComponentList;",
      "41: import com.xpn.xwiki.doc.XWikiDocument;",
      "43: import static org.junit.jupiter.api.Assertions.assertEquals;",
      "44: import static org.mockito.Mockito.when;",
      "54: @HTML50ComponentList",
      "55: @XWikiSyntax21ComponentList",
      "56: @ComponentList({",
      "58:     GroovyMacro.class,",
      "59:     GroovyScriptEngineFactory.class,",
      "60:     DefaultGroovyConfiguration.class",
      "62: })",
      "63: class ClassEditSheetPageTest extends PageTest",
      "64: {",
      "65:     private QueryManagerScriptService queryManagerScriptService;",
      "67:     @Mock",
      "68:     private Query query;",
      "70:     @BeforeEach",
      "71:     void setUp() throws Exception",
      "72:     {",
      "73:         this.queryManagerScriptService =",
      "74:             this.componentManager.registerMockComponent(ScriptService.class, \"query\", QueryManagerScriptService.class,",
      "75:                 false);",
      "76:     }",
      "78:     @Test",
      "79:     void displayFieldPalette() throws Exception",
      "80:     {",
      "81:         loadPage(new DocumentReference(\"xwiki\", \"AppWithinMinutes\", \"VelocityMacros\"));",
      "82:         loadPage(new DocumentReference(\"xwiki\", \"AppWithinMinutes\", \"ClassEditSheet\"));",
      "84:         when(this.queryManagerScriptService.xwql(\"from doc.object(AppWithinMinutes.FormFieldCategoryClass) as category \"",
      "85:             + \"order by category.priority\")).thenReturn(this.query);",
      "86:         when(this.query.execute()).thenReturn(List.of(\"xwiki:XWiki.Category\"));",
      "88:         XWikiDocument xWikiDocumentCategory =",
      "89:             this.xwiki.getDocument(new DocumentReference(\"xwiki\", \"XWiki\", \"Category\"), this.context);",
      "90:         xWikiDocumentCategory.setTitle(\"<strong>TITLE</strong>\");",
      "91:         this.xwiki.saveDocument(xWikiDocumentCategory, this.context);",
      "93:         XWikiDocument xwikiDocument =",
      "94:             this.xwiki.getDocument(new DocumentReference(\"xwiki\", \"Space\", \"Page\"), this.context);",
      "96:         xwikiDocument.setContent(\"{{include reference=\\\"AppWithinMinutes.ClassEditSheet\\\" /}}\\n\"",
      "97:             + \"\\n\"",
      "98:             + \"{{velocity}}\\n\"",
      "99:             + \"#displayFieldPalette()\\n\"",
      "100:             + \"{{/velocity}}\\n\");",
      "101:         xwikiDocument.setSyntax(Syntax.XWIKI_2_1);",
      "102:         this.xwiki.saveDocument(xwikiDocument, this.context);",
      "104:         Document document = renderHTMLPage(xwikiDocument);",
      "106:         assertEquals(\"<strong>TITLE</strong>\", document.selectFirst(\".category\").text());",
      "107:     }",
      "108: }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "55a6f5a40ccfd4ad099875e9db5a1a2e637f1713",
      "candidate_info": {
        "commit_hash": "55a6f5a40ccfd4ad099875e9db5a1a2e637f1713",
        "repo": "xwiki/xwiki-platform",
        "commit_url": "https://github.com/xwiki/xwiki-platform/commit/55a6f5a40ccfd4ad099875e9db5a1a2e637f1713",
        "files": [
          "xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/pom.xml",
          "xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/main/resources/AppWithinMinutes/ClassEditSheet.xml",
          "xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/test/java/org/xwikiplatform/appwithinminutes/ClassEditSheetPageTest.java"
        ],
        "message": "XWIKI-20365: Improved ClassEditSheet escaping",
        "before_after_code_files": [
          "xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/test/java/org/xwikiplatform/appwithinminutes/ClassEditSheetPageTest.java||xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/test/java/org/xwikiplatform/appwithinminutes/ClassEditSheetPageTest.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/test/java/org/xwikiplatform/appwithinminutes/ClassEditSheetPageTest.java||xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/test/java/org/xwikiplatform/appwithinminutes/ClassEditSheetPageTest.java"
          ],
          "candidate": [
            "xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/test/java/org/xwikiplatform/appwithinminutes/ClassEditSheetPageTest.java||xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/test/java/org/xwikiplatform/appwithinminutes/ClassEditSheetPageTest.java"
          ]
        }
      },
      "candidate_diff": {
        "xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/test/java/org/xwikiplatform/appwithinminutes/ClassEditSheetPageTest.java||xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/test/java/org/xwikiplatform/appwithinminutes/ClassEditSheetPageTest.java": [
          "File: xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/test/java/org/xwikiplatform/appwithinminutes/ClassEditSheetPageTest.java -> xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/test/java/org/xwikiplatform/appwithinminutes/ClassEditSheetPageTest.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "20: package org.xwikiplatform.appwithinminutes;",
          "22: import java.util.List;",
          "24: import org.jsoup.nodes.Document;",
          "25: import org.junit.jupiter.api.BeforeEach;",
          "26: import org.junit.jupiter.api.Test;",
          "27: import org.mockito.Mock;",
          "28: import org.xwiki.groovy.internal.DefaultGroovyConfiguration;",
          "29: import org.xwiki.groovy.internal.GroovyScriptEngineFactory;",
          "30: import org.xwiki.model.reference.DocumentReference;",
          "31: import org.xwiki.query.Query;",
          "32: import org.xwiki.query.script.QueryManagerScriptService;",
          "33: import org.xwiki.rendering.internal.macro.groovy.GroovyMacro;",
          "34: import org.xwiki.rendering.syntax.Syntax;",
          "35: import org.xwiki.script.service.ScriptService;",
          "36: import org.xwiki.test.annotation.ComponentList;",
          "37: import org.xwiki.test.page.HTML50ComponentList;",
          "38: import org.xwiki.test.page.PageTest;",
          "39: import org.xwiki.test.page.XWikiSyntax21ComponentList;",
          "41: import com.xpn.xwiki.doc.XWikiDocument;",
          "43: import static org.junit.jupiter.api.Assertions.assertEquals;",
          "44: import static org.mockito.Mockito.when;",
          "54: @HTML50ComponentList",
          "55: @XWikiSyntax21ComponentList",
          "56: @ComponentList({",
          "58:     GroovyMacro.class,",
          "59:     GroovyScriptEngineFactory.class,",
          "60:     DefaultGroovyConfiguration.class",
          "62: })",
          "63: class ClassEditSheetPageTest extends PageTest",
          "64: {",
          "65:     private QueryManagerScriptService queryManagerScriptService;",
          "67:     @Mock",
          "68:     private Query query;",
          "70:     @BeforeEach",
          "71:     void setUp() throws Exception",
          "72:     {",
          "73:         this.queryManagerScriptService =",
          "74:             this.componentManager.registerMockComponent(ScriptService.class, \"query\", QueryManagerScriptService.class,",
          "75:                 false);",
          "76:     }",
          "78:     @Test",
          "79:     void displayFieldPalette() throws Exception",
          "80:     {",
          "81:         loadPage(new DocumentReference(\"xwiki\", \"AppWithinMinutes\", \"VelocityMacros\"));",
          "82:         loadPage(new DocumentReference(\"xwiki\", \"AppWithinMinutes\", \"ClassEditSheet\"));",
          "84:         when(this.queryManagerScriptService.xwql(\"from doc.object(AppWithinMinutes.FormFieldCategoryClass) as category \"",
          "85:             + \"order by category.priority\")).thenReturn(this.query);",
          "86:         when(this.query.execute()).thenReturn(List.of(\"xwiki:XWiki.Category\"));",
          "88:         XWikiDocument xWikiDocumentCategory =",
          "89:             this.xwiki.getDocument(new DocumentReference(\"xwiki\", \"XWiki\", \"Category\"), this.context);",
          "90:         xWikiDocumentCategory.setTitle(\"<strong>TITLE</strong>\");",
          "91:         this.xwiki.saveDocument(xWikiDocumentCategory, this.context);",
          "93:         XWikiDocument xwikiDocument =",
          "94:             this.xwiki.getDocument(new DocumentReference(\"xwiki\", \"Space\", \"Page\"), this.context);",
          "96:         xwikiDocument.setContent(\"{{include reference=\\\"AppWithinMinutes.ClassEditSheet\\\" /}}\\n\"",
          "97:             + \"\\n\"",
          "98:             + \"{{velocity}}\\n\"",
          "99:             + \"#displayFieldPalette()\\n\"",
          "100:             + \"{{/velocity}}\\n\");",
          "101:         xwikiDocument.setSyntax(Syntax.XWIKI_2_1);",
          "102:         this.xwiki.saveDocument(xwikiDocument, this.context);",
          "104:         Document document = renderHTMLPage(xwikiDocument);",
          "106:         assertEquals(\"<strong>TITLE</strong>\", document.selectFirst(\".category\").text());",
          "107:     }",
          "108: }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "5c4be2f40270f64047113e69235896c07ee21a25",
      "candidate_info": {
        "commit_hash": "5c4be2f40270f64047113e69235896c07ee21a25",
        "repo": "xwiki/xwiki-platform",
        "commit_url": "https://github.com/xwiki/xwiki-platform/commit/5c4be2f40270f64047113e69235896c07ee21a25",
        "files": [
          "xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/pom.xml",
          "xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/main/resources/AppWithinMinutes/ClassEditSheet.xml",
          "xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/test/java/org/xwikiplatform/appwithinminutes/ClassEditSheetPageTest.java"
        ],
        "message": "XWIKI-20365: Improved ClassEditSheet escaping",
        "before_after_code_files": [
          "xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/test/java/org/xwikiplatform/appwithinminutes/ClassEditSheetPageTest.java||xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/test/java/org/xwikiplatform/appwithinminutes/ClassEditSheetPageTest.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/test/java/org/xwikiplatform/appwithinminutes/ClassEditSheetPageTest.java||xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/test/java/org/xwikiplatform/appwithinminutes/ClassEditSheetPageTest.java"
          ],
          "candidate": [
            "xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/test/java/org/xwikiplatform/appwithinminutes/ClassEditSheetPageTest.java||xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/test/java/org/xwikiplatform/appwithinminutes/ClassEditSheetPageTest.java"
          ]
        }
      },
      "candidate_diff": {
        "xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/test/java/org/xwikiplatform/appwithinminutes/ClassEditSheetPageTest.java||xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/test/java/org/xwikiplatform/appwithinminutes/ClassEditSheetPageTest.java": [
          "File: xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/test/java/org/xwikiplatform/appwithinminutes/ClassEditSheetPageTest.java -> xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/test/java/org/xwikiplatform/appwithinminutes/ClassEditSheetPageTest.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "20: package org.xwikiplatform.appwithinminutes;",
          "22: import java.util.List;",
          "24: import org.jsoup.nodes.Document;",
          "25: import org.junit.jupiter.api.BeforeEach;",
          "26: import org.junit.jupiter.api.Test;",
          "27: import org.mockito.Mock;",
          "28: import org.xwiki.groovy.internal.DefaultGroovyConfiguration;",
          "29: import org.xwiki.groovy.internal.GroovyScriptEngineFactory;",
          "30: import org.xwiki.model.reference.DocumentReference;",
          "31: import org.xwiki.query.Query;",
          "32: import org.xwiki.query.script.QueryManagerScriptService;",
          "33: import org.xwiki.rendering.internal.macro.groovy.GroovyMacro;",
          "34: import org.xwiki.rendering.syntax.Syntax;",
          "35: import org.xwiki.script.service.ScriptService;",
          "36: import org.xwiki.test.annotation.ComponentList;",
          "37: import org.xwiki.test.page.HTML50ComponentList;",
          "38: import org.xwiki.test.page.PageTest;",
          "39: import org.xwiki.test.page.XWikiSyntax21ComponentList;",
          "41: import com.xpn.xwiki.doc.XWikiDocument;",
          "43: import static org.junit.jupiter.api.Assertions.assertEquals;",
          "44: import static org.mockito.Mockito.when;",
          "54: @HTML50ComponentList",
          "55: @XWikiSyntax21ComponentList",
          "56: @ComponentList({",
          "58:     GroovyMacro.class,",
          "59:     GroovyScriptEngineFactory.class,",
          "60:     DefaultGroovyConfiguration.class",
          "62: })",
          "63: class ClassEditSheetPageTest extends PageTest",
          "64: {",
          "65:     private QueryManagerScriptService queryManagerScriptService;",
          "67:     @Mock",
          "68:     private Query query;",
          "70:     @BeforeEach",
          "71:     void setUp() throws Exception",
          "72:     {",
          "73:         this.queryManagerScriptService =",
          "74:             this.componentManager.registerMockComponent(ScriptService.class, \"query\", QueryManagerScriptService.class,",
          "75:                 false);",
          "76:     }",
          "78:     @Test",
          "79:     void displayFieldPalette() throws Exception",
          "80:     {",
          "81:         loadPage(new DocumentReference(\"xwiki\", \"AppWithinMinutes\", \"VelocityMacros\"));",
          "82:         loadPage(new DocumentReference(\"xwiki\", \"AppWithinMinutes\", \"ClassEditSheet\"));",
          "84:         when(this.queryManagerScriptService.xwql(\"from doc.object(AppWithinMinutes.FormFieldCategoryClass) as category \"",
          "85:             + \"order by category.priority\")).thenReturn(this.query);",
          "86:         when(this.query.execute()).thenReturn(List.of(\"xwiki:XWiki.Category\"));",
          "88:         XWikiDocument xWikiDocumentCategory =",
          "89:             this.xwiki.getDocument(new DocumentReference(\"xwiki\", \"XWiki\", \"Category\"), this.context);",
          "90:         xWikiDocumentCategory.setTitle(\"<strong>TITLE</strong>\");",
          "91:         this.xwiki.saveDocument(xWikiDocumentCategory, this.context);",
          "93:         XWikiDocument xwikiDocument =",
          "94:             this.xwiki.getDocument(new DocumentReference(\"xwiki\", \"Space\", \"Page\"), this.context);",
          "96:         xwikiDocument.setContent(\"{{include reference=\\\"AppWithinMinutes.ClassEditSheet\\\" /}}\\n\"",
          "97:             + \"\\n\"",
          "98:             + \"{{velocity}}\\n\"",
          "99:             + \"#displayFieldPalette()\\n\"",
          "100:             + \"{{/velocity}}\\n\");",
          "101:         xwikiDocument.setSyntax(Syntax.XWIKI_2_1);",
          "102:         this.xwiki.saveDocument(xwikiDocument, this.context);",
          "104:         Document document = renderHTMLPage(xwikiDocument);",
          "106:         assertEquals(\"<strong>TITLE</strong>\", document.selectFirst(\".category\").text());",
          "107:     }",
          "108: }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "6db9b97b3024319b07aecc9cc852d328d2979663",
      "candidate_info": {
        "commit_hash": "6db9b97b3024319b07aecc9cc852d328d2979663",
        "repo": "xwiki/xwiki-platform",
        "commit_url": "https://github.com/xwiki/xwiki-platform/commit/6db9b97b3024319b07aecc9cc852d328d2979663",
        "files": [
          "xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/pom.xml",
          "xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/main/resources/AppWithinMinutes/ClassEditSheet.xml",
          "xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/test/java/org/xwikiplatform/appwithinminutes/ClassEditSheetPageTest.java"
        ],
        "message": "XWIKI-20365: Improved ClassEditSheet escaping",
        "before_after_code_files": [
          "xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/test/java/org/xwikiplatform/appwithinminutes/ClassEditSheetPageTest.java||xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/test/java/org/xwikiplatform/appwithinminutes/ClassEditSheetPageTest.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/test/java/org/xwikiplatform/appwithinminutes/ClassEditSheetPageTest.java||xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/test/java/org/xwikiplatform/appwithinminutes/ClassEditSheetPageTest.java"
          ],
          "candidate": [
            "xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/test/java/org/xwikiplatform/appwithinminutes/ClassEditSheetPageTest.java||xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/test/java/org/xwikiplatform/appwithinminutes/ClassEditSheetPageTest.java"
          ]
        }
      },
      "candidate_diff": {
        "xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/test/java/org/xwikiplatform/appwithinminutes/ClassEditSheetPageTest.java||xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/test/java/org/xwikiplatform/appwithinminutes/ClassEditSheetPageTest.java": [
          "File: xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/test/java/org/xwikiplatform/appwithinminutes/ClassEditSheetPageTest.java -> xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/test/java/org/xwikiplatform/appwithinminutes/ClassEditSheetPageTest.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "20: package org.xwikiplatform.appwithinminutes;",
          "22: import java.util.List;",
          "24: import org.jsoup.nodes.Document;",
          "25: import org.junit.jupiter.api.BeforeEach;",
          "26: import org.junit.jupiter.api.Test;",
          "27: import org.mockito.Mock;",
          "28: import org.xwiki.groovy.internal.DefaultGroovyConfiguration;",
          "29: import org.xwiki.groovy.internal.GroovyScriptEngineFactory;",
          "30: import org.xwiki.model.reference.DocumentReference;",
          "31: import org.xwiki.query.Query;",
          "32: import org.xwiki.query.script.QueryManagerScriptService;",
          "33: import org.xwiki.rendering.internal.macro.groovy.GroovyMacro;",
          "34: import org.xwiki.rendering.syntax.Syntax;",
          "35: import org.xwiki.script.service.ScriptService;",
          "36: import org.xwiki.test.annotation.ComponentList;",
          "37: import org.xwiki.test.page.HTML50ComponentList;",
          "38: import org.xwiki.test.page.PageTest;",
          "39: import org.xwiki.test.page.XWikiSyntax21ComponentList;",
          "41: import com.xpn.xwiki.doc.XWikiDocument;",
          "43: import static org.junit.jupiter.api.Assertions.assertEquals;",
          "44: import static org.mockito.Mockito.when;",
          "54: @HTML50ComponentList",
          "55: @XWikiSyntax21ComponentList",
          "56: @ComponentList({",
          "58:     GroovyMacro.class,",
          "59:     GroovyScriptEngineFactory.class,",
          "60:     DefaultGroovyConfiguration.class",
          "62: })",
          "63: class ClassEditSheetPageTest extends PageTest",
          "64: {",
          "65:     private QueryManagerScriptService queryManagerScriptService;",
          "67:     @Mock",
          "68:     private Query query;",
          "70:     @BeforeEach",
          "71:     void setUp() throws Exception",
          "72:     {",
          "73:         this.queryManagerScriptService =",
          "74:             this.componentManager.registerMockComponent(ScriptService.class, \"query\", QueryManagerScriptService.class,",
          "75:                 false);",
          "76:     }",
          "78:     @Test",
          "79:     void displayFieldPalette() throws Exception",
          "80:     {",
          "81:         loadPage(new DocumentReference(\"xwiki\", \"AppWithinMinutes\", \"VelocityMacros\"));",
          "82:         loadPage(new DocumentReference(\"xwiki\", \"AppWithinMinutes\", \"ClassEditSheet\"));",
          "84:         when(this.queryManagerScriptService.xwql(\"from doc.object(AppWithinMinutes.FormFieldCategoryClass) as category \"",
          "85:             + \"order by category.priority\")).thenReturn(this.query);",
          "86:         when(this.query.execute()).thenReturn(List.of(\"xwiki:XWiki.Category\"));",
          "88:         XWikiDocument xWikiDocumentCategory =",
          "89:             this.xwiki.getDocument(new DocumentReference(\"xwiki\", \"XWiki\", \"Category\"), this.context);",
          "90:         xWikiDocumentCategory.setTitle(\"<strong>TITLE</strong>\");",
          "91:         this.xwiki.saveDocument(xWikiDocumentCategory, this.context);",
          "93:         XWikiDocument xwikiDocument =",
          "94:             this.xwiki.getDocument(new DocumentReference(\"xwiki\", \"Space\", \"Page\"), this.context);",
          "96:         xwikiDocument.setContent(\"{{include reference=\\\"AppWithinMinutes.ClassEditSheet\\\" /}}\\n\"",
          "97:             + \"\\n\"",
          "98:             + \"{{velocity}}\\n\"",
          "99:             + \"#displayFieldPalette()\\n\"",
          "100:             + \"{{/velocity}}\\n\");",
          "101:         xwikiDocument.setSyntax(Syntax.XWIKI_2_1);",
          "102:         this.xwiki.saveDocument(xwikiDocument, this.context);",
          "104:         Document document = renderHTMLPage(xwikiDocument);",
          "106:         assertEquals(\"<strong>TITLE</strong>\", document.selectFirst(\".category\").text());",
          "107:     }",
          "108: }",
          "",
          "---------------"
        ]
      }
    }
  ]
}