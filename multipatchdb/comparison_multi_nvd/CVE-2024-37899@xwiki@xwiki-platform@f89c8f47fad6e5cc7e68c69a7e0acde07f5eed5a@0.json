{
  "cve_id": "CVE-2024-37899",
  "cve_desc": "XWiki Platform is a generic wiki platform offering runtime services for applications built on top of it. When an admin disables a user account, the user's profile is executed with the admin's rights. This allows a user to place malicious code in the user profile before getting an admin to disable the user account. To reproduce, as a user without script nor programming rights, edit the about section of your user profile and add `{{groovy}}services.logging.getLogger(\"attacker\").error(\"Hello from Groovy!\"){{/groovy}}`.\nAs an admin, go to the user profile and click the \"Disable this account\" button. Then, reload the page. If the logs show `attacker - Hello from Groovy!` then the instance is vulnerable. This has been patched in XWiki 14.10.21, 15.5.5, 15.10.6 and 16.0.0. Users are advised to upgrade. There are no known workarounds for this vulnerability.\n\n### Workarounds\nWe're not aware of any workaround except upgrading.\n\n### References\n* https://jira.xwiki.org/browse/XWIKI-21611\n* https://github.com/xwiki/xwiki-platform/commit/f89c8f47fad6e5cc7e68c69a7e0acde07f5eed5a\n",
  "repo": "xwiki/xwiki-platform",
  "patch_hash": "f89c8f47fad6e5cc7e68c69a7e0acde07f5eed5a",
  "patch_info": {
    "commit_hash": "f89c8f47fad6e5cc7e68c69a7e0acde07f5eed5a",
    "repo": "xwiki/xwiki-platform",
    "commit_url": "https://github.com/xwiki/xwiki-platform/commit/f89c8f47fad6e5cc7e68c69a7e0acde07f5eed5a",
    "files": [
      "xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java",
      "xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java",
      "xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm"
    ],
    "message": "XWIKI-21611: Set right author when disabling/enabling an account\n\n* Set only the original metadata author in XWikiUser.setDisabled\n* Use the same disable/enable action everywhere\n* Remove no longer needed request parameters",
    "before_after_code_files": [
      "xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java||xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java",
      "xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java||xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java",
      "xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm||xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm"
    ]
  },
  "patch_diff": {
    "xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java||xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java": [
      "File: xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java -> xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java",
      "--- Hunk 1 ---",
      "[Context before]",
      "31: import org.xwiki.model.reference.EntityReferenceSerializer;",
      "32: import org.xwiki.model.reference.LocalDocumentReference;",
      "33: import org.xwiki.model.reference.WikiReference;",
      "35: import com.xpn.xwiki.XWiki;",
      "36: import com.xpn.xwiki.XWikiContext;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "34: import org.xwiki.user.UserReference;",
      "35: import org.xwiki.user.UserReferenceResolver;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "72:     private ContextualLocalizationManager localization;",
      "74:     private Logger logger = LoggerFactory.getLogger(XWikiUser.class);",
      "76:     private String fullName;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "76:     private UserReferenceResolver<DocumentReference> documentReferenceUserReferenceResolver;",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "204:         return localEntityReferenceSerializer;",
      "205:     }",
      "207:     private ContextualLocalizationManager getLocalization()",
      "208:     {",
      "209:         if (this.localization == null) {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "211:     private UserReferenceResolver<DocumentReference> getDocumentReferenceUserReferenceResolver()",
      "212:     {",
      "213:         if (this.documentReferenceUserReferenceResolver == null) {",
      "214:             this.documentReferenceUserReferenceResolver =",
      "215:                 Utils.getComponent(UserReferenceResolver.TYPE_DOCUMENT_REFERENCE, \"document\");",
      "216:         }",
      "217:         return this.documentReferenceUserReferenceResolver;",
      "218:     }",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "337:                 XWikiDocument userdoc = getUserDocument(context);",
      "338:                 userdoc.setIntValue(getUserClassReference(userdoc.getDocumentReference().getWikiReference()),",
      "339:                     ACTIVE_PROPERTY, activeFlag);",
      "341:                 context.getWiki().saveDocument(userdoc,",
      "342:                     localizePlainOrKey(\"core.users.\" + (disable ? \"disable\" : \"enable\") + \".saveComment\"), context);",
      "343:             } catch (XWikiException e) {",
      "",
      "[Removed Lines]",
      "340:                 userdoc.setAuthorReference(context.getUserReference());",
      "",
      "[Added Lines]",
      "353:                 UserReference userReference =",
      "354:                     getDocumentReferenceUserReferenceResolver().resolve(context.getUserReference());",
      "355:                 userdoc.getAuthors().setOriginalMetadataAuthor(userReference);",
      "",
      "---------------"
    ],
    "xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java||xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java": [
      "File: xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java -> xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java",
      "--- Hunk 1 ---",
      "[Context before]",
      "20: package com.xpn.xwiki.user.api;",
      "22: import org.junit.jupiter.api.BeforeEach;",
      "23: import org.junit.jupiter.api.Test;",
      "24: import org.mockito.Mock;",
      "25: import org.xwiki.localization.ContextualLocalizationManager;",
      "26: import org.xwiki.model.reference.DocumentReference;",
      "27: import org.xwiki.test.mockito.MockitoComponentManager;",
      "29: import com.xpn.xwiki.XWikiException;",
      "30: import com.xpn.xwiki.doc.XWikiDocument;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "22: import javax.inject.Named;",
      "28: import org.xwiki.model.document.DocumentAuthors;",
      "30: import org.xwiki.test.junit5.mockito.MockComponent;",
      "32: import org.xwiki.user.UserReferenceResolver;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "56:     @InjectMockitoOldcore",
      "57:     private MockitoOldcore mockitoOldcore;",
      "59:     @Mock",
      "60:     private XWikiDocument userDocument;",
      "66:     @BeforeEach",
      "67:     public void setup(MockitoComponentManager componentManager) throws Exception",
      "68:     {",
      "74:         componentManager.registerMockComponent(ContextualLocalizationManager.class, \"default\");",
      "75:     }",
      "",
      "[Removed Lines]",
      "62:     private DocumentReference userClassReference = new DocumentReference(\"xwiki\", \"XWiki\", \"XWikiUsers\");",
      "64:     private DocumentReference userReference = new DocumentReference(\"xwiki\", \"XWiki\", \"Foo\");",
      "69:         when(mockitoOldcore.getSpyXWiki().getDocument(userReference, mockitoOldcore.getXWikiContext()))",
      "70:             .thenReturn(userDocument);",
      "71:         when(userDocument.getDocumentReference()).thenReturn(userReference);",
      "72:         when(userDocument.getDocumentReferenceWithLocale()).thenReturn(userReference);",
      "73:         when(userDocument.clone()).thenReturn(userDocument);",
      "",
      "[Added Lines]",
      "64:     @MockComponent",
      "65:     @Named(\"document\")",
      "66:     private UserReferenceResolver<DocumentReference> documentReferenceUserReferenceResolver;",
      "71:     @Mock",
      "72:     private DocumentAuthors authors;",
      "74:     private final DocumentReference userClassReference = new DocumentReference(\"xwiki\", \"XWiki\", \"XWikiUsers\");",
      "76:     private final DocumentReference userReference = new DocumentReference(\"xwiki\", \"XWiki\", \"Foo\");",
      "81:         when(this.mockitoOldcore.getSpyXWiki().getDocument(this.userReference, this.mockitoOldcore.getXWikiContext()))",
      "82:             .thenReturn(this.userDocument);",
      "83:         when(this.userDocument.getDocumentReference()).thenReturn(this.userReference);",
      "84:         when(this.userDocument.getDocumentReferenceWithLocale()).thenReturn(this.userReference);",
      "85:         when(this.userDocument.getAuthors()).thenReturn(this.authors);",
      "86:         when(this.userDocument.clone()).thenReturn(this.userDocument);",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "95:     @Test",
      "96:     public void isDisabled()",
      "97:     {",
      "105:         user = new XWikiUser((DocumentReference) null);",
      "108:         user = new XWikiUser(XWikiRightService.SUPERADMIN_USER_FULLNAME);",
      "110:     }",
      "112:     @Test",
      "113:     public void setDisabledFalseNormalUser() throws XWikiException",
      "114:     {",
      "120:     }",
      "122:     @Test",
      "123:     public void setDisabledTrueNormalUser() throws XWikiException",
      "124:     {",
      "130:     }",
      "132:     @Test",
      "",
      "[Removed Lines]",
      "98:         XWikiUser user = new XWikiUser(userReference);",
      "99:         when(userDocument.getIntValue(userClassReference, XWikiUser.ACTIVE_PROPERTY, 1)).thenReturn(1);",
      "100:         assertFalse(user.isDisabled(mockitoOldcore.getXWikiContext()));",
      "102:         when(userDocument.getIntValue(userClassReference, XWikiUser.ACTIVE_PROPERTY, 1)).thenReturn(0);",
      "103:         assertTrue(user.isDisabled(mockitoOldcore.getXWikiContext()));",
      "106:         assertFalse(user.isDisabled(mockitoOldcore.getXWikiContext()));",
      "109:         assertFalse(user.isDisabled(mockitoOldcore.getXWikiContext()));",
      "115:         XWikiUser user = new XWikiUser(userReference);",
      "116:         user.setDisabled(false, mockitoOldcore.getXWikiContext());",
      "117:         verify(userDocument, times(1)).setIntValue(userClassReference, XWikiUser.ACTIVE_PROPERTY, 1);",
      "118:         verify(mockitoOldcore.getSpyXWiki(), times(1))",
      "119:             .saveDocument(same(userDocument), any(String.class), same(mockitoOldcore.getXWikiContext()));",
      "125:         XWikiUser user = new XWikiUser(userReference);",
      "126:         user.setDisabled(true, mockitoOldcore.getXWikiContext());",
      "127:         verify(userDocument, times(1)).setIntValue(userClassReference, XWikiUser.ACTIVE_PROPERTY, 0);",
      "128:         verify(mockitoOldcore.getSpyXWiki(), times(1))",
      "129:             .saveDocument(same(userDocument), any(String.class), same(mockitoOldcore.getXWikiContext()));",
      "",
      "[Added Lines]",
      "111:         XWikiUser user = new XWikiUser(this.userReference);",
      "112:         when(this.userDocument.getIntValue(this.userClassReference, XWikiUser.ACTIVE_PROPERTY, 1)).thenReturn(1);",
      "113:         assertFalse(user.isDisabled(this.mockitoOldcore.getXWikiContext()));",
      "115:         when(this.userDocument.getIntValue(this.userClassReference, XWikiUser.ACTIVE_PROPERTY, 1)).thenReturn(0);",
      "116:         assertTrue(user.isDisabled(this.mockitoOldcore.getXWikiContext()));",
      "119:         assertFalse(user.isDisabled(this.mockitoOldcore.getXWikiContext()));",
      "122:         assertFalse(user.isDisabled(this.mockitoOldcore.getXWikiContext()));",
      "128:         XWikiUser user = new XWikiUser(this.userReference);",
      "129:         user.setDisabled(false, this.mockitoOldcore.getXWikiContext());",
      "130:         verify(this.userDocument, times(1)).setIntValue(this.userClassReference, XWikiUser.ACTIVE_PROPERTY, 1);",
      "131:         verify(this.mockitoOldcore.getSpyXWiki(), times(1))",
      "132:             .saveDocument(same(this.userDocument), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
      "133:         verify(this.authors, times(1)).setOriginalMetadataAuthor(any());",
      "134:         verify(this.authors, never()).setEffectiveMetadataAuthor(any());",
      "140:         XWikiUser user = new XWikiUser(this.userReference);",
      "141:         user.setDisabled(true, this.mockitoOldcore.getXWikiContext());",
      "142:         verify(this.userDocument, times(1)).setIntValue(this.userClassReference, XWikiUser.ACTIVE_PROPERTY, 0);",
      "143:         verify(this.mockitoOldcore.getSpyXWiki(), times(1))",
      "144:             .saveDocument(same(this.userDocument), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
      "145:         verify(this.authors, times(1)).setOriginalMetadataAuthor(any());",
      "146:         verify(this.authors, never()).setEffectiveMetadataAuthor(any());",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "134:     {",
      "136:         XWikiUser user = new XWikiUser((DocumentReference) null);",
      "150:         user = new XWikiUser(XWikiRightService.SUPERADMIN_USER_FULLNAME);",
      "162:     }",
      "164:     @Test",
      "165:     public void isEmailChecked()",
      "166:     {",
      "174:         user = new XWikiUser((DocumentReference) null);",
      "177:         user = new XWikiUser(XWikiRightService.SUPERADMIN_USER_FULLNAME);",
      "179:     }",
      "181:     @Test",
      "182:     public void setEmailCheckedFalseNormalUser() throws XWikiException",
      "183:     {",
      "189:     }",
      "191:     @Test",
      "192:     public void setEmailCheckedTrueNormalUser() throws XWikiException",
      "193:     {",
      "199:     }",
      "201:     @Test",
      "",
      "[Removed Lines]",
      "137:         user.setDisabled(true, mockitoOldcore.getXWikiContext());",
      "138:         verify(userDocument, never())",
      "139:             .setIntValue(same(userClassReference), any(String.class), any(Integer.class));",
      "140:         verify(mockitoOldcore.getSpyXWiki(), never())",
      "141:             .saveDocument(any(XWikiDocument.class), any(String.class), same(mockitoOldcore.getXWikiContext()));",
      "143:         user.setDisabled(false, mockitoOldcore.getXWikiContext());",
      "144:         verify(userDocument, never())",
      "145:             .setIntValue(same(userClassReference), any(String.class), any(Integer.class));",
      "146:         verify(mockitoOldcore.getSpyXWiki(), never())",
      "147:             .saveDocument(any(XWikiDocument.class), any(String.class), same(mockitoOldcore.getXWikiContext()));",
      "151:         user.setDisabled(true, mockitoOldcore.getXWikiContext());",
      "152:         verify(userDocument, never())",
      "153:             .setIntValue(same(userClassReference), any(String.class), any(Integer.class));",
      "154:         verify(mockitoOldcore.getSpyXWiki(), never())",
      "155:             .saveDocument(any(XWikiDocument.class), any(String.class), same(mockitoOldcore.getXWikiContext()));",
      "157:         user.setDisabled(false, mockitoOldcore.getXWikiContext());",
      "158:         verify(userDocument, never())",
      "159:             .setIntValue(same(userClassReference), any(String.class), any(Integer.class));",
      "160:         verify(mockitoOldcore.getSpyXWiki(), never())",
      "161:             .saveDocument(any(XWikiDocument.class), any(String.class), same(mockitoOldcore.getXWikiContext()));",
      "167:         XWikiUser user = new XWikiUser(userReference);",
      "168:         when(userDocument.getIntValue(userClassReference, XWikiUser.EMAIL_CHECKED_PROPERTY, 1)).thenReturn(1);",
      "169:         assertTrue(user.isEmailChecked(mockitoOldcore.getXWikiContext()));",
      "171:         when(userDocument.getIntValue(userClassReference, XWikiUser.EMAIL_CHECKED_PROPERTY, 1)).thenReturn(0);",
      "172:         assertFalse(user.isEmailChecked(mockitoOldcore.getXWikiContext()));",
      "175:         assertTrue(user.isEmailChecked(mockitoOldcore.getXWikiContext()));",
      "178:         assertTrue(user.isEmailChecked(mockitoOldcore.getXWikiContext()));",
      "184:         XWikiUser user = new XWikiUser(userReference);",
      "185:         user.setEmailChecked(false, mockitoOldcore.getXWikiContext());",
      "186:         verify(userDocument, times(1)).setIntValue(userClassReference, XWikiUser.EMAIL_CHECKED_PROPERTY, 0);",
      "187:         verify(mockitoOldcore.getSpyXWiki(), times(1))",
      "188:             .saveDocument(same(userDocument), any(String.class), same(mockitoOldcore.getXWikiContext()));",
      "194:         XWikiUser user = new XWikiUser(userReference);",
      "195:         user.setEmailChecked(true, mockitoOldcore.getXWikiContext());",
      "196:         verify(userDocument, times(1)).setIntValue(userClassReference, XWikiUser.EMAIL_CHECKED_PROPERTY, 1);",
      "197:         verify(mockitoOldcore.getSpyXWiki(), times(1))",
      "198:             .saveDocument(same(userDocument), any(String.class), same(mockitoOldcore.getXWikiContext()));",
      "",
      "[Added Lines]",
      "154:         user.setDisabled(true, this.mockitoOldcore.getXWikiContext());",
      "155:         verify(this.userDocument, never())",
      "156:             .setIntValue(same(this.userClassReference), any(String.class), any(Integer.class));",
      "157:         verify(this.mockitoOldcore.getSpyXWiki(), never())",
      "158:             .saveDocument(any(XWikiDocument.class), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
      "160:         user.setDisabled(false, this.mockitoOldcore.getXWikiContext());",
      "161:         verify(this.userDocument, never())",
      "162:             .setIntValue(same(this.userClassReference), any(String.class), any(Integer.class));",
      "163:         verify(this.mockitoOldcore.getSpyXWiki(), never())",
      "164:             .saveDocument(any(XWikiDocument.class), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
      "168:         user.setDisabled(true, this.mockitoOldcore.getXWikiContext());",
      "169:         verify(this.userDocument, never())",
      "170:             .setIntValue(same(this.userClassReference), any(String.class), any(Integer.class));",
      "171:         verify(this.mockitoOldcore.getSpyXWiki(), never())",
      "172:             .saveDocument(any(XWikiDocument.class), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
      "174:         user.setDisabled(false, this.mockitoOldcore.getXWikiContext());",
      "175:         verify(this.userDocument, never())",
      "176:             .setIntValue(same(this.userClassReference), any(String.class), any(Integer.class));",
      "177:         verify(this.mockitoOldcore.getSpyXWiki(), never())",
      "178:             .saveDocument(any(XWikiDocument.class), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
      "184:         XWikiUser user = new XWikiUser(this.userReference);",
      "185:         when(this.userDocument.getIntValue(this.userClassReference, XWikiUser.EMAIL_CHECKED_PROPERTY, 1)).thenReturn(1);",
      "186:         assertTrue(user.isEmailChecked(this.mockitoOldcore.getXWikiContext()));",
      "188:         when(this.userDocument.getIntValue(this.userClassReference, XWikiUser.EMAIL_CHECKED_PROPERTY, 1)).thenReturn(0);",
      "189:         assertFalse(user.isEmailChecked(this.mockitoOldcore.getXWikiContext()));",
      "192:         assertTrue(user.isEmailChecked(this.mockitoOldcore.getXWikiContext()));",
      "195:         assertTrue(user.isEmailChecked(this.mockitoOldcore.getXWikiContext()));",
      "201:         XWikiUser user = new XWikiUser(this.userReference);",
      "202:         user.setEmailChecked(false, this.mockitoOldcore.getXWikiContext());",
      "203:         verify(this.userDocument, times(1)).setIntValue(this.userClassReference, XWikiUser.EMAIL_CHECKED_PROPERTY, 0);",
      "204:         verify(this.mockitoOldcore.getSpyXWiki(), times(1))",
      "205:             .saveDocument(same(this.userDocument), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
      "211:         XWikiUser user = new XWikiUser(this.userReference);",
      "212:         user.setEmailChecked(true, this.mockitoOldcore.getXWikiContext());",
      "213:         verify(this.userDocument, times(1)).setIntValue(this.userClassReference, XWikiUser.EMAIL_CHECKED_PROPERTY, 1);",
      "214:         verify(this.mockitoOldcore.getSpyXWiki(), times(1))",
      "215:             .saveDocument(same(this.userDocument), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "203:     {",
      "205:         XWikiUser user = new XWikiUser((DocumentReference) null);",
      "219:         user = new XWikiUser(XWikiRightService.SUPERADMIN_USER_FULLNAME);",
      "231:     }",
      "232: }",
      "",
      "[Removed Lines]",
      "206:         user.setEmailChecked(true, mockitoOldcore.getXWikiContext());",
      "207:         verify(userDocument, never())",
      "208:             .setIntValue(same(userClassReference), any(String.class), any(Integer.class));",
      "209:         verify(mockitoOldcore.getSpyXWiki(), never())",
      "210:             .saveDocument(any(XWikiDocument.class), any(String.class), same(mockitoOldcore.getXWikiContext()));",
      "212:         user.setEmailChecked(false, mockitoOldcore.getXWikiContext());",
      "213:         verify(userDocument, never())",
      "214:             .setIntValue(same(userClassReference), any(String.class), any(Integer.class));",
      "215:         verify(mockitoOldcore.getSpyXWiki(), never())",
      "216:             .saveDocument(any(XWikiDocument.class), any(String.class), same(mockitoOldcore.getXWikiContext()));",
      "220:         user.setEmailChecked(true, mockitoOldcore.getXWikiContext());",
      "221:         verify(userDocument, never())",
      "222:             .setIntValue(same(userClassReference), any(String.class), any(Integer.class));",
      "223:         verify(mockitoOldcore.getSpyXWiki(), never())",
      "224:             .saveDocument(any(XWikiDocument.class), any(String.class), same(mockitoOldcore.getXWikiContext()));",
      "226:         user.setEmailChecked(false, mockitoOldcore.getXWikiContext());",
      "227:         verify(userDocument, never())",
      "228:             .setIntValue(same(userClassReference), any(String.class), any(Integer.class));",
      "229:         verify(mockitoOldcore.getSpyXWiki(), never())",
      "230:             .saveDocument(any(XWikiDocument.class), any(String.class), same(mockitoOldcore.getXWikiContext()));",
      "",
      "[Added Lines]",
      "223:         user.setEmailChecked(true, this.mockitoOldcore.getXWikiContext());",
      "224:         verify(this.userDocument, never())",
      "225:             .setIntValue(same(this.userClassReference), any(String.class), any(Integer.class));",
      "226:         verify(this.mockitoOldcore.getSpyXWiki(), never())",
      "227:             .saveDocument(any(XWikiDocument.class), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
      "229:         user.setEmailChecked(false, this.mockitoOldcore.getXWikiContext());",
      "230:         verify(this.userDocument, never())",
      "231:             .setIntValue(same(this.userClassReference), any(String.class), any(Integer.class));",
      "232:         verify(this.mockitoOldcore.getSpyXWiki(), never())",
      "233:             .saveDocument(any(XWikiDocument.class), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
      "237:         user.setEmailChecked(true, this.mockitoOldcore.getXWikiContext());",
      "238:         verify(this.userDocument, never())",
      "239:             .setIntValue(same(this.userClassReference), any(String.class), any(Integer.class));",
      "240:         verify(this.mockitoOldcore.getSpyXWiki(), never())",
      "241:             .saveDocument(any(XWikiDocument.class), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
      "243:         user.setEmailChecked(false, this.mockitoOldcore.getXWikiContext());",
      "244:         verify(this.userDocument, never())",
      "245:             .setIntValue(same(this.userClassReference), any(String.class), any(Integer.class));",
      "246:         verify(this.mockitoOldcore.getSpyXWiki(), never())",
      "247:             .saveDocument(any(XWikiDocument.class), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
      "",
      "---------------"
    ],
    "xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm||xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm": [
      "File: xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm -> xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm",
      "--- Hunk 1 ---",
      "[Context before]",
      "128:       'doc_hasdelete': $hasDelete,",
      "129:       'doc_delete_url': $user.getURL('delete'),",
      "130:       'doc_hasdisable': $hasDisable,",
      "135:       })),",
      "136:       'doc_hasenable': $hasEnable,",
      "141:       })),",
      "142:       'name': \"#displayUserAliasWithAvatar($user.documentReference $disabled)\",",
      "143:       'first_name': $userObject.getValue('first_name'),",
      "",
      "[Removed Lines]",
      "131:       'doc_disable_url': $user.getURL('save', $escapetool.url({",
      "132:         \"${userClassName}_0_active\": 0,",
      "133:         'comment': $services.localization.render('core.users.disable.saveComment'),",
      "134:         'form_token': $services.csrf.token",
      "137:       'doc_enable_url': $user.getURL('save', $escapetool.url({",
      "138:         \"${userClassName}_0_active\": 1,",
      "139:         'comment': $services.localization.render('core.users.enable.saveComment'),",
      "140:         'form_token': $services.csrf.token",
      "",
      "[Added Lines]",
      "131:       'doc_disable_url': $xwiki.getURL('XWiki.XWikiUserProfileSheet', 'get', $escapetool.url({",
      "132:         'outputSyntax': 'plain',",
      "133:         'action': 'disable',",
      "134:         'userId': $user.documentReference,",
      "135:         'csrf': $services.csrf.token",
      "138:       'doc_enable_url': $xwiki.getURL('XWiki.XWikiUserProfileSheet', 'get', $escapetool.url({",
      "139:         'outputSyntax': 'plain',",
      "140:         'action': 'enable',",
      "141:         'userId': $user.documentReference,",
      "142:         'csrf': $services.csrf.token",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "cf8d5b73a911199be8ac91a98a3ec2e3e8d7529f",
      "candidate_info": {
        "commit_hash": "cf8d5b73a911199be8ac91a98a3ec2e3e8d7529f",
        "repo": "xwiki/xwiki-platform",
        "commit_url": "https://github.com/xwiki/xwiki-platform/commit/cf8d5b73a911199be8ac91a98a3ec2e3e8d7529f",
        "files": [
          "xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java",
          "xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java",
          "xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm"
        ],
        "message": "XWIKI-21611: Set right author when disabling/enabling an account\n\n* Set only the original metadata author in XWikiUser.setDisabled\n* Use the same disable/enable action everywhere\n* Remove no longer needed request parameters\n\n(cherry picked from commit f89c8f47fad6e5cc7e68c69a7e0acde07f5eed5a)",
        "before_after_code_files": [
          "xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java||xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java",
          "xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java||xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java",
          "xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm||xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java||xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java",
            "xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java||xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java",
            "xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm||xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm"
          ],
          "candidate": [
            "xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java||xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java",
            "xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java||xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java",
            "xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm||xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm"
          ]
        }
      },
      "candidate_diff": {
        "xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java||xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java": [
          "File: xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java -> xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "31: import org.xwiki.model.reference.EntityReferenceSerializer;",
          "32: import org.xwiki.model.reference.LocalDocumentReference;",
          "33: import org.xwiki.model.reference.WikiReference;",
          "35: import com.xpn.xwiki.XWiki;",
          "36: import com.xpn.xwiki.XWikiContext;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "34: import org.xwiki.user.UserReference;",
          "35: import org.xwiki.user.UserReferenceResolver;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "72:     private ContextualLocalizationManager localization;",
          "74:     private Logger logger = LoggerFactory.getLogger(XWikiUser.class);",
          "76:     private String fullName;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "76:     private UserReferenceResolver<DocumentReference> documentReferenceUserReferenceResolver;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "204:         return localEntityReferenceSerializer;",
          "205:     }",
          "207:     private ContextualLocalizationManager getLocalization()",
          "208:     {",
          "209:         if (this.localization == null) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "211:     private UserReferenceResolver<DocumentReference> getDocumentReferenceUserReferenceResolver()",
          "212:     {",
          "213:         if (this.documentReferenceUserReferenceResolver == null) {",
          "214:             this.documentReferenceUserReferenceResolver =",
          "215:                 Utils.getComponent(UserReferenceResolver.TYPE_DOCUMENT_REFERENCE, \"document\");",
          "216:         }",
          "217:         return this.documentReferenceUserReferenceResolver;",
          "218:     }",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "337:                 XWikiDocument userdoc = getUserDocument(context);",
          "338:                 userdoc.setIntValue(getUserClassReference(userdoc.getDocumentReference().getWikiReference()),",
          "339:                     ACTIVE_PROPERTY, activeFlag);",
          "341:                 context.getWiki().saveDocument(userdoc,",
          "342:                     localizePlainOrKey(\"core.users.\" + (disable ? \"disable\" : \"enable\") + \".saveComment\"), context);",
          "343:             } catch (XWikiException e) {",
          "",
          "[Removed Lines]",
          "340:                 userdoc.setAuthorReference(context.getUserReference());",
          "",
          "[Added Lines]",
          "353:                 UserReference userReference =",
          "354:                     getDocumentReferenceUserReferenceResolver().resolve(context.getUserReference());",
          "355:                 userdoc.getAuthors().setOriginalMetadataAuthor(userReference);",
          "",
          "---------------"
        ],
        "xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java||xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java": [
          "File: xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java -> xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "20: package com.xpn.xwiki.user.api;",
          "22: import org.junit.jupiter.api.BeforeEach;",
          "23: import org.junit.jupiter.api.Test;",
          "24: import org.mockito.Mock;",
          "25: import org.xwiki.localization.ContextualLocalizationManager;",
          "26: import org.xwiki.model.reference.DocumentReference;",
          "27: import org.xwiki.test.mockito.MockitoComponentManager;",
          "29: import com.xpn.xwiki.XWikiException;",
          "30: import com.xpn.xwiki.doc.XWikiDocument;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "22: import javax.inject.Named;",
          "28: import org.xwiki.model.document.DocumentAuthors;",
          "30: import org.xwiki.test.junit5.mockito.MockComponent;",
          "32: import org.xwiki.user.UserReferenceResolver;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "56:     @InjectMockitoOldcore",
          "57:     private MockitoOldcore mockitoOldcore;",
          "59:     @Mock",
          "60:     private XWikiDocument userDocument;",
          "66:     @BeforeEach",
          "67:     public void setup(MockitoComponentManager componentManager) throws Exception",
          "68:     {",
          "74:         componentManager.registerMockComponent(ContextualLocalizationManager.class, \"default\");",
          "75:     }",
          "",
          "[Removed Lines]",
          "62:     private DocumentReference userClassReference = new DocumentReference(\"xwiki\", \"XWiki\", \"XWikiUsers\");",
          "64:     private DocumentReference userReference = new DocumentReference(\"xwiki\", \"XWiki\", \"Foo\");",
          "69:         when(mockitoOldcore.getSpyXWiki().getDocument(userReference, mockitoOldcore.getXWikiContext()))",
          "70:             .thenReturn(userDocument);",
          "71:         when(userDocument.getDocumentReference()).thenReturn(userReference);",
          "72:         when(userDocument.getDocumentReferenceWithLocale()).thenReturn(userReference);",
          "73:         when(userDocument.clone()).thenReturn(userDocument);",
          "",
          "[Added Lines]",
          "64:     @MockComponent",
          "65:     @Named(\"document\")",
          "66:     private UserReferenceResolver<DocumentReference> documentReferenceUserReferenceResolver;",
          "71:     @Mock",
          "72:     private DocumentAuthors authors;",
          "74:     private final DocumentReference userClassReference = new DocumentReference(\"xwiki\", \"XWiki\", \"XWikiUsers\");",
          "76:     private final DocumentReference userReference = new DocumentReference(\"xwiki\", \"XWiki\", \"Foo\");",
          "81:         when(this.mockitoOldcore.getSpyXWiki().getDocument(this.userReference, this.mockitoOldcore.getXWikiContext()))",
          "82:             .thenReturn(this.userDocument);",
          "83:         when(this.userDocument.getDocumentReference()).thenReturn(this.userReference);",
          "84:         when(this.userDocument.getDocumentReferenceWithLocale()).thenReturn(this.userReference);",
          "85:         when(this.userDocument.getAuthors()).thenReturn(this.authors);",
          "86:         when(this.userDocument.clone()).thenReturn(this.userDocument);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "95:     @Test",
          "96:     public void isDisabled()",
          "97:     {",
          "105:         user = new XWikiUser((DocumentReference) null);",
          "108:         user = new XWikiUser(XWikiRightService.SUPERADMIN_USER_FULLNAME);",
          "110:     }",
          "112:     @Test",
          "113:     public void setDisabledFalseNormalUser() throws XWikiException",
          "114:     {",
          "120:     }",
          "122:     @Test",
          "123:     public void setDisabledTrueNormalUser() throws XWikiException",
          "124:     {",
          "130:     }",
          "132:     @Test",
          "",
          "[Removed Lines]",
          "98:         XWikiUser user = new XWikiUser(userReference);",
          "99:         when(userDocument.getIntValue(userClassReference, XWikiUser.ACTIVE_PROPERTY, 1)).thenReturn(1);",
          "100:         assertFalse(user.isDisabled(mockitoOldcore.getXWikiContext()));",
          "102:         when(userDocument.getIntValue(userClassReference, XWikiUser.ACTIVE_PROPERTY, 1)).thenReturn(0);",
          "103:         assertTrue(user.isDisabled(mockitoOldcore.getXWikiContext()));",
          "106:         assertFalse(user.isDisabled(mockitoOldcore.getXWikiContext()));",
          "109:         assertFalse(user.isDisabled(mockitoOldcore.getXWikiContext()));",
          "115:         XWikiUser user = new XWikiUser(userReference);",
          "116:         user.setDisabled(false, mockitoOldcore.getXWikiContext());",
          "117:         verify(userDocument, times(1)).setIntValue(userClassReference, XWikiUser.ACTIVE_PROPERTY, 1);",
          "118:         verify(mockitoOldcore.getSpyXWiki(), times(1))",
          "119:             .saveDocument(same(userDocument), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "125:         XWikiUser user = new XWikiUser(userReference);",
          "126:         user.setDisabled(true, mockitoOldcore.getXWikiContext());",
          "127:         verify(userDocument, times(1)).setIntValue(userClassReference, XWikiUser.ACTIVE_PROPERTY, 0);",
          "128:         verify(mockitoOldcore.getSpyXWiki(), times(1))",
          "129:             .saveDocument(same(userDocument), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "",
          "[Added Lines]",
          "111:         XWikiUser user = new XWikiUser(this.userReference);",
          "112:         when(this.userDocument.getIntValue(this.userClassReference, XWikiUser.ACTIVE_PROPERTY, 1)).thenReturn(1);",
          "113:         assertFalse(user.isDisabled(this.mockitoOldcore.getXWikiContext()));",
          "115:         when(this.userDocument.getIntValue(this.userClassReference, XWikiUser.ACTIVE_PROPERTY, 1)).thenReturn(0);",
          "116:         assertTrue(user.isDisabled(this.mockitoOldcore.getXWikiContext()));",
          "119:         assertFalse(user.isDisabled(this.mockitoOldcore.getXWikiContext()));",
          "122:         assertFalse(user.isDisabled(this.mockitoOldcore.getXWikiContext()));",
          "128:         XWikiUser user = new XWikiUser(this.userReference);",
          "129:         user.setDisabled(false, this.mockitoOldcore.getXWikiContext());",
          "130:         verify(this.userDocument, times(1)).setIntValue(this.userClassReference, XWikiUser.ACTIVE_PROPERTY, 1);",
          "131:         verify(this.mockitoOldcore.getSpyXWiki(), times(1))",
          "132:             .saveDocument(same(this.userDocument), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "133:         verify(this.authors, times(1)).setOriginalMetadataAuthor(any());",
          "134:         verify(this.authors, never()).setEffectiveMetadataAuthor(any());",
          "140:         XWikiUser user = new XWikiUser(this.userReference);",
          "141:         user.setDisabled(true, this.mockitoOldcore.getXWikiContext());",
          "142:         verify(this.userDocument, times(1)).setIntValue(this.userClassReference, XWikiUser.ACTIVE_PROPERTY, 0);",
          "143:         verify(this.mockitoOldcore.getSpyXWiki(), times(1))",
          "144:             .saveDocument(same(this.userDocument), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "145:         verify(this.authors, times(1)).setOriginalMetadataAuthor(any());",
          "146:         verify(this.authors, never()).setEffectiveMetadataAuthor(any());",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "134:     {",
          "136:         XWikiUser user = new XWikiUser((DocumentReference) null);",
          "150:         user = new XWikiUser(XWikiRightService.SUPERADMIN_USER_FULLNAME);",
          "162:     }",
          "164:     @Test",
          "165:     public void isEmailChecked()",
          "166:     {",
          "174:         user = new XWikiUser((DocumentReference) null);",
          "177:         user = new XWikiUser(XWikiRightService.SUPERADMIN_USER_FULLNAME);",
          "179:     }",
          "181:     @Test",
          "182:     public void setEmailCheckedFalseNormalUser() throws XWikiException",
          "183:     {",
          "189:     }",
          "191:     @Test",
          "192:     public void setEmailCheckedTrueNormalUser() throws XWikiException",
          "193:     {",
          "199:     }",
          "201:     @Test",
          "",
          "[Removed Lines]",
          "137:         user.setDisabled(true, mockitoOldcore.getXWikiContext());",
          "138:         verify(userDocument, never())",
          "139:             .setIntValue(same(userClassReference), any(String.class), any(Integer.class));",
          "140:         verify(mockitoOldcore.getSpyXWiki(), never())",
          "141:             .saveDocument(any(XWikiDocument.class), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "143:         user.setDisabled(false, mockitoOldcore.getXWikiContext());",
          "144:         verify(userDocument, never())",
          "145:             .setIntValue(same(userClassReference), any(String.class), any(Integer.class));",
          "146:         verify(mockitoOldcore.getSpyXWiki(), never())",
          "147:             .saveDocument(any(XWikiDocument.class), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "151:         user.setDisabled(true, mockitoOldcore.getXWikiContext());",
          "152:         verify(userDocument, never())",
          "153:             .setIntValue(same(userClassReference), any(String.class), any(Integer.class));",
          "154:         verify(mockitoOldcore.getSpyXWiki(), never())",
          "155:             .saveDocument(any(XWikiDocument.class), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "157:         user.setDisabled(false, mockitoOldcore.getXWikiContext());",
          "158:         verify(userDocument, never())",
          "159:             .setIntValue(same(userClassReference), any(String.class), any(Integer.class));",
          "160:         verify(mockitoOldcore.getSpyXWiki(), never())",
          "161:             .saveDocument(any(XWikiDocument.class), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "167:         XWikiUser user = new XWikiUser(userReference);",
          "168:         when(userDocument.getIntValue(userClassReference, XWikiUser.EMAIL_CHECKED_PROPERTY, 1)).thenReturn(1);",
          "169:         assertTrue(user.isEmailChecked(mockitoOldcore.getXWikiContext()));",
          "171:         when(userDocument.getIntValue(userClassReference, XWikiUser.EMAIL_CHECKED_PROPERTY, 1)).thenReturn(0);",
          "172:         assertFalse(user.isEmailChecked(mockitoOldcore.getXWikiContext()));",
          "175:         assertTrue(user.isEmailChecked(mockitoOldcore.getXWikiContext()));",
          "178:         assertTrue(user.isEmailChecked(mockitoOldcore.getXWikiContext()));",
          "184:         XWikiUser user = new XWikiUser(userReference);",
          "185:         user.setEmailChecked(false, mockitoOldcore.getXWikiContext());",
          "186:         verify(userDocument, times(1)).setIntValue(userClassReference, XWikiUser.EMAIL_CHECKED_PROPERTY, 0);",
          "187:         verify(mockitoOldcore.getSpyXWiki(), times(1))",
          "188:             .saveDocument(same(userDocument), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "194:         XWikiUser user = new XWikiUser(userReference);",
          "195:         user.setEmailChecked(true, mockitoOldcore.getXWikiContext());",
          "196:         verify(userDocument, times(1)).setIntValue(userClassReference, XWikiUser.EMAIL_CHECKED_PROPERTY, 1);",
          "197:         verify(mockitoOldcore.getSpyXWiki(), times(1))",
          "198:             .saveDocument(same(userDocument), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "",
          "[Added Lines]",
          "154:         user.setDisabled(true, this.mockitoOldcore.getXWikiContext());",
          "155:         verify(this.userDocument, never())",
          "156:             .setIntValue(same(this.userClassReference), any(String.class), any(Integer.class));",
          "157:         verify(this.mockitoOldcore.getSpyXWiki(), never())",
          "158:             .saveDocument(any(XWikiDocument.class), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "160:         user.setDisabled(false, this.mockitoOldcore.getXWikiContext());",
          "161:         verify(this.userDocument, never())",
          "162:             .setIntValue(same(this.userClassReference), any(String.class), any(Integer.class));",
          "163:         verify(this.mockitoOldcore.getSpyXWiki(), never())",
          "164:             .saveDocument(any(XWikiDocument.class), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "168:         user.setDisabled(true, this.mockitoOldcore.getXWikiContext());",
          "169:         verify(this.userDocument, never())",
          "170:             .setIntValue(same(this.userClassReference), any(String.class), any(Integer.class));",
          "171:         verify(this.mockitoOldcore.getSpyXWiki(), never())",
          "172:             .saveDocument(any(XWikiDocument.class), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "174:         user.setDisabled(false, this.mockitoOldcore.getXWikiContext());",
          "175:         verify(this.userDocument, never())",
          "176:             .setIntValue(same(this.userClassReference), any(String.class), any(Integer.class));",
          "177:         verify(this.mockitoOldcore.getSpyXWiki(), never())",
          "178:             .saveDocument(any(XWikiDocument.class), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "184:         XWikiUser user = new XWikiUser(this.userReference);",
          "185:         when(this.userDocument.getIntValue(this.userClassReference, XWikiUser.EMAIL_CHECKED_PROPERTY, 1)).thenReturn(1);",
          "186:         assertTrue(user.isEmailChecked(this.mockitoOldcore.getXWikiContext()));",
          "188:         when(this.userDocument.getIntValue(this.userClassReference, XWikiUser.EMAIL_CHECKED_PROPERTY, 1)).thenReturn(0);",
          "189:         assertFalse(user.isEmailChecked(this.mockitoOldcore.getXWikiContext()));",
          "192:         assertTrue(user.isEmailChecked(this.mockitoOldcore.getXWikiContext()));",
          "195:         assertTrue(user.isEmailChecked(this.mockitoOldcore.getXWikiContext()));",
          "201:         XWikiUser user = new XWikiUser(this.userReference);",
          "202:         user.setEmailChecked(false, this.mockitoOldcore.getXWikiContext());",
          "203:         verify(this.userDocument, times(1)).setIntValue(this.userClassReference, XWikiUser.EMAIL_CHECKED_PROPERTY, 0);",
          "204:         verify(this.mockitoOldcore.getSpyXWiki(), times(1))",
          "205:             .saveDocument(same(this.userDocument), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "211:         XWikiUser user = new XWikiUser(this.userReference);",
          "212:         user.setEmailChecked(true, this.mockitoOldcore.getXWikiContext());",
          "213:         verify(this.userDocument, times(1)).setIntValue(this.userClassReference, XWikiUser.EMAIL_CHECKED_PROPERTY, 1);",
          "214:         verify(this.mockitoOldcore.getSpyXWiki(), times(1))",
          "215:             .saveDocument(same(this.userDocument), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "203:     {",
          "205:         XWikiUser user = new XWikiUser((DocumentReference) null);",
          "219:         user = new XWikiUser(XWikiRightService.SUPERADMIN_USER_FULLNAME);",
          "231:     }",
          "232: }",
          "",
          "[Removed Lines]",
          "206:         user.setEmailChecked(true, mockitoOldcore.getXWikiContext());",
          "207:         verify(userDocument, never())",
          "208:             .setIntValue(same(userClassReference), any(String.class), any(Integer.class));",
          "209:         verify(mockitoOldcore.getSpyXWiki(), never())",
          "210:             .saveDocument(any(XWikiDocument.class), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "212:         user.setEmailChecked(false, mockitoOldcore.getXWikiContext());",
          "213:         verify(userDocument, never())",
          "214:             .setIntValue(same(userClassReference), any(String.class), any(Integer.class));",
          "215:         verify(mockitoOldcore.getSpyXWiki(), never())",
          "216:             .saveDocument(any(XWikiDocument.class), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "220:         user.setEmailChecked(true, mockitoOldcore.getXWikiContext());",
          "221:         verify(userDocument, never())",
          "222:             .setIntValue(same(userClassReference), any(String.class), any(Integer.class));",
          "223:         verify(mockitoOldcore.getSpyXWiki(), never())",
          "224:             .saveDocument(any(XWikiDocument.class), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "226:         user.setEmailChecked(false, mockitoOldcore.getXWikiContext());",
          "227:         verify(userDocument, never())",
          "228:             .setIntValue(same(userClassReference), any(String.class), any(Integer.class));",
          "229:         verify(mockitoOldcore.getSpyXWiki(), never())",
          "230:             .saveDocument(any(XWikiDocument.class), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "",
          "[Added Lines]",
          "223:         user.setEmailChecked(true, this.mockitoOldcore.getXWikiContext());",
          "224:         verify(this.userDocument, never())",
          "225:             .setIntValue(same(this.userClassReference), any(String.class), any(Integer.class));",
          "226:         verify(this.mockitoOldcore.getSpyXWiki(), never())",
          "227:             .saveDocument(any(XWikiDocument.class), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "229:         user.setEmailChecked(false, this.mockitoOldcore.getXWikiContext());",
          "230:         verify(this.userDocument, never())",
          "231:             .setIntValue(same(this.userClassReference), any(String.class), any(Integer.class));",
          "232:         verify(this.mockitoOldcore.getSpyXWiki(), never())",
          "233:             .saveDocument(any(XWikiDocument.class), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "237:         user.setEmailChecked(true, this.mockitoOldcore.getXWikiContext());",
          "238:         verify(this.userDocument, never())",
          "239:             .setIntValue(same(this.userClassReference), any(String.class), any(Integer.class));",
          "240:         verify(this.mockitoOldcore.getSpyXWiki(), never())",
          "241:             .saveDocument(any(XWikiDocument.class), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "243:         user.setEmailChecked(false, this.mockitoOldcore.getXWikiContext());",
          "244:         verify(this.userDocument, never())",
          "245:             .setIntValue(same(this.userClassReference), any(String.class), any(Integer.class));",
          "246:         verify(this.mockitoOldcore.getSpyXWiki(), never())",
          "247:             .saveDocument(any(XWikiDocument.class), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "",
          "---------------"
        ],
        "xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm||xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm": [
          "File: xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm -> xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm",
          "--- Hunk 1 ---",
          "[Context before]",
          "128:       'doc_hasdelete': $hasDelete,",
          "129:       'doc_delete_url': $user.getURL('delete'),",
          "130:       'doc_hasdisable': $hasDisable,",
          "135:       })),",
          "136:       'doc_hasenable': $hasEnable,",
          "141:       })),",
          "142:       'name': \"#displayUserAliasWithAvatar($user.documentReference $disabled)\",",
          "143:       'first_name': $userObject.getValue('first_name'),",
          "",
          "[Removed Lines]",
          "131:       'doc_disable_url': $user.getURL('save', $escapetool.url({",
          "132:         \"${userClassName}_0_active\": 0,",
          "133:         'comment': $services.localization.render('core.users.disable.saveComment'),",
          "134:         'form_token': $services.csrf.token",
          "137:       'doc_enable_url': $user.getURL('save', $escapetool.url({",
          "138:         \"${userClassName}_0_active\": 1,",
          "139:         'comment': $services.localization.render('core.users.enable.saveComment'),",
          "140:         'form_token': $services.csrf.token",
          "",
          "[Added Lines]",
          "131:       'doc_disable_url': $xwiki.getURL('XWiki.XWikiUserProfileSheet', 'get', $escapetool.url({",
          "132:         'outputSyntax': 'plain',",
          "133:         'action': 'disable',",
          "134:         'userId': $user.documentReference,",
          "135:         'csrf': $services.csrf.token",
          "138:       'doc_enable_url': $xwiki.getURL('XWiki.XWikiUserProfileSheet', 'get', $escapetool.url({",
          "139:         'outputSyntax': 'plain',",
          "140:         'action': 'enable',",
          "141:         'userId': $user.documentReference,",
          "142:         'csrf': $services.csrf.token",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "a9ccbc28c0f1c192d61d4c7cca11c6840f2315dd",
      "candidate_info": {
        "commit_hash": "a9ccbc28c0f1c192d61d4c7cca11c6840f2315dd",
        "repo": "xwiki/xwiki-platform",
        "commit_url": "https://github.com/xwiki/xwiki-platform/commit/a9ccbc28c0f1c192d61d4c7cca11c6840f2315dd",
        "files": [
          "xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java",
          "xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java",
          "xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm"
        ],
        "message": "XWIKI-21611: Set right author when disabling/enabling an account\n\n* Set only the original metadata author in XWikiUser.setDisabled\n* Use the same disable/enable action everywhere\n* Remove no longer needed request parameters\n\n(cherry picked from commit f89c8f47fad6e5cc7e68c69a7e0acde07f5eed5a)",
        "before_after_code_files": [
          "xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java||xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java",
          "xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java||xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java",
          "xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm||xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java||xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java",
            "xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java||xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java",
            "xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm||xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm"
          ],
          "candidate": [
            "xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java||xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java",
            "xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java||xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java",
            "xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm||xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm"
          ]
        }
      },
      "candidate_diff": {
        "xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java||xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java": [
          "File: xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java -> xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "31: import org.xwiki.model.reference.EntityReferenceSerializer;",
          "32: import org.xwiki.model.reference.LocalDocumentReference;",
          "33: import org.xwiki.model.reference.WikiReference;",
          "35: import com.xpn.xwiki.XWiki;",
          "36: import com.xpn.xwiki.XWikiContext;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "34: import org.xwiki.user.UserReference;",
          "35: import org.xwiki.user.UserReferenceResolver;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "72:     private ContextualLocalizationManager localization;",
          "74:     private Logger logger = LoggerFactory.getLogger(XWikiUser.class);",
          "76:     private String fullName;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "76:     private UserReferenceResolver<DocumentReference> documentReferenceUserReferenceResolver;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "204:         return localEntityReferenceSerializer;",
          "205:     }",
          "207:     private ContextualLocalizationManager getLocalization()",
          "208:     {",
          "209:         if (this.localization == null) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "211:     private UserReferenceResolver<DocumentReference> getDocumentReferenceUserReferenceResolver()",
          "212:     {",
          "213:         if (this.documentReferenceUserReferenceResolver == null) {",
          "214:             this.documentReferenceUserReferenceResolver =",
          "215:                 Utils.getComponent(UserReferenceResolver.TYPE_DOCUMENT_REFERENCE, \"document\");",
          "216:         }",
          "217:         return this.documentReferenceUserReferenceResolver;",
          "218:     }",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "337:                 XWikiDocument userdoc = getUserDocument(context);",
          "338:                 userdoc.setIntValue(getUserClassReference(userdoc.getDocumentReference().getWikiReference()),",
          "339:                     ACTIVE_PROPERTY, activeFlag);",
          "341:                 context.getWiki().saveDocument(userdoc,",
          "342:                     localizePlainOrKey(\"core.users.\" + (disable ? \"disable\" : \"enable\") + \".saveComment\"), context);",
          "343:             } catch (XWikiException e) {",
          "",
          "[Removed Lines]",
          "340:                 userdoc.setAuthorReference(context.getUserReference());",
          "",
          "[Added Lines]",
          "353:                 UserReference userReference =",
          "354:                     getDocumentReferenceUserReferenceResolver().resolve(context.getUserReference());",
          "355:                 userdoc.getAuthors().setOriginalMetadataAuthor(userReference);",
          "",
          "---------------"
        ],
        "xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java||xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java": [
          "File: xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java -> xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "20: package com.xpn.xwiki.user.api;",
          "22: import org.junit.jupiter.api.BeforeEach;",
          "23: import org.junit.jupiter.api.Test;",
          "24: import org.mockito.Mock;",
          "25: import org.xwiki.localization.ContextualLocalizationManager;",
          "26: import org.xwiki.model.reference.DocumentReference;",
          "27: import org.xwiki.test.mockito.MockitoComponentManager;",
          "29: import com.xpn.xwiki.XWikiException;",
          "30: import com.xpn.xwiki.doc.XWikiDocument;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "22: import javax.inject.Named;",
          "28: import org.xwiki.model.document.DocumentAuthors;",
          "30: import org.xwiki.test.junit5.mockito.MockComponent;",
          "32: import org.xwiki.user.UserReferenceResolver;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "56:     @InjectMockitoOldcore",
          "57:     private MockitoOldcore mockitoOldcore;",
          "59:     @Mock",
          "60:     private XWikiDocument userDocument;",
          "66:     @BeforeEach",
          "67:     public void setup(MockitoComponentManager componentManager) throws Exception",
          "68:     {",
          "74:         componentManager.registerMockComponent(ContextualLocalizationManager.class, \"default\");",
          "75:     }",
          "",
          "[Removed Lines]",
          "62:     private DocumentReference userClassReference = new DocumentReference(\"xwiki\", \"XWiki\", \"XWikiUsers\");",
          "64:     private DocumentReference userReference = new DocumentReference(\"xwiki\", \"XWiki\", \"Foo\");",
          "69:         when(mockitoOldcore.getSpyXWiki().getDocument(userReference, mockitoOldcore.getXWikiContext()))",
          "70:             .thenReturn(userDocument);",
          "71:         when(userDocument.getDocumentReference()).thenReturn(userReference);",
          "72:         when(userDocument.getDocumentReferenceWithLocale()).thenReturn(userReference);",
          "73:         when(userDocument.clone()).thenReturn(userDocument);",
          "",
          "[Added Lines]",
          "64:     @MockComponent",
          "65:     @Named(\"document\")",
          "66:     private UserReferenceResolver<DocumentReference> documentReferenceUserReferenceResolver;",
          "71:     @Mock",
          "72:     private DocumentAuthors authors;",
          "74:     private final DocumentReference userClassReference = new DocumentReference(\"xwiki\", \"XWiki\", \"XWikiUsers\");",
          "76:     private final DocumentReference userReference = new DocumentReference(\"xwiki\", \"XWiki\", \"Foo\");",
          "81:         when(this.mockitoOldcore.getSpyXWiki().getDocument(this.userReference, this.mockitoOldcore.getXWikiContext()))",
          "82:             .thenReturn(this.userDocument);",
          "83:         when(this.userDocument.getDocumentReference()).thenReturn(this.userReference);",
          "84:         when(this.userDocument.getDocumentReferenceWithLocale()).thenReturn(this.userReference);",
          "85:         when(this.userDocument.getAuthors()).thenReturn(this.authors);",
          "86:         when(this.userDocument.clone()).thenReturn(this.userDocument);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "95:     @Test",
          "96:     public void isDisabled()",
          "97:     {",
          "105:         user = new XWikiUser((DocumentReference) null);",
          "108:         user = new XWikiUser(XWikiRightService.SUPERADMIN_USER_FULLNAME);",
          "110:     }",
          "112:     @Test",
          "113:     public void setDisabledFalseNormalUser() throws XWikiException",
          "114:     {",
          "120:     }",
          "122:     @Test",
          "123:     public void setDisabledTrueNormalUser() throws XWikiException",
          "124:     {",
          "130:     }",
          "132:     @Test",
          "",
          "[Removed Lines]",
          "98:         XWikiUser user = new XWikiUser(userReference);",
          "99:         when(userDocument.getIntValue(userClassReference, XWikiUser.ACTIVE_PROPERTY, 1)).thenReturn(1);",
          "100:         assertFalse(user.isDisabled(mockitoOldcore.getXWikiContext()));",
          "102:         when(userDocument.getIntValue(userClassReference, XWikiUser.ACTIVE_PROPERTY, 1)).thenReturn(0);",
          "103:         assertTrue(user.isDisabled(mockitoOldcore.getXWikiContext()));",
          "106:         assertFalse(user.isDisabled(mockitoOldcore.getXWikiContext()));",
          "109:         assertFalse(user.isDisabled(mockitoOldcore.getXWikiContext()));",
          "115:         XWikiUser user = new XWikiUser(userReference);",
          "116:         user.setDisabled(false, mockitoOldcore.getXWikiContext());",
          "117:         verify(userDocument, times(1)).setIntValue(userClassReference, XWikiUser.ACTIVE_PROPERTY, 1);",
          "118:         verify(mockitoOldcore.getSpyXWiki(), times(1))",
          "119:             .saveDocument(same(userDocument), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "125:         XWikiUser user = new XWikiUser(userReference);",
          "126:         user.setDisabled(true, mockitoOldcore.getXWikiContext());",
          "127:         verify(userDocument, times(1)).setIntValue(userClassReference, XWikiUser.ACTIVE_PROPERTY, 0);",
          "128:         verify(mockitoOldcore.getSpyXWiki(), times(1))",
          "129:             .saveDocument(same(userDocument), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "",
          "[Added Lines]",
          "111:         XWikiUser user = new XWikiUser(this.userReference);",
          "112:         when(this.userDocument.getIntValue(this.userClassReference, XWikiUser.ACTIVE_PROPERTY, 1)).thenReturn(1);",
          "113:         assertFalse(user.isDisabled(this.mockitoOldcore.getXWikiContext()));",
          "115:         when(this.userDocument.getIntValue(this.userClassReference, XWikiUser.ACTIVE_PROPERTY, 1)).thenReturn(0);",
          "116:         assertTrue(user.isDisabled(this.mockitoOldcore.getXWikiContext()));",
          "119:         assertFalse(user.isDisabled(this.mockitoOldcore.getXWikiContext()));",
          "122:         assertFalse(user.isDisabled(this.mockitoOldcore.getXWikiContext()));",
          "128:         XWikiUser user = new XWikiUser(this.userReference);",
          "129:         user.setDisabled(false, this.mockitoOldcore.getXWikiContext());",
          "130:         verify(this.userDocument, times(1)).setIntValue(this.userClassReference, XWikiUser.ACTIVE_PROPERTY, 1);",
          "131:         verify(this.mockitoOldcore.getSpyXWiki(), times(1))",
          "132:             .saveDocument(same(this.userDocument), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "133:         verify(this.authors, times(1)).setOriginalMetadataAuthor(any());",
          "134:         verify(this.authors, never()).setEffectiveMetadataAuthor(any());",
          "140:         XWikiUser user = new XWikiUser(this.userReference);",
          "141:         user.setDisabled(true, this.mockitoOldcore.getXWikiContext());",
          "142:         verify(this.userDocument, times(1)).setIntValue(this.userClassReference, XWikiUser.ACTIVE_PROPERTY, 0);",
          "143:         verify(this.mockitoOldcore.getSpyXWiki(), times(1))",
          "144:             .saveDocument(same(this.userDocument), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "145:         verify(this.authors, times(1)).setOriginalMetadataAuthor(any());",
          "146:         verify(this.authors, never()).setEffectiveMetadataAuthor(any());",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "134:     {",
          "136:         XWikiUser user = new XWikiUser((DocumentReference) null);",
          "150:         user = new XWikiUser(XWikiRightService.SUPERADMIN_USER_FULLNAME);",
          "162:     }",
          "164:     @Test",
          "165:     public void isEmailChecked()",
          "166:     {",
          "174:         user = new XWikiUser((DocumentReference) null);",
          "177:         user = new XWikiUser(XWikiRightService.SUPERADMIN_USER_FULLNAME);",
          "179:     }",
          "181:     @Test",
          "182:     public void setEmailCheckedFalseNormalUser() throws XWikiException",
          "183:     {",
          "189:     }",
          "191:     @Test",
          "192:     public void setEmailCheckedTrueNormalUser() throws XWikiException",
          "193:     {",
          "199:     }",
          "201:     @Test",
          "",
          "[Removed Lines]",
          "137:         user.setDisabled(true, mockitoOldcore.getXWikiContext());",
          "138:         verify(userDocument, never())",
          "139:             .setIntValue(same(userClassReference), any(String.class), any(Integer.class));",
          "140:         verify(mockitoOldcore.getSpyXWiki(), never())",
          "141:             .saveDocument(any(XWikiDocument.class), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "143:         user.setDisabled(false, mockitoOldcore.getXWikiContext());",
          "144:         verify(userDocument, never())",
          "145:             .setIntValue(same(userClassReference), any(String.class), any(Integer.class));",
          "146:         verify(mockitoOldcore.getSpyXWiki(), never())",
          "147:             .saveDocument(any(XWikiDocument.class), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "151:         user.setDisabled(true, mockitoOldcore.getXWikiContext());",
          "152:         verify(userDocument, never())",
          "153:             .setIntValue(same(userClassReference), any(String.class), any(Integer.class));",
          "154:         verify(mockitoOldcore.getSpyXWiki(), never())",
          "155:             .saveDocument(any(XWikiDocument.class), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "157:         user.setDisabled(false, mockitoOldcore.getXWikiContext());",
          "158:         verify(userDocument, never())",
          "159:             .setIntValue(same(userClassReference), any(String.class), any(Integer.class));",
          "160:         verify(mockitoOldcore.getSpyXWiki(), never())",
          "161:             .saveDocument(any(XWikiDocument.class), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "167:         XWikiUser user = new XWikiUser(userReference);",
          "168:         when(userDocument.getIntValue(userClassReference, XWikiUser.EMAIL_CHECKED_PROPERTY, 1)).thenReturn(1);",
          "169:         assertTrue(user.isEmailChecked(mockitoOldcore.getXWikiContext()));",
          "171:         when(userDocument.getIntValue(userClassReference, XWikiUser.EMAIL_CHECKED_PROPERTY, 1)).thenReturn(0);",
          "172:         assertFalse(user.isEmailChecked(mockitoOldcore.getXWikiContext()));",
          "175:         assertTrue(user.isEmailChecked(mockitoOldcore.getXWikiContext()));",
          "178:         assertTrue(user.isEmailChecked(mockitoOldcore.getXWikiContext()));",
          "184:         XWikiUser user = new XWikiUser(userReference);",
          "185:         user.setEmailChecked(false, mockitoOldcore.getXWikiContext());",
          "186:         verify(userDocument, times(1)).setIntValue(userClassReference, XWikiUser.EMAIL_CHECKED_PROPERTY, 0);",
          "187:         verify(mockitoOldcore.getSpyXWiki(), times(1))",
          "188:             .saveDocument(same(userDocument), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "194:         XWikiUser user = new XWikiUser(userReference);",
          "195:         user.setEmailChecked(true, mockitoOldcore.getXWikiContext());",
          "196:         verify(userDocument, times(1)).setIntValue(userClassReference, XWikiUser.EMAIL_CHECKED_PROPERTY, 1);",
          "197:         verify(mockitoOldcore.getSpyXWiki(), times(1))",
          "198:             .saveDocument(same(userDocument), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "",
          "[Added Lines]",
          "154:         user.setDisabled(true, this.mockitoOldcore.getXWikiContext());",
          "155:         verify(this.userDocument, never())",
          "156:             .setIntValue(same(this.userClassReference), any(String.class), any(Integer.class));",
          "157:         verify(this.mockitoOldcore.getSpyXWiki(), never())",
          "158:             .saveDocument(any(XWikiDocument.class), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "160:         user.setDisabled(false, this.mockitoOldcore.getXWikiContext());",
          "161:         verify(this.userDocument, never())",
          "162:             .setIntValue(same(this.userClassReference), any(String.class), any(Integer.class));",
          "163:         verify(this.mockitoOldcore.getSpyXWiki(), never())",
          "164:             .saveDocument(any(XWikiDocument.class), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "168:         user.setDisabled(true, this.mockitoOldcore.getXWikiContext());",
          "169:         verify(this.userDocument, never())",
          "170:             .setIntValue(same(this.userClassReference), any(String.class), any(Integer.class));",
          "171:         verify(this.mockitoOldcore.getSpyXWiki(), never())",
          "172:             .saveDocument(any(XWikiDocument.class), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "174:         user.setDisabled(false, this.mockitoOldcore.getXWikiContext());",
          "175:         verify(this.userDocument, never())",
          "176:             .setIntValue(same(this.userClassReference), any(String.class), any(Integer.class));",
          "177:         verify(this.mockitoOldcore.getSpyXWiki(), never())",
          "178:             .saveDocument(any(XWikiDocument.class), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "184:         XWikiUser user = new XWikiUser(this.userReference);",
          "185:         when(this.userDocument.getIntValue(this.userClassReference, XWikiUser.EMAIL_CHECKED_PROPERTY, 1)).thenReturn(1);",
          "186:         assertTrue(user.isEmailChecked(this.mockitoOldcore.getXWikiContext()));",
          "188:         when(this.userDocument.getIntValue(this.userClassReference, XWikiUser.EMAIL_CHECKED_PROPERTY, 1)).thenReturn(0);",
          "189:         assertFalse(user.isEmailChecked(this.mockitoOldcore.getXWikiContext()));",
          "192:         assertTrue(user.isEmailChecked(this.mockitoOldcore.getXWikiContext()));",
          "195:         assertTrue(user.isEmailChecked(this.mockitoOldcore.getXWikiContext()));",
          "201:         XWikiUser user = new XWikiUser(this.userReference);",
          "202:         user.setEmailChecked(false, this.mockitoOldcore.getXWikiContext());",
          "203:         verify(this.userDocument, times(1)).setIntValue(this.userClassReference, XWikiUser.EMAIL_CHECKED_PROPERTY, 0);",
          "204:         verify(this.mockitoOldcore.getSpyXWiki(), times(1))",
          "205:             .saveDocument(same(this.userDocument), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "211:         XWikiUser user = new XWikiUser(this.userReference);",
          "212:         user.setEmailChecked(true, this.mockitoOldcore.getXWikiContext());",
          "213:         verify(this.userDocument, times(1)).setIntValue(this.userClassReference, XWikiUser.EMAIL_CHECKED_PROPERTY, 1);",
          "214:         verify(this.mockitoOldcore.getSpyXWiki(), times(1))",
          "215:             .saveDocument(same(this.userDocument), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "203:     {",
          "205:         XWikiUser user = new XWikiUser((DocumentReference) null);",
          "219:         user = new XWikiUser(XWikiRightService.SUPERADMIN_USER_FULLNAME);",
          "231:     }",
          "232: }",
          "",
          "[Removed Lines]",
          "206:         user.setEmailChecked(true, mockitoOldcore.getXWikiContext());",
          "207:         verify(userDocument, never())",
          "208:             .setIntValue(same(userClassReference), any(String.class), any(Integer.class));",
          "209:         verify(mockitoOldcore.getSpyXWiki(), never())",
          "210:             .saveDocument(any(XWikiDocument.class), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "212:         user.setEmailChecked(false, mockitoOldcore.getXWikiContext());",
          "213:         verify(userDocument, never())",
          "214:             .setIntValue(same(userClassReference), any(String.class), any(Integer.class));",
          "215:         verify(mockitoOldcore.getSpyXWiki(), never())",
          "216:             .saveDocument(any(XWikiDocument.class), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "220:         user.setEmailChecked(true, mockitoOldcore.getXWikiContext());",
          "221:         verify(userDocument, never())",
          "222:             .setIntValue(same(userClassReference), any(String.class), any(Integer.class));",
          "223:         verify(mockitoOldcore.getSpyXWiki(), never())",
          "224:             .saveDocument(any(XWikiDocument.class), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "226:         user.setEmailChecked(false, mockitoOldcore.getXWikiContext());",
          "227:         verify(userDocument, never())",
          "228:             .setIntValue(same(userClassReference), any(String.class), any(Integer.class));",
          "229:         verify(mockitoOldcore.getSpyXWiki(), never())",
          "230:             .saveDocument(any(XWikiDocument.class), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "",
          "[Added Lines]",
          "223:         user.setEmailChecked(true, this.mockitoOldcore.getXWikiContext());",
          "224:         verify(this.userDocument, never())",
          "225:             .setIntValue(same(this.userClassReference), any(String.class), any(Integer.class));",
          "226:         verify(this.mockitoOldcore.getSpyXWiki(), never())",
          "227:             .saveDocument(any(XWikiDocument.class), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "229:         user.setEmailChecked(false, this.mockitoOldcore.getXWikiContext());",
          "230:         verify(this.userDocument, never())",
          "231:             .setIntValue(same(this.userClassReference), any(String.class), any(Integer.class));",
          "232:         verify(this.mockitoOldcore.getSpyXWiki(), never())",
          "233:             .saveDocument(any(XWikiDocument.class), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "237:         user.setEmailChecked(true, this.mockitoOldcore.getXWikiContext());",
          "238:         verify(this.userDocument, never())",
          "239:             .setIntValue(same(this.userClassReference), any(String.class), any(Integer.class));",
          "240:         verify(this.mockitoOldcore.getSpyXWiki(), never())",
          "241:             .saveDocument(any(XWikiDocument.class), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "243:         user.setEmailChecked(false, this.mockitoOldcore.getXWikiContext());",
          "244:         verify(this.userDocument, never())",
          "245:             .setIntValue(same(this.userClassReference), any(String.class), any(Integer.class));",
          "246:         verify(this.mockitoOldcore.getSpyXWiki(), never())",
          "247:             .saveDocument(any(XWikiDocument.class), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "",
          "---------------"
        ],
        "xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm||xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm": [
          "File: xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm -> xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm",
          "--- Hunk 1 ---",
          "[Context before]",
          "128:       'doc_hasdelete': $hasDelete,",
          "129:       'doc_delete_url': $user.getURL('delete'),",
          "130:       'doc_hasdisable': $hasDisable,",
          "135:       })),",
          "136:       'doc_hasenable': $hasEnable,",
          "141:       })),",
          "142:       'name': \"#displayUserAliasWithAvatar($user.documentReference $disabled)\",",
          "143:       'first_name': $userObject.getValue('first_name'),",
          "",
          "[Removed Lines]",
          "131:       'doc_disable_url': $user.getURL('save', $escapetool.url({",
          "132:         \"${userClassName}_0_active\": 0,",
          "133:         'comment': $services.localization.render('core.users.disable.saveComment'),",
          "134:         'form_token': $services.csrf.token",
          "137:       'doc_enable_url': $user.getURL('save', $escapetool.url({",
          "138:         \"${userClassName}_0_active\": 1,",
          "139:         'comment': $services.localization.render('core.users.enable.saveComment'),",
          "140:         'form_token': $services.csrf.token",
          "",
          "[Added Lines]",
          "131:       'doc_disable_url': $xwiki.getURL('XWiki.XWikiUserProfileSheet', 'get', $escapetool.url({",
          "132:         'outputSyntax': 'plain',",
          "133:         'action': 'disable',",
          "134:         'userId': $user.documentReference,",
          "135:         'csrf': $services.csrf.token",
          "138:       'doc_enable_url': $xwiki.getURL('XWiki.XWikiUserProfileSheet', 'get', $escapetool.url({",
          "139:         'outputSyntax': 'plain',",
          "140:         'action': 'enable',",
          "141:         'userId': $user.documentReference,",
          "142:         'csrf': $services.csrf.token",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "bb232dd3e5cd72a26599dc12880d815e67965fd2",
      "candidate_info": {
        "commit_hash": "bb232dd3e5cd72a26599dc12880d815e67965fd2",
        "repo": "xwiki/xwiki-platform",
        "commit_url": "https://github.com/xwiki/xwiki-platform/commit/bb232dd3e5cd72a26599dc12880d815e67965fd2",
        "files": [
          "xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java",
          "xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java",
          "xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm"
        ],
        "message": "XWIKI-21611: Set right author when disabling/enabling an account\n\n* Set only the original metadata author in XWikiUser.setDisabled\n* Use the same disable/enable action everywhere\n* Remove no longer needed request parameters\n\n(cherry picked from commit f89c8f47fad6e5cc7e68c69a7e0acde07f5eed5a)",
        "before_after_code_files": [
          "xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java||xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java",
          "xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java||xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java",
          "xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm||xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java||xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java",
            "xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java||xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java",
            "xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm||xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm"
          ],
          "candidate": [
            "xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java||xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java",
            "xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java||xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java",
            "xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm||xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm"
          ]
        }
      },
      "candidate_diff": {
        "xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java||xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java": [
          "File: xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java -> xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "31: import org.xwiki.model.reference.EntityReferenceSerializer;",
          "32: import org.xwiki.model.reference.LocalDocumentReference;",
          "33: import org.xwiki.model.reference.WikiReference;",
          "35: import com.xpn.xwiki.XWiki;",
          "36: import com.xpn.xwiki.XWikiContext;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "34: import org.xwiki.user.UserReference;",
          "35: import org.xwiki.user.UserReferenceResolver;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "72:     private ContextualLocalizationManager localization;",
          "74:     private Logger logger = LoggerFactory.getLogger(XWikiUser.class);",
          "76:     private String fullName;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "76:     private UserReferenceResolver<DocumentReference> documentReferenceUserReferenceResolver;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "204:         return localEntityReferenceSerializer;",
          "205:     }",
          "207:     private ContextualLocalizationManager getLocalization()",
          "208:     {",
          "209:         if (this.localization == null) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "211:     private UserReferenceResolver<DocumentReference> getDocumentReferenceUserReferenceResolver()",
          "212:     {",
          "213:         if (this.documentReferenceUserReferenceResolver == null) {",
          "214:             this.documentReferenceUserReferenceResolver =",
          "215:                 Utils.getComponent(UserReferenceResolver.TYPE_DOCUMENT_REFERENCE, \"document\");",
          "216:         }",
          "217:         return this.documentReferenceUserReferenceResolver;",
          "218:     }",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "337:                 XWikiDocument userdoc = getUserDocument(context);",
          "338:                 userdoc.setIntValue(getUserClassReference(userdoc.getDocumentReference().getWikiReference()),",
          "339:                     ACTIVE_PROPERTY, activeFlag);",
          "341:                 context.getWiki().saveDocument(userdoc,",
          "342:                     localizePlainOrKey(\"core.users.\" + (disable ? \"disable\" : \"enable\") + \".saveComment\"), context);",
          "343:             } catch (XWikiException e) {",
          "",
          "[Removed Lines]",
          "340:                 userdoc.setAuthorReference(context.getUserReference());",
          "",
          "[Added Lines]",
          "353:                 UserReference userReference =",
          "354:                     getDocumentReferenceUserReferenceResolver().resolve(context.getUserReference());",
          "355:                 userdoc.getAuthors().setOriginalMetadataAuthor(userReference);",
          "",
          "---------------"
        ],
        "xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java||xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java": [
          "File: xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java -> xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "20: package com.xpn.xwiki.user.api;",
          "22: import org.junit.jupiter.api.BeforeEach;",
          "23: import org.junit.jupiter.api.Test;",
          "24: import org.mockito.Mock;",
          "25: import org.xwiki.localization.ContextualLocalizationManager;",
          "26: import org.xwiki.model.reference.DocumentReference;",
          "27: import org.xwiki.test.mockito.MockitoComponentManager;",
          "29: import com.xpn.xwiki.XWikiException;",
          "30: import com.xpn.xwiki.doc.XWikiDocument;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "22: import javax.inject.Named;",
          "28: import org.xwiki.model.document.DocumentAuthors;",
          "30: import org.xwiki.test.junit5.mockito.MockComponent;",
          "32: import org.xwiki.user.UserReferenceResolver;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "56:     @InjectMockitoOldcore",
          "57:     private MockitoOldcore mockitoOldcore;",
          "59:     @Mock",
          "60:     private XWikiDocument userDocument;",
          "66:     @BeforeEach",
          "67:     public void setup(MockitoComponentManager componentManager) throws Exception",
          "68:     {",
          "74:         componentManager.registerMockComponent(ContextualLocalizationManager.class, \"default\");",
          "75:     }",
          "",
          "[Removed Lines]",
          "62:     private DocumentReference userClassReference = new DocumentReference(\"xwiki\", \"XWiki\", \"XWikiUsers\");",
          "64:     private DocumentReference userReference = new DocumentReference(\"xwiki\", \"XWiki\", \"Foo\");",
          "69:         when(mockitoOldcore.getSpyXWiki().getDocument(userReference, mockitoOldcore.getXWikiContext()))",
          "70:             .thenReturn(userDocument);",
          "71:         when(userDocument.getDocumentReference()).thenReturn(userReference);",
          "72:         when(userDocument.getDocumentReferenceWithLocale()).thenReturn(userReference);",
          "73:         when(userDocument.clone()).thenReturn(userDocument);",
          "",
          "[Added Lines]",
          "64:     @MockComponent",
          "65:     @Named(\"document\")",
          "66:     private UserReferenceResolver<DocumentReference> documentReferenceUserReferenceResolver;",
          "71:     @Mock",
          "72:     private DocumentAuthors authors;",
          "74:     private final DocumentReference userClassReference = new DocumentReference(\"xwiki\", \"XWiki\", \"XWikiUsers\");",
          "76:     private final DocumentReference userReference = new DocumentReference(\"xwiki\", \"XWiki\", \"Foo\");",
          "81:         when(this.mockitoOldcore.getSpyXWiki().getDocument(this.userReference, this.mockitoOldcore.getXWikiContext()))",
          "82:             .thenReturn(this.userDocument);",
          "83:         when(this.userDocument.getDocumentReference()).thenReturn(this.userReference);",
          "84:         when(this.userDocument.getDocumentReferenceWithLocale()).thenReturn(this.userReference);",
          "85:         when(this.userDocument.getAuthors()).thenReturn(this.authors);",
          "86:         when(this.userDocument.clone()).thenReturn(this.userDocument);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "95:     @Test",
          "96:     public void isDisabled()",
          "97:     {",
          "105:         user = new XWikiUser((DocumentReference) null);",
          "108:         user = new XWikiUser(XWikiRightService.SUPERADMIN_USER_FULLNAME);",
          "110:     }",
          "112:     @Test",
          "113:     public void setDisabledFalseNormalUser() throws XWikiException",
          "114:     {",
          "120:     }",
          "122:     @Test",
          "123:     public void setDisabledTrueNormalUser() throws XWikiException",
          "124:     {",
          "130:     }",
          "132:     @Test",
          "",
          "[Removed Lines]",
          "98:         XWikiUser user = new XWikiUser(userReference);",
          "99:         when(userDocument.getIntValue(userClassReference, XWikiUser.ACTIVE_PROPERTY, 1)).thenReturn(1);",
          "100:         assertFalse(user.isDisabled(mockitoOldcore.getXWikiContext()));",
          "102:         when(userDocument.getIntValue(userClassReference, XWikiUser.ACTIVE_PROPERTY, 1)).thenReturn(0);",
          "103:         assertTrue(user.isDisabled(mockitoOldcore.getXWikiContext()));",
          "106:         assertFalse(user.isDisabled(mockitoOldcore.getXWikiContext()));",
          "109:         assertFalse(user.isDisabled(mockitoOldcore.getXWikiContext()));",
          "115:         XWikiUser user = new XWikiUser(userReference);",
          "116:         user.setDisabled(false, mockitoOldcore.getXWikiContext());",
          "117:         verify(userDocument, times(1)).setIntValue(userClassReference, XWikiUser.ACTIVE_PROPERTY, 1);",
          "118:         verify(mockitoOldcore.getSpyXWiki(), times(1))",
          "119:             .saveDocument(same(userDocument), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "125:         XWikiUser user = new XWikiUser(userReference);",
          "126:         user.setDisabled(true, mockitoOldcore.getXWikiContext());",
          "127:         verify(userDocument, times(1)).setIntValue(userClassReference, XWikiUser.ACTIVE_PROPERTY, 0);",
          "128:         verify(mockitoOldcore.getSpyXWiki(), times(1))",
          "129:             .saveDocument(same(userDocument), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "",
          "[Added Lines]",
          "111:         XWikiUser user = new XWikiUser(this.userReference);",
          "112:         when(this.userDocument.getIntValue(this.userClassReference, XWikiUser.ACTIVE_PROPERTY, 1)).thenReturn(1);",
          "113:         assertFalse(user.isDisabled(this.mockitoOldcore.getXWikiContext()));",
          "115:         when(this.userDocument.getIntValue(this.userClassReference, XWikiUser.ACTIVE_PROPERTY, 1)).thenReturn(0);",
          "116:         assertTrue(user.isDisabled(this.mockitoOldcore.getXWikiContext()));",
          "119:         assertFalse(user.isDisabled(this.mockitoOldcore.getXWikiContext()));",
          "122:         assertFalse(user.isDisabled(this.mockitoOldcore.getXWikiContext()));",
          "128:         XWikiUser user = new XWikiUser(this.userReference);",
          "129:         user.setDisabled(false, this.mockitoOldcore.getXWikiContext());",
          "130:         verify(this.userDocument, times(1)).setIntValue(this.userClassReference, XWikiUser.ACTIVE_PROPERTY, 1);",
          "131:         verify(this.mockitoOldcore.getSpyXWiki(), times(1))",
          "132:             .saveDocument(same(this.userDocument), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "133:         verify(this.authors, times(1)).setOriginalMetadataAuthor(any());",
          "134:         verify(this.authors, never()).setEffectiveMetadataAuthor(any());",
          "140:         XWikiUser user = new XWikiUser(this.userReference);",
          "141:         user.setDisabled(true, this.mockitoOldcore.getXWikiContext());",
          "142:         verify(this.userDocument, times(1)).setIntValue(this.userClassReference, XWikiUser.ACTIVE_PROPERTY, 0);",
          "143:         verify(this.mockitoOldcore.getSpyXWiki(), times(1))",
          "144:             .saveDocument(same(this.userDocument), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "145:         verify(this.authors, times(1)).setOriginalMetadataAuthor(any());",
          "146:         verify(this.authors, never()).setEffectiveMetadataAuthor(any());",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "134:     {",
          "136:         XWikiUser user = new XWikiUser((DocumentReference) null);",
          "150:         user = new XWikiUser(XWikiRightService.SUPERADMIN_USER_FULLNAME);",
          "162:     }",
          "164:     @Test",
          "165:     public void isEmailChecked()",
          "166:     {",
          "174:         user = new XWikiUser((DocumentReference) null);",
          "177:         user = new XWikiUser(XWikiRightService.SUPERADMIN_USER_FULLNAME);",
          "179:     }",
          "181:     @Test",
          "182:     public void setEmailCheckedFalseNormalUser() throws XWikiException",
          "183:     {",
          "189:     }",
          "191:     @Test",
          "192:     public void setEmailCheckedTrueNormalUser() throws XWikiException",
          "193:     {",
          "199:     }",
          "201:     @Test",
          "",
          "[Removed Lines]",
          "137:         user.setDisabled(true, mockitoOldcore.getXWikiContext());",
          "138:         verify(userDocument, never())",
          "139:             .setIntValue(same(userClassReference), any(String.class), any(Integer.class));",
          "140:         verify(mockitoOldcore.getSpyXWiki(), never())",
          "141:             .saveDocument(any(XWikiDocument.class), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "143:         user.setDisabled(false, mockitoOldcore.getXWikiContext());",
          "144:         verify(userDocument, never())",
          "145:             .setIntValue(same(userClassReference), any(String.class), any(Integer.class));",
          "146:         verify(mockitoOldcore.getSpyXWiki(), never())",
          "147:             .saveDocument(any(XWikiDocument.class), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "151:         user.setDisabled(true, mockitoOldcore.getXWikiContext());",
          "152:         verify(userDocument, never())",
          "153:             .setIntValue(same(userClassReference), any(String.class), any(Integer.class));",
          "154:         verify(mockitoOldcore.getSpyXWiki(), never())",
          "155:             .saveDocument(any(XWikiDocument.class), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "157:         user.setDisabled(false, mockitoOldcore.getXWikiContext());",
          "158:         verify(userDocument, never())",
          "159:             .setIntValue(same(userClassReference), any(String.class), any(Integer.class));",
          "160:         verify(mockitoOldcore.getSpyXWiki(), never())",
          "161:             .saveDocument(any(XWikiDocument.class), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "167:         XWikiUser user = new XWikiUser(userReference);",
          "168:         when(userDocument.getIntValue(userClassReference, XWikiUser.EMAIL_CHECKED_PROPERTY, 1)).thenReturn(1);",
          "169:         assertTrue(user.isEmailChecked(mockitoOldcore.getXWikiContext()));",
          "171:         when(userDocument.getIntValue(userClassReference, XWikiUser.EMAIL_CHECKED_PROPERTY, 1)).thenReturn(0);",
          "172:         assertFalse(user.isEmailChecked(mockitoOldcore.getXWikiContext()));",
          "175:         assertTrue(user.isEmailChecked(mockitoOldcore.getXWikiContext()));",
          "178:         assertTrue(user.isEmailChecked(mockitoOldcore.getXWikiContext()));",
          "184:         XWikiUser user = new XWikiUser(userReference);",
          "185:         user.setEmailChecked(false, mockitoOldcore.getXWikiContext());",
          "186:         verify(userDocument, times(1)).setIntValue(userClassReference, XWikiUser.EMAIL_CHECKED_PROPERTY, 0);",
          "187:         verify(mockitoOldcore.getSpyXWiki(), times(1))",
          "188:             .saveDocument(same(userDocument), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "194:         XWikiUser user = new XWikiUser(userReference);",
          "195:         user.setEmailChecked(true, mockitoOldcore.getXWikiContext());",
          "196:         verify(userDocument, times(1)).setIntValue(userClassReference, XWikiUser.EMAIL_CHECKED_PROPERTY, 1);",
          "197:         verify(mockitoOldcore.getSpyXWiki(), times(1))",
          "198:             .saveDocument(same(userDocument), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "",
          "[Added Lines]",
          "154:         user.setDisabled(true, this.mockitoOldcore.getXWikiContext());",
          "155:         verify(this.userDocument, never())",
          "156:             .setIntValue(same(this.userClassReference), any(String.class), any(Integer.class));",
          "157:         verify(this.mockitoOldcore.getSpyXWiki(), never())",
          "158:             .saveDocument(any(XWikiDocument.class), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "160:         user.setDisabled(false, this.mockitoOldcore.getXWikiContext());",
          "161:         verify(this.userDocument, never())",
          "162:             .setIntValue(same(this.userClassReference), any(String.class), any(Integer.class));",
          "163:         verify(this.mockitoOldcore.getSpyXWiki(), never())",
          "164:             .saveDocument(any(XWikiDocument.class), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "168:         user.setDisabled(true, this.mockitoOldcore.getXWikiContext());",
          "169:         verify(this.userDocument, never())",
          "170:             .setIntValue(same(this.userClassReference), any(String.class), any(Integer.class));",
          "171:         verify(this.mockitoOldcore.getSpyXWiki(), never())",
          "172:             .saveDocument(any(XWikiDocument.class), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "174:         user.setDisabled(false, this.mockitoOldcore.getXWikiContext());",
          "175:         verify(this.userDocument, never())",
          "176:             .setIntValue(same(this.userClassReference), any(String.class), any(Integer.class));",
          "177:         verify(this.mockitoOldcore.getSpyXWiki(), never())",
          "178:             .saveDocument(any(XWikiDocument.class), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "184:         XWikiUser user = new XWikiUser(this.userReference);",
          "185:         when(this.userDocument.getIntValue(this.userClassReference, XWikiUser.EMAIL_CHECKED_PROPERTY, 1)).thenReturn(1);",
          "186:         assertTrue(user.isEmailChecked(this.mockitoOldcore.getXWikiContext()));",
          "188:         when(this.userDocument.getIntValue(this.userClassReference, XWikiUser.EMAIL_CHECKED_PROPERTY, 1)).thenReturn(0);",
          "189:         assertFalse(user.isEmailChecked(this.mockitoOldcore.getXWikiContext()));",
          "192:         assertTrue(user.isEmailChecked(this.mockitoOldcore.getXWikiContext()));",
          "195:         assertTrue(user.isEmailChecked(this.mockitoOldcore.getXWikiContext()));",
          "201:         XWikiUser user = new XWikiUser(this.userReference);",
          "202:         user.setEmailChecked(false, this.mockitoOldcore.getXWikiContext());",
          "203:         verify(this.userDocument, times(1)).setIntValue(this.userClassReference, XWikiUser.EMAIL_CHECKED_PROPERTY, 0);",
          "204:         verify(this.mockitoOldcore.getSpyXWiki(), times(1))",
          "205:             .saveDocument(same(this.userDocument), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "211:         XWikiUser user = new XWikiUser(this.userReference);",
          "212:         user.setEmailChecked(true, this.mockitoOldcore.getXWikiContext());",
          "213:         verify(this.userDocument, times(1)).setIntValue(this.userClassReference, XWikiUser.EMAIL_CHECKED_PROPERTY, 1);",
          "214:         verify(this.mockitoOldcore.getSpyXWiki(), times(1))",
          "215:             .saveDocument(same(this.userDocument), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "203:     {",
          "205:         XWikiUser user = new XWikiUser((DocumentReference) null);",
          "219:         user = new XWikiUser(XWikiRightService.SUPERADMIN_USER_FULLNAME);",
          "231:     }",
          "232: }",
          "",
          "[Removed Lines]",
          "206:         user.setEmailChecked(true, mockitoOldcore.getXWikiContext());",
          "207:         verify(userDocument, never())",
          "208:             .setIntValue(same(userClassReference), any(String.class), any(Integer.class));",
          "209:         verify(mockitoOldcore.getSpyXWiki(), never())",
          "210:             .saveDocument(any(XWikiDocument.class), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "212:         user.setEmailChecked(false, mockitoOldcore.getXWikiContext());",
          "213:         verify(userDocument, never())",
          "214:             .setIntValue(same(userClassReference), any(String.class), any(Integer.class));",
          "215:         verify(mockitoOldcore.getSpyXWiki(), never())",
          "216:             .saveDocument(any(XWikiDocument.class), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "220:         user.setEmailChecked(true, mockitoOldcore.getXWikiContext());",
          "221:         verify(userDocument, never())",
          "222:             .setIntValue(same(userClassReference), any(String.class), any(Integer.class));",
          "223:         verify(mockitoOldcore.getSpyXWiki(), never())",
          "224:             .saveDocument(any(XWikiDocument.class), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "226:         user.setEmailChecked(false, mockitoOldcore.getXWikiContext());",
          "227:         verify(userDocument, never())",
          "228:             .setIntValue(same(userClassReference), any(String.class), any(Integer.class));",
          "229:         verify(mockitoOldcore.getSpyXWiki(), never())",
          "230:             .saveDocument(any(XWikiDocument.class), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "",
          "[Added Lines]",
          "223:         user.setEmailChecked(true, this.mockitoOldcore.getXWikiContext());",
          "224:         verify(this.userDocument, never())",
          "225:             .setIntValue(same(this.userClassReference), any(String.class), any(Integer.class));",
          "226:         verify(this.mockitoOldcore.getSpyXWiki(), never())",
          "227:             .saveDocument(any(XWikiDocument.class), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "229:         user.setEmailChecked(false, this.mockitoOldcore.getXWikiContext());",
          "230:         verify(this.userDocument, never())",
          "231:             .setIntValue(same(this.userClassReference), any(String.class), any(Integer.class));",
          "232:         verify(this.mockitoOldcore.getSpyXWiki(), never())",
          "233:             .saveDocument(any(XWikiDocument.class), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "237:         user.setEmailChecked(true, this.mockitoOldcore.getXWikiContext());",
          "238:         verify(this.userDocument, never())",
          "239:             .setIntValue(same(this.userClassReference), any(String.class), any(Integer.class));",
          "240:         verify(this.mockitoOldcore.getSpyXWiki(), never())",
          "241:             .saveDocument(any(XWikiDocument.class), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "243:         user.setEmailChecked(false, this.mockitoOldcore.getXWikiContext());",
          "244:         verify(this.userDocument, never())",
          "245:             .setIntValue(same(this.userClassReference), any(String.class), any(Integer.class));",
          "246:         verify(this.mockitoOldcore.getSpyXWiki(), never())",
          "247:             .saveDocument(any(XWikiDocument.class), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "",
          "---------------"
        ],
        "xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm||xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm": [
          "File: xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm -> xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm",
          "--- Hunk 1 ---",
          "[Context before]",
          "128:       'doc_hasdelete': $hasDelete,",
          "129:       'doc_delete_url': $user.getURL('delete'),",
          "130:       'doc_hasdisable': $hasDisable,",
          "135:       })),",
          "136:       'doc_hasenable': $hasEnable,",
          "141:       })),",
          "142:       'name': \"#displayUserAliasWithAvatar($user.documentReference $disabled)\",",
          "143:       'first_name': $userObject.getValue('first_name'),",
          "",
          "[Removed Lines]",
          "131:       'doc_disable_url': $user.getURL('save', $escapetool.url({",
          "132:         \"${userClassName}_0_active\": 0,",
          "133:         'comment': $services.localization.render('core.users.disable.saveComment'),",
          "134:         'form_token': $services.csrf.token",
          "137:       'doc_enable_url': $user.getURL('save', $escapetool.url({",
          "138:         \"${userClassName}_0_active\": 1,",
          "139:         'comment': $services.localization.render('core.users.enable.saveComment'),",
          "140:         'form_token': $services.csrf.token",
          "",
          "[Added Lines]",
          "131:       'doc_disable_url': $xwiki.getURL('XWiki.XWikiUserProfileSheet', 'get', $escapetool.url({",
          "132:         'outputSyntax': 'plain',",
          "133:         'action': 'disable',",
          "134:         'userId': $user.documentReference,",
          "135:         'csrf': $services.csrf.token",
          "138:       'doc_enable_url': $xwiki.getURL('XWiki.XWikiUserProfileSheet', 'get', $escapetool.url({",
          "139:         'outputSyntax': 'plain',",
          "140:         'action': 'enable',",
          "141:         'userId': $user.documentReference,",
          "142:         'csrf': $services.csrf.token",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "53d22f410bb8d936bf3a900c908d2f72cb428c60",
      "candidate_info": {
        "commit_hash": "53d22f410bb8d936bf3a900c908d2f72cb428c60",
        "repo": "xwiki/xwiki-platform",
        "commit_url": "https://github.com/xwiki/xwiki-platform/commit/53d22f410bb8d936bf3a900c908d2f72cb428c60",
        "files": [
          "xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java",
          "xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java",
          "xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm"
        ],
        "message": "XWIKI-21611: Set right author when disabling/enabling an account\n\n* Set only the original metadata author in XWikiUser.setDisabled\n* Use the same disable/enable action everywhere\n* Remove no longer needed request parameters\n\n(cherry picked from commit f89c8f47fad6e5cc7e68c69a7e0acde07f5eed5a)",
        "before_after_code_files": [
          "xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java||xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java",
          "xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java||xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java",
          "xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm||xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java||xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java",
            "xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java||xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java",
            "xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm||xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm"
          ],
          "candidate": [
            "xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java||xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java",
            "xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java||xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java",
            "xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm||xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm"
          ]
        }
      },
      "candidate_diff": {
        "xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java||xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java": [
          "File: xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java -> xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/api/XWikiUser.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "31: import org.xwiki.model.reference.EntityReferenceSerializer;",
          "32: import org.xwiki.model.reference.LocalDocumentReference;",
          "33: import org.xwiki.model.reference.WikiReference;",
          "35: import com.xpn.xwiki.XWiki;",
          "36: import com.xpn.xwiki.XWikiContext;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "34: import org.xwiki.user.UserReference;",
          "35: import org.xwiki.user.UserReferenceResolver;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "72:     private ContextualLocalizationManager localization;",
          "74:     private Logger logger = LoggerFactory.getLogger(XWikiUser.class);",
          "76:     private String fullName;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "76:     private UserReferenceResolver<DocumentReference> documentReferenceUserReferenceResolver;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "204:         return localEntityReferenceSerializer;",
          "205:     }",
          "207:     private ContextualLocalizationManager getLocalization()",
          "208:     {",
          "209:         if (this.localization == null) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "211:     private UserReferenceResolver<DocumentReference> getDocumentReferenceUserReferenceResolver()",
          "212:     {",
          "213:         if (this.documentReferenceUserReferenceResolver == null) {",
          "214:             this.documentReferenceUserReferenceResolver =",
          "215:                 Utils.getComponent(UserReferenceResolver.TYPE_DOCUMENT_REFERENCE, \"document\");",
          "216:         }",
          "217:         return this.documentReferenceUserReferenceResolver;",
          "218:     }",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "337:                 XWikiDocument userdoc = getUserDocument(context);",
          "338:                 userdoc.setIntValue(getUserClassReference(userdoc.getDocumentReference().getWikiReference()),",
          "339:                     ACTIVE_PROPERTY, activeFlag);",
          "341:                 context.getWiki().saveDocument(userdoc,",
          "342:                     localizePlainOrKey(\"core.users.\" + (disable ? \"disable\" : \"enable\") + \".saveComment\"), context);",
          "343:             } catch (XWikiException e) {",
          "",
          "[Removed Lines]",
          "340:                 userdoc.setAuthorReference(context.getUserReference());",
          "",
          "[Added Lines]",
          "353:                 UserReference userReference =",
          "354:                     getDocumentReferenceUserReferenceResolver().resolve(context.getUserReference());",
          "355:                 userdoc.getAuthors().setOriginalMetadataAuthor(userReference);",
          "",
          "---------------"
        ],
        "xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java||xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java": [
          "File: xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java -> xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/user/api/XWikiUserTest.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "20: package com.xpn.xwiki.user.api;",
          "22: import org.junit.jupiter.api.BeforeEach;",
          "23: import org.junit.jupiter.api.Test;",
          "24: import org.mockito.Mock;",
          "25: import org.xwiki.localization.ContextualLocalizationManager;",
          "26: import org.xwiki.model.reference.DocumentReference;",
          "27: import org.xwiki.test.mockito.MockitoComponentManager;",
          "29: import com.xpn.xwiki.XWikiException;",
          "30: import com.xpn.xwiki.doc.XWikiDocument;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "22: import javax.inject.Named;",
          "28: import org.xwiki.model.document.DocumentAuthors;",
          "30: import org.xwiki.test.junit5.mockito.MockComponent;",
          "32: import org.xwiki.user.UserReferenceResolver;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "56:     @InjectMockitoOldcore",
          "57:     private MockitoOldcore mockitoOldcore;",
          "59:     @Mock",
          "60:     private XWikiDocument userDocument;",
          "66:     @BeforeEach",
          "67:     public void setup(MockitoComponentManager componentManager) throws Exception",
          "68:     {",
          "74:         componentManager.registerMockComponent(ContextualLocalizationManager.class, \"default\");",
          "75:     }",
          "",
          "[Removed Lines]",
          "62:     private DocumentReference userClassReference = new DocumentReference(\"xwiki\", \"XWiki\", \"XWikiUsers\");",
          "64:     private DocumentReference userReference = new DocumentReference(\"xwiki\", \"XWiki\", \"Foo\");",
          "69:         when(mockitoOldcore.getSpyXWiki().getDocument(userReference, mockitoOldcore.getXWikiContext()))",
          "70:             .thenReturn(userDocument);",
          "71:         when(userDocument.getDocumentReference()).thenReturn(userReference);",
          "72:         when(userDocument.getDocumentReferenceWithLocale()).thenReturn(userReference);",
          "73:         when(userDocument.clone()).thenReturn(userDocument);",
          "",
          "[Added Lines]",
          "64:     @MockComponent",
          "65:     @Named(\"document\")",
          "66:     private UserReferenceResolver<DocumentReference> documentReferenceUserReferenceResolver;",
          "71:     @Mock",
          "72:     private DocumentAuthors authors;",
          "74:     private final DocumentReference userClassReference = new DocumentReference(\"xwiki\", \"XWiki\", \"XWikiUsers\");",
          "76:     private final DocumentReference userReference = new DocumentReference(\"xwiki\", \"XWiki\", \"Foo\");",
          "81:         when(this.mockitoOldcore.getSpyXWiki().getDocument(this.userReference, this.mockitoOldcore.getXWikiContext()))",
          "82:             .thenReturn(this.userDocument);",
          "83:         when(this.userDocument.getDocumentReference()).thenReturn(this.userReference);",
          "84:         when(this.userDocument.getDocumentReferenceWithLocale()).thenReturn(this.userReference);",
          "85:         when(this.userDocument.getAuthors()).thenReturn(this.authors);",
          "86:         when(this.userDocument.clone()).thenReturn(this.userDocument);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "95:     @Test",
          "96:     public void isDisabled()",
          "97:     {",
          "105:         user = new XWikiUser((DocumentReference) null);",
          "108:         user = new XWikiUser(XWikiRightService.SUPERADMIN_USER_FULLNAME);",
          "110:     }",
          "112:     @Test",
          "113:     public void setDisabledFalseNormalUser() throws XWikiException",
          "114:     {",
          "120:     }",
          "122:     @Test",
          "123:     public void setDisabledTrueNormalUser() throws XWikiException",
          "124:     {",
          "130:     }",
          "132:     @Test",
          "",
          "[Removed Lines]",
          "98:         XWikiUser user = new XWikiUser(userReference);",
          "99:         when(userDocument.getIntValue(userClassReference, XWikiUser.ACTIVE_PROPERTY, 1)).thenReturn(1);",
          "100:         assertFalse(user.isDisabled(mockitoOldcore.getXWikiContext()));",
          "102:         when(userDocument.getIntValue(userClassReference, XWikiUser.ACTIVE_PROPERTY, 1)).thenReturn(0);",
          "103:         assertTrue(user.isDisabled(mockitoOldcore.getXWikiContext()));",
          "106:         assertFalse(user.isDisabled(mockitoOldcore.getXWikiContext()));",
          "109:         assertFalse(user.isDisabled(mockitoOldcore.getXWikiContext()));",
          "115:         XWikiUser user = new XWikiUser(userReference);",
          "116:         user.setDisabled(false, mockitoOldcore.getXWikiContext());",
          "117:         verify(userDocument, times(1)).setIntValue(userClassReference, XWikiUser.ACTIVE_PROPERTY, 1);",
          "118:         verify(mockitoOldcore.getSpyXWiki(), times(1))",
          "119:             .saveDocument(same(userDocument), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "125:         XWikiUser user = new XWikiUser(userReference);",
          "126:         user.setDisabled(true, mockitoOldcore.getXWikiContext());",
          "127:         verify(userDocument, times(1)).setIntValue(userClassReference, XWikiUser.ACTIVE_PROPERTY, 0);",
          "128:         verify(mockitoOldcore.getSpyXWiki(), times(1))",
          "129:             .saveDocument(same(userDocument), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "",
          "[Added Lines]",
          "111:         XWikiUser user = new XWikiUser(this.userReference);",
          "112:         when(this.userDocument.getIntValue(this.userClassReference, XWikiUser.ACTIVE_PROPERTY, 1)).thenReturn(1);",
          "113:         assertFalse(user.isDisabled(this.mockitoOldcore.getXWikiContext()));",
          "115:         when(this.userDocument.getIntValue(this.userClassReference, XWikiUser.ACTIVE_PROPERTY, 1)).thenReturn(0);",
          "116:         assertTrue(user.isDisabled(this.mockitoOldcore.getXWikiContext()));",
          "119:         assertFalse(user.isDisabled(this.mockitoOldcore.getXWikiContext()));",
          "122:         assertFalse(user.isDisabled(this.mockitoOldcore.getXWikiContext()));",
          "128:         XWikiUser user = new XWikiUser(this.userReference);",
          "129:         user.setDisabled(false, this.mockitoOldcore.getXWikiContext());",
          "130:         verify(this.userDocument, times(1)).setIntValue(this.userClassReference, XWikiUser.ACTIVE_PROPERTY, 1);",
          "131:         verify(this.mockitoOldcore.getSpyXWiki(), times(1))",
          "132:             .saveDocument(same(this.userDocument), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "133:         verify(this.authors, times(1)).setOriginalMetadataAuthor(any());",
          "134:         verify(this.authors, never()).setEffectiveMetadataAuthor(any());",
          "140:         XWikiUser user = new XWikiUser(this.userReference);",
          "141:         user.setDisabled(true, this.mockitoOldcore.getXWikiContext());",
          "142:         verify(this.userDocument, times(1)).setIntValue(this.userClassReference, XWikiUser.ACTIVE_PROPERTY, 0);",
          "143:         verify(this.mockitoOldcore.getSpyXWiki(), times(1))",
          "144:             .saveDocument(same(this.userDocument), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "145:         verify(this.authors, times(1)).setOriginalMetadataAuthor(any());",
          "146:         verify(this.authors, never()).setEffectiveMetadataAuthor(any());",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "134:     {",
          "136:         XWikiUser user = new XWikiUser((DocumentReference) null);",
          "150:         user = new XWikiUser(XWikiRightService.SUPERADMIN_USER_FULLNAME);",
          "162:     }",
          "164:     @Test",
          "165:     public void isEmailChecked()",
          "166:     {",
          "174:         user = new XWikiUser((DocumentReference) null);",
          "177:         user = new XWikiUser(XWikiRightService.SUPERADMIN_USER_FULLNAME);",
          "179:     }",
          "181:     @Test",
          "182:     public void setEmailCheckedFalseNormalUser() throws XWikiException",
          "183:     {",
          "189:     }",
          "191:     @Test",
          "192:     public void setEmailCheckedTrueNormalUser() throws XWikiException",
          "193:     {",
          "199:     }",
          "201:     @Test",
          "",
          "[Removed Lines]",
          "137:         user.setDisabled(true, mockitoOldcore.getXWikiContext());",
          "138:         verify(userDocument, never())",
          "139:             .setIntValue(same(userClassReference), any(String.class), any(Integer.class));",
          "140:         verify(mockitoOldcore.getSpyXWiki(), never())",
          "141:             .saveDocument(any(XWikiDocument.class), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "143:         user.setDisabled(false, mockitoOldcore.getXWikiContext());",
          "144:         verify(userDocument, never())",
          "145:             .setIntValue(same(userClassReference), any(String.class), any(Integer.class));",
          "146:         verify(mockitoOldcore.getSpyXWiki(), never())",
          "147:             .saveDocument(any(XWikiDocument.class), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "151:         user.setDisabled(true, mockitoOldcore.getXWikiContext());",
          "152:         verify(userDocument, never())",
          "153:             .setIntValue(same(userClassReference), any(String.class), any(Integer.class));",
          "154:         verify(mockitoOldcore.getSpyXWiki(), never())",
          "155:             .saveDocument(any(XWikiDocument.class), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "157:         user.setDisabled(false, mockitoOldcore.getXWikiContext());",
          "158:         verify(userDocument, never())",
          "159:             .setIntValue(same(userClassReference), any(String.class), any(Integer.class));",
          "160:         verify(mockitoOldcore.getSpyXWiki(), never())",
          "161:             .saveDocument(any(XWikiDocument.class), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "167:         XWikiUser user = new XWikiUser(userReference);",
          "168:         when(userDocument.getIntValue(userClassReference, XWikiUser.EMAIL_CHECKED_PROPERTY, 1)).thenReturn(1);",
          "169:         assertTrue(user.isEmailChecked(mockitoOldcore.getXWikiContext()));",
          "171:         when(userDocument.getIntValue(userClassReference, XWikiUser.EMAIL_CHECKED_PROPERTY, 1)).thenReturn(0);",
          "172:         assertFalse(user.isEmailChecked(mockitoOldcore.getXWikiContext()));",
          "175:         assertTrue(user.isEmailChecked(mockitoOldcore.getXWikiContext()));",
          "178:         assertTrue(user.isEmailChecked(mockitoOldcore.getXWikiContext()));",
          "184:         XWikiUser user = new XWikiUser(userReference);",
          "185:         user.setEmailChecked(false, mockitoOldcore.getXWikiContext());",
          "186:         verify(userDocument, times(1)).setIntValue(userClassReference, XWikiUser.EMAIL_CHECKED_PROPERTY, 0);",
          "187:         verify(mockitoOldcore.getSpyXWiki(), times(1))",
          "188:             .saveDocument(same(userDocument), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "194:         XWikiUser user = new XWikiUser(userReference);",
          "195:         user.setEmailChecked(true, mockitoOldcore.getXWikiContext());",
          "196:         verify(userDocument, times(1)).setIntValue(userClassReference, XWikiUser.EMAIL_CHECKED_PROPERTY, 1);",
          "197:         verify(mockitoOldcore.getSpyXWiki(), times(1))",
          "198:             .saveDocument(same(userDocument), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "",
          "[Added Lines]",
          "154:         user.setDisabled(true, this.mockitoOldcore.getXWikiContext());",
          "155:         verify(this.userDocument, never())",
          "156:             .setIntValue(same(this.userClassReference), any(String.class), any(Integer.class));",
          "157:         verify(this.mockitoOldcore.getSpyXWiki(), never())",
          "158:             .saveDocument(any(XWikiDocument.class), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "160:         user.setDisabled(false, this.mockitoOldcore.getXWikiContext());",
          "161:         verify(this.userDocument, never())",
          "162:             .setIntValue(same(this.userClassReference), any(String.class), any(Integer.class));",
          "163:         verify(this.mockitoOldcore.getSpyXWiki(), never())",
          "164:             .saveDocument(any(XWikiDocument.class), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "168:         user.setDisabled(true, this.mockitoOldcore.getXWikiContext());",
          "169:         verify(this.userDocument, never())",
          "170:             .setIntValue(same(this.userClassReference), any(String.class), any(Integer.class));",
          "171:         verify(this.mockitoOldcore.getSpyXWiki(), never())",
          "172:             .saveDocument(any(XWikiDocument.class), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "174:         user.setDisabled(false, this.mockitoOldcore.getXWikiContext());",
          "175:         verify(this.userDocument, never())",
          "176:             .setIntValue(same(this.userClassReference), any(String.class), any(Integer.class));",
          "177:         verify(this.mockitoOldcore.getSpyXWiki(), never())",
          "178:             .saveDocument(any(XWikiDocument.class), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "184:         XWikiUser user = new XWikiUser(this.userReference);",
          "185:         when(this.userDocument.getIntValue(this.userClassReference, XWikiUser.EMAIL_CHECKED_PROPERTY, 1)).thenReturn(1);",
          "186:         assertTrue(user.isEmailChecked(this.mockitoOldcore.getXWikiContext()));",
          "188:         when(this.userDocument.getIntValue(this.userClassReference, XWikiUser.EMAIL_CHECKED_PROPERTY, 1)).thenReturn(0);",
          "189:         assertFalse(user.isEmailChecked(this.mockitoOldcore.getXWikiContext()));",
          "192:         assertTrue(user.isEmailChecked(this.mockitoOldcore.getXWikiContext()));",
          "195:         assertTrue(user.isEmailChecked(this.mockitoOldcore.getXWikiContext()));",
          "201:         XWikiUser user = new XWikiUser(this.userReference);",
          "202:         user.setEmailChecked(false, this.mockitoOldcore.getXWikiContext());",
          "203:         verify(this.userDocument, times(1)).setIntValue(this.userClassReference, XWikiUser.EMAIL_CHECKED_PROPERTY, 0);",
          "204:         verify(this.mockitoOldcore.getSpyXWiki(), times(1))",
          "205:             .saveDocument(same(this.userDocument), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "211:         XWikiUser user = new XWikiUser(this.userReference);",
          "212:         user.setEmailChecked(true, this.mockitoOldcore.getXWikiContext());",
          "213:         verify(this.userDocument, times(1)).setIntValue(this.userClassReference, XWikiUser.EMAIL_CHECKED_PROPERTY, 1);",
          "214:         verify(this.mockitoOldcore.getSpyXWiki(), times(1))",
          "215:             .saveDocument(same(this.userDocument), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "203:     {",
          "205:         XWikiUser user = new XWikiUser((DocumentReference) null);",
          "219:         user = new XWikiUser(XWikiRightService.SUPERADMIN_USER_FULLNAME);",
          "231:     }",
          "232: }",
          "",
          "[Removed Lines]",
          "206:         user.setEmailChecked(true, mockitoOldcore.getXWikiContext());",
          "207:         verify(userDocument, never())",
          "208:             .setIntValue(same(userClassReference), any(String.class), any(Integer.class));",
          "209:         verify(mockitoOldcore.getSpyXWiki(), never())",
          "210:             .saveDocument(any(XWikiDocument.class), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "212:         user.setEmailChecked(false, mockitoOldcore.getXWikiContext());",
          "213:         verify(userDocument, never())",
          "214:             .setIntValue(same(userClassReference), any(String.class), any(Integer.class));",
          "215:         verify(mockitoOldcore.getSpyXWiki(), never())",
          "216:             .saveDocument(any(XWikiDocument.class), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "220:         user.setEmailChecked(true, mockitoOldcore.getXWikiContext());",
          "221:         verify(userDocument, never())",
          "222:             .setIntValue(same(userClassReference), any(String.class), any(Integer.class));",
          "223:         verify(mockitoOldcore.getSpyXWiki(), never())",
          "224:             .saveDocument(any(XWikiDocument.class), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "226:         user.setEmailChecked(false, mockitoOldcore.getXWikiContext());",
          "227:         verify(userDocument, never())",
          "228:             .setIntValue(same(userClassReference), any(String.class), any(Integer.class));",
          "229:         verify(mockitoOldcore.getSpyXWiki(), never())",
          "230:             .saveDocument(any(XWikiDocument.class), any(String.class), same(mockitoOldcore.getXWikiContext()));",
          "",
          "[Added Lines]",
          "223:         user.setEmailChecked(true, this.mockitoOldcore.getXWikiContext());",
          "224:         verify(this.userDocument, never())",
          "225:             .setIntValue(same(this.userClassReference), any(String.class), any(Integer.class));",
          "226:         verify(this.mockitoOldcore.getSpyXWiki(), never())",
          "227:             .saveDocument(any(XWikiDocument.class), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "229:         user.setEmailChecked(false, this.mockitoOldcore.getXWikiContext());",
          "230:         verify(this.userDocument, never())",
          "231:             .setIntValue(same(this.userClassReference), any(String.class), any(Integer.class));",
          "232:         verify(this.mockitoOldcore.getSpyXWiki(), never())",
          "233:             .saveDocument(any(XWikiDocument.class), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "237:         user.setEmailChecked(true, this.mockitoOldcore.getXWikiContext());",
          "238:         verify(this.userDocument, never())",
          "239:             .setIntValue(same(this.userClassReference), any(String.class), any(Integer.class));",
          "240:         verify(this.mockitoOldcore.getSpyXWiki(), never())",
          "241:             .saveDocument(any(XWikiDocument.class), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "243:         user.setEmailChecked(false, this.mockitoOldcore.getXWikiContext());",
          "244:         verify(this.userDocument, never())",
          "245:             .setIntValue(same(this.userClassReference), any(String.class), any(Integer.class));",
          "246:         verify(this.mockitoOldcore.getSpyXWiki(), never())",
          "247:             .saveDocument(any(XWikiDocument.class), any(String.class), same(this.mockitoOldcore.getXWikiContext()));",
          "",
          "---------------"
        ],
        "xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm||xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm": [
          "File: xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm -> xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getusers.vm",
          "--- Hunk 1 ---",
          "[Context before]",
          "128:       'doc_hasdelete': $hasDelete,",
          "129:       'doc_delete_url': $user.getURL('delete'),",
          "130:       'doc_hasdisable': $hasDisable,",
          "135:       })),",
          "136:       'doc_hasenable': $hasEnable,",
          "141:       })),",
          "142:       'name': \"#displayUserAliasWithAvatar($user.documentReference $disabled)\",",
          "143:       'first_name': $userObject.getValue('first_name'),",
          "",
          "[Removed Lines]",
          "131:       'doc_disable_url': $user.getURL('save', $escapetool.url({",
          "132:         \"${userClassName}_0_active\": 0,",
          "133:         'comment': $services.localization.render('core.users.disable.saveComment'),",
          "134:         'form_token': $services.csrf.token",
          "137:       'doc_enable_url': $user.getURL('save', $escapetool.url({",
          "138:         \"${userClassName}_0_active\": 1,",
          "139:         'comment': $services.localization.render('core.users.enable.saveComment'),",
          "140:         'form_token': $services.csrf.token",
          "",
          "[Added Lines]",
          "131:       'doc_disable_url': $xwiki.getURL('XWiki.XWikiUserProfileSheet', 'get', $escapetool.url({",
          "132:         'outputSyntax': 'plain',",
          "133:         'action': 'disable',",
          "134:         'userId': $user.documentReference,",
          "135:         'csrf': $services.csrf.token",
          "138:       'doc_enable_url': $xwiki.getURL('XWiki.XWikiUserProfileSheet', 'get', $escapetool.url({",
          "139:         'outputSyntax': 'plain',",
          "140:         'action': 'enable',",
          "141:         'userId': $user.documentReference,",
          "142:         'csrf': $services.csrf.token",
          "",
          "---------------"
        ]
      }
    }
  ]
}