{
  "cve_id": "CVE-2018-1000075",
  "cve_desc": "RubyGems version Ruby 2.2 series: 2.2.9 and earlier, Ruby 2.3 series: 2.3.6 and earlier, Ruby 2.4 series: 2.4.3 and earlier, Ruby 2.5 series: 2.5.0 and earlier, prior to trunk revision 62422 contains a infinite loop caused by negative size vulnerability in ruby gem package tar header that can result in a negative size could cause an infinite loop.. This vulnerability appears to have been fixed in 2.7.6.",
  "repo": "rubygems/rubygems",
  "patch_hash": "92e98bf8f810bd812f919120d4832df51bc25d83",
  "patch_info": {
    "commit_hash": "92e98bf8f810bd812f919120d4832df51bc25d83",
    "repo": "rubygems/rubygems",
    "commit_url": "https://github.com/rubygems/rubygems/commit/92e98bf8f810bd812f919120d4832df51bc25d83",
    "files": [
      "lib/rubygems/package/tar_header.rb",
      "test/rubygems/test_gem_package_tar_header.rb"
    ],
    "message": "Strictly interpret octal fields in tar headers\n\nAny octal field that contains characters other that 0-7 will cause acn\nexception to be raised.\n\nThis prevents a negative size from being set, which could cause an\ninfinite loop.",
    "before_after_code_files": [
      "lib/rubygems/package/tar_header.rb||lib/rubygems/package/tar_header.rb",
      "test/rubygems/test_gem_package_tar_header.rb||test/rubygems/test_gem_package_tar_header.rb"
    ]
  },
  "patch_diff": {
    "lib/rubygems/package/tar_header.rb||lib/rubygems/package/tar_header.rb": [
      "File: lib/rubygems/package/tar_header.rb -> lib/rubygems/package/tar_header.rb",
      "--- Hunk 1 ---",
      "[Context before]",
      "104:     fields = header.unpack UNPACK_FORMAT",
      "106:     new :name     => fields.shift,",
      "113:         :typeflag => fields.shift,",
      "114:         :linkname => fields.shift,",
      "115:         :magic    => fields.shift,",
      "117:         :uname    => fields.shift,",
      "118:         :gname    => fields.shift,",
      "121:         :prefix   => fields.shift,",
      "123:         :empty => empty",
      "124:   end",
      "126:   ##",
      "127:   # Creates a new TarHeader using +vals+",
      "",
      "[Removed Lines]",
      "107:         :mode     => fields.shift.oct,",
      "108:         :uid      => fields.shift.oct,",
      "109:         :gid      => fields.shift.oct,",
      "110:         :size     => fields.shift.oct,",
      "111:         :mtime    => fields.shift.oct,",
      "112:         :checksum => fields.shift.oct,",
      "116:         :version  => fields.shift.oct,",
      "119:         :devmajor => fields.shift.oct,",
      "120:         :devminor => fields.shift.oct,",
      "",
      "[Added Lines]",
      "107:         :mode     => strict_oct(fields.shift),",
      "108:         :uid      => strict_oct(fields.shift),",
      "109:         :gid      => strict_oct(fields.shift),",
      "110:         :size     => strict_oct(fields.shift),",
      "111:         :mtime    => strict_oct(fields.shift),",
      "112:         :checksum => strict_oct(fields.shift),",
      "116:         :version  => strict_oct(fields.shift),",
      "119:         :devmajor => strict_oct(fields.shift),",
      "120:         :devminor => strict_oct(fields.shift),",
      "126:   def self.strict_oct(str)",
      "127:     return str.oct if str =~ /\\A[0-7]*\\z/",
      "128:     raise ArgumentError, \"#{str.inspect} is not an octal string\"",
      "129:   end",
      "",
      "---------------"
    ],
    "test/rubygems/test_gem_package_tar_header.rb||test/rubygems/test_gem_package_tar_header.rb": [
      "File: test/rubygems/test_gem_package_tar_header.rb -> test/rubygems/test_gem_package_tar_header.rb",
      "--- Hunk 1 ---",
      "[Context before]",
      "143:     assert_equal '012467', @tar_header.checksum",
      "144:   end",
      "146: end",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "146:   def test_from_bad_octal",
      "147:     test_cases = [",
      "148:       \"00000006,44\\000\", # bogus character",
      "149:       \"00000006789\\000\", # non-octal digit",
      "150:       \"+0000001234\\000\", # positive sign",
      "151:       \"-0000001000\\000\", # negative sign",
      "152:       \"0x000123abc\\000\", # radix prefix",
      "153:     ]",
      "155:     test_cases.each do |val|",
      "156:       header_s = @tar_header.to_s",
      "157:       # overwrite the size field",
      "158:       header_s[124, 12] = val",
      "159:       io = TempIO.new header_s",
      "160:       assert_raises ArgumentError do",
      "161:         new_header = Gem::Package::TarHeader.from io",
      "162:       end",
      "163:     end",
      "164:   end",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "33d2ad879c66ba0938f2c0d806f9e44471392839",
      "candidate_info": {
        "commit_hash": "33d2ad879c66ba0938f2c0d806f9e44471392839",
        "repo": "rubygems/rubygems",
        "commit_url": "https://github.com/rubygems/rubygems/commit/33d2ad879c66ba0938f2c0d806f9e44471392839",
        "files": [
          "test/rubygems/test_gem_package_tar_header.rb",
          "test/rubygems/test_gem_server.rb"
        ],
        "message": "Auto merge of #2205 - rubygems:colby/fix-test-warnings, r=colby-swandale\n\nFix ruby warnings in test suite\n\n# Description:\n\nRunning the rubygems test will print a couple of warnings, this PR fixes these warnings so we can have cleaner test output.\n\n```\n/Users/c/Projects/rubygems/test/rubygems/test_gem_package_tar_header.rb:161: warning: assigned but unused variable - new_header\n/Users/c/Projects/rubygems/test/rubygems/test_gem_server.rb:408: warning: character class has duplicated range\n/Users/c/Projects/rubygems/test/rubygems/test_gem_server.rb:463: warning: character class has duplicated range\n/Users/c/Projects/rubygems/test/rubygems/test_gem_server.rb:490: warning: character class has duplicated range\n/Users/c/Projects/rubygems/test/rubygems/test_gem_server.rb:517: warning: character class has duplicated range\n```\n\nThe `\\n` in `[\\n\\s]` is redundant because `\\s` already includes `\\n`\n\n# Tasks:\n\n- [ ] Describe the problem / feature\n- [ ] Write tests\n- [ ] Write code to solve the problem\n- [ ] Get code review from coworkers / friends\n\nI will abide by the [code of conduct](https://github.com/rubygems/rubygems/blob/master/CODE_OF_CONDUCT.md).",
        "before_after_code_files": [
          "test/rubygems/test_gem_package_tar_header.rb||test/rubygems/test_gem_package_tar_header.rb",
          "test/rubygems/test_gem_server.rb||test/rubygems/test_gem_server.rb"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "test/rubygems/test_gem_package_tar_header.rb||test/rubygems/test_gem_package_tar_header.rb"
          ],
          "candidate": [
            "test/rubygems/test_gem_package_tar_header.rb||test/rubygems/test_gem_package_tar_header.rb"
          ]
        }
      },
      "candidate_diff": {
        "test/rubygems/test_gem_package_tar_header.rb||test/rubygems/test_gem_package_tar_header.rb": [
          "File: test/rubygems/test_gem_package_tar_header.rb -> test/rubygems/test_gem_package_tar_header.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "158:       header_s[124, 12] = val",
          "159:       io = TempIO.new header_s",
          "160:       assert_raises ArgumentError do",
          "162:       end",
          "163:       io.close! if io.respond_to? :close!",
          "164:     end",
          "",
          "[Removed Lines]",
          "161:         new_header = Gem::Package::TarHeader.from io",
          "",
          "[Added Lines]",
          "161:         Gem::Package::TarHeader.from io",
          "",
          "---------------"
        ],
        "test/rubygems/test_gem_server.rb||test/rubygems/test_gem_server.rb": [
          "File: test/rubygems/test_gem_server.rb -> test/rubygems/test_gem_server.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "405:     #",
          "406:     #",
          "407:     #  <a href=\".\" title=\".\">[www]</a>",
          "409:     assert_match regex_match, @res.body",
          "410:   end",
          "",
          "[Removed Lines]",
          "408:     regex_match = /xsshomepagegem 1<\\/b>[\\n\\s]+(<span title=\"rdoc not installed\">\\[rdoc\\]<\\/span>|<a href=\"\\/doc_root\\/xsshomepagegem-1\\/\">\\[rdoc\\]<\\/a>)[\\n\\s]+<a href=\"\\.\" title=\"\\.\">\\[www\\]<\\/a>/",
          "",
          "[Added Lines]",
          "408:     regex_match = /xsshomepagegem 1<\\/b>[\\s]+(<span title=\"rdoc not installed\">\\[rdoc\\]<\\/span>|<a href=\"\\/doc_root\\/xsshomepagegem-1\\/\">\\[rdoc\\]<\\/a>)[\\s]+<a href=\"\\.\" title=\"\\.\">\\[www\\]<\\/a>/",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "460:     #",
          "461:     #",
          "462:     #  <a href=\".\" title=\".\">[www]</a>",
          "464:     assert_match regex_match, @res.body",
          "465:   end",
          "",
          "[Removed Lines]",
          "463:     regex_match = /invalidhomepagegem 1<\\/b>[\\n\\s]+(<span title=\"rdoc not installed\">\\[rdoc\\]<\\/span>|<a href=\"\\/doc_root\\/invalidhomepagegem-1\\/\">\\[rdoc\\]<\\/a>)[\\n\\s]+<a href=\"\\.\" title=\"\\.\">\\[www\\]<\\/a>/",
          "",
          "[Added Lines]",
          "463:     regex_match = /invalidhomepagegem 1<\\/b>[\\s]+(<span title=\"rdoc not installed\">\\[rdoc\\]<\\/span>|<a href=\"\\/doc_root\\/invalidhomepagegem-1\\/\">\\[rdoc\\]<\\/a>)[\\s]+<a href=\"\\.\" title=\"\\.\">\\[www\\]<\\/a>/",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "487:     assert_equal 200, @res.status",
          "488:     assert_match 'validhomepagegemhttp 1', @res.body",
          "491:     assert_match regex_match, @res.body",
          "492:   end",
          "",
          "[Removed Lines]",
          "490:     regex_match = /validhomepagegemhttp 1<\\/b>[\\n\\s]+(<span title=\"rdoc not installed\">\\[rdoc\\]<\\/span>|<a href=\"\\/doc_root\\/validhomepagegemhttp-1\\/\">\\[rdoc\\]<\\/a>)[\\n\\s]+<a href=\"http:\\/\\/rubygems\\.org\" title=\"http:\\/\\/rubygems\\.org\">\\[www\\]<\\/a>/",
          "",
          "[Added Lines]",
          "490:     regex_match = /validhomepagegemhttp 1<\\/b>[\\s]+(<span title=\"rdoc not installed\">\\[rdoc\\]<\\/span>|<a href=\"\\/doc_root\\/validhomepagegemhttp-1\\/\">\\[rdoc\\]<\\/a>)[\\s]+<a href=\"http:\\/\\/rubygems\\.org\" title=\"http:\\/\\/rubygems\\.org\">\\[www\\]<\\/a>/",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "514:     assert_equal 200, @res.status",
          "515:     assert_match 'validhomepagegemhttps 1', @res.body",
          "518:     assert_match regex_match, @res.body",
          "519:   end",
          "",
          "[Removed Lines]",
          "517:     regex_match = /validhomepagegemhttps 1<\\/b>[\\n\\s]+(<span title=\"rdoc not installed\">\\[rdoc\\]<\\/span>|<a href=\"\\/doc_root\\/validhomepagegemhttps-1\\/\">\\[rdoc\\]<\\/a>)[\\n\\s]+<a href=\"https:\\/\\/rubygems\\.org\" title=\"https:\\/\\/rubygems\\.org\">\\[www\\]<\\/a>/",
          "",
          "[Added Lines]",
          "517:     regex_match = /validhomepagegemhttps 1<\\/b>[\\s]+(<span title=\"rdoc not installed\">\\[rdoc\\]<\\/span>|<a href=\"\\/doc_root\\/validhomepagegemhttps-1\\/\">\\[rdoc\\]<\\/a>)[\\s]+<a href=\"https:\\/\\/rubygems\\.org\" title=\"https:\\/\\/rubygems\\.org\">\\[www\\]<\\/a>/",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "7f4951febc3008ab1f97cd9e536732571114e3d8",
      "candidate_info": {
        "commit_hash": "7f4951febc3008ab1f97cd9e536732571114e3d8",
        "repo": "rubygems/rubygems",
        "commit_url": "https://github.com/rubygems/rubygems/commit/7f4951febc3008ab1f97cd9e536732571114e3d8",
        "files": [
          "test/rubygems/test_gem_package_tar_header.rb",
          "test/rubygems/test_gem_server.rb"
        ],
        "message": "remove duplicated character classes in regexes and unused variable warnings in test suite",
        "before_after_code_files": [
          "test/rubygems/test_gem_package_tar_header.rb||test/rubygems/test_gem_package_tar_header.rb",
          "test/rubygems/test_gem_server.rb||test/rubygems/test_gem_server.rb"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "test/rubygems/test_gem_package_tar_header.rb||test/rubygems/test_gem_package_tar_header.rb"
          ],
          "candidate": [
            "test/rubygems/test_gem_package_tar_header.rb||test/rubygems/test_gem_package_tar_header.rb"
          ]
        }
      },
      "candidate_diff": {
        "test/rubygems/test_gem_package_tar_header.rb||test/rubygems/test_gem_package_tar_header.rb": [
          "File: test/rubygems/test_gem_package_tar_header.rb -> test/rubygems/test_gem_package_tar_header.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "158:       header_s[124, 12] = val",
          "159:       io = TempIO.new header_s",
          "160:       assert_raises ArgumentError do",
          "162:       end",
          "163:       io.close! if io.respond_to? :close!",
          "164:     end",
          "",
          "[Removed Lines]",
          "161:         new_header = Gem::Package::TarHeader.from io",
          "",
          "[Added Lines]",
          "161:         Gem::Package::TarHeader.from io",
          "",
          "---------------"
        ],
        "test/rubygems/test_gem_server.rb||test/rubygems/test_gem_server.rb": [
          "File: test/rubygems/test_gem_server.rb -> test/rubygems/test_gem_server.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "405:     #",
          "406:     #",
          "407:     #  <a href=\".\" title=\".\">[www]</a>",
          "409:     assert_match regex_match, @res.body",
          "410:   end",
          "",
          "[Removed Lines]",
          "408:     regex_match = /xsshomepagegem 1<\\/b>[\\n\\s]+(<span title=\"rdoc not installed\">\\[rdoc\\]<\\/span>|<a href=\"\\/doc_root\\/xsshomepagegem-1\\/\">\\[rdoc\\]<\\/a>)[\\n\\s]+<a href=\"\\.\" title=\"\\.\">\\[www\\]<\\/a>/",
          "",
          "[Added Lines]",
          "408:     regex_match = /xsshomepagegem 1<\\/b>[\\s]+(<span title=\"rdoc not installed\">\\[rdoc\\]<\\/span>|<a href=\"\\/doc_root\\/xsshomepagegem-1\\/\">\\[rdoc\\]<\\/a>)[\\s]+<a href=\"\\.\" title=\"\\.\">\\[www\\]<\\/a>/",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "460:     #",
          "461:     #",
          "462:     #  <a href=\".\" title=\".\">[www]</a>",
          "464:     assert_match regex_match, @res.body",
          "465:   end",
          "",
          "[Removed Lines]",
          "463:     regex_match = /invalidhomepagegem 1<\\/b>[\\n\\s]+(<span title=\"rdoc not installed\">\\[rdoc\\]<\\/span>|<a href=\"\\/doc_root\\/invalidhomepagegem-1\\/\">\\[rdoc\\]<\\/a>)[\\n\\s]+<a href=\"\\.\" title=\"\\.\">\\[www\\]<\\/a>/",
          "",
          "[Added Lines]",
          "463:     regex_match = /invalidhomepagegem 1<\\/b>[\\s]+(<span title=\"rdoc not installed\">\\[rdoc\\]<\\/span>|<a href=\"\\/doc_root\\/invalidhomepagegem-1\\/\">\\[rdoc\\]<\\/a>)[\\s]+<a href=\"\\.\" title=\"\\.\">\\[www\\]<\\/a>/",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "487:     assert_equal 200, @res.status",
          "488:     assert_match 'validhomepagegemhttp 1', @res.body",
          "491:     assert_match regex_match, @res.body",
          "492:   end",
          "",
          "[Removed Lines]",
          "490:     regex_match = /validhomepagegemhttp 1<\\/b>[\\n\\s]+(<span title=\"rdoc not installed\">\\[rdoc\\]<\\/span>|<a href=\"\\/doc_root\\/validhomepagegemhttp-1\\/\">\\[rdoc\\]<\\/a>)[\\n\\s]+<a href=\"http:\\/\\/rubygems\\.org\" title=\"http:\\/\\/rubygems\\.org\">\\[www\\]<\\/a>/",
          "",
          "[Added Lines]",
          "490:     regex_match = /validhomepagegemhttp 1<\\/b>[\\s]+(<span title=\"rdoc not installed\">\\[rdoc\\]<\\/span>|<a href=\"\\/doc_root\\/validhomepagegemhttp-1\\/\">\\[rdoc\\]<\\/a>)[\\s]+<a href=\"http:\\/\\/rubygems\\.org\" title=\"http:\\/\\/rubygems\\.org\">\\[www\\]<\\/a>/",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "514:     assert_equal 200, @res.status",
          "515:     assert_match 'validhomepagegemhttps 1', @res.body",
          "518:     assert_match regex_match, @res.body",
          "519:   end",
          "",
          "[Removed Lines]",
          "517:     regex_match = /validhomepagegemhttps 1<\\/b>[\\n\\s]+(<span title=\"rdoc not installed\">\\[rdoc\\]<\\/span>|<a href=\"\\/doc_root\\/validhomepagegemhttps-1\\/\">\\[rdoc\\]<\\/a>)[\\n\\s]+<a href=\"https:\\/\\/rubygems\\.org\" title=\"https:\\/\\/rubygems\\.org\">\\[www\\]<\\/a>/",
          "",
          "[Added Lines]",
          "517:     regex_match = /validhomepagegemhttps 1<\\/b>[\\s]+(<span title=\"rdoc not installed\">\\[rdoc\\]<\\/span>|<a href=\"\\/doc_root\\/validhomepagegemhttps-1\\/\">\\[rdoc\\]<\\/a>)[\\s]+<a href=\"https:\\/\\/rubygems\\.org\" title=\"https:\\/\\/rubygems\\.org\">\\[www\\]<\\/a>/",
          "",
          "---------------"
        ]
      }
    }
  ]
}