{
  "cve_id": "CVE-2024-4263",
  "cve_desc": "A broken access control vulnerability exists in mlflow/mlflow versions before 2.10.1, where low privilege users with only EDIT permissions on an experiment can delete any artifacts. This issue arises due to the lack of proper validation for DELETE requests by users with EDIT permissions, allowing them to perform unauthorized deletions of artifacts. The vulnerability specifically affects the handling of artifact deletions within the application, as demonstrated by the ability of a low privilege user to delete a directory inside an artifact using a DELETE request, despite the official documentation stating that users with EDIT permission can only read and update artifacts, not delete them.",
  "repo": "mlflow/mlflow",
  "patch_hash": "b43e0e3de5b500554e13dc032ba2083b2d6c94b8",
  "patch_info": {
    "commit_hash": "b43e0e3de5b500554e13dc032ba2083b2d6c94b8",
    "repo": "mlflow/mlflow",
    "commit_url": "https://github.com/mlflow/mlflow/commit/b43e0e3de5b500554e13dc032ba2083b2d6c94b8",
    "files": [
      "mlflow/server/auth/__init__.py"
    ],
    "message": "Fix #11308\n\nSigned-off-by: harupy <17039389+harupy@users.noreply.github.com>",
    "before_after_code_files": [
      "mlflow/server/auth/__init__.py||mlflow/server/auth/__init__.py"
    ]
  },
  "patch_diff": {
    "mlflow/server/auth/__init__.py||mlflow/server/auth/__init__.py": [
      "File: mlflow/server/auth/__init__.py -> mlflow/server/auth/__init__.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "261:     return _get_permission_from_experiment_id_artifact_proxy().can_update",
      "264: def validate_can_read_run():",
      "265:     return _get_permission_from_run_id().can_read",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "264: def validate_can_delete_experiment_artifact_proxy():",
      "265:     return _get_permission_from_experiment_id_artifact_proxy().can_manage",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "416:     return {",
      "417:         \"GET\": validate_can_read_experiment_artifact_proxy,  # Download",
      "418:         \"PUT\": validate_can_update_experiment_artifact_proxy,  # Upload",
      "420:     }.get(method)",
      "",
      "[Removed Lines]",
      "419:         \"DELETE\": validate_can_update_experiment_artifact_proxy,  # Delete",
      "",
      "[Added Lines]",
      "423:         \"DELETE\": validate_can_delete_experiment_artifact_proxy,  # Delete",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "cfa71879a884cc3520e23ccab998c9aa78fdf2b1",
      "candidate_info": {
        "commit_hash": "cfa71879a884cc3520e23ccab998c9aa78fdf2b1",
        "repo": "mlflow/mlflow",
        "commit_url": "https://github.com/mlflow/mlflow/commit/cfa71879a884cc3520e23ccab998c9aa78fdf2b1",
        "files": [
          "mlflow/server/auth/__init__.py"
        ],
        "message": "Fix #11308\n\nSigned-off-by: harupy <17039389+harupy@users.noreply.github.com>",
        "before_after_code_files": [
          "mlflow/server/auth/__init__.py||mlflow/server/auth/__init__.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "mlflow/server/auth/__init__.py||mlflow/server/auth/__init__.py"
          ],
          "candidate": [
            "mlflow/server/auth/__init__.py||mlflow/server/auth/__init__.py"
          ]
        }
      },
      "candidate_diff": {
        "mlflow/server/auth/__init__.py||mlflow/server/auth/__init__.py": [
          "File: mlflow/server/auth/__init__.py -> mlflow/server/auth/__init__.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "261:     return _get_permission_from_experiment_id_artifact_proxy().can_update",
          "264: def validate_can_read_run():",
          "265:     return _get_permission_from_run_id().can_read",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "264: def validate_can_delete_experiment_artifact_proxy():",
          "265:     return _get_permission_from_experiment_id_artifact_proxy().can_manage",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "416:     return {",
          "417:         \"GET\": validate_can_read_experiment_artifact_proxy,  # Download",
          "418:         \"PUT\": validate_can_update_experiment_artifact_proxy,  # Upload",
          "420:     }.get(method)",
          "",
          "[Removed Lines]",
          "419:         \"DELETE\": validate_can_update_experiment_artifact_proxy,  # Delete",
          "",
          "[Added Lines]",
          "423:         \"DELETE\": validate_can_delete_experiment_artifact_proxy,  # Delete",
          "",
          "---------------"
        ]
      }
    }
  ]
}