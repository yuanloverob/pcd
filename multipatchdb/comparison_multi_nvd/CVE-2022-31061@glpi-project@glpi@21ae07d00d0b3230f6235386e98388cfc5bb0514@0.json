{
  "cve_id": "CVE-2022-31061",
  "cve_desc": "GLPI is a Free Asset and IT Management Software package, Data center management, ITIL Service Desk, licenses tracking and software auditing. In affected versions there is a SQL injection vulnerability which is possible on login page. No user credentials are required to exploit this vulnerability. Users are advised to upgrade as soon as possible. There are no known workarounds for this issue.",
  "repo": "glpi-project/glpi",
  "patch_hash": "21ae07d00d0b3230f6235386e98388cfc5bb0514",
  "patch_info": {
    "commit_hash": "21ae07d00d0b3230f6235386e98388cfc5bb0514",
    "repo": "glpi-project/glpi",
    "commit_url": "https://github.com/glpi-project/glpi/commit/21ae07d00d0b3230f6235386e98388cfc5bb0514",
    "files": [
      "src/Auth.php"
    ],
    "message": "Merge pull request from GHSA-w2gc-v2gm-q7wq",
    "before_after_code_files": [
      "src/Auth.php||src/Auth.php"
    ]
  },
  "patch_diff": {
    "src/Auth.php||src/Auth.php": [
      "File: src/Auth.php -> src/Auth.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "736:         if ($login_auth == 'local') {",
      "737:             $authtype = self::DB_GLPI;",
      "738:             $this->user->fields[\"authtype\"] = self::DB_GLPI;",
      "743:                 $authtype = self::LDAP;",
      "746:                 $authtype = self::MAIL;",
      "749:                 $authtype = self::EXTERNAL;",
      "751:             }",
      "752:         }",
      "753:         if (!$noauto && ($authtype = self::checkAlternateAuthSystems())) {",
      "754:             if (",
      "",
      "[Removed Lines]",
      "739:         } else if (strstr($login_auth, '-')) {",
      "740:             $auths = explode('-', $login_auth);",
      "741:             $this->user->fields[\"auths_id\"] = $auths[1];",
      "742:             if ($auths[0] == 'ldap') {",
      "744:                 $this->user->fields[\"authtype\"] = self::LDAP;",
      "745:             } else if ($auths[0] == 'mail') {",
      "747:                 $this->user->fields[\"authtype\"] = self::MAIL;",
      "748:             } else if ($auths[0] == 'external') {",
      "750:                 $this->user->fields[\"authtype\"] = self::EXTERNAL;",
      "",
      "[Added Lines]",
      "739:         } else if (preg_match('/^(?<type>ldap|mail|external)-(?<id>\\d+)$/', $login_auth, $auth_matches)) {",
      "740:             $this->user->fields[\"auths_id\"] = (int)$auth_matches['id'];",
      "741:             if ($auth_matches['type'] == 'ldap') {",
      "743:             } else if ($auth_matches['type'] == 'mail') {",
      "745:             } else if ($auth_matches['type'] == 'external') {",
      "748:             $this->user->fields['authtype'] = $authtype;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "8f746efc325b52f8b08625558a49de59615fc645",
      "candidate_info": {
        "commit_hash": "8f746efc325b52f8b08625558a49de59615fc645",
        "repo": "glpi-project/glpi",
        "commit_url": "https://github.com/glpi-project/glpi/commit/8f746efc325b52f8b08625558a49de59615fc645",
        "files": [
          "inc/auth.class.php"
        ],
        "message": "Merge pull request from GHSA-w2gc-v2gm-q7wq",
        "before_after_code_files": [
          "inc/auth.class.php||inc/auth.class.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "inc/auth.class.php||inc/auth.class.php": [
          "File: inc/auth.class.php -> inc/auth.class.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "705:       if ($login_auth == 'local') {",
          "706:          $authtype = self::DB_GLPI;",
          "707:          $this->user->fields[\"authtype\"] = self::DB_GLPI;",
          "712:             $authtype = self::LDAP;",
          "715:             $authtype = self::MAIL;",
          "718:             $authtype = self::EXTERNAL;",
          "720:          }",
          "721:       }",
          "722:       if (!$noauto && ($authtype = self::checkAlternateAuthSystems())) {",
          "723:          if ($this->getAlternateAuthSystemsUserLogin($authtype)",
          "",
          "[Removed Lines]",
          "708:       } else if (strstr($login_auth, '-')) {",
          "709:          $auths = explode('-', $login_auth);",
          "710:          $this->user->fields[\"auths_id\"] = $auths[1];",
          "711:          if ($auths[0] == 'ldap') {",
          "713:             $this->user->fields[\"authtype\"] = self::LDAP;",
          "714:          } else if ($auths[0] == 'mail') {",
          "716:             $this->user->fields[\"authtype\"] = self::MAIL;",
          "717:          } else if ($auths[0] == 'external') {",
          "719:             $this->user->fields[\"authtype\"] = self::EXTERNAL;",
          "",
          "[Added Lines]",
          "708:       } else if (preg_match('/^(?<type>ldap|mail|external)-(?<id>\\d+)$/', $login_auth, $auth_matches)) {",
          "709:          $this->user->fields[\"auths_id\"] = (int)$auth_matches['id'];",
          "710:          if ($auth_matches['type'] == 'ldap') {",
          "712:          } else if ($auth_matches['type'] == 'mail') {",
          "714:          } else if ($auth_matches['type'] == 'external') {",
          "717:          $this->user->fields['authtype'] = $authtype;",
          "",
          "---------------"
        ]
      }
    }
  ]
}