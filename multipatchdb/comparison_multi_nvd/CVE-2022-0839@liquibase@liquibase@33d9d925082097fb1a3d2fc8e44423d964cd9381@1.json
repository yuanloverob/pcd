{
  "cve_id": "CVE-2022-0839",
  "cve_desc": "Improper Restriction of XML External Entity Reference in GitHub repository liquibase/liquibase prior to 4.8.0.",
  "repo": "liquibase/liquibase",
  "patch_hash": "33d9d925082097fb1a3d2fc8e44423d964cd9381",
  "patch_info": {
    "commit_hash": "33d9d925082097fb1a3d2fc8e44423d964cd9381",
    "repo": "liquibase/liquibase",
    "commit_url": "https://github.com/liquibase/liquibase/commit/33d9d925082097fb1a3d2fc8e44423d964cd9381",
    "files": [
      "liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy"
    ],
    "message": "Added liquibase.secureParsing test",
    "before_after_code_files": [
      "liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy||liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy"
    ]
  },
  "patch_diff": {
    "liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy||liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy": [
      "File: liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy -> liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy",
      "--- Hunk 1 ---",
      "[Context before]",
      "24:     def INSECURE_XML = \"\"\"",
      "25: <!DOCTYPE databaseChangeLog [",
      "27:         ]>",
      "29: <databaseChangeLog xmlns=\"http://www.liquibase.org/xml/ns/dbchangelog\"",
      "",
      "[Removed Lines]",
      "26:         <!ENTITY insecure SYSTEM \"https://localhost/insecure\">",
      "",
      "[Added Lines]",
      "26:         <!ENTITY insecure SYSTEM \"file://invalid.txt\">",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "84:         then:",
      "85:         def e = thrown(ChangeLogParseException)",
      "87:     }",
      "89:     def \"allows liquibase.secureParsing=false to disable secure parsing\"() {",
      "",
      "[Removed Lines]",
      "86:         e.message.contains(\"Failed to read external document 'insecure'\")",
      "",
      "[Added Lines]",
      "86:         e.message.contains(\"access is not allowed due to restriction set by the accessExternalDTD property\")",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "98:         then:",
      "99:         def e = thrown(ChangeLogParseException)",
      "101:     }",
      "103: }",
      "",
      "[Removed Lines]",
      "100:         e.message.contains(\"Connection refused\")",
      "",
      "[Added Lines]",
      "100:         e.message.contains(\"Error Reading Changelog File: invalid.txt\")",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "f793f0c9f453b349272d5b29199fe1160998a193",
      "candidate_info": {
        "commit_hash": "f793f0c9f453b349272d5b29199fe1160998a193",
        "repo": "liquibase/liquibase",
        "commit_url": "https://github.com/liquibase/liquibase/commit/f793f0c9f453b349272d5b29199fe1160998a193",
        "files": [
          "liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy"
        ],
        "message": "Revert \"Playing with ResourceAccessor changes\"\n\nThis reverts commit 3edac0f17d572ba2047de9f9a42a3cde82cf340c.",
        "before_after_code_files": [
          "liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy||liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy||liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy"
          ],
          "candidate": [
            "liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy||liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy"
          ]
        }
      },
      "candidate_diff": {
        "liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy||liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy": [
          "File: liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy -> liquibase-core/src/test/groovy/liquibase/parser/core/xml/XMLChangeLogSAXParserTest.groovy",
          "--- Hunk 1 ---",
          "[Context before]",
          "83:         e.message.contains(\"Unable to resolve xml entity file:///invalid.txt. liquibase.secureParsing is set to 'true'\")",
          "84:     }",
          "98:     }",
          "100:     def \"getSchemaVersion\"() {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "86:     def \"allows liquibase.secureParsing=false to disable secure parsing\"() {",
          "87:         when:",
          "88:         def resourceAccessor = new MockResourceAccessor([\"com/example/insecure.xml\": INSECURE_XML])",
          "90:         Scope.child(GlobalConfiguration.SECURE_PARSING.key, \"false\", { ->",
          "91:             new XMLChangeLogSAXParser().parse(\"com/example/insecure.xml\", new ChangeLogParameters(), resourceAccessor)",
          "92:         })",
          "95:         then:",
          "96:         def e = thrown(ChangeLogParseException)",
          "97:         e.message.contains(\"Error Reading Changelog File: \" + File.separator + \"invalid.txt\")",
          "",
          "---------------"
        ]
      }
    }
  ]
}