{
  "cve_id": "CVE-2020-26149",
  "cve_desc": "NATS nats.js before 2.0.0-209, nats.ws before 1.0.0-111, and nats.deno before 1.0.0-9 allow credential disclosure from a client to a server.",
  "repo": "nats-io/nats.ws",
  "patch_hash": "0a37ac2a411ff63f0707cda69a268c5fc4079eb7",
  "patch_info": {
    "commit_hash": "0a37ac2a411ff63f0707cda69a268c5fc4079eb7",
    "repo": "nats-io/nats.ws",
    "commit_url": "https://github.com/nats-io/nats.ws/commit/0a37ac2a411ff63f0707cda69a268c5fc4079eb7",
    "files": [
      ".github/workflows/natsws.yml",
      "package.json",
      "src/nats-base-client.ts",
      "src/ws_transport.ts"
    ],
    "message": "[update] [security] updated nats-base-client to v1.0.0-9 (#47)\n\n* [update] [security] updated nats-base-client to v1.0.0-9\n\n* bumped package version",
    "before_after_code_files": [
      "src/nats-base-client.ts||src/nats-base-client.ts",
      "src/ws_transport.ts||src/ws_transport.ts"
    ]
  },
  "patch_diff": {
    "src/nats-base-client.ts||src/nats-base-client.ts": [
      "File: src/nats-base-client.ts -> src/nats-base-client.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "15: export * from \"https://raw.githubusercontent.com/nats-io/nats.deno/v1.0.0-8/nats-base-client/internal_mod.ts\";",
      "",
      "[Added Lines]",
      "15: export * from \"https://raw.githubusercontent.com/nats-io/nats.deno/v1.0.0-9/nats-base-client/internal_mod.ts\";",
      "",
      "---------------"
    ],
    "src/ws_transport.ts||src/ws_transport.ts": [
      "File: src/ws_transport.ts -> src/ws_transport.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "26:   delay,",
      "27: } from \"./nats-base-client.ts\";",
      "30: const LANG = \"nats.ws\";",
      "32: export class WsTransport implements Transport {",
      "",
      "[Removed Lines]",
      "29: const VERSION = \"1.0.0-110\";",
      "",
      "[Added Lines]",
      "29: const VERSION = \"1.0.0-111\";",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "b56ef7e391d00c06016d41a6bcdfab60b5ece0d9",
      "candidate_info": {
        "commit_hash": "b56ef7e391d00c06016d41a6bcdfab60b5ece0d9",
        "repo": "nats-io/nats.ws",
        "commit_url": "https://github.com/nats-io/nats.ws/commit/b56ef7e391d00c06016d41a6bcdfab60b5ece0d9",
        "files": [
          ".gitignore",
          "package.json",
          "src/connect.ts",
          "src/mod.ts",
          "src/nats-base-client.ts",
          "src/ws_transport.ts"
        ],
        "message": "[update] nbc to v1.0.2 (#95)",
        "before_after_code_files": [
          "src/connect.ts||src/connect.ts",
          "src/mod.ts||src/mod.ts",
          "src/nats-base-client.ts||src/nats-base-client.ts",
          "src/ws_transport.ts||src/ws_transport.ts"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/nats-base-client.ts||src/nats-base-client.ts",
            "src/ws_transport.ts||src/ws_transport.ts"
          ],
          "candidate": [
            "src/nats-base-client.ts||src/nats-base-client.ts",
            "src/ws_transport.ts||src/ws_transport.ts"
          ]
        }
      },
      "candidate_diff": {
        "src/connect.ts||src/connect.ts": [
          "File: src/connect.ts -> src/connect.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "19:   setTransportFactory,",
          "20:   Transport,",
          "21:   TransportFactory,",
          "24: import { WsTransport } from \"./ws_transport.ts\";",
          "",
          "[Removed Lines]",
          "22: } from \"https://raw.githubusercontent.com/nats-io/nats.deno/v1.0.1/nats-base-client/internal_mod.ts\";",
          "",
          "[Added Lines]",
          "22: } from \"https://raw.githubusercontent.com/nats-io/nats.deno/v1.0.2/nats-base-client/internal_mod.ts\";",
          "",
          "---------------"
        ],
        "src/mod.ts||src/mod.ts": [
          "File: src/mod.ts -> src/mod.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "16: export { connect } from \"./connect.ts\";",
          "",
          "[Removed Lines]",
          "15: export * from \"https://raw.githubusercontent.com/nats-io/nats.deno/v1.0.1/nats-base-client/internal_mod.ts\";",
          "",
          "[Added Lines]",
          "15: export * from \"https://raw.githubusercontent.com/nats-io/nats.deno/v1.0.2/nats-base-client/internal_mod.ts\";",
          "",
          "---------------"
        ],
        "src/nats-base-client.ts||src/nats-base-client.ts": [
          "File: src/nats-base-client.ts -> src/nats-base-client.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "16: export * from \"https://raw.githubusercontent.com/nats-io/nats.deno/v1.0.1/nats-base-client/internal_mod.ts\";",
          "",
          "[Added Lines]",
          "16: export * from \"https://raw.githubusercontent.com/nats-io/nats.deno/v1.0.2/nats-base-client/internal_mod.ts\";",
          "",
          "---------------"
        ],
        "src/ws_transport.ts||src/ws_transport.ts": [
          "File: src/ws_transport.ts -> src/ws_transport.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "19:   Server,",
          "20:   ServerInfo,",
          "21:   Transport,",
          "23: import {",
          "24:   checkOptions,",
          "25:   DataBuffer,",
          "",
          "[Removed Lines]",
          "22: } from \"https://raw.githubusercontent.com/nats-io/nats.deno/v1.0.1/nats-base-client/internal_mod.ts\";",
          "",
          "[Added Lines]",
          "22: } from \"https://raw.githubusercontent.com/nats-io/nats.deno/v1.0.2/nats-base-client/internal_mod.ts\";",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "30:   INFO,",
          "31:   NatsError,",
          "32:   render,",
          "36: const LANG = \"nats.ws\";",
          "38: export class WsTransport implements Transport {",
          "",
          "[Removed Lines]",
          "33: } from \"https://raw.githubusercontent.com/nats-io/nats.deno/v1.0.1/nats-base-client/internal_mod.ts\";",
          "35: const VERSION = \"1.1.0-4\";",
          "",
          "[Added Lines]",
          "33: } from \"https://raw.githubusercontent.com/nats-io/nats.deno/v1.0.2/nats-base-client/internal_mod.ts\";",
          "35: const VERSION = \"1.1.0\";",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "4fbb841cf7112efbd9e5228dc124aa75a4890fbe",
      "candidate_info": {
        "commit_hash": "4fbb841cf7112efbd9e5228dc124aa75a4890fbe",
        "repo": "nats-io/nats.ws",
        "commit_url": "https://github.com/nats-io/nats.ws/commit/4fbb841cf7112efbd9e5228dc124aa75a4890fbe",
        "files": [
          ".gitignore",
          ".npmignore",
          "README.md",
          "bin/cjs-fix-imports.ts",
          "examples/bench.js",
          "examples/chat.js",
          "examples/ngs.html",
          "examples/simple.html",
          "examples/wss.html",
          "nats.cjs",
          "package.json",
          "src/ws_transport.ts",
          "test/auth.js",
          "test/basics.js",
          "test/helpers/launcher.js",
          "test/index.js",
          "test/jetstream.js",
          "test/reconnect.js",
          "test/urlparse.js",
          "tsconfig.json"
        ],
        "message": "reworked npm bundle to have cjs as this may help folks that are transpiling (#91)\n\n* reworked npm bundle to have cjs as this may help folks that are transpiling\n* updated the documentation providing hints for usage as cjs.\n* this renames the .mjs library to .js. The cjs lib is a .cjs.\n\nMany thanks to ValentinH.",
        "before_after_code_files": [
          "bin/cjs-fix-imports.ts||bin/cjs-fix-imports.ts",
          "examples/bench.js||examples/bench.js",
          "examples/chat.js||examples/chat.js",
          "examples/ngs.html||examples/ngs.html",
          "examples/simple.html||examples/simple.html",
          "examples/wss.html||examples/wss.html",
          "nats.cjs||nats.cjs",
          "src/ws_transport.ts||src/ws_transport.ts",
          "test/auth.js||test/auth.js",
          "test/basics.js||test/basics.js",
          "test/helpers/launcher.js||test/helpers/launcher.js",
          "test/index.js||test/index.js",
          "test/jetstream.js||test/jetstream.js",
          "test/reconnect.js||test/reconnect.js",
          "test/urlparse.js||test/urlparse.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/ws_transport.ts||src/ws_transport.ts"
          ],
          "candidate": [
            "src/ws_transport.ts||src/ws_transport.ts"
          ]
        }
      },
      "candidate_diff": {
        "bin/cjs-fix-imports.ts||bin/cjs-fix-imports.ts": [
          "File: bin/cjs-fix-imports.ts -> bin/cjs-fix-imports.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "29:     boolean: true,",
          "30:     string: [\"out\"],",
          "31:     default: {",
          "33:     },",
          "34:   },",
          "35: );",
          "",
          "[Removed Lines]",
          "32:       o: \"build\",",
          "",
          "[Added Lines]",
          "32:       o: \"lib\",",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "40:   \"https://raw.githubusercontent.com/nats-io/nkeys.js\",",
          "41:   { lib: \"nkeys.js\", arg: \"nkeys\" },",
          "42: );",
          "45: let dirs = (argv._ as string[]).map((n) => {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "43: requires.set(",
          "44:   \"https://deno.land/x/nkeys.js\",",
          "45:   { lib: \"nkeys.js\", arg: \"nkeys\" },",
          "46: )",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "71: if (!dirs.length || argv.h || argv.help) {",
          "72:   console.log(",
          "74:   );",
          "75:   Deno.exit(1);",
          "76: }",
          "",
          "[Removed Lines]",
          "73:     `deno run --allow-all cjs-fix-imports [--debug] [--out build/] dir/ dir2/`,",
          "",
          "[Added Lines]",
          "77:     `deno run --allow-all cjs-fix-imports [--debug] [--out lib/] dir/ dir2/`,",
          "",
          "---------------"
        ],
        "examples/bench.js||examples/bench.js": [
          "File: examples/bench.js -> examples/bench.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "18: function getString(id) {",
          "19:   return document.getElementById(id).value;",
          "",
          "[Removed Lines]",
          "16: import { Bench, connect, Metric } from \"../nats.mjs\";",
          "",
          "[Added Lines]",
          "16: import { Bench, connect, Metric } from \"../nats.js\";",
          "",
          "---------------"
        ],
        "examples/chat.js||examples/chat.js": [
          "File: examples/chat.js -> examples/chat.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "17: const me = Date.now();",
          "19: window.chat = {",
          "",
          "[Removed Lines]",
          "16: import { connect, JSONCodec } from \"../nats.mjs\";",
          "",
          "[Added Lines]",
          "16: import { connect, JSONCodec } from \"../nats.js\";",
          "",
          "---------------"
        ],
        "examples/ngs.html||examples/ngs.html": [
          "File: examples/ngs.html -> examples/ngs.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "11: <div id=\"messages\" class=\"container\"></div>",
          "12: <!-- load a script -->",
          "13: <script type=\"module\">",
          "17:   function addEntry (s) {",
          "",
          "[Removed Lines]",
          "14:   import { connect, StringCodec, credsAuthenticator } from '../nats.mjs'",
          "",
          "[Added Lines]",
          "14:   import { connect, StringCodec, credsAuthenticator } from '../nats.js'",
          "",
          "---------------"
        ],
        "examples/simple.html||examples/simple.html": [
          "File: examples/simple.html -> examples/simple.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "11: <div id=\"messages\" class=\"container\"></div>",
          "12: <!-- load a script -->",
          "13: <script type=\"module\">",
          "17:   function addEntry(s) {",
          "",
          "[Removed Lines]",
          "14:   import { connect, StringCodec } from '../nats.mjs'",
          "",
          "[Added Lines]",
          "14:   import { connect, StringCodec } from '../nats.js'",
          "",
          "---------------"
        ],
        "examples/wss.html||examples/wss.html": [
          "File: examples/wss.html -> examples/wss.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "11: <div id=\"messages\" class=\"container\"></div>",
          "12: <!-- load a script -->",
          "13: <script type=\"module\">",
          "17:   function addEntry(s) {",
          "",
          "[Removed Lines]",
          "14:   import { connect, StringCodec } from '../nats.mjs'",
          "",
          "[Added Lines]",
          "14:   import { connect } from '../nats.js'",
          "",
          "---------------"
        ],
        "nats.cjs||nats.cjs": [
          "File: nats.cjs -> nats.cjs",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "15: \"use strict\"",
          "17: module.exports = require(\"./lib/src/mod\");",
          "",
          "---------------"
        ],
        "src/ws_transport.ts||src/ws_transport.ts": [
          "File: src/ws_transport.ts -> src/ws_transport.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "32:   render,",
          "33: } from \"https://raw.githubusercontent.com/nats-io/nats.deno/v1.0.1/nats-base-client/internal_mod.ts\";",
          "36: const LANG = \"nats.ws\";",
          "38: export class WsTransport implements Transport {",
          "",
          "[Removed Lines]",
          "35: const VERSION = \"1.0.1\";",
          "",
          "[Added Lines]",
          "35: const VERSION = \"1.1.0-4\";",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "51:   yields: Uint8Array[];",
          "52:   signal: Deferred<void>;",
          "55:   constructor() {",
          "56:     this.version = VERSION;",
          "",
          "[Removed Lines]",
          "53:   private closedNotification: Deferred<void | Error>;",
          "",
          "[Added Lines]",
          "53:   closedNotification: Deferred<void | Error>;",
          "",
          "---------------"
        ],
        "test/auth.js||test/auth.js": [
          "File: test/auth.js -> test/auth.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "24: } = require(",
          "25:   \"./index\",",
          "26: );",
          "28: const { Lock } = require(\"./helpers/lock\");",
          "29: const { NatsServer, wsConfig } = require(\"./helpers/launcher\");",
          "",
          "[Removed Lines]",
          "27: const { nkeys } = require(\"../build/nats-base-client/internal_mod\");",
          "",
          "[Added Lines]",
          "27: const { nkeys } = require(\"../lib/nats-base-client/internal_mod\");",
          "",
          "---------------"
        ],
        "test/basics.js||test/basics.js": [
          "File: test/basics.js -> test/basics.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "18:   \"./index\",",
          "19: );",
          "20: const { deferred, delay } = require(",
          "22: );",
          "23: const { Lock } = require(\"./helpers/lock\");",
          "24: const { NatsServer, wsConfig, tlsConfig } = require(\"./helpers/launcher\");",
          "",
          "[Removed Lines]",
          "21:   \"../build/nats-base-client/internal_mod\",",
          "",
          "[Added Lines]",
          "21:   \"../lib/nats-base-client/internal_mod\",",
          "",
          "---------------"
        ],
        "test/helpers/launcher.js||test/helpers/launcher.js": [
          "File: test/helpers/launcher.js -> test/helpers/launcher.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "19:   delay,",
          "20:   timeout,",
          "21:   nuid,",
          "24: const { spawn } = require(\"child_process\");",
          "",
          "[Removed Lines]",
          "22: } = require(\"../../build/nats-base-client/internal_mod\");",
          "",
          "[Added Lines]",
          "22: } = require(\"../../lib/nats-base-client/internal_mod\");",
          "",
          "---------------"
        ],
        "test/index.js||test/index.js": [
          "File: test/index.js -> test/index.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "15: \"use strict\";",
          "",
          "[Removed Lines]",
          "17: module.exports = require(\"../build/wst/mod\");",
          "",
          "[Added Lines]",
          "17: module.exports = require(\"../lib/src/mod\");",
          "",
          "---------------"
        ],
        "test/jetstream.js||test/jetstream.js": [
          "File: test/jetstream.js -> test/jetstream.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "15: const test = require(\"ava\");",
          "17: const { connect, Empty, consumerOpts, AckPolicy } = require(",
          "18:   \"./index\",",
          "19: );",
          "",
          "[Removed Lines]",
          "16: const { delay } = require(\"../build/nats-base-client/internal_mod\");",
          "",
          "[Added Lines]",
          "16: const { delay } = require(\"../lib/nats-base-client/internal_mod\");",
          "",
          "---------------"
        ],
        "test/reconnect.js||test/reconnect.js": [
          "File: test/reconnect.js -> test/reconnect.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "21:   ErrorCode,",
          "22:   deferred,",
          "23:   DebugEvents,",
          "25: const { Lock } = require(\"./helpers/lock\");",
          "26: const {",
          "27:   connect,",
          "",
          "[Removed Lines]",
          "24: } = require(\"../build/nats-base-client/internal_mod\");",
          "",
          "[Added Lines]",
          "24: } = require(\"../lib/nats-base-client/internal_mod\");",
          "",
          "---------------"
        ],
        "test/urlparse.js||test/urlparse.js": [
          "File: test/urlparse.js -> test/urlparse.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "15: const test = require(\"ava\");",
          "18: test(\"url - parse\", (t) => {",
          "19:   const u = [",
          "",
          "[Removed Lines]",
          "16: const { wsUrlParseFn } = require(\"../build/wst/connect.js\");",
          "",
          "[Added Lines]",
          "16: const { wsUrlParseFn } = require(\"../lib/src/connect.js\");",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "d0c9e844bfd2fcea56df44f7859afbe2e8da0086",
      "candidate_info": {
        "commit_hash": "d0c9e844bfd2fcea56df44f7859afbe2e8da0086",
        "repo": "nats-io/nats.ws",
        "commit_url": "https://github.com/nats-io/nats.ws/commit/d0c9e844bfd2fcea56df44f7859afbe2e8da0086",
        "files": [
          "package.json",
          "src/nats-base-client.ts",
          "src/ws_transport.ts"
        ],
        "message": "updated nats-base-client an issue with duplicate CONNECT blocks. (#49)",
        "before_after_code_files": [
          "src/nats-base-client.ts||src/nats-base-client.ts",
          "src/ws_transport.ts||src/ws_transport.ts"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/nats-base-client.ts||src/nats-base-client.ts",
            "src/ws_transport.ts||src/ws_transport.ts"
          ],
          "candidate": [
            "src/nats-base-client.ts||src/nats-base-client.ts",
            "src/ws_transport.ts||src/ws_transport.ts"
          ]
        }
      },
      "candidate_diff": {
        "src/nats-base-client.ts||src/nats-base-client.ts": [
          "File: src/nats-base-client.ts -> src/nats-base-client.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "15: export * from \"https://raw.githubusercontent.com/nats-io/nats.deno/v1.0.0-9/nats-base-client/internal_mod.ts\";",
          "",
          "[Added Lines]",
          "15: export * from \"https://raw.githubusercontent.com/nats-io/nats.deno/v1.0.0-10/nats-base-client/internal_mod.ts\";",
          "",
          "---------------"
        ],
        "src/ws_transport.ts||src/ws_transport.ts": [
          "File: src/ws_transport.ts -> src/ws_transport.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "26:   delay,",
          "27: } from \"./nats-base-client.ts\";",
          "30: const LANG = \"nats.ws\";",
          "32: export class WsTransport implements Transport {",
          "",
          "[Removed Lines]",
          "29: const VERSION = \"1.0.0-111\";",
          "",
          "[Added Lines]",
          "29: const VERSION = \"1.0.0-112\";",
          "",
          "---------------"
        ]
      }
    }
  ]
}