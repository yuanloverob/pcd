{
  "cve_id": "CVE-2021-3623",
  "cve_desc": "A flaw was found in libtpms. The flaw can be triggered by specially-crafted TPM 2 command packets containing illegal values and may lead to an out-of-bounds access when the volatile state of the TPM 2 is marshalled/written or unmarshalled/read. The highest threat from this vulnerability is to system availability.",
  "repo": "stefanberger/libtpms",
  "patch_hash": "7981d9ad90a5043a05004e4ca7b46beab8ca7809",
  "patch_info": {
    "commit_hash": "7981d9ad90a5043a05004e4ca7b46beab8ca7809",
    "repo": "stefanberger/libtpms",
    "commit_url": "https://github.com/stefanberger/libtpms/commit/7981d9a",
    "files": [
      "src/tpm2/Marshal.c",
      "src/tpm2/Marshal_fp.h",
      "src/tpm2/NVMarshal.c"
    ],
    "message": "tpm2: Add maxSize parameter to TPM2B_Marshal for sanity checks\n\nAdd maxSize parameter to TPM2B_Marshal and assert on it checking\nthe size of the data intended to be marshaled versus the maximum\nbuffer size.\n\nSigned-off-by: Stefan Berger <stefanb@linux.ibm.com>",
    "before_after_code_files": [
      "src/tpm2/Marshal.c||src/tpm2/Marshal.c",
      "src/tpm2/Marshal_fp.h||src/tpm2/Marshal_fp.h",
      "src/tpm2/NVMarshal.c||src/tpm2/NVMarshal.c"
    ]
  },
  "patch_diff": {
    "src/tpm2/Marshal.c||src/tpm2/Marshal.c": [
      "File: src/tpm2/Marshal.c -> src/tpm2/Marshal.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "62: #include <string.h>",
      "64: #include \"Tpm.h\"",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "62: #include <assert.h> // libtpms added",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "176: }",
      "178: UINT16",
      "180: {",
      "181:     UINT16 written = 0;",
      "182:     written += UINT16_Marshal(&(source->size), buffer, size);",
      "183:     written += Array_Marshal(source->buffer, source->size, buffer, size);",
      "184:     return written;",
      "",
      "[Removed Lines]",
      "179: TPM2B_Marshal(TPM2B *source, BYTE **buffer, INT32 *size)",
      "",
      "[Added Lines]",
      "180: TPM2B_Marshal(TPM2B *source, UINT32 maxSize, BYTE **buffer, INT32 *size)",
      "183:     assert(source->size <= maxSize); // libtpms added",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "503: TPM2B_DIGEST_Marshal(TPM2B_DIGEST *source, BYTE **buffer, INT32 *size)",
      "504: {",
      "505: UINT16 written = 0;",
      "507: return written;",
      "508: }",
      "",
      "[Removed Lines]",
      "506: written += TPM2B_Marshal(&source->b, buffer, size);",
      "",
      "[Added Lines]",
      "508: written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "513: TPM2B_DATA_Marshal(TPM2B_DATA *source, BYTE **buffer, INT32 *size)",
      "514: {",
      "515: UINT16 written = 0;",
      "517: return written;",
      "518: }",
      "",
      "[Removed Lines]",
      "516: written += TPM2B_Marshal(&source->b, buffer, size);",
      "",
      "[Added Lines]",
      "518: written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "543: TPM2B_MAX_BUFFER_Marshal(TPM2B_MAX_BUFFER *source, BYTE **buffer, INT32 *size)",
      "544: {",
      "545:     UINT16 written = 0;",
      "547:     return written;",
      "548: }",
      "",
      "[Removed Lines]",
      "546:     written += TPM2B_Marshal(&source->b, buffer, size);",
      "",
      "[Added Lines]",
      "548:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "553: TPM2B_MAX_NV_BUFFER_Marshal(TPM2B_MAX_NV_BUFFER *source, BYTE **buffer, INT32 *size)",
      "554: {",
      "555:     UINT16 written = 0;",
      "557:     return written;",
      "558: }",
      "",
      "[Removed Lines]",
      "556:     written += TPM2B_Marshal(&source->b, buffer, size);",
      "",
      "[Added Lines]",
      "558:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "562: TPM2B_TIMEOUT_Marshal(TPM2B_TIMEOUT *source, BYTE **buffer, INT32 *size)",
      "563: {",
      "564:     UINT16 written = 0;",
      "566:     return written;",
      "567: }",
      "",
      "[Removed Lines]",
      "565:     written += TPM2B_Marshal(&source->b, buffer, size);",
      "",
      "[Added Lines]",
      "567:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
      "",
      "---------------",
      "--- Hunk 8 ---",
      "[Context before]",
      "572: TPM2B_IV_Marshal(TPM2B_IV *source, BYTE **buffer, INT32 *size)",
      "573: {",
      "574:     UINT16 written = 0;",
      "576:     return written;",
      "577: }",
      "",
      "[Removed Lines]",
      "575:     written += TPM2B_Marshal(&source->b, buffer, size);",
      "",
      "[Added Lines]",
      "577:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
      "",
      "---------------",
      "--- Hunk 9 ---",
      "[Context before]",
      "582: TPM2B_NAME_Marshal(TPM2B_NAME *source, BYTE **buffer, INT32 *size)",
      "583: {",
      "584:     UINT16 written = 0;",
      "586:     return written;",
      "587: }",
      "",
      "[Removed Lines]",
      "585:     written += TPM2B_Marshal(&source->b, buffer, size);",
      "",
      "[Added Lines]",
      "587:     written += TPM2B_Marshal(&source->b, sizeof(source->t.name), buffer, size); // libtpms changed",
      "",
      "---------------",
      "--- Hunk 10 ---",
      "[Context before]",
      "1163: TPM2B_ATTEST_Marshal(TPM2B_ATTEST *source, BYTE **buffer, INT32 *size)",
      "1164: {",
      "1165:     UINT16 written = 0;",
      "1167:     return written;",
      "1168: }",
      "",
      "[Removed Lines]",
      "1166:     written += TPM2B_Marshal(&source->b, buffer, size);",
      "",
      "[Added Lines]",
      "1168:     written += TPM2B_Marshal(&source->b, sizeof(source->t.attestationData), buffer, size); // libtpms changed",
      "",
      "---------------",
      "--- Hunk 11 ---",
      "[Context before]",
      "1294: TPM2B_SYM_KEY_Marshal(TPM2B_SYM_KEY *source, BYTE **buffer, INT32 *size)",
      "1295: {",
      "1296:     UINT16 written = 0;",
      "1298:     return written;",
      "1299: }",
      "",
      "[Removed Lines]",
      "1297:     written += TPM2B_Marshal(&source->b, buffer, size);",
      "",
      "[Added Lines]",
      "1299:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
      "",
      "---------------",
      "--- Hunk 12 ---",
      "[Context before]",
      "1315: TPM2B_SENSITIVE_DATA_Marshal(TPM2B_SENSITIVE_DATA *source, BYTE **buffer, INT32 *size)",
      "1316: {",
      "1317:     UINT16 written = 0;",
      "1319:     return written;",
      "1320: }",
      "",
      "[Removed Lines]",
      "1318:     written += TPM2B_Marshal(&source->b, buffer, size);",
      "",
      "[Added Lines]",
      "1320:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
      "",
      "---------------",
      "--- Hunk 13 ---",
      "[Context before]",
      "1673: TPM2B_PUBLIC_KEY_RSA_Marshal(TPM2B_PUBLIC_KEY_RSA *source, BYTE **buffer, INT32 *size)",
      "1674: {",
      "1675:     UINT16 written = 0;",
      "1677:     return written;",
      "1678: }",
      "",
      "[Removed Lines]",
      "1676:     written += TPM2B_Marshal(&source->b, buffer, size);",
      "",
      "[Added Lines]",
      "1678:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
      "",
      "---------------",
      "--- Hunk 14 ---",
      "[Context before]",
      "1693: TPM2B_PRIVATE_KEY_RSA_Marshal(TPM2B_PRIVATE_KEY_RSA *source, BYTE **buffer, INT32 *size)",
      "1694: {",
      "1695:     UINT16 written = 0;",
      "1697:     return written;",
      "1698: }",
      "",
      "[Removed Lines]",
      "1696:     written += TPM2B_Marshal(&source->b, buffer, size);",
      "",
      "[Added Lines]",
      "1698:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
      "",
      "---------------",
      "--- Hunk 15 ---",
      "[Context before]",
      "1703: TPM2B_ECC_PARAMETER_Marshal(TPM2B_ECC_PARAMETER *source, BYTE **buffer, INT32 *size)",
      "1704: {",
      "1705:     UINT16 written = 0;",
      "1707:     return written;",
      "1708: }",
      "",
      "[Removed Lines]",
      "1706:     written += TPM2B_Marshal(&source->b, buffer, size);",
      "",
      "[Added Lines]",
      "1708:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
      "",
      "---------------",
      "--- Hunk 16 ---",
      "[Context before]",
      "1937: TPM2B_ENCRYPTED_SECRET_Marshal(TPM2B_ENCRYPTED_SECRET *source, BYTE **buffer, INT32 *size)",
      "1938: {",
      "1939:     UINT16 written = 0;",
      "1941:     return written;",
      "1942: }",
      "",
      "[Removed Lines]",
      "1940:     written += TPM2B_Marshal(&source->b, buffer, size);",
      "",
      "[Added Lines]",
      "1942:     written += TPM2B_Marshal(&source->b, sizeof(source->t.secret), buffer, size); // libtpms changed",
      "",
      "---------------",
      "--- Hunk 17 ---",
      "[Context before]",
      "2148: TPM2B_PRIVATE_Marshal(TPM2B_PRIVATE *source, BYTE **buffer, INT32 *size)",
      "2149: {",
      "2150:     UINT16 written = 0;",
      "2152:     return written;",
      "2153: }",
      "",
      "[Removed Lines]",
      "2151:     written += TPM2B_Marshal(&source->b, buffer, size);",
      "",
      "[Added Lines]",
      "2153:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
      "",
      "---------------",
      "--- Hunk 18 ---",
      "[Context before]",
      "2158: TPM2B_ID_OBJECT_Marshal(TPM2B_ID_OBJECT *source, BYTE **buffer, INT32 *size)",
      "2159: {",
      "2160:     UINT16 written = 0;",
      "2162:     return written;",
      "2163: }",
      "",
      "[Removed Lines]",
      "2161:     written += TPM2B_Marshal(&source->b, buffer, size);",
      "",
      "[Added Lines]",
      "2163:     written += TPM2B_Marshal(&source->b, sizeof(source->t.credential), buffer, size); // libtpms changed",
      "",
      "---------------",
      "--- Hunk 19 ---",
      "[Context before]",
      "2215: TPM2B_CONTEXT_DATA_Marshal(TPM2B_CONTEXT_DATA  *source, BYTE **buffer, INT32 *size)",
      "2216: {",
      "2217:     UINT16 written = 0;",
      "2219:     return written;",
      "2220: }",
      "",
      "[Removed Lines]",
      "2218:     written += TPM2B_Marshal(&source->b, buffer, size);",
      "",
      "[Added Lines]",
      "2220:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
      "",
      "---------------"
    ],
    "src/tpm2/Marshal_fp.h||src/tpm2/Marshal_fp.h": [
      "File: src/tpm2/Marshal_fp.h -> src/tpm2/Marshal_fp.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "79:     UINT16",
      "80:     Array_Marshal(BYTE *sourceBuffer, UINT16 sourceSize, BYTE **buffer, INT32 *size);",
      "81:     UINT16",
      "83:     UINT16",
      "84:     TPM_KEY_BITS_Marshal(TPM_KEY_BITS *source, BYTE **buffer, INT32 *size);",
      "85:     UINT16",
      "",
      "[Removed Lines]",
      "82:     TPM2B_Marshal(TPM2B *source, BYTE **buffer, INT32 *size);",
      "",
      "[Added Lines]",
      "82:     TPM2B_Marshal(TPM2B *source, UINT32 maxSize, BYTE **buffer, INT32 *size); // libtpms changed",
      "",
      "---------------"
    ],
    "src/tpm2/NVMarshal.c||src/tpm2/NVMarshal.c": [
      "File: src/tpm2/NVMarshal.c -> src/tpm2/NVMarshal.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "278: TPM2B_PROOF_Marshal(TPM2B_PROOF *source, BYTE **buffer, INT32 *size)",
      "279: {",
      "280:     UINT16 written = 0;",
      "282:     return written;",
      "283: }",
      "",
      "[Removed Lines]",
      "281:     written += TPM2B_Marshal(&source->b, buffer, size);",
      "",
      "[Added Lines]",
      "281:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size);",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "1414:                                 STATE_RESET_DATA_VERSION,",
      "1415:                                 STATE_RESET_DATA_MAGIC, 4);",
      "1416:     written += TPM2B_PROOF_Marshal(&data->nullProof, buffer, size);",
      "1418:     written += UINT32_Marshal(&data->clearCount, buffer, size);",
      "1419:     written += UINT64_Marshal(&data->objectContextID, buffer, size);",
      "",
      "[Removed Lines]",
      "1417:     written += TPM2B_Marshal(&data->nullSeed.b, buffer, size);",
      "",
      "[Added Lines]",
      "1417:     written += TPM2B_Marshal(&data->nullSeed.b, sizeof(data->nullSeed.t.buffer), buffer, size);",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "2203: {",
      "2204:     UINT16 written;",
      "2208:     return written;",
      "2209: }",
      "",
      "[Removed Lines]",
      "2206:     written = TPM2B_Marshal(&data->b, buffer, size);",
      "",
      "[Added Lines]",
      "2206:     written = TPM2B_Marshal(&data->b, sizeof(data->t.buffer), buffer, size);",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "3089:     NvRead(&pd, NV_PERSISTENT_DATA, sizeof(pd));",
      "",
      "[Removed Lines]",
      "3090:     written += TPM2B_Marshal(&pd.EPSeed.b, buffer, size);",
      "3091:     written += TPM2B_Marshal(&pd.SPSeed.b, buffer, size);",
      "3092:     written += TPM2B_Marshal(&pd.PPSeed.b, buffer, size);",
      "",
      "[Added Lines]",
      "3090:     written += TPM2B_Marshal(&pd.EPSeed.b, sizeof(pd.EPSeed.t.buffer), buffer, size);",
      "3091:     written += TPM2B_Marshal(&pd.SPSeed.b, sizeof(pd.SPSeed.t.buffer), buffer, size);",
      "3092:     written += TPM2B_Marshal(&pd.PPSeed.b, sizeof(pd.PPSeed.t.buffer), buffer, size);",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "3906:     written += TPM2B_AUTH_Marshal(&data->ownerAuth, buffer, size);",
      "3907:     written += TPM2B_AUTH_Marshal(&data->endorsementAuth, buffer, size);",
      "3908:     written += TPM2B_AUTH_Marshal(&data->lockoutAuth, buffer, size);",
      "3912:     written += TPM2B_PROOF_Marshal(&data->phProof, buffer, size);",
      "3913:     written += TPM2B_PROOF_Marshal(&data->shProof, buffer, size);",
      "3914:     written += TPM2B_PROOF_Marshal(&data->ehProof, buffer, size);",
      "",
      "[Removed Lines]",
      "3909:     written += TPM2B_Marshal(&data->EPSeed.b, buffer, size);",
      "3910:     written += TPM2B_Marshal(&data->SPSeed.b, buffer, size);",
      "3911:     written += TPM2B_Marshal(&data->PPSeed.b, buffer, size);",
      "",
      "[Added Lines]",
      "3909:     written += TPM2B_Marshal(&data->EPSeed.b, sizeof(data->EPSeed.t.buffer), buffer, size);",
      "3910:     written += TPM2B_Marshal(&data->SPSeed.b, sizeof(data->SPSeed.t.buffer), buffer, size);",
      "3911:     written += TPM2B_Marshal(&data->PPSeed.b, sizeof(data->PPSeed.t.buffer), buffer, size);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "3ef9b26cb9f28bd64d738bff9505a20d4eb56acd",
      "candidate_info": {
        "commit_hash": "3ef9b26cb9f28bd64d738bff9505a20d4eb56acd",
        "repo": "stefanberger/libtpms",
        "commit_url": "https://github.com/stefanberger/libtpms/commit/3ef9b26cb9f28bd64d738bff9505a20d4eb56acd",
        "files": [
          "src/tpm2/Marshal.c",
          "src/tpm2/Marshal_fp.h",
          "src/tpm2/NVMarshal.c"
        ],
        "message": "tpm2: Add maxSize parameter to TPM2B_Marshal for sanity checks\n\nAdd maxSize parameter to TPM2B_Marshal and assert on it checking\nthe size of the data intended to be marshaled versus the maximum\nbuffer size.\n\nSigned-off-by: Stefan Berger <stefanb@linux.ibm.com>",
        "before_after_code_files": [
          "src/tpm2/Marshal.c||src/tpm2/Marshal.c",
          "src/tpm2/Marshal_fp.h||src/tpm2/Marshal_fp.h",
          "src/tpm2/NVMarshal.c||src/tpm2/NVMarshal.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "src/tpm2/Marshal.c||src/tpm2/Marshal.c",
            "src/tpm2/Marshal_fp.h||src/tpm2/Marshal_fp.h",
            "src/tpm2/NVMarshal.c||src/tpm2/NVMarshal.c"
          ],
          "candidate": [
            "src/tpm2/Marshal.c||src/tpm2/Marshal.c",
            "src/tpm2/Marshal_fp.h||src/tpm2/Marshal_fp.h",
            "src/tpm2/NVMarshal.c||src/tpm2/NVMarshal.c"
          ]
        }
      },
      "candidate_diff": {
        "src/tpm2/Marshal.c||src/tpm2/Marshal.c": [
          "File: src/tpm2/Marshal.c -> src/tpm2/Marshal.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "62: #include <string.h>",
          "64: #include \"Tpm.h\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "62: #include <assert.h> // libtpms added",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "176: }",
          "178: UINT16",
          "180: {",
          "181:     UINT16 written = 0;",
          "182:     written += UINT16_Marshal(&(source->size), buffer, size);",
          "183:     written += Array_Marshal(source->buffer, source->size, buffer, size);",
          "184:     return written;",
          "",
          "[Removed Lines]",
          "179: TPM2B_Marshal(TPM2B *source, BYTE **buffer, INT32 *size)",
          "",
          "[Added Lines]",
          "180: TPM2B_Marshal(TPM2B *source, UINT32 maxSize, BYTE **buffer, INT32 *size)",
          "183:     assert(source->size <= maxSize); // libtpms added",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "503: TPM2B_DIGEST_Marshal(TPM2B_DIGEST *source, BYTE **buffer, INT32 *size)",
          "504: {",
          "505: UINT16 written = 0;",
          "507: return written;",
          "508: }",
          "",
          "[Removed Lines]",
          "506: written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "508: written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "513: TPM2B_DATA_Marshal(TPM2B_DATA *source, BYTE **buffer, INT32 *size)",
          "514: {",
          "515: UINT16 written = 0;",
          "517: return written;",
          "518: }",
          "",
          "[Removed Lines]",
          "516: written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "518: written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "543: TPM2B_MAX_BUFFER_Marshal(TPM2B_MAX_BUFFER *source, BYTE **buffer, INT32 *size)",
          "544: {",
          "545:     UINT16 written = 0;",
          "547:     return written;",
          "548: }",
          "",
          "[Removed Lines]",
          "546:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "548:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "553: TPM2B_MAX_NV_BUFFER_Marshal(TPM2B_MAX_NV_BUFFER *source, BYTE **buffer, INT32 *size)",
          "554: {",
          "555:     UINT16 written = 0;",
          "557:     return written;",
          "558: }",
          "",
          "[Removed Lines]",
          "556:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "558:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "562: TPM2B_TIMEOUT_Marshal(TPM2B_TIMEOUT *source, BYTE **buffer, INT32 *size)",
          "563: {",
          "564:     UINT16 written = 0;",
          "566:     return written;",
          "567: }",
          "",
          "[Removed Lines]",
          "565:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "567:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "572: TPM2B_IV_Marshal(TPM2B_IV *source, BYTE **buffer, INT32 *size)",
          "573: {",
          "574:     UINT16 written = 0;",
          "576:     return written;",
          "577: }",
          "",
          "[Removed Lines]",
          "575:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "577:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "582: TPM2B_NAME_Marshal(TPM2B_NAME *source, BYTE **buffer, INT32 *size)",
          "583: {",
          "584:     UINT16 written = 0;",
          "586:     return written;",
          "587: }",
          "",
          "[Removed Lines]",
          "585:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "587:     written += TPM2B_Marshal(&source->b, sizeof(source->t.name), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "1163: TPM2B_ATTEST_Marshal(TPM2B_ATTEST *source, BYTE **buffer, INT32 *size)",
          "1164: {",
          "1165:     UINT16 written = 0;",
          "1167:     return written;",
          "1168: }",
          "",
          "[Removed Lines]",
          "1166:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "1168:     written += TPM2B_Marshal(&source->b, sizeof(source->t.attestationData), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "1294: TPM2B_SYM_KEY_Marshal(TPM2B_SYM_KEY *source, BYTE **buffer, INT32 *size)",
          "1295: {",
          "1296:     UINT16 written = 0;",
          "1298:     return written;",
          "1299: }",
          "",
          "[Removed Lines]",
          "1297:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "1299:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "1315: TPM2B_SENSITIVE_DATA_Marshal(TPM2B_SENSITIVE_DATA *source, BYTE **buffer, INT32 *size)",
          "1316: {",
          "1317:     UINT16 written = 0;",
          "1319:     return written;",
          "1320: }",
          "",
          "[Removed Lines]",
          "1318:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "1320:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "1673: TPM2B_PUBLIC_KEY_RSA_Marshal(TPM2B_PUBLIC_KEY_RSA *source, BYTE **buffer, INT32 *size)",
          "1674: {",
          "1675:     UINT16 written = 0;",
          "1677:     return written;",
          "1678: }",
          "",
          "[Removed Lines]",
          "1676:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "1678:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "1693: TPM2B_PRIVATE_KEY_RSA_Marshal(TPM2B_PRIVATE_KEY_RSA *source, BYTE **buffer, INT32 *size)",
          "1694: {",
          "1695:     UINT16 written = 0;",
          "1697:     return written;",
          "1698: }",
          "",
          "[Removed Lines]",
          "1696:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "1698:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1703: TPM2B_ECC_PARAMETER_Marshal(TPM2B_ECC_PARAMETER *source, BYTE **buffer, INT32 *size)",
          "1704: {",
          "1705:     UINT16 written = 0;",
          "1707:     return written;",
          "1708: }",
          "",
          "[Removed Lines]",
          "1706:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "1708:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1937: TPM2B_ENCRYPTED_SECRET_Marshal(TPM2B_ENCRYPTED_SECRET *source, BYTE **buffer, INT32 *size)",
          "1938: {",
          "1939:     UINT16 written = 0;",
          "1941:     return written;",
          "1942: }",
          "",
          "[Removed Lines]",
          "1940:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "1942:     written += TPM2B_Marshal(&source->b, sizeof(source->t.secret), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "2148: TPM2B_PRIVATE_Marshal(TPM2B_PRIVATE *source, BYTE **buffer, INT32 *size)",
          "2149: {",
          "2150:     UINT16 written = 0;",
          "2152:     return written;",
          "2153: }",
          "",
          "[Removed Lines]",
          "2151:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "2153:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "2158: TPM2B_ID_OBJECT_Marshal(TPM2B_ID_OBJECT *source, BYTE **buffer, INT32 *size)",
          "2159: {",
          "2160:     UINT16 written = 0;",
          "2162:     return written;",
          "2163: }",
          "",
          "[Removed Lines]",
          "2161:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "2163:     written += TPM2B_Marshal(&source->b, sizeof(source->t.credential), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "2215: TPM2B_CONTEXT_DATA_Marshal(TPM2B_CONTEXT_DATA  *source, BYTE **buffer, INT32 *size)",
          "2216: {",
          "2217:     UINT16 written = 0;",
          "2219:     return written;",
          "2220: }",
          "",
          "[Removed Lines]",
          "2218:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "2220:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
          "",
          "---------------"
        ],
        "src/tpm2/Marshal_fp.h||src/tpm2/Marshal_fp.h": [
          "File: src/tpm2/Marshal_fp.h -> src/tpm2/Marshal_fp.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "79:     UINT16",
          "80:     Array_Marshal(BYTE *sourceBuffer, UINT16 sourceSize, BYTE **buffer, INT32 *size);",
          "81:     UINT16",
          "83:     UINT16",
          "84:     TPM_KEY_BITS_Marshal(TPM_KEY_BITS *source, BYTE **buffer, INT32 *size);",
          "85:     UINT16",
          "",
          "[Removed Lines]",
          "82:     TPM2B_Marshal(TPM2B *source, BYTE **buffer, INT32 *size);",
          "",
          "[Added Lines]",
          "82:     TPM2B_Marshal(TPM2B *source, UINT32 maxSize, BYTE **buffer, INT32 *size); // libtpms changed",
          "",
          "---------------"
        ],
        "src/tpm2/NVMarshal.c||src/tpm2/NVMarshal.c": [
          "File: src/tpm2/NVMarshal.c -> src/tpm2/NVMarshal.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "278: TPM2B_PROOF_Marshal(TPM2B_PROOF *source, BYTE **buffer, INT32 *size)",
          "279: {",
          "280:     UINT16 written = 0;",
          "282:     return written;",
          "283: }",
          "",
          "[Removed Lines]",
          "281:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "281:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1390:                                 STATE_RESET_DATA_VERSION,",
          "1391:                                 STATE_RESET_DATA_MAGIC, 3);",
          "1392:     written += TPM2B_PROOF_Marshal(&data->nullProof, buffer, size);",
          "1394:     written += UINT32_Marshal(&data->clearCount, buffer, size);",
          "1395:     written += UINT64_Marshal(&data->objectContextID, buffer, size);",
          "",
          "[Removed Lines]",
          "1393:     written += TPM2B_Marshal(&data->nullSeed.b, buffer, size);",
          "",
          "[Added Lines]",
          "1393:     written += TPM2B_Marshal(&data->nullSeed.b, sizeof(data->nullSeed.t.buffer), buffer, size);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "2178: {",
          "2179:     UINT16 written;",
          "2183:     return written;",
          "2184: }",
          "",
          "[Removed Lines]",
          "2181:     written = TPM2B_Marshal(&data->b, buffer, size);",
          "",
          "[Added Lines]",
          "2181:     written = TPM2B_Marshal(&data->b, sizeof(data->t.buffer), buffer, size);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "3064:     NvRead(&pd, NV_PERSISTENT_DATA, sizeof(pd));",
          "",
          "[Removed Lines]",
          "3065:     written += TPM2B_Marshal(&pd.EPSeed.b, buffer, size);",
          "3066:     written += TPM2B_Marshal(&pd.SPSeed.b, buffer, size);",
          "3067:     written += TPM2B_Marshal(&pd.PPSeed.b, buffer, size);",
          "",
          "[Added Lines]",
          "3065:     written += TPM2B_Marshal(&pd.EPSeed.b, sizeof(pd.EPSeed.t.buffer), buffer, size);",
          "3066:     written += TPM2B_Marshal(&pd.SPSeed.b, sizeof(pd.SPSeed.t.buffer), buffer, size);",
          "3067:     written += TPM2B_Marshal(&pd.PPSeed.b, sizeof(pd.PPSeed.t.buffer), buffer, size);",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "3881:     written += TPM2B_AUTH_Marshal(&data->ownerAuth, buffer, size);",
          "3882:     written += TPM2B_AUTH_Marshal(&data->endorsementAuth, buffer, size);",
          "3883:     written += TPM2B_AUTH_Marshal(&data->lockoutAuth, buffer, size);",
          "3887:     written += TPM2B_PROOF_Marshal(&data->phProof, buffer, size);",
          "3888:     written += TPM2B_PROOF_Marshal(&data->shProof, buffer, size);",
          "3889:     written += TPM2B_PROOF_Marshal(&data->ehProof, buffer, size);",
          "",
          "[Removed Lines]",
          "3884:     written += TPM2B_Marshal(&data->EPSeed.b, buffer, size);",
          "3885:     written += TPM2B_Marshal(&data->SPSeed.b, buffer, size);",
          "3886:     written += TPM2B_Marshal(&data->PPSeed.b, buffer, size);",
          "",
          "[Added Lines]",
          "3884:     written += TPM2B_Marshal(&data->EPSeed.b, sizeof(data->EPSeed.t.buffer), buffer, size);",
          "3885:     written += TPM2B_Marshal(&data->SPSeed.b, sizeof(data->SPSeed.t.buffer), buffer, size);",
          "3886:     written += TPM2B_Marshal(&data->PPSeed.b, sizeof(data->PPSeed.t.buffer), buffer, size);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "d29d80c8ca14f793ef9a572945b232a52aa72c54",
      "candidate_info": {
        "commit_hash": "d29d80c8ca14f793ef9a572945b232a52aa72c54",
        "repo": "stefanberger/libtpms",
        "commit_url": "https://github.com/stefanberger/libtpms/commit/d29d80c8ca14f793ef9a572945b232a52aa72c54",
        "files": [
          "src/tpm2/Marshal.c",
          "src/tpm2/Marshal_fp.h",
          "src/tpm2/NVMarshal.c"
        ],
        "message": "tpm2: Add maxSize parameter to TPM2B_Marshal for sanity checks\n\nAdd maxSize parameter to TPM2B_Marshal and assert on it checking\nthe size of the data intended to be marshaled versus the maximum\nbuffer size.\n\nSigned-off-by: Stefan Berger <stefanb@linux.ibm.com>",
        "before_after_code_files": [
          "src/tpm2/Marshal.c||src/tpm2/Marshal.c",
          "src/tpm2/Marshal_fp.h||src/tpm2/Marshal_fp.h",
          "src/tpm2/NVMarshal.c||src/tpm2/NVMarshal.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "src/tpm2/Marshal.c||src/tpm2/Marshal.c",
            "src/tpm2/Marshal_fp.h||src/tpm2/Marshal_fp.h",
            "src/tpm2/NVMarshal.c||src/tpm2/NVMarshal.c"
          ],
          "candidate": [
            "src/tpm2/Marshal.c||src/tpm2/Marshal.c",
            "src/tpm2/Marshal_fp.h||src/tpm2/Marshal_fp.h",
            "src/tpm2/NVMarshal.c||src/tpm2/NVMarshal.c"
          ]
        }
      },
      "candidate_diff": {
        "src/tpm2/Marshal.c||src/tpm2/Marshal.c": [
          "File: src/tpm2/Marshal.c -> src/tpm2/Marshal.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "64: #include <string.h>",
          "66: #include \"Tpm.h\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "64: #include <assert.h> // libtpms added",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "178: }",
          "180: UINT16",
          "182: {",
          "183:     UINT16 written = 0;",
          "184:     written += UINT16_Marshal(&(source->size), buffer, size);",
          "185:     written += Array_Marshal(source->buffer, source->size, buffer, size);",
          "186:     return written;",
          "",
          "[Removed Lines]",
          "181: TPM2B_Marshal(TPM2B *source, BYTE **buffer, INT32 *size)",
          "",
          "[Added Lines]",
          "182: TPM2B_Marshal(TPM2B *source, UINT32 maxSize, BYTE **buffer, INT32 *size)",
          "185:     assert(source->size <= maxSize); // libtpms added",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "495: TPM2B_DIGEST_Marshal(TPM2B_DIGEST *source, BYTE **buffer, INT32 *size)",
          "496: {",
          "497: UINT16 written = 0;",
          "499: return written;",
          "500: }",
          "",
          "[Removed Lines]",
          "498: written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "500: written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "505: TPM2B_DATA_Marshal(TPM2B_DATA *source, BYTE **buffer, INT32 *size)",
          "506: {",
          "507: UINT16 written = 0;",
          "509: return written;",
          "510: }",
          "",
          "[Removed Lines]",
          "508: written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "510: written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "535: TPM2B_MAX_BUFFER_Marshal(TPM2B_MAX_BUFFER *source, BYTE **buffer, INT32 *size)",
          "536: {",
          "537:     UINT16 written = 0;",
          "539:     return written;",
          "540: }",
          "",
          "[Removed Lines]",
          "538:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "540:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "545: TPM2B_MAX_NV_BUFFER_Marshal(TPM2B_MAX_NV_BUFFER *source, BYTE **buffer, INT32 *size)",
          "546: {",
          "547:     UINT16 written = 0;",
          "549:     return written;",
          "550: }",
          "",
          "[Removed Lines]",
          "548:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "550:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "554: TPM2B_TIMEOUT_Marshal(TPM2B_TIMEOUT *source, BYTE **buffer, INT32 *size)",
          "555: {",
          "556:     UINT16 written = 0;",
          "558:     return written;",
          "559: }",
          "",
          "[Removed Lines]",
          "557:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "559:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "564: TPM2B_IV_Marshal(TPM2B_IV *source, BYTE **buffer, INT32 *size)",
          "565: {",
          "566:     UINT16 written = 0;",
          "568:     return written;",
          "569: }",
          "",
          "[Removed Lines]",
          "567:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "569:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "574: TPM2B_NAME_Marshal(TPM2B_NAME *source, BYTE **buffer, INT32 *size)",
          "575: {",
          "576:     UINT16 written = 0;",
          "578:     return written;",
          "579: }",
          "",
          "[Removed Lines]",
          "577:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "579:     written += TPM2B_Marshal(&source->b, sizeof(source->t.name), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "1111: TPM2B_ATTEST_Marshal(TPM2B_ATTEST *source, BYTE **buffer, INT32 *size)",
          "1112: {",
          "1113:     UINT16 written = 0;",
          "1115:     return written;",
          "1116: }",
          "",
          "[Removed Lines]",
          "1114:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "1116:     written += TPM2B_Marshal(&source->b, sizeof(source->t.attestationData), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "1232: TPM2B_SYM_KEY_Marshal(TPM2B_SYM_KEY *source, BYTE **buffer, INT32 *size)",
          "1233: {",
          "1234:     UINT16 written = 0;",
          "1236:     return written;",
          "1237: }",
          "",
          "[Removed Lines]",
          "1235:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "1237:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "1253: TPM2B_SENSITIVE_DATA_Marshal(TPM2B_SENSITIVE_DATA *source, BYTE **buffer, INT32 *size)",
          "1254: {",
          "1255:     UINT16 written = 0;",
          "1257:     return written;",
          "1258: }",
          "",
          "[Removed Lines]",
          "1256:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "1258:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "1613: TPM2B_PUBLIC_KEY_RSA_Marshal(TPM2B_PUBLIC_KEY_RSA *source, BYTE **buffer, INT32 *size)",
          "1614: {",
          "1615:     UINT16 written = 0;",
          "1617:     return written;",
          "1618: }",
          "",
          "[Removed Lines]",
          "1616:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "1618:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "1633: TPM2B_PRIVATE_KEY_RSA_Marshal(TPM2B_PRIVATE_KEY_RSA *source, BYTE **buffer, INT32 *size)",
          "1634: {",
          "1635:     UINT16 written = 0;",
          "1637:     return written;",
          "1638: }",
          "",
          "[Removed Lines]",
          "1636:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "1638:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1643: TPM2B_ECC_PARAMETER_Marshal(TPM2B_ECC_PARAMETER *source, BYTE **buffer, INT32 *size)",
          "1644: {",
          "1645:     UINT16 written = 0;",
          "1647:     return written;",
          "1648: }",
          "",
          "[Removed Lines]",
          "1646:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "1648:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1879: TPM2B_ENCRYPTED_SECRET_Marshal(TPM2B_ENCRYPTED_SECRET *source, BYTE **buffer, INT32 *size)",
          "1880: {",
          "1881:     UINT16 written = 0;",
          "1883:     return written;",
          "1884: }",
          "",
          "[Removed Lines]",
          "1882:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "1884:     written += TPM2B_Marshal(&source->b, sizeof(source->t.secret), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "2090: TPM2B_PRIVATE_Marshal(TPM2B_PRIVATE *source, BYTE **buffer, INT32 *size)",
          "2091: {",
          "2092:     UINT16 written = 0;",
          "2094:     return written;",
          "2095: }",
          "",
          "[Removed Lines]",
          "2093:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "2095:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "2100: TPM2B_ID_OBJECT_Marshal(TPM2B_ID_OBJECT *source, BYTE **buffer, INT32 *size)",
          "2101: {",
          "2102:     UINT16 written = 0;",
          "2104:     return written;",
          "2105: }",
          "",
          "[Removed Lines]",
          "2103:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "2105:     written += TPM2B_Marshal(&source->b, sizeof(source->t.credential), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "2157: TPM2B_CONTEXT_DATA_Marshal(TPM2B_CONTEXT_DATA  *source, BYTE **buffer, INT32 *size)",
          "2158: {",
          "2159:     UINT16 written = 0;",
          "2161:     return written;",
          "2162: }",
          "",
          "[Removed Lines]",
          "2160:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "2162:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
          "",
          "---------------"
        ],
        "src/tpm2/Marshal_fp.h||src/tpm2/Marshal_fp.h": [
          "File: src/tpm2/Marshal_fp.h -> src/tpm2/Marshal_fp.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "79:     UINT16",
          "80:     Array_Marshal(BYTE *sourceBuffer, UINT16 sourceSize, BYTE **buffer, INT32 *size);",
          "81:     UINT16",
          "83:     UINT16",
          "84:     TPM_KEY_BITS_Marshal(TPM_KEY_BITS *source, BYTE **buffer, INT32 *size);",
          "85:     UINT16",
          "",
          "[Removed Lines]",
          "82:     TPM2B_Marshal(TPM2B *source, BYTE **buffer, INT32 *size);",
          "",
          "[Added Lines]",
          "82:     TPM2B_Marshal(TPM2B *source, UINT32 maxSize, BYTE **buffer, INT32 *size); // libtpms changed",
          "",
          "---------------"
        ],
        "src/tpm2/NVMarshal.c||src/tpm2/NVMarshal.c": [
          "File: src/tpm2/NVMarshal.c -> src/tpm2/NVMarshal.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "255: TPM2B_PROOF_Marshal(TPM2B_PROOF *source, BYTE **buffer, INT32 *size)",
          "256: {",
          "257:     UINT16 written = 0;",
          "259:     return written;",
          "260: }",
          "",
          "[Removed Lines]",
          "258:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "258:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1332:                                 STATE_RESET_DATA_VERSION,",
          "1333:                                 STATE_RESET_DATA_MAGIC, 1);",
          "1334:     written += TPM2B_PROOF_Marshal(&data->nullProof, buffer, size);",
          "1336:     written += UINT32_Marshal(&data->clearCount, buffer, size);",
          "1337:     written += UINT64_Marshal(&data->objectContextID, buffer, size);",
          "",
          "[Removed Lines]",
          "1335:     written += TPM2B_Marshal(&data->nullSeed.b, buffer, size);",
          "",
          "[Added Lines]",
          "1335:     written += TPM2B_Marshal(&data->nullSeed.b, sizeof(data->nullSeed.t.buffer), buffer, size);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "2115: {",
          "2116:     UINT16 written;",
          "2120:     return written;",
          "2121: }",
          "",
          "[Removed Lines]",
          "2118:     written = TPM2B_Marshal(&data->b, buffer, size);",
          "",
          "[Added Lines]",
          "2118:     written = TPM2B_Marshal(&data->b, sizeof(data->t.buffer), buffer, size);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "2982:     NvRead(&pd, NV_PERSISTENT_DATA, sizeof(pd));",
          "",
          "[Removed Lines]",
          "2983:     written += TPM2B_Marshal(&pd.EPSeed.b, buffer, size);",
          "2984:     written += TPM2B_Marshal(&pd.SPSeed.b, buffer, size);",
          "2985:     written += TPM2B_Marshal(&pd.PPSeed.b, buffer, size);",
          "",
          "[Added Lines]",
          "2983:     written += TPM2B_Marshal(&pd.EPSeed.b, sizeof(pd.EPSeed.t.buffer), buffer, size);",
          "2984:     written += TPM2B_Marshal(&pd.SPSeed.b, sizeof(pd.SPSeed.t.buffer), buffer, size);",
          "2985:     written += TPM2B_Marshal(&pd.PPSeed.b, sizeof(pd.PPSeed.t.buffer), buffer, size);",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "3799:     written += TPM2B_AUTH_Marshal(&data->ownerAuth, buffer, size);",
          "3800:     written += TPM2B_AUTH_Marshal(&data->endorsementAuth, buffer, size);",
          "3801:     written += TPM2B_AUTH_Marshal(&data->lockoutAuth, buffer, size);",
          "3805:     written += TPM2B_PROOF_Marshal(&data->phProof, buffer, size);",
          "3806:     written += TPM2B_PROOF_Marshal(&data->shProof, buffer, size);",
          "3807:     written += TPM2B_PROOF_Marshal(&data->ehProof, buffer, size);",
          "",
          "[Removed Lines]",
          "3802:     written += TPM2B_Marshal(&data->EPSeed.b, buffer, size);",
          "3803:     written += TPM2B_Marshal(&data->SPSeed.b, buffer, size);",
          "3804:     written += TPM2B_Marshal(&data->PPSeed.b, buffer, size);",
          "",
          "[Added Lines]",
          "3802:     written += TPM2B_Marshal(&data->EPSeed.b, sizeof(data->EPSeed.t.buffer), buffer, size);",
          "3803:     written += TPM2B_Marshal(&data->SPSeed.b, sizeof(data->SPSeed.t.buffer), buffer, size);",
          "3804:     written += TPM2B_Marshal(&data->PPSeed.b, sizeof(data->PPSeed.t.buffer), buffer, size);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "90e0255762d383e69e3ba48abedfda4781c2b1c9",
      "candidate_info": {
        "commit_hash": "90e0255762d383e69e3ba48abedfda4781c2b1c9",
        "repo": "stefanberger/libtpms",
        "commit_url": "https://github.com/stefanberger/libtpms/commit/90e0255762d383e69e3ba48abedfda4781c2b1c9",
        "files": [
          "src/tpm2/Marshal.c",
          "src/tpm2/Marshal_fp.h",
          "src/tpm2/NVMarshal.c"
        ],
        "message": "tpm2: Add maxSize parameter to TPM2B_Marshal for sanity checks\n\nAdd maxSize parameter to TPM2B_Marshal and assert on it checking\nthe size of the data intended to be marshaled versus the maximum\nbuffer size.\n\nSigned-off-by: Stefan Berger <stefanb@linux.ibm.com>",
        "before_after_code_files": [
          "src/tpm2/Marshal.c||src/tpm2/Marshal.c",
          "src/tpm2/Marshal_fp.h||src/tpm2/Marshal_fp.h",
          "src/tpm2/NVMarshal.c||src/tpm2/NVMarshal.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "src/tpm2/Marshal.c||src/tpm2/Marshal.c",
            "src/tpm2/Marshal_fp.h||src/tpm2/Marshal_fp.h",
            "src/tpm2/NVMarshal.c||src/tpm2/NVMarshal.c"
          ],
          "candidate": [
            "src/tpm2/Marshal.c||src/tpm2/Marshal.c",
            "src/tpm2/Marshal_fp.h||src/tpm2/Marshal_fp.h",
            "src/tpm2/NVMarshal.c||src/tpm2/NVMarshal.c"
          ]
        }
      },
      "candidate_diff": {
        "src/tpm2/Marshal.c||src/tpm2/Marshal.c": [
          "File: src/tpm2/Marshal.c -> src/tpm2/Marshal.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "64: #include <string.h>",
          "66: #include \"Tpm.h\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "64: #include <assert.h> // libtpms added",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "190: }",
          "192: UINT16",
          "194: {",
          "195:     UINT16 written = 0;",
          "196:     written += UINT16_Marshal(&(source->size), buffer, size);",
          "197:     written += Array_Marshal(source->buffer, source->size, buffer, size);",
          "198:     return written;",
          "",
          "[Removed Lines]",
          "193: TPM2B_Marshal(TPM2B *source, BYTE **buffer, INT32 *size)",
          "",
          "[Added Lines]",
          "194: TPM2B_Marshal(TPM2B *source, UINT32 maxSize, BYTE **buffer, INT32 *size)",
          "197:     assert(source->size <= maxSize); // libtpms added",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "517: TPM2B_DIGEST_Marshal(TPM2B_DIGEST *source, BYTE **buffer, INT32 *size)",
          "518: {",
          "519: UINT16 written = 0;",
          "521: return written;",
          "522: }",
          "",
          "[Removed Lines]",
          "520: written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "522: written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "527: TPM2B_DATA_Marshal(TPM2B_DATA *source, BYTE **buffer, INT32 *size)",
          "528: {",
          "529: UINT16 written = 0;",
          "531: return written;",
          "532: }",
          "",
          "[Removed Lines]",
          "530: written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "532: written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "557: TPM2B_MAX_BUFFER_Marshal(TPM2B_MAX_BUFFER *source, BYTE **buffer, INT32 *size)",
          "558: {",
          "559:     UINT16 written = 0;",
          "561:     return written;",
          "562: }",
          "",
          "[Removed Lines]",
          "560:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "562:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "567: TPM2B_MAX_NV_BUFFER_Marshal(TPM2B_MAX_NV_BUFFER *source, BYTE **buffer, INT32 *size)",
          "568: {",
          "569:     UINT16 written = 0;",
          "571:     return written;",
          "572: }",
          "",
          "[Removed Lines]",
          "570:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "572:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "576: TPM2B_TIMEOUT_Marshal(TPM2B_TIMEOUT *source, BYTE **buffer, INT32 *size)",
          "577: {",
          "578:     UINT16 written = 0;",
          "580:     return written;",
          "581: }",
          "",
          "[Removed Lines]",
          "579:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "581:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "586: TPM2B_IV_Marshal(TPM2B_IV *source, BYTE **buffer, INT32 *size)",
          "587: {",
          "588:     UINT16 written = 0;",
          "590:     return written;",
          "591: }",
          "",
          "[Removed Lines]",
          "589:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "591:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "596: TPM2B_NAME_Marshal(TPM2B_NAME *source, BYTE **buffer, INT32 *size)",
          "597: {",
          "598:     UINT16 written = 0;",
          "600:     return written;",
          "601: }",
          "",
          "[Removed Lines]",
          "599:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "601:     written += TPM2B_Marshal(&source->b, sizeof(source->t.name), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "1133: TPM2B_ATTEST_Marshal(TPM2B_ATTEST *source, BYTE **buffer, INT32 *size)",
          "1134: {",
          "1135:     UINT16 written = 0;",
          "1137:     return written;",
          "1138: }",
          "",
          "[Removed Lines]",
          "1136:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "1138:     written += TPM2B_Marshal(&source->b, sizeof(source->t.attestationData), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "1254: TPM2B_SYM_KEY_Marshal(TPM2B_SYM_KEY *source, BYTE **buffer, INT32 *size)",
          "1255: {",
          "1256:     UINT16 written = 0;",
          "1258:     return written;",
          "1259: }",
          "",
          "[Removed Lines]",
          "1257:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "1259:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "1275: TPM2B_SENSITIVE_DATA_Marshal(TPM2B_SENSITIVE_DATA *source, BYTE **buffer, INT32 *size)",
          "1276: {",
          "1277:     UINT16 written = 0;",
          "1279:     return written;",
          "1280: }",
          "",
          "[Removed Lines]",
          "1278:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "1280:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "1635: TPM2B_PUBLIC_KEY_RSA_Marshal(TPM2B_PUBLIC_KEY_RSA *source, BYTE **buffer, INT32 *size)",
          "1636: {",
          "1637:     UINT16 written = 0;",
          "1639:     return written;",
          "1640: }",
          "",
          "[Removed Lines]",
          "1638:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "1640:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "1655: TPM2B_PRIVATE_KEY_RSA_Marshal(TPM2B_PRIVATE_KEY_RSA *source, BYTE **buffer, INT32 *size)",
          "1656: {",
          "1657:     UINT16 written = 0;",
          "1659:     return written;",
          "1660: }",
          "",
          "[Removed Lines]",
          "1658:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "1660:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1665: TPM2B_ECC_PARAMETER_Marshal(TPM2B_ECC_PARAMETER *source, BYTE **buffer, INT32 *size)",
          "1666: {",
          "1667:     UINT16 written = 0;",
          "1669:     return written;",
          "1670: }",
          "",
          "[Removed Lines]",
          "1668:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "1670:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1901: TPM2B_ENCRYPTED_SECRET_Marshal(TPM2B_ENCRYPTED_SECRET *source, BYTE **buffer, INT32 *size)",
          "1902: {",
          "1903:     UINT16 written = 0;",
          "1905:     return written;",
          "1906: }",
          "",
          "[Removed Lines]",
          "1904:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "1906:     written += TPM2B_Marshal(&source->b, sizeof(source->t.secret), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "2123: TPM2B_PRIVATE_Marshal(TPM2B_PRIVATE *source, BYTE **buffer, INT32 *size)",
          "2124: {",
          "2125:     UINT16 written = 0;",
          "2127:     return written;",
          "2128: }",
          "",
          "[Removed Lines]",
          "2126:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "2128:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "2133: TPM2B_ID_OBJECT_Marshal(TPM2B_ID_OBJECT *source, BYTE **buffer, INT32 *size)",
          "2134: {",
          "2135:     UINT16 written = 0;",
          "2137:     return written;",
          "2138: }",
          "",
          "[Removed Lines]",
          "2136:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "2138:     written += TPM2B_Marshal(&source->b, sizeof(source->t.credential), buffer, size); // libtpms changed",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "2190: TPM2B_CONTEXT_DATA_Marshal(TPM2B_CONTEXT_DATA  *source, BYTE **buffer, INT32 *size)",
          "2191: {",
          "2192:     UINT16 written = 0;",
          "2194:     return written;",
          "2195: }",
          "",
          "[Removed Lines]",
          "2193:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "2195:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size); // libtpms changed",
          "",
          "---------------"
        ],
        "src/tpm2/Marshal_fp.h||src/tpm2/Marshal_fp.h": [
          "File: src/tpm2/Marshal_fp.h -> src/tpm2/Marshal_fp.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "83:     UINT16",
          "84:     Array_Marshal(BYTE *sourceBuffer, UINT16 sourceSize, BYTE **buffer, INT32 *size);",
          "85:     UINT16",
          "87:     UINT16",
          "88:     TPM_KEY_BITS_Marshal(TPM_KEY_BITS *source, BYTE **buffer, INT32 *size);",
          "89:     UINT16",
          "",
          "[Removed Lines]",
          "86:     TPM2B_Marshal(TPM2B *source, BYTE **buffer, INT32 *size);",
          "",
          "[Added Lines]",
          "86:     TPM2B_Marshal(TPM2B *source, UINT32 maxSize, BYTE **buffer, INT32 *size); // libtpms changed",
          "",
          "---------------"
        ],
        "src/tpm2/NVMarshal.c||src/tpm2/NVMarshal.c": [
          "File: src/tpm2/NVMarshal.c -> src/tpm2/NVMarshal.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "255: TPM2B_PROOF_Marshal(TPM2B_PROOF *source, BYTE **buffer, INT32 *size)",
          "256: {",
          "257:     UINT16 written = 0;",
          "259:     return written;",
          "260: }",
          "",
          "[Removed Lines]",
          "258:     written += TPM2B_Marshal(&source->b, buffer, size);",
          "",
          "[Added Lines]",
          "258:     written += TPM2B_Marshal(&source->b, sizeof(source->t.buffer), buffer, size);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1328:                                 STATE_RESET_DATA_VERSION,",
          "1329:                                 STATE_RESET_DATA_MAGIC, 1);",
          "1330:     written += TPM2B_PROOF_Marshal(&data->nullProof, buffer, size);",
          "1332:     written += UINT32_Marshal(&data->clearCount, buffer, size);",
          "1333:     written += UINT64_Marshal(&data->objectContextID, buffer, size);",
          "",
          "[Removed Lines]",
          "1331:     written += TPM2B_Marshal(&data->nullSeed.b, buffer, size);",
          "",
          "[Added Lines]",
          "1331:     written += TPM2B_Marshal(&data->nullSeed.b, sizeof(data->nullSeed.t.buffer), buffer, size);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "2108: {",
          "2109:     UINT16 written;",
          "2113:     return written;",
          "2114: }",
          "",
          "[Removed Lines]",
          "2111:     written = TPM2B_Marshal(&data->b, buffer, size);",
          "",
          "[Added Lines]",
          "2111:     written = TPM2B_Marshal(&data->b, sizeof(data->t.buffer), buffer, size);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "2975:     NvRead(&pd, NV_PERSISTENT_DATA, sizeof(pd));",
          "",
          "[Removed Lines]",
          "2976:     written += TPM2B_Marshal(&pd.EPSeed.b, buffer, size);",
          "2977:     written += TPM2B_Marshal(&pd.SPSeed.b, buffer, size);",
          "2978:     written += TPM2B_Marshal(&pd.PPSeed.b, buffer, size);",
          "",
          "[Added Lines]",
          "2976:     written += TPM2B_Marshal(&pd.EPSeed.b, sizeof(pd.EPSeed.t.buffer), buffer, size);",
          "2977:     written += TPM2B_Marshal(&pd.SPSeed.b, sizeof(pd.SPSeed.t.buffer), buffer, size);",
          "2978:     written += TPM2B_Marshal(&pd.PPSeed.b, sizeof(pd.PPSeed.t.buffer), buffer, size);",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "3776:     written += TPM2B_AUTH_Marshal(&data->ownerAuth, buffer, size);",
          "3777:     written += TPM2B_AUTH_Marshal(&data->endorsementAuth, buffer, size);",
          "3778:     written += TPM2B_AUTH_Marshal(&data->lockoutAuth, buffer, size);",
          "3782:     written += TPM2B_PROOF_Marshal(&data->phProof, buffer, size);",
          "3783:     written += TPM2B_PROOF_Marshal(&data->shProof, buffer, size);",
          "3784:     written += TPM2B_PROOF_Marshal(&data->ehProof, buffer, size);",
          "",
          "[Removed Lines]",
          "3779:     written += TPM2B_Marshal(&data->EPSeed.b, buffer, size);",
          "3780:     written += TPM2B_Marshal(&data->SPSeed.b, buffer, size);",
          "3781:     written += TPM2B_Marshal(&data->PPSeed.b, buffer, size);",
          "",
          "[Added Lines]",
          "3779:     written += TPM2B_Marshal(&data->EPSeed.b, sizeof(data->EPSeed.t.buffer), buffer, size);",
          "3780:     written += TPM2B_Marshal(&data->SPSeed.b, sizeof(data->SPSeed.t.buffer), buffer, size);",
          "3781:     written += TPM2B_Marshal(&data->PPSeed.b, sizeof(data->PPSeed.t.buffer), buffer, size);",
          "",
          "---------------"
        ]
      }
    }
  ]
}