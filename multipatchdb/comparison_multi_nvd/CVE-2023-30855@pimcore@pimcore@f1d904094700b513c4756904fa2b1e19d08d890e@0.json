{
  "cve_id": "CVE-2023-30855",
  "cve_desc": "Pimcore is an open source data and experience management platform. Versions of Pimcore prior to 10.5.18 are vulnerable to path traversal. The impact of this path traversal and arbitrary extension is limited to creation of arbitrary files and appending data to existing files. When combined with the SQL Injection, the exported data `RESTRICTED DIFFUSION 9 / 9` can be controlled and a webshell can be uploaded. Attackers can use that to execute arbitrary PHP code on the server with the permissions of the webserver. Users may upgrade to version 10.5.18 to receive a patch or, as a workaround, apply the patch manually.",
  "repo": "pimcore/pimcore",
  "patch_hash": "f1d904094700b513c4756904fa2b1e19d08d890e",
  "patch_info": {
    "commit_hash": "f1d904094700b513c4756904fa2b1e19d08d890e",
    "repo": "pimcore/pimcore",
    "commit_url": "https://github.com/pimcore/pimcore/commit/f1d904094700b513c4756904fa2b1e19d08d890e",
    "files": [
      "bundles/AdminBundle/Controller/Admin/DataObject/ClassificationstoreController.php",
      "bundles/AdminBundle/Resources/public/js/pimcore/helpers.js",
      "bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/collectionsPanel.js",
      "bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/groupsPanel.js",
      "bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/propertiesPanel.js",
      "lib/Security/SecurityHelper.php"
    ],
    "message": "[Security] XSS in Classification Store of Data Objects module (#14933)\n\n* Fix: xss in CS\n\n* Fix: implement feedback",
    "before_after_code_files": [
      "bundles/AdminBundle/Controller/Admin/DataObject/ClassificationstoreController.php||bundles/AdminBundle/Controller/Admin/DataObject/ClassificationstoreController.php",
      "bundles/AdminBundle/Resources/public/js/pimcore/helpers.js||bundles/AdminBundle/Resources/public/js/pimcore/helpers.js",
      "bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/collectionsPanel.js||bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/collectionsPanel.js",
      "bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/groupsPanel.js||bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/groupsPanel.js",
      "bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/propertiesPanel.js||bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/propertiesPanel.js",
      "lib/Security/SecurityHelper.php||lib/Security/SecurityHelper.php"
    ]
  },
  "patch_diff": {
    "bundles/AdminBundle/Controller/Admin/DataObject/ClassificationstoreController.php||bundles/AdminBundle/Controller/Admin/DataObject/ClassificationstoreController.php": [
      "File: bundles/AdminBundle/Controller/Admin/DataObject/ClassificationstoreController.php -> bundles/AdminBundle/Controller/Admin/DataObject/ClassificationstoreController.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "24: use Pimcore\\Model\\Translation;",
      "25: use Pimcore\\Model\\Translation\\Listing;",
      "26: use Pimcore\\Model\\User;",
      "27: use Pimcore\\Tool\\Admin;",
      "28: use Symfony\\Component\\HttpFoundation\\JsonResponse;",
      "29: use Symfony\\Component\\HttpFoundation\\Request;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "27: use Pimcore\\Security\\SecurityHelper;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "128:     public function createGroupAction(Request $request): JsonResponse",
      "129:     {",
      "131:         $storeId = $request->get('storeId');",
      "132:         $config = Classificationstore\\GroupConfig::getByName($name, $storeId);",
      "",
      "[Removed Lines]",
      "130:         $name = $request->get('name');",
      "",
      "[Added Lines]",
      "131:         $name = SecurityHelper::getStringWithoutControlChars($request->get('name'));",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "155:     public function createStoreAction(Request $request): JsonResponse",
      "156:     {",
      "159:         $config = Classificationstore\\StoreConfig::getByName($name);",
      "",
      "[Removed Lines]",
      "157:         $name = $request->get('name');",
      "",
      "[Added Lines]",
      "158:         $name = SecurityHelper::getStringWithoutControlChars($request->get('name'));",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "181:     public function createCollectionAction(Request $request): JsonResponse",
      "182:     {",
      "184:         $storeId = $request->get('storeId');",
      "185:         $config = Classificationstore\\CollectionConfig::getByName($name, $storeId);",
      "",
      "[Removed Lines]",
      "183:         $name = $request->get('name');",
      "",
      "[Added Lines]",
      "184:         $name = SecurityHelper::getStringWithoutControlChars($request->get('name'));",
      "",
      "---------------"
    ],
    "bundles/AdminBundle/Resources/public/js/pimcore/helpers.js||bundles/AdminBundle/Resources/public/js/pimcore/helpers.js": [
      "File: bundles/AdminBundle/Resources/public/js/pimcore/helpers.js -> bundles/AdminBundle/Resources/public/js/pimcore/helpers.js",
      "--- Hunk 1 ---",
      "[Context before]",
      "3279:     return true;",
      "3280: };",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "3282: pimcore.helpers.getStringWithoutControlChars = function (text) {",
      "3283:     return text.replace(/[<>\"'`!?/\\\\%$(){};,:|=]/gi, '');",
      "3284: };",
      "",
      "---------------"
    ],
    "bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/collectionsPanel.js||bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/collectionsPanel.js": [
      "File: bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/collectionsPanel.js -> bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/collectionsPanel.js",
      "--- Hunk 1 ---",
      "[Context before]",
      "141:                         var colId = data.data.colId;",
      "142:                         var groupId = data.data.groupId;",
      "145:                             if (btn == 'yes') {",
      "146:                                 Ext.Ajax.request({",
      "147:                                     url: Routing.generate('pimcore_admin_dataobject_classificationstore_deletecollectionrelation'),",
      "",
      "[Removed Lines]",
      "144:                         Ext.Msg.confirm(t('delete'), sprintf(t('delete_message_advanced'), t('classificationstore_collection_relation'), data.data.groupName), function(btn) {",
      "",
      "[Added Lines]",
      "144:                         Ext.Msg.confirm(t('delete'), sprintf(t('delete_message_advanced'), t('classificationstore_collection_relation'), pimcore.helpers.getStringWithoutControlChars(data.data.groupName)), function(btn) {",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "315:                         this.relationsGrid.hide();",
      "316:                         this.relationsPanel.disable();",
      "319:                             if (btn == 'yes') {",
      "320:                                 Ext.Ajax.request({",
      "321:                                     url: Routing.generate('pimcore_admin_dataobject_classificationstore_deletecollection'),",
      "",
      "[Removed Lines]",
      "318:                         Ext.Msg.confirm(t('delete'), sprintf(t('delete_message_advanced'), t('classificationstore_collection'), data.data.name), function(btn) {",
      "",
      "[Added Lines]",
      "318:                         Ext.Msg.confirm(t('delete'), sprintf(t('delete_message_advanced'), t('classificationstore_collection'), pimcore.helpers.getStringWithoutControlChars(data.data.name)), function(btn) {",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "410:     },",
      "412:     addFieldComplete: function (button, value, object) {",
      "415:         if (button == \"ok\" && value.length > 1) {",
      "416:             Ext.Ajax.request({",
      "417:                 url: Routing.generate('pimcore_admin_dataobject_classificationstore_createcollection'),",
      "",
      "[Removed Lines]",
      "414:         value = value.trim();",
      "",
      "[Added Lines]",
      "413:         value = pimcore.helpers.getStringWithoutControlChars(value).trim();",
      "",
      "---------------"
    ],
    "bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/groupsPanel.js||bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/groupsPanel.js": [
      "File: bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/groupsPanel.js -> bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/groupsPanel.js",
      "--- Hunk 1 ---",
      "[Context before]",
      "148:                         var keyId = data.data.keyId;",
      "149:                         var groupId = data.data.groupId;",
      "152:                             if (btn == 'yes') {",
      "153:                                 Ext.Ajax.request({",
      "154:                                     url: Routing.generate('pimcore_admin_dataobject_classificationstore_deleterelation'),",
      "",
      "[Removed Lines]",
      "151:                         Ext.Msg.confirm(t('delete'), sprintf(t('delete_message_advanced'), t('classificationstore_relation'), data.data.keyName), function(btn) {",
      "",
      "[Added Lines]",
      "151:                         Ext.Msg.confirm(t('delete'), sprintf(t('delete_message_advanced'), t('classificationstore_relation'), pimcore.helpers.getStringWithoutControlChars(data.data.keyName)), function(btn) {",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "319:                         var data = grid.getStore().getAt(rowIndex);",
      "320:                         var id = data.data.id;",
      "323:                             if (btn == 'yes') {",
      "",
      "[Removed Lines]",
      "322:                         Ext.Msg.confirm(t('delete'), sprintf(t('delete_message_advanced'), t('classificationstore_group'), data.data.name), function(btn) {",
      "",
      "[Added Lines]",
      "322:                         Ext.Msg.confirm(t('delete'), sprintf(t('delete_message_advanced'), t('classificationstore_group'), pimcore.helpers.getStringWithoutControlChars(data.data.name)), function(btn) {",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "419:     },",
      "421:     addFieldComplete: function (button, value, object) {",
      "424:         if (button == \"ok\" && value.length > 1) {",
      "425:             Ext.Ajax.request({",
      "426:                 url: Routing.generate('pimcore_admin_dataobject_classificationstore_creategroup'),",
      "",
      "[Removed Lines]",
      "423:         value = value.trim();",
      "",
      "[Added Lines]",
      "422:         value = pimcore.helpers.getStringWithoutControlChars(value).trim();",
      "",
      "---------------"
    ],
    "bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/propertiesPanel.js||bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/propertiesPanel.js": [
      "File: bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/propertiesPanel.js -> bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/propertiesPanel.js",
      "--- Hunk 1 ---",
      "[Context before]",
      "198:                         var data = grid.getStore().getAt(rowIndex);",
      "199:                         var id = data.data.id;",
      "202:                             if (btn == 'yes') {",
      "203:                                 Ext.Ajax.request({",
      "204:                                     url: Routing.generate('pimcore_admin_dataobject_classificationstore_deleteproperty'),",
      "",
      "[Removed Lines]",
      "201:                         Ext.Msg.confirm(t('delete'), sprintf(t('delete_message_advanced'), t('classificationstore_property'), data.data.name), function(btn) {",
      "",
      "[Added Lines]",
      "201:                         Ext.Msg.confirm(t('delete'), sprintf(t('delete_message_advanced'), t('classificationstore_property'), pimcore.helpers.getStringWithoutControlChars(data.data.name)), function(btn) {",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "327:     },",
      "329:     addFieldComplete: function (button, value, object) {",
      "332:         if (button == \"ok\" && value.length > 1) {",
      "333:             Ext.Ajax.request({",
      "334:                 url: Routing.generate('pimcore_admin_dataobject_classificationstore_addproperty'),",
      "",
      "[Removed Lines]",
      "331:         value = value.trim();",
      "",
      "[Added Lines]",
      "330:         value = pimcore.helpers.getStringWithoutControlChars(value).trim();",
      "",
      "---------------"
    ],
    "lib/Security/SecurityHelper.php||lib/Security/SecurityHelper.php": [
      "File: lib/Security/SecurityHelper.php -> lib/Security/SecurityHelper.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: <?php",
      "16: namespace Pimcore\\Security;",
      "18: class SecurityHelper",
      "19: {",
      "20:     public static function getStringWithoutControlChars(string $text): string",
      "21:     {",
      "22:         return preg_replace('[\\\\\\\\<>\"\\'`!?/%$(){};,:|=]','', $text);",
      "23:     }",
      "24: }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "3b50ac000f34a9af8336024066b0d2c2116581dc",
      "candidate_info": {
        "commit_hash": "3b50ac000f34a9af8336024066b0d2c2116581dc",
        "repo": "pimcore/pimcore",
        "commit_url": "https://github.com/pimcore/pimcore/commit/3b50ac000f34a9af8336024066b0d2c2116581dc",
        "files": [
          "bundles/AdminBundle/Resources/public/js/pimcore/helpers.js",
          "bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/collectionsPanel.js",
          "bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/groupsPanel.js",
          "bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/propertiesPanel.js"
        ],
        "message": "Fix: remove getStringWithoutControlChars (#14964)",
        "before_after_code_files": [
          "bundles/AdminBundle/Resources/public/js/pimcore/helpers.js||bundles/AdminBundle/Resources/public/js/pimcore/helpers.js",
          "bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/collectionsPanel.js||bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/collectionsPanel.js",
          "bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/groupsPanel.js||bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/groupsPanel.js",
          "bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/propertiesPanel.js||bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/propertiesPanel.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "bundles/AdminBundle/Resources/public/js/pimcore/helpers.js||bundles/AdminBundle/Resources/public/js/pimcore/helpers.js",
            "bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/collectionsPanel.js||bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/collectionsPanel.js",
            "bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/groupsPanel.js||bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/groupsPanel.js",
            "bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/propertiesPanel.js||bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/propertiesPanel.js"
          ],
          "candidate": [
            "bundles/AdminBundle/Resources/public/js/pimcore/helpers.js||bundles/AdminBundle/Resources/public/js/pimcore/helpers.js",
            "bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/collectionsPanel.js||bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/collectionsPanel.js",
            "bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/groupsPanel.js||bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/groupsPanel.js",
            "bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/propertiesPanel.js||bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/propertiesPanel.js"
          ]
        }
      },
      "candidate_diff": {
        "bundles/AdminBundle/Resources/public/js/pimcore/helpers.js||bundles/AdminBundle/Resources/public/js/pimcore/helpers.js": [
          "File: bundles/AdminBundle/Resources/public/js/pimcore/helpers.js -> bundles/AdminBundle/Resources/public/js/pimcore/helpers.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "3290:     return true;",
          "3291: };",
          "",
          "[Removed Lines]",
          "3293: pimcore.helpers.getStringWithoutControlChars = function (text) {",
          "3294:     return text.replace(/[<>\"'`!?/\\\\%$(){};,:|=]/gi, '');",
          "3295: };",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/collectionsPanel.js||bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/collectionsPanel.js": [
          "File: bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/collectionsPanel.js -> bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/collectionsPanel.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "141:                         var colId = data.data.colId;",
          "142:                         var groupId = data.data.groupId;",
          "145:                             if (btn == 'yes') {",
          "146:                                 Ext.Ajax.request({",
          "147:                                     url: Routing.generate('pimcore_admin_dataobject_classificationstore_deletecollectionrelation'),",
          "",
          "[Removed Lines]",
          "144:                         Ext.Msg.confirm(t('delete'), sprintf(t('delete_message_advanced'), t('classificationstore_collection_relation'), pimcore.helpers.getStringWithoutControlChars(data.data.groupName)), function(btn) {",
          "",
          "[Added Lines]",
          "144:                         Ext.Msg.confirm(t('delete'), sprintf(t('delete_message_advanced'), t('classificationstore_collection_relation'), Ext.util.Format.htmlEncode(data.data.groupName)), function(btn) {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "315:                         this.relationsGrid.hide();",
          "316:                         this.relationsPanel.disable();",
          "319:                             if (btn == 'yes') {",
          "320:                                 Ext.Ajax.request({",
          "321:                                     url: Routing.generate('pimcore_admin_dataobject_classificationstore_deletecollection'),",
          "",
          "[Removed Lines]",
          "318:                         Ext.Msg.confirm(t('delete'), sprintf(t('delete_message_advanced'), t('classificationstore_collection'), pimcore.helpers.getStringWithoutControlChars(data.data.name)), function(btn) {",
          "",
          "[Added Lines]",
          "318:                         Ext.Msg.confirm(t('delete'), sprintf(t('delete_message_advanced'), t('classificationstore_collection'), Ext.util.Format.htmlEncode(data.data.name)), function(btn) {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "410:     },",
          "412:     addFieldComplete: function (button, value, object) {",
          "414:         if (button == \"ok\" && value.length > 1) {",
          "415:             Ext.Ajax.request({",
          "416:                 url: Routing.generate('pimcore_admin_dataobject_classificationstore_createcollection'),",
          "",
          "[Removed Lines]",
          "413:         value = pimcore.helpers.getStringWithoutControlChars(value).trim();",
          "",
          "[Added Lines]",
          "413:         value = Ext.util.Format.htmlEncode(value).trim();",
          "",
          "---------------"
        ],
        "bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/groupsPanel.js||bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/groupsPanel.js": [
          "File: bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/groupsPanel.js -> bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/groupsPanel.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "148:                         var keyId = data.data.keyId;",
          "149:                         var groupId = data.data.groupId;",
          "152:                             if (btn == 'yes') {",
          "153:                                 Ext.Ajax.request({",
          "154:                                     url: Routing.generate('pimcore_admin_dataobject_classificationstore_deleterelation'),",
          "",
          "[Removed Lines]",
          "151:                         Ext.Msg.confirm(t('delete'), sprintf(t('delete_message_advanced'), t('classificationstore_relation'), pimcore.helpers.getStringWithoutControlChars(data.data.keyName)), function(btn) {",
          "",
          "[Added Lines]",
          "151:                         Ext.Msg.confirm(t('delete'), sprintf(t('delete_message_advanced'), t('classificationstore_relation'), Ext.util.Format.htmlEncode(data.data.keyName)), function(btn) {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "319:                         var data = grid.getStore().getAt(rowIndex);",
          "320:                         var id = data.data.id;",
          "323:                             if (btn == 'yes') {",
          "",
          "[Removed Lines]",
          "322:                         Ext.Msg.confirm(t('delete'), sprintf(t('delete_message_advanced'), t('classificationstore_group'), pimcore.helpers.getStringWithoutControlChars(data.data.name)), function(btn) {",
          "",
          "[Added Lines]",
          "322:                         Ext.Msg.confirm(t('delete'), sprintf(t('delete_message_advanced'), t('classificationstore_group'), Ext.util.Format.htmlEncode(data.data.name)), function(btn) {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "419:     },",
          "421:     addFieldComplete: function (button, value, object) {",
          "423:         if (button == \"ok\" && value.length > 1) {",
          "424:             Ext.Ajax.request({",
          "425:                 url: Routing.generate('pimcore_admin_dataobject_classificationstore_creategroup'),",
          "",
          "[Removed Lines]",
          "422:         value = pimcore.helpers.getStringWithoutControlChars(value).trim();",
          "",
          "[Added Lines]",
          "422:         value = Ext.util.Format.htmlEncode(value).trim();",
          "",
          "---------------"
        ],
        "bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/propertiesPanel.js||bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/propertiesPanel.js": [
          "File: bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/propertiesPanel.js -> bundles/AdminBundle/Resources/public/js/pimcore/object/classificationstore/propertiesPanel.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "198:                         var data = grid.getStore().getAt(rowIndex);",
          "199:                         var id = data.data.id;",
          "202:                             if (btn == 'yes') {",
          "203:                                 Ext.Ajax.request({",
          "204:                                     url: Routing.generate('pimcore_admin_dataobject_classificationstore_deleteproperty'),",
          "",
          "[Removed Lines]",
          "201:                         Ext.Msg.confirm(t('delete'), sprintf(t('delete_message_advanced'), t('classificationstore_property'), pimcore.helpers.getStringWithoutControlChars(data.data.name)), function(btn) {",
          "",
          "[Added Lines]",
          "201:                         Ext.Msg.confirm(t('delete'), sprintf(t('delete_message_advanced'), t('classificationstore_property'), Ext.util.Format.htmlEncode(data.data.name)), function(btn) {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "327:     },",
          "329:     addFieldComplete: function (button, value, object) {",
          "331:         if (button == \"ok\" && value.length > 1) {",
          "332:             Ext.Ajax.request({",
          "333:                 url: Routing.generate('pimcore_admin_dataobject_classificationstore_addproperty'),",
          "",
          "[Removed Lines]",
          "330:         value = pimcore.helpers.getStringWithoutControlChars(value).trim();",
          "",
          "[Added Lines]",
          "330:         value = Ext.util.Format.htmlEncode(value).trim();",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "07a2c95be524c7e20105cef58c5767d4ebb06091",
      "candidate_info": {
        "commit_hash": "07a2c95be524c7e20105cef58c5767d4ebb06091",
        "repo": "pimcore/pimcore",
        "commit_url": "https://github.com/pimcore/pimcore/commit/07a2c95be524c7e20105cef58c5767d4ebb06091",
        "files": [
          "bundles/AdminBundle/Controller/Admin/DataObject/ClassificationstoreController.php",
          "bundles/AdminBundle/Resources/public/js/pimcore/helpers.js",
          "bundles/AdminBundle/Resources/public/js/pimcore/settings/staticroutes.js",
          "lib/Security/SecurityHelper.php",
          "models/Staticroute.php"
        ],
        "message": "[Security] Fix xss in static routes panel (#14947)\n\n* added new helper function to htmlEncode textFields, fixed xss issue in static routes panel\n\n* added `htmlspecialchars` to model\n\n* fixed double encode issue\n\n* fixed double encode problem in BE\n\n* changed type of `htmlspecialchars`, added `htmlspecialchars` to `setMethods`\n\n* improved `htmlSpecialChars`\n\n* changed SecurityHelper method name to `convertHtmlSpecialChars`\n\n* added htmlEncode to `deleteConfirm` msgbox",
        "before_after_code_files": [
          "bundles/AdminBundle/Controller/Admin/DataObject/ClassificationstoreController.php||bundles/AdminBundle/Controller/Admin/DataObject/ClassificationstoreController.php",
          "bundles/AdminBundle/Resources/public/js/pimcore/helpers.js||bundles/AdminBundle/Resources/public/js/pimcore/helpers.js",
          "bundles/AdminBundle/Resources/public/js/pimcore/settings/staticroutes.js||bundles/AdminBundle/Resources/public/js/pimcore/settings/staticroutes.js",
          "lib/Security/SecurityHelper.php||lib/Security/SecurityHelper.php",
          "models/Staticroute.php||models/Staticroute.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "bundles/AdminBundle/Controller/Admin/DataObject/ClassificationstoreController.php||bundles/AdminBundle/Controller/Admin/DataObject/ClassificationstoreController.php",
            "bundles/AdminBundle/Resources/public/js/pimcore/helpers.js||bundles/AdminBundle/Resources/public/js/pimcore/helpers.js",
            "lib/Security/SecurityHelper.php||lib/Security/SecurityHelper.php"
          ],
          "candidate": [
            "bundles/AdminBundle/Controller/Admin/DataObject/ClassificationstoreController.php||bundles/AdminBundle/Controller/Admin/DataObject/ClassificationstoreController.php",
            "bundles/AdminBundle/Resources/public/js/pimcore/helpers.js||bundles/AdminBundle/Resources/public/js/pimcore/helpers.js",
            "lib/Security/SecurityHelper.php||lib/Security/SecurityHelper.php"
          ]
        }
      },
      "candidate_diff": {
        "bundles/AdminBundle/Controller/Admin/DataObject/ClassificationstoreController.php||bundles/AdminBundle/Controller/Admin/DataObject/ClassificationstoreController.php": [
          "File: bundles/AdminBundle/Controller/Admin/DataObject/ClassificationstoreController.php -> bundles/AdminBundle/Controller/Admin/DataObject/ClassificationstoreController.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "129:     public function createGroupAction(Request $request): JsonResponse",
          "130:     {",
          "132:         $storeId = $request->get('storeId');",
          "133:         $config = Classificationstore\\GroupConfig::getByName($name, $storeId);",
          "",
          "[Removed Lines]",
          "131:         $name = SecurityHelper::getStringWithoutControlChars($request->get('name'));",
          "",
          "[Added Lines]",
          "131:         $name = SecurityHelper::convertHtmlSpecialChars($request->get('name'));",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "156:     public function createStoreAction(Request $request): JsonResponse",
          "157:     {",
          "160:         $config = Classificationstore\\StoreConfig::getByName($name);",
          "",
          "[Removed Lines]",
          "158:         $name = SecurityHelper::getStringWithoutControlChars($request->get('name'));",
          "",
          "[Added Lines]",
          "158:         $name = SecurityHelper::convertHtmlSpecialChars($request->get('name'));",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "182:     public function createCollectionAction(Request $request): JsonResponse",
          "183:     {",
          "185:         $storeId = $request->get('storeId');",
          "186:         $config = Classificationstore\\CollectionConfig::getByName($name, $storeId);",
          "",
          "[Removed Lines]",
          "184:         $name = SecurityHelper::getStringWithoutControlChars($request->get('name'));",
          "",
          "[Added Lines]",
          "184:         $name = SecurityHelper::convertHtmlSpecialChars($request->get('name'));",
          "",
          "---------------"
        ],
        "bundles/AdminBundle/Resources/public/js/pimcore/helpers.js||bundles/AdminBundle/Resources/public/js/pimcore/helpers.js": [
          "File: bundles/AdminBundle/Resources/public/js/pimcore/helpers.js -> bundles/AdminBundle/Resources/public/js/pimcore/helpers.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "22:     return slug.replace(/[^a-z0-9-_+/]/gi, '');",
          "23: };",
          "25: pimcore.helpers.registerKeyBindings = function (bindEl, ExtJS) {",
          "27:     if (!ExtJS) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "25: pimcore.helpers.htmlEncodeTextField = function (textField) {",
          "26:     if(textField.getValue()) {",
          "27:         textField.suspendEvent('change');",
          "28:         const decodedValue = Ext.util.Format.htmlDecode(textField.getValue());",
          "29:         textField.setValue(",
          "30:             Ext.util.Format.htmlEncode(decodedValue)",
          "31:         );",
          "32:         textField.resumeEvent('change');",
          "33:     }",
          "34: };",
          "",
          "---------------"
        ],
        "bundles/AdminBundle/Resources/public/js/pimcore/settings/staticroutes.js||bundles/AdminBundle/Resources/public/js/pimcore/settings/staticroutes.js": [
          "File: bundles/AdminBundle/Resources/public/js/pimcore/settings/staticroutes.js -> bundles/AdminBundle/Resources/public/js/pimcore/settings/staticroutes.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "97:         var typesColumns = [",
          "98:             {text:t(\"name\"), flex:50, sortable:true, dataIndex:'name',",
          "100:             {text:t(\"pattern\"), flex:100, sortable:true, dataIndex:'pattern',",
          "102:             {text:t(\"reverse\"), flex:100, sortable:true, dataIndex:'reverse',",
          "104:             {text:t(\"controller\"), flex:200, sortable:false, dataIndex:'controller',",
          "105:                 editor:new Ext.form.ComboBox({",
          "106:                     store:new Ext.data.JsonStore({",
          "",
          "[Removed Lines]",
          "99:                 editor:new Ext.form.TextField({})},",
          "101:                 editor:new Ext.form.TextField({})},",
          "103:                 editor:new Ext.form.TextField({})},",
          "",
          "[Added Lines]",
          "99:                 editor:new Ext.form.TextField({listeners: {'change': pimcore.helpers.htmlEncodeTextField}})},",
          "101:                 editor:new Ext.form.TextField({listeners: {'change': pimcore.helpers.htmlEncodeTextField}})},",
          "103:                 editor:new Ext.form.TextField({listeners: {'change': pimcore.helpers.htmlEncodeTextField}})},",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "127:                     valueField:'name',",
          "128:                     listConfig: {",
          "129:                         maxWidth: 400",
          "130:                     }",
          "131:                 })},",
          "132:             {text:t(\"variables\"), flex:50, sortable:false, dataIndex:'variables',",
          "134:             {text:t(\"defaults\"), flex:50, sortable:false, dataIndex:'defaults',",
          "136:             {text:t(\"site_ids\"), flex:100, sortable:true, dataIndex:\"siteId\",",
          "138:                 tooltip: t(\"site_ids_tooltip\")",
          "139:             },",
          "140:             {text:t(\"priority\"), flex:50, sortable:true, dataIndex:'priority', editor:new Ext.form.ComboBox({",
          "",
          "[Removed Lines]",
          "133:                 editor:new Ext.form.TextField({})},",
          "135:                 editor:new Ext.form.TextField({})},",
          "137:                 editor:new Ext.form.TextField({}),",
          "",
          "[Added Lines]",
          "130:                     },",
          "131:                     listeners: {",
          "132:                         'change': pimcore.helpers.htmlEncodeTextField",
          "136:                 editor:new Ext.form.TextField({listeners: {'change': pimcore.helpers.htmlEncodeTextField}})},",
          "138:                 editor:new Ext.form.TextField({listeners: {'change': pimcore.helpers.htmlEncodeTextField}})},",
          "140:                 editor:new Ext.form.TextField({listeners: {'change': pimcore.helpers.htmlEncodeTextField}}),",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "143:                 triggerAction:\"all\"",
          "144:             })},",
          "145:             {text:t(\"methods\"), flex:50, sortable:false, dataIndex:'methods',",
          "147:             },",
          "148:             {text: t(\"creationDate\"), sortable: true, dataIndex: 'creationDate', editable: false,",
          "149:                 hidden: true,",
          "",
          "[Removed Lines]",
          "146:                 editor:new Ext.form.TextField({}),",
          "",
          "[Added Lines]",
          "149:                 editor:new Ext.form.TextField({listeners: {'change': pimcore.helpers.htmlEncodeTextField}}),",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "186:                             return;",
          "187:                         }",
          "192:                     }.bind(this)",
          "193:                 }]",
          "194:             }",
          "",
          "[Removed Lines]",
          "189:                         pimcore.helpers.deleteConfirm(t('staticroute'), data.data.name, function () {",
          "190:                             grid.getStore().removeAt(rowIndex);",
          "191:                         }.bind(this));",
          "",
          "[Added Lines]",
          "192:                         const decodedName = Ext.util.Format.htmlDecode(data.data.name);",
          "194:                         pimcore.helpers.deleteConfirm(",
          "195:                             t('staticroute'),",
          "196:                             Ext.util.Format.htmlEncode(decodedName),",
          "197:                             function () {",
          "198:                                 grid.getStore().removeAt(rowIndex);",
          "199:                             }.bind(this)",
          "200:                         );",
          "",
          "---------------"
        ],
        "lib/Security/SecurityHelper.php||lib/Security/SecurityHelper.php": [
          "File: lib/Security/SecurityHelper.php -> lib/Security/SecurityHelper.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "18: class SecurityHelper",
          "19: {",
          "21:     {",
          "23:     }",
          "24: }",
          "",
          "[Removed Lines]",
          "20:     public static function getStringWithoutControlChars(string $text): string",
          "22:         return preg_replace('[\\\\\\\\<>\"\\'`!?/%$(){};,:|=]', '', $text);",
          "",
          "[Added Lines]",
          "20:     public static function convertHtmlSpecialChars(?string $text): ?string",
          "22:         if(is_string($text)){",
          "23:             return htmlspecialchars($text, ENT_QUOTES | ENT_SUBSTITUTE, 'UTF-8', false);",
          "24:         }",
          "26:         return null;",
          "",
          "---------------"
        ],
        "models/Staticroute.php||models/Staticroute.php": [
          "File: models/Staticroute.php -> models/Staticroute.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "18: use Pimcore\\Event\\FrontendEvents;",
          "19: use Pimcore\\Model\\Exception\\NotFoundException;",
          "20: use Symfony\\Component\\EventDispatcher\\GenericEvent;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "20: use Pimcore\\Security\\SecurityHelper;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "293:     public function setPattern($pattern)",
          "294:     {",
          "297:         return $this;",
          "298:     }",
          "",
          "[Removed Lines]",
          "295:         $this->pattern = $pattern;",
          "",
          "[Added Lines]",
          "296:         $this->pattern = SecurityHelper::convertHtmlSpecialChars($pattern);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "305:     public function setController($controller)",
          "306:     {",
          "309:         return $this;",
          "310:     }",
          "",
          "[Removed Lines]",
          "307:         $this->controller = $controller;",
          "",
          "[Added Lines]",
          "308:         $this->controller = SecurityHelper::convertHtmlSpecialChars($controller);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "317:     public function setVariables($variables)",
          "318:     {",
          "321:         return $this;",
          "322:     }",
          "",
          "[Removed Lines]",
          "319:         $this->variables = $variables;",
          "",
          "[Added Lines]",
          "320:         $this->variables = SecurityHelper::convertHtmlSpecialChars($variables);",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "329:     public function setDefaults($defaults)",
          "330:     {",
          "333:         return $this;",
          "334:     }",
          "",
          "[Removed Lines]",
          "331:         $this->defaults = $defaults;",
          "",
          "[Added Lines]",
          "332:         $this->defaults = SecurityHelper::convertHtmlSpecialChars($defaults);",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "361:     public function setName($name)",
          "362:     {",
          "365:         return $this;",
          "366:     }",
          "",
          "[Removed Lines]",
          "363:         $this->name = $name;",
          "",
          "[Added Lines]",
          "364:         $this->name = SecurityHelper::convertHtmlSpecialChars($name);",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "381:     public function setReverse($reverse)",
          "382:     {",
          "385:         return $this;",
          "386:     }",
          "",
          "[Removed Lines]",
          "383:         $this->reverse = $reverse;",
          "",
          "[Added Lines]",
          "384:         $this->reverse = SecurityHelper::convertHtmlSpecialChars($reverse);",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "611:     {",
          "612:         if (is_string($methods)) {",
          "613:             $methods = strlen($methods) ? explode(',', $methods) : [];",
          "615:         }",
          "617:         $this->methods = $methods;",
          "",
          "[Removed Lines]",
          "614:             $methods = array_map('trim', $methods);",
          "",
          "[Added Lines]",
          "615:             foreach($methods as $key => $method) {",
          "616:                 $methods[$key] = SecurityHelper::convertHtmlSpecialChars(trim($method));",
          "617:             }",
          "",
          "---------------"
        ]
      }
    }
  ]
}