{
  "cve_id": "CVE-2024-32877",
  "cve_desc": "Yii 2 is a PHP application framework. During internal penetration testing of a product based on Yii2, users discovered a Cross-site Scripting (XSS) vulnerability within the framework itself. This issue is relevant for the latest version of Yii2 (2.0.49.3). This issue lies in the mechanism for displaying function argument values in the stack trace. The vulnerability manifests when an argument's value exceeds 32 characters. For convenience, argument values exceeding this limit are truncated and displayed with an added \"...\". The full argument value becomes visible when hovering over it with the mouse, as it is displayed in the title attribute of a span tag. However, the use of a double quote (\") allows an attacker to break out of the title attribute's value context and inject their own attributes into the span tag, including malicious JavaScript code through event handlers such as onmousemove. This vulnerability allows an attacker to execute arbitrary JavaScript code in the security context of the victim's site via a specially crafted link. This could lead to the theft of cookies (including httpOnly cookies, which are accessible on the page), content substitution, or complete takeover of user accounts. This issue has been addressed in version 2.0.50. Users are advised to upgrade. There are no known workarounds for this vulnerability.",
  "repo": "yiisoft/yii2",
  "patch_hash": "f7baab16e79f2369d4838ab5653c3c07ecf26615",
  "patch_info": {
    "commit_hash": "f7baab16e79f2369d4838ab5653c3c07ecf26615",
    "repo": "yiisoft/yii2",
    "commit_url": "https://github.com/yiisoft/yii2/commit/f7baab16e79f2369d4838ab5653c3c07ecf26615",
    "files": [
      "framework/CHANGELOG.md",
      "framework/web/ErrorHandler.php"
    ],
    "message": "Merge pull request from GHSA-qg5r-95m4-mjgj\n\n* Hotfix: Reflected XSS in Debug mode\n\n* Added entry for the security issue GHSA-qg5r-95m4-mjgj to the CHANGELOG\n\n* Update CHANGELOG.md\n\n* Update CHANGELOG.md\n\n---------\n\nCo-authored-by: Alexander Makarov <sam@rmcreative.ru>",
    "before_after_code_files": [
      "framework/web/ErrorHandler.php||framework/web/ErrorHandler.php"
    ]
  },
  "patch_diff": {
    "framework/web/ErrorHandler.php||framework/web/ErrorHandler.php": [
      "File: framework/web/ErrorHandler.php -> framework/web/ErrorHandler.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "182:     public function htmlEncode($text)",
      "183:     {",
      "185:     }",
      "",
      "[Removed Lines]",
      "184:         return htmlspecialchars($text, ENT_NOQUOTES | ENT_SUBSTITUTE | ENT_HTML5, 'UTF-8');",
      "",
      "[Added Lines]",
      "184:         return htmlspecialchars($text, ENT_QUOTES | ENT_SUBSTITUTE | ENT_HTML5, 'UTF-8');",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "6b1591b22242519a10eec6cfecedecc1b35bb054",
      "candidate_info": {
        "commit_hash": "6b1591b22242519a10eec6cfecedecc1b35bb054",
        "repo": "yiisoft/yii2",
        "commit_url": "https://github.com/yiisoft/yii2/commit/6b1591b22242519a10eec6cfecedecc1b35bb054",
        "files": [
          "framework/BaseYii.php",
          "framework/CHANGELOG.md"
        ],
        "message": "prepare for next release",
        "before_after_code_files": [
          "framework/BaseYii.php||framework/BaseYii.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/yiisoft/yii2/pull/20362"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "framework/BaseYii.php||framework/BaseYii.php": [
          "File: framework/BaseYii.php -> framework/BaseYii.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "94:     public static function getVersion()",
          "95:     {",
          "97:     }",
          "",
          "[Removed Lines]",
          "96:         return '2.0.50';",
          "",
          "[Added Lines]",
          "96:         return '2.0.51-dev';",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "7d2de44ca0694abd6ca584536cf7ba40e3034b9b",
      "candidate_info": {
        "commit_hash": "7d2de44ca0694abd6ca584536cf7ba40e3034b9b",
        "repo": "yiisoft/yii2",
        "commit_url": "https://github.com/yiisoft/yii2/commit/7d2de44ca0694abd6ca584536cf7ba40e3034b9b",
        "files": [
          "tests/framework/db/mysql/QueryBuilderTest.php"
        ],
        "message": "Refactor `testAddDropCheck` method: remove unsupported check handling and update SQL statement in `testInsertInteger`.",
        "before_after_code_files": [
          "tests/framework/db/mysql/QueryBuilderTest.php||tests/framework/db/mysql/QueryBuilderTest.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/yiisoft/yii2/pull/20362"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "tests/framework/db/mysql/QueryBuilderTest.php||tests/framework/db/mysql/QueryBuilderTest.php": [
          "File: tests/framework/db/mysql/QueryBuilderTest.php -> tests/framework/db/mysql/QueryBuilderTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "324:             [",
          "325:                 'id' => 1,",
          "326:             ],",
          "328:             [",
          "329:                 ':qp0' => '{\"abc\":\"def\",\"0\":123,\"1\":null}',",
          "330:                 ':qp1' => 1,",
          "",
          "[Removed Lines]",
          "327:             self::replaceQuotes('UPDATE [[profile]] SET [[description]]=CAST(:qp0 AS JSON) WHERE [[id]]=:qp1'),",
          "",
          "[Added Lines]",
          "327:             self::replaceQuotes('UPDATE [[profile]] SET [[description]]=:qp0 WHERE [[id]]=:qp1'),",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "400:         $this->assertEquals(\"INSERT INTO `negative_default_values` (`tinyint_col`) VALUES (DEFAULT)\", $sql);",
          "401:     }",
          "",
          "[Removed Lines]",
          "408:     public function testAddDropCheck(string $sql, \\Closure $builder): void",
          "409:     {",
          "410:         $this->expectException(\\yii\\base\\NotSupportedException::class);",
          "411:         $this->expectExceptionMessage('is not supported by MySQL.');",
          "413:         parent::testAddDropCheck($sql, $builder);",
          "414:     }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "628d406bfafb80fc32147837888c0057d89a021e",
      "candidate_info": {
        "commit_hash": "628d406bfafb80fc32147837888c0057d89a021e",
        "repo": "yiisoft/yii2",
        "commit_url": "https://github.com/yiisoft/yii2/commit/628d406bfafb80fc32147837888c0057d89a021e",
        "files": [
          "framework/CHANGELOG.md",
          "framework/base/Component.php"
        ],
        "message": "Merge pull request from GHSA-cjcc-p67m-7qxm\n\n* Fix: Unsafe Reflection in base Component class\n\n* Fix style for consistency\n\n* add changelog entry\n\n* Fix wrong logic\n\n* Fix exception message\n\n* Update framework/CHANGELOG.md\n\n---------\n\nCo-authored-by: Stefano Mtangoo <stefano@hosannahighertech.co.tz>\nCo-authored-by: Alexander Makarov <sam@rmcreative.ru>",
        "before_after_code_files": [
          "framework/base/Component.php||framework/base/Component.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/yiisoft/yii2/pull/20362"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "framework/base/Component.php||framework/base/Component.php": [
          "File: framework/base/Component.php -> framework/base/Component.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "189:         } elseif (strncmp($name, 'as ', 3) === 0) {",
          "191:             $name = trim(substr($name, 3));",
          "194:             return;",
          "195:         }",
          "",
          "[Removed Lines]",
          "192:             $this->attachBehavior($name, $value instanceof Behavior ? $value : Yii::createObject($value));",
          "",
          "[Added Lines]",
          "192:             if ($value instanceof Behavior) {",
          "193:                 $this->attachBehavior($name, $value);",
          "194:             } elseif (isset($value['class']) && is_subclass_of($value['class'], Behavior::class, true)) {",
          "195:                 $this->attachBehavior($name, Yii::createObject($value));",
          "196:             } elseif (is_string($value) && is_subclass_of($value, Behavior::class, true)) {",
          "197:                 $this->attachBehavior($name, Yii::createObject($value));",
          "198:             } else {",
          "199:                 throw new InvalidConfigException('Class is not of type ' . Behavior::class . ' or its subclasses');",
          "200:             }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "ff3aee30e4b1129abb7e38c73c2618bdd94b4413",
      "candidate_info": {
        "commit_hash": "ff3aee30e4b1129abb7e38c73c2618bdd94b4413",
        "repo": "yiisoft/yii2",
        "commit_url": "https://github.com/yiisoft/yii2/commit/ff3aee30e4b1129abb7e38c73c2618bdd94b4413",
        "files": [
          ".phpunit.result.cache",
          "tests/framework/web/ErrorHandlerTest.php"
        ],
        "message": "Fix ErrorHandler quoting tests",
        "before_after_code_files": [
          ".phpunit.result.cache||.phpunit.result.cache",
          "tests/framework/web/ErrorHandlerTest.php||tests/framework/web/ErrorHandlerTest.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/yiisoft/yii2/pull/20362"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        ".phpunit.result.cache||.phpunit.result.cache": [
          "File: .phpunit.result.cache -> .phpunit.result.cache",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: {\"version\":1,\"defects\":{\"yiiunit\\\\framework\\\\web\\\\ErrorHandlerTest::testHtmlEncode with data set #0\":3,\"yiiunit\\\\framework\\\\web\\\\ErrorHandlerTest::testHtmlEncode with data set #2\":3,\"yiiunit\\\\framework\\\\web\\\\ErrorHandlerTest::testHtmlEncode with data set #3\":3,\"yiiunit\\\\framework\\\\web\\\\ErrorHandlerTest::testHtmlEncodeWithUnicodeSequence\":3},\"times\":{\"yiiunit\\\\framework\\\\web\\\\ErrorHandlerTest::testCorrectResponseCodeInErrorView\":0.005,\"yiiunit\\\\framework\\\\web\\\\ErrorHandlerTest::testFormatRaw\":0,\"yiiunit\\\\framework\\\\web\\\\ErrorHandlerTest::testFormatXml\":0.001,\"yiiunit\\\\framework\\\\web\\\\ErrorHandlerTest::testClearAssetFilesInErrorView\":0.001,\"yiiunit\\\\framework\\\\web\\\\ErrorHandlerTest::testClearAssetFilesInErrorActionView\":0.002,\"yiiunit\\\\framework\\\\web\\\\ErrorHandlerTest::testRenderCallStackItem\":0,\"yiiunit\\\\framework\\\\web\\\\ErrorHandlerTest::testHtmlEncode with data set #0\":0,\"yiiunit\\\\framework\\\\web\\\\ErrorHandlerTest::testHtmlEncode with data set #1\":0,\"yiiunit\\\\framework\\\\web\\\\ErrorHandlerTest::testHtmlEncode with data set #2\":0,\"yiiunit\\\\framework\\\\web\\\\ErrorHandlerTest::testHtmlEncode with data set #3\":0,\"yiiunit\\\\framework\\\\web\\\\ErrorHandlerTest::testHtmlEncode with data set #4\":0,\"yiiunit\\\\framework\\\\web\\\\ErrorHandlerTest::testHtmlEncode with data set #5\":0,\"yiiunit\\\\framework\\\\web\\\\ErrorHandlerTest::testHtmlEncodeWithUnicodeSequence\":0}}",
          "",
          "---------------"
        ],
        "tests/framework/web/ErrorHandlerTest.php||tests/framework/web/ErrorHandlerTest.php": [
          "File: tests/framework/web/ErrorHandlerTest.php -> tests/framework/web/ErrorHandlerTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "131:         return [",
          "132:             [",
          "133:                 \"a \\t=<>&\\\"'\\x80`\\n\",",
          "135:             ],",
          "136:             [",
          "137:                 '<b>test</b>',",
          "",
          "[Removed Lines]",
          "134:                 \"a \\t=&lt;&gt;&amp;\\\"'\ufffd`\\n\",",
          "",
          "[Added Lines]",
          "134:                 \"a \\t=&lt;&gt;&amp;&quot;&apos;\ufffd`\\n\",",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "139:             ],",
          "140:             [",
          "141:                 '\"hello\"',",
          "143:             ],",
          "144:             [",
          "145:                 \"'hello world'\",",
          "147:             ],",
          "148:             [",
          "149:                 'Chip&amp;Dale',",
          "",
          "[Removed Lines]",
          "142:                 '\"hello\"',",
          "146:                 \"'hello world'\",",
          "",
          "[Added Lines]",
          "142:                 '&quot;hello&quot;',",
          "146:                 \"&apos;hello world&apos;\",",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "171:         $handler = Yii::$app->getErrorHandler();",
          "173:         $text = \"a \\t=<>&\\\"'\\x80\\u{20bd}`\\u{000a}\\u{000c}\\u{0000}\";",
          "176:         $this->assertSame($expected, $handler->htmlEncode($text));",
          "177:     }",
          "",
          "[Removed Lines]",
          "174:         $expected = \"a \\t=&lt;&gt;&amp;\\\"'\ufffd\u20bd`\\n\\u{000c}\\u{0000}\";",
          "",
          "[Added Lines]",
          "174:         $expected = \"a \\t=&lt;&gt;&amp;&quot;&apos;\ufffd\u20bd`\\n\\u{000c}\\u{0000}\";",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "76150c5403dd1c4ded31fc6b44cc4c45c63c8bb3",
      "candidate_info": {
        "commit_hash": "76150c5403dd1c4ded31fc6b44cc4c45c63c8bb3",
        "repo": "yiisoft/yii2",
        "commit_url": "https://github.com/yiisoft/yii2/commit/76150c5403dd1c4ded31fc6b44cc4c45c63c8bb3",
        "files": [
          "framework/CHANGELOG.md",
          "framework/helpers/BaseHtml.php",
          "tests/framework/helpers/HtmlTest.php"
        ],
        "message": "Revert \"Fix #20198: Boolean values of the `value` HTML attribute are now converted to integer values\"\n\nThis reverts commit 0e50cee88fe7817cd23c764f16a2b1f8feb0694f.",
        "before_after_code_files": [
          "framework/helpers/BaseHtml.php||framework/helpers/BaseHtml.php",
          "tests/framework/helpers/HtmlTest.php||tests/framework/helpers/HtmlTest.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/yiisoft/yii2/pull/20362"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "framework/helpers/BaseHtml.php||framework/helpers/BaseHtml.php": [
          "File: framework/helpers/BaseHtml.php -> framework/helpers/BaseHtml.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "2003:         $html = '';",
          "2004:         foreach ($attributes as $name => $value) {",
          "2005:             if (is_bool($value)) {",
          "2007:                     $html .= \" $name\";",
          "2010:                 }",
          "2011:             } elseif (is_array($value)) {",
          "2012:                 if (in_array($name, static::$dataAttributes)) {",
          "",
          "[Removed Lines]",
          "2006:                 if ($value && 'value' !== $name) {",
          "2008:                 } elseif ('value' === $name) {",
          "2009:                     $html .= \" $name=\\\"\" . static::encode((int)$value) . '\"';",
          "",
          "[Added Lines]",
          "2006:                 if ($value) {",
          "",
          "---------------"
        ],
        "tests/framework/helpers/HtmlTest.php||tests/framework/helpers/HtmlTest.php": [
          "File: tests/framework/helpers/HtmlTest.php -> tests/framework/helpers/HtmlTest.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "1231:         $this->assertEquals('', Html::renderTagAttributes(['class' => []]));",
          "1232:         $this->assertEquals(' style=\"width: 100px; height: 200px;\"', Html::renderTagAttributes(['style' => ['width' => '100px', 'height' => '200px']]));",
          "1233:         $this->assertEquals('', Html::renderTagAttributes(['style' => []]));",
          "1245:         $attributes = [",
          "1246:             'data' => [",
          "",
          "[Removed Lines]",
          "1234:         $this->assertEquals(' type=\"submit\" value=\"1\"', Html::renderTagAttributes(['type' => 'submit', 'value' => true]));",
          "1235:         $this->assertEquals(' type=\"submit\" value=\"0\"', Html::renderTagAttributes(['type' => 'submit', 'value' => false]));",
          "1236:         $this->assertEquals(",
          "1237:             ' type=\"submit\" value=\"1\" disabled',",
          "1238:             Html::renderTagAttributes(['type' => 'submit', 'value' => true, 'disabled' => true])",
          "1239:         );",
          "1240:         $this->assertEquals(",
          "1241:             ' type=\"submit\" value=\"0\"',",
          "1242:             Html::renderTagAttributes(['type' => 'submit', 'value' => false, 'disabled' => false])",
          "1243:         );",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    }
  ]
}