{
  "cve_id": "CVE-2016-5731",
  "cve_desc": "Cross-site scripting (XSS) vulnerability in examples/openid.php in phpMyAdmin 4.0.x before 4.0.10.16, 4.4.x before 4.4.15.7, and 4.6.x before 4.6.3 allows remote attackers to inject arbitrary web script or HTML via vectors involving an OpenID error message.",
  "repo": "phpmyadmin/phpmyadmin",
  "patch_hash": "94cf3864254ffaf3a69e97d8fc454888368b94ab",
  "patch_info": {
    "commit_hash": "94cf3864254ffaf3a69e97d8fc454888368b94ab",
    "repo": "phpmyadmin/phpmyadmin",
    "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/94cf3864254ffaf3a69e97d8fc454888368b94ab",
    "files": [
      "examples/openid.php"
    ],
    "message": "Escape error messages from OpenID\n\nSigned-off-by: Michal \u010ciha\u0159 <michal@cihar.com>",
    "before_after_code_files": [
      "examples/openid.php||examples/openid.php"
    ]
  },
  "patch_diff": {
    "examples/openid.php||examples/openid.php": [
      "File: examples/openid.php -> examples/openid.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "111:     $o = new OpenID_RelyingParty($returnTo, $realm, $identifier);",
      "112: } catch (Exception $e) {",
      "113:     $contents = \"<div class='relyingparty_results'>\\n\";",
      "115:     $contents .= \"</div class='relyingparty_results'>\";",
      "116:     Show_page($contents);",
      "117:     exit;",
      "",
      "[Removed Lines]",
      "114:     $contents .= \"<pre>\" . $e->getMessage() . \"</pre>\\n\";",
      "",
      "[Added Lines]",
      "114:     $contents .= \"<pre>\" . htmlspecialchars($e->getMessage()) . \"</pre>\\n\";",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "121: if (isset($_POST['start'])) {",
      "122:     try {",
      "123:         $authRequest = $o->prepare();",
      "125:         $contents = \"<div class='relyingparty_results'>\\n\";",
      "127:         $contents .= \"</div class='relyingparty_results'>\";",
      "128:         Show_page($contents);",
      "129:         exit;",
      "",
      "[Removed Lines]",
      "124:     } catch (OpenID_Exception $e) {",
      "126:         $contents .= \"<pre>\" . $e->getMessage() . \"</pre>\\n\";",
      "",
      "[Added Lines]",
      "124:     } catch (Exception $e) {",
      "126:         $contents .= \"<pre>\" . htmlspecialchars($e->getMessage()) . \"</pre>\\n\";",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "418aeea3d83b0b6021bac311d849570acfc6e48c",
      "candidate_info": {
        "commit_hash": "418aeea3d83b0b6021bac311d849570acfc6e48c",
        "repo": "phpmyadmin/phpmyadmin",
        "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/418aeea3d83b0b6021bac311d849570acfc6e48c",
        "files": [
          "examples/openid.php"
        ],
        "message": "Add error handling to constructing openid message\n\nSigned-off-by: Michal \u010ciha\u0159 <michal@cihar.com>",
        "before_after_code_files": [
          "examples/openid.php||examples/openid.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "examples/openid.php||examples/openid.php"
          ],
          "candidate": [
            "examples/openid.php||examples/openid.php"
          ]
        }
      },
      "candidate_diff": {
        "examples/openid.php||examples/openid.php": [
          "File: examples/openid.php -> examples/openid.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "63:     <?php",
          "64: }",
          "67: session_set_cookie_params(0, '/', '', false);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "66: function Die_error($e)",
          "67: {",
          "68:     $contents = \"<div class='relyingparty_results'>\\n\";",
          "69:     $contents .= \"<pre>\" . htmlspecialchars($e->getMessage()) . \"</pre>\\n\";",
          "70:     $contents .= \"</div class='relyingparty_results'>\";",
          "71:     Show_page($contents);",
          "72:     exit;",
          "73: }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "110: try {",
          "111:     $o = new OpenID_RelyingParty($returnTo, $realm, $identifier);",
          "112: } catch (Exception $e) {",
          "118: }",
          "",
          "[Removed Lines]",
          "113:     $contents = \"<div class='relyingparty_results'>\\n\";",
          "114:     $contents .= \"<pre>\" . htmlspecialchars($e->getMessage()) . \"</pre>\\n\";",
          "115:     $contents .= \"</div class='relyingparty_results'>\";",
          "116:     Show_page($contents);",
          "117:     exit;",
          "",
          "[Added Lines]",
          "123:     Die_error($e);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "122:     try {",
          "123:         $authRequest = $o->prepare();",
          "124:     } catch (Exception $e) {",
          "130:     }",
          "132:     $url = $authRequest->getAuthorizeURL();",
          "",
          "[Removed Lines]",
          "125:         $contents = \"<div class='relyingparty_results'>\\n\";",
          "126:         $contents .= \"<pre>\" . htmlspecialchars($e->getMessage()) . \"</pre>\\n\";",
          "127:         $contents .= \"</div class='relyingparty_results'>\";",
          "128:         Show_page($contents);",
          "129:         exit;",
          "",
          "[Added Lines]",
          "131:         Die_error($e);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "143:     }",
          "148:     $id = $message->get('openid.claimed_id');",
          "",
          "[Removed Lines]",
          "146:     $message = new OpenID_Message($queryString, OpenID_Message::FORMAT_HTTP);",
          "",
          "[Added Lines]",
          "148:     try {",
          "149:         $message = new OpenID_Message($queryString, OpenID_Message::FORMAT_HTTP);",
          "150:     } catch (Exception $e) {",
          "151:         Die_error($e);",
          "152:     }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "5fefa5113948044983d8341f272950ace7bbf1e8",
      "candidate_info": {
        "commit_hash": "5fefa5113948044983d8341f272950ace7bbf1e8",
        "repo": "phpmyadmin/phpmyadmin",
        "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/5fefa5113948044983d8341f272950ace7bbf1e8",
        "files": [
          "examples/openid.php"
        ],
        "message": "Escape error messages from OpenID\n\nSigned-off-by: Michal \u010ciha\u0159 <michal@cihar.com>",
        "before_after_code_files": [
          "examples/openid.php||examples/openid.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "examples/openid.php||examples/openid.php"
          ],
          "candidate": [
            "examples/openid.php||examples/openid.php"
          ]
        }
      },
      "candidate_diff": {
        "examples/openid.php||examples/openid.php": [
          "File: examples/openid.php -> examples/openid.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "109:     $o = new OpenID_RelyingParty($returnTo, $realm, $identifier);",
          "110: } catch (Exception $e) {",
          "111:     $contents = \"<div class='relyingparty_results'>\\n\";",
          "113:     $contents .= \"</div class='relyingparty_results'>\";",
          "114:     show_page($contents);",
          "115:     exit;",
          "",
          "[Removed Lines]",
          "112:     $contents .= \"<pre>\" . $e->getMessage() . \"</pre>\\n\";",
          "",
          "[Added Lines]",
          "112:     $contents .= \"<pre>\" . htmlspecialchars($e->getMessage()) . \"</pre>\\n\";",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "119: if (isset($_POST['start'])) {",
          "120:     try {",
          "121:         $authRequest = $o->prepare();",
          "123:         $contents = \"<div class='relyingparty_results'>\\n\";",
          "125:         $contents .= \"</div class='relyingparty_results'>\";",
          "126:         show_page($contents);",
          "127:         exit;",
          "",
          "[Removed Lines]",
          "122:     } catch (OpenID_Exception $e) {",
          "124:         $contents .= \"<pre>\" . $e->getMessage() . \"</pre>\\n\";",
          "",
          "[Added Lines]",
          "122:     } catch (Exception $e) {",
          "124:         $contents .= \"<pre>\" . htmlspecialchars($e->getMessage()) . \"</pre>\\n\";",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "52e7898bdc71f4548f4d518c1e12bf2bcb8802e6",
      "candidate_info": {
        "commit_hash": "52e7898bdc71f4548f4d518c1e12bf2bcb8802e6",
        "repo": "phpmyadmin/phpmyadmin",
        "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/52e7898bdc71f4548f4d518c1e12bf2bcb8802e6",
        "files": [
          "examples/openid.php"
        ],
        "message": "Escape error messages from OpenID\n\nSigned-off-by: Michal \u010ciha\u0159 <michal@cihar.com>",
        "before_after_code_files": [
          "examples/openid.php||examples/openid.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "examples/openid.php||examples/openid.php"
          ],
          "candidate": [
            "examples/openid.php||examples/openid.php"
          ]
        }
      },
      "candidate_diff": {
        "examples/openid.php||examples/openid.php": [
          "File: examples/openid.php -> examples/openid.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "111:     $o = new OpenID_RelyingParty($returnTo, $realm, $identifier);",
          "112: } catch (Exception $e) {",
          "113:     $contents = \"<div class='relyingparty_results'>\\n\";",
          "115:     $contents .= \"</div class='relyingparty_results'>\";",
          "116:     Show_page($contents);",
          "117:     exit;",
          "",
          "[Removed Lines]",
          "114:     $contents .= \"<pre>\" . $e->getMessage() . \"</pre>\\n\";",
          "",
          "[Added Lines]",
          "114:     $contents .= \"<pre>\" . htmlspecialchars($e->getMessage()) . \"</pre>\\n\";",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "121: if (isset($_POST['start'])) {",
          "122:     try {",
          "123:         $authRequest = $o->prepare();",
          "125:         $contents = \"<div class='relyingparty_results'>\\n\";",
          "127:         $contents .= \"</div class='relyingparty_results'>\";",
          "128:         Show_page($contents);",
          "129:         exit;",
          "",
          "[Removed Lines]",
          "124:     } catch (OpenID_Exception $e) {",
          "126:         $contents .= \"<pre>\" . $e->getMessage() . \"</pre>\\n\";",
          "",
          "[Added Lines]",
          "124:     } catch (Exception $e) {",
          "126:         $contents .= \"<pre>\" . htmlspecialchars($e->getMessage()) . \"</pre>\\n\";",
          "",
          "---------------"
        ]
      }
    }
  ]
}