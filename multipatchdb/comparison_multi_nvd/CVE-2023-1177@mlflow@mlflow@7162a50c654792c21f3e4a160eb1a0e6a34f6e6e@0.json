{
  "cve_id": "CVE-2023-1177",
  "cve_desc": "Path Traversal: '\\..\\filename' in GitHub repository mlflow/mlflow prior to 2.2.1.\n\n",
  "repo": "mlflow/mlflow",
  "patch_hash": "7162a50c654792c21f3e4a160eb1a0e6a34f6e6e",
  "patch_info": {
    "commit_hash": "7162a50c654792c21f3e4a160eb1a0e6a34f6e6e",
    "repo": "mlflow/mlflow",
    "commit_url": "https://github.com/mlflow/mlflow/commit/7162a50c654792c21f3e4a160eb1a0e6a34f6e6e",
    "files": [
      "mlflow/server/handlers.py"
    ],
    "message": "Apply suggestions from code review\n\nCo-authored-by: Ben Wilson <39283302+BenWilson2@users.noreply.github.com>\nSigned-off-by: Harutaka Kawamura <hkawamura0130@gmail.com>",
    "before_after_code_files": [
      "mlflow/server/handlers.py||mlflow/server/handlers.py"
    ]
  },
  "patch_diff": {
    "mlflow/server/handlers.py||mlflow/server/handlers.py": [
      "File: mlflow/server/handlers.py -> mlflow/server/handlers.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "1573:     A request handler for `GET /mlflow-artifacts/artifacts/<artifact_path>` to download an artifact",
      "1574:     from `artifact_path` (a relative path from the root artifact directory).",
      "1575:     \"\"\"",
      "1577:     tmp_dir = tempfile.TemporaryDirectory()",
      "1578:     artifact_repo = _get_artifact_repo_mlflow_artifacts()",
      "1579:     dst = artifact_repo.download_artifacts(artifact_path, tmp_dir.name)",
      "",
      "[Removed Lines]",
      "1576:     validate_path_is_safe(validate_path_is_safe)",
      "",
      "[Added Lines]",
      "1576:     validate_path_is_safe(artifact_path)",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "1598:     A request handler for `PUT /mlflow-artifacts/artifacts/<artifact_path>` to upload an artifact",
      "1599:     to `artifact_path` (a relative path from the root artifact directory).",
      "1600:     \"\"\"",
      "1602:     head, tail = posixpath.split(artifact_path)",
      "1603:     with tempfile.TemporaryDirectory() as tmp_dir:",
      "1604:         tmp_path = os.path.join(tmp_dir, tail)",
      "",
      "[Removed Lines]",
      "1601:     validate_path_is_safe(validate_path_is_safe)",
      "",
      "[Added Lines]",
      "1601:     validate_path_is_safe(artifact_path)",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "b425222d4dd508d88b1156274ce736e44c27cb67",
      "candidate_info": {
        "commit_hash": "b425222d4dd508d88b1156274ce736e44c27cb67",
        "repo": "mlflow/mlflow",
        "commit_url": "https://github.com/mlflow/mlflow/commit/b425222d4dd508d88b1156274ce736e44c27cb67",
        "files": [
          "mlflow/server/handlers.py"
        ],
        "message": "Apply `validate_path_is_safe` to `path` and `artifact_path` for `/mlflow-artifacts/` endpoints (#7891)\n\n* Apply validate_path_is_safe to path for /mlflow-artifacts/artifacts\n\nSigned-off-by: harupy <hkawamura0130@gmail.com>\n\n* Add more validate_path_is_safe\n\nSigned-off-by: harupy <hkawamura0130@gmail.com>\n\n* Apply suggestions from code review\n\nCo-authored-by: Ben Wilson <39283302+BenWilson2@users.noreply.github.com>\nSigned-off-by: Harutaka Kawamura <hkawamura0130@gmail.com>\n\n---------\n\nSigned-off-by: harupy <hkawamura0130@gmail.com>\nSigned-off-by: Harutaka Kawamura <hkawamura0130@gmail.com>\nCo-authored-by: Ben Wilson <39283302+BenWilson2@users.noreply.github.com>",
        "before_after_code_files": [
          "mlflow/server/handlers.py||mlflow/server/handlers.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/mlflow/mlflow/pull/7891"
        ],
        "olp_code_files": {
          "patch": [
            "mlflow/server/handlers.py||mlflow/server/handlers.py"
          ],
          "candidate": [
            "mlflow/server/handlers.py||mlflow/server/handlers.py"
          ]
        }
      },
      "candidate_diff": {
        "mlflow/server/handlers.py||mlflow/server/handlers.py": [
          "File: mlflow/server/handlers.py -> mlflow/server/handlers.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "1573:     A request handler for `GET /mlflow-artifacts/artifacts/<artifact_path>` to download an artifact",
          "1574:     from `artifact_path` (a relative path from the root artifact directory).",
          "1575:     \"\"\"",
          "1576:     tmp_dir = tempfile.TemporaryDirectory()",
          "1577:     artifact_repo = _get_artifact_repo_mlflow_artifacts()",
          "1578:     dst = artifact_repo.download_artifacts(artifact_path, tmp_dir.name)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1576:     validate_path_is_safe(artifact_path)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1597:     A request handler for `PUT /mlflow-artifacts/artifacts/<artifact_path>` to upload an artifact",
          "1598:     to `artifact_path` (a relative path from the root artifact directory).",
          "1599:     \"\"\"",
          "1600:     head, tail = posixpath.split(artifact_path)",
          "1601:     with tempfile.TemporaryDirectory() as tmp_dir:",
          "1602:         tmp_path = os.path.join(tmp_dir, tail)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1601:     validate_path_is_safe(artifact_path)",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1622:     (a relative path from the root artifact directory).",
          "1623:     \"\"\"",
          "1624:     request_message = _get_request_message(ListArtifactsMlflowArtifacts())",
          "1626:     artifact_repo = _get_artifact_repo_mlflow_artifacts()",
          "1627:     files = []",
          "1628:     for file_info in artifact_repo.list_artifacts(path):",
          "",
          "[Removed Lines]",
          "1625:     path = request_message.path if request_message.HasField(\"path\") else None",
          "",
          "[Added Lines]",
          "1627:     if request_message.HasField(\"path\"):",
          "1628:         validate_path_is_safe(request_message.path)",
          "1629:         path = request_message.path",
          "1630:     else:",
          "1631:         path = None",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1643:     A request handler for `DELETE /mlflow-artifacts/artifacts?path=<value>` to delete artifacts in",
          "1644:     `path` (a relative path from the root artifact directory).",
          "1645:     \"\"\"",
          "1646:     _get_request_message(DeleteArtifact())",
          "1647:     artifact_repo = _get_artifact_repo_mlflow_artifacts()",
          "1648:     artifact_repo.delete_artifacts(artifact_path)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1652:     validate_path_is_safe(artifact_path)",
          "",
          "---------------"
        ]
      }
    }
  ]
}