{
  "cve_id": "CVE-2023-33659",
  "cve_desc": "A heap buffer overflow vulnerability exists in NanoMQ 0.17.2. The vulnerability can be triggered by calling the function nmq_subinfo_decode() in the file mqtt_parser.c. An attacker could exploit this vulnerability to cause a denial of service attack.",
  "repo": "nanomq/NanoNNG",
  "patch_hash": "6815c4036a2344865da393803ecdb7af27d8bde1",
  "patch_info": {
    "commit_hash": "6815c4036a2344865da393803ecdb7af27d8bde1",
    "repo": "nanomq/NanoNNG",
    "commit_url": "https://github.com/nanomq/NanoNNG/pull/509/commits/6815c4036a2344865da393803ecdb7af27d8bde1",
    "files": [
      "src/sp/protocol/mqtt/mqtt_parser.c"
    ],
    "message": "* FIX [mqtt_parser.c] Fixed issue 1155.",
    "before_after_code_files": [
      "src/sp/protocol/mqtt/mqtt_parser.c||src/sp/protocol/mqtt/mqtt_parser.c"
    ]
  },
  "patch_diff": {
    "src/sp/protocol/mqtt/mqtt_parser.c||src/sp/protocol/mqtt/mqtt_parser.c": [
      "File: src/sp/protocol/mqtt/mqtt_parser.c -> src/sp/protocol/mqtt/mqtt_parser.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "300:  uint8_t *dest = NULL;",
      "304:   return NULL;",
      "305:  }",
      "",
      "[Removed Lines]",
      "302:  if (!src || !pos) {",
      "",
      "[Added Lines]",
      "302:  if (!src || !pos || limit < 2) {",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "d9792f58aef3e42680eac8f687148da0d7f54ebd",
      "candidate_info": {
        "commit_hash": "d9792f58aef3e42680eac8f687148da0d7f54ebd",
        "repo": "nanomq/NanoNNG",
        "commit_url": "https://github.com/nanomq/NanoNNG/commit/d9792f58aef3e42680eac8f687148da0d7f54ebd",
        "files": [
          "src/sp/transport/mqtt/broker_tcp.c"
        ],
        "message": "* FIX [mqtt_parser.c] Fixed issue 1154.",
        "before_after_code_files": [
          "src/sp/transport/mqtt/broker_tcp.c||src/sp/transport/mqtt/broker_tcp.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/nanomq/NanoNNG/pull/509"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/sp/transport/mqtt/broker_tcp.c||src/sp/transport/mqtt/broker_tcp.c": [
          "File: src/sp/transport/mqtt/broker_tcp.c -> src/sp/transport/mqtt/broker_tcp.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "708:  nni_aio_list_remove(aio);",
          "709:  msg      = p->rxmsg;",
          "711:  n        = nni_msg_len(msg);",
          "712:  type     = p->rxlen[0] & 0xf0;",
          "714:  fixed_header_adaptor(p->rxlen, msg);",
          "715:  nni_msg_set_conn_param(msg, cparam);",
          "",
          "[Removed Lines]",
          "710:  p->rxmsg = NULL;",
          "",
          "[Added Lines]",
          "713:  if (len <= 0 &&",
          "714:      (type == CMD_SUBSCRIBE || type == CMD_PUBLISH ||",
          "715:          CMD_UNSUBSCRIBE)) {",
          "716:   rv = PROTOCOL_ERROR;",
          "717:   goto recv_error;",
          "718:  }",
          "719:  p->rxmsg = NULL;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "1f3d63eed109748f297a89622eb2df7a84a54644",
      "candidate_info": {
        "commit_hash": "1f3d63eed109748f297a89622eb2df7a84a54644",
        "repo": "nanomq/NanoNNG",
        "commit_url": "https://github.com/nanomq/NanoNNG/commit/1f3d63eed109748f297a89622eb2df7a84a54644",
        "files": [
          "src/sp/protocol/mqtt/mqtt_parser.c"
        ],
        "message": "* FIX [mqtt_parser.c] Fixed issue 1155.",
        "before_after_code_files": [
          "src/sp/protocol/mqtt/mqtt_parser.c||src/sp/protocol/mqtt/mqtt_parser.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "src/sp/protocol/mqtt/mqtt_parser.c||src/sp/protocol/mqtt/mqtt_parser.c"
          ],
          "candidate": [
            "src/sp/protocol/mqtt/mqtt_parser.c||src/sp/protocol/mqtt/mqtt_parser.c"
          ]
        }
      },
      "candidate_diff": {
        "src/sp/protocol/mqtt/mqtt_parser.c||src/sp/protocol/mqtt/mqtt_parser.c": [
          "File: src/sp/protocol/mqtt/mqtt_parser.c -> src/sp/protocol/mqtt/mqtt_parser.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "300:  uint8_t *dest = NULL;",
          "304:   return NULL;",
          "305:  }",
          "",
          "[Removed Lines]",
          "302:  if (!src || !pos) {",
          "",
          "[Added Lines]",
          "302:  if (!src || !pos || limit < 2) {",
          "",
          "---------------"
        ]
      }
    }
  ]
}