{
  "cve_id": "CVE-2021-36147",
  "cve_desc": "An issue was discovered in ACRN before 2.5. It allows a devicemodel/hw/pci/virtio/virtio_net.c virtio_net_ping_rxq NULL pointer dereference for vq->used.",
  "repo": "projectacrn/acrn-hypervisor",
  "patch_hash": "131116b15b0e35a62085d23686b43ed1c12c1331",
  "patch_info": {
    "commit_hash": "131116b15b0e35a62085d23686b43ed1c12c1331",
    "repo": "projectacrn/acrn-hypervisor",
    "commit_url": "https://github.com/projectacrn/acrn-hypervisor/pull/6121/commits/131116b15b0e35a62085d23686b43ed1c12c1331",
    "files": [
      "devicemodel/hw/pci/virtio/virtio_net.c"
    ],
    "message": "dm: NULL check of vq->used in virtio_net_ping_rxq\n\nAdd a check on this place to avoid NULL access issue.\n\nTracked-On: #6100\nSigned-off-by: Jie Deng <jie.deng@intel.com>",
    "before_after_code_files": [
      "devicemodel/hw/pci/virtio/virtio_net.c||devicemodel/hw/pci/virtio/virtio_net.c"
    ]
  },
  "patch_diff": {
    "devicemodel/hw/pci/virtio/virtio_net.c||devicemodel/hw/pci/virtio/virtio_net.c": [
      "File: devicemodel/hw/pci/virtio/virtio_net.c -> devicemodel/hw/pci/virtio/virtio_net.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "491:  if (net->rx_ready == 0) {",
      "492:   net->rx_ready = 1;",
      "494:  }",
      "495: }",
      "",
      "[Removed Lines]",
      "493:   vq->used->flags |= VRING_USED_F_NO_NOTIFY;",
      "",
      "[Added Lines]",
      "493:   if (vq->used != NULL) {",
      "494:    vq->used->flags |= VRING_USED_F_NO_NOTIFY;",
      "495:   }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "c08ceb25c5eabe422d063675080cc035407bede5",
      "candidate_info": {
        "commit_hash": "c08ceb25c5eabe422d063675080cc035407bede5",
        "repo": "projectacrn/acrn-hypervisor",
        "commit_url": "https://github.com/projectacrn/acrn-hypervisor/commit/c08ceb25c5eabe422d063675080cc035407bede5",
        "files": [
          "devicemodel/hw/pci/virtio/virtio_net.c"
        ],
        "message": "dm: NULL check of vq->used in virtio_net_ping_rxq\n\nAdd a check on this place to avoid NULL access issue.\n\nTracked-On: #6100\nSigned-off-by: Jie Deng <jie.deng@intel.com>",
        "before_after_code_files": [
          "devicemodel/hw/pci/virtio/virtio_net.c||devicemodel/hw/pci/virtio/virtio_net.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "devicemodel/hw/pci/virtio/virtio_net.c||devicemodel/hw/pci/virtio/virtio_net.c"
          ],
          "candidate": [
            "devicemodel/hw/pci/virtio/virtio_net.c||devicemodel/hw/pci/virtio/virtio_net.c"
          ]
        }
      },
      "candidate_diff": {
        "devicemodel/hw/pci/virtio/virtio_net.c||devicemodel/hw/pci/virtio/virtio_net.c": [
          "File: devicemodel/hw/pci/virtio/virtio_net.c -> devicemodel/hw/pci/virtio/virtio_net.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "491:  if (net->rx_ready == 0) {",
          "492:   net->rx_ready = 1;",
          "494:  }",
          "495: }",
          "",
          "[Removed Lines]",
          "493:   vq->used->flags |= VRING_USED_F_NO_NOTIFY;",
          "",
          "[Added Lines]",
          "493:   if (vq->used != NULL) {",
          "494:    vq->used->flags |= VRING_USED_F_NO_NOTIFY;",
          "495:   }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "cf90f060c15301bf4a6133780a356eab19294bde",
      "candidate_info": {
        "commit_hash": "cf90f060c15301bf4a6133780a356eab19294bde",
        "repo": "projectacrn/acrn-hypervisor",
        "commit_url": "https://github.com/projectacrn/acrn-hypervisor/commit/cf90f060c15301bf4a6133780a356eab19294bde",
        "files": [
          "devicemodel/hw/pci/virtio/virtio_net.c"
        ],
        "message": "dm: NULL check of vq->used in virtio_net_ping_rxq\n\nAdd a check on this place to avoid NULL access issue.\n\nTracked-On: #6100\nSigned-off-by: Jie Deng <jie.deng@intel.com>",
        "before_after_code_files": [
          "devicemodel/hw/pci/virtio/virtio_net.c||devicemodel/hw/pci/virtio/virtio_net.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "devicemodel/hw/pci/virtio/virtio_net.c||devicemodel/hw/pci/virtio/virtio_net.c"
          ],
          "candidate": [
            "devicemodel/hw/pci/virtio/virtio_net.c||devicemodel/hw/pci/virtio/virtio_net.c"
          ]
        }
      },
      "candidate_diff": {
        "devicemodel/hw/pci/virtio/virtio_net.c||devicemodel/hw/pci/virtio/virtio_net.c": [
          "File: devicemodel/hw/pci/virtio/virtio_net.c -> devicemodel/hw/pci/virtio/virtio_net.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "490:  if (net->rx_ready == 0) {",
          "491:   net->rx_ready = 1;",
          "493:  }",
          "494: }",
          "",
          "[Removed Lines]",
          "492:   vq->used->flags |= VRING_USED_F_NO_NOTIFY;",
          "",
          "[Added Lines]",
          "492:   if (vq->used != NULL) {",
          "493:    vq->used->flags |= VRING_USED_F_NO_NOTIFY;",
          "494:   }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "81c5bdab5fc84d0a35239b454c6a0d8a52736a18",
      "candidate_info": {
        "commit_hash": "81c5bdab5fc84d0a35239b454c6a0d8a52736a18",
        "repo": "projectacrn/acrn-hypervisor",
        "commit_url": "https://github.com/projectacrn/acrn-hypervisor/commit/81c5bdab5fc84d0a35239b454c6a0d8a52736a18",
        "files": [
          "devicemodel/hw/pci/virtio/virtio_net.c"
        ],
        "message": "dm: NULL check of vq->used in virtio_net_ping_rxq\n\nAdd a check on this place to avoid NULL access issue.\n\nTracked-On: #6100\nSigned-off-by: Jie Deng <jie.deng@intel.com>",
        "before_after_code_files": [
          "devicemodel/hw/pci/virtio/virtio_net.c||devicemodel/hw/pci/virtio/virtio_net.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "devicemodel/hw/pci/virtio/virtio_net.c||devicemodel/hw/pci/virtio/virtio_net.c"
          ],
          "candidate": [
            "devicemodel/hw/pci/virtio/virtio_net.c||devicemodel/hw/pci/virtio/virtio_net.c"
          ]
        }
      },
      "candidate_diff": {
        "devicemodel/hw/pci/virtio/virtio_net.c||devicemodel/hw/pci/virtio/virtio_net.c": [
          "File: devicemodel/hw/pci/virtio/virtio_net.c -> devicemodel/hw/pci/virtio/virtio_net.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "491:  if (net->rx_ready == 0) {",
          "492:   net->rx_ready = 1;",
          "494:  }",
          "495: }",
          "",
          "[Removed Lines]",
          "493:   vq->used->flags |= VRING_USED_F_NO_NOTIFY;",
          "",
          "[Added Lines]",
          "493:   if (vq->used != NULL) {",
          "494:    vq->used->flags |= VRING_USED_F_NO_NOTIFY;",
          "495:   }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "2e08f32e7a1606c6646da0b4795de8aef2667adf",
      "candidate_info": {
        "commit_hash": "2e08f32e7a1606c6646da0b4795de8aef2667adf",
        "repo": "projectacrn/acrn-hypervisor",
        "commit_url": "https://github.com/projectacrn/acrn-hypervisor/commit/2e08f32e7a1606c6646da0b4795de8aef2667adf",
        "files": [
          "devicemodel/hw/pci/virtio/virtio_net.c"
        ],
        "message": "dm: NULL check of vq->used in virtio_net_ping_rxq\n\nAdd a check on this place to avoid NULL access issue.\n\nTracked-On: #6100\nSigned-off-by: Jie Deng <jie.deng@intel.com>",
        "before_after_code_files": [
          "devicemodel/hw/pci/virtio/virtio_net.c||devicemodel/hw/pci/virtio/virtio_net.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "devicemodel/hw/pci/virtio/virtio_net.c||devicemodel/hw/pci/virtio/virtio_net.c"
          ],
          "candidate": [
            "devicemodel/hw/pci/virtio/virtio_net.c||devicemodel/hw/pci/virtio/virtio_net.c"
          ]
        }
      },
      "candidate_diff": {
        "devicemodel/hw/pci/virtio/virtio_net.c||devicemodel/hw/pci/virtio/virtio_net.c": [
          "File: devicemodel/hw/pci/virtio/virtio_net.c -> devicemodel/hw/pci/virtio/virtio_net.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "477:  if (net->rx_ready == 0) {",
          "478:   net->rx_ready = 1;",
          "480:  }",
          "481: }",
          "",
          "[Removed Lines]",
          "479:   vq->used->flags |= VRING_USED_F_NO_NOTIFY;",
          "",
          "[Added Lines]",
          "479:   if (vq->used != NULL) {",
          "480:    vq->used->flags |= VRING_USED_F_NO_NOTIFY;",
          "481:   }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "fc62ebfa854fb4c92afa6969a055dc1b3f11bc4c",
      "candidate_info": {
        "commit_hash": "fc62ebfa854fb4c92afa6969a055dc1b3f11bc4c",
        "repo": "projectacrn/acrn-hypervisor",
        "commit_url": "https://github.com/projectacrn/acrn-hypervisor/commit/fc62ebfa854fb4c92afa6969a055dc1b3f11bc4c",
        "files": [
          "devicemodel/hw/pci/virtio/virtio_net.c"
        ],
        "message": "dm: NULL check of vq->used in virtio_net_ping_rxq\n\nAdd a check on this place to avoid NULL access issue.\n\nTracked-On: #6100\nSigned-off-by: Jie Deng <jie.deng@intel.com>",
        "before_after_code_files": [
          "devicemodel/hw/pci/virtio/virtio_net.c||devicemodel/hw/pci/virtio/virtio_net.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "devicemodel/hw/pci/virtio/virtio_net.c||devicemodel/hw/pci/virtio/virtio_net.c"
          ],
          "candidate": [
            "devicemodel/hw/pci/virtio/virtio_net.c||devicemodel/hw/pci/virtio/virtio_net.c"
          ]
        }
      },
      "candidate_diff": {
        "devicemodel/hw/pci/virtio/virtio_net.c||devicemodel/hw/pci/virtio/virtio_net.c": [
          "File: devicemodel/hw/pci/virtio/virtio_net.c -> devicemodel/hw/pci/virtio/virtio_net.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "491:  if (net->rx_ready == 0) {",
          "492:   net->rx_ready = 1;",
          "494:  }",
          "495: }",
          "",
          "[Removed Lines]",
          "493:   vq->used->flags |= VRING_USED_F_NO_NOTIFY;",
          "",
          "[Added Lines]",
          "493:   if (vq->used != NULL) {",
          "494:    vq->used->flags |= VRING_USED_F_NO_NOTIFY;",
          "495:   }",
          "",
          "---------------"
        ]
      }
    }
  ]
}