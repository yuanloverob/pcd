{
  "cve_id": "CVE-2021-36357",
  "cve_desc": "An issue was discovered in OpenPOWER 2.6 firmware. unpack_timestamp() calls le32_to_cpu() for endian conversion of a uint16_t \"year\" value, resulting in a type mismatch that can truncate a higher integer value to a smaller one, and bypass a timestamp check. The fix is to use the right endian conversion function.",
  "repo": "open-power/skiboot",
  "patch_hash": "5be38b672c1410e2f10acd3ad2eecfdc81d5daf7",
  "patch_info": {
    "commit_hash": "5be38b672c1410e2f10acd3ad2eecfdc81d5daf7",
    "repo": "open-power/skiboot",
    "commit_url": "https://github.com/open-power/skiboot/commit/5be38b672c1410e2f10acd3ad2eecfdc81d5daf7",
    "files": [
      "libstb/secvar/backend/edk2-compat-process.c"
    ],
    "message": "secvar: fix endian conversion\n\nunpack_timestamp() calls le32_to_cpu() for endian conversion of\nuint16_t \"year\" value. This patch fixes the code to use le16_to_cpu().\n\nSigned-off-by: Nayna Jain <nayna@linux.ibm.com>\nReviewed-by: Daniel Axtens <dja@axtens.net>\nSigned-off-by: Vasant Hegde <hegdevasant@linux.vnet.ibm.com>",
    "before_after_code_files": [
      "libstb/secvar/backend/edk2-compat-process.c||libstb/secvar/backend/edk2-compat-process.c"
    ]
  },
  "patch_diff": {
    "libstb/secvar/backend/edk2-compat-process.c||libstb/secvar/backend/edk2-compat-process.c": [
      "File: libstb/secvar/backend/edk2-compat-process.c -> libstb/secvar/backend/edk2-compat-process.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "370: static uint64_t unpack_timestamp(const struct efi_time *timestamp)",
      "371: {",
      "372:  uint64_t val = 0;",
      "376:  val |= ((uint64_t) timestamp->pad1 & 0xFF) << 0;",
      "",
      "[Removed Lines]",
      "373:  uint16_t year = le32_to_cpu(timestamp->year);",
      "",
      "[Added Lines]",
      "373:  uint16_t year = le16_to_cpu(timestamp->year);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "55204c06b83dc5fd13280ec50a22caa649251fe1",
      "candidate_info": {
        "commit_hash": "55204c06b83dc5fd13280ec50a22caa649251fe1",
        "repo": "open-power/skiboot",
        "commit_url": "https://github.com/open-power/skiboot/commit/55204c06b83dc5fd13280ec50a22caa649251fe1",
        "files": [
          "libstb/secvar/backend/edk2-compat-process.c"
        ],
        "message": "secvar: fix endian conversion\n\n[ Upstream commit 5be38b672c1410e2f10acd3ad2eecfdc81d5daf7 ]\n\nunpack_timestamp() calls le32_to_cpu() for endian conversion of\nuint16_t \"year\" value. This patch fixes the code to use le16_to_cpu().\n\nSigned-off-by: Nayna Jain <nayna@linux.ibm.com>\nReviewed-by: Daniel Axtens <dja@axtens.net>\nSigned-off-by: Vasant Hegde <hegdevasant@linux.vnet.ibm.com>",
        "before_after_code_files": [
          "libstb/secvar/backend/edk2-compat-process.c||libstb/secvar/backend/edk2-compat-process.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libstb/secvar/backend/edk2-compat-process.c||libstb/secvar/backend/edk2-compat-process.c"
          ],
          "candidate": [
            "libstb/secvar/backend/edk2-compat-process.c||libstb/secvar/backend/edk2-compat-process.c"
          ]
        }
      },
      "candidate_diff": {
        "libstb/secvar/backend/edk2-compat-process.c||libstb/secvar/backend/edk2-compat-process.c": [
          "File: libstb/secvar/backend/edk2-compat-process.c -> libstb/secvar/backend/edk2-compat-process.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "370: static uint64_t unpack_timestamp(const struct efi_time *timestamp)",
          "371: {",
          "372:  uint64_t val = 0;",
          "376:  val |= ((uint64_t) timestamp->pad1 & 0xFF) << 0;",
          "",
          "[Removed Lines]",
          "373:  uint16_t year = le32_to_cpu(timestamp->year);",
          "",
          "[Added Lines]",
          "373:  uint16_t year = le16_to_cpu(timestamp->year);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "5eea157271852eaf16c59ef542a889ea6563a2d6",
      "candidate_info": {
        "commit_hash": "5eea157271852eaf16c59ef542a889ea6563a2d6",
        "repo": "open-power/skiboot",
        "commit_url": "https://github.com/open-power/skiboot/commit/5eea157271852eaf16c59ef542a889ea6563a2d6",
        "files": [
          "libstb/secvar/backend/edk2-compat-process.c"
        ],
        "message": "secvar: fix endian conversion\n\n[ Upstream commit 5be38b672c1410e2f10acd3ad2eecfdc81d5daf7 ]\n\nunpack_timestamp() calls le32_to_cpu() for endian conversion of\nuint16_t \"year\" value. This patch fixes the code to use le16_to_cpu().\n\nSigned-off-by: Nayna Jain <nayna@linux.ibm.com>\nReviewed-by: Daniel Axtens <dja@axtens.net>\nSigned-off-by: Vasant Hegde <hegdevasant@linux.vnet.ibm.com>",
        "before_after_code_files": [
          "libstb/secvar/backend/edk2-compat-process.c||libstb/secvar/backend/edk2-compat-process.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libstb/secvar/backend/edk2-compat-process.c||libstb/secvar/backend/edk2-compat-process.c"
          ],
          "candidate": [
            "libstb/secvar/backend/edk2-compat-process.c||libstb/secvar/backend/edk2-compat-process.c"
          ]
        }
      },
      "candidate_diff": {
        "libstb/secvar/backend/edk2-compat-process.c||libstb/secvar/backend/edk2-compat-process.c": [
          "File: libstb/secvar/backend/edk2-compat-process.c -> libstb/secvar/backend/edk2-compat-process.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "370: static uint64_t unpack_timestamp(const struct efi_time *timestamp)",
          "371: {",
          "372:  uint64_t val = 0;",
          "376:  val |= ((uint64_t) timestamp->pad1 & 0xFF) << 0;",
          "",
          "[Removed Lines]",
          "373:  uint16_t year = le32_to_cpu(timestamp->year);",
          "",
          "[Added Lines]",
          "373:  uint16_t year = le16_to_cpu(timestamp->year);",
          "",
          "---------------"
        ]
      }
    }
  ]
}