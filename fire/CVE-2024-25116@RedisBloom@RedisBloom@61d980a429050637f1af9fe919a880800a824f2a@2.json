{
  "cve_id": "CVE-2024-25116",
  "cve_desc": "RedisBloom adds a set of probabilistic data structures to Redis. Starting in version 2.0.0 and prior to version 2.4.7 and 2.6.10, authenticated users can use the `CF.RESERVE` command to trigger a runtime assertion and termination of the Redis server process. The problem is fixed in RedisBloom 2.4.7 and 2.6.10.",
  "repo": "RedisBloom/RedisBloom",
  "patch_hash": "61d980a429050637f1af9fe919a880800a824f2a",
  "patch_info": {
    "commit_hash": "61d980a429050637f1af9fe919a880800a824f2a",
    "repo": "RedisBloom/RedisBloom",
    "commit_url": "https://github.com/RedisBloom/RedisBloom/commit/61d980a429050637f1af9fe919a880800a824f2a",
    "files": [
      "src/rebloom.c",
      "tests/flow/test_cuckoo.py"
    ],
    "message": "MOD-6343 Fix potential crash for cf.reserve (#724)\n\n* Enforce limits for cf.reserve arguments\n\n* comment\n\n* comment-2",
    "before_after_code_files": [
      "src/rebloom.c||src/rebloom.c",
      "tests/flow/test_cuckoo.py||tests/flow/test_cuckoo.py"
    ]
  },
  "patch_diff": {
    "src/rebloom.c||src/rebloom.c": [
      "File: src/rebloom.c -> src/rebloom.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "24: #define REDISBLOOM_GIT_SHA \"unknown\"",
      "25: #endif",
      "28: #define CF_DEFAULT_BUCKETSIZE 2",
      "29: #define CF_DEFAULT_EXPANSION 1",
      "30: #define BF_DEFAULT_EXPANSION 2",
      "",
      "[Removed Lines]",
      "27: #define CF_MAX_ITERATIONS 20",
      "",
      "[Added Lines]",
      "27: #define CF_DEFAULT_MAX_ITERATIONS 20",
      "30: #define CF_MAX_EXPANSION 32768",
      "31: #define CF_MAX_BUCKET_SIZE 255",
      "32: #define CF_MAX_ITERATIONS 65535",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "107:     return sb;",
      "108: }",
      "112:     if (capacity < bucketSize * 2)",
      "113:         return NULL;",
      "",
      "[Removed Lines]",
      "110: static CuckooFilter *cfCreate(RedisModuleKey *key, size_t capacity, size_t bucketSize,",
      "111:                               size_t maxIterations, size_t expansion) {",
      "",
      "[Added Lines]",
      "113: static CuckooFilter *cfCreate(RedisModuleKey *key, size_t capacity, uint16_t bucketSize,",
      "114:                               uint16_t maxIterations, uint16_t expansion) {",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "529:         return RedisModule_ReplyWithError(ctx, \"Bad capacity\");",
      "530:     }",
      "533:     int mi_loc = RMUtil_ArgIndex(\"MAXITERATIONS\", argv, argc);",
      "534:     if (mi_loc != -1) {",
      "535:         if (RedisModule_StringToLongLong(argv[mi_loc + 1], &maxIterations) != REDISMODULE_OK) {",
      "536:             return RedisModule_ReplyWithError(ctx, \"Couldn't parse MAXITERATIONS\");",
      "538:             return RedisModule_ReplyWithError(",
      "540:         }",
      "541:     }",
      "",
      "[Removed Lines]",
      "532:     long long maxIterations = CF_MAX_ITERATIONS;",
      "537:         } else if (maxIterations <= 0) {",
      "539:                 ctx, \"MAXITERATIONS parameter needs to be a positive integer\");",
      "",
      "[Added Lines]",
      "535:     long long maxIterations = CF_DEFAULT_MAX_ITERATIONS;",
      "540:         } else if (maxIterations <= 0 || maxIterations > CF_MAX_ITERATIONS) {",
      "542:                 ctx, \"MAXITERATIONS: value must be an integer between 1 and 65535, inclusive.\");",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "545:     if (bs_loc != -1) {",
      "546:         if (RedisModule_StringToLongLong(argv[bs_loc + 1], &bucketSize) != REDISMODULE_OK) {",
      "547:             return RedisModule_ReplyWithError(ctx, \"Couldn't parse BUCKETSIZE\");",
      "549:             return RedisModule_ReplyWithError(",
      "551:         }",
      "552:     }",
      "",
      "[Removed Lines]",
      "548:         } else if (bucketSize <= 0) {",
      "550:                 ctx, \"BUCKETSIZE parameter needs to be a positive integer\");",
      "",
      "[Added Lines]",
      "551:         } else if (bucketSize <= 0 || bucketSize > CF_MAX_BUCKET_SIZE) {",
      "553:                 ctx, \"BUCKETSIZE: value must be an integer between 1 and 255, inclusive.\");",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "556:     if (ex_loc != -1) {",
      "557:         if (RedisModule_StringToLongLong(argv[ex_loc + 1], &expansion) != REDISMODULE_OK) {",
      "558:             return RedisModule_ReplyWithError(ctx, \"Couldn't parse EXPANSION\");",
      "560:             return RedisModule_ReplyWithError(",
      "562:         }",
      "563:     }",
      "",
      "[Removed Lines]",
      "559:         } else if (expansion < 0) {",
      "561:                 ctx, \"EXPANSION parameter needs to be a non-negative integer\");",
      "",
      "[Added Lines]",
      "562:         } else if (expansion < 0 || expansion > CF_MAX_EXPANSION) {",
      "564:                 ctx, \"EXPANSION: value must be an integer between 0 and 32768, inclusive.\");",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "596:     int status = cfGetFilter(key, &cf);",
      "598:     if (status == SB_EMPTY && options->autocreate) {",
      "600:                            CF_DEFAULT_EXPANSION)) == NULL) {",
      "601:             return RedisModule_ReplyWithError(ctx, \"Could not create filter\"); // LCOV_EXCL_LINE",
      "602:         }",
      "",
      "[Removed Lines]",
      "599:         if ((cf = cfCreate(key, options->capacity, CF_DEFAULT_BUCKETSIZE, CF_MAX_ITERATIONS,",
      "",
      "[Added Lines]",
      "602:         if ((cf = cfCreate(key, options->capacity, CF_DEFAULT_BUCKETSIZE, CF_DEFAULT_MAX_ITERATIONS,",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "1252:     if (encver < CF_MIN_EXPANSION_VERSION) { // CF_ENCODING_VERSION when added",
      "1253:         cf->numDeletes = 0;                  // Didn't exist earlier. bug fix",
      "1254:         cf->bucketSize = CF_DEFAULT_BUCKETSIZE;",
      "1256:         cf->expansion = CF_DEFAULT_EXPANSION;",
      "1257:     } else {",
      "1258:         cf->numDeletes = RedisModule_LoadUnsigned(io);",
      "",
      "[Removed Lines]",
      "1255:         cf->maxIterations = CF_MAX_ITERATIONS;",
      "",
      "[Added Lines]",
      "1258:         cf->maxIterations = CF_DEFAULT_MAX_ITERATIONS;",
      "",
      "---------------"
    ],
    "tests/flow/test_cuckoo.py||tests/flow/test_cuckoo.py": [
      "File: tests/flow/test_cuckoo.py -> tests/flow/test_cuckoo.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "346:         self.assertRaises(ResponseError, self.cmd, 'CF.LOADCHUNK err iterator') # missing data",
      "347:         self.assertRaises(ResponseError, self.cmd, 'CF.SCANDUMP err')",
      "349: class testCuckooNoCodec():",
      "350:     def __init__(self):",
      "351:         self.env = Env(decodeResponses=False)",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "349:     def test_reserve_limits(self):",
      "350:         self.cmd('FLUSHALL')",
      "351:         self.assertRaises(ResponseError, self.cmd, 'CF.RESERVE cf 100 BUCKETSIZE 33554432')",
      "352:         self.assertRaises(ResponseError, self.cmd, 'CF.RESERVE cf 100 MAXITERATIONS 165536')",
      "353:         self.assertRaises(ResponseError, self.cmd, 'CF.RESERVE cf 100 EXPANSION 327695')",
      "354:         self.assertRaises(ResponseError, self.cmd, 'CF.RESERVE CF 67108864 BUCKETSIZE 33554432 MAXITERATIONS 1337 EXPANSION 1337')",
      "356:         self.cmd('CF.RESERVE cf 67108864 BUCKETSIZE 255 MAXITERATIONS 65535 EXPANSION 32768')",
      "357:         info = self.cmd('CF.INFO cf')",
      "358:         self.assertEqual(info[info.index('Bucket size') + 1], 255)",
      "359:         self.assertEqual(info[info.index('Expansion rate') + 1], 32768)",
      "360:         self.assertEqual(info[info.index('Max iterations') + 1], 65535)",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "56b0974680607a120c8d81d8cec0328c4ef6ce9c",
      "candidate_info": {
        "commit_hash": "56b0974680607a120c8d81d8cec0328c4ef6ce9c",
        "repo": "RedisBloom/RedisBloom",
        "commit_url": "https://github.com/RedisBloom/RedisBloom/commit/56b0974680607a120c8d81d8cec0328c4ef6ce9c",
        "files": [
          "Makefile",
          "pack/ramp.yml",
          "sbin/pack.sh"
        ],
        "message": "Enhance packaging scripts to support additional arguments and improve module handling in Makefile and pack.sh (#839)\n\n(cherry picked from commit cbb18311ce60812ea256915dbbfbcca5d6c360e1)",
        "before_after_code_files": [
          "sbin/pack.sh||sbin/pack.sh"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/RedisBloom/RedisBloom/pull/859"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "sbin/pack.sh||sbin/pack.sh": [
          "File: sbin/pack.sh -> sbin/pack.sh",
          "--- Hunk 1 ---",
          "[Context before]",
          "18:  cat <<-END",
          "19:   Generate RedisBloom distribution packages.",
          "23:   Argument variables:",
          "26:   RAMP=0|1            Build RAMP package",
          "27:   DEPS=0|1            Build dependencies files",
          "28:   SYM=0|1             Build debug symbols file",
          "30:   BRANCH=name         Branch name for snapshot packages",
          "31:   WITH_GITSHA=1       Append Git SHA to shapshot package names",
          "",
          "[Removed Lines]",
          "21:   [ARGVARS...] pack.sh [--help|help]",
          "24:   MODULE=path         Path of module .so",
          "",
          "[Added Lines]",
          "21:   [ARGVARS...] pack.sh [--help|help] [<module-so-path>]",
          "27:   RELEASE=1           Generate \"release\" packages (artifacts/release/)",
          "28:   SNAPSHOT=1          Generate \"shapshot\" packages (artifacts/snapshot/)",
          "30:   MODULE_NAME=name    Module name (default: bf)",
          "31:   PACKAGE_NAME=name   Package stem name",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "35:   ARTDIR=dir          Directory in which packages are created (default: bin/artifacts)",
          "37:   JUST_PRINT=1        Only print package names, do not generate",
          "38:   VERBOSE=1           Print commands",
          "39:   HELP=1              Show help",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "40:   RAMP_YAML=path      RAMP configuration file path",
          "41:   RAMP_ARGS=args      Extra arguments to RAMP",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "70: [[ $OSNICK == rocky8 ]]  && OSNICK=rhel8",
          "71: [[ $OSNICK == rocky9 ]]  && OSNICK=rhel9",
          "73: PLATFORM=\"$OS-$OSNICK-$ARCH\"",
          "75: #----------------------------------------------------------------------------------------------",
          "82: RAMP=${RAMP:-1}",
          "86: [[ -z $ARTDIR ]] && ARTDIR=bin/artifacts",
          "87: mkdir -p $ARTDIR $ARTDIR/snapshots",
          "88: ARTDIR=$(cd $ARTDIR && pwd)",
          "90: PACKAGE_NAME=redisbloom",
          "92: DEP_NAMES=\"\"",
          "",
          "[Removed Lines]",
          "77: if [[ -z $MODULE || ! -f $MODULE ]]; then",
          "78:  eprint \"MODULE is not defined or does not refer to a file\"",
          "79:  exit 1",
          "80: fi",
          "83: DEPS=${DEPS:-0}",
          "84: SYM=${SYM:-0}",
          "",
          "[Added Lines]",
          "84: MODULE=\"$1\"",
          "87: DEPS=${DEPS:-1}",
          "88: SYM=${SYM:-1}",
          "90: RELEASE=${RELEASE:-1}",
          "91: SNAPSHOT=${SNAPSHOT:-1}",
          "97: #----------------------------------------------------------------------------------------------",
          "99: MODULE_NAME=${MODULE_NAME:-bf}",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "99:  cd $ROOT",
          "101:  local stem=${PACKAGE_NAME}.${PLATFORM}",
          "105:  local fq_package=$stem.${verspec}.zip",
          "111:  local xtx_vars=\"\"",
          "116:  elif [[ -z $RAMP_VARIANT ]]; then",
          "118:  else",
          "120:  fi",
          "122:  python3 $READIES/bin/xtx \\",
          "",
          "[Removed Lines]",
          "103:  local verspec=${SEMVER}${_VARIANT}",
          "107:  [[ ! -d $ARTDIR ]] && mkdir -p $ARTDIR",
          "109:  local packfile=\"$ARTDIR/$fq_package\"",
          "112:  local dep_fname=\"${PACKAGE_NAME}.${PLATFORM}.${verspec}.tgz\"",
          "114:  if [[ -z $RAMP_YAML ]]; then",
          "115:   RAMP_YAML=$ROOT/ramp.yml",
          "117:   RAMP_YAML=$ROOT/ramp.yml",
          "119:   RAMP_YAML=$ROOT/ramp${_RAMP_VARIANT}.yml",
          "",
          "[Added Lines]",
          "112:  local stem_debug=${PACKAGE_NAME}.debug.${PLATFORM}",
          "114:  if [[ $SNAPSHOT == 0 ]]; then",
          "115:   local verspec=${SEMVER}${VARIANT}",
          "116:   local packdir=.",
          "117:   local s3base=\"\"",
          "118:  else",
          "119:   local verspec=${BRANCH}${VARIANT}",
          "120:   local packdir=snapshots",
          "121:   local s3base=snapshots/",
          "122:  fi",
          "125:  local fq_package_debug=$stem_debug.${verspec}.zip",
          "127:  [[ ! -d $ARTDIR/$packdir ]] && mkdir -p $ARTDIR/$packdir",
          "129:  local packfile=$ARTDIR/$packdir/$fq_package",
          "130:  local packfile_debug=$ARTDIR/$packdir/$fq_package_debug",
          "133:  for dep in $DEP_NAMES; do",
          "134:   eval \"export NAME_${dep}=${PACKAGE_NAME}_${dep}\"",
          "135:   local dep_fname=\"${PACKAGE_NAME}.${dep}.${PLATFORM}.${verspec}.tgz\"",
          "136:   eval \"export PATH_${dep}=${s3base}${dep_fname}\"",
          "137:   local dep_sha256=\"$ARTDIR/$packdir/${dep_fname}.sha256\"",
          "138:   eval \"export SHA256_${dep}=$(cat $dep_sha256)\"",
          "140:   xtx_vars+=\" -e NAME_$dep -e PATH_$dep -e SHA256_$dep\"",
          "141:  done",
          "143:  if [[ -n $RAMP_YAML ]]; then",
          "144:   RAMP_YAML=\"$(realpath $RAMP_YAML)\"",
          "146:   RAMP_YAML=\"$ROOT/pack/ramp.yml\"",
          "148:   RAMP_YAML=\"$ROOT/pack/ramp${_RAMP_VARIANT}.yml\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "129:  fi",
          "131:  runn rm -f /tmp/ramp.fname $packfile",
          "133:  # ROOT is required so ramp will detect the right git commit",
          "134:  cd $ROOT",
          "135:  runn @ <<-EOF",
          "136:   $RAMP_CMD pack -m /tmp/ramp.yml \\",
          "137:    $RAMP_ARGS \\",
          "138:    --verbose \\",
          "139:    --debug \\",
          "140:    --packname-file /tmp/ramp.fname \\",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "167:    -n $MODULE_NAME \\",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "150:    exit 1",
          "151:   else",
          "152:    local packname=`cat /tmp/ramp.fname`",
          "154:   fi",
          "155:  fi",
          "161:  fi",
          "165:  cd $ROOT",
          "166: }",
          "",
          "[Removed Lines]",
          "153:    echo \"# Created $packname\"",
          "157:  cd $ARTDIR/snapshots",
          "158:  if [[ ! -z $BRANCH ]]; then",
          "159:   local snap_package=$stem.${BRANCH}${_VARIANT}.zip",
          "160:   ln -sf ../$fq_package $snap_package",
          "163:  local packname=`cat /tmp/ramp.fname`",
          "164:  echo \"Created $packname\"",
          "",
          "[Added Lines]",
          "183:    echo \"# Created $(realpath $packname)\"",
          "187:  if [[ -f $MODULE.debug ]]; then",
          "188:   runn @ <<-EOF",
          "189:    $RAMP_CMD pack -m /tmp/ramp.yml \\",
          "190:     $RAMP_ARGS \\",
          "191:     -n $MODULE_NAME \\",
          "192:     --verbose \\",
          "193:     --debug \\",
          "194:     --packname-file /tmp/ramp.fname \\",
          "195:     -o $packfile_debug \\",
          "196:     $MODULE.debug \\",
          "197:     >/tmp/ramp.err 2>&1 || true",
          "198:    EOF",
          "200:   if [[ $NOP != 1 ]]; then",
          "201:    if [[ ! -e $packfile_debug ]]; then",
          "202:     eprint \"Error generating RAMP file:\"",
          "203:     >&2 cat /tmp/ramp.err",
          "204:     exit 1",
          "205:    else",
          "206:     local packname=`cat /tmp/ramp.fname`",
          "207:     echo \"# Created $(realpath $packname)\"",
          "208:    fi",
          "209:   fi",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "170: pack_deps() {",
          "171:  local dep=\"$1\"",
          "173:  local stem=${PACKAGE_NAME}.${dep}.${PLATFORM}",
          "176:  local depdir=$(cat $ARTDIR/$dep.dir)",
          "180:  local dep_prefix_dir=$(cat $ARTDIR/$dep.prefix)",
          "194:  fi",
          "195:  runn @ <<-EOF",
          "197:   EOF",
          "199:  cd $ARTDIR/snapshots",
          "200:  if [[ -n $BRANCH ]]; then",
          "204:  fi",
          "206:  cd $ROOT",
          "",
          "[Removed Lines]",
          "174:  local verspec=${SEMVER}${_VARIANT}",
          "178:  local fq_dep=$stem.${verspec}.tgz",
          "179:  local tar_path=$ARTDIR/$fq_dep",
          "182:  { cd $depdir ;\\",
          "183:    cat $ARTDIR/$dep.files | \\",
          "184:    xargs tar -c --sort=name --owner=root:0 --group=root:0 --mtime='UTC 1970-01-01' \\",
          "185:   --transform \"s,^,$dep_prefix_dir,\" 2> /tmp/pack.err | \\",
          "186:    gzip -n - > $tar_path ; E=$?; } || true",
          "187:  rm -f $ARTDIR/$dep.prefix $ARTDIR/$dep.files $ARTDIR/$dep.dir",
          "189:  cd $ROOT",
          "190:  if [[ $E != 0 || -s /tmp/pack.err ]]; then",
          "191:   eprint \"Error creating $tar_path:\"",
          "192:   cat /tmp/pack.err >&2",
          "193:   exit 1",
          "196:   sha256sum $tar_path | awk '{print $1}' > $tar_path.sha256",
          "201:   local snap_dep=$stem.${BRANCH}${_VARIANT}.tgz",
          "202:   runn ln -sf ../$fq_dep $snap_dep",
          "203:   runn ln -sf ../$fq_dep.sha256 $snap_dep.sha256",
          "",
          "[Added Lines]",
          "220:  cd $ROOT",
          "223:  local verspec=${SEMVER}${VARIANT}",
          "224:  local fq_package=$stem.${verspec}.tgz",
          "227:  local tar_path=$ARTDIR/$fq_package",
          "230:  rm -f $tar_path",
          "231:  if [[ $NOP != 1 ]]; then",
          "232:   { cd $depdir ;\\",
          "233:     cat $ARTDIR/$dep.files | \\",
          "234:     xargs tar -c --sort=name --owner=root:0 --group=root:0 --mtime='UTC 1970-01-01' \\",
          "235:    --transform \"s,^,$dep_prefix_dir,\" 2> /tmp/pack.err | \\",
          "236:     gzip -n - > $tar_path ; E=$?; } || true",
          "237:   if [[ ! -e $tar_path || -z $(tar tzf $tar_path) ]]; then",
          "238:    eprint \"Count not create $tar_path. Aborting.\"",
          "239:    rm -f $tar_path",
          "240:    exit 1",
          "241:   fi",
          "242:  else",
          "243:   runn @ <<-EOF",
          "244:    cd $depdir",
          "245:    cat $ARTDIR/$dep.files | \\",
          "246:    xargs tar -c --sort=name --owner=root:0 --group=root:0 --mtime='UTC 1970-01-01' \\",
          "247:     --transform \"s,^,$dep_prefix_dir,\" 2> /tmp/pack.err | \\",
          "248:    gzip -n - > $tar_path ; E=$?; } || true",
          "249:    EOF",
          "252:   sha256sum $tar_path | gawk '{print $1}' > $tar_path.sha256",
          "255:  mkdir -p $ARTDIR/snapshots",
          "258:   local snap_package=$stem.${BRANCH}${VARIANT}.tgz",
          "259:   runn ln -sf ../$fq_package $snap_package",
          "260:   runn ln -sf ../$fq_package.sha256 $snap_package.sha256",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "209: #----------------------------------------------------------------------------------------------",
          "223: NUMVER=\"$(NUMERIC=1 $SBIN/getver)\"",
          "224: SEMVER=\"$($SBIN/getver)\"",
          "",
          "[Removed Lines]",
          "211: prepare_symbols_dep() {",
          "212:  if [[ ! -f $MODULE.debug ]]; then return 0; fi",
          "213:  echo \"# Preparing debug symbols dependencies ...\"",
          "214:  echo $(cd \"$(dirname $MODULE)\" && pwd) > $ARTDIR/debug.dir",
          "215:  echo $(basename $MODULE.debug) > $ARTDIR/debug.files",
          "216:  echo \"\" > $ARTDIR/debug.prefix",
          "217:  pack_deps debug",
          "218:  echo \"# Done.\"",
          "219: }",
          "221: #----------------------------------------------------------------------------------------------",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "233: #----------------------------------------------------------------------------------------------",
          "235: if [[ -z $BRANCH ]]; then",
          "236:  BRANCH=$(git rev-parse --abbrev-ref HEAD)",
          "237:  # this happens of detached HEAD",
          "238:  if [[ $BRANCH == HEAD ]]; then",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "280: git_config_add_ifnx() {",
          "281:  local key=\"$1\"",
          "282:  local val=\"$2\"",
          "283:  if [[ -z $(git config --global --get $key $val) ]]; then",
          "284:   git config --global --add $key $val",
          "285:  fi",
          "286: }",
          "289:  git_config_add_ifnx safe.directory $ROOT",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "241: fi",
          "242: BRANCH=${BRANCH//[^A-Za-z0-9._-]/_}",
          "243: if [[ $WITH_GITSHA == 1 ]]; then",
          "244:  GIT_COMMIT=$(git rev-parse --short HEAD)",
          "245:  BRANCH=\"${BRANCH}-${GIT_COMMIT}\"",
          "246: fi",
          "249: #----------------------------------------------------------------------------------------------",
          "251: if [[ $JUST_PRINT == 1 ]]; then",
          "252:  if [[ $RAMP == 1 ]]; then",
          "254:  fi",
          "255:  if [[ $DEPS == 1 ]]; then",
          "259:  fi",
          "260:  exit 0",
          "261: fi",
          "",
          "[Removed Lines]",
          "247: export BRANCH",
          "253:   echo \"${PACKAGE_NAME}.${OS}-${OSNICK}-${ARCH}.${SEMVER}${VARIANT}.zip\"",
          "256:   for dep in $DEP_NAMES; do",
          "257:    echo \"${PACKAGE_NAME}.${dep}.${OS}-${OSNICK}-${ARCH}.${SEMVER}${VARIANT}.tgz\"",
          "258:   done",
          "",
          "[Added Lines]",
          "298:  git_config_add_ifnx safe.directory $ROOT",
          "303: #----------------------------------------------------------------------------------------------",
          "305: RELEASE_ramp=${PACKAGE_NAME}.$OS-$OSNICK-$ARCH.$SEMVER${VARIANT}.zip",
          "306: SNAPSHOT_ramp=${PACKAGE_NAME}.$OS-$OSNICK-$ARCH.${BRANCH}${VARIANT}.zip",
          "308: RELEASE_deps=",
          "309: SNAPSHOT_deps=",
          "310: for dep in $DEP_NAMES; do",
          "311:  RELEASE_deps+=\" ${PACKAGE_NAME}.${dep}.$OS-$OSNICK-$ARCH.$SEMVER${VARIANT}.tgz\"",
          "312:  SNAPSHOT_deps+=\" ${PACKAGE_NAME}.${dep}.$OS-$OSNICK-$ARCH.${BRANCH}${VARIANT}.tgz\"",
          "313: done",
          "319:   [[ $RELEASE == 1 ]] && echo $RELEASE_ramp",
          "320:   [[ $SNAPSHOT == 1 ]] && echo $SNAPSHOT_ramp",
          "323:   [[ $RELEASE == 1 ]] && echo $RELEASE_deps",
          "324:   [[ $SNAPSHOT == 1 ]] && echo $SNAPSHOT_deps",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "265: mkdir -p $ARTDIR",
          "272:  for dep in $DEP_NAMES; do",
          "275:  done",
          "276:  echo \"# Done.\"",
          "277: fi",
          "",
          "[Removed Lines]",
          "267: if [[ $DEPS == 1 ]]; then",
          "268:  echo \"# Building dependencies ...\"",
          "270:  [[ $SYM == 1 ]] && prepare_symbols_dep",
          "273:   echo \"# $dep ...\"",
          "274:   pack_deps $dep",
          "",
          "[Added Lines]",
          "333: if [[ $DEPS == 1 && -n $DEP_NAMES ]]; then",
          "334:  # set up `debug` dep",
          "335:  dirname \"$(realpath \"$MODULE\")\" > \"$ARTDIR/debug.dir\"",
          "336:  echo \"$(basename \"$(realpath \"$MODULE\")\").debug\" > \"$ARTDIR/debug.files\"",
          "337:  echo \"\" > $ARTDIR/debug.prefix",
          "339:  echo \"# Building dependencies ...\"",
          "342:   if [[ $OS != macos ]]; then",
          "343:    echo \"# $dep ...\"",
          "344:    pack_deps $dep",
          "345:   fi",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "287:  fi",
          "289:  echo \"# Building RAMP $RAMP_VARIANT files ...\"",
          "291:  echo \"# Done.\"",
          "292: fi",
          "",
          "[Removed Lines]",
          "290:  pack_ramp",
          "",
          "[Added Lines]",
          "362:  [[ -z $MODULE ]] && { eprint \"Nothing to pack. Aborting.\"; exit 1; }",
          "363:  [[ ! -f $MODULE ]] && { eprint \"$MODULE does not exist. Aborting.\"; exit 1; }",
          "364:  MODULE=$(realpath $MODULE)",
          "366:  [[ $RELEASE == 1 ]] && SNAPSHOT=0 pack_ramp",
          "367:  [[ $SNAPSHOT == 1 ]] && pack_ramp",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "1b35f8811e1ba0f986c10452aeccc86f2aafe217",
      "candidate_info": {
        "commit_hash": "1b35f8811e1ba0f986c10452aeccc86f2aafe217",
        "repo": "RedisBloom/RedisBloom",
        "commit_url": "https://github.com/RedisBloom/RedisBloom/commit/1b35f8811e1ba0f986c10452aeccc86f2aafe217",
        "files": [
          ".github/actions/build-module-and-redis/action.yml",
          ".github/actions/pack-module/action.yml",
          ".github/actions/run-tests/action.yml",
          ".github/actions/setup-env/action.yml",
          ".github/actions/upload-artifacts-to-s3/action.yml",
          ".github/actions/upload-artifacts/action.yml",
          ".github/workflows/build-linux-platforms.yml",
          ".github/workflows/build-macos.yml",
          ".github/workflows/build.yml",
          ".github/workflows/ci-full.yml",
          ".github/workflows/codeql-analysis.yml",
          ".github/workflows/event-ci.yml",
          ".github/workflows/event-nightly.yml",
          ".github/workflows/event-tag.yml",
          ".github/workflows/flow-alpine.yml",
          ".github/workflows/flow-linter.yml",
          ".github/workflows/flow-linux-x86.yml",
          ".github/workflows/flow-macos.yml",
          ".github/workflows/flow-spellcheck.yml",
          ".github/workflows/flow-ubuntu-arm.yml",
          ".github/workflows/mariner2.yml",
          ".github/workflows/sanitizer.yml",
          ".github/workflows/trigger-build.yml",
          ".install/alpine.sh",
          ".install/amazon_linux_2.sh",
          ".install/build_package_requirements.txt",
          ".install/common_base_linux_mariner_2.0.sh",
          ".install/common_installations.sh",
          ".install/debian_gnu_linux_11.sh",
          ".install/install_cmake.sh",
          ".install/install_script.sh",
          ".install/macos.sh",
          ".install/rocky_linux_8.sh",
          ".install/rocky_linux_9.sh",
          ".install/ubuntu_18.04.sh",
          ".install/ubuntu_20.04.sh",
          ".install/ubuntu_22.04.sh",
          "deps/readies",
          "sbin/getver",
          "sbin/upload-artifacts",
          "tests/flow/requirements.txt",
          "tests/flow/test_overall.py",
          "tests/flow/test_topk.py",
          "tests/flow/tests.sh"
        ],
        "message": "MOD-8197 Unified CI workflows (#830)\n\n* MOD-8197 Unified CI workflows (#826)\n\n- Updated and added new GitHub Actions workflows for build, test, and deployment\n- Introduced event-based workflows for specific triggers:\n    - `event-ci.yml`: Runs CI checks on pull requests and pushes to specific branches\n    - `event-nightly.yml`: Executes nightly builds and tests\n    - `event-tag.yml`: Triggers workflows on new tags for release processes\n- Differentiated flow-based workflows for various environments:\n    - `flow-alpine.yml`: Handles builds and tests for Alpine Linux\n    - `flow-linux-x86.yml`: Manages workflows for x86 Linux distributions\n    - `flow-macos.yml`: Manages workflows for macOS environments\n    - `flow-ubuntu-arm.yml`: Handles builds and tests for Ubuntu on ARM architecture\n- Removed obsolete workflows\n- Added new installation scripts for various Linux distributions and macOS\n- Modified existing scripts and configurations for better compatibility and performance\n- Update GitHub Actions to use checkout@v4 and streamline Redis checkout process\n\n(cherry picked from commit 17c8fc3ba0b2609f3873439f0f7f48749a4dea92)\n\n* git submodule update after git checkout on CI\n\n(cherry picked from commit 5ed11604f32ba969025ac7133b0062620137ceef)\n\n* change redis version to 7.2\n\n* remove --depth=1 from redis checkout on CI\n\n(cherry picked from commit 396c70f81c656ab176b38fe1dbb175f10d995069)\n\n* change redis versio  to 7.2\n\n* fix test_scandump_load_big\n\n* add --enable-debug-command\n\n* remove old workflows\n\n* fix\n\n* fix test_no_init_params\n\n* update readies\n\n* Patch the pack.sh to work with mktemp in busybox\n\n(cherry picked from commit 230413a80ef69c54bf1d584589b1b9babc1a40fc)\n\n---------\n\nCo-authored-by: Victor Polevoy <fx@thefx.co>",
        "before_after_code_files": [
          ".install/alpine.sh||.install/alpine.sh",
          ".install/amazon_linux_2.sh||.install/amazon_linux_2.sh",
          ".install/common_base_linux_mariner_2.0.sh||.install/common_base_linux_mariner_2.0.sh",
          ".install/common_installations.sh||.install/common_installations.sh",
          ".install/debian_gnu_linux_11.sh||.install/debian_gnu_linux_11.sh",
          ".install/install_cmake.sh||.install/install_cmake.sh",
          ".install/install_script.sh||.install/install_script.sh",
          ".install/macos.sh||.install/macos.sh",
          ".install/rocky_linux_8.sh||.install/rocky_linux_8.sh",
          ".install/rocky_linux_9.sh||.install/rocky_linux_9.sh",
          ".install/ubuntu_18.04.sh||.install/ubuntu_18.04.sh",
          ".install/ubuntu_20.04.sh||.install/ubuntu_20.04.sh",
          ".install/ubuntu_22.04.sh||.install/ubuntu_22.04.sh",
          "tests/flow/test_overall.py||tests/flow/test_overall.py",
          "tests/flow/test_topk.py||tests/flow/test_topk.py",
          "tests/flow/tests.sh||tests/flow/tests.sh"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/RedisBloom/RedisBloom/pull/859"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        ".install/alpine.sh||.install/alpine.sh": [
          "File: .install/alpine.sh -> .install/alpine.sh",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: apk add bash make libtool tar cmake python3 python3-dev py3-pip gcc git curl build-base autoconf automake py3-cryptography linux-headers musl-dev libffi-dev openssl-dev openssh py-virtualenv clang18-libclang gcompat libstdc++ libgcc g++ openblas-dev xsimd git xz bsd-compat-headers clang18",
          "2: pip install -q --upgrade pip setuptools wheel",
          "",
          "---------------"
        ],
        ".install/amazon_linux_2.sh||.install/amazon_linux_2.sh": [
          "File: .install/amazon_linux_2.sh -> .install/amazon_linux_2.sh",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: #!/bin/bash",
          "2: MODE=$1 # whether to install using sudo or not",
          "3: set -e",
          "4: export DEBIAN_FRONTEND=noninteractive",
          "5: echo \"::group::Install dependencies\"",
          "6: $MODE yum update -y",
          "7: # Install the RPM package that provides the Software Collections (SCL) required for devtoolset-11",
          "8: $MODE yum install -y https://vault.centos.org/centos/7/extras/x86_64/Packages/centos-release-scl-rh-2-3.el7.centos.noarch.rpm",
          "10: # http://mirror.centos.org/centos/7/ is deprecated, so we changed the above link to `https://vault.centos.org`,",
          "11: # and we have to change the baseurl in the repo file to the working mirror (from mirror.centos.org to vault.centos.org)",
          "12: $MODE sed -i 's/mirrorlist=/#mirrorlist=/g' /etc/yum.repos.d/CentOS-SCLo-scl-rh.repo                        # Disable mirrorlist",
          "13: $MODE sed -i 's/#baseurl=http:\\/\\/mirror/baseurl=http:\\/\\/vault/g' /etc/yum.repos.d/CentOS-SCLo-scl-rh.repo # Enable a working baseurl",
          "15: $MODE yum install -y wget git which devtoolset-11-gcc devtoolset-11-gcc-c++ devtoolset-11-make \\",
          "16:   rsync python3 unzip tar python3-devel python3-pip awscli libffi-devel",
          "18: source /opt/rh/devtoolset-11/enable",
          "20: cp /opt/rh/devtoolset-11/enable /etc/profile.d/scl-devtoolset-11.sh",
          "22: $MODE yum install -y curl",
          "23: $MODE yum install -y openssl11 openssl11-devel",
          "24: $MODE ln -s `which openssl11` /usr/bin/openssl",
          "26: # Install clang",
          "27: $MODE yum install -y clang",
          "28: echo \"::endgroup::\"",
          "30: make --version",
          "31: git --version",
          "33: echo \"::group::install Python 3.9.6\"",
          "34: wget https://www.python.org/ftp/python/3.9.6/Python-3.9.6.tgz",
          "35: tar -xvf Python-3.9.6.tgz",
          "36: cd Python-3.9.6",
          "37: ./configure",
          "38: make -j `nproc`",
          "39: make altinstall",
          "40: cd ..",
          "41: rm /usr/bin/python3 && ln -s `which python3.9` /usr/bin/python3",
          "42: python3 --version",
          "43: echo \"::endgroup::\"",
          "45: echo \"::group::install awscli\"",
          "46: curl \"https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip\" -o \"awscliv2.zip\"",
          "47: unzip awscliv2.zip",
          "48: ./aws/install",
          "49: echo \"::endgroup::\"",
          "51: echo \"::group::install cmake\"",
          "52: version=3.25.1",
          "53: filename=cmake-${version}-linux-x86_64.sh",
          "54: wget https://github.com/Kitware/CMake/releases/download/v${version}/${filename}",
          "55: chmod u+x ./${filename}",
          "56: $MODE ./${filename} --skip-license --prefix=/usr/local --exclude-subdir",
          "57: cmake --version",
          "58: echo \"::endgroup::\"",
          "",
          "---------------"
        ],
        ".install/common_base_linux_mariner_2.0.sh||.install/common_base_linux_mariner_2.0.sh": [
          "File: .install/common_base_linux_mariner_2.0.sh -> .install/common_base_linux_mariner_2.0.sh",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: #!/bin/bash",
          "3: tdnf install -y build-essential wget tar openssl-devel cmake python3 python3-pip which unzip",
          "4: git config --global --add safe.directory $PWD",
          "6: pip install --upgrade setuptools",
          "7: pip install -r tests/flow/requirements.txt",
          "9: pip install -r .install/build_package_requirements.txt  # required for packing the module (todo: move to pack.sh after refactor)",
          "11: # Install aws-cli for uploading artifacts to s3",
          "12: curl \"https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip\" -o \"awscliv2.zip\"",
          "13: unzip awscliv2.zip",
          "14: ./aws/install",
          "",
          "---------------"
        ],
        ".install/common_installations.sh||.install/common_installations.sh": [
          "File: .install/common_installations.sh -> .install/common_installations.sh",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: #!/bin/bash",
          "2: set -e",
          "3: OS_TYPE=$(uname -s)",
          "4: MODE=$1 # whether to install using sudo or not",
          "6: pip3 install --upgrade pip",
          "7: pip3 install -q --upgrade setuptools",
          "8: echo \"pip version: $(pip3 --version)\"",
          "9: echo \"pip path: $(which pip3)\"",
          "11: pip3 install -q -r tests/flow/requirements.txt",
          "12: # These packages are needed to build the package",
          "13: pip3 install -q -r .install/build_package_requirements.txt",
          "15: # List installed packages",
          "16: pip3 list",
          "",
          "---------------"
        ],
        ".install/debian_gnu_linux_11.sh||.install/debian_gnu_linux_11.sh": [
          "File: .install/debian_gnu_linux_11.sh -> .install/debian_gnu_linux_11.sh",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: #!/bin/bash",
          "2: set -e",
          "3: export DEBIAN_FRONTEND=noninteractive",
          "4: MODE=$1 # whether to install using sudo or not",
          "6: $MODE apt update -qq",
          "7: $MODE apt upgrade -yqq",
          "8: $MODE apt-get install -y build-essential make cmake autoconf automake libtool lcov git wget zlib1g-dev lsb-release libssl-dev openssl ca-certificates python3 python3-pip python3-venv curl unzip rsync libclang-dev clang",
          "",
          "---------------"
        ],
        ".install/install_cmake.sh||.install/install_cmake.sh": [
          "File: .install/install_cmake.sh -> .install/install_cmake.sh",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: #!/bin/bash",
          "2: version=3.25.1",
          "3: processor=$(uname -m)",
          "4: OS_TYPE=$(uname -s)",
          "5: MODE=$1 # whether to install using sudo or not",
          "7: if [[ $OS_TYPE = 'Darwin' ]]",
          "8: then",
          "9:     brew install cmake",
          "10: else",
          "11:     if [[ $processor = 'x86_64' ]]",
          "12:     then",
          "13:         filename=cmake-${version}-linux-x86_64.sh",
          "14:     else",
          "15:         filename=cmake-${version}-linux-aarch64.sh",
          "16:     fi",
          "18:     wget https://github.com/Kitware/CMake/releases/download/v${version}/${filename}",
          "19:     chmod u+x ./${filename}",
          "20:     $MODE ./${filename} --skip-license --prefix=/usr/local --exclude-subdir",
          "21:     cmake --version",
          "22: fi",
          "",
          "---------------"
        ],
        ".install/install_script.sh||.install/install_script.sh": [
          "File: .install/install_script.sh -> .install/install_script.sh",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: #!/bin/bash",
          "3: OS_TYPE=$(uname -s)",
          "4: MODE=$1 # whether to install using sudo or not",
          "6: if [[ $OS_TYPE = 'Darwin' ]]",
          "7: then",
          "8:     OS='macos'",
          "9: else",
          "10:     VERSION=$(grep '^VERSION_ID=' /etc/os-release | sed 's/\"//g')",
          "11:     VERSION=${VERSION#\"VERSION_ID=\"}",
          "12:     OS_NAME=$(grep '^NAME=' /etc/os-release | sed 's/\"//g')",
          "13:     OS_NAME=${OS_NAME#\"NAME=\"}",
          "14:     [[ $OS_NAME == 'Rocky Linux' ]] && VERSION=${VERSION%.*} # remove minor version for Rocky Linux",
          "15:     OS=${OS_NAME,,}_${VERSION}",
          "16:     OS=$(echo $OS | sed 's/[/ ]/_/g') # replace spaces and slashes with underscores",
          "17: fi",
          "18: echo $OS",
          "20: source ${OS}.sh $MODE",
          "22: git config --global --add safe.directory '*'",
          "",
          "---------------"
        ],
        ".install/macos.sh||.install/macos.sh": [
          "File: .install/macos.sh -> .install/macos.sh",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: #!/bin/bash",
          "3: if ! which brew &> /dev/null; then",
          "4:     echo \"Brew is not installed. Install from https://brew.sh\"",
          "5:     exit 1",
          "6: fi",
          "8: export HOMEBREW_NO_AUTO_UPDATE=1",
          "10: LLVM_VERSION=\"18\"",
          "12: brew update",
          "13: brew install coreutils",
          "14: brew install make",
          "15: brew install openssl",
          "16: brew install llvm@$LLVM_VERSION",
          "18: BREW_PREFIX=$(brew --prefix)",
          "19: GNUBIN=$BREW_PREFIX/opt/make/libexec/gnubin",
          "20: LLVM=\"$BREW_PREFIX/opt/llvm@$LLVM_VERSION/bin\"",
          "21: COREUTILS=$BREW_PREFIX/opt/coreutils/libexec/gnubin",
          "23: update_profile() {",
          "24:     local profile_path=$1",
          "25:     local newpath=\"export PATH=$COREUTILS:$LLVM:$GNUBIN:\\$PATH\"",
          "26:     grep -qxF \"$newpath\" \"$profile_path\" || echo \"$newpath\" >> \"$profile_path\"",
          "27:     echo $newpath",
          "28:     source $profile_path",
          "29:     echo \"export PATH=$COREUTILS:$LLVM:$GNUBIN:\\$PATH\" >> $GITHUB_PATH",
          "30: }",
          "32: [[ -f ~/.bash_profile ]] && update_profile ~/.bash_profile",
          "33: [[ -f ~/.zshrc ]] && update_profile ~/.zshrc",
          "",
          "---------------"
        ],
        ".install/rocky_linux_8.sh||.install/rocky_linux_8.sh": [
          "File: .install/rocky_linux_8.sh -> .install/rocky_linux_8.sh",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: #!/bin/bash",
          "2: yum -y install epel-release",
          "3: yum -y install gcc make cmake3 git openssl-devel bzip2-devel libffi-devel zlib-devel wget scl-utils which gcc-toolset-11-gcc gcc-toolset-11-gcc-c++ gcc-toolset-11-libatomic-devel",
          "4: yum groupinstall \"Development Tools\" -y",
          "5: cp /opt/rh/gcc-toolset-11/enable /etc/profile.d/gcc-toolset-11.sh",
          "7: make --version",
          "8: gcc --version",
          "9: git --version",
          "11: wget https://www.python.org/ftp/python/3.9.6/Python-3.9.6.tgz",
          "12: tar -xvf Python-3.9.6.tgz",
          "13: cd Python-3.9.6",
          "14: ./configure",
          "15: make -j `nproc`",
          "16: make altinstall",
          "17: cd ..",
          "18: rm /usr/bin/python3 && ln -s `which python3.9` /usr/bin/python3",
          "19: cmake --version",
          "20: python3 --version",
          "21: curl \"https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip\" -o \"awscliv2.zip\"",
          "22: unzip awscliv2.zip",
          "23: ./aws/install",
          "",
          "---------------"
        ],
        ".install/rocky_linux_9.sh||.install/rocky_linux_9.sh": [
          "File: .install/rocky_linux_9.sh -> .install/rocky_linux_9.sh",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: #!/bin/bash",
          "2: yum -y install epel-release",
          "3: yum -y install gcc make cmake3 wget openssl-devel bzip2-devel libffi-devel zlib-devel wget scl-utils which gcc-toolset-13-gcc gcc-toolset-13-gcc-c++ gcc-toolset-13-libatomic-devel",
          "4: yum groupinstall \"Development Tools\" -y",
          "5: cp /opt/rh/gcc-toolset-13/enable /etc/profile.d/gcc-toolset-13.sh",
          "7: make --version",
          "8: gcc --version",
          "9: git --version",
          "11: wget https://www.python.org/ftp/python/3.9.6/Python-3.9.6.tgz",
          "12: tar -xvf Python-3.9.6.tgz",
          "13: cd Python-3.9.6",
          "14: ./configure",
          "15: make -j `nproc`",
          "16: make altinstall",
          "17: cd ..",
          "18: rm /usr/bin/python3 && ln -s `which python3.9` /usr/bin/python3",
          "19: cmake --version",
          "20: python3 --version",
          "21: curl \"https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip\" -o \"awscliv2.zip\"",
          "22: unzip awscliv2.zip",
          "23: ./aws/install",
          "",
          "---------------"
        ],
        ".install/ubuntu_18.04.sh||.install/ubuntu_18.04.sh": [
          "File: .install/ubuntu_18.04.sh -> .install/ubuntu_18.04.sh",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: #!/bin/bash",
          "2: set -e",
          "3: export DEBIAN_FRONTEND=noninteractive",
          "4: MODE=$1 # whether to install using sudo or not",
          "6: $MODE apt update -qq",
          "7: $MODE apt upgrade -yqq",
          "9: add-apt-repository ppa:ubuntu-toolchain-r/test -y",
          "10: apt update",
          "11: apt-get install -y build-essential make autoconf automake libtool lcov git wget zlib1g-dev lsb-release libssl-dev openssl ca-certificates curl unzip gcc-10 g++-10 binfmt-support lsb-core awscli libclang-dev clang libffi-dev",
          "12: update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-10 60 --slave /usr/bin/g++ g++ /usr/bin/g++-10",
          "14: wget https://cmake.org/files/v3.28/cmake-3.28.0.tar.gz",
          "15: tar -xzvf cmake-3.28.0.tar.gz",
          "16: cd cmake-3.28.0",
          "17: ./configure",
          "18: make -j `nproc`",
          "19: make install",
          "20: cd ..",
          "21: ln -s /usr/local/bin/cmake /usr/bin/cmake",
          "22: wget https://www.python.org/ftp/python/3.9.6/Python-3.9.6.tgz",
          "23: tar -xvf Python-3.9.6.tgz",
          "24: cd Python-3.9.6",
          "25: ./configure",
          "26: make -j `nproc`",
          "27: make altinstall",
          "28: cd ..",
          "29: rm /usr/bin/python3 && ln -s `which python3.9` /usr/bin/python3",
          "30: rm /usr/bin/lsb_release",
          "31: python3 --version",
          "32: make --version",
          "33: cmake --version",
          "34: python3 -m pip install --upgrade pip",
          "",
          "---------------"
        ],
        ".install/ubuntu_20.04.sh||.install/ubuntu_20.04.sh": [
          "File: .install/ubuntu_20.04.sh -> .install/ubuntu_20.04.sh",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: #!/bin/bash",
          "2: set -e",
          "3: export DEBIAN_FRONTEND=noninteractive",
          "4: MODE=$1 # whether to install using sudo or not",
          "6: $MODE apt update -qq",
          "7: $MODE apt upgrade -yqq",
          "9: apt-get install -y build-essential make autoconf automake libtool lcov git wget zlib1g-dev lsb-release libssl-dev openssl ca-certificates curl unzip libffi-dev",
          "10: wget https://cmake.org/files/v3.28/cmake-3.28.0.tar.gz",
          "11: tar -xzvf cmake-3.28.0.tar.gz",
          "12: cd cmake-3.28.0",
          "13: ./configure",
          "14: make -j `nproc`",
          "15: make install",
          "16: cd ..",
          "17: ln -s /usr/local/bin/cmake /usr/bin/cmake",
          "18: wget https://www.python.org/ftp/python/3.9.6/Python-3.9.6.tgz",
          "19: tar -xvf Python-3.9.6.tgz",
          "20: cd Python-3.9.6",
          "21: ./configure",
          "22: make -j `nproc`",
          "23: make altinstall",
          "24: cd ..",
          "25: rm /usr/bin/python3 && ln -s `which python3.9` /usr/bin/python3",
          "26: rm /usr/bin/lsb_release",
          "27: python3 --version",
          "28: make --version",
          "29: cmake --version",
          "30: python3 -m pip install --upgrade pip",
          "",
          "---------------"
        ],
        ".install/ubuntu_22.04.sh||.install/ubuntu_22.04.sh": [
          "File: .install/ubuntu_22.04.sh -> .install/ubuntu_22.04.sh",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: #!/bin/bash",
          "2: set -e",
          "3: export DEBIAN_FRONTEND=noninteractive",
          "4: MODE=$1 # whether to install using sudo or not",
          "6: $MODE apt update -qq",
          "7: $MODE apt upgrade -yqq",
          "8: $MODE apt install -yqq git wget build-essential lcov openssl libssl-dev \\",
          "9:   python3 python3-pip python3-venv python3-dev unzip rsync libclang-dev clang curl \\",
          "10:   autoconf automake libtool cmake lcov valgrind",
          "",
          "---------------"
        ],
        "tests/flow/test_overall.py||tests/flow/test_overall.py": [
          "File: tests/flow/test_overall.py -> tests/flow/test_overall.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "756:                 env.cmd('bf.loadchunk', 'bf', random.randint(0, size), bytes(b))",
          "757:             except Exception as e:",
          "758:                 if (str(e) != \"invalid offset - no link found\" and",
          "760:                     raise e",
          "",
          "[Removed Lines]",
          "759:                         str(e) != \"received bad data\"):",
          "",
          "[Added Lines]",
          "759:                         str(e) != \"received bad data\" and str(e) != \"invalid chunk - Too big for current filter\"):",
          "",
          "---------------"
        ],
        "tests/flow/test_topk.py||tests/flow/test_topk.py": [
          "File: tests/flow/test_topk.py -> tests/flow/test_topk.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "160:     def test_no_init_params(self):",
          "161:         self.cmd('FLUSHALL')",
          "162:         self.cmd('topk.reserve', 'topk', '3')",
          "166:         heapList = self.cmd('topk.list', 'topk')",
          "167:         self.assertEqual(['foo', 'baz', 'bar'], heapList)",
          "",
          "[Removed Lines]",
          "163:         self.cmd('topk.add', 'topk', 'foo', 'bar', 'baz', '42', 'foo', 'bar', 'baz', )",
          "164:         self.cmd('topk.add', 'topk', 'foo', 'baz', '42', 'foo', 'baz', )",
          "165:         self.cmd('topk.add', 'topk', 'foo', 'bar', 'baz', 'foo', 'baz', )",
          "",
          "[Added Lines]",
          "163:         self.cmd('topk.add', 'topk', 'foo', 'bar', 'baz', '42', 'foo', 'bar', 'baz', 'foo', 'foo', 'foo', 'foo')",
          "164:         self.cmd('topk.add', 'topk', 'foo', 'baz', '42', 'foo', 'baz', 'foo', 'foo', 'foo', 'foo', 'foo')",
          "165:         self.cmd('topk.add', 'topk', 'foo', 'bar', 'baz', 'foo', 'baz', 'baz', 'baz', 'baz')",
          "",
          "---------------"
        ],
        "tests/flow/tests.sh||tests/flow/tests.sh": [
          "File: tests/flow/tests.sh -> tests/flow/tests.sh",
          "--- Hunk 1 ---",
          "[Context before]",
          "549:  { (run_tests \"general\"); (( E |= $? )); } || true",
          "550: fi",
          "551: if [[ $VG != 1 && $SLAVES == 1 ]]; then",
          "553: fi",
          "554: if [[ $AOF == 1 ]]; then",
          "556: fi",
          "557: if [[ $CLUSTER == 1 ]]; then",
          "559: fi",
          "561: #-------------------------------------------------------------------------------------- Summary",
          "",
          "[Removed Lines]",
          "552:  { (RLTEST_ARGS+=\" --use-slaves\" run_tests \"--use-slaves\"); (( E |= $? )); } || true",
          "555:  { (RLTEST_ARGS+=\" --use-aof\" run_tests \"--use-aof\"); (( E |= $? )); } || true",
          "558:  { (RLTEST_ARGS+=\" --env oss-cluster --shards-count 1\" run_tests \"--env oss-cluster\"); (( E |= $? )); } || true",
          "",
          "[Added Lines]",
          "552:  { (RLTEST_ARGS+=\" --use-slaves --enable-debug-command\" run_tests \"--use-slaves\"); (( E |= $? )); } || true",
          "555:  { (RLTEST_ARGS+=\" --use-aof --enable-debug-command\" run_tests \"--use-aof\"); (( E |= $? )); } || true",
          "558:  { (RLTEST_ARGS+=\" --env oss-cluster --shards-count 1 --enable-debug-command\" run_tests \"--env oss-cluster\"); (( E |= $? )); } || true",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "7f8e2b6f490d6f464ebf969a6036ffff889f948b",
      "candidate_info": {
        "commit_hash": "7f8e2b6f490d6f464ebf969a6036ffff889f948b",
        "repo": "RedisBloom/RedisBloom",
        "commit_url": "https://github.com/RedisBloom/RedisBloom/commit/7f8e2b6f490d6f464ebf969a6036ffff889f948b",
        "files": [
          "src/rm_cms.c",
          "tests/flow/test_cms.py"
        ],
        "message": "Fix potential crash on cms.merge (#1)\n\nFix potential crash due to missing validation for number of keys argument on cms.merge\n\nTo reproduce:\n```\nCMS.INITBYPROB c1 0.001 0.01\nCMS.MERGE c1 -1 c1\n```\n\nNegative argument makes an alloc size calculation negative. This negative number overflows and becomes a huge number when it is passed to `RM_Calloc()`. It triggers OOM panic.\n\n```\n2024-04-22 11:10:25 === REDIS BUG REPORT START: Cut & paste starting from here ===\n2024-04-22 11:10:25 9:M 22 Apr 2024 08:10:25.489 # ------------------------------------------------\n2024-04-22 11:10:25 9:M 22 Apr 2024 08:10:25.489 # !!! Software Failure. Press left mouse button to continue\n2024-04-22 11:10:25 9:M 22 Apr 2024 08:10:25.489 # Guru Meditation: Redis aborting for OUT OF MEMORY. Allocating 16033030816760063908 bytes! #server.c:6835\n2024-04-22 11:10:25\n2024-04-22 11:10:25 ------ STACK TRACE ------\n2024-04-22 11:10:25\n2024-04-22 11:10:25 Backtrace:\n2024-04-22 11:10:25 /opt/redis-stack/bin/redis-server *:6379(redisOutOfMemoryHandler+0x36)[0x558b0662a1b6]\n2024-04-22 11:10:25 /opt/redis-stack/bin/redis-server *:6379(RM_Calloc+0x74)[0x558b066f8e54]\n2024-04-22 11:10:25 /opt/redis-stack/lib/redisbloom.so(NewCMSketch+0x68)[0x7fe2cfa28ab8]\n2024-04-22 11:10:25 /opt/redis-stack/lib/redisbloom.so(CMSketch_Create+0x166)[0x7fe2cfa28596]\n2024-04-22 11:10:25 /opt/redis-stack/bin/redis-server *:6379(RedisModuleCommandDispatcher+0xae)[0x558b066f9c0e]\n2024-04-22 11:10:25 /opt/redis-stack/bin/redis-server *:6379(call+0x186)[0x558b06618226]\n2024-04-22 11:10:25 /opt/redis-stack/bin/redis-server *:6379(processCommand+0xba9)[0x558b06619559]\n2024-04-22 11:10:25 /opt/redis-stack/bin/redis-server *:6379(processInputBuffer+0x107)[0x558b0663e387]\n2024-04-22 11:10:25 /opt/redis-stack/bin/redis-server *:6379(readQueryFromClient+0x368)[0x558b0663e908]\n2024-04-22 11:10:25 /opt/redis-stack/bin/redis-server *:6379(+0x1c9b9c)[0x558b06747b9c]\n2024-04-22 11:10:25 /opt/redis-stack/bin/redis-server *:6379(aeMain+0xf9)[0x558b0660ddd9]\n2024-04-22 11:10:25 /opt/redis-stack/bin/redis-server *:6379(main+0x3df)[0x558b0660263f]\n2024-04-22 11:10:25 /lib/x86_64-linux-gnu/libc.so.6(+0x29d90)[0x7fe2d205dd90]\n2024-04-22 11:10:25 /lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0x80)[0x7fe2d205de40]\n2024-04-22 11:10:25 /opt/redis-stack/bin/redis-server *:6379(_start+0x25)[0x558b06602e05]\n```\n\n(cherry picked from commit 63ea526914ec1edba874572905e4452f0e87330a)",
        "before_after_code_files": [
          "src/rm_cms.c||src/rm_cms.c",
          "tests/flow/test_cms.py||tests/flow/test_cms.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/RedisBloom/RedisBloom/pull/859"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/rm_cms.c||src/rm_cms.c": [
          "File: src/rm_cms.c -> src/rm_cms.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "184: static int parseMergeArgs(RedisModuleCtx *ctx, RedisModuleString **argv, int argc,",
          "185:                           mergeParams *params) {",
          "186:     long long numKeys = params->numKeys;",
          "187:     int pos = RMUtil_ArgIndex(\"WEIGHTS\", argv, argc);",
          "188:     if (pos < 0) {",
          "189:         if (numKeys != argc) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "187:     if (numKeys <= 0) {",
          "188:         INNER_ERROR(\"CMS: Number of keys must be positive\");",
          "189:     }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "195:         }",
          "196:     }",
          "198:     size_t width = params->dest->width;",
          "199:     size_t depth = params->dest->depth;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "202:     params->cmsArray = CMS_CALLOC(params->numKeys, sizeof(CMSketch *));",
          "203:     params->weights = CMS_CALLOC(params->numKeys, sizeof(long long));",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "233:         return RedisModule_ReplyWithError(ctx, \"CMS: invalid numkeys\");",
          "234:     }",
          "239:     if (parseMergeArgs(ctx, argv + 3, argc - 3, &params) != REDISMODULE_OK) {",
          "240:         CMS_FREE(params.cmsArray);",
          "241:         CMS_FREE(params.weights);",
          "",
          "[Removed Lines]",
          "236:     params.cmsArray = CMS_CALLOC(params.numKeys, sizeof(CMSketch *));",
          "237:     params.weights = CMS_CALLOC(params.numKeys, sizeof(long long));",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "tests/flow/test_cms.py||tests/flow/test_cms.py": [
          "File: tests/flow/test_cms.py -> tests/flow/test_cms.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "163:         self.assertRaises(ResponseError, self.cmd, 'cms.merge', 'foo', 'A', 'foo', 'weights', 1)",
          "164:         self.assertRaises(ResponseError, self.cmd, 'cms.merge', 'foo', 3, 'bar', 'baz' 'weights', 1, 'a')",
          "165:         self.assertRaises(ResponseError, self.cmd, 'cms.merge', 'foo', 3, 'bar', 'baz' 'weights', 1)",
          "167:     def test_merge_extensive(self):",
          "168:         self.cmd('FLUSHALL')",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "166:         self.assertRaises(ResponseError, self.cmd, 'cms.merge', 'foo', '0')",
          "167:         self.assertRaises(ResponseError, self.cmd, 'cms.merge', 'foo', '0', 'weights')",
          "168:         self.assertRaises(ResponseError, self.cmd, 'cms.merge', 'foo', '-1')",
          "169:         self.assertRaises(ResponseError, self.cmd, 'cms.merge', 'foo', '-1', 'foo', 'bar')",
          "170:         self.assertRaises(ResponseError, self.cmd, 'cms.merge', 'foo', '-1', 'foo', 'bar', 'weights', 1, 1)",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "1b188221e8aa40ae6a14b6c854d52c66a1ae71be",
      "candidate_info": {
        "commit_hash": "1b188221e8aa40ae6a14b6c854d52c66a1ae71be",
        "repo": "RedisBloom/RedisBloom",
        "commit_url": "https://github.com/RedisBloom/RedisBloom/commit/1b188221e8aa40ae6a14b6c854d52c66a1ae71be",
        "files": [
          "sbin/pack.sh",
          "sbin/upload-artifacts"
        ],
        "message": "MOD-8436 update upload artifacts script to use Ventura and Sonoma instead catalina and monterey (#833)\n\n(cherry picked from commit 52ed1b8d6bc418fea29ab567d9bd45aa2d16beef)",
        "before_after_code_files": [
          "sbin/pack.sh||sbin/pack.sh"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/RedisBloom/RedisBloom/pull/859"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "sbin/pack.sh||sbin/pack.sh": [
          "File: sbin/pack.sh -> sbin/pack.sh",
          "--- Hunk 1 ---",
          "[Context before]",
          "70: [[ $OSNICK == rocky8 ]]  && OSNICK=rhel8",
          "71: [[ $OSNICK == rocky9 ]]  && OSNICK=rhel9",
          "75: PLATFORM=\"$OS-$OSNICK-$ARCH\"",
          "77: #----------------------------------------------------------------------------------------------",
          "",
          "[Removed Lines]",
          "73: [[ $OSNICK == bigsur ]]  && OSNICK=catalina",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "f609223d508fbb5c8185eaa915a699719f294f58",
      "candidate_info": {
        "commit_hash": "f609223d508fbb5c8185eaa915a699719f294f58",
        "repo": "RedisBloom/RedisBloom",
        "commit_url": "https://github.com/RedisBloom/RedisBloom/commit/f609223d508fbb5c8185eaa915a699719f294f58",
        "files": [
          "src/version.h"
        ],
        "message": "bump version 2.6.11",
        "before_after_code_files": [
          "src/version.h||src/version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/RedisBloom/RedisBloom/pull/859"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/version.h||src/version.h": [
          "File: src/version.h -> src/version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "17: #endif",
          "19: #ifndef REBLOOM_VERSION_PATCH",
          "21: #endif",
          "23: #define REBLOOM_MODULE_VERSION                                                                     \\",
          "",
          "[Removed Lines]",
          "20: #define REBLOOM_VERSION_PATCH 10",
          "",
          "[Added Lines]",
          "20: #define REBLOOM_VERSION_PATCH 11",
          "",
          "---------------"
        ]
      }
    }
  ]
}