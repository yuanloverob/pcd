{
  "cve_id": "CVE-2023-3153",
  "cve_desc": "A flaw was found in Open Virtual Network where the service monitor MAC does not properly rate limit. This issue could allow an attacker to cause a denial of service, including on deployments with CoPP enabled and properly configured.",
  "repo": "ovn-org/ovn",
  "patch_hash": "9a3f7ed905e525ebdcb14541e775211cbb0203bd",
  "patch_info": {
    "commit_hash": "9a3f7ed905e525ebdcb14541e775211cbb0203bd",
    "repo": "ovn-org/ovn",
    "commit_url": "https://github.com/ovn-org/ovn/commit/9a3f7ed905e525ebdcb14541e775211cbb0203bd",
    "files": [
      "lib/copp.c",
      "lib/copp.h",
      "northd/northd.c",
      "ovn-nb.xml",
      "tests/ovn-northd.at",
      "tests/system-ovn.at"
    ],
    "message": "northd, controller: Add CoPP for SVC monitor\n\nThe SVC monitor was exposed without any limitation.\nAdd CoPP for the SVC monitor flow, which adds a way\nfor CMSs to limit the traffic that this flow accepts.\n\nSigned-off-by: Ales Musil <amusil@redhat.com>",
    "before_after_code_files": [
      "lib/copp.c||lib/copp.c",
      "lib/copp.h||lib/copp.h",
      "northd/northd.c||northd/northd.c",
      "tests/ovn-northd.at||tests/ovn-northd.at",
      "tests/system-ovn.at||tests/system-ovn.at"
    ]
  },
  "patch_diff": {
    "lib/copp.c||lib/copp.c": [
      "File: lib/copp.c -> lib/copp.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "38:     [COPP_ND_RA_OPTS]    = \"nd-ra-opts\",",
      "39:     [COPP_TCP_RESET]     = \"tcp-reset\",",
      "40:     [COPP_REJECT]        = \"reject\",",
      "41:     [COPP_BFD]           = \"bfd\",",
      "42: };",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "41:     [COPP_SVC_MONITOR]   = \"svc-monitor\",",
      "",
      "---------------"
    ],
    "lib/copp.h||lib/copp.h": [
      "File: lib/copp.h -> lib/copp.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "37:     COPP_TCP_RESET,",
      "38:     COPP_BFD,",
      "39:     COPP_REJECT,",
      "40:     COPP_PROTO_MAX,",
      "41:     COPP_PROTO_INVALID = COPP_PROTO_MAX,",
      "42: };",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "40:     COPP_SVC_MONITOR,",
      "",
      "---------------"
    ],
    "northd/northd.c||northd/northd.c": [
      "File: northd/northd.c -> northd/northd.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "8924: static void",
      "8925: build_lswitch_destination_lookup_bmcast(struct ovn_datapath *od,",
      "8929: {",
      "8930:     if (od->nbs) {",
      "",
      "[Removed Lines]",
      "8926:                                         struct hmap *lflows,",
      "8927:                                         struct ds *actions,",
      "8928:                                         const struct shash *meter_groups)",
      "",
      "[Added Lines]",
      "8926:                                         struct hmap *lflows,",
      "8927:                                         struct ds *actions,",
      "8928:                                         const struct shash *meter_groups)",
      "8929: {",
      "8930:     if (od->nbs) {",
      "",
      "---------------"
    ],
    "tests/ovn-northd.at||tests/ovn-northd.at": [
      "File: tests/ovn-northd.at -> tests/ovn-northd.at",
      "--- Hunk 1 ---",
      "[Context before]",
      "3545: # let's try to add an usupported protocol \"dhcp\"",
      "3546: AT_CHECK([ovn-nbctl --wait=hv copp-add copp5 dhcp meter1],[1],[],[dnl",
      "3548: ])",
      "3550: #Let's try to add a valid protocol to an unknown datapath",
      "",
      "[Removed Lines]",
      "3547: ovn-nbctl: Invalid control protocol. Allowed values: arp, arp-resolve, dhcpv4-opts, dhcpv6-opts, dns, event-elb, icmp4-error, icmp6-error, igmp, nd-na, nd-ns, nd-ns-resolve, nd-ra-opts, tcp-reset, bfd, reject.",
      "",
      "[Added Lines]",
      "3547: ovn-nbctl: Invalid control protocol. Allowed values: arp, arp-resolve, dhcpv4-opts, dhcpv6-opts, dns, event-elb, icmp4-error, icmp6-error, igmp, nd-na, nd-ns, nd-ns-resolve, nd-ra-opts, tcp-reset, bfd, reject, svc-monitor.",
      "",
      "---------------"
    ],
    "tests/system-ovn.at||tests/system-ovn.at": [
      "File: tests/system-ovn.at -> tests/system-ovn.at",
      "--- Hunk 1 ---",
      "[Context before]",
      "7282: ])",
      "7283: kill $(pidof tcpdump)",
      "7285: kill $(pidof ovn-controller)",
      "7287: as ovn-sb",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "7285: check ovn-nbctl set nb_global . options:svc_monitor_mac=\"33:33:33:33:33:33\"",
      "7286: check ovn-nbctl meter-add svc-meter drop 1 pktps 0",
      "7287: check ovn-nbctl --wait=hv copp-add copp4 svc-monitor svc-meter",
      "7288: check ovn-nbctl --wait=hv ls-copp-add copp4 sw0",
      "7289: check ovn-appctl -t ovn-controller vlog/set vconn:dbg",
      "7290: AT_CHECK([ovn-nbctl copp-list copp4], [0], [dnl",
      "7291: svc-monitor: svc-meter",
      "7292: ])",
      "7294: ip netns exec sw01 scapy -H <<-EOF",
      "7295: p = Ether(dst=\"33:33:33:33:33:33\", src=\"f0:00:00:01:02:03\") /\\",
      "7296:     IP(dst=\"192.168.1.100\", src=\"192.168.1.2\") / TCP(dport=1234, sport=1234)",
      "7297: sendp(p, iface='sw01', loop=0, verbose=0, count=20)",
      "7298: EOF",
      "7300: OVS_WAIT_UNTIL([test \"1\" = \"$(grep -c \"dl_dst=33:33:33:33:33:33\" ovn-controller.log)\"])",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "7296: as",
      "7297: OVS_TRAFFIC_VSWITCHD_STOP([\"/.*error receiving.*/d",
      "7300: AT_CLEANUP",
      "7301: ])",
      "",
      "[Removed Lines]",
      "7298: /.*terminating with signal 15.*/d\"])",
      "",
      "[Added Lines]",
      "7315: /.*terminating with signal 15.*/d",
      "7316: /.*Service monitor not found/d\"])",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "01d85f351031a6125444eccf0e56eb0037d2741c",
      "candidate_info": {
        "commit_hash": "01d85f351031a6125444eccf0e56eb0037d2741c",
        "repo": "ovn-org/ovn",
        "commit_url": "https://github.com/ovn-org/ovn/commit/01d85f351031a6125444eccf0e56eb0037d2741c",
        "files": [
          "tests/system-ovn.at"
        ],
        "message": "system-tests: Consolidate wait condition in CoPP test\n\nAdd missing wait condition and at the same time\nmove the wait to the last ovn-nbctl command\nof the chain, as there is no need to wait\nif there are more command afterward.\n\nSigned-off-by: Ales Musil <amusil@redhat.com>\nSigned-off-by: Dumitru Ceara <dceara@redhat.com>\n(cherry picked from commit 907b4fe190c5de709ec68b7facc325e33bf27be0)",
        "before_after_code_files": [
          "tests/system-ovn.at||tests/system-ovn.at"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "tests/system-ovn.at||tests/system-ovn.at"
          ],
          "candidate": [
            "tests/system-ovn.at||tests/system-ovn.at"
          ]
        }
      },
      "candidate_diff": {
        "tests/system-ovn.at||tests/system-ovn.at": [
          "File: tests/system-ovn.at -> tests/system-ovn.at",
          "--- Hunk 1 ---",
          "[Context before]",
          "7124: NS_EXEC([sw01], [tcpdump -l -n -i sw01 icmp -Q in > reject.pcap &])",
          "7125: check ovn-nbctl meter-add acl-meter drop 1 pktps 0",
          "7130: AT_CHECK([ovn-nbctl copp-list copp0], [0], [dnl",
          "7131: reject: acl-meter",
          "",
          "[Removed Lines]",
          "7126: check ovn-nbctl --wait=hv copp-add copp0 reject acl-meter",
          "7127: check ovn-nbctl --wait=hv ls-copp-add copp0 sw0",
          "7128: check ovn-nbctl acl-add sw0 from-lport 1002 'inport == \"sw01\" && ip && udp' reject",
          "",
          "[Added Lines]",
          "7126: check ovn-nbctl copp-add copp0 reject acl-meter",
          "7127: check ovn-nbctl ls-copp-add copp0 sw0",
          "7128: check ovn-nbctl --wait=hv acl-add sw0 from-lport 1002 'inport == \"sw01\" && ip && udp' reject",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "7147: # Let's update the meter",
          "7148: NS_EXEC([sw01], [tcpdump -l -n -i sw01 icmp -Q in > reject.pcap &])",
          "7150: ip netns exec sw01 scapy -H <<-EOF",
          "7151: p = IP(src=\"192.168.1.2\", dst=\"192.168.1.1\") / UDP(dport = 12345) / Raw(b\"X\"*64)",
          "7152: send (p, iface='sw01', loop = 0, verbose = 0, count = 40)",
          "",
          "[Removed Lines]",
          "7149: check ovn-nbctl --may-exist meter-add acl-meter drop 10 pktps 0",
          "",
          "[Added Lines]",
          "7149: check ovn-nbctl --may-exist --wait=hv meter-add acl-meter drop 10 pktps 0",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "7178: NS_EXEC([server], [tcpdump -l -n -i s1 arp[[24:4]]=0xac100164 > arp.pcap &])",
          "7179: check ovn-nbctl meter-add arp-meter drop 1 pktps 0",
          "7181: check ovn-nbctl --wait=hv lr-copp-add copp1 R1",
          "7182: AT_CHECK([ovn-nbctl copp-list copp1], [0], [dnl",
          "7183: arp-resolve: arp-meter",
          "",
          "[Removed Lines]",
          "7180: check ovn-nbctl --wait=hv copp-add copp1 arp-resolve arp-meter",
          "",
          "[Added Lines]",
          "7180: check ovn-nbctl copp-add copp1 arp-resolve arp-meter",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "7196: kill $(pidof tcpdump)",
          "7198: check ovn-nbctl meter-add icmp-meter drop 1 pktps 0",
          "7200: check ovn-nbctl --wait=hv lr-copp-add copp2 R1",
          "7201: AT_CHECK([ovn-nbctl copp-list copp2 |grep icmp4-error], [0], [dnl",
          "7202: icmp4-error: icmp-meter",
          "",
          "[Removed Lines]",
          "7199: check ovn-nbctl --wait=hv copp-add copp2 icmp4-error icmp-meter",
          "",
          "[Added Lines]",
          "7199: check ovn-nbctl copp-add copp2 icmp4-error icmp-meter",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "7216: kill $(pidof tcpdump)",
          "7218: check ovn-nbctl meter-add bfd-meter drop 1 pktps 0",
          "7220: check ovn-nbctl --wait=hv lr-copp-add copp3 R1",
          "7221: AT_CHECK([ovn-nbctl copp-list copp3 |grep bfd], [0], [dnl",
          "7222: bfd: bfd-meter",
          "",
          "[Removed Lines]",
          "7219: check ovn-nbctl --wait=hv copp-add copp3 bfd bfd-meter",
          "",
          "[Added Lines]",
          "7219: check ovn-nbctl copp-add copp3 bfd bfd-meter",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "7247: check ovn-nbctl set nb_global . options:svc_monitor_mac=\"33:33:33:33:33:33\"",
          "7248: check ovn-nbctl meter-add svc-meter drop 1 pktps 0",
          "7250: check ovn-nbctl --wait=hv ls-copp-add copp4 sw0",
          "7251: check ovn-appctl -t ovn-controller vlog/set vconn:dbg",
          "7252: AT_CHECK([ovn-nbctl copp-list copp4], [0], [dnl",
          "",
          "[Removed Lines]",
          "7249: check ovn-nbctl --wait=hv copp-add copp4 svc-monitor svc-meter",
          "",
          "[Added Lines]",
          "7249: check ovn-nbctl copp-add copp4 svc-monitor svc-meter",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "66195e07fbec9f237703d16f1cb963ab56672341",
      "candidate_info": {
        "commit_hash": "66195e07fbec9f237703d16f1cb963ab56672341",
        "repo": "ovn-org/ovn",
        "commit_url": "https://github.com/ovn-org/ovn/commit/66195e07fbec9f237703d16f1cb963ab56672341",
        "files": [
          "lib/copp.c",
          "lib/copp.h",
          "northd/northd.c",
          "ovn-nb.xml",
          "tests/ovn-northd.at",
          "tests/system-ovn.at"
        ],
        "message": "northd, controller: Add CoPP for SVC monitor\n\nThe SVC monitor was exposed without any limitation.\nAdd CoPP for the SVC monitor flow, which adds a way\nfor CMSs to limit the traffic that this flow accepts.\n\nSigned-off-by: Ales Musil <amusil@redhat.com>",
        "before_after_code_files": [
          "lib/copp.c||lib/copp.c",
          "lib/copp.h||lib/copp.h",
          "northd/northd.c||northd/northd.c",
          "tests/ovn-northd.at||tests/ovn-northd.at",
          "tests/system-ovn.at||tests/system-ovn.at"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "lib/copp.c||lib/copp.c",
            "lib/copp.h||lib/copp.h",
            "northd/northd.c||northd/northd.c",
            "tests/ovn-northd.at||tests/ovn-northd.at",
            "tests/system-ovn.at||tests/system-ovn.at"
          ],
          "candidate": [
            "lib/copp.c||lib/copp.c",
            "lib/copp.h||lib/copp.h",
            "northd/northd.c||northd/northd.c",
            "tests/ovn-northd.at||tests/ovn-northd.at",
            "tests/system-ovn.at||tests/system-ovn.at"
          ]
        }
      },
      "candidate_diff": {
        "lib/copp.c||lib/copp.c": [
          "File: lib/copp.c -> lib/copp.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "38:     [COPP_ND_RA_OPTS]    = \"nd-ra-opts\",",
          "39:     [COPP_TCP_RESET]     = \"tcp-reset\",",
          "40:     [COPP_REJECT]        = \"reject\",",
          "41:     [COPP_BFD]           = \"bfd\",",
          "42: };",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "41:     [COPP_SVC_MONITOR]   = \"svc-monitor\",",
          "",
          "---------------"
        ],
        "lib/copp.h||lib/copp.h": [
          "File: lib/copp.h -> lib/copp.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "37:     COPP_TCP_RESET,",
          "38:     COPP_BFD,",
          "39:     COPP_REJECT,",
          "40:     COPP_PROTO_MAX,",
          "41:     COPP_PROTO_INVALID = COPP_PROTO_MAX,",
          "42: };",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "40:     COPP_SVC_MONITOR,",
          "",
          "---------------"
        ],
        "northd/northd.c||northd/northd.c": [
          "File: northd/northd.c -> northd/northd.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "8933: static void",
          "8934: build_lswitch_destination_lookup_bmcast(struct ovn_datapath *od,",
          "8938: {",
          "8939:     if (od->nbs) {",
          "",
          "[Removed Lines]",
          "8935:                                         struct hmap *lflows,",
          "8936:                                         struct ds *actions,",
          "8937:                                         const struct shash *meter_groups)",
          "",
          "[Added Lines]",
          "8935:                                         struct hmap *lflows,",
          "8936:                                         struct ds *actions,",
          "8937:                                         const struct shash *meter_groups)",
          "8938: {",
          "8939:     if (od->nbs) {",
          "",
          "---------------"
        ],
        "tests/ovn-northd.at||tests/ovn-northd.at": [
          "File: tests/ovn-northd.at -> tests/ovn-northd.at",
          "--- Hunk 1 ---",
          "[Context before]",
          "3545: # let's try to add an usupported protocol \"dhcp\"",
          "3546: AT_CHECK([ovn-nbctl --wait=hv copp-add copp5 dhcp meter1],[1],[],[dnl",
          "3548: ])",
          "3550: #Let's try to add a valid protocol to an unknown datapath",
          "",
          "[Removed Lines]",
          "3547: ovn-nbctl: Invalid control protocol. Allowed values: arp, arp-resolve, dhcpv4-opts, dhcpv6-opts, dns, event-elb, icmp4-error, icmp6-error, igmp, nd-na, nd-ns, nd-ns-resolve, nd-ra-opts, tcp-reset, bfd, reject.",
          "",
          "[Added Lines]",
          "3547: ovn-nbctl: Invalid control protocol. Allowed values: arp, arp-resolve, dhcpv4-opts, dhcpv6-opts, dns, event-elb, icmp4-error, icmp6-error, igmp, nd-na, nd-ns, nd-ns-resolve, nd-ra-opts, tcp-reset, bfd, reject, svc-monitor.",
          "",
          "---------------"
        ],
        "tests/system-ovn.at||tests/system-ovn.at": [
          "File: tests/system-ovn.at -> tests/system-ovn.at",
          "--- Hunk 1 ---",
          "[Context before]",
          "7078: ])",
          "7079: kill $(pidof tcpdump)",
          "7081: kill $(pidof ovn-controller)",
          "7083: as ovn-sb",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "7081: check ovn-nbctl set nb_global . options:svc_monitor_mac=\"33:33:33:33:33:33\"",
          "7082: check ovn-nbctl meter-add svc-meter drop 1 pktps 0",
          "7083: check ovn-nbctl --wait=hv copp-add copp4 svc-monitor svc-meter",
          "7084: check ovn-nbctl --wait=hv ls-copp-add copp4 sw0",
          "7085: check ovn-appctl -t ovn-controller vlog/set vconn:dbg",
          "7086: AT_CHECK([ovn-nbctl copp-list copp4], [0], [dnl",
          "7087: svc-monitor: svc-meter",
          "7088: ])",
          "7090: ip netns exec sw01 scapy -H <<-EOF",
          "7091: p = Ether(dst=\"33:33:33:33:33:33\", src=\"f0:00:00:01:02:03\") /\\",
          "7092:     IP(dst=\"192.168.1.100\", src=\"192.168.1.2\") / TCP(dport=1234, sport=1234)",
          "7093: sendp(p, iface='sw01', loop=0, verbose=0, count=20)",
          "7094: EOF",
          "7096: OVS_WAIT_UNTIL([test \"1\" = \"$(grep -c \"dl_dst=33:33:33:33:33:33\" ovn-controller.log)\"])",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "7092: as",
          "7093: OVS_TRAFFIC_VSWITCHD_STOP([\"/.*error receiving.*/d",
          "7096: AT_CLEANUP",
          "7097: ])",
          "",
          "[Removed Lines]",
          "7094: /.*terminating with signal 15.*/d\"])",
          "",
          "[Added Lines]",
          "7111: /.*terminating with signal 15.*/d",
          "7112: /.*Service monitor not found/d\"])",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "d3488ea26e061c815402c0a0321d92a3dee7a847",
      "candidate_info": {
        "commit_hash": "d3488ea26e061c815402c0a0321d92a3dee7a847",
        "repo": "ovn-org/ovn",
        "commit_url": "https://github.com/ovn-org/ovn/commit/d3488ea26e061c815402c0a0321d92a3dee7a847",
        "files": [
          "lib/copp.c",
          "lib/copp.h",
          "northd/northd.c",
          "ovn-nb.xml",
          "tests/ovn-northd.at",
          "tests/system-ovn.at"
        ],
        "message": "northd, controller: Add CoPP for SVC monitor\n\nThe SVC monitor was exposed without any limitation.\nAdd CoPP for the SVC monitor flow, which adds a way\nfor CMSs to limit the traffic that this flow accepts.\n\nSigned-off-by: Ales Musil <amusil@redhat.com>",
        "before_after_code_files": [
          "lib/copp.c||lib/copp.c",
          "lib/copp.h||lib/copp.h",
          "northd/northd.c||northd/northd.c",
          "tests/ovn-northd.at||tests/ovn-northd.at",
          "tests/system-ovn.at||tests/system-ovn.at"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "lib/copp.c||lib/copp.c",
            "lib/copp.h||lib/copp.h",
            "northd/northd.c||northd/northd.c",
            "tests/ovn-northd.at||tests/ovn-northd.at",
            "tests/system-ovn.at||tests/system-ovn.at"
          ],
          "candidate": [
            "lib/copp.c||lib/copp.c",
            "lib/copp.h||lib/copp.h",
            "northd/northd.c||northd/northd.c",
            "tests/ovn-northd.at||tests/ovn-northd.at",
            "tests/system-ovn.at||tests/system-ovn.at"
          ]
        }
      },
      "candidate_diff": {
        "lib/copp.c||lib/copp.c": [
          "File: lib/copp.c -> lib/copp.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "38:     [COPP_ND_RA_OPTS]    = \"nd-ra-opts\",",
          "39:     [COPP_TCP_RESET]     = \"tcp-reset\",",
          "40:     [COPP_REJECT]        = \"reject\",",
          "41:     [COPP_BFD]           = \"bfd\",",
          "42: };",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "41:     [COPP_SVC_MONITOR]   = \"svc-monitor\",",
          "",
          "---------------"
        ],
        "lib/copp.h||lib/copp.h": [
          "File: lib/copp.h -> lib/copp.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "37:     COPP_TCP_RESET,",
          "38:     COPP_BFD,",
          "39:     COPP_REJECT,",
          "40:     COPP_PROTO_MAX,",
          "41:     COPP_PROTO_INVALID = COPP_PROTO_MAX,",
          "42: };",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "40:     COPP_SVC_MONITOR,",
          "",
          "---------------"
        ],
        "northd/northd.c||northd/northd.c": [
          "File: northd/northd.c -> northd/northd.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "9127: static void",
          "9128: build_lswitch_destination_lookup_bmcast(struct ovn_datapath *od,",
          "9129:                                         struct hmap *lflows,",
          "9133:     ovs_assert(od->nbs);",
          "9135:     ovn_lflow_add(lflows, od, S_SWITCH_IN_L2_LKUP, 110,",
          "",
          "[Removed Lines]",
          "9130:                                         struct ds *actions,",
          "9131:                                         const struct shash *meter_groups)",
          "9132: {",
          "",
          "[Added Lines]",
          "9130:                                         struct ds *actions,",
          "9131:                                         const struct shash *meter_groups)",
          "9132: {",
          "9133:     ovs_assert(od->nbs);",
          "",
          "---------------"
        ],
        "tests/ovn-northd.at||tests/ovn-northd.at": [
          "File: tests/ovn-northd.at -> tests/ovn-northd.at",
          "--- Hunk 1 ---",
          "[Context before]",
          "3631: # let's try to add an usupported protocol \"dhcp\"",
          "3632: AT_CHECK([ovn-nbctl --wait=hv copp-add copp5 dhcp meter1],[1],[],[dnl",
          "3634: ])",
          "3636: #Let's try to add a valid protocol to an unknown datapath",
          "",
          "[Removed Lines]",
          "3633: ovn-nbctl: Invalid control protocol. Allowed values: arp, arp-resolve, dhcpv4-opts, dhcpv6-opts, dns, event-elb, icmp4-error, icmp6-error, igmp, nd-na, nd-ns, nd-ns-resolve, nd-ra-opts, tcp-reset, bfd, reject.",
          "",
          "[Added Lines]",
          "3633: ovn-nbctl: Invalid control protocol. Allowed values: arp, arp-resolve, dhcpv4-opts, dhcpv6-opts, dns, event-elb, icmp4-error, icmp6-error, igmp, nd-na, nd-ns, nd-ns-resolve, nd-ra-opts, tcp-reset, bfd, reject, svc-monitor.",
          "",
          "---------------"
        ],
        "tests/system-ovn.at||tests/system-ovn.at": [
          "File: tests/system-ovn.at -> tests/system-ovn.at",
          "--- Hunk 1 ---",
          "[Context before]",
          "7466: ])",
          "7467: kill $(pidof tcpdump)",
          "7469: OVS_APP_EXIT_AND_WAIT([ovn-controller])",
          "7471: as ovn-sb",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "7469: check ovn-nbctl set nb_global . options:svc_monitor_mac=\"33:33:33:33:33:33\"",
          "7470: check ovn-nbctl meter-add svc-meter drop 1 pktps 0",
          "7471: check ovn-nbctl --wait=hv copp-add copp4 svc-monitor svc-meter",
          "7472: check ovn-nbctl --wait=hv ls-copp-add copp4 sw0",
          "7473: check ovn-appctl -t ovn-controller vlog/set vconn:dbg",
          "7474: AT_CHECK([ovn-nbctl copp-list copp4], [0], [dnl",
          "7475: svc-monitor: svc-meter",
          "7476: ])",
          "7478: ip netns exec sw01 scapy -H <<-EOF",
          "7479: p = Ether(dst=\"33:33:33:33:33:33\", src=\"f0:00:00:01:02:03\") /\\",
          "7480:     IP(dst=\"192.168.1.100\", src=\"192.168.1.2\") / TCP(dport=1234, sport=1234)",
          "7481: sendp(p, iface='sw01', loop=0, verbose=0, count=20)",
          "7482: EOF",
          "7484: OVS_WAIT_UNTIL([test \"1\" = \"$(grep -c \"dl_dst=33:33:33:33:33:33\" ovn-controller.log)\"])",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "7480: as",
          "7481: OVS_TRAFFIC_VSWITCHD_STOP([\"/.*error receiving.*/d",
          "7484: AT_CLEANUP",
          "7485: ])",
          "",
          "[Removed Lines]",
          "7482: /.*terminating with signal 15.*/d\"])",
          "",
          "[Added Lines]",
          "7499: /.*terminating with signal 15.*/d",
          "7500: /.*Service monitor not found/d\"])",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "3297ea66ef624541e90278e618ff2521979fe22a",
      "candidate_info": {
        "commit_hash": "3297ea66ef624541e90278e618ff2521979fe22a",
        "repo": "ovn-org/ovn",
        "commit_url": "https://github.com/ovn-org/ovn/commit/3297ea66ef624541e90278e618ff2521979fe22a",
        "files": [
          "lib/copp.c",
          "lib/copp.h",
          "northd/northd.c",
          "ovn-nb.xml",
          "tests/ovn-northd.at",
          "tests/system-ovn.at"
        ],
        "message": "northd, controller: Add CoPP for SVC monitor\n\nThe SVC monitor was exposed without any limitation.\nAdd CoPP for the SVC monitor flow, which adds a way\nfor CMSs to limit the traffic that this flow accepts.\n\nSigned-off-by: Ales Musil <amusil@redhat.com>",
        "before_after_code_files": [
          "lib/copp.c||lib/copp.c",
          "lib/copp.h||lib/copp.h",
          "northd/northd.c||northd/northd.c",
          "tests/ovn-northd.at||tests/ovn-northd.at",
          "tests/system-ovn.at||tests/system-ovn.at"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "lib/copp.c||lib/copp.c",
            "lib/copp.h||lib/copp.h",
            "northd/northd.c||northd/northd.c",
            "tests/ovn-northd.at||tests/ovn-northd.at",
            "tests/system-ovn.at||tests/system-ovn.at"
          ],
          "candidate": [
            "lib/copp.c||lib/copp.c",
            "lib/copp.h||lib/copp.h",
            "northd/northd.c||northd/northd.c",
            "tests/ovn-northd.at||tests/ovn-northd.at",
            "tests/system-ovn.at||tests/system-ovn.at"
          ]
        }
      },
      "candidate_diff": {
        "lib/copp.c||lib/copp.c": [
          "File: lib/copp.c -> lib/copp.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "38:     [COPP_ND_RA_OPTS]    = \"nd-ra-opts\",",
          "39:     [COPP_TCP_RESET]     = \"tcp-reset\",",
          "40:     [COPP_REJECT]        = \"reject\",",
          "41:     [COPP_BFD]           = \"bfd\",",
          "42: };",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "41:     [COPP_SVC_MONITOR]   = \"svc-monitor\",",
          "",
          "---------------"
        ],
        "lib/copp.h||lib/copp.h": [
          "File: lib/copp.h -> lib/copp.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "37:     COPP_TCP_RESET,",
          "38:     COPP_BFD,",
          "39:     COPP_REJECT,",
          "40:     COPP_PROTO_MAX,",
          "41:     COPP_PROTO_INVALID = COPP_PROTO_MAX,",
          "42: };",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "40:     COPP_SVC_MONITOR,",
          "",
          "---------------"
        ],
        "northd/northd.c||northd/northd.c": [
          "File: northd/northd.c -> northd/northd.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "8424: static void",
          "8425: build_lswitch_destination_lookup_bmcast(struct ovn_datapath *od,",
          "8429: {",
          "8430:     if (od->nbs) {",
          "",
          "[Removed Lines]",
          "8426:                                         struct hmap *lflows,",
          "8427:                                         struct ds *actions,",
          "8428:                                         const struct shash *meter_groups)",
          "",
          "[Added Lines]",
          "8426:                                         struct hmap *lflows,",
          "8427:                                         struct ds *actions,",
          "8428:                                         const struct shash *meter_groups)",
          "8429: {",
          "8430:     if (od->nbs) {",
          "",
          "---------------"
        ],
        "tests/ovn-northd.at||tests/ovn-northd.at": [
          "File: tests/ovn-northd.at -> tests/ovn-northd.at",
          "--- Hunk 1 ---",
          "[Context before]",
          "3363: # let's try to add an usupported protocol \"dhcp\"",
          "3364: AT_CHECK([ovn-nbctl --wait=hv copp-add copp5 dhcp meter1],[1],[],[dnl",
          "3366: ])",
          "3368: #Let's try to add a valid protocol to an unknown datapath",
          "",
          "[Removed Lines]",
          "3365: ovn-nbctl: Invalid control protocol. Allowed values: arp, arp-resolve, dhcpv4-opts, dhcpv6-opts, dns, event-elb, icmp4-error, icmp6-error, igmp, nd-na, nd-ns, nd-ns-resolve, nd-ra-opts, tcp-reset, bfd, reject.",
          "",
          "[Added Lines]",
          "3365: ovn-nbctl: Invalid control protocol. Allowed values: arp, arp-resolve, dhcpv4-opts, dhcpv6-opts, dns, event-elb, icmp4-error, icmp6-error, igmp, nd-na, nd-ns, nd-ns-resolve, nd-ra-opts, tcp-reset, bfd, reject, svc-monitor.",
          "",
          "---------------"
        ],
        "tests/system-ovn.at||tests/system-ovn.at": [
          "File: tests/system-ovn.at -> tests/system-ovn.at",
          "--- Hunk 1 ---",
          "[Context before]",
          "7019: ])",
          "7020: kill $(pidof tcpdump)",
          "7022: kill $(pidof ovn-controller)",
          "7024: as ovn-sb",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "7022: check ovn-nbctl set nb_global . options:svc_monitor_mac=\"33:33:33:33:33:33\"",
          "7023: check ovn-nbctl meter-add svc-meter drop 1 pktps 0",
          "7024: check ovn-nbctl --wait=hv copp-add copp4 svc-monitor svc-meter",
          "7025: check ovn-nbctl --wait=hv ls-copp-add copp4 sw0",
          "7026: check ovn-appctl -t ovn-controller vlog/set vconn:dbg",
          "7027: AT_CHECK([ovn-nbctl copp-list copp4], [0], [dnl",
          "7028: svc-monitor: svc-meter",
          "7029: ])",
          "7031: ip netns exec sw01 scapy -H <<-EOF",
          "7032: p = Ether(dst=\"33:33:33:33:33:33\", src=\"f0:00:00:01:02:03\") /\\",
          "7033:     IP(dst=\"192.168.1.100\", src=\"192.168.1.2\") / TCP(dport=1234, sport=1234)",
          "7034: sendp(p, iface='sw01', loop=0, verbose=0, count=20)",
          "7035: EOF",
          "7037: OVS_WAIT_UNTIL([test \"1\" = \"$(grep -c \"dl_dst=33:33:33:33:33:33\" ovn-controller.log)\"])",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "7033: as",
          "7034: OVS_TRAFFIC_VSWITCHD_STOP([\"/.*error receiving.*/d",
          "7037: AT_CLEANUP",
          "7038: ])",
          "",
          "[Removed Lines]",
          "7035: /.*terminating with signal 15.*/d\"])",
          "",
          "[Added Lines]",
          "7052: /.*terminating with signal 15.*/d",
          "7053: /.*Service monitor not found/d\"])",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "c0f17e7d1452c35de8f3c3540b8750662742cec4",
      "candidate_info": {
        "commit_hash": "c0f17e7d1452c35de8f3c3540b8750662742cec4",
        "repo": "ovn-org/ovn",
        "commit_url": "https://github.com/ovn-org/ovn/commit/c0f17e7d1452c35de8f3c3540b8750662742cec4",
        "files": [
          "lib/copp.c",
          "lib/copp.h",
          "northd/northd.c",
          "ovn-nb.xml",
          "tests/ovn-northd.at",
          "tests/system-ovn.at"
        ],
        "message": "northd, controller: Add CoPP for SVC monitor\n\nThe SVC monitor was exposed without any limitation.\nAdd CoPP for the SVC monitor flow, which adds a way\nfor CMSs to limit the traffic that this flow accepts.\n\nSigned-off-by: Ales Musil <amusil@redhat.com>",
        "before_after_code_files": [
          "lib/copp.c||lib/copp.c",
          "lib/copp.h||lib/copp.h",
          "northd/northd.c||northd/northd.c",
          "tests/ovn-northd.at||tests/ovn-northd.at",
          "tests/system-ovn.at||tests/system-ovn.at"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "lib/copp.c||lib/copp.c",
            "lib/copp.h||lib/copp.h",
            "northd/northd.c||northd/northd.c",
            "tests/ovn-northd.at||tests/ovn-northd.at",
            "tests/system-ovn.at||tests/system-ovn.at"
          ],
          "candidate": [
            "lib/copp.c||lib/copp.c",
            "lib/copp.h||lib/copp.h",
            "northd/northd.c||northd/northd.c",
            "tests/ovn-northd.at||tests/ovn-northd.at",
            "tests/system-ovn.at||tests/system-ovn.at"
          ]
        }
      },
      "candidate_diff": {
        "lib/copp.c||lib/copp.c": [
          "File: lib/copp.c -> lib/copp.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "38:     [COPP_ND_RA_OPTS]    = \"nd-ra-opts\",",
          "39:     [COPP_TCP_RESET]     = \"tcp-reset\",",
          "40:     [COPP_REJECT]        = \"reject\",",
          "41:     [COPP_BFD]           = \"bfd\",",
          "42: };",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "41:     [COPP_SVC_MONITOR]   = \"svc-monitor\",",
          "",
          "---------------"
        ],
        "lib/copp.h||lib/copp.h": [
          "File: lib/copp.h -> lib/copp.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "37:     COPP_TCP_RESET,",
          "38:     COPP_BFD,",
          "39:     COPP_REJECT,",
          "40:     COPP_PROTO_MAX,",
          "41:     COPP_PROTO_INVALID = COPP_PROTO_MAX,",
          "42: };",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "40:     COPP_SVC_MONITOR,",
          "",
          "---------------"
        ],
        "northd/northd.c||northd/northd.c": [
          "File: northd/northd.c -> northd/northd.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "8338: static void",
          "8339: build_lswitch_destination_lookup_bmcast(struct ovn_datapath *od,",
          "8343: {",
          "8344:     if (od->nbs) {",
          "",
          "[Removed Lines]",
          "8340:                                         struct hmap *lflows,",
          "8341:                                         struct ds *actions,",
          "8342:                                         const struct shash *meter_groups)",
          "",
          "[Added Lines]",
          "8340:                                         struct hmap *lflows,",
          "8341:                                         struct ds *actions,",
          "8342:                                         const struct shash *meter_groups)",
          "8343: {",
          "8344:     if (od->nbs) {",
          "",
          "---------------"
        ],
        "tests/ovn-northd.at||tests/ovn-northd.at": [
          "File: tests/ovn-northd.at -> tests/ovn-northd.at",
          "--- Hunk 1 ---",
          "[Context before]",
          "3377: # let's try to add an usupported protocol \"dhcp\"",
          "3378: AT_CHECK([ovn-nbctl --wait=hv copp-add copp5 dhcp meter1],[1],[],[dnl",
          "3380: ])",
          "3382: #Let's try to add a valid protocol to an unknown datapath",
          "",
          "[Removed Lines]",
          "3379: ovn-nbctl: Invalid control protocol. Allowed values: arp, arp-resolve, dhcpv4-opts, dhcpv6-opts, dns, event-elb, icmp4-error, icmp6-error, igmp, nd-na, nd-ns, nd-ns-resolve, nd-ra-opts, tcp-reset, bfd, reject.",
          "",
          "[Added Lines]",
          "3379: ovn-nbctl: Invalid control protocol. Allowed values: arp, arp-resolve, dhcpv4-opts, dhcpv6-opts, dns, event-elb, icmp4-error, icmp6-error, igmp, nd-na, nd-ns, nd-ns-resolve, nd-ra-opts, tcp-reset, bfd, reject, svc-monitor.",
          "",
          "---------------"
        ],
        "tests/system-ovn.at||tests/system-ovn.at": [
          "File: tests/system-ovn.at -> tests/system-ovn.at",
          "--- Hunk 1 ---",
          "[Context before]",
          "7079: ])",
          "7080: kill $(pidof tcpdump)",
          "7082: kill $(pidof ovn-controller)",
          "7084: as ovn-sb",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "7082: check ovn-nbctl set nb_global . options:svc_monitor_mac=\"33:33:33:33:33:33\"",
          "7083: check ovn-nbctl meter-add svc-meter drop 1 pktps 0",
          "7084: check ovn-nbctl --wait=hv copp-add copp4 svc-monitor svc-meter",
          "7085: check ovn-nbctl --wait=hv ls-copp-add copp4 sw0",
          "7086: check ovn-appctl -t ovn-controller vlog/set vconn:dbg",
          "7087: AT_CHECK([ovn-nbctl copp-list copp4], [0], [dnl",
          "7088: svc-monitor: svc-meter",
          "7089: ])",
          "7091: ip netns exec sw01 scapy -H <<-EOF",
          "7092: p = Ether(dst=\"33:33:33:33:33:33\", src=\"f0:00:00:01:02:03\") /\\",
          "7093:     IP(dst=\"192.168.1.100\", src=\"192.168.1.2\") / TCP(dport=1234, sport=1234)",
          "7094: sendp(p, iface='sw01', loop=0, verbose=0, count=20)",
          "7095: EOF",
          "7097: OVS_WAIT_UNTIL([test \"1\" = \"$(grep -c \"dl_dst=33:33:33:33:33:33\" ovn-controller.log)\"])",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "7093: as",
          "7094: OVS_TRAFFIC_VSWITCHD_STOP([\"/.*error receiving.*/d",
          "7097: AT_CLEANUP",
          "7098: ])",
          "",
          "[Removed Lines]",
          "7095: /.*terminating with signal 15.*/d\"])",
          "",
          "[Added Lines]",
          "7112: /.*terminating with signal 15.*/d",
          "7113: /.*Service monitor not found/d\"])",
          "",
          "---------------"
        ]
      }
    }
  ]
}