{
  "cve_id": "CVE-2024-31949",
  "cve_desc": "In FRRouting (FRR) through 9.1, an infinite loop can occur when receiving a MP/GR capability as a dynamic capability because malformed data results in a pointer not advancing.",
  "repo": "FRRouting/frr",
  "patch_hash": "30a332dad86fafd2b0b6c61d23de59ed969a219b",
  "patch_info": {
    "commit_hash": "30a332dad86fafd2b0b6c61d23de59ed969a219b",
    "repo": "FRRouting/frr",
    "commit_url": "https://github.com/FRRouting/frr/commit/30a332dad86fafd2b0b6c61d23de59ed969a219b",
    "files": [
      "bgpd/bgp_packet.c"
    ],
    "message": "bgpd: Fix errors handling for MP/GR capabilities as dynamic capability\n\nWhen receiving a MP/GR capability as dynamic capability, but malformed, do not\nforget to advance the pointer to avoid hitting infinity loop.\n\nAfter:\n```\nMar 29 11:15:28 donatas-laptop bgpd[353550]: [GS0AQ-HKY0X] 127.0.0.1 rcv CAPABILITY\nMar 29 11:15:28 donatas-laptop bgpd[353550]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 5, length 0\nMar 29 11:15:28 donatas-laptop bgpd[353550]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 0, length 0\nMar 29 11:15:28 donatas-laptop bgpd[353550]: [HFHDS-QT71N][EC 33554494] 127.0.0.1(donatas-pc): unrecognized capability code: 0 - ignored\nMar 29 11:15:28 donatas-laptop bgpd[353550]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 0, code: 0, length 0\nMar 29 11:15:28 donatas-laptop bgpd[353550]: [HFHDS-QT71N][EC 33554494] 127.0.0.1(donatas-pc): unrecognized capability code: 0 - ignored\nMar 29 11:15:28 donatas-laptop bgpd[353550]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 0, code: 0, length 0\nMar 29 11:15:28 donatas-laptop bgpd[353550]: [HFHDS-QT71N][EC 33554494] 127.0.0.1(donatas-pc): unrecognized capability code: 0 - ignored\nMar 29 11:15:28 donatas-laptop bgpd[353550]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 0, code: 0, length 1\nMar 29 11:15:28 donatas-laptop bgpd[353550]: [HFHDS-QT71N][EC 33554494] 127.0.0.1(donatas-pc): unrecognized capability code: 0 - ignored\nMar 29 11:15:28 donatas-laptop bgpd[353550]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:15:28 donatas-laptop bgpd[353550]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\n```\n\nBefore:\n```\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\n```\n\nReported-by: Iggy Frankovic <iggyfran@amazon.com>\nSigned-off-by: Donatas Abraitis <donatas@opensourcerouting.org>",
    "before_after_code_files": [
      "bgpd/bgp_packet.c||bgpd/bgp_packet.c"
    ]
  },
  "patch_diff": {
    "bgpd/bgp_packet.c||bgpd/bgp_packet.c": [
      "File: bgpd/bgp_packet.c -> bgpd/bgp_packet.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "3734:    zlog_err(\"%pBP: Capability length error\", peer);",
      "3735:    bgp_notify_send(peer->connection, BGP_NOTIFY_CEASE,",
      "3736:      BGP_NOTIFY_SUBCODE_UNSPECIFIC);",
      "3737:    return BGP_Stop;",
      "3738:   }",
      "3739:   action = *pnt;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "3737:    pnt += length;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "3746:      action);",
      "3747:    bgp_notify_send(peer->connection, BGP_NOTIFY_CEASE,",
      "3748:      BGP_NOTIFY_SUBCODE_UNSPECIFIC);",
      "3750:   }",
      "3752:   if (bgp_debug_neighbor_events(peer))",
      "",
      "[Removed Lines]",
      "3749:    return BGP_Stop;",
      "",
      "[Added Lines]",
      "3750:    goto done;",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "3758:    zlog_err(\"%pBP: Capability length error\", peer);",
      "3759:    bgp_notify_send(peer->connection, BGP_NOTIFY_CEASE,",
      "3760:      BGP_NOTIFY_SUBCODE_UNSPECIFIC);",
      "3761:    return BGP_Stop;",
      "3762:   }",
      "3765:   if (CHECK_FLAG(peer->flags, PEER_FLAG_OVERRIDE_CAPABILITY))",
      "3768:   capability = lookup_msg(capcode_str, hdr->code, \"Unknown\");",
      "",
      "[Removed Lines]",
      "3766:    continue;",
      "",
      "[Added Lines]",
      "3762:    pnt += length;",
      "3768:    goto done;",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "3778:       peer, capability,",
      "3779:       sizeof(struct capability_mp_data),",
      "3780:       hdr->length);",
      "3782:    }",
      "3784:    memcpy(&mpc, pnt + 3, sizeof(struct capability_mp_data));",
      "",
      "[Removed Lines]",
      "3781:     return BGP_Stop;",
      "",
      "[Added Lines]",
      "3783:     goto done;",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "3793:          peer, capability,",
      "3794:          iana_afi2str(pkt_afi),",
      "3795:          iana_safi2str(pkt_safi));",
      "3797:    }",
      "",
      "[Removed Lines]",
      "3796:     continue;",
      "",
      "[Added Lines]",
      "3798:     goto done;",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "3820:     if (peer_active_nego(peer))",
      "3821:      bgp_clear_route(peer, afi, safi);",
      "3822:     else",
      "3824:    }",
      "3825:    break;",
      "3826:   case CAPABILITY_CODE_RESTART:",
      "",
      "[Removed Lines]",
      "3823:      return BGP_Stop;",
      "",
      "[Added Lines]",
      "3825:      goto done;",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "3830:     bgp_notify_send(peer->connection,",
      "3831:       BGP_NOTIFY_CEASE,",
      "3832:       BGP_NOTIFY_SUBCODE_UNSPECIFIC);",
      "3834:    }",
      "3836:    bgp_dynamic_capability_graceful_restart(pnt, action,",
      "",
      "[Removed Lines]",
      "3833:     return BGP_Stop;",
      "",
      "[Added Lines]",
      "3835:     goto done;",
      "",
      "---------------",
      "--- Hunk 8 ---",
      "[Context before]",
      "3866:     bgp_notify_send(peer->connection,",
      "3867:       BGP_NOTIFY_CEASE,",
      "3868:       BGP_NOTIFY_SUBCODE_UNSPECIFIC);",
      "3870:    }",
      "3872:    uint8_t role;",
      "",
      "[Removed Lines]",
      "3869:     return BGP_Stop;",
      "",
      "[Added Lines]",
      "3871:     goto done;",
      "",
      "---------------",
      "--- Hunk 9 ---",
      "[Context before]",
      "3888:    break;",
      "3889:   }",
      "3891:   pnt += hdr->length + 3;",
      "3892:  }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "3893: done:",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "0ddeb8b0e4ad51105f56ee2bab6b629154b54a49",
      "candidate_info": {
        "commit_hash": "0ddeb8b0e4ad51105f56ee2bab6b629154b54a49",
        "repo": "FRRouting/frr",
        "commit_url": "https://github.com/FRRouting/frr/commit/0ddeb8b0e4ad51105f56ee2bab6b629154b54a49",
        "files": [
          "bgpd/bgp_packet.c"
        ],
        "message": "bgpd: Fix errors handling for MP/GR capabilities as dynamic capability\n\nWhen receiving a MP/GR capability as dynamic capability, but malformed, do not\nforget to advance the pointer to avoid hitting infinity loop.\n\nAfter:\n```\nMar 29 11:15:28 donatas-laptop bgpd[353550]: [GS0AQ-HKY0X] 127.0.0.1 rcv CAPABILITY\nMar 29 11:15:28 donatas-laptop bgpd[353550]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 5, length 0\nMar 29 11:15:28 donatas-laptop bgpd[353550]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 0, length 0\nMar 29 11:15:28 donatas-laptop bgpd[353550]: [HFHDS-QT71N][EC 33554494] 127.0.0.1(donatas-pc): unrecognized capability code: 0 - ignored\nMar 29 11:15:28 donatas-laptop bgpd[353550]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 0, code: 0, length 0\nMar 29 11:15:28 donatas-laptop bgpd[353550]: [HFHDS-QT71N][EC 33554494] 127.0.0.1(donatas-pc): unrecognized capability code: 0 - ignored\nMar 29 11:15:28 donatas-laptop bgpd[353550]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 0, code: 0, length 0\nMar 29 11:15:28 donatas-laptop bgpd[353550]: [HFHDS-QT71N][EC 33554494] 127.0.0.1(donatas-pc): unrecognized capability code: 0 - ignored\nMar 29 11:15:28 donatas-laptop bgpd[353550]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 0, code: 0, length 1\nMar 29 11:15:28 donatas-laptop bgpd[353550]: [HFHDS-QT71N][EC 33554494] 127.0.0.1(donatas-pc): unrecognized capability code: 0 - ignored\nMar 29 11:15:28 donatas-laptop bgpd[353550]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:15:28 donatas-laptop bgpd[353550]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\n```\n\nBefore:\n```\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\n```\n\nReported-by: Iggy Frankovic <iggyfran@amazon.com>\nSigned-off-by: Donatas Abraitis <donatas@opensourcerouting.org>\n(cherry picked from commit 30a332dad86fafd2b0b6c61d23de59ed969a219b)",
        "before_after_code_files": [
          "bgpd/bgp_packet.c||bgpd/bgp_packet.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "bgpd/bgp_packet.c||bgpd/bgp_packet.c"
          ],
          "candidate": [
            "bgpd/bgp_packet.c||bgpd/bgp_packet.c"
          ]
        }
      },
      "candidate_diff": {
        "bgpd/bgp_packet.c||bgpd/bgp_packet.c": [
          "File: bgpd/bgp_packet.c -> bgpd/bgp_packet.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "3121:    zlog_err(\"%pBP: Capability length error\", peer);",
          "3122:    bgp_notify_send(peer->connection, BGP_NOTIFY_CEASE,",
          "3123:      BGP_NOTIFY_SUBCODE_UNSPECIFIC);",
          "3124:    return BGP_Stop;",
          "3125:   }",
          "3126:   action = *pnt;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3124:    pnt += length;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "3133:      action);",
          "3134:    bgp_notify_send(peer->connection, BGP_NOTIFY_CEASE,",
          "3135:      BGP_NOTIFY_SUBCODE_UNSPECIFIC);",
          "3137:   }",
          "3139:   if (bgp_debug_neighbor_events(peer))",
          "",
          "[Removed Lines]",
          "3136:    return BGP_Stop;",
          "",
          "[Added Lines]",
          "3137:    goto done;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "3145:    zlog_err(\"%pBP: Capability length error\", peer);",
          "3146:    bgp_notify_send(peer->connection, BGP_NOTIFY_CEASE,",
          "3147:      BGP_NOTIFY_SUBCODE_UNSPECIFIC);",
          "3148:    return BGP_Stop;",
          "3149:   }",
          "3152:   if (CHECK_FLAG(peer->flags, PEER_FLAG_OVERRIDE_CAPABILITY))",
          "3155:   capability = lookup_msg(capcode_str, hdr->code, \"Unknown\");",
          "",
          "[Removed Lines]",
          "3153:    continue;",
          "",
          "[Added Lines]",
          "3149:    pnt += length;",
          "3155:    goto done;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "3165:       peer, capability,",
          "3166:       sizeof(struct capability_mp_data),",
          "3167:       hdr->length);",
          "3169:    }",
          "3171:    memcpy(&mpc, pnt + 3, sizeof(struct capability_mp_data));",
          "",
          "[Removed Lines]",
          "3168:     return BGP_Stop;",
          "",
          "[Added Lines]",
          "3170:     goto done;",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "3180:          peer, capability,",
          "3181:          iana_afi2str(pkt_afi),",
          "3182:          iana_safi2str(pkt_safi));",
          "3184:    }",
          "",
          "[Removed Lines]",
          "3183:     continue;",
          "",
          "[Added Lines]",
          "3185:     goto done;",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "3207:     if (peer_active_nego(peer))",
          "3208:      bgp_clear_route(peer, afi, safi);",
          "3209:     else",
          "3211:    }",
          "3212:    break;",
          "3213:   case CAPABILITY_CODE_RESTART:",
          "",
          "[Removed Lines]",
          "3210:      return BGP_Stop;",
          "",
          "[Added Lines]",
          "3212:      goto done;",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "3217:     bgp_notify_send(peer->connection,",
          "3218:       BGP_NOTIFY_CEASE,",
          "3219:       BGP_NOTIFY_SUBCODE_UNSPECIFIC);",
          "3221:    }",
          "3223:    bgp_dynamic_capability_graceful_restart(pnt, action,",
          "",
          "[Removed Lines]",
          "3220:     return BGP_Stop;",
          "",
          "[Added Lines]",
          "3222:     goto done;",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "3243:     bgp_notify_send(peer->connection,",
          "3244:       BGP_NOTIFY_CEASE,",
          "3245:       BGP_NOTIFY_SUBCODE_UNSPECIFIC);",
          "3247:    }",
          "3249:    uint8_t role;",
          "",
          "[Removed Lines]",
          "3246:     return BGP_Stop;",
          "",
          "[Added Lines]",
          "3248:     goto done;",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "3265:    break;",
          "3266:   }",
          "3268:   pnt += hdr->length + 3;",
          "3269:  }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3270: done:",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "2a5ea423efe179c018b836a1c5a256c93ae429ef",
      "candidate_info": {
        "commit_hash": "2a5ea423efe179c018b836a1c5a256c93ae429ef",
        "repo": "FRRouting/frr",
        "commit_url": "https://github.com/FRRouting/frr/commit/2a5ea423efe179c018b836a1c5a256c93ae429ef",
        "files": [
          "bgpd/bgp_packet.c"
        ],
        "message": "bgpd: Fix errors handling for MP/GR capabilities as dynamic capability\n\nWhen receiving a MP/GR capability as dynamic capability, but malformed, do not\nforget to advance the pointer to avoid hitting infinity loop.\n\nAfter:\n```\nMar 29 11:15:28 donatas-laptop bgpd[353550]: [GS0AQ-HKY0X] 127.0.0.1 rcv CAPABILITY\nMar 29 11:15:28 donatas-laptop bgpd[353550]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 5, length 0\nMar 29 11:15:28 donatas-laptop bgpd[353550]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 0, length 0\nMar 29 11:15:28 donatas-laptop bgpd[353550]: [HFHDS-QT71N][EC 33554494] 127.0.0.1(donatas-pc): unrecognized capability code: 0 - ignored\nMar 29 11:15:28 donatas-laptop bgpd[353550]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 0, code: 0, length 0\nMar 29 11:15:28 donatas-laptop bgpd[353550]: [HFHDS-QT71N][EC 33554494] 127.0.0.1(donatas-pc): unrecognized capability code: 0 - ignored\nMar 29 11:15:28 donatas-laptop bgpd[353550]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 0, code: 0, length 0\nMar 29 11:15:28 donatas-laptop bgpd[353550]: [HFHDS-QT71N][EC 33554494] 127.0.0.1(donatas-pc): unrecognized capability code: 0 - ignored\nMar 29 11:15:28 donatas-laptop bgpd[353550]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 0, code: 0, length 1\nMar 29 11:15:28 donatas-laptop bgpd[353550]: [HFHDS-QT71N][EC 33554494] 127.0.0.1(donatas-pc): unrecognized capability code: 0 - ignored\nMar 29 11:15:28 donatas-laptop bgpd[353550]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:15:28 donatas-laptop bgpd[353550]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\n```\n\nBefore:\n```\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [Z1DRQ-N6Z5F] 127.0.0.1(donatas-pc): Dynamic Capability MultiProtocol Extensions afi/safi invalid (bad-value/unicast)\nMar 29 11:14:54 donatas-laptop bgpd[347675]: [JTVED-VGTQQ] 127.0.0.1(donatas-pc): CAPABILITY has action: 1, code: 1, length 10\n```\n\nReported-by: Iggy Frankovic <iggyfran@amazon.com>\nSigned-off-by: Donatas Abraitis <donatas@opensourcerouting.org>\n(cherry picked from commit 30a332dad86fafd2b0b6c61d23de59ed969a219b)",
        "before_after_code_files": [
          "bgpd/bgp_packet.c||bgpd/bgp_packet.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "bgpd/bgp_packet.c||bgpd/bgp_packet.c"
          ],
          "candidate": [
            "bgpd/bgp_packet.c||bgpd/bgp_packet.c"
          ]
        }
      },
      "candidate_diff": {
        "bgpd/bgp_packet.c||bgpd/bgp_packet.c": [
          "File: bgpd/bgp_packet.c -> bgpd/bgp_packet.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "3610:    zlog_err(\"%pBP: Capability length error\", peer);",
          "3611:    bgp_notify_send(peer->connection, BGP_NOTIFY_CEASE,",
          "3612:      BGP_NOTIFY_SUBCODE_UNSPECIFIC);",
          "3613:    return BGP_Stop;",
          "3614:   }",
          "3615:   action = *pnt;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3613:    pnt += length;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "3622:      action);",
          "3623:    bgp_notify_send(peer->connection, BGP_NOTIFY_CEASE,",
          "3624:      BGP_NOTIFY_SUBCODE_UNSPECIFIC);",
          "3626:   }",
          "3628:   if (bgp_debug_neighbor_events(peer))",
          "",
          "[Removed Lines]",
          "3625:    return BGP_Stop;",
          "",
          "[Added Lines]",
          "3626:    goto done;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "3634:    zlog_err(\"%pBP: Capability length error\", peer);",
          "3635:    bgp_notify_send(peer->connection, BGP_NOTIFY_CEASE,",
          "3636:      BGP_NOTIFY_SUBCODE_UNSPECIFIC);",
          "3637:    return BGP_Stop;",
          "3638:   }",
          "3641:   if (CHECK_FLAG(peer->flags, PEER_FLAG_OVERRIDE_CAPABILITY))",
          "3644:   capability = lookup_msg(capcode_str, hdr->code, \"Unknown\");",
          "",
          "[Removed Lines]",
          "3642:    continue;",
          "",
          "[Added Lines]",
          "3638:    pnt += length;",
          "3644:    goto done;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "3654:       peer, capability,",
          "3655:       sizeof(struct capability_mp_data),",
          "3656:       hdr->length);",
          "3658:    }",
          "3660:    memcpy(&mpc, pnt + 3, sizeof(struct capability_mp_data));",
          "",
          "[Removed Lines]",
          "3657:     return BGP_Stop;",
          "",
          "[Added Lines]",
          "3659:     goto done;",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "3669:          peer, capability,",
          "3670:          iana_afi2str(pkt_afi),",
          "3671:          iana_safi2str(pkt_safi));",
          "3673:    }",
          "",
          "[Removed Lines]",
          "3672:     continue;",
          "",
          "[Added Lines]",
          "3674:     goto done;",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "3696:     if (peer_active_nego(peer))",
          "3697:      bgp_clear_route(peer, afi, safi);",
          "3698:     else",
          "3700:    }",
          "3701:    break;",
          "3702:   case CAPABILITY_CODE_RESTART:",
          "",
          "[Removed Lines]",
          "3699:      return BGP_Stop;",
          "",
          "[Added Lines]",
          "3701:      goto done;",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "3706:     bgp_notify_send(peer->connection,",
          "3707:       BGP_NOTIFY_CEASE,",
          "3708:       BGP_NOTIFY_SUBCODE_UNSPECIFIC);",
          "3710:    }",
          "3712:    bgp_dynamic_capability_graceful_restart(pnt, action,",
          "",
          "[Removed Lines]",
          "3709:     return BGP_Stop;",
          "",
          "[Added Lines]",
          "3711:     goto done;",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "3738:     bgp_notify_send(peer->connection,",
          "3739:       BGP_NOTIFY_CEASE,",
          "3740:       BGP_NOTIFY_SUBCODE_UNSPECIFIC);",
          "3742:    }",
          "3744:    uint8_t role;",
          "",
          "[Removed Lines]",
          "3741:     return BGP_Stop;",
          "",
          "[Added Lines]",
          "3743:     goto done;",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "3760:    break;",
          "3761:   }",
          "3763:   pnt += hdr->length + 3;",
          "3764:  }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3765: done:",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "048609103c339ef1264ce9ff003647974323d341",
      "candidate_info": {
        "commit_hash": "048609103c339ef1264ce9ff003647974323d341",
        "repo": "FRRouting/frr",
        "commit_url": "https://github.com/FRRouting/frr/commit/048609103c339ef1264ce9ff003647974323d341",
        "files": [
          "bgpd/bgp_open.c",
          "bgpd/bgp_open.h",
          "bgpd/bgp_packet.c"
        ],
        "message": "bgpd: Add sanity check for capability lengths before processing them\n\nThis is for CAPABILITY messages, not for OPEN message capabilities.\n\nSigned-off-by: Donatas Abraitis <donatas@opensourcerouting.org>",
        "before_after_code_files": [
          "bgpd/bgp_open.c||bgpd/bgp_open.c",
          "bgpd/bgp_open.h||bgpd/bgp_open.h",
          "bgpd/bgp_packet.c||bgpd/bgp_packet.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "bgpd/bgp_packet.c||bgpd/bgp_packet.c"
          ],
          "candidate": [
            "bgpd/bgp_packet.c||bgpd/bgp_packet.c"
          ]
        }
      },
      "candidate_diff": {
        "bgpd/bgp_open.c||bgpd/bgp_open.c": [
          "File: bgpd/bgp_open.c -> bgpd/bgp_open.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "47: };",
          "66: };",
          "",
          "[Removed Lines]",
          "50: static const size_t cap_minsizes[] = {",
          "51:   [CAPABILITY_CODE_MP] = CAPABILITY_CODE_MP_LEN,",
          "52:   [CAPABILITY_CODE_REFRESH] = CAPABILITY_CODE_REFRESH_LEN,",
          "53:   [CAPABILITY_CODE_ORF] = CAPABILITY_CODE_ORF_LEN,",
          "54:   [CAPABILITY_CODE_RESTART] = CAPABILITY_CODE_RESTART_LEN,",
          "55:   [CAPABILITY_CODE_AS4] = CAPABILITY_CODE_AS4_LEN,",
          "56:   [CAPABILITY_CODE_ADDPATH] = CAPABILITY_CODE_ADDPATH_LEN,",
          "57:   [CAPABILITY_CODE_DYNAMIC] = CAPABILITY_CODE_DYNAMIC_LEN,",
          "58:   [CAPABILITY_CODE_ENHE] = CAPABILITY_CODE_ENHE_LEN,",
          "59:   [CAPABILITY_CODE_FQDN] = CAPABILITY_CODE_MIN_FQDN_LEN,",
          "60:   [CAPABILITY_CODE_ENHANCED_RR] = CAPABILITY_CODE_ENHANCED_LEN,",
          "61:   [CAPABILITY_CODE_EXT_MESSAGE] = CAPABILITY_CODE_EXT_MESSAGE_LEN,",
          "62:   [CAPABILITY_CODE_LLGR] = CAPABILITY_CODE_LLGR_LEN,",
          "63:   [CAPABILITY_CODE_ROLE] = CAPABILITY_CODE_ROLE_LEN,",
          "64:   [CAPABILITY_CODE_SOFT_VERSION] = CAPABILITY_CODE_SOFT_VERSION_LEN,",
          "65:   [CAPABILITY_CODE_PATHS_LIMIT] = CAPABILITY_CODE_PATHS_LIMIT_LEN,",
          "",
          "[Added Lines]",
          "50: const size_t cap_minsizes[] = {",
          "51:  [CAPABILITY_CODE_MP] = CAPABILITY_CODE_MP_LEN,",
          "52:  [CAPABILITY_CODE_REFRESH] = CAPABILITY_CODE_REFRESH_LEN,",
          "53:  [CAPABILITY_CODE_ORF] = CAPABILITY_CODE_ORF_LEN,",
          "54:  [CAPABILITY_CODE_RESTART] = CAPABILITY_CODE_RESTART_LEN,",
          "55:  [CAPABILITY_CODE_AS4] = CAPABILITY_CODE_AS4_LEN,",
          "56:  [CAPABILITY_CODE_ADDPATH] = CAPABILITY_CODE_ADDPATH_LEN,",
          "57:  [CAPABILITY_CODE_DYNAMIC] = CAPABILITY_CODE_DYNAMIC_LEN,",
          "58:  [CAPABILITY_CODE_ENHE] = CAPABILITY_CODE_ENHE_LEN,",
          "59:  [CAPABILITY_CODE_FQDN] = CAPABILITY_CODE_MIN_FQDN_LEN,",
          "60:  [CAPABILITY_CODE_ENHANCED_RR] = CAPABILITY_CODE_ENHANCED_LEN,",
          "61:  [CAPABILITY_CODE_EXT_MESSAGE] = CAPABILITY_CODE_EXT_MESSAGE_LEN,",
          "62:  [CAPABILITY_CODE_LLGR] = CAPABILITY_CODE_LLGR_LEN,",
          "63:  [CAPABILITY_CODE_ROLE] = CAPABILITY_CODE_ROLE_LEN,",
          "64:  [CAPABILITY_CODE_SOFT_VERSION] = CAPABILITY_CODE_SOFT_VERSION_LEN,",
          "65:  [CAPABILITY_CODE_PATHS_LIMIT] = CAPABILITY_CODE_PATHS_LIMIT_LEN,",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "89: };",
          "",
          "[Removed Lines]",
          "73: static const size_t cap_modsizes[] = {",
          "74:   [CAPABILITY_CODE_MP] = 4,",
          "75:   [CAPABILITY_CODE_REFRESH] = 1,",
          "76:   [CAPABILITY_CODE_ORF] = 1,",
          "77:   [CAPABILITY_CODE_RESTART] = 1,",
          "78:   [CAPABILITY_CODE_AS4] = 4,",
          "79:   [CAPABILITY_CODE_ADDPATH] = 4,",
          "80:   [CAPABILITY_CODE_DYNAMIC] = 1,",
          "81:   [CAPABILITY_CODE_ENHE] = 6,",
          "82:   [CAPABILITY_CODE_FQDN] = 1,",
          "83:   [CAPABILITY_CODE_ENHANCED_RR] = 1,",
          "84:   [CAPABILITY_CODE_EXT_MESSAGE] = 1,",
          "85:   [CAPABILITY_CODE_LLGR] = 1,",
          "86:   [CAPABILITY_CODE_ROLE] = 1,",
          "87:   [CAPABILITY_CODE_SOFT_VERSION] = 1,",
          "88:   [CAPABILITY_CODE_PATHS_LIMIT] = 5,",
          "",
          "[Added Lines]",
          "73: const size_t cap_modsizes[] = {",
          "74:  [CAPABILITY_CODE_MP] = 4,",
          "75:  [CAPABILITY_CODE_REFRESH] = 1,",
          "76:  [CAPABILITY_CODE_ORF] = 1,",
          "77:  [CAPABILITY_CODE_RESTART] = 1,",
          "78:  [CAPABILITY_CODE_AS4] = 4,",
          "79:  [CAPABILITY_CODE_ADDPATH] = 4,",
          "80:  [CAPABILITY_CODE_DYNAMIC] = 1,",
          "81:  [CAPABILITY_CODE_ENHE] = 6,",
          "82:  [CAPABILITY_CODE_FQDN] = 1,",
          "83:  [CAPABILITY_CODE_ENHANCED_RR] = 1,",
          "84:  [CAPABILITY_CODE_EXT_MESSAGE] = 1,",
          "85:  [CAPABILITY_CODE_LLGR] = 1,",
          "86:  [CAPABILITY_CODE_ROLE] = 1,",
          "87:  [CAPABILITY_CODE_SOFT_VERSION] = 1,",
          "88:  [CAPABILITY_CODE_PATHS_LIMIT] = 5,",
          "",
          "---------------"
        ],
        "bgpd/bgp_open.h||bgpd/bgp_open.h": [
          "File: bgpd/bgp_open.h -> bgpd/bgp_open.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "112: extern const struct message capcode_str[];",
          "113: extern const struct message orf_type_str[];",
          "114: extern const struct message orf_mode_str[];",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "115: extern const size_t cap_minsizes[];",
          "116: extern const size_t cap_modsizes[];",
          "",
          "---------------"
        ],
        "bgpd/bgp_packet.c||bgpd/bgp_packet.c": [
          "File: bgpd/bgp_packet.c -> bgpd/bgp_packet.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "3406:  }",
          "3407: }",
          "3409: static void bgp_dynamic_capability_fqdn(uint8_t *pnt, int action,",
          "3410:      struct capability_header *hdr,",
          "3411:      struct peer *peer)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3409: static void bgp_dynamic_capability_role(uint8_t *pnt, int action,",
          "3410:      struct peer *peer)",
          "3411: {",
          "3412:  uint8_t role;",
          "3414:  if (action == CAPABILITY_ACTION_SET) {",
          "3415:   SET_FLAG(peer->cap, PEER_CAP_ROLE_RCV);",
          "3416:   memcpy(&role, pnt + 3, sizeof(role));",
          "3418:   peer->remote_role = role;",
          "3419:  } else {",
          "3420:   UNSET_FLAG(peer->cap, PEER_CAP_ROLE_RCV);",
          "3421:   peer->remote_role = ROLE_UNDEFINED;",
          "3422:  }",
          "3423: }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "3776:   capability = lookup_msg(capcode_str, hdr->code, \"Unknown\");",
          "3778:   switch (hdr->code) {",
          "3779:   case CAPABILITY_CODE_SOFT_VERSION:",
          "3780:    bgp_dynamic_capability_software_version(pnt, action,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3795:   switch (hdr->code) {",
          "3796:   case CAPABILITY_CODE_MP:",
          "3797:   case CAPABILITY_CODE_REFRESH:",
          "3798:   case CAPABILITY_CODE_ORF:",
          "3799:   case CAPABILITY_CODE_RESTART:",
          "3800:   case CAPABILITY_CODE_AS4:",
          "3801:   case CAPABILITY_CODE_ADDPATH:",
          "3802:   case CAPABILITY_CODE_DYNAMIC:",
          "3803:   case CAPABILITY_CODE_ENHE:",
          "3804:   case CAPABILITY_CODE_FQDN:",
          "3805:   case CAPABILITY_CODE_ENHANCED_RR:",
          "3806:   case CAPABILITY_CODE_EXT_MESSAGE:",
          "3807:   case CAPABILITY_CODE_ROLE:",
          "3808:   case CAPABILITY_CODE_SOFT_VERSION:",
          "3809:   case CAPABILITY_CODE_PATHS_LIMIT:",
          "3810:    if (hdr->length < cap_minsizes[hdr->code]) {",
          "3811:     zlog_info(\"%pBP: %s Capability length error: got %u, expected at least %u\",",
          "3812:        peer, capability, hdr->length,",
          "3813:        (unsigned int)cap_minsizes[hdr->code]);",
          "3814:     bgp_notify_send(peer->connection,",
          "3815:       BGP_NOTIFY_OPEN_ERR,",
          "3816:       BGP_NOTIFY_OPEN_MALFORMED_ATTR);",
          "3817:     goto done;",
          "3818:    }",
          "3819:    if (hdr->length &&",
          "3820:        hdr->length % cap_modsizes[hdr->code] != 0) {",
          "3821:     zlog_info(\"%pBP %s Capability length error: got %u, expected a multiple of %u\",",
          "3822:        peer, capability, hdr->length,",
          "3823:        (unsigned int)cap_modsizes[hdr->code]);",
          "3824:     bgp_notify_send(peer->connection,",
          "3825:       BGP_NOTIFY_OPEN_ERR,",
          "3826:       BGP_NOTIFY_OPEN_MALFORMED_ATTR);",
          "3827:     goto done;",
          "3828:    }",
          "3829:    break;",
          "3830:   default:",
          "3831:    break;",
          "3832:   }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "3832:    }",
          "3833:    break;",
          "3834:   case CAPABILITY_CODE_RESTART:",
          "3844:    bgp_dynamic_capability_graceful_restart(pnt, action,",
          "3845:         hdr, peer);",
          "3846:    break;",
          "",
          "[Removed Lines]",
          "3835:    if ((hdr->length - 2) % 4) {",
          "3836:     zlog_err(\"%pBP: Received invalid Graceful-Restart capability length %d\",",
          "3837:       peer, hdr->length);",
          "3838:     bgp_notify_send(peer->connection,",
          "3839:       BGP_NOTIFY_CEASE,",
          "3840:       BGP_NOTIFY_SUBCODE_UNSPECIFIC);",
          "3841:     goto done;",
          "3842:    }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "3868:   case CAPABILITY_CODE_EXT_MESSAGE:",
          "3869:    break;",
          "3870:   case CAPABILITY_CODE_ROLE:",
          "3891:    break;",
          "3892:   default:",
          "3893:    flog_warn(EC_BGP_UNRECOGNIZED_CAPABILITY,",
          "",
          "[Removed Lines]",
          "3871:    if (hdr->length != CAPABILITY_CODE_ROLE_LEN) {",
          "3872:     zlog_err(\"%pBP: Capability (%s) length error\",",
          "3873:       peer, capability);",
          "3874:     bgp_notify_send(peer->connection,",
          "3875:       BGP_NOTIFY_CEASE,",
          "3876:       BGP_NOTIFY_SUBCODE_UNSPECIFIC);",
          "3877:     goto done;",
          "3878:    }",
          "3880:    uint8_t role;",
          "3882:    if (action == CAPABILITY_ACTION_SET) {",
          "3883:     SET_FLAG(peer->cap, PEER_CAP_ROLE_RCV);",
          "3884:     memcpy(&role, pnt + 3, sizeof(role));",
          "3886:     peer->remote_role = role;",
          "3887:    } else {",
          "3888:     UNSET_FLAG(peer->cap, PEER_CAP_ROLE_RCV);",
          "3889:     peer->remote_role = ROLE_UNDEFINED;",
          "3890:    }",
          "",
          "[Added Lines]",
          "3918:    bgp_dynamic_capability_role(pnt, action, peer);",
          "",
          "---------------"
        ]
      }
    }
  ]
}