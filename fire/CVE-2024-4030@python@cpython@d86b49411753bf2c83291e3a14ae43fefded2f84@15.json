{
  "cve_id": "CVE-2024-4030",
  "cve_desc": "On Windows a directory returned by tempfile.mkdtemp() would not always have permissions set to restrict reading and writing to the temporary directory by other users, instead usually inheriting the correct permissions from the default location. Alternate configurations or users without a profile directory may not have the intended permissions.\n\nIf you\u2019re not using Windows or haven\u2019t changed the temporary directory location then you aren\u2019t affected by this vulnerability. On other platforms the returned directory is consistently readable and writable only by the current user.\n\nThis issue was caused by Python not supporting Unix permissions on Windows. The fix adds support for Unix \u201c700\u201d for the mkdir function on Windows which is used by mkdtemp() to ensure the newly created directory has the proper permissions.",
  "repo": "python/cpython",
  "patch_hash": "d86b49411753bf2c83291e3a14ae43fefded2f84",
  "patch_info": {
    "commit_hash": "d86b49411753bf2c83291e3a14ae43fefded2f84",
    "repo": "python/cpython",
    "commit_url": "https://github.com/python/cpython/commit/d86b49411753bf2c83291e3a14ae43fefded2f84",
    "files": [
      "Doc/whatsnew/3.13.rst",
      "Misc/NEWS.d/next/Security/2024-05-01-20-57-09.gh-issue-118486.K44KJG.rst"
    ],
    "message": "gh-118486: Update docs for CVE-2024-4030 reference (GH-118737)\n\nUpdate docs for CVE-2024-4030 reference",
    "before_after_code_files": []
  },
  "patch_diff": {},
  "candidates": [
    {
      "candidate_hash": "8a4730e95ebfceeb3a6a9b037444db3eba4d1123",
      "candidate_info": {
        "commit_hash": "8a4730e95ebfceeb3a6a9b037444db3eba4d1123",
        "repo": "python/cpython",
        "commit_url": "https://github.com/python/cpython/commit/8a4730e95ebfceeb3a6a9b037444db3eba4d1123",
        "files": [
          "Lib/test/test_tkinter/test_misc.py"
        ],
        "message": "[3.13] Add Tkinter tests for different events (GH-118778) (GH-119091)\n\n(cherry picked from commit b6839942a8906fccdd64e749abeefe8a61ce7e03)\n\nCo-authored-by: Serhiy Storchaka <storchaka@gmail.com>",
        "before_after_code_files": [
          "Lib/test/test_tkinter/test_misc.py||Lib/test/test_tkinter/test_misc.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/AcreetionOS-Linux/python/pull/2"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "Lib/test/test_tkinter/test_misc.py||Lib/test/test_tkinter/test_misc.py": [
          "File: Lib/test/test_tkinter/test_misc.py -> Lib/test/test_tkinter/test_misc.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "532:                          1.0 if self.wantobjects else '1.0')",
          "535: class BindTest(AbstractTkTest, unittest.TestCase):",
          "537:     def setUp(self):",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "535: class EventTest(AbstractTkTest, unittest.TestCase):",
          "537:     def test_focus(self):",
          "538:         f = tkinter.Frame(self.root, width=150, height=100)",
          "539:         f.pack()",
          "540:         self.root.wait_visibility()  # needed on Windows",
          "541:         self.root.update_idletasks()",
          "543:         events = []",
          "544:         f.bind('<FocusIn>', events.append)",
          "546:         f.focus_force()",
          "547:         self.root.update()",
          "548:         self.assertEqual(len(events), 1, events)",
          "549:         e = events[0]",
          "550:         self.assertIs(e.type, tkinter.EventType.FocusIn)",
          "551:         self.assertIs(e.widget, f)",
          "552:         self.assertIsInstance(e.serial, int)",
          "553:         self.assertEqual(e.time, '??')",
          "554:         self.assertIs(e.send_event, False)",
          "555:         self.assertFalse(hasattr(e, 'focus'))",
          "556:         self.assertEqual(e.num, '??')",
          "557:         self.assertEqual(e.state, '??')",
          "558:         self.assertEqual(e.char, '??')",
          "559:         self.assertEqual(e.keycode, '??')",
          "560:         self.assertEqual(e.keysym, '??')",
          "561:         self.assertEqual(e.keysym_num, '??')",
          "562:         self.assertEqual(e.width, '??')",
          "563:         self.assertEqual(e.height, '??')",
          "564:         self.assertEqual(e.x, '??')",
          "565:         self.assertEqual(e.y, '??')",
          "566:         self.assertEqual(e.x_root, '??')",
          "567:         self.assertEqual(e.y_root, '??')",
          "568:         self.assertEqual(e.delta, 0)",
          "569:         self.assertEqual(repr(e), '<FocusIn event>')",
          "571:     def test_configure(self):",
          "572:         f = tkinter.Frame(self.root, width=150, height=100)",
          "573:         f.pack()",
          "574:         self.root.wait_visibility()  # needed on Windows",
          "575:         self.root.update_idletasks()",
          "577:         events = []",
          "578:         f.bind('<Configure>', events.append)",
          "580:         f.configure(height=120, borderwidth=10)",
          "581:         self.assertEqual(len(events), 1, events)",
          "582:         e = events[0]",
          "583:         self.assertIs(e.type, tkinter.EventType.Configure)",
          "584:         self.assertIs(e.widget, f)",
          "585:         self.assertIsInstance(e.serial, int)",
          "586:         self.assertEqual(e.time, '??')",
          "587:         self.assertIs(e.send_event, False)",
          "588:         self.assertFalse(hasattr(e, 'focus'))",
          "589:         self.assertEqual(e.num, '??')",
          "590:         self.assertEqual(e.state, '??')",
          "591:         self.assertEqual(e.char, '??')",
          "592:         self.assertEqual(e.keycode, '??')",
          "593:         self.assertEqual(e.keysym, '??')",
          "594:         self.assertEqual(e.keysym_num, '??')",
          "595:         self.assertEqual(e.width, 150)",
          "596:         self.assertEqual(e.height, 100)",
          "597:         self.assertEqual(e.x, 0)",
          "598:         self.assertEqual(e.y, 0)",
          "599:         self.assertEqual(e.x_root, '??')",
          "600:         self.assertEqual(e.y_root, '??')",
          "601:         self.assertEqual(e.delta, 0)",
          "602:         self.assertEqual(repr(e), '<Configure event x=0 y=0 width=150 height=100>')",
          "604:     def test_event_generate_key_press(self):",
          "605:         f = tkinter.Frame(self.root, width=150, height=100)",
          "606:         f.pack()",
          "607:         self.root.wait_visibility()  # needed on Windows",
          "608:         self.root.update_idletasks()",
          "610:         events = []",
          "611:         f.bind('<KeyPress>', events.append)",
          "612:         f.focus_force()",
          "614:         f.event_generate('<Alt-z>')",
          "615:         self.assertEqual(len(events), 1, events)",
          "616:         e = events[0]",
          "617:         self.assertIs(e.type, tkinter.EventType.KeyPress)",
          "618:         self.assertIs(e.widget, f)",
          "619:         self.assertIsInstance(e.serial, int)",
          "620:         self.assertEqual(e.time, 0)",
          "621:         self.assertIs(e.send_event, False)",
          "622:         self.assertFalse(hasattr(e, 'focus'))",
          "623:         self.assertEqual(e.num, '??')",
          "624:         self.assertIsInstance(e.state, int)",
          "625:         self.assertNotEqual(e.state, 0)",
          "626:         self.assertEqual(e.char, 'z')",
          "627:         self.assertIsInstance(e.keycode, int)",
          "628:         self.assertNotEqual(e.keycode, 0)",
          "629:         self.assertEqual(e.keysym, 'z')",
          "630:         self.assertEqual(e.keysym_num, ord('z'))",
          "631:         self.assertEqual(e.width, '??')",
          "632:         self.assertEqual(e.height, '??')",
          "633:         self.assertEqual(e.x, -1 - f.winfo_rootx())",
          "634:         self.assertEqual(e.y, -1 - f.winfo_rooty())",
          "635:         self.assertEqual(e.x_root, -1)",
          "636:         self.assertEqual(e.y_root, -1)",
          "637:         self.assertEqual(e.delta, 0)",
          "638:         self.assertEqual(repr(e),",
          "639:             f\"<KeyPress event state={e.state:#x} \"",
          "640:             f\"keysym=z keycode={e.keycode} char='z' x={e.x} y={e.y}>\")",
          "642:     def test_event_generate_enter(self):",
          "643:         f = tkinter.Frame(self.root, width=150, height=100)",
          "644:         f.pack()",
          "645:         self.root.wait_visibility()  # needed on Windows",
          "646:         self.root.update_idletasks()",
          "648:         events = []",
          "649:         f.bind('<Enter>', events.append)",
          "651:         f.event_generate('<Enter>', x=100, y=50)",
          "652:         self.assertEqual(len(events), 1, events)",
          "653:         e = events[0]",
          "654:         self.assertIs(e.type, tkinter.EventType.Enter)",
          "655:         self.assertIs(e.widget, f)",
          "656:         self.assertIsInstance(e.serial, int)",
          "657:         self.assertEqual(e.time, 0)",
          "658:         self.assertIs(e.send_event, False)",
          "659:         self.assertIs(e.focus, False)",
          "660:         self.assertEqual(e.num, '??')",
          "661:         self.assertEqual(e.state, 0)",
          "662:         self.assertEqual(e.char, '??')",
          "663:         self.assertEqual(e.keycode, '??')",
          "664:         self.assertEqual(e.keysym, '??')",
          "665:         self.assertEqual(e.keysym_num, '??')",
          "666:         self.assertEqual(e.width, '??')",
          "667:         self.assertEqual(e.height, '??')",
          "668:         self.assertEqual(e.x, 100)",
          "669:         self.assertEqual(e.y, 50)",
          "670:         self.assertEqual(e.x_root, 100 + f.winfo_rootx())",
          "671:         self.assertEqual(e.y_root, 50 + f.winfo_rooty())",
          "672:         self.assertEqual(e.delta, 0)",
          "673:         self.assertEqual(repr(e), '<Enter event focus=False x=100 y=50>')",
          "675:     def test_event_generate_button_press(self):",
          "676:         f = tkinter.Frame(self.root, width=150, height=100)",
          "677:         f.pack()",
          "678:         self.root.wait_visibility()  # needed on Windows",
          "679:         self.root.update_idletasks()",
          "681:         events = []",
          "682:         f.bind('<ButtonPress>', events.append)",
          "683:         f.focus_force()",
          "685:         f.event_generate('<Button-1>', x=100, y=50)",
          "686:         self.assertEqual(len(events), 1, events)",
          "687:         e = events[0]",
          "688:         self.assertIs(e.type, tkinter.EventType.ButtonPress)",
          "689:         self.assertIs(e.widget, f)",
          "690:         self.assertIsInstance(e.serial, int)",
          "691:         self.assertEqual(e.time, 0)",
          "692:         self.assertIs(e.send_event, False)",
          "693:         self.assertFalse(hasattr(e, 'focus'))",
          "694:         self.assertEqual(e.num, 1)",
          "695:         self.assertEqual(e.state, 0)",
          "696:         self.assertEqual(e.char, '??')",
          "697:         self.assertEqual(e.keycode, '??')",
          "698:         self.assertEqual(e.keysym, '??')",
          "699:         self.assertEqual(e.keysym_num, '??')",
          "700:         self.assertEqual(e.width, '??')",
          "701:         self.assertEqual(e.height, '??')",
          "702:         self.assertEqual(e.x, 100)",
          "703:         self.assertEqual(e.y, 50)",
          "704:         self.assertEqual(e.x_root, f.winfo_rootx() + 100)",
          "705:         self.assertEqual(e.y_root, f.winfo_rooty() + 50)",
          "706:         self.assertEqual(e.delta, 0)",
          "707:         self.assertEqual(repr(e), '<ButtonPress event num=1 x=100 y=50>')",
          "709:     def test_event_generate_motion(self):",
          "710:         f = tkinter.Frame(self.root, width=150, height=100)",
          "711:         f.pack()",
          "712:         self.root.wait_visibility()  # needed on Windows",
          "713:         self.root.update_idletasks()",
          "715:         events = []",
          "716:         f.bind('<Motion>', events.append)",
          "717:         f.focus_force()",
          "719:         f.event_generate('<B1-Motion>', x=100, y=50)",
          "720:         self.assertEqual(len(events), 1, events)",
          "721:         e = events[0]",
          "722:         self.assertIs(e.type, tkinter.EventType.Motion)",
          "723:         self.assertIs(e.widget, f)",
          "724:         self.assertIsInstance(e.serial, int)",
          "725:         self.assertEqual(e.time, 0)",
          "726:         self.assertIs(e.send_event, False)",
          "727:         self.assertFalse(hasattr(e, 'focus'))",
          "728:         self.assertEqual(e.num, '??')",
          "729:         self.assertEqual(e.state, 0x100)",
          "730:         self.assertEqual(e.char, '??')",
          "731:         self.assertEqual(e.keycode, '??')",
          "732:         self.assertEqual(e.keysym, '??')",
          "733:         self.assertEqual(e.keysym_num, '??')",
          "734:         self.assertEqual(e.width, '??')",
          "735:         self.assertEqual(e.height, '??')",
          "736:         self.assertEqual(e.x, 100)",
          "737:         self.assertEqual(e.y, 50)",
          "738:         self.assertEqual(e.x_root, f.winfo_rootx() + 100)",
          "739:         self.assertEqual(e.y_root, f.winfo_rooty() + 50)",
          "740:         self.assertEqual(e.delta, 0)",
          "741:         self.assertEqual(repr(e), '<Motion event state=Button1 x=100 y=50>')",
          "743:     def test_event_generate_mouse_wheel(self):",
          "744:         f = tkinter.Frame(self.root, width=150, height=100)",
          "745:         f.pack()",
          "746:         self.root.wait_visibility()  # needed on Windows",
          "747:         self.root.update_idletasks()",
          "749:         events = []",
          "750:         f.bind('<MouseWheel>', events.append)",
          "751:         f.focus_force()",
          "753:         f.event_generate('<MouseWheel>', x=100, y=50, delta=-5)",
          "754:         self.assertEqual(len(events), 1, events)",
          "755:         e = events[0]",
          "756:         self.assertIs(e.type, tkinter.EventType.MouseWheel)",
          "757:         self.assertIs(e.widget, f)",
          "758:         self.assertIsInstance(e.serial, int)",
          "759:         self.assertIs(e.send_event, False)",
          "760:         self.assertFalse(hasattr(e, 'focus'))",
          "761:         self.assertEqual(e.time, 0)",
          "762:         self.assertEqual(e.num, '??')",
          "763:         self.assertEqual(e.state, 0)",
          "764:         self.assertEqual(e.char, '??')",
          "765:         self.assertEqual(e.keycode, '??')",
          "766:         self.assertEqual(e.keysym, '??')",
          "767:         self.assertEqual(e.keysym_num, '??')",
          "768:         self.assertEqual(e.width, '??')",
          "769:         self.assertEqual(e.height, '??')",
          "770:         self.assertEqual(e.x, 100)",
          "771:         self.assertEqual(e.y, 50)",
          "772:         self.assertEqual(e.x_root, f.winfo_rootx() + 100)",
          "773:         self.assertEqual(e.y_root, f.winfo_rooty() + 50)",
          "774:         self.assertEqual(e.delta, -5)",
          "775:         self.assertEqual(repr(e), '<MouseWheel event delta=-5 x=100 y=50>')",
          "777:     def test_generate_event_virtual_event(self):",
          "778:         f = tkinter.Frame(self.root, width=150, height=100)",
          "779:         f.pack()",
          "780:         self.root.wait_visibility()  # needed on Windows",
          "781:         self.root.update_idletasks()",
          "783:         events = []",
          "784:         f.bind('<<Spam>>', events.append)",
          "785:         f.focus_force()",
          "787:         f.event_generate('<<Spam>>', x=50)",
          "788:         self.assertEqual(len(events), 1, events)",
          "789:         e = events[0]",
          "790:         self.assertIs(e.type, tkinter.EventType.VirtualEvent)",
          "791:         self.assertIs(e.widget, f)",
          "792:         self.assertIsInstance(e.serial, int)",
          "793:         self.assertEqual(e.time, 0)",
          "794:         self.assertIs(e.send_event, False)",
          "795:         self.assertFalse(hasattr(e, 'focus'))",
          "796:         self.assertEqual(e.num, '??')",
          "797:         self.assertEqual(e.state, 0)",
          "798:         self.assertEqual(e.char, '??')",
          "799:         self.assertEqual(e.keycode, '??')",
          "800:         self.assertEqual(e.keysym, '??')",
          "801:         self.assertEqual(e.keysym_num, '??')",
          "802:         self.assertEqual(e.width, '??')",
          "803:         self.assertEqual(e.height, '??')",
          "804:         self.assertEqual(e.x, 50)",
          "805:         self.assertEqual(e.y, 0)",
          "806:         self.assertEqual(e.x_root, f.winfo_rootx() + 50)",
          "807:         self.assertEqual(e.y_root, -1)",
          "808:         self.assertEqual(e.delta, 0)",
          "809:         self.assertEqual(repr(e),",
          "810:             f\"<VirtualEvent event x=50 y=0>\")",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "3b908072578d44673b8f278117c9d4c3d42a3127",
      "candidate_info": {
        "commit_hash": "3b908072578d44673b8f278117c9d4c3d42a3127",
        "repo": "python/cpython",
        "commit_url": "https://github.com/python/cpython/commit/3b908072578d44673b8f278117c9d4c3d42a3127",
        "files": [
          "Lib/idlelib/config.py"
        ],
        "message": "[3.13] IDLE: fix url in config.py comment (GH-119198) (#119199)\n\nIDLE: fix url in config.py comment (GH-119198)\n(cherry picked from commit 357f5a1f73684d0c126a5e8f79d76ff3641c4d52)\n\nCo-authored-by: Terry Jan Reedy <tjreedy@udel.edu>",
        "before_after_code_files": [
          "Lib/idlelib/config.py||Lib/idlelib/config.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/AcreetionOS-Linux/python/pull/2"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "Lib/idlelib/config.py||Lib/idlelib/config.py": [
          "File: Lib/idlelib/config.py -> Lib/idlelib/config.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "159:         self.userCfg = {}",
          "160:         self.cfg = {}  # TODO use to select userCfg vs defaultCfg",
          "161:         # self.blink_off_time = <first editor text>['insertofftime']",
          "164:         if not _utest:",
          "165:             self.CreateConfigHandlers()",
          "",
          "[Removed Lines]",
          "162:         # See https:/bugs.python.org/issue4630, msg356516.",
          "",
          "[Added Lines]",
          "162:         # See https://bugs.python.org/issue4630#msg356516.",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "d98d6b1776996484e05ec6b755a6770977a5000a",
      "candidate_info": {
        "commit_hash": "d98d6b1776996484e05ec6b755a6770977a5000a",
        "repo": "python/cpython",
        "commit_url": "https://github.com/python/cpython/commit/d98d6b1776996484e05ec6b755a6770977a5000a",
        "files": [
          "Include/cpython/pystate.h",
          "Include/internal/pycore_ceval.h",
          "Lib/test/test_importlib/test_threaded_import.py",
          "Python/ceval_gil.c",
          "Python/pystate.c"
        ],
        "message": "[3.13] gh-118727: Don't drop the GIL in `drop_gil()` unless the current thread holds it (GH-118745) (#119474)\n\n`drop_gil()` assumes that its caller is attached, which means that the current\nthread holds the GIL if and only if the GIL is enabled, and the enabled-state\nof the GIL won't change. This isn't true, though, because `detach_thread()`\ncalls `_PyEval_ReleaseLock()` after detaching and\n`_PyThreadState_DeleteCurrent()` calls it after removing the current thread\nfrom consideration for stop-the-world requests (effectively detaching it).\n\nFix this by remembering whether or not a thread acquired the GIL when it last\nattached, in `PyThreadState._status.holds_gil`, and check this in `drop_gil()`\ninstead of `gil->enabled`.\n\nThis fixes a crash in `test_multiprocessing_pool_circular_import()`, so I've\nreenabled it.\n(cherry picked from commit be1dfccdf2c5c7671b8a549e969b8cf7d60d9936)\n\nCo-authored-by: Brett Simmers <swtaarrs@users.noreply.github.com>",
        "before_after_code_files": [
          "Include/cpython/pystate.h||Include/cpython/pystate.h",
          "Include/internal/pycore_ceval.h||Include/internal/pycore_ceval.h",
          "Lib/test/test_importlib/test_threaded_import.py||Lib/test/test_importlib/test_threaded_import.py",
          "Python/ceval_gil.c||Python/ceval_gil.c",
          "Python/pystate.c||Python/pystate.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/AcreetionOS-Linux/python/pull/2"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "Include/cpython/pystate.h||Include/cpython/pystate.h": [
          "File: Include/cpython/pystate.h -> Include/cpython/pystate.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "83:         unsigned int bound_gilstate:1;",
          "85:         unsigned int active:1;",
          "88:         unsigned int finalizing:1;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "87:         unsigned int holds_gil:1;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "90:         unsigned int finalized:1;",
          "94:     } _status;",
          "95: #ifdef Py_BUILD_CORE",
          "96: #  define _PyThreadState_WHENCE_NOTSET -1",
          "",
          "[Removed Lines]",
          "93:         unsigned int :24;",
          "",
          "[Added Lines]",
          "95:         unsigned int :23;",
          "",
          "---------------"
        ],
        "Include/internal/pycore_ceval.h||Include/internal/pycore_ceval.h": [
          "File: Include/internal/pycore_ceval.h -> Include/internal/pycore_ceval.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "131: extern void _PyEval_InitGIL(PyThreadState *tstate, int own_gil);",
          "132: extern void _PyEval_FiniGIL(PyInterpreterState *interp);",
          "140: #ifdef Py_GIL_DISABLED",
          "",
          "[Removed Lines]",
          "136: extern int _PyEval_AcquireLock(PyThreadState *tstate);",
          "138: extern void _PyEval_ReleaseLock(PyInterpreterState *, PyThreadState *);",
          "",
          "[Added Lines]",
          "134: extern void _PyEval_AcquireLock(PyThreadState *tstate);",
          "136: extern void _PyEval_ReleaseLock(PyInterpreterState *, PyThreadState *,",
          "137:                                 int final_release);",
          "",
          "---------------"
        ],
        "Lib/test/test_importlib/test_threaded_import.py||Lib/test/test_importlib/test_threaded_import.py": [
          "File: Lib/test/test_importlib/test_threaded_import.py -> Lib/test/test_importlib/test_threaded_import.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "17: from test.support import verbose",
          "18: from test.support.import_helper import forget, mock_register_at_fork",
          "19: from test.support.os_helper import (TESTFN, unlink, rmtree)",
          "22: threading_helper.requires_working_threading(module=True)",
          "",
          "[Removed Lines]",
          "20: from test.support import script_helper, threading_helper, requires_gil_enabled",
          "",
          "[Added Lines]",
          "20: from test.support import script_helper, threading_helper",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "248:                           'partial', 'cfimport.py')",
          "249:         script_helper.assert_python_ok(fn)",
          "254:     def test_multiprocessing_pool_circular_import(self):",
          "255:         # Regression test for bpo-41567",
          "256:         fn = os.path.join(os.path.dirname(__file__),",
          "",
          "[Removed Lines]",
          "251:     # gh-118727 and gh-118729: pool_in_threads.py may crash in free-threaded",
          "252:     # builds, which can hang the Tsan test so temporarily skip it for now.",
          "253:     @requires_gil_enabled(\"gh-118727: test may crash in free-threaded builds\")",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "Python/ceval_gil.c||Python/ceval_gil.c": [
          "File: Python/ceval_gil.c -> Python/ceval_gil.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "205: }",
          "206: #endif",
          "210: {",
          "211:     MUTEX_LOCK(gil->mutex);",
          "212:     _Py_ANNOTATE_RWLOCK_RELEASED(&gil->locked, /*is_write=*/1);",
          "213:     _Py_atomic_store_int_relaxed(&gil->locked, 0);",
          "214:     COND_SIGNAL(gil->cond);",
          "215:     MUTEX_UNLOCK(gil->mutex);",
          "216: }",
          "218: static void",
          "220: {",
          "221:     struct _ceval_state *ceval = &interp->ceval;",
          "223:        the GIL for the last time in this thread.  This is particularly",
          "224:        relevant when the current thread state is finalizing or its",
          "225:        interpreter is finalizing (either may be in an inconsistent",
          "226:        state).  In that case the current thread will definitely",
          "231:     struct _gil_runtime_state *gil = ceval->gil;",
          "232: #ifdef Py_GIL_DISABLED",
          "234:         return;",
          "235:     }",
          "236: #endif",
          "",
          "[Removed Lines]",
          "208: static void",
          "209: drop_gil_impl(struct _gil_runtime_state *gil)",
          "219: drop_gil(PyInterpreterState *interp, PyThreadState *tstate)",
          "233:     if (!_Py_atomic_load_int_relaxed(&gil->enabled)) {",
          "",
          "[Added Lines]",
          "208: static inline void",
          "209: drop_gil_impl(PyThreadState *tstate, struct _gil_runtime_state *gil)",
          "214:     if (tstate != NULL) {",
          "215:         tstate->_status.holds_gil = 0;",
          "216:     }",
          "222: drop_gil(PyInterpreterState *interp, PyThreadState *tstate, int final_release)",
          "234:     assert(final_release || tstate != NULL);",
          "240:     if (tstate != NULL && !tstate->_status.holds_gil) {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "238:         Py_FatalError(\"drop_gil: GIL is not locked\");",
          "239:     }",
          "244:            under our feet using PyThreadState_Swap(). Fix the GIL last",
          "246:         _Py_atomic_store_ptr_relaxed(&gil->last_holder, tstate);",
          "247:     }",
          "251: #ifdef FORCE_SWITCHING",
          "261:         _Py_eval_breaker_bit_is_set(tstate, _PY_GIL_DROP_REQUEST_BIT)) {",
          "262:         MUTEX_LOCK(gil->switch_mutex);",
          "",
          "[Removed Lines]",
          "242:     if (tstate != NULL) {",
          "249:     drop_gil_impl(gil);",
          "253:        the last time in this thread.  In that case there's a possible",
          "254:        race with tstate->interp getting deleted after gil->mutex is",
          "255:        unlocked and before the following code runs, leading to a crash.",
          "256:        We can use (tstate == NULL) to indicate the thread is done with",
          "257:        the GIL, and that's the only time we might delete the",
          "258:        interpreter, so checking tstate first prevents the crash.",
          "260:     if (tstate != NULL &&",
          "",
          "[Added Lines]",
          "248:     if (!final_release) {",
          "255:     drop_gil_impl(tstate, gil);",
          "259:        case there's a possible race with tstate->interp getting deleted after",
          "260:        gil->mutex is unlocked and before the following code runs, leading to a",
          "261:        crash.  We can use final_release to indicate the thread is done with the",
          "262:        GIL, and that's the only time we might delete the interpreter.  See",
          "264:     if (!final_release &&",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "284:    tstate must be non-NULL.",
          "288: take_gil(PyThreadState *tstate)",
          "289: {",
          "290:     int err = errno;",
          "",
          "[Removed Lines]",
          "287: static int",
          "",
          "[Added Lines]",
          "291: static void",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "309:     struct _gil_runtime_state *gil = interp->ceval.gil;",
          "310: #ifdef Py_GIL_DISABLED",
          "311:     if (!_Py_atomic_load_int_relaxed(&gil->enabled)) {",
          "313:     }",
          "314: #endif",
          "",
          "[Removed Lines]",
          "312:         return 0;",
          "",
          "[Added Lines]",
          "316:         return;",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "358:     if (!_Py_atomic_load_int_relaxed(&gil->enabled)) {",
          "362:         COND_SIGNAL(gil->cond);",
          "363:         MUTEX_UNLOCK(gil->mutex);",
          "365:     }",
          "366: #endif",
          "",
          "[Removed Lines]",
          "364:         return 0;",
          "",
          "[Added Lines]",
          "368:         return;",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "393:            in take_gil() while the main thread called",
          "395:         MUTEX_UNLOCK(gil->mutex);",
          "399:         PyThread_exit_thread();",
          "400:     }",
          "401:     assert(_PyThreadState_CheckConsistency(tstate));",
          "403:     _Py_unset_eval_breaker_bit(tstate, _PY_GIL_DROP_REQUEST_BIT);",
          "404:     update_eval_breaker_for_thread(interp, tstate);",
          "406:     MUTEX_UNLOCK(gil->mutex);",
          "408:     errno = err;",
          "410: }",
          "412: void _PyEval_SetSwitchInterval(unsigned long microseconds)",
          "",
          "[Removed Lines]",
          "398:         drop_gil(interp, NULL);",
          "409:     return 1;",
          "",
          "[Added Lines]",
          "402:         drop_gil(interp, NULL, 1);",
          "407:     tstate->_status.holds_gil = 1;",
          "414:     return;",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "451: static inline int",
          "452: current_thread_holds_gil(struct _gil_runtime_state *gil, PyThreadState *tstate)",
          "453: {",
          "458: }",
          "459: #endif",
          "",
          "[Removed Lines]",
          "454:     if (((PyThreadState*)_Py_atomic_load_ptr_relaxed(&gil->last_holder)) != tstate) {",
          "455:         return 0;",
          "456:     }",
          "457:     return _Py_atomic_load_int_relaxed(&gil->locked);",
          "",
          "[Added Lines]",
          "459:     int holds_gil = tstate->_status.holds_gil;",
          "463:     int locked = _Py_atomic_load_int_relaxed(&gil->locked);",
          "464:     int is_last_holder =",
          "465:         ((PyThreadState*)_Py_atomic_load_ptr_relaxed(&gil->last_holder)) == tstate;",
          "466:     assert(!holds_gil || locked);",
          "467:     assert(!holds_gil || is_last_holder);",
          "469:     return holds_gil;",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "564:        We therefore avoid PyThreadState_Get() which dumps a fatal error",
          "567: }",
          "570: _PyEval_AcquireLock(PyThreadState *tstate)",
          "571: {",
          "572:     _Py_EnsureTstateNotNULL(tstate);",
          "574: }",
          "576: void",
          "578: {",
          "583: }",
          "585: void",
          "",
          "[Removed Lines]",
          "566:     drop_gil(tstate->interp, tstate);",
          "569: int",
          "573:     return take_gil(tstate);",
          "577: _PyEval_ReleaseLock(PyInterpreterState *interp, PyThreadState *tstate)",
          "581:     assert(tstate == NULL || tstate->interp == interp);",
          "582:     drop_gil(interp, tstate);",
          "",
          "[Added Lines]",
          "578:     drop_gil(tstate->interp, tstate, 0);",
          "581: void",
          "585:     take_gil(tstate);",
          "589: _PyEval_ReleaseLock(PyInterpreterState *interp,",
          "590:                     PyThreadState *tstate,",
          "591:                     int final_release)",
          "593:     assert(tstate != NULL);",
          "594:     assert(tstate->interp == interp);",
          "595:     drop_gil(interp, tstate, final_release);",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "1140:         return 1;",
          "1141:     }",
          "1142:     return 0;",
          "",
          "[Removed Lines]",
          "1139:         drop_gil_impl(gil);",
          "",
          "[Added Lines]",
          "1152:         drop_gil_impl(tstate, gil);",
          "1157:         _Py_unset_eval_breaker_bit(tstate, _PY_GIL_DROP_REQUEST_BIT);",
          "",
          "---------------"
        ],
        "Python/pystate.c||Python/pystate.c": [
          "File: Python/pystate.c -> Python/pystate.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1843: #endif",
          "1844:     current_fast_clear(tstate->interp->runtime);",
          "1845:     tstate_delete_common(tstate);",
          "1847:     free_threadstate((_PyThreadStateImpl *)tstate);",
          "1848: }",
          "",
          "[Removed Lines]",
          "1846:     _PyEval_ReleaseLock(tstate->interp, NULL);",
          "",
          "[Added Lines]",
          "1846:     _PyEval_ReleaseLock(tstate->interp, tstate, 1);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2070:     while (1) {",
          "2074:         current_fast_set(&_PyRuntime, tstate);",
          "",
          "[Removed Lines]",
          "2071:         int acquired_gil = _PyEval_AcquireLock(tstate);",
          "",
          "[Added Lines]",
          "2071:         _PyEval_AcquireLock(tstate);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "2079:         }",
          "2081: #ifdef Py_GIL_DISABLED",
          "2088:             tstate_set_detached(tstate, _Py_THREAD_DETACHED);",
          "2089:             tstate_deactivate(tstate);",
          "2090:             current_fast_clear(&_PyRuntime);",
          "2091:             continue;",
          "2092:         }",
          "2093:         _Py_qsbr_attach(((_PyThreadStateImpl *)tstate)->qsbr);",
          "2096: #endif",
          "2097:         break;",
          "2098:     }",
          "",
          "[Removed Lines]",
          "2082:         if (_PyEval_IsGILEnabled(tstate) != acquired_gil) {",
          "2087:             assert(!acquired_gil);",
          "2094: #else",
          "2095:         (void)acquired_gil;",
          "",
          "[Added Lines]",
          "2082:         if (_PyEval_IsGILEnabled(tstate) && !tstate->_status.holds_gil) {",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "2123:     tstate_deactivate(tstate);",
          "2124:     tstate_set_detached(tstate, detached_state);",
          "2125:     current_fast_clear(&_PyRuntime);",
          "2127: }",
          "2129: void",
          "",
          "[Removed Lines]",
          "2126:     _PyEval_ReleaseLock(tstate->interp, tstate);",
          "",
          "[Added Lines]",
          "2123:     _PyEval_ReleaseLock(tstate->interp, tstate, 0);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "1f2f9c4ff5c8f1b362766fc4fd38a665674504d1",
      "candidate_info": {
        "commit_hash": "1f2f9c4ff5c8f1b362766fc4fd38a665674504d1",
        "repo": "python/cpython",
        "commit_url": "https://github.com/python/cpython/commit/1f2f9c4ff5c8f1b362766fc4fd38a665674504d1",
        "files": [
          "Lib/test/libregrtest/testresult.py",
          "Lib/test/libregrtest/utils.py",
          "Lib/test/test_regrtest.py",
          "Misc/NEWS.d/next/Tests/2024-07-01-09-04-32.gh-issue-121188.XbuTVa.rst"
        ],
        "message": "[3.13] gh-121188: Sanitize invalid XML characters in regrtest (GH-121195) (#121204)\n\ngh-121188: Sanitize invalid XML characters in regrtest (GH-121195)\n\nWhen creating the JUnit XML file, regrtest now escapes characters\nwhich are invalid in XML, such as the chr(27) control character used\nin ANSI escape sequences.\n(cherry picked from commit af8c3d7a26d605099f5b3406a8d33ecddb77e8fb)\n\nCo-authored-by: Victor Stinner <vstinner@python.org>",
        "before_after_code_files": [
          "Lib/test/libregrtest/testresult.py||Lib/test/libregrtest/testresult.py",
          "Lib/test/libregrtest/utils.py||Lib/test/libregrtest/utils.py",
          "Lib/test/test_regrtest.py||Lib/test/test_regrtest.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/AcreetionOS-Linux/python/pull/2"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "Lib/test/libregrtest/testresult.py||Lib/test/libregrtest/testresult.py": [
          "File: Lib/test/libregrtest/testresult.py -> Lib/test/libregrtest/testresult.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "9: import traceback",
          "10: import unittest",
          "11: from test import support",
          "13: class RegressionTestResult(unittest.TextTestResult):",
          "14:     USE_XML = False",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "12: from test.libregrtest.utils import sanitize_xml",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "65:         if capture:",
          "66:             if self._stdout_buffer is not None:",
          "67:                 stdout = self._stdout_buffer.getvalue().rstrip()",
          "69:             if self._stderr_buffer is not None:",
          "70:                 stderr = self._stderr_buffer.getvalue().rstrip()",
          "73:         for k, v in args.items():",
          "74:             if not k or not v:",
          "75:                 continue",
          "76:             e2 = ET.SubElement(e, k)",
          "77:             if hasattr(v, 'items'):",
          "78:                 for k2, v2 in v.items():",
          "79:                     if k2:",
          "81:                     else:",
          "83:             else:",
          "86:     @classmethod",
          "87:     def __makeErrorDict(cls, err_type, err_value, err_tb):",
          "",
          "[Removed Lines]",
          "68:                 ET.SubElement(e, 'system-out').text = stdout",
          "71:                 ET.SubElement(e, 'system-err').text = stderr",
          "80:                         e2.set(k2, str(v2))",
          "82:                         e2.text = str(v2)",
          "84:                 e2.text = str(v)",
          "",
          "[Added Lines]",
          "69:                 ET.SubElement(e, 'system-out').text = sanitize_xml(stdout)",
          "72:                 ET.SubElement(e, 'system-err').text = sanitize_xml(stderr)",
          "82:                         e2.set(k2, sanitize_xml(str(v2)))",
          "84:                         e2.text = sanitize_xml(str(v2))",
          "86:                 e2.text = sanitize_xml(str(v))",
          "",
          "---------------"
        ],
        "Lib/test/libregrtest/utils.py||Lib/test/libregrtest/utils.py": [
          "File: Lib/test/libregrtest/utils.py -> Lib/test/libregrtest/utils.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: import os.path",
          "6: import platform",
          "7: import random",
          "8: import shlex",
          "9: import signal",
          "10: import subprocess",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "8: import re",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "712:         pass",
          "714:     return None",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "718: ILLEGAL_XML_CHARS_RE = re.compile(",
          "719:     '['",
          "720:     # Control characters; newline (\\x0A and \\x0D) and TAB (\\x09) are legal",
          "721:     '\\x00-\\x08\\x0B\\x0C\\x0E-\\x1F'",
          "722:     # Surrogate characters",
          "723:     '\\uD800-\\uDFFF'",
          "724:     # Special Unicode characters",
          "725:     '\\uFFFE'",
          "726:     '\\uFFFF'",
          "727:     # Match multiple sequential invalid characters for better effiency",
          "728:     ']+')",
          "730: def _sanitize_xml_replace(regs):",
          "731:     text = regs[0]",
          "732:     return ''.join(f'\\\\x{ord(ch):02x}' if ch <= '\\xff' else ascii(ch)[1:-1]",
          "733:                    for ch in text)",
          "735: def sanitize_xml(text):",
          "736:     return ILLEGAL_XML_CHARS_RE.sub(_sanitize_xml_replace, text)",
          "",
          "---------------"
        ],
        "Lib/test/test_regrtest.py||Lib/test/test_regrtest.py": [
          "File: Lib/test/test_regrtest.py -> Lib/test/test_regrtest.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "21: import tempfile",
          "22: import textwrap",
          "23: import unittest",
          "24: from test import support",
          "25: from test.support import os_helper, without_optimizer",
          "26: from test.libregrtest import cmdline",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "24: from xml.etree import ElementTree",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2243:             self.check_executed_tests(output, testname, stats=1, parallel=True)",
          "2244:             self.assertNotIn('SPAM SPAM SPAM', output)",
          "2247: class TestUtils(unittest.TestCase):",
          "2248:     def test_format_duration(self):",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2248:     def test_xml(self):",
          "2249:         code = textwrap.dedent(r\"\"\"",
          "2250:             import unittest",
          "2251:             from test import support",
          "2253:             class VerboseTests(unittest.TestCase):",
          "2254:                 def test_failed(self):",
          "2255:                     print(\"abc \\x1b def\")",
          "2256:                     self.fail()",
          "2257:         \"\"\")",
          "2258:         testname = self.create_test(code=code)",
          "2260:         # Run sequentially",
          "2261:         filename = os_helper.TESTFN",
          "2262:         self.addCleanup(os_helper.unlink, filename)",
          "2264:         output = self.run_tests(testname, \"--junit-xml\", filename,",
          "2265:                                 exitcode=EXITCODE_BAD_TEST)",
          "2266:         self.check_executed_tests(output, testname,",
          "2267:                                   failed=testname,",
          "2268:                                   stats=TestStats(1, 1, 0))",
          "2270:         # Test generated XML",
          "2271:         with open(filename, encoding=\"utf8\") as fp:",
          "2272:             content = fp.read()",
          "2274:         testsuite = ElementTree.fromstring(content)",
          "2275:         self.assertEqual(int(testsuite.get('tests')), 1)",
          "2276:         self.assertEqual(int(testsuite.get('errors')), 0)",
          "2277:         self.assertEqual(int(testsuite.get('failures')), 1)",
          "2279:         testcase = testsuite[0][0]",
          "2280:         self.assertEqual(testcase.get('status'), 'run')",
          "2281:         self.assertEqual(testcase.get('result'), 'completed')",
          "2282:         self.assertGreater(float(testcase.get('time')), 0)",
          "2283:         for out in testcase.iter('system-out'):",
          "2284:             self.assertEqual(out.text, r\"abc \\x1b def\")",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "2426:             self.assertTrue(match_test(test_chdir))",
          "2427:             self.assertFalse(match_test(test_copy))",
          "2430: if __name__ == '__main__':",
          "2431:     unittest.main()",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2469:     def test_sanitize_xml(self):",
          "2470:         sanitize_xml = utils.sanitize_xml",
          "2472:         # escape invalid XML characters",
          "2473:         self.assertEqual(sanitize_xml('abc \\x1b\\x1f def'),",
          "2474:                          r'abc \\x1b\\x1f def')",
          "2475:         self.assertEqual(sanitize_xml('nul:\\x00, bell:\\x07'),",
          "2476:                          r'nul:\\x00, bell:\\x07')",
          "2477:         self.assertEqual(sanitize_xml('surrogate:\\uDC80'),",
          "2478:                          r'surrogate:\\udc80')",
          "2479:         self.assertEqual(sanitize_xml('illegal \\uFFFE and \\uFFFF'),",
          "2480:                          r'illegal \\ufffe and \\uffff')",
          "2482:         # no escape for valid XML characters",
          "2483:         self.assertEqual(sanitize_xml('a\\n\\tb'),",
          "2484:                          'a\\n\\tb')",
          "2485:         self.assertEqual(sanitize_xml('valid t\\xe9xt \\u20ac'),",
          "2486:                          'valid t\\xe9xt \\u20ac')",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "48c777688305bfa45038a15ab09c03350503a2c4",
      "candidate_info": {
        "commit_hash": "48c777688305bfa45038a15ab09c03350503a2c4",
        "repo": "python/cpython",
        "commit_url": "https://github.com/python/cpython/commit/48c777688305bfa45038a15ab09c03350503a2c4",
        "files": [
          "Modules/_ctypes/clinic/_ctypes.c.h",
          "Modules/_io/clinic/bufferedio.c.h",
          "Modules/_io/clinic/iobase.c.h",
          "Modules/_io/clinic/textio.c.h",
          "Modules/clinic/_curses_panel.c.h",
          "Modules/clinic/_dbmmodule.c.h",
          "Modules/clinic/_elementtree.c.h",
          "Modules/clinic/_gdbmmodule.c.h",
          "Modules/clinic/_pickle.c.h",
          "Modules/clinic/arraymodule.c.h",
          "Modules/clinic/pyexpat.c.h",
          "Tools/clinic/libclinic/parse_args.py"
        ],
        "message": "[3.13] gh-119661: Add _Py_SINGLETON() include in Argumenet Clinic (#119712) (#119716)\n\ngh-119661: Add _Py_SINGLETON() include in Argumenet Clinic (#119712)\n\nWhen the _Py_SINGLETON() is used, Argument Clinic now adds an\nexplicit \"pycore_runtime.h\" include to get the macro. Previously, the\nmacro may or may not be included indirectly by another include.\n\n(cherry picked from commit 7ca74a760a5d3cdf48159f003d4db7c2778e9261)",
        "before_after_code_files": [
          "Modules/_ctypes/clinic/_ctypes.c.h||Modules/_ctypes/clinic/_ctypes.c.h",
          "Modules/_io/clinic/bufferedio.c.h||Modules/_io/clinic/bufferedio.c.h",
          "Modules/_io/clinic/iobase.c.h||Modules/_io/clinic/iobase.c.h",
          "Modules/_io/clinic/textio.c.h||Modules/_io/clinic/textio.c.h",
          "Modules/clinic/_curses_panel.c.h||Modules/clinic/_curses_panel.c.h",
          "Modules/clinic/_dbmmodule.c.h||Modules/clinic/_dbmmodule.c.h",
          "Modules/clinic/_elementtree.c.h||Modules/clinic/_elementtree.c.h",
          "Modules/clinic/_gdbmmodule.c.h||Modules/clinic/_gdbmmodule.c.h",
          "Modules/clinic/_pickle.c.h||Modules/clinic/_pickle.c.h",
          "Modules/clinic/arraymodule.c.h||Modules/clinic/arraymodule.c.h",
          "Modules/clinic/pyexpat.c.h||Modules/clinic/pyexpat.c.h",
          "Tools/clinic/libclinic/parse_args.py||Tools/clinic/libclinic/parse_args.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/AcreetionOS-Linux/python/pull/2"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "Modules/_ctypes/clinic/_ctypes.c.h||Modules/_ctypes/clinic/_ctypes.c.h": [
          "File: Modules/_ctypes/clinic/_ctypes.c.h -> Modules/_ctypes/clinic/_ctypes.c.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "2: preserve",
          "5: #include \"pycore_abstract.h\"      // _PyNumber_Index()",
          "6: #include \"pycore_modsupport.h\"    // _PyArg_UnpackKeywords()",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "5: #if defined(Py_BUILD_CORE) && !defined(Py_BUILD_CORE_MODULE)",
          "6: #  include \"pycore_runtime.h\"     // _Py_SINGLETON()",
          "7: #endif",
          "",
          "---------------"
        ],
        "Modules/_io/clinic/bufferedio.c.h||Modules/_io/clinic/bufferedio.c.h": [
          "File: Modules/_io/clinic/bufferedio.c.h -> Modules/_io/clinic/bufferedio.c.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: #if defined(Py_BUILD_CORE) && !defined(Py_BUILD_CORE_MODULE)",
          "6: #  include \"pycore_gc.h\"          // PyGC_Head",
          "8: #endif",
          "9: #include \"pycore_abstract.h\"      // _PyNumber_Index()",
          "10: #include \"pycore_critical_section.h\"// Py_BEGIN_CRITICAL_SECTION()",
          "",
          "[Removed Lines]",
          "7: #  include \"pycore_runtime.h\"     // _Py_ID()",
          "",
          "[Added Lines]",
          "7: #  include \"pycore_runtime.h\"     // _Py_SINGLETON()",
          "",
          "---------------"
        ],
        "Modules/_io/clinic/iobase.c.h||Modules/_io/clinic/iobase.c.h": [
          "File: Modules/_io/clinic/iobase.c.h -> Modules/_io/clinic/iobase.c.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "2: preserve",
          "5: #include \"pycore_abstract.h\"      // _Py_convert_optional_to_ssize_t()",
          "6: #include \"pycore_modsupport.h\"    // _PyArg_UnpackKeywords()",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "5: #if defined(Py_BUILD_CORE) && !defined(Py_BUILD_CORE_MODULE)",
          "6: #  include \"pycore_runtime.h\"     // _Py_SINGLETON()",
          "7: #endif",
          "",
          "---------------"
        ],
        "Modules/_io/clinic/textio.c.h||Modules/_io/clinic/textio.c.h": [
          "File: Modules/_io/clinic/textio.c.h -> Modules/_io/clinic/textio.c.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: #if defined(Py_BUILD_CORE) && !defined(Py_BUILD_CORE_MODULE)",
          "6: #  include \"pycore_gc.h\"          // PyGC_Head",
          "8: #endif",
          "9: #include \"pycore_abstract.h\"      // _Py_convert_optional_to_ssize_t()",
          "10: #include \"pycore_critical_section.h\"// Py_BEGIN_CRITICAL_SECTION()",
          "",
          "[Removed Lines]",
          "7: #  include \"pycore_runtime.h\"     // _Py_ID()",
          "",
          "[Added Lines]",
          "7: #  include \"pycore_runtime.h\"     // _Py_SINGLETON()",
          "",
          "---------------"
        ],
        "Modules/clinic/_curses_panel.c.h||Modules/clinic/_curses_panel.c.h": [
          "File: Modules/clinic/_curses_panel.c.h -> Modules/clinic/_curses_panel.c.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "2: preserve",
          "5: #include \"pycore_modsupport.h\"    // _PyArg_UnpackKeywords()",
          "7: PyDoc_STRVAR(_curses_panel_panel_bottom__doc__,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "5: #if defined(Py_BUILD_CORE) && !defined(Py_BUILD_CORE_MODULE)",
          "6: #  include \"pycore_runtime.h\"     // _Py_SINGLETON()",
          "7: #endif",
          "",
          "---------------"
        ],
        "Modules/clinic/_dbmmodule.c.h||Modules/clinic/_dbmmodule.c.h": [
          "File: Modules/clinic/_dbmmodule.c.h -> Modules/clinic/_dbmmodule.c.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "2: preserve",
          "5: #include \"pycore_modsupport.h\"    // _PyArg_UnpackKeywords()",
          "7: PyDoc_STRVAR(_dbm_dbm_close__doc__,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "5: #if defined(Py_BUILD_CORE) && !defined(Py_BUILD_CORE_MODULE)",
          "6: #  include \"pycore_runtime.h\"     // _Py_SINGLETON()",
          "7: #endif",
          "",
          "---------------"
        ],
        "Modules/clinic/_elementtree.c.h||Modules/clinic/_elementtree.c.h": [
          "File: Modules/clinic/_elementtree.c.h -> Modules/clinic/_elementtree.c.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: #if defined(Py_BUILD_CORE) && !defined(Py_BUILD_CORE_MODULE)",
          "6: #  include \"pycore_gc.h\"          // PyGC_Head",
          "8: #endif",
          "9: #include \"pycore_abstract.h\"      // _PyNumber_Index()",
          "10: #include \"pycore_modsupport.h\"    // _PyArg_UnpackKeywords()",
          "",
          "[Removed Lines]",
          "7: #  include \"pycore_runtime.h\"     // _Py_ID()",
          "",
          "[Added Lines]",
          "7: #  include \"pycore_runtime.h\"     // _Py_SINGLETON()",
          "",
          "---------------"
        ],
        "Modules/clinic/_gdbmmodule.c.h||Modules/clinic/_gdbmmodule.c.h": [
          "File: Modules/clinic/_gdbmmodule.c.h -> Modules/clinic/_gdbmmodule.c.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "2: preserve",
          "5: #include \"pycore_modsupport.h\"    // _PyArg_CheckPositional()",
          "7: PyDoc_STRVAR(_gdbm_gdbm_get__doc__,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "5: #if defined(Py_BUILD_CORE) && !defined(Py_BUILD_CORE_MODULE)",
          "6: #  include \"pycore_runtime.h\"     // _Py_SINGLETON()",
          "7: #endif",
          "",
          "---------------"
        ],
        "Modules/clinic/_pickle.c.h||Modules/clinic/_pickle.c.h": [
          "File: Modules/clinic/_pickle.c.h -> Modules/clinic/_pickle.c.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: #if defined(Py_BUILD_CORE) && !defined(Py_BUILD_CORE_MODULE)",
          "6: #  include \"pycore_gc.h\"          // PyGC_Head",
          "8: #endif",
          "9: #include \"pycore_modsupport.h\"    // _PyArg_UnpackKeywords()",
          "",
          "[Removed Lines]",
          "7: #  include \"pycore_runtime.h\"     // _Py_ID()",
          "",
          "[Added Lines]",
          "7: #  include \"pycore_runtime.h\"     // _Py_SINGLETON()",
          "",
          "---------------"
        ],
        "Modules/clinic/arraymodule.c.h||Modules/clinic/arraymodule.c.h": [
          "File: Modules/clinic/arraymodule.c.h -> Modules/clinic/arraymodule.c.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "2: preserve",
          "5: #include \"pycore_abstract.h\"      // _PyNumber_Index()",
          "6: #include \"pycore_modsupport.h\"    // _PyArg_CheckPositional()",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "5: #if defined(Py_BUILD_CORE) && !defined(Py_BUILD_CORE_MODULE)",
          "6: #  include \"pycore_runtime.h\"     // _Py_SINGLETON()",
          "7: #endif",
          "",
          "---------------"
        ],
        "Modules/clinic/pyexpat.c.h||Modules/clinic/pyexpat.c.h": [
          "File: Modules/clinic/pyexpat.c.h -> Modules/clinic/pyexpat.c.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: #if defined(Py_BUILD_CORE) && !defined(Py_BUILD_CORE_MODULE)",
          "6: #  include \"pycore_gc.h\"          // PyGC_Head",
          "8: #endif",
          "9: #include \"pycore_modsupport.h\"    // _PyArg_UnpackKeywords()",
          "",
          "[Removed Lines]",
          "7: #  include \"pycore_runtime.h\"     // _Py_ID()",
          "",
          "[Added Lines]",
          "7: #  include \"pycore_runtime.h\"     // _Py_SINGLETON()",
          "",
          "---------------"
        ],
        "Tools/clinic/libclinic/parse_args.py||Tools/clinic/libclinic/parse_args.py": [
          "File: Tools/clinic/libclinic/parse_args.py -> Tools/clinic/libclinic/parse_args.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "38:         p for p in f.parameters.values()",
          "39:         if not p.is_positional_only() and not p.is_vararg()",
          "40:     ])",
          "41:     if limited_capi:",
          "42:         declarations = \"\"\"",
          "43:             #define KWTUPLE NULL",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "42:     condition = '#if defined(Py_BUILD_CORE) && !defined(Py_BUILD_CORE_MODULE)'",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "50:             #  define KWTUPLE NULL",
          "51:             #endif",
          "52:         \"\"\"",
          "53:     else:",
          "54:         # XXX Why do we not statically allocate the tuple",
          "55:         # for non-builtin modules?",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "56:         codegen.add_include('pycore_runtime.h', '_Py_SINGLETON()',",
          "57:                             condition=condition)",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "73:             #endif  // !Py_BUILD_CORE",
          "74:         \"\"\" % num_keywords",
          "80:     declarations += \"\"\"",
          "81:             static const char * const _keywords[] = {{{keywords_c} NULL}};",
          "",
          "[Removed Lines]",
          "76:         condition = '#if defined(Py_BUILD_CORE) && !defined(Py_BUILD_CORE_MODULE)'",
          "77:         codegen.add_include('pycore_gc.h', 'PyGC_Head', condition=condition)",
          "78:         codegen.add_include('pycore_runtime.h', '_Py_ID()', condition=condition)",
          "",
          "[Added Lines]",
          "81:         codegen.add_include('pycore_gc.h', 'PyGC_Head',",
          "82:                             condition=condition)",
          "83:         codegen.add_include('pycore_runtime.h', '_Py_ID()',",
          "84:                             condition=condition)",
          "",
          "---------------"
        ]
      }
    }
  ]
}