{
  "cve_id": "CVE-2019-15694",
  "cve_desc": "TigerVNC version prior to 1.10.1 is vulnerable to heap buffer overflow, which could be triggered from DecodeManager::decodeRect. Vulnerability occurs due to the signdness error in processing MemOutStream. Exploitation of this vulnerability could potentially result into remote code execution. This attack appear to be exploitable via network connectivity.",
  "repo": "CendioOssman/tigervnc",
  "patch_hash": "0943c006c7d900dfc0281639e992791d6c567438",
  "patch_info": {
    "commit_hash": "0943c006c7d900dfc0281639e992791d6c567438",
    "repo": "CendioOssman/tigervnc",
    "commit_url": "https://github.com/CendioOssman/tigervnc/commit/0943c006c7d900dfc0281639e992791d6c567438",
    "files": [
      "common/rdr/FdInStream.cxx",
      "common/rdr/FdInStream.h",
      "common/rdr/FdOutStream.cxx",
      "common/rdr/FdOutStream.h",
      "common/rdr/FileInStream.cxx",
      "common/rdr/FileInStream.h",
      "common/rdr/HexInStream.cxx",
      "common/rdr/HexInStream.h",
      "common/rdr/HexOutStream.cxx",
      "common/rdr/HexOutStream.h",
      "common/rdr/InStream.h",
      "common/rdr/MemInStream.h",
      "common/rdr/MemOutStream.h",
      "common/rdr/OutStream.h",
      "common/rdr/RandomStream.cxx",
      "common/rdr/RandomStream.h",
      "common/rdr/TLSInStream.cxx",
      "common/rdr/TLSInStream.h",
      "common/rdr/TLSOutStream.cxx",
      "common/rdr/TLSOutStream.h",
      "common/rdr/ZlibInStream.cxx",
      "common/rdr/ZlibInStream.h",
      "common/rdr/ZlibOutStream.cxx",
      "common/rdr/ZlibOutStream.h",
      "common/rfb/Configuration.cxx",
      "common/rfb/Configuration.h",
      "common/rfb/Password.cxx",
      "common/rfb/Password.h",
      "common/rfb/util.h",
      "tests/perf/encperf.cxx",
      "win/rfb_win32/Registry.cxx",
      "win/rfb_win32/Registry.h"
    ],
    "message": "Use size_t for lengths in stream objects\n\nProvides safety against them accidentally becoming negative because\nof bugs in the calculations.\n\nAlso does the same to CharArray and friends as they were strongly\nconnection to the stream objects.",
    "before_after_code_files": [
      "common/rdr/FdInStream.cxx||common/rdr/FdInStream.cxx",
      "common/rdr/FdInStream.h||common/rdr/FdInStream.h",
      "common/rdr/FdOutStream.cxx||common/rdr/FdOutStream.cxx",
      "common/rdr/FdOutStream.h||common/rdr/FdOutStream.h",
      "common/rdr/FileInStream.cxx||common/rdr/FileInStream.cxx",
      "common/rdr/FileInStream.h||common/rdr/FileInStream.h",
      "common/rdr/HexInStream.cxx||common/rdr/HexInStream.cxx",
      "common/rdr/HexInStream.h||common/rdr/HexInStream.h",
      "common/rdr/HexOutStream.cxx||common/rdr/HexOutStream.cxx",
      "common/rdr/HexOutStream.h||common/rdr/HexOutStream.h",
      "common/rdr/InStream.h||common/rdr/InStream.h",
      "common/rdr/MemInStream.h||common/rdr/MemInStream.h",
      "common/rdr/MemOutStream.h||common/rdr/MemOutStream.h",
      "common/rdr/OutStream.h||common/rdr/OutStream.h",
      "common/rdr/RandomStream.cxx||common/rdr/RandomStream.cxx",
      "common/rdr/RandomStream.h||common/rdr/RandomStream.h",
      "common/rdr/TLSInStream.cxx||common/rdr/TLSInStream.cxx",
      "common/rdr/TLSInStream.h||common/rdr/TLSInStream.h",
      "common/rdr/TLSOutStream.cxx||common/rdr/TLSOutStream.cxx",
      "common/rdr/TLSOutStream.h||common/rdr/TLSOutStream.h",
      "common/rdr/ZlibInStream.cxx||common/rdr/ZlibInStream.cxx",
      "common/rdr/ZlibInStream.h||common/rdr/ZlibInStream.h",
      "common/rdr/ZlibOutStream.cxx||common/rdr/ZlibOutStream.cxx",
      "common/rdr/ZlibOutStream.h||common/rdr/ZlibOutStream.h",
      "common/rfb/Configuration.cxx||common/rfb/Configuration.cxx",
      "common/rfb/Configuration.h||common/rfb/Configuration.h",
      "common/rfb/Password.cxx||common/rfb/Password.cxx",
      "common/rfb/Password.h||common/rfb/Password.h",
      "common/rfb/util.h||common/rfb/util.h",
      "tests/perf/encperf.cxx||tests/perf/encperf.cxx",
      "win/rfb_win32/Registry.cxx||win/rfb_win32/Registry.cxx",
      "win/rfb_win32/Registry.h||win/rfb_win32/Registry.h"
    ]
  },
  "patch_diff": {
    "common/rdr/FdInStream.cxx||common/rdr/FdInStream.cxx": [
      "File: common/rdr/FdInStream.cxx -> common/rdr/FdInStream.cxx",
      "--- Hunk 1 ---",
      "[Context before]",
      "56: enum { DEFAULT_BUF_SIZE = 8192,",
      "57:        MIN_BULK_SIZE = 1024 };",
      "60:                        bool closeWhenDone_)",
      "61:   : fd(fd_), closeWhenDone(closeWhenDone_),",
      "62:     timeoutms(timeoutms_), blockCallback(0),",
      "",
      "[Removed Lines]",
      "59: FdInStream::FdInStream(int fd_, int timeoutms_, int bufSize_,",
      "",
      "[Added Lines]",
      "59: FdInStream::FdInStream(int fd_, int timeoutms_, size_t bufSize_,",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "67: }",
      "69: FdInStream::FdInStream(int fd_, FdInStreamBlockCallback* blockCallback_,",
      "71:   : fd(fd_), timeoutms(0), blockCallback(blockCallback_),",
      "72:     timing(false), timeWaitedIn100us(5), timedKbits(0),",
      "73:     bufSize(bufSize_ ? bufSize_ : DEFAULT_BUF_SIZE), offset(0)",
      "",
      "[Removed Lines]",
      "70:                        int bufSize_)",
      "",
      "[Added Lines]",
      "70:                        size_t bufSize_)",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "92:   timeoutms = 0;",
      "93: }",
      "96: {",
      "97:   return offset + ptr - start;",
      "98: }",
      "101: {",
      "102:   if (length < MIN_BULK_SIZE) {",
      "103:     InStream::readBytes(data, length);",
      "",
      "[Removed Lines]",
      "95: int FdInStream::pos()",
      "100: void FdInStream::readBytes(void* data, int length)",
      "",
      "[Added Lines]",
      "95: size_t FdInStream::pos()",
      "100: void FdInStream::readBytes(void* data, size_t length)",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "107:   U8* dataPtr = (U8*)data;",
      "110:   if (n > length) n = length;",
      "112:   memcpy(dataPtr, ptr, n);",
      "",
      "[Removed Lines]",
      "109:   int n = end - ptr;",
      "",
      "[Added Lines]",
      "109:   size_t n = end - ptr;",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "123: }",
      "127: {",
      "128:   if (itemSize > bufSize)",
      "129:     throw Exception(\"FdInStream overrun: max itemSize exceeded\");",
      "",
      "[Removed Lines]",
      "126: int FdInStream::overrun(int itemSize, int nItems, bool wait)",
      "",
      "[Added Lines]",
      "126: size_t FdInStream::overrun(size_t itemSize, size_t nItems, bool wait)",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "135:   end -= ptr - start;",
      "136:   ptr = start;",
      "139:   while (end < start + itemSize) {",
      "140:     bytes_to_read = start + bufSize - end;",
      "141:     if (!timing) {",
      "",
      "[Removed Lines]",
      "138:   int bytes_to_read;",
      "",
      "[Added Lines]",
      "138:   size_t bytes_to_read;",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "148:       bytes_to_read = vncmin(bytes_to_read, vncmax(itemSize*nItems, 8));",
      "149:     }",
      "151:     if (n == 0) return 0;",
      "152:     end += n;",
      "153:   }",
      "156:     nItems = (end - ptr) / itemSize;",
      "158:   return nItems;",
      "",
      "[Removed Lines]",
      "150:     int n = readWithTimeoutOrCallback((U8*)end, bytes_to_read, wait);",
      "155:   if (itemSize * nItems > end - ptr)",
      "",
      "[Added Lines]",
      "150:     size_t n = readWithTimeoutOrCallback((U8*)end, bytes_to_read, wait);",
      "155:   if (itemSize * nItems > (size_t)(end - ptr))",
      "",
      "---------------",
      "--- Hunk 8 ---",
      "[Context before]",
      "175: {",
      "176:   struct timeval before, after;",
      "177:   if (timing)",
      "",
      "[Removed Lines]",
      "174: int FdInStream::readWithTimeoutOrCallback(void* buf, int len, bool wait)",
      "",
      "[Added Lines]",
      "174: size_t FdInStream::readWithTimeoutOrCallback(void* buf, size_t len, bool wait)",
      "",
      "---------------"
    ],
    "common/rdr/FdInStream.h||common/rdr/FdInStream.h": [
      "File: common/rdr/FdInStream.h -> common/rdr/FdInStream.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "38:   public:",
      "41:                bool closeWhenDone_=false);",
      "43:     virtual ~FdInStream();",
      "45:     void setTimeout(int timeoutms);",
      "46:     void setBlockCallback(FdInStreamBlockCallback* blockCallback);",
      "47:     int getFd() { return fd; }",
      "51:     void startTiming();",
      "52:     void stopTiming();",
      "",
      "[Removed Lines]",
      "40:     FdInStream(int fd, int timeoutms=-1, int bufSize=0,",
      "42:     FdInStream(int fd, FdInStreamBlockCallback* blockCallback, int bufSize=0);",
      "48:     int pos();",
      "49:     void readBytes(void* data, int length);",
      "",
      "[Added Lines]",
      "40:     FdInStream(int fd, int timeoutms=-1, size_t bufSize=0,",
      "42:     FdInStream(int fd, FdInStreamBlockCallback* blockCallback,",
      "43:                size_t bufSize=0);",
      "49:     size_t pos();",
      "50:     void readBytes(void* data, size_t length);",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "54:     unsigned int timeWaited() { return timeWaitedIn100us; }",
      "56:   protected:",
      "59:   private:",
      "62:     int fd;",
      "63:     bool closeWhenDone;",
      "",
      "[Removed Lines]",
      "57:     int overrun(int itemSize, int nItems, bool wait);",
      "60:     int readWithTimeoutOrCallback(void* buf, int len, bool wait=true);",
      "",
      "[Added Lines]",
      "58:     size_t overrun(size_t itemSize, size_t nItems, bool wait);",
      "61:     size_t readWithTimeoutOrCallback(void* buf, size_t len, bool wait=true);",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "68:     unsigned int timeWaitedIn100us;",
      "69:     unsigned int timedKbits;",
      "73:     U8* start;",
      "74:   };",
      "",
      "[Removed Lines]",
      "71:     int bufSize;",
      "72:     int offset;",
      "",
      "[Added Lines]",
      "72:     size_t bufSize;",
      "73:     size_t offset;",
      "",
      "---------------"
    ],
    "common/rdr/FdOutStream.cxx||common/rdr/FdOutStream.cxx": [
      "File: common/rdr/FdOutStream.cxx -> common/rdr/FdOutStream.cxx",
      "--- Hunk 1 ---",
      "[Context before]",
      "52: enum { DEFAULT_BUF_SIZE = 16384 };",
      "55:   : fd(fd_), blocking(blocking_), timeoutms(timeoutms_),",
      "56:     bufSize(bufSize_ ? bufSize_ : DEFAULT_BUF_SIZE), offset(0)",
      "57: {",
      "",
      "[Removed Lines]",
      "54: FdOutStream::FdOutStream(int fd_, bool blocking_, int timeoutms_, int bufSize_)",
      "",
      "[Added Lines]",
      "54: FdOutStream::FdOutStream(int fd_, bool blocking_, int timeoutms_, size_t bufSize_)",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "79:   blocking = blocking_;",
      "80: }",
      "83: {",
      "84:   return offset + ptr - sentUpTo;",
      "85: }",
      "",
      "[Removed Lines]",
      "82: int FdOutStream::length()",
      "",
      "[Added Lines]",
      "82: size_t FdOutStream::length()",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "97: void FdOutStream::flush()",
      "98: {",
      "99:   while (sentUpTo < ptr) {",
      "105:     if (n == 0) {",
      "",
      "[Removed Lines]",
      "100:     int n = writeWithTimeout((const void*) sentUpTo,",
      "101:                              ptr - sentUpTo,",
      "102:                              blocking? timeoutms : 0);",
      "",
      "[Added Lines]",
      "100:     size_t n = writeWithTimeout((const void*) sentUpTo,",
      "101:                                 ptr - sentUpTo,",
      "102:                                 blocking? timeoutms : 0);",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "120: }",
      "124: {",
      "125:   if (itemSize > bufSize)",
      "126:     throw Exception(\"FdOutStream overrun: max itemSize exceeded\");",
      "",
      "[Removed Lines]",
      "123: int FdOutStream::overrun(int itemSize, int nItems)",
      "",
      "[Added Lines]",
      "123: size_t FdOutStream::overrun(size_t itemSize, size_t nItems)",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "129:   flush();",
      "136:         (itemSize < bufSize - (ptr - sentUpTo))) {",
      "137:       memmove(start, sentUpTo, ptr - sentUpTo);",
      "138:       ptr = start + (ptr - sentUpTo);",
      "",
      "[Removed Lines]",
      "132:   if (itemSize > end - ptr) {",
      "135:     if ((sentUpTo - start > bufSize / 4) &&",
      "",
      "[Added Lines]",
      "132:   if (itemSize > (size_t)(end - ptr)) {",
      "135:     if (((size_t)(sentUpTo - start) > bufSize / 4) &&",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "150:   }",
      "154:     nItems = (end - ptr) / itemSize;",
      "156:   return nItems;",
      "",
      "[Removed Lines]",
      "153:   if (itemSize * nItems > end - ptr)",
      "",
      "[Added Lines]",
      "153:   if (itemSize * nItems > (size_t)(end - ptr))",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "170: {",
      "171:   int n;",
      "",
      "[Removed Lines]",
      "169: int FdOutStream::writeWithTimeout(const void* data, int length, int timeoutms)",
      "",
      "[Added Lines]",
      "169: size_t FdOutStream::writeWithTimeout(const void* data, size_t length, int timeoutms)",
      "",
      "---------------"
    ],
    "common/rdr/FdOutStream.h||common/rdr/FdOutStream.h": [
      "File: common/rdr/FdOutStream.h -> common/rdr/FdOutStream.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "35:   public:",
      "38:     virtual ~FdOutStream();",
      "40:     void setTimeout(int timeoutms);",
      "",
      "[Removed Lines]",
      "37:     FdOutStream(int fd, bool blocking=true, int timeoutms=-1, int bufSize=0);",
      "",
      "[Added Lines]",
      "37:     FdOutStream(int fd, bool blocking=true, int timeoutms=-1, size_t bufSize=0);",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "42:     int getFd() { return fd; }",
      "44:     void flush();",
      "47:     int bufferUsage();",
      "49:     unsigned getIdleTime();",
      "51:   private:",
      "54:     int fd;",
      "55:     bool blocking;",
      "56:     int timeoutms;",
      "59:     U8* start;",
      "60:     U8* sentUpTo;",
      "61:     struct timeval lastWrite;",
      "",
      "[Removed Lines]",
      "45:     int length();",
      "52:     int overrun(int itemSize, int nItems);",
      "53:     int writeWithTimeout(const void* data, int length, int timeoutms);",
      "57:     int bufSize;",
      "58:     int offset;",
      "",
      "[Added Lines]",
      "45:     size_t length();",
      "52:     size_t overrun(size_t itemSize, size_t nItems);",
      "53:     size_t writeWithTimeout(const void* data, size_t length, int timeoutms);",
      "57:     size_t bufSize;",
      "58:     size_t offset;",
      "",
      "---------------"
    ],
    "common/rdr/FileInStream.cxx||common/rdr/FileInStream.cxx": [
      "File: common/rdr/FileInStream.cxx -> common/rdr/FileInStream.cxx",
      "--- Hunk 1 ---",
      "[Context before]",
      "48:   ptr = end = b;",
      "49: }",
      "52: {",
      "53:   if (!file)",
      "54:     throw Exception(\"File is not open\");",
      "",
      "[Removed Lines]",
      "51: int FileInStream::pos()",
      "",
      "[Added Lines]",
      "51: size_t FileInStream::pos()",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "56:   return ftell(file) + ptr - b;",
      "57: }",
      "60: {",
      "62:     throw Exception(\"FileInStream overrun: max itemSize exceeded\");",
      "64:   if (end - ptr != 0)",
      "",
      "[Removed Lines]",
      "59: int FileInStream::overrun(int itemSize, int nItems, bool wait)",
      "61:   if (itemSize > (int)sizeof(b))",
      "",
      "[Added Lines]",
      "59: size_t FileInStream::overrun(size_t itemSize, size_t nItems, bool wait)",
      "61:   if (itemSize > sizeof(b))",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "80:     end += b + sizeof(b) - end;",
      "81:   }",
      "84:     nItems = (end - ptr) / itemSize;",
      "86:   return nItems;",
      "",
      "[Removed Lines]",
      "83:   if (itemSize * nItems > end - ptr)",
      "",
      "[Added Lines]",
      "83:   if (itemSize * nItems > (size_t)(end - ptr))",
      "",
      "---------------"
    ],
    "common/rdr/FileInStream.h||common/rdr/FileInStream.h": [
      "File: common/rdr/FileInStream.h -> common/rdr/FileInStream.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "36:     void reset(void);",
      "40:   protected:",
      "43:   private:",
      "44:     U8 b[131072];",
      "",
      "[Removed Lines]",
      "38:     int pos();",
      "41:     int overrun(int itemSize, int nItems, bool wait = true);",
      "",
      "[Added Lines]",
      "38:     size_t pos();",
      "41:     size_t overrun(size_t itemSize, size_t nItems, bool wait = true);",
      "",
      "---------------"
    ],
    "common/rdr/HexInStream.cxx||common/rdr/HexInStream.cxx": [
      "File: common/rdr/HexInStream.cxx -> common/rdr/HexInStream.cxx",
      "--- Hunk 1 ---",
      "[Context before]",
      "29: static inline int min(int a, int b) {return a<b ? a : b;}",
      "32: : bufSize(bufSize_ ? bufSize_ : DEFAULT_BUF_LEN), offset(0), in_stream(is)",
      "33: {",
      "34:   ptr = end = start = new U8[bufSize];",
      "",
      "[Removed Lines]",
      "31: HexInStream::HexInStream(InStream& is, int bufSize_)",
      "",
      "[Added Lines]",
      "31: HexInStream::HexInStream(InStream& is, size_t bufSize_)",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "50:   return true;",
      "51: }",
      "55:   if ((l % 2) == 0) {",
      "56:     delete [] *data;",
      "",
      "[Removed Lines]",
      "53: bool HexInStream::hexStrToBin(const char* s, char** data, int* length) {",
      "54:   int l=strlen(s);",
      "",
      "[Added Lines]",
      "53: bool HexInStream::hexStrToBin(const char* s, char** data, size_t* length) {",
      "54:   size_t l=strlen(s);",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "59:       return true;",
      "63:       int byte = 0;",
      "64:       if (!readHexAndShift(s[i], &byte) ||",
      "65:         !readHexAndShift(s[i+1], &byte))",
      "",
      "[Removed Lines]",
      "62:     for(int i=0;i<l;i+=2) {",
      "",
      "[Added Lines]",
      "62:     for(size_t i=0;i<l;i+=2) {",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "76: }",
      "80:   return offset + ptr - start;",
      "81: }",
      "84:   if (itemSize > bufSize)",
      "85:     throw Exception(\"HexInStream overrun: max itemSize exceeded\");",
      "",
      "[Removed Lines]",
      "79: int HexInStream::pos() {",
      "83: int HexInStream::overrun(int itemSize, int nItems, bool wait) {",
      "",
      "[Added Lines]",
      "79: size_t HexInStream::pos() {",
      "83: size_t HexInStream::overrun(size_t itemSize, size_t nItems, bool wait) {",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "92:   ptr = start;",
      "94:   while (end < ptr + itemSize) {",
      "96:     if (n == 0) return 0;",
      "97:     const U8* iptr = in_stream.getptr();",
      "98:     const U8* eptr = in_stream.getend();",
      "101:     U8* optr = (U8*) end;",
      "103:       int v = 0;",
      "104:       readHexAndShift(iptr[i*2], &v);",
      "105:       readHexAndShift(iptr[i*2+1], &v);",
      "",
      "[Removed Lines]",
      "95:     int n = in_stream.check(2, 1, wait);",
      "99:     int length = min((eptr - iptr)/2, start + bufSize - end);",
      "102:     for (int i=0; i<length; i++) {",
      "",
      "[Added Lines]",
      "95:     size_t n = in_stream.check(2, 1, wait);",
      "99:     size_t length = min((eptr - iptr)/2, start + bufSize - end);",
      "102:     for (size_t i=0; i<length; i++) {",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "110:     end += length;",
      "111:   }",
      "114:     nItems = (end - ptr) / itemSize;",
      "116:   return nItems;",
      "",
      "[Removed Lines]",
      "113:   if (itemSize * nItems > end - ptr)",
      "",
      "[Added Lines]",
      "113:   if (itemSize * nItems > (size_t)(end - ptr))",
      "",
      "---------------"
    ],
    "common/rdr/HexInStream.h||common/rdr/HexInStream.h": [
      "File: common/rdr/HexInStream.h -> common/rdr/HexInStream.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "26:   class HexInStream : public InStream {",
      "27:   public:",
      "30:     virtual ~HexInStream();",
      "34:     static bool readHexAndShift(char c, int* v);",
      "37:   protected:",
      "40:   private:",
      "42:     U8* start;",
      "45:     InStream& in_stream;",
      "46:   };",
      "",
      "[Removed Lines]",
      "29:     HexInStream(InStream& is, int bufSize=0);",
      "32:     int pos();",
      "35:     static bool hexStrToBin(const char* s, char** data, int* length);",
      "38:     int overrun(int itemSize, int nItems, bool wait);",
      "41:     int bufSize;",
      "43:     int offset;",
      "",
      "[Added Lines]",
      "29:     HexInStream(InStream& is, size_t bufSize=0);",
      "32:     size_t pos();",
      "35:     static bool hexStrToBin(const char* s, char** data, size_t* length);",
      "38:     size_t overrun(size_t itemSize, size_t nItems, bool wait);",
      "41:     size_t bufSize;",
      "43:     size_t offset;",
      "",
      "---------------"
    ],
    "common/rdr/HexOutStream.cxx||common/rdr/HexOutStream.cxx": [
      "File: common/rdr/HexOutStream.cxx -> common/rdr/HexOutStream.cxx",
      "--- Hunk 1 ---",
      "[Context before]",
      "24: const int DEFAULT_BUF_LEN = 16384;",
      "29: : out_stream(os), offset(0), bufSize(buflen ? buflen : DEFAULT_BUF_LEN)",
      "30: {",
      "31:   if (bufSize % 2)",
      "",
      "[Removed Lines]",
      "26: static inline int min(int a, int b) {return a<b ? a : b;}",
      "28: HexOutStream::HexOutStream(OutStream& os, int buflen)",
      "",
      "[Added Lines]",
      "26: static inline size_t min(size_t a, size_t b) {return a<b ? a : b;}",
      "28: HexOutStream::HexOutStream(OutStream& os, size_t buflen)",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "48:     throw rdr::Exception(\"intToHex failed\");",
      "49: }",
      "52:   char* buffer = new char[length*2+1];",
      "54:     buffer[i*2] = intToHex((data[i] >> 4) & 15);",
      "55:     buffer[i*2+1] = intToHex((data[i] & 15));",
      "56:     if (!buffer[i*2] || !buffer[i*2+1]) {",
      "",
      "[Removed Lines]",
      "51: char* HexOutStream::binToHexStr(const char* data, int length) {",
      "53:   for (int i=0; i<length; i++) {",
      "",
      "[Added Lines]",
      "51: char* HexOutStream::binToHexStr(const char* data, size_t length) {",
      "53:   for (size_t i=0; i<length; i++) {",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "70:     out_stream.check(2);",
      "71:     U8* optr = out_stream.getptr();",
      "72:     U8* oend = out_stream.getend();",
      "76:       optr[i*2] = intToHex((pos[i] >> 4) & 0xf);",
      "77:       optr[i*2+1] = intToHex(pos[i] & 0xf);",
      "78:     }",
      "",
      "[Removed Lines]",
      "73:     int length = min(ptr-pos, (oend-optr)/2);",
      "75:     for (int i=0; i<length; i++) {",
      "",
      "[Added Lines]",
      "73:     size_t length = min(ptr-pos, (oend-optr)/2);",
      "75:     for (size_t i=0; i<length; i++) {",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "84:   ptr = start;",
      "85: }",
      "88: {",
      "89:   return offset + ptr - start;",
      "90: }",
      "",
      "[Removed Lines]",
      "87: int HexOutStream::length()",
      "",
      "[Added Lines]",
      "87: size_t HexOutStream::length()",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "95:   out_stream.flush();",
      "96: }",
      "100:   if (itemSize > bufSize)",
      "101:     throw Exception(\"HexOutStream overrun: max itemSize exceeded\");",
      "103:   writeBuffer();",
      "106:     nItems = (end - ptr) / itemSize;",
      "108:   return nItems;",
      "",
      "[Removed Lines]",
      "98: int",
      "99: HexOutStream::overrun(int itemSize, int nItems) {",
      "105:   if (itemSize * nItems > end - ptr)",
      "",
      "[Added Lines]",
      "98: size_t",
      "99: HexOutStream::overrun(size_t itemSize, size_t nItems) {",
      "105:   if (itemSize * nItems > (size_t)(end - ptr))",
      "",
      "---------------"
    ],
    "common/rdr/HexOutStream.h||common/rdr/HexOutStream.h": [
      "File: common/rdr/HexOutStream.h -> common/rdr/HexOutStream.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "26:   class HexOutStream : public OutStream {",
      "27:   public:",
      "30:     virtual ~HexOutStream();",
      "32:     void flush();",
      "35:     static char intToHex(int i);",
      "38:   private:",
      "39:     void writeBuffer();",
      "42:     OutStream& out_stream;",
      "44:     U8* start;",
      "47:   };",
      "49: }",
      "",
      "[Removed Lines]",
      "29:     HexOutStream(OutStream& os, int buflen=0);",
      "33:     int length();",
      "36:     static char* binToHexStr(const char* data, int length);",
      "40:     int overrun(int itemSize, int nItems);",
      "45:     int offset;",
      "46:     int bufSize;",
      "",
      "[Added Lines]",
      "29:     HexOutStream(OutStream& os, size_t buflen=0);",
      "33:     size_t length();",
      "36:     static char* binToHexStr(const char* data, size_t length);",
      "40:     size_t overrun(size_t itemSize, size_t nItems);",
      "45:     size_t offset;",
      "46:     size_t bufSize;",
      "",
      "---------------"
    ],
    "common/rdr/InStream.h||common/rdr/InStream.h": [
      "File: common/rdr/InStream.h -> common/rdr/InStream.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "45:     {",
      "46:       if (ptr + itemSize * nItems > end) {",
      "47:         if (ptr + itemSize > end)",
      "",
      "[Removed Lines]",
      "44:     inline int check(int itemSize, int nItems=1, bool wait=true)",
      "",
      "[Added Lines]",
      "44:     inline size_t check(size_t itemSize, size_t nItems=1, bool wait=true)",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "59:     inline bool checkNoWait(int length) { return check(length, 1, false)!=0; }",
      "",
      "[Added Lines]",
      "59:     inline bool checkNoWait(size_t length) { return check(length, 1, false)!=0; }",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "83:     static U32 maxStringLength;",
      "86:       while (bytes > 0) {",
      "88:         ptr += n;",
      "89:         bytes -= n;",
      "90:       }",
      "",
      "[Removed Lines]",
      "85:     inline void skip(int bytes) {",
      "87:         int n = check(1, bytes);",
      "",
      "[Added Lines]",
      "85:     inline void skip(size_t bytes) {",
      "87:         size_t n = check(1, bytes);",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "96:       U8* dataPtr = (U8*)data;",
      "97:       U8* dataEnd = dataPtr + length;",
      "98:       while (dataPtr < dataEnd) {",
      "100:         memcpy(dataPtr, ptr, n);",
      "101:         ptr += n;",
      "102:         dataPtr += n;",
      "",
      "[Removed Lines]",
      "95:     void readBytes(void* data, int length) {",
      "99:         int n = check(1, dataEnd - dataPtr);",
      "",
      "[Added Lines]",
      "95:     void readBytes(void* data, size_t length) {",
      "99:         size_t n = check(1, dataEnd - dataPtr);",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "117:     virtual int pos() = 0;",
      "",
      "[Added Lines]",
      "117:     virtual size_t pos() = 0;",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "138:   protected:",
      "",
      "[Removed Lines]",
      "136:     virtual int overrun(int itemSize, int nItems, bool wait=true) = 0;",
      "",
      "[Added Lines]",
      "136:     virtual size_t overrun(size_t itemSize, size_t nItems, bool wait=true) = 0;",
      "",
      "---------------"
    ],
    "common/rdr/MemInStream.h||common/rdr/MemInStream.h": [
      "File: common/rdr/MemInStream.h -> common/rdr/MemInStream.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "37:   public:",
      "40:       : start((const U8*)data), deleteWhenDone(deleteWhenDone_)",
      "41:     {",
      "42:       ptr = start;",
      "",
      "[Removed Lines]",
      "39:     MemInStream(const void* data, int len, bool deleteWhenDone_=false)",
      "",
      "[Added Lines]",
      "39:     MemInStream(const void* data, size_t len, bool deleteWhenDone_=false)",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "48:         delete [] start;",
      "49:     }",
      "54:   private:",
      "57:     const U8* start;",
      "58:     bool deleteWhenDone;",
      "59:   };",
      "",
      "[Removed Lines]",
      "51:     int pos() { return ptr - start; }",
      "52:     void reposition(int pos) { ptr = start + pos; }",
      "56:     int overrun(int itemSize, int nItems, bool wait) { throw EndOfStream(); }",
      "",
      "[Added Lines]",
      "51:     size_t pos() { return ptr - start; }",
      "52:     void reposition(size_t pos) { ptr = start + pos; }",
      "56:     size_t overrun(size_t itemSize, size_t nItems, bool wait) { throw EndOfStream(); }",
      "",
      "---------------"
    ],
    "common/rdr/MemOutStream.h||common/rdr/MemOutStream.h": [
      "File: common/rdr/MemOutStream.h -> common/rdr/MemOutStream.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "40:       delete [] start;",
      "41:     }",
      "44:       check(length);",
      "45:       memcpy(ptr, data, length);",
      "46:       ptr += length;",
      "47:     }",
      "50:     void clear() { ptr = start; };",
      "51:     void clearAndZero() { memset(start, 0, ptr-start); clear(); }",
      "",
      "[Removed Lines]",
      "43:     void writeBytes(const void* data, int length) {",
      "49:     int length() { return ptr - start; }",
      "52:     void reposition(int pos) { ptr = start + pos; }",
      "",
      "[Added Lines]",
      "43:     void writeBytes(const void* data, size_t length) {",
      "49:     size_t length() { return ptr - start; }",
      "52:     void reposition(size_t pos) { ptr = start + pos; }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "66:         len = (end - start) * 2;",
      "68:       U8* newStart = new U8[len];",
      "",
      "[Removed Lines]",
      "63:     int overrun(int itemSize, int nItems) {",
      "64:       int len = ptr - start + itemSize * nItems;",
      "65:       if (len < (end - start) * 2)",
      "",
      "[Added Lines]",
      "63:     size_t overrun(size_t itemSize, size_t nItems) {",
      "64:       size_t len = ptr - start + itemSize * nItems;",
      "65:       if (len < (size_t)(end - start) * 2)",
      "",
      "---------------"
    ],
    "common/rdr/OutStream.h||common/rdr/OutStream.h": [
      "File: common/rdr/OutStream.h -> common/rdr/OutStream.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "48:     {",
      "49:       if (ptr + itemSize * nItems > end) {",
      "50:         if (ptr + itemSize > end)",
      "",
      "[Removed Lines]",
      "47:     inline int check(int itemSize, int nItems=1)",
      "",
      "[Added Lines]",
      "47:     inline size_t check(size_t itemSize, size_t nItems=1)",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "76:       writeBytes(str, len);",
      "77:     }",
      "80:       while (bytes-- > 0) writeU8(0);",
      "81:     }",
      "84:       while (bytes > 0) {",
      "86:         ptr += n;",
      "87:         bytes -= n;",
      "88:       }",
      "",
      "[Removed Lines]",
      "79:     inline void pad(int bytes) {",
      "83:     inline void skip(int bytes) {",
      "85:         int n = check(1, bytes);",
      "",
      "[Added Lines]",
      "79:     inline void pad(size_t bytes) {",
      "83:     inline void skip(size_t bytes) {",
      "85:         size_t n = check(1, bytes);",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "94:       const U8* dataPtr = (const U8*)data;",
      "95:       const U8* dataEnd = dataPtr + length;",
      "96:       while (dataPtr < dataEnd) {",
      "98:         memcpy(ptr, dataPtr, n);",
      "99:         ptr += n;",
      "100:         dataPtr += n;",
      "",
      "[Removed Lines]",
      "93:     void writeBytes(const void* data, int length) {",
      "97:         int n = check(1, dataEnd - dataPtr);",
      "",
      "[Added Lines]",
      "93:     void writeBytes(const void* data, size_t length) {",
      "97:         size_t n = check(1, dataEnd - dataPtr);",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "107:       while (length > 0) {",
      "109:         is->readBytes(ptr, n);",
      "110:         ptr += n;",
      "111:         length -= n;",
      "",
      "[Removed Lines]",
      "106:     void copyBytes(InStream* is, int length) {",
      "108:         int n = check(1, length);",
      "",
      "[Added Lines]",
      "106:     void copyBytes(InStream* is, size_t length) {",
      "108:         size_t n = check(1, length);",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "127:     virtual int length() = 0;",
      "",
      "[Added Lines]",
      "127:     virtual size_t length() = 0;",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "150:   protected:",
      "",
      "[Removed Lines]",
      "148:     virtual int overrun(int itemSize, int nItems) = 0;",
      "",
      "[Added Lines]",
      "148:     virtual size_t overrun(size_t itemSize, size_t nItems) = 0;",
      "",
      "---------------"
    ],
    "common/rdr/RandomStream.cxx||common/rdr/RandomStream.cxx": [
      "File: common/rdr/RandomStream.cxx -> common/rdr/RandomStream.cxx",
      "--- Hunk 1 ---",
      "[Context before]",
      "36: using namespace rdr;",
      "40: unsigned int RandomStream::seed;",
      "",
      "[Removed Lines]",
      "38: const int DEFAULT_BUF_LEN = 256;",
      "",
      "[Added Lines]",
      "38: const size_t DEFAULT_BUF_LEN = 256;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "86: #endif",
      "87: }",
      "90:   return offset + ptr - start;",
      "91: }",
      "94:   if (itemSize > DEFAULT_BUF_LEN)",
      "95:     throw Exception(\"RandomStream overrun: max itemSize exceeded\");",
      "",
      "[Removed Lines]",
      "89: int RandomStream::pos() {",
      "93: int RandomStream::overrun(int itemSize, int nItems, bool wait) {",
      "",
      "[Added Lines]",
      "89: size_t RandomStream::pos() {",
      "93: size_t RandomStream::overrun(size_t itemSize, size_t nItems, bool wait) {",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "101:   offset += ptr - start;",
      "102:   ptr = start;",
      "106: #ifdef RFB_HAVE_WINCRYPT",
      "107:   if (provider) {",
      "",
      "[Removed Lines]",
      "104:   int length = start + DEFAULT_BUF_LEN - end;",
      "",
      "[Added Lines]",
      "104:   size_t length = start + DEFAULT_BUF_LEN - end;",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "112: #else",
      "113: #ifndef WIN32",
      "114:   if (fp) {",
      "116:     if (n != 1)",
      "117:       throw rdr::SystemException(\"reading /dev/urandom or /dev/random failed\",",
      "118:                                  errno);",
      "",
      "[Removed Lines]",
      "115:     int n = fread((U8*)end, length, 1, fp);",
      "",
      "[Added Lines]",
      "115:     size_t n = fread((U8*)end, length, 1, fp);",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "122:   {",
      "123: #endif",
      "124: #endif",
      "127:   }",
      "130:     nItems = (end - ptr) / itemSize;",
      "132:   return nItems;",
      "",
      "[Removed Lines]",
      "125:     for (int i=0; i<length; i++)",
      "129:   if (itemSize * nItems > end - ptr)",
      "",
      "[Added Lines]",
      "125:     for (size_t i=0; i<length; i++)",
      "129:   if (itemSize * nItems > (size_t)(end - ptr))",
      "",
      "---------------"
    ],
    "common/rdr/RandomStream.h||common/rdr/RandomStream.h": [
      "File: common/rdr/RandomStream.h -> common/rdr/RandomStream.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "39:     RandomStream();",
      "40:     virtual ~RandomStream();",
      "44:   protected:",
      "47:   private:",
      "48:     U8* start;",
      "51:     static unsigned int seed;",
      "52: #ifdef RFB_HAVE_WINCRYPT",
      "",
      "[Removed Lines]",
      "42:     int pos();",
      "45:     int overrun(int itemSize, int nItems, bool wait);",
      "49:     int offset;",
      "",
      "[Added Lines]",
      "42:     size_t pos();",
      "45:     size_t overrun(size_t itemSize, size_t nItems, bool wait);",
      "49:     size_t offset;",
      "",
      "---------------"
    ],
    "common/rdr/TLSInStream.cxx||common/rdr/TLSInStream.cxx": [
      "File: common/rdr/TLSInStream.cxx -> common/rdr/TLSInStream.cxx",
      "--- Hunk 1 ---",
      "[Context before]",
      "75:   delete[] start;",
      "76: }",
      "79: {",
      "80:   return offset + ptr - start;",
      "81: }",
      "84: {",
      "85:   if (itemSize > bufSize)",
      "86:     throw Exception(\"TLSInStream overrun: max itemSize exceeded\");",
      "",
      "[Removed Lines]",
      "78: int TLSInStream::pos()",
      "83: int TLSInStream::overrun(int itemSize, int nItems, bool wait)",
      "",
      "[Added Lines]",
      "78: size_t TLSInStream::pos()",
      "83: size_t TLSInStream::overrun(size_t itemSize, size_t nItems, bool wait)",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "93:   ptr = start;",
      "95:   while (end < start + itemSize) {",
      "97:     if (!wait && n == 0)",
      "98:       return 0;",
      "99:     end += n;",
      "100:   }",
      "103:     nItems = (end - ptr) / itemSize;",
      "105:   return nItems;",
      "106: }",
      "109: {",
      "110:   int n;",
      "",
      "[Removed Lines]",
      "96:     int n = readTLS((U8*) end, start + bufSize - end, wait);",
      "102:   if (itemSize * nItems > end - ptr)",
      "108: int TLSInStream::readTLS(U8* buf, int len, bool wait)",
      "",
      "[Added Lines]",
      "96:     size_t n = readTLS((U8*) end, start + bufSize - end, wait);",
      "102:   if (itemSize * nItems > (size_t)(end - ptr))",
      "108: size_t TLSInStream::readTLS(U8* buf, size_t len, bool wait)",
      "",
      "---------------"
    ],
    "common/rdr/TLSInStream.h||common/rdr/TLSInStream.h": [
      "File: common/rdr/TLSInStream.h -> common/rdr/TLSInStream.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "36:     TLSInStream(InStream* in, gnutls_session_t session);",
      "37:     virtual ~TLSInStream();",
      "41:   private:",
      "44:     static ssize_t pull(gnutls_transport_ptr_t str, void* data, size_t size);",
      "46:     gnutls_session_t session;",
      "47:     InStream* in;",
      "50:     U8* start;",
      "51:   };",
      "52: };",
      "",
      "[Removed Lines]",
      "39:     int pos();",
      "42:     int overrun(int itemSize, int nItems, bool wait);",
      "43:     int readTLS(U8* buf, int len, bool wait);",
      "48:     int bufSize;",
      "49:     int offset;",
      "",
      "[Added Lines]",
      "39:     size_t pos();",
      "42:     size_t overrun(size_t itemSize, size_t nItems, bool wait);",
      "43:     size_t readTLS(U8* buf, size_t len, bool wait);",
      "48:     size_t bufSize;",
      "49:     size_t offset;",
      "",
      "---------------"
    ],
    "common/rdr/TLSOutStream.cxx||common/rdr/TLSOutStream.cxx": [
      "File: common/rdr/TLSOutStream.cxx -> common/rdr/TLSOutStream.cxx",
      "--- Hunk 1 ---",
      "[Context before]",
      "75:   delete [] start;",
      "76: }",
      "79: {",
      "80:   return offset + ptr - start;",
      "81: }",
      "",
      "[Removed Lines]",
      "78: int TLSOutStream::length()",
      "",
      "[Added Lines]",
      "78: size_t TLSOutStream::length()",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "84: {",
      "85:   U8* sentUpTo = start;",
      "86:   while (sentUpTo < ptr) {",
      "88:     sentUpTo += n;",
      "89:     offset += n;",
      "90:   }",
      "",
      "[Removed Lines]",
      "87:     int n = writeTLS(sentUpTo, ptr - sentUpTo);",
      "",
      "[Added Lines]",
      "87:     size_t n = writeTLS(sentUpTo, ptr - sentUpTo);",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "93:   out->flush();",
      "94: }",
      "97: {",
      "98:   if (itemSize > bufSize)",
      "99:     throw Exception(\"TLSOutStream overrun: max itemSize exceeded\");",
      "101:   flush();",
      "104:     nItems = (end - ptr) / itemSize;",
      "106:   return nItems;",
      "107: }",
      "110: {",
      "111:   int n;",
      "",
      "[Removed Lines]",
      "96: int TLSOutStream::overrun(int itemSize, int nItems)",
      "103:   if (itemSize * nItems > end - ptr)",
      "109: int TLSOutStream::writeTLS(const U8* data, int length)",
      "",
      "[Added Lines]",
      "96: size_t TLSOutStream::overrun(size_t itemSize, size_t nItems)",
      "103:   if (itemSize * nItems > (size_t)(end - ptr))",
      "109: size_t TLSOutStream::writeTLS(const U8* data, size_t length)",
      "",
      "---------------"
    ],
    "common/rdr/TLSOutStream.h||common/rdr/TLSOutStream.h": [
      "File: common/rdr/TLSOutStream.h -> common/rdr/TLSOutStream.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "36:     virtual ~TLSOutStream();",
      "38:     void flush();",
      "41:   protected:",
      "44:   private:",
      "46:     static ssize_t push(gnutls_transport_ptr_t str, const void* data, size_t size);",
      "48:     gnutls_session_t session;",
      "49:     OutStream* out;",
      "51:     U8* start;",
      "53:   };",
      "54: };",
      "",
      "[Removed Lines]",
      "39:     int length();",
      "42:     int overrun(int itemSize, int nItems);",
      "45:     int writeTLS(const U8* data, int length);",
      "50:     int bufSize;",
      "52:     int offset;",
      "",
      "[Added Lines]",
      "39:     size_t length();",
      "42:     size_t overrun(size_t itemSize, size_t nItems);",
      "45:     size_t writeTLS(const U8* data, size_t length);",
      "50:     size_t bufSize;",
      "52:     size_t offset;",
      "",
      "---------------"
    ],
    "common/rdr/ZlibInStream.cxx||common/rdr/ZlibInStream.cxx": [
      "File: common/rdr/ZlibInStream.cxx -> common/rdr/ZlibInStream.cxx",
      "--- Hunk 1 ---",
      "[Context before]",
      "27: enum { DEFAULT_BUF_SIZE = 16384 };",
      "30:   : underlying(0), bufSize(bufSize_ ? bufSize_ : DEFAULT_BUF_SIZE), offset(0),",
      "31:     zs(NULL), bytesIn(0)",
      "32: {",
      "",
      "[Removed Lines]",
      "29: ZlibInStream::ZlibInStream(int bufSize_)",
      "",
      "[Added Lines]",
      "29: ZlibInStream::ZlibInStream(size_t bufSize_)",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "40:   delete [] start;",
      "41: }",
      "44: {",
      "45:   underlying = is;",
      "46:   bytesIn = bytesIn_;",
      "47:   ptr = end = start;",
      "48: }",
      "51: {",
      "52:   return offset + ptr - start;",
      "53: }",
      "",
      "[Removed Lines]",
      "43: void ZlibInStream::setUnderlying(InStream* is, int bytesIn_)",
      "50: int ZlibInStream::pos()",
      "",
      "[Added Lines]",
      "43: void ZlibInStream::setUnderlying(InStream* is, size_t bytesIn_)",
      "50: size_t ZlibInStream::pos()",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "96:   zs = NULL;",
      "97: }",
      "100: {",
      "101:   if (itemSize > bufSize)",
      "102:     throw Exception(\"ZlibInStream overrun: max itemSize exceeded\");",
      "",
      "[Removed Lines]",
      "99: int ZlibInStream::overrun(int itemSize, int nItems, bool wait)",
      "",
      "[Added Lines]",
      "99: size_t ZlibInStream::overrun(size_t itemSize, size_t nItems, bool wait)",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "108:   end -= ptr - start;",
      "109:   ptr = start;",
      "112:     if (!decompress(wait))",
      "113:       return 0;",
      "114:   }",
      "117:     nItems = (end - ptr) / itemSize;",
      "119:   return nItems;",
      "",
      "[Removed Lines]",
      "111:   while (end - ptr < itemSize) {",
      "116:   if (itemSize * nItems > end - ptr)",
      "",
      "[Added Lines]",
      "111:   while ((size_t)(end - ptr) < itemSize) {",
      "116:   if (itemSize * nItems > (size_t)(end - ptr))",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "131:   zs->next_out = (U8*)end;",
      "132:   zs->avail_out = start + bufSize - end;",
      "135:   if (n == 0) return false;",
      "136:   zs->next_in = (U8*)underlying->getptr();",
      "137:   zs->avail_in = underlying->getend() - underlying->getptr();",
      "139:     zs->avail_in = bytesIn;",
      "141:   int rc = inflate(zs, Z_SYNC_FLUSH);",
      "",
      "[Removed Lines]",
      "134:   int n = underlying->check(1, 1, wait);",
      "138:   if ((int)zs->avail_in > bytesIn)",
      "",
      "[Added Lines]",
      "134:   size_t n = underlying->check(1, 1, wait);",
      "138:   if (zs->avail_in > bytesIn)",
      "",
      "---------------"
    ],
    "common/rdr/ZlibInStream.h||common/rdr/ZlibInStream.h": [
      "File: common/rdr/ZlibInStream.h -> common/rdr/ZlibInStream.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "35:   public:",
      "38:     virtual ~ZlibInStream();",
      "41:     void flushUnderlying();",
      "43:     void reset();",
      "45:   private:",
      "",
      "[Removed Lines]",
      "37:     ZlibInStream(int bufSize=0);",
      "40:     void setUnderlying(InStream* is, int bytesIn);",
      "42:     int pos();",
      "",
      "[Added Lines]",
      "37:     ZlibInStream(size_t bufSize=0);",
      "40:     void setUnderlying(InStream* is, size_t bytesIn);",
      "42:     size_t pos();",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "47:     void init();",
      "48:     void deinit();",
      "51:     bool decompress(bool wait);",
      "53:     InStream* underlying;",
      "56:     z_stream_s* zs;",
      "58:     U8* start;",
      "59:   };",
      "",
      "[Removed Lines]",
      "50:     int overrun(int itemSize, int nItems, bool wait);",
      "54:     int bufSize;",
      "55:     int offset;",
      "57:     int bytesIn;",
      "",
      "[Added Lines]",
      "50:     size_t overrun(size_t itemSize, size_t nItems, bool wait);",
      "54:     size_t bufSize;",
      "55:     size_t offset;",
      "57:     size_t bytesIn;",
      "",
      "---------------"
    ],
    "common/rdr/ZlibOutStream.cxx||common/rdr/ZlibOutStream.cxx": [
      "File: common/rdr/ZlibOutStream.cxx -> common/rdr/ZlibOutStream.cxx",
      "--- Hunk 1 ---",
      "[Context before]",
      "34: enum { DEFAULT_BUF_SIZE = 16384 };",
      "37:   : underlying(os), compressionLevel(compressLevel), newLevel(compressLevel),",
      "38:     bufSize(bufSize_ ? bufSize_ : DEFAULT_BUF_SIZE), offset(0)",
      "39: {",
      "",
      "[Removed Lines]",
      "36: ZlibOutStream::ZlibOutStream(OutStream* os, int bufSize_, int compressLevel)",
      "",
      "[Added Lines]",
      "36: ZlibOutStream::ZlibOutStream(OutStream* os, size_t bufSize_, int compressLevel)",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "75:   newLevel = level;",
      "76: }",
      "79: {",
      "80:   return offset + ptr - start;",
      "81: }",
      "",
      "[Removed Lines]",
      "78: int ZlibOutStream::length()",
      "",
      "[Added Lines]",
      "78: size_t ZlibOutStream::length()",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "98:   ptr = start;",
      "99: }",
      "102: {",
      "103: #ifdef ZLIBOUT_DEBUG",
      "104:   vlog.debug(\"overrun\");",
      "",
      "[Removed Lines]",
      "101: int ZlibOutStream::overrun(int itemSize, int nItems)",
      "",
      "[Added Lines]",
      "101: size_t ZlibOutStream::overrun(size_t itemSize, size_t nItems)",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "110:   checkCompressionLevel();",
      "113:     zs->next_in = start;",
      "114:     zs->avail_in = ptr - start;",
      "",
      "[Removed Lines]",
      "112:   while (end - ptr < itemSize) {",
      "",
      "[Added Lines]",
      "112:   while ((size_t)(end - ptr) < itemSize) {",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "130:     }",
      "131:   }",
      "134:     nItems = (end - ptr) / itemSize;",
      "136:   return nItems;",
      "",
      "[Removed Lines]",
      "133:   if (itemSize * nItems > end - ptr)",
      "",
      "[Added Lines]",
      "133:   if (itemSize * nItems > (size_t)(end - ptr))",
      "",
      "---------------"
    ],
    "common/rdr/ZlibOutStream.h||common/rdr/ZlibOutStream.h": [
      "File: common/rdr/ZlibOutStream.h -> common/rdr/ZlibOutStream.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "36:   public:",
      "39:     virtual ~ZlibOutStream();",
      "41:     void setUnderlying(OutStream* os);",
      "42:     void setCompressionLevel(int level=-1);",
      "43:     void flush();",
      "46:   private:",
      "49:     void deflate(int flush);",
      "50:     void checkCompressionLevel();",
      "52:     OutStream* underlying;",
      "53:     int compressionLevel;",
      "54:     int newLevel;",
      "57:     z_stream_s* zs;",
      "58:     U8* start;",
      "59:   };",
      "",
      "[Removed Lines]",
      "38:     ZlibOutStream(OutStream* os=0, int bufSize=0, int compressionLevel=-1);",
      "44:     int length();",
      "48:     int overrun(int itemSize, int nItems);",
      "55:     int bufSize;",
      "56:     int offset;",
      "",
      "[Added Lines]",
      "38:     ZlibOutStream(OutStream* os=0, size_t bufSize=0, int compressionLevel=-1);",
      "44:     size_t length();",
      "48:     size_t overrun(size_t itemSize, size_t nItems);",
      "55:     size_t bufSize;",
      "56:     size_t offset;",
      "",
      "---------------"
    ],
    "common/rfb/Configuration.cxx||common/rfb/Configuration.cxx": [
      "File: common/rfb/Configuration.cxx -> common/rfb/Configuration.cxx",
      "--- Hunk 1 ---",
      "[Context before]",
      "423: BinaryParameter::BinaryParameter(const char* name_, const char* desc_,",
      "425: : VoidParameter(name_, desc_, co), value(0), length(0), def_value((char*)v), def_length(l) {",
      "426:   if (l) {",
      "427:     value = new char[l];",
      "",
      "[Removed Lines]",
      "424:      const void* v, int l, ConfigurationObject co)",
      "",
      "[Added Lines]",
      "424:      const void* v, size_t l, ConfigurationObject co)",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "441:   return rdr::HexInStream::hexStrToBin(v, &value, &length);",
      "442: }",
      "445:   LOCK_CONFIG;",
      "446:   if (immutable) return;",
      "447:   vlog.debug(\"set %s(Binary)\", getName());",
      "",
      "[Removed Lines]",
      "444: void BinaryParameter::setParam(const void* v, int len) {",
      "",
      "[Added Lines]",
      "444: void BinaryParameter::setParam(const void* v, size_t len) {",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "462:   return rdr::HexOutStream::binToHexStr(value, length);",
      "463: }",
      "466:   LOCK_CONFIG;",
      "467:   if (length_) *length_ = length;",
      "468:   if (data_) {",
      "",
      "[Removed Lines]",
      "465: void BinaryParameter::getData(void** data_, int* length_) const {",
      "",
      "[Added Lines]",
      "465: void BinaryParameter::getData(void** data_, size_t* length_) const {",
      "",
      "---------------"
    ],
    "common/rfb/Configuration.h||common/rfb/Configuration.h": [
      "File: common/rfb/Configuration.h -> common/rfb/Configuration.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "257:   class BinaryParameter : public VoidParameter {",
      "258:   public:",
      "261:     using VoidParameter::setParam;",
      "262:     virtual ~BinaryParameter();",
      "263:     virtual bool setParam(const char* value);",
      "265:     virtual char* getDefaultStr() const;",
      "266:     virtual char* getValueStr() const;",
      "272:   protected:",
      "273:     char* value;",
      "275:     char* def_value;",
      "277:   };",
      "",
      "[Removed Lines]",
      "259:     BinaryParameter(const char* name_, const char* desc_, const void* v, int l,",
      "260:       ConfigurationObject co=ConfGlobal);",
      "264:     virtual void setParam(const void* v, int l);",
      "270:     void getData(void** data, int* length) const;",
      "274:     int length;",
      "276:     int def_length;",
      "",
      "[Added Lines]",
      "259:     BinaryParameter(const char* name_, const char* desc_,",
      "260:                     const void* v, size_t l,",
      "261:                     ConfigurationObject co=ConfGlobal);",
      "265:     virtual void setParam(const void* v, size_t l);",
      "271:     void getData(void** data, size_t* length) const;",
      "275:     size_t length;",
      "277:     size_t def_length;",
      "",
      "---------------"
    ],
    "common/rfb/Password.cxx||common/rfb/Password.cxx": [
      "File: common/rfb/Password.cxx -> common/rfb/Password.cxx",
      "--- Hunk 1 ---",
      "[Context before]",
      "38: PlainPasswd::PlainPasswd(char* pwd) : CharArray(pwd) {",
      "39: }",
      "42: }",
      "44: PlainPasswd::PlainPasswd(const ObfuscatedPasswd& obfPwd) : CharArray(9) {",
      "",
      "[Removed Lines]",
      "41: PlainPasswd::PlainPasswd(int len) : CharArray(len) {",
      "",
      "[Added Lines]",
      "41: PlainPasswd::PlainPasswd(size_t len) : CharArray(len) {",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "63: ObfuscatedPasswd::ObfuscatedPasswd() : length(0) {",
      "64: }",
      "67: }",
      "69: ObfuscatedPasswd::ObfuscatedPasswd(const PlainPasswd& plainPwd) : CharArray(8), length(8) {",
      "71:   for (i=0; i<8; i++)",
      "72:     buf[i] = i<l ? plainPwd.buf[i] : 0;",
      "73:   deskey(d3desObfuscationKey, EN0);",
      "",
      "[Removed Lines]",
      "66: ObfuscatedPasswd::ObfuscatedPasswd(int len) : CharArray(len), length(len) {",
      "70:   int l = strlen(plainPwd.buf), i;",
      "",
      "[Added Lines]",
      "66: ObfuscatedPasswd::ObfuscatedPasswd(size_t len) : CharArray(len), length(len) {",
      "70:   size_t l = strlen(plainPwd.buf), i;",
      "",
      "---------------"
    ],
    "common/rfb/Password.h||common/rfb/Password.h": [
      "File: common/rfb/Password.h -> common/rfb/Password.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "28:   public:",
      "29:     PlainPasswd();",
      "30:     PlainPasswd(char* pwd);",
      "32:     PlainPasswd(const ObfuscatedPasswd& obfPwd);",
      "33:     ~PlainPasswd();",
      "34:     void replaceBuf(char* b);",
      "",
      "[Removed Lines]",
      "31:     PlainPasswd(int len);",
      "",
      "[Added Lines]",
      "31:     PlainPasswd(size_t len);",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "37:   class ObfuscatedPasswd : public CharArray {",
      "38:   public:",
      "39:     ObfuscatedPasswd();",
      "41:     ObfuscatedPasswd(const PlainPasswd& plainPwd);",
      "42:     ~ObfuscatedPasswd();",
      "44:   };",
      "46: }",
      "",
      "[Removed Lines]",
      "40:     ObfuscatedPasswd(int l);",
      "43:     int length;",
      "",
      "[Added Lines]",
      "40:     ObfuscatedPasswd(size_t l);",
      "43:     size_t length;",
      "",
      "---------------"
    ],
    "common/rfb/util.h||common/rfb/util.h": [
      "File: common/rfb/util.h -> common/rfb/util.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "50:   public:",
      "51:     CharArray() : buf(0) {}",
      "52:     CharArray(char* str) : buf(str) {} // note: assumes ownership",
      "54:       buf = new char[len]();",
      "55:     }",
      "56:     ~CharArray() {",
      "",
      "[Removed Lines]",
      "53:     CharArray(int len) {",
      "",
      "[Added Lines]",
      "53:     CharArray(size_t len) {",
      "",
      "---------------"
    ],
    "tests/perf/encperf.cxx||tests/perf/encperf.cxx": [
      "File: tests/perf/encperf.cxx -> tests/perf/encperf.cxx",
      "--- Hunk 1 ---",
      "[Context before]",
      "71: public:",
      "72:   DummyOutStream();",
      "75:   virtual void flush();",
      "77: private:",
      "80:   int offset;",
      "81:   rdr::U8 buf[131072];",
      "",
      "[Removed Lines]",
      "74:   virtual int length();",
      "78:   virtual int overrun(int itemSize, int nItems);",
      "",
      "[Added Lines]",
      "74:   virtual size_t length();",
      "78:   virtual size_t overrun(size_t itemSize, size_t nItems);",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "141:   end = buf + sizeof(buf);",
      "142: }",
      "145: {",
      "146:   flush();",
      "147:   return offset;",
      "",
      "[Removed Lines]",
      "144: int DummyOutStream::length()",
      "",
      "[Added Lines]",
      "144: size_t DummyOutStream::length()",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "153:   ptr = buf;",
      "154: }",
      "157: {",
      "158:   flush();",
      "160:     nItems = (end - ptr) / itemSize;",
      "161:   return nItems;",
      "162: }",
      "",
      "[Removed Lines]",
      "156: int DummyOutStream::overrun(int itemSize, int nItems)",
      "159:   if (itemSize * nItems > end - ptr)",
      "",
      "[Added Lines]",
      "156: size_t DummyOutStream::overrun(size_t itemSize, size_t nItems)",
      "159:   if (itemSize * nItems > (size_t)(end - ptr))",
      "",
      "---------------"
    ],
    "win/rfb_win32/Registry.cxx||win/rfb_win32/Registry.cxx": [
      "File: win/rfb_win32/Registry.cxx -> win/rfb_win32/Registry.cxx",
      "--- Hunk 1 ---",
      "[Context before]",
      "146:   if (result != ERROR_SUCCESS) throw rdr::SystemException(\"setString\", result);",
      "147: }",
      "150:   LONG result = RegSetValueEx(key, valname, 0, REG_BINARY, (const BYTE*)value, length);",
      "151:   if (result != ERROR_SUCCESS) throw rdr::SystemException(\"setBinary\", result);",
      "152: }",
      "",
      "[Removed Lines]",
      "149: void RegKey::setBinary(const TCHAR* valname, const void* value, int length) const {",
      "",
      "[Added Lines]",
      "149: void RegKey::setBinary(const TCHAR* valname, const void* value, size_t length) const {",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "169:   }",
      "170: }",
      "173:   TCharArray hex(getRepresentation(valname));",
      "174:   if (!rdr::HexInStream::hexStrToBin(CStr(hex.buf), (char**)data, length))",
      "175:     throw rdr::Exception(\"getBinary failed\");",
      "176: }",
      "178:   try {",
      "179:     getBinary(valname, data, length);",
      "180:   } catch(rdr::Exception&) {",
      "",
      "[Removed Lines]",
      "172: void RegKey::getBinary(const TCHAR* valname, void** data, int* length) const {",
      "177: void RegKey::getBinary(const TCHAR* valname, void** data, int* length, void* def, int deflen) const {",
      "",
      "[Added Lines]",
      "172: void RegKey::getBinary(const TCHAR* valname, void** data, size_t* length) const {",
      "177: void RegKey::getBinary(const TCHAR* valname, void** data, size_t* length, void* def, size_t deflen) const {",
      "",
      "---------------"
    ],
    "win/rfb_win32/Registry.h||win/rfb_win32/Registry.h": [
      "File: win/rfb_win32/Registry.h -> win/rfb_win32/Registry.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "72:       void setExpandString(const TCHAR* valname, const TCHAR* s) const;",
      "73:       void setString(const TCHAR* valname, const TCHAR* s) const;",
      "75:       void setInt(const TCHAR* valname, int i) const;",
      "76:       void setBool(const TCHAR* valname, bool b) const;",
      "78:       TCHAR* getString(const TCHAR* valname) const;",
      "79:       TCHAR* getString(const TCHAR* valname, const TCHAR* def) const;",
      "84:       int getInt(const TCHAR* valname) const;",
      "85:       int getInt(const TCHAR* valname, int def) const;",
      "",
      "[Removed Lines]",
      "74:       void setBinary(const TCHAR* valname, const void* data, int length) const;",
      "81:       void getBinary(const TCHAR* valname, void** data, int* length) const;",
      "82:       void getBinary(const TCHAR* valname, void** data, int* length, void* def, int deflength) const;",
      "",
      "[Added Lines]",
      "74:       void setBinary(const TCHAR* valname, const void* data, size_t length) const;",
      "81:       void getBinary(const TCHAR* valname, void** data, size_t* length) const;",
      "82:       void getBinary(const TCHAR* valname, void** data, size_t* length, void* def, size_t deflength) const;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "05e28490873a861379c943bf616614b78b558b89",
      "candidate_info": {
        "commit_hash": "05e28490873a861379c943bf616614b78b558b89",
        "repo": "CendioOssman/tigervnc",
        "commit_url": "https://github.com/CendioOssman/tigervnc/commit/05e28490873a861379c943bf616614b78b558b89",
        "files": [
          "common/rfb/PixelFormat.cxx",
          "tests/unit/pixelformat.cxx"
        ],
        "message": "Handle pixel formats with odd shift values\n\nOur fast paths assume that each channel fits in to a separate byte.\nThat means the shift needs to be a multiple of 8. Start actually\nchecking this so that a client cannot trip us up and possibly cause\nincorrect code exection.\n\nIssue found by Pavel Cheremushkin from Kaspersky Lab.",
        "before_after_code_files": [
          "common/rfb/PixelFormat.cxx||common/rfb/PixelFormat.cxx",
          "tests/unit/pixelformat.cxx||tests/unit/pixelformat.cxx"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/TigerVNC/tigervnc/pull/921"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "common/rfb/PixelFormat.cxx||common/rfb/PixelFormat.cxx": [
          "File: common/rfb/PixelFormat.cxx -> common/rfb/PixelFormat.cxx",
          "--- Hunk 1 ---",
          "[Context before]",
          "206:     return false;",
          "207:   if (blueMax != 255)",
          "208:     return false;",
          "210:   return true;",
          "211: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "209:   if ((redShift & 0x7) != 0)",
          "210:     return false;",
          "211:   if ((greenShift & 0x7) != 0)",
          "212:     return false;",
          "213:   if ((blueShift & 0x7) != 0)",
          "214:     return false;",
          "",
          "---------------"
        ],
        "tests/unit/pixelformat.cxx||tests/unit/pixelformat.cxx": [
          "File: tests/unit/pixelformat.cxx -> tests/unit/pixelformat.cxx",
          "--- Hunk 1 ---",
          "[Context before]",
          "171:     do888Test(false, 8, 8, false, false, 0, 0, 0, 0, 0, 0);",
          "173:     printf(\"\\n\");",
          "174: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "175:     do888Test(false, 32, 24, false, true, 255, 255, 255, 0, 8, 18);",
          "176:     do888Test(false, 32, 24, false, true, 255, 255, 255, 0, 11, 24);",
          "177:     do888Test(false, 32, 24, false, true, 255, 255, 255, 4, 16, 24);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "996356b6c65ca165ee1ea46a571c32a1dc3c3821",
      "candidate_info": {
        "commit_hash": "996356b6c65ca165ee1ea46a571c32a1dc3c3821",
        "repo": "CendioOssman/tigervnc",
        "commit_url": "https://github.com/CendioOssman/tigervnc/commit/996356b6c65ca165ee1ea46a571c32a1dc3c3821",
        "files": [
          "common/rfb/PixelBuffer.cxx"
        ],
        "message": "Restrict PixelBuffer dimensions to safe values\n\nWe do a lot of calculations based on pixel coordinates and we need\nto make sure they do not overflow. Restrict the maximum dimensions\nwe support rather than try to switch over all calculations to use\n64 bit integers.\n\nThis prevents attackers from from injecting code by specifying a\nhuge framebuffer size and relying on the values overflowing to\naccess invalid areas of the heap.\n\nThis primarily affects the client which gets both the screen\ndimensions and the pixel contents from the remote side. But the\nserver might also be affected as a client can adjust the screen\ndimensions, as can applications inside the session.\n\nIssue found by Pavel Cheremushkin from Kaspersky Lab.",
        "before_after_code_files": [
          "common/rfb/PixelBuffer.cxx||common/rfb/PixelBuffer.cxx"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/TigerVNC/tigervnc/pull/921"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "common/rfb/PixelBuffer.cxx||common/rfb/PixelBuffer.cxx": [
          "File: common/rfb/PixelBuffer.cxx -> common/rfb/PixelBuffer.cxx",
          "--- Hunk 1 ---",
          "[Context before]",
          "32: static LogWriter vlog(\"PixelBuffer\");",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "38: const int maxPixelBufferWidth = 16384;",
          "39: const int maxPixelBufferHeight = 16384;",
          "40: const int maxPixelBufferStride = 16384;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "109: void PixelBuffer::setSize(int width, int height)",
          "110: {",
          "111:   width_ = width;",
          "112:   height_ = height;",
          "113: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "119:   if ((width < 0) || (width > maxPixelBufferWidth))",
          "120:     throw rfb::Exception(\"Invalid PixelBuffer width of %d pixels requested\", width);",
          "121:   if ((height < 0) || (height > maxPixelBufferHeight))",
          "122:     throw rfb::Exception(\"Invalid PixelBuffer height of %d pixels requested\", height);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "340: void FullFramePixelBuffer::setBuffer(int width, int height,",
          "341:                                      rdr::U8* data_, int stride_)",
          "342: {",
          "343:   ModifiablePixelBuffer::setSize(width, height);",
          "344:   stride = stride_;",
          "345:   data = data_;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "356:   if ((width < 0) || (width > maxPixelBufferWidth))",
          "357:     throw rfb::Exception(\"Invalid PixelBuffer width of %d pixels requested\", width);",
          "358:   if ((height < 0) || (height > maxPixelBufferHeight))",
          "359:     throw rfb::Exception(\"Invalid PixelBuffer height of %d pixels requested\", height);",
          "360:   if ((stride_ < 0) || (stride_ > maxPixelBufferStride) || (stride_ < width))",
          "361:     throw rfb::Exception(\"Invalid PixelBuffer stride of %d pixels requested\", stride_);",
          "362:   if ((width != 0) && (height != 0) && (data_ == NULL))",
          "363:     throw rfb::Exception(\"PixelBuffer requested without a valid memory area\");",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "cd1d650c532a46e95a1229dffaf281c76a50cdfe",
      "candidate_info": {
        "commit_hash": "cd1d650c532a46e95a1229dffaf281c76a50cdfe",
        "repo": "CendioOssman/tigervnc",
        "commit_url": "https://github.com/CendioOssman/tigervnc/commit/cd1d650c532a46e95a1229dffaf281c76a50cdfe",
        "files": [
          "common/rfb/PixelFormat.cxx",
          "tests/unit/pixelformat.cxx"
        ],
        "message": "Add sanity checks for PixelFormat shift values\n\nOtherwise we might be tricked in to reading and writing things at\nincorrect offsets for pixels which ultimately could result in an\nattacker writing things to the stack or heap and executing things\nthey shouldn't.\n\nThis only affects the server as the client never uses the pixel\nformat suggested by th server.\n\nIssue found by Pavel Cheremushkin from Kaspersky Lab.",
        "before_after_code_files": [
          "common/rfb/PixelFormat.cxx||common/rfb/PixelFormat.cxx",
          "tests/unit/pixelformat.cxx||tests/unit/pixelformat.cxx"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/TigerVNC/tigervnc/pull/921"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "common/rfb/PixelFormat.cxx||common/rfb/PixelFormat.cxx": [
          "File: common/rfb/PixelFormat.cxx -> common/rfb/PixelFormat.cxx",
          "--- Hunk 1 ---",
          "[Context before]",
          "682:   if (totalBits > depth)",
          "683:     return false;",
          "685:   if (((redMax << redShift) & (greenMax << greenShift)) != 0)",
          "686:     return false;",
          "687:   if (((redMax << redShift) & (blueMax << blueShift)) != 0)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "685:   if ((bits(redMax) + redShift) > bpp)",
          "686:     return false;",
          "687:   if ((bits(greenMax) + greenShift) > bpp)",
          "688:     return false;",
          "689:   if ((bits(blueMax) + blueShift) > bpp)",
          "690:     return false;",
          "",
          "---------------"
        ],
        "tests/unit/pixelformat.cxx||tests/unit/pixelformat.cxx": [
          "File: tests/unit/pixelformat.cxx -> tests/unit/pixelformat.cxx",
          "--- Hunk 1 ---",
          "[Context before]",
          "109:     doTest(true, 32, 16, false, true, 255, 255, 255, 0, 8, 16);",
          "113:     doTest(true, 32, 24, false, true, 255, 255, 255, 0, 7, 16);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "113:     doTest(true, 32, 24, false, true, 255, 255, 255, 25, 8, 16);",
          "114:     doTest(true, 32, 24, false, true, 255, 255, 255, 0, 25, 16);",
          "115:     doTest(true, 32, 24, false, true, 255, 255, 255, 0, 8, 25);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "d61a767d6842b530ffb532ddd5a3d233119aad40",
      "candidate_info": {
        "commit_hash": "d61a767d6842b530ffb532ddd5a3d233119aad40",
        "repo": "CendioOssman/tigervnc",
        "commit_url": "https://github.com/CendioOssman/tigervnc/commit/d61a767d6842b530ffb532ddd5a3d233119aad40",
        "files": [
          "common/rdr/ZlibInStream.cxx",
          "common/rdr/ZlibInStream.h",
          "common/rfb/CMsgReader.cxx",
          "common/rfb/SMsgReader.cxx",
          "common/rfb/TightDecoder.cxx",
          "common/rfb/zrleDecode.h"
        ],
        "message": "Make ZlibInStream more robust against failures\n\nMove the checks around to avoid missing cases where we might access\nmemory that is no longer valid. Also avoid touching the underlying\nstream implicitly (e.g. via the destructor) as it might also no\nlonger be valid.\n\nA malicious server could theoretically use this for remote code\nexecution in the client.\n\nIssue found by Pavel Cheremushkin from Kaspersky Lab",
        "before_after_code_files": [
          "common/rdr/ZlibInStream.cxx||common/rdr/ZlibInStream.cxx",
          "common/rdr/ZlibInStream.h||common/rdr/ZlibInStream.h",
          "common/rfb/CMsgReader.cxx||common/rfb/CMsgReader.cxx",
          "common/rfb/SMsgReader.cxx||common/rfb/SMsgReader.cxx",
          "common/rfb/TightDecoder.cxx||common/rfb/TightDecoder.cxx",
          "common/rfb/zrleDecode.h||common/rfb/zrleDecode.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/TigerVNC/tigervnc/pull/921"
        ],
        "olp_code_files": {
          "patch": [
            "common/rdr/ZlibInStream.cxx||common/rdr/ZlibInStream.cxx",
            "common/rdr/ZlibInStream.h||common/rdr/ZlibInStream.h"
          ],
          "candidate": [
            "common/rdr/ZlibInStream.cxx||common/rdr/ZlibInStream.cxx",
            "common/rdr/ZlibInStream.h||common/rdr/ZlibInStream.h"
          ]
        }
      },
      "candidate_diff": {
        "common/rdr/ZlibInStream.cxx||common/rdr/ZlibInStream.cxx": [
          "File: common/rdr/ZlibInStream.cxx -> common/rdr/ZlibInStream.cxx",
          "--- Hunk 1 ---",
          "[Context before]",
          "52:   return offset + ptr - start;",
          "53: }",
          "56: {",
          "57:   ptr = end = start;",
          "60:   while (bytesIn > 0) {",
          "61:     decompress(true);",
          "62:     end = start; // throw away any data",
          "63:   }",
          "65: }",
          "67: void ZlibInStream::reset()",
          "",
          "[Removed Lines]",
          "55: void ZlibInStream::removeUnderlying()",
          "58:   if (!underlying) return;",
          "64:   underlying = 0;",
          "",
          "[Added Lines]",
          "55: void ZlibInStream::flushUnderlying()",
          "64:   setUnderlying(NULL, 0);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "90: void ZlibInStream::deinit()",
          "91: {",
          "92:   assert(zs != NULL);",
          "94:   inflateEnd(zs);",
          "95:   delete zs;",
          "96:   zs = NULL;",
          "",
          "[Removed Lines]",
          "93:   removeUnderlying();",
          "",
          "[Added Lines]",
          "93:   setUnderlying(NULL, 0);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "100: {",
          "101:   if (itemSize > bufSize)",
          "102:     throw Exception(\"ZlibInStream overrun: max itemSize exceeded\");",
          "106:   if (end - ptr != 0)",
          "107:     memmove(start, ptr, end - ptr);",
          "",
          "[Removed Lines]",
          "103:   if (!underlying)",
          "104:     throw Exception(\"ZlibInStream overrun: no underlying stream\");",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "128: bool ZlibInStream::decompress(bool wait)",
          "129: {",
          "130:   zs->next_out = (U8*)end;",
          "131:   zs->avail_out = start + bufSize - end;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "128:   if (!underlying)",
          "129:     throw Exception(\"ZlibInStream overrun: no underlying stream\");",
          "",
          "---------------"
        ],
        "common/rdr/ZlibInStream.h||common/rdr/ZlibInStream.h": [
          "File: common/rdr/ZlibInStream.h -> common/rdr/ZlibInStream.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "38:     virtual ~ZlibInStream();",
          "40:     void setUnderlying(InStream* is, int bytesIn);",
          "42:     int pos();",
          "43:     void reset();",
          "",
          "[Removed Lines]",
          "41:     void removeUnderlying();",
          "",
          "[Added Lines]",
          "41:     void flushUnderlying();",
          "",
          "---------------"
        ],
        "common/rfb/CMsgReader.cxx||common/rfb/CMsgReader.cxx": [
          "File: common/rfb/CMsgReader.cxx -> common/rfb/CMsgReader.cxx",
          "--- Hunk 1 ---",
          "[Context before]",
          "242:       num++;",
          "243:     }",
          "247:     handler->handleClipboardProvide(flags, lengths, buffers);",
          "",
          "[Removed Lines]",
          "245:     zis.removeUnderlying();",
          "",
          "[Added Lines]",
          "245:     zis.flushUnderlying();",
          "246:     zis.setUnderlying(NULL, 0);",
          "",
          "---------------"
        ],
        "common/rfb/SMsgReader.cxx||common/rfb/SMsgReader.cxx": [
          "File: common/rfb/SMsgReader.cxx -> common/rfb/SMsgReader.cxx",
          "--- Hunk 1 ---",
          "[Context before]",
          "293:       num++;",
          "294:     }",
          "298:     handler->handleClipboardProvide(flags, lengths, buffers);",
          "",
          "[Removed Lines]",
          "296:     zis.removeUnderlying();",
          "",
          "[Added Lines]",
          "296:     zis.flushUnderlying();",
          "297:     zis.setUnderlying(NULL, 0);",
          "",
          "---------------"
        ],
        "common/rfb/TightDecoder.cxx||common/rfb/TightDecoder.cxx": [
          "File: common/rfb/TightDecoder.cxx -> common/rfb/TightDecoder.cxx",
          "--- Hunk 1 ---",
          "[Context before]",
          "342:     zis[streamId].readBytes(netbuf, dataSize);",
          "345:     delete ms;",
          "347:     bufptr = netbuf;",
          "",
          "[Removed Lines]",
          "344:     zis[streamId].removeUnderlying();",
          "",
          "[Added Lines]",
          "344:     zis[streamId].flushUnderlying();",
          "345:     zis[streamId].setUnderlying(NULL, 0);",
          "",
          "---------------"
        ],
        "common/rfb/zrleDecode.h||common/rfb/zrleDecode.h": [
          "File: common/rfb/zrleDecode.h -> common/rfb/zrleDecode.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "174:     }",
          "175:   }",
          "178: }",
          "180: #undef ZRLE_DECODE",
          "",
          "[Removed Lines]",
          "177:   zis->removeUnderlying();",
          "",
          "[Added Lines]",
          "177:   zis->flushUnderlying();",
          "178:   zis->setUnderlying(NULL, 0);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "4ff58f0acaeb566b79ae12cf013b376eaaaab834",
      "candidate_info": {
        "commit_hash": "4ff58f0acaeb566b79ae12cf013b376eaaaab834",
        "repo": "CendioOssman/tigervnc",
        "commit_url": "https://github.com/CendioOssman/tigervnc/commit/4ff58f0acaeb566b79ae12cf013b376eaaaab834",
        "files": [
          "common/rdr/FixedMemOutStream.h"
        ],
        "message": "Remove unused FixedMemOutStream",
        "before_after_code_files": [
          "common/rdr/FixedMemOutStream.h||common/rdr/FixedMemOutStream.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/TigerVNC/tigervnc/pull/921"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "common/rdr/FixedMemOutStream.h||common/rdr/FixedMemOutStream.h": [
          "File: common/rdr/FixedMemOutStream.h -> common/rdr/FixedMemOutStream.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    }
  ]
}