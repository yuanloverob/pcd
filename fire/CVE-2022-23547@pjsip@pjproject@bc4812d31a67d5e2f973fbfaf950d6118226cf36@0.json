{
  "cve_id": "CVE-2022-23547",
  "cve_desc": "PJSIP is a free and open source multimedia communication library written in C language implementing standard based protocols such as SIP, SDP, RTP, STUN, TURN, and ICE. This issue is similar to GHSA-9pfh-r8x4-w26w. Possible buffer overread when parsing a certain STUN message. The vulnerability affects applications that uses STUN including PJNATH and PJSUA-LIB. The patch is available as commit in the master branch.",
  "repo": "pjsip/pjproject",
  "patch_hash": "bc4812d31a67d5e2f973fbfaf950d6118226cf36",
  "patch_info": {
    "commit_hash": "bc4812d31a67d5e2f973fbfaf950d6118226cf36",
    "repo": "pjsip/pjproject",
    "commit_url": "https://github.com/pjsip/pjproject/commit/bc4812d31a67d5e2f973fbfaf950d6118226cf36",
    "files": [
      "pjnath/src/pjnath/stun_msg.c"
    ],
    "message": "Merge pull request from GHSA-cxwq-5g9x-x7fr\n\n* Fixed heap buffer overflow when parsing STUN errcode attribute\n\n* Also fixed uint parsing",
    "before_after_code_files": [
      "pjnath/src/pjnath/stun_msg.c||pjnath/src/pjnath/stun_msg.c"
    ]
  },
  "patch_diff": {
    "pjnath/src/pjnath/stun_msg.c||pjnath/src/pjnath/stun_msg.c": [
      "File: pjnath/src/pjnath/stun_msg.c -> pjnath/src/pjnath/stun_msg.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1438:     attr = PJ_POOL_ZALLOC_T(pool, pj_stun_uint_attr);",
      "1439:     GETATTRHDR(buf, &attr->hdr);",
      "1444:     if (attr->hdr.length != 4)",
      "1445:         return PJNATH_ESTUNINATTRLEN;",
      "",
      "[Removed Lines]",
      "1441:     attr->value = GETVAL32H(buf, 4);",
      "",
      "[Added Lines]",
      "1445:     attr->value = GETVAL32H(buf, 4);",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "1757:     attr = PJ_POOL_ZALLOC_T(pool, pj_stun_errcode_attr);",
      "1758:     GETATTRHDR(buf, &attr->hdr);",
      "1760:     attr->err_code = buf[6] * 100 + buf[7];",
      "1763:     value.ptr = ((char*)buf + ATTR_HDR_LEN + 4);",
      "1764:     value.slen = attr->hdr.length - 4;",
      "1770:     pj_strdup(pool, &attr->reason, &value);",
      "",
      "[Removed Lines]",
      "1766:     if (value.slen < 0)",
      "1767:         value.slen = 0;",
      "",
      "[Added Lines]",
      "1761:     if (attr->hdr.length < 4)",
      "1762:         return PJNATH_ESTUNINATTRLEN;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "4cea72a4db91c6f0a0984b82edf2f147eda289aa",
      "candidate_info": {
        "commit_hash": "4cea72a4db91c6f0a0984b82edf2f147eda289aa",
        "repo": "pjsip/pjproject",
        "commit_url": "https://github.com/pjsip/pjproject/commit/4cea72a4db91c6f0a0984b82edf2f147eda289aa",
        "files": [
          "pjnath/src/pjnath/stun_msg.c"
        ],
        "message": "Merge pull request from GHSA-cxwq-5g9x-x7fr\n\n* Fixed heap buffer overflow when parsing STUN errcode attribute\n\n* Also fixed uint parsing",
        "before_after_code_files": [
          "pjnath/src/pjnath/stun_msg.c||pjnath/src/pjnath/stun_msg.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "pjnath/src/pjnath/stun_msg.c||pjnath/src/pjnath/stun_msg.c"
          ],
          "candidate": [
            "pjnath/src/pjnath/stun_msg.c||pjnath/src/pjnath/stun_msg.c"
          ]
        }
      },
      "candidate_diff": {
        "pjnath/src/pjnath/stun_msg.c||pjnath/src/pjnath/stun_msg.c": [
          "File: pjnath/src/pjnath/stun_msg.c -> pjnath/src/pjnath/stun_msg.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1438:     attr = PJ_POOL_ZALLOC_T(pool, pj_stun_uint_attr);",
          "1439:     GETATTRHDR(buf, &attr->hdr);",
          "1444:     if (attr->hdr.length != 4)",
          "1445:         return PJNATH_ESTUNINATTRLEN;",
          "",
          "[Removed Lines]",
          "1441:     attr->value = GETVAL32H(buf, 4);",
          "",
          "[Added Lines]",
          "1445:     attr->value = GETVAL32H(buf, 4);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1757:     attr = PJ_POOL_ZALLOC_T(pool, pj_stun_errcode_attr);",
          "1758:     GETATTRHDR(buf, &attr->hdr);",
          "1760:     attr->err_code = buf[6] * 100 + buf[7];",
          "1763:     value.ptr = ((char*)buf + ATTR_HDR_LEN + 4);",
          "1764:     value.slen = attr->hdr.length - 4;",
          "1770:     pj_strdup(pool, &attr->reason, &value);",
          "",
          "[Removed Lines]",
          "1766:     if (value.slen < 0)",
          "1767:         value.slen = 0;",
          "",
          "[Added Lines]",
          "1761:     if (attr->hdr.length < 4)",
          "1762:         return PJNATH_ESTUNINATTRLEN;",
          "",
          "---------------"
        ]
      }
    }
  ]
}