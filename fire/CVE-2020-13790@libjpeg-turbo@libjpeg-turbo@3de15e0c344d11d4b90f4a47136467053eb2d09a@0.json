{
  "cve_id": "CVE-2020-13790",
  "cve_desc": "libjpeg-turbo 2.0.4, and mozjpeg 4.0.0, has a heap-based buffer over-read in get_rgb_row() in rdppm.c via a malformed PPM input file.",
  "repo": "libjpeg-turbo/libjpeg-turbo",
  "patch_hash": "3de15e0c344d11d4b90f4a47136467053eb2d09a",
  "patch_info": {
    "commit_hash": "3de15e0c344d11d4b90f4a47136467053eb2d09a",
    "repo": "libjpeg-turbo/libjpeg-turbo",
    "commit_url": "https://github.com/libjpeg-turbo/libjpeg-turbo/commit/3de15e0c344d11d4b90f4a47136467053eb2d09a",
    "files": [
      "ChangeLog.md",
      "rdppm.c"
    ],
    "message": "rdppm.c: Fix buf overrun caused by bad binary PPM\n\nThis extends the fix in 1e81b0c3ea26f4ea8f56de05367469333de64a9f to\ninclude binary PPM files with maximum values < 255, thus preventing a\nmalformed binary PPM input file with those specifications from\ntriggering an overrun of the rescale array and potentially crashing\ncjpeg, TJBench, or any program that uses the tjLoadImage() function.\n\nFixes #433",
    "before_after_code_files": [
      "rdppm.c||rdppm.c"
    ]
  },
  "patch_diff": {
    "rdppm.c||rdppm.c": [
      "File: rdppm.c -> rdppm.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "721:     source->rescale = (JSAMPLE *)",
      "722:       (*cinfo->mem->alloc_small) ((j_common_ptr)cinfo, JPOOL_IMAGE,",
      "724:                                            sizeof(JSAMPLE)));",
      "725:     half_maxval = maxval / 2;",
      "726:     for (val = 0; val <= (long)maxval; val++) {",
      "",
      "[Removed Lines]",
      "723:                                   (size_t)(((long)maxval + 1L) *",
      "",
      "[Added Lines]",
      "723:                                   (size_t)(((long)MAX(maxval, 255) + 1L) *",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "1bfb0b5247f4fc8f6677639781ce468543490216",
      "candidate_info": {
        "commit_hash": "1bfb0b5247f4fc8f6677639781ce468543490216",
        "repo": "libjpeg-turbo/libjpeg-turbo",
        "commit_url": "https://github.com/libjpeg-turbo/libjpeg-turbo/commit/1bfb0b5247f4fc8f6677639781ce468543490216",
        "files": [
          "ChangeLog.md",
          "rdppm.c"
        ],
        "message": "rdppm.c: Fix buf overrun caused by bad binary PPM\n\nThis extends the fix in 1e81b0c3ea26f4ea8f56de05367469333de64a9f to\ninclude binary PPM files with maximum values < 255, thus preventing a\nmalformed binary PPM input file with those specifications from\ntriggering an overrun of the rescale array and potentially crashing\ncjpeg, TJBench, or any program that uses the tjLoadImage() function.\n\nFixes #433",
        "before_after_code_files": [
          "rdppm.c||rdppm.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "rdppm.c||rdppm.c"
          ],
          "candidate": [
            "rdppm.c||rdppm.c"
          ]
        }
      },
      "candidate_diff": {
        "rdppm.c||rdppm.c": [
          "File: rdppm.c -> rdppm.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "27: #ifdef PPM_SUPPORTED",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "25: #define JPEG_INTERNALS",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "426:     source->rescale = (JSAMPLE *)",
          "427:       (*cinfo->mem->alloc_small) ((j_common_ptr) cinfo, JPOOL_IMAGE,",
          "429:                                             sizeof(JSAMPLE)));",
          "430:     half_maxval = maxval / 2;",
          "431:     for (val = 0; val <= (long) maxval; val++) {",
          "",
          "[Removed Lines]",
          "428:                                   (size_t) (((long) maxval + 1L) *",
          "",
          "[Added Lines]",
          "429:                                   (size_t) (((long) MAX(maxval, 255) + 1L) *",
          "",
          "---------------"
        ]
      }
    }
  ]
}