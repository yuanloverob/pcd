{
  "cve_id": "CVE-2023-38408",
  "cve_desc": "The PKCS#11 feature in ssh-agent in OpenSSH before 9.3p2 has an insufficiently trustworthy search path, leading to remote code execution if an agent is forwarded to an attacker-controlled system. (Code in /usr/lib is not necessarily safe for loading into ssh-agent.) NOTE: this issue exists because of an incomplete fix for CVE-2016-10009.",
  "repo": "openbsd/src",
  "patch_hash": "7bc29a9d5cd697290aa056e94ecee6253d3425f8",
  "patch_info": {
    "commit_hash": "7bc29a9d5cd697290aa056e94ecee6253d3425f8",
    "repo": "openbsd/src",
    "commit_url": "https://github.com/openbsd/src/commit/7bc29a9d5cd697290aa056e94ecee6253d3425f8",
    "files": [
      "usr.bin/ssh/ssh-agent.1",
      "usr.bin/ssh/ssh-agent.c"
    ],
    "message": "Disallow remote addition of FIDO/PKCS11 provider libraries to ssh-agent by default.\n\nThe old behaviour of allowing remote clients from loading providers\ncan be restored using `ssh-agent -O allow-remote-pkcs11`.\n\nDetection of local/remote clients requires a ssh(1) that supports\nthe `session-bind@openssh.com` extension. Forwarding access to a\nssh-agent socket using non-OpenSSH tools may circumvent this control.\n\nok markus@",
    "before_after_code_files": [
      "usr.bin/ssh/ssh-agent.1||usr.bin/ssh/ssh-agent.1",
      "usr.bin/ssh/ssh-agent.c||usr.bin/ssh/ssh-agent.c"
    ]
  },
  "patch_diff": {
    "usr.bin/ssh/ssh-agent.1||usr.bin/ssh/ssh-agent.1": [
      "File: usr.bin/ssh/ssh-agent.1 -> usr.bin/ssh/ssh-agent.1",
      "--- Hunk 1 ---",
      "[Context before]",
      "2: .\\\"",
      "3: .\\\" Author: Tatu Ylonen <ylo@cs.hut.fi>",
      "4: .\\\" Copyright (c) 1995 Tatu Ylonen <ylo@cs.hut.fi>, Espoo, Finland",
      "",
      "[Removed Lines]",
      "1: .\\\" $OpenBSD: ssh-agent.1,v 1.75 2022/10/07 06:00:58 jmc Exp $",
      "",
      "[Added Lines]",
      "1: .\\\" $OpenBSD: ssh-agent.1,v 1.76 2023/07/19 13:56:33 djm Exp $",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "34: .\\\" (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF",
      "35: .\\\" THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.",
      "36: .\\\"",
      "38: .Dt SSH-AGENT 1",
      "39: .Os",
      "40: .Sh NAME",
      "",
      "[Removed Lines]",
      "37: .Dd $Mdocdate: October 7 2022 $",
      "",
      "[Added Lines]",
      "37: .Dd $Mdocdate: July 19 2023 $",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "107: .It Fl O Ar option",
      "108: Specify an option when starting",
      "109: .Nm .",
      "111: .Cm no-restrict-websafe .",
      "113: .Nm",
      "114: to permit signatures using FIDO keys that might be web authentication",
      "115: requests.",
      "",
      "[Removed Lines]",
      "110: Currently only one option is supported:",
      "112: This instructs",
      "",
      "[Added Lines]",
      "110: Currently two options are supported:",
      "111: .Cm allow-remote-pkcs11",
      "112: and",
      "114: .Pp",
      "115: The",
      "116: .Cm allow-remote-pkcs11",
      "117: option allows clients of a forwarded",
      "118: .Nm",
      "119: to load PKCS#11 or FIDO provider libraries.",
      "120: By default only local clients may perform this operation.",
      "121: Note that signalling that a",
      "122: .Nm",
      "123: client remote is performed by",
      "124: .Xr ssh 1 ,",
      "125: and use of other tools to forward access to the agent socket may circumvent",
      "126: this restriction.",
      "127: .Pp",
      "128: The",
      "129: .Cm no-restrict-websafe ,",
      "130: instructs",
      "",
      "---------------"
    ],
    "usr.bin/ssh/ssh-agent.c||usr.bin/ssh/ssh-agent.c": [
      "File: usr.bin/ssh/ssh-agent.c -> usr.bin/ssh/ssh-agent.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "157: static char *allowed_providers;",
      "160: #define LOCK_SIZE 32",
      "161: #define LOCK_SALT_SIZE 16",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "163: static int remote_add_provider;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "1215:   if (strcasecmp(sk_provider, \"internal\") == 0) {",
      "1216:    debug_f(\"internal provider\");",
      "1217:   } else {",
      "1218:    if (realpath(sk_provider, canonical_provider) == NULL) {",
      "1219:     verbose(\"failed provider \\\"%.100s\\\": \"",
      "1220:         \"realpath: %s\", sk_provider,",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1224:    if (e->nsession_ids != 0 && !remote_add_provider) {",
      "1225:     verbose(\"failed add of SK provider \\\"%.100s\\\": \"",
      "1226:         \"remote addition of providers is disabled\",",
      "1227:         sk_provider);",
      "1228:     goto out;",
      "1229:    }",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "1378:   error_f(\"failed to parse constraints\");",
      "1379:   goto send;",
      "1380:  }",
      "1381:  if (realpath(provider, canonical_provider) == NULL) {",
      "1382:   verbose(\"failed PKCS#11 add of \\\"%.100s\\\": realpath: %s\",",
      "1383:       provider, strerror(errno));",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1393:  if (e->nsession_ids != 0 && !remote_add_provider) {",
      "1394:   verbose(\"failed PKCS#11 add of \\\"%.100s\\\": remote addition of \"",
      "1395:       \"providers is disabled\", provider);",
      "1396:   goto send;",
      "1397:  }",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "2032:    break;",
      "2033:   case 'O':",
      "2034:    if (strcmp(optarg, \"no-restrict-websafe\") == 0)",
      "2036:    else",
      "2037:     fatal(\"Unknown -O option\");",
      "2038:    break;",
      "",
      "[Removed Lines]",
      "2035:     restrict_websafe  = 0;",
      "",
      "[Added Lines]",
      "2052:     restrict_websafe = 0;",
      "2053:    else if (strcmp(optarg, \"allow-remote-pkcs11\") == 0)",
      "2054:     remote_add_provider = 1;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "f17d0bb035c3ce4015fbae9f795ba5d04a1ab538",
      "candidate_info": {
        "commit_hash": "f17d0bb035c3ce4015fbae9f795ba5d04a1ab538",
        "repo": "openbsd/src",
        "commit_url": "https://github.com/openbsd/src/commit/f17d0bb035c3ce4015fbae9f795ba5d04a1ab538",
        "files": [
          "usr.bin/ssh/ssh-agent.1"
        ],
        "message": "drop a wayward comma, ok jmc@",
        "before_after_code_files": [
          "usr.bin/ssh/ssh-agent.1||usr.bin/ssh/ssh-agent.1"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "usr.bin/ssh/ssh-agent.1||usr.bin/ssh/ssh-agent.1"
          ],
          "candidate": [
            "usr.bin/ssh/ssh-agent.1||usr.bin/ssh/ssh-agent.1"
          ]
        }
      },
      "candidate_diff": {
        "usr.bin/ssh/ssh-agent.1||usr.bin/ssh/ssh-agent.1": [
          "File: usr.bin/ssh/ssh-agent.1 -> usr.bin/ssh/ssh-agent.1",
          "--- Hunk 1 ---",
          "[Context before]",
          "2: .\\\"",
          "3: .\\\" Author: Tatu Ylonen <ylo@cs.hut.fi>",
          "4: .\\\" Copyright (c) 1995 Tatu Ylonen <ylo@cs.hut.fi>, Espoo, Finland",
          "",
          "[Removed Lines]",
          "1: .\\\" $OpenBSD: ssh-agent.1,v 1.78 2023/07/23 20:04:45 naddy Exp $",
          "",
          "[Added Lines]",
          "1: .\\\" $OpenBSD: ssh-agent.1,v 1.79 2023/08/10 14:37:32 naddy Exp $",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "34: .\\\" (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF",
          "35: .\\\" THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.",
          "36: .\\\"",
          "38: .Dt SSH-AGENT 1",
          "39: .Os",
          "40: .Sh NAME",
          "",
          "[Removed Lines]",
          "37: .Dd $Mdocdate: July 23 2023 $",
          "",
          "[Added Lines]",
          "37: .Dd $Mdocdate: August 10 2023 $",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "122: .Nm",
          "123: client is remote is performed by",
          "124: .Xr ssh 1 ,",
          "126: this restriction.",
          "127: .Pp",
          "128: The",
          "",
          "[Removed Lines]",
          "125: and use of other tools to forward access to the agent socket, may circumvent",
          "",
          "[Added Lines]",
          "125: and use of other tools to forward access to the agent socket may circumvent",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "935597dbc03fda264f26b5463bc0be6a09e5daa0",
      "candidate_info": {
        "commit_hash": "935597dbc03fda264f26b5463bc0be6a09e5daa0",
        "repo": "openbsd/src",
        "commit_url": "https://github.com/openbsd/src/commit/935597dbc03fda264f26b5463bc0be6a09e5daa0",
        "files": [
          "usr.bin/ssh/ssh-agent.1",
          "usr.bin/ssh/ssh-keygen.1",
          "usr.bin/ssh/ssh.1"
        ],
        "message": "man page typos; ok jmc@",
        "before_after_code_files": [
          "usr.bin/ssh/ssh-agent.1||usr.bin/ssh/ssh-agent.1",
          "usr.bin/ssh/ssh-keygen.1||usr.bin/ssh/ssh-keygen.1",
          "usr.bin/ssh/ssh.1||usr.bin/ssh/ssh.1"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "usr.bin/ssh/ssh-agent.1||usr.bin/ssh/ssh-agent.1"
          ],
          "candidate": [
            "usr.bin/ssh/ssh-agent.1||usr.bin/ssh/ssh-agent.1"
          ]
        }
      },
      "candidate_diff": {
        "usr.bin/ssh/ssh-agent.1||usr.bin/ssh/ssh-agent.1": [
          "File: usr.bin/ssh/ssh-agent.1 -> usr.bin/ssh/ssh-agent.1",
          "--- Hunk 1 ---",
          "[Context before]",
          "2: .\\\"",
          "3: .\\\" Author: Tatu Ylonen <ylo@cs.hut.fi>",
          "4: .\\\" Copyright (c) 1995 Tatu Ylonen <ylo@cs.hut.fi>, Espoo, Finland",
          "",
          "[Removed Lines]",
          "1: .\\\" $OpenBSD: ssh-agent.1,v 1.77 2023/07/20 05:43:39 jmc Exp $",
          "",
          "[Added Lines]",
          "1: .\\\" $OpenBSD: ssh-agent.1,v 1.78 2023/07/23 20:04:45 naddy Exp $",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "34: .\\\" (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF",
          "35: .\\\" THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.",
          "36: .\\\"",
          "38: .Dt SSH-AGENT 1",
          "39: .Os",
          "40: .Sh NAME",
          "",
          "[Removed Lines]",
          "37: .Dd $Mdocdate: July 20 2023 $",
          "",
          "[Added Lines]",
          "37: .Dd $Mdocdate: July 23 2023 $",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "118: .Nm",
          "119: to load PKCS#11 or FIDO provider libraries.",
          "120: By default only local clients may perform this operation.",
          "122: .Nm",
          "124: .Xr ssh 1 ,",
          "125: and use of other tools to forward access to the agent socket, may circumvent",
          "126: this restriction.",
          "",
          "[Removed Lines]",
          "121: Note that signalling that a",
          "123: client remote is performed by",
          "",
          "[Added Lines]",
          "121: Note that signalling that an",
          "123: client is remote is performed by",
          "",
          "---------------"
        ],
        "usr.bin/ssh/ssh-keygen.1||usr.bin/ssh/ssh-keygen.1": [
          "File: usr.bin/ssh/ssh-keygen.1 -> usr.bin/ssh/ssh-keygen.1",
          "--- Hunk 1 ---",
          "[Context before]",
          "2: .\\\"",
          "3: .\\\" Author: Tatu Ylonen <ylo@cs.hut.fi>",
          "4: .\\\" Copyright (c) 1995 Tatu Ylonen <ylo@cs.hut.fi>, Espoo, Finland",
          "",
          "[Removed Lines]",
          "1: .\\\" $OpenBSD: ssh-keygen.1,v 1.228 2023/02/10 06:40:48 jmc Exp $",
          "",
          "[Added Lines]",
          "1: .\\\" $OpenBSD: ssh-keygen.1,v 1.229 2023/07/23 20:04:45 naddy Exp $",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "35: .\\\" (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF",
          "36: .\\\" THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.",
          "37: .\\\"",
          "39: .Dt SSH-KEYGEN 1",
          "40: .Os",
          "41: .Sh NAME",
          "",
          "[Removed Lines]",
          "38: .Dd $Mdocdate: February 10 2023 $",
          "",
          "[Added Lines]",
          "38: .Dd $Mdocdate: July 23 2023 $",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "733: .Nm",
          "734: returning a zero exit status.",
          "735: .It Fl Y Cm sign",
          "737: When signing,",
          "738: .Nm",
          "739: accepts zero or more files to sign on the command-line - if no files",
          "",
          "[Removed Lines]",
          "736: Cryptographically sign a file or some data using a SSH key.",
          "",
          "[Added Lines]",
          "736: Cryptographically sign a file or some data using an SSH key.",
          "",
          "---------------"
        ],
        "usr.bin/ssh/ssh.1||usr.bin/ssh/ssh.1": [
          "File: usr.bin/ssh/ssh.1 -> usr.bin/ssh/ssh.1",
          "--- Hunk 1 ---",
          "[Context before]",
          "33: .\\\" (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF",
          "34: .\\\" THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.",
          "35: .\\\"",
          "38: .Dt SSH 1",
          "39: .Os",
          "40: .Sh NAME",
          "",
          "[Removed Lines]",
          "36: .\\\" $OpenBSD: ssh.1,v 1.436 2023/07/17 05:38:10 jmc Exp $",
          "37: .Dd $Mdocdate: July 17 2023 $",
          "",
          "[Added Lines]",
          "36: .\\\" $OpenBSD: ssh.1,v 1.437 2023/07/23 20:04:45 naddy Exp $",
          "37: .Dd $Mdocdate: July 23 2023 $",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "323: to identity filenames.",
          "324: .Pp",
          "325: .It Fl J Ar destination",
          "327: .Nm",
          "328: connection to the jump host described by",
          "329: .Ar destination",
          "",
          "[Removed Lines]",
          "326: Connect to the target host by first making a",
          "",
          "[Added Lines]",
          "326: Connect to the target host by first making an",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "646fc28444d8804fc8acf76257608fab5f43c05c",
      "candidate_info": {
        "commit_hash": "646fc28444d8804fc8acf76257608fab5f43c05c",
        "repo": "openbsd/src",
        "commit_url": "https://github.com/openbsd/src/commit/646fc28444d8804fc8acf76257608fab5f43c05c",
        "files": [
          "usr.bin/ssh/ssh-agent.1"
        ],
        "message": "tweak the allow-remote-pkcs11 text;",
        "before_after_code_files": [
          "usr.bin/ssh/ssh-agent.1||usr.bin/ssh/ssh-agent.1"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "usr.bin/ssh/ssh-agent.1||usr.bin/ssh/ssh-agent.1"
          ],
          "candidate": [
            "usr.bin/ssh/ssh-agent.1||usr.bin/ssh/ssh-agent.1"
          ]
        }
      },
      "candidate_diff": {
        "usr.bin/ssh/ssh-agent.1||usr.bin/ssh/ssh-agent.1": [
          "File: usr.bin/ssh/ssh-agent.1 -> usr.bin/ssh/ssh-agent.1",
          "--- Hunk 1 ---",
          "[Context before]",
          "2: .\\\"",
          "3: .\\\" Author: Tatu Ylonen <ylo@cs.hut.fi>",
          "4: .\\\" Copyright (c) 1995 Tatu Ylonen <ylo@cs.hut.fi>, Espoo, Finland",
          "",
          "[Removed Lines]",
          "1: .\\\" $OpenBSD: ssh-agent.1,v 1.76 2023/07/19 13:56:33 djm Exp $",
          "",
          "[Added Lines]",
          "1: .\\\" $OpenBSD: ssh-agent.1,v 1.77 2023/07/20 05:43:39 jmc Exp $",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "34: .\\\" (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF",
          "35: .\\\" THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.",
          "36: .\\\"",
          "38: .Dt SSH-AGENT 1",
          "39: .Os",
          "40: .Sh NAME",
          "",
          "[Removed Lines]",
          "37: .Dd $Mdocdate: July 19 2023 $",
          "",
          "[Added Lines]",
          "37: .Dd $Mdocdate: July 20 2023 $",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "122: .Nm",
          "123: client remote is performed by",
          "124: .Xr ssh 1 ,",
          "126: this restriction.",
          "127: .Pp",
          "128: The",
          "131: .Nm",
          "132: to permit signatures using FIDO keys that might be web authentication",
          "133: requests.",
          "",
          "[Removed Lines]",
          "125: and use of other tools to forward access to the agent socket may circumvent",
          "129: .Cm no-restrict-websafe ,",
          "130: instructs",
          "",
          "[Added Lines]",
          "125: and use of other tools to forward access to the agent socket, may circumvent",
          "129: .Cm no-restrict-websafe",
          "130: option instructs",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "ee6c82a8e7dbc872765bf4e5ff071275d35890c3",
      "candidate_info": {
        "commit_hash": "ee6c82a8e7dbc872765bf4e5ff071275d35890c3",
        "repo": "openbsd/src",
        "commit_url": "https://github.com/openbsd/src/commit/ee6c82a8e7dbc872765bf4e5ff071275d35890c3",
        "files": [
          "usr.bin/ssh/ssh-agent.c"
        ],
        "message": "ssh-agent: record failed session-bind attempts\n\nRecord failed attempts to session-bind a connection and refuse signing\noperations on that connection henceforth.\n\nPrevents a future situation where we add a new hostkey type that is not\nrecognised by an older ssh-agent, that consequently causes session-bind\nto fail (this situation is only likely to arise when people mix ssh(1)\nand ssh-agent(1) of different versions on the same host). Previously,\nafter such a failure the agent socket would be considered unbound and\nnot subject to restriction.\n\nSpotted by Jann Horn",
        "before_after_code_files": [
          "usr.bin/ssh/ssh-agent.c||usr.bin/ssh/ssh-agent.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "usr.bin/ssh/ssh-agent.c||usr.bin/ssh/ssh-agent.c"
          ],
          "candidate": [
            "usr.bin/ssh/ssh-agent.c||usr.bin/ssh/ssh-agent.c"
          ]
        }
      },
      "candidate_diff": {
        "usr.bin/ssh/ssh-agent.c||usr.bin/ssh/ssh-agent.c": [
          "File: usr.bin/ssh/ssh-agent.c -> usr.bin/ssh/ssh-agent.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "117:  struct sshbuf *request;",
          "118:  size_t nsession_ids;",
          "119:  struct hostkey_sid *session_ids;",
          "120: } SocketEntry;",
          "122: u_int sockets_alloc = 0;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "120:  int session_bind_attempted;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "464:      e->nsession_ids, id->ndest_constraints);",
          "465:  if (id->ndest_constraints == 0)",
          "467:  if (e->nsession_ids == 0)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "468:  if (e->session_bind_attempted && e->nsession_ids == 0) {",
          "469:   error_f(\"previous session bind failed on socket\");",
          "470:   return -1;",
          "471:  }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "543:  return 0;",
          "544: }",
          "547: static Identity *",
          "548: lookup_identity(struct sshkey *key)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "551: static int",
          "552: socket_is_remote(SocketEntry *e)",
          "553: {",
          "554:  return e->session_bind_attempted || (e->nsession_ids != 0);",
          "555: }",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1354:   if (strcasecmp(sk_provider, \"internal\") == 0) {",
          "1355:    debug_f(\"internal provider\");",
          "1356:   } else {",
          "1358:     verbose(\"failed add of SK provider \\\"%.100s\\\": \"",
          "1359:         \"remote addition of providers is disabled\",",
          "1360:         sk_provider);",
          "",
          "[Removed Lines]",
          "1357:    if (e->nsession_ids != 0 && !remote_add_provider) {",
          "",
          "[Added Lines]",
          "1368:    if (socket_is_remote(e) && !remote_add_provider) {",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1552:   goto send;",
          "1553:  }",
          "1554:  dump_dest_constraints(__func__, dest_constraints, ndest_constraints);",
          "1556:   verbose(\"failed PKCS#11 add of \\\"%.100s\\\": remote addition of \"",
          "1557:       \"providers is disabled\", provider);",
          "1558:   goto send;",
          "",
          "[Removed Lines]",
          "1555:  if (e->nsession_ids != 0 && !remote_add_provider) {",
          "",
          "[Added Lines]",
          "1566:  if (socket_is_remote(e) && !remote_add_provider) {",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "1667:  u_char fwd = 0;",
          "1669:  debug2_f(\"entering\");",
          "1670:  if ((r = sshkey_froms(e->request, &key)) != 0 ||",
          "1671:      (r = sshbuf_froms(e->request, &sid)) != 0 ||",
          "1672:      (r = sshbuf_froms(e->request, &sig)) != 0 ||",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1681:  e->session_bind_attempted = 1;",
          "",
          "---------------"
        ]
      }
    }
  ]
}