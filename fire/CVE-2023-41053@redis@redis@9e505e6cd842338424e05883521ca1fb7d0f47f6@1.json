{
  "cve_id": "CVE-2023-41053",
  "cve_desc": "Redis is an in-memory database that persists on disk. Redis does not correctly identify keys accessed by `SORT_RO` and as a result may grant users executing this command access to keys that are not explicitly authorized by the ACL configuration. The problem exists in Redis 7.0 or newer and has been fixed in Redis 7.0.13 and 7.2.1. Users are advised to upgrade. There are no known workarounds for this vulnerability.",
  "repo": "redis/redis",
  "patch_hash": "9e505e6cd842338424e05883521ca1fb7d0f47f6",
  "patch_info": {
    "commit_hash": "9e505e6cd842338424e05883521ca1fb7d0f47f6",
    "repo": "redis/redis",
    "commit_url": "https://github.com/redis/redis/commit/9e505e6cd842338424e05883521ca1fb7d0f47f6",
    "files": [
      "src/db.c",
      "tests/unit/sort.tcl"
    ],
    "message": "Fix sort_ro get-keys function return wrong key number (#12522)\n\nBefore\uff1a\n```\n127.0.0.1:6379> command getkeys sort_ro key\n(empty array)\n127.0.0.1:6379>\n```\nAfter:\n```\n127.0.0.1:6379> command getkeys sort_ro key\n1) \"key\"\n127.0.0.1:6379>\n```\n\n(cherry picked from commit b59f53efb31b36d0a307809f5d33bf66d66a4447)",
    "before_after_code_files": [
      "src/db.c||src/db.c",
      "tests/unit/sort.tcl||tests/unit/sort.tcl"
    ]
  },
  "patch_diff": {
    "src/db.c||src/db.c": [
      "File: src/db.c -> src/db.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "2294:     keys = getKeysPrepareResult(result, 1);",
      "2296:     keys[0].flags = CMD_KEY_RO | CMD_KEY_ACCESS;",
      "2298: }",
      "",
      "[Removed Lines]",
      "2297:     return 1;",
      "",
      "[Added Lines]",
      "2297:     result->numkeys = 1;",
      "2298:     return result->numkeys;",
      "",
      "---------------"
    ],
    "tests/unit/sort.tcl||tests/unit/sort.tcl": [
      "File: tests/unit/sort.tcl -> tests/unit/sort.tcl",
      "--- Hunk 1 ---",
      "[Context before]",
      "109:     test \"SORT extracts STORE correctly\" {",
      "110:         r command getkeys sort abc store def",
      "111:     } {abc def}",
      "113:     test \"SORT extracts multiple STORE correctly\" {",
      "114:         r command getkeys sort abc store invalid store stillbad store def",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "113:     test \"SORT_RO get keys\" {",
      "114:         r command getkeys sort_ro abc",
      "115:     } {abc}",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "68305c5b991f4b1652b003522fbd9f7e6d8e8fb1",
      "candidate_info": {
        "commit_hash": "68305c5b991f4b1652b003522fbd9f7e6d8e8fb1",
        "repo": "redis/redis",
        "commit_url": "https://github.com/redis/redis/commit/68305c5b991f4b1652b003522fbd9f7e6d8e8fb1",
        "files": [
          "src/commands.def",
          "src/commands/config-resetstat.json",
          "src/commands/config-rewrite.json"
        ],
        "message": "Align CONFIG RESETSTAT/REWRITE tips with SET. (#12530)\n\nSince the three commands have similar behavior (change config, return\nOK), the tips that govern how they should behave should be similar.\n\nCo-authored-by: Shachar Langbeheim <shachlan@amazon.com>\n(cherry picked from commit 4b281ce519974061d22eef7a9a8072d3611e64f9)",
        "before_after_code_files": [
          "src/commands.def||src/commands.def"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/redis/redis/pull/12553"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/commands.def||src/commands.def": [
          "File: src/commands.def -> src/commands.def",
          "--- Hunk 1 ---",
          "[Context before]",
          "6447: #ifndef SKIP_CMD_TIPS_TABLE",
          "6450: #endif",
          "6452: #ifndef SKIP_CMD_KEY_SPECS_TABLE",
          "",
          "[Removed Lines]",
          "6449: #define CONFIG_RESETSTAT_Tips NULL",
          "",
          "[Added Lines]",
          "6449: const char *CONFIG_RESETSTAT_Tips[] = {",
          "6450: \"request_policy:all_nodes\",",
          "6451: \"response_policy:all_succeeded\",",
          "6452: };",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "6464: #ifndef SKIP_CMD_TIPS_TABLE",
          "6467: #endif",
          "6469: #ifndef SKIP_CMD_KEY_SPECS_TABLE",
          "",
          "[Removed Lines]",
          "6466: #define CONFIG_REWRITE_Tips NULL",
          "",
          "[Added Lines]",
          "6469: const char *CONFIG_REWRITE_Tips[] = {",
          "6470: \"request_policy:all_nodes\",",
          "6471: \"response_policy:all_succeeded\",",
          "6472: };",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "6508: struct COMMAND_STRUCT CONFIG_Subcommands[] = {",
          "6509: {MAKE_CMD(\"get\",\"Returns the effective values of configuration parameters.\",\"O(N) when N is the number of configuration parameters provided\",\"2.0.0\",CMD_DOC_NONE,NULL,NULL,\"server\",COMMAND_GROUP_SERVER,CONFIG_GET_History,1,CONFIG_GET_Tips,0,configGetCommand,-3,CMD_ADMIN|CMD_NOSCRIPT|CMD_LOADING|CMD_STALE,0,CONFIG_GET_Keyspecs,0,NULL,1),.args=CONFIG_GET_Args},",
          "6510: {MAKE_CMD(\"help\",\"Returns helpful text about the different subcommands.\",\"O(1)\",\"5.0.0\",CMD_DOC_NONE,NULL,NULL,\"server\",COMMAND_GROUP_SERVER,CONFIG_HELP_History,0,CONFIG_HELP_Tips,0,configHelpCommand,2,CMD_LOADING|CMD_STALE,0,CONFIG_HELP_Keyspecs,0,NULL,0)},",
          "6513: {MAKE_CMD(\"set\",\"Sets configuration parameters in-flight.\",\"O(N) when N is the number of configuration parameters provided\",\"2.0.0\",CMD_DOC_NONE,NULL,NULL,\"server\",COMMAND_GROUP_SERVER,CONFIG_SET_History,1,CONFIG_SET_Tips,2,configSetCommand,-4,CMD_ADMIN|CMD_NOSCRIPT|CMD_LOADING|CMD_STALE,0,CONFIG_SET_Keyspecs,0,NULL,1),.args=CONFIG_SET_Args},",
          "6514: {0}",
          "6515: };",
          "",
          "[Removed Lines]",
          "6511: {MAKE_CMD(\"resetstat\",\"Resets the server's statistics.\",\"O(1)\",\"2.0.0\",CMD_DOC_NONE,NULL,NULL,\"server\",COMMAND_GROUP_SERVER,CONFIG_RESETSTAT_History,0,CONFIG_RESETSTAT_Tips,0,configResetStatCommand,2,CMD_ADMIN|CMD_NOSCRIPT|CMD_LOADING|CMD_STALE,0,CONFIG_RESETSTAT_Keyspecs,0,NULL,0)},",
          "6512: {MAKE_CMD(\"rewrite\",\"Persists the effective configuration to file.\",\"O(1)\",\"2.8.0\",CMD_DOC_NONE,NULL,NULL,\"server\",COMMAND_GROUP_SERVER,CONFIG_REWRITE_History,0,CONFIG_REWRITE_Tips,0,configRewriteCommand,2,CMD_ADMIN|CMD_NOSCRIPT|CMD_LOADING|CMD_STALE,0,CONFIG_REWRITE_Keyspecs,0,NULL,0)},",
          "",
          "[Added Lines]",
          "6517: {MAKE_CMD(\"resetstat\",\"Resets the server's statistics.\",\"O(1)\",\"2.0.0\",CMD_DOC_NONE,NULL,NULL,\"server\",COMMAND_GROUP_SERVER,CONFIG_RESETSTAT_History,0,CONFIG_RESETSTAT_Tips,2,configResetStatCommand,2,CMD_ADMIN|CMD_NOSCRIPT|CMD_LOADING|CMD_STALE,0,CONFIG_RESETSTAT_Keyspecs,0,NULL,0)},",
          "6518: {MAKE_CMD(\"rewrite\",\"Persists the effective configuration to file.\",\"O(1)\",\"2.8.0\",CMD_DOC_NONE,NULL,NULL,\"server\",COMMAND_GROUP_SERVER,CONFIG_REWRITE_History,0,CONFIG_REWRITE_Tips,2,configRewriteCommand,2,CMD_ADMIN|CMD_NOSCRIPT|CMD_LOADING|CMD_STALE,0,CONFIG_REWRITE_Keyspecs,0,NULL,0)},",
          "",
          "---------------"
        ]
      }
    }
  ]
}