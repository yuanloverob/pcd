{
  "cve_id": "CVE-2022-40138",
  "cve_desc": "An integer conversion error in Hermes bytecode generation, prior to commit 6aa825e480d48127b480b08d13adf70033237097, could have been used to perform Out-Of-Bounds operations and subsequently execute arbitrary code. Note that this is only exploitable in cases where Hermes is used to execute untrusted JavaScript. Hence, most React Native applications are not affected.",
  "repo": "facebook/hermes",
  "patch_hash": "6aa825e480d48127b480b08d13adf70033237097",
  "patch_info": {
    "commit_hash": "6aa825e480d48127b480b08d13adf70033237097",
    "repo": "facebook/hermes",
    "commit_url": "https://github.com/facebook/hermes/commit/6aa825e480d48127b480b08d13adf70033237097",
    "files": [
      "include/hermes/BCGen/HBC/BytecodeInstructionGenerator.h",
      "include/hermes/CompilerDriver/CompilerDriver.h",
      "include/hermes/VM/CodeBlock.h",
      "lib/BCGen/HBC/BytecodeGenerator.cpp",
      "lib/BCGen/HBC/BytecodeProviderFromSrc.cpp",
      "lib/BCGen/HBC/HBC.cpp",
      "lib/BCGen/HBC/ISel.cpp",
      "lib/CompilerDriver/CompilerDriver.cpp",
      "lib/VM/Callable.cpp",
      "lib/VM/CodeBlock.cpp",
      "lib/VM/Debugger/Debugger.cpp",
      "lib/VM/Interpreter.cpp",
      "lib/VM/Operations.cpp",
      "test/hermes/far-environment-access-eval.js",
      "test/hermes/far-environment-access.js"
    ],
    "message": "Re-sync with internal repository (#822)\n\nCo-authored-by: Facebook Community Bot <6422482+facebook-github-bot@users.noreply.github.com>",
    "before_after_code_files": [
      "include/hermes/BCGen/HBC/BytecodeInstructionGenerator.h||include/hermes/BCGen/HBC/BytecodeInstructionGenerator.h",
      "include/hermes/CompilerDriver/CompilerDriver.h||include/hermes/CompilerDriver/CompilerDriver.h",
      "include/hermes/VM/CodeBlock.h||include/hermes/VM/CodeBlock.h",
      "lib/BCGen/HBC/BytecodeGenerator.cpp||lib/BCGen/HBC/BytecodeGenerator.cpp",
      "lib/BCGen/HBC/BytecodeProviderFromSrc.cpp||lib/BCGen/HBC/BytecodeProviderFromSrc.cpp",
      "lib/BCGen/HBC/HBC.cpp||lib/BCGen/HBC/HBC.cpp",
      "lib/BCGen/HBC/ISel.cpp||lib/BCGen/HBC/ISel.cpp",
      "lib/CompilerDriver/CompilerDriver.cpp||lib/CompilerDriver/CompilerDriver.cpp",
      "lib/VM/Callable.cpp||lib/VM/Callable.cpp",
      "lib/VM/CodeBlock.cpp||lib/VM/CodeBlock.cpp",
      "lib/VM/Debugger/Debugger.cpp||lib/VM/Debugger/Debugger.cpp",
      "lib/VM/Interpreter.cpp||lib/VM/Interpreter.cpp",
      "lib/VM/Operations.cpp||lib/VM/Operations.cpp",
      "test/hermes/far-environment-access-eval.js||test/hermes/far-environment-access-eval.js",
      "test/hermes/far-environment-access.js||test/hermes/far-environment-access.js"
    ]
  },
  "patch_diff": {
    "include/hermes/BCGen/HBC/BytecodeInstructionGenerator.h||include/hermes/BCGen/HBC/BytecodeInstructionGenerator.h": [
      "File: include/hermes/BCGen/HBC/BytecodeInstructionGenerator.h -> include/hermes/BCGen/HBC/BytecodeInstructionGenerator.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "46:   std::vector<opcode_atom_t> opcodes_{};",
      "48:  public:",
      "50:   offset_t getCurrentLocation() {",
      "51:     return opcodes_.size();",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "50:   bool encodingError_{};",
      "54:   bool hasEncodingError() const {",
      "55:     return encodingError_;",
      "56:   }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "86:   }",
      "87: #include \"hermes/BCGen/HBC/BytecodeList.def\"",
      "",
      "[Removed Lines]",
      "79: #define DEFINE_OPERAND_TYPE(name, ctype)          \\",
      "80:   void emit##name(param_t value) {                \\",
      "81:     assert(                                       \\",
      "82:         (((param_t)(ctype)value) == value ||      \\",
      "83:          std::is_floating_point<ctype>::value) && \\",
      "84:         \"Value does not fit in \" #ctype);         \\",
      "85:     emitOperand(value, sizeof(ctype));            \\",
      "",
      "[Added Lines]",
      "88: #define DEFINE_OPERAND_TYPE(name, ctype)                  \\",
      "89:   void emit##name(param_t value) {                        \\",
      "90:     encodingError_ |= ((param_t)(ctype)value) != value && \\",
      "91:         !std::is_floating_point<ctype>::value;            \\",
      "92:     emitOperand(value, sizeof(ctype));                    \\",
      "",
      "---------------"
    ],
    "include/hermes/CompilerDriver/CompilerDriver.h||include/hermes/CompilerDriver/CompilerDriver.h": [
      "File: include/hermes/CompilerDriver/CompilerDriver.h -> include/hermes/CompilerDriver/CompilerDriver.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "32:   OutputFileError,",
      "34:   OptimizationFailed,",
      "35: };",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "36:   BackendError,",
      "",
      "---------------"
    ],
    "include/hermes/VM/CodeBlock.h||include/hermes/VM/CodeBlock.h": [
      "File: include/hermes/VM/CodeBlock.h -> include/hermes/VM/CodeBlock.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "64: #ifndef HERMESVM_LEAN",
      "67: #endif",
      "",
      "[Removed Lines]",
      "66:   void lazyCompileImpl(Runtime &runtime);",
      "",
      "[Added Lines]",
      "66:   ExecutionStatus lazyCompileImpl(Runtime &runtime);",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "237:   }",
      "241:     if (LLVM_UNLIKELY(isLazy())) {",
      "243:     }",
      "244:   }",
      "245: #else",
      "247:   bool isLazy() const {",
      "248:     return false;",
      "249:   }",
      "251: #endif",
      "",
      "[Removed Lines]",
      "240:   void lazyCompile(Runtime &runtime) {",
      "242:       lazyCompileImpl(runtime);",
      "250:   void lazyCompile(Runtime &) {}",
      "",
      "[Added Lines]",
      "240:   ExecutionStatus lazyCompile(Runtime &runtime) {",
      "242:       return lazyCompileImpl(runtime);",
      "244:     return ExecutionStatus::RETURNED;",
      "251:   ExecutionStatus lazyCompile(Runtime &) {",
      "252:     return ExecutionStatus::RETURNED;",
      "253:   }",
      "",
      "---------------"
    ],
    "lib/BCGen/HBC/BytecodeGenerator.cpp||lib/BCGen/HBC/BytecodeGenerator.cpp": [
      "File: lib/BCGen/HBC/BytecodeGenerator.cpp -> lib/BCGen/HBC/BytecodeGenerator.cpp",
      "--- Hunk 1 ---",
      "[Context before]",
      "217:   assert(",
      "218:       functionGenerators_.find(F) == functionGenerators_.end() &&",
      "219:       \"Adding same function twice.\");",
      "220:   functionGenerators_[F] = std::move(BFG);",
      "221: }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "220:   assert(",
      "221:       !BFG->hasEncodingError() && \"Error should have been reported already.\");",
      "",
      "---------------"
    ],
    "lib/BCGen/HBC/BytecodeProviderFromSrc.cpp||lib/BCGen/HBC/BytecodeProviderFromSrc.cpp": [
      "File: lib/BCGen/HBC/BytecodeProviderFromSrc.cpp -> lib/BCGen/HBC/BytecodeProviderFromSrc.cpp",
      "--- Hunk 1 ---",
      "[Context before]",
      "236:   opts.staticBuiltinsEnabled =",
      "237:       context->getOptimizationSettings().staticBuiltins;",
      "238:   opts.verifyIR = compileFlags.verifyIR;",
      "241:   bytecode->singleFunction_ = isSingleFunctionExpression(parsed.getValue());",
      "242:   return {std::move(bytecode), std::string{}};",
      "243: }",
      "",
      "[Removed Lines]",
      "239:   auto bytecode = createBCProviderFromSrc(",
      "240:       hbc::generateBytecodeModule(&M, M.getTopLevelFunction(), opts));",
      "",
      "[Added Lines]",
      "239:   auto BM = hbc::generateBytecodeModule(&M, M.getTopLevelFunction(), opts);",
      "240:   if (context->getSourceErrorManager().getErrorCount() > 0) {",
      "241:     return {nullptr, getErrorString()};",
      "242:   }",
      "243:   auto bytecode = createBCProviderFromSrc(std::move(BM));",
      "",
      "---------------"
    ],
    "lib/BCGen/HBC/HBC.cpp||lib/BCGen/HBC/HBC.cpp": [
      "File: lib/BCGen/HBC/HBC.cpp -> lib/BCGen/HBC/HBC.cpp",
      "--- Hunk 1 ---",
      "[Context before]",
      "313:       debugCache = hbciSel.getDebugCache();",
      "314:     }",
      "316:     BMGen.setFunctionGenerator(&F, std::move(funcGen));",
      "317:   }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "316:     if (funcGen->hasEncodingError()) {",
      "317:       M->getContext().getSourceErrorManager().error(",
      "318:           F.getSourceRange().Start, \"Error encoding bytecode\");",
      "319:       return nullptr;",
      "320:     }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "335:       sourceMapGen,",
      "336:       std::move(baseBCProvider));",
      "338:   if (options.format == OutputFormatKind::EmitBundle) {",
      "339:     assert(BM != nullptr);",
      "340:     BytecodeSerializer BS{OS, options};",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "343:   if (!BM) {",
      "344:     return {};",
      "345:   }",
      "",
      "---------------"
    ],
    "lib/BCGen/HBC/ISel.cpp||lib/BCGen/HBC/ISel.cpp": [
      "File: lib/BCGen/HBC/ISel.cpp -> lib/BCGen/HBC/ISel.cpp",
      "--- Hunk 1 ---",
      "[Context before]",
      "1337:       \"Cannot access variables in inner scopes\");",
      "1338:   int32_t delta = curScopeDepth.getValue() - instScopeDepth.getValue();",
      "1339:   assert(delta > 0 && \"HBCResolveEnvironment for current scope\");",
      "1340:   BCFGen_->emitGetEnvironment(encodeValue(Inst), delta - 1);",
      "1341: }",
      "1342: void HBCISel::generateHBCStoreToEnvironmentInst(",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1340:   if (std::numeric_limits<uint8_t>::max() < delta) {",
      "1341:     F_->getContext().getSourceErrorManager().error(",
      "1342:         Inst->getLocation(), \"Variable environment is out-of-reach\");",
      "1343:   }",
      "",
      "---------------"
    ],
    "lib/CompilerDriver/CompilerDriver.cpp||lib/CompilerDriver/CompilerDriver.cpp": [
      "File: lib/CompilerDriver/CompilerDriver.cpp -> lib/CompilerDriver/CompilerDriver.cpp",
      "--- Hunk 1 ---",
      "[Context before]",
      "1694:   std::shared_ptr<Context> context = M.shareContext();",
      "1695:   CompileResult result{Success};",
      "1696:   if (cl::BytecodeFormat == cl::BytecodeFormatKind::HBC) {",
      "1700:   } else {",
      "1701:     llvm_unreachable(\"Invalid bytecode kind for execution\");",
      "1702:     result = InvalidFlags;",
      "",
      "[Removed Lines]",
      "1697:     result.bytecodeProvider = hbc::BCProviderFromSrc::createBCProviderFromSrc(",
      "1698:         hbc::generateBytecodeModule(&M, M.getTopLevelFunction(), genOptions));",
      "",
      "[Added Lines]",
      "1697:     auto BM =",
      "1698:         hbc::generateBytecodeModule(&M, M.getTopLevelFunction(), genOptions);",
      "1699:     if (auto N = context->getSourceErrorManager().getErrorCount()) {",
      "1700:       llvh::errs() << \"Emitted \" << N << \" errors in the backend. exiting.\\n\";",
      "1701:       return BackendError;",
      "1702:     }",
      "1704:     result.bytecodeProvider =",
      "1705:         hbc::BCProviderFromSrc::createBCProviderFromSrc(std::move(BM));",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "1735:         sourceMapGenOrNull,",
      "1736:         std::move(baseBCProvider));",
      "1738:     if (cl::DumpTarget == DumpBytecode) {",
      "1739:       disassembleBytecode(hbc::BCProviderFromSrc::createBCProviderFromSrc(",
      "1740:           std::move(bytecodeModule)));",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1744:     if (auto N = M.getContext().getSourceErrorManager().getErrorCount()) {",
      "1745:       llvh::errs() << \"Emitted \" << N << \" errors in the backend. exiting.\\n\";",
      "1746:       return BackendError;",
      "1747:     }",
      "",
      "---------------"
    ],
    "lib/VM/Callable.cpp||lib/VM/Callable.cpp": [
      "File: lib/VM/Callable.cpp -> lib/VM/Callable.cpp",
      "--- Hunk 1 ---",
      "[Context before]",
      "1397:   if (LLVM_UNLIKELY(selfHandle->getCodeBlock(runtime)->isLazy())) {",
      "1399:     if (LLVM_UNLIKELY(",
      "1400:             ArrayStorage::resize(",
      "1401:                 ctx,",
      "",
      "[Removed Lines]",
      "1398:     selfHandle->getCodeBlock(runtime)->lazyCompile(runtime);",
      "",
      "[Added Lines]",
      "1398:     if (LLVM_UNLIKELY(",
      "1399:             selfHandle->getCodeBlock(runtime)->lazyCompile(runtime) ==",
      "1400:             ExecutionStatus::EXCEPTION)) {",
      "1401:       return ExecutionStatus::EXCEPTION;",
      "1402:     }",
      "",
      "---------------"
    ],
    "lib/VM/CodeBlock.cpp||lib/VM/CodeBlock.cpp": [
      "File: lib/VM/CodeBlock.cpp -> lib/VM/CodeBlock.cpp",
      "--- Hunk 1 ---",
      "[Context before]",
      "14: #include \"hermes/IRGen/IRGen.h\"",
      "15: #include \"hermes/Support/Conversions.h\"",
      "16: #include \"hermes/Support/PerfSection.h\"",
      "17: #include \"hermes/VM/GCPointer-inline.h\"",
      "18: #include \"hermes/VM/Runtime.h\"",
      "19: #include \"hermes/VM/RuntimeModule.h\"",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "17: #include \"hermes/Support/SimpleDiagHandler.h\"",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "330: }",
      "331: } // namespace",
      "334:   assert(isLazy() && \"Laziness has not been checked\");",
      "335:   PerfSection perf(\"Lazy function compilation\");",
      "336:   auto *provider = (hbc::BCProviderLazy *)runtimeModule_->getBytecode();",
      "337:   auto *func = provider->getBytecodeFunction();",
      "338:   auto *lazyData = func->getLazyCompilationData();",
      "339:   auto bcModule = compileLazyFunction(lazyData);",
      "341:   runtimeModule_->initializeLazyMayAllocate(",
      "342:       hbc::BCProviderFromSrc::createBCProviderFromSrc(std::move(bcModule)));",
      "",
      "[Removed Lines]",
      "333: void CodeBlock::lazyCompileImpl(Runtime &runtime) {",
      "",
      "[Added Lines]",
      "334: ExecutionStatus CodeBlock::lazyCompileImpl(Runtime &runtime) {",
      "340:   SourceErrorManager &manager = lazyData->context->getSourceErrorManager();",
      "341:   SimpleDiagHandlerRAII outputManager{manager};",
      "344:   if (manager.getErrorCount()) {",
      "346:     return runtime.raiseSyntaxError(",
      "347:         llvh::StringRef{outputManager.getErrorString()});",
      "348:   }",
      "350:   assert(bcModule && \"No errors, yet no bcModule\");",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "346:   functionHeader_ =",
      "347:       runtimeModule_->getBytecode()->getFunctionHeader(functionID_);",
      "348:   bytecode_ = runtimeModule_->getBytecode()->getBytecode(functionID_);",
      "349: }",
      "350: #endif // HERMESVM_LEAN",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "361:   return ExecutionStatus::RETURNED;",
      "",
      "---------------"
    ],
    "lib/VM/Debugger/Debugger.cpp||lib/VM/Debugger/Debugger.cpp": [
      "File: lib/VM/Debugger/Debugger.cpp -> lib/VM/Debugger/Debugger.cpp",
      "--- Hunk 1 ---",
      "[Context before]",
      "1147:            (start.col <= request.column && request.column <= end.col))) {",
      "",
      "[Removed Lines]",
      "1150:         codeBlock->lazyCompile(runtime_);",
      "",
      "[Added Lines]",
      "1150:         if (LLVM_UNLIKELY(",
      "1151:                 codeBlock->lazyCompile(runtime_) ==",
      "1152:                 ExecutionStatus::EXCEPTION)) {",
      "1154:           runtime_.clearThrownValue();",
      "1155:         }",
      "",
      "---------------"
    ],
    "lib/VM/Interpreter.cpp||lib/VM/Interpreter.cpp": [
      "File: lib/VM/Interpreter.cpp -> lib/VM/Interpreter.cpp",
      "--- Hunk 1 ---",
      "[Context before]",
      "786: CallResult<HermesValue> Runtime::interpretFunctionImpl(",
      "787:     CodeBlock *newCodeBlock) {",
      "790: #if defined(HERMES_MEMORY_INSTRUMENTATION) || !defined(NDEBUG)",
      "",
      "[Removed Lines]",
      "788:   newCodeBlock->lazyCompile(*this);",
      "",
      "[Added Lines]",
      "788:   if (LLVM_UNLIKELY(",
      "789:           newCodeBlock->lazyCompile(*this) == ExecutionStatus::EXCEPTION)) {",
      "790:     return ExecutionStatus::EXCEPTION;",
      "791:   }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "1584: #endif",
      "1586:         CodeBlock *calleeBlock = func->getCodeBlock(runtime);",
      "1588:         curCodeBlock = calleeBlock;",
      "1589:         CAPTURE_IP_SET();",
      "1590:         goto tailCall;",
      "",
      "[Removed Lines]",
      "1587:         CAPTURE_IP(calleeBlock->lazyCompile(runtime));",
      "",
      "[Added Lines]",
      "1590:         CAPTURE_IP_ASSIGN(auto res, calleeBlock->lazyCompile(runtime));",
      "1591:         if (LLVM_UNLIKELY(res == ExecutionStatus::EXCEPTION)) {",
      "1592:           goto exception;",
      "1593:         }",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "1638:         assert(!SingleStep && \"can't single-step a call\");",
      "1641:         curCodeBlock = calleeBlock;",
      "1642:         CAPTURE_IP_SET();",
      "1643:         goto tailCall;",
      "",
      "[Removed Lines]",
      "1640:         CAPTURE_IP(calleeBlock->lazyCompile(runtime));",
      "",
      "[Added Lines]",
      "1646:         CAPTURE_IP_ASSIGN(auto res, calleeBlock->lazyCompile(runtime));",
      "1647:         if (LLVM_UNLIKELY(res == ExecutionStatus::EXCEPTION)) {",
      "1648:           goto exception;",
      "1649:         }",
      "",
      "---------------"
    ],
    "lib/VM/Operations.cpp||lib/VM/Operations.cpp": [
      "File: lib/VM/Operations.cpp -> lib/VM/Operations.cpp",
      "--- Hunk 1 ---",
      "[Context before]",
      "1679:     auto *cb = func->getCodeBlock(runtime);",
      "1683:     return !func->getCodeBlock(runtime)->getHeaderFlags().isCallProhibited(",
      "1684:         true);",
      "1685:   }",
      "",
      "[Removed Lines]",
      "1682:     cb->lazyCompile(runtime);",
      "",
      "[Added Lines]",
      "1682:     if (LLVM_UNLIKELY(cb->lazyCompile(runtime) == ExecutionStatus::EXCEPTION)) {",
      "1683:       return ExecutionStatus::EXCEPTION;",
      "1684:     }",
      "",
      "---------------"
    ],
    "test/hermes/far-environment-access-eval.js||test/hermes/far-environment-access-eval.js": [
      "File: test/hermes/far-environment-access-eval.js -> test/hermes/far-environment-access-eval.js",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "17: try {",
      "18:     eval('\"use strict\";\\n' +",
      "19:          '\\n' +",
      "20:          'function sink(x) { return x; }\\n' +",
      "21:          'function foo(){\\n' +",
      "22:          '  var var0 = sink(\"1\");\\n' +",
      "23:          '  var var1 = sink(\"2\");\\n' +",
      "24:          '  var var2 = sink(\"3\");\\n' +",
      "25:          '  return ()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=> [var0, var1, var2];\\n' +",
      "26:          '}\\n' +",
      "27:          '\\n' +",
      "28:          'print(foo()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()());\\n')",
      "29: } catch (e) {",
      "30:   print(e);",
      "31: }",
      "",
      "---------------"
    ],
    "test/hermes/far-environment-access.js||test/hermes/far-environment-access.js": [
      "File: test/hermes/far-environment-access.js -> test/hermes/far-environment-access.js",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "18: \"use strict\";",
      "20: function sink(x) { return x; }",
      "21: function foo(){",
      "22:   var var0 = sink(\"1\");",
      "23:   var var1 = sink(\"2\");",
      "24:   var var2 = sink(\"3\");",
      "25:   return ()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=> [var0, var1, var2];",
      "26: }",
      "28: try {",
      "29:   print(foo()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()());",
      "30: } catch (e) {",
      "31:   print(e);",
      "32: }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "ab06fe474ff27967e5185ce98d8cd181c35b43e3",
      "candidate_info": {
        "commit_hash": "ab06fe474ff27967e5185ce98d8cd181c35b43e3",
        "repo": "facebook/hermes",
        "commit_url": "https://github.com/facebook/hermes/commit/ab06fe474ff27967e5185ce98d8cd181c35b43e3",
        "files": [
          "include/hermes/BCGen/HBC/BytecodeInstructionGenerator.h",
          "include/hermes/CompilerDriver/CompilerDriver.h",
          "include/hermes/VM/CodeBlock.h",
          "lib/BCGen/HBC/BytecodeGenerator.cpp",
          "lib/BCGen/HBC/BytecodeProviderFromSrc.cpp",
          "lib/BCGen/HBC/HBC.cpp",
          "lib/BCGen/HBC/ISel.cpp",
          "lib/CompilerDriver/CompilerDriver.cpp",
          "lib/VM/Callable.cpp",
          "lib/VM/CodeBlock.cpp",
          "lib/VM/Debugger/Debugger.cpp",
          "lib/VM/Interpreter.cpp",
          "lib/VM/Operations.cpp",
          "test/hermes/far-environment-access-eval.js",
          "test/hermes/far-environment-access.js"
        ],
        "message": "Re-sync with internal repository (#822)\n\nSummary:\nOriginal Author: Facebook Community Bot <6422482+facebook-github-bot@users.noreply.github.com>\nOriginal Git: 6aa825e480d48127b480b08d13adf70033237097\n\nCo-authored-by: Facebook Community Bot <6422482+facebook-github-bot@users.noreply.github.com>\n\nReviewed By: tmikov\n\nDifferential Revision: D41240791\n\nfbshipit-source-id: acaafb9c9fd27d9cc61f451cdbd88326599b3f7d",
        "before_after_code_files": [
          "include/hermes/BCGen/HBC/BytecodeInstructionGenerator.h||include/hermes/BCGen/HBC/BytecodeInstructionGenerator.h",
          "include/hermes/CompilerDriver/CompilerDriver.h||include/hermes/CompilerDriver/CompilerDriver.h",
          "include/hermes/VM/CodeBlock.h||include/hermes/VM/CodeBlock.h",
          "lib/BCGen/HBC/BytecodeGenerator.cpp||lib/BCGen/HBC/BytecodeGenerator.cpp",
          "lib/BCGen/HBC/BytecodeProviderFromSrc.cpp||lib/BCGen/HBC/BytecodeProviderFromSrc.cpp",
          "lib/BCGen/HBC/HBC.cpp||lib/BCGen/HBC/HBC.cpp",
          "lib/BCGen/HBC/ISel.cpp||lib/BCGen/HBC/ISel.cpp",
          "lib/CompilerDriver/CompilerDriver.cpp||lib/CompilerDriver/CompilerDriver.cpp",
          "lib/VM/Callable.cpp||lib/VM/Callable.cpp",
          "lib/VM/CodeBlock.cpp||lib/VM/CodeBlock.cpp",
          "lib/VM/Debugger/Debugger.cpp||lib/VM/Debugger/Debugger.cpp",
          "lib/VM/Interpreter.cpp||lib/VM/Interpreter.cpp",
          "lib/VM/Operations.cpp||lib/VM/Operations.cpp",
          "test/hermes/far-environment-access-eval.js||test/hermes/far-environment-access-eval.js",
          "test/hermes/far-environment-access.js||test/hermes/far-environment-access.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_olp_changes": 1,
        "olp_code_files": {
          "patch": [
            "include/hermes/BCGen/HBC/BytecodeInstructionGenerator.h||include/hermes/BCGen/HBC/BytecodeInstructionGenerator.h",
            "include/hermes/CompilerDriver/CompilerDriver.h||include/hermes/CompilerDriver/CompilerDriver.h",
            "include/hermes/VM/CodeBlock.h||include/hermes/VM/CodeBlock.h",
            "lib/BCGen/HBC/BytecodeGenerator.cpp||lib/BCGen/HBC/BytecodeGenerator.cpp",
            "lib/BCGen/HBC/BytecodeProviderFromSrc.cpp||lib/BCGen/HBC/BytecodeProviderFromSrc.cpp",
            "lib/BCGen/HBC/HBC.cpp||lib/BCGen/HBC/HBC.cpp",
            "lib/BCGen/HBC/ISel.cpp||lib/BCGen/HBC/ISel.cpp",
            "lib/CompilerDriver/CompilerDriver.cpp||lib/CompilerDriver/CompilerDriver.cpp",
            "lib/VM/Callable.cpp||lib/VM/Callable.cpp",
            "lib/VM/CodeBlock.cpp||lib/VM/CodeBlock.cpp",
            "lib/VM/Debugger/Debugger.cpp||lib/VM/Debugger/Debugger.cpp",
            "lib/VM/Interpreter.cpp||lib/VM/Interpreter.cpp",
            "lib/VM/Operations.cpp||lib/VM/Operations.cpp",
            "test/hermes/far-environment-access-eval.js||test/hermes/far-environment-access-eval.js",
            "test/hermes/far-environment-access.js||test/hermes/far-environment-access.js"
          ],
          "candidate": [
            "include/hermes/BCGen/HBC/BytecodeInstructionGenerator.h||include/hermes/BCGen/HBC/BytecodeInstructionGenerator.h",
            "include/hermes/CompilerDriver/CompilerDriver.h||include/hermes/CompilerDriver/CompilerDriver.h",
            "include/hermes/VM/CodeBlock.h||include/hermes/VM/CodeBlock.h",
            "lib/BCGen/HBC/BytecodeGenerator.cpp||lib/BCGen/HBC/BytecodeGenerator.cpp",
            "lib/BCGen/HBC/BytecodeProviderFromSrc.cpp||lib/BCGen/HBC/BytecodeProviderFromSrc.cpp",
            "lib/BCGen/HBC/HBC.cpp||lib/BCGen/HBC/HBC.cpp",
            "lib/BCGen/HBC/ISel.cpp||lib/BCGen/HBC/ISel.cpp",
            "lib/CompilerDriver/CompilerDriver.cpp||lib/CompilerDriver/CompilerDriver.cpp",
            "lib/VM/Callable.cpp||lib/VM/Callable.cpp",
            "lib/VM/CodeBlock.cpp||lib/VM/CodeBlock.cpp",
            "lib/VM/Debugger/Debugger.cpp||lib/VM/Debugger/Debugger.cpp",
            "lib/VM/Interpreter.cpp||lib/VM/Interpreter.cpp",
            "lib/VM/Operations.cpp||lib/VM/Operations.cpp",
            "test/hermes/far-environment-access-eval.js||test/hermes/far-environment-access-eval.js",
            "test/hermes/far-environment-access.js||test/hermes/far-environment-access.js"
          ]
        }
      },
      "candidate_diff": {
        "include/hermes/BCGen/HBC/BytecodeInstructionGenerator.h||include/hermes/BCGen/HBC/BytecodeInstructionGenerator.h": [
          "File: include/hermes/BCGen/HBC/BytecodeInstructionGenerator.h -> include/hermes/BCGen/HBC/BytecodeInstructionGenerator.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "42:   std::vector<opcode_atom_t> opcodes_{};",
          "44:  public:",
          "46:   offset_t getCurrentLocation() {",
          "47:     return opcodes_.size();",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "46:   bool encodingError_{};",
          "50:   bool hasEncodingError() const {",
          "51:     return encodingError_;",
          "52:   }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "82:   }",
          "83: #include \"hermes/BCGen/HBC/BytecodeList.def\"",
          "",
          "[Removed Lines]",
          "75: #define DEFINE_OPERAND_TYPE(name, ctype)          \\",
          "76:   void emit##name(param_t value) {                \\",
          "77:     assert(                                       \\",
          "78:         (((param_t)(ctype)value) == value ||      \\",
          "79:          std::is_floating_point<ctype>::value) && \\",
          "80:         \"Value does not fit in \" #ctype);         \\",
          "81:     emitOperand(value, sizeof(ctype));            \\",
          "",
          "[Added Lines]",
          "84: #define DEFINE_OPERAND_TYPE(name, ctype)                  \\",
          "85:   void emit##name(param_t value) {                        \\",
          "86:     encodingError_ |= ((param_t)(ctype)value) != value && \\",
          "87:         !std::is_floating_point<ctype>::value;            \\",
          "88:     emitOperand(value, sizeof(ctype));                    \\",
          "",
          "---------------"
        ],
        "include/hermes/CompilerDriver/CompilerDriver.h||include/hermes/CompilerDriver/CompilerDriver.h": [
          "File: include/hermes/CompilerDriver/CompilerDriver.h -> include/hermes/CompilerDriver/CompilerDriver.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "32:   OutputFileError,",
          "34:   OptimizationFailed,",
          "35: };",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "36:   BackendError,",
          "",
          "---------------"
        ],
        "include/hermes/VM/CodeBlock.h||include/hermes/VM/CodeBlock.h": [
          "File: include/hermes/VM/CodeBlock.h -> include/hermes/VM/CodeBlock.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "60: #ifndef HERMESVM_LEAN",
          "63: #endif",
          "",
          "[Removed Lines]",
          "62:   void lazyCompileImpl(Runtime &runtime);",
          "",
          "[Added Lines]",
          "62:   ExecutionStatus lazyCompileImpl(Runtime &runtime);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "233:   }",
          "237:     if (LLVM_UNLIKELY(isLazy())) {",
          "239:     }",
          "240:   }",
          "241: #else",
          "243:   bool isLazy() const {",
          "244:     return false;",
          "245:   }",
          "247: #endif",
          "",
          "[Removed Lines]",
          "236:   void lazyCompile(Runtime &runtime) {",
          "238:       lazyCompileImpl(runtime);",
          "246:   void lazyCompile(Runtime &) {}",
          "",
          "[Added Lines]",
          "236:   ExecutionStatus lazyCompile(Runtime &runtime) {",
          "238:       return lazyCompileImpl(runtime);",
          "240:     return ExecutionStatus::RETURNED;",
          "247:   ExecutionStatus lazyCompile(Runtime &) {",
          "248:     return ExecutionStatus::RETURNED;",
          "249:   }",
          "",
          "---------------"
        ],
        "lib/BCGen/HBC/BytecodeGenerator.cpp||lib/BCGen/HBC/BytecodeGenerator.cpp": [
          "File: lib/BCGen/HBC/BytecodeGenerator.cpp -> lib/BCGen/HBC/BytecodeGenerator.cpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "217:   assert(",
          "218:       functionGenerators_.find(F) == functionGenerators_.end() &&",
          "219:       \"Adding same function twice.\");",
          "220:   functionGenerators_[F] = std::move(BFG);",
          "221: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "220:   assert(",
          "221:       !BFG->hasEncodingError() && \"Error should have been reported already.\");",
          "",
          "---------------"
        ],
        "lib/BCGen/HBC/BytecodeProviderFromSrc.cpp||lib/BCGen/HBC/BytecodeProviderFromSrc.cpp": [
          "File: lib/BCGen/HBC/BytecodeProviderFromSrc.cpp -> lib/BCGen/HBC/BytecodeProviderFromSrc.cpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "235:   opts.staticBuiltinsEnabled =",
          "236:       context->getOptimizationSettings().staticBuiltins;",
          "237:   opts.verifyIR = compileFlags.verifyIR;",
          "240:   bytecode->singleFunction_ = isSingleFunctionExpression(parsed.getValue());",
          "241:   return {std::move(bytecode), std::string{}};",
          "242: }",
          "",
          "[Removed Lines]",
          "238:   auto bytecode = createBCProviderFromSrc(",
          "239:       hbc::generateBytecodeModule(&M, M.getTopLevelFunction(), opts));",
          "",
          "[Added Lines]",
          "238:   auto BM = hbc::generateBytecodeModule(&M, M.getTopLevelFunction(), opts);",
          "239:   if (context->getSourceErrorManager().getErrorCount() > 0) {",
          "240:     return {nullptr, getErrorString()};",
          "241:   }",
          "242:   auto bytecode = createBCProviderFromSrc(std::move(BM));",
          "",
          "---------------"
        ],
        "lib/BCGen/HBC/HBC.cpp||lib/BCGen/HBC/HBC.cpp": [
          "File: lib/BCGen/HBC/HBC.cpp -> lib/BCGen/HBC/HBC.cpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "313:       debugCache = hbciSel.getDebugCache();",
          "314:     }",
          "316:     BMGen.setFunctionGenerator(&F, std::move(funcGen));",
          "317:   }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "316:     if (funcGen->hasEncodingError()) {",
          "317:       M->getContext().getSourceErrorManager().error(",
          "318:           F.getSourceRange().Start, \"Error encoding bytecode\");",
          "319:       return nullptr;",
          "320:     }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "335:       sourceMapGen,",
          "336:       std::move(baseBCProvider));",
          "338:   if (options.format == OutputFormatKind::EmitBundle) {",
          "339:     assert(BM != nullptr);",
          "340:     BytecodeSerializer BS{OS, options};",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "343:   if (!BM) {",
          "344:     return {};",
          "345:   }",
          "",
          "---------------"
        ],
        "lib/BCGen/HBC/ISel.cpp||lib/BCGen/HBC/ISel.cpp": [
          "File: lib/BCGen/HBC/ISel.cpp -> lib/BCGen/HBC/ISel.cpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "1323:       \"Cannot access variables in inner scopes\");",
          "1324:   int32_t delta = curScopeDepth.getValue() - instScopeDepth.getValue();",
          "1325:   assert(delta > 0 && \"HBCResolveEnvironment for current scope\");",
          "1326:   BCFGen_->emitGetEnvironment(encodeValue(Inst), delta - 1);",
          "1327: }",
          "1328: void HBCISel::generateHBCStoreToEnvironmentInst(",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1326:   if (std::numeric_limits<uint8_t>::max() < delta) {",
          "1327:     F_->getContext().getSourceErrorManager().error(",
          "1328:         Inst->getLocation(), \"Variable environment is out-of-reach\");",
          "1329:   }",
          "",
          "---------------"
        ],
        "lib/CompilerDriver/CompilerDriver.cpp||lib/CompilerDriver/CompilerDriver.cpp": [
          "File: lib/CompilerDriver/CompilerDriver.cpp -> lib/CompilerDriver/CompilerDriver.cpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "1692:   std::shared_ptr<Context> context = M.shareContext();",
          "1693:   CompileResult result{Success};",
          "1694:   if (cl::BytecodeFormat == cl::BytecodeFormatKind::HBC) {",
          "1698:   } else {",
          "1699:     llvm_unreachable(\"Invalid bytecode kind for execution\");",
          "1700:     result = InvalidFlags;",
          "",
          "[Removed Lines]",
          "1695:     result.bytecodeProvider = hbc::BCProviderFromSrc::createBCProviderFromSrc(",
          "1696:         hbc::generateBytecodeModule(&M, M.getTopLevelFunction(), genOptions));",
          "",
          "[Added Lines]",
          "1695:     auto BM =",
          "1696:         hbc::generateBytecodeModule(&M, M.getTopLevelFunction(), genOptions);",
          "1697:     if (auto N = context->getSourceErrorManager().getErrorCount()) {",
          "1698:       llvh::errs() << \"Emitted \" << N << \" errors in the backend. exiting.\\n\";",
          "1699:       return BackendError;",
          "1700:     }",
          "1702:     result.bytecodeProvider =",
          "1703:         hbc::BCProviderFromSrc::createBCProviderFromSrc(std::move(BM));",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1733:         sourceMapGenOrNull,",
          "1734:         std::move(baseBCProvider));",
          "1736:     if (cl::DumpTarget == DumpBytecode) {",
          "1737:       disassembleBytecode(hbc::BCProviderFromSrc::createBCProviderFromSrc(",
          "1738:           std::move(bytecodeModule)));",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1742:     if (auto N = M.getContext().getSourceErrorManager().getErrorCount()) {",
          "1743:       llvh::errs() << \"Emitted \" << N << \" errors in the backend. exiting.\\n\";",
          "1744:       return BackendError;",
          "1745:     }",
          "",
          "---------------"
        ],
        "lib/VM/Callable.cpp||lib/VM/Callable.cpp": [
          "File: lib/VM/Callable.cpp -> lib/VM/Callable.cpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "1565:   if (LLVM_UNLIKELY(selfHandle->getCodeBlock(runtime)->isLazy())) {",
          "1567:     if (LLVM_UNLIKELY(",
          "1568:             ArrayStorage::resize(",
          "1569:                 ctx,",
          "",
          "[Removed Lines]",
          "1566:     selfHandle->getCodeBlock(runtime)->lazyCompile(runtime);",
          "",
          "[Added Lines]",
          "1566:     if (LLVM_UNLIKELY(",
          "1567:             selfHandle->getCodeBlock(runtime)->lazyCompile(runtime) ==",
          "1568:             ExecutionStatus::EXCEPTION)) {",
          "1569:       return ExecutionStatus::EXCEPTION;",
          "1570:     }",
          "",
          "---------------"
        ],
        "lib/VM/CodeBlock.cpp||lib/VM/CodeBlock.cpp": [
          "File: lib/VM/CodeBlock.cpp -> lib/VM/CodeBlock.cpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "14: #include \"hermes/IRGen/IRGen.h\"",
          "15: #include \"hermes/Support/Conversions.h\"",
          "16: #include \"hermes/Support/PerfSection.h\"",
          "17: #include \"hermes/VM/GCPointer-inline.h\"",
          "18: #include \"hermes/VM/Runtime.h\"",
          "19: #include \"hermes/VM/RuntimeModule.h\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "17: #include \"hermes/Support/SimpleDiagHandler.h\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "330: }",
          "331: } // namespace",
          "334:   assert(isLazy() && \"Laziness has not been checked\");",
          "335:   PerfSection perf(\"Lazy function compilation\");",
          "336:   auto *provider = (hbc::BCProviderLazy *)runtimeModule_->getBytecode();",
          "337:   auto *func = provider->getBytecodeFunction();",
          "338:   auto *lazyData = func->getLazyCompilationData();",
          "339:   auto bcModule = compileLazyFunction(lazyData);",
          "341:   runtimeModule_->initializeLazyMayAllocate(",
          "342:       hbc::BCProviderFromSrc::createBCProviderFromSrc(std::move(bcModule)));",
          "",
          "[Removed Lines]",
          "333: void CodeBlock::lazyCompileImpl(Runtime &runtime) {",
          "",
          "[Added Lines]",
          "334: ExecutionStatus CodeBlock::lazyCompileImpl(Runtime &runtime) {",
          "340:   SourceErrorManager &manager = lazyData->context->getSourceErrorManager();",
          "341:   SimpleDiagHandlerRAII outputManager{manager};",
          "344:   if (manager.getErrorCount()) {",
          "346:     return runtime.raiseSyntaxError(",
          "347:         llvh::StringRef{outputManager.getErrorString()});",
          "348:   }",
          "350:   assert(bcModule && \"No errors, yet no bcModule\");",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "346:   functionHeader_ =",
          "347:       runtimeModule_->getBytecode()->getFunctionHeader(functionID_);",
          "348:   bytecode_ = runtimeModule_->getBytecode()->getBytecode(functionID_);",
          "349: }",
          "350: #endif // HERMESVM_LEAN",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "361:   return ExecutionStatus::RETURNED;",
          "",
          "---------------"
        ],
        "lib/VM/Debugger/Debugger.cpp||lib/VM/Debugger/Debugger.cpp": [
          "File: lib/VM/Debugger/Debugger.cpp -> lib/VM/Debugger/Debugger.cpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "1143:            (start.col <= request.column && request.column <= end.col))) {",
          "",
          "[Removed Lines]",
          "1146:         codeBlock->lazyCompile(runtime_);",
          "",
          "[Added Lines]",
          "1146:         if (LLVM_UNLIKELY(",
          "1147:                 codeBlock->lazyCompile(runtime_) ==",
          "1148:                 ExecutionStatus::EXCEPTION)) {",
          "1150:           runtime_.clearThrownValue();",
          "1151:         }",
          "",
          "---------------"
        ],
        "lib/VM/Interpreter.cpp||lib/VM/Interpreter.cpp": [
          "File: lib/VM/Interpreter.cpp -> lib/VM/Interpreter.cpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "788: CallResult<HermesValue> Runtime::interpretFunctionImpl(",
          "789:     CodeBlock *newCodeBlock) {",
          "792: #if defined(HERMES_MEMORY_INSTRUMENTATION) || !defined(NDEBUG)",
          "",
          "[Removed Lines]",
          "790:   newCodeBlock->lazyCompile(*this);",
          "",
          "[Added Lines]",
          "790:   if (LLVM_UNLIKELY(",
          "791:           newCodeBlock->lazyCompile(*this) == ExecutionStatus::EXCEPTION)) {",
          "792:     return ExecutionStatus::EXCEPTION;",
          "793:   }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1586: #endif",
          "1588:         CodeBlock *calleeBlock = func->getCodeBlock(runtime);",
          "1590:         curCodeBlock = calleeBlock;",
          "1591:         CAPTURE_IP_SET();",
          "1592:         goto tailCall;",
          "",
          "[Removed Lines]",
          "1589:         CAPTURE_IP(calleeBlock->lazyCompile(runtime));",
          "",
          "[Added Lines]",
          "1592:         CAPTURE_IP_ASSIGN(auto res, calleeBlock->lazyCompile(runtime));",
          "1593:         if (LLVM_UNLIKELY(res == ExecutionStatus::EXCEPTION)) {",
          "1594:           goto exception;",
          "1595:         }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1640:         assert(!SingleStep && \"can't single-step a call\");",
          "1643:         curCodeBlock = calleeBlock;",
          "1644:         CAPTURE_IP_SET();",
          "1645:         goto tailCall;",
          "",
          "[Removed Lines]",
          "1642:         CAPTURE_IP(calleeBlock->lazyCompile(runtime));",
          "",
          "[Added Lines]",
          "1648:         CAPTURE_IP_ASSIGN(auto res, calleeBlock->lazyCompile(runtime));",
          "1649:         if (LLVM_UNLIKELY(res == ExecutionStatus::EXCEPTION)) {",
          "1650:           goto exception;",
          "1651:         }",
          "",
          "---------------"
        ],
        "lib/VM/Operations.cpp||lib/VM/Operations.cpp": [
          "File: lib/VM/Operations.cpp -> lib/VM/Operations.cpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "1680:     auto *cb = func->getCodeBlock(runtime);",
          "1684:     return !func->getCodeBlock(runtime)->getHeaderFlags().isCallProhibited(",
          "1685:         true);",
          "1686:   }",
          "",
          "[Removed Lines]",
          "1683:     cb->lazyCompile(runtime);",
          "",
          "[Added Lines]",
          "1683:     if (LLVM_UNLIKELY(cb->lazyCompile(runtime) == ExecutionStatus::EXCEPTION)) {",
          "1684:       return ExecutionStatus::EXCEPTION;",
          "1685:     }",
          "",
          "---------------"
        ],
        "test/hermes/far-environment-access-eval.js||test/hermes/far-environment-access-eval.js": [
          "File: test/hermes/far-environment-access-eval.js -> test/hermes/far-environment-access-eval.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "17: try {",
          "18:     eval('\"use strict\";\\n' +",
          "19:          '\\n' +",
          "20:          'function sink(x) { return x; }\\n' +",
          "21:          'function foo(){\\n' +",
          "22:          '  var var0 = sink(\"1\");\\n' +",
          "23:          '  var var1 = sink(\"2\");\\n' +",
          "24:          '  var var2 = sink(\"3\");\\n' +",
          "25:          '  return ()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=> [var0, var1, var2];\\n' +",
          "26:          '}\\n' +",
          "27:          '\\n' +",
          "28:          'print(foo()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()());\\n')",
          "29: } catch (e) {",
          "30:   print(e);",
          "31: }",
          "",
          "---------------"
        ],
        "test/hermes/far-environment-access.js||test/hermes/far-environment-access.js": [
          "File: test/hermes/far-environment-access.js -> test/hermes/far-environment-access.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "18: \"use strict\";",
          "20: function sink(x) { return x; }",
          "21: function foo(){",
          "22:   var var0 = sink(\"1\");",
          "23:   var var1 = sink(\"2\");",
          "24:   var var2 = sink(\"3\");",
          "25:   return ()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=>()=> [var0, var1, var2];",
          "26: }",
          "28: try {",
          "29:   print(foo()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()());",
          "30: } catch (e) {",
          "31:   print(e);",
          "32: }",
          "",
          "---------------"
        ]
      }
    }
  ]
}