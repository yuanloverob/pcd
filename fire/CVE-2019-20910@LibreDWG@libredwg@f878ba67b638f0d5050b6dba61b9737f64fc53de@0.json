{
  "cve_id": "CVE-2019-20910",
  "cve_desc": "An issue was discovered in GNU LibreDWG through 0.9.3. Crafted input will lead to a heap-based buffer over-read in decode_R13_R2000 in decode.c, a different vulnerability than CVE-2019-20011.",
  "repo": "LibreDWG/libredwg",
  "patch_hash": "f878ba67b638f0d5050b6dba61b9737f64fc53de",
  "patch_info": {
    "commit_hash": "f878ba67b638f0d5050b6dba61b9737f64fc53de",
    "repo": "LibreDWG/libredwg",
    "commit_url": "https://github.com/LibreDWG/libredwg/commit/f878ba67b638f0d5050b6dba61b9737f64fc53de",
    "files": [
      "src/classes.inc",
      "src/dec_macros.h"
    ],
    "message": "add DEBUGGING_CLASS_CPP\n\nand use it for TABLECONTENT.\nThis is more stable than CLASS_DXF in cases when\nTABLE is mixed up with TABLECONTENT. See e.g.\nGH #178, where it fixes the heap_overflow2 case.",
    "before_after_code_files": [
      "src/classes.inc||src/classes.inc",
      "src/dec_macros.h||src/dec_macros.h"
    ]
  },
  "patch_diff": {
    "src/classes.inc||src/classes.inc": [
      "File: src/classes.inc -> src/classes.inc",
      "--- Hunk 1 ---",
      "[Context before]",
      "53: # define DEBUGGING_DXF(action, name)                 ALLOW_DXF(action, name)",
      "54: # define DEBUGGING_CLASS(action, name)               UNSTABLE_CLASS(action, name)",
      "55: # define DEBUGGING_CLASS_DXF(action, name, _dxfname) UNSTABLE_CLASS_DXF(action, name, _dxfname)",
      "56: #else",
      "57: # define DEBUGGING_DXF(action, name)                 DISALLOW_DXF(action, name)",
      "58: # define DEBUGGING_CLASS(action, name)               UNHANDLED_CLASS(action, name)",
      "59: # define DEBUGGING_CLASS_DXF(action, name, _dxfname) UNHANDLED_CLASS_DXF(action, name, _dxfname)",
      "60: #endif",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "56: # define DEBUGGING_CLASS_CPP(action, name, cppname)  UNSTABLE_CLASS_CPP(action, name, cppname)",
      "61: # define DEBUGGING_CLASS_CPP(action, name, cppname)  UNHANDLED_CLASS_CPP(action, name, cppname)",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "150:       return DWG_ERR_UNHANDLEDCLASS; \\",
      "151:     }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "154: #define UNHANDLED_CLASS_CPP(action, _name, _cppname) \\",
      "155:   if (klass->cppname && strEQc (klass->cppname, #_cppname)) \\",
      "156:     { \\",
      "157:       WARN_UNHANDLED_CLASS; \\",
      "158:       if (strEQc (_STR(action), \"decode\") || !memcmp (_STR(action), \"in\", 2)) { \\",
      "159:         obj->name = (char*) #_name; \\",
      "160:         obj->dxfname = (char*) #_name; \\",
      "161:         obj->fixedtype = DWG_TYPE_##_name; \\",
      "162:       } \\",
      "164:       return DWG_ERR_UNHANDLEDCLASS; \\",
      "165:     }",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "222:   DEBUGGING_CLASS     (ACTION, ARC_DIMENSION) //ent",
      "224:   DEBUGGING_CLASS     (ACTION, TABLEGEOMETRY) //wrong geom_data",
      "225:   DEBUGGING_CLASS     (ACTION, CELLSTYLEMAP) //broken",
      "226:   DEBUGGING_CLASS     (ACTION, MATERIAL)     //working on",
      "",
      "[Removed Lines]",
      "223:   DEBUGGING_CLASS     (ACTION, TABLECONTENT) //wrong values",
      "",
      "[Added Lines]",
      "237:   DEBUGGING_CLASS_CPP (ACTION, TABLECONTENT, AcDbTableContent)",
      "",
      "---------------"
    ],
    "src/dec_macros.h||src/dec_macros.h": [
      "File: src/dec_macros.h -> src/dec_macros.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "1236:       obj_dat = *dat;                                                         \\",
      "1237:       hdl_dat = *dat;                                                         \\",
      "1238:       str_dat = *dat;                                                         \\",
      "1241:     }                                                                         \\",
      "1242:     else { error = dwg_decode_##token##_private (dat, dat, dat, obj); }       \\",
      "1243:     return error;                                                             \\",
      "",
      "[Removed Lines]",
      "1239:       error                                                                   \\",
      "1240:           = dwg_decode_##token##_private (&obj_dat, &hdl_dat, &str_dat, obj); \\",
      "",
      "[Added Lines]",
      "1239:       error = dwg_decode_##token##_private (&obj_dat, &hdl_dat, &str_dat,     \\",
      "1240:                                             obj);                             \\",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "3f503dd294efc63a59608d8a16058c41d44ba13a",
      "candidate_info": {
        "commit_hash": "3f503dd294efc63a59608d8a16058c41d44ba13a",
        "repo": "LibreDWG/libredwg",
        "commit_url": "https://github.com/LibreDWG/libredwg/commit/3f503dd294efc63a59608d8a16058c41d44ba13a",
        "files": [
          "src/classes.inc",
          "src/dec_macros.h"
        ],
        "message": "add DEBUGGING_CLASS_CPP\n\nand use it for TABLECONTENT.\nThis is more stable than CLASS_DXF in cases when\nTABLE is mixed up with TABLECONTENT. See e.g.\nGH #178, where it fixes the heap_overflow2 case.",
        "before_after_code_files": [
          "src/classes.inc||src/classes.inc",
          "src/dec_macros.h||src/dec_macros.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "src/classes.inc||src/classes.inc",
            "src/dec_macros.h||src/dec_macros.h"
          ],
          "candidate": [
            "src/classes.inc||src/classes.inc",
            "src/dec_macros.h||src/dec_macros.h"
          ]
        }
      },
      "candidate_diff": {
        "src/classes.inc||src/classes.inc": [
          "File: src/classes.inc -> src/classes.inc",
          "--- Hunk 1 ---",
          "[Context before]",
          "53: # define DEBUGGING_DXF(action, name)                 ALLOW_DXF(action, name)",
          "54: # define DEBUGGING_CLASS(action, name)               UNSTABLE_CLASS(action, name)",
          "55: # define DEBUGGING_CLASS_DXF(action, name, _dxfname) UNSTABLE_CLASS_DXF(action, name, _dxfname)",
          "56: #else",
          "57: # define DEBUGGING_DXF(action, name)                 DISALLOW_DXF(action, name)",
          "58: # define DEBUGGING_CLASS(action, name)               UNHANDLED_CLASS(action, name)",
          "59: # define DEBUGGING_CLASS_DXF(action, name, _dxfname) UNHANDLED_CLASS_DXF(action, name, _dxfname)",
          "60: #endif",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "56: # define DEBUGGING_CLASS_CPP(action, name, _cppname) UNSTABLE_CLASS_CPP(action, name, _cppname)",
          "61: # define DEBUGGING_CLASS_CPP(action, name, _cppname) UNHANDLED_CLASS_CPP(action, name, _cppname)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "123:         obj->dxfname = (char*) #_name; \\",
          "124:         obj->fixedtype = DWG_TYPE_##_name; \\",
          "125:       } \\",
          "127:     }",
          "128: #define UNHANDLED_CLASS(action, _name) \\",
          "129:   if (klass->dxfname && strEQc (klass->dxfname, #_name)) \\",
          "",
          "[Removed Lines]",
          "126:       return DEBUGGING_DXF(action, name) DWG_FUNC_N(action,_name)(dat, obj); \\",
          "",
          "[Added Lines]",
          "128:       return DEBUGGING_DXF(action, name) DWG_FUNC_N(action,_name) (dat, obj); \\",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "144:       if (strEQc (_STR(action), \"decode\") || !memcmp (_STR(action), \"in\", 2)) { \\",
          "145:         obj->name = (char*) #_name; \\",
          "146:         obj->dxfname = (char*) #_dxfname; \\",
          "148:       } \\",
          "150:       return DWG_ERR_UNHANDLEDCLASS; \\",
          "151:     }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "148:       return DWG_ERR_UNHANDLEDCLASS; \\",
          "149:     }",
          "150: #define UNHANDLED_CLASS_CPP(action, _name, _cppname) \\",
          "151:   if (klass->cppname && strEQc (klass->cppname, #_cppname)) \\",
          "152:     { \\",
          "153:       WARN_UNHANDLED_CLASS; \\",
          "154:       if (strEQc (_STR(action), \"decode\") || !memcmp (_STR(action), \"in\", 2)) { \\",
          "155:         obj->name = (char*) #_name; \\",
          "156:         obj->dxfname = (char*) #_name; \\",
          "157:       } \\",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "170:   STABLE_CLASS    (ACTION, IMAGEDEF)",
          "171:   STABLE_CLASS    (ACTION, IMAGEDEF_REACTOR)",
          "172:   STABLE_CLASS    (ACTION, LAYER_INDEX)",
          "174:   STABLE_CLASS    (ACTION, LWPOLYLINE)",
          "176:   STABLE_CLASS    (ACTION, OBJECTCONTEXTDATA)",
          "177:   STABLE_CLASS_CPP(ACTION, OBJECTCONTEXTDATA, AcDbObjectContextData)",
          "178:   STABLE_CLASS_DXF(ACTION, PLACEHOLDER, ACDBPLACEHOLDER)",
          "",
          "[Removed Lines]",
          "173:   STABLE_CLASS    (ACTION, LAYOUT)",
          "175:   STABLE_CLASS    (ACTION, MLEADERSTYLE)",
          "",
          "[Added Lines]",
          "181:   STABLE_CLASS    (ACTION, LAYOUT) // TODO bottom_margin nan",
          "183:   STABLE_CLASS    (ACTION, MLEADERSTYLE) // TODO block_rotation nan",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "224:   DEBUGGING_CLASS     (ACTION, TABLEGEOMETRY) //wrong geom_data",
          "225:   DEBUGGING_CLASS     (ACTION, CELLSTYLEMAP) //broken",
          "226:   DEBUGGING_CLASS     (ACTION, MATERIAL)     //working on",
          "",
          "[Removed Lines]",
          "222:   DEBUGGING_CLASS     (ACTION, ARC_DIMENSION) //ent",
          "223:   DEBUGGING_CLASS     (ACTION, TABLECONTENT) //wrong values",
          "",
          "[Added Lines]",
          "231:   DEBUGGING_CLASS_CPP (ACTION, TABLECONTENT, AcDbTableContent)",
          "",
          "---------------"
        ],
        "src/dec_macros.h||src/dec_macros.h": [
          "File: src/dec_macros.h -> src/dec_macros.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "1236:       obj_dat = *dat;                                                         \\",
          "1237:       hdl_dat = *dat;                                                         \\",
          "1238:       str_dat = *dat;                                                         \\",
          "1241:     }                                                                         \\",
          "1242:     else { error = dwg_decode_##token##_private (dat, dat, dat, obj); }       \\",
          "1243:     return error;                                                             \\",
          "",
          "[Removed Lines]",
          "1239:       error                                                                   \\",
          "1240:           = dwg_decode_##token##_private (&obj_dat, &hdl_dat, &str_dat, obj); \\",
          "",
          "[Added Lines]",
          "1239:       error = dwg_decode_##token##_private (&obj_dat, &hdl_dat, &str_dat,     \\",
          "1240:                                             obj);                             \\",
          "",
          "---------------"
        ]
      }
    }
  ]
}