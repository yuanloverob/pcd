{
  "cve_id": "CVE-2021-37688",
  "cve_desc": "TensorFlow is an end-to-end open source platform for machine learning. In affected versions an attacker can craft a TFLite model that would trigger a null pointer dereference, which would result in a crash and denial of service. The [implementation](https://github.com/tensorflow/tensorflow/blob/149562d49faa709ea80df1d99fc41d005b81082a/tensorflow/lite/kernels/internal/optimized/optimized_ops.h#L268-L285) unconditionally dereferences a pointer. We have patched the issue in GitHub commit 15691e456c7dc9bd6be203b09765b063bf4a380c. The fix will be included in TensorFlow 2.6.0. We will also cherrypick this commit on TensorFlow 2.5.1, TensorFlow 2.4.3, and TensorFlow 2.3.4, as these are also affected and still in supported range.",
  "repo": "tensorflow/tensorflow",
  "patch_hash": "15691e456c7dc9bd6be203b09765b063bf4a380c",
  "patch_info": {
    "commit_hash": "15691e456c7dc9bd6be203b09765b063bf4a380c",
    "repo": "tensorflow/tensorflow",
    "commit_url": "https://github.com/tensorflow/tensorflow/commit/15691e456c7dc9bd6be203b09765b063bf4a380c",
    "files": [
      "tensorflow/lite/kernels/internal/optimized/optimized_ops.h"
    ],
    "message": "Prevent dereferencing of null pointers in TFLite's `add.cc`.\n\nPiperOrigin-RevId: 387244946\nChange-Id: I56094233327fbd8439b92e1dbb1262176e00eeb9",
    "before_after_code_files": [
      "tensorflow/lite/kernels/internal/optimized/optimized_ops.h||tensorflow/lite/kernels/internal/optimized/optimized_ops.h"
    ]
  },
  "patch_diff": {
    "tensorflow/lite/kernels/internal/optimized/optimized_ops.h||tensorflow/lite/kernels/internal/optimized/optimized_ops.h": [
      "File: tensorflow/lite/kernels/internal/optimized/optimized_ops.h -> tensorflow/lite/kernels/internal/optimized/optimized_ops.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "266:       input2_data_reset = input2_data_ptr;",
      "267:     }",
      "",
      "[Removed Lines]",
      "268:   } else {",
      "",
      "[Added Lines]",
      "268:   } else if (input1_data_ptr != nullptr) {",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "14f52ca726de725b7e6b15f1783ae9ea3b197227",
      "candidate_info": {
        "commit_hash": "14f52ca726de725b7e6b15f1783ae9ea3b197227",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/14f52ca726de725b7e6b15f1783ae9ea3b197227",
        "files": [
          "tensorflow/lite/kernels/internal/optimized/optimized_ops.h"
        ],
        "message": "Prevent dereferencing of null pointers in TFLite's `add.cc`.\n\nPiperOrigin-RevId: 387244946\nChange-Id: I56094233327fbd8439b92e1dbb1262176e00eeb9",
        "before_after_code_files": [
          "tensorflow/lite/kernels/internal/optimized/optimized_ops.h||tensorflow/lite/kernels/internal/optimized/optimized_ops.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/lite/kernels/internal/optimized/optimized_ops.h||tensorflow/lite/kernels/internal/optimized/optimized_ops.h"
          ],
          "candidate": [
            "tensorflow/lite/kernels/internal/optimized/optimized_ops.h||tensorflow/lite/kernels/internal/optimized/optimized_ops.h"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/lite/kernels/internal/optimized/optimized_ops.h||tensorflow/lite/kernels/internal/optimized/optimized_ops.h": [
          "File: tensorflow/lite/kernels/internal/optimized/optimized_ops.h -> tensorflow/lite/kernels/internal/optimized/optimized_ops.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "305:       input2_data_reset = input2_data_ptr;",
          "306:     }",
          "",
          "[Removed Lines]",
          "307:   } else {",
          "",
          "[Added Lines]",
          "307:   } else if (input1_data_ptr != nullptr) {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "0fafc31d4e4bead71c0ddb10061f72e5f000b532",
      "candidate_info": {
        "commit_hash": "0fafc31d4e4bead71c0ddb10061f72e5f000b532",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/0fafc31d4e4bead71c0ddb10061f72e5f000b532",
        "files": [
          "tensorflow/lite/kernels/internal/optimized/optimized_ops.h"
        ],
        "message": "Prevent dereferencing of null pointers in TFLite's `add.cc`.\n\nPiperOrigin-RevId: 387244946\nChange-Id: I56094233327fbd8439b92e1dbb1262176e00eeb9",
        "before_after_code_files": [
          "tensorflow/lite/kernels/internal/optimized/optimized_ops.h||tensorflow/lite/kernels/internal/optimized/optimized_ops.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/lite/kernels/internal/optimized/optimized_ops.h||tensorflow/lite/kernels/internal/optimized/optimized_ops.h"
          ],
          "candidate": [
            "tensorflow/lite/kernels/internal/optimized/optimized_ops.h||tensorflow/lite/kernels/internal/optimized/optimized_ops.h"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/lite/kernels/internal/optimized/optimized_ops.h||tensorflow/lite/kernels/internal/optimized/optimized_ops.h": [
          "File: tensorflow/lite/kernels/internal/optimized/optimized_ops.h -> tensorflow/lite/kernels/internal/optimized/optimized_ops.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "266:       input2_data_reset = input2_data_ptr;",
          "267:     }",
          "",
          "[Removed Lines]",
          "268:   } else {",
          "",
          "[Added Lines]",
          "268:   } else if (input1_data_ptr != nullptr) {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "d543642c0bd82ee68b0e383a6567555f7f96a81a",
      "candidate_info": {
        "commit_hash": "d543642c0bd82ee68b0e383a6567555f7f96a81a",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/d543642c0bd82ee68b0e383a6567555f7f96a81a",
        "files": [
          "tensorflow/lite/kernels/internal/optimized/optimized_ops.h"
        ],
        "message": "Prevent dereferencing of null pointers in TFLite's `add.cc`.\n\nPiperOrigin-RevId: 387244946\nChange-Id: I56094233327fbd8439b92e1dbb1262176e00eeb9",
        "before_after_code_files": [
          "tensorflow/lite/kernels/internal/optimized/optimized_ops.h||tensorflow/lite/kernels/internal/optimized/optimized_ops.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/lite/kernels/internal/optimized/optimized_ops.h||tensorflow/lite/kernels/internal/optimized/optimized_ops.h"
          ],
          "candidate": [
            "tensorflow/lite/kernels/internal/optimized/optimized_ops.h||tensorflow/lite/kernels/internal/optimized/optimized_ops.h"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/lite/kernels/internal/optimized/optimized_ops.h||tensorflow/lite/kernels/internal/optimized/optimized_ops.h": [
          "File: tensorflow/lite/kernels/internal/optimized/optimized_ops.h -> tensorflow/lite/kernels/internal/optimized/optimized_ops.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "305:       input2_data_reset = input2_data_ptr;",
          "306:     }",
          "",
          "[Removed Lines]",
          "307:   } else {",
          "",
          "[Added Lines]",
          "307:   } else if (input1_data_ptr != nullptr) {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "66664775f1c1f7616ecf00e593c7d880f98a1734",
      "candidate_info": {
        "commit_hash": "66664775f1c1f7616ecf00e593c7d880f98a1734",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/66664775f1c1f7616ecf00e593c7d880f98a1734",
        "files": [
          "tensorflow/lite/kernels/internal/optimized/optimized_ops.h"
        ],
        "message": "Prevent dereferencing of null pointers in TFLite's `add.cc`.\n\nPiperOrigin-RevId: 387244946\nChange-Id: I56094233327fbd8439b92e1dbb1262176e00eeb9",
        "before_after_code_files": [
          "tensorflow/lite/kernels/internal/optimized/optimized_ops.h||tensorflow/lite/kernels/internal/optimized/optimized_ops.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/lite/kernels/internal/optimized/optimized_ops.h||tensorflow/lite/kernels/internal/optimized/optimized_ops.h"
          ],
          "candidate": [
            "tensorflow/lite/kernels/internal/optimized/optimized_ops.h||tensorflow/lite/kernels/internal/optimized/optimized_ops.h"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/lite/kernels/internal/optimized/optimized_ops.h||tensorflow/lite/kernels/internal/optimized/optimized_ops.h": [
          "File: tensorflow/lite/kernels/internal/optimized/optimized_ops.h -> tensorflow/lite/kernels/internal/optimized/optimized_ops.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "266:       input2_data_reset = input2_data_ptr;",
          "267:     }",
          "",
          "[Removed Lines]",
          "268:   } else {",
          "",
          "[Added Lines]",
          "268:   } else if (input1_data_ptr != nullptr) {",
          "",
          "---------------"
        ]
      }
    }
  ]
}