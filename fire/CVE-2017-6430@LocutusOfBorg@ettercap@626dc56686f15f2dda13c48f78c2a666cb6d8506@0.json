{
  "cve_id": "CVE-2017-6430",
  "cve_desc": "The compile_tree function in ef_compiler.c in the Etterfilter utility in Ettercap 0.8.2 and earlier allows remote attackers to cause a denial of service (out-of-bounds read) via a crafted filter.",
  "repo": "LocutusOfBorg/ettercap",
  "patch_hash": "626dc56686f15f2dda13c48f78c2a666cb6d8506",
  "patch_info": {
    "commit_hash": "626dc56686f15f2dda13c48f78c2a666cb6d8506",
    "repo": "LocutusOfBorg/ettercap",
    "commit_url": "https://github.com/LocutusOfBorg/ettercap/commit/626dc56686f15f2dda13c48f78c2a666cb6d8506",
    "files": [
      "utils/etterfilter/ef_compiler.c",
      "utils/etterfilter/ef_main.c",
      "utils/etterfilter/ef_output.c"
    ],
    "message": "Exit gracefully in case of corrupted filters (Closes issue #782)",
    "before_after_code_files": [
      "utils/etterfilter/ef_compiler.c||utils/etterfilter/ef_compiler.c",
      "utils/etterfilter/ef_main.c||utils/etterfilter/ef_main.c",
      "utils/etterfilter/ef_output.c||utils/etterfilter/ef_output.c"
    ]
  },
  "patch_diff": {
    "utils/etterfilter/ef_compiler.c||utils/etterfilter/ef_compiler.c": [
      "File: utils/etterfilter/ef_compiler.c -> utils/etterfilter/ef_compiler.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "239:    struct filter_op *array = NULL;",
      "240:    struct unfold_elm *ue;",
      "244:    fprintf(stdout, \" Unfolding the meta-tree \");",
      "245:    fflush(stdout);",
      "",
      "[Removed Lines]",
      "242:    BUG_IF(tree_root == NULL);",
      "",
      "[Added Lines]",
      "243:    if (tree_root == NULL)",
      "244:       return 0;",
      "",
      "---------------"
    ],
    "utils/etterfilter/ef_main.c||utils/etterfilter/ef_main.c": [
      "File: utils/etterfilter/ef_main.c -> utils/etterfilter/ef_main.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "42: int main(int argc, char *argv[])",
      "43: {",
      "44:    libettercap_init();",
      "45:    ef_globals_alloc();",
      "46:    select_text_interface();",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "44:    int ret_value = 0;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "88:       fprintf(stdout, \"\\n\\nThe script contains errors...\\n\\n\");",
      "93:    ef_globals_free();",
      "94:    return 0;",
      "95: }",
      "",
      "[Removed Lines]",
      "91:    if (write_output() != E_SUCCESS)",
      "92:       FATAL_ERROR(\"Cannot write output file (%s)\", EF_GBL_OPTIONS->output_file);",
      "",
      "[Added Lines]",
      "92:    ret_value = write_output();",
      "93:    if (ret_value == -E_NOTHANDLED)",
      "94:       FATAL_ERROR(\"Cannot write output file (%s): the filter is not correctly handled.\", EF_GBL_OPTIONS->output_file);",
      "95:    else if (ret_value == -E_INVALID)",
      "96:       FATAL_ERROR(\"Cannot write output file (%s): the filter format is not correct. \", EF_GBL_OPTIONS->output_file);",
      "",
      "---------------"
    ],
    "utils/etterfilter/ef_output.c||utils/etterfilter/ef_output.c": [
      "File: utils/etterfilter/ef_output.c -> utils/etterfilter/ef_output.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "51:    if (fop == NULL)",
      "52:       return -E_NOTHANDLED;",
      "55:    fd = open(EF_GBL_OPTIONS->output_file, O_CREAT | O_RDWR | O_TRUNC | O_BINARY, 0644);",
      "56:    ON_ERROR(fd, -1, \"Can't create file %s\", EF_GBL_OPTIONS->output_file);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "54:    if (ninst == 0)",
      "55:       return -E_INVALID;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "4ad7f85dc01202e363659aa473c99470b3f4e1f4",
      "candidate_info": {
        "commit_hash": "4ad7f85dc01202e363659aa473c99470b3f4e1f4",
        "repo": "LocutusOfBorg/ettercap",
        "commit_url": "https://github.com/LocutusOfBorg/ettercap/commit/4ad7f85dc01202e363659aa473c99470b3f4e1f4",
        "files": [
          "utils/etterfilter/ef_compiler.c",
          "utils/etterfilter/ef_main.c",
          "utils/etterfilter/ef_output.c"
        ],
        "message": "Fix issue #782",
        "before_after_code_files": [
          "utils/etterfilter/ef_compiler.c||utils/etterfilter/ef_compiler.c",
          "utils/etterfilter/ef_main.c||utils/etterfilter/ef_main.c",
          "utils/etterfilter/ef_output.c||utils/etterfilter/ef_output.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_issue": 1,
        "olp_code_files": {
          "patch": [
            "utils/etterfilter/ef_compiler.c||utils/etterfilter/ef_compiler.c",
            "utils/etterfilter/ef_main.c||utils/etterfilter/ef_main.c",
            "utils/etterfilter/ef_output.c||utils/etterfilter/ef_output.c"
          ],
          "candidate": [
            "utils/etterfilter/ef_compiler.c||utils/etterfilter/ef_compiler.c",
            "utils/etterfilter/ef_main.c||utils/etterfilter/ef_main.c",
            "utils/etterfilter/ef_output.c||utils/etterfilter/ef_output.c"
          ]
        }
      },
      "candidate_diff": {
        "utils/etterfilter/ef_compiler.c||utils/etterfilter/ef_compiler.c": [
          "File: utils/etterfilter/ef_compiler.c -> utils/etterfilter/ef_compiler.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "239:    struct filter_op *array = NULL;",
          "240:    struct unfold_elm *ue;",
          "244:    fprintf(stdout, \" Unfolding the meta-tree \");",
          "245:    fflush(stdout);",
          "",
          "[Removed Lines]",
          "242:    BUG_IF(tree_root == NULL);",
          "",
          "[Added Lines]",
          "243:    if (tree_root == NULL)",
          "244:       return 0;",
          "",
          "---------------"
        ],
        "utils/etterfilter/ef_main.c||utils/etterfilter/ef_main.c": [
          "File: utils/etterfilter/ef_main.c -> utils/etterfilter/ef_main.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "40: int main(int argc, char *argv[])",
          "41: {",
          "43:    globals_alloc();",
          "45:    fprintf(stdout, \"\\n\" EC_COLOR_BOLD \"%s %s\" EC_COLOR_END \" copyright %s %s\\n\\n\",",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "42:    int ret_value = 0;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "84:       fprintf(stdout, \"\\n\\nThe script contains errors...\\n\\n\");",
          "89:    globals_free();",
          "90:    return 0;",
          "91: }",
          "",
          "[Removed Lines]",
          "87:    if (write_output() != E_SUCCESS)",
          "88:       FATAL_ERROR(\"Cannot write output file (%s)\", GBL_OPTIONS->output_file);",
          "",
          "[Added Lines]",
          "87:    ret_value = write_output();",
          "88:    if (ret_value == -E_NOTHANDLED)",
          "89:       FATAL_ERROR(\"Cannot write output file (%s): the filter is not correctly handled.\", GBL_OPTIONS->output_file);",
          "90:    else if (ret_value == -E_INVALID)",
          "91:       FATAL_ERROR(\"Cannot write output file (%s): the filter format is not correct. \", GBL_OPTIONS->output_file);",
          "",
          "---------------"
        ],
        "utils/etterfilter/ef_output.c||utils/etterfilter/ef_output.c": [
          "File: utils/etterfilter/ef_output.c -> utils/etterfilter/ef_output.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "51:    if (fop == NULL)",
          "52:       return -E_NOTHANDLED;",
          "55:    fd = open(GBL_OPTIONS->output_file, O_CREAT | O_RDWR | O_TRUNC | O_BINARY, 0644);",
          "56:    ON_ERROR(fd, -1, \"Can't create file %s\", GBL_OPTIONS->output_file);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "54:    if (ninst == 0)",
          "55:       return -E_INVALID;",
          "",
          "---------------"
        ]
      }
    }
  ]
}