{
  "cve_id": "CVE-2023-3745",
  "cve_desc": "A heap-based buffer overflow issue was found in ImageMagick's PushCharPixel() function in quantum-private.h. This issue may allow a local attacker to trick the user into opening a specially crafted file, triggering an out-of-bounds read error and allowing an application to crash, resulting in a denial of service.",
  "repo": "ImageMagick/ImageMagick6",
  "patch_hash": "7486477aa00c5c7856b111506da075b6cdfa8b73",
  "patch_info": {
    "commit_hash": "7486477aa00c5c7856b111506da075b6cdfa8b73",
    "repo": "ImageMagick/ImageMagick6",
    "commit_url": "https://github.com/ImageMagick/ImageMagick6/commit/7486477aa00c5c7856b111506da075b6cdfa8b73",
    "files": [
      "coders/tiff.c"
    ],
    "message": "https://github.com/ImageMagick/ImageMagick/issues/1857",
    "before_after_code_files": [
      "coders/tiff.c||coders/tiff.c"
    ]
  },
  "patch_diff": {
    "coders/tiff.c||coders/tiff.c": [
      "File: coders/tiff.c -> coders/tiff.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1701:         (void) FormatLocaleString(value,MaxTextExtent,\"%u\",(unsigned int)",
      "1702:           rows_per_strip);",
      "1703:         (void) SetImageProperty(image,\"tiff:rows-per-strip\",value);",
      "1705:         if (rows_per_strip > (uint32) image->rows)",
      "1706:           rows_per_strip=(uint32) image->rows;",
      "1707:       }",
      "",
      "[Removed Lines]",
      "1704:         method=ReadStripMethod;",
      "",
      "[Added Lines]",
      "1704:         method=ReadStripMethod;",
      "1705:         if (rows_per_strip > (uint32) image->rows)",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "1834:           strip_size;",
      "1836:         unsigned char",
      "1840:           Convert stripped TIFF image.",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "6951ba0259bc0caa09e80fdbb47261a00933950d",
      "candidate_info": {
        "commit_hash": "6951ba0259bc0caa09e80fdbb47261a00933950d",
        "repo": "ImageMagick/ImageMagick6",
        "commit_url": "https://github.com/ImageMagick/ImageMagick6/commit/6951ba0259bc0caa09e80fdbb47261a00933950d",
        "files": [
          "coders/tiff.c"
        ],
        "message": "https://github.com/ImageMagick/ImageMagick/discussions/2935",
        "before_after_code_files": [
          "coders/tiff.c||coders/tiff.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "coders/tiff.c||coders/tiff.c"
          ],
          "candidate": [
            "coders/tiff.c||coders/tiff.c"
          ]
        }
      },
      "candidate_diff": {
        "coders/tiff.c||coders/tiff.c": [
          "File: coders/tiff.c -> coders/tiff.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1732:         if ((TIFFGetField(tiff,TIFFTAG_TILEWIDTH,&columns) != 1) ||",
          "1733:             (TIFFGetField(tiff,TIFFTAG_TILELENGTH,&rows) != 1))",
          "1735:         if ((AcquireMagickResource(WidthResource,columns) == MagickFalse) ||",
          "1736:             (AcquireMagickResource(HeightResource,rows) == MagickFalse))",
          "1737:           ThrowTIFFException(ImageError,\"WidthOrHeightExceedsLimit\");",
          "",
          "[Removed Lines]",
          "1734:           ThrowTIFFException(CoderError,\"ImageIsNotTiled\");",
          "",
          "[Added Lines]",
          "1734:           ThrowTIFFException(CoderError,\"ImageIsNotTiled\");",
          "1735:         if ((AcquireMagickResource(WidthResource,columns) == MagickFalse) ||",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "b466a96965afc1308a4ace93f5535c2b770f294b",
      "candidate_info": {
        "commit_hash": "b466a96965afc1308a4ace93f5535c2b770f294b",
        "repo": "ImageMagick/ImageMagick6",
        "commit_url": "https://github.com/ImageMagick/ImageMagick6/commit/b466a96965afc1308a4ace93f5535c2b770f294b",
        "files": [
          "ChangeLog",
          "coders/tiff.c"
        ],
        "message": "https://github.com/ImageMagick/ImageMagick/issues/1857",
        "before_after_code_files": [
          "coders/tiff.c||coders/tiff.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "coders/tiff.c||coders/tiff.c"
          ],
          "candidate": [
            "coders/tiff.c||coders/tiff.c"
          ]
        }
      },
      "candidate_diff": {
        "coders/tiff.c||coders/tiff.c": [
          "File: coders/tiff.c -> coders/tiff.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1834:           strip_size;",
          "1836:         unsigned char",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "f36f5cada9b23626da93b5b8e1c09e2f828d1ec7",
      "candidate_info": {
        "commit_hash": "f36f5cada9b23626da93b5b8e1c09e2f828d1ec7",
        "repo": "ImageMagick/ImageMagick6",
        "commit_url": "https://github.com/ImageMagick/ImageMagick6/commit/f36f5cada9b23626da93b5b8e1c09e2f828d1ec7",
        "files": [
          "coders/tiff.c",
          "configure",
          "configure.ac",
          "version.sh"
        ],
        "message": "https://github.com/ImageMagick/ImageMagick/issues/2959",
        "before_after_code_files": [
          "coders/tiff.c||coders/tiff.c",
          "configure.ac||configure.ac",
          "version.sh||version.sh"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "coders/tiff.c||coders/tiff.c"
          ],
          "candidate": [
            "coders/tiff.c||coders/tiff.c"
          ]
        }
      },
      "candidate_diff": {
        "coders/tiff.c||coders/tiff.c": [
          "File: coders/tiff.c -> coders/tiff.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1732:         if ((TIFFGetField(tiff,TIFFTAG_TILEWIDTH,&columns) != 1) ||",
          "1733:             (TIFFGetField(tiff,TIFFTAG_TILELENGTH,&rows) != 1))",
          "1736:             (AcquireMagickResource(HeightResource,rows) == MagickFalse))",
          "1737:           ThrowTIFFException(ImageError,\"WidthOrHeightExceedsLimit\");",
          "1738:         method=ReadTileMethod;",
          "",
          "[Removed Lines]",
          "1734:           ThrowTIFFException(CoderError,\"ImageIsNotTiled\");",
          "1735:         if ((AcquireMagickResource(WidthResource,columns) == MagickFalse) ||",
          "",
          "[Added Lines]",
          "1734:           ThrowTIFFException(CoderError,\"ImageIsNotTiled\");",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1885:         strip_id=0;",
          "1886:         p=strip_pixels;",
          "1887:         for (i=0; i < (ssize_t) samples_per_pixel; i++)",
          "1889:           size_t",
          "1890:             rows_remaining;",
          "1892:           switch (i)",
          "1893:           {",
          "1894:             case 0: break;",
          "1895:             case 1: quantum_type=GreenQuantum; break;",
          "1896:             case 2: quantum_type=BlueQuantum; break;",
          "1897:             case 3:",
          "1898:             {",
          "1899:               if (image->colorspace == CMYKColorspace)",
          "1900:                 quantum_type=BlackQuantum;",
          "",
          "[Removed Lines]",
          "1888:         {",
          "",
          "[Added Lines]",
          "1887:         {",
          "1892:           {",
          "1898:               quantum_type=AlphaQuantum;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1977:         tile_pixels=(unsigned char *) AcquireQuantumMemory(extent,",
          "1978:           sizeof(*tile_pixels));",
          "1979:         if (tile_pixels == (unsigned char *) NULL)",
          "1981:         (void) memset(tile_pixels,0,extent*sizeof(*tile_pixels));",
          "1982:         for (i=0; i < (ssize_t) samples_per_pixel; i++)",
          "1983:         {",
          "1984:           switch (i)",
          "1985:           {",
          "1986:             case 0: break;",
          "1987:             case 1: quantum_type=GreenQuantum; break;",
          "1988:             case 2: quantum_type=BlueQuantum; break;",
          "1989:             case 3:",
          "1990:             {",
          "1991:               if (image->colorspace == CMYKColorspace)",
          "1992:                 quantum_type=BlackQuantum;",
          "",
          "[Removed Lines]",
          "1980:           ThrowTIFFException(ResourceLimitError,\"MemoryAllocationFailed\");",
          "",
          "[Added Lines]",
          "1981:           ThrowTIFFException(ResourceLimitError,\"MemoryAllocationFailed\");",
          "1986:           {",
          "1992:               quantum_type=AlphaQuantum;",
          "",
          "---------------"
        ],
        "configure.ac||configure.ac": [
          "File: configure.ac -> configure.ac",
          "--- Hunk 1 ---",
          "[Context before]",
          "27: m4_define([magick_major_version], [6])",
          "28: m4_define([magick_minor_version], [9])",
          "29: m4_define([magick_micro_version], [11])",
          "31: m4_define([magick_version],",
          "32:           [magick_major_version.magick_minor_version.magick_micro_version-magick_patchlevel_version])",
          "33: m4_define([magick_git_revision],",
          "",
          "[Removed Lines]",
          "30: m4_define([magick_patchlevel_version], [47])",
          "",
          "[Added Lines]",
          "30: m4_define([magick_patchlevel_version], [48])",
          "",
          "---------------"
        ],
        "version.sh||version.sh": [
          "File: version.sh -> version.sh",
          "--- Hunk 1 ---",
          "[Context before]",
          "19: PACKAGE_VERSION='6.9.11'",
          "20: PACKAGE_PERL_VERSION='6.9.11'",
          "21: PACKAGE_LIB_VERSION=\"0x69B\"",
          "23: PACKAGE_LIB_VERSION_NUMBER=\"6,9,11,${PACKAGE_RELEASE}\"",
          "24: PACKAGE_RELEASE_DATE_RAW=`date +%F`",
          "25: PACKAGE_RELEASE_DATE_REPRODUCIBLE=\"${PACKAGE_CHANGE_DATE}\"",
          "",
          "[Removed Lines]",
          "22: PACKAGE_RELEASE=\"47\"",
          "",
          "[Added Lines]",
          "22: PACKAGE_RELEASE=\"48\"",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "9055e0d4f51c1e63e35d7cea8e4d75b1ff1468ca",
      "candidate_info": {
        "commit_hash": "9055e0d4f51c1e63e35d7cea8e4d75b1ff1468ca",
        "repo": "ImageMagick/ImageMagick6",
        "commit_url": "https://github.com/ImageMagick/ImageMagick6/commit/9055e0d4f51c1e63e35d7cea8e4d75b1ff1468ca",
        "files": [
          "ChangeLog",
          "coders/tiff.c"
        ],
        "message": "better support for TIFF YCbCr photometric",
        "before_after_code_files": [
          "coders/tiff.c||coders/tiff.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "coders/tiff.c||coders/tiff.c"
          ],
          "candidate": [
            "coders/tiff.c||coders/tiff.c"
          ]
        }
      },
      "candidate_diff": {
        "coders/tiff.c||coders/tiff.c": [
          "File: coders/tiff.c -> coders/tiff.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1434:       }",
          "1435: #endif",
          "1436:     if ((photometric == PHOTOMETRIC_MINISBLACK) ||",
          "1437:         (photometric == PHOTOMETRIC_MINISWHITE))",
          "1438:       image->colorspace=GRAYColorspace;",
          "1439:     if (photometric == PHOTOMETRIC_SEPARATED)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1437:         (photometric == PHOTOMETRIC_MINISWHITE))",
          "1438:       image->colorspace=GRAYColorspace;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1714:         (void) FormatLocaleString(value,MaxTextExtent,\"%u\",(unsigned int)",
          "1715:           rows_per_strip);",
          "1716:         (void) SetImageProperty(image,\"tiff:rows-per-strip\",value);",
          "1719:           rows_per_strip=(uint32) image->rows;",
          "1720:       }",
          "1721:     if (TIFFIsTiled(tiff) != MagickFalse)",
          "",
          "[Removed Lines]",
          "1717:         method=ReadStripMethod;",
          "1718:         if (rows_per_strip > (uint32) image->rows)",
          "",
          "[Added Lines]",
          "1719:         method=ReadStripMethod;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "540cb0f29abcdf5694ba92a473e0367ab8e01123",
      "candidate_info": {
        "commit_hash": "540cb0f29abcdf5694ba92a473e0367ab8e01123",
        "repo": "ImageMagick/ImageMagick6",
        "commit_url": "https://github.com/ImageMagick/ImageMagick6/commit/540cb0f29abcdf5694ba92a473e0367ab8e01123",
        "files": [
          "coders/tiff.c"
        ],
        "message": "https://github.com/ImageMagick/ImageMagick/discussions/3078",
        "before_after_code_files": [
          "coders/tiff.c||coders/tiff.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "coders/tiff.c||coders/tiff.c"
          ],
          "candidate": [
            "coders/tiff.c||coders/tiff.c"
          ]
        }
      },
      "candidate_diff": {
        "coders/tiff.c||coders/tiff.c": [
          "File: coders/tiff.c -> coders/tiff.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1733:         if ((TIFFGetField(tiff,TIFFTAG_TILEWIDTH,&columns) != 1) ||",
          "1734:             (TIFFGetField(tiff,TIFFTAG_TILELENGTH,&rows) != 1))",
          "1736:         if ((AcquireMagickResource(WidthResource,columns) == MagickFalse) ||",
          "1737:             (AcquireMagickResource(HeightResource,rows) == MagickFalse))",
          "1738:           ThrowTIFFException(ImageError,\"WidthOrHeightExceedsLimit\");",
          "",
          "[Removed Lines]",
          "1735:           ThrowTIFFException(CoderError,\"ImageIsNotTiled\");",
          "",
          "[Added Lines]",
          "1735:           ThrowTIFFException(CoderError,\"ImageIsNotTiled\");",
          "1736:         if ((AcquireMagickResource(WidthResource,columns) == MagickFalse) ||",
          "",
          "---------------"
        ]
      }
    }
  ]
}