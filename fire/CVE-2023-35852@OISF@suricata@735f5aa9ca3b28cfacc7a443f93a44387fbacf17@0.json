{
  "cve_id": "CVE-2023-35852",
  "cve_desc": "In Suricata before 6.0.13 (when there is an adversary who controls an external source of rules), a dataset filename, that comes from a rule, may trigger absolute or relative directory traversal, and lead to write access to a local filesystem. This is addressed in 6.0.13 by requiring allow-absolute-filenames and allow-write (in the datasets rules configuration section) if an installation requires traversal/writing in this situation.",
  "repo": "OISF/suricata",
  "patch_hash": "735f5aa9ca3b28cfacc7a443f93a44387fbacf17",
  "patch_info": {
    "commit_hash": "735f5aa9ca3b28cfacc7a443f93a44387fbacf17",
    "repo": "OISF/suricata",
    "commit_url": "https://github.com/OISF/suricata/commit/735f5aa9ca3b28cfacc7a443f93a44387fbacf17",
    "files": [
      "src/detect-dataset.c",
      "suricata.yaml.in"
    ],
    "message": "datasets: flag to disable \"write\" actions\n\nAdd a new configuration flag, \"datasets.rules.allow-write\" to control\nif rules can contain \"save\" or \"state\" rules which allow write access\nto the file system.\n\nTicket: #6123",
    "before_after_code_files": [
      "src/detect-dataset.c||src/detect-dataset.c",
      "suricata.yaml.in||suricata.yaml.in"
    ]
  },
  "patch_diff": {
    "src/detect-dataset.c||src/detect-dataset.c": [
      "File: src/detect-dataset.c -> src/detect-dataset.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "302: {",
      "303:     SCLogDebug(\"save %s\", save);",
      "305:     int allow_absolute = 0;",
      "306:     (void)ConfGetBool(\"datasets.rules.allow-absolute-filenames\", &allow_absolute);",
      "307:     if (allow_absolute) {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "305:     int allow_save = 1;",
      "306:     if (ConfGetBool(\"datasets.rules.allow-write\", &allow_save)) {",
      "307:         if (!allow_save) {",
      "308:             SCLogError(SC_ERR_INVALID_SIGNATURE,",
      "309:                     \"Rules containing save/state datasets have been disabled\");",
      "310:             return -1;",
      "311:         }",
      "312:     }",
      "",
      "---------------"
    ],
    "suricata.yaml.in||suricata.yaml.in": [
      "File: suricata.yaml.in -> suricata.yaml.in",
      "--- Hunk 1 ---",
      "[Context before]",
      "1004: #    # \"..\" components to reference parent directories in rules that specify",
      "1005: #    # their filenames.",
      "1006: #    #allow-absolute-filenames: false",
      "1008: ##############################################################################",
      "1009: ##",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1007: #",
      "1008: #    # Allow datasets in rules write access for \"save\" and",
      "1009: #    # \"state\". This is enabled by default, however write access is",
      "1010: #    # limited to the data directory.",
      "1011: #    #allow-write: true",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "bcb9edc9b05a1528a7a2d342e366631923c029a1",
      "candidate_info": {
        "commit_hash": "bcb9edc9b05a1528a7a2d342e366631923c029a1",
        "repo": "OISF/suricata",
        "commit_url": "https://github.com/OISF/suricata/commit/bcb9edc9b05a1528a7a2d342e366631923c029a1",
        "files": [
          "suricata.yaml.in"
        ],
        "message": "config: uncomment datasets configuration\n\nUncomment the datasets configuration for easier editing by users.  The\nvalues are left commented out as their defaults.",
        "before_after_code_files": [
          "suricata.yaml.in||suricata.yaml.in"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "suricata.yaml.in||suricata.yaml.in"
          ],
          "candidate": [
            "suricata.yaml.in||suricata.yaml.in"
          ]
        }
      },
      "candidate_diff": {
        "suricata.yaml.in||suricata.yaml.in": [
          "File: suricata.yaml.in -> suricata.yaml.in",
          "--- Hunk 1 ---",
          "[Context before]",
          "992: asn1-max-frames: 256",
          "994: # Datasets default settings",
          "1013: ##############################################################################",
          "1014: ##",
          "",
          "[Removed Lines]",
          "995: # datasets:",
          "996: #   # Default fallback memcap and hashsize values for datasets in case these",
          "997: #   # were not explicitly defined.",
          "998: #   defaults:",
          "999: #     memcap: 100mb",
          "1000: #     hashsize: 2048",
          "1001: #",
          "1002: #  rules:",
          "1003: #    # Set to true to allow absolute filenames and filenames that use",
          "1004: #    # \"..\" components to reference parent directories in rules that specify",
          "1005: #    # their filenames.",
          "1006: #    #allow-absolute-filenames: false",
          "1007: #",
          "1008: #    # Allow datasets in rules write access for \"save\" and",
          "1009: #    # \"state\". This is enabled by default, however write access is",
          "1010: #    # limited to the data directory.",
          "1011: #    #allow-write: true",
          "",
          "[Added Lines]",
          "995: datasets:",
          "996:   # Default fallback memcap and hashsize values for datasets in case these",
          "997:   # were not explicitly defined.",
          "998:   defaults:",
          "999:     #memcap: 100mb",
          "1000:     #hashsize: 2048",
          "1002:   rules:",
          "1003:     # Set to true to allow absolute filenames and filenames that use",
          "1004:     # \"..\" components to reference parent directories in rules that specify",
          "1005:     # their filenames.",
          "1006:     #allow-absolute-filenames: false",
          "1008:     # Allow datasets in rules write access for \"save\" and",
          "1009:     # \"state\". This is enabled by default, however write access is",
          "1010:     # limited to the data directory.",
          "1011:     #allow-write: true",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "93b64939d19512f4a5191e491c363aa83faf015b",
      "candidate_info": {
        "commit_hash": "93b64939d19512f4a5191e491c363aa83faf015b",
        "repo": "OISF/suricata",
        "commit_url": "https://github.com/OISF/suricata/commit/93b64939d19512f4a5191e491c363aa83faf015b",
        "files": [
          "src/detect-dataset.c",
          "suricata.yaml.in"
        ],
        "message": "datasets: flag to disable \"write\" actions\n\nAdd a new configuration flag, \"datasets.rules.allow-write\" to control\nif rules can contain \"save\" or \"state\" rules which allow write access\nto the file system.\n\nTicket: #6123",
        "before_after_code_files": [
          "src/detect-dataset.c||src/detect-dataset.c",
          "suricata.yaml.in||suricata.yaml.in"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "src/detect-dataset.c||src/detect-dataset.c",
            "suricata.yaml.in||suricata.yaml.in"
          ],
          "candidate": [
            "src/detect-dataset.c||src/detect-dataset.c",
            "suricata.yaml.in||suricata.yaml.in"
          ]
        }
      },
      "candidate_diff": {
        "src/detect-dataset.c||src/detect-dataset.c": [
          "File: src/detect-dataset.c -> src/detect-dataset.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "303: {",
          "304:     SCLogDebug(\"save %s\", save);",
          "306:     int allow_absolute = 0;",
          "307:     (void)ConfGetBool(\"datasets.rules.allow-absolute-filenames\", &allow_absolute);",
          "308:     if (allow_absolute) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "306:     int allow_save = 1;",
          "307:     if (ConfGetBool(\"datasets.rules.allow-write\", &allow_save)) {",
          "308:         if (!allow_save) {",
          "309:             SCLogError(\"Rules containing save/state datasets have been disabled\");",
          "310:             return -1;",
          "311:         }",
          "312:     }",
          "",
          "---------------"
        ],
        "suricata.yaml.in||suricata.yaml.in": [
          "File: suricata.yaml.in -> suricata.yaml.in",
          "--- Hunk 1 ---",
          "[Context before]",
          "1164: #    # \"..\" components to reference parent directories in rules that specify",
          "1165: #    # their filenames.",
          "1166: #    #allow-absolute-filenames: false",
          "1168: ##############################################################################",
          "1169: ##",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1167: #",
          "1168: #    # Allow datasets in rules write access for \"save\" and",
          "1169: #    # \"state\". This is enabled by default, however write access is",
          "1170: #    # limited to the data directory.",
          "1171: #    #allow-write: true",
          "",
          "---------------"
        ]
      }
    }
  ]
}