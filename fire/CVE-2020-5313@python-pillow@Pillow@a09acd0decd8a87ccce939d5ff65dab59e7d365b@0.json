{
  "cve_id": "CVE-2020-5313",
  "cve_desc": "libImaging/FliDecode.c in Pillow before 6.2.2 has an FLI buffer overflow.",
  "repo": "python-pillow/Pillow",
  "patch_hash": "a09acd0decd8a87ccce939d5ff65dab59e7d365b",
  "patch_info": {
    "commit_hash": "a09acd0decd8a87ccce939d5ff65dab59e7d365b",
    "repo": "python-pillow/Pillow",
    "commit_url": "https://github.com/python-pillow/Pillow/commit/a09acd0decd8a87ccce939d5ff65dab59e7d365b",
    "files": [
      "Tests/images/fli_overrun2.bin",
      "Tests/test_image.py",
      "src/libImaging/FliDecode.c"
    ],
    "message": "Catch FLI buffer overrun",
    "before_after_code_files": [
      "Tests/test_image.py||Tests/test_image.py",
      "src/libImaging/FliDecode.c||src/libImaging/FliDecode.c"
    ]
  },
  "patch_diff": {
    "Tests/test_image.py||Tests/test_image.py": [
      "File: Tests/test_image.py -> Tests/test_image.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "598:             except IOError as e:",
      "599:                 self.assertEqual(str(e), \"buffer overrun when reading image file\")",
      "602: class MockEncoder(object):",
      "603:     pass",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "601:         with Image.open(\"Tests/images/fli_overrun2.bin\") as im:",
      "602:             try:",
      "603:                 im.seek(1)",
      "604:                 self.assertFail()",
      "605:             except IOError as e:",
      "606:                 self.assertEqual(str(e), \"buffer overrun when reading image file\")",
      "",
      "---------------"
    ],
    "src/libImaging/FliDecode.c||src/libImaging/FliDecode.c": [
      "File: src/libImaging/FliDecode.c -> src/libImaging/FliDecode.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "40:  return 0;",
      "46:     ptr = buf;",
      "",
      "[Removed Lines]",
      "43:        input buffer (on the other hand, the Python part of the driver",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "55:     if (I16(ptr+4) != 0xF1FA) {",
      "56:  state->errcode = IMAGING_CODEC_UNKNOWN;",
      "57:  return -1;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "54:     if (bytes < 8) {",
      "55:         state->errcode = IMAGING_CODEC_OVERRUN;",
      "56:         return -1;",
      "57:     }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "c40bc258472c83168a997a9bf4e4b5934397774a",
      "candidate_info": {
        "commit_hash": "c40bc258472c83168a997a9bf4e4b5934397774a",
        "repo": "python-pillow/Pillow",
        "commit_url": "https://github.com/python-pillow/Pillow/commit/c40bc258472c83168a997a9bf4e4b5934397774a",
        "files": [
          "Tests/images/fli_overrun2.bin",
          "Tests/test_image.py",
          "src/libImaging/FliDecode.c"
        ],
        "message": "Catch FLI buffer overrun",
        "before_after_code_files": [
          "Tests/test_image.py||Tests/test_image.py",
          "src/libImaging/FliDecode.c||src/libImaging/FliDecode.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_message": 1,
        "olp_code_files": {
          "patch": [
            "Tests/test_image.py||Tests/test_image.py",
            "src/libImaging/FliDecode.c||src/libImaging/FliDecode.c"
          ],
          "candidate": [
            "Tests/test_image.py||Tests/test_image.py",
            "src/libImaging/FliDecode.c||src/libImaging/FliDecode.c"
          ]
        }
      },
      "candidate_diff": {
        "Tests/test_image.py||Tests/test_image.py": [
          "File: Tests/test_image.py -> Tests/test_image.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "598:                 except OSError as e:",
          "599:                     self.assertEqual(str(e), \"buffer overrun when reading image file\")",
          "602: class MockEncoder:",
          "603:     pass",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "601:         with Image.open(\"Tests/images/fli_overrun2.bin\") as im:",
          "602:             try:",
          "603:                 im.seek(1)",
          "604:                 self.assertFail()",
          "605:             except OSError as e:",
          "606:                 self.assertEqual(str(e), \"buffer overrun when reading image file\")",
          "",
          "---------------"
        ],
        "src/libImaging/FliDecode.c||src/libImaging/FliDecode.c": [
          "File: src/libImaging/FliDecode.c -> src/libImaging/FliDecode.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "40:  return 0;",
          "46:     ptr = buf;",
          "",
          "[Removed Lines]",
          "43:        input buffer (on the other hand, the Python part of the driver",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "55:     if (I16(ptr+4) != 0xF1FA) {",
          "56:  state->errcode = IMAGING_CODEC_UNKNOWN;",
          "57:  return -1;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "54:     if (bytes < 8) {",
          "55:         state->errcode = IMAGING_CODEC_OVERRUN;",
          "56:         return -1;",
          "57:     }",
          "",
          "---------------"
        ]
      }
    }
  ]
}