{
  "cve_id": "CVE-2023-25661",
  "cve_desc": "TensorFlow is an Open Source Machine Learning Framework. In versions prior to 2.11.1 a malicious invalid input crashes a tensorflow model (Check Failed) and can be used to trigger a denial of service attack. A proof of concept can be constructed with the `Convolution3DTranspose` function. This Convolution3DTranspose layer is a very common API in modern neural networks. The ML models containing such vulnerable components could be deployed in ML applications or as cloud services. This failure could be potentially used to trigger a denial of service attack on ML cloud services. An attacker must have privilege to provide input to a `Convolution3DTranspose` call. This issue has been patched and users are advised to upgrade to version 2.11.1. There are no known workarounds for this vulnerability.",
  "repo": "tensorflow/tensorflow",
  "patch_hash": "948fe6369a5711d4b4568ea9bbf6015c6dfb77e2",
  "patch_info": {
    "commit_hash": "948fe6369a5711d4b4568ea9bbf6015c6dfb77e2",
    "repo": "tensorflow/tensorflow",
    "commit_url": "https://github.com/tensorflow/tensorflow/commit/948fe6369a5711d4b4568ea9bbf6015c6dfb77e2",
    "files": [
      "tensorflow/core/kernels/conv_grad_ops_3d.cc",
      "tensorflow/python/kernel_tests/nn_ops/conv3d_transpose_test.py"
    ],
    "message": "Fix nn.conv3d_transpose security vulnerability with illegal input shape\n\nPiperOrigin-RevId: 487000656",
    "before_after_code_files": [
      "tensorflow/core/kernels/conv_grad_ops_3d.cc||tensorflow/core/kernels/conv_grad_ops_3d.cc",
      "tensorflow/python/kernel_tests/nn_ops/conv3d_transpose_test.py||tensorflow/python/kernel_tests/nn_ops/conv3d_transpose_test.py"
    ]
  },
  "patch_diff": {
    "tensorflow/core/kernels/conv_grad_ops_3d.cc||tensorflow/core/kernels/conv_grad_ops_3d.cc": [
      "File: tensorflow/core/kernels/conv_grad_ops_3d.cc -> tensorflow/core/kernels/conv_grad_ops_3d.cc",
      "--- Hunk 1 ---",
      "[Context before]",
      "1322:     Tensor* in_backprop;",
      "1323:     OP_REQUIRES_OK(context,",
      "1324:                    context->allocate_output(0, input_shape, &in_backprop));",
      "1326:     auto* stream = context->op_device_context()->stream();",
      "1327:     OP_REQUIRES(context, stream, errors::Internal(\"No GPU stream available.\"));",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1325:     for (std::size_t i = 0; i < input_shape.dims(); ++i) {",
      "1326:       if (input_shape.dim_size(i) == 0) {",
      "1327:         return;",
      "1328:       }",
      "1329:     }",
      "",
      "---------------"
    ],
    "tensorflow/python/kernel_tests/nn_ops/conv3d_transpose_test.py||tensorflow/python/kernel_tests/nn_ops/conv3d_transpose_test.py": [
      "File: tensorflow/python/kernel_tests/nn_ops/conv3d_transpose_test.py -> tensorflow/python/kernel_tests/nn_ops/conv3d_transpose_test.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "126:     x_value = np.random.random_sample(x_shape).astype(np.float64)",
      "127:     f_value = np.random.random_sample(f_shape).astype(np.float64)",
      "128:     nn_ops.conv3d_transpose(",
      "131:   def testConv3DTransposeOutputShapeType(self):",
      "132:     # Test case for GitHub issue 18887",
      "",
      "[Removed Lines]",
      "129:         x_value, f_value, y_shape, strides, data_format='NCDHW')",
      "",
      "[Added Lines]",
      "129:         x_value, f_value, y_shape, strides, data_format=\"NCDHW\")",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "218:     err_tolerance = 0.00055",
      "219:     self.assertLess(err, err_tolerance)",
      "222: if __name__ == \"__main__\":",
      "223:   test.main()",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "221:   def testConv3DTransposeZeroShapeDoNotRaiseError(self):",
      "222:     with self.cached_session():",
      "223:       x_value = np.zeros([10, 0, 2, 3, 3])",
      "224:       f_value = np.ones((3, 3, 3, 3, 3))",
      "225:       y_shape = np.stack([10, 0, 2, 3, 3])",
      "226:       output = nn_ops.conv3d_transpose(",
      "227:           x_value,",
      "228:           f_value,",
      "229:           y_shape,",
      "230:           strides=(1, 1, 1),",
      "231:           data_format=\"NDHWC\",",
      "232:           padding=\"SAME\",",
      "233:       )",
      "234:       _ = self.evaluate(output)",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "2bae31327f77df0510542561d0a08843396dc0d4",
      "candidate_info": {
        "commit_hash": "2bae31327f77df0510542561d0a08843396dc0d4",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/2bae31327f77df0510542561d0a08843396dc0d4",
        "files": [
          "tensorflow/core/kernels/conv_grad_ops_3d.cc",
          "tensorflow/python/kernel_tests/nn_ops/conv3d_transpose_test.py"
        ],
        "message": "Fix nn.conv3d_transpose security vulnerability with illegal input shape\n\nPiperOrigin-RevId: 487000656",
        "before_after_code_files": [
          "tensorflow/core/kernels/conv_grad_ops_3d.cc||tensorflow/core/kernels/conv_grad_ops_3d.cc",
          "tensorflow/python/kernel_tests/nn_ops/conv3d_transpose_test.py||tensorflow/python/kernel_tests/nn_ops/conv3d_transpose_test.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/core/kernels/conv_grad_ops_3d.cc||tensorflow/core/kernels/conv_grad_ops_3d.cc",
            "tensorflow/python/kernel_tests/nn_ops/conv3d_transpose_test.py||tensorflow/python/kernel_tests/nn_ops/conv3d_transpose_test.py"
          ],
          "candidate": [
            "tensorflow/core/kernels/conv_grad_ops_3d.cc||tensorflow/core/kernels/conv_grad_ops_3d.cc",
            "tensorflow/python/kernel_tests/nn_ops/conv3d_transpose_test.py||tensorflow/python/kernel_tests/nn_ops/conv3d_transpose_test.py"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/core/kernels/conv_grad_ops_3d.cc||tensorflow/core/kernels/conv_grad_ops_3d.cc": [
          "File: tensorflow/core/kernels/conv_grad_ops_3d.cc -> tensorflow/core/kernels/conv_grad_ops_3d.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "1322:     Tensor* in_backprop;",
          "1323:     OP_REQUIRES_OK(context,",
          "1324:                    context->allocate_output(0, input_shape, &in_backprop));",
          "1326:     auto* stream = context->op_device_context()->stream();",
          "1327:     OP_REQUIRES(context, stream, errors::Internal(\"No GPU stream available.\"));",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1325:     for (std::size_t i = 0; i < input_shape.dims(); ++i) {",
          "1326:       if (input_shape.dim_size(i) == 0) {",
          "1327:         return;",
          "1328:       }",
          "1329:     }",
          "",
          "---------------"
        ],
        "tensorflow/python/kernel_tests/nn_ops/conv3d_transpose_test.py||tensorflow/python/kernel_tests/nn_ops/conv3d_transpose_test.py": [
          "File: tensorflow/python/kernel_tests/nn_ops/conv3d_transpose_test.py -> tensorflow/python/kernel_tests/nn_ops/conv3d_transpose_test.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "126:     x_value = np.random.random_sample(x_shape).astype(np.float64)",
          "127:     f_value = np.random.random_sample(f_shape).astype(np.float64)",
          "128:     nn_ops.conv3d_transpose(",
          "131:   def testConv3DTransposeOutputShapeType(self):",
          "132:     # Test case for GitHub issue 18887",
          "",
          "[Removed Lines]",
          "129:         x_value, f_value, y_shape, strides, data_format='NCDHW')",
          "",
          "[Added Lines]",
          "129:         x_value, f_value, y_shape, strides, data_format=\"NCDHW\")",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "218:     err_tolerance = 0.00055",
          "219:     self.assertLess(err, err_tolerance)",
          "222: if __name__ == \"__main__\":",
          "223:   test.main()",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "221:   def testConv3DTransposeZeroShapeDoNotRaiseError(self):",
          "222:     with self.cached_session():",
          "223:       x_value = np.zeros([10, 0, 2, 3, 3])",
          "224:       f_value = np.ones((3, 3, 3, 3, 3))",
          "225:       y_shape = np.stack([10, 0, 2, 3, 3])",
          "226:       output = nn_ops.conv3d_transpose(",
          "227:           x_value,",
          "228:           f_value,",
          "229:           y_shape,",
          "230:           strides=(1, 1, 1),",
          "231:           data_format=\"NDHWC\",",
          "232:           padding=\"SAME\",",
          "233:       )",
          "234:       _ = self.evaluate(output)",
          "",
          "---------------"
        ]
      }
    }
  ]
}