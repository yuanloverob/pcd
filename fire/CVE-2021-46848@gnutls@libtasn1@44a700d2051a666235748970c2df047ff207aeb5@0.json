{
  "cve_id": "CVE-2021-46848",
  "cve_desc": "GNU Libtasn1 before 4.19.0 has an ETYPE_OK off-by-one array size check that affects asn1_encode_simple_der.",
  "repo": "gnutls/libtasn1",
  "patch_hash": "44a700d2051a666235748970c2df047ff207aeb5",
  "patch_info": {
    "commit_hash": "44a700d2051a666235748970c2df047ff207aeb5",
    "repo": "gnutls/libtasn1",
    "commit_url": "https://gitlab.com/gnutls/libtasn1/-/commit/44a700d2051a666235748970c2df047ff207aeb5",
    "files": [
      "NEWS",
      "lib/int.h"
    ],
    "message": "Fix ETYPE_OK off by one array size check.  Closes: #32.\n\nReported by David Trabish in\n<https://gitlab.com/gnutls/libtasn1/-/issues/32>.\n\nSigned-off-by: Simon Josefsson <simon@josefsson.org>",
    "before_after_code_files": [
      "lib/int.h||lib/int.h"
    ]
  },
  "patch_diff": {
    "lib/int.h||lib/int.h": [
      "File: lib/int.h -> lib/int.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "97: # define ETYPE_TAG(etype) (_asn1_tags[etype].tag)",
      "98: # define ETYPE_CLASS(etype) (_asn1_tags[etype].class)",
      "99: # define ETYPE_OK(etype) (((etype) != ASN1_ETYPE_INVALID && \\",
      "101:                           _asn1_tags[(etype)].desc != NULL)?1:0)",
      "103: # define ETYPE_IS_STRING(etype) ((etype == ASN1_ETYPE_GENERALSTRING || \\",
      "",
      "[Removed Lines]",
      "100:                           (etype) <= _asn1_tags_size && \\",
      "",
      "[Added Lines]",
      "100:                           (etype) < _asn1_tags_size && \\",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "65334852e9bcf3fb18a5708ce16fab7a58a2dcfd",
      "candidate_info": {
        "commit_hash": "65334852e9bcf3fb18a5708ce16fab7a58a2dcfd",
        "repo": "gnutls/libtasn1",
        "commit_url": "https://github.com/gnutls/libtasn1/commit/65334852e9bcf3fb18a5708ce16fab7a58a2dcfd",
        "files": [
          "tests/Test_simple.c"
        ],
        "message": "Add self-check for #32 to see if cicd catches it.\n\nSigned-off-by: Simon Josefsson <simon@josefsson.org>",
        "before_after_code_files": [
          "tests/Test_simple.c||tests/Test_simple.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_issue": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "tests/Test_simple.c||tests/Test_simple.c": [
          "File: tests/Test_simple.c -> tests/Test_simple.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "87:   int ret_len, bit_len;",
          "88:   size_t i;",
          "92:   asn1_bit_der (NULL, 0, der, &der_len);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "90:   {",
          "91:     unsigned int etype = 38;",
          "92:     unsigned int my_str_len = 10;",
          "93:     unsigned char my_str[10];",
          "94:     unsigned int tl_len = 10;",
          "95:     unsigned char tl[10];",
          "98:     result = asn1_encode_simple_der (etype, my_str, my_str_len, tl, &tl_len);",
          "99:     if (result != ASN1_VALUE_NOT_VALID)",
          "100:       {",
          "101:  fprintf (stderr, \"asn1_encode_simple_der out of range etype\\n\");",
          "102:  return 1;",
          "103:       }",
          "104:   }",
          "",
          "---------------"
        ]
      }
    }
  ]
}