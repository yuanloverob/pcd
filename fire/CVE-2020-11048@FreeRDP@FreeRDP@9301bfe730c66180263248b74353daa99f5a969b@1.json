{
  "cve_id": "CVE-2020-11048",
  "cve_desc": "In FreeRDP after 1.0 and before 2.0.0, there is an out-of-bounds read. It only allows to abort a session. No data extraction is possible. This has been fixed in 2.0.0.",
  "repo": "FreeRDP/FreeRDP",
  "patch_hash": "9301bfe730c66180263248b74353daa99f5a969b",
  "patch_info": {
    "commit_hash": "9301bfe730c66180263248b74353daa99f5a969b",
    "repo": "FreeRDP/FreeRDP",
    "commit_url": "https://github.com/FreeRDP/FreeRDP/commit/9301bfe730c66180263248b74353daa99f5a969b",
    "files": [
      "libfreerdp/core/rdp.c"
    ],
    "message": "Fixed #6007: Boundary checks in rdp_read_flow_control_pdu",
    "before_after_code_files": [
      "libfreerdp/core/rdp.c||libfreerdp/core/rdp.c"
    ]
  },
  "patch_diff": {
    "libfreerdp/core/rdp.c||libfreerdp/core/rdp.c": [
      "File: libfreerdp/core/rdp.c -> libfreerdp/core/rdp.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "103: };",
      "106: static void rdp_write_share_control_header(wStream* s, UINT16 length, UINT16 type,",
      "107:                                            UINT16 channel_id);",
      "108: static void rdp_write_share_data_header(wStream* s, UINT16 length, BYTE type, UINT32 share_id);",
      "",
      "[Removed Lines]",
      "105: static void rdp_read_flow_control_pdu(wStream* s, UINT16* type);",
      "",
      "[Added Lines]",
      "105: static BOOL rdp_read_flow_control_pdu(wStream* s, UINT16* type);",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "146: BOOL rdp_read_share_control_header(wStream* s, UINT16* length, UINT16* type, UINT16* channel_id)",
      "147: {",
      "148:  if (Stream_GetRemainingLength(s) < 2)",
      "149:   return FALSE;",
      "157:  {",
      "161:   return TRUE;",
      "162:  }",
      "165:   return FALSE;",
      "172:  else",
      "",
      "[Removed Lines]",
      "156:  if (*length == 0x8000)",
      "158:   rdp_read_flow_control_pdu(s, type);",
      "164:  if (((size_t)*length - 2) > Stream_GetRemainingLength(s))",
      "170:  if (*length > 4)",
      "",
      "[Added Lines]",
      "148:  UINT16 len;",
      "159:  if (len == 0x8000)",
      "161:   if (!rdp_read_flow_control_pdu(s, type))",
      "162:    return FALSE;",
      "168:  if ((len < 4) || ((len - 2) > Stream_GetRemainingLength(s)))",
      "174:  if (len > 4)",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "1116:  }",
      "1117: }",
      "1120: {",
      "",
      "[Removed Lines]",
      "1119: void rdp_read_flow_control_pdu(wStream* s, UINT16* type)",
      "",
      "[Added Lines]",
      "1123: BOOL rdp_read_flow_control_pdu(wStream* s, UINT16* type)",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "1128:  UINT8 pduType;",
      "1135: }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1133:  if (!type)",
      "1134:   return FALSE;",
      "1135:  if (Stream_GetRemainingLength(s) < 6)",
      "1136:   return FALSE;",
      "1143:  return TRUE;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "2a379bfe0949dd7be5c407e8524ff3f721613419",
      "candidate_info": {
        "commit_hash": "2a379bfe0949dd7be5c407e8524ff3f721613419",
        "repo": "FreeRDP/FreeRDP",
        "commit_url": "https://github.com/FreeRDP/FreeRDP/commit/2a379bfe0949dd7be5c407e8524ff3f721613419",
        "files": [
          "libfreerdp/core/rdp.c"
        ],
        "message": "Fixed invalid seek size in patrial pdu parse case",
        "before_after_code_files": [
          "libfreerdp/core/rdp.c||libfreerdp/core/rdp.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/FreeRDP/FreeRDP/pull/6019"
        ],
        "olp_code_files": {
          "patch": [
            "libfreerdp/core/rdp.c||libfreerdp/core/rdp.c"
          ],
          "candidate": [
            "libfreerdp/core/rdp.c||libfreerdp/core/rdp.c"
          ]
        }
      },
      "candidate_diff": {
        "libfreerdp/core/rdp.c||libfreerdp/core/rdp.c": [
          "File: libfreerdp/core/rdp.c -> libfreerdp/core/rdp.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1393:               \"pduType %s not properly parsed, %\" PRIdz",
          "1394:               \" bytes remaining unhandled. Skipping.\",",
          "1395:               pdu_type_to_str(pduType), diff);",
          "1397:      return -1;",
          "1398:    }",
          "1399:   }",
          "",
          "[Removed Lines]",
          "1396:     if (!Stream_SafeSeek(s, pduLength))",
          "",
          "[Added Lines]",
          "1396:     if (!Stream_SafeSeek(s, pduLength - diff))",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "6b2bc41935e53b0034fe5948aeeab4f32e80f30f",
      "candidate_info": {
        "commit_hash": "6b2bc41935e53b0034fe5948aeeab4f32e80f30f",
        "repo": "FreeRDP/FreeRDP",
        "commit_url": "https://github.com/FreeRDP/FreeRDP/commit/6b2bc41935e53b0034fe5948aeeab4f32e80f30f",
        "files": [
          "libfreerdp/core/window.c"
        ],
        "message": "Fix #6010: Check length in read_icon_info",
        "before_after_code_files": [
          "libfreerdp/core/window.c||libfreerdp/core/window.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/FreeRDP/FreeRDP/pull/6019"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "libfreerdp/core/window.c||libfreerdp/core/window.c": [
          "File: libfreerdp/core/window.c -> libfreerdp/core/window.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "143:  newBitMask = (BYTE*)realloc(iconInfo->bitsMask, iconInfo->cbBitsMask);",
          "",
          "[Removed Lines]",
          "139:  if (Stream_GetRemainingLength(s) < iconInfo->cbBitsMask + iconInfo->cbBitsColor)",
          "140:   return FALSE;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "150:  }",
          "152:  iconInfo->bitsMask = newBitMask;",
          "153:  Stream_Read(s, iconInfo->bitsMask, iconInfo->cbBitsMask);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "150:  if (Stream_GetRemainingLength(s) < iconInfo->cbBitsMask)",
          "151:   return FALSE;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "184:  }",
          "186:  if (iconInfo->colorTable)",
          "187:   Stream_Read(s, iconInfo->colorTable, iconInfo->cbColorTable);",
          "190:  newBitMask = (BYTE*)realloc(iconInfo->bitsColor, iconInfo->cbBitsColor);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "186:  {",
          "187:   if (Stream_GetRemainingLength(s) < iconInfo->cbColorTable)",
          "188:    return FALSE;",
          "190:  }",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "197:  }",
          "199:  iconInfo->bitsColor = newBitMask;",
          "200:  Stream_Read(s, iconInfo->bitsColor, iconInfo->cbBitsColor);",
          "201:  return TRUE;",
          "202: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "203:  if (Stream_GetRemainingLength(s) < iconInfo->cbBitsColor)",
          "204:   return FALSE;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "df55f40ecf5ef16909f60b86bef63e0268941821",
      "candidate_info": {
        "commit_hash": "df55f40ecf5ef16909f60b86bef63e0268941821",
        "repo": "FreeRDP/FreeRDP",
        "commit_url": "https://github.com/FreeRDP/FreeRDP/commit/df55f40ecf5ef16909f60b86bef63e0268941821",
        "files": [
          "libfreerdp/core/capabilities.c"
        ],
        "message": "Fixed incorrect parser error message.",
        "before_after_code_files": [
          "libfreerdp/core/capabilities.c||libfreerdp/core/capabilities.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/FreeRDP/FreeRDP/pull/6019"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "libfreerdp/core/capabilities.c||libfreerdp/core/capabilities.c": [
          "File: libfreerdp/core/capabilities.c -> libfreerdp/core/capabilities.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "3811:    WLog_ERR(TAG,",
          "3812:             \"incorrect offset, type:0x%04\" PRIX16 \" actual:%\" PRIuz \" expected:%\" PRIu16",
          "3813:             \"\",",
          "3815:   }",
          "3817:   numberCapabilities--;",
          "",
          "[Removed Lines]",
          "3814:             type, rest + length, length);",
          "",
          "[Added Lines]",
          "3814:             type, length - rest, length);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "3627aaf7d289315b614a584afb388f04abfb5bbf",
      "candidate_info": {
        "commit_hash": "3627aaf7d289315b614a584afb388f04abfb5bbf",
        "repo": "FreeRDP/FreeRDP",
        "commit_url": "https://github.com/FreeRDP/FreeRDP/commit/3627aaf7d289315b614a584afb388f04abfb5bbf",
        "files": [
          "libfreerdp/core/capabilities.c"
        ],
        "message": "Fixed #6011: Bounds check in rdp_read_font_capability_set",
        "before_after_code_files": [
          "libfreerdp/core/capabilities.c||libfreerdp/core/capabilities.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/FreeRDP/FreeRDP/pull/6019"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "libfreerdp/core/capabilities.c||libfreerdp/core/capabilities.c": [
          "File: libfreerdp/core/capabilities.c -> libfreerdp/core/capabilities.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1397: static BOOL rdp_read_font_capability_set(wStream* s, UINT16 length, rdpSettings* settings)",
          "1398: {",
          "1399:  WINPR_UNUSED(settings);",
          "1406:  return TRUE;",
          "",
          "[Removed Lines]",
          "1400:  if (length > 4)",
          "1403:  if (length > 6)",
          "",
          "[Added Lines]",
          "1400:  if (length > 5)",
          "1403:  if (length > 7)",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "67c2aa52b2ae0341d469071d1bc8aab91f8d2ed8",
      "candidate_info": {
        "commit_hash": "67c2aa52b2ae0341d469071d1bc8aab91f8d2ed8",
        "repo": "FreeRDP/FreeRDP",
        "commit_url": "https://github.com/FreeRDP/FreeRDP/commit/67c2aa52b2ae0341d469071d1bc8aab91f8d2ed8",
        "files": [
          "libfreerdp/core/orders.c"
        ],
        "message": "Fixed #6013: Check new length is > 0",
        "before_after_code_files": [
          "libfreerdp/core/orders.c||libfreerdp/core/orders.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/FreeRDP/FreeRDP/pull/6019"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "libfreerdp/core/orders.c||libfreerdp/core/orders.c": [
          "File: libfreerdp/core/orders.c -> libfreerdp/core/orders.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2165:   goto fail;",
          "2167:  new_data = (BYTE*)realloc(bitmapData->data, new_len);",
          "",
          "[Removed Lines]",
          "2164:  if (Stream_GetRemainingLength(s) < new_len)",
          "",
          "[Added Lines]",
          "2164:  if ((new_len == 0) || (Stream_GetRemainingLength(s) < new_len))",
          "",
          "---------------"
        ]
      }
    }
  ]
}