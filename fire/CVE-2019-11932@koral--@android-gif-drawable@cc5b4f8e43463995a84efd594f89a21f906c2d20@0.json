{
  "cve_id": "CVE-2019-11932",
  "cve_desc": "A double free vulnerability in the DDGifSlurp function in decoding.c in the android-gif-drawable library before version 1.2.18, as used in WhatsApp for Android before version 2.19.244 and many other Android applications, allows remote attackers to execute arbitrary code or cause a denial of service when the library is used to parse a specially crafted GIF image.",
  "repo": "koral--/android-gif-drawable",
  "patch_hash": "cc5b4f8e43463995a84efd594f89a21f906c2d20",
  "patch_info": {
    "commit_hash": "cc5b4f8e43463995a84efd594f89a21f906c2d20",
    "repo": "koral--/android-gif-drawable",
    "commit_url": "https://github.com/koral--/android-gif-drawable/commit/cc5b4f8e43463995a84efd594f89a21f906c2d20",
    "files": [
      "android-gif-drawable/src/main/c/decoding.c"
    ],
    "message": "Do not realloc array if new raster size is 0.\n\nif realloc() is called with 0 size it may return NULL and this will be incorrectly handled\nas not enough memory and (also) rasterBits will be freed by realloc but we will not update\nit.",
    "before_after_code_files": [
      "android-gif-drawable/src/main/c/decoding.c||android-gif-drawable/src/main/c/decoding.c"
    ]
  },
  "patch_diff": {
    "android-gif-drawable/src/main/c/decoding.c||android-gif-drawable/src/main/c/decoding.c": [
      "File: android-gif-drawable/src/main/c/decoding.c -> android-gif-drawable/src/main/c/decoding.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "56:     }",
      "58:     if (decode) {",
      "61:      const uint_fast32_t newRasterSize = gifFilePtr->Image.Width * gifFilePtr->Image.Height;",
      "62:      if (newRasterSize > info->rasterSize || widthOverflow > 0 || heightOverflow > 0) {",
      "63:       void *tmpRasterBits = reallocarray(info->rasterBits, newRasterSize, sizeof(GifPixelType));",
      "64:       if (tmpRasterBits == NULL) {",
      "",
      "[Removed Lines]",
      "59:      int_fast32_t widthOverflow = gifFilePtr->Image.Width - info->originalWidth;",
      "60:      int_fast32_t heightOverflow = gifFilePtr->Image.Height - info->originalHeight;",
      "",
      "[Added Lines]",
      "60:      if (newRasterSize == 0) {",
      "61:       free(info->rasterBits);",
      "62:       info->rasterBits = NULL;",
      "63:       info->rasterSize = newRasterSize;",
      "64:       return;",
      "65:      }",
      "66:      const int_fast32_t widthOverflow = gifFilePtr->Image.Width - info->originalWidth;",
      "67:      const int_fast32_t heightOverflow = gifFilePtr->Image.Height - info->originalHeight;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "8f7ddae058173bfd673728fc919cd7e4fcbc1694",
      "candidate_info": {
        "commit_hash": "8f7ddae058173bfd673728fc919cd7e4fcbc1694",
        "repo": "koral--/android-gif-drawable",
        "commit_url": "https://github.com/koral--/android-gif-drawable/commit/8f7ddae058173bfd673728fc919cd7e4fcbc1694",
        "files": [
          "CHANGELOG.md",
          "README.md",
          "android-gif-drawable/gradle.properties"
        ],
        "message": "Release 1.2.17 Update readme and changelog",
        "before_after_code_files": [
          "android-gif-drawable/gradle.properties||android-gif-drawable/gradle.properties"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/koral--/android-gif-drawable/pull/689"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "android-gif-drawable/gradle.properties||android-gif-drawable/gradle.properties": [
          "File: android-gif-drawable/gradle.properties -> android-gif-drawable/gradle.properties",
          "--- Hunk 1 ---",
          "[Context before]",
          "2: GROUP=pl.droidsonroids.gif",
          "4: POM_DESCRIPTION=Views and Drawable for displaying animated GIFs for Android",
          "",
          "[Removed Lines]",
          "1: VERSION_NAME=1.2.17-SNAPSHOT",
          "",
          "[Added Lines]",
          "1: VERSION_NAME=1.2.17",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "2753c4931ca0d2c8d0d917eb260e5a9c0402ebeb",
      "candidate_info": {
        "commit_hash": "2753c4931ca0d2c8d0d917eb260e5a9c0402ebeb",
        "repo": "koral--/android-gif-drawable",
        "commit_url": "https://github.com/koral--/android-gif-drawable/commit/2753c4931ca0d2c8d0d917eb260e5a9c0402ebeb",
        "files": [
          "android-gif-drawable/build.gradle"
        ],
        "message": "Use relocated ReLinker fixes #665",
        "before_after_code_files": [
          "android-gif-drawable/build.gradle||android-gif-drawable/build.gradle"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/koral--/android-gif-drawable/pull/689"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "android-gif-drawable/build.gradle||android-gif-drawable/build.gradle": [
          "File: android-gif-drawable/build.gradle -> android-gif-drawable/build.gradle",
          "--- Hunk 1 ---",
          "[Context before]",
          "63: }",
          "65: dependencies {",
          "67:     compileOnly \"androidx.annotation:annotation:$versions.androidxAnnotations\"",
          "68:     testCompileOnly \"androidx.annotation:annotation:$versions.androidxAnnotations\"",
          "69:     testImplementation \"junit:junit:$versions.junit\"",
          "",
          "[Removed Lines]",
          "66:     implementation \"pl.droidsonroids.relinker:relinker:$versions.relinker\"",
          "",
          "[Added Lines]",
          "66:     implementation \"pl.droidsonroids:relinker:$versions.relinker\"",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "bf9281ab07d1797c02e361de97be4f124b562f28",
      "candidate_info": {
        "commit_hash": "bf9281ab07d1797c02e361de97be4f124b562f28",
        "repo": "koral--/android-gif-drawable",
        "commit_url": "https://github.com/koral--/android-gif-drawable/commit/bf9281ab07d1797c02e361de97be4f124b562f28",
        "files": [
          "android-gif-drawable/build.gradle",
          "build.gradle",
          "gradle/wrapper/gradle-wrapper.jar",
          "gradle/wrapper/gradle-wrapper.properties",
          "gradlew",
          "gradlew.bat",
          "sample/build.gradle"
        ],
        "message": "Dependency versions bump",
        "before_after_code_files": [
          "android-gif-drawable/build.gradle||android-gif-drawable/build.gradle",
          "build.gradle||build.gradle",
          "gradle/wrapper/gradle-wrapper.properties||gradle/wrapper/gradle-wrapper.properties",
          "gradlew.bat||gradlew.bat",
          "sample/build.gradle||sample/build.gradle"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/koral--/android-gif-drawable/pull/689"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "android-gif-drawable/build.gradle||android-gif-drawable/build.gradle": [
          "File: android-gif-drawable/build.gradle -> android-gif-drawable/build.gradle",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: }",
          "5: apply plugin: 'com.android.library'",
          "7: apply from: 'gradle-mvn-push.gradle'",
          "9: version = VERSION_NAME",
          "",
          "[Removed Lines]",
          "6: apply plugin: 'jacoco-android'",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "64: }",
          "66: dependencies {",
          "69:  testImplementation 'junit:junit:4.12'",
          "74:  testImplementation 'org.khronos:opengl-api:gl1.1-android-2.1_r1'",
          "75:  androidTestImplementation 'junit:junit:4.12'",
          "76:  androidTestImplementation 'org.assertj:assertj-core:1.7.1'",
          "81:  androidTestImplementation \"androidx.test.ext:junit:$versions.androidXextJunit\"",
          "87: }",
          "89: def isDebugBuild() {",
          "",
          "[Removed Lines]",
          "67:  compileOnly \"androidx.annotation:annotation:$versions.androidX\"",
          "68:  testCompileOnly \"androidx.annotation:annotation:$versions.androidX\"",
          "70:  testImplementation 'org.mockito:mockito-core:2.23.0'",
          "71:  testImplementation 'org.robolectric:robolectric:3.8'",
          "72:  testImplementation 'org.assertj:assertj-core:3.11.1'",
          "73:  testImplementation 'net.jodah:concurrentunit:0.4.3'",
          "77:  androidTestImplementation 'com.squareup.okhttp3:mockwebserver:3.11.0'",
          "78:  androidTestCompileOnly \"androidx.annotation:annotation:$versions.androidX\"",
          "79:  androidTestImplementation \"androidx.test:rules:$versions.androidXtest\"",
          "80:  androidTestImplementation \"androidx.test:runner:$versions.androidXtest\"",
          "82: }",
          "84: jacocoAndroidUnitTestReport {",
          "85:  html.enabled true",
          "86:  xml.enabled true",
          "",
          "[Added Lines]",
          "66:  compileOnly \"androidx.annotation:annotation:$versions.androidxAnnotations\"",
          "67:  testCompileOnly \"androidx.annotation:annotation:$versions.androidxAnnotations\"",
          "69:  testImplementation 'org.mockito:mockito-core:2.25.1'",
          "70:  testImplementation 'org.robolectric:robolectric:4.2.1'",
          "71:  testImplementation 'org.assertj:assertj-core:3.12.1'",
          "72:  testImplementation 'net.jodah:concurrentunit:0.4.4'",
          "77:  androidTestImplementation 'com.squareup.okhttp3:mockwebserver:3.12.2'",
          "78:  androidTestImplementation \"androidx.test:rules:$versions.androidxTest\"",
          "79:  androidTestImplementation \"androidx.test:runner:$versions.androixTtest\"",
          "80:  androidTestCompileOnly \"androidx.annotation:annotation:$versions.androidxAnnotations\"",
          "",
          "---------------"
        ],
        "build.gradle||build.gradle": [
          "File: build.gradle -> build.gradle",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: buildscript {",
          "27: }",
          "29: subprojects {",
          "38: }",
          "",
          "[Removed Lines]",
          "2:  ext {",
          "3:   versions = [",
          "4:     compileSdk         : 28,",
          "5:     targetSdk          : 28,",
          "6:     minSdk             : 17,",
          "7:     androidX           : '1.0.0',",
          "8:     androidXtest       : '1.1.0',",
          "9:     coroutines         : '1.0.0',",
          "10:     leakCanary         : '1.6.1',",
          "11:     kotlin             : '1.3.0',",
          "12:     intellijAnnotations: '13.0',",
          "13:     material           : '1.0.0-rc01',",
          "14:     androidXextJunit   : '1.0.0'",
          "15:   ]",
          "16:  }",
          "17:  repositories {",
          "18:   google()",
          "19:   mavenCentral()",
          "20:   jcenter()",
          "21:  }",
          "22:  dependencies {",
          "23:   classpath 'com.android.tools.build:gradle:3.2.1'",
          "24:   classpath 'com.dicedmelon.gradle:jacoco-android:0.1.3'",
          "25:   classpath \"org.jetbrains.kotlin:kotlin-gradle-plugin:$versions.kotlin\"",
          "26:  }",
          "30:  tasks.withType(JavaCompile) {",
          "31:   options.compilerArgs << '-Xlint'",
          "32:  }",
          "33:  repositories {",
          "34:   google()",
          "35:   mavenCentral()",
          "36:   jcenter()",
          "37:  }",
          "",
          "[Added Lines]",
          "2:     ext {",
          "3:         versions = [",
          "4:                 compileSdk         : 28,",
          "5:                 targetSdk          : 28,",
          "6:                 minSdk             : 17,",
          "7:                 androidxAppcompat  : '1.0.2',",
          "8:                 androidxAnnotations: '1.0.0',",
          "9:                 androidxTest       : '1.1.0',",
          "10:                 coroutines         : '1.1.1',",
          "11:                 leakCanary         : '1.6.3',",
          "12:                 kotlin             : '1.3.21',",
          "13:                 intellijAnnotations: '13.0',",
          "14:                 material           : '1.0.0',",
          "15:                 androidXextJunit   : '1.0.0'",
          "16:         ]",
          "17:     }",
          "18:     repositories {",
          "19:         google()",
          "20:         mavenCentral()",
          "21:         jcenter()",
          "22:     }",
          "23:     dependencies {",
          "24:         classpath 'com.android.tools.build:gradle:3.3.2'",
          "25:         classpath \"org.jetbrains.kotlin:kotlin-gradle-plugin:$versions.kotlin\"",
          "26:     }",
          "30:     tasks.withType(JavaCompile) {",
          "31:         options.compilerArgs << '-Xlint'",
          "32:     }",
          "33:     repositories {",
          "34:         google()",
          "35:         mavenCentral()",
          "36:         jcenter()",
          "37:     }",
          "",
          "---------------"
        ],
        "gradle/wrapper/gradle-wrapper.properties||gradle/wrapper/gradle-wrapper.properties": [
          "File: gradle/wrapper/gradle-wrapper.properties -> gradle/wrapper/gradle-wrapper.properties",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: distributionBase=GRADLE_USER_HOME",
          "2: distributionPath=wrapper/dists",
          "4: zipStoreBase=GRADLE_USER_HOME",
          "5: zipStorePath=wrapper/dists",
          "",
          "[Removed Lines]",
          "3: distributionUrl=https\\://services.gradle.org/distributions/gradle-4.10.2-bin.zip",
          "",
          "[Added Lines]",
          "3: distributionUrl=https\\://services.gradle.org/distributions/gradle-5.3-bin.zip",
          "",
          "---------------"
        ],
        "gradlew.bat||gradlew.bat": [
          "File: gradlew.bat -> gradlew.bat",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: @if \"%DEBUG%\" == \"\" @echo off",
          "2: @rem ##########################################################################",
          "3: @rem",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: @rem",
          "2: @rem Copyright 2015 the original author or authors.",
          "3: @rem",
          "4: @rem Licensed under the Apache License, Version 2.0 (the \"License\");",
          "5: @rem you may not use this file except in compliance with the License.",
          "6: @rem You may obtain a copy of the License at",
          "7: @rem",
          "8: @rem      http://www.apache.org/licenses/LICENSE-2.0",
          "9: @rem",
          "10: @rem Unless required by applicable law or agreed to in writing, software",
          "11: @rem distributed under the License is distributed on an \"AS IS\" BASIS,",
          "12: @rem WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.",
          "13: @rem See the License for the specific language governing permissions and",
          "14: @rem limitations under the License.",
          "15: @rem",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "14: set APP_HOME=%DIRNAME%",
          "16: @rem Add default JVM options here. You can also use JAVA_OPTS and GRADLE_OPTS to pass JVM options to this script.",
          "19: @rem Find java.exe",
          "20: if defined JAVA_HOME goto findJavaFromJavaHome",
          "",
          "[Removed Lines]",
          "17: set DEFAULT_JVM_OPTS=",
          "",
          "[Added Lines]",
          "33: set DEFAULT_JVM_OPTS=\"-Xmx64m\" \"-Xms64m\"",
          "",
          "---------------"
        ],
        "sample/build.gradle||sample/build.gradle": [
          "File: sample/build.gradle -> sample/build.gradle",
          "--- Hunk 1 ---",
          "[Context before]",
          "42:     debugImplementation \"com.squareup.leakcanary:leakcanary-android:$versions.leakCanary\"",
          "43:     releaseImplementation \"com.squareup.leakcanary:leakcanary-android-no-op:$versions.leakCanary\"",
          "44:     implementation \"com.google.android.material:material:$versions.material\"",
          "46:  implementation \"org.jetbrains.kotlin:kotlin-stdlib-jdk7:$versions.kotlin\"",
          "47:     implementation \"org.jetbrains.kotlinx:kotlinx-coroutines-core:$versions.coroutines\"",
          "48:     implementation \"org.jetbrains.kotlinx:kotlinx-coroutines-android:$versions.coroutines\"",
          "",
          "[Removed Lines]",
          "45:     implementation \"androidx.appcompat:appcompat:$versions.androidX\"",
          "",
          "[Added Lines]",
          "45:     implementation \"androidx.appcompat:appcompat:$versions.androidxAppcompat\"",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "c38ec03d5df094dfad3892cb61b0fe59c3b8384b",
      "candidate_info": {
        "commit_hash": "c38ec03d5df094dfad3892cb61b0fe59c3b8384b",
        "repo": "koral--/android-gif-drawable",
        "commit_url": "https://github.com/koral--/android-gif-drawable/commit/c38ec03d5df094dfad3892cb61b0fe59c3b8384b",
        "files": [
          "android-gif-drawable/build.gradle"
        ],
        "message": "Add java compile options",
        "before_after_code_files": [
          "android-gif-drawable/build.gradle||android-gif-drawable/build.gradle"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/koral--/android-gif-drawable/pull/689"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "android-gif-drawable/build.gradle||android-gif-drawable/build.gradle": [
          "File: android-gif-drawable/build.gradle -> android-gif-drawable/build.gradle",
          "--- Hunk 1 ---",
          "[Context before]",
          "61:     testOptions {",
          "62:         unitTests.returnDefaultValues = true",
          "63:     }",
          "64: }",
          "66: dependencies {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "64:     compileOptions {",
          "65:         sourceCompatibility 1.8",
          "66:         targetCompatibility 1.8",
          "67:     }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "6a0573135c4a0e9f3d8cf7882f6d41c0ce70c413",
      "candidate_info": {
        "commit_hash": "6a0573135c4a0e9f3d8cf7882f6d41c0ce70c413",
        "repo": "koral--/android-gif-drawable",
        "commit_url": "https://github.com/koral--/android-gif-drawable/commit/6a0573135c4a0e9f3d8cf7882f6d41c0ce70c413",
        "files": [
          "gradle/wrapper/gradle-wrapper.properties"
        ],
        "message": "Gradle version bump",
        "before_after_code_files": [
          "gradle/wrapper/gradle-wrapper.properties||gradle/wrapper/gradle-wrapper.properties"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/koral--/android-gif-drawable/pull/689"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "gradle/wrapper/gradle-wrapper.properties||gradle/wrapper/gradle-wrapper.properties": [
          "File: gradle/wrapper/gradle-wrapper.properties -> gradle/wrapper/gradle-wrapper.properties",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: distributionBase=GRADLE_USER_HOME",
          "2: distributionPath=wrapper/dists",
          "4: zipStoreBase=GRADLE_USER_HOME",
          "5: zipStorePath=wrapper/dists",
          "",
          "[Removed Lines]",
          "3: distributionUrl=https\\://services.gradle.org/distributions/gradle-5.6-bin.zip",
          "",
          "[Added Lines]",
          "3: distributionUrl=https\\://services.gradle.org/distributions/gradle-5.6.1-bin.zip",
          "",
          "---------------"
        ]
      }
    }
  ]
}