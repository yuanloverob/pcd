{
  "cve_id": "CVE-2020-21048",
  "cve_desc": "An issue in the dither.c component of libsixel prior to v1.8.4 allows attackers to cause a denial of service (DOS) via a crafted PNG file.",
  "repo": "saitoha/libsixel",
  "patch_hash": "cb373ab6614c910407c5e5a93ab935144e62b037",
  "patch_info": {
    "commit_hash": "cb373ab6614c910407c5e5a93ab935144e62b037",
    "repo": "saitoha/libsixel",
    "commit_url": "https://github.com/saitoha/libsixel/commit/cb373ab6614c910407c5e5a93ab935144e62b037",
    "files": [
      "src/dither.c"
    ],
    "message": "Avoid illegal memory access problem with 1 color paletted png(#73), Thanks to HongxuChen.",
    "before_after_code_files": [
      "src/dither.c||src/dither.c"
    ]
  },
  "patch_diff": {
    "src/dither.c||src/dither.c": [
      "File: src/dither.c -> src/dither.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "284:         quality_mode = SIXEL_QUALITY_HIGHCOLOR;",
      "285:     } else {",
      "286:         if (ncolors > SIXEL_PALETTE_MAX) {",
      "287:             ncolors = 256;",
      "290:         }",
      "291:         quality_mode = SIXEL_QUALITY_LOW;",
      "292:     }",
      "",
      "[Removed Lines]",
      "288:         } else if (ncolors < 2) {",
      "289:             ncolors = 2;",
      "",
      "[Added Lines]",
      "287:             status = SIXEL_BAD_INPUT;",
      "289:         } else if (ncolors < 1) {",
      "290:             status = SIXEL_BAD_INPUT;",
      "291:             sixel_helper_set_additional_message(",
      "292:                 \"sixel_dither_new: palette colors must be more than 0\");",
      "293:             goto end;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "26ac06f3623279348f0dce2d191a9b6ca0c80226",
      "candidate_info": {
        "commit_hash": "26ac06f3623279348f0dce2d191a9b6ca0c80226",
        "repo": "saitoha/libsixel",
        "commit_url": "https://github.com/saitoha/libsixel/commit/26ac06f3623279348f0dce2d191a9b6ca0c80226",
        "files": [
          "src/loader.c"
        ],
        "message": "Handle libpng error message (#73), thanks to HongxuChen",
        "before_after_code_files": [
          "src/loader.c||src/loader.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_issue": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/loader.c||src/loader.c": [
          "File: src/loader.c -> src/loader.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "269: }",
          "272: static SIXELSTATUS",
          "273: load_png(unsigned char      /* out */ **result,",
          "274:          unsigned char      /* in */  *buffer,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "272: jmp_buf jump_buffer;",
          "275: static void",
          "276: png_error_callback(png_structp png_ptr, png_const_charp error_message)",
          "277: {",
          "278:     (void) png_ptr;",
          "280:     sixel_helper_set_additional_message(error_message);",
          "281:     longjmp(jump_buffer, (-1));",
          "282: }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "296:     int i;",
          "297:     int depth;",
          "300:     if (!png_ptr) {",
          "301:         sixel_helper_set_additional_message(",
          "302:             \"png_create_read_struct() failed.\");",
          "",
          "[Removed Lines]",
          "299:     png_ptr = png_create_read_struct(PNG_LIBPNG_VER_STRING, NULL, NULL, NULL);",
          "",
          "[Added Lines]",
          "312:     if (setjmp(jump_buffer) != 0) {",
          "313:       status = SIXEL_PNG_ERROR;",
          "314:       goto cleanup;",
          "315:     }",
          "317:     png_ptr = png_create_read_struct(",
          "318:         PNG_LIBPNG_VER_STRING, NULL, &png_error_callback, NULL);",
          "",
          "---------------"
        ]
      }
    }
  ]
}