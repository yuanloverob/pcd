{
  "cve_id": "CVE-2021-4156",
  "cve_desc": "An out-of-bounds read flaw was found in libsndfile's FLAC codec functionality. An attacker who is able to submit a specially crafted file (via tricking a user to open or otherwise) to an application linked with libsndfile and using the FLAC codec, could trigger an out-of-bounds read that would most likely cause a crash but could potentially leak memory information that could be used in further exploitation of other flaws.",
  "repo": "libsndfile/libsndfile",
  "patch_hash": "4c30646abf7834e406f7e2429c70bc254e18beab",
  "patch_info": {
    "commit_hash": "4c30646abf7834e406f7e2429c70bc254e18beab",
    "repo": "libsndfile/libsndfile",
    "commit_url": "https://github.com/libsndfile/libsndfile/pull/732/commits/4c30646abf7834e406f7e2429c70bc254e18beab",
    "files": [
      "src/flac.c"
    ],
    "message": "flac: Fix improper buffer reusing",
    "before_after_code_files": [
      "src/flac.c||src/flac.c"
    ]
  },
  "patch_diff": {
    "src/flac.c||src/flac.c": [
      "File: src/flac.c -> src/flac.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "62:  FLAC__StreamMetadata *metadata ;",
      "64:  const int32_t * const * wbuffer ;",
      "65:  int32_t * rbuffer [FLAC__MAX_CHANNELS] ;",
      "67:  int32_t* encbuffer ;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "65:  unsigned wbuffer_size ;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "188:   return 0 ;",
      "189:   } ;",
      "191:  if (frame->header.channels > FLAC__MAX_CHANNELS)",
      "192:   psf_log_printf (psf, \"Ooops : frame->header.channels (%d) > FLAC__MAX_BLOCK_SIZE (%d)\\n\", __func__, __LINE__, frame->header.channels, FLAC__MAX_CHANNELS) ;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "192:  if (frame->header.blocksize > pflac->wbuffer_size)",
      "193:  { psf_log_printf (psf, \"Ooops : frame->header.blocksize (%d) > pflac->wbuffer_size (%d)\\n\", __func__, __LINE__, frame->header.blocksize, pflac->wbuffer_size) ;",
      "194:   psf->error = SFE_INTERNAL ;",
      "195:   return 0 ;",
      "196:   } ;",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "393:  pflac->bufferpos = 0 ;",
      "395:  pflac->wbuffer = buffer ;",
      "397:  flac_buffer_copy (psf) ;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "403:  pflac->wbuffer_size = pflac->frame->header.blocksize ;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "ced91d7b971be6173b604154c39279ce90ad87cc",
      "candidate_info": {
        "commit_hash": "ced91d7b971be6173b604154c39279ce90ad87cc",
        "repo": "libsndfile/libsndfile",
        "commit_url": "https://github.com/libsndfile/libsndfile/commit/ced91d7b971be6173b604154c39279ce90ad87cc",
        "files": [
          "src/flac.c"
        ],
        "message": "flac: Fix improper buffer reusing (#732)",
        "before_after_code_files": [
          "src/flac.c||src/flac.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/libsndfile/libsndfile/pull/732"
        ],
        "olp_code_files": {
          "patch": [
            "src/flac.c||src/flac.c"
          ],
          "candidate": [
            "src/flac.c||src/flac.c"
          ]
        }
      },
      "candidate_diff": {
        "src/flac.c||src/flac.c": [
          "File: src/flac.c -> src/flac.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "949:  while (pflac->pos < pflac->len)",
          "950:  { if (FLAC__stream_decoder_process_single (pflac->fsd) == 0)",
          "951:    break ;",
          "952:   state = FLAC__stream_decoder_get_state (pflac->fsd) ;",
          "953:   if (state >= FLAC__STREAM_DECODER_END_OF_STREAM)",
          "954:   { psf_log_printf (psf, \"FLAC__stream_decoder_get_state returned %s\\n\", FLAC__StreamDecoderStateString [state]) ;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "951:   { psf_log_printf (psf, \"FLAC__stream_decoder_process_single returned false\\n\") ;",
          "953:    pflac->frame = NULL ;",
          "955:    } ;",
          "",
          "---------------"
        ]
      }
    }
  ]
}