{
  "cve_id": "CVE-2019-13012",
  "cve_desc": "The keyfile settings backend in GNOME GLib (aka glib2.0) before 2.60.0 creates directories using g_file_make_directory_with_parents (kfsb->dir, NULL, NULL) and files using g_file_replace_contents (kfsb->file, contents, length, NULL, FALSE, G_FILE_CREATE_REPLACE_DESTINATION, NULL, NULL, NULL). Consequently, it does not properly restrict directory (and file) permissions. Instead, for directories, 0777 permissions are used; for files, default file permissions are used. This is similar to CVE-2019-12450.",
  "repo": "GNOME/glib",
  "patch_hash": "5e4da714f00f6bfb2ccd6d73d61329c6f3a08429",
  "patch_info": {
    "commit_hash": "5e4da714f00f6bfb2ccd6d73d61329c6f3a08429",
    "repo": "GNOME/glib",
    "commit_url": "https://gitlab.gnome.org/GNOME/glib/commit/5e4da714f00f6bfb2ccd6d73d61329c6f3a08429",
    "files": [
      "gio/gkeyfilesettingsbackend.c"
    ],
    "message": "keyfile settings: Use tighter permissions\n\nWhen creating directories, create them with 700 permissions,\ninstead of 777.\n\nCloses: #1658",
    "before_after_code_files": [
      "gio/gkeyfilesettingsbackend.c||gio/gkeyfilesettingsbackend.c"
    ]
  },
  "patch_diff": {
    "gio/gkeyfilesettingsbackend.c||gio/gkeyfilesettingsbackend.c": [
      "File: gio/gkeyfilesettingsbackend.c -> gio/gkeyfilesettingsbackend.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "114:   contents = g_key_file_to_data (kfsb->keyfile, &length, NULL);",
      "115:   g_file_replace_contents (kfsb->file, contents, length, NULL, FALSE,",
      "117:                            NULL, NULL, NULL);",
      "119:   compute_checksum (kfsb->digest, contents, length);",
      "",
      "[Removed Lines]",
      "116:                            G_FILE_CREATE_REPLACE_DESTINATION,",
      "",
      "[Added Lines]",
      "116:                            G_FILE_CREATE_REPLACE_DESTINATION |",
      "117:                            G_FILE_CREATE_PRIVATE,",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "708:   kfsb->permission = g_simple_permission_new (TRUE);",
      "710:   kfsb->dir = g_file_get_parent (kfsb->file);",
      "713:   kfsb->file_monitor = g_file_monitor (kfsb->file, G_FILE_MONITOR_NONE, NULL, NULL);",
      "714:   kfsb->dir_monitor = g_file_monitor (kfsb->dir, G_FILE_MONITOR_NONE, NULL, NULL);",
      "",
      "[Removed Lines]",
      "711:   g_file_make_directory_with_parents (kfsb->dir, NULL, NULL);",
      "",
      "[Added Lines]",
      "712:   g_mkdir_with_parents (g_file_peek_path (kfsb->dir), 0700);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "8d8083256b7bc5ecc9f084724517c6c26f164ab5",
      "candidate_info": {
        "commit_hash": "8d8083256b7bc5ecc9f084724517c6c26f164ab5",
        "repo": "GNOME/glib",
        "commit_url": "https://github.com/GNOME/glib/commit/8d8083256b7bc5ecc9f084724517c6c26f164ab5",
        "files": [
          "gio/gkeyfilesettingsbackend.c"
        ],
        "message": "keyfile settings: Use tighter permissions\n\nWhen creating directories, create them with 700 permissions,\ninstead of 777.\n\nCloses: #1658",
        "before_after_code_files": [
          "gio/gkeyfilesettingsbackend.c||gio/gkeyfilesettingsbackend.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "gio/gkeyfilesettingsbackend.c||gio/gkeyfilesettingsbackend.c"
          ],
          "candidate": [
            "gio/gkeyfilesettingsbackend.c||gio/gkeyfilesettingsbackend.c"
          ]
        }
      },
      "candidate_diff": {
        "gio/gkeyfilesettingsbackend.c||gio/gkeyfilesettingsbackend.c": [
          "File: gio/gkeyfilesettingsbackend.c -> gio/gkeyfilesettingsbackend.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "114:   contents = g_key_file_to_data (kfsb->keyfile, &length, NULL);",
          "115:   g_file_replace_contents (kfsb->file, contents, length, NULL, FALSE,",
          "117:                            NULL, NULL, NULL);",
          "119:   compute_checksum (kfsb->digest, contents, length);",
          "",
          "[Removed Lines]",
          "116:                            G_FILE_CREATE_REPLACE_DESTINATION,",
          "",
          "[Added Lines]",
          "116:                            G_FILE_CREATE_REPLACE_DESTINATION |",
          "117:                            G_FILE_CREATE_PRIVATE,",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "708:   kfsb->permission = g_simple_permission_new (TRUE);",
          "710:   kfsb->dir = g_file_get_parent (kfsb->file);",
          "713:   kfsb->file_monitor = g_file_monitor (kfsb->file, G_FILE_MONITOR_NONE, NULL, NULL);",
          "714:   kfsb->dir_monitor = g_file_monitor (kfsb->dir, G_FILE_MONITOR_NONE, NULL, NULL);",
          "",
          "[Removed Lines]",
          "711:   g_file_make_directory_with_parents (kfsb->dir, NULL, NULL);",
          "",
          "[Added Lines]",
          "712:   g_mkdir_with_parents (g_file_peek_path (kfsb->dir), 0700);",
          "",
          "---------------"
        ]
      }
    }
  ]
}