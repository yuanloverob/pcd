{
  "cve_id": "CVE-2023-27597",
  "cve_desc": "OpenSIPS is a Session Initiation Protocol (SIP) server implementation. Prior to versions 3.1.8 and 3.2.5, when a specially crafted SIP message is processed by the function `rewrite_ruri`, a crash occurs due to a segmentation fault. This issue causes the server to crash. It affects configurations containing functions that make use of the affected code, such as the function `setport`. This issue has been fixed in version 3.1.8 and 3.2.5.",
  "repo": "OpenSIPS/opensips",
  "patch_hash": "b2dffe4b5cd81182c9c8eabb6c96aac96c7acfe3",
  "patch_info": {
    "commit_hash": "b2dffe4b5cd81182c9c8eabb6c96aac96c7acfe3",
    "repo": "OpenSIPS/opensips",
    "commit_url": "https://github.com/OpenSIPS/opensips/commit/b2dffe4b5cd81182c9c8eabb6c96aac96c7acfe3",
    "files": [
      "parser/parse_uri.c"
    ],
    "message": "[core] fix parse_uri() parsing\n\nIssue discovered during OpenSIPS Security Audit 2022,\n\tby Alfred Farrugia & Sandro Gauci (Enable Security)\n\nhttps://github.com/OpenSIPS/opensips/security/advisories/GHSA-358f-935m-7p9c",
    "before_after_code_files": [
      "parser/parse_uri.c||parser/parse_uri.c"
    ]
  },
  "patch_diff": {
    "parser/parse_uri.c||parser/parse_uri.c": [
      "File: parser/parse_uri.c -> parser/parse_uri.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1532:   case TELS_URI_T:",
      "1534:    uri->user=uri->host;",
      "1536:    uri->host.len=0;",
      "1537:    break;",
      "1538:   case SIP_URI_T:",
      "",
      "[Removed Lines]",
      "1535:    uri->host.s=\"\";",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "1543:   case URN_NENA_SERVICE_URI_T:",
      "1544:    uri->user.s=0;",
      "1545:    uri->user.len=0;",
      "1548:    break;",
      "1549:   case ERROR_URI_T:",
      "1550:    LM_ERR(\"unexpected error (BUG?)\\n\");",
      "",
      "[Removed Lines]",
      "1546:    uri->host.s=\"\";",
      "1547:    uri->host.len=0;",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "089daf6d35e126e0a83b71a17287961e91d6aa87",
      "candidate_info": {
        "commit_hash": "089daf6d35e126e0a83b71a17287961e91d6aa87",
        "repo": "OpenSIPS/opensips",
        "commit_url": "https://github.com/OpenSIPS/opensips/commit/089daf6d35e126e0a83b71a17287961e91d6aa87",
        "files": [
          "Makefile.defs",
          "packaging/debian/changelog",
          "packaging/freebsd/Makefile",
          "packaging/netbsd/Makefile",
          "packaging/openbsd/Makefile",
          "packaging/redhat_fedora/opensips.spec",
          "packaging/solaris/base-pkginfo",
          "packaging/solaris/berkeley-pkginfo",
          "packaging/solaris/carrierroute-pkginfo",
          "packaging/solaris/identity-pkginfo",
          "packaging/solaris/ldap-pkginfo",
          "packaging/solaris/mmgeoip-pkginfo",
          "packaging/solaris/mysql-pkginfo",
          "packaging/solaris/perl-pkginfo",
          "packaging/solaris/pgsql-pkginfo",
          "packaging/solaris/pkginfo",
          "packaging/solaris/regex-pkginfo",
          "packaging/solaris/snmp-pkginfo",
          "packaging/solaris/tls-pkginfo",
          "packaging/solaris/xmlrpc-pkginfo"
        ],
        "message": "Bump version to 3.2.6",
        "before_after_code_files": [
          "Makefile.defs||Makefile.defs",
          "packaging/redhat_fedora/opensips.spec||packaging/redhat_fedora/opensips.spec"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/naveenecosmob/opensips/pull/1",
          "https://github.com/naveenecosmob/opensips/pull/5"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "Makefile.defs||Makefile.defs": [
          "File: Makefile.defs -> Makefile.defs",
          "--- Hunk 1 ---",
          "[Context before]",
          "66: #version number",
          "67: VERSION_MAJOR = 3",
          "68: VERSION_MINOR = 2",
          "70: VERSION_BUILD =",
          "72: ifneq (,$(VERSION_BUILD))",
          "",
          "[Removed Lines]",
          "69: VERSION_SUBMINOR = 5",
          "",
          "[Added Lines]",
          "69: VERSION_SUBMINOR = 6",
          "",
          "---------------"
        ],
        "packaging/redhat_fedora/opensips.spec||packaging/redhat_fedora/opensips.spec": [
          "File: packaging/redhat_fedora/opensips.spec -> packaging/redhat_fedora/opensips.spec",
          "--- Hunk 1 ---",
          "[Context before]",
          "46: Summary:  Very fast and configurable SIP server",
          "47: Name:     opensips",
          "49: Release:  1%{?dist}",
          "50: License:  GPLv2+",
          "51: Group:    System Environment/Daemons",
          "",
          "[Removed Lines]",
          "48: Version:  3.2.5",
          "",
          "[Added Lines]",
          "48: Version:  3.2.6",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "c3de32c0618a22a6d05960da7dcf4b8927bba3a5",
      "candidate_info": {
        "commit_hash": "c3de32c0618a22a6d05960da7dcf4b8927bba3a5",
        "repo": "OpenSIPS/opensips",
        "commit_url": "https://github.com/OpenSIPS/opensips/commit/c3de32c0618a22a6d05960da7dcf4b8927bba3a5",
        "files": [
          "modules/dialog/dlg_handlers.c"
        ],
        "message": "[dialog] fix bad unref leading to dialog leaking\n\nWhen using the dlg_on_timeout to set a new timeout for the dialog, due to the timer related operations (re-inserting in the list), an extra ref cnt happens. If not unref'ed, the dialog will stay (as terminated) forever in memory.\n\nCloses #2788\n\n(cherry picked from commit 4062de45d0ccfe62bb4f9475f6320d2726349bab)",
        "before_after_code_files": [
          "modules/dialog/dlg_handlers.c||modules/dialog/dlg_handlers.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/naveenecosmob/opensips/pull/1",
          "https://github.com/naveenecosmob/opensips/pull/5"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "modules/dialog/dlg_handlers.c||modules/dialog/dlg_handlers.c": [
          "File: modules/dialog/dlg_handlers.c -> modules/dialog/dlg_handlers.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2322:   run_dlg_script_route( dlg, dlg->rt_on_timeout);",
          "2324:   if (tl->timeout) {",
          "2328:    if (dialog_repl_cluster && dlg->flags&DLG_FLAG_VP_CHANGED)",
          "2329:     replicate_dialog_updated(dlg);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2330:    unref_dlg(dlg, 1);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "6ecac89e5418b9a192519d1ed3cde000695079d1",
      "candidate_info": {
        "commit_hash": "6ecac89e5418b9a192519d1ed3cde000695079d1",
        "repo": "OpenSIPS/opensips",
        "commit_url": "https://github.com/OpenSIPS/opensips/commit/6ecac89e5418b9a192519d1ed3cde000695079d1",
        "files": [
          "modules/cachedb_redis/cachedb_redis.c",
          "modules/cachedb_redis/cachedb_redis_dbase.c",
          "modules/cachedb_redis/cachedb_redis_dbase.h",
          "modules/cachedb_redis/doc/cachedb_redis_admin.xml"
        ],
        "message": "cachedb_redis: Allow quoting strings in raw queries\n\nIn case the Redis raw query string arguments include whitespace (' ',\n\\t, \\r, \\n), script developers can now enclose them in single (') or\ndouble quotes (\"), and OpenSIPS will pass the correct string to Redis.\n\nFor example:\n    cache_raw_query(\"redis\", \"SET foo \\\"bar baz\\\"\", \"$avp(result)\");\n        or:\n    cache_raw_query(\"redis\", \"SET foo 'bar baz'\", \"$avp(result)\");\n\n... are now possible and equivalent.  Both of these will set the\n\"bar baz\" value, without the quotes.\n\nNEW module parameter in order to maintain backwards-compatibility with\nprevious code (default: 0):\n\n    modparam(\"cachedb_redis\", \"enable_query_arg_quoting\", 1)\n\nFixes #2036",
        "before_after_code_files": [
          "modules/cachedb_redis/cachedb_redis.c||modules/cachedb_redis/cachedb_redis.c",
          "modules/cachedb_redis/cachedb_redis_dbase.c||modules/cachedb_redis/cachedb_redis_dbase.c",
          "modules/cachedb_redis/cachedb_redis_dbase.h||modules/cachedb_redis/cachedb_redis_dbase.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/naveenecosmob/opensips/pull/1",
          "https://github.com/naveenecosmob/opensips/pull/5"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "modules/cachedb_redis/cachedb_redis.c||modules/cachedb_redis/cachedb_redis.c": [
          "File: modules/cachedb_redis/cachedb_redis.c -> modules/cachedb_redis/cachedb_redis.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "58:  { \"shutdown_on_error\",           INT_PARAM,                &shutdown_on_error     },",
          "59:  { \"cachedb_url\",                 STR_PARAM|USE_FUNC_PARAM, (void *)&set_connection},",
          "60:  { \"use_tls\",                     INT_PARAM,                &use_tls},",
          "61:  {0,0,0}",
          "62: };",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "61:  { \"enable_raw_query_quoting\",    INT_PARAM,                &enable_raw_query_quoting},",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "162:   return -1;",
          "163:  }",
          "165:  return 0;",
          "166: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "166:  redis_raw_query_send = enable_raw_query_quoting ?",
          "167:    redis_raw_query_send_new : redis_raw_query_send_old;",
          "",
          "---------------"
        ],
        "modules/cachedb_redis/cachedb_redis_dbase.c||modules/cachedb_redis/cachedb_redis_dbase.c": [
          "File: modules/cachedb_redis/cachedb_redis_dbase.c -> modules/cachedb_redis/cachedb_redis_dbase.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "40: int redis_connnection_tout = CACHEDB_REDIS_DEFAULT_TIMEOUT;",
          "41: int shutdown_on_error = 0;",
          "42: int use_tls = 0;",
          "44: struct tls_mgm_binds tls_api;",
          "46: redisContext *redis_get_ctx(char *ip, int port)",
          "47: {",
          "48:  struct timeval tv;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "43: int enable_raw_query_quoting;",
          "51: int (*redis_raw_query_send)(cachedb_con *connection, redisReply **reply,",
          "52:   cdb_raw_entry ***_, int __, int *___, str *attr);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "716:  return -1;",
          "717: }",
          "747: #define MAP_SET_MAX_FIELDS 128",
          "749:   cdb_raw_entry ***_, int __, int *___, str *attr)",
          "750: {",
          "751:  int i, argc = 0;",
          "",
          "[Removed Lines]",
          "721: int redis_raw_query_extract_key(str *attr,str *query_key)",
          "722: {",
          "723:  int len;",
          "724:  char *p,*q,*r;",
          "726:  if (!attr || attr->s == NULL || query_key == NULL)",
          "727:   return -1;",
          "729:  trim_len(len,p,*attr);",
          "730:  q = memchr(p,' ',len);",
          "731:  if (q == NULL) {",
          "732:   LM_ERR(\"Malformed Redis RAW query \\n\");",
          "733:   return -1;",
          "734:  }",
          "736:  query_key->s = q+1;",
          "737:  r = memchr(query_key->s,' ',len - (query_key->s - p));",
          "738:  if (r == NULL) {",
          "739:   query_key->len = (p+len) - query_key->s;",
          "740:  } else {",
          "741:   query_key->len = r-query_key->s;",
          "742:  }",
          "744:  return 0;",
          "745: }",
          "748: static int redis_raw_query_send(cachedb_con *connection, redisReply **reply,",
          "",
          "[Added Lines]",
          "728: int redis_raw_query_send_old(cachedb_con *connection, redisReply **reply,",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "794:   return -1;",
          "795:  }",
          "799:  key.s = (char *)argv[1];",
          "800:  key.len = argvlen[1];",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "779:  key.s = (char *)argv[1];",
          "780:  key.len = argvlen[1];",
          "782: #ifdef EXTRA_DEBUG",
          "783:  LM_DBG(\"raw query key: %.*s\\n\", key.len, key.s);",
          "784:  for (i = 0; i < argc; i++)",
          "785:   LM_DBG(\"raw query arg %d: '%.*s' (%d)\\n\", i, (int)argvlen[i], argv[i],",
          "786:          (int)argvlen[i]);",
          "787: #endif",
          "789:  node = get_redis_connection(con, &key);",
          "790:  if (node == NULL) {",
          "791:   LM_ERR(\"Bad cluster configuration\\n\");",
          "792:   return -10;",
          "793:  }",
          "795:  if (node->context == NULL) {",
          "796:   if (redis_reconnect_node(con,node) < 0) {",
          "797:    return -1;",
          "798:   }",
          "799:  }",
          "801:  for (i = QUERY_ATTEMPTS; i; i--) {",
          "803:   if (*reply == NULL || (*reply)->type == REDIS_REPLY_ERROR) {",
          "804:    LM_INFO(\"Redis query failed: %.*s\\n\",",
          "806:    if (*reply)",
          "807:     freeReplyObject(*reply);",
          "808:    if (node->context->err == REDIS_OK || redis_reconnect_node(con,node) < 0) {",
          "809:     i = 0; break;",
          "810:    }",
          "811:   } else break;",
          "812:  }",
          "814:  if (i==0) {",
          "815:   LM_ERR(\"giving up on query\\n\");",
          "816:   return -1;",
          "817:  }",
          "819:  if (i != QUERY_ATTEMPTS)",
          "820:   LM_INFO(\"successfully ran query after %d failed attempt(s)\\n\",",
          "821:           QUERY_ATTEMPTS - i);",
          "823:  return 0;",
          "824: }",
          "826: int redis_raw_query_send_new(cachedb_con *connection, redisReply **reply,",
          "827:   cdb_raw_entry ***_, int __, int *___, str *attr)",
          "828: {",
          "829:  int i, argc = 0, squoted = 0, dquoted = 0;",
          "830:  const char *argv[MAP_SET_MAX_FIELDS];",
          "831:  size_t argvlen[MAP_SET_MAX_FIELDS];",
          "832:  redis_con *con;",
          "833:  cluster_node *node;",
          "834:  str key, st;",
          "835:  char *p, *lim, *arg = NULL;",
          "837:  con = (redis_con *)connection->data;",
          "839:  if (!(con->flags & REDIS_INIT_NODES) && redis_connect(con) < 0) {",
          "840:   LM_ERR(\"failed to connect to DB\\n\");",
          "841:   return -9;",
          "842:  }",
          "844:  st = *attr;",
          "845:  trim(&st);",
          "850:  for (p = st.s, lim = p + st.len; p < lim; p++) {",
          "851:   if ((dquoted && *p != '\"') || (squoted && *p != '\\''))",
          "852:    continue;",
          "854:   if (argc == MAP_SET_MAX_FIELDS) {",
          "855:    LM_ERR(\"max raw query args exceeded (%d)\\n\", MAP_SET_MAX_FIELDS);",
          "856:    goto bad_query;",
          "857:   }",
          "859:   if (dquoted || squoted) {",
          "860:    if (p+1 < lim && !is_ws(*(p+1)))",
          "861:     goto bad_query;",
          "863:    argv[argc]++;",
          "864:    argvlen[argc] = p - argv[argc];",
          "865:    argc++;",
          "866:    dquoted = squoted = 0;",
          "867:   } else if (*p == '\"') {",
          "868:    dquoted = 1;",
          "869:    argv[argc] = p;",
          "870:   } else if (*p == '\\'') {",
          "871:    squoted = 1;",
          "872:    argv[argc] = p;",
          "873:   } else if (is_ws(*p)) {",
          "874:    if (!arg)",
          "875:     continue;",
          "877:    argv[argc] = arg;",
          "878:    argvlen[argc++] = p - arg;",
          "879:    arg = NULL;",
          "880:   } else if (!arg) {",
          "881:    arg = p;",
          "882:   }",
          "883:  }",
          "885:  if (squoted || dquoted) {",
          "886:   LM_ERR(\"unterminated quoted query argument\\n\");",
          "887:   goto bad_query;",
          "888:  }",
          "890:  if (arg) {",
          "891:   argv[argc] = arg;",
          "892:   argvlen[argc++] = st.s + st.len - arg;",
          "893:  }",
          "895:  if (argc < 2)",
          "896:   goto bad_query;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "841:           QUERY_ATTEMPTS - i);",
          "843:  return 0;",
          "844: }",
          "846: int redis_raw_query(cachedb_con *connection,str *attr,cdb_raw_entry ***rpl,int expected_kv_no,int *reply_no)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "946: bad_query:",
          "947:  LM_ERR(\"malformed Redis RAW query: '%.*s' (%d)\\n\",",
          "948:         attr->len, attr->s, attr->len);",
          "949:  return -1;",
          "",
          "---------------"
        ],
        "modules/cachedb_redis/cachedb_redis_dbase.h||modules/cachedb_redis/cachedb_redis_dbase.h": [
          "File: modules/cachedb_redis/cachedb_redis_dbase.h -> modules/cachedb_redis/cachedb_redis_dbase.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "55: extern int redis_connnection_tout;",
          "56: extern int shutdown_on_error;",
          "57: extern int use_tls;",
          "59: extern struct tls_mgm_binds tls_api;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "58: extern int enable_raw_query_quoting;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "84: int redis_get_counter(cachedb_con *connection,str *attr,int *val);",
          "85: int redis_raw_query(cachedb_con *connection,str *attr,cdb_raw_entry ***reply,int expected_kv_no,int *reply_no);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "88: extern int redis_raw_query_send_old(cachedb_con *connection, redisReply **reply,",
          "89:   cdb_raw_entry ***_, int __, int *___, str *attr);",
          "90: extern int redis_raw_query_send_new(cachedb_con *connection, redisReply **reply,",
          "91:   cdb_raw_entry ***_, int __, int *___, str *attr);",
          "92: extern int (*redis_raw_query_send)(cachedb_con *connection, redisReply **reply,",
          "93:   cdb_raw_entry ***_, int __, int *___, str *attr);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "9a47ad9bea05859a99ee0a408f77f778588591f4",
      "candidate_info": {
        "commit_hash": "9a47ad9bea05859a99ee0a408f77f778588591f4",
        "repo": "OpenSIPS/opensips",
        "commit_url": "https://github.com/OpenSIPS/opensips/commit/9a47ad9bea05859a99ee0a408f77f778588591f4",
        "files": [
          "modules/b2b_entities/dlg.c"
        ],
        "message": "b2b_entities: properly handle PRACK after dlg is matched\n\nOtherwise, simply relay the PRACK.\n\n(cherry picked from commit 8edf6ff627456c8cfa5c496e44c477e9ba8852a6)",
        "before_after_code_files": [
          "modules/b2b_entities/dlg.c||modules/b2b_entities/dlg.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/naveenecosmob/opensips/pull/1",
          "https://github.com/naveenecosmob/opensips/pull/5"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "modules/b2b_entities/dlg.c||modules/b2b_entities/dlg.c": [
          "File: modules/b2b_entities/dlg.c -> modules/b2b_entities/dlg.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "801:   }",
          "802:  }",
          "824: search_dialog:",
          "825:  if( msg->callid==NULL || msg->callid->body.s==NULL)",
          "826:  {",
          "",
          "[Removed Lines]",
          "804:  if(method_value == METHOD_PRACK)",
          "805:  {",
          "806:   LM_DBG(\"Received a PRACK - send 200 reply\\n\");",
          "807:   str reason={\"OK\", 2};",
          "809:   tmb.t_newtran( msg );",
          "810:   tm_tran = tmb.t_gett();",
          "813:   tmb.t_reply(msg, 200, &reason);",
          "814:   if(tm_tran && tm_tran!=T_UNDEFINED)",
          "815:    tmb.unref_cell(tm_tran);",
          "818:   if(req_routeid > 0)",
          "819:    run_top_route(sroutes->request[req_routeid], msg);",
          "821:   goto done;",
          "822:  }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "960:   }",
          "962:   {",
          "964:    {",
          "965:     LM_DBG(\"Not a b2b request\\n\");",
          "966:     return SCB_RUN_ALL;",
          "",
          "[Removed Lines]",
          "963:    if(method_value != METHOD_UPDATE)",
          "",
          "[Added Lines]",
          "943:    if(method_value != METHOD_UPDATE && method_value != METHOD_PRACK)",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "975:     if(dlg == NULL)",
          "976:     {",
          "977:      lock_release(&server_htable[hash_index].lock);",
          "979:      return SCB_RUN_ALL;",
          "980:     }",
          "981:    }",
          "",
          "[Removed Lines]",
          "978:      LM_DBG(\"No dialog found for cancel\\n\");",
          "",
          "[Added Lines]",
          "958:      LM_DBG(\"No dialog found for UPDATE/PRACK\\n\");",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1010:    return SCB_RUN_ALL;",
          "1011:   }",
          "1012:  }",
          "1014:  ctx = b2b_get_context();",
          "1015:  if (!ctx) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "993:  if (method_value == METHOD_PRACK)",
          "994:  {",
          "995:   lock_release(&table[hash_index].lock);",
          "996:   LM_DBG(\"Received a PRACK - send 200 reply\\n\");",
          "997:   str reason={\"OK\", 2};",
          "999:   tmb.t_newtran( msg );",
          "1000:   tm_tran = tmb.t_gett();",
          "1001:   if (dlg)",
          "1002:    b2b_run_tracer(dlg, msg, tm_tran);",
          "1003:   tmb.t_reply(msg, 200, &reason);",
          "1004:   if(tm_tran && tm_tran!=T_UNDEFINED)",
          "1005:    tmb.unref_cell(tm_tran);",
          "1008:   if(req_routeid > 0)",
          "1009:    run_top_route(sroutes->request[req_routeid], msg);",
          "1011:   goto done;",
          "1012:  }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "e8df85a64a3b8095cd95c0b2d9254de605b61384",
      "candidate_info": {
        "commit_hash": "e8df85a64a3b8095cd95c0b2d9254de605b61384",
        "repo": "OpenSIPS/opensips",
        "commit_url": "https://github.com/OpenSIPS/opensips/commit/e8df85a64a3b8095cd95c0b2d9254de605b61384",
        "files": [
          "modules/b2b_entities/dlg.c"
        ],
        "message": "b2b_entities: properly handle negative replies to reINVITEs\n\nDo not change the dialog state to terminated as a result of a sending a\nnegative reply to a reINVITE. This would have prevented the forwarding of\nfurther requests.\n\nThanks to David Escartin from Sonoc for reporting and testing the fix.",
        "before_after_code_files": [
          "modules/b2b_entities/dlg.c||modules/b2b_entities/dlg.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/naveenecosmob/opensips/pull/1",
          "https://github.com/naveenecosmob/opensips/pull/5"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "modules/b2b_entities/dlg.c||modules/b2b_entities/dlg.c": [
          "File: modules/b2b_entities/dlg.c -> modules/b2b_entities/dlg.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1632:   {",
          "1633:    if(code < 300)",
          "1634:     dlg->state = B2B_CONFIRMED;",
          "1636:     dlg->state= B2B_TERMINATED;",
          "1637:    UPDATE_DBFLAG(dlg);",
          "1638:   }",
          "",
          "[Removed Lines]",
          "1635:    else if (!dlg->uac_tran)",
          "",
          "[Added Lines]",
          "1635:    else if (!dlg->uac_tran && dlg->state != B2B_MODIFIED)",
          "",
          "---------------"
        ]
      }
    }
  ]
}