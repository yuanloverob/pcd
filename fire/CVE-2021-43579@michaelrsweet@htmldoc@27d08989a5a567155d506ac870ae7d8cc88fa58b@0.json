{
  "cve_id": "CVE-2021-43579",
  "cve_desc": "A stack-based buffer overflow in image_load_bmp() in HTMLDOC <= 1.9.13 results in remote code execution if the victim converts an HTML document linking to a crafted BMP file.",
  "repo": "michaelrsweet/htmldoc",
  "patch_hash": "27d08989a5a567155d506ac870ae7d8cc88fa58b",
  "patch_info": {
    "commit_hash": "27d08989a5a567155d506ac870ae7d8cc88fa58b",
    "repo": "michaelrsweet/htmldoc",
    "commit_url": "https://github.com/michaelrsweet/htmldoc/commit/27d08989a5a567155d506ac870ae7d8cc88fa58b",
    "files": [
      "CHANGES.md",
      "htmldoc/image.cxx"
    ],
    "message": "Fix potential BMP stack overflow (Issue #453)",
    "before_after_code_files": [
      "htmldoc/image.cxx||htmldoc/image.cxx"
    ]
  },
  "patch_diff": {
    "htmldoc/image.cxx||htmldoc/image.cxx": [
      "File: htmldoc/image.cxx -> htmldoc/image.cxx",
      "--- Hunk 1 ---",
      "[Context before]",
      "919:     return (-1);",
      "921:   if (info_size > 40)",
      "922:     for (info_size -= 40; info_size > 0; info_size --)",
      "923:       getc(fp);",
      "926:   if (colors_used == 0 && depth <= 8)",
      "927:     colors_used = 1 << depth;",
      "929:   fread(colormap, (size_t)colors_used, 4, fp);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "922:   {",
      "925:   }",
      "930:   else if (colors_used > 256)",
      "931:     return (-1);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "753c71bce6fd916458e31b30eb633a577731d8b8",
      "candidate_info": {
        "commit_hash": "753c71bce6fd916458e31b30eb633a577731d8b8",
        "repo": "michaelrsweet/htmldoc",
        "commit_url": "https://github.com/michaelrsweet/htmldoc/commit/753c71bce6fd916458e31b30eb633a577731d8b8",
        "files": [
          "CHANGES.md",
          "doc/1-intro.html",
          "doc/2-using.html",
          "doc/3-cmdref.html",
          "doc/4-htmlref.html",
          "htmldoc/image.cxx"
        ],
        "message": "Fix another potential stack overflow issue in the BMP image loader (Issue #456)\n\nDeprecate BMP support and document that it is going away in a future HTMLDOC\nrelease.",
        "before_after_code_files": [
          "htmldoc/image.cxx||htmldoc/image.cxx"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "htmldoc/image.cxx||htmldoc/image.cxx"
          ],
          "candidate": [
            "htmldoc/image.cxx||htmldoc/image.cxx"
          ]
        }
      },
      "candidate_diff": {
        "htmldoc/image.cxx||htmldoc/image.cxx": [
          "File: htmldoc/image.cxx -> htmldoc/image.cxx",
          "--- Hunk 1 ---",
          "[Context before]",
          "916:   colors_used      = (int)read_dword(fp);",
          "917:   read_dword(fp);",
          "920:     return (-1);",
          "922:   if (info_size > 40)",
          "",
          "[Removed Lines]",
          "919:   if (img->width <= 0 || img->width > 8192 || img->height <= 0 || img->height > 8192)",
          "",
          "[Added Lines]",
          "919:   if (img->width <= 0 || img->width > 8192 || img->height <= 0 || img->height > 8192 || info_size < 0)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "929:   if (colors_used == 0 && depth <= 8)",
          "930:     colors_used = 1 << depth;",
          "932:     return (-1);",
          "934:   fread(colormap, (size_t)colors_used, 4, fp);",
          "",
          "[Removed Lines]",
          "931:   else if (colors_used > 256)",
          "",
          "[Added Lines]",
          "931:   else if (colors_used < 0 || colors_used > 256)",
          "",
          "---------------"
        ]
      }
    }
  ]
}