{
  "cve_id": "CVE-2019-3570",
  "cve_desc": "Call to the scrypt_enc() function in HHVM can lead to heap corruption by using specifically crafted parameters (N, r and p). This happens if the parameters are configurable by an attacker for instance by providing the output of scrypt_enc() in a context where Hack/PHP code would attempt to verify it by re-running scrypt_enc() with the same parameters. This could result in information disclosure, memory being overwriten or crashes of the HHVM process. This issue affects versions 4.3.0, 4.4.0, 4.5.0, 4.6.0, 4.7.0, 4.8.0, versions 3.30.5 and below, and all versions in the 4.0, 4.1, and 4.2 series.",
  "repo": "facebook/hhvm",
  "patch_hash": "cc331e4349e91706a673e2a09f1f2ea5bbb33815",
  "patch_info": {
    "commit_hash": "cc331e4349e91706a673e2a09f1f2ea5bbb33815",
    "repo": "facebook/hhvm",
    "commit_url": "https://github.com/facebook/hhvm/commit/cc331e4349e91706a673e2a09f1f2ea5bbb33815",
    "files": [
      "hphp/runtime/ext/scrypt/config.cmake",
      "hphp/runtime/ext/scrypt/crypto/crypto_scrypt-nosse.cpp",
      "hphp/runtime/ext/scrypt/crypto/crypto_scrypt-sse.cpp",
      "hphp/runtime/ext/scrypt/crypto/crypto_scrypt.cpp",
      "hphp/runtime/ext/scrypt/crypto/memory.h",
      "hphp/runtime/ext/scrypt/crypto/sha256.cpp",
      "hphp/runtime/ext/scrypt/crypto/sha256.h"
    ],
    "message": "Replace copied scrypt implementation with call to libsodium\n\nSummary:\nlibsodium actually uses the same implementation; using libsodium means we don't\nneed to maintain a copy ourselves.\n\nKeep the `pickparams` implementation though, as that's not exposed in libsodium.\n\nWe should deprecate this extension, and strongly encourage directly using `ext_sodium` instead from Hack code; stored hashes from `ext_scrypt` can be verified like this:\n\n```\n$enc = scrypt_enc('foo', random_bytes(SODIUM_CRYPTO_PWHASH_SCRYPTSALSA208SHA256_SALTBYTES));\n\t\u200b\n\u200blist($_, $algo, $n, $r, $p, $salt, $out) = explode('$', $enc);\n\u200binvariant($algo === 's', 'did not get an scrypt result');\n\u200b$salt = base64_decode($salt);\n\u200b$out = base64_decode($out);\n\u200b\n\u200b$opslimit = (1 << $n) * $r * $p * 4;\n\u200b$memlimit = (1 << $n) * $r * 128;\n\u200b$sodium = sodium_crypto_pwhash_scryptsalsa208sha256(strlen($out), 'foo', $salt, $opslimit, $memlimit);\n\u200b\\var_dump($sodium === $out);\n```\n\nThis also makes the scrypt extension depend on libsodium; this is fine, libsodium's going to be a hard dependency for HHVM  anyway when the proxygen pin is next updated.\n\nReviewed By: alexeyt\n\nDifferential Revision: D15702142\n\nfbshipit-source-id: 2dcad7c6cb273d4ce4b3479ffa445841fa2d1107",
    "before_after_code_files": [
      "hphp/runtime/ext/scrypt/config.cmake||hphp/runtime/ext/scrypt/config.cmake",
      "hphp/runtime/ext/scrypt/crypto/crypto_scrypt-nosse.cpp||hphp/runtime/ext/scrypt/crypto/crypto_scrypt-nosse.cpp",
      "hphp/runtime/ext/scrypt/crypto/crypto_scrypt-sse.cpp||hphp/runtime/ext/scrypt/crypto/crypto_scrypt-sse.cpp",
      "hphp/runtime/ext/scrypt/crypto/memory.h||hphp/runtime/ext/scrypt/crypto/crypto_scrypt.cpp",
      "hphp/runtime/ext/scrypt/crypto/sha256.cpp||hphp/runtime/ext/scrypt/crypto/sha256.cpp",
      "hphp/runtime/ext/scrypt/crypto/sha256.h||hphp/runtime/ext/scrypt/crypto/sha256.h"
    ]
  },
  "patch_diff": {
    "hphp/runtime/ext/scrypt/config.cmake||hphp/runtime/ext/scrypt/config.cmake": [
      "File: hphp/runtime/ext/scrypt/config.cmake -> hphp/runtime/ext/scrypt/config.cmake",
      "--- Hunk 1 ---",
      "[Context before]",
      "2:   SOURCES",
      "3:     ext_scrypt.cpp",
      "7:     crypto/params.cpp",
      "8:   HEADERS",
      "9:     crypto/crypto_scrypt.h",
      "10:     crypto/params.h",
      "12:   SYSTEMLIB",
      "13:     ext_scrypt.php",
      "14: )",
      "",
      "[Removed Lines]",
      "1: HHVM_DEFINE_EXTENSION(\"scrypt\"",
      "4:     crypto/crypto_scrypt-sse.cpp",
      "5:     crypto/crypto_scrypt-nosse.cpp",
      "6:     crypto/sha256.cpp",
      "11:     crypto/sha256.h",
      "",
      "[Added Lines]",
      "1: HHVM_DEFINE_EXTENSION(\"scrypt\" IMPLICIT",
      "4:     crypto/crypto_scrypt.cpp",
      "11:   DEPENDS",
      "12:     \"libsodium 1.0.9\"",
      "",
      "---------------"
    ],
    "hphp/runtime/ext/scrypt/crypto/crypto_scrypt-nosse.cpp||hphp/runtime/ext/scrypt/crypto/crypto_scrypt-nosse.cpp": [
      "File: hphp/runtime/ext/scrypt/crypto/crypto_scrypt-nosse.cpp -> hphp/runtime/ext/scrypt/crypto/crypto_scrypt-nosse.cpp",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ],
    "hphp/runtime/ext/scrypt/crypto/crypto_scrypt-sse.cpp||hphp/runtime/ext/scrypt/crypto/crypto_scrypt-sse.cpp": [
      "File: hphp/runtime/ext/scrypt/crypto/crypto_scrypt-sse.cpp -> hphp/runtime/ext/scrypt/crypto/crypto_scrypt-sse.cpp",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ],
    "hphp/runtime/ext/scrypt/crypto/memory.h||hphp/runtime/ext/scrypt/crypto/crypto_scrypt.cpp": [
      "File: hphp/runtime/ext/scrypt/crypto/memory.h -> hphp/runtime/ext/scrypt/crypto/crypto_scrypt.cpp",
      "--- Hunk 1 ---",
      "[Context before]",
      "3:    | HipHop for PHP                                                       |",
      "4:    +----------------------------------------------------------------------+",
      "5:    | Copyright (c) 2010-present Facebook, Inc. (http://www.facebook.com)  |",
      "6:    +----------------------------------------------------------------------+",
      "7:    | This source file is subject to version 3.01 of the PHP license,      |",
      "8:    | that is bundled with this package in the file LICENSE, and is        |",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "6:    | Copyright (c) 1997-2010 The PHP Group                                |",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "14:    +----------------------------------------------------------------------+",
      "33: }",
      "",
      "[Removed Lines]",
      "17: #pragma once",
      "19: #include <folly/portability/Memory.h>",
      "21: namespace folly_ext {",
      "25: inline void* aligned_malloc(size_t size, size_t alignment) {",
      "26:   return folly::detail::aligned_malloc(size, alignment);",
      "27: }",
      "29: inline void aligned_free(void* ptr) {",
      "30:   folly::detail::aligned_free(ptr);",
      "31: }",
      "",
      "[Added Lines]",
      "18: #include \"hphp/runtime/ext/scrypt/crypto/crypto_scrypt.h\"",
      "20: #include <sodium.h>",
      "22: int crypto_scrypt(const uint8_t* password, size_t pwlen, const uint8_t* salt,",
      "23:                   size_t saltlen, uint64_t N, uint32_t r, uint32_t p,",
      "24:                   uint8_t* buf, size_t buflen) {",
      "25:   return crypto_pwhash_scryptsalsa208sha256_ll(password, pwlen, salt, saltlen,",
      "26:                                                N, r, p, buf, buflen);",
      "",
      "---------------"
    ],
    "hphp/runtime/ext/scrypt/crypto/sha256.cpp||hphp/runtime/ext/scrypt/crypto/sha256.cpp": [
      "File: hphp/runtime/ext/scrypt/crypto/sha256.cpp -> hphp/runtime/ext/scrypt/crypto/sha256.cpp",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ],
    "hphp/runtime/ext/scrypt/crypto/sha256.h||hphp/runtime/ext/scrypt/crypto/sha256.h": [
      "File: hphp/runtime/ext/scrypt/crypto/sha256.h -> hphp/runtime/ext/scrypt/crypto/sha256.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "ba55163980302cd5f377fc1e368fab3279f34c82",
      "candidate_info": {
        "commit_hash": "ba55163980302cd5f377fc1e368fab3279f34c82",
        "repo": "facebook/hhvm",
        "commit_url": "https://github.com/facebook/hhvm/commit/ba55163980302cd5f377fc1e368fab3279f34c82",
        "files": [
          "CMake/HHVMExtensionConfig.cmake",
          "CMake/HPHPFindLibs.cmake",
          "hphp/runtime/ext/scrypt/config.cmake",
          "hphp/runtime/ext/sodium/config.cmake",
          "hphp/vixl/a64/disasm-a64.cc",
          "patches/0001-CVE-2019-3552-potential-DoS-in-Thrift.patch",
          "patches/fizz-openssl-bio-h.patch",
          "patches/folly-network-socket-backport.patch",
          "patches/mcrouter-folly-dynamic-forward-decl.patch",
          "patches/thrift-byval-this.patch",
          "third-party"
        ],
        "message": "Update FB dependencies in third-party/ to v2019.06.10.00 (#8516)\n\nSummary:\nUpdate FB dependencies in third-party/ to v2019.06.10.00\n\nThis updates:\n- folly\n- mcrouter\n- proxygen\n- squangle\n- thrift\n- wangle\n- libzip\n\nThis adds:\n- fizz\n- fmt\n- librsocket-cpp\n- libsodium (system version used if available, bundled if not)\n\nIt also blacklists boost 1.71.0 due to a bug that breaks fizz; this bug\nis already fixed upsstream, but not yet released.\nPull Request resolved: https://github.com/facebook/hhvm/pull/8516\n\nReviewed By: alexeyt\n\nDifferential Revision: D15825097\n\nfbshipit-source-id: 26f671ea60e57e80028c1653a8aff6a4e73e0e83",
        "before_after_code_files": [
          "CMake/HHVMExtensionConfig.cmake||CMake/HHVMExtensionConfig.cmake",
          "CMake/HPHPFindLibs.cmake||CMake/HPHPFindLibs.cmake",
          "hphp/runtime/ext/scrypt/config.cmake||hphp/runtime/ext/scrypt/config.cmake",
          "hphp/runtime/ext/sodium/config.cmake||hphp/runtime/ext/sodium/config.cmake",
          "hphp/vixl/a64/disasm-a64.cc||hphp/vixl/a64/disasm-a64.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "hphp/runtime/ext/scrypt/config.cmake||hphp/runtime/ext/scrypt/config.cmake"
          ],
          "candidate": [
            "hphp/runtime/ext/scrypt/config.cmake||hphp/runtime/ext/scrypt/config.cmake"
          ]
        }
      },
      "candidate_diff": {
        "CMake/HHVMExtensionConfig.cmake||CMake/HHVMExtensionConfig.cmake": [
          "File: CMake/HHVMExtensionConfig.cmake -> CMake/HHVMExtensionConfig.cmake",
          "--- Hunk 1 ---",
          "[Context before]",
          "1000:       HHVM_EXTENSION_INTERNAL_ADD_INCLUDE_DIRS(${SNAPPY_INCLUDE_DIRS})",
          "1001:       HHVM_EXTENSION_INTERNAL_ADD_LINK_LIBRARIES(${SNAPPY_LIBRARIES})",
          "1002:     endif()",
          "1014:   elseif (${libraryName} STREQUAL \"vpx\")",
          "1015:     find_package(LibVpx ${requiredVersion})",
          "1016:     if (NOT LIBVPX_INCLUDE_DIRS OR NOT LIBVPX_LIBRARIES)",
          "",
          "[Removed Lines]",
          "1003:   elseif (${libraryName} STREQUAL \"sodium\")",
          "1004:     find_package(LibSodium ${requiredVersion})",
          "1005:     if (NOT LIBSODIUM_INCLUDE_DIRS OR NOT LIBSODIUM_LIBRARIES)",
          "1006:       HHVM_EXTENSION_INTERNAL_SET_FAILED_DEPENDENCY(${extensionID} ${dependencyName})",
          "1007:       return()",
          "1008:     endif()",
          "1010:     if (${addPaths})",
          "1011:       HHVM_EXTENSION_INTERNAL_ADD_INCLUDE_DIRS(${LIBSODIUM_INCLUDE_DIRS})",
          "1012:       HHVM_EXTENSION_INTERNAL_ADD_LINK_LIBRARIES(${LIBSODIUM_LIBRARIES})",
          "1013:     endif()",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "CMake/HPHPFindLibs.cmake||CMake/HPHPFindLibs.cmake": [
          "File: CMake/HPHPFindLibs.cmake -> CMake/HPHPFindLibs.cmake",
          "--- Hunk 1 ---",
          "[Context before]",
          "438:   add_dependencies(${target} boostMaybeBuild)",
          "439:   target_link_libraries(${target} boost)",
          "440:   target_link_libraries(${target} ${MYSQL_CLIENT_LIBS})",
          "441:   if (ENABLE_ASYNC_MYSQL)",
          "442:     target_link_libraries(${target} squangle)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "440:   add_dependencies(${target} libsodiumMaybeBuild)",
          "441:   target_link_libraries(${target} libsodium)",
          "",
          "---------------"
        ],
        "hphp/runtime/ext/scrypt/config.cmake||hphp/runtime/ext/scrypt/config.cmake": [
          "File: hphp/runtime/ext/scrypt/config.cmake -> hphp/runtime/ext/scrypt/config.cmake",
          "--- Hunk 1 ---",
          "[Context before]",
          "2:   SOURCES",
          "3:     ext_scrypt.cpp",
          "4:     crypto/crypto_scrypt.cpp",
          "",
          "[Removed Lines]",
          "1: HHVM_DEFINE_EXTENSION(\"scrypt\" IMPLICIT",
          "",
          "[Added Lines]",
          "1: HHVM_DEFINE_EXTENSION(\"scrypt\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "8:     crypto/params.h",
          "9:   SYSTEMLIB",
          "10:     ext_scrypt.php",
          "13: )",
          "",
          "[Removed Lines]",
          "11:   DEPENDS",
          "12:     \"libsodium 1.0.9\"",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "hphp/runtime/ext/sodium/config.cmake||hphp/runtime/ext/sodium/config.cmake": [
          "File: hphp/runtime/ext/sodium/config.cmake -> hphp/runtime/ext/sodium/config.cmake",
          "--- Hunk 1 ---",
          "[Context before]",
          "2:   SOURCES",
          "3:     ext_sodium.cpp",
          "4:   SYSTEMLIB",
          "5:     ext_sodium.php",
          "8: )",
          "",
          "[Removed Lines]",
          "1: HHVM_DEFINE_EXTENSION(\"sodium\" IMPLICIT",
          "6:   DEPENDS",
          "7:     \"libsodium 1.0.9\"",
          "",
          "[Added Lines]",
          "1: HHVM_DEFINE_EXTENSION(\"sodium\"",
          "",
          "---------------"
        ],
        "hphp/vixl/a64/disasm-a64.cc||hphp/vixl/a64/disasm-a64.cc": [
          "File: hphp/vixl/a64/disasm-a64.cc -> hphp/vixl/a64/disasm-a64.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "27: #include \"hphp/vixl/a64/disasm-a64.h\"",
          "28: #include \"hphp/util/text-color.h\"",
          "30: #include <folly/Format.h>",
          "32: namespace vixl {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "30: #include <ostream>",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "53de4b54671286ea374028170f866f24846ed2db",
      "candidate_info": {
        "commit_hash": "53de4b54671286ea374028170f866f24846ed2db",
        "repo": "facebook/hhvm",
        "commit_url": "https://github.com/facebook/hhvm/commit/53de4b54671286ea374028170f866f24846ed2db",
        "files": [
          "CMake/HHVMExtensionConfig.cmake",
          "CMake/HPHPFindLibs.cmake",
          "hphp/runtime/ext/scrypt/config.cmake",
          "hphp/runtime/ext/sodium/config.cmake",
          "hphp/vixl/a64/disasm-a64.cc",
          "patches/0001-CVE-2019-3552-potential-DoS-in-Thrift.patch",
          "patches/fizz-openssl-bio-h.patch",
          "patches/folly-network-socket-backport.patch",
          "patches/mcrouter-folly-dynamic-forward-decl.patch",
          "patches/thrift-byval-this.patch",
          "third-party"
        ],
        "message": "Revert D15825097: [hhvm][PR] Update FB dependencies in third-party/ to v2019.06.10.00\n\nDifferential Revision:\nD15825097\n\nOriginal commit changeset: 26f671ea60e5\n\nfbshipit-source-id: d4c28661ce746d6dd96c5ffefce90b39dbdf35a8",
        "before_after_code_files": [
          "CMake/HHVMExtensionConfig.cmake||CMake/HHVMExtensionConfig.cmake",
          "CMake/HPHPFindLibs.cmake||CMake/HPHPFindLibs.cmake",
          "hphp/runtime/ext/scrypt/config.cmake||hphp/runtime/ext/scrypt/config.cmake",
          "hphp/runtime/ext/sodium/config.cmake||hphp/runtime/ext/sodium/config.cmake",
          "hphp/vixl/a64/disasm-a64.cc||hphp/vixl/a64/disasm-a64.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "hphp/runtime/ext/scrypt/config.cmake||hphp/runtime/ext/scrypt/config.cmake"
          ],
          "candidate": [
            "hphp/runtime/ext/scrypt/config.cmake||hphp/runtime/ext/scrypt/config.cmake"
          ]
        }
      },
      "candidate_diff": {
        "CMake/HHVMExtensionConfig.cmake||CMake/HHVMExtensionConfig.cmake": [
          "File: CMake/HHVMExtensionConfig.cmake -> CMake/HHVMExtensionConfig.cmake",
          "--- Hunk 1 ---",
          "[Context before]",
          "1000:       HHVM_EXTENSION_INTERNAL_ADD_INCLUDE_DIRS(${SNAPPY_INCLUDE_DIRS})",
          "1001:       HHVM_EXTENSION_INTERNAL_ADD_LINK_LIBRARIES(${SNAPPY_LIBRARIES})",
          "1002:     endif()",
          "1003:   elseif (${libraryName} STREQUAL \"vpx\")",
          "1004:     find_package(LibVpx ${requiredVersion})",
          "1005:     if (NOT LIBVPX_INCLUDE_DIRS OR NOT LIBVPX_LIBRARIES)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1003:   elseif (${libraryName} STREQUAL \"sodium\")",
          "1004:     find_package(LibSodium ${requiredVersion})",
          "1005:     if (NOT LIBSODIUM_INCLUDE_DIRS OR NOT LIBSODIUM_LIBRARIES)",
          "1006:       HHVM_EXTENSION_INTERNAL_SET_FAILED_DEPENDENCY(${extensionID} ${dependencyName})",
          "1007:       return()",
          "1008:     endif()",
          "1010:     if (${addPaths})",
          "1011:       HHVM_EXTENSION_INTERNAL_ADD_INCLUDE_DIRS(${LIBSODIUM_INCLUDE_DIRS})",
          "1012:       HHVM_EXTENSION_INTERNAL_ADD_LINK_LIBRARIES(${LIBSODIUM_LIBRARIES})",
          "1013:     endif()",
          "",
          "---------------"
        ],
        "CMake/HPHPFindLibs.cmake||CMake/HPHPFindLibs.cmake": [
          "File: CMake/HPHPFindLibs.cmake -> CMake/HPHPFindLibs.cmake",
          "--- Hunk 1 ---",
          "[Context before]",
          "438:   add_dependencies(${target} boostMaybeBuild)",
          "439:   target_link_libraries(${target} boost)",
          "443:   target_link_libraries(${target} ${MYSQL_CLIENT_LIBS})",
          "444:   if (ENABLE_ASYNC_MYSQL)",
          "445:     target_link_libraries(${target} squangle)",
          "",
          "[Removed Lines]",
          "440:   add_dependencies(${target} libsodiumMaybeBuild)",
          "441:   target_link_libraries(${target} libsodium)",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "hphp/runtime/ext/scrypt/config.cmake||hphp/runtime/ext/scrypt/config.cmake": [
          "File: hphp/runtime/ext/scrypt/config.cmake -> hphp/runtime/ext/scrypt/config.cmake",
          "--- Hunk 1 ---",
          "[Context before]",
          "2:   SOURCES",
          "3:     ext_scrypt.cpp",
          "4:     crypto/crypto_scrypt.cpp",
          "",
          "[Removed Lines]",
          "1: HHVM_DEFINE_EXTENSION(\"scrypt\"",
          "",
          "[Added Lines]",
          "1: HHVM_DEFINE_EXTENSION(\"scrypt\" IMPLICIT",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "8:     crypto/params.h",
          "9:   SYSTEMLIB",
          "10:     ext_scrypt.php",
          "11: )",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "11:   DEPENDS",
          "12:     \"libsodium 1.0.9\"",
          "",
          "---------------"
        ],
        "hphp/runtime/ext/sodium/config.cmake||hphp/runtime/ext/sodium/config.cmake": [
          "File: hphp/runtime/ext/sodium/config.cmake -> hphp/runtime/ext/sodium/config.cmake",
          "--- Hunk 1 ---",
          "[Context before]",
          "2:   SOURCES",
          "3:     ext_sodium.cpp",
          "4:   SYSTEMLIB",
          "5:     ext_sodium.php",
          "6: )",
          "",
          "[Removed Lines]",
          "1: HHVM_DEFINE_EXTENSION(\"sodium\"",
          "",
          "[Added Lines]",
          "1: HHVM_DEFINE_EXTENSION(\"sodium\" IMPLICIT",
          "6:   DEPENDS",
          "7:     \"libsodium 1.0.9\"",
          "",
          "---------------"
        ],
        "hphp/vixl/a64/disasm-a64.cc||hphp/vixl/a64/disasm-a64.cc": [
          "File: hphp/vixl/a64/disasm-a64.cc -> hphp/vixl/a64/disasm-a64.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "27: #include \"hphp/vixl/a64/disasm-a64.h\"",
          "28: #include \"hphp/util/text-color.h\"",
          "31: #include <folly/Format.h>",
          "33: namespace vixl {",
          "",
          "[Removed Lines]",
          "30: #include <ostream>",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "4a0961da3a873bbcfdf5823f92273a6d2b0a4a95",
      "candidate_info": {
        "commit_hash": "4a0961da3a873bbcfdf5823f92273a6d2b0a4a95",
        "repo": "facebook/hhvm",
        "commit_url": "https://github.com/facebook/hhvm/commit/4a0961da3a873bbcfdf5823f92273a6d2b0a4a95",
        "files": [
          "CMake/HHVMExtensionConfig.cmake",
          "CMake/HPHPFindLibs.cmake",
          "hphp/runtime/ext/scrypt/config.cmake",
          "hphp/runtime/ext/sodium/config.cmake",
          "hphp/vixl/a64/disasm-a64.cc",
          "patches/0001-CVE-2019-3552-potential-DoS-in-Thrift.patch",
          "patches/fizz-openssl-bio-h.patch",
          "patches/folly-network-socket-backport.patch",
          "patches/mcrouter-folly-dynamic-forward-decl.patch",
          "patches/thrift-byval-this.patch",
          "third-party"
        ],
        "message": "Revert D16010944: [hhvm][easy] Update FB dependencies in third-party/ to v2019.06.10.00 again\n\nDifferential Revision:\nD16010944\n\nOriginal commit changeset: 5b1fc47d62bb\n\nfbshipit-source-id: c80235d7906d7b7b71f139275d1de5ae89a1bb6d",
        "before_after_code_files": [
          "CMake/HHVMExtensionConfig.cmake||CMake/HHVMExtensionConfig.cmake",
          "CMake/HPHPFindLibs.cmake||CMake/HPHPFindLibs.cmake",
          "hphp/runtime/ext/scrypt/config.cmake||hphp/runtime/ext/scrypt/config.cmake",
          "hphp/runtime/ext/sodium/config.cmake||hphp/runtime/ext/sodium/config.cmake",
          "hphp/vixl/a64/disasm-a64.cc||hphp/vixl/a64/disasm-a64.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "hphp/runtime/ext/scrypt/config.cmake||hphp/runtime/ext/scrypt/config.cmake"
          ],
          "candidate": [
            "hphp/runtime/ext/scrypt/config.cmake||hphp/runtime/ext/scrypt/config.cmake"
          ]
        }
      },
      "candidate_diff": {
        "CMake/HHVMExtensionConfig.cmake||CMake/HHVMExtensionConfig.cmake": [
          "File: CMake/HHVMExtensionConfig.cmake -> CMake/HHVMExtensionConfig.cmake",
          "--- Hunk 1 ---",
          "[Context before]",
          "1000:       HHVM_EXTENSION_INTERNAL_ADD_INCLUDE_DIRS(${SNAPPY_INCLUDE_DIRS})",
          "1001:       HHVM_EXTENSION_INTERNAL_ADD_LINK_LIBRARIES(${SNAPPY_LIBRARIES})",
          "1002:     endif()",
          "1003:   elseif (${libraryName} STREQUAL \"vpx\")",
          "1004:     find_package(LibVpx ${requiredVersion})",
          "1005:     if (NOT LIBVPX_INCLUDE_DIRS OR NOT LIBVPX_LIBRARIES)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1003:   elseif (${libraryName} STREQUAL \"sodium\")",
          "1004:     find_package(LibSodium ${requiredVersion})",
          "1005:     if (NOT LIBSODIUM_INCLUDE_DIRS OR NOT LIBSODIUM_LIBRARIES)",
          "1006:       HHVM_EXTENSION_INTERNAL_SET_FAILED_DEPENDENCY(${extensionID} ${dependencyName})",
          "1007:       return()",
          "1008:     endif()",
          "1010:     if (${addPaths})",
          "1011:       HHVM_EXTENSION_INTERNAL_ADD_INCLUDE_DIRS(${LIBSODIUM_INCLUDE_DIRS})",
          "1012:       HHVM_EXTENSION_INTERNAL_ADD_LINK_LIBRARIES(${LIBSODIUM_LIBRARIES})",
          "1013:     endif()",
          "",
          "---------------"
        ],
        "CMake/HPHPFindLibs.cmake||CMake/HPHPFindLibs.cmake": [
          "File: CMake/HPHPFindLibs.cmake -> CMake/HPHPFindLibs.cmake",
          "--- Hunk 1 ---",
          "[Context before]",
          "438:   add_dependencies(${target} boostMaybeBuild)",
          "439:   target_link_libraries(${target} boost)",
          "443:   target_link_libraries(${target} ${MYSQL_CLIENT_LIBS})",
          "444:   if (ENABLE_ASYNC_MYSQL)",
          "445:     target_link_libraries(${target} squangle)",
          "",
          "[Removed Lines]",
          "440:   add_dependencies(${target} libsodiumMaybeBuild)",
          "441:   target_link_libraries(${target} libsodium)",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "hphp/runtime/ext/scrypt/config.cmake||hphp/runtime/ext/scrypt/config.cmake": [
          "File: hphp/runtime/ext/scrypt/config.cmake -> hphp/runtime/ext/scrypt/config.cmake",
          "--- Hunk 1 ---",
          "[Context before]",
          "2:   SOURCES",
          "3:     ext_scrypt.cpp",
          "4:     crypto/crypto_scrypt.cpp",
          "",
          "[Removed Lines]",
          "1: HHVM_DEFINE_EXTENSION(\"scrypt\"",
          "",
          "[Added Lines]",
          "1: HHVM_DEFINE_EXTENSION(\"scrypt\" IMPLICIT",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "8:     crypto/params.h",
          "9:   SYSTEMLIB",
          "10:     ext_scrypt.php",
          "11: )",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "11:   DEPENDS",
          "12:     \"libsodium 1.0.9\"",
          "",
          "---------------"
        ],
        "hphp/runtime/ext/sodium/config.cmake||hphp/runtime/ext/sodium/config.cmake": [
          "File: hphp/runtime/ext/sodium/config.cmake -> hphp/runtime/ext/sodium/config.cmake",
          "--- Hunk 1 ---",
          "[Context before]",
          "2:   SOURCES",
          "3:     ext_sodium.cpp",
          "4:   SYSTEMLIB",
          "5:     ext_sodium.php",
          "6: )",
          "",
          "[Removed Lines]",
          "1: HHVM_DEFINE_EXTENSION(\"sodium\"",
          "",
          "[Added Lines]",
          "1: HHVM_DEFINE_EXTENSION(\"sodium\" IMPLICIT",
          "6:   DEPENDS",
          "7:     \"libsodium 1.0.9\"",
          "",
          "---------------"
        ],
        "hphp/vixl/a64/disasm-a64.cc||hphp/vixl/a64/disasm-a64.cc": [
          "File: hphp/vixl/a64/disasm-a64.cc -> hphp/vixl/a64/disasm-a64.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "27: #include \"hphp/vixl/a64/disasm-a64.h\"",
          "28: #include \"hphp/util/text-color.h\"",
          "31: #include <folly/Format.h>",
          "33: namespace vixl {",
          "",
          "[Removed Lines]",
          "30: #include <ostream>",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "0cfe9b2d048fa8b13a15af6dbd1a7d93dab3fc35",
      "candidate_info": {
        "commit_hash": "0cfe9b2d048fa8b13a15af6dbd1a7d93dab3fc35",
        "repo": "facebook/hhvm",
        "commit_url": "https://github.com/facebook/hhvm/commit/0cfe9b2d048fa8b13a15af6dbd1a7d93dab3fc35",
        "files": [
          "CMake/HHVMExtensionConfig.cmake",
          "CMake/HPHPFindLibs.cmake",
          "hphp/runtime/ext/scrypt/config.cmake",
          "hphp/runtime/ext/sodium/config.cmake",
          "hphp/vixl/a64/disasm-a64.cc",
          "patches/fizz-openssl-bio-h.patch",
          "patches/folly-network-socket-backport.patch",
          "patches/folly-openssl-SSL_CTX_add1_chain_cert.patch",
          "patches/mcrouter-folly-dynamic-forward-decl.patch",
          "patches/proxygen-CVE-2019-9512-to-9515.patch",
          "patches/thrift-byval-this.patch",
          "third-party"
        ],
        "message": "Reland: Update FB depnedencies in third-party/ to v2019.06.10.00 again\n\nSummary:\nThis reverts D16010944 and also applies the folly patch from D16924414\nwhich should fix the build.\n\nReviewed By: jjergus\n\nDifferential Revision: D16925797\n\nfbshipit-source-id: a4cb0107dd698e4660673f64e29dd5e9952dca64",
        "before_after_code_files": [
          "CMake/HHVMExtensionConfig.cmake||CMake/HHVMExtensionConfig.cmake",
          "CMake/HPHPFindLibs.cmake||CMake/HPHPFindLibs.cmake",
          "hphp/runtime/ext/scrypt/config.cmake||hphp/runtime/ext/scrypt/config.cmake",
          "hphp/runtime/ext/sodium/config.cmake||hphp/runtime/ext/sodium/config.cmake",
          "hphp/vixl/a64/disasm-a64.cc||hphp/vixl/a64/disasm-a64.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "hphp/runtime/ext/scrypt/config.cmake||hphp/runtime/ext/scrypt/config.cmake"
          ],
          "candidate": [
            "hphp/runtime/ext/scrypt/config.cmake||hphp/runtime/ext/scrypt/config.cmake"
          ]
        }
      },
      "candidate_diff": {
        "CMake/HHVMExtensionConfig.cmake||CMake/HHVMExtensionConfig.cmake": [
          "File: CMake/HHVMExtensionConfig.cmake -> CMake/HHVMExtensionConfig.cmake",
          "--- Hunk 1 ---",
          "[Context before]",
          "1000:       HHVM_EXTENSION_INTERNAL_ADD_INCLUDE_DIRS(${SNAPPY_INCLUDE_DIRS})",
          "1001:       HHVM_EXTENSION_INTERNAL_ADD_LINK_LIBRARIES(${SNAPPY_LIBRARIES})",
          "1002:     endif()",
          "1014:   elseif (${libraryName} STREQUAL \"vpx\")",
          "1015:     find_package(LibVpx ${requiredVersion})",
          "1016:     if (NOT LIBVPX_INCLUDE_DIRS OR NOT LIBVPX_LIBRARIES)",
          "",
          "[Removed Lines]",
          "1003:   elseif (${libraryName} STREQUAL \"sodium\")",
          "1004:     find_package(LibSodium ${requiredVersion})",
          "1005:     if (NOT LIBSODIUM_INCLUDE_DIRS OR NOT LIBSODIUM_LIBRARIES)",
          "1006:       HHVM_EXTENSION_INTERNAL_SET_FAILED_DEPENDENCY(${extensionID} ${dependencyName})",
          "1007:       return()",
          "1008:     endif()",
          "1010:     if (${addPaths})",
          "1011:       HHVM_EXTENSION_INTERNAL_ADD_INCLUDE_DIRS(${LIBSODIUM_INCLUDE_DIRS})",
          "1012:       HHVM_EXTENSION_INTERNAL_ADD_LINK_LIBRARIES(${LIBSODIUM_LIBRARIES})",
          "1013:     endif()",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "CMake/HPHPFindLibs.cmake||CMake/HPHPFindLibs.cmake": [
          "File: CMake/HPHPFindLibs.cmake -> CMake/HPHPFindLibs.cmake",
          "--- Hunk 1 ---",
          "[Context before]",
          "438:   add_dependencies(${target} boostMaybeBuild)",
          "439:   target_link_libraries(${target} boost)",
          "440:   target_link_libraries(${target} ${MYSQL_CLIENT_LIBS})",
          "441:   if (ENABLE_ASYNC_MYSQL)",
          "442:     target_link_libraries(${target} squangle)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "440:   add_dependencies(${target} libsodiumMaybeBuild)",
          "441:   target_link_libraries(${target} libsodium)",
          "",
          "---------------"
        ],
        "hphp/runtime/ext/scrypt/config.cmake||hphp/runtime/ext/scrypt/config.cmake": [
          "File: hphp/runtime/ext/scrypt/config.cmake -> hphp/runtime/ext/scrypt/config.cmake",
          "--- Hunk 1 ---",
          "[Context before]",
          "2:   SOURCES",
          "3:     ext_scrypt.cpp",
          "4:     crypto/crypto_scrypt.cpp",
          "",
          "[Removed Lines]",
          "1: HHVM_DEFINE_EXTENSION(\"scrypt\" IMPLICIT",
          "",
          "[Added Lines]",
          "1: HHVM_DEFINE_EXTENSION(\"scrypt\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "8:     crypto/params.h",
          "9:   SYSTEMLIB",
          "10:     ext_scrypt.php",
          "13: )",
          "",
          "[Removed Lines]",
          "11:   DEPENDS",
          "12:     \"libsodium 1.0.9\"",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "hphp/runtime/ext/sodium/config.cmake||hphp/runtime/ext/sodium/config.cmake": [
          "File: hphp/runtime/ext/sodium/config.cmake -> hphp/runtime/ext/sodium/config.cmake",
          "--- Hunk 1 ---",
          "[Context before]",
          "2:   SOURCES",
          "3:     ext_sodium.cpp",
          "4:   SYSTEMLIB",
          "5:     ext_sodium.php",
          "8: )",
          "",
          "[Removed Lines]",
          "1: HHVM_DEFINE_EXTENSION(\"sodium\" IMPLICIT",
          "6:   DEPENDS",
          "7:     \"libsodium 1.0.9\"",
          "",
          "[Added Lines]",
          "1: HHVM_DEFINE_EXTENSION(\"sodium\"",
          "",
          "---------------"
        ],
        "hphp/vixl/a64/disasm-a64.cc||hphp/vixl/a64/disasm-a64.cc": [
          "File: hphp/vixl/a64/disasm-a64.cc -> hphp/vixl/a64/disasm-a64.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "27: #include \"hphp/vixl/a64/disasm-a64.h\"",
          "28: #include \"hphp/util/text-color.h\"",
          "30: #include <folly/Format.h>",
          "32: namespace vixl {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "30: #include <ostream>",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "eb1bb5dc243eecf237326b418e180decc30e267f",
      "candidate_info": {
        "commit_hash": "eb1bb5dc243eecf237326b418e180decc30e267f",
        "repo": "facebook/hhvm",
        "commit_url": "https://github.com/facebook/hhvm/commit/eb1bb5dc243eecf237326b418e180decc30e267f",
        "files": [
          "CMake/HHVMExtensionConfig.cmake",
          "CMake/HPHPFindLibs.cmake",
          "hphp/runtime/ext/scrypt/config.cmake",
          "hphp/runtime/ext/sodium/config.cmake",
          "hphp/vixl/a64/disasm-a64.cc",
          "patches/0001-CVE-2019-3552-potential-DoS-in-Thrift.patch",
          "patches/fizz-openssl-bio-h.patch",
          "patches/folly-network-socket-backport.patch",
          "patches/mcrouter-folly-dynamic-forward-decl.patch",
          "patches/thrift-byval-this.patch",
          "third-party"
        ],
        "message": "Update FB dependencies in third-party/ to v2019.06.10.00 again\n\nSummary:\nD15825097, but with https://github.com/hhvm/hhvm-third-party/commit/59e1d7c285f7b6863dcc8f0b4ba0ed58e2559dc5 added, which fixes\nout-of-source builds (e.g. `cd $(mktemp -d); cmake /path/to/source/tree` instead of `cmake .`\n\nReviewed By: alexeyt\n\nDifferential Revision: D16010944\n\nfbshipit-source-id: 5b1fc47d62bbecc17b9ba09ff73fa45439c640e6",
        "before_after_code_files": [
          "CMake/HHVMExtensionConfig.cmake||CMake/HHVMExtensionConfig.cmake",
          "CMake/HPHPFindLibs.cmake||CMake/HPHPFindLibs.cmake",
          "hphp/runtime/ext/scrypt/config.cmake||hphp/runtime/ext/scrypt/config.cmake",
          "hphp/runtime/ext/sodium/config.cmake||hphp/runtime/ext/sodium/config.cmake",
          "hphp/vixl/a64/disasm-a64.cc||hphp/vixl/a64/disasm-a64.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "hphp/runtime/ext/scrypt/config.cmake||hphp/runtime/ext/scrypt/config.cmake"
          ],
          "candidate": [
            "hphp/runtime/ext/scrypt/config.cmake||hphp/runtime/ext/scrypt/config.cmake"
          ]
        }
      },
      "candidate_diff": {
        "CMake/HHVMExtensionConfig.cmake||CMake/HHVMExtensionConfig.cmake": [
          "File: CMake/HHVMExtensionConfig.cmake -> CMake/HHVMExtensionConfig.cmake",
          "--- Hunk 1 ---",
          "[Context before]",
          "1000:       HHVM_EXTENSION_INTERNAL_ADD_INCLUDE_DIRS(${SNAPPY_INCLUDE_DIRS})",
          "1001:       HHVM_EXTENSION_INTERNAL_ADD_LINK_LIBRARIES(${SNAPPY_LIBRARIES})",
          "1002:     endif()",
          "1014:   elseif (${libraryName} STREQUAL \"vpx\")",
          "1015:     find_package(LibVpx ${requiredVersion})",
          "1016:     if (NOT LIBVPX_INCLUDE_DIRS OR NOT LIBVPX_LIBRARIES)",
          "",
          "[Removed Lines]",
          "1003:   elseif (${libraryName} STREQUAL \"sodium\")",
          "1004:     find_package(LibSodium ${requiredVersion})",
          "1005:     if (NOT LIBSODIUM_INCLUDE_DIRS OR NOT LIBSODIUM_LIBRARIES)",
          "1006:       HHVM_EXTENSION_INTERNAL_SET_FAILED_DEPENDENCY(${extensionID} ${dependencyName})",
          "1007:       return()",
          "1008:     endif()",
          "1010:     if (${addPaths})",
          "1011:       HHVM_EXTENSION_INTERNAL_ADD_INCLUDE_DIRS(${LIBSODIUM_INCLUDE_DIRS})",
          "1012:       HHVM_EXTENSION_INTERNAL_ADD_LINK_LIBRARIES(${LIBSODIUM_LIBRARIES})",
          "1013:     endif()",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "CMake/HPHPFindLibs.cmake||CMake/HPHPFindLibs.cmake": [
          "File: CMake/HPHPFindLibs.cmake -> CMake/HPHPFindLibs.cmake",
          "--- Hunk 1 ---",
          "[Context before]",
          "438:   add_dependencies(${target} boostMaybeBuild)",
          "439:   target_link_libraries(${target} boost)",
          "440:   target_link_libraries(${target} ${MYSQL_CLIENT_LIBS})",
          "441:   if (ENABLE_ASYNC_MYSQL)",
          "442:     target_link_libraries(${target} squangle)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "440:   add_dependencies(${target} libsodiumMaybeBuild)",
          "441:   target_link_libraries(${target} libsodium)",
          "",
          "---------------"
        ],
        "hphp/runtime/ext/scrypt/config.cmake||hphp/runtime/ext/scrypt/config.cmake": [
          "File: hphp/runtime/ext/scrypt/config.cmake -> hphp/runtime/ext/scrypt/config.cmake",
          "--- Hunk 1 ---",
          "[Context before]",
          "2:   SOURCES",
          "3:     ext_scrypt.cpp",
          "4:     crypto/crypto_scrypt.cpp",
          "",
          "[Removed Lines]",
          "1: HHVM_DEFINE_EXTENSION(\"scrypt\" IMPLICIT",
          "",
          "[Added Lines]",
          "1: HHVM_DEFINE_EXTENSION(\"scrypt\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "8:     crypto/params.h",
          "9:   SYSTEMLIB",
          "10:     ext_scrypt.php",
          "13: )",
          "",
          "[Removed Lines]",
          "11:   DEPENDS",
          "12:     \"libsodium 1.0.9\"",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "hphp/runtime/ext/sodium/config.cmake||hphp/runtime/ext/sodium/config.cmake": [
          "File: hphp/runtime/ext/sodium/config.cmake -> hphp/runtime/ext/sodium/config.cmake",
          "--- Hunk 1 ---",
          "[Context before]",
          "2:   SOURCES",
          "3:     ext_sodium.cpp",
          "4:   SYSTEMLIB",
          "5:     ext_sodium.php",
          "8: )",
          "",
          "[Removed Lines]",
          "1: HHVM_DEFINE_EXTENSION(\"sodium\" IMPLICIT",
          "6:   DEPENDS",
          "7:     \"libsodium 1.0.9\"",
          "",
          "[Added Lines]",
          "1: HHVM_DEFINE_EXTENSION(\"sodium\"",
          "",
          "---------------"
        ],
        "hphp/vixl/a64/disasm-a64.cc||hphp/vixl/a64/disasm-a64.cc": [
          "File: hphp/vixl/a64/disasm-a64.cc -> hphp/vixl/a64/disasm-a64.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "27: #include \"hphp/vixl/a64/disasm-a64.h\"",
          "28: #include \"hphp/util/text-color.h\"",
          "30: #include <folly/Format.h>",
          "32: namespace vixl {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "30: #include <ostream>",
          "",
          "---------------"
        ]
      }
    }
  ]
}