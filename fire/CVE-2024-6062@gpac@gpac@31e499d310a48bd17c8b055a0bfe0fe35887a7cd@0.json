{
  "cve_id": "CVE-2024-6062",
  "cve_desc": "A vulnerability was found in GPAC 2.5-DEV-rev228-g11067ea92-master and classified as problematic. Affected by this issue is the function swf_svg_add_iso_sample of the file src/filters/load_text.c of the component MP4Box. The manipulation leads to null pointer dereference. The attack needs to be approached locally. The exploit has been disclosed to the public and may be used. The patch is identified as 31e499d310a48bd17c8b055a0bfe0fe35887a7cd. It is recommended to apply a patch to fix this issue. VDB-268790 is the identifier assigned to this vulnerability.",
  "repo": "gpac/gpac",
  "patch_hash": "31e499d310a48bd17c8b055a0bfe0fe35887a7cd",
  "patch_info": {
    "commit_hash": "31e499d310a48bd17c8b055a0bfe0fe35887a7cd",
    "repo": "gpac/gpac",
    "commit_url": "https://github.com/gpac/gpac/commit/31e499d310a48bd17c8b055a0bfe0fe35887a7cd",
    "files": [
      "src/filters/load_text.c"
    ],
    "message": "fixed #2872",
    "before_after_code_files": [
      "src/filters/load_text.c||src/filters/load_text.c"
    ]
  },
  "patch_diff": {
    "src/filters/load_text.c||src/filters/load_text.c": [
      "File: src/filters/load_text.c -> src/filters/load_text.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "2535:  GF_FilterPacket *pck;",
      "2536:  u8 *pck_data;",
      "2537:  GF_TXTIn *ctx = (GF_TXTIn *)user;",
      "2539:  if (ctx->seek_state==2) {",
      "2540:   Double ts = (Double) timestamp;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "2538:  if (!data || !length) return GF_BAD_PARAM;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "e3386b1b1d2ff12a1064a70be676e24644271458",
      "candidate_info": {
        "commit_hash": "e3386b1b1d2ff12a1064a70be676e24644271458",
        "repo": "gpac/gpac",
        "commit_url": "https://github.com/gpac/gpac/commit/e3386b1b1d2ff12a1064a70be676e24644271458",
        "files": [
          "src/filters/load_text.c",
          "src/scene_manager/swf_parse.c",
          "src/scene_manager/swf_svg.c"
        ],
        "message": "swf: check some null lengths (#2872)",
        "before_after_code_files": [
          "src/filters/load_text.c||src/filters/load_text.c",
          "src/scene_manager/swf_parse.c||src/scene_manager/swf_parse.c",
          "src/scene_manager/swf_svg.c||src/scene_manager/swf_svg.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_issue": 1,
        "olp_code_files": {
          "patch": [
            "src/filters/load_text.c||src/filters/load_text.c"
          ],
          "candidate": [
            "src/filters/load_text.c||src/filters/load_text.c"
          ]
        }
      },
      "candidate_diff": {
        "src/filters/load_text.c||src/filters/load_text.c": [
          "File: src/filters/load_text.c -> src/filters/load_text.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2545:  }",
          "2547:  pck = gf_filter_pck_new_alloc(ctx->opid, length, &pck_data);",
          "2549:   memcpy(pck_data, data, length);",
          "2550:   gf_filter_pck_set_cts(pck, (u64) (ctx->timescale*timestamp/1000) );",
          "2551:   gf_filter_pck_set_sap(pck, isRap ? GF_FILTER_SAP_1 : GF_FILTER_SAP_NONE);",
          "",
          "[Removed Lines]",
          "2548:  if (pck) {",
          "",
          "[Added Lines]",
          "2548:  if (pck && data && length) {",
          "",
          "---------------"
        ],
        "src/scene_manager/swf_parse.c||src/scene_manager/swf_parse.c": [
          "File: src/scene_manager/swf_parse.c -> src/scene_manager/swf_parse.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2025:   bytes[3] = swf_read_int(read, 8);",
          "2026:   hdr = GF_4CC(bytes[0], bytes[1], bytes[2], bytes[3]);",
          "2027:   size = gf_mp3_frame_size(hdr);",
          "2028:   if (alloc_size<size-4) {",
          "2029:    frame = (char*)gf_realloc(frame, sizeof(char)*(size-4));",
          "2030:    alloc_size = size-4;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2028:   if (!size) {",
          "2029:    e = GF_ISOM_INVALID_MEDIA;",
          "2030:    break;",
          "2031:   }",
          "",
          "---------------"
        ],
        "src/scene_manager/swf_svg.c||src/scene_manager/swf_svg.c": [
          "File: src/scene_manager/swf_svg.c -> src/scene_manager/swf_svg.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "458:   swf_svg_print(read, \"</g>\\n\");",
          "459:  }",
          "463:  read->svg_data_size = 0;",
          "465:  read->empty_frame = GF_TRUE;",
          "",
          "[Removed Lines]",
          "460:  read->add_sample(read->user, read->svg_data, read->svg_data_size, read->current_frame*1000/read->frame_rate, (read->current_frame == 0));",
          "461:  gf_free(read->svg_data);",
          "462:  read->svg_data = NULL;",
          "",
          "[Added Lines]",
          "461:  if (read->svg_data && read->svg_data_size)",
          "462:   read->add_sample(read->user, read->svg_data, read->svg_data_size, read->current_frame*1000/read->frame_rate, (read->current_frame == 0));",
          "464:  if (read->svg_data) {",
          "465:   gf_free(read->svg_data);",
          "466:   read->svg_data = NULL;",
          "467:  }",
          "",
          "---------------"
        ]
      }
    }
  ]
}