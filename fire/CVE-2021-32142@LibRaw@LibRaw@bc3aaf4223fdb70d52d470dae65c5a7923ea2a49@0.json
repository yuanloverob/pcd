{
  "cve_id": "CVE-2021-32142",
  "cve_desc": "Buffer Overflow vulnerability in LibRaw linux/unix v0.20.0 allows attacker to escalate privileges via the LibRaw_buffer_datastream::gets(char*, int) in /src/libraw/src/libraw_datastream.cpp.",
  "repo": "LibRaw/LibRaw",
  "patch_hash": "bc3aaf4223fdb70d52d470dae65c5a7923ea2a49",
  "patch_info": {
    "commit_hash": "bc3aaf4223fdb70d52d470dae65c5a7923ea2a49",
    "repo": "LibRaw/LibRaw",
    "commit_url": "https://github.com/LibRaw/LibRaw/commit/bc3aaf4223fdb70d52d470dae65c5a7923ea2a49",
    "files": [
      "src/libraw_datastream.cpp"
    ],
    "message": "check for input buffer size on datastream::gets",
    "before_after_code_files": [
      "src/libraw_datastream.cpp||src/libraw_datastream.cpp"
    ]
  },
  "patch_diff": {
    "src/libraw_datastream.cpp||src/libraw_datastream.cpp": [
      "File: src/libraw_datastream.cpp -> src/libraw_datastream.cpp",
      "--- Hunk 1 ---",
      "[Context before]",
      "288: char *LibRaw_file_datastream::gets(char *str, int sz)",
      "289: {",
      "290:   LR_STREAM_CHK();",
      "291:   std::istream is(f.get());",
      "292:   is.getline(str, sz);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "290:   if(sz<1) return NULL;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "422: char *LibRaw_buffer_datastream::gets(char *s, int sz)",
      "423: {",
      "424:   unsigned char *psrc, *pdest, *str;",
      "425:   str = (unsigned char *)s;",
      "426:   psrc = buf + streampos;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "425:   if(sz<1) return NULL;",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "619: char *LibRaw_bigfile_datastream::gets(char *str, int sz)",
      "620: {",
      "621:   LR_BF_CHK();",
      "622:   return fgets(str, sz, f);",
      "623: }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "623:   if(sz<1) return NULL;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "fa329f37dca4a2c938f8abb50ee4a7ef93e64fbb",
      "candidate_info": {
        "commit_hash": "fa329f37dca4a2c938f8abb50ee4a7ef93e64fbb",
        "repo": "LibRaw/LibRaw",
        "commit_url": "https://github.com/LibRaw/LibRaw/commit/fa329f37dca4a2c938f8abb50ee4a7ef93e64fbb",
        "files": [
          "src/libraw_datastream.cpp"
        ],
        "message": "check for input buffer size on datastream::gets",
        "before_after_code_files": [
          "src/libraw_datastream.cpp||src/libraw_datastream.cpp"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "src/libraw_datastream.cpp||src/libraw_datastream.cpp"
          ],
          "candidate": [
            "src/libraw_datastream.cpp||src/libraw_datastream.cpp"
          ]
        }
      },
      "candidate_diff": {
        "src/libraw_datastream.cpp||src/libraw_datastream.cpp": [
          "File: src/libraw_datastream.cpp -> src/libraw_datastream.cpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "287: char *LibRaw_file_datastream::gets(char *str, int sz)",
          "288: {",
          "289:   LR_STREAM_CHK();",
          "290:   std::istream is(f.get());",
          "291:   is.getline(str, sz);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "289:   if(sz<1) return NULL;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "418: char *LibRaw_buffer_datastream::gets(char *s, int sz)",
          "419: {",
          "420:   unsigned char *psrc, *pdest, *str;",
          "421:   str = (unsigned char *)s;",
          "422:   psrc = buf + streampos;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "421:   if(sz<1) return NULL;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "610: char *LibRaw_bigfile_datastream::gets(char *str, int sz)",
          "611: {",
          "612:   LR_BF_CHK();",
          "613:   return fgets(str, sz, f);",
          "614: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "614:   if(sz<1) return NULL;",
          "",
          "---------------"
        ]
      }
    }
  ]
}