{
  "cve_id": "CVE-2018-17407",
  "cve_desc": "An issue was discovered in t1_check_unusual_charstring functions in writet1.c files in TeX Live before 2018-09-21. A buffer overflow in the handling of Type 1 fonts allows arbitrary code execution when a malicious font is loaded by one of the vulnerable tools: pdflatex, pdftex, dvips, or luatex.",
  "repo": "TeX-Live/texlive-source",
  "patch_hash": "6ed0077520e2b0da1fd060c7f88db7b2e6068e4c",
  "patch_info": {
    "commit_hash": "6ed0077520e2b0da1fd060c7f88db7b2e6068e4c",
    "repo": "TeX-Live/texlive-source",
    "commit_url": "https://github.com/TeX-Live/texlive-source/commit/6ed0077520e2b0da1fd060c7f88db7b2e6068e4c",
    "files": [
      "texk/dvipsk/ChangeLog",
      "texk/dvipsk/writet1.c",
      "texk/web2c/luatexdir/ChangeLog",
      "texk/web2c/luatexdir/font/writet1.c",
      "texk/web2c/pdftexdir/ChangeLog",
      "texk/web2c/pdftexdir/writet1.c"
    ],
    "message": "writet1 protection against buffer overflow\n\ngit-svn-id: svn://tug.org/texlive/trunk/Build/source@48697 c570f23f-e606-0410-a88d-b1316a301751",
    "before_after_code_files": [
      "texk/dvipsk/writet1.c||texk/dvipsk/writet1.c",
      "texk/web2c/luatexdir/font/writet1.c||texk/web2c/luatexdir/font/writet1.c",
      "texk/web2c/pdftexdir/writet1.c||texk/web2c/pdftexdir/writet1.c"
    ]
  },
  "patch_diff": {
    "texk/dvipsk/writet1.c||texk/dvipsk/writet1.c": [
      "File: texk/dvipsk/writet1.c -> texk/dvipsk/writet1.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1451:         t1_getline();",
      "1452:         strcat(t1_buf_array, t1_line_array);",
      "1453:         strcpy(t1_line_array, t1_buf_array);",
      "1454:         t1_line_ptr = eol(t1_line_array);",
      "1455:     }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1452:         alloc_array(t1_buf, strlen(t1_line_array) + strlen(t1_buf_array) + 1, T1_BUF_SIZE);",
      "1454:         alloc_array(t1_line, strlen(t1_buf_array) + 1, T1_BUF_SIZE);",
      "",
      "---------------"
    ],
    "texk/web2c/luatexdir/font/writet1.c||texk/web2c/luatexdir/font/writet1.c": [
      "File: texk/web2c/luatexdir/font/writet1.c -> texk/web2c/luatexdir/font/writet1.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1581:     if (sscanf(p, \"%i\", &i) != 1) {",
      "1582:         strcpy(t1_buf_array, t1_line_array);",
      "1583:         t1_getline();",
      "1584:         strcat(t1_buf_array, t1_line_array);",
      "1585:         strcpy(t1_line_array, t1_buf_array);",
      "1586:         t1_line_ptr = eol(t1_line_array);",
      "1587:     }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1584:         alloc_array(t1_buf, strlen(t1_line_array) + strlen(t1_buf_array) + 1, T1_BUF_SIZE);",
      "1586:         alloc_array(t1_line, strlen(t1_buf_array) + 1, T1_BUF_SIZE);",
      "",
      "---------------"
    ],
    "texk/web2c/pdftexdir/writet1.c||texk/web2c/pdftexdir/writet1.c": [
      "File: texk/web2c/pdftexdir/writet1.c -> texk/web2c/pdftexdir/writet1.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1600:         t1_getline();",
      "1601:         strcat(t1_buf_array, t1_line_array);",
      "1602:         strcpy(t1_line_array, t1_buf_array);",
      "1603:         t1_line_ptr = eol(t1_line_array);",
      "1604:     }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1601:         alloc_array(t1_buf, strlen(t1_line_array) + strlen(t1_buf_array) + 1, T1_BUF_SIZE);",
      "1603:         alloc_array(t1_line, strlen(t1_buf_array) + 1, T1_BUF_SIZE);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "80b489df6f27f8074f036c7cf5bdd776212a7c14",
      "candidate_info": {
        "commit_hash": "80b489df6f27f8074f036c7cf5bdd776212a7c14",
        "repo": "TeX-Live/texlive-source",
        "commit_url": "https://github.com/TeX-Live/texlive-source/commit/80b489df6f27f8074f036c7cf5bdd776212a7c14",
        "files": [
          "texk/dvipsk/ChangeLog",
          "texk/dvipsk/writet1.c",
          "texk/web2c/pdftexdir/ChangeLog",
          "texk/web2c/pdftexdir/writet1.c"
        ],
        "message": "avoid possible strlen on null ptr\n\ngit-svn-id: svn://tug.org/texlive/trunk/Build/source@48980 c570f23f-e606-0410-a88d-b1316a301751",
        "before_after_code_files": [
          "texk/dvipsk/writet1.c||texk/dvipsk/writet1.c",
          "texk/web2c/pdftexdir/writet1.c||texk/web2c/pdftexdir/writet1.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "texk/dvipsk/writet1.c||texk/dvipsk/writet1.c",
            "texk/web2c/pdftexdir/writet1.c||texk/web2c/pdftexdir/writet1.c"
          ],
          "candidate": [
            "texk/dvipsk/writet1.c||texk/dvipsk/writet1.c",
            "texk/web2c/pdftexdir/writet1.c||texk/web2c/pdftexdir/writet1.c"
          ]
        }
      },
      "candidate_diff": {
        "texk/dvipsk/writet1.c||texk/dvipsk/writet1.c": [
          "File: texk/dvipsk/writet1.c -> texk/dvipsk/writet1.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "4: This program is free software; you can redistribute it and/or modify",
          "5: it under the terms of the GNU General Public License as published by",
          "",
          "[Removed Lines]",
          "2: Copyright 1996-2013 Han The Thanh <thanh@pdftex.org>",
          "",
          "[Added Lines]",
          "2: Copyright 1996-2018 Han The Thanh <thanh@pdftex.org>",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1451:         t1_getline();",
          "1453:         strcat(t1_buf_array, t1_line_array);",
          "1454:         alloc_array(t1_line, strlen(t1_buf_array) + 1, T1_BUF_SIZE);",
          "1455:         strcpy(t1_line_array, t1_buf_array);",
          "",
          "[Removed Lines]",
          "1452:         alloc_array(t1_buf, strlen(t1_line_array) + strlen(t1_buf_array) + 1, T1_BUF_SIZE);",
          "",
          "[Added Lines]",
          "1452:         alloc_array(t1_buf, strlen(t1_line_array)",
          "1453:                             + (t1_buf_array ? strlen(t1_buf_array) + 1 : 0),",
          "1454:                             T1_BUF_SIZE);",
          "",
          "---------------"
        ],
        "texk/web2c/pdftexdir/writet1.c||texk/web2c/pdftexdir/writet1.c": [
          "File: texk/web2c/pdftexdir/writet1.c -> texk/web2c/pdftexdir/writet1.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "4: This program is free software; you can redistribute it and/or modify",
          "5: it under the terms of the GNU General Public License as published by",
          "",
          "[Removed Lines]",
          "2: Copyright 1996-2014 Han The Thanh <thanh@pdftex.org>",
          "",
          "[Added Lines]",
          "2: Copyright 1996-2018 Han The Thanh <thanh@pdftex.org>",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1600:         t1_getline();",
          "1602:         strcat(t1_buf_array, t1_line_array);",
          "1603:         alloc_array(t1_line, strlen(t1_buf_array) + 1, T1_BUF_SIZE);",
          "1604:         strcpy(t1_line_array, t1_buf_array);",
          "",
          "[Removed Lines]",
          "1601:         alloc_array(t1_buf, strlen(t1_line_array) + strlen(t1_buf_array) + 1, T1_BUF_SIZE);",
          "",
          "[Added Lines]",
          "1601:         alloc_array(t1_buf, strlen(t1_line_array)",
          "1602:                             + (t1_buf_array ? strlen(t1_buf_array) + 1 : 0),",
          "1603:                             T1_BUF_SIZE);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "f1211fe16c19af8fee54146ae116e4e5c779e8b4",
      "candidate_info": {
        "commit_hash": "f1211fe16c19af8fee54146ae116e4e5c779e8b4",
        "repo": "TeX-Live/texlive-source",
        "commit_url": "https://github.com/TeX-Live/texlive-source/commit/f1211fe16c19af8fee54146ae116e4e5c779e8b4",
        "files": [
          "texk/dvipsk/ChangeLog",
          "texk/dvipsk/writet1.c",
          "texk/web2c/luatexdir/ChangeLog",
          "texk/web2c/luatexdir/font/writet1.w",
          "texk/web2c/pdftexdir/ChangeLog",
          "texk/web2c/pdftexdir/writet1.c"
        ],
        "message": "writet1.(c,w) of dvips, pdftex, luatex: protect against buffer overflow\n\ngit-svn-id: svn://tug.org/texlive/branches/branch2018/Build/source@48688 c570f23f-e606-0410-a88d-b1316a301751",
        "before_after_code_files": [
          "texk/dvipsk/writet1.c||texk/dvipsk/writet1.c",
          "texk/web2c/luatexdir/font/writet1.w||texk/web2c/luatexdir/font/writet1.w",
          "texk/web2c/pdftexdir/writet1.c||texk/web2c/pdftexdir/writet1.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_olp_changes": 1,
        "olp_code_files": {
          "patch": [
            "texk/dvipsk/writet1.c||texk/dvipsk/writet1.c",
            "texk/web2c/pdftexdir/writet1.c||texk/web2c/pdftexdir/writet1.c"
          ],
          "candidate": [
            "texk/dvipsk/writet1.c||texk/dvipsk/writet1.c",
            "texk/web2c/pdftexdir/writet1.c||texk/web2c/pdftexdir/writet1.c"
          ]
        }
      },
      "candidate_diff": {
        "texk/dvipsk/writet1.c||texk/dvipsk/writet1.c": [
          "File: texk/dvipsk/writet1.c -> texk/dvipsk/writet1.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1451:         t1_getline();",
          "1452:         strcat(t1_buf_array, t1_line_array);",
          "1453:         strcpy(t1_line_array, t1_buf_array);",
          "1454:         t1_line_ptr = eol(t1_line_array);",
          "1455:     }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1452:         alloc_array(t1_buf, strlen(t1_line_array) + strlen(t1_buf_array) + 1, T1_BUF_SIZE);",
          "1454:         alloc_array(t1_line, strlen(t1_buf_array) + 1, T1_BUF_SIZE);",
          "",
          "---------------"
        ],
        "texk/web2c/luatexdir/font/writet1.w||texk/web2c/luatexdir/font/writet1.w": [
          "File: texk/web2c/luatexdir/font/writet1.w -> texk/web2c/luatexdir/font/writet1.w",
          "--- Hunk 1 ---",
          "[Context before]",
          "1625:     if (sscanf(p, \"%i\", &i) != 1) {",
          "1626:         strcpy(t1_buf_array, t1_line_array);",
          "1627:         t1_getline();",
          "1628:         strcat(t1_buf_array, t1_line_array);",
          "1629:         strcpy(t1_line_array, t1_buf_array);",
          "1630:         t1_line_ptr = eol(t1_line_array);",
          "1631:     }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1628:         alloc_array(t1_buf, strlen(t1_line_array) + strlen(t1_buf_array) + 1, T1_BUF_SIZE);",
          "1630:         alloc_array(t1_line, strlen(t1_buf_array) + 1, T1_BUF_SIZE);",
          "",
          "---------------"
        ],
        "texk/web2c/pdftexdir/writet1.c||texk/web2c/pdftexdir/writet1.c": [
          "File: texk/web2c/pdftexdir/writet1.c -> texk/web2c/pdftexdir/writet1.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1600:         t1_getline();",
          "1601:         strcat(t1_buf_array, t1_line_array);",
          "1602:         strcpy(t1_line_array, t1_buf_array);",
          "1603:         t1_line_ptr = eol(t1_line_array);",
          "1604:     }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1601:         alloc_array(t1_buf, strlen(t1_line_array) + strlen(t1_buf_array) + 1, T1_BUF_SIZE);",
          "1603:         alloc_array(t1_line, strlen(t1_buf_array) + 1, T1_BUF_SIZE);",
          "",
          "---------------"
        ]
      }
    }
  ]
}