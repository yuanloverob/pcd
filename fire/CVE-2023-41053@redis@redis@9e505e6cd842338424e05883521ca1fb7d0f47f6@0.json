{
  "cve_id": "CVE-2023-41053",
  "cve_desc": "Redis is an in-memory database that persists on disk. Redis does not correctly identify keys accessed by `SORT_RO` and as a result may grant users executing this command access to keys that are not explicitly authorized by the ACL configuration. The problem exists in Redis 7.0 or newer and has been fixed in Redis 7.0.13 and 7.2.1. Users are advised to upgrade. There are no known workarounds for this vulnerability.",
  "repo": "redis/redis",
  "patch_hash": "9e505e6cd842338424e05883521ca1fb7d0f47f6",
  "patch_info": {
    "commit_hash": "9e505e6cd842338424e05883521ca1fb7d0f47f6",
    "repo": "redis/redis",
    "commit_url": "https://github.com/redis/redis/commit/9e505e6cd842338424e05883521ca1fb7d0f47f6",
    "files": [
      "src/db.c",
      "tests/unit/sort.tcl"
    ],
    "message": "Fix sort_ro get-keys function return wrong key number (#12522)\n\nBefore\uff1a\n```\n127.0.0.1:6379> command getkeys sort_ro key\n(empty array)\n127.0.0.1:6379>\n```\nAfter:\n```\n127.0.0.1:6379> command getkeys sort_ro key\n1) \"key\"\n127.0.0.1:6379>\n```\n\n(cherry picked from commit b59f53efb31b36d0a307809f5d33bf66d66a4447)",
    "before_after_code_files": [
      "src/db.c||src/db.c",
      "tests/unit/sort.tcl||tests/unit/sort.tcl"
    ]
  },
  "patch_diff": {
    "src/db.c||src/db.c": [
      "File: src/db.c -> src/db.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "2294:     keys = getKeysPrepareResult(result, 1);",
      "2296:     keys[0].flags = CMD_KEY_RO | CMD_KEY_ACCESS;",
      "2298: }",
      "",
      "[Removed Lines]",
      "2297:     return 1;",
      "",
      "[Added Lines]",
      "2297:     result->numkeys = 1;",
      "2298:     return result->numkeys;",
      "",
      "---------------"
    ],
    "tests/unit/sort.tcl||tests/unit/sort.tcl": [
      "File: tests/unit/sort.tcl -> tests/unit/sort.tcl",
      "--- Hunk 1 ---",
      "[Context before]",
      "109:     test \"SORT extracts STORE correctly\" {",
      "110:         r command getkeys sort abc store def",
      "111:     } {abc def}",
      "113:     test \"SORT extracts multiple STORE correctly\" {",
      "114:         r command getkeys sort abc store invalid store stillbad store def",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "113:     test \"SORT_RO get keys\" {",
      "114:         r command getkeys sort_ro abc",
      "115:     } {abc}",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "0f14d3279212e1b262869b6160db87d6f117cff5",
      "candidate_info": {
        "commit_hash": "0f14d3279212e1b262869b6160db87d6f117cff5",
        "repo": "redis/redis",
        "commit_url": "https://github.com/redis/redis/commit/0f14d3279212e1b262869b6160db87d6f117cff5",
        "files": [
          "src/db.c",
          "tests/unit/sort.tcl"
        ],
        "message": "Fix sort_ro get-keys function return wrong key number (#12522)\n\nBefore\uff1a\n```\n127.0.0.1:6379> command getkeys sort_ro key\n(empty array)\n127.0.0.1:6379>\n```\nAfter:\n```\n127.0.0.1:6379> command getkeys sort_ro key\n1) \"key\"\n127.0.0.1:6379>\n```\n\n(cherry picked from commit b59f53efb31b36d0a307809f5d33bf66d66a4447)",
        "before_after_code_files": [
          "src/db.c||src/db.c",
          "tests/unit/sort.tcl||tests/unit/sort.tcl"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "src/db.c||src/db.c",
            "tests/unit/sort.tcl||tests/unit/sort.tcl"
          ],
          "candidate": [
            "src/db.c||src/db.c",
            "tests/unit/sort.tcl||tests/unit/sort.tcl"
          ]
        }
      },
      "candidate_diff": {
        "src/db.c||src/db.c": [
          "File: src/db.c -> src/db.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2193:     keys = getKeysPrepareResult(result, 1);",
          "2195:     keys[0].flags = CMD_KEY_RO | CMD_KEY_ACCESS;",
          "2197: }",
          "",
          "[Removed Lines]",
          "2196:     return 1;",
          "",
          "[Added Lines]",
          "2196:     result->numkeys = 1;",
          "2197:     return result->numkeys;",
          "",
          "---------------"
        ],
        "tests/unit/sort.tcl||tests/unit/sort.tcl": [
          "File: tests/unit/sort.tcl -> tests/unit/sort.tcl",
          "--- Hunk 1 ---",
          "[Context before]",
          "97:     test \"SORT extracts STORE correctly\" {",
          "98:         r command getkeys sort abc store def",
          "99:     } {abc def}",
          "101:     test \"SORT extracts multiple STORE correctly\" {",
          "102:         r command getkeys sort abc store invalid store stillbad store def",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "101:     test \"SORT_RO get keys\" {",
          "102:         r command getkeys sort_ro abc",
          "103:     } {abc}",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "cc244370a2d622d5d2fec5573ae87de6c59ed3b9",
      "candidate_info": {
        "commit_hash": "cc244370a2d622d5d2fec5573ae87de6c59ed3b9",
        "repo": "redis/redis",
        "commit_url": "https://github.com/redis/redis/commit/cc244370a2d622d5d2fec5573ae87de6c59ed3b9",
        "files": [
          "00-RELEASENOTES",
          "src/version.h"
        ],
        "message": "Redis 7.2.1",
        "before_after_code_files": [
          "src/version.h||src/version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/redis/redis/pull/12553"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/version.h||src/version.h": [
          "File: src/version.h -> src/version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: #define REDIS_VERSION \"7.2.0\"",
          "2: #define REDIS_VERSION_NUM 0x00070200",
          "",
          "[Added Lines]",
          "1: #define REDIS_VERSION \"7.2.1\"",
          "2: #define REDIS_VERSION_NUM 0x00070201",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "3e7523aceb5190dc5355f01e388807286b89bb13",
      "candidate_info": {
        "commit_hash": "3e7523aceb5190dc5355f01e388807286b89bb13",
        "repo": "redis/redis",
        "commit_url": "https://github.com/redis/redis/commit/3e7523aceb5190dc5355f01e388807286b89bb13",
        "files": [
          "src/commands.def",
          "src/commands/acl-deluser.json",
          "src/commands/acl-save.json",
          "src/commands/acl-setuser.json",
          "src/commands/client-setinfo.json",
          "src/commands/client-setname.json",
          "src/commands/latency-reset.json"
        ],
        "message": "Update command tips on more admin / configuration commands (#12545)\n\nUpdated the command tips for ACL SAVE / SETUSER / DELUSER, CLIENT SETNAME / SETINFO, and LATENCY RESET.\nThe tips now match CONFIG SET, since there's a similar behavior for all of these commands - the\nuser expects to update the various configurations & states on all nodes, not only on a single, random node.\nFor LATENCY RESET the response tip is now agg_sum.\n\nCo-authored-by: Shachar Langbeheim <shachlan@amazon.com>\n(cherry picked from commit 90e9fc387c81d48d3d82ea7fcd2d3b6d896bf923)",
        "before_after_code_files": [
          "src/commands.def||src/commands.def"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/redis/redis/pull/12553"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/commands.def||src/commands.def": [
          "File: src/commands.def -> src/commands.def",
          "--- Hunk 1 ---",
          "[Context before]",
          "1392: #ifndef SKIP_CMD_TIPS_TABLE",
          "1395: #endif",
          "1397: #ifndef SKIP_CMD_KEY_SPECS_TABLE",
          "",
          "[Removed Lines]",
          "1394: #define CLIENT_SETINFO_Tips NULL",
          "",
          "[Added Lines]",
          "1394: const char *CLIENT_SETINFO_Tips[] = {",
          "1395: \"request_policy:all_nodes\",",
          "1396: \"response_policy:all_succeeded\",",
          "1397: };",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1420: #ifndef SKIP_CMD_TIPS_TABLE",
          "1423: #endif",
          "1425: #ifndef SKIP_CMD_KEY_SPECS_TABLE",
          "",
          "[Removed Lines]",
          "1422: #define CLIENT_SETNAME_Tips NULL",
          "",
          "[Added Lines]",
          "1425: const char *CLIENT_SETNAME_Tips[] = {",
          "1426: \"request_policy:all_nodes\",",
          "1427: \"response_policy:all_succeeded\",",
          "1428: };",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1543: {MAKE_CMD(\"no-touch\",\"Controls whether commands sent by the client affect the LRU/LFU of accessed keys.\",\"O(1)\",\"7.2.0\",CMD_DOC_NONE,NULL,NULL,\"connection\",COMMAND_GROUP_CONNECTION,CLIENT_NO_TOUCH_History,0,CLIENT_NO_TOUCH_Tips,0,clientCommand,3,CMD_NOSCRIPT|CMD_LOADING|CMD_STALE,ACL_CATEGORY_CONNECTION,CLIENT_NO_TOUCH_Keyspecs,0,NULL,1),.args=CLIENT_NO_TOUCH_Args},",
          "1544: {MAKE_CMD(\"pause\",\"Suspends commands processing.\",\"O(1)\",\"3.0.0\",CMD_DOC_NONE,NULL,NULL,\"connection\",COMMAND_GROUP_CONNECTION,CLIENT_PAUSE_History,1,CLIENT_PAUSE_Tips,0,clientCommand,-3,CMD_ADMIN|CMD_NOSCRIPT|CMD_LOADING|CMD_STALE|CMD_SENTINEL,ACL_CATEGORY_CONNECTION,CLIENT_PAUSE_Keyspecs,0,NULL,2),.args=CLIENT_PAUSE_Args},",
          "1545: {MAKE_CMD(\"reply\",\"Instructs the server whether to reply to commands.\",\"O(1)\",\"3.2.0\",CMD_DOC_NONE,NULL,NULL,\"connection\",COMMAND_GROUP_CONNECTION,CLIENT_REPLY_History,0,CLIENT_REPLY_Tips,0,clientCommand,3,CMD_NOSCRIPT|CMD_LOADING|CMD_STALE|CMD_SENTINEL,ACL_CATEGORY_CONNECTION,CLIENT_REPLY_Keyspecs,0,NULL,1),.args=CLIENT_REPLY_Args},",
          "1548: {MAKE_CMD(\"tracking\",\"Controls server-assisted client-side caching for the connection.\",\"O(1). Some options may introduce additional complexity.\",\"6.0.0\",CMD_DOC_NONE,NULL,NULL,\"connection\",COMMAND_GROUP_CONNECTION,CLIENT_TRACKING_History,0,CLIENT_TRACKING_Tips,0,clientCommand,-3,CMD_NOSCRIPT|CMD_LOADING|CMD_STALE|CMD_SENTINEL,ACL_CATEGORY_CONNECTION,CLIENT_TRACKING_Keyspecs,0,NULL,7),.args=CLIENT_TRACKING_Args},",
          "1549: {MAKE_CMD(\"trackinginfo\",\"Returns information about server-assisted client-side caching for the connection.\",\"O(1)\",\"6.2.0\",CMD_DOC_NONE,NULL,NULL,\"connection\",COMMAND_GROUP_CONNECTION,CLIENT_TRACKINGINFO_History,0,CLIENT_TRACKINGINFO_Tips,0,clientCommand,2,CMD_NOSCRIPT|CMD_LOADING|CMD_STALE|CMD_SENTINEL,ACL_CATEGORY_CONNECTION,CLIENT_TRACKINGINFO_Keyspecs,0,NULL,0)},",
          "1550: {MAKE_CMD(\"unblock\",\"Unblocks a client blocked by a blocking command from a different connection.\",\"O(log N) where N is the number of client connections\",\"5.0.0\",CMD_DOC_NONE,NULL,NULL,\"connection\",COMMAND_GROUP_CONNECTION,CLIENT_UNBLOCK_History,0,CLIENT_UNBLOCK_Tips,0,clientCommand,-3,CMD_ADMIN|CMD_NOSCRIPT|CMD_LOADING|CMD_STALE|CMD_SENTINEL,ACL_CATEGORY_CONNECTION,CLIENT_UNBLOCK_Keyspecs,0,NULL,2),.args=CLIENT_UNBLOCK_Args},",
          "",
          "[Removed Lines]",
          "1546: {MAKE_CMD(\"setinfo\",\"Sets information specific to the client or connection.\",\"O(1)\",\"7.2.0\",CMD_DOC_NONE,NULL,NULL,\"connection\",COMMAND_GROUP_CONNECTION,CLIENT_SETINFO_History,0,CLIENT_SETINFO_Tips,0,clientSetinfoCommand,4,CMD_NOSCRIPT|CMD_LOADING|CMD_STALE|CMD_SENTINEL,ACL_CATEGORY_CONNECTION,CLIENT_SETINFO_Keyspecs,0,NULL,1),.args=CLIENT_SETINFO_Args},",
          "1547: {MAKE_CMD(\"setname\",\"Sets the connection name.\",\"O(1)\",\"2.6.9\",CMD_DOC_NONE,NULL,NULL,\"connection\",COMMAND_GROUP_CONNECTION,CLIENT_SETNAME_History,0,CLIENT_SETNAME_Tips,0,clientCommand,3,CMD_NOSCRIPT|CMD_LOADING|CMD_STALE|CMD_SENTINEL,ACL_CATEGORY_CONNECTION,CLIENT_SETNAME_Keyspecs,0,NULL,1),.args=CLIENT_SETNAME_Args},",
          "",
          "[Added Lines]",
          "1552: {MAKE_CMD(\"setinfo\",\"Sets information specific to the client or connection.\",\"O(1)\",\"7.2.0\",CMD_DOC_NONE,NULL,NULL,\"connection\",COMMAND_GROUP_CONNECTION,CLIENT_SETINFO_History,0,CLIENT_SETINFO_Tips,2,clientSetinfoCommand,4,CMD_NOSCRIPT|CMD_LOADING|CMD_STALE|CMD_SENTINEL,ACL_CATEGORY_CONNECTION,CLIENT_SETINFO_Keyspecs,0,NULL,1),.args=CLIENT_SETINFO_Args},",
          "1553: {MAKE_CMD(\"setname\",\"Sets the connection name.\",\"O(1)\",\"2.6.9\",CMD_DOC_NONE,NULL,NULL,\"connection\",COMMAND_GROUP_CONNECTION,CLIENT_SETNAME_History,0,CLIENT_SETNAME_Tips,2,clientCommand,3,CMD_NOSCRIPT|CMD_LOADING|CMD_STALE|CMD_SENTINEL,ACL_CATEGORY_CONNECTION,CLIENT_SETNAME_Keyspecs,0,NULL,1),.args=CLIENT_SETNAME_Args},",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "5887: #ifndef SKIP_CMD_TIPS_TABLE",
          "5890: #endif",
          "5892: #ifndef SKIP_CMD_KEY_SPECS_TABLE",
          "",
          "[Removed Lines]",
          "5889: #define ACL_DELUSER_Tips NULL",
          "",
          "[Added Lines]",
          "5895: const char *ACL_DELUSER_Tips[] = {",
          "5896: \"request_policy:all_nodes\",",
          "5897: \"response_policy:all_succeeded\",",
          "5898: };",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "6061: #ifndef SKIP_CMD_TIPS_TABLE",
          "6064: #endif",
          "6066: #ifndef SKIP_CMD_KEY_SPECS_TABLE",
          "",
          "[Removed Lines]",
          "6063: #define ACL_SAVE_Tips NULL",
          "",
          "[Added Lines]",
          "6072: const char *ACL_SAVE_Tips[] = {",
          "6073: \"request_policy:all_nodes\",",
          "6074: \"response_policy:all_succeeded\",",
          "6075: };",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "6081: #ifndef SKIP_CMD_TIPS_TABLE",
          "6084: #endif",
          "6086: #ifndef SKIP_CMD_KEY_SPECS_TABLE",
          "",
          "[Removed Lines]",
          "6083: #define ACL_SETUSER_Tips NULL",
          "",
          "[Added Lines]",
          "6095: const char *ACL_SETUSER_Tips[] = {",
          "6096: \"request_policy:all_nodes\",",
          "6097: \"response_policy:all_succeeded\",",
          "6098: };",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "6132: struct COMMAND_STRUCT ACL_Subcommands[] = {",
          "6133: {MAKE_CMD(\"cat\",\"Lists the ACL categories, or the commands inside a category.\",\"O(1) since the categories and commands are a fixed set.\",\"6.0.0\",CMD_DOC_NONE,NULL,NULL,\"server\",COMMAND_GROUP_SERVER,ACL_CAT_History,0,ACL_CAT_Tips,0,aclCommand,-2,CMD_NOSCRIPT|CMD_LOADING|CMD_STALE|CMD_SENTINEL,0,ACL_CAT_Keyspecs,0,NULL,1),.args=ACL_CAT_Args},",
          "6135: {MAKE_CMD(\"dryrun\",\"Simulates the execution of a command by a user, without executing the command.\",\"O(1).\",\"7.0.0\",CMD_DOC_NONE,NULL,NULL,\"server\",COMMAND_GROUP_SERVER,ACL_DRYRUN_History,0,ACL_DRYRUN_Tips,0,aclCommand,-4,CMD_ADMIN|CMD_NOSCRIPT|CMD_LOADING|CMD_STALE|CMD_SENTINEL,0,ACL_DRYRUN_Keyspecs,0,NULL,3),.args=ACL_DRYRUN_Args},",
          "6136: {MAKE_CMD(\"genpass\",\"Generates a pseudorandom, secure password that can be used to identify ACL users.\",\"O(1)\",\"6.0.0\",CMD_DOC_NONE,NULL,NULL,\"server\",COMMAND_GROUP_SERVER,ACL_GENPASS_History,0,ACL_GENPASS_Tips,0,aclCommand,-2,CMD_NOSCRIPT|CMD_LOADING|CMD_STALE|CMD_SENTINEL,0,ACL_GENPASS_Keyspecs,0,NULL,1),.args=ACL_GENPASS_Args},",
          "6137: {MAKE_CMD(\"getuser\",\"Lists the ACL rules of a user.\",\"O(N). Where N is the number of password, command and pattern rules that the user has.\",\"6.0.0\",CMD_DOC_NONE,NULL,NULL,\"server\",COMMAND_GROUP_SERVER,ACL_GETUSER_History,2,ACL_GETUSER_Tips,0,aclCommand,3,CMD_ADMIN|CMD_NOSCRIPT|CMD_LOADING|CMD_STALE|CMD_SENTINEL,0,ACL_GETUSER_Keyspecs,0,NULL,1),.args=ACL_GETUSER_Args},",
          "",
          "[Removed Lines]",
          "6134: {MAKE_CMD(\"deluser\",\"Deletes ACL users, and terminates their connections.\",\"O(1) amortized time considering the typical user.\",\"6.0.0\",CMD_DOC_NONE,NULL,NULL,\"server\",COMMAND_GROUP_SERVER,ACL_DELUSER_History,0,ACL_DELUSER_Tips,0,aclCommand,-3,CMD_ADMIN|CMD_NOSCRIPT|CMD_LOADING|CMD_STALE|CMD_SENTINEL,0,ACL_DELUSER_Keyspecs,0,NULL,1),.args=ACL_DELUSER_Args},",
          "",
          "[Added Lines]",
          "6149: {MAKE_CMD(\"deluser\",\"Deletes ACL users, and terminates their connections.\",\"O(1) amortized time considering the typical user.\",\"6.0.0\",CMD_DOC_NONE,NULL,NULL,\"server\",COMMAND_GROUP_SERVER,ACL_DELUSER_History,0,ACL_DELUSER_Tips,2,aclCommand,-3,CMD_ADMIN|CMD_NOSCRIPT|CMD_LOADING|CMD_STALE|CMD_SENTINEL,0,ACL_DELUSER_Keyspecs,0,NULL,1),.args=ACL_DELUSER_Args},",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "6139: {MAKE_CMD(\"list\",\"Dumps the effective rules in ACL file format.\",\"O(N). Where N is the number of configured users.\",\"6.0.0\",CMD_DOC_NONE,NULL,NULL,\"server\",COMMAND_GROUP_SERVER,ACL_LIST_History,0,ACL_LIST_Tips,0,aclCommand,2,CMD_ADMIN|CMD_NOSCRIPT|CMD_LOADING|CMD_STALE|CMD_SENTINEL,0,ACL_LIST_Keyspecs,0,NULL,0)},",
          "6140: {MAKE_CMD(\"load\",\"Reloads the rules from the configured ACL file.\",\"O(N). Where N is the number of configured users.\",\"6.0.0\",CMD_DOC_NONE,NULL,NULL,\"server\",COMMAND_GROUP_SERVER,ACL_LOAD_History,0,ACL_LOAD_Tips,0,aclCommand,2,CMD_ADMIN|CMD_NOSCRIPT|CMD_LOADING|CMD_STALE|CMD_SENTINEL,0,ACL_LOAD_Keyspecs,0,NULL,0)},",
          "6141: {MAKE_CMD(\"log\",\"Lists recent security events generated due to ACL rules.\",\"O(N) with N being the number of entries shown.\",\"6.0.0\",CMD_DOC_NONE,NULL,NULL,\"server\",COMMAND_GROUP_SERVER,ACL_LOG_History,1,ACL_LOG_Tips,0,aclCommand,-2,CMD_ADMIN|CMD_NOSCRIPT|CMD_LOADING|CMD_STALE|CMD_SENTINEL,0,ACL_LOG_Keyspecs,0,NULL,1),.args=ACL_LOG_Args},",
          "6144: {MAKE_CMD(\"users\",\"Lists all ACL users.\",\"O(N). Where N is the number of configured users.\",\"6.0.0\",CMD_DOC_NONE,NULL,NULL,\"server\",COMMAND_GROUP_SERVER,ACL_USERS_History,0,ACL_USERS_Tips,0,aclCommand,2,CMD_ADMIN|CMD_NOSCRIPT|CMD_LOADING|CMD_STALE|CMD_SENTINEL,0,ACL_USERS_Keyspecs,0,NULL,0)},",
          "6145: {MAKE_CMD(\"whoami\",\"Returns the authenticated username of the current connection.\",\"O(1)\",\"6.0.0\",CMD_DOC_NONE,NULL,NULL,\"server\",COMMAND_GROUP_SERVER,ACL_WHOAMI_History,0,ACL_WHOAMI_Tips,0,aclCommand,2,CMD_NOSCRIPT|CMD_LOADING|CMD_STALE|CMD_SENTINEL,0,ACL_WHOAMI_Keyspecs,0,NULL,0)},",
          "6146: {0}",
          "",
          "[Removed Lines]",
          "6142: {MAKE_CMD(\"save\",\"Saves the effective ACL rules in the configured ACL file.\",\"O(N). Where N is the number of configured users.\",\"6.0.0\",CMD_DOC_NONE,NULL,NULL,\"server\",COMMAND_GROUP_SERVER,ACL_SAVE_History,0,ACL_SAVE_Tips,0,aclCommand,2,CMD_ADMIN|CMD_NOSCRIPT|CMD_LOADING|CMD_STALE|CMD_SENTINEL,0,ACL_SAVE_Keyspecs,0,NULL,0)},",
          "6143: {MAKE_CMD(\"setuser\",\"Creates and modifies an ACL user and its rules.\",\"O(N). Where N is the number of rules provided.\",\"6.0.0\",CMD_DOC_NONE,NULL,NULL,\"server\",COMMAND_GROUP_SERVER,ACL_SETUSER_History,2,ACL_SETUSER_Tips,0,aclCommand,-3,CMD_ADMIN|CMD_NOSCRIPT|CMD_LOADING|CMD_STALE|CMD_SENTINEL,0,ACL_SETUSER_Keyspecs,0,NULL,2),.args=ACL_SETUSER_Args},",
          "",
          "[Added Lines]",
          "6157: {MAKE_CMD(\"save\",\"Saves the effective ACL rules in the configured ACL file.\",\"O(N). Where N is the number of configured users.\",\"6.0.0\",CMD_DOC_NONE,NULL,NULL,\"server\",COMMAND_GROUP_SERVER,ACL_SAVE_History,0,ACL_SAVE_Tips,2,aclCommand,2,CMD_ADMIN|CMD_NOSCRIPT|CMD_LOADING|CMD_STALE|CMD_SENTINEL,0,ACL_SAVE_Keyspecs,0,NULL,0)},",
          "6158: {MAKE_CMD(\"setuser\",\"Creates and modifies an ACL user and its rules.\",\"O(N). Where N is the number of rules provided.\",\"6.0.0\",CMD_DOC_NONE,NULL,NULL,\"server\",COMMAND_GROUP_SERVER,ACL_SETUSER_History,2,ACL_SETUSER_Tips,2,aclCommand,-3,CMD_ADMIN|CMD_NOSCRIPT|CMD_LOADING|CMD_STALE|CMD_SENTINEL,0,ACL_SETUSER_Keyspecs,0,NULL,2),.args=ACL_SETUSER_Args},",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "6869: const char *LATENCY_RESET_Tips[] = {",
          "6870: \"request_policy:all_nodes\",",
          "6872: };",
          "6873: #endif",
          "",
          "[Removed Lines]",
          "6871: \"response_policy:all_succeeded\",",
          "",
          "[Added Lines]",
          "6886: \"response_policy:agg_sum\",",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "459acdeeb131dffe90721741b435a5a2ec667b58",
      "candidate_info": {
        "commit_hash": "459acdeeb131dffe90721741b435a5a2ec667b58",
        "repo": "redis/redis",
        "commit_url": "https://github.com/redis/redis/commit/459acdeeb131dffe90721741b435a5a2ec667b58",
        "files": [
          "src/cluster.c"
        ],
        "message": "Check shard_id pointer validity in updateShardId (#12538)\n\nWhen connecting between a 7.0 and 7.2 cluster, the 7.0 cluster will not populate the shard_id field, which is expect on the 7.2 cluster. This is not intended behavior, as the 7.2 cluster is supposed to use a temporary shard_id while the node is in the upgrading state, but it wasn't being correctly set in this case.\n\n(cherry picked from commit a2046c1eb1bcfcdeffadfffffad3b1f635965652)",
        "before_after_code_files": [
          "src/cluster.c||src/cluster.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/redis/redis/pull/12553"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/cluster.c||src/cluster.c": [
          "File: src/cluster.c -> src/cluster.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "940: static void updateShardId(clusterNode *node, const char *shard_id) {",
          "942:         clusterRemoveNodeFromShard(node);",
          "943:         memcpy(node->shard_id, shard_id, CLUSTER_NAMELEN);",
          "944:         clusterAddNodeToShard(shard_id, node);",
          "945:         clusterDoBeforeSleep(CLUSTER_TODO_SAVE_CONFIG);",
          "946:     }",
          "948:         if (memcmp(myself->shard_id, shard_id, CLUSTER_NAMELEN) != 0) {",
          "",
          "[Removed Lines]",
          "941:     if (memcmp(node->shard_id, shard_id, CLUSTER_NAMELEN) != 0) {",
          "947:     if (myself != node && myself->slaveof == node) {",
          "",
          "[Added Lines]",
          "941:     if (shard_id && memcmp(node->shard_id, shard_id, CLUSTER_NAMELEN) != 0) {",
          "947:     if (shard_id && myself != node && myself->slaveof == node) {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "0b2cbf138e77f3dea2217ba3b950dc501ebeb2f2",
      "candidate_info": {
        "commit_hash": "0b2cbf138e77f3dea2217ba3b950dc501ebeb2f2",
        "repo": "redis/redis",
        "commit_url": "https://github.com/redis/redis/commit/0b2cbf138e77f3dea2217ba3b950dc501ebeb2f2",
        "files": [
          "src/commands/sort.json",
          "src/commands/sort_ro.json",
          "tests/unit/sort.tcl"
        ],
        "message": "Update sort_ro reply_schema to mention the null reply (#12534)\n\nAlso added a test to cover this case, so this can\ncover the reply schemas check.\n\n(cherry picked from commit 9ce8c54d74f40bc5a70f210c2b14cf89c031ee10)",
        "before_after_code_files": [
          "tests/unit/sort.tcl||tests/unit/sort.tcl"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/redis/redis/pull/12553"
        ],
        "olp_code_files": {
          "patch": [
            "tests/unit/sort.tcl||tests/unit/sort.tcl"
          ],
          "candidate": [
            "tests/unit/sort.tcl||tests/unit/sort.tcl"
          ]
        }
      },
      "candidate_diff": {
        "tests/unit/sort.tcl||tests/unit/sort.tcl": [
          "File: tests/unit/sort.tcl -> tests/unit/sort.tcl",
          "--- Hunk 1 ---",
          "[Context before]",
          "75:         assert_equal [lsort -integer $result] [r sort tosort GET #]",
          "76:     } {} {cluster:skip}",
          "79:         r del foo",
          "81:         assert_equal 16 [llength $res]",
          "82:         foreach item $res { assert_equal {} $item }",
          "83:     } {} {cluster:skip}",
          "85:     test \"SORT GET (key and hash) with sanity check\" {",
          "86:         set l1 [r sort tosort GET # GET weight_*]",
          "",
          "[Removed Lines]",
          "78:     test \"SORT GET <const>\" {",
          "80:         set res [r sort tosort GET foo]",
          "",
          "[Added Lines]",
          "78: foreach command {SORT SORT_RO} {",
          "79:     test \"$command GET <const>\" {",
          "81:         set res [r $command tosort GET foo]",
          "85: }",
          "",
          "---------------"
        ]
      }
    }
  ]
}