{
  "cve_id": "CVE-2018-18584",
  "cve_desc": "In mspack/cab.h in libmspack before 0.8alpha and cabextract before 1.8, the CAB block input buffer is one byte too small for the maximal Quantum block, leading to an out-of-bounds write.",
  "repo": "kyz/libmspack",
  "patch_hash": "40ef1b4093d77ad3a5cfcee1f5cb6108b3a3bcc2",
  "patch_info": {
    "commit_hash": "40ef1b4093d77ad3a5cfcee1f5cb6108b3a3bcc2",
    "repo": "kyz/libmspack",
    "commit_url": "https://github.com/kyz/libmspack/commit/40ef1b4093d77ad3a5cfcee1f5cb6108b3a3bcc2",
    "files": [
      "libmspack/ChangeLog",
      "libmspack/mspack/cab.h"
    ],
    "message": "CAB block input buffer is one byte too small for maximal Quantum block",
    "before_after_code_files": [
      "libmspack/mspack/cab.h||libmspack/mspack/cab.h"
    ]
  },
  "patch_diff": {
    "libmspack/mspack/cab.h||libmspack/mspack/cab.h": [
      "File: libmspack/mspack/cab.h -> libmspack/mspack/cab.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "70: #define CAB_BLOCKMAX (32768)",
      "71: #define CAB_INPUTMAX (CAB_BLOCKMAX+6144)",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "79: #define CAB_INPUTBUF (65535 + 1)",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "6b03a2b28a8bde44e2d20103c1e5aafe9b4e5b84",
      "candidate_info": {
        "commit_hash": "6b03a2b28a8bde44e2d20103c1e5aafe9b4e5b84",
        "repo": "kyz/libmspack",
        "commit_url": "https://github.com/kyz/libmspack/commit/6b03a2b28a8bde44e2d20103c1e5aafe9b4e5b84",
        "files": [
          "libmspack/mspack/cab.h",
          "libmspack/mspack/cabd.c"
        ],
        "message": "Give the unchecked salvage-mode max input size a name",
        "before_after_code_files": [
          "libmspack/mspack/cab.h||libmspack/mspack/cab.h",
          "libmspack/mspack/cabd.c||libmspack/mspack/cabd.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "libmspack/mspack/cab.h||libmspack/mspack/cab.h"
          ],
          "candidate": [
            "libmspack/mspack/cab.h||libmspack/mspack/cab.h"
          ]
        }
      },
      "candidate_diff": {
        "libmspack/mspack/cab.h||libmspack/mspack/cab.h": [
          "File: libmspack/mspack/cab.h -> libmspack/mspack/cab.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "79: #define CAB_INPUTBUF (65535 + 1)",
          "",
          "[Added Lines]",
          "79: #define CAB_INPUTMAX_SALVAGE (65535)",
          "80: #define CAB_INPUTBUF (CAB_INPUTMAX_SALVAGE + 1)",
          "",
          "---------------"
        ],
        "libmspack/mspack/cabd.c||libmspack/mspack/cabd.c": [
          "File: libmspack/mspack/cabd.c -> libmspack/mspack/cabd.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1329:     if (full_len > CAB_INPUTMAX) {",
          "1330:       D((\"block size %d > CAB_INPUTMAX\", full_len));",
          "1333:           return MSPACK_ERR_DATAFORMAT;",
          "1334:       }",
          "1335:     }",
          "",
          "[Removed Lines]",
          "1332:       if (!ignore_blocksize || full_len > 65535) {",
          "",
          "[Added Lines]",
          "1332:       if (!ignore_blocksize || full_len > CAB_INPUTMAX_SALVAGE) {",
          "",
          "---------------"
        ]
      }
    }
  ]
}