{
  "cve_id": "CVE-2024-4030",
  "cve_desc": "On Windows a directory returned by tempfile.mkdtemp() would not always have permissions set to restrict reading and writing to the temporary directory by other users, instead usually inheriting the correct permissions from the default location. Alternate configurations or users without a profile directory may not have the intended permissions.\n\nIf you\u2019re not using Windows or haven\u2019t changed the temporary directory location then you aren\u2019t affected by this vulnerability. On other platforms the returned directory is consistently readable and writable only by the current user.\n\nThis issue was caused by Python not supporting Unix permissions on Windows. The fix adds support for Unix \u201c700\u201d for the mkdir function on Windows which is used by mkdtemp() to ensure the newly created directory has the proper permissions.",
  "repo": "python/cpython",
  "patch_hash": "e1dfa978b1ad210d551385ad8073ec6154f53763",
  "patch_info": {
    "commit_hash": "e1dfa978b1ad210d551385ad8073ec6154f53763",
    "repo": "python/cpython",
    "commit_url": "https://github.com/python/cpython/commit/e1dfa978b1ad210d551385ad8073ec6154f53763",
    "files": [
      "Lib/test/test_os.py",
      "Modules/posixmodule.c"
    ],
    "message": "gh-118486: Simplify test_win32_mkdir_700 to check the exact ACL (GH-119056)\n\n(cherry picked from commit 94591dca510c796c7d40e9b4167ea56f2fdf28ca)\n\nCo-authored-by: Steve Dower <steve.dower@python.org>",
    "before_after_code_files": [
      "Lib/test/test_os.py||Lib/test/test_os.py",
      "Modules/posixmodule.c||Modules/posixmodule.c"
    ]
  },
  "patch_diff": {
    "Lib/test/test_os.py||Lib/test/test_os.py": [
      "File: Lib/test/test_os.py -> Lib/test/test_os.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "1814:     @unittest.skipUnless(os.name == 'nt', \"requires Windows\")",
      "1815:     def test_win32_mkdir_700(self):",
      "1816:         base = os_helper.TESTFN",
      "1833:     def tearDown(self):",
      "1834:         path = os.path.join(os_helper.TESTFN, 'dir1', 'dir2', 'dir3',",
      "",
      "[Removed Lines]",
      "1817:         path1 = os.path.join(os_helper.TESTFN, 'dir1')",
      "1818:         path2 = os.path.join(os_helper.TESTFN, 'dir2')",
      "1819:         # mode=0o700 is special-cased to override ACLs on Windows",
      "1820:         # There's no way to know exactly how the ACLs will look, so we'll",
      "1821:         # check that they are different from a regularly created directory.",
      "1822:         os.mkdir(path1, mode=0o700)",
      "1823:         os.mkdir(path2, mode=0o777)",
      "1825:         out1 = subprocess.check_output([\"icacls.exe\", path1], encoding=\"oem\")",
      "1826:         out2 = subprocess.check_output([\"icacls.exe\", path2], encoding=\"oem\")",
      "1827:         os.rmdir(path1)",
      "1828:         os.rmdir(path2)",
      "1829:         out1 = out1.replace(path1, \"<PATH>\")",
      "1830:         out2 = out2.replace(path2, \"<PATH>\")",
      "1831:         self.assertNotEqual(out1, out2)",
      "",
      "[Added Lines]",
      "1817:         path = os.path.abspath(os.path.join(os_helper.TESTFN, 'dir'))",
      "1818:         os.mkdir(path, mode=0o700)",
      "1819:         out = subprocess.check_output([\"cacls.exe\", path, \"/s\"], encoding=\"oem\")",
      "1820:         os.rmdir(path)",
      "1821:         self.assertEqual(",
      "1822:             out.strip(),",
      "1823:             f'{path} \"D:P(A;OICI;FA;;;SY)(A;OICI;FA;;;BA)(A;OICI;FA;;;OW)\"',",
      "1824:         )",
      "",
      "---------------"
    ],
    "Modules/posixmodule.c||Modules/posixmodule.c": [
      "File: Modules/posixmodule.c -> Modules/posixmodule.c"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "396f8b0b98441344e1d3223a4075e5e342e0c2df",
      "candidate_info": {
        "commit_hash": "396f8b0b98441344e1d3223a4075e5e342e0c2df",
        "repo": "python/cpython",
        "commit_url": "https://github.com/python/cpython/commit/396f8b0b98441344e1d3223a4075e5e342e0c2df",
        "files": [
          "Lib/test/test_descr.py",
          "Lib/test/test_free_threading/test_slots.py",
          "Python/structmember.c",
          "Tools/tsan/suppressions_free_threading.txt"
        ],
        "message": "[3.13] gh-117657:  Fix `__slots__` thread safety in free-threaded build (GH-119368) (#120655)\n\nFix a race in `PyMember_GetOne` and `PyMember_SetOne` for `Py_T_OBJECT_EX`.\nThese functions implement `__slots__` accesses for Python objects.\n(cherry picked from commit 362cd2680b45a36c3467b9721ff7fc0ceb338452)\n\nCo-authored-by: Daniele Parmeggiani <8658291+dpdani@users.noreply.github.com>",
        "before_after_code_files": [
          "Lib/test/test_descr.py||Lib/test/test_descr.py",
          "Lib/test/test_free_threading/test_slots.py||Lib/test/test_free_threading/test_slots.py",
          "Python/structmember.c||Python/structmember.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/AcreetionOS-Linux/python/pull/2"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "Lib/test/test_descr.py||Lib/test/test_descr.py": [
          "File: Lib/test/test_descr.py -> Lib/test/test_descr.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "1314:         # Inherit from object on purpose to check some backwards compatibility paths",
          "1315:         class X(object):",
          "1316:             __slots__ = \"a\"",
          "1318:             X().a",
          "1320:         # Test string subclass in `__slots__`, see gh-98783",
          "",
          "[Removed Lines]",
          "1317:         with self.assertRaisesRegex(AttributeError, \"'X' object has no attribute 'a'\"):",
          "",
          "[Added Lines]",
          "1317:         with self.assertRaisesRegex(AttributeError, \"'test.test_descr.ClassPropertiesAndMethods.test_slots.<locals>.X' object has no attribute 'a'\"):",
          "",
          "---------------"
        ],
        "Lib/test/test_free_threading/test_slots.py||Lib/test/test_free_threading/test_slots.py": [
          "File: Lib/test/test_free_threading/test_slots.py -> Lib/test/test_free_threading/test_slots.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: import threading",
          "2: from test.support import threading_helper",
          "3: from unittest import TestCase",
          "6: def run_in_threads(targets):",
          "7:     \"\"\"Run `targets` in separate threads\"\"\"",
          "8:     threads = [",
          "9:         threading.Thread(target=target)",
          "10:         for target in targets",
          "11:     ]",
          "12:     for thread in threads:",
          "13:         thread.start()",
          "14:     for thread in threads:",
          "15:         thread.join()",
          "18: @threading_helper.requires_working_threading()",
          "19: class TestSlots(TestCase):",
          "21:     def test_object(self):",
          "22:         class Spam:",
          "23:             __slots__ = [",
          "24:                 \"eggs\",",
          "25:             ]",
          "27:             def __init__(self, initial_value):",
          "28:                 self.eggs = initial_value",
          "30:         spam = Spam(0)",
          "31:         iters = 20_000",
          "33:         def writer():",
          "34:             for _ in range(iters):",
          "35:                 spam.eggs += 1",
          "37:         def reader():",
          "38:             for _ in range(iters):",
          "39:                 eggs = spam.eggs",
          "40:                 assert type(eggs) is int",
          "41:                 assert 0 <= eggs <= iters",
          "43:         run_in_threads([writer, reader, reader, reader])",
          "",
          "---------------"
        ],
        "Python/structmember.c||Python/structmember.c": [
          "File: Python/structmember.c -> Python/structmember.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "4: #include \"Python.h\"",
          "5: #include \"pycore_abstract.h\"      // _PyNumber_Index()",
          "6: #include \"pycore_long.h\"          // _PyLong_IsNegative()",
          "9: PyObject *",
          "10: PyMember_GetOne(const char *obj_addr, PyMemberDef *l)",
          "11: {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "7: #include \"pycore_object.h\"        // _Py_TryIncrefCompare(), FT_ATOMIC_*()",
          "8: #include \"pycore_critical_section.h\"",
          "11: static inline PyObject *",
          "12: member_get_object(const char *addr, const char *obj_addr, PyMemberDef *l)",
          "13: {",
          "14:     PyObject *v = FT_ATOMIC_LOAD_PTR(*(PyObject **) addr);",
          "15:     if (v == NULL) {",
          "16:         PyErr_Format(PyExc_AttributeError,",
          "17:                      \"'%T' object has no attribute '%s'\",",
          "18:                      (PyObject *)obj_addr, l->name);",
          "19:     }",
          "20:     return v;",
          "21: }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "75:         Py_INCREF(v);",
          "76:         break;",
          "77:     case Py_T_OBJECT_EX:",
          "86:         Py_XINCREF(v);",
          "87:         break;",
          "88:     case Py_T_LONGLONG:",
          "89:         v = PyLong_FromLongLong(*(long long *)addr);",
          "",
          "[Removed Lines]",
          "78:         v = *(PyObject **)addr;",
          "79:         if (v == NULL) {",
          "80:             PyObject *obj = (PyObject *)obj_addr;",
          "81:             PyTypeObject *tp = Py_TYPE(obj);",
          "82:             PyErr_Format(PyExc_AttributeError,",
          "83:                          \"'%.200s' object has no attribute '%s'\",",
          "84:                          tp->tp_name, l->name);",
          "85:         }",
          "",
          "[Added Lines]",
          "92:         v = member_get_object(addr, obj_addr, l);",
          "93: #ifndef Py_GIL_DISABLED",
          "95: #else",
          "96:         if (v != NULL) {",
          "97:             if (!_Py_TryIncrefCompare((PyObject **) addr, v)) {",
          "98:                 Py_BEGIN_CRITICAL_SECTION((PyObject *) obj_addr);",
          "99:                 v = member_get_object(addr, obj_addr, l);",
          "100:                 Py_XINCREF(v);",
          "101:                 Py_END_CRITICAL_SECTION();",
          "102:             }",
          "103:         }",
          "104: #endif",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "118:         return -1;",
          "119:     }",
          "121:     addr += l->offset;",
          "123:     if ((l->flags & Py_READONLY))",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "140: #ifdef Py_GIL_DISABLED",
          "141:     PyObject *obj = (PyObject *) addr;",
          "142: #endif",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "281:         break;",
          "282:     case _Py_T_OBJECT:",
          "283:     case Py_T_OBJECT_EX:",
          "284:         oldv = *(PyObject **)addr;",
          "286:         Py_XDECREF(oldv);",
          "287:         break;",
          "288:     case Py_T_CHAR: {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "306:         Py_BEGIN_CRITICAL_SECTION(obj);",
          "308:         FT_ATOMIC_STORE_PTR_RELEASE(*(PyObject **)addr, Py_XNewRef(v));",
          "309:         Py_END_CRITICAL_SECTION();",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "978b86a91e381bf7cc987ac3e44b0251e4a474ba",
      "candidate_info": {
        "commit_hash": "978b86a91e381bf7cc987ac3e44b0251e4a474ba",
        "repo": "python/cpython",
        "commit_url": "https://github.com/python/cpython/commit/978b86a91e381bf7cc987ac3e44b0251e4a474ba",
        "files": [
          "Lib/test/test_tkinter/test_widgets.py",
          "Lib/test/test_ttk/test_widgets.py"
        ],
        "message": "[3.13] gh-107262: Update Tkinter tests for Tcl/Tk 8.6.14 (GH-119322) (GH-119806)\n\n(cherry picked from commit 9732ed5ca94cd8fe9ca2fc7ba5a42dfa2b7791ea)\n\nCo-authored-by: James De Bias <81095953+DBJim@users.noreply.github.com>\nCo-authored-by: Serhiy Storchaka <storchaka@gmail.com>",
        "before_after_code_files": [
          "Lib/test/test_tkinter/test_widgets.py||Lib/test/test_tkinter/test_widgets.py",
          "Lib/test/test_ttk/test_widgets.py||Lib/test/test_ttk/test_widgets.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/AcreetionOS-Linux/python/pull/2"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "Lib/test/test_tkinter/test_widgets.py||Lib/test/test_tkinter/test_widgets.py": [
          "File: Lib/test/test_tkinter/test_widgets.py -> Lib/test/test_tkinter/test_widgets.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "660:         widget = self.create()",
          "661:         self.checkParam(widget, 'tabs', (10.2, 20.7, '1i', '2i'))",
          "662:         self.checkParam(widget, 'tabs', '10.2 20.7 1i 2i',",
          "664:         self.checkParam(widget, 'tabs', '2c left 4c 6c center',",
          "665:                         expected=('2c', 'left', '4c', '6c', 'center'))",
          "666:         self.checkInvalidParam(widget, 'tabs', 'spam',",
          "",
          "[Removed Lines]",
          "663:                         expected=('10.2', '20.7', '1i', '2i'))",
          "",
          "[Added Lines]",
          "663:                         expected=(10.2, 20.7, '1i', '2i')",
          "664:                                  if get_tk_patchlevel(self.root) >= (8, 6, 14)",
          "665:                                  else ('10.2', '20.7', '1i', '2i'))",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "999:             widget.itemconfigure()",
          "1000:         with self.assertRaisesRegex(TclError, 'bad listbox index \"red\"'):",
          "1001:             widget.itemconfigure('red')",
          "1002:         self.assertEqual(widget.itemconfigure(0, 'background'),",
          "1004:         self.assertEqual(widget.itemconfigure('end', 'background'),",
          "1006:         self.assertEqual(widget.itemconfigure('@0,0', 'background'),",
          "1009:         d = widget.itemconfigure(0)",
          "1010:         self.assertIsInstance(d, dict)",
          "",
          "[Removed Lines]",
          "1003:                          ('background', 'background', 'Background', '', 'red'))",
          "1005:                          ('background', 'background', 'Background', '', 'violet'))",
          "1007:                          ('background', 'background', 'Background', '', 'red'))",
          "",
          "[Added Lines]",
          "1004:         if get_tk_patchlevel(self.root) >= (8, 6, 14):",
          "1005:             prefix = ('background', '', '', '')",
          "1006:         else:",
          "1007:             prefix = ('background', 'background', 'Background', '')",
          "1009:                          (*prefix, 'red'))",
          "1011:                          (*prefix, 'violet'))",
          "1013:                          (*prefix, 'red'))",
          "",
          "---------------"
        ],
        "Lib/test/test_ttk/test_widgets.py||Lib/test/test_ttk/test_widgets.py": [
          "File: Lib/test/test_ttk/test_widgets.py -> Lib/test/test_ttk/test_widgets.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "28:     def test_configure_padding(self):",
          "29:         widget = self.create()",
          "33:         self.checkParam(widget, 'padding', (5, 6, 7),",
          "35:         self.checkParam(widget, 'padding', (5, 6, 7, 8),",
          "37:         self.checkParam(widget, 'padding', ('5p', '6p', '7p', '8p'))",
          "38:         self.checkParam(widget, 'padding', (), expected='')",
          "",
          "[Removed Lines]",
          "30:         self.checkParam(widget, 'padding', 0, expected=('0',))",
          "31:         self.checkParam(widget, 'padding', 5, expected=('5',))",
          "32:         self.checkParam(widget, 'padding', (5, 6), expected=('5', '6'))",
          "34:                         expected=('5', '6', '7'))",
          "36:                         expected=('5', '6', '7', '8'))",
          "",
          "[Added Lines]",
          "30:         if get_tk_patchlevel(self.root) < (8, 6, 14):",
          "31:             def padding_conv(value):",
          "32:                 self.assertIsInstance(value, tuple)",
          "33:                 return tuple(map(str, value))",
          "34:         else:",
          "35:             padding_conv = None",
          "36:         self.checkParam(widget, 'padding', 0, expected=(0,), conv=padding_conv)",
          "37:         self.checkParam(widget, 'padding', 5, expected=(5,), conv=padding_conv)",
          "38:         self.checkParam(widget, 'padding', (5, 6),",
          "39:                         expected=(5, 6), conv=padding_conv)",
          "41:                         expected=(5, 6, 7), conv=padding_conv)",
          "43:                         expected=(5, 6, 7, 8), conv=padding_conv)",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "e6e4efcc86ffecb9884ff64d622f3c6b659b7220",
      "candidate_info": {
        "commit_hash": "e6e4efcc86ffecb9884ff64d622f3c6b659b7220",
        "repo": "python/cpython",
        "commit_url": "https://github.com/python/cpython/commit/e6e4efcc86ffecb9884ff64d622f3c6b659b7220",
        "files": [
          "Lib/_pyrepl/completing_reader.py",
          "Lib/_pyrepl/keymap.py",
          "Lib/test/test_pyrepl/test_keymap.py"
        ],
        "message": "[3.13] gh-119357: Increase test coverage for keymap in _pyrepl (GH-119358) (#119414)\n\n(cherry picked from commit 73ab83b27f105a4509046ce26e35f20d66625195)\n\nCo-authored-by: Eugene Triguba <eugenetriguba@gmail.com>\nCo-authored-by: \u0141ukasz Langa <lukasz@langa.pl>",
        "before_after_code_files": [
          "Lib/_pyrepl/completing_reader.py||Lib/_pyrepl/completing_reader.py",
          "Lib/_pyrepl/keymap.py||Lib/_pyrepl/keymap.py",
          "Lib/test/test_pyrepl/test_keymap.py||Lib/test/test_pyrepl/test_keymap.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/AcreetionOS-Linux/python/pull/2"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "Lib/_pyrepl/completing_reader.py||Lib/_pyrepl/completing_reader.py": [
          "File: Lib/_pyrepl/completing_reader.py -> Lib/_pyrepl/completing_reader.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "30: # types",
          "31: Command = commands.Command",
          "32: if False:",
          "36: def prefix(wordlist: list[str], j: int = 0) -> str:",
          "",
          "[Removed Lines]",
          "33:     from .types import Callback, SimpleContextManager, KeySpec, CommandName",
          "",
          "[Added Lines]",
          "33:     from .types import KeySpec, CommandName",
          "",
          "---------------"
        ],
        "Lib/_pyrepl/keymap.py||Lib/_pyrepl/keymap.py": [
          "File: Lib/_pyrepl/keymap.py -> Lib/_pyrepl/keymap.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "19: # CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.",
          "21: \"\"\"",
          "40: The extension to readline is that the sequence \\\\<KEY> denotes the",
          "43: Examples:",
          "46: `\\\\EOA'  - Escape - O - A (up, on my terminal)",
          "47: `\\\\<UP>' - the up arrow key",
          "49: `\\\\C-o', `\\\\c-o'  - control-o",
          "50: `\\\\M-.'  - meta-period",
          "51: `\\\\E.'   - ditto (that's how meta works for pyrepl)",
          "52: `\\\\<tab>', `\\\\<TAB>', `\\\\t', `\\\\011', '\\\\x09', '\\\\X09', '\\\\C-i', '\\\\C-I'",
          "54: \"\"\"",
          "56: _escapes = {",
          "",
          "[Removed Lines]",
          "22: functions for parsing keyspecs",
          "24: Support for turning keyspecs into appropriate sequences.",
          "26: pyrepl uses it's own bastardized keyspec format, which is meant to be",
          "27: a strict superset of readline's \\\"KEYSEQ\\\" format (which is to say",
          "28: that if you can come up with a spec readline accepts that this",
          "29: doesn't, you've found a bug and should tell me about it).",
          "31: Note that this is the `\\\\C-o' style of readline keyspec, not the",
          "32: `Control-o' sort.",
          "34: A keyspec is a string representing a sequence of keypresses that can",
          "35: be bound to a command.",
          "37: All characters other than the backslash represent themselves.  In the",
          "38: traditional manner, a backslash introduces a escape sequence.",
          "41: sequence of charaters produced by hitting KEY.",
          "45: `a'     - what you get when you hit the `a' key",
          "48: `\\\\<up>' - ditto (keynames are case insensitive)",
          "53:    - all of these are the tab character.  Can you think of any more?",
          "",
          "[Added Lines]",
          "22: Keymap contains functions for parsing keyspecs and turning keyspecs into",
          "23: appropriate sequences.",
          "25: A keyspec is a string representing a sequence of key presses that can",
          "26: be bound to a command. All characters other than the backslash represent",
          "27: themselves. In the traditional manner, a backslash introduces an escape",
          "28: sequence.",
          "30: pyrepl uses its own keyspec format that is meant to be a strict superset of",
          "31: readline's KEYSEQ format. This means that if a spec is found that readline",
          "32: accepts that this doesn't, it should be logged as a bug. Note that this means",
          "33: we're using the `\\\\C-o' style of readline's keyspec, not the `Control-o' sort.",
          "36: sequence of characters produced by hitting KEY.",
          "39: `a'      - what you get when you hit the `a' key",
          "42: `\\\\<up>' - ditto (keynames are case-insensitive)",
          "47:    - all of these are the tab character.",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "111:     pass",
          "115:     ctrl = 0",
          "116:     meta = 0",
          "117:     ret = \"\"",
          "",
          "[Removed Lines]",
          "114: def _parse_key1(key, s):",
          "",
          "[Added Lines]",
          "108: def parse_keys(keys: str) -> list[str]:",
          "109:     \"\"\"Parse keys in keyspec format to a sequence of keys.\"\"\"",
          "110:     s = 0",
          "111:     r: list[str] = []",
          "112:     while s < len(keys):",
          "113:         k, s = _parse_single_key_sequence(keys, s)",
          "114:         r.extend(k)",
          "115:     return r",
          "118: def _parse_single_key_sequence(key: str, s: int) -> tuple[list[str], int]:",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "183:             ret = f\"ctrl {ret}\"",
          "184:         else:",
          "185:             raise KeySpecError(\"\\\\C- followed by invalid key\")",
          "202: def compile_keymap(keymap, empty=b\"\"):",
          "",
          "[Removed Lines]",
          "186:     if meta:",
          "187:         ret = [\"\\033\", ret]",
          "188:     else:",
          "189:         ret = [ret]",
          "190:     return ret, s",
          "193: def parse_keys(key: str) -> list[str]:",
          "194:     s = 0",
          "195:     r = []",
          "196:     while s < len(key):",
          "197:         k, s = _parse_key1(key, s)",
          "198:         r.extend(k)",
          "199:     return r",
          "",
          "[Added Lines]",
          "191:     result = [ret], s",
          "192:     if meta:",
          "193:         result[0].insert(0, \"\\033\")",
          "194:     return result",
          "",
          "---------------"
        ],
        "Lib/test/test_pyrepl/test_keymap.py||Lib/test/test_pyrepl/test_keymap.py": [
          "File: Lib/test/test_pyrepl/test_keymap.py -> Lib/test/test_pyrepl/test_keymap.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: import unittest",
          "6: class TestParseKeys(unittest.TestCase):",
          "7:     def test_single_character(self):",
          "12:     def test_escape_sequences(self):",
          "19:     def test_control_sequences(self):",
          "24:     def test_meta_sequences(self):",
          "25:         self.assertEqual(parse_keys(\"\\\\M-a\"), [\"\\033\", \"a\"])",
          "26:         self.assertEqual(parse_keys(\"\\\\M-b\"), [\"\\033\", \"b\"])",
          "27:         self.assertEqual(parse_keys(\"\\\\M-c\"), [\"\\033\", \"c\"])",
          "35:     def test_combinations(self):",
          "36:         self.assertEqual(parse_keys(\"\\\\C-a\\\\n\\\\<up>\"), [\"\\x01\", \"\\n\", \"up\"])",
          "37:         self.assertEqual(parse_keys(\"\\\\M-a\\\\t\\\\<down>\"), [\"\\033\", \"a\", \"\\t\", \"down\"])",
          "40: class TestCompileKeymap(unittest.TestCase):",
          "41:     def test_empty_keymap(self):",
          "",
          "[Removed Lines]",
          "3: from _pyrepl.keymap import parse_keys, compile_keymap",
          "8:         self.assertEqual(parse_keys(\"a\"), [\"a\"])",
          "9:         self.assertEqual(parse_keys(\"b\"), [\"b\"])",
          "10:         self.assertEqual(parse_keys(\"1\"), [\"1\"])",
          "13:         self.assertEqual(parse_keys(\"\\\\n\"), [\"\\n\"])",
          "14:         self.assertEqual(parse_keys(\"\\\\t\"), [\"\\t\"])",
          "15:         self.assertEqual(parse_keys(\"\\\\\\\\\"), [\"\\\\\"])",
          "16:         self.assertEqual(parse_keys(\"\\\\'\"), [\"'\"])",
          "17:         self.assertEqual(parse_keys('\\\\\"'), ['\"'])",
          "20:         self.assertEqual(parse_keys(\"\\\\C-a\"), [\"\\x01\"])",
          "21:         self.assertEqual(parse_keys(\"\\\\C-b\"), [\"\\x02\"])",
          "22:         self.assertEqual(parse_keys(\"\\\\C-c\"), [\"\\x03\"])",
          "29:     def test_keynames(self):",
          "30:         self.assertEqual(parse_keys(\"\\\\<up>\"), [\"up\"])",
          "31:         self.assertEqual(parse_keys(\"\\\\<down>\"), [\"down\"])",
          "32:         self.assertEqual(parse_keys(\"\\\\<left>\"), [\"left\"])",
          "33:         self.assertEqual(parse_keys(\"\\\\<right>\"), [\"right\"])",
          "",
          "[Added Lines]",
          "1: import string",
          "4: from _pyrepl.keymap import _keynames, _escapes, parse_keys, compile_keymap, KeySpecError",
          "9:         \"\"\"Ensure that single ascii characters or single digits are parsed as single characters.\"\"\"",
          "10:         test_cases = [(key, [key]) for key in string.ascii_letters + string.digits]",
          "11:         for test_key, expected_keys in test_cases:",
          "12:             with self.subTest(f\"{test_key} should be parsed as {expected_keys}\"):",
          "13:                 self.assertEqual(parse_keys(test_key), expected_keys)",
          "15:     def test_keynames(self):",
          "16:         \"\"\"Ensure that keynames are parsed to their corresponding mapping.",
          "18:         A keyname is expected to be of the following form: \\\\<keyname> such as \\\\<left>",
          "19:         which would get parsed as \"left\".",
          "20:         \"\"\"",
          "21:         test_cases = [(f\"\\\\<{keyname}>\", [parsed_keyname]) for keyname, parsed_keyname in _keynames.items()]",
          "22:         for test_key, expected_keys in test_cases:",
          "23:             with self.subTest(f\"{test_key} should be parsed as {expected_keys}\"):",
          "24:                 self.assertEqual(parse_keys(test_key), expected_keys)",
          "27:         \"\"\"Ensure that escaping sequences are parsed to their corresponding mapping.\"\"\"",
          "28:         test_cases = [(f\"\\\\{escape}\", [parsed_escape]) for escape, parsed_escape in _escapes.items()]",
          "29:         for test_key, expected_keys in test_cases:",
          "30:             with self.subTest(f\"{test_key} should be parsed as {expected_keys}\"):",
          "31:                 self.assertEqual(parse_keys(test_key), expected_keys)",
          "34:         \"\"\"Ensure that supported control sequences are parsed successfully.\"\"\"",
          "35:         keys = [\"@\", \"[\", \"]\", \"\\\\\", \"^\", \"_\", \"\\\\<space>\", \"\\\\<delete>\"]",
          "36:         keys.extend(string.ascii_letters)",
          "37:         test_cases = [(f\"\\\\C-{key}\", chr(ord(key) & 0x1F)) for key in []]",
          "38:         for test_key, expected_keys in test_cases:",
          "39:             with self.subTest(f\"{test_key} should be parsed as {expected_keys}\"):",
          "40:                 self.assertEqual(parse_keys(test_key), expected_keys)",
          "51:     def test_keyspec_errors(self):",
          "52:         cases = [",
          "53:             (\"\\\\Ca\", \"\\\\C must be followed by `-'\"),",
          "54:             (\"\\\\ca\", \"\\\\C must be followed by `-'\"),",
          "55:             (\"\\\\C-\\\\C-\", \"doubled \\\\C-\"),",
          "56:             (\"\\\\Ma\", \"\\\\M must be followed by `-'\"),",
          "57:             (\"\\\\ma\", \"\\\\M must be followed by `-'\"),",
          "58:             (\"\\\\M-\\\\M-\", \"doubled \\\\M-\"),",
          "59:             (\"\\\\<left\", \"unterminated \\\\<\"),",
          "60:             (\"\\\\<unsupported>\", \"unrecognised keyname\"),",
          "61:             (\"\\\\\u5927\", \"unknown backslash escape\"),",
          "62:             (\"\\\\C-\\\\<backspace>\", \"\\\\C- followed by invalid key\")",
          "63:         ]",
          "64:         for test_keys, expected_err in cases:",
          "65:             with self.subTest(f\"{test_keys} should give error {expected_err}\"):",
          "66:                 with self.assertRaises(KeySpecError) as e:",
          "67:                     parse_keys(test_keys)",
          "68:                 self.assertIn(expected_err, str(e.exception))",
          "70:     def test_index_errors(self):",
          "71:         test_cases = [\"\\\\\", \"\\\\C\", \"\\\\C-\\\\C\"]",
          "72:         for test_keys in test_cases:",
          "73:             with self.assertRaises(IndexError):",
          "74:                 parse_keys(test_keys)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "72:         keymap = {b\"a\": {b\"b\": {b\"c\": \"action\"}}}",
          "73:         result = compile_keymap(keymap)",
          "74:         self.assertEqual(result, {b\"a\": {b\"b\": {b\"c\": \"action\"}}})",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "113:     def test_clashing_definitions(self):",
          "114:         km = {b'a': 'c', b'a' + b'b': 'd'}",
          "115:         with self.assertRaises(KeySpecError):",
          "116:             compile_keymap(km)",
          "118:     def test_non_bytes_key(self):",
          "119:         with self.assertRaises(TypeError):",
          "120:             compile_keymap({123: 'a'})",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "06c62d697a87822690342cd0d99d1cdbeca4ce9d",
      "candidate_info": {
        "commit_hash": "06c62d697a87822690342cd0d99d1cdbeca4ce9d",
        "repo": "python/cpython",
        "commit_url": "https://github.com/python/cpython/commit/06c62d697a87822690342cd0d99d1cdbeca4ce9d",
        "files": [
          "Doc/library/dataclasses.rst",
          "Lib/test/test_dataclasses/__init__.py"
        ],
        "message": "[3.13] gh-119260: Clarify is_dataclass Behavior for Subclasses in Documentation and Tests (GH-119480) (#119760)\n\ngh-119260: Clarify is_dataclass Behavior for Subclasses in Documentation and Tests (GH-119480)\n(cherry picked from commit bf4ff3ad2e362801e87c85fffd9e140b774cef26)\n\nCo-authored-by: Aditya Borikar <adityaborikar2@gmail.com>\nCo-authored-by: Carl Meyer <carl@oddbird.net>",
        "before_after_code_files": [
          "Lib/test/test_dataclasses/__init__.py||Lib/test/test_dataclasses/__init__.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/AcreetionOS-Linux/python/pull/2"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "Lib/test/test_dataclasses/__init__.py||Lib/test/test_dataclasses/__init__.py": [
          "File: Lib/test/test_dataclasses/__init__.py -> Lib/test/test_dataclasses/__init__.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "1547:         self.assertTrue(is_dataclass(type(a)))",
          "1548:         self.assertTrue(is_dataclass(a))",
          "1551:     def test_helper_fields_with_class_instance(self):",
          "1552:         # Check that we can call fields() on either a class or instance,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1550:     def test_is_dataclass_inheritance(self):",
          "1551:         @dataclass",
          "1552:         class X:",
          "1553:             y: int",
          "1555:         class Z(X):",
          "1556:             pass",
          "1558:         self.assertTrue(is_dataclass(X), \"X should be a dataclass\")",
          "1559:         self.assertTrue(",
          "1560:             is_dataclass(Z),",
          "1561:             \"Z should be a dataclass because it inherits from X\",",
          "1562:         )",
          "1563:         z_instance = Z(y=5)",
          "1564:         self.assertTrue(",
          "1565:             is_dataclass(z_instance),",
          "1566:             \"z_instance should be a dataclass because it is an instance of Z\",",
          "1567:         )",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "64c4139f61517cb8845b42fce0a1dad0e6ebbd9a",
      "candidate_info": {
        "commit_hash": "64c4139f61517cb8845b42fce0a1dad0e6ebbd9a",
        "repo": "python/cpython",
        "commit_url": "https://github.com/python/cpython/commit/64c4139f61517cb8845b42fce0a1dad0e6ebbd9a",
        "files": [
          "Include/cpython/pyatomic_gcc.h"
        ],
        "message": "[3.13] gh-120593: Fix const qualifier in pyatomic.h (GH-121055) (#121057)\n\ngh-120593: Fix const qualifier in pyatomic.h (GH-121055)\n(cherry picked from commit 9cd2dcbb87fb3c35d8ca3554d9472ac283f62a64)\n\nCo-authored-by: Victor Stinner <vstinner@python.org>",
        "before_after_code_files": [
          "Include/cpython/pyatomic_gcc.h||Include/cpython/pyatomic_gcc.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/AcreetionOS-Linux/python/pull/2"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "Include/cpython/pyatomic_gcc.h||Include/cpython/pyatomic_gcc.h": [
          "File: Include/cpython/pyatomic_gcc.h -> Include/cpython/pyatomic_gcc.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "298: static inline void *",
          "299: _Py_atomic_load_ptr(const void *obj)",
          "",
          "[Removed Lines]",
          "300: { return (void *)__atomic_load_n((void **)obj, __ATOMIC_SEQ_CST); }",
          "",
          "[Added Lines]",
          "300: { return (void *)__atomic_load_n((void * const *)obj, __ATOMIC_SEQ_CST); }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "357: static inline void *",
          "358: _Py_atomic_load_ptr_relaxed(const void *obj)",
          "361: static inline unsigned long long",
          "362: _Py_atomic_load_ullong_relaxed(const unsigned long long *obj)",
          "",
          "[Removed Lines]",
          "359: { return (void *)__atomic_load_n((const void **)obj, __ATOMIC_RELAXED); }",
          "",
          "[Added Lines]",
          "359: { return (void *)__atomic_load_n((void * const *)obj, __ATOMIC_RELAXED); }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "491: static inline void *",
          "492: _Py_atomic_load_ptr_acquire(const void *obj)",
          "495: static inline uintptr_t",
          "496: _Py_atomic_load_uintptr_acquire(const uintptr_t *obj)",
          "499: static inline void",
          "500: _Py_atomic_store_ptr_release(void *obj, void *value)",
          "",
          "[Removed Lines]",
          "493: { return (void *)__atomic_load_n((void **)obj, __ATOMIC_ACQUIRE); }",
          "497: { return (uintptr_t)__atomic_load_n((uintptr_t *)obj, __ATOMIC_ACQUIRE); }",
          "",
          "[Added Lines]",
          "493: { return (void *)__atomic_load_n((void * const *)obj, __ATOMIC_ACQUIRE); }",
          "497: { return (uintptr_t)__atomic_load_n(obj, __ATOMIC_ACQUIRE); }",
          "",
          "---------------"
        ]
      }
    }
  ]
}