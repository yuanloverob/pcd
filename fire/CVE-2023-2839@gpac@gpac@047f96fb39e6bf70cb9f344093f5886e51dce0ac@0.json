{
  "cve_id": "CVE-2023-2839",
  "cve_desc": "Divide By Zero in GitHub repository gpac/gpac prior to 2.2.2.",
  "repo": "gpac/gpac",
  "patch_hash": "047f96fb39e6bf70cb9f344093f5886e51dce0ac",
  "patch_info": {
    "commit_hash": "047f96fb39e6bf70cb9f344093f5886e51dce0ac",
    "repo": "gpac/gpac",
    "commit_url": "https://github.com/gpac/gpac/commit/047f96fb39e6bf70cb9f344093f5886e51dce0ac",
    "files": [
      "src/filters/reframe_nalu.c"
    ],
    "message": "fixed #2476",
    "before_after_code_files": [
      "src/filters/reframe_nalu.c||src/filters/reframe_nalu.c"
    ]
  },
  "patch_diff": {
    "src/filters/reframe_nalu.c||src/filters/reframe_nalu.c": [
      "File: src/filters/reframe_nalu.c -> src/filters/reframe_nalu.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1509:      else",
      "1510:       DeltaTfiDivisorIdx = (ctx->avc_state->sei.pic_timing.pic_struct+1) / 2;",
      "1511:     }",
      "1516:      if (!ctx->fps.num && ctx->dts==ctx->fps.den)",
      "1517:       ctx->dts = ctx->cur_fps.den;",
      "1518:     }",
      "",
      "[Removed Lines]",
      "1512:     if (ctx->notime && sps->vui.time_scale && sps->vui.num_units_in_tick) {",
      "1513:      ctx->cur_fps.num = 2 * sps->vui.time_scale;",
      "1514:      ctx->cur_fps.den = 2 * sps->vui.num_units_in_tick * DeltaTfiDivisorIdx;",
      "",
      "[Added Lines]",
      "1512:     if (ctx->notime) {",
      "1513:      u32 fps_num = 2 * sps->vui.time_scale;",
      "1514:      u32 fps_den = 2 * sps->vui.num_units_in_tick * DeltaTfiDivisorIdx;",
      "1515:      if (fps_num && fps_den) {",
      "1516:       ctx->cur_fps.num = fps_num;",
      "1517:       ctx->cur_fps.den = fps_den;",
      "1518:      }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "640106c93fd9a7cf806c03cdec14aa6d48d04fcf",
      "candidate_info": {
        "commit_hash": "640106c93fd9a7cf806c03cdec14aa6d48d04fcf",
        "repo": "gpac/gpac",
        "commit_url": "https://github.com/gpac/gpac/commit/640106c93fd9a7cf806c03cdec14aa6d48d04fcf",
        "files": [
          "src/filters/reframe_nalu.c"
        ],
        "message": "fixed FPS detection for very large values of VUI timescale - cf #2562",
        "before_after_code_files": [
          "src/filters/reframe_nalu.c||src/filters/reframe_nalu.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/filters/reframe_nalu.c||src/filters/reframe_nalu.c"
          ],
          "candidate": [
            "src/filters/reframe_nalu.c||src/filters/reframe_nalu.c"
          ]
        }
      },
      "candidate_diff": {
        "src/filters/reframe_nalu.c||src/filters/reframe_nalu.c": [
          "File: src/filters/reframe_nalu.c -> src/filters/reframe_nalu.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1161:    if (ctx->notime && first && (!ctx->fps.num || !ctx->fps.den) && sps->has_timing_info",
          "1164:    ) {",
          "1165:     ctx->cur_fps.num = sps->time_scale;",
          "1166:     ctx->cur_fps.den = sps->num_units_in_tick;",
          "",
          "[Removed Lines]",
          "1163:     && (sps->time_scale <= 1000*sps->num_units_in_tick)",
          "",
          "[Added Lines]",
          "1163:     && (sps->time_scale / 1000 <= sps->num_units_in_tick)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1338:    if (ctx->notime && first && (!ctx->fps.num || !ctx->fps.den) && sps->has_timing_info",
          "1341:    ) {",
          "1342:     ctx->cur_fps.num = sps->time_scale;",
          "1343:     ctx->cur_fps.den = sps->num_units_in_tick;",
          "",
          "[Removed Lines]",
          "1340:     && (sps->time_scale <= 1000*sps->num_units_in_tick)",
          "",
          "[Added Lines]",
          "1340:     && (sps->time_scale / 1000 <= sps->num_units_in_tick)",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1487:    if (first && (!ctx->fps.num || !ctx->fps.den) && sps->vui.timing_info_present_flag",
          "1490:    ) {",
          "",
          "[Removed Lines]",
          "1489:     && (sps->vui.time_scale <= 1000*sps->vui.num_units_in_tick)",
          "",
          "[Added Lines]",
          "1489:     && (sps->vui.time_scale / 1000 <= sps->vui.num_units_in_tick)",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1502:       DeltaTfiDivisorIdx = (ctx->avc_state->sei.pic_timing.pic_struct+1) / 2;",
          "1503:     }",
          "1504:     if (ctx->notime) {",
          "1507:      if (fps_num && fps_den) {",
          "1508:       ctx->cur_fps.num = fps_num;",
          "1509:       ctx->cur_fps.den = fps_den;",
          "",
          "[Removed Lines]",
          "1505:      u32 fps_num = 2 * sps->vui.time_scale;",
          "1506:      u32 fps_den = 2 * sps->vui.num_units_in_tick * DeltaTfiDivisorIdx;",
          "",
          "[Added Lines]",
          "1505:      u32 fps_num, fps_den;",
          "1506:      if ( (s32) (2*sps->vui.time_scale) < 0) {",
          "1507:       fps_num = sps->vui.time_scale;",
          "1508:       fps_den = sps->vui.num_units_in_tick * DeltaTfiDivisorIdx;",
          "1509:      } else {",
          "1510:       fps_num = 2 * sps->vui.time_scale;",
          "1511:       fps_den = 2 * sps->vui.num_units_in_tick * DeltaTfiDivisorIdx;",
          "1512:      }",
          "",
          "---------------"
        ]
      }
    }
  ]
}