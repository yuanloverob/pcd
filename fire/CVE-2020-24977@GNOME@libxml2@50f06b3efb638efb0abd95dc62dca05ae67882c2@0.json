{
  "cve_id": "CVE-2020-24977",
  "cve_desc": "GNOME project libxml2 v2.9.10 has a global buffer over-read vulnerability in xmlEncodeEntitiesInternal at libxml2/entities.c. The issue has been fixed in commit 50f06b3e.",
  "repo": "GNOME/libxml2",
  "patch_hash": "50f06b3efb638efb0abd95dc62dca05ae67882c2",
  "patch_info": {
    "commit_hash": "50f06b3efb638efb0abd95dc62dca05ae67882c2",
    "repo": "GNOME/libxml2",
    "commit_url": "https://github.com/GNOME/libxml2/commit/50f06b3efb638efb0abd95dc62dca05ae67882c2",
    "files": [
      "xmllint.c"
    ],
    "message": "Fix out-of-bounds read with 'xmllint --htmlout'\n\nMake sure that truncated UTF-8 sequences don't cause an out-of-bounds\narray access.\n\nThanks to @SuhwanSong and the Agency for Defense Development (ADD) for\nthe report.\n\nFixes #178.",
    "before_after_code_files": [
      "xmllint.c||xmllint.c"
    ]
  },
  "patch_diff": {
    "xmllint.c||xmllint.c": [
      "File: xmllint.c -> xmllint.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "528: xmlHTMLEncodeSend(void) {",
      "529:     char *result;",
      "531:     result = (char *) xmlEncodeEntitiesReentrant(NULL, BAD_CAST buffer);",
      "532:     if (result) {",
      "533:  xmlGenericError(xmlGenericErrorContext, \"%s\", result);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "536:     memset(&buffer[sizeof(buffer)-4], 0, 4);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "bf22713507fe1fc3a2c4b525cf0a88c2dc87a3a2",
      "candidate_info": {
        "commit_hash": "bf22713507fe1fc3a2c4b525cf0a88c2dc87a3a2",
        "repo": "GNOME/libxml2",
        "commit_url": "https://github.com/GNOME/libxml2/commit/bf22713507fe1fc3a2c4b525cf0a88c2dc87a3a2",
        "files": [
          "entities.c"
        ],
        "message": "Validate UTF8 in xmlEncodeEntities\n\nCode is currently assuming UTF-8 without validating. Truncated UTF-8\ninput can cause out-of-bounds array access.\n\nAdds further checks to partial fix in 50f06b3e.\n\nFixes #178",
        "before_after_code_files": [
          "entities.c||entities.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_issue": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "entities.c||entities.c": [
          "File: entities.c -> entities.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "704:      } else {",
          "708:   char buf[11], *ptr;",
          "709:   int val = 0, l = 1;",
          "712:       xmlEntitiesErr(XML_CHECK_NOT_UTF8,",
          "713:        \"xmlEncodeEntities: input not UTF-8\");",
          "714:       if (doc != NULL)",
          "",
          "[Removed Lines]",
          "711:   if (*cur < 0xC0) {",
          "",
          "[Added Lines]",
          "721:   if (((cur[0] & 0xC0) != 0xC0) ||",
          "722:       ((cur[1] & 0xC0) != 0x80) ||",
          "723:       (((cur[0] & 0xE0) == 0xE0) && ((cur[2] & 0xC0) != 0x80)) ||",
          "724:       (((cur[0] & 0xF0) == 0xF0) && ((cur[3] & 0xC0) != 0x80)) ||",
          "725:       (((cur[0] & 0xF8) == 0xF8))) {",
          "",
          "---------------"
        ]
      }
    }
  ]
}