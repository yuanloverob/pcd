{
  "cve_id": "CVE-2022-0534",
  "cve_desc": "A vulnerability was found in htmldoc version 1.9.15 where the stack out-of-bounds read takes place in gif_get_code() and occurs when opening a malicious GIF file, which can result in a crash (segmentation fault).",
  "repo": "michaelrsweet/htmldoc",
  "patch_hash": "312f0f9c12f26fbe015cd0e6cefa40e4b99017d9",
  "patch_info": {
    "commit_hash": "312f0f9c12f26fbe015cd0e6cefa40e4b99017d9",
    "repo": "michaelrsweet/htmldoc",
    "commit_url": "https://github.com/michaelrsweet/htmldoc/commit/312f0f9c12f26fbe015cd0e6cefa40e4b99017d9",
    "files": [
      "htmldoc/image.cxx"
    ],
    "message": "Block GIF images with a code size > 12 (Issue #463)",
    "before_after_code_files": [
      "htmldoc/image.cxx||htmldoc/image.cxx"
    ]
  },
  "patch_diff": {
    "htmldoc/image.cxx||htmldoc/image.cxx": [
      "File: htmldoc/image.cxx -> htmldoc/image.cxx",
      "--- Hunk 1 ---",
      "[Context before]",
      "305:   pass      = 0;",
      "306:   code_size = (uchar)getc(fp);",
      "308:   if (gif_read_lzw(fp, 1, code_size) < 0)",
      "309:     return (-1);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "308:   if (code_size > 12)",
      "309:   {",
      "310:     progress_error(HD_ERROR_READ_ERROR, \"Bad GIF file \\\"%s\\\" - invalid code size %d.\", img->filename, code_size);",
      "311:     return (-1);",
      "312:   }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "432:   if (sp > stack)",
      "433:     return (*--sp);",
      "436:   {",
      "437:     if (code == clear_code)",
      "438:     {",
      "",
      "[Removed Lines]",
      "435:   while ((code = gif_get_code (fp, code_size, 0)) >= 0)",
      "",
      "[Added Lines]",
      "441:   while ((code = gif_get_code(fp, code_size, 0)) >= 0)",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "776cf0fc4c760f1fb7b966ce28dc92dd7d44ed50",
      "candidate_info": {
        "commit_hash": "776cf0fc4c760f1fb7b966ce28dc92dd7d44ed50",
        "repo": "michaelrsweet/htmldoc",
        "commit_url": "https://github.com/michaelrsweet/htmldoc/commit/776cf0fc4c760f1fb7b966ce28dc92dd7d44ed50",
        "files": [
          "CHANGES.md",
          "htmldoc/image.cxx"
        ],
        "message": "Fix potential stack overflow with GIF images (Issue #463)",
        "before_after_code_files": [
          "htmldoc/image.cxx||htmldoc/image.cxx"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_issue": 1,
        "olp_code_files": {
          "patch": [
            "htmldoc/image.cxx||htmldoc/image.cxx"
          ],
          "candidate": [
            "htmldoc/image.cxx||htmldoc/image.cxx"
          ]
        }
      },
      "candidate_diff": {
        "htmldoc/image.cxx||htmldoc/image.cxx": [
          "File: htmldoc/image.cxx -> htmldoc/image.cxx",
          "--- Hunk 1 ---",
          "[Context before]",
          "226:     if (done)",
          "227:     {",
          "231:     }",
          "",
          "[Removed Lines]",
          "228:       progress_error(HD_ERROR_READ_ERROR,",
          "229:                      \"Not enough data left to read GIF compression code.\");",
          "",
          "[Added Lines]",
          "228:       progress_error(HD_ERROR_READ_ERROR, \"Not enough data left to read GIF compression code.\");",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "254:     {",
          "",
          "[Removed Lines]",
          "253:     if ((count = gif_get_block (fp, buf + last_byte)) <= 0)",
          "",
          "[Added Lines]",
          "252:     if ((count = gif_get_block(fp, buf + last_byte)) <= 0)",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "268:     last_byte += (unsigned)count;",
          "269:     lastbit   = last_byte * 8;",
          "270:   }",
          "",
          "[Removed Lines]",
          "267:     curbit    = (curbit - lastbit) + 8 * last_byte;",
          "",
          "[Added Lines]",
          "266:     curbit    = curbit + 8 * last_byte - lastbit;",
          "",
          "---------------"
        ]
      }
    }
  ]
}