{
  "cve_id": "CVE-2017-13053",
  "cve_desc": "The BGP parser in tcpdump before 4.9.2 has a buffer over-read in print-bgp.c:decode_rt_routing_info().",
  "repo": "the-tcpdump-group/tcpdump",
  "patch_hash": "bd4e697ebd6c8457efa8f28f6831fc929b88a014",
  "patch_info": {
    "commit_hash": "bd4e697ebd6c8457efa8f28f6831fc929b88a014",
    "repo": "the-tcpdump-group/tcpdump",
    "commit_url": "https://github.com/the-tcpdump-group/tcpdump/commit/bd4e697ebd6c8457efa8f28f6831fc929b88a014",
    "files": [
      "print-bgp.c",
      "tests/TESTLIST",
      "tests/bgp_vpn_rt-oobr.out",
      "tests/bgp_vpn_rt-oobr.pcap"
    ],
    "message": "CVE-2017-13053/BGP: fix VPN route target bounds checks\n\ndecode_rt_routing_info() didn't check bounds before fetching 4 octets of\nthe origin AS field and could over-read the input buffer, put it right.\n\nIt also fetched the varying number of octets of the route target field\nfrom 4 octets lower than the correct offset, put it right.\n\nIt also used the same temporary buffer explicitly through as_printf()\nand implicitly through bgp_vpn_rd_print() so the end result of snprintf()\nwas not what was originally intended.\n\nThis fixes a buffer over-read discovered by Bhargava Shastry,\nSecT/TU Berlin.\n\nAdd a test using the capture file supplied by the reporter(s).",
    "before_after_code_files": [
      "print-bgp.c||print-bgp.c"
    ]
  },
  "patch_diff": {
    "print-bgp.c||print-bgp.c": [
      "File: print-bgp.c -> print-bgp.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "773:  if (32 > plen)",
      "774:   return -1;",
      "778:  if (64 < plen)",
      "779:   return -1;",
      "781:  memset(&route_target, 0, sizeof(route_target));",
      "784:  if (plen % 8) {",
      "785:   ((u_char *)&route_target)[(plen + 7) / 8 - 1] &=",
      "786:    ((0xff00 >> (plen % 8)) & 0xff);",
      "787:  }",
      "788:  snprintf(buf, buflen, \"origin AS: %s, route target %s\",",
      "790:      bgp_vpn_rd_print(ndo, (u_char *)&route_target));",
      "792:  return 5 + (plen + 7) / 8;",
      "",
      "[Removed Lines]",
      "782:  ND_TCHECK2(pptr[1], (plen + 7) / 8);",
      "783:  memcpy(&route_target, &pptr[1], (plen + 7) / 8);",
      "789:      as_printf(ndo, astostr, sizeof(astostr), EXTRACT_32BITS(pptr+1)),",
      "",
      "[Added Lines]",
      "784:  ND_TCHECK_32BITS(pptr + 1);",
      "785:  as_printf(ndo, asbuf, sizeof(asbuf), EXTRACT_32BITS(pptr + 1));",
      "797:  ND_TCHECK2(pptr[5], (plen + 7) / 8);",
      "798:  memcpy(&route_target, &pptr[5], (plen + 7) / 8);",
      "805:      asbuf,",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "6ceeae50d82649235205e55323a210308d543639",
      "candidate_info": {
        "commit_hash": "6ceeae50d82649235205e55323a210308d543639",
        "repo": "the-tcpdump-group/tcpdump",
        "commit_url": "https://github.com/the-tcpdump-group/tcpdump/commit/6ceeae50d82649235205e55323a210308d543639",
        "files": [
          "print-bgp.c"
        ],
        "message": "Temporarily undo whitespace cleanups to help a pull request.\n\nHopefully this will reduce the number of conflicts.",
        "before_after_code_files": [
          "print-bgp.c||print-bgp.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "print-bgp.c||print-bgp.c"
          ],
          "candidate": [
            "print-bgp.c||print-bgp.c"
          ]
        }
      },
      "candidate_diff": {
        "print-bgp.c||print-bgp.c": [
          "File: print-bgp.c -> print-bgp.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "48: #include \"l2vpn.h\"",
          "50: struct bgp {",
          "54: };",
          "61: #define BGP_ROUTE_REFRESH       5",
          "63: static const struct tok bgp_msg_values[] = {",
          "",
          "[Removed Lines]",
          "51:     nd_byte     bgp_marker[16];",
          "52:     nd_uint16_t bgp_len;",
          "53:     nd_uint8_t  bgp_type;",
          "57: #define BGP_OPEN                1",
          "58: #define BGP_UPDATE              2",
          "59: #define BGP_NOTIFICATION        3",
          "60: #define BGP_KEEPALIVE           4",
          "",
          "[Added Lines]",
          "51:  nd_byte     bgp_marker[16];",
          "52:  nd_uint16_t bgp_len;",
          "53:  nd_uint8_t  bgp_type;",
          "57: #define BGP_OPEN  1",
          "58: #define BGP_UPDATE  2",
          "59: #define BGP_NOTIFICATION 3",
          "60: #define BGP_KEEPALIVE  4",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "70: };",
          "72: struct bgp_open {",
          "82: };",
          "85: struct bgp_opt {",
          "89: };",
          "93: struct bgp_notification {",
          "99: };",
          "102: struct bgp_route_refresh {",
          "109: };",
          "110: #define BGP_ROUTE_REFRESH_SIZE          23",
          "112: #define bgp_attr_lenlen(flags, p) \\",
          "114: #define bgp_attr_len(flags, p) \\",
          "",
          "[Removed Lines]",
          "73:     nd_byte     bgpo_marker[16];",
          "74:     nd_uint16_t bgpo_len;",
          "75:     nd_uint8_t  bgpo_type;",
          "76:     nd_uint8_t  bgpo_version;",
          "77:     nd_uint16_t bgpo_myas;",
          "78:     nd_uint16_t bgpo_holdtime;",
          "79:     nd_uint32_t bgpo_id;",
          "80:     nd_uint8_t  bgpo_optlen;",
          "86:     nd_uint8_t bgpopt_type;",
          "87:     nd_uint8_t bgpopt_len;",
          "94:     nd_byte     bgpn_marker[16];",
          "95:     nd_uint16_t bgpn_len;",
          "96:     nd_uint8_t  bgpn_type;",
          "97:     nd_uint8_t  bgpn_major;",
          "98:     nd_uint8_t  bgpn_minor;",
          "103:     nd_byte     bgp_marker[16];",
          "104:     nd_uint16_t len;",
          "106:     nd_uint16_t afi;",
          "107:     nd_uint8_t  res;",
          "108:     nd_uint8_t  safi;",
          "113:     (((flags) & 0x10) ? 2 : 1)",
          "115:     (((flags) & 0x10) ? EXTRACT_BE_U_2(p) : EXTRACT_U_1(p))",
          "117: #define BGPTYPE_ORIGIN                   1",
          "118: #define BGPTYPE_AS_PATH                  2",
          "119: #define BGPTYPE_NEXT_HOP                 3",
          "120: #define BGPTYPE_MULTI_EXIT_DISC          4",
          "121: #define BGPTYPE_LOCAL_PREF               5",
          "122: #define BGPTYPE_ATOMIC_AGGREGATE         6",
          "123: #define BGPTYPE_AGGREGATOR               7",
          "",
          "[Added Lines]",
          "73:  nd_byte     bgpo_marker[16];",
          "74:  nd_uint16_t bgpo_len;",
          "75:  nd_uint8_t  bgpo_type;",
          "76:  nd_uint8_t  bgpo_version;",
          "77:  nd_uint16_t bgpo_myas;",
          "78:  nd_uint16_t bgpo_holdtime;",
          "79:  nd_uint32_t bgpo_id;",
          "80:  nd_uint8_t  bgpo_optlen;",
          "86:  nd_uint8_t bgpopt_type;",
          "87:  nd_uint8_t bgpopt_len;",
          "94:  nd_byte     bgpn_marker[16];",
          "95:  nd_uint16_t bgpn_len;",
          "96:  nd_uint8_t  bgpn_type;",
          "97:  nd_uint8_t  bgpn_major;",
          "98:  nd_uint8_t  bgpn_minor;",
          "103:  nd_byte     bgp_marker[16];",
          "104:  nd_uint16_t len;",
          "106:  nd_uint16_t afi;",
          "107:  nd_uint8_t  res;",
          "108:  nd_uint8_t  safi;",
          "113:  (((flags) & 0x10) ? 2 : 1)",
          "115:  (((flags) & 0x10) ? EXTRACT_BE_U_2(p) : EXTRACT_U_1(p))",
          "117: #define BGPTYPE_ORIGIN   1",
          "118: #define BGPTYPE_AS_PATH   2",
          "119: #define BGPTYPE_NEXT_HOP  3",
          "120: #define BGPTYPE_MULTI_EXIT_DISC  4",
          "121: #define BGPTYPE_LOCAL_PREF  5",
          "122: #define BGPTYPE_ATOMIC_AGGREGATE 6",
          "123: #define BGPTYPE_AGGREGATOR  7",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "404: };",
          "",
          "[Removed Lines]",
          "407: #define BGP_COMMUNITY_NO_EXPORT              0xffffff01",
          "408: #define BGP_COMMUNITY_NO_ADVERT              0xffffff02",
          "409: #define BGP_COMMUNITY_NO_EXPORT_SUBCONFED    0xffffff03",
          "",
          "[Added Lines]",
          "407: #define BGP_COMMUNITY_NO_EXPORT   0xffffff01",
          "408: #define BGP_COMMUNITY_NO_ADVERT   0xffffff02",
          "409: #define BGP_COMMUNITY_NO_EXPORT_SUBCONFED 0xffffff03",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "444: #define BGP_EXT_COM_EIGRP_EXT_REMPROTO_REMMETRIC 0x8805",
          "446: static const struct tok bgp_extd_comm_flag_values[] = {",
          "",
          "[Removed Lines]",
          "439: #define BGP_EXT_COM_EIGRP_GEN                    0x8800",
          "440: #define BGP_EXT_COM_EIGRP_METRIC_AS_DELAY        0x8801",
          "441: #define BGP_EXT_COM_EIGRP_METRIC_REL_NH_BW       0x8802",
          "442: #define BGP_EXT_COM_EIGRP_METRIC_LOAD_MTU        0x8803",
          "443: #define BGP_EXT_COM_EIGRP_EXT_REMAS_REMID        0x8804",
          "",
          "[Added Lines]",
          "439: #define BGP_EXT_COM_EIGRP_GEN   0x8800",
          "440: #define BGP_EXT_COM_EIGRP_METRIC_AS_DELAY  0x8801",
          "441: #define BGP_EXT_COM_EIGRP_METRIC_REL_NH_BW 0x8802",
          "442: #define BGP_EXT_COM_EIGRP_METRIC_LOAD_MTU  0x8803",
          "443: #define BGP_EXT_COM_EIGRP_EXT_REMAS_REMID  0x8804",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "502: static const struct tok bgp_add_path_recvsend[] = {",
          "507: };",
          "509: static char astostr[20];",
          "",
          "[Removed Lines]",
          "503:     { 1, \"Receive\" },",
          "504:     { 2, \"Send\" },",
          "505:     { 3, \"Both\" },",
          "506:     { 0, NULL },",
          "",
          "[Added Lines]",
          "503:   { 1, \"Receive\" },",
          "504:   { 2, \"Send\" },",
          "505:   { 3, \"Both\" },",
          "506:   { 0, NULL },",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "521: as_printf(netdissect_options *ndo,",
          "522:           char *str, int size, u_int asnum)",
          "523: {",
          "530: }",
          "532: #define ITEMCHECK(minlen) if (itemlen < minlen) goto badtlv;",
          "",
          "[Removed Lines]",
          "524:     if (!ndo->ndo_bflag || asnum <= 0xFFFF) {",
          "525:         snprintf(str, size, \"%u\", asnum);",
          "526:     } else {",
          "527:         snprintf(str, size, \"%u.%u\", asnum >> 16, asnum & 0xFFFF);",
          "528:     }",
          "529:     return str;",
          "",
          "[Added Lines]",
          "524:  if (!ndo->ndo_bflag || asnum <= 0xFFFF) {",
          "525:   snprintf(str, size, \"%u\", asnum);",
          "526:  } else {",
          "527:   snprintf(str, size, \"%u.%u\", asnum >> 16, asnum & 0xFFFF);",
          "528:  }",
          "529:  return str;",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "535: decode_prefix4(netdissect_options *ndo,",
          "536:                const u_char *pptr, u_int itemlen, char *buf, u_int buflen)",
          "537: {",
          "559: trunc:",
          "562: badtlv:",
          "564: }",
          "566: static int",
          "567: decode_labeled_prefix4(netdissect_options *ndo,",
          "568:                        const u_char *pptr, u_int itemlen, char *buf, u_int buflen)",
          "569: {",
          "612: trunc:",
          "615: badtlv:",
          "617: }",
          "",
          "[Removed Lines]",
          "538:     struct in_addr addr;",
          "539:     u_int plen, plenbytes;",
          "541:     ND_TCHECK_1(pptr);",
          "542:     ITEMCHECK(1);",
          "543:     plen = EXTRACT_U_1(pptr);",
          "544:     if (32 < plen)",
          "545:         return -1;",
          "546:     itemlen -= 1;",
          "548:     memset(&addr, 0, sizeof(addr));",
          "549:     plenbytes = (plen + 7) / 8;",
          "550:     ND_TCHECK_LEN(pptr + 1, plenbytes);",
          "551:     ITEMCHECK(plenbytes);",
          "552:     memcpy(&addr, pptr + 1, plenbytes);",
          "553:     if (plen % 8) {",
          "554:         ((u_char *)&addr)[plenbytes - 1] &= ((0xff00 >> (plen % 8)) & 0xff);",
          "555:     }",
          "556:     snprintf(buf, buflen, \"%s/%d\", ipaddr_string(ndo, &addr), plen);",
          "557:     return 1 + plenbytes;",
          "560:     return -2;",
          "563:     return -3;",
          "570:     struct in_addr addr;",
          "571:     u_int plen, plenbytes;",
          "574:     ND_TCHECK_4(pptr);",
          "575:     ITEMCHECK(4);",
          "579:        the label length (actually the label + COS bits)",
          "580:        is added to the prefix length;",
          "581:        we also do only read out just one label -",
          "582:        there is no real application for advertisement of",
          "583:        stacked labels in a single BGP message",
          "586:     if (24 > plen)",
          "587:         return -1;",
          "591:     if (32 < plen)",
          "592:         return -1;",
          "593:     itemlen -= 4;",
          "595:     memset(&addr, 0, sizeof(addr));",
          "596:     plenbytes = (plen + 7) / 8;",
          "597:     ND_TCHECK_LEN(pptr + 4, plenbytes);",
          "598:     ITEMCHECK(plenbytes);",
          "599:     memcpy(&addr, pptr + 4, plenbytes);",
          "600:     if (plen % 8) {",
          "601:         ((u_char *)&addr)[plenbytes - 1] &= ((0xff00 >> (plen % 8)) & 0xff);",
          "602:     }",
          "604:     snprintf(buf, buflen, \"%s/%d, label:%u %s\",",
          "605:              ipaddr_string(ndo, &addr),",
          "606:              plen,",
          "607:              EXTRACT_BE_U_3(pptr + 1)>>4,",
          "608:              ((pptr[3]&1)==0) ? \"(BOGUS: Bottom of Stack NOT set!)\" : \"(bottom)\" );",
          "610:     return 4 + plenbytes;",
          "613:     return -2;",
          "616:     return -3;",
          "",
          "[Added Lines]",
          "538:  struct in_addr addr;",
          "539:  u_int plen, plenbytes;",
          "541:  ND_TCHECK_1(pptr);",
          "542:  ITEMCHECK(1);",
          "543:  plen = EXTRACT_U_1(pptr);",
          "544:  if (32 < plen)",
          "545:   return -1;",
          "546:  itemlen -= 1;",
          "548:  memset(&addr, 0, sizeof(addr));",
          "549:  plenbytes = (plen + 7) / 8;",
          "550:  ND_TCHECK_LEN(pptr + 1, plenbytes);",
          "551:  ITEMCHECK(plenbytes);",
          "552:  memcpy(&addr, pptr + 1, plenbytes);",
          "553:  if (plen % 8) {",
          "554:   ((u_char *)&addr)[plenbytes - 1] &=",
          "555:    ((0xff00 >> (plen % 8)) & 0xff);",
          "556:  }",
          "557:  snprintf(buf, buflen, \"%s/%d\", ipaddr_string(ndo, &addr), plen);",
          "558:  return 1 + plenbytes;",
          "561:  return -2;",
          "564:  return -3;",
          "571:  struct in_addr addr;",
          "572:  u_int plen, plenbytes;",
          "575:  ND_TCHECK_4(pptr);",
          "576:  ITEMCHECK(4);",
          "580:            the label length (actually the label + COS bits)",
          "581:            is added to the prefix length;",
          "582:            we also do only read out just one label -",
          "583:            there is no real application for advertisement of",
          "584:            stacked labels in a single BGP message",
          "587:  if (24 > plen)",
          "588:   return -1;",
          "592:  if (32 < plen)",
          "593:   return -1;",
          "594:  itemlen -= 4;",
          "596:  memset(&addr, 0, sizeof(addr));",
          "597:  plenbytes = (plen + 7) / 8;",
          "598:  ND_TCHECK_LEN(pptr + 4, plenbytes);",
          "599:  ITEMCHECK(plenbytes);",
          "600:  memcpy(&addr, pptr + 4, plenbytes);",
          "601:  if (plen % 8) {",
          "602:   ((u_char *)&addr)[plenbytes - 1] &=",
          "603:    ((0xff00 >> (plen % 8)) & 0xff);",
          "604:  }",
          "606:  snprintf(buf, buflen, \"%s/%d, label:%u %s\",",
          "607:                  ipaddr_string(ndo, &addr),",
          "608:                  plen,",
          "609:                  EXTRACT_BE_U_3(pptr + 1)>>4,",
          "610:                  ((pptr[3]&1)==0) ? \"(BOGUS: Bottom of Stack NOT set!)\" : \"(bottom)\" );",
          "612:  return 4 + plenbytes;",
          "615:  return -2;",
          "618:  return -3;",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "688:     offset = strlen(buf);",
          "689:     if (addr_length) {",
          "690:         snprintf(buf + offset, buflen - offset, \", Source %s\",",
          "692:         pptr += (addr_length >> 3);",
          "693:     }",
          "",
          "[Removed Lines]",
          "691:              bgp_vpn_ip_print(ndo, pptr, addr_length));",
          "",
          "[Added Lines]",
          "693:                  bgp_vpn_ip_print(ndo, pptr, addr_length));",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "703:     offset = strlen(buf);",
          "704:     if (addr_length) {",
          "705:         snprintf(buf + offset, buflen - offset, \", Group %s\",",
          "707:         pptr += (addr_length >> 3);",
          "708:     }",
          "",
          "[Removed Lines]",
          "706:              bgp_vpn_ip_print(ndo, pptr, addr_length));",
          "",
          "[Added Lines]",
          "708:                  bgp_vpn_ip_print(ndo, pptr, addr_length));",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "738:     case 1:",
          "739:         snprintf(pos, sizeof(rd) - (pos - rd), \"%u.%u.%u.%u:%u\",",
          "743:         break;",
          "746:     case 2:",
          "752:         break;",
          "753:     default:",
          "754:         snprintf(pos, sizeof(rd) - (pos - rd), \"unknown RD format\");",
          "",
          "[Removed Lines]",
          "740:                  EXTRACT_U_1(pptr + 2), EXTRACT_U_1(pptr + 3),",
          "741:                  EXTRACT_U_1(pptr + 4), EXTRACT_U_1(pptr + 5),",
          "742:                  EXTRACT_BE_U_2(pptr + 6));",
          "747:         snprintf(pos, sizeof(rd) - (pos - rd), \"%s:%u (%u.%u.%u.%u:%u)\",",
          "748:                  as_printf(ndo, astostr, sizeof(astostr), EXTRACT_BE_U_4(pptr + 2)),",
          "749:                  EXTRACT_BE_U_2(pptr + 6), EXTRACT_U_1(pptr + 2),",
          "750:                  EXTRACT_U_1(pptr + 3), EXTRACT_U_1(pptr + 4),",
          "751:                  EXTRACT_U_1(pptr + 5), EXTRACT_BE_U_2(pptr + 6));",
          "",
          "[Added Lines]",
          "742:             EXTRACT_U_1(pptr + 2), EXTRACT_U_1(pptr + 3),",
          "743:             EXTRACT_U_1(pptr + 4), EXTRACT_U_1(pptr + 5),",
          "744:             EXTRACT_BE_U_2(pptr + 6));",
          "749:  snprintf(pos, sizeof(rd) - (pos - rd), \"%s:%u (%u.%u.%u.%u:%u)\",",
          "750:      as_printf(ndo, astostr, sizeof(astostr), EXTRACT_BE_U_4(pptr + 2)),",
          "751:      EXTRACT_BE_U_2(pptr + 6), EXTRACT_U_1(pptr + 2),",
          "752:      EXTRACT_U_1(pptr + 3), EXTRACT_U_1(pptr + 4),",
          "753:      EXTRACT_U_1(pptr + 5), EXTRACT_BE_U_2(pptr + 6));",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "763: decode_rt_routing_info(netdissect_options *ndo,",
          "764:                        const u_char *pptr, char *buf, u_int buflen)",
          "765: {",
          "814: trunc:",
          "816: }",
          "818: static int",
          "819: decode_labeled_vpn_prefix4(netdissect_options *ndo,",
          "820:                            const u_char *pptr, char *buf, u_int buflen)",
          "821: {",
          "853: trunc:",
          "855: }",
          "",
          "[Removed Lines]",
          "766:     uint8_t route_target[8];",
          "767:     u_int plen;",
          "771:     ND_TCHECK_1(pptr);",
          "778:     if (0 == plen) {",
          "780:         snprintf(buf, buflen, \"default route target\");",
          "781:         return 1;",
          "782:     }",
          "784:     if (32 > plen)",
          "785:         return -1;",
          "788:     ND_TCHECK_4(pptr + 1);",
          "789:     as_printf(ndo, asbuf, sizeof(asbuf), EXTRACT_BE_U_4(pptr + 1));",
          "793:     if (64 < plen)",
          "794:         return -1;",
          "800:     memset(&route_target, 0, sizeof(route_target));",
          "801:     ND_TCHECK_LEN(pptr + 5, (plen + 7) / 8);",
          "802:     memcpy(&route_target, pptr + 5, (plen + 7) / 8);",
          "804:     if (plen % 8) {",
          "805:         ((u_char *)&route_target)[(plen + 7) / 8 - 1] &=",
          "806:             ((0xff00 >> (plen % 8)) & 0xff);",
          "807:     }",
          "808:     snprintf(buf, buflen, \"origin AS: %s, route target %s\",",
          "809:              asbuf,",
          "810:              bgp_vpn_rd_print(ndo, (u_char *)&route_target));",
          "812:     return 5 + (plen + 7) / 8;",
          "815:     return -2;",
          "822:     struct in_addr addr;",
          "823:     u_int plen;",
          "825:     ND_TCHECK_1(pptr);",
          "828:     if ((24+64) > plen)",
          "829:         return -1;",
          "833:     if (32 < plen)",
          "834:         return -1;",
          "836:     memset(&addr, 0, sizeof(addr));",
          "837:     ND_TCHECK_LEN(pptr + 12, (plen + 7) / 8);",
          "838:     memcpy(&addr, pptr + 12, (plen + 7) / 8);",
          "839:     if (plen % 8) {",
          "840:         ((u_char *)&addr)[(plen + 7) / 8 - 1] &=",
          "841:             ((0xff00 >> (plen % 8)) & 0xff);",
          "842:     }",
          "844:     snprintf(buf, buflen, \"RD: %s, %s/%d, label:%u %s\",",
          "845:              bgp_vpn_rd_print(ndo, pptr+4),",
          "846:              ipaddr_string(ndo, &addr),",
          "847:              plen,",
          "848:              EXTRACT_BE_U_3(pptr + 1)>>4,",
          "849:              ((pptr[3]&1)==0) ? \"(BOGUS: Bottom of Stack NOT set!)\" : \"(bottom)\" );",
          "851:     return 12 + (plen + 7) / 8;",
          "854:     return -2;",
          "",
          "[Added Lines]",
          "768:  uint8_t route_target[8];",
          "769:  u_int plen;",
          "773:  ND_TCHECK_1(pptr);",
          "780:  if (0 == plen) {",
          "782:   snprintf(buf, buflen, \"default route target\");",
          "783:   return 1;",
          "784:  }",
          "786:  if (32 > plen)",
          "787:   return -1;",
          "790:  ND_TCHECK_4(pptr + 1);",
          "791:  as_printf(ndo, asbuf, sizeof(asbuf), EXTRACT_BE_U_4(pptr + 1));",
          "795:  if (64 < plen)",
          "796:   return -1;",
          "802:  memset(&route_target, 0, sizeof(route_target));",
          "803:  ND_TCHECK_LEN(pptr + 5, (plen + 7) / 8);",
          "804:  memcpy(&route_target, pptr + 5, (plen + 7) / 8);",
          "806:  if (plen % 8) {",
          "807:   ((u_char *)&route_target)[(plen + 7) / 8 - 1] &=",
          "808:    ((0xff00 >> (plen % 8)) & 0xff);",
          "809:  }",
          "810:  snprintf(buf, buflen, \"origin AS: %s, route target %s\",",
          "811:      asbuf,",
          "812:      bgp_vpn_rd_print(ndo, (u_char *)&route_target));",
          "814:  return 5 + (plen + 7) / 8;",
          "817:  return -2;",
          "824:  struct in_addr addr;",
          "825:  u_int plen;",
          "827:  ND_TCHECK_1(pptr);",
          "830:  if ((24+64) > plen)",
          "831:   return -1;",
          "835:  if (32 < plen)",
          "836:   return -1;",
          "838:  memset(&addr, 0, sizeof(addr));",
          "839:  ND_TCHECK_LEN(pptr + 12, (plen + 7) / 8);",
          "840:  memcpy(&addr, pptr + 12, (plen + 7) / 8);",
          "841:  if (plen % 8) {",
          "842:   ((u_char *)&addr)[(plen + 7) / 8 - 1] &=",
          "843:    ((0xff00 >> (plen % 8)) & 0xff);",
          "844:  }",
          "846:  snprintf(buf, buflen, \"RD: %s, %s/%d, label:%u %s\",",
          "847:                  bgp_vpn_rd_print(ndo, pptr+4),",
          "848:                  ipaddr_string(ndo, &addr),",
          "849:                  plen,",
          "850:                  EXTRACT_BE_U_3(pptr + 1)>>4,",
          "851:                  ((pptr[3]&1)==0) ? \"(BOGUS: Bottom of Stack NOT set!)\" : \"(bottom)\" );",
          "853:  return 12 + (plen + 7) / 8;",
          "856:  return -2;",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "869: static int",
          "870: decode_mdt_vpn_nlri(netdissect_options *ndo,",
          "872: {",
          "873:     const u_char *rd;",
          "874:     const u_char *vpn_ip;",
          "",
          "[Removed Lines]",
          "871:             const u_char *pptr, char *buf, u_int buflen)",
          "",
          "[Added Lines]",
          "873:                     const u_char *pptr, char *buf, u_int buflen)",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "879:     if (EXTRACT_U_1(pptr) != MDT_VPN_NLRI_LEN * 8)",
          "881:     pptr++;",
          "884:     ND_TCHECK_8(pptr);",
          "885:     rd = pptr;",
          "889:     ND_TCHECK_LEN(pptr, sizeof(struct in_addr));",
          "890:     vpn_ip = pptr;",
          "894:     ND_TCHECK_LEN(pptr, sizeof(struct in_addr));",
          "896:     snprintf(buf, buflen, \"RD: %s, VPN IP Address: %s, MC Group Address: %s\",",
          "899:     return MDT_VPN_NLRI_LEN + 1;",
          "901:  trunc:",
          "903: }",
          "905: #define BGP_MULTICAST_VPN_ROUTE_TYPE_INTRA_AS_I_PMSI   1",
          "",
          "[Removed Lines]",
          "880:         return -1;",
          "886:     pptr += 8;",
          "891:     pptr += sizeof(struct in_addr);",
          "897:              bgp_vpn_rd_print(ndo, rd), ipaddr_string(ndo, vpn_ip), ipaddr_string(ndo, pptr));",
          "902:     return -2;",
          "",
          "[Added Lines]",
          "883:  return -1;",
          "889:     pptr+=8;",
          "894:     pptr+=sizeof(struct in_addr);",
          "900:       bgp_vpn_rd_print(ndo, rd), ipaddr_string(ndo, vpn_ip), ipaddr_string(ndo, pptr));",
          "906: return -2;",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "924: static int",
          "925: decode_multicast_vpn(netdissect_options *ndo,",
          "927: {",
          "1009: trunc:",
          "1011: }",
          "",
          "[Removed Lines]",
          "926:              const u_char *pptr, char *buf, u_int buflen)",
          "928:     uint8_t route_type, route_length, addr_length, sg_length;",
          "929:     u_int offset;",
          "931:     ND_TCHECK_2(pptr);",
          "932:     route_type = EXTRACT_U_1(pptr);",
          "933:     pptr++;",
          "934:     route_length = EXTRACT_U_1(pptr);",
          "935:     pptr++;",
          "937:     snprintf(buf, buflen, \"Route-Type: %s (%u), length: %u\",",
          "938:          tok2str(bgp_multicast_vpn_route_type_values,",
          "939:                  \"Unknown\", route_type),",
          "940:          route_type, route_length);",
          "942:     switch(route_type) {",
          "943:     case BGP_MULTICAST_VPN_ROUTE_TYPE_INTRA_AS_I_PMSI:",
          "944:         ND_TCHECK_LEN(pptr, BGP_VPN_RD_LEN);",
          "945:         offset = strlen(buf);",
          "946:         snprintf(buf + offset, buflen - offset, \", RD: %s, Originator %s\",",
          "947:                  bgp_vpn_rd_print(ndo, pptr),",
          "948:                  bgp_vpn_ip_print(ndo, pptr + BGP_VPN_RD_LEN,",
          "949:                                   (route_length - BGP_VPN_RD_LEN) << 3));",
          "950:         break;",
          "951:     case BGP_MULTICAST_VPN_ROUTE_TYPE_INTER_AS_I_PMSI:",
          "952:         ND_TCHECK_LEN(pptr, BGP_VPN_RD_LEN + 4);",
          "953:         offset = strlen(buf);",
          "954:         snprintf(buf + offset, buflen - offset, \", RD: %s, Source-AS %s\",",
          "955:         bgp_vpn_rd_print(ndo, pptr),",
          "956:         as_printf(ndo, astostr, sizeof(astostr),",
          "957:         EXTRACT_BE_U_4(pptr + BGP_VPN_RD_LEN)));",
          "958:         break;",
          "960:     case BGP_MULTICAST_VPN_ROUTE_TYPE_S_PMSI:",
          "961:         ND_TCHECK_LEN(pptr, BGP_VPN_RD_LEN);",
          "962:         offset = strlen(buf);",
          "963:         snprintf(buf + offset, buflen - offset, \", RD: %s\",",
          "964:                  bgp_vpn_rd_print(ndo, pptr));",
          "965:         pptr += BGP_VPN_RD_LEN;",
          "967:         sg_length = bgp_vpn_sg_print(ndo, pptr, buf, buflen);",
          "968:         addr_length =  route_length - sg_length;",
          "970:         ND_TCHECK_LEN(pptr, addr_length);",
          "971:         offset = strlen(buf);",
          "972:         snprintf(buf + offset, buflen - offset, \", Originator %s\",",
          "973:                  bgp_vpn_ip_print(ndo, pptr, addr_length << 3));",
          "974:         break;",
          "976:     case BGP_MULTICAST_VPN_ROUTE_TYPE_SOURCE_ACTIVE:",
          "977:         ND_TCHECK_LEN(pptr, BGP_VPN_RD_LEN);",
          "978:         offset = strlen(buf);",
          "979:         snprintf(buf + offset, buflen - offset, \", RD: %s\",",
          "980:                  bgp_vpn_rd_print(ndo, pptr));",
          "981:         pptr += BGP_VPN_RD_LEN;",
          "983:         bgp_vpn_sg_print(ndo, pptr, buf, buflen);",
          "984:         break;",
          "987:     case BGP_MULTICAST_VPN_ROUTE_TYPE_SOURCE_TREE_JOIN:",
          "988:         ND_TCHECK_LEN(pptr, BGP_VPN_RD_LEN + 4);",
          "989:         offset = strlen(buf);",
          "990:         snprintf(buf + offset, buflen - offset, \", RD: %s, Source-AS %s\",",
          "991:         bgp_vpn_rd_print(ndo, pptr),",
          "992:         as_printf(ndo, astostr, sizeof(astostr),",
          "993:         EXTRACT_BE_U_4(pptr + BGP_VPN_RD_LEN)));",
          "994:         pptr += BGP_VPN_RD_LEN + 4;",
          "996:         bgp_vpn_sg_print(ndo, pptr, buf, buflen);",
          "997:         break;",
          "1002:     case BGP_MULTICAST_VPN_ROUTE_TYPE_INTRA_AS_SEG_LEAF:",
          "1003:     default:",
          "1004:         break;",
          "1005:     }",
          "1007:     return route_length + 2;",
          "1010:     return -2;",
          "",
          "[Added Lines]",
          "930:                      const u_char *pptr, char *buf, u_int buflen)",
          "932:         uint8_t route_type, route_length, addr_length, sg_length;",
          "933:         u_int offset;",
          "935:  ND_TCHECK_2(pptr);",
          "936:         route_type = EXTRACT_U_1(pptr);",
          "937:         pptr++;",
          "938:         route_length = EXTRACT_U_1(pptr);",
          "939:         pptr++;",
          "941:         snprintf(buf, buflen, \"Route-Type: %s (%u), length: %u\",",
          "942:                  tok2str(bgp_multicast_vpn_route_type_values,",
          "943:                          \"Unknown\", route_type),",
          "944:                  route_type, route_length);",
          "946:         switch(route_type) {",
          "947:         case BGP_MULTICAST_VPN_ROUTE_TYPE_INTRA_AS_I_PMSI:",
          "948:             ND_TCHECK_LEN(pptr, BGP_VPN_RD_LEN);",
          "949:             offset = strlen(buf);",
          "950:             snprintf(buf + offset, buflen - offset, \", RD: %s, Originator %s\",",
          "951:                      bgp_vpn_rd_print(ndo, pptr),",
          "952:                      bgp_vpn_ip_print(ndo, pptr + BGP_VPN_RD_LEN,",
          "953:                                       (route_length - BGP_VPN_RD_LEN) << 3));",
          "954:             break;",
          "955:         case BGP_MULTICAST_VPN_ROUTE_TYPE_INTER_AS_I_PMSI:",
          "956:             ND_TCHECK_LEN(pptr, BGP_VPN_RD_LEN + 4);",
          "957:             offset = strlen(buf);",
          "958:      snprintf(buf + offset, buflen - offset, \", RD: %s, Source-AS %s\",",
          "959:   bgp_vpn_rd_print(ndo, pptr),",
          "960:   as_printf(ndo, astostr, sizeof(astostr),",
          "961:   EXTRACT_BE_U_4(pptr + BGP_VPN_RD_LEN)));",
          "962:             break;",
          "964:         case BGP_MULTICAST_VPN_ROUTE_TYPE_S_PMSI:",
          "965:             ND_TCHECK_LEN(pptr, BGP_VPN_RD_LEN);",
          "966:             offset = strlen(buf);",
          "967:             snprintf(buf + offset, buflen - offset, \", RD: %s\",",
          "968:                      bgp_vpn_rd_print(ndo, pptr));",
          "969:             pptr += BGP_VPN_RD_LEN;",
          "971:             sg_length = bgp_vpn_sg_print(ndo, pptr, buf, buflen);",
          "972:             addr_length =  route_length - sg_length;",
          "974:             ND_TCHECK_LEN(pptr, addr_length);",
          "975:             offset = strlen(buf);",
          "976:             snprintf(buf + offset, buflen - offset, \", Originator %s\",",
          "977:                      bgp_vpn_ip_print(ndo, pptr, addr_length << 3));",
          "978:             break;",
          "980:         case BGP_MULTICAST_VPN_ROUTE_TYPE_SOURCE_ACTIVE:",
          "981:             ND_TCHECK_LEN(pptr, BGP_VPN_RD_LEN);",
          "982:             offset = strlen(buf);",
          "983:             snprintf(buf + offset, buflen - offset, \", RD: %s\",",
          "984:                      bgp_vpn_rd_print(ndo, pptr));",
          "985:             pptr += BGP_VPN_RD_LEN;",
          "987:             bgp_vpn_sg_print(ndo, pptr, buf, buflen);",
          "988:             break;",
          "991:         case BGP_MULTICAST_VPN_ROUTE_TYPE_SOURCE_TREE_JOIN:",
          "992:             ND_TCHECK_LEN(pptr, BGP_VPN_RD_LEN + 4);",
          "993:             offset = strlen(buf);",
          "994:      snprintf(buf + offset, buflen - offset, \", RD: %s, Source-AS %s\",",
          "995:   bgp_vpn_rd_print(ndo, pptr),",
          "996:   as_printf(ndo, astostr, sizeof(astostr),",
          "997:   EXTRACT_BE_U_4(pptr + BGP_VPN_RD_LEN)));",
          "998:             pptr += BGP_VPN_RD_LEN + 4;",
          "1000:             bgp_vpn_sg_print(ndo, pptr, buf, buflen);",
          "1001:             break;",
          "1006:         case BGP_MULTICAST_VPN_ROUTE_TYPE_INTRA_AS_SEG_LEAF:",
          "1007:         default:",
          "1008:             break;",
          "1009:         }",
          "1011:         return route_length + 2;",
          "1014:  return -2;",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1023: #define UPDATE_BUF_BUFLEN(buf, buflen, stringlen) \\",
          "1024:     if (stringlen<0) \\",
          "1026:     else if ((u_int)stringlen>buflen) \\",
          "1027:         buflen=0; \\",
          "1028:     else { \\",
          "1029:         buflen-=stringlen; \\",
          "1031:     }",
          "1033: static int",
          "1034: decode_labeled_vpn_l2(netdissect_options *ndo,",
          "1036: {",
          "1124: trunc:",
          "1126: }",
          "1128: int",
          "1129: decode_prefix6(netdissect_options *ndo,",
          "1130:                const u_char *pd, u_int itemlen, char *buf, u_int buflen)",
          "1131: {",
          "1154: trunc:",
          "1157: badtlv:",
          "1159: }",
          "1161: static int",
          "1162: decode_labeled_prefix6(netdissect_options *ndo,",
          "1164: {",
          "1199: trunc:",
          "1202: badtlv:",
          "1204: }",
          "1206: static int",
          "1207: decode_labeled_vpn_prefix6(netdissect_options *ndo,",
          "1208:                            const u_char *pptr, char *buf, u_int buflen)",
          "1209: {",
          "1241: trunc:",
          "1243: }",
          "1245: static int",
          "1246: decode_clnp_prefix(netdissect_options *ndo,",
          "1247:                    const u_char *pptr, char *buf, u_int buflen)",
          "1248: {",
          "1271: trunc:",
          "1273: }",
          "1275: static int",
          "1276: decode_labeled_vpn_clnp_prefix(netdissect_options *ndo,",
          "1278: {",
          "1310: trunc:",
          "1312: }",
          "",
          "[Removed Lines]",
          "1025:         buflen=0; \\",
          "1030:         buf+=stringlen; \\",
          "1035:               const u_char *pptr, char *buf, u_int buflen)",
          "1037:     int plen,tlen,stringlen,tlv_type,tlv_len,ttlv_len;",
          "1039:     ND_TCHECK_2(pptr);",
          "1040:     plen=EXTRACT_BE_U_2(pptr);",
          "1041:     tlen=plen;",
          "1042:     pptr += 2;",
          "1047:     if (plen==12) {",
          "1049:         ND_TCHECK_LEN(pptr, 12);",
          "1050:         buf[0]='\\0';",
          "1051:         stringlen=snprintf(buf, buflen, \"RD: %s, BGPNH: %s\",",
          "1052:                            bgp_vpn_rd_print(ndo, pptr),",
          "1053:                            ipaddr_string(ndo, pptr+8)",
          "1054:                    );",
          "1055:         UPDATE_BUF_BUFLEN(buf, buflen, stringlen);",
          "1056:         pptr+=12;",
          "1057:         tlen-=12;",
          "1058:         return plen;",
          "1059:     } else if (plen>17) {",
          "1063:         ND_TCHECK_LEN(pptr, 15);",
          "1064:         buf[0]='\\0';",
          "1065:         stringlen=snprintf(buf, buflen, \"RD: %s, CE-ID: %u, Label-Block Offset: %u, Label Base %u\",",
          "1066:                            bgp_vpn_rd_print(ndo, pptr),",
          "1067:                            EXTRACT_BE_U_2(pptr + 8),",
          "1068:                            EXTRACT_BE_U_2(pptr + 10),",
          "1070:         UPDATE_BUF_BUFLEN(buf, buflen, stringlen);",
          "1071:         pptr+=15;",
          "1072:         tlen-=15;",
          "1075:         while (tlen>0) {",
          "1076:             if (tlen < 3)",
          "1077:                 return -1;",
          "1078:             ND_TCHECK_3(pptr);",
          "1079:             tlv_type=EXTRACT_U_1(pptr);",
          "1080:             pptr++;",
          "1081:             tlv_len=EXTRACT_BE_U_2(pptr);",
          "1082:             ttlv_len=tlv_len;",
          "1083:             pptr+=2;",
          "1085:             switch(tlv_type) {",
          "1086:             case 1:",
          "1087:                 if (buflen!=0) {",
          "1088:                     stringlen=snprintf(buf,buflen, \"\\n\\t\\tcircuit status vector (%u) length: %u: 0x\",",
          "1089:                                        tlv_type,",
          "1090:                                        tlv_len);",
          "1091:                     UPDATE_BUF_BUFLEN(buf, buflen, stringlen);",
          "1092:                 }",
          "1094:                 while (ttlv_len>0) {",
          "1095:                     ND_TCHECK_1(pptr);",
          "1096:                     if (buflen!=0) {",
          "1097:                         stringlen=snprintf(buf,buflen, \"%02x\",",
          "1098:                                            EXTRACT_U_1(pptr));",
          "1099:                         pptr++;",
          "1100:                         UPDATE_BUF_BUFLEN(buf, buflen, stringlen);",
          "1101:                     }",
          "1102:                     ttlv_len--;",
          "1103:                 }",
          "1104:                 break;",
          "1105:             default:",
          "1106:                 if (buflen!=0) {",
          "1107:                     stringlen=snprintf(buf,buflen, \"\\n\\t\\tunknown TLV #%u, length: %u\",",
          "1108:                                        tlv_type,",
          "1109:                                        tlv_len);",
          "1110:                     UPDATE_BUF_BUFLEN(buf, buflen, stringlen);",
          "1111:                 }",
          "1112:                 break;",
          "1113:             }",
          "1115:         }",
          "1116:         return plen+2;",
          "1118:     } else {",
          "1121:         goto trunc;",
          "1122:     }",
          "1125:     return -2;",
          "1132:     struct in6_addr addr;",
          "1133:     u_int plen, plenbytes;",
          "1135:     ND_TCHECK_1(pd);",
          "1136:     ITEMCHECK(1);",
          "1137:     plen = EXTRACT_U_1(pd);",
          "1138:     if (128 < plen)",
          "1139:         return -1;",
          "1140:     itemlen -= 1;",
          "1142:     memset(&addr, 0, sizeof(addr));",
          "1143:     plenbytes = (plen + 7) / 8;",
          "1144:     ND_TCHECK_LEN(pd + 1, plenbytes);",
          "1145:     ITEMCHECK(plenbytes);",
          "1146:     memcpy(&addr, pd + 1, plenbytes);",
          "1147:     if (plen % 8) {",
          "1148:         addr.s6_addr[plenbytes - 1] &=",
          "1149:             ((0xff00 >> (plen % 8)) & 0xff);",
          "1150:     }",
          "1151:     snprintf(buf, buflen, \"%s/%d\", ip6addr_string(ndo, &addr), plen);",
          "1152:     return 1 + plenbytes;",
          "1155:     return -2;",
          "1158:     return -3;",
          "1163:                const u_char *pptr, u_int itemlen, char *buf, u_int buflen)",
          "1165:     struct in6_addr addr;",
          "1166:     u_int plen, plenbytes;",
          "1169:     ND_TCHECK_4(pptr);",
          "1170:     ITEMCHECK(4);",
          "1173:     if (24 > plen)",
          "1174:         return -1;",
          "1178:     if (128 < plen)",
          "1179:         return -1;",
          "1180:     itemlen -= 4;",
          "1182:     memset(&addr, 0, sizeof(addr));",
          "1183:     plenbytes = (plen + 7) / 8;",
          "1184:     ND_TCHECK_LEN(pptr + 4, plenbytes);",
          "1185:     memcpy(&addr, pptr + 4, plenbytes);",
          "1186:     if (plen % 8) {",
          "1187:         addr.s6_addr[plenbytes - 1] &=",
          "1188:             ((0xff00 >> (plen % 8)) & 0xff);",
          "1189:     }",
          "1191:     snprintf(buf, buflen, \"%s/%d, label:%u %s\",",
          "1192:              ip6addr_string(ndo, &addr),",
          "1193:              plen,",
          "1194:              EXTRACT_BE_U_3(pptr + 1)>>4,",
          "1195:              ((pptr[3]&1)==0) ? \"(BOGUS: Bottom of Stack NOT set!)\" : \"(bottom)\" );",
          "1197:     return 4 + plenbytes;",
          "1200:     return -2;",
          "1203:     return -3;",
          "1210:     struct in6_addr addr;",
          "1211:     u_int plen;",
          "1213:     ND_TCHECK_1(pptr);",
          "1216:     if ((24+64) > plen)",
          "1217:         return -1;",
          "1221:     if (128 < plen)",
          "1222:         return -1;",
          "1224:     memset(&addr, 0, sizeof(addr));",
          "1225:     ND_TCHECK_LEN(pptr + 12, (plen + 7) / 8);",
          "1226:     memcpy(&addr, pptr + 12, (plen + 7) / 8);",
          "1227:     if (plen % 8) {",
          "1228:         addr.s6_addr[(plen + 7) / 8 - 1] &=",
          "1229:             ((0xff00 >> (plen % 8)) & 0xff);",
          "1230:     }",
          "1232:     snprintf(buf, buflen, \"RD: %s, %s/%d, label:%u %s\",",
          "1233:              bgp_vpn_rd_print(ndo, pptr+4),",
          "1234:              ip6addr_string(ndo, &addr),",
          "1235:              plen,",
          "1236:              EXTRACT_BE_U_3(pptr + 1)>>4,",
          "1237:               ((pptr[3]&1)==0) ? \"(BOGUS: Bottom of Stack NOT set!)\" : \"(bottom)\" );",
          "1239:     return 12 + (plen + 7) / 8;",
          "1242:     return -2;",
          "1249:     uint8_t addr[19];",
          "1250:     u_int plen;",
          "1252:     ND_TCHECK_1(pptr);",
          "1255:     if (152 < plen)",
          "1256:         return -1;",
          "1258:     memset(&addr, 0, sizeof(addr));",
          "1259:     ND_TCHECK_LEN(pptr + 4, (plen + 7) / 8);",
          "1260:     memcpy(&addr, pptr + 4, (plen + 7) / 8);",
          "1261:     if (plen % 8) {",
          "1262:         addr[(plen + 7) / 8 - 1] &=",
          "1263:             ((0xff00 >> (plen % 8)) & 0xff);",
          "1264:     }",
          "1265:     snprintf(buf, buflen, \"%s/%d\",",
          "1266:              isonsap_string(ndo, addr,(plen + 7) / 8),",
          "1267:              plen);",
          "1269:     return 1 + (plen + 7) / 8;",
          "1272:     return -2;",
          "1277:                    const u_char *pptr, char *buf, u_int buflen)",
          "1279:     uint8_t addr[19];",
          "1280:     u_int plen;",
          "1282:     ND_TCHECK_1(pptr);",
          "1285:     if ((24+64) > plen)",
          "1286:         return -1;",
          "1290:     if (152 < plen)",
          "1291:         return -1;",
          "1293:     memset(&addr, 0, sizeof(addr));",
          "1294:     ND_TCHECK_LEN(pptr + 12, (plen + 7) / 8);",
          "1295:     memcpy(&addr, pptr + 12, (plen + 7) / 8);",
          "1296:     if (plen % 8) {",
          "1297:         addr[(plen + 7) / 8 - 1] &=",
          "1298:             ((0xff00 >> (plen % 8)) & 0xff);",
          "1299:     }",
          "1301:     snprintf(buf, buflen, \"RD: %s, %s/%d, label:%u %s\",",
          "1302:              bgp_vpn_rd_print(ndo, pptr+4),",
          "1303:              isonsap_string(ndo, addr,(plen + 7) / 8),",
          "1304:              plen,",
          "1305:              EXTRACT_BE_U_3(pptr + 1)>>4,",
          "1306:              ((pptr[3]&1)==0) ? \"(BOGUS: Bottom of Stack NOT set!)\" : \"(bottom)\" );",
          "1308:     return 12 + (plen + 7) / 8;",
          "1311:     return -2;",
          "",
          "[Added Lines]",
          "1029:         buflen=0; \\",
          "1034:  buf+=stringlen; \\",
          "1039:                       const u_char *pptr, char *buf, u_int buflen)",
          "1041:         int plen,tlen,stringlen,tlv_type,tlv_len,ttlv_len;",
          "1043:  ND_TCHECK_2(pptr);",
          "1044:         plen=EXTRACT_BE_U_2(pptr);",
          "1045:         tlen=plen;",
          "1046:         pptr+=2;",
          "1051:         if (plen==12) {",
          "1053:      ND_TCHECK_LEN(pptr, 12);",
          "1054:      buf[0]='\\0';",
          "1055:      stringlen=snprintf(buf, buflen, \"RD: %s, BGPNH: %s\",",
          "1056:           bgp_vpn_rd_print(ndo, pptr),",
          "1057:           ipaddr_string(ndo, pptr+8)",
          "1058:           );",
          "1059:      UPDATE_BUF_BUFLEN(buf, buflen, stringlen);",
          "1060:      pptr+=12;",
          "1061:      tlen-=12;",
          "1062:      return plen;",
          "1063:         } else if (plen>17) {",
          "1067:      ND_TCHECK_LEN(pptr, 15);",
          "1068:      buf[0]='\\0';",
          "1069:      stringlen=snprintf(buf, buflen, \"RD: %s, CE-ID: %u, Label-Block Offset: %u, Label Base %u\",",
          "1070:           bgp_vpn_rd_print(ndo, pptr),",
          "1071:           EXTRACT_BE_U_2(pptr + 8),",
          "1072:           EXTRACT_BE_U_2(pptr + 10),",
          "1074:      UPDATE_BUF_BUFLEN(buf, buflen, stringlen);",
          "1075:      pptr+=15;",
          "1076:      tlen-=15;",
          "1079:      while (tlen>0) {",
          "1080:   if (tlen < 3)",
          "1081:       return -1;",
          "1082:   ND_TCHECK_3(pptr);",
          "1083:   tlv_type=EXTRACT_U_1(pptr);",
          "1084:   pptr++;",
          "1085:   tlv_len=EXTRACT_BE_U_2(pptr);",
          "1086:   ttlv_len=tlv_len;",
          "1087:   pptr+=2;",
          "1089:   switch(tlv_type) {",
          "1090:   case 1:",
          "1091:       if (buflen!=0) {",
          "1092:    stringlen=snprintf(buf,buflen, \"\\n\\t\\tcircuit status vector (%u) length: %u: 0x\",",
          "1093:         tlv_type,",
          "1094:         tlv_len);",
          "1095:    UPDATE_BUF_BUFLEN(buf, buflen, stringlen);",
          "1096:       }",
          "1098:       while (ttlv_len>0) {",
          "1099:    ND_TCHECK_1(pptr);",
          "1100:    if (buflen!=0) {",
          "1101:        stringlen=snprintf(buf,buflen, \"%02x\",",
          "1102:                                                EXTRACT_U_1(pptr));",
          "1103:        pptr++;",
          "1104:        UPDATE_BUF_BUFLEN(buf, buflen, stringlen);",
          "1105:    }",
          "1106:    ttlv_len--;",
          "1107:       }",
          "1108:       break;",
          "1109:   default:",
          "1110:       if (buflen!=0) {",
          "1111:    stringlen=snprintf(buf,buflen, \"\\n\\t\\tunknown TLV #%u, length: %u\",",
          "1112:         tlv_type,",
          "1113:         tlv_len);",
          "1114:    UPDATE_BUF_BUFLEN(buf, buflen, stringlen);",
          "1115:       }",
          "1116:       break;",
          "1117:   }",
          "1119:      }",
          "1120:      return plen+2;",
          "1122:         } else {",
          "1125:             goto trunc;",
          "1126:         }",
          "1129:         return -2;",
          "1136:  struct in6_addr addr;",
          "1137:  u_int plen, plenbytes;",
          "1139:  ND_TCHECK_1(pd);",
          "1140:  ITEMCHECK(1);",
          "1141:  plen = EXTRACT_U_1(pd);",
          "1142:  if (128 < plen)",
          "1143:   return -1;",
          "1144:  itemlen -= 1;",
          "1146:  memset(&addr, 0, sizeof(addr));",
          "1147:  plenbytes = (plen + 7) / 8;",
          "1148:  ND_TCHECK_LEN(pd + 1, plenbytes);",
          "1149:  ITEMCHECK(plenbytes);",
          "1150:  memcpy(&addr, pd + 1, plenbytes);",
          "1151:  if (plen % 8) {",
          "1152:   addr.s6_addr[plenbytes - 1] &=",
          "1153:    ((0xff00 >> (plen % 8)) & 0xff);",
          "1154:  }",
          "1155:  snprintf(buf, buflen, \"%s/%d\", ip6addr_string(ndo, &addr), plen);",
          "1156:  return 1 + plenbytes;",
          "1159:  return -2;",
          "1162:  return -3;",
          "1167:                        const u_char *pptr, u_int itemlen, char *buf, u_int buflen)",
          "1169:  struct in6_addr addr;",
          "1170:  u_int plen, plenbytes;",
          "1173:  ND_TCHECK_4(pptr);",
          "1174:  ITEMCHECK(4);",
          "1177:  if (24 > plen)",
          "1178:   return -1;",
          "1182:  if (128 < plen)",
          "1183:   return -1;",
          "1184:  itemlen -= 4;",
          "1186:  memset(&addr, 0, sizeof(addr));",
          "1187:  plenbytes = (plen + 7) / 8;",
          "1188:  ND_TCHECK_LEN(pptr + 4, plenbytes);",
          "1189:  memcpy(&addr, pptr + 4, plenbytes);",
          "1190:  if (plen % 8) {",
          "1191:   addr.s6_addr[plenbytes - 1] &=",
          "1192:    ((0xff00 >> (plen % 8)) & 0xff);",
          "1193:  }",
          "1195:  snprintf(buf, buflen, \"%s/%d, label:%u %s\",",
          "1196:                  ip6addr_string(ndo, &addr),",
          "1197:                  plen,",
          "1198:                  EXTRACT_BE_U_3(pptr + 1)>>4,",
          "1199:                  ((pptr[3]&1)==0) ? \"(BOGUS: Bottom of Stack NOT set!)\" : \"(bottom)\" );",
          "1201:  return 4 + plenbytes;",
          "1204:  return -2;",
          "1207:  return -3;",
          "1214:  struct in6_addr addr;",
          "1215:  u_int plen;",
          "1217:  ND_TCHECK_1(pptr);",
          "1220:  if ((24+64) > plen)",
          "1221:   return -1;",
          "1225:  if (128 < plen)",
          "1226:   return -1;",
          "1228:  memset(&addr, 0, sizeof(addr));",
          "1229:  ND_TCHECK_LEN(pptr + 12, (plen + 7) / 8);",
          "1230:  memcpy(&addr, pptr + 12, (plen + 7) / 8);",
          "1231:  if (plen % 8) {",
          "1232:   addr.s6_addr[(plen + 7) / 8 - 1] &=",
          "1233:    ((0xff00 >> (plen % 8)) & 0xff);",
          "1234:  }",
          "1236:  snprintf(buf, buflen, \"RD: %s, %s/%d, label:%u %s\",",
          "1237:                  bgp_vpn_rd_print(ndo, pptr+4),",
          "1238:                  ip6addr_string(ndo, &addr),",
          "1239:                  plen,",
          "1240:                  EXTRACT_BE_U_3(pptr + 1)>>4,",
          "1241:                  ((pptr[3]&1)==0) ? \"(BOGUS: Bottom of Stack NOT set!)\" : \"(bottom)\" );",
          "1243:  return 12 + (plen + 7) / 8;",
          "1246:  return -2;",
          "1253:         uint8_t addr[19];",
          "1254:  u_int plen;",
          "1256:  ND_TCHECK_1(pptr);",
          "1259:  if (152 < plen)",
          "1260:   return -1;",
          "1262:  memset(&addr, 0, sizeof(addr));",
          "1263:  ND_TCHECK_LEN(pptr + 4, (plen + 7) / 8);",
          "1264:  memcpy(&addr, pptr + 4, (plen + 7) / 8);",
          "1265:  if (plen % 8) {",
          "1266:   addr[(plen + 7) / 8 - 1] &=",
          "1267:    ((0xff00 >> (plen % 8)) & 0xff);",
          "1268:  }",
          "1269:  snprintf(buf, buflen, \"%s/%d\",",
          "1270:                  isonsap_string(ndo, addr,(plen + 7) / 8),",
          "1271:                  plen);",
          "1273:  return 1 + (plen + 7) / 8;",
          "1276:  return -2;",
          "1281:                                const u_char *pptr, char *buf, u_int buflen)",
          "1283:         uint8_t addr[19];",
          "1284:  u_int plen;",
          "1286:  ND_TCHECK_1(pptr);",
          "1289:  if ((24+64) > plen)",
          "1290:   return -1;",
          "1294:  if (152 < plen)",
          "1295:   return -1;",
          "1297:  memset(&addr, 0, sizeof(addr));",
          "1298:  ND_TCHECK_LEN(pptr + 12, (plen + 7) / 8);",
          "1299:  memcpy(&addr, pptr + 12, (plen + 7) / 8);",
          "1300:  if (plen % 8) {",
          "1301:   addr[(plen + 7) / 8 - 1] &=",
          "1302:    ((0xff00 >> (plen % 8)) & 0xff);",
          "1303:  }",
          "1305:  snprintf(buf, buflen, \"RD: %s, %s/%d, label:%u %s\",",
          "1306:                  bgp_vpn_rd_print(ndo, pptr+4),",
          "1307:                  isonsap_string(ndo, addr,(plen + 7) / 8),",
          "1308:                  plen,",
          "1309:                  EXTRACT_BE_U_3(pptr + 1)>>4,",
          "1310:                  ((pptr[3]&1)==0) ? \"(BOGUS: Bottom of Stack NOT set!)\" : \"(bottom)\" );",
          "1312:  return 12 + (plen + 7) / 8;",
          "1315:  return -2;",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1370: }",
          "1372: static int",
          "1373: bgp_attr_print(netdissect_options *ndo,",
          "1374:                u_int atype, const u_char *pptr, u_int len)",
          "1375: {",
          "1515:                 break;",
          "1518:                 break;",
          "1524:                 break;",
          "1616:                 switch(af<<8 | safi) {",
          "1617:                 case (AFNUM_INET<<8 | SAFNUM_UNICAST):",
          "1618:                 case (AFNUM_INET<<8 | SAFNUM_MULTICAST):",
          "1619:                 case (AFNUM_INET<<8 | SAFNUM_UNIMULTICAST):",
          "1620:                 case (AFNUM_INET<<8 | SAFNUM_LABUNICAST):",
          "1621:                 case (AFNUM_INET<<8 | SAFNUM_RT_ROUTING_INFO):",
          "1634:                 case (AFNUM_INET<<8 | SAFNUM_VPNUNICAST):",
          "1635:                 case (AFNUM_INET<<8 | SAFNUM_VPNMULTICAST):",
          "1636:                 case (AFNUM_INET<<8 | SAFNUM_VPNUNIMULTICAST):",
          "1650:                 case (AFNUM_INET6<<8 | SAFNUM_UNICAST):",
          "1651:                 case (AFNUM_INET6<<8 | SAFNUM_MULTICAST):",
          "1652:                 case (AFNUM_INET6<<8 | SAFNUM_UNIMULTICAST):",
          "1653:                 case (AFNUM_INET6<<8 | SAFNUM_LABUNICAST):",
          "1664:                 case (AFNUM_INET6<<8 | SAFNUM_VPNUNICAST):",
          "1665:                 case (AFNUM_INET6<<8 | SAFNUM_VPNMULTICAST):",
          "1666:                 case (AFNUM_INET6<<8 | SAFNUM_VPNUNIMULTICAST):",
          "1694:                 case (AFNUM_NSAP<<8 | SAFNUM_UNICAST):",
          "1695:                 case (AFNUM_NSAP<<8 | SAFNUM_MULTICAST):",
          "1696:                 case (AFNUM_NSAP<<8 | SAFNUM_UNIMULTICAST):",
          "1703:                 case (AFNUM_NSAP<<8 | SAFNUM_VPNUNICAST):",
          "1704:                 case (AFNUM_NSAP<<8 | SAFNUM_VPNMULTICAST):",
          "1705:                 case (AFNUM_NSAP<<8 | SAFNUM_VPNUNIMULTICAST):",
          "1723:                     break;",
          "1724:                 default:",
          "1725:                     ND_TCHECK_LEN(tptr, tlen);",
          "1727:                     if (ndo->ndo_vflag <= 1)",
          "1728:                         print_unknown_data(ndo, tptr, \"\\n\\t    \", tlen);",
          "1731:                     goto done;",
          "1732:                     break;",
          "1733:                 }",
          "1809:                 break;",
          "2140:                 break;",
          "2144:         }",
          "2241:                 break;",
          "2308:             break;",
          "2326:             print_unknown_data(ndo, pptr, \"\\n\\t    \", len);",
          "2335: trunc:",
          "2337: }",
          "2339: static void",
          "2340: bgp_capabilities_print(netdissect_options *ndo,",
          "2341:                        const u_char *opt, u_int caps_len)",
          "2342: {",
          "2406:                     break;",
          "2407:                 }",
          "2429:         }",
          "2434: trunc:",
          "2436: }",
          "2438: static void",
          "2439: bgp_open_print(netdissect_options *ndo,",
          "2440:                const u_char *dat, u_int length)",
          "2441: {",
          "2505: trunc:",
          "2507: }",
          "2509: static void",
          "2510: bgp_update_print(netdissect_options *ndo,",
          "2512: {",
          "2610:         }",
          "2641: trunc:",
          "2643: }",
          "2645: static void",
          "2646: bgp_notification_print(netdissect_options *ndo,",
          "2648: {",
          "2752:         }",
          "2759: trunc:",
          "2761: }",
          "2763: static void",
          "2764: bgp_route_refresh_print(netdissect_options *ndo,",
          "2766: {",
          "2791: trunc:",
          "2793: }",
          "2795: static int",
          "2796: bgp_pdu_print(netdissect_options *ndo,",
          "2798: {",
          "2834: trunc:",
          "2837: }",
          "2839: void",
          "2840: bgp_print(netdissect_options *ndo,",
          "2842: {",
          "2895:                 return;",
          "2909: trunc:",
          "2911: }",
          "",
          "[Removed Lines]",
          "1369:     return 4;",
          "1376:     int i;",
          "1377:     uint16_t af;",
          "1378:     uint8_t safi, snpa, nhlen;",
          "1380:         float f;",
          "1381:         uint32_t i;",
          "1382:     } bw;",
          "1383:     int advance;",
          "1384:     u_int tlen;",
          "1385:     const u_char *tptr;",
          "1386:     char buf[MAXHOSTNAMELEN + 100];",
          "1387:     int  as_size;",
          "1389:     tptr = pptr;",
          "1390:     tlen = len;",
          "1392:     switch (atype) {",
          "1393:     case BGPTYPE_ORIGIN:",
          "1394:         if (len != 1)",
          "1395:             ND_PRINT((ndo, \"invalid len\"));",
          "1396:         else {",
          "1397:             ND_TCHECK_1(tptr);",
          "1398:             ND_PRINT((ndo, \"%s\", tok2str(bgp_origin_values,",
          "1399:                       \"Unknown Origin Typecode\",",
          "1400:                       EXTRACT_U_1(tptr))));",
          "1401:         }",
          "1402:         break;",
          "1407:     case BGPTYPE_AS4_PATH:",
          "1408:     case BGPTYPE_AS_PATH:",
          "1409:         if (len % 2) {",
          "1410:             ND_PRINT((ndo, \"invalid len\"));",
          "1411:             break;",
          "1412:         }",
          "1413:         if (!len) {",
          "1414:             ND_PRINT((ndo, \"empty\"));",
          "1415:             break;",
          "1416:         }",
          "1426:         as_size = bgp_attr_get_as_size(ndo, atype, pptr, len);",
          "1428:         while (tptr < pptr + len) {",
          "1429:             ND_TCHECK_1(tptr);",
          "1430:             ND_PRINT((ndo, \"%s\", tok2str(bgp_as_path_segment_open_values,",
          "1431:                       \"?\", EXTRACT_U_1(tptr))));",
          "1432:             ND_TCHECK_1(tptr + 1);",
          "1433:             for (i = 0; i < tptr[1] * as_size; i += as_size) {",
          "1434:                 ND_TCHECK_LEN(tptr + 2 + i, as_size);",
          "1435:                 ND_PRINT((ndo, \"%s \",",
          "1436:                           as_printf(ndo, astostr, sizeof(astostr),",
          "1437:                 as_size == 2 ?",
          "1438:                     EXTRACT_BE_U_2(tptr + i + 2) :",
          "1439:                     EXTRACT_BE_U_4(tptr + i + 2))));",
          "1440:             }",
          "1441:             ND_TCHECK_1(tptr);",
          "1442:             ND_PRINT((ndo, \"%s\", tok2str(bgp_as_path_segment_close_values,",
          "1443:                       \"?\", EXTRACT_U_1(tptr))));",
          "1444:             ND_TCHECK_1(tptr + 1);",
          "1445:             tptr += 2 + EXTRACT_U_1(tptr + 1) * as_size;",
          "1446:         }",
          "1447:         break;",
          "1448:     case BGPTYPE_NEXT_HOP:",
          "1449:         if (len != 4)",
          "1450:             ND_PRINT((ndo, \"invalid len\"));",
          "1451:         else {",
          "1452:             ND_TCHECK_4(tptr);",
          "1453:             ND_PRINT((ndo, \"%s\", ipaddr_string(ndo, tptr)));",
          "1454:         }",
          "1455:         break;",
          "1456:     case BGPTYPE_MULTI_EXIT_DISC:",
          "1457:     case BGPTYPE_LOCAL_PREF:",
          "1458:         if (len != 4)",
          "1459:             ND_PRINT((ndo, \"invalid len\"));",
          "1460:         else {",
          "1461:             ND_TCHECK_4(tptr);",
          "1462:             ND_PRINT((ndo, \"%u\", EXTRACT_BE_U_4(tptr)));",
          "1463:         }",
          "1464:         break;",
          "1465:     case BGPTYPE_ATOMIC_AGGREGATE:",
          "1466:         if (len != 0)",
          "1467:             ND_PRINT((ndo, \"invalid len\"));",
          "1468:         break;",
          "1469:     case BGPTYPE_AGGREGATOR:",
          "1475:         if (len != 6 && len != 8) {",
          "1476:             ND_PRINT((ndo, \"invalid len\"));",
          "1477:             break;",
          "1478:         }",
          "1479:         ND_TCHECK_LEN(tptr, len);",
          "1480:         if (len == 6) {",
          "1481:             ND_PRINT((ndo, \" AS #%s, origin %s\",",
          "1482:                       as_printf(ndo, astostr, sizeof(astostr), EXTRACT_BE_U_2(tptr)),",
          "1483:                       ipaddr_string(ndo, tptr + 2)));",
          "1484:         } else {",
          "1485:             ND_PRINT((ndo, \" AS #%s, origin %s\",",
          "1486:                       as_printf(ndo, astostr, sizeof(astostr),",
          "1487:                       EXTRACT_BE_U_4(tptr)), ipaddr_string(ndo, tptr + 4)));",
          "1488:         }",
          "1489:         break;",
          "1490:     case BGPTYPE_AGGREGATOR4:",
          "1491:         if (len != 8) {",
          "1492:             ND_PRINT((ndo, \"invalid len\"));",
          "1493:             break;",
          "1494:         }",
          "1495:         ND_TCHECK_8(tptr);",
          "1496:         ND_PRINT((ndo, \" AS #%s, origin %s\",",
          "1497:                   as_printf(ndo, astostr, sizeof(astostr), EXTRACT_BE_U_4(tptr)),",
          "1498:                   ipaddr_string(ndo, tptr + 4)));",
          "1499:         break;",
          "1500:     case BGPTYPE_COMMUNITIES:",
          "1501:         if (len % 4) {",
          "1502:             ND_PRINT((ndo, \"invalid len\"));",
          "1503:             break;",
          "1504:         }",
          "1505:         while (tlen>0) {",
          "1506:             uint32_t comm;",
          "1507:             ND_TCHECK_4(tptr);",
          "1508:             comm = EXTRACT_BE_U_4(tptr);",
          "1509:             switch (comm) {",
          "1510:             case BGP_COMMUNITY_NO_EXPORT:",
          "1511:                 ND_PRINT((ndo, \" NO_EXPORT\"));",
          "1512:                 break;",
          "1513:             case BGP_COMMUNITY_NO_ADVERT:",
          "1514:                 ND_PRINT((ndo, \" NO_ADVERTISE\"));",
          "1516:             case BGP_COMMUNITY_NO_EXPORT_SUBCONFED:",
          "1517:                 ND_PRINT((ndo, \" NO_EXPORT_SUBCONFED\"));",
          "1519:             default:",
          "1520:                 ND_PRINT((ndo, \"%u:%u%s\",",
          "1521:                          (comm >> 16) & 0xffff,",
          "1522:                          comm & 0xffff,",
          "1523:                          (tlen>4) ? \", \" : \"\"));",
          "1525:             }",
          "1526:             tlen -=4;",
          "1527:             tptr +=4;",
          "1528:         }",
          "1529:         break;",
          "1530:     case BGPTYPE_ORIGINATOR_ID:",
          "1531:         if (len != 4) {",
          "1532:             ND_PRINT((ndo, \"invalid len\"));",
          "1533:             break;",
          "1534:         }",
          "1535:         ND_TCHECK_4(tptr);",
          "1536:         ND_PRINT((ndo, \"%s\",ipaddr_string(ndo, tptr)));",
          "1537:         break;",
          "1538:     case BGPTYPE_CLUSTER_LIST:",
          "1539:         if (len % 4) {",
          "1540:             ND_PRINT((ndo, \"invalid len\"));",
          "1541:             break;",
          "1542:         }",
          "1543:         while (tlen>0) {",
          "1544:             ND_TCHECK_4(tptr);",
          "1545:             ND_PRINT((ndo, \"%s%s\",",
          "1546:                       ipaddr_string(ndo, tptr),",
          "1547:                       (tlen>4) ? \", \" : \"\"));",
          "1548:             tlen -=4;",
          "1549:             tptr +=4;",
          "1550:         }",
          "1551:         break;",
          "1552:     case BGPTYPE_MP_REACH_NLRI:",
          "1553:         ND_TCHECK_3(tptr);",
          "1554:         af = EXTRACT_BE_U_2(tptr);",
          "1555:         safi = EXTRACT_U_1(tptr + 2);",
          "1557:         ND_PRINT((ndo, \"\\n\\t    AFI: %s (%u), %sSAFI: %s (%u)\",",
          "1558:                   tok2str(af_values, \"Unknown AFI\", af),",
          "1559:                   af,",
          "1561:                   tok2str(bgp_safi_values, \"Unknown SAFI\", safi),",
          "1562:                   safi));",
          "1564:         switch(af<<8 | safi) {",
          "1565:         case (AFNUM_INET<<8 | SAFNUM_UNICAST):",
          "1566:         case (AFNUM_INET<<8 | SAFNUM_MULTICAST):",
          "1567:         case (AFNUM_INET<<8 | SAFNUM_UNIMULTICAST):",
          "1568:         case (AFNUM_INET<<8 | SAFNUM_LABUNICAST):",
          "1569:         case (AFNUM_INET<<8 | SAFNUM_RT_ROUTING_INFO):",
          "1570:         case (AFNUM_INET<<8 | SAFNUM_VPNUNICAST):",
          "1571:         case (AFNUM_INET<<8 | SAFNUM_VPNMULTICAST):",
          "1572:         case (AFNUM_INET<<8 | SAFNUM_VPNUNIMULTICAST):",
          "1573:         case (AFNUM_INET<<8 | SAFNUM_MULTICAST_VPN):",
          "1574:         case (AFNUM_INET<<8 | SAFNUM_MDT):",
          "1575:         case (AFNUM_INET6<<8 | SAFNUM_UNICAST):",
          "1576:         case (AFNUM_INET6<<8 | SAFNUM_MULTICAST):",
          "1577:         case (AFNUM_INET6<<8 | SAFNUM_UNIMULTICAST):",
          "1578:         case (AFNUM_INET6<<8 | SAFNUM_LABUNICAST):",
          "1579:         case (AFNUM_INET6<<8 | SAFNUM_VPNUNICAST):",
          "1580:         case (AFNUM_INET6<<8 | SAFNUM_VPNMULTICAST):",
          "1581:         case (AFNUM_INET6<<8 | SAFNUM_VPNUNIMULTICAST):",
          "1582:         case (AFNUM_NSAP<<8 | SAFNUM_UNICAST):",
          "1583:         case (AFNUM_NSAP<<8 | SAFNUM_MULTICAST):",
          "1584:         case (AFNUM_NSAP<<8 | SAFNUM_UNIMULTICAST):",
          "1585:         case (AFNUM_NSAP<<8 | SAFNUM_VPNUNICAST):",
          "1586:         case (AFNUM_NSAP<<8 | SAFNUM_VPNMULTICAST):",
          "1587:         case (AFNUM_NSAP<<8 | SAFNUM_VPNUNIMULTICAST):",
          "1588:         case (AFNUM_L2VPN<<8 | SAFNUM_VPNUNICAST):",
          "1589:         case (AFNUM_L2VPN<<8 | SAFNUM_VPNMULTICAST):",
          "1590:         case (AFNUM_L2VPN<<8 | SAFNUM_VPNUNIMULTICAST):",
          "1591:         case (AFNUM_VPLS<<8 | SAFNUM_VPLS):",
          "1592:             break;",
          "1593:         default:",
          "1594:             ND_TCHECK_LEN(tptr, tlen);",
          "1595:             ND_PRINT((ndo, \"\\n\\t    no AFI %u / SAFI %u decoder\", af, safi));",
          "1596:             if (ndo->ndo_vflag <= 1)",
          "1597:                 print_unknown_data(ndo, tptr, \"\\n\\t    \", tlen);",
          "1598:             goto done;",
          "1599:             break;",
          "1600:         }",
          "1602:         tptr +=3;",
          "1604:         ND_TCHECK_1(tptr);",
          "1605:         nhlen = EXTRACT_U_1(tptr);",
          "1606:         tlen = nhlen;",
          "1607:         tptr++;",
          "1609:         if (tlen) {",
          "1610:             int nnh = 0;",
          "1611:             ND_PRINT((ndo, \"\\n\\t    nexthop: \"));",
          "1612:             while (tlen > 0) {",
          "1613:                 if (nnh++ > 0) {",
          "1614:                     ND_PRINT((ndo,  \", \" ));",
          "1615:                 }",
          "1622:                 case (AFNUM_INET<<8 | SAFNUM_MULTICAST_VPN):",
          "1623:                 case (AFNUM_INET<<8 | SAFNUM_MDT):",
          "1624:                     if (tlen < sizeof(struct in_addr)) {",
          "1625:                         ND_PRINT((ndo, \"invalid len\"));",
          "1626:                         tlen = 0;",
          "1627:                     } else {",
          "1628:                         ND_TCHECK_LEN(tptr, sizeof(struct in_addr));",
          "1629:                         ND_PRINT((ndo, \"%s\",ipaddr_string(ndo, tptr)));",
          "1630:                         tlen -= sizeof(struct in_addr);",
          "1631:                         tptr += sizeof(struct in_addr);",
          "1632:                     }",
          "1633:                     break;",
          "1637:                     if (tlen < sizeof(struct in_addr)+BGP_VPN_RD_LEN) {",
          "1638:                         ND_PRINT((ndo, \"invalid len\"));",
          "1639:                         tlen = 0;",
          "1640:                     } else {",
          "1641:                         ND_TCHECK_LEN(tptr,",
          "1642:                                       sizeof(struct in_addr) + BGP_VPN_RD_LEN);",
          "1643:                         ND_PRINT((ndo, \"RD: %s, %s\",",
          "1644:                                   bgp_vpn_rd_print(ndo, tptr),",
          "1645:                                   ipaddr_string(ndo, tptr+BGP_VPN_RD_LEN)));",
          "1646:                         tlen -= (sizeof(struct in_addr)+BGP_VPN_RD_LEN);",
          "1647:                         tptr += (sizeof(struct in_addr)+BGP_VPN_RD_LEN);",
          "1648:                     }",
          "1649:                     break;",
          "1654:                     if (tlen < sizeof(struct in6_addr)) {",
          "1655:                         ND_PRINT((ndo, \"invalid len\"));",
          "1656:                         tlen = 0;",
          "1657:                     } else {",
          "1658:                         ND_TCHECK_LEN(tptr, sizeof(struct in6_addr));",
          "1659:                         ND_PRINT((ndo, \"%s\", ip6addr_string(ndo, tptr)));",
          "1660:                         tlen -= sizeof(struct in6_addr);",
          "1661:                         tptr += sizeof(struct in6_addr);",
          "1662:                     }",
          "1663:                     break;",
          "1667:                     if (tlen < sizeof(struct in6_addr)+BGP_VPN_RD_LEN) {",
          "1668:                         ND_PRINT((ndo, \"invalid len\"));",
          "1669:                         tlen = 0;",
          "1670:                     } else {",
          "1671:                         ND_TCHECK_LEN(tptr,",
          "1672:                                       sizeof(struct in6_addr) + BGP_VPN_RD_LEN);",
          "1673:                         ND_PRINT((ndo, \"RD: %s, %s\",",
          "1674:                                   bgp_vpn_rd_print(ndo, tptr),",
          "1675:                                   ip6addr_string(ndo, tptr+BGP_VPN_RD_LEN)));",
          "1676:                         tlen -= (sizeof(struct in6_addr)+BGP_VPN_RD_LEN);",
          "1677:                         tptr += (sizeof(struct in6_addr)+BGP_VPN_RD_LEN);",
          "1678:                     }",
          "1679:                     break;",
          "1680:                 case (AFNUM_VPLS<<8 | SAFNUM_VPLS):",
          "1681:                 case (AFNUM_L2VPN<<8 | SAFNUM_VPNUNICAST):",
          "1682:                 case (AFNUM_L2VPN<<8 | SAFNUM_VPNMULTICAST):",
          "1683:                 case (AFNUM_L2VPN<<8 | SAFNUM_VPNUNIMULTICAST):",
          "1684:                     if (tlen < sizeof(struct in_addr)) {",
          "1685:                         ND_PRINT((ndo, \"invalid len\"));",
          "1686:                         tlen = 0;",
          "1687:                     } else {",
          "1688:                         ND_TCHECK_LEN(tptr, sizeof(struct in_addr));",
          "1689:                         ND_PRINT((ndo, \"%s\", ipaddr_string(ndo, tptr)));",
          "1690:                         tlen -= (sizeof(struct in_addr));",
          "1691:                         tptr += (sizeof(struct in_addr));",
          "1692:                     }",
          "1693:                     break;",
          "1697:                     ND_TCHECK_LEN(tptr, tlen);",
          "1698:                     ND_PRINT((ndo, \"%s\", isonsap_string(ndo, tptr, tlen)));",
          "1699:                     tptr += tlen;",
          "1700:                     tlen = 0;",
          "1701:                     break;",
          "1706:                     if (tlen < BGP_VPN_RD_LEN+1) {",
          "1707:                         ND_PRINT((ndo, \"invalid len\"));",
          "1708:                         tlen = 0;",
          "1709:                     } else {",
          "1710:                         ND_TCHECK_LEN(tptr, tlen);",
          "1711:                         ND_PRINT((ndo, \"RD: %s, %s\",",
          "1712:                                   bgp_vpn_rd_print(ndo, tptr),",
          "1713:                                   isonsap_string(ndo, tptr+BGP_VPN_RD_LEN,tlen-BGP_VPN_RD_LEN)));",
          "1715:                         if (EXTRACT_BE_U_4(tptr + BGP_VPN_RD_LEN) ==  0x47000601)",
          "1716:                             ND_PRINT((ndo, \" = %s\", ipaddr_string(ndo, tptr+BGP_VPN_RD_LEN+4)));",
          "1718:                         else if (EXTRACT_BE_U_3(tptr + BGP_VPN_RD_LEN) ==  0x350000)",
          "1719:                             ND_PRINT((ndo, \" = %s\", ip6addr_string(ndo, tptr+BGP_VPN_RD_LEN+3)));",
          "1720:                         tptr += tlen;",
          "1721:                         tlen = 0;",
          "1722:                     }",
          "1726:                     ND_PRINT((ndo, \"no AFI %u/SAFI %u decoder\", af, safi));",
          "1729:                     tptr += tlen;",
          "1730:                     tlen = 0;",
          "1734:             }",
          "1735:         }",
          "1736:         ND_PRINT((ndo, \", nh-length: %u\", nhlen));",
          "1737:         tptr += tlen;",
          "1739:         ND_TCHECK_1(tptr);",
          "1740:         snpa = EXTRACT_U_1(tptr);",
          "1741:         tptr++;",
          "1743:         if (snpa) {",
          "1744:             ND_PRINT((ndo, \"\\n\\t    %u SNPA\", snpa));",
          "1745:             for (/*nothing*/; snpa > 0; snpa--) {",
          "1746:                 ND_TCHECK_1(tptr);",
          "1747:                 ND_PRINT((ndo, \"\\n\\t      %d bytes\", EXTRACT_U_1(tptr)));",
          "1748:                 tptr += EXTRACT_U_1(tptr) + 1;",
          "1749:             }",
          "1750:         } else {",
          "1751:             ND_PRINT((ndo, \", no SNPA\"));",
          "1752:         }",
          "1754:         while (tptr < pptr + len) {",
          "1755:             switch (af<<8 | safi) {",
          "1756:             case (AFNUM_INET<<8 | SAFNUM_UNICAST):",
          "1757:             case (AFNUM_INET<<8 | SAFNUM_MULTICAST):",
          "1758:             case (AFNUM_INET<<8 | SAFNUM_UNIMULTICAST):",
          "1759:                 advance = decode_prefix4(ndo, tptr, len, buf, sizeof(buf));",
          "1760:                 if (advance == -1)",
          "1761:                     ND_PRINT((ndo, \"\\n\\t    (illegal prefix length)\"));",
          "1762:                 else if (advance == -2)",
          "1763:                     goto trunc;",
          "1764:                 else if (advance == -3)",
          "1766:                 else",
          "1767:                     ND_PRINT((ndo, \"\\n\\t      %s\", buf));",
          "1768:                 break;",
          "1769:             case (AFNUM_INET<<8 | SAFNUM_LABUNICAST):",
          "1770:                 advance = decode_labeled_prefix4(ndo, tptr, len, buf, sizeof(buf));",
          "1771:                 if (advance == -1)",
          "1772:                     ND_PRINT((ndo, \"\\n\\t    (illegal prefix length)\"));",
          "1773:                 else if (advance == -2)",
          "1774:                     goto trunc;",
          "1775:                 else if (advance == -3)",
          "1777:                 else",
          "1778:                     ND_PRINT((ndo, \"\\n\\t      %s\", buf));",
          "1779:                 break;",
          "1780:             case (AFNUM_INET<<8 | SAFNUM_VPNUNICAST):",
          "1781:             case (AFNUM_INET<<8 | SAFNUM_VPNMULTICAST):",
          "1782:             case (AFNUM_INET<<8 | SAFNUM_VPNUNIMULTICAST):",
          "1783:                 advance = decode_labeled_vpn_prefix4(ndo, tptr, buf, sizeof(buf));",
          "1784:                 if (advance == -1)",
          "1785:                     ND_PRINT((ndo, \"\\n\\t    (illegal prefix length)\"));",
          "1786:                 else if (advance == -2)",
          "1787:                     goto trunc;",
          "1788:                 else",
          "1789:                     ND_PRINT((ndo, \"\\n\\t      %s\", buf));",
          "1790:                 break;",
          "1791:             case (AFNUM_INET<<8 | SAFNUM_RT_ROUTING_INFO):",
          "1792:                 advance = decode_rt_routing_info(ndo, tptr, buf, sizeof(buf));",
          "1793:                 if (advance == -1)",
          "1794:                     ND_PRINT((ndo, \"\\n\\t    (illegal prefix length)\"));",
          "1795:                 else if (advance == -2)",
          "1796:                     goto trunc;",
          "1797:                 else",
          "1798:                     ND_PRINT((ndo, \"\\n\\t      %s\", buf));",
          "1799:                 break;",
          "1801:             case (AFNUM_INET6<<8 | SAFNUM_MULTICAST_VPN):",
          "1802:                 advance = decode_multicast_vpn(ndo, tptr, buf, sizeof(buf));",
          "1803:                 if (advance == -1)",
          "1804:                     ND_PRINT((ndo, \"\\n\\t    (illegal prefix length)\"));",
          "1805:                 else if (advance == -2)",
          "1806:                     goto trunc;",
          "1807:                 else",
          "1808:                     ND_PRINT((ndo, \"\\n\\t      %s\", buf));",
          "1811:             case (AFNUM_INET<<8 | SAFNUM_MDT):",
          "1812:                 advance = decode_mdt_vpn_nlri(ndo, tptr, buf, sizeof(buf));",
          "1813:                 if (advance == -1)",
          "1814:                     ND_PRINT((ndo, \"\\n\\t    (illegal prefix length)\"));",
          "1815:                 else if (advance == -2)",
          "1816:                     goto trunc;",
          "1817:                 else",
          "1818:                     ND_PRINT((ndo, \"\\n\\t      %s\", buf));",
          "1819:                 break;",
          "1820:             case (AFNUM_INET6<<8 | SAFNUM_UNICAST):",
          "1821:             case (AFNUM_INET6<<8 | SAFNUM_MULTICAST):",
          "1822:             case (AFNUM_INET6<<8 | SAFNUM_UNIMULTICAST):",
          "1823:                 advance = decode_prefix6(ndo, tptr, len, buf, sizeof(buf));",
          "1824:                 if (advance == -1)",
          "1825:                     ND_PRINT((ndo, \"\\n\\t    (illegal prefix length)\"));",
          "1826:                 else if (advance == -2)",
          "1827:                     goto trunc;",
          "1828:                 else if (advance == -3)",
          "1830:                 else",
          "1831:                     ND_PRINT((ndo, \"\\n\\t      %s\", buf));",
          "1832:                 break;",
          "1833:             case (AFNUM_INET6<<8 | SAFNUM_LABUNICAST):",
          "1834:                 advance = decode_labeled_prefix6(ndo, tptr, len, buf, sizeof(buf));",
          "1835:                 if (advance == -1)",
          "1836:                     ND_PRINT((ndo, \"\\n\\t    (illegal prefix length)\"));",
          "1837:                 else if (advance == -2)",
          "1838:                     goto trunc;",
          "1839:                 else if (advance == -3)",
          "1841:                 else",
          "1842:                     ND_PRINT((ndo, \"\\n\\t      %s\", buf));",
          "1843:                 break;",
          "1844:             case (AFNUM_INET6<<8 | SAFNUM_VPNUNICAST):",
          "1845:             case (AFNUM_INET6<<8 | SAFNUM_VPNMULTICAST):",
          "1846:             case (AFNUM_INET6<<8 | SAFNUM_VPNUNIMULTICAST):",
          "1847:                 advance = decode_labeled_vpn_prefix6(ndo, tptr, buf, sizeof(buf));",
          "1848:                 if (advance == -1)",
          "1849:                     ND_PRINT((ndo, \"\\n\\t    (illegal prefix length)\"));",
          "1850:                 else if (advance == -2)",
          "1851:                     goto trunc;",
          "1852:                 else",
          "1853:                     ND_PRINT((ndo, \"\\n\\t      %s\", buf));",
          "1854:                 break;",
          "1855:             case (AFNUM_VPLS<<8 | SAFNUM_VPLS):",
          "1856:             case (AFNUM_L2VPN<<8 | SAFNUM_VPNUNICAST):",
          "1857:             case (AFNUM_L2VPN<<8 | SAFNUM_VPNMULTICAST):",
          "1858:             case (AFNUM_L2VPN<<8 | SAFNUM_VPNUNIMULTICAST):",
          "1859:                 advance = decode_labeled_vpn_l2(ndo, tptr, buf, sizeof(buf));",
          "1860:                 if (advance == -1)",
          "1861:                     ND_PRINT((ndo, \"\\n\\t    (illegal length)\"));",
          "1862:                 else if (advance == -2)",
          "1863:                     goto trunc;",
          "1864:                 else",
          "1865:                     ND_PRINT((ndo, \"\\n\\t      %s\", buf));",
          "1866:                 break;",
          "1867:             case (AFNUM_NSAP<<8 | SAFNUM_UNICAST):",
          "1868:             case (AFNUM_NSAP<<8 | SAFNUM_MULTICAST):",
          "1869:             case (AFNUM_NSAP<<8 | SAFNUM_UNIMULTICAST):",
          "1870:                 advance = decode_clnp_prefix(ndo, tptr, buf, sizeof(buf));",
          "1871:                 if (advance == -1)",
          "1872:                     ND_PRINT((ndo, \"\\n\\t    (illegal prefix length)\"));",
          "1873:                 else if (advance == -2)",
          "1874:                     goto trunc;",
          "1875:                 else",
          "1876:                     ND_PRINT((ndo, \"\\n\\t      %s\", buf));",
          "1877:                 break;",
          "1878:             case (AFNUM_NSAP<<8 | SAFNUM_VPNUNICAST):",
          "1879:             case (AFNUM_NSAP<<8 | SAFNUM_VPNMULTICAST):",
          "1880:             case (AFNUM_NSAP<<8 | SAFNUM_VPNUNIMULTICAST):",
          "1881:                 advance = decode_labeled_vpn_clnp_prefix(ndo, tptr, buf, sizeof(buf));",
          "1882:                 if (advance == -1)",
          "1883:                     ND_PRINT((ndo, \"\\n\\t    (illegal prefix length)\"));",
          "1884:                 else if (advance == -2)",
          "1885:                     goto trunc;",
          "1886:                 else",
          "1887:                     ND_PRINT((ndo, \"\\n\\t      %s\", buf));",
          "1888:                 break;",
          "1889:             default:",
          "1890:                 ND_TCHECK_LEN(tptr, tlen);",
          "1891:                 ND_PRINT((ndo, \"\\n\\t    no AFI %u / SAFI %u decoder\", af, safi));",
          "1892:                 if (ndo->ndo_vflag <= 1)",
          "1893:                     print_unknown_data(ndo, tptr, \"\\n\\t    \", tlen);",
          "1894:                 advance = 0;",
          "1895:                 tptr = pptr + len;",
          "1896:                 break;",
          "1897:             }",
          "1898:             if (advance < 0)",
          "1899:                 break;",
          "1900:             tptr += advance;",
          "1901:         }",
          "1902:     done:",
          "1903:         break;",
          "1905:     case BGPTYPE_MP_UNREACH_NLRI:",
          "1906:         ND_TCHECK_LEN(tptr, BGP_MP_NLRI_MINSIZE);",
          "1907:         af = EXTRACT_BE_U_2(tptr);",
          "1908:         safi = EXTRACT_U_1(tptr + 2);",
          "1910:         ND_PRINT((ndo, \"\\n\\t    AFI: %s (%u), %sSAFI: %s (%u)\",",
          "1911:                   tok2str(af_values, \"Unknown AFI\", af),",
          "1912:                   af,",
          "1914:                   tok2str(bgp_safi_values, \"Unknown SAFI\", safi),",
          "1915:                   safi));",
          "1917:         if (len == BGP_MP_NLRI_MINSIZE)",
          "1918:             ND_PRINT((ndo, \"\\n\\t      End-of-Rib Marker (empty NLRI)\"));",
          "1920:         tptr += 3;",
          "1922:         while (tptr < pptr + len) {",
          "1923:             switch (af<<8 | safi) {",
          "1924:             case (AFNUM_INET<<8 | SAFNUM_UNICAST):",
          "1925:             case (AFNUM_INET<<8 | SAFNUM_MULTICAST):",
          "1926:             case (AFNUM_INET<<8 | SAFNUM_UNIMULTICAST):",
          "1927:                 advance = decode_prefix4(ndo, tptr, len, buf, sizeof(buf));",
          "1928:                 if (advance == -1)",
          "1929:                     ND_PRINT((ndo, \"\\n\\t    (illegal prefix length)\"));",
          "1930:                 else if (advance == -2)",
          "1931:                     goto trunc;",
          "1932:                 else if (advance == -3)",
          "1934:                 else",
          "1935:                     ND_PRINT((ndo, \"\\n\\t      %s\", buf));",
          "1936:                 break;",
          "1937:             case (AFNUM_INET<<8 | SAFNUM_LABUNICAST):",
          "1938:                 advance = decode_labeled_prefix4(ndo, tptr, len, buf, sizeof(buf));",
          "1939:                 if (advance == -1)",
          "1940:                     ND_PRINT((ndo, \"\\n\\t    (illegal prefix length)\"));",
          "1941:                 else if (advance == -2)",
          "1942:                     goto trunc;",
          "1943:                 else if (advance == -3)",
          "1945:                 else",
          "1946:                     ND_PRINT((ndo, \"\\n\\t      %s\", buf));",
          "1947:                 break;",
          "1948:             case (AFNUM_INET<<8 | SAFNUM_VPNUNICAST):",
          "1949:             case (AFNUM_INET<<8 | SAFNUM_VPNMULTICAST):",
          "1950:             case (AFNUM_INET<<8 | SAFNUM_VPNUNIMULTICAST):",
          "1951:                 advance = decode_labeled_vpn_prefix4(ndo, tptr, buf, sizeof(buf));",
          "1952:                 if (advance == -1)",
          "1953:                     ND_PRINT((ndo, \"\\n\\t    (illegal prefix length)\"));",
          "1954:                 else if (advance == -2)",
          "1955:                     goto trunc;",
          "1956:                 else",
          "1957:                     ND_PRINT((ndo, \"\\n\\t      %s\", buf));",
          "1958:                 break;",
          "1959:             case (AFNUM_INET6<<8 | SAFNUM_UNICAST):",
          "1960:             case (AFNUM_INET6<<8 | SAFNUM_MULTICAST):",
          "1961:             case (AFNUM_INET6<<8 | SAFNUM_UNIMULTICAST):",
          "1962:                 advance = decode_prefix6(ndo, tptr, len, buf, sizeof(buf));",
          "1963:                 if (advance == -1)",
          "1964:                     ND_PRINT((ndo, \"\\n\\t    (illegal prefix length)\"));",
          "1965:                 else if (advance == -2)",
          "1966:                     goto trunc;",
          "1967:                 else if (advance == -3)",
          "1969:                 else",
          "1970:                     ND_PRINT((ndo, \"\\n\\t      %s\", buf));",
          "1971:                 break;",
          "1972:             case (AFNUM_INET6<<8 | SAFNUM_LABUNICAST):",
          "1973:                 advance = decode_labeled_prefix6(ndo, tptr, len, buf, sizeof(buf));",
          "1974:                 if (advance == -1)",
          "1975:                     ND_PRINT((ndo, \"\\n\\t    (illegal prefix length)\"));",
          "1976:                 else if (advance == -2)",
          "1977:                     goto trunc;",
          "1978:                 else if (advance == -3)",
          "1980:                 else",
          "1981:                     ND_PRINT((ndo, \"\\n\\t      %s\", buf));",
          "1982:                 break;",
          "1983:             case (AFNUM_INET6<<8 | SAFNUM_VPNUNICAST):",
          "1984:             case (AFNUM_INET6<<8 | SAFNUM_VPNMULTICAST):",
          "1985:             case (AFNUM_INET6<<8 | SAFNUM_VPNUNIMULTICAST):",
          "1986:                 advance = decode_labeled_vpn_prefix6(ndo, tptr, buf, sizeof(buf));",
          "1987:                 if (advance == -1)",
          "1988:                     ND_PRINT((ndo, \"\\n\\t    (illegal prefix length)\"));",
          "1989:                 else if (advance == -2)",
          "1990:                     goto trunc;",
          "1991:                 else",
          "1992:                     ND_PRINT((ndo, \"\\n\\t      %s\", buf));",
          "1993:                 break;",
          "1994:             case (AFNUM_VPLS<<8 | SAFNUM_VPLS):",
          "1995:             case (AFNUM_L2VPN<<8 | SAFNUM_VPNUNICAST):",
          "1996:             case (AFNUM_L2VPN<<8 | SAFNUM_VPNMULTICAST):",
          "1997:             case (AFNUM_L2VPN<<8 | SAFNUM_VPNUNIMULTICAST):",
          "1998:                 advance = decode_labeled_vpn_l2(ndo, tptr, buf, sizeof(buf));",
          "1999:                 if (advance == -1)",
          "2000:                     ND_PRINT((ndo, \"\\n\\t    (illegal length)\"));",
          "2001:                 else if (advance == -2)",
          "2002:                     goto trunc;",
          "2003:                 else",
          "2004:                     ND_PRINT((ndo, \"\\n\\t      %s\", buf));",
          "2005:                 break;",
          "2006:             case (AFNUM_NSAP<<8 | SAFNUM_UNICAST):",
          "2007:             case (AFNUM_NSAP<<8 | SAFNUM_MULTICAST):",
          "2008:             case (AFNUM_NSAP<<8 | SAFNUM_UNIMULTICAST):",
          "2009:                 advance = decode_clnp_prefix(ndo, tptr, buf, sizeof(buf));",
          "2010:                 if (advance == -1)",
          "2011:                     ND_PRINT((ndo, \"\\n\\t    (illegal prefix length)\"));",
          "2012:                 else if (advance == -2)",
          "2013:                     goto trunc;",
          "2014:                 else",
          "2015:                     ND_PRINT((ndo, \"\\n\\t      %s\", buf));",
          "2016:                 break;",
          "2017:             case (AFNUM_NSAP<<8 | SAFNUM_VPNUNICAST):",
          "2018:             case (AFNUM_NSAP<<8 | SAFNUM_VPNMULTICAST):",
          "2019:             case (AFNUM_NSAP<<8 | SAFNUM_VPNUNIMULTICAST):",
          "2020:                 advance = decode_labeled_vpn_clnp_prefix(ndo, tptr, buf, sizeof(buf));",
          "2021:                 if (advance == -1)",
          "2022:                     ND_PRINT((ndo, \"\\n\\t    (illegal prefix length)\"));",
          "2023:                 else if (advance == -2)",
          "2024:                     goto trunc;",
          "2025:                 else",
          "2026:                     ND_PRINT((ndo, \"\\n\\t      %s\", buf));",
          "2027:                 break;",
          "2028:             case (AFNUM_INET<<8 | SAFNUM_MDT):",
          "2029:                 advance = decode_mdt_vpn_nlri(ndo, tptr, buf, sizeof(buf));",
          "2030:                 if (advance == -1)",
          "2031:                     ND_PRINT((ndo, \"\\n\\t    (illegal prefix length)\"));",
          "2032:                 else if (advance == -2)",
          "2033:                     goto trunc;",
          "2034:                 else",
          "2035:                     ND_PRINT((ndo, \"\\n\\t      %s\", buf));",
          "2036:                 break;",
          "2038:             case (AFNUM_INET6<<8 | SAFNUM_MULTICAST_VPN):",
          "2039:                 advance = decode_multicast_vpn(ndo, tptr, buf, sizeof(buf));",
          "2040:                 if (advance == -1)",
          "2041:                     ND_PRINT((ndo, \"\\n\\t    (illegal prefix length)\"));",
          "2042:                 else if (advance == -2)",
          "2043:                     goto trunc;",
          "2044:                 else",
          "2045:                     ND_PRINT((ndo, \"\\n\\t      %s\", buf));",
          "2046:                 break;",
          "2047:             default:",
          "2048:                 ND_TCHECK_LEN(tptr - 3, tlen);",
          "2049:                 ND_PRINT((ndo, \"no AFI %u / SAFI %u decoder\", af, safi));",
          "2050:                 if (ndo->ndo_vflag <= 1)",
          "2051:                     print_unknown_data(ndo, tptr-3, \"\\n\\t    \", tlen);",
          "2052:                 advance = 0;",
          "2053:                 tptr = pptr + len;",
          "2054:                 break;",
          "2055:             }",
          "2056:             if (advance < 0)",
          "2057:                 break;",
          "2058:             tptr += advance;",
          "2059:         }",
          "2060:         break;",
          "2061:     case BGPTYPE_EXTD_COMMUNITIES:",
          "2062:         if (len % 8) {",
          "2063:             ND_PRINT((ndo, \"invalid len\"));",
          "2064:             break;",
          "2065:         }",
          "2066:         while (tlen>0) {",
          "2067:             uint16_t extd_comm;",
          "2069:             ND_TCHECK_2(tptr);",
          "2070:             extd_comm=EXTRACT_BE_U_2(tptr);",
          "2072:             ND_PRINT((ndo, \"\\n\\t    %s (0x%04x), Flags [%s]\",",
          "2073:                       tok2str(bgp_extd_comm_subtype_values,",
          "2074:                               \"unknown extd community typecode\",",
          "2075:                               extd_comm),",
          "2076:                       extd_comm,",
          "2077:                       bittok2str(bgp_extd_comm_flag_values, \"none\", extd_comm)));",
          "2079:             ND_TCHECK_6(tptr + 2);",
          "2080:             switch(extd_comm) {",
          "2081:             case BGP_EXT_COM_RT_0:",
          "2082:             case BGP_EXT_COM_RO_0:",
          "2083:             case BGP_EXT_COM_L2VPN_RT_0:",
          "2084:                 ND_PRINT((ndo, \": %u:%u (= %s)\",",
          "2085:                           EXTRACT_BE_U_2(tptr + 2),",
          "2086:                           EXTRACT_BE_U_4(tptr + 4),",
          "2087:                           ipaddr_string(ndo, tptr+4)));",
          "2088:                 break;",
          "2089:             case BGP_EXT_COM_RT_1:",
          "2090:             case BGP_EXT_COM_RO_1:",
          "2091:             case BGP_EXT_COM_L2VPN_RT_1:",
          "2092:             case BGP_EXT_COM_VRF_RT_IMP:",
          "2093:                 ND_PRINT((ndo, \": %s:%u\",",
          "2094:                           ipaddr_string(ndo, tptr+2),",
          "2095:                           EXTRACT_BE_U_2(tptr + 6)));",
          "2096:                 break;",
          "2097:             case BGP_EXT_COM_RT_2:",
          "2098:             case BGP_EXT_COM_RO_2:",
          "2099:                 ND_PRINT((ndo, \": %s:%u\",",
          "2100:                           as_printf(ndo, astostr, sizeof(astostr),",
          "2101:                           EXTRACT_BE_U_4(tptr + 2)), EXTRACT_BE_U_2(tptr + 6)));",
          "2102:                 break;",
          "2103:             case BGP_EXT_COM_LINKBAND:",
          "2104:                 bw.i = EXTRACT_BE_U_4(tptr + 2);",
          "2105:                 ND_PRINT((ndo, \": bandwidth: %.3f Mbps\",",
          "2106:                           bw.f*8/1000000));",
          "2107:                 break;",
          "2108:             case BGP_EXT_COM_VPN_ORIGIN:",
          "2109:             case BGP_EXT_COM_VPN_ORIGIN2:",
          "2110:             case BGP_EXT_COM_VPN_ORIGIN3:",
          "2111:             case BGP_EXT_COM_VPN_ORIGIN4:",
          "2112:             case BGP_EXT_COM_OSPF_RID:",
          "2113:             case BGP_EXT_COM_OSPF_RID2:",
          "2114:                 ND_PRINT((ndo, \"%s\", ipaddr_string(ndo, tptr+2)));",
          "2115:                 break;",
          "2116:             case BGP_EXT_COM_OSPF_RTYPE:",
          "2117:             case BGP_EXT_COM_OSPF_RTYPE2:",
          "2118:                 ND_PRINT((ndo, \": area:%s, router-type:%s, metric-type:%s%s\",",
          "2119:                           ipaddr_string(ndo, tptr+2),",
          "2120:                           tok2str(bgp_extd_comm_ospf_rtype_values,",
          "2121:                                   \"unknown (0x%02x)\",",
          "2122:                                   EXTRACT_U_1((tptr + 6))),",
          "2123:                           (EXTRACT_U_1(tptr + 7) &  BGP_OSPF_RTYPE_METRIC_TYPE) ? \"E2\" : \"\",",
          "2124:                           ((EXTRACT_U_1(tptr + 6) == BGP_OSPF_RTYPE_EXT) || (EXTRACT_U_1(tptr + 6) == BGP_OSPF_RTYPE_NSSA)) ? \"E1\" : \"\"));",
          "2125:                 break;",
          "2126:             case BGP_EXT_COM_L2INFO:",
          "2127:                 ND_PRINT((ndo, \": %s Control Flags [0x%02x]:MTU %u\",",
          "2128:                           tok2str(l2vpn_encaps_values,",
          "2129:                                   \"unknown encaps\",",
          "2130:                                   EXTRACT_U_1((tptr + 2))),",
          "2131:                           EXTRACT_U_1((tptr + 3)),",
          "2132:                           EXTRACT_BE_U_2(tptr + 4)));",
          "2133:                 break;",
          "2134:             case BGP_EXT_COM_SOURCE_AS:",
          "2135:                 ND_PRINT((ndo, \": AS %u\", EXTRACT_BE_U_2(tptr + 2)));",
          "2136:                 break;",
          "2137:             default:",
          "2138:                 ND_TCHECK_8(tptr);",
          "2139:                 print_unknown_data(ndo, tptr, \"\\n\\t      \", 8);",
          "2141:             }",
          "2142:             tlen -= 8;",
          "2143:             tptr += 8;",
          "2145:         break;",
          "2147:     case BGPTYPE_PMSI_TUNNEL:",
          "2148:     {",
          "2149:         uint8_t tunnel_type, flags;",
          "2151:         ND_TCHECK_5(tptr);",
          "2152:         flags = EXTRACT_U_1(tptr);",
          "2153:         tunnel_type = EXTRACT_U_1(tptr + 1);",
          "2154:         tlen = len;",
          "2156:         ND_PRINT((ndo, \"\\n\\t    Tunnel-type %s (%u), Flags [%s], MPLS Label %u\",",
          "2157:                   tok2str(bgp_pmsi_tunnel_values, \"Unknown\", tunnel_type),",
          "2158:                   tunnel_type,",
          "2159:                   bittok2str(bgp_pmsi_flag_values, \"none\", flags),",
          "2160:                   EXTRACT_BE_U_3(tptr + 2)>>4));",
          "2162:         tptr +=5;",
          "2163:         tlen -= 5;",
          "2165:         switch (tunnel_type) {",
          "2167:         case BGP_PMSI_TUNNEL_PIM_BIDIR:",
          "2168:             ND_TCHECK_8(tptr);",
          "2169:             ND_PRINT((ndo, \"\\n\\t      Sender %s, P-Group %s\",",
          "2170:                       ipaddr_string(ndo, tptr),",
          "2171:                       ipaddr_string(ndo, tptr+4)));",
          "2172:             break;",
          "2174:         case BGP_PMSI_TUNNEL_PIM_SSM:",
          "2175:             ND_TCHECK_8(tptr);",
          "2176:             ND_PRINT((ndo, \"\\n\\t      Root-Node %s, P-Group %s\",",
          "2177:                       ipaddr_string(ndo, tptr),",
          "2178:                       ipaddr_string(ndo, tptr+4)));",
          "2179:             break;",
          "2180:         case BGP_PMSI_TUNNEL_INGRESS:",
          "2181:             ND_TCHECK_4(tptr);",
          "2182:             ND_PRINT((ndo, \"\\n\\t      Tunnel-Endpoint %s\",",
          "2183:                       ipaddr_string(ndo, tptr)));",
          "2184:             break;",
          "2186:         case BGP_PMSI_TUNNEL_LDP_MP2MP:",
          "2187:             ND_TCHECK_8(tptr);",
          "2188:             ND_PRINT((ndo, \"\\n\\t      Root-Node %s, LSP-ID 0x%08x\",",
          "2189:                       ipaddr_string(ndo, tptr),",
          "2190:                       EXTRACT_BE_U_4(tptr + 4)));",
          "2191:             break;",
          "2192:         case BGP_PMSI_TUNNEL_RSVP_P2MP:",
          "2193:             ND_TCHECK_8(tptr);",
          "2194:             ND_PRINT((ndo, \"\\n\\t      Extended-Tunnel-ID %s, P2MP-ID 0x%08x\",",
          "2195:                       ipaddr_string(ndo, tptr),",
          "2196:                       EXTRACT_BE_U_4(tptr + 4)));",
          "2197:             break;",
          "2198:         default:",
          "2199:             if (ndo->ndo_vflag <= 1) {",
          "2200:                 print_unknown_data(ndo, tptr, \"\\n\\t      \", tlen);",
          "2201:             }",
          "2202:         }",
          "2203:         break;",
          "2204:     }",
          "2205:     case BGPTYPE_AIGP:",
          "2206:     {",
          "2207:         uint8_t type;",
          "2208:         uint16_t length;",
          "2210:         tlen = len;",
          "2212:         while (tlen >= 3) {",
          "2214:             ND_TCHECK_3(tptr);",
          "2216:             type = EXTRACT_U_1(tptr);",
          "2217:             length = EXTRACT_BE_U_2(tptr + 1);",
          "2218:             tptr += 3;",
          "2219:             tlen -= 3;",
          "2221:             ND_PRINT((ndo, \"\\n\\t    %s TLV (%u), length %u\",",
          "2222:                       tok2str(bgp_aigp_values, \"Unknown\", type),",
          "2223:                       type, length));",
          "2225:             if (length < 3)",
          "2226:                 goto trunc;",
          "2227:             length -= 3;",
          "2232:             ND_TCHECK_LEN(tptr + 3, length);",
          "2234:             switch (type) {",
          "2236:             case BGP_AIGP_TLV:",
          "2237:                 if (length < 8)",
          "2238:                     goto trunc;",
          "2239:                 ND_PRINT((ndo, \", metric %\" PRIu64,",
          "2240:                           EXTRACT_BE_U_8(tptr)));",
          "2243:             default:",
          "2244:                 if (ndo->ndo_vflag <= 1) {",
          "2245:                     print_unknown_data(ndo, tptr,\"\\n\\t      \", length);",
          "2246:                 }",
          "2247:             }",
          "2249:             tptr += length;",
          "2250:             tlen -= length;",
          "2251:         }",
          "2252:         break;",
          "2253:     }",
          "2254:     case BGPTYPE_ATTR_SET:",
          "2255:         ND_TCHECK_4(tptr);",
          "2256:         if (len < 4)",
          "2257:             goto trunc;",
          "2258:         ND_PRINT((ndo, \"\\n\\t    Origin AS: %s\",",
          "2259:                   as_printf(ndo, astostr, sizeof(astostr), EXTRACT_BE_U_4(tptr))));",
          "2260:         tptr += 4;",
          "2261:         len -= 4;",
          "2263:         while (len) {",
          "2264:             u_int aflags, alenlen, alen;",
          "2266:             ND_TCHECK_2(tptr);",
          "2267:             if (len < 2)",
          "2268:                 goto trunc;",
          "2269:             aflags = EXTRACT_U_1(tptr);",
          "2270:             atype = EXTRACT_U_1(tptr + 1);",
          "2271:             tptr += 2;",
          "2272:             len -= 2;",
          "2273:             alenlen = bgp_attr_lenlen(aflags, tptr);",
          "2274:             ND_TCHECK_LEN(tptr, alenlen);",
          "2275:             if (len < alenlen)",
          "2276:                 goto trunc;",
          "2277:             alen = bgp_attr_len(aflags, tptr);",
          "2278:             tptr += alenlen;",
          "2279:             len -= alenlen;",
          "2281:             ND_PRINT((ndo, \"\\n\\t      %s (%u), length: %u\",",
          "2282:                       tok2str(bgp_attr_values,",
          "2283:                               \"Unknown Attribute\", atype),",
          "2284:                       atype,",
          "2285:                       alen));",
          "2287:             if (aflags) {",
          "2288:                 ND_PRINT((ndo, \", Flags [%s%s%s%s\",",
          "2289:                           aflags & 0x80 ? \"O\" : \"\",",
          "2290:                           aflags & 0x40 ? \"T\" : \"\",",
          "2291:                           aflags & 0x20 ? \"P\" : \"\",",
          "2292:                           aflags & 0x10 ? \"E\" : \"\"));",
          "2293:                 if (aflags & 0xf)",
          "2294:                     ND_PRINT((ndo, \"+%x\", aflags & 0xf));",
          "2295:                 ND_PRINT((ndo, \"]: \"));",
          "2296:             }",
          "2298:             if (!bgp_attr_print(ndo, atype, tptr, alen))",
          "2299:             return 0;",
          "2300:             tptr += alen;",
          "2301:             len -= alen;",
          "2302:         }",
          "2303:         break;",
          "2305:     case BGPTYPE_LARGE_COMMUNITY:",
          "2306:         if (len == 0 || len % 12) {",
          "2307:             ND_PRINT((ndo, \"invalid len\"));",
          "2309:         }",
          "2310:         ND_PRINT((ndo, \"\\n\\t    \"));",
          "2311:         while (len > 0) {",
          "2312:             ND_TCHECK_LEN(tptr, 12);",
          "2313:             ND_PRINT((ndo, \"%u:%u:%u%s\",",
          "2314:                       EXTRACT_BE_U_4(tptr),",
          "2315:                       EXTRACT_BE_U_4(tptr + 4),",
          "2316:                       EXTRACT_BE_U_4(tptr + 8),",
          "2317:                       (len > 12) ? \", \" : \"\"));",
          "2318:             tptr += 12;",
          "2319:             len -= 12;",
          "2320:         }",
          "2321:         break;",
          "2322:     default:",
          "2323:         ND_TCHECK_LEN(pptr, len);",
          "2325:         if (ndo->ndo_vflag <= 1)",
          "2327:         break;",
          "2328:     }",
          "2330:         ND_TCHECK_LEN(pptr, len);",
          "2331:         print_unknown_data(ndo, pptr, \"\\n\\t    \", len);",
          "2332:     }",
          "2333:     return 1;",
          "2336:     return 0;",
          "2343:     u_int cap_type, cap_len, tcap_len, cap_offset;",
          "2344:     u_int i = 0;",
          "2346:     while (i < caps_len) {",
          "2347:         ND_TCHECK_LEN(opt + i, BGP_CAP_HEADER_SIZE);",
          "2348:         cap_type=EXTRACT_U_1(opt + i);",
          "2349:         cap_len=EXTRACT_U_1(opt + i + 1);",
          "2350:         tcap_len=cap_len;",
          "2351:         ND_PRINT((ndo, \"\\n\\t      %s (%u), length: %u\",",
          "2352:                   tok2str(bgp_capcode_values, \"Unknown\", cap_type),",
          "2353:                   cap_type,",
          "2354:                   cap_len));",
          "2355:         ND_TCHECK_LEN(opt + 2 + i, cap_len);",
          "2356:         switch (cap_type) {",
          "2357:         case BGP_CAPCODE_MP:",
          "2358:             ND_PRINT((ndo, \"\\n\\t\\tAFI %s (%u), SAFI %s (%u)\",",
          "2359:                tok2str(af_values, \"Unknown\", EXTRACT_BE_U_2(opt + i + 2)),",
          "2360:                EXTRACT_BE_U_2(opt + i + 2),",
          "2361:                tok2str(bgp_safi_values, \"Unknown\", EXTRACT_U_1(opt + i + 5)),",
          "2362:                EXTRACT_U_1(opt + i + 5)));",
          "2363:             break;",
          "2364:         case BGP_CAPCODE_RESTART:",
          "2365:             ND_PRINT((ndo, \"\\n\\t\\tRestart Flags: [%s], Restart Time %us\",",
          "2366:                       ((EXTRACT_U_1(opt + i + 2))&0x80) ? \"R\" : \"none\",",
          "2367:                       EXTRACT_BE_U_2(opt + i + 2)&0xfff));",
          "2368:             tcap_len-=2;",
          "2369:             cap_offset=4;",
          "2370:             while(tcap_len>=4) {",
          "2371:                 ND_PRINT((ndo, \"\\n\\t\\t  AFI %s (%u), SAFI %s (%u), Forwarding state preserved: %s\",",
          "2372:                           tok2str(af_values,\"Unknown\",",
          "2373:                                   EXTRACT_BE_U_2(opt + i + cap_offset)),",
          "2374:                           EXTRACT_BE_U_2(opt + i + cap_offset),",
          "2375:                           tok2str(bgp_safi_values,\"Unknown\",",
          "2376:                                   EXTRACT_U_1(opt + i + cap_offset + 2)),",
          "2377:                           EXTRACT_U_1(opt + (i + cap_offset + 2)),",
          "2378:                           ((EXTRACT_U_1(opt + (i + cap_offset + 3)))&0x80) ? \"yes\" : \"no\" ));",
          "2379:                 tcap_len -= 4;",
          "2380:                 cap_offset += 4;",
          "2381:             }",
          "2382:             break;",
          "2383:         case BGP_CAPCODE_RR:",
          "2384:         case BGP_CAPCODE_RR_CISCO:",
          "2385:             break;",
          "2386:         case BGP_CAPCODE_AS_NEW:",
          "2391:             if (cap_len == 4) {",
          "2392:             ND_PRINT((ndo, \"\\n\\t\\t 4 Byte AS %s\",",
          "2393:                       as_printf(ndo, astostr, sizeof(astostr),",
          "2394:                       EXTRACT_BE_U_4(opt + i + 2))));",
          "2395:             }",
          "2396:             break;",
          "2397:         case BGP_CAPCODE_ADD_PATH:",
          "2398:             cap_offset=2;",
          "2399:             if (tcap_len == 0) {",
          "2401:                 break;",
          "2402:             }",
          "2403:             while (tcap_len > 0) {",
          "2404:                 if (tcap_len < 4) {",
          "2405:                     ND_PRINT((ndo, \"\\n\\t\\t(invalid)\"));",
          "2408:                 ND_PRINT((ndo, \"\\n\\t\\tAFI %s (%u), SAFI %s (%u), Send/Receive: %s\",",
          "2409:                           tok2str(af_values,\"Unknown\",EXTRACT_BE_U_2(opt + i + cap_offset)),",
          "2410:                           EXTRACT_BE_U_2(opt + i + cap_offset),",
          "2411:                           tok2str(bgp_safi_values,\"Unknown\",EXTRACT_U_1(opt + i + cap_offset + 2)),",
          "2412:                           EXTRACT_U_1(opt + (i + cap_offset + 2)),",
          "2413:                           tok2str(bgp_add_path_recvsend,\"Bogus (0x%02x)\",EXTRACT_U_1(opt + i + cap_offset + 3))",
          "2414:                 ));",
          "2415:                 tcap_len -= 4;",
          "2416:                 cap_offset += 4;",
          "2417:             }",
          "2418:             break;",
          "2419:         default:",
          "2420:             ND_PRINT((ndo, \"\\n\\t\\tno decoder for Capability %u\",",
          "2421:                       cap_type));",
          "2422:             if (ndo->ndo_vflag <= 1)",
          "2423:                 print_unknown_data(ndo, opt + i + 2, \"\\n\\t\\t\",",
          "2424:                                    cap_len);",
          "2425:             break;",
          "2426:         }",
          "2427:         if (ndo->ndo_vflag > 1 && cap_len > 0) {",
          "2428:             print_unknown_data(ndo, opt + i + 2, \"\\n\\t\\t\", cap_len);",
          "2430:         i += BGP_CAP_HEADER_SIZE + cap_len;",
          "2431:     }",
          "2432:     return;",
          "2435:     ND_PRINT((ndo, \"[|BGP]\"));",
          "2442:     const struct bgp_open *bgp_open_header;",
          "2443:     u_int optslen;",
          "2444:     const struct bgp_opt *bgpopt;",
          "2445:     const u_char *opt;",
          "2446:     u_int i;",
          "2448:     ND_TCHECK_LEN(dat, BGP_OPEN_SIZE);",
          "2449:     if (length < BGP_OPEN_SIZE)",
          "2450:         goto trunc;",
          "2452:     bgp_open_header = (const struct bgp_open *)dat;",
          "2454:     ND_PRINT((ndo, \"\\n\\t  Version %u, \",",
          "2455:         EXTRACT_U_1(bgp_open_header->bgpo_version)));",
          "2456:     ND_PRINT((ndo, \"my AS %s, \",",
          "2457:         as_printf(ndo, astostr, sizeof(astostr), EXTRACT_BE_U_2(bgp_open_header->bgpo_myas))));",
          "2458:     ND_PRINT((ndo, \"Holdtime %us, \",",
          "2459:         EXTRACT_BE_U_2(bgp_open_header->bgpo_holdtime)));",
          "2460:     ND_PRINT((ndo, \"ID %s\", ipaddr_string(ndo, &bgp_open_header->bgpo_id)));",
          "2461:     optslen = EXTRACT_U_1(bgp_open_header->bgpo_optlen);",
          "2462:     ND_PRINT((ndo, \"\\n\\t  Optional parameters, length: %u\", optslen));",
          "2464:     opt = dat + BGP_OPEN_SIZE;",
          "2465:     length -= BGP_OPEN_SIZE;",
          "2467:     i = 0;",
          "2468:     while (i < optslen) {",
          "2469:         uint8_t opt_type, opt_len;",
          "2471:         ND_TCHECK_LEN(opt + i, BGP_OPT_SIZE);",
          "2472:         if (length < BGP_OPT_SIZE + i)",
          "2473:             goto trunc;",
          "2474:         bgpopt = (const struct bgp_opt *)(opt + i);",
          "2475:         opt_type = EXTRACT_U_1(bgpopt->bgpopt_type);",
          "2476:         opt_len = EXTRACT_U_1(bgpopt->bgpopt_len);",
          "2477:         if (BGP_OPT_SIZE + i + opt_len > optslen) {",
          "2478:             ND_PRINT((ndo, \"\\n\\t     Option %u, length: %u, goes past the end of the options\",",
          "2479:                       opt_type, opt_len));",
          "2480:             break;",
          "2481:         }",
          "2483:         ND_PRINT((ndo, \"\\n\\t    Option %s (%u), length: %u\",",
          "2484:                   tok2str(bgp_opt_values,\"Unknown\",opt_type),",
          "2485:                   opt_type,",
          "2486:                   opt_len));",
          "2489:         switch(opt_type) {",
          "2491:         case BGP_OPT_CAP:",
          "2492:             bgp_capabilities_print(ndo, opt + BGP_OPT_SIZE + i,",
          "2493:                                    opt_len);",
          "2494:             break;",
          "2496:         case BGP_OPT_AUTH:",
          "2497:         default:",
          "2498:                ND_PRINT((ndo, \"\\n\\t      no decoder for option %u\",",
          "2499:                opt_type));",
          "2500:                break;",
          "2501:         }",
          "2502:         i += BGP_OPT_SIZE + opt_len;",
          "2503:     }",
          "2504:     return;",
          "2506:     ND_PRINT((ndo, \"[|BGP]\"));",
          "2511:          const u_char *dat, int length)",
          "2513:     const struct bgp *bgp_header;",
          "2514:     const u_char *p;",
          "2515:     int withdrawn_routes_len;",
          "2516:     int len;",
          "2517:     int i;",
          "2519:     ND_TCHECK_LEN(dat, BGP_SIZE);",
          "2520:     if (length < BGP_SIZE)",
          "2521:         goto trunc;",
          "2522:     bgp_header = (const struct bgp *)dat;",
          "2523:     p = dat + BGP_SIZE;",
          "2524:     length -= BGP_SIZE;",
          "2527:     ND_TCHECK_2(p);",
          "2528:     if (length < 2)",
          "2529:         goto trunc;",
          "2530:     withdrawn_routes_len = EXTRACT_BE_U_2(p);",
          "2531:     p += 2;",
          "2532:     length -= 2;",
          "2533:     if (withdrawn_routes_len) {",
          "2539:         ND_TCHECK_LEN(p, withdrawn_routes_len);",
          "2540:         if (length < withdrawn_routes_len)",
          "2541:             goto trunc;",
          "2542:         ND_PRINT((ndo, \"\\n\\t  Withdrawn routes: %d bytes\", withdrawn_routes_len));",
          "2543:         p += withdrawn_routes_len;",
          "2544:         length -= withdrawn_routes_len;",
          "2545:     }",
          "2547:     ND_TCHECK_2(p);",
          "2548:     if (length < 2)",
          "2549:         goto trunc;",
          "2550:     len = EXTRACT_BE_U_2(p);",
          "2551:     p += 2;",
          "2552:     length -= 2;",
          "2554:     if (withdrawn_routes_len == 0 && len == 0 && length == 0) {",
          "2556:         ND_PRINT((ndo, \"\\n\\t  End-of-Rib Marker (empty NLRI)\"));",
          "2557:         return;",
          "2558:     }",
          "2560:     if (len) {",
          "2562:         while (len) {",
          "2563:             int aflags, atype, alenlen, alen;",
          "2565:             ND_TCHECK_2(p);",
          "2566:             if (len < 2)",
          "2567:                 goto trunc;",
          "2568:             if (length < 2)",
          "2569:                 goto trunc;",
          "2570:             aflags = EXTRACT_U_1(p);",
          "2571:             atype = EXTRACT_U_1(p + 1);",
          "2572:             p += 2;",
          "2573:             len -= 2;",
          "2574:             length -= 2;",
          "2575:             alenlen = bgp_attr_lenlen(aflags, p);",
          "2576:             ND_TCHECK_LEN(p, alenlen);",
          "2577:             if (len < alenlen)",
          "2578:                 goto trunc;",
          "2579:             if (length < alenlen)",
          "2580:                 goto trunc;",
          "2581:             alen = bgp_attr_len(aflags, p);",
          "2582:             p += alenlen;",
          "2583:             len -= alenlen;",
          "2584:             length -= alenlen;",
          "2586:             ND_PRINT((ndo, \"\\n\\t  %s (%u), length: %u\",",
          "2587:                       tok2str(bgp_attr_values, \"Unknown Attribute\", atype),",
          "2588:                       atype,",
          "2589:                       alen));",
          "2591:             if (aflags) {",
          "2592:                 ND_PRINT((ndo, \", Flags [%s%s%s%s\",",
          "2593:                           aflags & 0x80 ? \"O\" : \"\",",
          "2594:                           aflags & 0x40 ? \"T\" : \"\",",
          "2595:                           aflags & 0x20 ? \"P\" : \"\",",
          "2596:                           aflags & 0x10 ? \"E\" : \"\"));",
          "2597:                 if (aflags & 0xf)",
          "2598:                     ND_PRINT((ndo, \"+%x\", aflags & 0xf));",
          "2599:                 ND_PRINT((ndo, \"]: \"));",
          "2600:             }",
          "2601:             if (len < alen)",
          "2602:                 goto trunc;",
          "2603:             if (length < alen)",
          "2604:                 goto trunc;",
          "2605:             if (!bgp_attr_print(ndo, atype, p, alen))",
          "2606:                 goto trunc;",
          "2607:             p += alen;",
          "2608:             len -= alen;",
          "2609:             length -= alen;",
          "2611:     }",
          "2613:     if (length) {",
          "2622:         ND_PRINT((ndo, \"\\n\\t  Updated routes:\"));",
          "2623:         while (length) {",
          "2624:             char buf[MAXHOSTNAMELEN + 100];",
          "2625:             i = decode_prefix4(ndo, p, length, buf, sizeof(buf));",
          "2626:             if (i == -1) {",
          "2627:                 ND_PRINT((ndo, \"\\n\\t    (illegal prefix length)\"));",
          "2628:                 break;",
          "2629:             } else if (i == -2)",
          "2630:                 goto trunc;",
          "2631:             else if (i == -3)",
          "2633:             else {",
          "2634:                 ND_PRINT((ndo, \"\\n\\t    %s\", buf));",
          "2635:                 p += i;",
          "2636:                 length -= i;",
          "2637:             }",
          "2638:         }",
          "2639:     }",
          "2640:     return;",
          "2642:     ND_PRINT((ndo, \"[|BGP]\"));",
          "2647:                const u_char *dat, int length)",
          "2649:     const struct bgp_notification *bgp_notification_header;",
          "2650:     const u_char *tptr;",
          "2651:     uint8_t bgpn_major, bgpn_minor;",
          "2652:     uint8_t shutdown_comm_length;",
          "2653:     uint8_t remainder_offset;",
          "2655:     ND_TCHECK_LEN(dat, BGP_NOTIFICATION_SIZE);",
          "2656:     if (length<BGP_NOTIFICATION_SIZE)",
          "2657:         return;",
          "2659:     bgp_notification_header = (const struct bgp_notification *)dat;",
          "2660:     bgpn_major = EXTRACT_U_1(bgp_notification_header->bgpn_major);",
          "2661:     bgpn_minor = EXTRACT_U_1(bgp_notification_header->bgpn_minor);",
          "2663:     ND_PRINT((ndo, \", %s (%u)\",",
          "2664:               tok2str(bgp_notify_major_values, \"Unknown Error\",",
          "2665:                       bgpn_major),",
          "2666:               bgpn_major));",
          "2668:     switch (bgpn_major) {",
          "2670:     case BGP_NOTIFY_MAJOR_MSG:",
          "2671:         ND_PRINT((ndo, \", subcode %s (%u)\",",
          "2672:                   tok2str(bgp_notify_minor_msg_values, \"Unknown\",",
          "2673:                           bgpn_minor),",
          "2674:                   bgpn_minor));",
          "2675:         break;",
          "2676:     case BGP_NOTIFY_MAJOR_OPEN:",
          "2677:         ND_PRINT((ndo, \", subcode %s (%u)\",",
          "2678:                   tok2str(bgp_notify_minor_open_values, \"Unknown\",",
          "2679:                           bgpn_minor),",
          "2680:                   bgpn_minor));",
          "2681:         break;",
          "2682:     case BGP_NOTIFY_MAJOR_UPDATE:",
          "2683:         ND_PRINT((ndo, \", subcode %s (%u)\",",
          "2684:                   tok2str(bgp_notify_minor_update_values, \"Unknown\",",
          "2685:                           bgpn_minor),",
          "2686:                   bgpn_minor));",
          "2687:         break;",
          "2688:     case BGP_NOTIFY_MAJOR_FSM:",
          "2689:         ND_PRINT((ndo, \" subcode %s (%u)\",",
          "2690:                   tok2str(bgp_notify_minor_fsm_values, \"Unknown\",",
          "2691:                           bgpn_minor),",
          "2692:                   bgpn_minor));",
          "2693:         break;",
          "2694:     case BGP_NOTIFY_MAJOR_CAP:",
          "2695:         ND_PRINT((ndo, \" subcode %s (%u)\",",
          "2696:                   tok2str(bgp_notify_minor_cap_values, \"Unknown\",",
          "2697:                           bgpn_minor),",
          "2698:                   bgpn_minor));",
          "2699:         break;",
          "2700:     case BGP_NOTIFY_MAJOR_CEASE:",
          "2701:         ND_PRINT((ndo, \", subcode %s (%u)\",",
          "2702:                   tok2str(bgp_notify_minor_cease_values, \"Unknown\",",
          "2703:                           bgpn_minor),",
          "2704:                   bgpn_minor));",
          "2709:         if(bgpn_minor == BGP_NOTIFY_MINOR_CEASE_MAXPRFX && length >= BGP_NOTIFICATION_SIZE + 7) {",
          "2710:             tptr = dat + BGP_NOTIFICATION_SIZE;",
          "2711:             ND_TCHECK_7(tptr);",
          "2712:             ND_PRINT((ndo, \", AFI %s (%u), SAFI %s (%u), Max Prefixes: %u\",",
          "2713:                       tok2str(af_values, \"Unknown\", EXTRACT_BE_U_2(tptr)),",
          "2714:                       EXTRACT_BE_U_2(tptr),",
          "2715:                       tok2str(bgp_safi_values, \"Unknown\", EXTRACT_U_1((tptr + 2))),",
          "2716:                       EXTRACT_U_1((tptr + 2)),",
          "2717:                       EXTRACT_BE_U_4(tptr + 3)));",
          "2718:         }",
          "2723:         if ((bgpn_minor == BGP_NOTIFY_MINOR_CEASE_SHUT ||",
          "2724:              bgpn_minor == BGP_NOTIFY_MINOR_CEASE_RESET) &&",
          "2725:              length >= BGP_NOTIFICATION_SIZE + 1) {",
          "2726:             tptr = dat + BGP_NOTIFICATION_SIZE;",
          "2727:             ND_TCHECK_1(tptr);",
          "2728:             shutdown_comm_length = EXTRACT_U_1(tptr);",
          "2729:             remainder_offset = 0;",
          "2731:             if (shutdown_comm_length > BGP_NOTIFY_MINOR_CEASE_ADMIN_SHUTDOWN_LEN ||",
          "2732:                 shutdown_comm_length > length - (BGP_NOTIFICATION_SIZE + 1)) {",
          "2733:                 ND_PRINT((ndo, \", invalid Shutdown Communication length\"));",
          "2734:             }",
          "2735:             else if (shutdown_comm_length == 0) {",
          "2736:                 ND_PRINT((ndo, \", empty Shutdown Communication\"));",
          "2737:                 remainder_offset += 1;",
          "2738:             }",
          "2740:             else {",
          "2741:                 ND_TCHECK_LEN(tptr + 1, shutdown_comm_length);",
          "2742:                 ND_PRINT((ndo, \", Shutdown Communication (length: %u): \\\"\", shutdown_comm_length));",
          "2743:                 (void)fn_printn(ndo, tptr+1, shutdown_comm_length, NULL);",
          "2744:                 ND_PRINT((ndo, \"\\\"\"));",
          "2745:                 remainder_offset += shutdown_comm_length + 1;",
          "2746:             }",
          "2748:             if(length - (remainder_offset + BGP_NOTIFICATION_SIZE) > 0) {",
          "2749:                 ND_PRINT((ndo, \", Data: (length: %u)\", length - (remainder_offset + BGP_NOTIFICATION_SIZE)));",
          "2750:                 hex_print(ndo, \"\\n\\t\\t\", tptr + remainder_offset, length - (remainder_offset + BGP_NOTIFICATION_SIZE));",
          "2751:             }",
          "2753:         break;",
          "2754:     default:",
          "2755:         break;",
          "2756:     }",
          "2758:     return;",
          "2760:     ND_PRINT((ndo, \"[|BGP]\"));",
          "2765:             const u_char *pptr, int len)",
          "2767:     const struct bgp_route_refresh *bgp_route_refresh_header;",
          "2769:     ND_TCHECK_LEN(pptr, BGP_ROUTE_REFRESH_SIZE);",
          "2772:     if (len<BGP_ROUTE_REFRESH_SIZE)",
          "2773:         return;",
          "2775:     bgp_route_refresh_header = (const struct bgp_route_refresh *)pptr;",
          "2777:     ND_PRINT((ndo, \"\\n\\t  AFI %s (%u), SAFI %s (%u)\",",
          "2778:               tok2str(af_values,\"Unknown\",",
          "2779:                       EXTRACT_BE_U_2(bgp_route_refresh_header->afi)),",
          "2780:               EXTRACT_BE_U_2(bgp_route_refresh_header->afi),",
          "2781:               tok2str(bgp_safi_values,\"Unknown\",",
          "2782:                       EXTRACT_U_1(bgp_route_refresh_header->safi)),",
          "2783:               EXTRACT_U_1(bgp_route_refresh_header->safi)));",
          "2785:     if (ndo->ndo_vflag > 1) {",
          "2786:         ND_TCHECK_LEN(pptr, len);",
          "2787:         print_unknown_data(ndo, pptr, \"\\n\\t  \", len);",
          "2788:     }",
          "2790:     return;",
          "2792:     ND_PRINT((ndo, \"[|BGP]\"));",
          "2797:          const u_char *dat, u_int length)",
          "2799:     const struct bgp *bgp_header;",
          "2800:     uint8_t bgp_type;",
          "2802:     ND_TCHECK_LEN(dat, BGP_SIZE);",
          "2803:     bgp_header = (const struct bgp *)dat;",
          "2804:     bgp_type = EXTRACT_U_1(bgp_header->bgp_type);",
          "2806:     ND_PRINT((ndo, \"\\n\\t%s Message (%u), length: %u\",",
          "2807:               tok2str(bgp_msg_values, \"Unknown\", bgp_type),",
          "2808:               bgp_type,",
          "2809:               length));",
          "2811:     switch (bgp_type) {",
          "2812:     case BGP_OPEN:",
          "2813:         bgp_open_print(ndo, dat, length);",
          "2814:         break;",
          "2815:     case BGP_UPDATE:",
          "2816:         bgp_update_print(ndo, dat, length);",
          "2817:         break;",
          "2818:     case BGP_NOTIFICATION:",
          "2819:         bgp_notification_print(ndo, dat, length);",
          "2820:         break;",
          "2821:     case BGP_KEEPALIVE:",
          "2822:         break;",
          "2823:     case BGP_ROUTE_REFRESH:",
          "2824:         bgp_route_refresh_print(ndo, dat, length);",
          "2825:         break;",
          "2826:     default:",
          "2828:         ND_TCHECK_LEN(dat, length);",
          "2829:         ND_PRINT((ndo, \"\\n\\t  no Message %u decoder\", bgp_type));",
          "2830:         print_unknown_data(ndo, dat, \"\\n\\t  \", length);",
          "2831:         break;",
          "2832:     }",
          "2833:     return 1;",
          "2835:     ND_PRINT((ndo, \"[|BGP]\"));",
          "2836:     return 0;",
          "2841:       const u_char *dat, int length)",
          "2843:     const u_char *p;",
          "2844:     const u_char *ep;",
          "2845:     const u_char *start;",
          "2846:     const u_char marker[] = {",
          "2847:         0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,",
          "2848:         0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,",
          "2849:     };",
          "2850:     const struct bgp *bgp_header;",
          "2851:     uint16_t hlen;",
          "2853:     ep = dat + length;",
          "2854:     if (ndo->ndo_snapend < dat + length)",
          "2855:         ep = ndo->ndo_snapend;",
          "2857:     ND_PRINT((ndo, \": BGP\"));",
          "2860:         return;",
          "2862:     p = dat;",
          "2863:     start = p;",
          "2864:     while (p < ep) {",
          "2865:         if (!ND_TTEST_1(p))",
          "2866:             break;",
          "2867:         if (EXTRACT_U_1(p) != 0xff) {",
          "2868:             p++;",
          "2869:             continue;",
          "2870:         }",
          "2872:         if (!ND_TTEST_LEN(p, sizeof(marker)))",
          "2873:             break;",
          "2874:         if (memcmp(p, marker, sizeof(marker)) != 0) {",
          "2875:             p++;",
          "2876:             continue;",
          "2877:         }",
          "2880:         ND_TCHECK_LEN(p, BGP_SIZE);",
          "2881:         bgp_header = (const struct bgp *)p;",
          "2883:         if (start != p)",
          "2884:             ND_PRINT((ndo, \" [|BGP]\"));",
          "2886:         hlen = EXTRACT_BE_U_2(bgp_header->bgp_len);",
          "2887:         if (hlen < BGP_SIZE) {",
          "2888:             ND_PRINT((ndo, \"\\n[|BGP Bogus header length %u < %u]\", hlen,",
          "2889:                       BGP_SIZE));",
          "2890:             break;",
          "2891:         }",
          "2893:         if (ND_TTEST_LEN(p, hlen)) {",
          "2894:             if (!bgp_pdu_print(ndo, p, hlen))",
          "2896:             p += hlen;",
          "2897:             start = p;",
          "2898:         } else {",
          "2899:             ND_PRINT((ndo, \"\\n[|BGP %s]\",",
          "2900:                       tok2str(bgp_msg_values,",
          "2901:                               \"Unknown Message Type\",",
          "2902:                               EXTRACT_U_1(bgp_header->bgp_type))));",
          "2903:             break;",
          "2904:         }",
          "2905:     }",
          "2907:     return;",
          "2910:     ND_PRINT((ndo, \" [|BGP]\"));",
          "",
          "[Added Lines]",
          "1373:    return 4;",
          "1380:  int i;",
          "1381:  uint16_t af;",
          "1382:  uint8_t safi, snpa, nhlen;",
          "1384:             float f;",
          "1385:             uint32_t i;",
          "1386:         } bw;",
          "1387:  int advance;",
          "1388:  u_int tlen;",
          "1389:  const u_char *tptr;",
          "1390:  char buf[MAXHOSTNAMELEN + 100];",
          "1391:         int  as_size;",
          "1393:         tptr = pptr;",
          "1394:         tlen=len;",
          "1396:  switch (atype) {",
          "1397:  case BGPTYPE_ORIGIN:",
          "1398:   if (len != 1)",
          "1399:    ND_PRINT((ndo, \"invalid len\"));",
          "1400:   else {",
          "1401:    ND_TCHECK_1(tptr);",
          "1402:    ND_PRINT((ndo, \"%s\", tok2str(bgp_origin_values,",
          "1403:       \"Unknown Origin Typecode\",",
          "1404:       EXTRACT_U_1(tptr))));",
          "1405:   }",
          "1406:   break;",
          "1411:  case BGPTYPE_AS4_PATH:",
          "1412:  case BGPTYPE_AS_PATH:",
          "1413:   if (len % 2) {",
          "1414:    ND_PRINT((ndo, \"invalid len\"));",
          "1415:    break;",
          "1416:   }",
          "1417:                 if (!len) {",
          "1418:    ND_PRINT((ndo, \"empty\"));",
          "1419:    break;",
          "1420:                 }",
          "1430:                 as_size = bgp_attr_get_as_size(ndo, atype, pptr, len);",
          "1432:   while (tptr < pptr + len) {",
          "1433:    ND_TCHECK_1(tptr);",
          "1434:                         ND_PRINT((ndo, \"%s\", tok2str(bgp_as_path_segment_open_values,",
          "1435:       \"?\", EXTRACT_U_1(tptr))));",
          "1436:    ND_TCHECK_1(tptr + 1);",
          "1437:                         for (i = 0; i < tptr[1] * as_size; i += as_size) {",
          "1438:                             ND_TCHECK_LEN(tptr + 2 + i, as_size);",
          "1439:        ND_PRINT((ndo, \"%s \",",
          "1440:     as_printf(ndo, astostr, sizeof(astostr),",
          "1441:     as_size == 2 ?",
          "1442:     EXTRACT_BE_U_2(tptr + i + 2) :",
          "1443:     EXTRACT_BE_U_4(tptr + i + 2))));",
          "1444:                         }",
          "1445:    ND_TCHECK_1(tptr);",
          "1446:                         ND_PRINT((ndo, \"%s\", tok2str(bgp_as_path_segment_close_values,",
          "1447:       \"?\", EXTRACT_U_1(tptr))));",
          "1448:                         ND_TCHECK_1(tptr + 1);",
          "1449:                         tptr += 2 + EXTRACT_U_1(tptr + 1) * as_size;",
          "1450:   }",
          "1451:   break;",
          "1452:  case BGPTYPE_NEXT_HOP:",
          "1453:   if (len != 4)",
          "1454:    ND_PRINT((ndo, \"invalid len\"));",
          "1455:   else {",
          "1456:    ND_TCHECK_4(tptr);",
          "1457:    ND_PRINT((ndo, \"%s\", ipaddr_string(ndo, tptr)));",
          "1458:   }",
          "1459:   break;",
          "1460:  case BGPTYPE_MULTI_EXIT_DISC:",
          "1461:  case BGPTYPE_LOCAL_PREF:",
          "1462:   if (len != 4)",
          "1463:    ND_PRINT((ndo, \"invalid len\"));",
          "1464:   else {",
          "1465:    ND_TCHECK_4(tptr);",
          "1466:    ND_PRINT((ndo, \"%u\", EXTRACT_BE_U_4(tptr)));",
          "1467:   }",
          "1468:   break;",
          "1469:  case BGPTYPE_ATOMIC_AGGREGATE:",
          "1470:   if (len != 0)",
          "1471:    ND_PRINT((ndo, \"invalid len\"));",
          "1472:   break;",
          "1473:         case BGPTYPE_AGGREGATOR:",
          "1479:                 if (len != 6 && len != 8) {",
          "1480:                     ND_PRINT((ndo, \"invalid len\"));",
          "1481:                     break;",
          "1482:                 }",
          "1483:                 ND_TCHECK_LEN(tptr, len);",
          "1484:                 if (len == 6) {",
          "1485:       ND_PRINT((ndo, \" AS #%s, origin %s\",",
          "1486:    as_printf(ndo, astostr, sizeof(astostr), EXTRACT_BE_U_2(tptr)),",
          "1487:    ipaddr_string(ndo, tptr + 2)));",
          "1488:                 } else {",
          "1489:       ND_PRINT((ndo, \" AS #%s, origin %s\",",
          "1490:    as_printf(ndo, astostr, sizeof(astostr),",
          "1491:    EXTRACT_BE_U_4(tptr)), ipaddr_string(ndo, tptr + 4)));",
          "1492:                 }",
          "1494:  case BGPTYPE_AGGREGATOR4:",
          "1495:   if (len != 8) {",
          "1496:    ND_PRINT((ndo, \"invalid len\"));",
          "1497:    break;",
          "1498:   }",
          "1499:   ND_TCHECK_8(tptr);",
          "1500:   ND_PRINT((ndo, \" AS #%s, origin %s\",",
          "1501:          as_printf(ndo, astostr, sizeof(astostr), EXTRACT_BE_U_4(tptr)),",
          "1502:          ipaddr_string(ndo, tptr + 4)));",
          "1503:   break;",
          "1504:  case BGPTYPE_COMMUNITIES:",
          "1505:   if (len % 4) {",
          "1506:    ND_PRINT((ndo, \"invalid len\"));",
          "1507:    break;",
          "1508:   }",
          "1509:   while (tlen>0) {",
          "1510:    uint32_t comm;",
          "1511:    ND_TCHECK_4(tptr);",
          "1512:    comm = EXTRACT_BE_U_4(tptr);",
          "1513:    switch (comm) {",
          "1514:    case BGP_COMMUNITY_NO_EXPORT:",
          "1515:     ND_PRINT((ndo, \" NO_EXPORT\"));",
          "1516:     break;",
          "1517:    case BGP_COMMUNITY_NO_ADVERT:",
          "1518:     ND_PRINT((ndo, \" NO_ADVERTISE\"));",
          "1519:     break;",
          "1520:    case BGP_COMMUNITY_NO_EXPORT_SUBCONFED:",
          "1521:     ND_PRINT((ndo, \" NO_EXPORT_SUBCONFED\"));",
          "1522:     break;",
          "1523:    default:",
          "1524:     ND_PRINT((ndo, \"%u:%u%s\",",
          "1525:                                        (comm >> 16) & 0xffff,",
          "1526:                                        comm & 0xffff,",
          "1527:                                        (tlen>4) ? \", \" : \"\"));",
          "1528:     break;",
          "1529:    }",
          "1530:                         tlen -=4;",
          "1531:                         tptr +=4;",
          "1532:   }",
          "1533:   break;",
          "1534:         case BGPTYPE_ORIGINATOR_ID:",
          "1535:   if (len != 4) {",
          "1536:    ND_PRINT((ndo, \"invalid len\"));",
          "1537:    break;",
          "1538:   }",
          "1539:   ND_TCHECK_4(tptr);",
          "1540:                 ND_PRINT((ndo, \"%s\",ipaddr_string(ndo, tptr)));",
          "1542:         case BGPTYPE_CLUSTER_LIST:",
          "1543:   if (len % 4) {",
          "1544:    ND_PRINT((ndo, \"invalid len\"));",
          "1545:    break;",
          "1546:   }",
          "1547:                 while (tlen>0) {",
          "1548:    ND_TCHECK_4(tptr);",
          "1549:                         ND_PRINT((ndo, \"%s%s\",",
          "1550:                                ipaddr_string(ndo, tptr),",
          "1551:                                 (tlen>4) ? \", \" : \"\"));",
          "1552:                         tlen -=4;",
          "1553:                         tptr +=4;",
          "1554:                 }",
          "1556:  case BGPTYPE_MP_REACH_NLRI:",
          "1557:   ND_TCHECK_3(tptr);",
          "1558:   af = EXTRACT_BE_U_2(tptr);",
          "1559:   safi = EXTRACT_U_1(tptr + 2);",
          "1561:                 ND_PRINT((ndo, \"\\n\\t    AFI: %s (%u), %sSAFI: %s (%u)\",",
          "1562:                        tok2str(af_values, \"Unknown AFI\", af),",
          "1563:                        af,",
          "1565:                        tok2str(bgp_safi_values, \"Unknown SAFI\", safi),",
          "1566:                        safi));",
          "1577:                 case (AFNUM_INET<<8 | SAFNUM_MULTICAST_VPN):",
          "1578:   case (AFNUM_INET<<8 | SAFNUM_MDT):",
          "1592:                 case (AFNUM_L2VPN<<8 | SAFNUM_VPNUNICAST):",
          "1593:                 case (AFNUM_L2VPN<<8 | SAFNUM_VPNMULTICAST):",
          "1594:                 case (AFNUM_L2VPN<<8 | SAFNUM_VPNUNIMULTICAST):",
          "1595:                 case (AFNUM_VPLS<<8 | SAFNUM_VPLS):",
          "1599:                     ND_PRINT((ndo, \"\\n\\t    no AFI %u / SAFI %u decoder\", af, safi));",
          "1606:                 tptr +=3;",
          "1608:   ND_TCHECK_1(tptr);",
          "1609:   nhlen = EXTRACT_U_1(tptr);",
          "1610:                 tlen = nhlen;",
          "1611:                 tptr++;",
          "1613:   if (tlen) {",
          "1614:                     int nnh = 0;",
          "1615:                     ND_PRINT((ndo, \"\\n\\t    nexthop: \"));",
          "1616:                     while (tlen > 0) {",
          "1617:                         if ( nnh++ > 0 ) {",
          "1618:                             ND_PRINT((ndo,  \", \" ));",
          "1619:                         }",
          "1620:                         switch(af<<8 | safi) {",
          "1621:                         case (AFNUM_INET<<8 | SAFNUM_UNICAST):",
          "1622:                         case (AFNUM_INET<<8 | SAFNUM_MULTICAST):",
          "1623:                         case (AFNUM_INET<<8 | SAFNUM_UNIMULTICAST):",
          "1624:                         case (AFNUM_INET<<8 | SAFNUM_LABUNICAST):",
          "1625:                         case (AFNUM_INET<<8 | SAFNUM_RT_ROUTING_INFO):",
          "1626:                         case (AFNUM_INET<<8 | SAFNUM_MULTICAST_VPN):",
          "1627:                         case (AFNUM_INET<<8 | SAFNUM_MDT):",
          "1628:        if (tlen < sizeof(struct in_addr)) {",
          "1629:                                 ND_PRINT((ndo, \"invalid len\"));",
          "1630:                                 tlen = 0;",
          "1631:                             } else {",
          "1632:                                 ND_TCHECK_LEN(tptr, sizeof(struct in_addr));",
          "1633:                                 ND_PRINT((ndo, \"%s\",ipaddr_string(ndo, tptr)));",
          "1634:                                 tlen -= sizeof(struct in_addr);",
          "1635:                                 tptr += sizeof(struct in_addr);",
          "1636:                             }",
          "1637:                             break;",
          "1638:                         case (AFNUM_INET<<8 | SAFNUM_VPNUNICAST):",
          "1639:                         case (AFNUM_INET<<8 | SAFNUM_VPNMULTICAST):",
          "1640:                         case (AFNUM_INET<<8 | SAFNUM_VPNUNIMULTICAST):",
          "1641:                             if (tlen < sizeof(struct in_addr)+BGP_VPN_RD_LEN) {",
          "1642:                                 ND_PRINT((ndo, \"invalid len\"));",
          "1643:                                 tlen = 0;",
          "1644:                             } else {",
          "1645:                                 ND_TCHECK_LEN(tptr,",
          "1646:                                               sizeof(struct in_addr) + BGP_VPN_RD_LEN);",
          "1647:                                 ND_PRINT((ndo, \"RD: %s, %s\",",
          "1648:                                        bgp_vpn_rd_print(ndo, tptr),",
          "1649:                                        ipaddr_string(ndo, tptr+BGP_VPN_RD_LEN)));",
          "1650:                                 tlen -= (sizeof(struct in_addr)+BGP_VPN_RD_LEN);",
          "1651:                                 tptr += (sizeof(struct in_addr)+BGP_VPN_RD_LEN);",
          "1652:                             }",
          "1653:                             break;",
          "1654:                         case (AFNUM_INET6<<8 | SAFNUM_UNICAST):",
          "1655:                         case (AFNUM_INET6<<8 | SAFNUM_MULTICAST):",
          "1656:                         case (AFNUM_INET6<<8 | SAFNUM_UNIMULTICAST):",
          "1657:                         case (AFNUM_INET6<<8 | SAFNUM_LABUNICAST):",
          "1658:                             if (tlen < sizeof(struct in6_addr)) {",
          "1659:                                 ND_PRINT((ndo, \"invalid len\"));",
          "1660:                                 tlen = 0;",
          "1661:                             } else {",
          "1662:                                 ND_TCHECK_LEN(tptr, sizeof(struct in6_addr));",
          "1663:                                 ND_PRINT((ndo, \"%s\", ip6addr_string(ndo, tptr)));",
          "1664:                                 tlen -= sizeof(struct in6_addr);",
          "1665:                                 tptr += sizeof(struct in6_addr);",
          "1666:                             }",
          "1667:                             break;",
          "1668:                         case (AFNUM_INET6<<8 | SAFNUM_VPNUNICAST):",
          "1669:                         case (AFNUM_INET6<<8 | SAFNUM_VPNMULTICAST):",
          "1670:                         case (AFNUM_INET6<<8 | SAFNUM_VPNUNIMULTICAST):",
          "1671:                             if (tlen < sizeof(struct in6_addr)+BGP_VPN_RD_LEN) {",
          "1672:                                 ND_PRINT((ndo, \"invalid len\"));",
          "1673:                                 tlen = 0;",
          "1674:                             } else {",
          "1675:                                 ND_TCHECK_LEN(tptr,",
          "1676:                                               sizeof(struct in6_addr) + BGP_VPN_RD_LEN);",
          "1677:                                 ND_PRINT((ndo, \"RD: %s, %s\",",
          "1678:                                        bgp_vpn_rd_print(ndo, tptr),",
          "1679:                                        ip6addr_string(ndo, tptr+BGP_VPN_RD_LEN)));",
          "1680:                                 tlen -= (sizeof(struct in6_addr)+BGP_VPN_RD_LEN);",
          "1681:                                 tptr += (sizeof(struct in6_addr)+BGP_VPN_RD_LEN);",
          "1682:                             }",
          "1683:                             break;",
          "1684:                         case (AFNUM_VPLS<<8 | SAFNUM_VPLS):",
          "1685:                         case (AFNUM_L2VPN<<8 | SAFNUM_VPNUNICAST):",
          "1686:                         case (AFNUM_L2VPN<<8 | SAFNUM_VPNMULTICAST):",
          "1687:                         case (AFNUM_L2VPN<<8 | SAFNUM_VPNUNIMULTICAST):",
          "1688:                             if (tlen < sizeof(struct in_addr)) {",
          "1689:                                 ND_PRINT((ndo, \"invalid len\"));",
          "1690:                                 tlen = 0;",
          "1691:                             } else {",
          "1692:                                 ND_TCHECK_LEN(tptr, sizeof(struct in_addr));",
          "1693:                                 ND_PRINT((ndo, \"%s\", ipaddr_string(ndo, tptr)));",
          "1694:                                 tlen -= (sizeof(struct in_addr));",
          "1695:                                 tptr += (sizeof(struct in_addr));",
          "1696:                             }",
          "1697:                             break;",
          "1698:                         case (AFNUM_NSAP<<8 | SAFNUM_UNICAST):",
          "1699:                         case (AFNUM_NSAP<<8 | SAFNUM_MULTICAST):",
          "1700:                         case (AFNUM_NSAP<<8 | SAFNUM_UNIMULTICAST):",
          "1701:                             ND_TCHECK_LEN(tptr, tlen);",
          "1702:                             ND_PRINT((ndo, \"%s\", isonsap_string(ndo, tptr, tlen)));",
          "1703:                             tptr += tlen;",
          "1704:                             tlen = 0;",
          "1705:                             break;",
          "1707:                         case (AFNUM_NSAP<<8 | SAFNUM_VPNUNICAST):",
          "1708:                         case (AFNUM_NSAP<<8 | SAFNUM_VPNMULTICAST):",
          "1709:                         case (AFNUM_NSAP<<8 | SAFNUM_VPNUNIMULTICAST):",
          "1710:                             if (tlen < BGP_VPN_RD_LEN+1) {",
          "1711:                                 ND_PRINT((ndo, \"invalid len\"));",
          "1712:                                 tlen = 0;",
          "1713:                             } else {",
          "1714:                                 ND_TCHECK_LEN(tptr, tlen);",
          "1715:                                 ND_PRINT((ndo, \"RD: %s, %s\",",
          "1716:                                        bgp_vpn_rd_print(ndo, tptr),",
          "1717:                                        isonsap_string(ndo, tptr+BGP_VPN_RD_LEN,tlen-BGP_VPN_RD_LEN)));",
          "1719:                                 if (EXTRACT_BE_U_4(tptr + BGP_VPN_RD_LEN) ==  0x47000601)",
          "1720:                                     ND_PRINT((ndo, \" = %s\", ipaddr_string(ndo, tptr+BGP_VPN_RD_LEN+4)));",
          "1722:                                 else if (EXTRACT_BE_U_3(tptr + BGP_VPN_RD_LEN) ==  0x350000)",
          "1723:                                     ND_PRINT((ndo, \" = %s\", ip6addr_string(ndo, tptr+BGP_VPN_RD_LEN+3)));",
          "1724:                                 tptr += tlen;",
          "1725:                                 tlen = 0;",
          "1726:                             }",
          "1727:                             break;",
          "1728:                         default:",
          "1729:                             ND_TCHECK_LEN(tptr, tlen);",
          "1730:                             ND_PRINT((ndo, \"no AFI %u/SAFI %u decoder\", af, safi));",
          "1731:                             if (ndo->ndo_vflag <= 1)",
          "1732:                                 print_unknown_data(ndo, tptr, \"\\n\\t    \", tlen);",
          "1733:                             tptr += tlen;",
          "1734:                             tlen = 0;",
          "1735:                             goto done;",
          "1736:                             break;",
          "1737:                         }",
          "1738:                     }",
          "1739:   }",
          "1740:   ND_PRINT((ndo, \", nh-length: %u\", nhlen));",
          "1741:   tptr += tlen;",
          "1743:   ND_TCHECK_1(tptr);",
          "1744:   snpa = EXTRACT_U_1(tptr);",
          "1745:   tptr++;",
          "1747:   if (snpa) {",
          "1748:    ND_PRINT((ndo, \"\\n\\t    %u SNPA\", snpa));",
          "1749:    for (/*nothing*/; snpa > 0; snpa--) {",
          "1750:     ND_TCHECK_1(tptr);",
          "1751:     ND_PRINT((ndo, \"\\n\\t      %d bytes\", EXTRACT_U_1(tptr)));",
          "1752:     tptr += EXTRACT_U_1(tptr) + 1;",
          "1753:    }",
          "1754:   } else {",
          "1755:    ND_PRINT((ndo, \", no SNPA\"));",
          "1756:                 }",
          "1758:   while (tptr < pptr + len) {",
          "1759:                     switch (af<<8 | safi) {",
          "1760:                     case (AFNUM_INET<<8 | SAFNUM_UNICAST):",
          "1761:                     case (AFNUM_INET<<8 | SAFNUM_MULTICAST):",
          "1762:                     case (AFNUM_INET<<8 | SAFNUM_UNIMULTICAST):",
          "1763:                         advance = decode_prefix4(ndo, tptr, len, buf, sizeof(buf));",
          "1764:                         if (advance == -1)",
          "1765:                             ND_PRINT((ndo, \"\\n\\t    (illegal prefix length)\"));",
          "1766:                         else if (advance == -2)",
          "1767:                             goto trunc;",
          "1768:                         else if (advance == -3)",
          "1770:                         else",
          "1771:                             ND_PRINT((ndo, \"\\n\\t      %s\", buf));",
          "1772:                         break;",
          "1773:                     case (AFNUM_INET<<8 | SAFNUM_LABUNICAST):",
          "1774:                         advance = decode_labeled_prefix4(ndo, tptr, len, buf, sizeof(buf));",
          "1775:                         if (advance == -1)",
          "1776:                             ND_PRINT((ndo, \"\\n\\t    (illegal prefix length)\"));",
          "1777:                         else if (advance == -2)",
          "1778:                             goto trunc;",
          "1779:                         else if (advance == -3)",
          "1781:                         else",
          "1782:                             ND_PRINT((ndo, \"\\n\\t      %s\", buf));",
          "1783:                         break;",
          "1784:                     case (AFNUM_INET<<8 | SAFNUM_VPNUNICAST):",
          "1785:                     case (AFNUM_INET<<8 | SAFNUM_VPNMULTICAST):",
          "1786:                     case (AFNUM_INET<<8 | SAFNUM_VPNUNIMULTICAST):",
          "1787:                         advance = decode_labeled_vpn_prefix4(ndo, tptr, buf, sizeof(buf));",
          "1788:                         if (advance == -1)",
          "1789:                             ND_PRINT((ndo, \"\\n\\t    (illegal prefix length)\"));",
          "1790:                         else if (advance == -2)",
          "1791:                             goto trunc;",
          "1792:                         else",
          "1793:                             ND_PRINT((ndo, \"\\n\\t      %s\", buf));",
          "1794:                         break;",
          "1795:                     case (AFNUM_INET<<8 | SAFNUM_RT_ROUTING_INFO):",
          "1796:                         advance = decode_rt_routing_info(ndo, tptr, buf, sizeof(buf));",
          "1797:                         if (advance == -1)",
          "1798:                             ND_PRINT((ndo, \"\\n\\t    (illegal prefix length)\"));",
          "1799:                         else if (advance == -2)",
          "1800:                             goto trunc;",
          "1801:                         else",
          "1802:                             ND_PRINT((ndo, \"\\n\\t      %s\", buf));",
          "1803:                         break;",
          "1805:                     case (AFNUM_INET6<<8 | SAFNUM_MULTICAST_VPN):",
          "1806:                         advance = decode_multicast_vpn(ndo, tptr, buf, sizeof(buf));",
          "1807:                         if (advance == -1)",
          "1808:                             ND_PRINT((ndo, \"\\n\\t    (illegal prefix length)\"));",
          "1809:                         else if (advance == -2)",
          "1810:                             goto trunc;",
          "1811:                         else",
          "1812:                             ND_PRINT((ndo, \"\\n\\t      %s\", buf));",
          "1813:                         break;",
          "1815:       case (AFNUM_INET<<8 | SAFNUM_MDT):",
          "1816:         advance = decode_mdt_vpn_nlri(ndo, tptr, buf, sizeof(buf));",
          "1817:         if (advance == -1)",
          "1818:                             ND_PRINT((ndo, \"\\n\\t    (illegal prefix length)\"));",
          "1819:                         else if (advance == -2)",
          "1820:                             goto trunc;",
          "1821:                         else",
          "1822:                             ND_PRINT((ndo, \"\\n\\t      %s\", buf));",
          "1823:          break;",
          "1824:                     case (AFNUM_INET6<<8 | SAFNUM_UNICAST):",
          "1825:                     case (AFNUM_INET6<<8 | SAFNUM_MULTICAST):",
          "1826:                     case (AFNUM_INET6<<8 | SAFNUM_UNIMULTICAST):",
          "1827:                         advance = decode_prefix6(ndo, tptr, len, buf, sizeof(buf));",
          "1828:                         if (advance == -1)",
          "1829:                             ND_PRINT((ndo, \"\\n\\t    (illegal prefix length)\"));",
          "1830:                         else if (advance == -2)",
          "1831:                             goto trunc;",
          "1832:                         else if (advance == -3)",
          "1834:                         else",
          "1835:                             ND_PRINT((ndo, \"\\n\\t      %s\", buf));",
          "1836:                         break;",
          "1837:                     case (AFNUM_INET6<<8 | SAFNUM_LABUNICAST):",
          "1838:                         advance = decode_labeled_prefix6(ndo, tptr, len, buf, sizeof(buf));",
          "1839:                         if (advance == -1)",
          "1840:                             ND_PRINT((ndo, \"\\n\\t    (illegal prefix length)\"));",
          "1841:                         else if (advance == -2)",
          "1842:                             goto trunc;",
          "1843:                         else if (advance == -3)",
          "1845:                         else",
          "1846:                             ND_PRINT((ndo, \"\\n\\t      %s\", buf));",
          "1847:                         break;",
          "1848:                     case (AFNUM_INET6<<8 | SAFNUM_VPNUNICAST):",
          "1849:                     case (AFNUM_INET6<<8 | SAFNUM_VPNMULTICAST):",
          "1850:                     case (AFNUM_INET6<<8 | SAFNUM_VPNUNIMULTICAST):",
          "1851:                         advance = decode_labeled_vpn_prefix6(ndo, tptr, buf, sizeof(buf));",
          "1852:                         if (advance == -1)",
          "1853:                             ND_PRINT((ndo, \"\\n\\t    (illegal prefix length)\"));",
          "1854:                         else if (advance == -2)",
          "1855:                             goto trunc;",
          "1856:                         else",
          "1857:                             ND_PRINT((ndo, \"\\n\\t      %s\", buf));",
          "1858:                         break;",
          "1859:                     case (AFNUM_VPLS<<8 | SAFNUM_VPLS):",
          "1860:                     case (AFNUM_L2VPN<<8 | SAFNUM_VPNUNICAST):",
          "1861:                     case (AFNUM_L2VPN<<8 | SAFNUM_VPNMULTICAST):",
          "1862:                     case (AFNUM_L2VPN<<8 | SAFNUM_VPNUNIMULTICAST):",
          "1863:                         advance = decode_labeled_vpn_l2(ndo, tptr, buf, sizeof(buf));",
          "1864:                         if (advance == -1)",
          "1865:                             ND_PRINT((ndo, \"\\n\\t    (illegal length)\"));",
          "1866:                         else if (advance == -2)",
          "1867:                             goto trunc;",
          "1868:                         else",
          "1869:                             ND_PRINT((ndo, \"\\n\\t      %s\", buf));",
          "1870:                         break;",
          "1871:                     case (AFNUM_NSAP<<8 | SAFNUM_UNICAST):",
          "1872:                     case (AFNUM_NSAP<<8 | SAFNUM_MULTICAST):",
          "1873:                     case (AFNUM_NSAP<<8 | SAFNUM_UNIMULTICAST):",
          "1874:                         advance = decode_clnp_prefix(ndo, tptr, buf, sizeof(buf));",
          "1875:                         if (advance == -1)",
          "1876:                             ND_PRINT((ndo, \"\\n\\t    (illegal prefix length)\"));",
          "1877:                         else if (advance == -2)",
          "1878:                             goto trunc;",
          "1879:                         else",
          "1880:                             ND_PRINT((ndo, \"\\n\\t      %s\", buf));",
          "1881:                         break;",
          "1882:                     case (AFNUM_NSAP<<8 | SAFNUM_VPNUNICAST):",
          "1883:                     case (AFNUM_NSAP<<8 | SAFNUM_VPNMULTICAST):",
          "1884:                     case (AFNUM_NSAP<<8 | SAFNUM_VPNUNIMULTICAST):",
          "1885:                         advance = decode_labeled_vpn_clnp_prefix(ndo, tptr, buf, sizeof(buf));",
          "1886:                         if (advance == -1)",
          "1887:                             ND_PRINT((ndo, \"\\n\\t    (illegal prefix length)\"));",
          "1888:                         else if (advance == -2)",
          "1889:                             goto trunc;",
          "1890:                         else",
          "1891:                             ND_PRINT((ndo, \"\\n\\t      %s\", buf));",
          "1892:                         break;",
          "1893:                     default:",
          "1894:                         ND_TCHECK_LEN(tptr, tlen);",
          "1895:                         ND_PRINT((ndo, \"\\n\\t    no AFI %u / SAFI %u decoder\", af, safi));",
          "1896:                         if (ndo->ndo_vflag <= 1)",
          "1897:                             print_unknown_data(ndo, tptr, \"\\n\\t    \", tlen);",
          "1898:                         advance = 0;",
          "1899:                         tptr = pptr + len;",
          "1900:                         break;",
          "1901:                     }",
          "1902:                     if (advance < 0)",
          "1903:                         break;",
          "1904:                     tptr += advance;",
          "1905:   }",
          "1906:         done:",
          "1907:   break;",
          "1909:  case BGPTYPE_MP_UNREACH_NLRI:",
          "1910:   ND_TCHECK_LEN(tptr, BGP_MP_NLRI_MINSIZE);",
          "1911:   af = EXTRACT_BE_U_2(tptr);",
          "1912:   safi = EXTRACT_U_1(tptr + 2);",
          "1914:                 ND_PRINT((ndo, \"\\n\\t    AFI: %s (%u), %sSAFI: %s (%u)\",",
          "1915:                        tok2str(af_values, \"Unknown AFI\", af),",
          "1916:                        af,",
          "1918:                        tok2str(bgp_safi_values, \"Unknown SAFI\", safi),",
          "1919:                        safi));",
          "1921:                 if (len == BGP_MP_NLRI_MINSIZE)",
          "1922:                     ND_PRINT((ndo, \"\\n\\t      End-of-Rib Marker (empty NLRI)\"));",
          "1924:   tptr += 3;",
          "1926:   while (tptr < pptr + len) {",
          "1927:                     switch (af<<8 | safi) {",
          "1928:                     case (AFNUM_INET<<8 | SAFNUM_UNICAST):",
          "1929:                     case (AFNUM_INET<<8 | SAFNUM_MULTICAST):",
          "1930:                     case (AFNUM_INET<<8 | SAFNUM_UNIMULTICAST):",
          "1931:                         advance = decode_prefix4(ndo, tptr, len, buf, sizeof(buf));",
          "1932:                         if (advance == -1)",
          "1933:                             ND_PRINT((ndo, \"\\n\\t    (illegal prefix length)\"));",
          "1934:                         else if (advance == -2)",
          "1935:                             goto trunc;",
          "1936:                         else if (advance == -3)",
          "1938:                         else",
          "1939:                             ND_PRINT((ndo, \"\\n\\t      %s\", buf));",
          "1940:                         break;",
          "1941:                     case (AFNUM_INET<<8 | SAFNUM_LABUNICAST):",
          "1942:                         advance = decode_labeled_prefix4(ndo, tptr, len, buf, sizeof(buf));",
          "1943:                         if (advance == -1)",
          "1944:                             ND_PRINT((ndo, \"\\n\\t    (illegal prefix length)\"));",
          "1945:                         else if (advance == -2)",
          "1946:                             goto trunc;",
          "1947:                         else if (advance == -3)",
          "1949:                         else",
          "1950:                             ND_PRINT((ndo, \"\\n\\t      %s\", buf));",
          "1951:                         break;",
          "1952:                     case (AFNUM_INET<<8 | SAFNUM_VPNUNICAST):",
          "1953:                     case (AFNUM_INET<<8 | SAFNUM_VPNMULTICAST):",
          "1954:                     case (AFNUM_INET<<8 | SAFNUM_VPNUNIMULTICAST):",
          "1955:                         advance = decode_labeled_vpn_prefix4(ndo, tptr, buf, sizeof(buf));",
          "1956:                         if (advance == -1)",
          "1957:                             ND_PRINT((ndo, \"\\n\\t    (illegal prefix length)\"));",
          "1958:                         else if (advance == -2)",
          "1959:                             goto trunc;",
          "1960:                         else",
          "1961:                             ND_PRINT((ndo, \"\\n\\t      %s\", buf));",
          "1962:                         break;",
          "1963:                     case (AFNUM_INET6<<8 | SAFNUM_UNICAST):",
          "1964:                     case (AFNUM_INET6<<8 | SAFNUM_MULTICAST):",
          "1965:                     case (AFNUM_INET6<<8 | SAFNUM_UNIMULTICAST):",
          "1966:                         advance = decode_prefix6(ndo, tptr, len, buf, sizeof(buf));",
          "1967:                         if (advance == -1)",
          "1968:                             ND_PRINT((ndo, \"\\n\\t    (illegal prefix length)\"));",
          "1969:                         else if (advance == -2)",
          "1970:                             goto trunc;",
          "1971:                         else if (advance == -3)",
          "1973:                         else",
          "1974:                             ND_PRINT((ndo, \"\\n\\t      %s\", buf));",
          "1975:                         break;",
          "1976:                     case (AFNUM_INET6<<8 | SAFNUM_LABUNICAST):",
          "1977:                         advance = decode_labeled_prefix6(ndo, tptr, len, buf, sizeof(buf));",
          "1978:                         if (advance == -1)",
          "1979:                             ND_PRINT((ndo, \"\\n\\t    (illegal prefix length)\"));",
          "1980:                         else if (advance == -2)",
          "1981:                             goto trunc;",
          "1982:                         else if (advance == -3)",
          "1984:                         else",
          "1985:                             ND_PRINT((ndo, \"\\n\\t      %s\", buf));",
          "1986:                         break;",
          "1987:                     case (AFNUM_INET6<<8 | SAFNUM_VPNUNICAST):",
          "1988:                     case (AFNUM_INET6<<8 | SAFNUM_VPNMULTICAST):",
          "1989:                     case (AFNUM_INET6<<8 | SAFNUM_VPNUNIMULTICAST):",
          "1990:                         advance = decode_labeled_vpn_prefix6(ndo, tptr, buf, sizeof(buf));",
          "1991:                         if (advance == -1)",
          "1992:                             ND_PRINT((ndo, \"\\n\\t    (illegal prefix length)\"));",
          "1993:                         else if (advance == -2)",
          "1994:                             goto trunc;",
          "1995:                         else",
          "1996:                             ND_PRINT((ndo, \"\\n\\t      %s\", buf));",
          "1997:                         break;",
          "1998:                     case (AFNUM_VPLS<<8 | SAFNUM_VPLS):",
          "1999:                     case (AFNUM_L2VPN<<8 | SAFNUM_VPNUNICAST):",
          "2000:                     case (AFNUM_L2VPN<<8 | SAFNUM_VPNMULTICAST):",
          "2001:                     case (AFNUM_L2VPN<<8 | SAFNUM_VPNUNIMULTICAST):",
          "2002:                         advance = decode_labeled_vpn_l2(ndo, tptr, buf, sizeof(buf));",
          "2003:                         if (advance == -1)",
          "2004:                             ND_PRINT((ndo, \"\\n\\t    (illegal length)\"));",
          "2005:                         else if (advance == -2)",
          "2006:                             goto trunc;",
          "2007:                         else",
          "2008:                             ND_PRINT((ndo, \"\\n\\t      %s\", buf));",
          "2009:                         break;",
          "2010:                     case (AFNUM_NSAP<<8 | SAFNUM_UNICAST):",
          "2011:                     case (AFNUM_NSAP<<8 | SAFNUM_MULTICAST):",
          "2012:                     case (AFNUM_NSAP<<8 | SAFNUM_UNIMULTICAST):",
          "2013:                         advance = decode_clnp_prefix(ndo, tptr, buf, sizeof(buf));",
          "2014:                         if (advance == -1)",
          "2015:                             ND_PRINT((ndo, \"\\n\\t    (illegal prefix length)\"));",
          "2016:                         else if (advance == -2)",
          "2017:                             goto trunc;",
          "2018:                         else",
          "2019:                             ND_PRINT((ndo, \"\\n\\t      %s\", buf));",
          "2020:                         break;",
          "2021:                     case (AFNUM_NSAP<<8 | SAFNUM_VPNUNICAST):",
          "2022:                     case (AFNUM_NSAP<<8 | SAFNUM_VPNMULTICAST):",
          "2023:                     case (AFNUM_NSAP<<8 | SAFNUM_VPNUNIMULTICAST):",
          "2024:                         advance = decode_labeled_vpn_clnp_prefix(ndo, tptr, buf, sizeof(buf));",
          "2025:                         if (advance == -1)",
          "2026:                             ND_PRINT((ndo, \"\\n\\t    (illegal prefix length)\"));",
          "2027:                         else if (advance == -2)",
          "2028:                             goto trunc;",
          "2029:                         else",
          "2030:                             ND_PRINT((ndo, \"\\n\\t      %s\", buf));",
          "2031:                         break;",
          "2032:       case (AFNUM_INET<<8 | SAFNUM_MDT):",
          "2033:         advance = decode_mdt_vpn_nlri(ndo, tptr, buf, sizeof(buf));",
          "2034:         if (advance == -1)",
          "2035:                             ND_PRINT((ndo, \"\\n\\t    (illegal prefix length)\"));",
          "2036:                         else if (advance == -2)",
          "2037:                             goto trunc;",
          "2038:                         else",
          "2039:                             ND_PRINT((ndo, \"\\n\\t      %s\", buf));",
          "2040:          break;",
          "2042:                     case (AFNUM_INET6<<8 | SAFNUM_MULTICAST_VPN):",
          "2043:                         advance = decode_multicast_vpn(ndo, tptr, buf, sizeof(buf));",
          "2044:                         if (advance == -1)",
          "2045:                             ND_PRINT((ndo, \"\\n\\t    (illegal prefix length)\"));",
          "2046:                         else if (advance == -2)",
          "2047:                             goto trunc;",
          "2048:                         else",
          "2049:                             ND_PRINT((ndo, \"\\n\\t      %s\", buf));",
          "2050:                         break;",
          "2051:                     default:",
          "2052:                         ND_TCHECK_LEN(tptr - 3, tlen);",
          "2053:                         ND_PRINT((ndo, \"no AFI %u / SAFI %u decoder\", af, safi));",
          "2054:                         if (ndo->ndo_vflag <= 1)",
          "2055:                             print_unknown_data(ndo, tptr-3, \"\\n\\t    \", tlen);",
          "2056:                         advance = 0;",
          "2057:                         tptr = pptr + len;",
          "2058:                         break;",
          "2059:                     }",
          "2060:                     if (advance < 0)",
          "2061:                         break;",
          "2062:                     tptr += advance;",
          "2063:   }",
          "2064:   break;",
          "2065:         case BGPTYPE_EXTD_COMMUNITIES:",
          "2066:   if (len % 8) {",
          "2067:    ND_PRINT((ndo, \"invalid len\"));",
          "2068:    break;",
          "2069:   }",
          "2070:                 while (tlen>0) {",
          "2071:                     uint16_t extd_comm;",
          "2073:                     ND_TCHECK_2(tptr);",
          "2074:                     extd_comm=EXTRACT_BE_U_2(tptr);",
          "2076:       ND_PRINT((ndo, \"\\n\\t    %s (0x%04x), Flags [%s]\",",
          "2077:       tok2str(bgp_extd_comm_subtype_values,",
          "2078:           \"unknown extd community typecode\",",
          "2079:           extd_comm),",
          "2080:       extd_comm,",
          "2081:       bittok2str(bgp_extd_comm_flag_values, \"none\", extd_comm)));",
          "2083:                     ND_TCHECK_6(tptr + 2);",
          "2084:                     switch(extd_comm) {",
          "2085:                     case BGP_EXT_COM_RT_0:",
          "2086:                     case BGP_EXT_COM_RO_0:",
          "2087:                     case BGP_EXT_COM_L2VPN_RT_0:",
          "2088:                         ND_PRINT((ndo, \": %u:%u (= %s)\",",
          "2089:                                EXTRACT_BE_U_2(tptr + 2),",
          "2090:                                EXTRACT_BE_U_4(tptr + 4),",
          "2091:                                ipaddr_string(ndo, tptr+4)));",
          "2092:                         break;",
          "2093:                     case BGP_EXT_COM_RT_1:",
          "2094:                     case BGP_EXT_COM_RO_1:",
          "2095:                     case BGP_EXT_COM_L2VPN_RT_1:",
          "2096:                     case BGP_EXT_COM_VRF_RT_IMP:",
          "2097:                         ND_PRINT((ndo, \": %s:%u\",",
          "2098:                                ipaddr_string(ndo, tptr+2),",
          "2099:                                EXTRACT_BE_U_2(tptr + 6)));",
          "2100:                         break;",
          "2101:                     case BGP_EXT_COM_RT_2:",
          "2102:                     case BGP_EXT_COM_RO_2:",
          "2103:    ND_PRINT((ndo, \": %s:%u\",",
          "2104:        as_printf(ndo, astostr, sizeof(astostr),",
          "2105:        EXTRACT_BE_U_4(tptr + 2)), EXTRACT_BE_U_2(tptr + 6)));",
          "2106:    break;",
          "2107:                     case BGP_EXT_COM_LINKBAND:",
          "2108:           bw.i = EXTRACT_BE_U_4(tptr + 2);",
          "2109:                         ND_PRINT((ndo, \": bandwidth: %.3f Mbps\",",
          "2110:                                bw.f*8/1000000));",
          "2111:                         break;",
          "2112:                     case BGP_EXT_COM_VPN_ORIGIN:",
          "2113:                     case BGP_EXT_COM_VPN_ORIGIN2:",
          "2114:                     case BGP_EXT_COM_VPN_ORIGIN3:",
          "2115:                     case BGP_EXT_COM_VPN_ORIGIN4:",
          "2116:                     case BGP_EXT_COM_OSPF_RID:",
          "2117:                     case BGP_EXT_COM_OSPF_RID2:",
          "2118:                         ND_PRINT((ndo, \"%s\", ipaddr_string(ndo, tptr+2)));",
          "2119:                         break;",
          "2120:                     case BGP_EXT_COM_OSPF_RTYPE:",
          "2121:                     case BGP_EXT_COM_OSPF_RTYPE2:",
          "2122:                         ND_PRINT((ndo, \": area:%s, router-type:%s, metric-type:%s%s\",",
          "2123:                                ipaddr_string(ndo, tptr+2),",
          "2124:                                tok2str(bgp_extd_comm_ospf_rtype_values,",
          "2125:        \"unknown (0x%02x)\",",
          "2126:        EXTRACT_U_1((tptr + 6))),",
          "2127:                                (EXTRACT_U_1(tptr + 7) &  BGP_OSPF_RTYPE_METRIC_TYPE) ? \"E2\" : \"\",",
          "2128:                                ((EXTRACT_U_1(tptr + 6) == BGP_OSPF_RTYPE_EXT) || (EXTRACT_U_1(tptr + 6) == BGP_OSPF_RTYPE_NSSA)) ? \"E1\" : \"\"));",
          "2129:                         break;",
          "2130:                     case BGP_EXT_COM_L2INFO:",
          "2131:                         ND_PRINT((ndo, \": %s Control Flags [0x%02x]:MTU %u\",",
          "2132:                                tok2str(l2vpn_encaps_values,",
          "2133:        \"unknown encaps\",",
          "2134:        EXTRACT_U_1((tptr + 2))),",
          "2135:                                EXTRACT_U_1((tptr + 3)),",
          "2136:                                EXTRACT_BE_U_2(tptr + 4)));",
          "2137:                         break;",
          "2138:                     case BGP_EXT_COM_SOURCE_AS:",
          "2139:                         ND_PRINT((ndo, \": AS %u\", EXTRACT_BE_U_2(tptr + 2)));",
          "2140:                         break;",
          "2141:                     default:",
          "2142:                         ND_TCHECK_8(tptr);",
          "2143:                         print_unknown_data(ndo, tptr, \"\\n\\t      \", 8);",
          "2144:                         break;",
          "2145:                     }",
          "2146:                     tlen -=8;",
          "2147:                     tptr +=8;",
          "2148:                 }",
          "2151:         case BGPTYPE_PMSI_TUNNEL:",
          "2152:         {",
          "2153:                 uint8_t tunnel_type, flags;",
          "2155:                 ND_TCHECK_5(tptr);",
          "2156:                 flags = EXTRACT_U_1(tptr);",
          "2157:                 tunnel_type = EXTRACT_U_1(tptr + 1);",
          "2158:                 tlen = len;",
          "2160:                 ND_PRINT((ndo, \"\\n\\t    Tunnel-type %s (%u), Flags [%s], MPLS Label %u\",",
          "2161:                        tok2str(bgp_pmsi_tunnel_values, \"Unknown\", tunnel_type),",
          "2162:                        tunnel_type,",
          "2163:                        bittok2str(bgp_pmsi_flag_values, \"none\", flags),",
          "2164:                        EXTRACT_BE_U_3(tptr + 2)>>4));",
          "2166:                 tptr +=5;",
          "2167:                 tlen -= 5;",
          "2169:                 switch (tunnel_type) {",
          "2171:                 case BGP_PMSI_TUNNEL_PIM_BIDIR:",
          "2172:                     ND_TCHECK_8(tptr);",
          "2173:                     ND_PRINT((ndo, \"\\n\\t      Sender %s, P-Group %s\",",
          "2174:                            ipaddr_string(ndo, tptr),",
          "2175:                            ipaddr_string(ndo, tptr+4)));",
          "2176:                     break;",
          "2178:                 case BGP_PMSI_TUNNEL_PIM_SSM:",
          "2179:                     ND_TCHECK_8(tptr);",
          "2180:                     ND_PRINT((ndo, \"\\n\\t      Root-Node %s, P-Group %s\",",
          "2181:                            ipaddr_string(ndo, tptr),",
          "2182:                            ipaddr_string(ndo, tptr+4)));",
          "2183:                     break;",
          "2184:                 case BGP_PMSI_TUNNEL_INGRESS:",
          "2185:                     ND_TCHECK_4(tptr);",
          "2186:                     ND_PRINT((ndo, \"\\n\\t      Tunnel-Endpoint %s\",",
          "2187:                            ipaddr_string(ndo, tptr)));",
          "2188:                     break;",
          "2190:                 case BGP_PMSI_TUNNEL_LDP_MP2MP:",
          "2191:                     ND_TCHECK_8(tptr);",
          "2192:                     ND_PRINT((ndo, \"\\n\\t      Root-Node %s, LSP-ID 0x%08x\",",
          "2193:                            ipaddr_string(ndo, tptr),",
          "2194:                            EXTRACT_BE_U_4(tptr + 4)));",
          "2195:                     break;",
          "2196:                 case BGP_PMSI_TUNNEL_RSVP_P2MP:",
          "2197:                     ND_TCHECK_8(tptr);",
          "2198:                     ND_PRINT((ndo, \"\\n\\t      Extended-Tunnel-ID %s, P2MP-ID 0x%08x\",",
          "2199:                            ipaddr_string(ndo, tptr),",
          "2200:                            EXTRACT_BE_U_4(tptr + 4)));",
          "2201:                     break;",
          "2202:                 default:",
          "2203:                     if (ndo->ndo_vflag <= 1) {",
          "2204:                         print_unknown_data(ndo, tptr, \"\\n\\t      \", tlen);",
          "2205:                     }",
          "2206:                 }",
          "2209:  case BGPTYPE_AIGP:",
          "2210:  {",
          "2211:   uint8_t type;",
          "2212:   uint16_t length;",
          "2214:   tlen = len;",
          "2216:   while (tlen >= 3) {",
          "2218:       ND_TCHECK_3(tptr);",
          "2220:       type = EXTRACT_U_1(tptr);",
          "2221:       length = EXTRACT_BE_U_2(tptr + 1);",
          "2222:       tptr += 3;",
          "2223:       tlen -= 3;",
          "2225:       ND_PRINT((ndo, \"\\n\\t    %s TLV (%u), length %u\",",
          "2226:          tok2str(bgp_aigp_values, \"Unknown\", type),",
          "2227:          type, length));",
          "2229:       if (length < 3)",
          "2230:    goto trunc;",
          "2231:       length -= 3;",
          "2236:       ND_TCHECK_LEN(tptr + 3, length);",
          "2238:       switch (type) {",
          "2240:       case BGP_AIGP_TLV:",
          "2241:           if (length < 8)",
          "2242:               goto trunc;",
          "2243:    ND_PRINT((ndo, \", metric %\" PRIu64,",
          "2244:       EXTRACT_BE_U_8(tptr)));",
          "2245:    break;",
          "2247:       default:",
          "2248:    if (ndo->ndo_vflag <= 1) {",
          "2249:        print_unknown_data(ndo, tptr,\"\\n\\t      \", length);",
          "2250:    }",
          "2251:       }",
          "2253:       tptr += length;",
          "2254:       tlen -= length;",
          "2255:   }",
          "2256:   break;",
          "2257:  }",
          "2258:         case BGPTYPE_ATTR_SET:",
          "2259:                 ND_TCHECK_4(tptr);",
          "2260:                 if (len < 4)",
          "2261:                  goto trunc;",
          "2262:   ND_PRINT((ndo, \"\\n\\t    Origin AS: %s\",",
          "2263:       as_printf(ndo, astostr, sizeof(astostr), EXTRACT_BE_U_4(tptr))));",
          "2264:   tptr+=4;",
          "2265:                 len -=4;",
          "2267:                 while (len) {",
          "2268:                     u_int aflags, alenlen, alen;",
          "2270:                     ND_TCHECK_2(tptr);",
          "2271:                     if (len < 2)",
          "2272:                         goto trunc;",
          "2273:                     aflags = EXTRACT_U_1(tptr);",
          "2274:                     atype = EXTRACT_U_1(tptr + 1);",
          "2275:                     tptr += 2;",
          "2276:                     len -= 2;",
          "2277:                     alenlen = bgp_attr_lenlen(aflags, tptr);",
          "2278:                     ND_TCHECK_LEN(tptr, alenlen);",
          "2279:                     if (len < alenlen)",
          "2280:                         goto trunc;",
          "2281:                     alen = bgp_attr_len(aflags, tptr);",
          "2282:                     tptr += alenlen;",
          "2283:                     len -= alenlen;",
          "2285:                     ND_PRINT((ndo, \"\\n\\t      %s (%u), length: %u\",",
          "2286:                            tok2str(bgp_attr_values,",
          "2287:                                       \"Unknown Attribute\", atype),",
          "2288:                            atype,",
          "2289:                            alen));",
          "2291:                     if (aflags) {",
          "2292:                         ND_PRINT((ndo, \", Flags [%s%s%s%s\",",
          "2293:                                aflags & 0x80 ? \"O\" : \"\",",
          "2294:                                aflags & 0x40 ? \"T\" : \"\",",
          "2295:                                aflags & 0x20 ? \"P\" : \"\",",
          "2296:                                aflags & 0x10 ? \"E\" : \"\"));",
          "2297:                         if (aflags & 0xf)",
          "2298:                             ND_PRINT((ndo, \"+%x\", aflags & 0xf));",
          "2299:                         ND_PRINT((ndo, \"]: \"));",
          "2300:                     }",
          "2302:                     if (!bgp_attr_print(ndo, atype, tptr, alen))",
          "2303:                         return 0;",
          "2304:                     tptr += alen;",
          "2305:                     len -= alen;",
          "2306:   }",
          "2309:  case BGPTYPE_LARGE_COMMUNITY:",
          "2310:   if (len == 0 || len % 12) {",
          "2311:    ND_PRINT((ndo, \"invalid len\"));",
          "2312:    break;",
          "2313:   }",
          "2314:   ND_PRINT((ndo, \"\\n\\t    \"));",
          "2315:   while (len > 0) {",
          "2316:    ND_TCHECK_LEN(tptr, 12);",
          "2317:    ND_PRINT((ndo, \"%u:%u:%u%s\",",
          "2318:      EXTRACT_BE_U_4(tptr),",
          "2319:      EXTRACT_BE_U_4(tptr + 4),",
          "2320:      EXTRACT_BE_U_4(tptr + 8),",
          "2321:      (len > 12) ? \", \" : \"\"));",
          "2322:                         tptr += 12;",
          "2323:                         len -= 12;",
          "2324:   }",
          "2325:   break;",
          "2326:  default:",
          "2327:      ND_TCHECK_LEN(pptr, len);",
          "2329:             if (ndo->ndo_vflag <= 1)",
          "2330:                 print_unknown_data(ndo, pptr, \"\\n\\t    \", len);",
          "2332:  }",
          "2334:             ND_TCHECK_LEN(pptr, len);",
          "2336:         }",
          "2337:         return 1;",
          "2340:         return 0;",
          "2347:  u_int cap_type, cap_len, tcap_len, cap_offset;",
          "2348:         u_int i = 0;",
          "2350:         while (i < caps_len) {",
          "2351:                 ND_TCHECK_LEN(opt + i, BGP_CAP_HEADER_SIZE);",
          "2352:                 cap_type=EXTRACT_U_1(opt + i);",
          "2353:                 cap_len=EXTRACT_U_1(opt + i + 1);",
          "2354:                 tcap_len=cap_len;",
          "2355:                 ND_PRINT((ndo, \"\\n\\t      %s (%u), length: %u\",",
          "2356:                        tok2str(bgp_capcode_values, \"Unknown\",",
          "2357:                                   cap_type),",
          "2358:                        cap_type,",
          "2359:                        cap_len));",
          "2360:                 ND_TCHECK_LEN(opt + 2 + i, cap_len);",
          "2361:                 switch (cap_type) {",
          "2362:                 case BGP_CAPCODE_MP:",
          "2363:                     ND_PRINT((ndo, \"\\n\\t\\tAFI %s (%u), SAFI %s (%u)\",",
          "2364:                            tok2str(af_values, \"Unknown\",",
          "2365:                                       EXTRACT_BE_U_2(opt + i + 2)),",
          "2366:                            EXTRACT_BE_U_2(opt + i + 2),",
          "2367:                            tok2str(bgp_safi_values, \"Unknown\",",
          "2368:                                       EXTRACT_U_1(opt + i + 5)),",
          "2369:                            EXTRACT_U_1(opt + i + 5)));",
          "2370:                     break;",
          "2371:                 case BGP_CAPCODE_RESTART:",
          "2372:                     ND_PRINT((ndo, \"\\n\\t\\tRestart Flags: [%s], Restart Time %us\",",
          "2373:                            ((EXTRACT_U_1(opt + i + 2))&0x80) ? \"R\" : \"none\",",
          "2374:                            EXTRACT_BE_U_2(opt + i + 2)&0xfff));",
          "2375:                     tcap_len-=2;",
          "2376:                     cap_offset=4;",
          "2377:                     while(tcap_len>=4) {",
          "2378:                         ND_PRINT((ndo, \"\\n\\t\\t  AFI %s (%u), SAFI %s (%u), Forwarding state preserved: %s\",",
          "2379:                                tok2str(af_values,\"Unknown\",",
          "2380:                                           EXTRACT_BE_U_2(opt + i + cap_offset)),",
          "2381:                                EXTRACT_BE_U_2(opt + i + cap_offset),",
          "2382:                                tok2str(bgp_safi_values,\"Unknown\",",
          "2383:                                           EXTRACT_U_1(opt + i + cap_offset + 2)),",
          "2384:                                EXTRACT_U_1(opt + (i + cap_offset + 2)),",
          "2385:                                ((EXTRACT_U_1(opt + (i + cap_offset + 3)))&0x80) ? \"yes\" : \"no\" ));",
          "2386:                         tcap_len-=4;",
          "2387:                         cap_offset+=4;",
          "2388:                     }",
          "2389:                     break;",
          "2390:                 case BGP_CAPCODE_RR:",
          "2391:                 case BGP_CAPCODE_RR_CISCO:",
          "2392:                     break;",
          "2393:                 case BGP_CAPCODE_AS_NEW:",
          "2398:                     if (cap_len == 4) {",
          "2399:                         ND_PRINT((ndo, \"\\n\\t\\t 4 Byte AS %s\",",
          "2400:                             as_printf(ndo, astostr, sizeof(astostr),",
          "2401:                             EXTRACT_BE_U_4(opt + i + 2))));",
          "2402:                     }",
          "2403:                     break;",
          "2404:                 case BGP_CAPCODE_ADD_PATH:",
          "2405:                     cap_offset=2;",
          "2406:                     if (tcap_len == 0) {",
          "2408:                         break;",
          "2409:                     }",
          "2410:                     while (tcap_len > 0) {",
          "2411:                         if (tcap_len < 4) {",
          "2412:                             ND_PRINT((ndo, \"\\n\\t\\t(invalid)\"));",
          "2413:                             break;",
          "2414:                         }",
          "2415:                         ND_PRINT((ndo, \"\\n\\t\\tAFI %s (%u), SAFI %s (%u), Send/Receive: %s\",",
          "2416:                                   tok2str(af_values,\"Unknown\",EXTRACT_BE_U_2(opt + i + cap_offset)),",
          "2417:                                   EXTRACT_BE_U_2(opt + i + cap_offset),",
          "2418:                                   tok2str(bgp_safi_values,\"Unknown\",EXTRACT_U_1(opt + i + cap_offset + 2)),",
          "2419:                                   EXTRACT_U_1(opt + (i + cap_offset + 2)),",
          "2420:                                   tok2str(bgp_add_path_recvsend,\"Bogus (0x%02x)\",EXTRACT_U_1(opt + i + cap_offset + 3))",
          "2421:                         ));",
          "2422:                         tcap_len-=4;",
          "2423:                         cap_offset+=4;",
          "2424:                     }",
          "2425:                     break;",
          "2426:                 default:",
          "2427:                     ND_PRINT((ndo, \"\\n\\t\\tno decoder for Capability %u\",",
          "2428:                            cap_type));",
          "2429:                     if (ndo->ndo_vflag <= 1)",
          "2430:                         print_unknown_data(ndo, opt + i + 2, \"\\n\\t\\t\",",
          "2431:         cap_len);",
          "2434:                 if (ndo->ndo_vflag > 1 && cap_len > 0) {",
          "2435:                     print_unknown_data(ndo, opt + i + 2, \"\\n\\t\\t\", cap_len);",
          "2436:                 }",
          "2437:                 i += BGP_CAP_HEADER_SIZE + cap_len;",
          "2439:         return;",
          "2442:  ND_PRINT((ndo, \"[|BGP]\"));",
          "2449:  const struct bgp_open *bgp_open_header;",
          "2450:  u_int optslen;",
          "2451:  const struct bgp_opt *bgpopt;",
          "2452:  const u_char *opt;",
          "2453:  u_int i;",
          "2455:  ND_TCHECK_LEN(dat, BGP_OPEN_SIZE);",
          "2456:  if (length < BGP_OPEN_SIZE)",
          "2457:   goto trunc;",
          "2459:  bgp_open_header = (const struct bgp_open *)dat;",
          "2461:  ND_PRINT((ndo, \"\\n\\t  Version %u, \",",
          "2462:      EXTRACT_U_1(bgp_open_header->bgpo_version)));",
          "2463:  ND_PRINT((ndo, \"my AS %s, \",",
          "2464:      as_printf(ndo, astostr, sizeof(astostr), EXTRACT_BE_U_2(bgp_open_header->bgpo_myas))));",
          "2465:  ND_PRINT((ndo, \"Holdtime %us, \",",
          "2466:      EXTRACT_BE_U_2(bgp_open_header->bgpo_holdtime)));",
          "2467:  ND_PRINT((ndo, \"ID %s\", ipaddr_string(ndo, &bgp_open_header->bgpo_id)));",
          "2468:  optslen = EXTRACT_U_1(bgp_open_header->bgpo_optlen);",
          "2469:  ND_PRINT((ndo, \"\\n\\t  Optional parameters, length: %u\", optslen));",
          "2471:  opt = dat + BGP_OPEN_SIZE;",
          "2472:  length -= BGP_OPEN_SIZE;",
          "2474:  i = 0;",
          "2475:  while (i < optslen) {",
          "2476:   uint8_t opt_type, opt_len;",
          "2478:   ND_TCHECK_LEN(opt + i, BGP_OPT_SIZE);",
          "2479:   if (length < BGP_OPT_SIZE + i)",
          "2480:    goto trunc;",
          "2481:   bgpopt = (const struct bgp_opt *)(opt + i);",
          "2482:   opt_type = EXTRACT_U_1(bgpopt->bgpopt_type);",
          "2483:   opt_len = EXTRACT_U_1(bgpopt->bgpopt_len);",
          "2484:   if (BGP_OPT_SIZE + i + opt_len > optslen) {",
          "2485:    ND_PRINT((ndo, \"\\n\\t     Option %u, length: %u, goes past the end of the options\",",
          "2486:        opt_type, opt_len));",
          "2487:    break;",
          "2488:   }",
          "2490:   ND_PRINT((ndo, \"\\n\\t    Option %s (%u), length: %u\",",
          "2491:          tok2str(bgp_opt_values,\"Unknown\",opt_type),",
          "2492:          opt_type,",
          "2493:          opt_len));",
          "2496:   switch(opt_type) {",
          "2498:   case BGP_OPT_CAP:",
          "2499:    bgp_capabilities_print(ndo, opt + BGP_OPT_SIZE + i,",
          "2500:             opt_len);",
          "2501:    break;",
          "2503:   case BGP_OPT_AUTH:",
          "2504:   default:",
          "2505:          ND_PRINT((ndo, \"\\n\\t      no decoder for option %u\",",
          "2506:       opt_type));",
          "2507:          break;",
          "2508:   }",
          "2509:   i += BGP_OPT_SIZE + opt_len;",
          "2510:  }",
          "2511:  return;",
          "2513:  ND_PRINT((ndo, \"[|BGP]\"));",
          "2518:                  const u_char *dat, int length)",
          "2520:  const struct bgp *bgp_header;",
          "2521:  const u_char *p;",
          "2522:  int withdrawn_routes_len;",
          "2523:  int len;",
          "2524:  int i;",
          "2526:  ND_TCHECK_LEN(dat, BGP_SIZE);",
          "2527:  if (length < BGP_SIZE)",
          "2528:   goto trunc;",
          "2529:  bgp_header = (const struct bgp *)dat;",
          "2530:  p = dat + BGP_SIZE;",
          "2531:  length -= BGP_SIZE;",
          "2534:  ND_TCHECK_2(p);",
          "2535:  if (length < 2)",
          "2536:   goto trunc;",
          "2537:  withdrawn_routes_len = EXTRACT_BE_U_2(p);",
          "2538:  p += 2;",
          "2539:  length -= 2;",
          "2540:  if (withdrawn_routes_len) {",
          "2546:   ND_TCHECK_LEN(p, withdrawn_routes_len);",
          "2547:   if (length < withdrawn_routes_len)",
          "2548:    goto trunc;",
          "2549:   ND_PRINT((ndo, \"\\n\\t  Withdrawn routes: %d bytes\", withdrawn_routes_len));",
          "2550:   p += withdrawn_routes_len;",
          "2551:   length -= withdrawn_routes_len;",
          "2552:  }",
          "2554:  ND_TCHECK_2(p);",
          "2555:  if (length < 2)",
          "2556:   goto trunc;",
          "2557:  len = EXTRACT_BE_U_2(p);",
          "2558:  p += 2;",
          "2559:  length -= 2;",
          "2561:         if (withdrawn_routes_len == 0 && len == 0 && length == 0) {",
          "2563:             ND_PRINT((ndo, \"\\n\\t  End-of-Rib Marker (empty NLRI)\"));",
          "2564:             return;",
          "2567:  if (len) {",
          "2569:   while (len) {",
          "2570:    int aflags, atype, alenlen, alen;",
          "2572:    ND_TCHECK_2(p);",
          "2573:    if (len < 2)",
          "2574:        goto trunc;",
          "2575:    if (length < 2)",
          "2576:        goto trunc;",
          "2577:    aflags = EXTRACT_U_1(p);",
          "2578:    atype = EXTRACT_U_1(p + 1);",
          "2579:    p += 2;",
          "2580:    len -= 2;",
          "2581:    length -= 2;",
          "2582:    alenlen = bgp_attr_lenlen(aflags, p);",
          "2583:    ND_TCHECK_LEN(p, alenlen);",
          "2584:    if (len < alenlen)",
          "2585:        goto trunc;",
          "2586:    if (length < alenlen)",
          "2587:        goto trunc;",
          "2588:    alen = bgp_attr_len(aflags, p);",
          "2589:    p += alenlen;",
          "2590:    len -= alenlen;",
          "2591:    length -= alenlen;",
          "2593:    ND_PRINT((ndo, \"\\n\\t  %s (%u), length: %u\",",
          "2594:                               tok2str(bgp_attr_values, \"Unknown Attribute\",",
          "2595:       atype),",
          "2596:                               atype,",
          "2597:                               alen));",
          "2599:    if (aflags) {",
          "2600:     ND_PRINT((ndo, \", Flags [%s%s%s%s\",",
          "2601:      aflags & 0x80 ? \"O\" : \"\",",
          "2602:      aflags & 0x40 ? \"T\" : \"\",",
          "2603:      aflags & 0x20 ? \"P\" : \"\",",
          "2604:      aflags & 0x10 ? \"E\" : \"\"));",
          "2605:     if (aflags & 0xf)",
          "2606:      ND_PRINT((ndo, \"+%x\", aflags & 0xf));",
          "2607:     ND_PRINT((ndo, \"]: \"));",
          "2608:    }",
          "2609:    if (len < alen)",
          "2610:     goto trunc;",
          "2611:    if (length < alen)",
          "2612:     goto trunc;",
          "2613:    if (!bgp_attr_print(ndo, atype, p, alen))",
          "2614:     goto trunc;",
          "2615:    p += alen;",
          "2616:    len -= alen;",
          "2617:    length -= alen;",
          "2618:   }",
          "2619:  }",
          "2621:  if (length) {",
          "2630:   ND_PRINT((ndo, \"\\n\\t  Updated routes:\"));",
          "2631:   while (length) {",
          "2632:    char buf[MAXHOSTNAMELEN + 100];",
          "2633:    i = decode_prefix4(ndo, p, length, buf, sizeof(buf));",
          "2634:    if (i == -1) {",
          "2635:     ND_PRINT((ndo, \"\\n\\t    (illegal prefix length)\"));",
          "2636:     break;",
          "2637:    } else if (i == -2)",
          "2638:     goto trunc;",
          "2639:    else if (i == -3)",
          "2641:    else {",
          "2642:     ND_PRINT((ndo, \"\\n\\t    %s\", buf));",
          "2643:     p += i;",
          "2644:     length -= i;",
          "2645:    }",
          "2646:   }",
          "2647:  }",
          "2648:  return;",
          "2650:  ND_PRINT((ndo, \"[|BGP]\"));",
          "2655:                        const u_char *dat, int length)",
          "2657:  const struct bgp_notification *bgp_notification_header;",
          "2658:  const u_char *tptr;",
          "2659:  uint8_t bgpn_major, bgpn_minor;",
          "2660:  uint8_t shutdown_comm_length;",
          "2661:  uint8_t remainder_offset;",
          "2663:  ND_TCHECK_LEN(dat, BGP_NOTIFICATION_SIZE);",
          "2664:         if (length<BGP_NOTIFICATION_SIZE)",
          "2665:             return;",
          "2667:  bgp_notification_header = (const struct bgp_notification *)dat;",
          "2668:  bgpn_major = EXTRACT_U_1(bgp_notification_header->bgpn_major);",
          "2669:  bgpn_minor = EXTRACT_U_1(bgp_notification_header->bgpn_minor);",
          "2671:  ND_PRINT((ndo, \", %s (%u)\",",
          "2672:         tok2str(bgp_notify_major_values, \"Unknown Error\",",
          "2673:      bgpn_major),",
          "2674:         bgpn_major));",
          "2676:         switch (bgpn_major) {",
          "2678:         case BGP_NOTIFY_MAJOR_MSG:",
          "2679:             ND_PRINT((ndo, \", subcode %s (%u)\",",
          "2680:      tok2str(bgp_notify_minor_msg_values, \"Unknown\",",
          "2681:          bgpn_minor),",
          "2682:      bgpn_minor));",
          "2683:             break;",
          "2684:         case BGP_NOTIFY_MAJOR_OPEN:",
          "2685:             ND_PRINT((ndo, \", subcode %s (%u)\",",
          "2686:      tok2str(bgp_notify_minor_open_values, \"Unknown\",",
          "2687:          bgpn_minor),",
          "2688:      bgpn_minor));",
          "2689:             break;",
          "2690:         case BGP_NOTIFY_MAJOR_UPDATE:",
          "2691:             ND_PRINT((ndo, \", subcode %s (%u)\",",
          "2692:      tok2str(bgp_notify_minor_update_values, \"Unknown\",",
          "2693:          bgpn_minor),",
          "2694:      bgpn_minor));",
          "2695:             break;",
          "2696:         case BGP_NOTIFY_MAJOR_FSM:",
          "2697:             ND_PRINT((ndo, \" subcode %s (%u)\",",
          "2698:      tok2str(bgp_notify_minor_fsm_values, \"Unknown\",",
          "2699:          bgpn_minor),",
          "2700:      bgpn_minor));",
          "2701:             break;",
          "2702:         case BGP_NOTIFY_MAJOR_CAP:",
          "2703:             ND_PRINT((ndo, \" subcode %s (%u)\",",
          "2704:      tok2str(bgp_notify_minor_cap_values, \"Unknown\",",
          "2705:          bgpn_minor),",
          "2706:      bgpn_minor));",
          "2707:             break;",
          "2708:         case BGP_NOTIFY_MAJOR_CEASE:",
          "2709:             ND_PRINT((ndo, \", subcode %s (%u)\",",
          "2710:      tok2str(bgp_notify_minor_cease_values, \"Unknown\",",
          "2711:          bgpn_minor),",
          "2712:      bgpn_minor));",
          "2717:      if(bgpn_minor == BGP_NOTIFY_MINOR_CEASE_MAXPRFX && length >= BGP_NOTIFICATION_SIZE + 7) {",
          "2718:   tptr = dat + BGP_NOTIFICATION_SIZE;",
          "2719:   ND_TCHECK_7(tptr);",
          "2720:   ND_PRINT((ndo, \", AFI %s (%u), SAFI %s (%u), Max Prefixes: %u\",",
          "2721:          tok2str(af_values, \"Unknown\",",
          "2722:       EXTRACT_BE_U_2(tptr)),",
          "2723:          EXTRACT_BE_U_2(tptr),",
          "2724:          tok2str(bgp_safi_values, \"Unknown\", EXTRACT_U_1((tptr + 2))),",
          "2725:          EXTRACT_U_1((tptr + 2)),",
          "2726:          EXTRACT_BE_U_4(tptr + 3)));",
          "2727:      }",
          "2732:      if ((bgpn_minor == BGP_NOTIFY_MINOR_CEASE_SHUT ||",
          "2733:   bgpn_minor == BGP_NOTIFY_MINOR_CEASE_RESET) &&",
          "2734:   length >= BGP_NOTIFICATION_SIZE + 1) {",
          "2735:       tptr = dat + BGP_NOTIFICATION_SIZE;",
          "2736:       ND_TCHECK_1(tptr);",
          "2737:       shutdown_comm_length = EXTRACT_U_1(tptr);",
          "2738:       remainder_offset = 0;",
          "2740:       if (shutdown_comm_length > BGP_NOTIFY_MINOR_CEASE_ADMIN_SHUTDOWN_LEN ||",
          "2741:    shutdown_comm_length > length - (BGP_NOTIFICATION_SIZE + 1)) {",
          "2742:        ND_PRINT((ndo, \", invalid Shutdown Communication length\"));",
          "2743:       }",
          "2744:       else if (shutdown_comm_length == 0) {",
          "2745:        ND_PRINT((ndo, \", empty Shutdown Communication\"));",
          "2746:        remainder_offset += 1;",
          "2747:       }",
          "2749:       else {",
          "2750:        ND_TCHECK_LEN(tptr + 1, shutdown_comm_length);",
          "2751:        ND_PRINT((ndo, \", Shutdown Communication (length: %u): \\\"\", shutdown_comm_length));",
          "2752:        (void)fn_printn(ndo, tptr+1, shutdown_comm_length, NULL);",
          "2753:        ND_PRINT((ndo, \"\\\"\"));",
          "2754:        remainder_offset += shutdown_comm_length + 1;",
          "2755:       }",
          "2757:       if(length - (remainder_offset + BGP_NOTIFICATION_SIZE) > 0) {",
          "2758:        ND_PRINT((ndo, \", Data: (length: %u)\", length - (remainder_offset + BGP_NOTIFICATION_SIZE)));",
          "2759:        hex_print(ndo, \"\\n\\t\\t\", tptr + remainder_offset, length - (remainder_offset + BGP_NOTIFICATION_SIZE));",
          "2760:       }",
          "2761:      }",
          "2762:      break;",
          "2763:  default:",
          "2764:             break;",
          "2767:  return;",
          "2769:  ND_PRINT((ndo, \"[|BGP]\"));",
          "2774:                         const u_char *pptr, int len)",
          "2776:         const struct bgp_route_refresh *bgp_route_refresh_header;",
          "2778:  ND_TCHECK_LEN(pptr, BGP_ROUTE_REFRESH_SIZE);",
          "2781:         if (len<BGP_ROUTE_REFRESH_SIZE)",
          "2782:             return;",
          "2784:         bgp_route_refresh_header = (const struct bgp_route_refresh *)pptr;",
          "2786:         ND_PRINT((ndo, \"\\n\\t  AFI %s (%u), SAFI %s (%u)\",",
          "2787:                tok2str(af_values,\"Unknown\",",
          "2788:      EXTRACT_BE_U_2(bgp_route_refresh_header->afi)),",
          "2789:                EXTRACT_BE_U_2(bgp_route_refresh_header->afi),",
          "2790:                tok2str(bgp_safi_values,\"Unknown\",",
          "2791:      EXTRACT_U_1(bgp_route_refresh_header->safi)),",
          "2792:                EXTRACT_U_1(bgp_route_refresh_header->safi)));",
          "2794:         if (ndo->ndo_vflag > 1) {",
          "2795:             ND_TCHECK_LEN(pptr, len);",
          "2796:             print_unknown_data(ndo, pptr, \"\\n\\t  \", len);",
          "2797:         }",
          "2799:         return;",
          "2801:  ND_PRINT((ndo, \"[|BGP]\"));",
          "2806:                  const u_char *dat, u_int length)",
          "2808:  const struct bgp *bgp_header;",
          "2809:  uint8_t bgp_type;",
          "2811:  ND_TCHECK_LEN(dat, BGP_SIZE);",
          "2812:  bgp_header = (const struct bgp *)dat;",
          "2813:  bgp_type = EXTRACT_U_1(bgp_header->bgp_type);",
          "2815:  ND_PRINT((ndo, \"\\n\\t%s Message (%u), length: %u\",",
          "2816:                tok2str(bgp_msg_values, \"Unknown\", bgp_type),",
          "2817:                bgp_type,",
          "2818:                length));",
          "2820:  switch (bgp_type) {",
          "2821:  case BGP_OPEN:",
          "2822:   bgp_open_print(ndo, dat, length);",
          "2823:   break;",
          "2824:  case BGP_UPDATE:",
          "2825:   bgp_update_print(ndo, dat, length);",
          "2826:   break;",
          "2827:  case BGP_NOTIFICATION:",
          "2828:   bgp_notification_print(ndo, dat, length);",
          "2829:   break;",
          "2830:         case BGP_KEEPALIVE:",
          "2831:                 break;",
          "2832:         case BGP_ROUTE_REFRESH:",
          "2833:                 bgp_route_refresh_print(ndo, dat, length);",
          "2834:                 break;",
          "2835:         default:",
          "2837:                 ND_TCHECK_LEN(dat, length);",
          "2838:                 ND_PRINT((ndo, \"\\n\\t  no Message %u decoder\", bgp_type));",
          "2839:                 print_unknown_data(ndo, dat, \"\\n\\t  \", length);",
          "2840:                 break;",
          "2841:  }",
          "2842:  return 1;",
          "2844:  ND_PRINT((ndo, \"[|BGP]\"));",
          "2845:  return 0;",
          "2850:           const u_char *dat, int length)",
          "2852:  const u_char *p;",
          "2853:  const u_char *ep;",
          "2854:  const u_char *start;",
          "2855:  const u_char marker[] = {",
          "2856:   0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,",
          "2857:   0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,",
          "2858:  };",
          "2859:  const struct bgp *bgp_header;",
          "2860:  uint16_t hlen;",
          "2862:  ep = dat + length;",
          "2863:  if (ndo->ndo_snapend < dat + length)",
          "2864:   ep = ndo->ndo_snapend;",
          "2866:  ND_PRINT((ndo, \": BGP\"));",
          "2871:  p = dat;",
          "2872:  start = p;",
          "2873:  while (p < ep) {",
          "2874:   if (!ND_TTEST_1(p))",
          "2875:    break;",
          "2876:   if (EXTRACT_U_1(p) != 0xff) {",
          "2877:    p++;",
          "2878:    continue;",
          "2879:   }",
          "2881:   if (!ND_TTEST_LEN(p, sizeof(marker)))",
          "2882:    break;",
          "2883:   if (memcmp(p, marker, sizeof(marker)) != 0) {",
          "2884:    p++;",
          "2885:    continue;",
          "2886:   }",
          "2889:   ND_TCHECK_LEN(p, BGP_SIZE);",
          "2890:   bgp_header = (const struct bgp *)p;",
          "2892:   if (start != p)",
          "2893:    ND_PRINT((ndo, \" [|BGP]\"));",
          "2895:   hlen = EXTRACT_BE_U_2(bgp_header->bgp_len);",
          "2896:   if (hlen < BGP_SIZE) {",
          "2897:    ND_PRINT((ndo, \"\\n[|BGP Bogus header length %u < %u]\", hlen,",
          "2898:        BGP_SIZE));",
          "2899:    break;",
          "2900:   }",
          "2902:   if (ND_TTEST_LEN(p, hlen)) {",
          "2903:    if (!bgp_pdu_print(ndo, p, hlen))",
          "2904:     return;",
          "2905:    p += hlen;",
          "2906:    start = p;",
          "2907:   } else {",
          "2908:    ND_PRINT((ndo, \"\\n[|BGP %s]\",",
          "2909:           tok2str(bgp_msg_values,",
          "2910:        \"Unknown Message Type\",",
          "2911:        EXTRACT_U_1(bgp_header->bgp_type))));",
          "2912:    break;",
          "2913:   }",
          "2914:  }",
          "2916:  return;",
          "2919:  ND_PRINT((ndo, \" [|BGP]\"));",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "e83dfd9b161eeb2bde1a42b5e3f2fc83639d54f3",
      "candidate_info": {
        "commit_hash": "e83dfd9b161eeb2bde1a42b5e3f2fc83639d54f3",
        "repo": "the-tcpdump-group/tcpdump",
        "commit_url": "https://github.com/the-tcpdump-group/tcpdump/commit/e83dfd9b161eeb2bde1a42b5e3f2fc83639d54f3",
        "files": [
          "print-bgp.c",
          "print-hncp.c",
          "print-ip6opts.c",
          "print-mobility.c",
          "print-pim.c",
          "print-sl.c",
          "print-smb.c",
          "print-vjc.c",
          "smbutil.c"
        ],
        "message": "Simplify some expressions\n\nThis will also help some future scripted code updates.",
        "before_after_code_files": [
          "print-bgp.c||print-bgp.c",
          "print-hncp.c||print-hncp.c",
          "print-ip6opts.c||print-ip6opts.c",
          "print-mobility.c||print-mobility.c",
          "print-pim.c||print-pim.c",
          "print-sl.c||print-sl.c",
          "print-smb.c||print-smb.c",
          "print-vjc.c||print-vjc.c",
          "smbutil.c||smbutil.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "print-bgp.c||print-bgp.c"
          ],
          "candidate": [
            "print-bgp.c||print-bgp.c"
          ]
        }
      },
      "candidate_diff": {
        "print-bgp.c||print-bgp.c": [
          "File: print-bgp.c -> print-bgp.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "549:  plenbytes = (plen + 7) / 8;",
          "550:  ND_TCHECK2(pptr[1], plenbytes);",
          "551:  ITEMCHECK(plenbytes);",
          "553:  if (plen % 8) {",
          "554:   ((u_char *)&addr)[plenbytes - 1] &=",
          "555:    ((0xff00 >> (plen % 8)) & 0xff);",
          "",
          "[Removed Lines]",
          "552:  memcpy(&addr, &pptr[1], plenbytes);",
          "",
          "[Added Lines]",
          "552:  memcpy(&addr, pptr + 1, plenbytes);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "597:  plenbytes = (plen + 7) / 8;",
          "598:  ND_TCHECK2(pptr[4], plenbytes);",
          "599:  ITEMCHECK(plenbytes);",
          "601:  if (plen % 8) {",
          "602:   ((u_char *)&addr)[plenbytes - 1] &=",
          "603:    ((0xff00 >> (plen % 8)) & 0xff);",
          "",
          "[Removed Lines]",
          "600:  memcpy(&addr, &pptr[4], plenbytes);",
          "",
          "[Added Lines]",
          "600:  memcpy(&addr, pptr + 4, plenbytes);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "802:  memset(&route_target, 0, sizeof(route_target));",
          "803:  ND_TCHECK2(pptr[5], (plen + 7) / 8);",
          "806:  if (plen % 8) {",
          "807:   ((u_char *)&route_target)[(plen + 7) / 8 - 1] &=",
          "",
          "[Removed Lines]",
          "804:  memcpy(&route_target, &pptr[5], (plen + 7) / 8);",
          "",
          "[Added Lines]",
          "804:  memcpy(&route_target, pptr + 5, (plen + 7) / 8);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "838:  memset(&addr, 0, sizeof(addr));",
          "839:  ND_TCHECK2(pptr[12], (plen + 7) / 8);",
          "841:  if (plen % 8) {",
          "842:   ((u_char *)&addr)[(plen + 7) / 8 - 1] &=",
          "843:    ((0xff00 >> (plen % 8)) & 0xff);",
          "",
          "[Removed Lines]",
          "840:  memcpy(&addr, &pptr[12], (plen + 7) / 8);",
          "",
          "[Added Lines]",
          "840:  memcpy(&addr, pptr + 12, (plen + 7) / 8);",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1147:  plenbytes = (plen + 7) / 8;",
          "1148:  ND_TCHECK2(pd[1], plenbytes);",
          "1149:  ITEMCHECK(plenbytes);",
          "1151:  if (plen % 8) {",
          "1152:   addr.s6_addr[plenbytes - 1] &=",
          "1153:    ((0xff00 >> (plen % 8)) & 0xff);",
          "",
          "[Removed Lines]",
          "1150:  memcpy(&addr, &pd[1], plenbytes);",
          "",
          "[Added Lines]",
          "1150:  memcpy(&addr, pd + 1, plenbytes);",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "1186:  memset(&addr, 0, sizeof(addr));",
          "1187:  plenbytes = (plen + 7) / 8;",
          "1188:  ND_TCHECK2(pptr[4], plenbytes);",
          "1190:  if (plen % 8) {",
          "1191:   addr.s6_addr[plenbytes - 1] &=",
          "1192:    ((0xff00 >> (plen % 8)) & 0xff);",
          "",
          "[Removed Lines]",
          "1189:  memcpy(&addr, &pptr[4], plenbytes);",
          "",
          "[Added Lines]",
          "1189:  memcpy(&addr, pptr + 4, plenbytes);",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "1228:  memset(&addr, 0, sizeof(addr));",
          "1229:  ND_TCHECK2(pptr[12], (plen + 7) / 8);",
          "1231:  if (plen % 8) {",
          "1232:   addr.s6_addr[(plen + 7) / 8 - 1] &=",
          "1233:    ((0xff00 >> (plen % 8)) & 0xff);",
          "",
          "[Removed Lines]",
          "1230:  memcpy(&addr, &pptr[12], (plen + 7) / 8);",
          "",
          "[Added Lines]",
          "1230:  memcpy(&addr, pptr + 12, (plen + 7) / 8);",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "1262:  memset(&addr, 0, sizeof(addr));",
          "1263:  ND_TCHECK2(pptr[4], (plen + 7) / 8);",
          "1265:  if (plen % 8) {",
          "1266:   addr[(plen + 7) / 8 - 1] &=",
          "1267:    ((0xff00 >> (plen % 8)) & 0xff);",
          "",
          "[Removed Lines]",
          "1264:  memcpy(&addr, &pptr[4], (plen + 7) / 8);",
          "",
          "[Added Lines]",
          "1264:  memcpy(&addr, pptr + 4, (plen + 7) / 8);",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "1297:  memset(&addr, 0, sizeof(addr));",
          "1298:  ND_TCHECK2(pptr[12], (plen + 7) / 8);",
          "1300:  if (plen % 8) {",
          "1301:   addr[(plen + 7) / 8 - 1] &=",
          "1302:    ((0xff00 >> (plen % 8)) & 0xff);",
          "",
          "[Removed Lines]",
          "1299:  memcpy(&addr, &pptr[12], (plen + 7) / 8);",
          "",
          "[Added Lines]",
          "1299:  memcpy(&addr, pptr + 12, (plen + 7) / 8);",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "2425:                     ND_PRINT((ndo, \"\\n\\t\\tno decoder for Capability %u\",",
          "2426:                            cap_type));",
          "2427:                     if (ndo->ndo_vflag <= 1)",
          "2429:                     break;",
          "2430:                 }",
          "2431:                 if (ndo->ndo_vflag > 1 && cap_len > 0) {",
          "2433:                 }",
          "2434:                 i += BGP_CAP_HEADER_SIZE + cap_len;",
          "2435:         }",
          "",
          "[Removed Lines]",
          "2428:                         print_unknown_data(ndo, &opt[i+2], \"\\n\\t\\t\", cap_len);",
          "2432:                     print_unknown_data(ndo, &opt[i+2], \"\\n\\t\\t\", cap_len);",
          "",
          "[Added Lines]",
          "2428:                         print_unknown_data(ndo, opt + i + 2, \"\\n\\t\\t\",",
          "2429:         cap_len);",
          "2433:                     print_unknown_data(ndo, opt + i + 2, \"\\n\\t\\t\", cap_len);",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "2469:  i = 0;",
          "2470:  while (i < bgpo.bgpo_optlen) {",
          "2471:   ND_TCHECK2(opt[i], BGP_OPT_SIZE);",
          "2473:   if (i + 2 + bgpopt.bgpopt_len > bgpo.bgpo_optlen) {",
          "2474:    ND_PRINT((ndo, \"\\n\\t     Option %d, length: %u\", bgpopt.bgpopt_type, bgpopt.bgpopt_len));",
          "2475:    break;",
          "",
          "[Removed Lines]",
          "2472:   memcpy(&bgpopt, &opt[i], BGP_OPT_SIZE);",
          "",
          "[Added Lines]",
          "2473:   memcpy(&bgpopt, opt + i, BGP_OPT_SIZE);",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "2485:   switch(bgpopt.bgpopt_type) {",
          "2487:   case BGP_OPT_CAP:",
          "2490:    break;",
          "2492:   case BGP_OPT_AUTH:",
          "",
          "[Removed Lines]",
          "2488:    bgp_capabilities_print(ndo, &opt[i+BGP_OPT_SIZE],",
          "2489:        bgpopt.bgpopt_len);",
          "",
          "[Added Lines]",
          "2489:    bgp_capabilities_print(ndo, opt + i + BGP_OPT_SIZE,",
          "2490:             bgpopt.bgpopt_len);",
          "",
          "---------------"
        ],
        "print-hncp.c||print-hncp.c": [
          "File: print-hncp.c -> print-hncp.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "221:         plenbytes = (plen + 7) / 8;",
          "222:         if (max_length < (u_int)plenbytes + IPV4_MAPPED_HEADING_LEN)",
          "223:             return -3;",
          "225:         if (plen % 8) {",
          "226:   ((u_char *)&addr)[plenbytes - 1] &=",
          "227:    ((0xff00 >> (plen % 8)) & 0xff);",
          "",
          "[Removed Lines]",
          "224:         memcpy(&addr, &prefix[1 + IPV4_MAPPED_HEADING_LEN], plenbytes);",
          "",
          "[Added Lines]",
          "224:         memcpy(&addr, prefix + IPV4_MAPPED_HEADING_LEN + 1, plenbytes);",
          "",
          "---------------"
        ],
        "print-ip6opts.c||print-ip6opts.c": [
          "File: print-ip6opts.c -> print-ip6opts.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "149:      }",
          "150:      ND_PRINT((ndo, \"(homeaddr: %s\", ip6addr_string(ndo, bp + i + 2)));",
          "151:             if (bp[i + 1] > IP6OPT_HOMEADDR_MINLEN - 2) {",
          "154:      }",
          "155:             ND_PRINT((ndo, \")\"));",
          "156:      break;",
          "",
          "[Removed Lines]",
          "152:   ip6_sopt_print(ndo, &bp[i + IP6OPT_HOMEADDR_MINLEN],",
          "153:       (optlen - IP6OPT_HOMEADDR_MINLEN));",
          "",
          "[Added Lines]",
          "152:   ip6_sopt_print(ndo, bp + i + IP6OPT_HOMEADDR_MINLEN,",
          "153:                                (optlen - IP6OPT_HOMEADDR_MINLEN));",
          "",
          "---------------"
        ],
        "print-mobility.c||print-mobility.c": [
          "File: print-mobility.c -> print-mobility.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "333:   break;",
          "334:  }",
          "335:  if (ndo->ndo_vflag)",
          "337:    goto trunc;",
          "339:  return(mhlen);",
          "",
          "[Removed Lines]",
          "336:   if (mobility_opt_print(ndo, &bp[hlen], mhlen - hlen))",
          "",
          "[Added Lines]",
          "336:   if (mobility_opt_print(ndo, bp + hlen, mhlen - hlen))",
          "",
          "---------------"
        ],
        "print-pim.c||print-pim.c": [
          "File: print-pim.c -> print-pim.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "321:   if (ndo->ndo_vflag) {",
          "322:    if (len < 8)",
          "323:     goto trunc;",
          "325:   }",
          "326:   break;",
          "327:  }",
          "",
          "[Removed Lines]",
          "324:    pimv1_join_prune_print(ndo, &bp[8], len - 8);",
          "",
          "[Added Lines]",
          "324:    pimv1_join_prune_print(ndo, bp + 8, len - 8);",
          "",
          "---------------"
        ],
        "print-sl.c||print-sl.c": [
          "File: print-sl.c -> print-sl.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "184:    return;",
          "185:   }",
          "186:   if (p[SLX_CHDR] & TYPE_COMPRESSED_TCP) {",
          "189:    ND_PRINT((ndo, \": \"));",
          "190:   } else",
          "191:    ND_PRINT((ndo, \"slip-%d!: \", EXTRACT_U_1(p + SLX_CHDR)));",
          "",
          "[Removed Lines]",
          "187:    compressed_sl_print(ndo, &p[SLX_CHDR], ip,",
          "188:        length, dir);",
          "",
          "[Added Lines]",
          "187:    compressed_sl_print(ndo, p + SLX_CHDR, ip,",
          "188:          length, dir);",
          "",
          "---------------"
        ],
        "print-smb.c||print-smb.c": [
          "File: print-smb.c -> print-smb.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1452:  for (i = 0; i < 128; i++) {",
          "1453:      if (&data2[i + 3] >= maxbuf)",
          "1454:   break;",
          "1456:   ND_PRINT((ndo, \"found SMB packet at %d\\n\", i));",
          "1458:   break;",
          "1459:      }",
          "1460:  }",
          "",
          "[Removed Lines]",
          "1455:      if (memcmp(&data2[i], \"\\377SMB\", 4) == 0) {",
          "1457:   print_smb(ndo, &data2[i], maxbuf);",
          "",
          "[Added Lines]",
          "1455:      if (memcmp(data2 + i, \"\\377SMB\", 4) == 0) {",
          "1457:   print_smb(ndo, data2 + i, maxbuf);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1490:     for (i = 0; i < 128; i++) {",
          "1491:  if (&data[i + 4] > maxbuf)",
          "1492:      break;",
          "1496:      ND_PRINT((ndo, \"\\n\"));",
          "1497:      break;",
          "1498:  }",
          "",
          "[Removed Lines]",
          "1493:  if (memcmp(&data[i], \"\\377SMB\", 4) == 0) {",
          "1494:      smb_fdata(ndo, data, \"\\n>>> IPX transport \", &data[i], 0);",
          "1495:      print_smb(ndo, &data[i], maxbuf);",
          "",
          "[Added Lines]",
          "1493:  if (memcmp(data + i, \"\\377SMB\", 4) == 0) {",
          "1494:      smb_fdata(ndo, data, \"\\n>>> IPX transport \", data + i, 0);",
          "1495:      print_smb(ndo, data + i, maxbuf);",
          "",
          "---------------"
        ],
        "print-vjc.c||print-vjc.c": [
          "File: print-vjc.c -> print-vjc.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "106:   if (bp[1])",
          "107:    ND_PRINT((ndo, \" \"));",
          "108:   ND_PRINT((ndo, \"C=0x%02x \", bp[2]));",
          "110:   return -1;",
          "111:  case TYPE_ERROR:",
          "112:   if (ndo->ndo_eflag)",
          "",
          "[Removed Lines]",
          "109:   ND_PRINT((ndo, \"sum=0x%04x \", *(const u_short *)&bp[3]));",
          "",
          "[Added Lines]",
          "109:   ND_PRINT((ndo, \"sum=0x%04x \", *(const u_short *)(bp + 3)));",
          "",
          "---------------"
        ],
        "smbutil.c||smbutil.c": [
          "File: smbutil.c -> smbutil.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "287:  if (i%8 == 0)",
          "288:      ND_PRINT((ndo, \" \"));",
          "289:  if (i % 16 == 0) {",
          "291:      ND_PRINT((ndo, \" \"));",
          "293:      ND_PRINT((ndo, \"\\n\"));",
          "294:      if (i < len)",
          "295:   ND_PRINT((ndo, \"[%03X] \", i));",
          "",
          "[Removed Lines]",
          "290:      print_asc(ndo, &buf[i - 16], 8);",
          "292:      print_asc(ndo, &buf[i - 8], 8);",
          "",
          "[Added Lines]",
          "290:      print_asc(ndo, buf + i - 16, 8);",
          "292:      print_asc(ndo, buf + i - 8, 8);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "306:      ND_PRINT((ndo, \"   \"));",
          "308:  n = min(8, i % 16);",
          "310:  ND_PRINT((ndo, \" \"));",
          "311:  n = (i % 16) - n;",
          "312:  if (n > 0)",
          "314:  ND_PRINT((ndo, \"\\n\"));",
          "315:     }",
          "316:     return;",
          "",
          "[Removed Lines]",
          "309:  print_asc(ndo, &buf[i - (i % 16)], n);",
          "313:      print_asc(ndo, &buf[i - n], n);",
          "",
          "[Added Lines]",
          "309:  print_asc(ndo, buf + i - (i % 16), n);",
          "313:      print_asc(ndo, buf + i - n, n);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "12f570c35c1edb9d2c7a1b4062b834b0315e3b1a",
      "candidate_info": {
        "commit_hash": "12f570c35c1edb9d2c7a1b4062b834b0315e3b1a",
        "repo": "the-tcpdump-group/tcpdump",
        "commit_url": "https://github.com/the-tcpdump-group/tcpdump/commit/12f570c35c1edb9d2c7a1b4062b834b0315e3b1a",
        "files": [
          "print-bgp.c"
        ],
        "message": "Fix dissection of RFC 4684 routing information.\n\nRFC 4684, sadly, doesn't do a very good job of describing what a \"route\ntarget\" is.  In practice, it appears to be a Route Target extended\ncommunity, as per RFC 4360 section 4 \"Route Target Community\".  Those do\n*not* have the same format as an RFC 4364 Route Descriptor.\n\nSo just take the code to dissect an extended community, put it in a\nsubroutine, change it to directly print information rather than filling\nin a static string buffer (C support for strings is spectacularly bad -\nlarge variable-length objects are hard, let's go shopping!), and call\nthat routine when dissecting RFC 4684 routing information.",
        "before_after_code_files": [
          "print-bgp.c||print-bgp.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "print-bgp.c||print-bgp.c"
          ],
          "candidate": [
            "print-bgp.c||print-bgp.c"
          ]
        }
      },
      "candidate_diff": {
        "print-bgp.c||print-bgp.c": [
          "File: print-bgp.c -> print-bgp.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "761:     return (rd);",
          "762: }",
          "764: static int",
          "765: decode_rt_routing_info(netdissect_options *ndo,",
          "767: {",
          "769:     u_int plen;",
          "",
          "[Removed Lines]",
          "766:                        const u_char *pptr, char *buf, u_int buflen)",
          "768:     uint8_t route_target[8];",
          "",
          "[Added Lines]",
          "765: static void",
          "766: bgp_extended_community_print(netdissect_options *ndo,",
          "767:                              const u_char *pptr)",
          "768: {",
          "770:         float f;",
          "771:         uint32_t i;",
          "772:     } bw;",
          "774:     switch (EXTRACT_BE_U_2(pptr)) {",
          "776:     case BGP_EXT_COM_RT_0:",
          "777:     case BGP_EXT_COM_RO_0:",
          "778:     case BGP_EXT_COM_L2VPN_RT_0:",
          "779:         ND_PRINT(\"%u:%u (= %s)\",",
          "780:                  EXTRACT_BE_U_2(pptr + 2),",
          "781:                  EXTRACT_BE_U_4(pptr + 4),",
          "782:                  ipaddr_string(ndo, pptr+4));",
          "783:         break;",
          "785:     case BGP_EXT_COM_RT_1:",
          "786:     case BGP_EXT_COM_RO_1:",
          "787:     case BGP_EXT_COM_L2VPN_RT_1:",
          "788:     case BGP_EXT_COM_VRF_RT_IMP:",
          "789:         ND_PRINT(\"%s:%u\",",
          "790:                  ipaddr_string(ndo, pptr+2),",
          "791:                  EXTRACT_BE_U_2(pptr + 6));",
          "792:         break;",
          "794:     case BGP_EXT_COM_RT_2:",
          "795:         case BGP_EXT_COM_RO_2:",
          "796:             ND_PRINT(\"%s:%u\",",
          "797:                      as_printf(ndo, astostr, sizeof(astostr),",
          "798:                      EXTRACT_BE_U_4(pptr + 2)), EXTRACT_BE_U_2(pptr + 6));",
          "799:             break;",
          "801:     case BGP_EXT_COM_LINKBAND:",
          "802:             bw.i = EXTRACT_BE_U_4(pptr + 2);",
          "803:             ND_PRINT(\"bandwidth: %.3f Mbps\",",
          "804:                      bw.f*8/1000000);",
          "805:             break;",
          "807:     case BGP_EXT_COM_VPN_ORIGIN:",
          "808:     case BGP_EXT_COM_VPN_ORIGIN2:",
          "809:     case BGP_EXT_COM_VPN_ORIGIN3:",
          "810:     case BGP_EXT_COM_VPN_ORIGIN4:",
          "811:     case BGP_EXT_COM_OSPF_RID:",
          "812:     case BGP_EXT_COM_OSPF_RID2:",
          "813:         ND_PRINT(\"%s\", ipaddr_string(ndo, pptr+2));",
          "814:         break;",
          "816:     case BGP_EXT_COM_OSPF_RTYPE:",
          "817:     case BGP_EXT_COM_OSPF_RTYPE2:",
          "818:         ND_PRINT(\"area:%s, router-type:%s, metric-type:%s%s\",",
          "819:                  ipaddr_string(ndo, pptr+2),",
          "820:                  tok2str(bgp_extd_comm_ospf_rtype_values,",
          "821:                          \"unknown (0x%02x)\",",
          "822:                          EXTRACT_U_1((pptr + 6))),",
          "823:                  (EXTRACT_U_1(pptr + 7) &  BGP_OSPF_RTYPE_METRIC_TYPE) ? \"E2\" : \"\",",
          "824:                  ((EXTRACT_U_1(pptr + 6) == BGP_OSPF_RTYPE_EXT) || (EXTRACT_U_1(pptr + 6) == BGP_OSPF_RTYPE_NSSA)) ? \"E1\" : \"\");",
          "825:         break;",
          "827:     case BGP_EXT_COM_L2INFO:",
          "828:         ND_PRINT(\"%s Control Flags [0x%02x]:MTU %u\",",
          "829:                  tok2str(l2vpn_encaps_values,",
          "830:                          \"unknown encaps\",",
          "831:                          EXTRACT_U_1((pptr + 2))),",
          "832:                  EXTRACT_U_1((pptr + 3)),",
          "833:                           EXTRACT_BE_U_2(pptr + 4));",
          "834:         break;",
          "836:     case BGP_EXT_COM_SOURCE_AS:",
          "837:         ND_PRINT(\"AS %u\", EXTRACT_BE_U_2(pptr + 2));",
          "838:         break;",
          "840:     default:",
          "841:         ND_PRINT(\"%02x%02x%02x%02x%02x%02x\",",
          "842:                  EXTRACT_U_1(pptr + 2),",
          "843:                  EXTRACT_U_1(pptr + 3),",
          "844:                  EXTRACT_U_1(pptr + 4),",
          "845:                  EXTRACT_U_1(pptr + 5),",
          "846:                  EXTRACT_U_1(pptr + 6),",
          "847:                  EXTRACT_U_1(pptr + 7));",
          "848:         break;",
          "849:     }",
          "850: }",
          "855:                        const u_char *pptr)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "780:     if (0 == plen) {",
          "783:         return 1;",
          "784:     }",
          "787:         return -1;",
          "790:     ND_TCHECK_4(pptr + 1);",
          "",
          "[Removed Lines]",
          "782:         nd_snprintf(buf, buflen, \"default route target\");",
          "786:     if (32 > plen)",
          "",
          "[Added Lines]",
          "870:         ND_PRINT(\"\\n\\t      default route target\");",
          "874:     if (32 > plen) {",
          "875:         ND_PRINT(\"\\n\\t      (illegal prefix length)\");",
          "877:     }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "809:     }",
          "816: trunc:",
          "817:     return -2;",
          "",
          "[Removed Lines]",
          "795:     if (64 < plen)",
          "796:         return -1;",
          "802:     memset(&route_target, 0, sizeof(route_target));",
          "803:     ND_TCHECK_LEN(pptr + 5, (plen + 7) / 8);",
          "804:     memcpy(&route_target, pptr + 5, (plen + 7) / 8);",
          "806:     if (plen % 8) {",
          "807:         ((u_char *)&route_target)[(plen + 7) / 8 - 1] &=",
          "808:             ((0xff00 >> (plen % 8)) & 0xff);",
          "810:     nd_snprintf(buf, buflen, \"origin AS: %s, route target %s\",",
          "811:              asbuf,",
          "812:              bgp_vpn_rd_print(ndo, (u_char *)&route_target));",
          "814:     return 5 + (plen + 7) / 8;",
          "",
          "[Added Lines]",
          "888:     if (64 != plen) {",
          "889:         ND_PRINT(\"\\n\\t    (illegal prefix length)\");",
          "890:         return -1;",
          "892:     ND_TCHECK_LEN(pptr + 5, 8);",
          "893:     ND_PRINT(\"\\n\\t      origin AS: %s, route target \", asbuf);",
          "894:     bgp_extended_community_print(ndo, pptr + 5);",
          "896:     return 5 + 8;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1463:     u_int i;",
          "1464:     uint16_t af;",
          "1465:     uint8_t safi, snpa, nhlen;",
          "1470:     int advance;",
          "1471:     u_int tlen;",
          "1472:     const u_char *tptr;",
          "",
          "[Removed Lines]",
          "1467:         float f;",
          "1468:         uint32_t i;",
          "1469:     } bw;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1894:                     ND_PRINT(\"\\n\\t      %s\", buf);",
          "1895:                 break;",
          "1896:             case (AFNUM_INET<<8 | SAFNUM_RT_ROUTING_INFO):",
          "1901:                     goto trunc;",
          "1904:                 break;",
          "1906:             case (AFNUM_INET6<<8 | SAFNUM_MULTICAST_VPN):",
          "",
          "[Removed Lines]",
          "1897:                 advance = decode_rt_routing_info(ndo, tptr, buf, sizeof(buf));",
          "1898:                 if (advance == -1)",
          "1899:                     ND_PRINT(\"\\n\\t    (illegal prefix length)\");",
          "1900:                 else if (advance == -2)",
          "1902:                 else",
          "1903:                     ND_PRINT(\"\\n\\t      %s\", buf);",
          "",
          "[Added Lines]",
          "1975:                 advance = decode_rt_routing_info(ndo, tptr);",
          "1976:                 if (advance == -2)",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "2207:                       extd_comm,",
          "2208:                       bittok2str(bgp_extd_comm_flag_values, \"none\", extd_comm));",
          "2211:             if (tlen < 8)",
          "2212:                 goto trunc;",
          "2275:             tlen -= 8;",
          "2276:             tptr += 8;",
          "2277:         }",
          "",
          "[Removed Lines]",
          "2210:             ND_TCHECK_6(tptr + 2);",
          "2213:             switch(extd_comm) {",
          "2214:             case BGP_EXT_COM_RT_0:",
          "2215:             case BGP_EXT_COM_RO_0:",
          "2216:             case BGP_EXT_COM_L2VPN_RT_0:",
          "2217:                 ND_PRINT(\": %u:%u (= %s)\",",
          "2218:                           EXTRACT_BE_U_2(tptr + 2),",
          "2219:                           EXTRACT_BE_U_4(tptr + 4),",
          "2220:                           ipaddr_string(ndo, tptr+4));",
          "2221:                 break;",
          "2222:             case BGP_EXT_COM_RT_1:",
          "2223:             case BGP_EXT_COM_RO_1:",
          "2224:             case BGP_EXT_COM_L2VPN_RT_1:",
          "2225:             case BGP_EXT_COM_VRF_RT_IMP:",
          "2226:                 ND_PRINT(\": %s:%u\",",
          "2227:                           ipaddr_string(ndo, tptr+2),",
          "2228:                           EXTRACT_BE_U_2(tptr + 6));",
          "2229:                 break;",
          "2230:             case BGP_EXT_COM_RT_2:",
          "2231:             case BGP_EXT_COM_RO_2:",
          "2232:                 ND_PRINT(\": %s:%u\",",
          "2233:                           as_printf(ndo, astostr, sizeof(astostr),",
          "2234:                           EXTRACT_BE_U_4(tptr + 2)), EXTRACT_BE_U_2(tptr + 6));",
          "2235:                 break;",
          "2236:             case BGP_EXT_COM_LINKBAND:",
          "2237:                 bw.i = EXTRACT_BE_U_4(tptr + 2);",
          "2238:                 ND_PRINT(\": bandwidth: %.3f Mbps\",",
          "2239:                           bw.f*8/1000000);",
          "2240:                 break;",
          "2241:             case BGP_EXT_COM_VPN_ORIGIN:",
          "2242:             case BGP_EXT_COM_VPN_ORIGIN2:",
          "2243:             case BGP_EXT_COM_VPN_ORIGIN3:",
          "2244:             case BGP_EXT_COM_VPN_ORIGIN4:",
          "2245:             case BGP_EXT_COM_OSPF_RID:",
          "2246:             case BGP_EXT_COM_OSPF_RID2:",
          "2247:                 ND_PRINT(\"%s\", ipaddr_string(ndo, tptr+2));",
          "2248:                 break;",
          "2249:             case BGP_EXT_COM_OSPF_RTYPE:",
          "2250:             case BGP_EXT_COM_OSPF_RTYPE2:",
          "2251:                 ND_PRINT(\": area:%s, router-type:%s, metric-type:%s%s\",",
          "2252:                           ipaddr_string(ndo, tptr+2),",
          "2253:                           tok2str(bgp_extd_comm_ospf_rtype_values,",
          "2254:                                   \"unknown (0x%02x)\",",
          "2255:                                   EXTRACT_U_1((tptr + 6))),",
          "2256:                           (EXTRACT_U_1(tptr + 7) &  BGP_OSPF_RTYPE_METRIC_TYPE) ? \"E2\" : \"\",",
          "2257:                           ((EXTRACT_U_1(tptr + 6) == BGP_OSPF_RTYPE_EXT) || (EXTRACT_U_1(tptr + 6) == BGP_OSPF_RTYPE_NSSA)) ? \"E1\" : \"\");",
          "2258:                 break;",
          "2259:             case BGP_EXT_COM_L2INFO:",
          "2260:                 ND_PRINT(\": %s Control Flags [0x%02x]:MTU %u\",",
          "2261:                           tok2str(l2vpn_encaps_values,",
          "2262:                                   \"unknown encaps\",",
          "2263:                                   EXTRACT_U_1((tptr + 2))),",
          "2264:                           EXTRACT_U_1((tptr + 3)),",
          "2265:                           EXTRACT_BE_U_2(tptr + 4));",
          "2266:                 break;",
          "2267:             case BGP_EXT_COM_SOURCE_AS:",
          "2268:                 ND_PRINT(\": AS %u\", EXTRACT_BE_U_2(tptr + 2));",
          "2269:                 break;",
          "2270:             default:",
          "2271:                 ND_TCHECK_8(tptr);",
          "2272:                 print_unknown_data(ndo, tptr, \"\\n\\t      \", 8);",
          "2273:                 break;",
          "2274:             }",
          "",
          "[Added Lines]",
          "2284:             ND_TCHECK_8(tptr);",
          "2287:             ND_PRINT(\": \");",
          "2288:             bgp_extended_community_print(ndo, tptr);",
          "",
          "---------------"
        ]
      }
    }
  ]
}