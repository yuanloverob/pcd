{
  "cve_id": "CVE-2022-37434",
  "cve_desc": "zlib through 1.2.12 has a heap-based buffer over-read or buffer overflow in inflate in inflate.c via a large gzip header extra field. NOTE: only applications that call inflateGetHeader are affected. Some common applications bundle the affected zlib source code but may be unable to call inflateGetHeader (e.g., see the nodejs/node reference).",
  "repo": "madler/zlib",
  "patch_hash": "eff308af425b67093bab25f80f1ae950166bece1",
  "patch_info": {
    "commit_hash": "eff308af425b67093bab25f80f1ae950166bece1",
    "repo": "madler/zlib",
    "commit_url": "https://github.com/madler/zlib/commit/eff308af425b67093bab25f80f1ae950166bece1",
    "files": [
      "inflate.c"
    ],
    "message": "Fix a bug when getting a gzip header extra field with inflate().\n\nIf the extra field was larger than the space the user provided with\ninflateGetHeader(), and if multiple calls of inflate() delivered\nthe extra header data, then there could be a buffer overflow of the\nprovided space. This commit assures that provided space is not\nexceeded.",
    "before_after_code_files": [
      "inflate.c||inflate.c"
    ]
  },
  "patch_diff": {
    "inflate.c||inflate.c": [
      "File: inflate.c -> inflate.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "763:                 copy = state->length;",
      "764:                 if (copy > have) copy = have;",
      "765:                 if (copy) {",
      "766:                     if (state->head != Z_NULL &&",
      "769:                         zmemcpy(state->head->extra + len, next,",
      "770:                                 len + copy > state->head->extra_max ?",
      "771:                                 state->head->extra_max - len : copy);",
      "",
      "[Removed Lines]",
      "767:                         state->head->extra != Z_NULL) {",
      "768:                         len = state->head->extra_len - state->length;",
      "",
      "[Added Lines]",
      "766:                     len = state->head->extra_len - state->length;",
      "768:                         state->head->extra != Z_NULL &&",
      "769:                         len < state->head->extra_max) {",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "1eb7682f845ac9e9bf9ae35bbfb3bad5dacbd91d",
      "candidate_info": {
        "commit_hash": "1eb7682f845ac9e9bf9ae35bbfb3bad5dacbd91d",
        "repo": "madler/zlib",
        "commit_url": "https://github.com/madler/zlib/commit/1eb7682f845ac9e9bf9ae35bbfb3bad5dacbd91d",
        "files": [
          "inflate.c"
        ],
        "message": "Fix extra field processing bug that dereferences NULL state->head.\n\nThe recent commit to fix a gzip header extra field processing bug\nintroduced the new bug fixed here.",
        "before_after_code_files": [
          "inflate.c||inflate.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "inflate.c||inflate.c"
          ],
          "candidate": [
            "inflate.c||inflate.c"
          ]
        }
      },
      "candidate_diff": {
        "inflate.c||inflate.c": [
          "File: inflate.c -> inflate.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "763:                 copy = state->length;",
          "764:                 if (copy > have) copy = have;",
          "765:                 if (copy) {",
          "767:                     if (state->head != Z_NULL &&",
          "768:                         state->head->extra != Z_NULL &&",
          "770:                         zmemcpy(state->head->extra + len, next,",
          "771:                                 len + copy > state->head->extra_max ?",
          "772:                                 state->head->extra_max - len : copy);",
          "",
          "[Removed Lines]",
          "766:                     len = state->head->extra_len - state->length;",
          "769:                         len < state->head->extra_max) {",
          "",
          "[Added Lines]",
          "768:                         (len = state->head->extra_len - state->length) <",
          "769:                             state->head->extra_max) {",
          "",
          "---------------"
        ]
      }
    }
  ]
}