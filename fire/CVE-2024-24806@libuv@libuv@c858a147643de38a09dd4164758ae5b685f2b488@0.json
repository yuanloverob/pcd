{
  "cve_id": "CVE-2024-24806",
  "cve_desc": "libuv is a multi-platform support library with a focus on asynchronous I/O. The `uv_getaddrinfo` function in `src/unix/getaddrinfo.c` (and its windows counterpart `src/win/getaddrinfo.c`), truncates hostnames to 256 characters before calling `getaddrinfo`. This behavior can be exploited to create addresses like `0x00007f000001`, which are considered valid by `getaddrinfo` and could allow an attacker to craft payloads that resolve to unintended IP addresses, bypassing developer checks. The vulnerability arises due to how the `hostname_ascii` variable (with a length of 256 bytes) is handled in `uv_getaddrinfo` and subsequently in `uv__idna_toascii`. When the hostname exceeds 256 characters, it gets truncated without a terminating null byte. As a result attackers may be able to access internal APIs or for websites (similar to MySpace) that allows users to have `username.example.com` pages. Internal services that crawl or cache these user pages can be exposed to SSRF attacks if a malicious user chooses a long vulnerable username. This issue has been addressed in release version 1.48.0. Users are advised to upgrade. There are no known workarounds for this vulnerability.",
  "repo": "libuv/libuv",
  "patch_hash": "c858a147643de38a09dd4164758ae5b685f2b488",
  "patch_info": {
    "commit_hash": "c858a147643de38a09dd4164758ae5b685f2b488",
    "repo": "libuv/libuv",
    "commit_url": "https://github.com/libuv/libuv/commit/c858a147643de38a09dd4164758ae5b685f2b488",
    "files": [],
    "message": "Merge pull request from GHSA-f74f-cvh7-c6q6\n\n* fix: always zero-terminate idna output\n\n* fix: reject zero-length idna inputs\n\n* test: empty strings are not valid IDNA\n\n---------\n\nCo-authored-by: Santiago Gimeno <santiago.gimeno@gmail.com>",
    "before_after_code_files": []
  },
  "patch_diff": {},
  "candidates": [
    {
      "candidate_hash": "e9f29cb984231524e3931aa0ae2c5dae1a32884e",
      "candidate_info": {
        "commit_hash": "e9f29cb984231524e3931aa0ae2c5dae1a32884e",
        "repo": "libuv/libuv",
        "commit_url": "https://github.com/libuv/libuv/commit/e9f29cb984231524e3931aa0ae2c5dae1a32884e",
        "files": [
          "AUTHORS",
          "ChangeLog",
          "configure.ac",
          "include/uv/version.h"
        ],
        "message": "2024.02.07, Version 1.48.0 (Stable)\n\nChanges since version 1.47.0:\n\n* misc: remove deprecated stalebot file (Jameson Nash)\n\n* build: disable windows asan buildbot (Ben Noordhuis)\n\n* test: don't run tcp_writealot under msan (Ben Noordhuis)\n\n* build,win: remove extraneous -lshell32 (Ben Noordhuis)\n\n* unix: ignore ifaddrs with NULL ifa_addr (Stephen Gallagher)\n\n* unix,win: utility for setting priority for thread (Hao Hu)\n\n* pipe: add back error handling to connect / bind (Jameson Nash)\n\n* test: check if ipv6 link-local traffic is routable (Ben Noordhuis)\n\n* win: remove check for UV_PIPE_NO_TRUNCATE (Jameson Nash)\n\n* linux: disable io_uring on hppa below kernel 6.1.51 (matoro)\n\n* unix,win: fix read past end of pipe name buffer (Ben Noordhuis)\n\n* unix: unbreak macOS < 10.14 (Sergey Fedorov)\n\n* aix: disable ipv6 link local (Abdirahim Musse)\n\n* doc: move cjihrig to emeriti (cjihrig)\n\n* unix: correct pwritev conditional (Bo Anderson)\n\n* test_fs.c: Fix issue on 32-bit systems using btrfs (Stephen Gallagher)\n\n* misc: ignore libuv-release-tool files (Jameson Nash)\n\n* win: honor NoDefaultCurrentDirectoryInExePath env var (Ardi Nugraha)\n\n* idna: fix compilation warning (Sa\u00fal Ibarra Corretg\u00e9)\n\n* linux: remove HAVE_IFADDRS_H macro (Ben Noordhuis)\n\n* test: skip tcp-write-in-a-row on IBM i (Abdirahim Musse)\n\n* build,win: work around missing uuid.dll on MinGW (Anton Bachin)\n\n* win: stop using deprecated names (Matheus Izvekov)\n\n* unix,win: fix busy loop with zero timeout timers (Matheus Izvekov)\n\n* aix,ibmi: use uv_interface_addresses instead of getifaddrs (Abdirahim\n  Musse)\n\n* linux: fix bind/connect for abstract sockets (Santiago Gimeno)\n\n* win: replace c99 comments with c89 comments (Trevor Flynn)\n\n* build: add .cache clangd folder to .gitignore (Juan Jos\u00e9 Arboleda)\n\n* unix: support full TCP keep-alive on Solaris (Andy Pan)\n\n* freebsd: fix F_KINFO file path handling (David Carlier)\n\n* linux: retry fs op if unsupported by io_uring (Santiago Gimeno)\n\n* freebsd: fix build on non-intel archs (David Carlier)\n\n* unix: optimize uv__tcp_keepalive cpp directives (Andy Pan)\n\n* linux: disable io_uring on ppc64 and ppc64le (Brad King)\n\n* doc: add very basic Security Policy document (Santiago Gimeno)\n\n* build: re-enable msvc-asan job on CI (Jameson Nash)\n\n* win/spawn: optionally run executable paths with no file extension\n  (Brad King)\n\n* win: fix ESRCH implementation (Jameson Nash)\n\n* unix,win: reset the timer queue on stop (Santiago Gimeno)\n\n* fix: always zero-terminate idna output (Ben Noordhuis)\n\n* fix: reject zero-length idna inputs (Ben Noordhuis)\n\n* test: empty strings are not valid IDNA (Santiago Gimeno)\n\n* Merge pull request from GHSA-f74f-cvh7-c6q6 (Ben Noordhuis)",
        "before_after_code_files": [
          "configure.ac||configure.ac",
          "include/uv/version.h||include/uv/version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/libuv/libuv/pull/4305"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "configure.ac||configure.ac": [
          "File: configure.ac -> configure.ac",
          "--- Hunk 1 ---",
          "[Context before]",
          "13: # OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.",
          "15: AC_PREREQ(2.57)",
          "17: AC_CONFIG_MACRO_DIR([m4])",
          "18: m4_include([m4/libuv-extra-automake-flags.m4])",
          "19: m4_include([m4/as_case.m4])",
          "",
          "[Removed Lines]",
          "16: AC_INIT([libuv], [1.47.1-dev], [https://github.com/libuv/libuv/issues])",
          "",
          "[Added Lines]",
          "16: AC_INIT([libuv], [1.48.0], [https://github.com/libuv/libuv/issues])",
          "",
          "---------------"
        ],
        "include/uv/version.h||include/uv/version.h": [
          "File: include/uv/version.h -> include/uv/version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "33: #define UV_VERSION_MAJOR 1",
          "39: #define UV_VERSION_HEX  ((UV_VERSION_MAJOR << 16) | \\",
          "40:                          (UV_VERSION_MINOR <<  8) | \\",
          "",
          "[Removed Lines]",
          "34: #define UV_VERSION_MINOR 47",
          "35: #define UV_VERSION_PATCH 1",
          "36: #define UV_VERSION_IS_RELEASE 0",
          "37: #define UV_VERSION_SUFFIX \"dev\"",
          "",
          "[Added Lines]",
          "34: #define UV_VERSION_MINOR 48",
          "35: #define UV_VERSION_PATCH 0",
          "36: #define UV_VERSION_IS_RELEASE 1",
          "37: #define UV_VERSION_SUFFIX \"\"",
          "",
          "---------------"
        ]
      }
    }
  ]
}