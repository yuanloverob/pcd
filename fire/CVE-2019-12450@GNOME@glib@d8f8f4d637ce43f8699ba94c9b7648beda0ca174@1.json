{
  "cve_id": "CVE-2019-12450",
  "cve_desc": "file_copy_fallback in gio/gfile.c in GNOME GLib 2.15.0 through 2.61.1 does not properly restrict file permissions while a copy operation is in progress. Instead, default permissions are used.",
  "repo": "GNOME/glib",
  "patch_hash": "d8f8f4d637ce43f8699ba94c9b7648beda0ca174",
  "patch_info": {
    "commit_hash": "d8f8f4d637ce43f8699ba94c9b7648beda0ca174",
    "repo": "GNOME/glib",
    "commit_url": "https://github.com/GNOME/glib/commit/d8f8f4d637ce43f8699ba94c9b7648beda0ca174",
    "files": [
      "gio/gfile.c"
    ],
    "message": "gfile: Limit access to files when copying\n\nfile_copy_fallback creates new files with default permissions and\nset the correct permissions after the operation is finished. This\nmight cause that the files can be accessible by more users during\nthe operation than expected. Use G_FILE_CREATE_PRIVATE for the new\nfiles to limit access to those files.",
    "before_after_code_files": [
      "gio/gfile.c||gio/gfile.c"
    ]
  },
  "patch_diff": {
    "gio/gfile.c||gio/gfile.c": [
      "File: gio/gfile.c -> gio/gfile.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "3284:         out = (GOutputStream*)_g_local_file_output_stream_replace (_g_local_file_get_filename (G_LOCAL_FILE (destination)),",
      "3285:                                                                    FALSE, NULL,",
      "3286:                                                                    flags & G_FILE_COPY_BACKUP,",
      "3289:                                                                    cancellable, error);",
      "3290:       else",
      "3291:         out = (GOutputStream*)_g_local_file_output_stream_create (_g_local_file_get_filename (G_LOCAL_FILE (destination)),",
      "3293:                                                                   cancellable, error);",
      "3294:     }",
      "3295:   else if (flags & G_FILE_COPY_OVERWRITE)",
      "",
      "[Removed Lines]",
      "3287:                                                                    G_FILE_CREATE_REPLACE_DESTINATION,",
      "3288:                                                                    info,",
      "3292:                                                                   FALSE, 0, info,",
      "",
      "[Added Lines]",
      "3287:                                                                    G_FILE_CREATE_REPLACE_DESTINATION |",
      "3288:                                                                    G_FILE_CREATE_PRIVATE, info,",
      "3292:                                                                   FALSE, G_FILE_CREATE_PRIVATE, info,",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "3297:       out = (GOutputStream *)g_file_replace (destination,",
      "3298:                                              NULL,",
      "3299:                                              flags & G_FILE_COPY_BACKUP,",
      "3301:                                              cancellable, error);",
      "3302:     }",
      "3303:   else",
      "3304:     {",
      "3306:     }",
      "3308:   if (!out)",
      "",
      "[Removed Lines]",
      "3300:                                              G_FILE_CREATE_REPLACE_DESTINATION,",
      "3305:       out = (GOutputStream *)g_file_create (destination, 0, cancellable, error);",
      "",
      "[Added Lines]",
      "3300:                                              G_FILE_CREATE_REPLACE_DESTINATION |",
      "3301:                                              G_FILE_CREATE_PRIVATE,",
      "3306:       out = (GOutputStream *)g_file_create (destination, G_FILE_CREATE_PRIVATE, cancellable, error);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "e6b769819d63d2b24b251dbc9f902fe6fd614da3",
      "candidate_info": {
        "commit_hash": "e6b769819d63d2b24b251dbc9f902fe6fd614da3",
        "repo": "GNOME/glib",
        "commit_url": "https://github.com/GNOME/glib/commit/e6b769819d63d2b24b251dbc9f902fe6fd614da3",
        "files": [
          "gio/gfile.c"
        ],
        "message": "gfile: Limit access to files when copying\n\nfile_copy_fallback creates new files with default permissions and\nset the correct permissions after the operation is finished. This\nmight cause that the files can be accessible by more users during\nthe operation than expected. Use G_FILE_CREATE_PRIVATE for the new\nfiles to limit access to those files.",
        "before_after_code_files": [
          "gio/gfile.c||gio/gfile.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "gio/gfile.c||gio/gfile.c"
          ],
          "candidate": [
            "gio/gfile.c||gio/gfile.c"
          ]
        }
      },
      "candidate_diff": {
        "gio/gfile.c||gio/gfile.c": [
          "File: gio/gfile.c -> gio/gfile.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "3284:         out = (GOutputStream*)_g_local_file_output_stream_replace (_g_local_file_get_filename (G_LOCAL_FILE (destination)),",
          "3285:                                                                    FALSE, NULL,",
          "3286:                                                                    flags & G_FILE_COPY_BACKUP,",
          "3289:                                                                    cancellable, error);",
          "3290:       else",
          "3291:         out = (GOutputStream*)_g_local_file_output_stream_create (_g_local_file_get_filename (G_LOCAL_FILE (destination)),",
          "3293:                                                                   cancellable, error);",
          "3294:     }",
          "3295:   else if (flags & G_FILE_COPY_OVERWRITE)",
          "",
          "[Removed Lines]",
          "3287:                                                                    G_FILE_CREATE_REPLACE_DESTINATION,",
          "3288:                                                                    info,",
          "3292:                                                                   FALSE, 0, info,",
          "",
          "[Added Lines]",
          "3287:                                                                    G_FILE_CREATE_REPLACE_DESTINATION |",
          "3288:                                                                    G_FILE_CREATE_PRIVATE, info,",
          "3292:                                                                   FALSE, G_FILE_CREATE_PRIVATE, info,",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "3297:       out = (GOutputStream *)g_file_replace (destination,",
          "3298:                                              NULL,",
          "3299:                                              flags & G_FILE_COPY_BACKUP,",
          "3301:                                              cancellable, error);",
          "3302:     }",
          "3303:   else",
          "3304:     {",
          "3306:     }",
          "3308:   if (!out)",
          "",
          "[Removed Lines]",
          "3300:                                              G_FILE_CREATE_REPLACE_DESTINATION,",
          "3305:       out = (GOutputStream *)g_file_create (destination, 0, cancellable, error);",
          "",
          "[Added Lines]",
          "3300:                                              G_FILE_CREATE_REPLACE_DESTINATION |",
          "3301:                                              G_FILE_CREATE_PRIVATE,",
          "3306:       out = (GOutputStream *)g_file_create (destination, G_FILE_CREATE_PRIVATE, cancellable, error);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "7a0be345be080e1f00a4a0366a4ceee904ebe1ee",
      "candidate_info": {
        "commit_hash": "7a0be345be080e1f00a4a0366a4ceee904ebe1ee",
        "repo": "GNOME/glib",
        "commit_url": "https://github.com/GNOME/glib/commit/7a0be345be080e1f00a4a0366a4ceee904ebe1ee",
        "files": [
          "gio/gfile.c"
        ],
        "message": "gfile: Limit access to files when copying\n\nfile_copy_fallback creates new files with default permissions and\nset the correct permissions after the operation is finished. This\nmight cause that the files can be accessible by more users during\nthe operation than expected. Use G_FILE_CREATE_PRIVATE for the new\nfiles to limit access to those files.",
        "before_after_code_files": [
          "gio/gfile.c||gio/gfile.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "gio/gfile.c||gio/gfile.c"
          ],
          "candidate": [
            "gio/gfile.c||gio/gfile.c"
          ]
        }
      },
      "candidate_diff": {
        "gio/gfile.c||gio/gfile.c": [
          "File: gio/gfile.c -> gio/gfile.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "3271:         out = (GOutputStream*)_g_local_file_output_stream_replace (_g_local_file_get_filename (G_LOCAL_FILE (destination)),",
          "3272:                                                                    FALSE, NULL,",
          "3273:                                                                    flags & G_FILE_COPY_BACKUP,",
          "3276:                                                                    cancellable, error);",
          "3277:       else",
          "3278:         out = (GOutputStream*)_g_local_file_output_stream_create (_g_local_file_get_filename (G_LOCAL_FILE (destination)),",
          "3280:                                                                   cancellable, error);",
          "3281:     }",
          "3282:   else if (flags & G_FILE_COPY_OVERWRITE)",
          "",
          "[Removed Lines]",
          "3274:                                                                    G_FILE_CREATE_REPLACE_DESTINATION,",
          "3275:                                                                    info,",
          "3279:                                                                   FALSE, 0, info,",
          "",
          "[Added Lines]",
          "3274:                                                                    G_FILE_CREATE_REPLACE_DESTINATION |",
          "3275:                                                                    G_FILE_CREATE_PRIVATE, info,",
          "3279:                                                                   FALSE, G_FILE_CREATE_PRIVATE, info,",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "3284:       out = (GOutputStream *)g_file_replace (destination,",
          "3285:                                              NULL,",
          "3286:                                              flags & G_FILE_COPY_BACKUP,",
          "3288:                                              cancellable, error);",
          "3289:     }",
          "3290:   else",
          "3291:     {",
          "3293:     }",
          "3295:   if (!out)",
          "",
          "[Removed Lines]",
          "3287:                                              G_FILE_CREATE_REPLACE_DESTINATION,",
          "3292:       out = (GOutputStream *)g_file_create (destination, 0, cancellable, error);",
          "",
          "[Added Lines]",
          "3287:                                              G_FILE_CREATE_REPLACE_DESTINATION |",
          "3288:                                              G_FILE_CREATE_PRIVATE,",
          "3293:       out = (GOutputStream *)g_file_create (destination, G_FILE_CREATE_PRIVATE, cancellable, error);",
          "",
          "---------------"
        ]
      }
    }
  ]
}