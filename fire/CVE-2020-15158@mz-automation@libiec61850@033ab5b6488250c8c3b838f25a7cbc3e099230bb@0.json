{
  "cve_id": "CVE-2020-15158",
  "cve_desc": "In libIEC61850 before version 1.4.3, when a message with COTP message length field with value < 4 is received an integer underflow will happen leading to heap buffer overflow. This can cause an application crash or on some platforms even the execution of remote code. If your application is used in open networks or there are untrusted nodes in the network it is highly recommend to apply the patch. This was patched with commit 033ab5b. Users of version 1.4.x should upgrade to version 1.4.3 when available. As a workaround changes of commit 033ab5b can be applied to older versions.",
  "repo": "mz-automation/libiec61850",
  "patch_hash": "033ab5b6488250c8c3b838f25a7cbc3e099230bb",
  "patch_info": {
    "commit_hash": "033ab5b6488250c8c3b838f25a7cbc3e099230bb",
    "repo": "mz-automation/libiec61850",
    "commit_url": "https://github.com/mz-automation/libiec61850/commit/033ab5b6488250c8c3b838f25a7cbc3e099230bb",
    "files": [
      "src/mms/iso_cotp/cotp.c"
    ],
    "message": "- COTP: fixed possible heap buffer overflow when handling message with invalid (zero) value in length field (#250)",
    "before_after_code_files": [
      "src/mms/iso_cotp/cotp.c||src/mms/iso_cotp/cotp.c"
    ]
  },
  "patch_diff": {
    "src/mms/iso_cotp/cotp.c||src/mms/iso_cotp/cotp.c": [
      "File: src/mms/iso_cotp/cotp.c -> src/mms/iso_cotp/cotp.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "720:             goto exit_waiting;",
      "721:     }",
      "723:     readBytes = readFromSocket(self, buffer + bufPos, self->packetSize - bufPos);",
      "725:     if (readBytes < 0)",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "723:     if (self->packetSize <= bufPos)",
      "724:         goto exit_error;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "88acbd49c443d35328d4503d59c663710052ceda",
      "candidate_info": {
        "commit_hash": "88acbd49c443d35328d4503d59c663710052ceda",
        "repo": "mz-automation/libiec61850",
        "commit_url": "https://github.com/mz-automation/libiec61850/commit/88acbd49c443d35328d4503d59c663710052ceda",
        "files": [
          "src/mms/iso_cotp/cotp.c"
        ],
        "message": "- COTP: fixed possible heap buffer overflow when handling message with invalid (zero) value in length field (#250)",
        "before_after_code_files": [
          "src/mms/iso_cotp/cotp.c||src/mms/iso_cotp/cotp.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "src/mms/iso_cotp/cotp.c||src/mms/iso_cotp/cotp.c"
          ],
          "candidate": [
            "src/mms/iso_cotp/cotp.c||src/mms/iso_cotp/cotp.c"
          ]
        }
      },
      "candidate_diff": {
        "src/mms/iso_cotp/cotp.c||src/mms/iso_cotp/cotp.c": [
          "File: src/mms/iso_cotp/cotp.c -> src/mms/iso_cotp/cotp.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "720:             goto exit_waiting;",
          "721:     }",
          "723:     readBytes = readFromSocket(self, buffer + bufPos, self->packetSize - bufPos);",
          "725:     if (readBytes < 0)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "723:     if (self->packetSize <= bufPos)",
          "724:         goto exit_error;",
          "",
          "---------------"
        ]
      }
    }
  ]
}