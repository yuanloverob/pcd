{
  "cve_id": "CVE-2024-4030",
  "cve_desc": "On Windows a directory returned by tempfile.mkdtemp() would not always have permissions set to restrict reading and writing to the temporary directory by other users, instead usually inheriting the correct permissions from the default location. Alternate configurations or users without a profile directory may not have the intended permissions.\n\nIf you\u2019re not using Windows or haven\u2019t changed the temporary directory location then you aren\u2019t affected by this vulnerability. On other platforms the returned directory is consistently readable and writable only by the current user.\n\nThis issue was caused by Python not supporting Unix permissions on Windows. The fix adds support for Unix \u201c700\u201d for the mkdir function on Windows which is used by mkdtemp() to ensure the newly created directory has the proper permissions.",
  "repo": "python/cpython",
  "patch_hash": "d86b49411753bf2c83291e3a14ae43fefded2f84",
  "patch_info": {
    "commit_hash": "d86b49411753bf2c83291e3a14ae43fefded2f84",
    "repo": "python/cpython",
    "commit_url": "https://github.com/python/cpython/commit/d86b49411753bf2c83291e3a14ae43fefded2f84",
    "files": [
      "Doc/whatsnew/3.13.rst",
      "Misc/NEWS.d/next/Security/2024-05-01-20-57-09.gh-issue-118486.K44KJG.rst"
    ],
    "message": "gh-118486: Update docs for CVE-2024-4030 reference (GH-118737)\n\nUpdate docs for CVE-2024-4030 reference",
    "before_after_code_files": []
  },
  "patch_diff": {},
  "candidates": [
    {
      "candidate_hash": "b8fd80f91b980598cb378dba224cdb595b132fb4",
      "candidate_info": {
        "commit_hash": "b8fd80f91b980598cb378dba224cdb595b132fb4",
        "repo": "python/cpython",
        "commit_url": "https://github.com/python/cpython/commit/b8fd80f91b980598cb378dba224cdb595b132fb4",
        "files": [
          "Doc/c-api/typeobj.rst",
          "Include/object.h",
          "Lib/test/test_type_cache.py",
          "Misc/NEWS.d/next/Core and Builtins/2024-06-19-11-10-50.gh-issue-119462.DpcqSe.rst",
          "Modules/_testcapimodule.c",
          "Modules/pyexpat.c",
          "Objects/typeobject.c"
        ],
        "message": "[3.13] GH-119462: Enforce invariants of type versioning. Backport of GH-120731. (#120748)\n\n* Remove uses of Py_TPFLAGS_VALID_VERSION_TAG",
        "before_after_code_files": [
          "Include/object.h||Include/object.h",
          "Lib/test/test_type_cache.py||Lib/test/test_type_cache.py",
          "Modules/_testcapimodule.c||Modules/_testcapimodule.c",
          "Modules/pyexpat.c||Modules/pyexpat.c",
          "Objects/typeobject.c||Objects/typeobject.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/AcreetionOS-Linux/python/pull/2"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "Include/object.h||Include/object.h": [
          "File: Include/object.h -> Include/object.h"
        ],
        "Lib/test/test_type_cache.py||Lib/test/test_type_cache.py": [
          "File: Lib/test/test_type_cache.py -> Lib/test/test_type_cache.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "92:         new_version = type_get_version(C)",
          "93:         self.assertEqual(new_version, 0)",
          "96: @support.cpython_only",
          "97: @requires_specialization",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "95:     def test_119462(self):",
          "97:         class Holder:",
          "98:             value = None",
          "100:             @classmethod",
          "101:             def set_value(cls):",
          "102:                 cls.value = object()",
          "104:         class HolderSub(Holder):",
          "105:             pass",
          "107:         for _ in range(1050):",
          "108:             Holder.set_value()",
          "109:             HolderSub.value",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "105:         if type_get_version(type_) == 0:",
          "106:             self.skipTest(\"Could not assign valid type version\")",
          "109:         type_modified(user_type)",
          "110:         type_assign_specific_version_unsafe(user_type, 0)",
          "111:         self.assertEqual(type_get_version(user_type), 0)",
          "",
          "[Removed Lines]",
          "108:     def _assign_and_check_version_0(self, user_type):",
          "",
          "[Added Lines]",
          "123:     def _no_more_versions(self, user_type):",
          "125:         for _ in range(1001):",
          "126:             type_assign_specific_version_unsafe(user_type, 1000_000_000)",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "135:         self._check_specialization(load_foo_1, A, \"LOAD_ATTR\", should_specialize=True)",
          "136:         del load_foo_1",
          "140:         def load_foo_2(type_):",
          "141:             return type_.foo",
          "",
          "[Removed Lines]",
          "138:         self._assign_and_check_version_0(A)",
          "",
          "[Added Lines]",
          "155:         self._no_more_versions(A)",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "186:         self._check_specialization(load_x_1, G(), \"LOAD_ATTR\", should_specialize=True)",
          "187:         del load_x_1",
          "191:         def load_x_2(instance):",
          "192:             instance.x",
          "",
          "[Removed Lines]",
          "189:         self._assign_and_check_version_0(G)",
          "",
          "[Added Lines]",
          "206:         self._no_more_versions(G)",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "205:         self._check_specialization(store_bar_1, B(), \"STORE_ATTR\", should_specialize=True)",
          "206:         del store_bar_1",
          "210:         def store_bar_2(type_):",
          "211:             type_.bar = 10",
          "",
          "[Removed Lines]",
          "208:         self._assign_and_check_version_0(B)",
          "",
          "[Added Lines]",
          "225:         self._no_more_versions(B)",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "225:         self._check_specialization(call_class_1, F, \"CALL\", should_specialize=True)",
          "226:         del call_class_1",
          "230:         def call_class_2(type_):",
          "231:             type_()",
          "",
          "[Removed Lines]",
          "228:         self._assign_and_check_version_0(F)",
          "",
          "[Added Lines]",
          "245:         self._no_more_versions(F)",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "244:         self._check_specialization(to_bool_1, H(), \"TO_BOOL\", should_specialize=True)",
          "245:         del to_bool_1",
          "249:         def to_bool_2(instance):",
          "250:             not instance",
          "",
          "[Removed Lines]",
          "247:         self._assign_and_check_version_0(H)",
          "",
          "[Added Lines]",
          "264:         self._no_more_versions(H)",
          "",
          "---------------"
        ],
        "Modules/_testcapimodule.c||Modules/_testcapimodule.c": [
          "File: Modules/_testcapimodule.c -> Modules/_testcapimodule.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2415:     }",
          "2416:     assert(!PyType_HasFeature(type, Py_TPFLAGS_IMMUTABLETYPE));",
          "2417:     type->tp_version_tag = version;",
          "2419:     Py_RETURN_NONE;",
          "2420: }",
          "",
          "[Removed Lines]",
          "2418:     type->tp_flags |= Py_TPFLAGS_VALID_VERSION_TAG;",
          "",
          "[Added Lines]",
          "2418:     type->tp_versions_used++;",
          "",
          "---------------"
        ],
        "Modules/pyexpat.c||Modules/pyexpat.c": [
          "File: Modules/pyexpat.c -> Modules/pyexpat.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1651: static int init_handler_descrs(pyexpat_state *state)",
          "1652: {",
          "1653:     int i;",
          "1655:     for (i = 0; handler_info[i].name != NULL; i++) {",
          "1656:         struct HandlerInfo *hi = &handler_info[i];",
          "1657:         hi->getset.name = hi->name;",
          "",
          "[Removed Lines]",
          "1654:     assert(!PyType_HasFeature(state->xml_parse_type, Py_TPFLAGS_VALID_VERSION_TAG));",
          "",
          "[Added Lines]",
          "1654:     assert(state->xml_parse_type->tp_version_tag == 0);",
          "",
          "---------------"
        ],
        "Objects/typeobject.c||Objects/typeobject.c": [
          "File: Objects/typeobject.c -> Objects/typeobject.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "973:     return 0;",
          "974: }",
          "978: static void",
          "980: {",
          "981:     ASSERT_TYPE_LOCK_HELD();",
          "990:     }",
          "1006:     }",
          "1012: #endif",
          "1014: static void",
          "1015: type_modified_unlocked(PyTypeObject *type)",
          "",
          "[Removed Lines]",
          "976: #ifdef Py_GIL_DISABLED",
          "979: type_modification_starting_unlocked(PyTypeObject *type)",
          "984:        version tag intact.  This prepares for a modification so that",
          "985:        any concurrent readers of the type cache will not see invalid",
          "986:        values.",
          "988:     if (!_PyType_HasFeature(type, Py_TPFLAGS_VALID_VERSION_TAG)) {",
          "989:         return;",
          "992:     PyObject *subclasses = lookup_tp_subclasses(type);",
          "993:     if (subclasses != NULL) {",
          "994:         assert(PyDict_CheckExact(subclasses));",
          "996:         Py_ssize_t i = 0;",
          "997:         PyObject *ref;",
          "998:         while (PyDict_Next(subclasses, &i, NULL, &ref)) {",
          "999:             PyTypeObject *subclass = type_from_ref(ref);",
          "1000:             if (subclass == NULL) {",
          "1001:                 continue;",
          "1002:             }",
          "1003:             type_modification_starting_unlocked(subclass);",
          "1004:             Py_DECREF(subclass);",
          "1005:         }",
          "1009:     _Py_atomic_store_uint32_release(&type->tp_version_tag, 0);",
          "1010: }",
          "",
          "[Added Lines]",
          "977: set_version_unlocked(PyTypeObject *tp, unsigned int version)",
          "980: #ifndef Py_GIL_DISABLED",
          "981:     if (version) {",
          "982:         tp->tp_versions_used++;",
          "984: #else",
          "985:     if (version) {",
          "986:         _Py_atomic_add_uint16(&tp->tp_versions_used, 1);",
          "989:     FT_ATOMIC_STORE_UINT32_RELAXED(tp->tp_version_tag, version);",
          "990: }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1021:        Invariants:",
          "1024:          it must first be set on all super types.",
          "1027:        type (so it must first clear it on all subclasses).  The",
          "1029:        We don't assign new version tags eagerly, but only as",
          "1030:        needed.",
          "1033:         return;",
          "1034:     }",
          "",
          "[Removed Lines]",
          "1023:        - before Py_TPFLAGS_VALID_VERSION_TAG can be set on a type,",
          "1026:        This function clears the Py_TPFLAGS_VALID_VERSION_TAG of a",
          "1028:        tp_version_tag value is meaningless unless this flag is set.",
          "1032:     if (!_PyType_HasFeature(type, Py_TPFLAGS_VALID_VERSION_TAG)) {",
          "",
          "[Added Lines]",
          "1001:        - before tp_version_tag can be set on a type,",
          "1004:        This function clears the tp_version_tag of a",
          "1006:        tp_version_tag value is meaningless when equal to zero.",
          "1010:     if (type->tp_version_tag == 0) {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1069:         }",
          "1070:     }",
          "1074:     if (PyType_HasFeature(type, Py_TPFLAGS_HEAPTYPE)) {",
          "",
          "[Removed Lines]",
          "1072:     type->tp_flags &= ~Py_TPFLAGS_VALID_VERSION_TAG;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1082: PyType_Modified(PyTypeObject *type)",
          "1083: {",
          "1086:         return;",
          "1087:     }",
          "",
          "[Removed Lines]",
          "1085:     if (!_PyType_HasFeature(type, Py_TPFLAGS_VALID_VERSION_TAG)) {",
          "",
          "[Added Lines]",
          "1062:     if (type->tp_version_tag == 0) {",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1147:  clear:",
          "1148:     assert(!(type->tp_flags & _Py_TPFLAGS_STATIC_BUILTIN));",
          "1151:     if (PyType_HasFeature(type, Py_TPFLAGS_HEAPTYPE)) {",
          "",
          "[Removed Lines]",
          "1149:     type->tp_flags &= ~Py_TPFLAGS_VALID_VERSION_TAG;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "1162: {",
          "1163:     ASSERT_TYPE_LOCK_HELD();",
          "1171:         return 1;",
          "1172:     }",
          "1173:     if (!_PyType_HasFeature(type, Py_TPFLAGS_READY)) {",
          "",
          "[Removed Lines]",
          "1166:        Py_TPFLAGS_VALID_VERSION_TAG.  To respect the invariant, this",
          "1167:        must first be done on all super classes.  Return 0 if this",
          "1168:        cannot be done, 1 if Py_TPFLAGS_VALID_VERSION_TAG.",
          "1170:     if (_PyType_HasFeature(type, Py_TPFLAGS_VALID_VERSION_TAG)) {",
          "",
          "[Added Lines]",
          "1145:     if (type->tp_version_tag != 0) {",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "1176:     if (type->tp_versions_used >= MAX_VERSIONS_PER_CLASS) {",
          "1177:         return 0;",
          "1178:     }",
          "1180:     if (type->tp_flags & Py_TPFLAGS_IMMUTABLETYPE) {",
          "1182:         if (NEXT_GLOBAL_VERSION_TAG > _Py_MAX_GLOBAL_TYPE_VERSION_TAG) {",
          "1184:             return 0;",
          "1185:         }",
          "1188:         assert (type->tp_version_tag <= _Py_MAX_GLOBAL_TYPE_VERSION_TAG);",
          "1189:     }",
          "1190:     else {",
          "",
          "[Removed Lines]",
          "1179:     type->tp_versions_used++;",
          "1186:         FT_ATOMIC_STORE_UINT32_RELAXED(type->tp_version_tag,",
          "1187:                                        NEXT_GLOBAL_VERSION_TAG++);",
          "",
          "[Added Lines]",
          "1155:     PyObject *bases = lookup_tp_bases(type);",
          "1156:     Py_ssize_t n = PyTuple_GET_SIZE(bases);",
          "1157:     for (Py_ssize_t i = 0; i < n; i++) {",
          "1158:         PyObject *b = PyTuple_GET_ITEM(bases, i);",
          "1159:         if (!assign_version_tag(interp, _PyType_CAST(b))) {",
          "1160:             return 0;",
          "1161:         }",
          "1162:     }",
          "1169:         set_version_unlocked(type, NEXT_GLOBAL_VERSION_TAG++);",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "1194:             return 0;",
          "1195:         }",
          "1198:         assert (type->tp_version_tag != 0);",
          "1199:     }",
          "1209:     return 1;",
          "1210: }",
          "",
          "[Removed Lines]",
          "1196:         FT_ATOMIC_STORE_UINT32_RELAXED(type->tp_version_tag,",
          "1197:                                        NEXT_VERSION_TAG(interp)++);",
          "1201:     PyObject *bases = lookup_tp_bases(type);",
          "1202:     Py_ssize_t n = PyTuple_GET_SIZE(bases);",
          "1203:     for (Py_ssize_t i = 0; i < n; i++) {",
          "1204:         PyObject *b = PyTuple_GET_ITEM(bases, i);",
          "1205:         if (!assign_version_tag(interp, _PyType_CAST(b)))",
          "1206:             return 0;",
          "1207:     }",
          "1208:     type->tp_flags |= Py_TPFLAGS_VALID_VERSION_TAG;",
          "",
          "[Added Lines]",
          "1178:         set_version_unlocked(type, NEXT_VERSION_TAG(interp)++);",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "3126:     else {",
          "3130:     }",
          "3132:     if (p_old_mro != NULL)",
          "",
          "[Removed Lines]",
          "3129:         assert(_PyType_HasFeature(type, Py_TPFLAGS_VALID_VERSION_TAG));",
          "",
          "[Added Lines]",
          "3101:         assert(type->tp_version_tag);",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "5275: #else",
          "5276:     if (entry->version == type->tp_version_tag &&",
          "5277:         entry->name == name) {",
          "5279:         OBJECT_STAT_INC_COND(type_cache_hits, !is_dunder_name(name));",
          "5280:         OBJECT_STAT_INC_COND(type_cache_dunder_hits, is_dunder_name(name));",
          "5281:         Py_XINCREF(entry->value);",
          "",
          "[Removed Lines]",
          "5278:         assert(_PyType_HasFeature(type, Py_TPFLAGS_VALID_VERSION_TAG));",
          "",
          "[Added Lines]",
          "5250:         assert(type->tp_version_tag);",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "5298:     if (MCACHE_CACHEABLE_NAME(name)) {",
          "5299:         has_version = assign_version_tag(interp, type);",
          "5300:         version = type->tp_version_tag;",
          "5302:     }",
          "5303:     END_TYPE_LOCK()",
          "",
          "[Removed Lines]",
          "5301:         assert(!has_version || _PyType_HasFeature(type, Py_TPFLAGS_VALID_VERSION_TAG));",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "5582:         return -1;",
          "5583:     }",
          "5596:         subclasses.  This could possibly be unified with the",
          "5597:         update_subclasses() recursion in update_slot(), but carefully:",
          "",
          "[Removed Lines]",
          "5585: #ifdef Py_GIL_DISABLED",
          "5590:     type_modification_starting_unlocked(type);",
          "5591: #endif",
          "5593:     res = _PyDict_SetItem_LockHeld((PyDictObject *)dict, name, value);",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "5600:     type_modified_unlocked(type);",
          "5602:     if (res == 0) {",
          "5603:         if (is_dunder_name(name)) {",
          "5604:             res = update_slot(type, name);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "5563:     res = _PyDict_SetItem_LockHeld((PyDictObject *)dict, name, value);",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "5711:     if (final) {",
          "5712:         type->tp_flags &= ~Py_TPFLAGS_READY;",
          "5714:         type->tp_version_tag = 0;",
          "5715:     }",
          "",
          "[Removed Lines]",
          "5713:         type->tp_flags &= ~Py_TPFLAGS_VALID_VERSION_TAG;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "8330:         assert(NEXT_GLOBAL_VERSION_TAG <= _Py_MAX_GLOBAL_TYPE_VERSION_TAG);",
          "8331:         self->tp_version_tag = NEXT_GLOBAL_VERSION_TAG++;",
          "8333:     }",
          "8334:     else {",
          "8335:         assert(!initial);",
          "8336:         assert(self->tp_flags & _Py_TPFLAGS_STATIC_BUILTIN);",
          "8338:     }",
          "8340:     managed_static_type_state_init(interp, self, isbuiltin, initial);",
          "",
          "[Removed Lines]",
          "8332:         self->tp_flags |= Py_TPFLAGS_VALID_VERSION_TAG;",
          "8337:         assert(self->tp_flags & Py_TPFLAGS_VALID_VERSION_TAG);",
          "",
          "[Added Lines]",
          "8298:         assert(self->tp_version_tag != 0);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "660125f864aa533b68a6ccbe11e35f0353388d56",
      "candidate_info": {
        "commit_hash": "660125f864aa533b68a6ccbe11e35f0353388d56",
        "repo": "python/cpython",
        "commit_url": "https://github.com/python/cpython/commit/660125f864aa533b68a6ccbe11e35f0353388d56",
        "files": [
          "Lib/test/test_import/__init__.py",
          "Modules/_testsinglephase.c",
          "Python/import.c"
        ],
        "message": "[3.13] gh-119584: Fix test_import Failed Assertion (gh-119623) (gh-119633)\n\nThe fix in gh-119561 introduced an assertion that doesn't hold true if any of the three new test extension modules are loaded more than once.  This is fine normally but breaks if the new test_check_state_first() is run more than once, which happens for refleak checking and with the regrtest --forever flag.  We fix that here by clearing each of the three modules after loading them.  We also tweak a check in _modules_by_index_check().\n\n(cherry picked from commit ae7b17673f29efe17b416cbcfbf43b5b3ff5977c)\n\nCo-authored-by: Eric Snow <ericsnowcurrently@gmail.com>",
        "before_after_code_files": [
          "Lib/test/test_import/__init__.py||Lib/test/test_import/__init__.py",
          "Modules/_testsinglephase.c||Modules/_testsinglephase.c",
          "Python/import.c||Python/import.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/AcreetionOS-Linux/python/pull/2"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "Lib/test/test_import/__init__.py||Lib/test/test_import/__init__.py": [
          "File: Lib/test/test_import/__init__.py -> Lib/test/test_import/__init__.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "2888:                 self.assertIs(reloaded.snapshot.cached, reloaded.module)",
          "2890:     def test_check_state_first(self):",
          "2891:         for variant in ['', '_with_reinit', '_with_state']:",
          "2892:             name = f'{self.NAME}{variant}_check_cache_first'",
          "2893:             with self.subTest(name):",
          "2894:                 mod = self._load_dynamic(name, self.ORIGIN)",
          "2895:                 self.assertEqual(mod.__name__, name)",
          "2897:     # Currently, for every single-phrase init module loaded",
          "2898:     # in multiple interpreters, those interpreters share a",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2890:     @unittest.skipIf(_testinternalcapi is None, \"requires _testinternalcapi\")",
          "2897:                 sys.modules.pop(name, None)",
          "2898:                 _testinternalcapi.clear_extension(name, self.ORIGIN)",
          "",
          "---------------"
        ],
        "Modules/_testsinglephase.c||Modules/_testsinglephase.c": [
          "File: Modules/_testsinglephase.c -> Modules/_testsinglephase.c"
        ],
        "Python/import.c||Python/import.c": [
          "File: Python/import.c -> Python/import.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "494:     if (MODULES_BY_INDEX(interp) == NULL) {",
          "495:         return \"Interpreters module-list not accessible.\";",
          "496:     }",
          "498:         return \"Module index out of bounds.\";",
          "499:     }",
          "500:     return NULL;",
          "",
          "[Removed Lines]",
          "497:     if (index > PyList_GET_SIZE(MODULES_BY_INDEX(interp))) {",
          "",
          "[Added Lines]",
          "497:     if (index >= PyList_GET_SIZE(MODULES_BY_INDEX(interp))) {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2184:     def->m_base.m_init = NULL;",
          "2185:     Py_CLEAR(def->m_base.m_copy);",
          "2189:     Py_ssize_t index = _get_cached_module_index(cached);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2186:     def->m_base.m_index = 0;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "14ff4c979c8564376707de4b5a84dd3e4fcb5d1d",
      "candidate_info": {
        "commit_hash": "14ff4c979c8564376707de4b5a84dd3e4fcb5d1d",
        "repo": "python/cpython",
        "commit_url": "https://github.com/python/cpython/commit/14ff4c979c8564376707de4b5a84dd3e4fcb5d1d",
        "files": [
          "Modules/_zoneinfo.c"
        ],
        "message": "[3.13] gh-120155: Fix Coverity issue in zoneinfo load_data() (GH-120232) (#120310)\n\ngh-120155: Fix Coverity issue in zoneinfo load_data() (GH-120232)\n\nDeclare the 'rv' varaible at the top of the load_data() function to\nmake sure that it's initialized before the first 'goto error' which\nuses 'rv' (return rv).\n\nFix the Coverity issue:\n\nError: UNINIT (CWE-457):\nPython-3.12.2/Modules/_zoneinfo.c:1233:5: skipped_decl: Jumping over declaration of \"\"rv\"\".\nPython-3.12.2/Modules/_zoneinfo.c:1284:5: uninit_use: Using uninitialized value \"\"rv\"\".\n  1282|       }\n  1283|\n  1284|->     return rv;\n  1285|   }\n  1286|\n(cherry picked from commit b90bd3e5bbc136f53b24ee791824acd6b17e0d42)\n\nCo-authored-by: Victor Stinner <vstinner@python.org>",
        "before_after_code_files": [
          "Modules/_zoneinfo.c||Modules/_zoneinfo.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/AcreetionOS-Linux/python/pull/2"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "Modules/_zoneinfo.c||Modules/_zoneinfo.c": [
          "File: Modules/_zoneinfo.c -> Modules/_zoneinfo.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "944: static int",
          "945: load_data(zoneinfo_state *state, PyZoneInfo_ZoneInfo *self, PyObject *file_obj)",
          "946: {",
          "947:     PyObject *data_tuple = NULL;",
          "949:     long *utcoff = NULL;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "947:     int rv = 0;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1220:         }",
          "1221:     }",
          "1224:     goto cleanup;",
          "1225: error:",
          "",
          "[Removed Lines]",
          "1223:     int rv = 0;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "4f81915cf59389b4ac03972561b53ea2b662696f",
      "candidate_info": {
        "commit_hash": "4f81915cf59389b4ac03972561b53ea2b662696f",
        "repo": "python/cpython",
        "commit_url": "https://github.com/python/cpython/commit/4f81915cf59389b4ac03972561b53ea2b662696f",
        "files": [
          "Lib/tkinter/__init__.py",
          "Misc/NEWS.d/next/Library/2024-05-08-21-13-56.gh-issue-118760.mdmH3T.rst"
        ],
        "message": "[3.13] gh-118760: Fix errors in calling Tkinter bindings on Windows (GH-118782) (GH-119072)\n\nFor unknown reasons some arguments for Tkinter binding can be created\nas a 1-tuple containing a Tcl_Obj when wantobjects is 2.\n(cherry picked from commit 5b88d95cc542cf02303c6fe0e8719a93544decdb)\n\nCo-authored-by: Serhiy Storchaka <storchaka@gmail.com>",
        "before_after_code_files": [
          "Lib/tkinter/__init__.py||Lib/tkinter/__init__.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/AcreetionOS-Linux/python/pull/2"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "Lib/tkinter/__init__.py||Lib/tkinter/__init__.py": [
          "File: Lib/tkinter/__init__.py -> Lib/tkinter/__init__.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "1727:             except (ValueError, TclError):",
          "1728:                 return s",
          "1730:         nsign, b, f, h, k, s, t, w, x, y, A, E, K, N, W, T, X, Y, D = args",
          "1731:         # Missing: (a, c, d, m, o, v, B, R)",
          "1732:         e = Event()",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1730:         if any(isinstance(s, tuple) for s in args):",
          "1731:             args = [s[0] if isinstance(s, tuple) and len(s) == 1 else s",
          "1732:                     for s in args]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "6df49134b3f59a84c6d9a3883b23fa2873db2534",
      "candidate_info": {
        "commit_hash": "6df49134b3f59a84c6d9a3883b23fa2873db2534",
        "repo": "python/cpython",
        "commit_url": "https://github.com/python/cpython/commit/6df49134b3f59a84c6d9a3883b23fa2873db2534",
        "files": [
          "Include/internal/pycore_typevarobject.h",
          "Lib/test/test_typing.py",
          "Misc/NEWS.d/next/Library/2024-05-10-05-24-32.gh-issue-118895.wUm5r2.rst",
          "Modules/_typingmodule.c"
        ],
        "message": "[3.13] gh-118895: Call PyType_Ready() on typing.NoDefault (GH-118897) (#118914)\n\n(cherry picked from commit 13d7cf997bc9c22cf67c42fd799413e8325e0039)\n\nCo-authored-by: Jelle Zijlstra <jelle.zijlstra@gmail.com>",
        "before_after_code_files": [
          "Include/internal/pycore_typevarobject.h||Include/internal/pycore_typevarobject.h",
          "Lib/test/test_typing.py||Lib/test/test_typing.py",
          "Modules/_typingmodule.c||Modules/_typingmodule.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/AcreetionOS-Linux/python/pull/2"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "Include/internal/pycore_typevarobject.h||Include/internal/pycore_typevarobject.h": [
          "File: Include/internal/pycore_typevarobject.h -> Include/internal/pycore_typevarobject.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "18: extern void _Py_clear_generic_types(PyInterpreterState *);",
          "20: extern PyTypeObject _PyTypeAlias_Type;",
          "21: extern PyObject _Py_NoDefaultStruct;",
          "23: #ifdef __cplusplus",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "21: extern PyTypeObject _PyNoDefault_Type;",
          "",
          "---------------"
        ],
        "Lib/test/test_typing.py||Lib/test/test_typing.py": [
          "File: Lib/test/test_typing.py -> Lib/test/test_typing.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "45: import weakref",
          "46: import types",
          "49: from test.typinganndata import ann_module695, mod_generics_cache, _typed_dict_helper",
          "",
          "[Removed Lines]",
          "48: from test.support import captured_stderr, cpython_only, infinite_recursion",
          "",
          "[Added Lines]",
          "48: from test.support import captured_stderr, cpython_only, infinite_recursion, requires_docstrings",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "10247:     def test_constructor(self):",
          "10248:         self.assertIs(NoDefault, type(NoDefault)())",
          "10249:         with self.assertRaises(TypeError):",
          "10252:     def test_repr(self):",
          "10253:         self.assertEqual(repr(NoDefault), 'typing.NoDefault')",
          "10255:     def test_no_call(self):",
          "10256:         with self.assertRaises(TypeError):",
          "10257:             NoDefault()",
          "10260: class AllTests(BaseTestCase):",
          "10261:     \"\"\"Tests for __all__.\"\"\"",
          "",
          "[Removed Lines]",
          "10250:             NoDefault(1)",
          "",
          "[Added Lines]",
          "10250:             type(NoDefault)(1)",
          "10255:     @requires_docstrings",
          "10256:     def test_doc(self):",
          "10257:         self.assertIsInstance(NoDefault.__doc__, str)",
          "10259:     def test_class(self):",
          "10260:         self.assertIs(NoDefault.__class__, type(NoDefault))",
          "10266:     def test_no_attributes(self):",
          "10267:         with self.assertRaises(AttributeError):",
          "10268:             NoDefault.foo = 3",
          "10269:         with self.assertRaises(AttributeError):",
          "10270:             NoDefault.foo",
          "10272:         # TypeError is consistent with the behavior of NoneType",
          "10273:         with self.assertRaises(TypeError):",
          "10274:             type(NoDefault).foo = 3",
          "10275:         with self.assertRaises(AttributeError):",
          "10276:             type(NoDefault).foo",
          "",
          "---------------"
        ],
        "Modules/_typingmodule.c||Modules/_typingmodule.c": [
          "File: Modules/_typingmodule.c -> Modules/_typingmodule.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "63:     if (PyModule_AddObjectRef(m, \"TypeAliasType\", (PyObject *)&_PyTypeAlias_Type) < 0) {",
          "64:         return -1;",
          "65:     }",
          "66:     if (PyModule_AddObjectRef(m, \"NoDefault\", (PyObject *)&_Py_NoDefaultStruct) < 0) {",
          "67:         return -1;",
          "68:     }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "66:     if (PyType_Ready(&_PyNoDefault_Type) < 0) {",
          "67:         return -1;",
          "68:     }",
          "",
          "---------------"
        ]
      }
    }
  ]
}