{
  "cve_id": "CVE-2023-25673",
  "cve_desc": "TensorFlow is an open source platform for machine learning. Versions prior to 2.12.0 and 2.11.1 have a Floating Point Exception in TensorListSplit with XLA. A fix is included in TensorFlow version 2.12.0 and version 2.11.1.\n",
  "repo": "tensorflow/tensorflow",
  "patch_hash": "728113a3be690facad6ce436660a0bc1858017fa",
  "patch_info": {
    "commit_hash": "728113a3be690facad6ce436660a0bc1858017fa",
    "repo": "tensorflow/tensorflow",
    "commit_url": "https://github.com/tensorflow/tensorflow/commit/728113a3be690facad6ce436660a0bc1858017fa",
    "files": [
      "tensorflow/compiler/tests/tensor_list_ops_test.py",
      "tensorflow/compiler/tf2xla/kernels/tensor_list_ops.cc"
    ],
    "message": "[Tensorflow] Fix security vulnerability with TensorListSplitOp\n\nPiperOrigin-RevId: 506441188",
    "before_after_code_files": [
      "tensorflow/compiler/tests/tensor_list_ops_test.py||tensorflow/compiler/tests/tensor_list_ops_test.py",
      "tensorflow/compiler/tf2xla/kernels/tensor_list_ops.cc||tensorflow/compiler/tf2xla/kernels/tensor_list_ops.cc"
    ]
  },
  "patch_diff": {
    "tensorflow/compiler/tests/tensor_list_ops_test.py||tensorflow/compiler/tests/tensor_list_ops_test.py": [
      "File: tensorflow/compiler/tests/tensor_list_ops_test.py -> tensorflow/compiler/tests/tensor_list_ops_test.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "236:       self.assertAllEqual(z.shape.as_list(), [None])",
      "237:       self.assertAllEqual(z, [0.0, 0.0])",
      "239: if __name__ == \"__main__\":",
      "240:   os.environ[\"TF_XLA_FLAGS\"] = (\"--tf_xla_min_cluster_size=2 \" +",
      "241:                                 os.environ.get(\"TF_XLA_FLAGS\", \"\"))",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "239:   def testInvalidSplitLength(self):",
      "240:     with self.session(), self.test_scope():",
      "241:       tensor_list_split = list_ops.tensor_list_split(",
      "242:           tensor=[1], element_shape=[-1], lengths=[0]",
      "243:       )",
      "244:       with self.assertRaisesRegex(",
      "245:           errors.UnimplementedError, \"All lengths must be positive\"",
      "246:       ):",
      "247:         self.evaluate(tensor_list_split)",
      "",
      "---------------"
    ],
    "tensorflow/compiler/tf2xla/kernels/tensor_list_ops.cc||tensorflow/compiler/tf2xla/kernels/tensor_list_ops.cc": [
      "File: tensorflow/compiler/tf2xla/kernels/tensor_list_ops.cc -> tensorflow/compiler/tf2xla/kernels/tensor_list_ops.cc",
      "--- Hunk 1 ---",
      "[Context before]",
      "553:       OP_REQUIRES(ctx, len == length,",
      "554:                   errors::Unimplemented(\"All lengths have to be the same\"));",
      "555:     }",
      "556:     OP_REQUIRES(",
      "557:         ctx, element_dims[0] % length == 0,",
      "558:         errors::Unimplemented(\"Buffer size has to be a multiple of length\"));",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "556:     OP_REQUIRES(ctx, length,",
      "557:                 errors::Unimplemented(\"All lengths must be positive\"));",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "076f909b70b251daea6c443c9b1929b9745aed20",
      "candidate_info": {
        "commit_hash": "076f909b70b251daea6c443c9b1929b9745aed20",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/076f909b70b251daea6c443c9b1929b9745aed20",
        "files": [
          "tensorflow/compiler/tf2xla/kernels/tensor_list_ops.cc"
        ],
        "message": "fix boolean expression in length check\n\nPiperOrigin-RevId: 513891216",
        "before_after_code_files": [
          "tensorflow/compiler/tf2xla/kernels/tensor_list_ops.cc||tensorflow/compiler/tf2xla/kernels/tensor_list_ops.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/compiler/tf2xla/kernels/tensor_list_ops.cc||tensorflow/compiler/tf2xla/kernels/tensor_list_ops.cc"
          ],
          "candidate": [
            "tensorflow/compiler/tf2xla/kernels/tensor_list_ops.cc||tensorflow/compiler/tf2xla/kernels/tensor_list_ops.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/compiler/tf2xla/kernels/tensor_list_ops.cc||tensorflow/compiler/tf2xla/kernels/tensor_list_ops.cc": [
          "File: tensorflow/compiler/tf2xla/kernels/tensor_list_ops.cc -> tensorflow/compiler/tf2xla/kernels/tensor_list_ops.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "553:       OP_REQUIRES(ctx, len == length,",
          "554:                   errors::Unimplemented(\"All lengths have to be the same\"));",
          "555:     }",
          "557:                 errors::Unimplemented(\"All lengths must be positive\"));",
          "558:     OP_REQUIRES(",
          "559:         ctx, element_dims[0] % length == 0,",
          "",
          "[Removed Lines]",
          "556:     OP_REQUIRES(ctx, length,",
          "",
          "[Added Lines]",
          "556:     OP_REQUIRES(ctx, length > 0,",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "53fccb429a53b52ed03de4efcda45afe1cee924e",
      "candidate_info": {
        "commit_hash": "53fccb429a53b52ed03de4efcda45afe1cee924e",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/53fccb429a53b52ed03de4efcda45afe1cee924e",
        "files": [
          "tensorflow/compiler/tests/tensor_list_ops_test.py",
          "tensorflow/compiler/tf2xla/kernels/tensor_list_ops.cc"
        ],
        "message": "[Tensorflow] Fix security vulnerability with TensorListSplitOp\n\nPiperOrigin-RevId: 506441188",
        "before_after_code_files": [
          "tensorflow/compiler/tests/tensor_list_ops_test.py||tensorflow/compiler/tests/tensor_list_ops_test.py",
          "tensorflow/compiler/tf2xla/kernels/tensor_list_ops.cc||tensorflow/compiler/tf2xla/kernels/tensor_list_ops.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/compiler/tests/tensor_list_ops_test.py||tensorflow/compiler/tests/tensor_list_ops_test.py",
            "tensorflow/compiler/tf2xla/kernels/tensor_list_ops.cc||tensorflow/compiler/tf2xla/kernels/tensor_list_ops.cc"
          ],
          "candidate": [
            "tensorflow/compiler/tests/tensor_list_ops_test.py||tensorflow/compiler/tests/tensor_list_ops_test.py",
            "tensorflow/compiler/tf2xla/kernels/tensor_list_ops.cc||tensorflow/compiler/tf2xla/kernels/tensor_list_ops.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/compiler/tests/tensor_list_ops_test.py||tensorflow/compiler/tests/tensor_list_ops_test.py": [
          "File: tensorflow/compiler/tests/tensor_list_ops_test.py -> tensorflow/compiler/tests/tensor_list_ops_test.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "236:       self.assertAllEqual(z.shape.as_list(), [None])",
          "237:       self.assertAllEqual(z, [0.0, 0.0])",
          "239: if __name__ == \"__main__\":",
          "240:   os.environ[\"TF_XLA_FLAGS\"] = (\"--tf_xla_min_cluster_size=2 \" +",
          "241:                                 os.environ.get(\"TF_XLA_FLAGS\", \"\"))",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "239:   def testInvalidSplitLength(self):",
          "240:     with self.session(), self.test_scope():",
          "241:       tensor_list_split = list_ops.tensor_list_split(",
          "242:           tensor=[1], element_shape=[-1], lengths=[0]",
          "243:       )",
          "244:       with self.assertRaisesRegex(",
          "245:           errors.UnimplementedError, \"All lengths must be positive\"",
          "246:       ):",
          "247:         self.evaluate(tensor_list_split)",
          "",
          "---------------"
        ],
        "tensorflow/compiler/tf2xla/kernels/tensor_list_ops.cc||tensorflow/compiler/tf2xla/kernels/tensor_list_ops.cc": [
          "File: tensorflow/compiler/tf2xla/kernels/tensor_list_ops.cc -> tensorflow/compiler/tf2xla/kernels/tensor_list_ops.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "553:       OP_REQUIRES(ctx, len == length,",
          "554:                   errors::Unimplemented(\"All lengths have to be the same\"));",
          "555:     }",
          "556:     OP_REQUIRES(",
          "557:         ctx, element_dims[0] % length == 0,",
          "558:         errors::Unimplemented(\"Buffer size has to be a multiple of length\"));",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "556:     OP_REQUIRES(ctx, length,",
          "557:                 errors::Unimplemented(\"All lengths must be positive\"));",
          "",
          "---------------"
        ]
      }
    }
  ]
}