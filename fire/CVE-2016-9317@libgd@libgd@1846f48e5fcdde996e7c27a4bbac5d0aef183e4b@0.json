{
  "cve_id": "CVE-2016-9317",
  "cve_desc": "The gdImageCreate function in the GD Graphics Library (aka libgd) before 2.2.4 allows remote attackers to cause a denial of service (system hang) via an oversized image.",
  "repo": "libgd/libgd",
  "patch_hash": "1846f48e5fcdde996e7c27a4bbac5d0aef183e4b",
  "patch_info": {
    "commit_hash": "1846f48e5fcdde996e7c27a4bbac5d0aef183e4b",
    "repo": "libgd/libgd",
    "commit_url": "https://github.com/libgd/libgd/commit/1846f48e5fcdde996e7c27a4bbac5d0aef183e4b",
    "files": [
      "src/gd.c",
      "tests/CMakeLists.txt",
      "tests/Makefile.am",
      "tests/gdimagecreate/.gitignore",
      "tests/gdimagecreate/CMakeLists.txt",
      "tests/gdimagecreate/Makemodule.am",
      "tests/gdimagecreate/bug00340.c"
    ],
    "message": "Fix #340: System frozen\n\ngdImageCreate() doesn't check for oversized images and as such is prone\nto DoS vulnerabilities. We fix that by applying the same overflow check\nthat is already in place for gdImageCreateTrueColor().\n\nCVE-2016-9317",
    "before_after_code_files": [
      "src/gd.c||src/gd.c",
      "tests/Makefile.am||tests/Makefile.am",
      "tests/gdimagecreate/Makemodule.am||tests/gdimagecreate/Makemodule.am",
      "tests/gdimagecreate/bug00340.c||tests/gdimagecreate/bug00340.c"
    ]
  },
  "patch_diff": {
    "src/gd.c||src/gd.c": [
      "File: src/gd.c -> src/gd.c"
    ],
    "tests/Makefile.am||tests/Makefile.am": [
      "File: tests/Makefile.am -> tests/Makefile.am",
      "--- Hunk 1 ---",
      "[Context before]",
      "33: include gdimagecopy/Makemodule.am",
      "34: include gdimagecopyresampled/Makemodule.am",
      "35: include gdimagecopyrotated/Makemodule.am",
      "36: include gdimagecrop/Makemodule.am",
      "37: include gdimagefile/Makemodule.am",
      "38: include gdimagefill/Makemodule.am",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "36: include gdimagecreate/Makemodule.am",
      "",
      "---------------"
    ],
    "tests/gdimagecreate/Makemodule.am||tests/gdimagecreate/Makemodule.am": [
      "File: tests/gdimagecreate/Makemodule.am -> tests/gdimagecreate/Makemodule.am",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: libgd_test_programs += \\",
      "2:  gdimagecreate/bug00340",
      "4: EXTRA_DIST += \\",
      "5:  gdimagecreate/CMakeLists.txt",
      "",
      "---------------"
    ],
    "tests/gdimagecreate/bug00340.c||tests/gdimagecreate/bug00340.c": [
      "File: tests/gdimagecreate/bug00340.c -> tests/gdimagecreate/bug00340.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "9: #include <string.h>",
      "10: #include \"gd.h\"",
      "11: #include \"gd_errors.h\"",
      "12: #include \"gdtest.h\"",
      "15: #define MSG \"product of memory allocation multiplication would exceed INT_MAX, failing operation gracefully\\n\"",
      "18: void error_handler(int priority, const char *format, ...)",
      "19: {",
      "20:     gdTestAssert(priority == GD_WARNING);",
      "21:     gdTestAssert(!strcmp(format, MSG));",
      "22: }",
      "25: int main()",
      "26: {",
      "27:     gdImagePtr im;",
      "29:     im = gdImageCreate(64970, 65111);",
      "30:     gdTestAssert(im == NULL);",
      "32:     return gdNumFailures();",
      "33: }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "6944ea10cb730d5071620439c6c2e823e6caeff1",
      "candidate_info": {
        "commit_hash": "6944ea10cb730d5071620439c6c2e823e6caeff1",
        "repo": "libgd/libgd",
        "commit_url": "https://github.com/libgd/libgd/commit/6944ea10cb730d5071620439c6c2e823e6caeff1",
        "files": [
          "src/gd.c",
          "tests/CMakeLists.txt",
          "tests/Makefile.am",
          "tests/gdimagecreate/.gitignore",
          "tests/gdimagecreate/CMakeLists.txt",
          "tests/gdimagecreate/Makemodule.am",
          "tests/gdimagecreate/bug00340.c"
        ],
        "message": "Fix #340: System frozen\n\ngdImageCreate() doesn't check for oversized images and as such is prone\nto DoS vulnerabilities. We fix that by applying the same overflow check\nthat is already in place for gdImageCreateTrueColor().\n\nCVE-2016-9317\n\nConflicts:\n\tsrc/gd.c",
        "before_after_code_files": [
          "src/gd.c||src/gd.c",
          "tests/Makefile.am||tests/Makefile.am",
          "tests/gdimagecreate/Makemodule.am||tests/gdimagecreate/Makemodule.am",
          "tests/gdimagecreate/bug00340.c||tests/gdimagecreate/bug00340.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "src/gd.c||src/gd.c",
            "tests/Makefile.am||tests/Makefile.am",
            "tests/gdimagecreate/Makemodule.am||tests/gdimagecreate/Makemodule.am",
            "tests/gdimagecreate/bug00340.c||tests/gdimagecreate/bug00340.c"
          ],
          "candidate": [
            "src/gd.c||src/gd.c",
            "tests/Makefile.am||tests/Makefile.am",
            "tests/gdimagecreate/Makemodule.am||tests/gdimagecreate/Makemodule.am",
            "tests/gdimagecreate/bug00340.c||tests/gdimagecreate/bug00340.c"
          ]
        }
      },
      "candidate_diff": {
        "src/gd.c||src/gd.c": [
          "File: src/gd.c -> src/gd.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "185:  int i;",
          "186:  gdImagePtr im;",
          "188:  if (overflow2(sizeof (unsigned char *), sy)) {",
          "189:   return NULL;",
          "190:  }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "188:  if (overflow2(sx, sy)) {",
          "189:   return NULL;",
          "190:  }",
          "",
          "---------------"
        ],
        "tests/Makefile.am||tests/Makefile.am": [
          "File: tests/Makefile.am -> tests/Makefile.am",
          "--- Hunk 1 ---",
          "[Context before]",
          "33: include gdimagecopy/Makemodule.am",
          "34: include gdimagecopyresampled/Makemodule.am",
          "35: include gdimagecopyrotated/Makemodule.am",
          "36: include gdimagecrop/Makemodule.am",
          "37: include gdimagefile/Makemodule.am",
          "38: include gdimagefill/Makemodule.am",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "36: include gdimagecreate/Makemodule.am",
          "",
          "---------------"
        ],
        "tests/gdimagecreate/Makemodule.am||tests/gdimagecreate/Makemodule.am": [
          "File: tests/gdimagecreate/Makemodule.am -> tests/gdimagecreate/Makemodule.am",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: libgd_test_programs += \\",
          "2:  gdimagecreate/bug00340",
          "4: EXTRA_DIST += \\",
          "5:  gdimagecreate/CMakeLists.txt",
          "",
          "---------------"
        ],
        "tests/gdimagecreate/bug00340.c||tests/gdimagecreate/bug00340.c": [
          "File: tests/gdimagecreate/bug00340.c -> tests/gdimagecreate/bug00340.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "9: #include <string.h>",
          "10: #include \"gd.h\"",
          "11: #include \"gd_errors.h\"",
          "12: #include \"gdtest.h\"",
          "15: #define MSG \"product of memory allocation multiplication would exceed INT_MAX, failing operation gracefully\\n\"",
          "18: void error_handler(int priority, const char *format, ...)",
          "19: {",
          "20:     gdTestAssert(priority == GD_WARNING);",
          "21:     gdTestAssert(!strcmp(format, MSG));",
          "22: }",
          "25: int main()",
          "26: {",
          "27:     gdImagePtr im;",
          "29:     im = gdImageCreate(64970, 65111);",
          "30:     gdTestAssert(im == NULL);",
          "32:     return gdNumFailures();",
          "33: }",
          "",
          "---------------"
        ]
      }
    }
  ]
}