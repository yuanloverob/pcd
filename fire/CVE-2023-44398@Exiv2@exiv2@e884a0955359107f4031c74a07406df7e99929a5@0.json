{
  "cve_id": "CVE-2023-44398",
  "cve_desc": "Exiv2 is a C++ library and a command-line utility to read, write, delete and modify Exif, IPTC, XMP and ICC image metadata. An out-of-bounds write was found in Exiv2 version v0.28.0. The vulnerable function, `BmffImage::brotliUncompress`, is new in v0.28.0, so earlier versions of Exiv2 are _not_ affected. The out-of-bounds write is triggered when Exiv2 is used to read the metadata of a crafted image file. An attacker could potentially exploit the vulnerability to gain code execution, if they can trick the victim into running Exiv2 on a crafted image file. This bug is fixed in version v0.28.1. Users are advised to upgrade. There are no known workarounds for this vulnerability.",
  "repo": "Exiv2/exiv2",
  "patch_hash": "e884a0955359107f4031c74a07406df7e99929a5",
  "patch_info": {
    "commit_hash": "e884a0955359107f4031c74a07406df7e99929a5",
    "repo": "Exiv2/exiv2",
    "commit_url": "https://github.com/Exiv2/exiv2/commit/e884a0955359107f4031c74a07406df7e99929a5",
    "files": [
      "src/bmffimage.cpp",
      "test/data/issue_ghsa_hrw9_ggg3_3r4r_poc.jpg",
      "tests/bugfixes/github/test_issue_ghsa_hrw9_ggg3_3r4r.py",
      "tests/regression_tests/test_regression_allfiles.py"
    ],
    "message": "Merge pull request from GHSA-hrw9-ggg3-3r4r\n\nFix integer overflow in BmffImage::brotliUncompress",
    "before_after_code_files": [
      "src/bmffimage.cpp||src/bmffimage.cpp",
      "tests/bugfixes/github/test_issue_ghsa_hrw9_ggg3_3r4r.py||tests/bugfixes/github/test_issue_ghsa_hrw9_ggg3_3r4r.py",
      "tests/regression_tests/test_regression_allfiles.py||tests/regression_tests/test_regression_allfiles.py"
    ]
  },
  "patch_diff": {
    "src/bmffimage.cpp||src/bmffimage.cpp": [
      "File: src/bmffimage.cpp -> src/bmffimage.cpp",
      "--- Hunk 1 ---",
      "[Context before]",
      "212:       uncompressedLen *= 2;",
      "214:       if (uncompressedLen > 131072) {",
      "216:           break;",
      "217:         uncompressedLen = 131072;",
      "218:       }",
      "",
      "[Removed Lines]",
      "215:         if (++dos > 1)",
      "",
      "[Added Lines]",
      "215:         if (++dos > 1 || total_out > 131072)",
      "",
      "---------------"
    ],
    "tests/bugfixes/github/test_issue_ghsa_hrw9_ggg3_3r4r.py||tests/bugfixes/github/test_issue_ghsa_hrw9_ggg3_3r4r.py": [
      "File: tests/bugfixes/github/test_issue_ghsa_hrw9_ggg3_3r4r.py -> tests/bugfixes/github/test_issue_ghsa_hrw9_ggg3_3r4r.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: # -*- coding: utf-8 -*-",
      "3: from system_tests import CaseMeta, path",
      "5: class BrotliUncompressOutOfBoundsWrite(metaclass=CaseMeta):",
      "6:     \"\"\"",
      "7:     Regression test for the bug described in:",
      "8:     https://github.com/Exiv2/exiv2/security/advisories/GHSA-hrw9-ggg3-3r4r",
      "9:     \"\"\"",
      "10:     url = \"https://github.com/Exiv2/exiv2/security/advisories/GHSA-hrw9-ggg3-3r4r\"",
      "12:     filename = path(\"$data_path/issue_ghsa_hrw9_ggg3_3r4r_poc.jpg\")",
      "13:     commands = [\"$exiv2 $filename\"]",
      "14:     stdout = [\"\"]",
      "15:     stderr = [",
      "16: \"\"\"Exiv2 exception in print action for file $filename:",
      "17: $kerFailedToReadImageData",
      "18: \"\"\"]",
      "19:     retval = [1]",
      "",
      "---------------"
    ],
    "tests/regression_tests/test_regression_allfiles.py||tests/regression_tests/test_regression_allfiles.py": [
      "File: tests/regression_tests/test_regression_allfiles.py -> tests/regression_tests/test_regression_allfiles.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "116:         \"issue_ghsa_583f_w9pm_99r2_poc.jp2\",",
      "117:         \"issue_ghsa_7569_phvm_vwc2_poc.jp2\",",
      "118:         \"issue_ghsa_mxw9_qx4c_6m8v_poc.jp2\",",
      "119:         \"pocIssue283.jpg\",",
      "120:         \"poc_1522.jp2\",",
      "121:         \"xmpsdk.xmp\",",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "119:         \"issue_ghsa_hrw9_ggg3_3r4r_poc.jpg\",",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "78642f786a35c79a4eeca695fc0f2b7c4e012ec1",
      "candidate_info": {
        "commit_hash": "78642f786a35c79a4eeca695fc0f2b7c4e012ec1",
        "repo": "Exiv2/exiv2",
        "commit_url": "https://github.com/Exiv2/exiv2/commit/78642f786a35c79a4eeca695fc0f2b7c4e012ec1",
        "files": [
          "test/data/issue_ghsa_hrw9_ggg3_3r4r_poc.jpg",
          "tests/bugfixes/github/test_issue_ghsa_hrw9_ggg3_3r4r.py",
          "tests/regression_tests/test_regression_allfiles.py"
        ],
        "message": "Regression test for https://github.com/Exiv2/exiv2/security/advisories/GHSA-hrw9-ggg3-3r4r",
        "before_after_code_files": [
          "tests/bugfixes/github/test_issue_ghsa_hrw9_ggg3_3r4r.py||tests/bugfixes/github/test_issue_ghsa_hrw9_ggg3_3r4r.py",
          "tests/regression_tests/test_regression_allfiles.py||tests/regression_tests/test_regression_allfiles.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_olp_changes": 1,
        "olp_code_files": {
          "patch": [
            "tests/bugfixes/github/test_issue_ghsa_hrw9_ggg3_3r4r.py||tests/bugfixes/github/test_issue_ghsa_hrw9_ggg3_3r4r.py",
            "tests/regression_tests/test_regression_allfiles.py||tests/regression_tests/test_regression_allfiles.py"
          ],
          "candidate": [
            "tests/bugfixes/github/test_issue_ghsa_hrw9_ggg3_3r4r.py||tests/bugfixes/github/test_issue_ghsa_hrw9_ggg3_3r4r.py",
            "tests/regression_tests/test_regression_allfiles.py||tests/regression_tests/test_regression_allfiles.py"
          ]
        }
      },
      "candidate_diff": {
        "tests/bugfixes/github/test_issue_ghsa_hrw9_ggg3_3r4r.py||tests/bugfixes/github/test_issue_ghsa_hrw9_ggg3_3r4r.py": [
          "File: tests/bugfixes/github/test_issue_ghsa_hrw9_ggg3_3r4r.py -> tests/bugfixes/github/test_issue_ghsa_hrw9_ggg3_3r4r.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: # -*- coding: utf-8 -*-",
          "3: from system_tests import CaseMeta, path",
          "5: class BrotliUncompressOutOfBoundsWrite(metaclass=CaseMeta):",
          "6:     \"\"\"",
          "7:     Regression test for the bug described in:",
          "8:     https://github.com/Exiv2/exiv2/security/advisories/GHSA-hrw9-ggg3-3r4r",
          "9:     \"\"\"",
          "10:     url = \"https://github.com/Exiv2/exiv2/security/advisories/GHSA-hrw9-ggg3-3r4r\"",
          "12:     filename = path(\"$data_path/issue_ghsa_hrw9_ggg3_3r4r_poc.jpg\")",
          "13:     commands = [\"$exiv2 $filename\"]",
          "14:     stdout = [\"\"]",
          "15:     stderr = [",
          "16: \"\"\"Exiv2 exception in print action for file $filename:",
          "17: $kerFailedToReadImageData",
          "18: \"\"\"]",
          "19:     retval = [1]",
          "",
          "---------------"
        ],
        "tests/regression_tests/test_regression_allfiles.py||tests/regression_tests/test_regression_allfiles.py": [
          "File: tests/regression_tests/test_regression_allfiles.py -> tests/regression_tests/test_regression_allfiles.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "116:         \"issue_ghsa_583f_w9pm_99r2_poc.jp2\",",
          "117:         \"issue_ghsa_7569_phvm_vwc2_poc.jp2\",",
          "118:         \"issue_ghsa_mxw9_qx4c_6m8v_poc.jp2\",",
          "119:         \"pocIssue283.jpg\",",
          "120:         \"poc_1522.jp2\",",
          "121:         \"xmpsdk.xmp\",",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "119:         \"issue_ghsa_hrw9_ggg3_3r4r_poc.jpg\",",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "a1f254358de167af9a619523ca7ba6492bd89959",
      "candidate_info": {
        "commit_hash": "a1f254358de167af9a619523ca7ba6492bd89959",
        "repo": "Exiv2/exiv2",
        "commit_url": "https://github.com/Exiv2/exiv2/commit/a1f254358de167af9a619523ca7ba6492bd89959",
        "files": [
          "src/bmffimage.cpp"
        ],
        "message": "Credit to OSS-Fuzz: https://bugs.chromium.org/p/oss-fuzz/issues/detail?id=61675 Avoid integer overflow in the calculation of available_out.",
        "before_after_code_files": [
          "src/bmffimage.cpp||src/bmffimage.cpp"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_olp_changes": 1,
        "olp_code_files": {
          "patch": [
            "src/bmffimage.cpp||src/bmffimage.cpp"
          ],
          "candidate": [
            "src/bmffimage.cpp||src/bmffimage.cpp"
          ]
        }
      },
      "candidate_diff": {
        "src/bmffimage.cpp||src/bmffimage.cpp": [
          "File: src/bmffimage.cpp -> src/bmffimage.cpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "216:       uncompressedLen *= 2;",
          "218:       if (uncompressedLen > 131072) {",
          "220:           break;",
          "221:         uncompressedLen = 131072;",
          "222:       }",
          "",
          "[Removed Lines]",
          "219:         if (++dos > 1)",
          "",
          "[Added Lines]",
          "219:         if (++dos > 1 || total_out > 131072)",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "9d45a1dcae165c2a471b776d4bc1010f137c2fd2",
      "candidate_info": {
        "commit_hash": "9d45a1dcae165c2a471b776d4bc1010f137c2fd2",
        "repo": "Exiv2/exiv2",
        "commit_url": "https://github.com/Exiv2/exiv2/commit/9d45a1dcae165c2a471b776d4bc1010f137c2fd2",
        "files": [
          "test/data/issue_ghsa_g9xm_7538_mq8w_poc.mov",
          "tests/bugfixes/github/test_issue_ghsa_g9xm_7538_mq8w.py",
          "tests/regression_tests/test_regression_allfiles.py"
        ],
        "message": "Regression test for https://github.com/Exiv2/exiv2/security/advisories/GHSA-g9xm-7538-mq8w",
        "before_after_code_files": [
          "tests/bugfixes/github/test_issue_ghsa_g9xm_7538_mq8w.py||tests/bugfixes/github/test_issue_ghsa_g9xm_7538_mq8w.py",
          "tests/regression_tests/test_regression_allfiles.py||tests/regression_tests/test_regression_allfiles.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_olp_changes": 1,
        "olp_code_files": {
          "patch": [
            "tests/regression_tests/test_regression_allfiles.py||tests/regression_tests/test_regression_allfiles.py"
          ],
          "candidate": [
            "tests/regression_tests/test_regression_allfiles.py||tests/regression_tests/test_regression_allfiles.py"
          ]
        }
      },
      "candidate_diff": {
        "tests/bugfixes/github/test_issue_ghsa_g9xm_7538_mq8w.py||tests/bugfixes/github/test_issue_ghsa_g9xm_7538_mq8w.py": [
          "File: tests/bugfixes/github/test_issue_ghsa_g9xm_7538_mq8w.py -> tests/bugfixes/github/test_issue_ghsa_g9xm_7538_mq8w.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: # -*- coding: utf-8 -*-",
          "3: from system_tests import CaseMeta, CopyTmpFiles, path, check_no_ASAN_UBSAN_errors",
          "5: class QuickTimeVideoNikonTagsDecoderOutOfBoundsRead(metaclass=CaseMeta):",
          "6:     \"\"\"",
          "7:     Regression test for the bug described in:",
          "8:     https://github.com/Exiv2/exiv2/security/advisories/GHSA-g9xm-7538-mq8w",
          "9:     \"\"\"",
          "10:     url = \"https://github.com/Exiv2/exiv2/security/advisories/GHSA-g9xm-7538-mq8w\"",
          "12:     filename = path(\"$data_path/issue_ghsa_g9xm_7538_mq8w_poc.mov\")",
          "13:     commands = [\"$exiv2 $filename\"]",
          "14:     retval = [1]",
          "16:     compare_stdout = check_no_ASAN_UBSAN_errors",
          "17:     compare_stderr = check_no_ASAN_UBSAN_errors",
          "",
          "---------------"
        ],
        "tests/regression_tests/test_regression_allfiles.py||tests/regression_tests/test_regression_allfiles.py": [
          "File: tests/regression_tests/test_regression_allfiles.py -> tests/regression_tests/test_regression_allfiles.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "117:         \"issue_ghsa_7569_phvm_vwc2_poc.jp2\",",
          "118:         \"issue_ghsa_mxw9_qx4c_6m8v_poc.jp2\",",
          "119:         \"issue_ghsa_hrw9_ggg3_3r4r_poc.jpg\",",
          "120:         \"pocIssue283.jpg\",",
          "121:         \"poc_1522.jp2\",",
          "122:         \"xmpsdk.xmp\",",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "120:         \"issue_ghsa_g9xm_7538_mq8w_poc.mov\",",
          "",
          "---------------"
        ]
      }
    }
  ]
}