{
  "cve_id": "CVE-2020-36230",
  "cve_desc": "A flaw was discovered in OpenLDAP before 2.4.57 leading in an assertion failure in slapd in the X.509 DN parsing in decode.c ber_next_element, resulting in denial of service.",
  "repo": "openldap/openldap",
  "patch_hash": "8c1d96ee36ed98b32cd0e28b7069c7b8ea09d793",
  "patch_info": {
    "commit_hash": "8c1d96ee36ed98b32cd0e28b7069c7b8ea09d793",
    "repo": "openldap/openldap",
    "commit_url": "https://github.com/openldap/openldap/commit/8c1d96ee36ed98b32cd0e28b7069c7b8ea09d793",
    "files": [
      "libraries/libldap/tls2.c"
    ],
    "message": "ITS#9423 ldap_X509dn2bv: check for invalid BER after RDN count",
    "before_after_code_files": [
      "libraries/libldap/tls2.c||libraries/libldap/tls2.c"
    ]
  },
  "patch_diff": {
    "libraries/libldap/tls2.c||libraries/libldap/tls2.c": [
      "File: libraries/libldap/tls2.c -> libraries/libldap/tls2.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1254:   }",
      "1255:  }",
      "1258:  dnsize = sizeof(LDAPRDN) * (nrdns+1);",
      "1259:  dnsize += sizeof(LDAPAVA *) * (navas+nrdns);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1258:  ber_rewind( ber );",
      "1259:  tag = ber_first_element( ber, &len, &dn_end );",
      "1260:  if ( tag == LBER_DEFAULT )",
      "1261:   return LDAP_DECODING_ERROR;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "1265:  } else {",
      "1266:   newDN = (LDAPDN)(char *)ptrs;",
      "1267:  }",
      "1269:  newDN[nrdns] = NULL;",
      "1270:  newRDN = (LDAPRDN)(newDN + nrdns+1);",
      "1271:  newAVA = (LDAPAVA *)(newRDN + navas + nrdns);",
      "1272:  baseAVA = newAVA;",
      "1278:  for ( i = nrdns - 1; i >= 0; i-- ) {",
      "1279:   newDN[i] = newRDN;",
      "",
      "[Removed Lines]",
      "1275:  ber_rewind( ber );",
      "1277:  tag = ber_first_element( ber, &len, &dn_end );",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "4bdfffd2889c0c5cdf58bebafbdc8fce4bb2bff0",
      "candidate_info": {
        "commit_hash": "4bdfffd2889c0c5cdf58bebafbdc8fce4bb2bff0",
        "repo": "openldap/openldap",
        "commit_url": "https://github.com/openldap/openldap/commit/4bdfffd2889c0c5cdf58bebafbdc8fce4bb2bff0",
        "files": [
          "libraries/libldap/tls2.c"
        ],
        "message": "ITS#9425 add more checks to ldap_X509dn2bv",
        "before_after_code_files": [
          "libraries/libldap/tls2.c||libraries/libldap/tls2.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "libraries/libldap/tls2.c||libraries/libldap/tls2.c"
          ],
          "candidate": [
            "libraries/libldap/tls2.c||libraries/libldap/tls2.c"
          ]
        }
      },
      "candidate_diff": {
        "libraries/libldap/tls2.c||libraries/libldap/tls2.c": [
          "File: libraries/libldap/tls2.c -> libraries/libldap/tls2.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1248:   for ( tag = ber_first_element( ber, &len, &rdn_end );",
          "1249:    tag == LBER_SEQUENCE;",
          "1250:    tag = ber_next_element( ber, &len, rdn_end )) {",
          "1251:    tag = ber_skip_tag( ber, &len );",
          "1252:    ber_skip_data( ber, len );",
          "1253:    navas++;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1251:    if ( rdn_end > dn_end )",
          "1252:     return LDAP_DECODING_ERROR;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1258:  ber_rewind( ber );",
          "1259:  tag = ber_first_element( ber, &len, &dn_end );",
          "1261:   return LDAP_DECODING_ERROR;",
          "",
          "[Removed Lines]",
          "1260:  if ( tag == LBER_DEFAULT )",
          "",
          "[Added Lines]",
          "1262:  if ( tag != LBER_SET )",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1371:     rc = der_to_ldap_BitString( &Val, &newAVA->la_value );",
          "1372:     goto allocd;",
          "1373:    default:",
          "1375:     newAVA->la_flags = 0;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1375:    case LBER_DEFAULT:",
          "1377:     rc = LDAP_DECODING_ERROR;",
          "1378:     goto nomem;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "c944dc55b719e330a26475b55f79e622af1ff0b3",
      "candidate_info": {
        "commit_hash": "c944dc55b719e330a26475b55f79e622af1ff0b3",
        "repo": "openldap/openldap",
        "commit_url": "https://github.com/openldap/openldap/commit/c944dc55b719e330a26475b55f79e622af1ff0b3",
        "files": [
          "libraries/libldap/tls2.c"
        ],
        "message": "ITS#9423 ldap_X509dn2bv: check for invalid BER after RDN count",
        "before_after_code_files": [
          "libraries/libldap/tls2.c||libraries/libldap/tls2.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libraries/libldap/tls2.c||libraries/libldap/tls2.c"
          ],
          "candidate": [
            "libraries/libldap/tls2.c||libraries/libldap/tls2.c"
          ]
        }
      },
      "candidate_diff": {
        "libraries/libldap/tls2.c||libraries/libldap/tls2.c": [
          "File: libraries/libldap/tls2.c -> libraries/libldap/tls2.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1505:   }",
          "1506:  }",
          "1509:  dnsize = sizeof(LDAPRDN) * (nrdns+1);",
          "1510:  dnsize += sizeof(LDAPAVA *) * (navas+nrdns);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1509:  ber_rewind( ber );",
          "1510:  tag = ber_first_element( ber, &len, &dn_end );",
          "1511:  if ( tag == LBER_DEFAULT )",
          "1512:   return LDAP_DECODING_ERROR;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1516:  } else {",
          "1517:   newDN = (LDAPDN)(char *)ptrs;",
          "1518:  }",
          "1520:  newDN[nrdns] = NULL;",
          "1521:  newRDN = (LDAPRDN)(newDN + nrdns+1);",
          "1522:  newAVA = (LDAPAVA *)(newRDN + navas + nrdns);",
          "1523:  baseAVA = newAVA;",
          "1529:  for ( i = nrdns - 1; i >= 0; i-- ) {",
          "1530:   newDN[i] = newRDN;",
          "",
          "[Removed Lines]",
          "1526:  ber_rewind( ber );",
          "1528:  tag = ber_first_element( ber, &len, &dn_end );",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    }
  ]
}