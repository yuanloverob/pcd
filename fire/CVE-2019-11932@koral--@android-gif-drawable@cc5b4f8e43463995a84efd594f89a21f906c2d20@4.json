{
  "cve_id": "CVE-2019-11932",
  "cve_desc": "A double free vulnerability in the DDGifSlurp function in decoding.c in the android-gif-drawable library before version 1.2.18, as used in WhatsApp for Android before version 2.19.244 and many other Android applications, allows remote attackers to execute arbitrary code or cause a denial of service when the library is used to parse a specially crafted GIF image.",
  "repo": "koral--/android-gif-drawable",
  "patch_hash": "cc5b4f8e43463995a84efd594f89a21f906c2d20",
  "patch_info": {
    "commit_hash": "cc5b4f8e43463995a84efd594f89a21f906c2d20",
    "repo": "koral--/android-gif-drawable",
    "commit_url": "https://github.com/koral--/android-gif-drawable/commit/cc5b4f8e43463995a84efd594f89a21f906c2d20",
    "files": [
      "android-gif-drawable/src/main/c/decoding.c"
    ],
    "message": "Do not realloc array if new raster size is 0.\n\nif realloc() is called with 0 size it may return NULL and this will be incorrectly handled\nas not enough memory and (also) rasterBits will be freed by realloc but we will not update\nit.",
    "before_after_code_files": [
      "android-gif-drawable/src/main/c/decoding.c||android-gif-drawable/src/main/c/decoding.c"
    ]
  },
  "patch_diff": {
    "android-gif-drawable/src/main/c/decoding.c||android-gif-drawable/src/main/c/decoding.c": [
      "File: android-gif-drawable/src/main/c/decoding.c -> android-gif-drawable/src/main/c/decoding.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "56:     }",
      "58:     if (decode) {",
      "61:      const uint_fast32_t newRasterSize = gifFilePtr->Image.Width * gifFilePtr->Image.Height;",
      "62:      if (newRasterSize > info->rasterSize || widthOverflow > 0 || heightOverflow > 0) {",
      "63:       void *tmpRasterBits = reallocarray(info->rasterBits, newRasterSize, sizeof(GifPixelType));",
      "64:       if (tmpRasterBits == NULL) {",
      "",
      "[Removed Lines]",
      "59:      int_fast32_t widthOverflow = gifFilePtr->Image.Width - info->originalWidth;",
      "60:      int_fast32_t heightOverflow = gifFilePtr->Image.Height - info->originalHeight;",
      "",
      "[Added Lines]",
      "60:      if (newRasterSize == 0) {",
      "61:       free(info->rasterBits);",
      "62:       info->rasterBits = NULL;",
      "63:       info->rasterSize = newRasterSize;",
      "64:       return;",
      "65:      }",
      "66:      const int_fast32_t widthOverflow = gifFilePtr->Image.Width - info->originalWidth;",
      "67:      const int_fast32_t heightOverflow = gifFilePtr->Image.Height - info->originalHeight;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "29f81207d1e26c66569b76c5f589baf93e5cd853",
      "candidate_info": {
        "commit_hash": "29f81207d1e26c66569b76c5f589baf93e5cd853",
        "repo": "koral--/android-gif-drawable",
        "commit_url": "https://github.com/koral--/android-gif-drawable/commit/29f81207d1e26c66569b76c5f589baf93e5cd853",
        "files": [
          "android-gif-drawable/gradle.properties"
        ],
        "message": "Bump library version to 1.2.17",
        "before_after_code_files": [
          "android-gif-drawable/gradle.properties||android-gif-drawable/gradle.properties"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/koral--/android-gif-drawable/pull/689"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "android-gif-drawable/gradle.properties||android-gif-drawable/gradle.properties": [
          "File: android-gif-drawable/gradle.properties -> android-gif-drawable/gradle.properties",
          "--- Hunk 1 ---",
          "[Context before]",
          "2: GROUP=pl.droidsonroids.gif",
          "4: POM_DESCRIPTION=Views and Drawable for displaying animated GIFs for Android",
          "",
          "[Removed Lines]",
          "1: VERSION_NAME=1.2.16",
          "",
          "[Added Lines]",
          "1: VERSION_NAME=1.2.17-SNAPSHOT",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "db1057aa3c8d049e4369da1e55e745b252bd3a0d",
      "candidate_info": {
        "commit_hash": "db1057aa3c8d049e4369da1e55e745b252bd3a0d",
        "repo": "koral--/android-gif-drawable",
        "commit_url": "https://github.com/koral--/android-gif-drawable/commit/db1057aa3c8d049e4369da1e55e745b252bd3a0d",
        "files": [
          "android-gif-drawable/build.gradle"
        ],
        "message": "Set STL to none, closes #634",
        "before_after_code_files": [
          "android-gif-drawable/build.gradle||android-gif-drawable/build.gradle"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/koral--/android-gif-drawable/pull/689"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "android-gif-drawable/build.gradle||android-gif-drawable/build.gradle": [
          "File: android-gif-drawable/build.gradle -> android-gif-drawable/build.gradle",
          "--- Hunk 1 ---",
          "[Context before]",
          "24:   testInstrumentationRunner 'androidx.test.runner.AndroidJUnitRunner'",
          "25:   externalNativeBuild {",
          "26:    cmake {",
          "28:     cFlags '-std=c11', '-Weverything', '-Wall'",
          "29:     if (isDebugBuild()) {",
          "30:      cFlags '-DDEBUG', '-g'",
          "",
          "[Removed Lines]",
          "27:     arguments \"-DANDROID_PLATFORM=android-$versions.minSdk\"",
          "",
          "[Added Lines]",
          "27:     arguments \"-DANDROID_PLATFORM=android-$versions.minSdk\", \"-DANDROID_STL=none\"",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "fa77f718d54f3836f19e98eb48f5b26081fe510b",
      "candidate_info": {
        "commit_hash": "fa77f718d54f3836f19e98eb48f5b26081fe510b",
        "repo": "koral--/android-gif-drawable",
        "commit_url": "https://github.com/koral--/android-gif-drawable/commit/fa77f718d54f3836f19e98eb48f5b26081fe510b",
        "files": [
          "android-gif-drawable/src/test/java/pl/droidsonroids/gif/GifOptionsTest.java"
        ],
        "message": "Cleanup GifOptionsTest",
        "before_after_code_files": [
          "android-gif-drawable/src/test/java/pl/droidsonroids/gif/GifOptionsTest.java||android-gif-drawable/src/test/java/pl/droidsonroids/gif/GifOptionsTest.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/koral--/android-gif-drawable/pull/689"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "android-gif-drawable/src/test/java/pl/droidsonroids/gif/GifOptionsTest.java||android-gif-drawable/src/test/java/pl/droidsonroids/gif/GifOptionsTest.java": [
          "File: android-gif-drawable/src/test/java/pl/droidsonroids/gif/GifOptionsTest.java -> android-gif-drawable/src/test/java/pl/droidsonroids/gif/GifOptionsTest.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: import org.junit.Before;",
          "4: import org.junit.Test;",
          "8: public class GifOptionsTest {",
          "",
          "[Removed Lines]",
          "6: import static org.assertj.core.api.Java6Assertions.assertThat;",
          "",
          "[Added Lines]",
          "6: import static org.assertj.core.api.Assertions.assertThat;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "21:  }",
          "23:  @Test",
          "25:   gifOptions.setInSampleSize(2);",
          "26:   assertThat(gifOptions.inSampleSize).isEqualTo((char) 2);",
          "27:  }",
          "29:  @Test",
          "31:   gifOptions.setInIsOpaque(true);",
          "32:   assertThat(gifOptions.inIsOpaque).isTrue();",
          "33:  }",
          "35:  @Test",
          "37:   GifOptions source = new GifOptions();",
          "38:   source.setInIsOpaque(false);",
          "39:   source.setInSampleSize(8);",
          "",
          "[Removed Lines]",
          "24:  public void setInSampleSize() throws Exception {",
          "30:  public void setInIsOpaque() throws Exception {",
          "36:  public void copyFromNonNull() throws Exception {",
          "",
          "[Added Lines]",
          "24:  public void setInSampleSize() {",
          "30:  public void setInIsOpaque() {",
          "36:  public void copyFromNonNull() {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "42:  }",
          "44:  @Test",
          "46:   GifOptions defaultOptions = new GifOptions();",
          "47:   gifOptions.setInIsOpaque(false);",
          "48:   gifOptions.setInSampleSize(8);",
          "",
          "[Removed Lines]",
          "45:  public void copyFromNull() throws Exception {",
          "",
          "[Added Lines]",
          "45:  public void copyFromNull() {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "cc6ae3d35f86aa19c13c1d05f3a4559f21bc17b3",
      "candidate_info": {
        "commit_hash": "cc6ae3d35f86aa19c13c1d05f3a4559f21bc17b3",
        "repo": "koral--/android-gif-drawable",
        "commit_url": "https://github.com/koral--/android-gif-drawable/commit/cc6ae3d35f86aa19c13c1d05f3a4559f21bc17b3",
        "files": [
          "android-gif-drawable/gradle.properties"
        ],
        "message": "Prepare for 1.2.18 development iteration",
        "before_after_code_files": [
          "android-gif-drawable/gradle.properties||android-gif-drawable/gradle.properties"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/koral--/android-gif-drawable/pull/689"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "android-gif-drawable/gradle.properties||android-gif-drawable/gradle.properties": [
          "File: android-gif-drawable/gradle.properties -> android-gif-drawable/gradle.properties",
          "--- Hunk 1 ---",
          "[Context before]",
          "2: GROUP=pl.droidsonroids.gif",
          "4: POM_DESCRIPTION=Views and Drawable for displaying animated GIFs for Android",
          "",
          "[Removed Lines]",
          "1: VERSION_NAME=1.2.17",
          "",
          "[Added Lines]",
          "1: VERSION_NAME=1.2.18-SNAPSHOT",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "ff620ebb715b407db33ef36e7fa805d0381cf296",
      "candidate_info": {
        "commit_hash": "ff620ebb715b407db33ef36e7fa805d0381cf296",
        "repo": "koral--/android-gif-drawable",
        "commit_url": "https://github.com/koral--/android-gif-drawable/commit/ff620ebb715b407db33ef36e7fa805d0381cf296",
        "files": [
          "android-gif-drawable/build.gradle",
          "android-gif-drawable/src/main/java/pl/droidsonroids/gif/LibraryLoader.java",
          "android-gif-drawable/src/main/java/pl/droidsonroids/gif/ReLinker.java",
          "build.gradle"
        ],
        "message": "Use ReLinker 1.3.1 for native library loading. Possible fix for #636.",
        "before_after_code_files": [
          "android-gif-drawable/build.gradle||android-gif-drawable/build.gradle",
          "android-gif-drawable/src/main/java/pl/droidsonroids/gif/LibraryLoader.java||android-gif-drawable/src/main/java/pl/droidsonroids/gif/LibraryLoader.java",
          "android-gif-drawable/src/main/java/pl/droidsonroids/gif/ReLinker.java||android-gif-drawable/src/main/java/pl/droidsonroids/gif/ReLinker.java",
          "build.gradle||build.gradle"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/koral--/android-gif-drawable/pull/689"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "android-gif-drawable/build.gradle||android-gif-drawable/build.gradle": [
          "File: android-gif-drawable/build.gradle -> android-gif-drawable/build.gradle",
          "--- Hunk 1 ---",
          "[Context before]",
          "64: }",
          "66: dependencies {",
          "67:     compileOnly \"androidx.annotation:annotation:$versions.androidxAnnotations\"",
          "68:     testCompileOnly \"androidx.annotation:annotation:$versions.androidxAnnotations\"",
          "69:     testImplementation \"junit:junit:$versions.junit\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "67:     implementation \"com.getkeepsafe.relinker:relinker:$versions.relinker\"",
          "",
          "---------------"
        ],
        "android-gif-drawable/src/main/java/pl/droidsonroids/gif/LibraryLoader.java||android-gif-drawable/src/main/java/pl/droidsonroids/gif/LibraryLoader.java": [
          "File: android-gif-drawable/src/main/java/pl/droidsonroids/gif/LibraryLoader.java -> android-gif-drawable/src/main/java/pl/droidsonroids/gif/LibraryLoader.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: import android.annotation.SuppressLint;",
          "4: import android.content.Context;",
          "8: import androidx.annotation.NonNull;",
          "14: public class LibraryLoader {",
          "16:  static final String BASE_LIBRARY_NAME = \"pl_droidsonroids_gif\";",
          "17:  @SuppressLint(\"StaticFieldLeak\") //workaround for Android bug",
          "18:  private static Context sAppContext;",
          "",
          "[Removed Lines]",
          "6: import java.lang.reflect.Method;",
          "15:  static final String SURFACE_LIBRARY_NAME = \"pl_droidsonroids_gif_surface\";",
          "",
          "[Added Lines]",
          "8: import com.getkeepsafe.relinker.ReLinker;",
          "10: import java.lang.reflect.Method;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "48:   try {",
          "49:    System.loadLibrary(BASE_LIBRARY_NAME);",
          "50:   } catch (final UnsatisfiedLinkError e) {",
          "52:   }",
          "53:  }",
          "54: }",
          "",
          "[Removed Lines]",
          "51:    ReLinker.loadLibrary(getContext());",
          "",
          "[Added Lines]",
          "52:    ReLinker.loadLibrary(getContext(), BASE_LIBRARY_NAME);",
          "",
          "---------------"
        ],
        "android-gif-drawable/src/main/java/pl/droidsonroids/gif/ReLinker.java||android-gif-drawable/src/main/java/pl/droidsonroids/gif/ReLinker.java": [
          "File: android-gif-drawable/src/main/java/pl/droidsonroids/gif/ReLinker.java -> android-gif-drawable/src/main/java/pl/droidsonroids/gif/ReLinker.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "build.gradle||build.gradle": [
          "File: build.gradle -> build.gradle",
          "--- Hunk 1 ---",
          "[Context before]",
          "23:                 concurrentunit     : '0.4.4',",
          "24:                 openglApi          : 'gl1.1-android-2.1_r1',",
          "25:                 mockwebserver      : '3.14.1',",
          "26:         ]",
          "27:     }",
          "28:     repositories {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "26:                 relinker           : '1.3.1'",
          "",
          "---------------"
        ]
      }
    }
  ]
}