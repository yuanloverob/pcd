{
  "cve_id": "CVE-2024-23836",
  "cve_desc": "Suricata is a network Intrusion Detection System, Intrusion Prevention System and Network Security Monitoring engine. Prior to versions 6.0.16 and 7.0.3, an attacker can craft traffic to cause Suricata to use far more CPU and memory for processing the traffic than needed, which can lead to extreme slow downs and denial of service.  This vulnerability is patched in 6.0.16 or 7.0.3.  Workarounds include disabling the affected protocol app-layer parser in the yaml and reducing the `stream.reassembly.depth` value helps reduce the severity of the issue.",
  "repo": "OISF/suricata",
  "patch_hash": "8efaebe293e2a74c8e323fa85a6f5fadf82801bc",
  "patch_info": {
    "commit_hash": "8efaebe293e2a74c8e323fa85a6f5fadf82801bc",
    "repo": "OISF/suricata",
    "commit_url": "https://github.com/OISF/suricata/commit/8efaebe293e2a74c8e323fa85a6f5fadf82801bc",
    "files": [
      "configure.ac",
      "src/app-layer-htp.c"
    ],
    "message": "http1: configurable max number of live tx per flow\n\nUnlike the original commit, this commit just enforces a maximum limit,\nbut does not expose the configuration of it.\n\nTicket: #5921\n\n(cherry picked from commit 4175680a8a1c0dfaa491ee63d6e36c011d498473)",
    "before_after_code_files": [
      "configure.ac||configure.ac",
      "src/app-layer-htp.c||src/app-layer-htp.c"
    ]
  },
  "patch_diff": {
    "configure.ac||configure.ac": [
      "File: configure.ac -> configure.ac",
      "--- Hunk 1 ---",
      "[Context before]",
      "1692:         AC_CHECK_LIB([htp], [htp_config_set_lzma_layers],AC_DEFINE_UNQUOTED([HAVE_HTP_CONFIG_SET_LZMA_LAYERS],[1],[Found htp_config_set_lzma_layers function in libhtp]) ,,[-lhtp])",
      "1693:         AC_CHECK_LIB([htp], [htp_config_set_compression_bomb_limit],AC_DEFINE_UNQUOTED([HAVE_HTP_CONFIG_SET_COMPRESSION_BOMB_LIMIT],[1],[Found htp_config_set_compression_bomb_limit function in libhtp]) ,,[-lhtp])",
      "1694:         AC_CHECK_LIB([htp], [htp_config_set_compression_time_limit],AC_DEFINE_UNQUOTED([HAVE_HTP_CONFIG_SET_COMPRESSION_TIME_LIMIT],[1],[Found htp_config_set_compression_time_limit function in libhtp]) ,,[-lhtp])",
      "1695:     ])",
      "1697:     if test \"x$enable_non_bundled_htp\" = \"xno\"; then",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1695:         AC_CHECK_LIB([htp], [htp_config_set_max_tx],AC_DEFINE_UNQUOTED([HAVE_HTP_CONFIG_SET_MAX_TX],[1],[Found htp_config_set_max_tx function in libhtp]) ,,[-lhtp])",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "1716:             AC_DEFINE_UNQUOTED([HAVE_HTP_CONFIG_SET_LZMA_LAYERS],[1],[Assuming htp_config_set_lzma_layers function in bundled libhtp])",
      "1717:             AC_DEFINE_UNQUOTED([HAVE_HTP_CONFIG_SET_COMPRESSION_BOMB_LIMIT],[1],[Assuming htp_config_set_compression_bomb_limit function in bundled libhtp])",
      "1718:             AC_DEFINE_UNQUOTED([HAVE_HTP_CONFIG_SET_COMPRESSION_TIME_LIMIT],[1],[Assuming htp_config_set_compression_time_limit function in bundled libhtp])",
      "1719:         else",
      "1720:             echo",
      "1721:             echo \"  ERROR: Libhtp is not bundled. Get libhtp by doing:\"",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1720:             AC_DEFINE_UNQUOTED([HAVE_HTP_CONFIG_SET_MAX_TX],[1],[Assuming htp_config_set_max_tx function in bundled libhtp])",
      "",
      "---------------"
    ],
    "src/app-layer-htp.c||src/app-layer-htp.c": [
      "File: src/app-layer-htp.c -> src/app-layer-htp.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "2407: #endif",
      "2408: #ifdef HAVE_HTP_CONFIG_SET_COMPRESSION_TIME_LIMIT",
      "2409:     htp_config_set_compression_time_limit(cfg_prec->cfg, HTP_CONFIG_DEFAULT_COMPRESSION_TIME_LIMIT);",
      "2410: #endif",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "2410: #endif",
      "2411: #ifdef HAVE_HTP_CONFIG_SET_MAX_TX",
      "2412: #define HTP_CONFIG_DEFAULT_MAX_TX_LIMIT 512",
      "2413:     htp_config_set_max_tx(cfg_prec->cfg, HTP_CONFIG_DEFAULT_MAX_TX_LIMIT);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "4175680a8a1c0dfaa491ee63d6e36c011d498473",
      "candidate_info": {
        "commit_hash": "4175680a8a1c0dfaa491ee63d6e36c011d498473",
        "repo": "OISF/suricata",
        "commit_url": "https://github.com/OISF/suricata/commit/4175680a8a1c0dfaa491ee63d6e36c011d498473",
        "files": [
          "configure.ac",
          "doc/userguide/configuration/suricata-yaml.rst",
          "src/app-layer-htp.c",
          "suricata.yaml.in"
        ],
        "message": "http1: configurable max number of live tx per flow\n\nTicket: #5921\n\nCo-authored-by: Jason Ish <jason.ish@oisf.net>",
        "before_after_code_files": [
          "configure.ac||configure.ac",
          "src/app-layer-htp.c||src/app-layer-htp.c",
          "suricata.yaml.in||suricata.yaml.in"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "configure.ac||configure.ac",
            "src/app-layer-htp.c||src/app-layer-htp.c"
          ],
          "candidate": [
            "configure.ac||configure.ac",
            "src/app-layer-htp.c||src/app-layer-htp.c"
          ]
        }
      },
      "candidate_diff": {
        "configure.ac||configure.ac": [
          "File: configure.ac -> configure.ac",
          "--- Hunk 1 ---",
          "[Context before]",
          "1620:         AC_CHECK_LIB([htp], [htp_config_set_lzma_layers],AC_DEFINE_UNQUOTED([HAVE_HTP_CONFIG_SET_LZMA_LAYERS],[1],[Found htp_config_set_lzma_layers function in libhtp]) ,,[-lhtp])",
          "1621:         AC_CHECK_LIB([htp], [htp_config_set_compression_bomb_limit],AC_DEFINE_UNQUOTED([HAVE_HTP_CONFIG_SET_COMPRESSION_BOMB_LIMIT],[1],[Found htp_config_set_compression_bomb_limit function in libhtp]) ,,[-lhtp])",
          "1622:         AC_CHECK_LIB([htp], [htp_config_set_compression_time_limit],AC_DEFINE_UNQUOTED([HAVE_HTP_CONFIG_SET_COMPRESSION_TIME_LIMIT],[1],[Found htp_config_set_compression_time_limit function in libhtp]) ,,[-lhtp])",
          "1623:     ])",
          "1625:     if test \"x$enable_non_bundled_htp\" = \"xno\"; then",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1623:         AC_CHECK_LIB([htp], [htp_config_set_max_tx],AC_DEFINE_UNQUOTED([HAVE_HTP_CONFIG_SET_MAX_TX],[1],[Found htp_config_set_max_tx function in libhtp]) ,,[-lhtp])",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1644:             AC_DEFINE_UNQUOTED([HAVE_HTP_CONFIG_SET_LZMA_LAYERS],[1],[Assuming htp_config_set_lzma_layers function in bundled libhtp])",
          "1645:             AC_DEFINE_UNQUOTED([HAVE_HTP_CONFIG_SET_COMPRESSION_BOMB_LIMIT],[1],[Assuming htp_config_set_compression_bomb_limit function in bundled libhtp])",
          "1646:             AC_DEFINE_UNQUOTED([HAVE_HTP_CONFIG_SET_COMPRESSION_TIME_LIMIT],[1],[Assuming htp_config_set_compression_time_limit function in bundled libhtp])",
          "1647:         else",
          "1648:             echo",
          "1649:             echo \"  ERROR: Libhtp is not bundled. Get libhtp by doing:\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1648:             AC_DEFINE_UNQUOTED([HAVE_HTP_CONFIG_SET_MAX_TX],[1],[Assuming htp_config_set_max_tx function in bundled libhtp])",
          "",
          "---------------"
        ],
        "src/app-layer-htp.c||src/app-layer-htp.c": [
          "File: src/app-layer-htp.c -> src/app-layer-htp.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2517: #endif",
          "2518: #ifdef HAVE_HTP_CONFIG_SET_COMPRESSION_TIME_LIMIT",
          "2519:     htp_config_set_compression_time_limit(cfg_prec->cfg, HTP_CONFIG_DEFAULT_COMPRESSION_TIME_LIMIT);",
          "2520: #endif",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2520: #endif",
          "2521: #ifdef HAVE_HTP_CONFIG_SET_MAX_TX",
          "2522: #define HTP_CONFIG_DEFAULT_MAX_TX_LIMIT 512",
          "2523:     htp_config_set_max_tx(cfg_prec->cfg, HTP_CONFIG_DEFAULT_MAX_TX_LIMIT);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2868:             }",
          "2869:             SCLogConfig(\"Setting HTTP decompression time limit to %\" PRIu32 \" usec\", limit);",
          "2870:             htp_config_set_compression_time_limit(cfg_prec->cfg, (size_t)limit);",
          "2871: #endif",
          "2872:         } else if (strcasecmp(\"randomize-inspection-sizes\", p->name) == 0) {",
          "2873:             if (!g_disable_randomness) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2875: #endif",
          "2876: #ifdef HAVE_HTP_CONFIG_SET_MAX_TX",
          "2877:         } else if (strcasecmp(\"max-tx\", p->name) == 0) {",
          "2878:             uint32_t limit = 0;",
          "2879:             if (ParseSizeStringU32(p->val, &limit) < 0) {",
          "2880:                 FatalError(\"failed to parse 'max-tx' \"",
          "2881:                            \"from conf file - %s.\",",
          "2882:                         p->val);",
          "2883:             }",
          "2885:             SCLogConfig(\"Setting HTTP max-tx limit to %\" PRIu32 \" bytes\", limit);",
          "2886:             htp_config_set_max_tx(cfg_prec->cfg, (size_t)limit);",
          "",
          "---------------"
        ],
        "suricata.yaml.in||suricata.yaml.in": [
          "File: suricata.yaml.in -> suricata.yaml.in",
          "--- Hunk 1 ---",
          "[Context before]",
          "1081:            #compression-bomb-limit: 1mb",
          "1082:            # Maximum time spent decompressing a single transaction in usec",
          "1083:            #decompression-time-limit: 100000",
          "1085:          server-config:",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1084:            # Maximum number of live transactions per flow",
          "1085:            #max-tx: 512",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "e7e28822f473320658d6125f16ac3f0524baff01",
      "candidate_info": {
        "commit_hash": "e7e28822f473320658d6125f16ac3f0524baff01",
        "repo": "OISF/suricata",
        "commit_url": "https://github.com/OISF/suricata/commit/e7e28822f473320658d6125f16ac3f0524baff01",
        "files": [
          "configure.ac",
          "doc/userguide/configuration/suricata-yaml.rst",
          "src/app-layer-htp.c",
          "suricata.yaml.in"
        ],
        "message": "http1: configurable max number of live tx per flow\n\nTicket: #5921\n\nCo-authored-by: Jason Ish <jason.ish@oisf.net>\n(cherry picked from commit 4175680a8a1c0dfaa491ee63d6e36c011d498473)",
        "before_after_code_files": [
          "configure.ac||configure.ac",
          "src/app-layer-htp.c||src/app-layer-htp.c",
          "suricata.yaml.in||suricata.yaml.in"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "configure.ac||configure.ac",
            "src/app-layer-htp.c||src/app-layer-htp.c"
          ],
          "candidate": [
            "configure.ac||configure.ac",
            "src/app-layer-htp.c||src/app-layer-htp.c"
          ]
        }
      },
      "candidate_diff": {
        "configure.ac||configure.ac": [
          "File: configure.ac -> configure.ac",
          "--- Hunk 1 ---",
          "[Context before]",
          "1596:         AC_CHECK_LIB([htp], [htp_config_set_lzma_layers],AC_DEFINE_UNQUOTED([HAVE_HTP_CONFIG_SET_LZMA_LAYERS],[1],[Found htp_config_set_lzma_layers function in libhtp]) ,,[-lhtp])",
          "1597:         AC_CHECK_LIB([htp], [htp_config_set_compression_bomb_limit],AC_DEFINE_UNQUOTED([HAVE_HTP_CONFIG_SET_COMPRESSION_BOMB_LIMIT],[1],[Found htp_config_set_compression_bomb_limit function in libhtp]) ,,[-lhtp])",
          "1598:         AC_CHECK_LIB([htp], [htp_config_set_compression_time_limit],AC_DEFINE_UNQUOTED([HAVE_HTP_CONFIG_SET_COMPRESSION_TIME_LIMIT],[1],[Found htp_config_set_compression_time_limit function in libhtp]) ,,[-lhtp])",
          "1599:     ])",
          "1601:     if test \"x$enable_non_bundled_htp\" = \"xno\"; then",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1599:         AC_CHECK_LIB([htp], [htp_config_set_max_tx],AC_DEFINE_UNQUOTED([HAVE_HTP_CONFIG_SET_MAX_TX],[1],[Found htp_config_set_max_tx function in libhtp]) ,,[-lhtp])",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1620:             AC_DEFINE_UNQUOTED([HAVE_HTP_CONFIG_SET_LZMA_LAYERS],[1],[Assuming htp_config_set_lzma_layers function in bundled libhtp])",
          "1621:             AC_DEFINE_UNQUOTED([HAVE_HTP_CONFIG_SET_COMPRESSION_BOMB_LIMIT],[1],[Assuming htp_config_set_compression_bomb_limit function in bundled libhtp])",
          "1622:             AC_DEFINE_UNQUOTED([HAVE_HTP_CONFIG_SET_COMPRESSION_TIME_LIMIT],[1],[Assuming htp_config_set_compression_time_limit function in bundled libhtp])",
          "1623:         else",
          "1624:             echo",
          "1625:             echo \"  ERROR: Libhtp is not bundled. Get libhtp by doing:\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1624:             AC_DEFINE_UNQUOTED([HAVE_HTP_CONFIG_SET_MAX_TX],[1],[Assuming htp_config_set_max_tx function in bundled libhtp])",
          "",
          "---------------"
        ],
        "src/app-layer-htp.c||src/app-layer-htp.c": [
          "File: src/app-layer-htp.c -> src/app-layer-htp.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2517: #endif",
          "2518: #ifdef HAVE_HTP_CONFIG_SET_COMPRESSION_TIME_LIMIT",
          "2519:     htp_config_set_compression_time_limit(cfg_prec->cfg, HTP_CONFIG_DEFAULT_COMPRESSION_TIME_LIMIT);",
          "2520: #endif",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2520: #endif",
          "2521: #ifdef HAVE_HTP_CONFIG_SET_MAX_TX",
          "2522: #define HTP_CONFIG_DEFAULT_MAX_TX_LIMIT 512",
          "2523:     htp_config_set_max_tx(cfg_prec->cfg, HTP_CONFIG_DEFAULT_MAX_TX_LIMIT);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2868:             }",
          "2869:             SCLogConfig(\"Setting HTTP decompression time limit to %\" PRIu32 \" usec\", limit);",
          "2870:             htp_config_set_compression_time_limit(cfg_prec->cfg, (size_t)limit);",
          "2871: #endif",
          "2872:         } else if (strcasecmp(\"randomize-inspection-sizes\", p->name) == 0) {",
          "2873:             if (!g_disable_randomness) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2875: #endif",
          "2876: #ifdef HAVE_HTP_CONFIG_SET_MAX_TX",
          "2877:         } else if (strcasecmp(\"max-tx\", p->name) == 0) {",
          "2878:             uint32_t limit = 0;",
          "2879:             if (ParseSizeStringU32(p->val, &limit) < 0) {",
          "2880:                 FatalError(\"failed to parse 'max-tx' \"",
          "2881:                            \"from conf file - %s.\",",
          "2882:                         p->val);",
          "2883:             }",
          "2885:             SCLogConfig(\"Setting HTTP max-tx limit to %\" PRIu32 \" bytes\", limit);",
          "2886:             htp_config_set_max_tx(cfg_prec->cfg, (size_t)limit);",
          "",
          "---------------"
        ],
        "suricata.yaml.in||suricata.yaml.in": [
          "File: suricata.yaml.in -> suricata.yaml.in",
          "--- Hunk 1 ---",
          "[Context before]",
          "1086:            #compression-bomb-limit: 1mb",
          "1087:            # Maximum time spent decompressing a single transaction in usec",
          "1088:            #decompression-time-limit: 100000",
          "1090:          server-config:",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1089:            # Maximum number of live transactions per flow",
          "1090:            #max-tx: 512",
          "",
          "---------------"
        ]
      }
    }
  ]
}