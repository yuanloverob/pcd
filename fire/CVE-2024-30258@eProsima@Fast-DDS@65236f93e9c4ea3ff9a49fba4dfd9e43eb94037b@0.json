{
  "cve_id": "CVE-2024-30258",
  "cve_desc": "FastDDS is a C++ implementation of the DDS (Data Distribution Service) standard of the OMG (Object Management Group). Prior to versions 2.14.1, 2.13.5, 2.10.4, and 2.6.8, when a publisher serves a malformed `RTPS` packet, the subscriber crashes when creating `pthread`. This can remotely crash any Fast-DDS process, potentially leading to a DOS attack. Versions 2.14.1, 2.13.5, 2.10.4, and 2.6.8 contain a patch for the issue.\n",
  "repo": "eProsima/Fast-DDS",
  "patch_hash": "65236f93e9c4ea3ff9a49fba4dfd9e43eb94037b",
  "patch_info": {
    "commit_hash": "65236f93e9c4ea3ff9a49fba4dfd9e43eb94037b",
    "repo": "eProsima/Fast-DDS",
    "commit_url": "https://github.com/eProsima/Fast-DDS/commit/65236f93e9c4ea3ff9a49fba4dfd9e43eb94037b",
    "files": [
      "include/fastdds/rtps/messages/CDRMessage.h",
      "include/fastdds/rtps/messages/CDRMessage.hpp",
      "src/cpp/fastdds/core/policy/ParameterSerializer.hpp",
      "test/blackbox/common/BlackboxTestsTransportUDP.cpp",
      "test/blackbox/datagrams/20574.bin",
      "test/blackbox/datagrams/20660.bin"
    ],
    "message": "Merge pull request from GHSA-53xw-465j-rxfh\n\nSigned-off-by: Mario Dominguez <mariodominguez@eprosima.com>",
    "before_after_code_files": [
      "include/fastdds/rtps/messages/CDRMessage.h||include/fastdds/rtps/messages/CDRMessage.h",
      "include/fastdds/rtps/messages/CDRMessage.hpp||include/fastdds/rtps/messages/CDRMessage.hpp",
      "src/cpp/fastdds/core/policy/ParameterSerializer.hpp||src/cpp/fastdds/core/policy/ParameterSerializer.hpp",
      "test/blackbox/common/BlackboxTestsTransportUDP.cpp||test/blackbox/common/BlackboxTestsTransportUDP.cpp"
    ]
  },
  "patch_diff": {
    "include/fastdds/rtps/messages/CDRMessage.h||include/fastdds/rtps/messages/CDRMessage.h": [
      "File: include/fastdds/rtps/messages/CDRMessage.h -> include/fastdds/rtps/messages/CDRMessage.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "141: inline bool readPropertySeq(",
      "142:         CDRMessage_t* msg,",
      "145: inline bool readBinaryPropertySeq(",
      "146:         CDRMessage_t* msg,",
      "149: inline bool readDataHolder(",
      "150:         CDRMessage_t* msg,",
      "153: inline bool readDataHolderSeq(",
      "154:         CDRMessage_t* msg,",
      "",
      "[Removed Lines]",
      "143:         PropertySeq& properties);",
      "147:         BinaryPropertySeq& binary_properties);",
      "151:         DataHolder& data_holder);",
      "",
      "[Added Lines]",
      "143:         PropertySeq& properties,",
      "144:         const uint32_t parameter_length);",
      "148:         BinaryPropertySeq& binary_properties,",
      "149:         const uint32_t parameter_length);",
      "153:         DataHolder& data_holder,",
      "154:         const uint32_t parameter_length);",
      "",
      "---------------"
    ],
    "include/fastdds/rtps/messages/CDRMessage.hpp||include/fastdds/rtps/messages/CDRMessage.hpp": [
      "File: include/fastdds/rtps/messages/CDRMessage.hpp -> include/fastdds/rtps/messages/CDRMessage.hpp",
      "--- Hunk 1 ---",
      "[Context before]",
      "861: inline bool CDRMessage::readPropertySeq(",
      "862:         CDRMessage_t* msg,",
      "864: {",
      "865:     assert(msg);",
      "",
      "[Removed Lines]",
      "863:         PropertySeq& properties)",
      "",
      "[Added Lines]",
      "863:         PropertySeq& properties,",
      "864:         const uint32_t parameter_length)",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "870:         return false;",
      "871:     }",
      "873:     properties.resize(length);",
      "874:     bool returnedValue = true;",
      "875:     for (uint32_t i = 0; returnedValue && i < length; ++i)",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "876:     if (16 * length > parameter_length)",
      "877:     {",
      "878:         return false;",
      "879:     }",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "963: inline bool CDRMessage::readBinaryPropertySeq(",
      "964:         CDRMessage_t* msg,",
      "966: {",
      "967:     assert(msg);",
      "",
      "[Removed Lines]",
      "965:         BinaryPropertySeq& binary_properties)",
      "",
      "[Added Lines]",
      "973:         BinaryPropertySeq& binary_properties,",
      "974:         const uint32_t parameter_length)",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "972:         return false;",
      "973:     }",
      "975:     binary_properties.resize(length);",
      "976:     bool returnedValue = true;",
      "977:     for (uint32_t i = 0; returnedValue && i < length; ++i)",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "987:     if (12 * length > parameter_length)",
      "988:     {",
      "989:         return false;",
      "990:     }",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "1007: inline bool CDRMessage::readDataHolder(",
      "1008:         CDRMessage_t* msg,",
      "1010: {",
      "1011:     assert(msg);",
      "",
      "[Removed Lines]",
      "1009:         DataHolder& data_holder)",
      "",
      "[Added Lines]",
      "1026:         DataHolder& data_holder,",
      "1027:         const uint32_t parameter_length)",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "1014:     {",
      "1015:         return false;",
      "1016:     }",
      "1018:     {",
      "1019:         return false;",
      "1020:     }",
      "1022:     {",
      "1023:         return false;",
      "1024:     }",
      "",
      "[Removed Lines]",
      "1017:     if (!CDRMessage::readPropertySeq(msg, data_holder.properties()))",
      "1021:     if (!CDRMessage::readBinaryPropertySeq(msg, data_holder.binary_properties()))",
      "",
      "[Added Lines]",
      "1035:     if (!CDRMessage::readPropertySeq(msg, data_holder.properties(), parameter_length))",
      "1039:     if (!CDRMessage::readBinaryPropertySeq(msg, data_holder.binary_properties(), parameter_length))",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "1063:         return false;",
      "1064:     }",
      "1066:     data_holders.resize(length);",
      "1067:     bool returnedValue = true;",
      "1068:     for (uint32_t i = 0; returnedValue && i < length; ++i)",
      "1069:     {",
      "1071:     }",
      "1073:     return returnedValue;",
      "",
      "[Removed Lines]",
      "1070:         returnedValue = CDRMessage::readDataHolder(msg, data_holders.at(i));",
      "",
      "[Added Lines]",
      "1087:     if (msg->pos + 16 * length > msg->length)",
      "1088:     {",
      "1089:         return false;",
      "1090:     }",
      "1097:         uint32_t remaining_length = msg->length - msg->pos;",
      "1098:         returnedValue = CDRMessage::readDataHolder(msg, data_holders.at(i), remaining_length);",
      "",
      "---------------"
    ],
    "src/cpp/fastdds/core/policy/ParameterSerializer.hpp||src/cpp/fastdds/core/policy/ParameterSerializer.hpp": [
      "File: src/cpp/fastdds/core/policy/ParameterSerializer.hpp -> src/cpp/fastdds/core/policy/ParameterSerializer.hpp",
      "--- Hunk 1 ---",
      "[Context before]",
      "1040:     parameter.length = parameter_length;",
      "1041:     uint32_t pos_ref = cdr_message->pos;",
      "1043:     uint32_t length_diff = cdr_message->pos - pos_ref;",
      "1044:     valid &= (parameter_length == length_diff);",
      "1045:     return valid;",
      "",
      "[Removed Lines]",
      "1042:     bool valid =  fastrtps::rtps::CDRMessage::readDataHolder(cdr_message, parameter.token);",
      "",
      "[Added Lines]",
      "1042:     bool valid =  fastrtps::rtps::CDRMessage::readDataHolder(cdr_message, parameter.token, parameter_length);",
      "",
      "---------------"
    ],
    "test/blackbox/common/BlackboxTestsTransportUDP.cpp||test/blackbox/common/BlackboxTestsTransportUDP.cpp": [
      "File: test/blackbox/common/BlackboxTestsTransportUDP.cpp -> test/blackbox/common/BlackboxTestsTransportUDP.cpp",
      "--- Hunk 1 ---",
      "[Context before]",
      "534:     DatagramInjectionTransport::deliver_datagram_from_file(receivers, \"datagrams/16784.bin\");",
      "535:     DatagramInjectionTransport::deliver_datagram_from_file(receivers, \"datagrams/20140.bin\");",
      "536: }",
      "538: TEST(TransportUDP, MaliciousManipulatedDataOctetsToNextHeaderIgnore)",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "536:     DatagramInjectionTransport::deliver_datagram_from_file(receivers, \"datagrams/20574.bin\");",
      "537:     DatagramInjectionTransport::deliver_datagram_from_file(receivers, \"datagrams/20660.bin\");",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "8032e655be42c37cf140028a807092def7709252",
      "candidate_info": {
        "commit_hash": "8032e655be42c37cf140028a807092def7709252",
        "repo": "eProsima/Fast-DDS",
        "commit_url": "https://github.com/eProsima/Fast-DDS/commit/8032e655be42c37cf140028a807092def7709252",
        "files": [
          "include/fastdds/rtps/messages/CDRMessage.h",
          "include/fastdds/rtps/messages/CDRMessage.hpp",
          "src/cpp/fastdds/core/policy/ParameterSerializer.hpp",
          "test/blackbox/common/BlackboxTestsTransportUDP.cpp",
          "test/blackbox/datagrams/20574.bin",
          "test/blackbox/datagrams/20660.bin"
        ],
        "message": "Fix CVE-2024-30258 / CVE-2024-30259\n\nSigned-off-by: Mario Dominguez <mariodominguez@eprosima.com>",
        "before_after_code_files": [
          "include/fastdds/rtps/messages/CDRMessage.h||include/fastdds/rtps/messages/CDRMessage.h",
          "include/fastdds/rtps/messages/CDRMessage.hpp||include/fastdds/rtps/messages/CDRMessage.hpp",
          "src/cpp/fastdds/core/policy/ParameterSerializer.hpp||src/cpp/fastdds/core/policy/ParameterSerializer.hpp",
          "test/blackbox/common/BlackboxTestsTransportUDP.cpp||test/blackbox/common/BlackboxTestsTransportUDP.cpp"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "include/fastdds/rtps/messages/CDRMessage.h||include/fastdds/rtps/messages/CDRMessage.h",
            "include/fastdds/rtps/messages/CDRMessage.hpp||include/fastdds/rtps/messages/CDRMessage.hpp",
            "src/cpp/fastdds/core/policy/ParameterSerializer.hpp||src/cpp/fastdds/core/policy/ParameterSerializer.hpp",
            "test/blackbox/common/BlackboxTestsTransportUDP.cpp||test/blackbox/common/BlackboxTestsTransportUDP.cpp"
          ],
          "candidate": [
            "include/fastdds/rtps/messages/CDRMessage.h||include/fastdds/rtps/messages/CDRMessage.h",
            "include/fastdds/rtps/messages/CDRMessage.hpp||include/fastdds/rtps/messages/CDRMessage.hpp",
            "src/cpp/fastdds/core/policy/ParameterSerializer.hpp||src/cpp/fastdds/core/policy/ParameterSerializer.hpp",
            "test/blackbox/common/BlackboxTestsTransportUDP.cpp||test/blackbox/common/BlackboxTestsTransportUDP.cpp"
          ]
        }
      },
      "candidate_diff": {
        "include/fastdds/rtps/messages/CDRMessage.h||include/fastdds/rtps/messages/CDRMessage.h": [
          "File: include/fastdds/rtps/messages/CDRMessage.h -> include/fastdds/rtps/messages/CDRMessage.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "141: inline bool readPropertySeq(",
          "142:         CDRMessage_t* msg,",
          "145: inline bool readBinaryPropertySeq(",
          "146:         CDRMessage_t* msg,",
          "149: inline bool readDataHolder(",
          "150:         CDRMessage_t* msg,",
          "153: inline bool readDataHolderSeq(",
          "154:         CDRMessage_t* msg,",
          "",
          "[Removed Lines]",
          "143:         PropertySeq& properties);",
          "147:         BinaryPropertySeq& binary_properties);",
          "151:         DataHolder& data_holder);",
          "",
          "[Added Lines]",
          "143:         PropertySeq& properties,",
          "144:         const uint32_t parameter_length);",
          "148:         BinaryPropertySeq& binary_properties,",
          "149:         const uint32_t parameter_length);",
          "153:         DataHolder& data_holder,",
          "154:         const uint32_t parameter_length);",
          "",
          "---------------"
        ],
        "include/fastdds/rtps/messages/CDRMessage.hpp||include/fastdds/rtps/messages/CDRMessage.hpp": [
          "File: include/fastdds/rtps/messages/CDRMessage.hpp -> include/fastdds/rtps/messages/CDRMessage.hpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "861: inline bool CDRMessage::readPropertySeq(",
          "862:         CDRMessage_t* msg,",
          "864: {",
          "865:     assert(msg);",
          "",
          "[Removed Lines]",
          "863:         PropertySeq& properties)",
          "",
          "[Added Lines]",
          "863:         PropertySeq& properties,",
          "864:         const uint32_t parameter_length)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "870:         return false;",
          "871:     }",
          "873:     properties.resize(length);",
          "874:     bool returnedValue = true;",
          "875:     for (uint32_t i = 0; returnedValue && i < length; ++i)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "876:     if (16 * length > parameter_length)",
          "877:     {",
          "878:         return false;",
          "879:     }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "963: inline bool CDRMessage::readBinaryPropertySeq(",
          "964:         CDRMessage_t* msg,",
          "966: {",
          "967:     assert(msg);",
          "",
          "[Removed Lines]",
          "965:         BinaryPropertySeq& binary_properties)",
          "",
          "[Added Lines]",
          "973:         BinaryPropertySeq& binary_properties,",
          "974:         const uint32_t parameter_length)",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "972:         return false;",
          "973:     }",
          "975:     binary_properties.resize(length);",
          "976:     bool returnedValue = true;",
          "977:     for (uint32_t i = 0; returnedValue && i < length; ++i)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "987:     if (12 * length > parameter_length)",
          "988:     {",
          "989:         return false;",
          "990:     }",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1007: inline bool CDRMessage::readDataHolder(",
          "1008:         CDRMessage_t* msg,",
          "1010: {",
          "1011:     assert(msg);",
          "",
          "[Removed Lines]",
          "1009:         DataHolder& data_holder)",
          "",
          "[Added Lines]",
          "1026:         DataHolder& data_holder,",
          "1027:         const uint32_t parameter_length)",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "1014:     {",
          "1015:         return false;",
          "1016:     }",
          "1018:     {",
          "1019:         return false;",
          "1020:     }",
          "1022:     {",
          "1023:         return false;",
          "1024:     }",
          "",
          "[Removed Lines]",
          "1017:     if (!CDRMessage::readPropertySeq(msg, data_holder.properties()))",
          "1021:     if (!CDRMessage::readBinaryPropertySeq(msg, data_holder.binary_properties()))",
          "",
          "[Added Lines]",
          "1035:     if (!CDRMessage::readPropertySeq(msg, data_holder.properties(), parameter_length))",
          "1039:     if (!CDRMessage::readBinaryPropertySeq(msg, data_holder.binary_properties(), parameter_length))",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "1063:         return false;",
          "1064:     }",
          "1066:     data_holders.resize(length);",
          "1067:     bool returnedValue = true;",
          "1068:     for (uint32_t i = 0; returnedValue && i < length; ++i)",
          "1069:     {",
          "1071:     }",
          "1073:     return returnedValue;",
          "",
          "[Removed Lines]",
          "1070:         returnedValue = CDRMessage::readDataHolder(msg, data_holders.at(i));",
          "",
          "[Added Lines]",
          "1087:     if (msg->pos + 16 * length > msg->length)",
          "1088:     {",
          "1089:         return false;",
          "1090:     }",
          "1097:         uint32_t remaining_length = msg->length - msg->pos;",
          "1098:         returnedValue = CDRMessage::readDataHolder(msg, data_holders.at(i), remaining_length);",
          "",
          "---------------"
        ],
        "src/cpp/fastdds/core/policy/ParameterSerializer.hpp||src/cpp/fastdds/core/policy/ParameterSerializer.hpp": [
          "File: src/cpp/fastdds/core/policy/ParameterSerializer.hpp -> src/cpp/fastdds/core/policy/ParameterSerializer.hpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "984:     parameter.length = parameter_length;",
          "985:     uint32_t pos_ref = cdr_message->pos;",
          "987:     uint32_t length_diff = cdr_message->pos - pos_ref;",
          "988:     valid &= (parameter_length == length_diff);",
          "989:     return valid;",
          "",
          "[Removed Lines]",
          "986:     bool valid =  fastrtps::rtps::CDRMessage::readDataHolder(cdr_message, parameter.token);",
          "",
          "[Added Lines]",
          "986:     bool valid =  fastrtps::rtps::CDRMessage::readDataHolder(cdr_message, parameter.token, parameter_length);",
          "",
          "---------------"
        ],
        "test/blackbox/common/BlackboxTestsTransportUDP.cpp||test/blackbox/common/BlackboxTestsTransportUDP.cpp": [
          "File: test/blackbox/common/BlackboxTestsTransportUDP.cpp -> test/blackbox/common/BlackboxTestsTransportUDP.cpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "551:     deliver_datagram_from_file(receivers, \"datagrams/16784.bin\");",
          "552:     deliver_datagram_from_file(receivers, \"datagrams/20140.bin\");",
          "553: }",
          "555: TEST(TransportUDP, MaliciousManipulatedDataOctetsToNextHeaderIgnore)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "553:     deliver_datagram_from_file(receivers, \"datagrams/20574.bin\");",
          "554:     deliver_datagram_from_file(receivers, \"datagrams/20660.bin\");",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "ab174f0983e81da0e099a8cc4ba9c89da5bcc873",
      "candidate_info": {
        "commit_hash": "ab174f0983e81da0e099a8cc4ba9c89da5bcc873",
        "repo": "eProsima/Fast-DDS",
        "commit_url": "https://github.com/eProsima/Fast-DDS/commit/ab174f0983e81da0e099a8cc4ba9c89da5bcc873",
        "files": [
          "include/fastdds/rtps/messages/CDRMessage.h",
          "include/fastdds/rtps/messages/CDRMessage.hpp",
          "src/cpp/fastdds/core/policy/ParameterSerializer.hpp",
          "test/blackbox/common/BlackboxTestsTransportUDP.cpp",
          "test/blackbox/datagrams/20574.bin",
          "test/blackbox/datagrams/20660.bin"
        ],
        "message": "Fix CVE-2024-30258 / CVE-2024-30259\n\nSigned-off-by: Mario Dominguez <mariodominguez@eprosima.com>",
        "before_after_code_files": [
          "include/fastdds/rtps/messages/CDRMessage.h||include/fastdds/rtps/messages/CDRMessage.h",
          "include/fastdds/rtps/messages/CDRMessage.hpp||include/fastdds/rtps/messages/CDRMessage.hpp",
          "src/cpp/fastdds/core/policy/ParameterSerializer.hpp||src/cpp/fastdds/core/policy/ParameterSerializer.hpp",
          "test/blackbox/common/BlackboxTestsTransportUDP.cpp||test/blackbox/common/BlackboxTestsTransportUDP.cpp"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "include/fastdds/rtps/messages/CDRMessage.h||include/fastdds/rtps/messages/CDRMessage.h",
            "include/fastdds/rtps/messages/CDRMessage.hpp||include/fastdds/rtps/messages/CDRMessage.hpp",
            "src/cpp/fastdds/core/policy/ParameterSerializer.hpp||src/cpp/fastdds/core/policy/ParameterSerializer.hpp",
            "test/blackbox/common/BlackboxTestsTransportUDP.cpp||test/blackbox/common/BlackboxTestsTransportUDP.cpp"
          ],
          "candidate": [
            "include/fastdds/rtps/messages/CDRMessage.h||include/fastdds/rtps/messages/CDRMessage.h",
            "include/fastdds/rtps/messages/CDRMessage.hpp||include/fastdds/rtps/messages/CDRMessage.hpp",
            "src/cpp/fastdds/core/policy/ParameterSerializer.hpp||src/cpp/fastdds/core/policy/ParameterSerializer.hpp",
            "test/blackbox/common/BlackboxTestsTransportUDP.cpp||test/blackbox/common/BlackboxTestsTransportUDP.cpp"
          ]
        }
      },
      "candidate_diff": {
        "include/fastdds/rtps/messages/CDRMessage.h||include/fastdds/rtps/messages/CDRMessage.h": [
          "File: include/fastdds/rtps/messages/CDRMessage.h -> include/fastdds/rtps/messages/CDRMessage.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "141: inline bool readPropertySeq(",
          "142:         CDRMessage_t* msg,",
          "145: inline bool readBinaryPropertySeq(",
          "146:         CDRMessage_t* msg,",
          "149: inline bool readDataHolder(",
          "150:         CDRMessage_t* msg,",
          "153: inline bool readDataHolderSeq(",
          "154:         CDRMessage_t* msg,",
          "",
          "[Removed Lines]",
          "143:         PropertySeq& properties);",
          "147:         BinaryPropertySeq& binary_properties);",
          "151:         DataHolder& data_holder);",
          "",
          "[Added Lines]",
          "143:         PropertySeq& properties,",
          "144:         const uint32_t parameter_length);",
          "148:         BinaryPropertySeq& binary_properties,",
          "149:         const uint32_t parameter_length);",
          "153:         DataHolder& data_holder,",
          "154:         const uint32_t parameter_length);",
          "",
          "---------------"
        ],
        "include/fastdds/rtps/messages/CDRMessage.hpp||include/fastdds/rtps/messages/CDRMessage.hpp": [
          "File: include/fastdds/rtps/messages/CDRMessage.hpp -> include/fastdds/rtps/messages/CDRMessage.hpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "861: inline bool CDRMessage::readPropertySeq(",
          "862:         CDRMessage_t* msg,",
          "864: {",
          "865:     assert(msg);",
          "",
          "[Removed Lines]",
          "863:         PropertySeq& properties)",
          "",
          "[Added Lines]",
          "863:         PropertySeq& properties,",
          "864:         const uint32_t parameter_length)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "870:         return false;",
          "871:     }",
          "873:     properties.resize(length);",
          "874:     bool returnedValue = true;",
          "875:     for (uint32_t i = 0; returnedValue && i < length; ++i)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "876:     if (16 * length > parameter_length)",
          "877:     {",
          "878:         return false;",
          "879:     }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "963: inline bool CDRMessage::readBinaryPropertySeq(",
          "964:         CDRMessage_t* msg,",
          "966: {",
          "967:     assert(msg);",
          "",
          "[Removed Lines]",
          "965:         BinaryPropertySeq& binary_properties)",
          "",
          "[Added Lines]",
          "973:         BinaryPropertySeq& binary_properties,",
          "974:         const uint32_t parameter_length)",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "972:         return false;",
          "973:     }",
          "975:     binary_properties.resize(length);",
          "976:     bool returnedValue = true;",
          "977:     for (uint32_t i = 0; returnedValue && i < length; ++i)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "987:     if (12 * length > parameter_length)",
          "988:     {",
          "989:         return false;",
          "990:     }",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1007: inline bool CDRMessage::readDataHolder(",
          "1008:         CDRMessage_t* msg,",
          "1010: {",
          "1011:     assert(msg);",
          "",
          "[Removed Lines]",
          "1009:         DataHolder& data_holder)",
          "",
          "[Added Lines]",
          "1026:         DataHolder& data_holder,",
          "1027:         const uint32_t parameter_length)",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "1014:     {",
          "1015:         return false;",
          "1016:     }",
          "1018:     {",
          "1019:         return false;",
          "1020:     }",
          "1022:     {",
          "1023:         return false;",
          "1024:     }",
          "",
          "[Removed Lines]",
          "1017:     if (!CDRMessage::readPropertySeq(msg, data_holder.properties()))",
          "1021:     if (!CDRMessage::readBinaryPropertySeq(msg, data_holder.binary_properties()))",
          "",
          "[Added Lines]",
          "1035:     if (!CDRMessage::readPropertySeq(msg, data_holder.properties(), parameter_length))",
          "1039:     if (!CDRMessage::readBinaryPropertySeq(msg, data_holder.binary_properties(), parameter_length))",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "1063:         return false;",
          "1064:     }",
          "1066:     data_holders.resize(length);",
          "1067:     bool returnedValue = true;",
          "1068:     for (uint32_t i = 0; returnedValue && i < length; ++i)",
          "1069:     {",
          "1071:     }",
          "1073:     return returnedValue;",
          "",
          "[Removed Lines]",
          "1070:         returnedValue = CDRMessage::readDataHolder(msg, data_holders.at(i));",
          "",
          "[Added Lines]",
          "1087:     if (msg->pos + 16 * length > msg->length)",
          "1088:     {",
          "1089:         return false;",
          "1090:     }",
          "1097:         uint32_t remaining_length = msg->length - msg->pos;",
          "1098:         returnedValue = CDRMessage::readDataHolder(msg, data_holders.at(i), remaining_length);",
          "",
          "---------------"
        ],
        "src/cpp/fastdds/core/policy/ParameterSerializer.hpp||src/cpp/fastdds/core/policy/ParameterSerializer.hpp": [
          "File: src/cpp/fastdds/core/policy/ParameterSerializer.hpp -> src/cpp/fastdds/core/policy/ParameterSerializer.hpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "1040:     parameter.length = parameter_length;",
          "1041:     uint32_t pos_ref = cdr_message->pos;",
          "1043:     uint32_t length_diff = cdr_message->pos - pos_ref;",
          "1044:     valid &= (parameter_length == length_diff);",
          "1045:     return valid;",
          "",
          "[Removed Lines]",
          "1042:     bool valid =  fastrtps::rtps::CDRMessage::readDataHolder(cdr_message, parameter.token);",
          "",
          "[Added Lines]",
          "1042:     bool valid =  fastrtps::rtps::CDRMessage::readDataHolder(cdr_message, parameter.token, parameter_length);",
          "",
          "---------------"
        ],
        "test/blackbox/common/BlackboxTestsTransportUDP.cpp||test/blackbox/common/BlackboxTestsTransportUDP.cpp": [
          "File: test/blackbox/common/BlackboxTestsTransportUDP.cpp -> test/blackbox/common/BlackboxTestsTransportUDP.cpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "555:     deliver_datagram_from_file(receivers, \"datagrams/16784.bin\");",
          "556:     deliver_datagram_from_file(receivers, \"datagrams/20140.bin\");",
          "557: }",
          "559: TEST(TransportUDP, MaliciousManipulatedDataOctetsToNextHeaderIgnore)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "557:     deliver_datagram_from_file(receivers, \"datagrams/20574.bin\");",
          "558:     deliver_datagram_from_file(receivers, \"datagrams/20660.bin\");",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "dbdc7a9ca82b7f31e5313d98fc5a03865f385a50",
      "candidate_info": {
        "commit_hash": "dbdc7a9ca82b7f31e5313d98fc5a03865f385a50",
        "repo": "eProsima/Fast-DDS",
        "commit_url": "https://github.com/eProsima/Fast-DDS/commit/dbdc7a9ca82b7f31e5313d98fc5a03865f385a50",
        "files": [
          "include/fastdds/rtps/messages/CDRMessage.h",
          "include/fastdds/rtps/messages/CDRMessage.hpp",
          "src/cpp/fastdds/core/policy/ParameterSerializer.hpp",
          "test/blackbox/common/BlackboxTestsTransportUDP.cpp",
          "test/blackbox/datagrams/20574.bin",
          "test/blackbox/datagrams/20660.bin"
        ],
        "message": "Fix CVE-2024-30258 / CVE-2024-30259\n\nSigned-off-by: Mario Dominguez <mariodominguez@eprosima.com>",
        "before_after_code_files": [
          "include/fastdds/rtps/messages/CDRMessage.h||include/fastdds/rtps/messages/CDRMessage.h",
          "include/fastdds/rtps/messages/CDRMessage.hpp||include/fastdds/rtps/messages/CDRMessage.hpp",
          "src/cpp/fastdds/core/policy/ParameterSerializer.hpp||src/cpp/fastdds/core/policy/ParameterSerializer.hpp",
          "test/blackbox/common/BlackboxTestsTransportUDP.cpp||test/blackbox/common/BlackboxTestsTransportUDP.cpp"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "include/fastdds/rtps/messages/CDRMessage.h||include/fastdds/rtps/messages/CDRMessage.h",
            "include/fastdds/rtps/messages/CDRMessage.hpp||include/fastdds/rtps/messages/CDRMessage.hpp",
            "src/cpp/fastdds/core/policy/ParameterSerializer.hpp||src/cpp/fastdds/core/policy/ParameterSerializer.hpp",
            "test/blackbox/common/BlackboxTestsTransportUDP.cpp||test/blackbox/common/BlackboxTestsTransportUDP.cpp"
          ],
          "candidate": [
            "include/fastdds/rtps/messages/CDRMessage.h||include/fastdds/rtps/messages/CDRMessage.h",
            "include/fastdds/rtps/messages/CDRMessage.hpp||include/fastdds/rtps/messages/CDRMessage.hpp",
            "src/cpp/fastdds/core/policy/ParameterSerializer.hpp||src/cpp/fastdds/core/policy/ParameterSerializer.hpp",
            "test/blackbox/common/BlackboxTestsTransportUDP.cpp||test/blackbox/common/BlackboxTestsTransportUDP.cpp"
          ]
        }
      },
      "candidate_diff": {
        "include/fastdds/rtps/messages/CDRMessage.h||include/fastdds/rtps/messages/CDRMessage.h": [
          "File: include/fastdds/rtps/messages/CDRMessage.h -> include/fastdds/rtps/messages/CDRMessage.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "141: inline bool readPropertySeq(",
          "142:         CDRMessage_t* msg,",
          "145: inline bool readBinaryPropertySeq(",
          "146:         CDRMessage_t* msg,",
          "149: inline bool readDataHolder(",
          "150:         CDRMessage_t* msg,",
          "153: inline bool readDataHolderSeq(",
          "154:         CDRMessage_t* msg,",
          "",
          "[Removed Lines]",
          "143:         PropertySeq& properties);",
          "147:         BinaryPropertySeq& binary_properties);",
          "151:         DataHolder& data_holder);",
          "",
          "[Added Lines]",
          "143:         PropertySeq& properties,",
          "144:         const uint32_t parameter_length);",
          "148:         BinaryPropertySeq& binary_properties,",
          "149:         const uint32_t parameter_length);",
          "153:         DataHolder& data_holder,",
          "154:         const uint32_t parameter_length);",
          "",
          "---------------"
        ],
        "include/fastdds/rtps/messages/CDRMessage.hpp||include/fastdds/rtps/messages/CDRMessage.hpp": [
          "File: include/fastdds/rtps/messages/CDRMessage.hpp -> include/fastdds/rtps/messages/CDRMessage.hpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "861: inline bool CDRMessage::readPropertySeq(",
          "862:         CDRMessage_t* msg,",
          "864: {",
          "865:     assert(msg);",
          "",
          "[Removed Lines]",
          "863:         PropertySeq& properties)",
          "",
          "[Added Lines]",
          "863:         PropertySeq& properties,",
          "864:         const uint32_t parameter_length)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "870:         return false;",
          "871:     }",
          "873:     properties.resize(length);",
          "874:     bool returnedValue = true;",
          "875:     for (uint32_t i = 0; returnedValue && i < length; ++i)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "876:     if (16 * length > parameter_length)",
          "877:     {",
          "878:         return false;",
          "879:     }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "963: inline bool CDRMessage::readBinaryPropertySeq(",
          "964:         CDRMessage_t* msg,",
          "966: {",
          "967:     assert(msg);",
          "",
          "[Removed Lines]",
          "965:         BinaryPropertySeq& binary_properties)",
          "",
          "[Added Lines]",
          "973:         BinaryPropertySeq& binary_properties,",
          "974:         const uint32_t parameter_length)",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "972:         return false;",
          "973:     }",
          "975:     binary_properties.resize(length);",
          "976:     bool returnedValue = true;",
          "977:     for (uint32_t i = 0; returnedValue && i < length; ++i)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "987:     if (12 * length > parameter_length)",
          "988:     {",
          "989:         return false;",
          "990:     }",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1007: inline bool CDRMessage::readDataHolder(",
          "1008:         CDRMessage_t* msg,",
          "1010: {",
          "1011:     assert(msg);",
          "",
          "[Removed Lines]",
          "1009:         DataHolder& data_holder)",
          "",
          "[Added Lines]",
          "1026:         DataHolder& data_holder,",
          "1027:         const uint32_t parameter_length)",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "1014:     {",
          "1015:         return false;",
          "1016:     }",
          "1018:     {",
          "1019:         return false;",
          "1020:     }",
          "1022:     {",
          "1023:         return false;",
          "1024:     }",
          "",
          "[Removed Lines]",
          "1017:     if (!CDRMessage::readPropertySeq(msg, data_holder.properties()))",
          "1021:     if (!CDRMessage::readBinaryPropertySeq(msg, data_holder.binary_properties()))",
          "",
          "[Added Lines]",
          "1035:     if (!CDRMessage::readPropertySeq(msg, data_holder.properties(), parameter_length))",
          "1039:     if (!CDRMessage::readBinaryPropertySeq(msg, data_holder.binary_properties(), parameter_length))",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "1063:         return false;",
          "1064:     }",
          "1066:     data_holders.resize(length);",
          "1067:     bool returnedValue = true;",
          "1068:     for (uint32_t i = 0; returnedValue && i < length; ++i)",
          "1069:     {",
          "1071:     }",
          "1073:     return returnedValue;",
          "",
          "[Removed Lines]",
          "1070:         returnedValue = CDRMessage::readDataHolder(msg, data_holders.at(i));",
          "",
          "[Added Lines]",
          "1087:     if (msg->pos + 16 * length > msg->length)",
          "1088:     {",
          "1089:         return false;",
          "1090:     }",
          "1097:         uint32_t remaining_length = msg->length - msg->pos;",
          "1098:         returnedValue = CDRMessage::readDataHolder(msg, data_holders.at(i), remaining_length);",
          "",
          "---------------"
        ],
        "src/cpp/fastdds/core/policy/ParameterSerializer.hpp||src/cpp/fastdds/core/policy/ParameterSerializer.hpp": [
          "File: src/cpp/fastdds/core/policy/ParameterSerializer.hpp -> src/cpp/fastdds/core/policy/ParameterSerializer.hpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "1018:     parameter.length = parameter_length;",
          "1019:     uint32_t pos_ref = cdr_message->pos;",
          "1021:     uint32_t length_diff = cdr_message->pos - pos_ref;",
          "1022:     valid &= (parameter_length == length_diff);",
          "1023:     return valid;",
          "",
          "[Removed Lines]",
          "1020:     bool valid =  fastrtps::rtps::CDRMessage::readDataHolder(cdr_message, parameter.token);",
          "",
          "[Added Lines]",
          "1020:     bool valid =  fastrtps::rtps::CDRMessage::readDataHolder(cdr_message, parameter.token, parameter_length);",
          "",
          "---------------"
        ],
        "test/blackbox/common/BlackboxTestsTransportUDP.cpp||test/blackbox/common/BlackboxTestsTransportUDP.cpp": [
          "File: test/blackbox/common/BlackboxTestsTransportUDP.cpp -> test/blackbox/common/BlackboxTestsTransportUDP.cpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "551:     deliver_datagram_from_file(receivers, \"datagrams/16784.bin\");",
          "552:     deliver_datagram_from_file(receivers, \"datagrams/20140.bin\");",
          "553: }",
          "555: TEST(TransportUDP, MaliciousManipulatedDataOctetsToNextHeaderIgnore)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "553:     deliver_datagram_from_file(receivers, \"datagrams/20574.bin\");",
          "554:     deliver_datagram_from_file(receivers, \"datagrams/20660.bin\");",
          "",
          "---------------"
        ]
      }
    }
  ]
}