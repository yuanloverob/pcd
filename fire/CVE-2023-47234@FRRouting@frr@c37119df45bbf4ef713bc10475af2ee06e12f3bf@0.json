{
  "cve_id": "CVE-2023-47234",
  "cve_desc": "An issue was discovered in FRRouting FRR through 9.0.1. A crash can occur when processing a crafted BGP UPDATE message with a MP_UNREACH_NLRI attribute and additional NLRI data (that lacks mandatory path attributes).",
  "repo": "FRRouting/frr",
  "patch_hash": "c37119df45bbf4ef713bc10475af2ee06e12f3bf",
  "patch_info": {
    "commit_hash": "c37119df45bbf4ef713bc10475af2ee06e12f3bf",
    "repo": "FRRouting/frr",
    "commit_url": "https://github.com/FRRouting/frr/commit/c37119df45bbf4ef713bc10475af2ee06e12f3bf",
    "files": [
      "bgpd/bgp_attr.c",
      "bgpd/bgp_attr.h",
      "bgpd/bgp_packet.c"
    ],
    "message": "bgpd: Ignore handling NLRIs if we received MP_UNREACH_NLRI\n\nIf we receive MP_UNREACH_NLRI, we should stop handling remaining NLRIs if\nno mandatory path attributes received.\n\nIn other words, if MP_UNREACH_NLRI received, the remaining NLRIs should be handled\nas a new data, but without mandatory attributes, it's a malformed packet.\n\nIn normal case, this MUST not happen at all, but to avoid crashing bgpd, we MUST\nhandle that.\n\nReported-by: Iggy Frankovic <iggyfran@amazon.com>\nSigned-off-by: Donatas Abraitis <donatas@opensourcerouting.org>",
    "before_after_code_files": [
      "bgpd/bgp_attr.c||bgpd/bgp_attr.c",
      "bgpd/bgp_attr.h||bgpd/bgp_attr.h",
      "bgpd/bgp_packet.c||bgpd/bgp_packet.c"
    ]
  },
  "patch_diff": {
    "bgpd/bgp_attr.c||bgpd/bgp_attr.c": [
      "File: bgpd/bgp_attr.c -> bgpd/bgp_attr.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "3399:      !length)",
      "3400:   return BGP_ATTR_PARSE_WITHDRAW;",
      "3411:  if (!CHECK_FLAG(attr->flag, ATTR_FLAG_BIT(BGP_ATTR_ORIGIN)))",
      "3412:   type = BGP_ATTR_ORIGIN;",
      "",
      "[Removed Lines]",
      "3403:     to carry any other path attributes.\", though if MP_REACH_NLRI or NLRI",
      "3404:     are present, it should.  Check for any other attribute being present",
      "3405:     instead.",
      "3407:  if ((!CHECK_FLAG(attr->flag, ATTR_FLAG_BIT(BGP_ATTR_MP_REACH_NLRI)) &&",
      "3408:       CHECK_FLAG(attr->flag, ATTR_FLAG_BIT(BGP_ATTR_MP_UNREACH_NLRI))))",
      "3409:   return BGP_ATTR_PARSE_PROCEED;",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "3426:      && !CHECK_FLAG(attr->flag, ATTR_FLAG_BIT(BGP_ATTR_LOCAL_PREF)))",
      "3427:   type = BGP_ATTR_LOCAL_PREF;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "3425:  if (!CHECK_FLAG(attr->flag, ATTR_FLAG_BIT(BGP_ATTR_MP_REACH_NLRI)) &&",
      "3426:      CHECK_FLAG(attr->flag, ATTR_FLAG_BIT(BGP_ATTR_MP_UNREACH_NLRI)))",
      "3427:   return type ? BGP_ATTR_PARSE_MISSING_MANDATORY",
      "3428:        : BGP_ATTR_PARSE_PROCEED;",
      "",
      "---------------"
    ],
    "bgpd/bgp_attr.h||bgpd/bgp_attr.h": [
      "File: bgpd/bgp_attr.h -> bgpd/bgp_attr.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "366:  BGP_ATTR_PARSE_ERROR_NOTIFYPLS = -3,",
      "367: };",
      "369: struct bpacket_attr_vec_arr;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "367:  BGP_ATTR_PARSE_MISSING_MANDATORY = -4,",
      "",
      "---------------"
    ],
    "bgpd/bgp_packet.c||bgpd/bgp_packet.c": [
      "File: bgpd/bgp_packet.c -> bgpd/bgp_packet.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "2360:  update_len = end - stream_pnt(s);",
      "2364:   nlris[NLRI_UPDATE].afi = AFI_IP;",
      "2365:   nlris[NLRI_UPDATE].safi = SAFI_UNICAST;",
      "",
      "[Removed Lines]",
      "2362:  if (update_len && attribute_len) {",
      "",
      "[Added Lines]",
      "2366:  if (update_len && attribute_len &&",
      "2367:      attr_parse_ret != BGP_ATTR_PARSE_MISSING_MANDATORY) {",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "b21e7b8fe8c4970f2f6f794cb78bcc93057af94f",
      "candidate_info": {
        "commit_hash": "b21e7b8fe8c4970f2f6f794cb78bcc93057af94f",
        "repo": "FRRouting/frr",
        "commit_url": "https://github.com/FRRouting/frr/commit/b21e7b8fe8c4970f2f6f794cb78bcc93057af94f",
        "files": [
          "bgpd/bgp_attr.c",
          "bgpd/bgp_attr.h",
          "bgpd/bgp_packet.c"
        ],
        "message": "bgpd: Ignore handling NLRIs if we received MP_UNREACH_NLRI\n\nIf we receive MP_UNREACH_NLRI, we should stop handling remaining NLRIs if\nno mandatory path attributes received.\n\nIn other words, if MP_UNREACH_NLRI received, the remaining NLRIs should be handled\nas a new data, but without mandatory attributes, it's a malformed packet.\n\nIn normal case, this MUST not happen at all, but to avoid crashing bgpd, we MUST\nhandle that.\n\nReported-by: Iggy Frankovic <iggyfran@amazon.com>\nSigned-off-by: Donatas Abraitis <donatas@opensourcerouting.org>\n(cherry picked from commit c37119df45bbf4ef713bc10475af2ee06e12f3bf)",
        "before_after_code_files": [
          "bgpd/bgp_attr.c||bgpd/bgp_attr.c",
          "bgpd/bgp_attr.h||bgpd/bgp_attr.h",
          "bgpd/bgp_packet.c||bgpd/bgp_packet.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "bgpd/bgp_attr.c||bgpd/bgp_attr.c",
            "bgpd/bgp_attr.h||bgpd/bgp_attr.h",
            "bgpd/bgp_packet.c||bgpd/bgp_packet.c"
          ],
          "candidate": [
            "bgpd/bgp_attr.c||bgpd/bgp_attr.c",
            "bgpd/bgp_attr.h||bgpd/bgp_attr.h",
            "bgpd/bgp_packet.c||bgpd/bgp_packet.c"
          ]
        }
      },
      "candidate_diff": {
        "bgpd/bgp_attr.c||bgpd/bgp_attr.c": [
          "File: bgpd/bgp_attr.c -> bgpd/bgp_attr.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "3120:      !length)",
          "3121:   return BGP_ATTR_PARSE_WITHDRAW;",
          "3132:  if (!CHECK_FLAG(attr->flag, ATTR_FLAG_BIT(BGP_ATTR_ORIGIN)))",
          "3133:   type = BGP_ATTR_ORIGIN;",
          "",
          "[Removed Lines]",
          "3124:     to carry any other path attributes.\", though if MP_REACH_NLRI or NLRI",
          "3125:     are present, it should.  Check for any other attribute being present",
          "3126:     instead.",
          "3128:  if ((!CHECK_FLAG(attr->flag, ATTR_FLAG_BIT(BGP_ATTR_MP_REACH_NLRI)) &&",
          "3129:       CHECK_FLAG(attr->flag, ATTR_FLAG_BIT(BGP_ATTR_MP_UNREACH_NLRI))))",
          "3130:   return BGP_ATTR_PARSE_PROCEED;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "3147:      && !CHECK_FLAG(attr->flag, ATTR_FLAG_BIT(BGP_ATTR_LOCAL_PREF)))",
          "3148:   type = BGP_ATTR_LOCAL_PREF;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3146:  if (!CHECK_FLAG(attr->flag, ATTR_FLAG_BIT(BGP_ATTR_MP_REACH_NLRI)) &&",
          "3147:      CHECK_FLAG(attr->flag, ATTR_FLAG_BIT(BGP_ATTR_MP_UNREACH_NLRI)))",
          "3148:   return type ? BGP_ATTR_PARSE_MISSING_MANDATORY",
          "3149:        : BGP_ATTR_PARSE_PROCEED;",
          "",
          "---------------"
        ],
        "bgpd/bgp_attr.h||bgpd/bgp_attr.h": [
          "File: bgpd/bgp_attr.h -> bgpd/bgp_attr.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "384:  BGP_ATTR_PARSE_ERROR_NOTIFYPLS = -3,",
          "385: };",
          "387: struct bpacket_attr_vec_arr;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "385:  BGP_ATTR_PARSE_MISSING_MANDATORY = -4,",
          "",
          "---------------"
        ],
        "bgpd/bgp_packet.c||bgpd/bgp_packet.c": [
          "File: bgpd/bgp_packet.c -> bgpd/bgp_packet.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1952:  update_len = end - stream_pnt(s);",
          "1956:   nlris[NLRI_UPDATE].afi = AFI_IP;",
          "1957:   nlris[NLRI_UPDATE].safi = SAFI_UNICAST;",
          "",
          "[Removed Lines]",
          "1954:  if (update_len && attribute_len) {",
          "",
          "[Added Lines]",
          "1958:  if (update_len && attribute_len &&",
          "1959:      attr_parse_ret != BGP_ATTR_PARSE_MISSING_MANDATORY) {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "7893fecf7d24acf9c365c3982152ec6cc43a24ee",
      "candidate_info": {
        "commit_hash": "7893fecf7d24acf9c365c3982152ec6cc43a24ee",
        "repo": "FRRouting/frr",
        "commit_url": "https://github.com/FRRouting/frr/commit/7893fecf7d24acf9c365c3982152ec6cc43a24ee",
        "files": [
          "bgpd/bgp_attr.c",
          "bgpd/bgp_attr.h",
          "bgpd/bgp_packet.c"
        ],
        "message": "bgpd: Ignore handling NLRIs if we received MP_UNREACH_NLRI\n\nIf we receive MP_UNREACH_NLRI, we should stop handling remaining NLRIs if\nno mandatory path attributes received.\n\nIn other words, if MP_UNREACH_NLRI received, the remaining NLRIs should be handled\nas a new data, but without mandatory attributes, it's a malformed packet.\n\nIn normal case, this MUST not happen at all, but to avoid crashing bgpd, we MUST\nhandle that.\n\nReported-by: Iggy Frankovic <iggyfran@amazon.com>\nSigned-off-by: Donatas Abraitis <donatas@opensourcerouting.org>\nSigned-off-by: Christian Breunig <christian@breunig.cc>\n\n(cherry picked from commit c37119df45bbf4ef713bc10475af2ee06e12f3bf)",
        "before_after_code_files": [
          "bgpd/bgp_attr.c||bgpd/bgp_attr.c",
          "bgpd/bgp_attr.h||bgpd/bgp_attr.h",
          "bgpd/bgp_packet.c||bgpd/bgp_packet.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "bgpd/bgp_attr.c||bgpd/bgp_attr.c",
            "bgpd/bgp_attr.h||bgpd/bgp_attr.h",
            "bgpd/bgp_packet.c||bgpd/bgp_packet.c"
          ],
          "candidate": [
            "bgpd/bgp_attr.c||bgpd/bgp_attr.c",
            "bgpd/bgp_attr.h||bgpd/bgp_attr.h",
            "bgpd/bgp_packet.c||bgpd/bgp_packet.c"
          ]
        }
      },
      "candidate_diff": {
        "bgpd/bgp_attr.c||bgpd/bgp_attr.c": [
          "File: bgpd/bgp_attr.c -> bgpd/bgp_attr.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2850:  if (CHECK_FLAG(peer->cap, PEER_CAP_RESTART_RCV) && !attr->flag)",
          "2851:   return BGP_ATTR_PARSE_PROCEED;",
          "2862:  if (!CHECK_FLAG(attr->flag, ATTR_FLAG_BIT(BGP_ATTR_ORIGIN)))",
          "2863:   type = BGP_ATTR_ORIGIN;",
          "",
          "[Removed Lines]",
          "2854:     to carry any other path attributes.\", though if MP_REACH_NLRI or NLRI",
          "2855:     are present, it should.  Check for any other attribute being present",
          "2856:     instead.",
          "2858:  if ((!CHECK_FLAG(attr->flag, ATTR_FLAG_BIT(BGP_ATTR_MP_REACH_NLRI)) &&",
          "2859:       CHECK_FLAG(attr->flag, ATTR_FLAG_BIT(BGP_ATTR_MP_UNREACH_NLRI))))",
          "2860:   return BGP_ATTR_PARSE_PROCEED;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2877:      && !CHECK_FLAG(attr->flag, ATTR_FLAG_BIT(BGP_ATTR_LOCAL_PREF)))",
          "2878:   type = BGP_ATTR_LOCAL_PREF;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2876:  if (!CHECK_FLAG(attr->flag, ATTR_FLAG_BIT(BGP_ATTR_MP_REACH_NLRI)) &&",
          "2877:      CHECK_FLAG(attr->flag, ATTR_FLAG_BIT(BGP_ATTR_MP_UNREACH_NLRI)))",
          "2878:   return type ? BGP_ATTR_PARSE_MISSING_MANDATORY",
          "2879:        : BGP_ATTR_PARSE_PROCEED;",
          "",
          "---------------"
        ],
        "bgpd/bgp_attr.h||bgpd/bgp_attr.h": [
          "File: bgpd/bgp_attr.h -> bgpd/bgp_attr.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "340:  BGP_ATTR_PARSE_ERROR_NOTIFYPLS = -3,",
          "341:  BGP_ATTR_PARSE_EOR = -4,",
          "342: } bgp_attr_parse_ret_t;",
          "344: struct bpacket_attr_vec_arr;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "342:  BGP_ATTR_PARSE_MISSING_MANDATORY = -5,",
          "",
          "---------------"
        ],
        "bgpd/bgp_packet.c||bgpd/bgp_packet.c": [
          "File: bgpd/bgp_packet.c -> bgpd/bgp_packet.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1626:  update_len = end - stream_pnt(s);",
          "1630:   nlris[NLRI_UPDATE].afi = AFI_IP;",
          "1631:   nlris[NLRI_UPDATE].safi = SAFI_UNICAST;",
          "",
          "[Removed Lines]",
          "1628:  if (update_len) {",
          "",
          "[Added Lines]",
          "1632:  if (update_len && attribute_len &&",
          "1633:      attr_parse_ret != BGP_ATTR_PARSE_MISSING_MANDATORY) {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "250844bbcabcc55d9cc009c0769718a4f2a1e166",
      "candidate_info": {
        "commit_hash": "250844bbcabcc55d9cc009c0769718a4f2a1e166",
        "repo": "FRRouting/frr",
        "commit_url": "https://github.com/FRRouting/frr/commit/250844bbcabcc55d9cc009c0769718a4f2a1e166",
        "files": [
          "bgpd/bgp_attr.c",
          "bgpd/bgp_attr.h",
          "bgpd/bgp_packet.c"
        ],
        "message": "bgpd: Ignore handling NLRIs if we received MP_UNREACH_NLRI\n\nIf we receive MP_UNREACH_NLRI, we should stop handling remaining NLRIs if\nno mandatory path attributes received.\n\nIn other words, if MP_UNREACH_NLRI received, the remaining NLRIs should be handled\nas a new data, but without mandatory attributes, it's a malformed packet.\n\nIn normal case, this MUST not happen at all, but to avoid crashing bgpd, we MUST\nhandle that.\n\nReported-by: Iggy Frankovic <iggyfran@amazon.com>\nSigned-off-by: Donatas Abraitis <donatas@opensourcerouting.org>\n(cherry picked from commit c37119df45bbf4ef713bc10475af2ee06e12f3bf)",
        "before_after_code_files": [
          "bgpd/bgp_attr.c||bgpd/bgp_attr.c",
          "bgpd/bgp_attr.h||bgpd/bgp_attr.h",
          "bgpd/bgp_packet.c||bgpd/bgp_packet.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "bgpd/bgp_attr.c||bgpd/bgp_attr.c",
            "bgpd/bgp_attr.h||bgpd/bgp_attr.h",
            "bgpd/bgp_packet.c||bgpd/bgp_packet.c"
          ],
          "candidate": [
            "bgpd/bgp_attr.c||bgpd/bgp_attr.c",
            "bgpd/bgp_attr.h||bgpd/bgp_attr.h",
            "bgpd/bgp_packet.c||bgpd/bgp_packet.c"
          ]
        }
      },
      "candidate_diff": {
        "bgpd/bgp_attr.c||bgpd/bgp_attr.c": [
          "File: bgpd/bgp_attr.c -> bgpd/bgp_attr.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "3399:      !length)",
          "3400:   return BGP_ATTR_PARSE_WITHDRAW;",
          "3411:  if (!CHECK_FLAG(attr->flag, ATTR_FLAG_BIT(BGP_ATTR_ORIGIN)))",
          "3412:   type = BGP_ATTR_ORIGIN;",
          "",
          "[Removed Lines]",
          "3403:     to carry any other path attributes.\", though if MP_REACH_NLRI or NLRI",
          "3404:     are present, it should.  Check for any other attribute being present",
          "3405:     instead.",
          "3407:  if ((!CHECK_FLAG(attr->flag, ATTR_FLAG_BIT(BGP_ATTR_MP_REACH_NLRI)) &&",
          "3408:       CHECK_FLAG(attr->flag, ATTR_FLAG_BIT(BGP_ATTR_MP_UNREACH_NLRI))))",
          "3409:   return BGP_ATTR_PARSE_PROCEED;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "3426:      && !CHECK_FLAG(attr->flag, ATTR_FLAG_BIT(BGP_ATTR_LOCAL_PREF)))",
          "3427:   type = BGP_ATTR_LOCAL_PREF;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3425:  if (!CHECK_FLAG(attr->flag, ATTR_FLAG_BIT(BGP_ATTR_MP_REACH_NLRI)) &&",
          "3426:      CHECK_FLAG(attr->flag, ATTR_FLAG_BIT(BGP_ATTR_MP_UNREACH_NLRI)))",
          "3427:   return type ? BGP_ATTR_PARSE_MISSING_MANDATORY",
          "3428:        : BGP_ATTR_PARSE_PROCEED;",
          "",
          "---------------"
        ],
        "bgpd/bgp_attr.h||bgpd/bgp_attr.h": [
          "File: bgpd/bgp_attr.h -> bgpd/bgp_attr.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "366:  BGP_ATTR_PARSE_ERROR_NOTIFYPLS = -3,",
          "367: };",
          "369: struct bpacket_attr_vec_arr;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "367:  BGP_ATTR_PARSE_MISSING_MANDATORY = -4,",
          "",
          "---------------"
        ],
        "bgpd/bgp_packet.c||bgpd/bgp_packet.c": [
          "File: bgpd/bgp_packet.c -> bgpd/bgp_packet.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2166:  update_len = end - stream_pnt(s);",
          "2170:   nlris[NLRI_UPDATE].afi = AFI_IP;",
          "2171:   nlris[NLRI_UPDATE].safi = SAFI_UNICAST;",
          "",
          "[Removed Lines]",
          "2168:  if (update_len && attribute_len) {",
          "",
          "[Added Lines]",
          "2172:  if (update_len && attribute_len &&",
          "2173:      attr_parse_ret != BGP_ATTR_PARSE_MISSING_MANDATORY) {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "c25bdf085532f6ca636a927a8fe4352bd570df9d",
      "candidate_info": {
        "commit_hash": "c25bdf085532f6ca636a927a8fe4352bd570df9d",
        "repo": "FRRouting/frr",
        "commit_url": "https://github.com/FRRouting/frr/commit/c25bdf085532f6ca636a927a8fe4352bd570df9d",
        "files": [
          "bgpd/bgp_attr.c",
          "bgpd/bgp_attr.h",
          "bgpd/bgp_packet.c"
        ],
        "message": "bgpd: Ignore handling NLRIs if we received MP_UNREACH_NLRI\n\nIf we receive MP_UNREACH_NLRI, we should stop handling remaining NLRIs if\nno mandatory path attributes received.\n\nIn other words, if MP_UNREACH_NLRI received, the remaining NLRIs should be handled\nas a new data, but without mandatory attributes, it's a malformed packet.\n\nIn normal case, this MUST not happen at all, but to avoid crashing bgpd, we MUST\nhandle that.\n\nReported-by: Iggy Frankovic <iggyfran@amazon.com>\nSigned-off-by: Donatas Abraitis <donatas@opensourcerouting.org>\n(cherry picked from commit c37119df45bbf4ef713bc10475af2ee06e12f3bf)",
        "before_after_code_files": [
          "bgpd/bgp_attr.c||bgpd/bgp_attr.c",
          "bgpd/bgp_attr.h||bgpd/bgp_attr.h",
          "bgpd/bgp_packet.c||bgpd/bgp_packet.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "bgpd/bgp_attr.c||bgpd/bgp_attr.c",
            "bgpd/bgp_attr.h||bgpd/bgp_attr.h",
            "bgpd/bgp_packet.c||bgpd/bgp_packet.c"
          ],
          "candidate": [
            "bgpd/bgp_attr.c||bgpd/bgp_attr.c",
            "bgpd/bgp_attr.h||bgpd/bgp_attr.h",
            "bgpd/bgp_packet.c||bgpd/bgp_packet.c"
          ]
        }
      },
      "candidate_diff": {
        "bgpd/bgp_attr.c||bgpd/bgp_attr.c": [
          "File: bgpd/bgp_attr.c -> bgpd/bgp_attr.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "3363:      !length)",
          "3364:   return BGP_ATTR_PARSE_WITHDRAW;",
          "3375:  if (!CHECK_FLAG(attr->flag, ATTR_FLAG_BIT(BGP_ATTR_ORIGIN)))",
          "3376:   type = BGP_ATTR_ORIGIN;",
          "",
          "[Removed Lines]",
          "3367:     to carry any other path attributes.\", though if MP_REACH_NLRI or NLRI",
          "3368:     are present, it should.  Check for any other attribute being present",
          "3369:     instead.",
          "3371:  if ((!CHECK_FLAG(attr->flag, ATTR_FLAG_BIT(BGP_ATTR_MP_REACH_NLRI)) &&",
          "3372:       CHECK_FLAG(attr->flag, ATTR_FLAG_BIT(BGP_ATTR_MP_UNREACH_NLRI))))",
          "3373:   return BGP_ATTR_PARSE_PROCEED;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "3390:      && !CHECK_FLAG(attr->flag, ATTR_FLAG_BIT(BGP_ATTR_LOCAL_PREF)))",
          "3391:   type = BGP_ATTR_LOCAL_PREF;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3389:  if (!CHECK_FLAG(attr->flag, ATTR_FLAG_BIT(BGP_ATTR_MP_REACH_NLRI)) &&",
          "3390:      CHECK_FLAG(attr->flag, ATTR_FLAG_BIT(BGP_ATTR_MP_UNREACH_NLRI)))",
          "3391:   return type ? BGP_ATTR_PARSE_MISSING_MANDATORY",
          "3392:        : BGP_ATTR_PARSE_PROCEED;",
          "",
          "---------------"
        ],
        "bgpd/bgp_attr.h||bgpd/bgp_attr.h": [
          "File: bgpd/bgp_attr.h -> bgpd/bgp_attr.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "366:  BGP_ATTR_PARSE_ERROR_NOTIFYPLS = -3,",
          "367: };",
          "369: struct bpacket_attr_vec_arr;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "367:  BGP_ATTR_PARSE_MISSING_MANDATORY = -4,",
          "",
          "---------------"
        ],
        "bgpd/bgp_packet.c||bgpd/bgp_packet.c": [
          "File: bgpd/bgp_packet.c -> bgpd/bgp_packet.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1977:  update_len = end - stream_pnt(s);",
          "1981:   nlris[NLRI_UPDATE].afi = AFI_IP;",
          "1982:   nlris[NLRI_UPDATE].safi = SAFI_UNICAST;",
          "",
          "[Removed Lines]",
          "1979:  if (update_len && attribute_len) {",
          "",
          "[Added Lines]",
          "1983:  if (update_len && attribute_len &&",
          "1984:      attr_parse_ret != BGP_ATTR_PARSE_MISSING_MANDATORY) {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "6814f2e0138a6ea5e1f83bdd9085d9a77999900b",
      "candidate_info": {
        "commit_hash": "6814f2e0138a6ea5e1f83bdd9085d9a77999900b",
        "repo": "FRRouting/frr",
        "commit_url": "https://github.com/FRRouting/frr/pull/14716/commits/6814f2e0138a6ea5e1f83bdd9085d9a77999900b",
        "files": [
          "bgpd/bgp_attr.c"
        ],
        "message": "bgpd: Treat EOR as withdrawn to avoid unwanted handling of malformed attrs\n\nTreat-as-withdraw, otherwise if we just ignore it, we will pass it to be\nprocessed as a normal UPDATE without mandatory attributes, that could lead\nto harmful behavior. In this case, a crash for route-maps with the configuration\nsuch as:\n\n```\nrouter bgp 65001\n no bgp ebgp-requires-policy\n neighbor 127.0.0.1 remote-as external\n neighbor 127.0.0.1 passive\n neighbor 127.0.0.1 ebgp-multihop\n neighbor 127.0.0.1 disable-connected-check\n neighbor 127.0.0.1 update-source 127.0.0.2\n neighbor 127.0.0.1 timers 3 90\n neighbor 127.0.0.1 timers connect 1\n !\n address-family ipv4 unicast\n  neighbor 127.0.0.1 addpath-tx-all-paths\n  neighbor 127.0.0.1 default-originate\n  neighbor 127.0.0.1 route-map RM_IN in\n exit-address-family\nexit\n!\nroute-map RM_IN permit 10\n set as-path prepend 200\nexit\n```\n\nSend a malformed optional transitive attribute:\n\n```\nimport socket\nimport time\n\nOPEN = (b\"\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\"\nb\"\\xff\\xff\\x00\\x62\\x01\\x04\\xfd\\xea\\x00\\x5a\\x0a\\x00\\x00\\x01\\x45\\x02\"\nb\"\\x06\\x01\\x04\\x00\\x01\\x00\\x01\\x02\\x02\\x02\\x00\\x02\\x02\\x46\\x00\\x02\"\nb\"\\x06\\x41\\x04\\x00\\x00\\xfd\\xea\\x02\\x02\\x06\\x00\\x02\\x06\\x45\\x04\\x00\"\nb\"\\x01\\x01\\x03\\x02\\x0e\\x49\\x0c\\x0a\\x64\\x6f\\x6e\\x61\\x74\\x61\\x73\\x2d\"\nb\"\\x70\\x63\\x00\\x02\\x04\\x40\\x02\\x00\\x78\\x02\\x09\\x47\\x07\\x00\\x01\\x01\"\nb\"\\x80\\x00\\x00\\x00\")\n\nKEEPALIVE = (b\"\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\"\nb\"\\xff\\xff\\xff\\xff\\xff\\xff\\x00\\x13\\x04\")\n\nUPDATE = bytearray.fromhex(\"ffffffffffffffffffffffffffffffff002b0200000003c0ff00010100eb00ac100b0b001ad908ac100b0b\")\n\ns = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\ns.connect(('127.0.0.2', 179))\ns.send(OPEN)\ndata = s.recv(1024)\ns.send(KEEPALIVE)\ndata = s.recv(1024)\ns.send(UPDATE)\ndata = s.recv(1024)\ntime.sleep(100)\ns.close()\n```\n\nReported-by: Iggy Frankovic <iggyfran@amazon.com>\nSigned-off-by: Donatas Abraitis <donatas@opensourcerouting.org>",
        "before_after_code_files": [
          "bgpd/bgp_attr.c||bgpd/bgp_attr.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/FRRouting/frr/pull/14716"
        ],
        "olp_code_files": {
          "patch": [
            "bgpd/bgp_attr.c||bgpd/bgp_attr.c"
          ],
          "candidate": [
            "bgpd/bgp_attr.c||bgpd/bgp_attr.c"
          ]
        }
      },
      "candidate_diff": {
        "bgpd/bgp_attr.c||bgpd/bgp_attr.c": [
          "File: bgpd/bgp_attr.c -> bgpd/bgp_attr.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "3391:  uint8_t type = 0;",
          "3395:  if (CHECK_FLAG(peer->cap, PEER_CAP_RESTART_RCV) && !attr->flag &&",
          "3396:      !length)",
          "3400:     to carry any other path attributes.\", though if MP_REACH_NLRI or NLRI",
          "",
          "[Removed Lines]",
          "3397:   return BGP_ATTR_PARSE_PROCEED;",
          "",
          "[Added Lines]",
          "3400:   return BGP_ATTR_PARSE_WITHDRAW;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "3889:  aspath_unintern(&as4_path);",
          "3891:  transit = bgp_attr_get_transit(attr);",
          "3894:   if (transit)",
          "3895:    bgp_attr_set_transit(attr, transit_intern(transit));",
          "",
          "[Removed Lines]",
          "3892:  if (ret != BGP_ATTR_PARSE_ERROR) {",
          "",
          "[Added Lines]",
          "3901:  if (ret == BGP_ATTR_PARSE_PROCEED) {",
          "",
          "---------------"
        ]
      }
    }
  ]
}