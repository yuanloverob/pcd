{
  "cve_id": "CVE-2023-28099",
  "cve_desc": "OpenSIPS is a Session Initiation Protocol (SIP) server implementation. Prior to versions 3.1.9 and 3.2.6, if `ds_is_in_list()` is used with an invalid IP address string (`NULL` is illegal input), OpenSIPS will attempt to print a string from a random address (stack garbage), which could lead to a crash.  All users of `ds_is_in_list()` without the `$si` variable as 1st parameter could be affected by this vulnerability to a larger, lesser or no extent at all, depending if the data passed to the function is a valid IPv4 or IPv6 address string or not. Fixes will are available starting with the 3.1.9 and 3.2.6 minor releases. There are no known workarounds.",
  "repo": "OpenSIPS/opensips",
  "patch_hash": "e2f13d3747577937152346b031b86639b37bc2b5",
  "patch_info": {
    "commit_hash": "e2f13d3747577937152346b031b86639b37bc2b5",
    "repo": "OpenSIPS/opensips",
    "commit_url": "https://github.com/OpenSIPS/opensips/commit/e2f13d3747577937152346b031b86639b37bc2b5",
    "files": [
      "modules/dispatcher/dispatch.c"
    ],
    "message": "dispatcher: Fix IP printing on error case\n\nMany thanks to @Cossack9989 for the report!\n\nFixes #2780",
    "before_after_code_files": [
      "modules/dispatcher/dispatch.c||modules/dispatcher/dispatch.c"
    ]
  },
  "patch_diff": {
    "modules/dispatcher/dispatch.c||modules/dispatcher/dispatch.c": [
      "File: modules/dispatcher/dispatch.c -> modules/dispatcher/dispatch.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "2310:  char *pattern = NULL;",
      "2312:  if (!(ip = str2ip(_ip)) && !(ip = str2ip6(_ip))) {",
      "2314:   return -1;",
      "2315:  }",
      "",
      "[Removed Lines]",
      "2313:   LM_ERR(\"IP val is not IP <%.*s>\\n\",val.rs.len,val.rs.s);",
      "",
      "[Added Lines]",
      "2313:   LM_ERR(\"IP val is not IP <%.*s>\\n\", _ip->len, _ip->s);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "4ed384ef685b3741740eacfc1337e06feae18cc5",
      "candidate_info": {
        "commit_hash": "4ed384ef685b3741740eacfc1337e06feae18cc5",
        "repo": "OpenSIPS/opensips",
        "commit_url": "https://github.com/OpenSIPS/opensips/commit/4ed384ef685b3741740eacfc1337e06feae18cc5",
        "files": [
          "modules/dispatcher/dispatch.c"
        ],
        "message": "dispatcher: Fix IP printing on error case\n\nMany thanks to @Cossack9989 for the report!\n\nFixes #2780\n\n(cherry picked from commit e2f13d3747577937152346b031b86639b37bc2b5)",
        "before_after_code_files": [
          "modules/dispatcher/dispatch.c||modules/dispatcher/dispatch.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "modules/dispatcher/dispatch.c||modules/dispatcher/dispatch.c"
          ],
          "candidate": [
            "modules/dispatcher/dispatch.c||modules/dispatcher/dispatch.c"
          ]
        }
      },
      "candidate_diff": {
        "modules/dispatcher/dispatch.c||modules/dispatcher/dispatch.c": [
          "File: modules/dispatcher/dispatch.c -> modules/dispatcher/dispatch.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2269:  int j,k;",
          "2271:  if (!(ip = str2ip(_ip)) && !(ip = str2ip6(_ip))) {",
          "2273:   return -1;",
          "2274:  }",
          "",
          "[Removed Lines]",
          "2272:   LM_ERR(\"IP val is not IP <%.*s>\\n\",val.rs.len,val.rs.s);",
          "",
          "[Added Lines]",
          "2272:   LM_ERR(\"IP val is not IP <%.*s>\\n\", _ip->len, _ip->s);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "4dadf7782725ddd8e047166c1a1296d1c7c2d74f",
      "candidate_info": {
        "commit_hash": "4dadf7782725ddd8e047166c1a1296d1c7c2d74f",
        "repo": "OpenSIPS/opensips",
        "commit_url": "https://github.com/OpenSIPS/opensips/commit/4dadf7782725ddd8e047166c1a1296d1c7c2d74f",
        "files": [
          "modules/dispatcher/dispatch.c"
        ],
        "message": "dispatcher: Fix IP printing on error case\n\nMany thanks to @Cossack9989 for the report!\n\nFixes #2780\n\n(cherry picked from commit e2f13d3747577937152346b031b86639b37bc2b5)",
        "before_after_code_files": [
          "modules/dispatcher/dispatch.c||modules/dispatcher/dispatch.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "modules/dispatcher/dispatch.c||modules/dispatcher/dispatch.c"
          ],
          "candidate": [
            "modules/dispatcher/dispatch.c||modules/dispatcher/dispatch.c"
          ]
        }
      },
      "candidate_diff": {
        "modules/dispatcher/dispatch.c||modules/dispatcher/dispatch.c": [
          "File: modules/dispatcher/dispatch.c -> modules/dispatcher/dispatch.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2318:  char *pattern = NULL;",
          "2320:  if (!(ip = str2ip(_ip)) && !(ip = str2ip6(_ip))) {",
          "2322:   return -1;",
          "2323:  }",
          "",
          "[Removed Lines]",
          "2321:   LM_ERR(\"IP val is not IP <%.*s>\\n\",val.rs.len,val.rs.s);",
          "",
          "[Added Lines]",
          "2321:   LM_ERR(\"IP val is not IP <%.*s>\\n\", _ip->len, _ip->s);",
          "",
          "---------------"
        ]
      }
    }
  ]
}