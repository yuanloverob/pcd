{
  "cve_id": "CVE-2024-4030",
  "cve_desc": "On Windows a directory returned by tempfile.mkdtemp() would not always have permissions set to restrict reading and writing to the temporary directory by other users, instead usually inheriting the correct permissions from the default location. Alternate configurations or users without a profile directory may not have the intended permissions.\n\nIf you\u2019re not using Windows or haven\u2019t changed the temporary directory location then you aren\u2019t affected by this vulnerability. On other platforms the returned directory is consistently readable and writable only by the current user.\n\nThis issue was caused by Python not supporting Unix permissions on Windows. The fix adds support for Unix \u201c700\u201d for the mkdir function on Windows which is used by mkdtemp() to ensure the newly created directory has the proper permissions.",
  "repo": "python/cpython",
  "patch_hash": "e1dfa978b1ad210d551385ad8073ec6154f53763",
  "patch_info": {
    "commit_hash": "e1dfa978b1ad210d551385ad8073ec6154f53763",
    "repo": "python/cpython",
    "commit_url": "https://github.com/python/cpython/commit/e1dfa978b1ad210d551385ad8073ec6154f53763",
    "files": [
      "Lib/test/test_os.py",
      "Modules/posixmodule.c"
    ],
    "message": "gh-118486: Simplify test_win32_mkdir_700 to check the exact ACL (GH-119056)\n\n(cherry picked from commit 94591dca510c796c7d40e9b4167ea56f2fdf28ca)\n\nCo-authored-by: Steve Dower <steve.dower@python.org>",
    "before_after_code_files": [
      "Lib/test/test_os.py||Lib/test/test_os.py",
      "Modules/posixmodule.c||Modules/posixmodule.c"
    ]
  },
  "patch_diff": {
    "Lib/test/test_os.py||Lib/test/test_os.py": [
      "File: Lib/test/test_os.py -> Lib/test/test_os.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "1814:     @unittest.skipUnless(os.name == 'nt', \"requires Windows\")",
      "1815:     def test_win32_mkdir_700(self):",
      "1816:         base = os_helper.TESTFN",
      "1833:     def tearDown(self):",
      "1834:         path = os.path.join(os_helper.TESTFN, 'dir1', 'dir2', 'dir3',",
      "",
      "[Removed Lines]",
      "1817:         path1 = os.path.join(os_helper.TESTFN, 'dir1')",
      "1818:         path2 = os.path.join(os_helper.TESTFN, 'dir2')",
      "1819:         # mode=0o700 is special-cased to override ACLs on Windows",
      "1820:         # There's no way to know exactly how the ACLs will look, so we'll",
      "1821:         # check that they are different from a regularly created directory.",
      "1822:         os.mkdir(path1, mode=0o700)",
      "1823:         os.mkdir(path2, mode=0o777)",
      "1825:         out1 = subprocess.check_output([\"icacls.exe\", path1], encoding=\"oem\")",
      "1826:         out2 = subprocess.check_output([\"icacls.exe\", path2], encoding=\"oem\")",
      "1827:         os.rmdir(path1)",
      "1828:         os.rmdir(path2)",
      "1829:         out1 = out1.replace(path1, \"<PATH>\")",
      "1830:         out2 = out2.replace(path2, \"<PATH>\")",
      "1831:         self.assertNotEqual(out1, out2)",
      "",
      "[Added Lines]",
      "1817:         path = os.path.abspath(os.path.join(os_helper.TESTFN, 'dir'))",
      "1818:         os.mkdir(path, mode=0o700)",
      "1819:         out = subprocess.check_output([\"cacls.exe\", path, \"/s\"], encoding=\"oem\")",
      "1820:         os.rmdir(path)",
      "1821:         self.assertEqual(",
      "1822:             out.strip(),",
      "1823:             f'{path} \"D:P(A;OICI;FA;;;SY)(A;OICI;FA;;;BA)(A;OICI;FA;;;OW)\"',",
      "1824:         )",
      "",
      "---------------"
    ],
    "Modules/posixmodule.c||Modules/posixmodule.c": [
      "File: Modules/posixmodule.c -> Modules/posixmodule.c"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "9b704ceecae28d73a0315c3fd5547cf09b2d85a4",
      "candidate_info": {
        "commit_hash": "9b704ceecae28d73a0315c3fd5547cf09b2d85a4",
        "repo": "python/cpython",
        "commit_url": "https://github.com/python/cpython/commit/9b704ceecae28d73a0315c3fd5547cf09b2d85a4",
        "files": [
          "Misc/NEWS.d/next/Library/2024-06-08-09-45-31.gh-issue-120244.8o9Dzr.rst",
          "Modules/_sre/sre.c"
        ],
        "message": "[3.13] gh-120244: Fix re.sub() reference leak (GH-120245) (GH-120264)\n\n(cherry picked from commit 38a25e9560cf0ff0b80d9e90bce793ff24c6e027)\n\nCo-authored-by: neonene <53406459+neonene@users.noreply.github.com>",
        "before_after_code_files": [
          "Modules/_sre/sre.c||Modules/_sre/sre.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/AcreetionOS-Linux/python/pull/2"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "Modules/_sre/sre.c||Modules/_sre/sre.c": [
          "File: Modules/_sre/sre.c -> Modules/_sre/sre.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1622:         }",
          "1623:         self->items[i].literal = Py_XNewRef(literal);",
          "1624:     }",
          "1625:     return (PyObject*) self;",
          "1627: bad_template:",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1625:     PyObject_GC_Track(self);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "844b535c51201a176865cea059533bf13a3826e2",
      "candidate_info": {
        "commit_hash": "844b535c51201a176865cea059533bf13a3826e2",
        "repo": "python/cpython",
        "commit_url": "https://github.com/python/cpython/commit/844b535c51201a176865cea059533bf13a3826e2",
        "files": [
          "Doc/library/cmath.rst",
          "Doc/library/functions.rst",
          "Objects/clinic/complexobject.c.h",
          "Objects/complexobject.c"
        ],
        "message": "[3.13] gh-109218: Improve documentation for the complex() constructor (GH-119687) (GH-119803)\n\n* Remove the equivalence with real+imag*1j which can be incorrect in corner\n  cases (non-finite numbers, the sign of zeroes).\n* Separately document the three roles of the constructor: parsing a string,\n  converting a number, and constructing a complex from components.\n* Document positional-only parameters of complex(), float(), int() and bool()\n  as positional-only.\n* Add examples for complex() and int().\n* Specify the grammar of the string for complex().\n* Improve the grammar of the string for float().\n* Describe more explicitly the behavior when real and/or imag arguments are\n  complex numbers. (This will be deprecated in future.)\n(cherry picked from commit ec1ba264607b2b7b98d2602f5536a1d02981efc6)\n\nCo-authored-by: Serhiy Storchaka <storchaka@gmail.com>",
        "before_after_code_files": [
          "Objects/clinic/complexobject.c.h||Objects/clinic/complexobject.c.h",
          "Objects/complexobject.c||Objects/complexobject.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/AcreetionOS-Linux/python/pull/2"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "Objects/clinic/complexobject.c.h||Objects/clinic/complexobject.c.h": [
          "File: Objects/clinic/complexobject.c.h -> Objects/clinic/complexobject.c.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "94: \"complex(real=0, imag=0)\\n\"",
          "95: \"--\\n\"",
          "96: \"\\n\"",
          "98: \"\\n\"",
          "101: static PyObject *",
          "102: complex_new_impl(PyTypeObject *type, PyObject *r, PyObject *i);",
          "",
          "[Removed Lines]",
          "97: \"Create a complex number from a real part and an optional imaginary part.\\n\"",
          "99: \"This is equivalent to (real + imag*1j) where imag defaults to 0.\");",
          "",
          "[Added Lines]",
          "97: \"Create a complex number from a string or numbers.\\n\"",
          "99: \"If a string is given, parse it as a complex number.\\n\"",
          "100: \"If a single number is given, convert it to a complex number.\\n\"",
          "101: \"If the \\'real\\' or \\'imag\\' arguments are given, create a complex number\\n\"",
          "102: \"with the specified real and imaginary components.\");",
          "",
          "---------------"
        ],
        "Objects/complexobject.c||Objects/complexobject.c": [
          "File: Objects/complexobject.c -> Objects/complexobject.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "911:     real as r: object(c_default=\"NULL\") = 0",
          "912:     imag as i: object(c_default=\"NULL\") = 0",
          "919: static PyObject *",
          "920: complex_new_impl(PyTypeObject *type, PyObject *r, PyObject *i)",
          "922: {",
          "923:     PyObject *tmp;",
          "924:     PyNumberMethods *nbr, *nbi = NULL;",
          "",
          "[Removed Lines]",
          "914: Create a complex number from a real part and an optional imaginary part.",
          "916: This is equivalent to (real + imag*1j) where imag defaults to 0.",
          "",
          "[Added Lines]",
          "914: Create a complex number from a string or numbers.",
          "916: If a string is given, parse it as a complex number.",
          "917: If a single number is given, convert it to a complex number.",
          "918: If the 'real' or 'imag' arguments are given, create a complex number",
          "919: with the specified real and imaginary components.",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "041cc2a4be609ed5f072239df32161653ae8deca",
      "candidate_info": {
        "commit_hash": "041cc2a4be609ed5f072239df32161653ae8deca",
        "repo": "python/cpython",
        "commit_url": "https://github.com/python/cpython/commit/041cc2a4be609ed5f072239df32161653ae8deca",
        "files": [
          "Lib/test/test_typing.py"
        ],
        "message": "[3.13] typing tests: remove some unnecessary uses of `exec()` (GH-119005) (#119038)\n\n(cherry picked from commit a9328e2b6ee05c186dcc552feb92b862b4a574df)\n\nCo-authored-by: Alex Waygood <Alex.Waygood@Gmail.com>",
        "before_after_code_files": [
          "Lib/test/test_typing.py||Lib/test/test_typing.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/AcreetionOS-Linux/python/pull/2"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "Lib/test/test_typing.py||Lib/test/test_typing.py": [
          "File: Lib/test/test_typing.py -> Lib/test/test_typing.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "7060:         self.assertNotIsInstance(42, typing.Iterator)",
          "7062:     def test_awaitable(self):",
          "7069:         g = foo()",
          "7070:         self.assertIsInstance(g, typing.Awaitable)",
          "7071:         self.assertNotIsInstance(foo, typing.Awaitable)",
          "7072:         g.send(None)  # Run foo() till completion, to avoid warning.",
          "7074:     def test_coroutine(self):",
          "7081:         g = foo()",
          "7082:         self.assertIsInstance(g, typing.Coroutine)",
          "7083:         with self.assertRaises(TypeError):",
          "",
          "[Removed Lines]",
          "7063:         ns = {}",
          "7064:         exec(",
          "7065:             \"async def foo() -> typing.Awaitable[int]:\\n\"",
          "7066:             \"    return await AwaitableWrapper(42)\\n\",",
          "7067:             globals(), ns)",
          "7068:         foo = ns['foo']",
          "7075:         ns = {}",
          "7076:         exec(",
          "7077:             \"async def foo():\\n\"",
          "7078:             \"    return\\n\",",
          "7079:             globals(), ns)",
          "7080:         foo = ns['foo']",
          "",
          "[Added Lines]",
          "7063:         async def foo() -> typing.Awaitable[int]:",
          "7064:             return await AwaitableWrapper(42)",
          "7071:         async def foo():",
          "7072:             return",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "7362:             typing.Generator[int, int, int]()",
          "7364:     def test_async_generator(self):",
          "7369:         self.assertIsSubclass(type(g), typing.AsyncGenerator)",
          "7371:     def test_no_async_generator_instantiation(self):",
          "",
          "[Removed Lines]",
          "7365:         ns = {}",
          "7366:         exec(\"async def f():\\n\"",
          "7367:              \"    yield 42\\n\", globals(), ns)",
          "7368:         g = ns['f']()",
          "",
          "[Added Lines]",
          "7357:         async def f():",
          "7358:              yield 42",
          "7359:         g = f()",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "7452:             def athrow(self, typ, val=None, tb=None):",
          "7453:                 pass",
          "7458:         self.assertIsSubclass(G, typing.AsyncGenerator)",
          "7459:         self.assertIsSubclass(G, typing.AsyncIterable)",
          "7460:         self.assertIsSubclass(G, collections.abc.AsyncGenerator)",
          "",
          "[Removed Lines]",
          "7455:         ns = {}",
          "7456:         exec('async def g(): yield 0', globals(), ns)",
          "7457:         g = ns['g']",
          "",
          "[Added Lines]",
          "7446:         async def g(): yield 0",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "060d846f436027c0169fc8e2d3a0a7b9bc9afee8",
      "candidate_info": {
        "commit_hash": "060d846f436027c0169fc8e2d3a0a7b9bc9afee8",
        "repo": "python/cpython",
        "commit_url": "https://github.com/python/cpython/commit/060d846f436027c0169fc8e2d3a0a7b9bc9afee8",
        "files": [
          ".github/workflows/build.yml",
          "Lib/test/test_pyrepl/test_unix_console.py",
          "Lib/test/test_pyrepl/test_windows_console.py"
        ],
        "message": "[3.13] Use Cirrus M1 macOS runners for CI (GH-119979) (GH-119986)\n\n(cherry picked from commit 6acb32fac3511c1d5500cac66f1d6397dcdab835)\n\nCo-authored-by: \u0141ukasz Langa <lukasz@langa.pl>\nCo-authored-by: Ee Durbin <ee@python.org>",
        "before_after_code_files": [
          "Lib/test/test_pyrepl/test_unix_console.py||Lib/test/test_pyrepl/test_unix_console.py",
          "Lib/test/test_pyrepl/test_windows_console.py||Lib/test/test_pyrepl/test_windows_console.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/AcreetionOS-Linux/python/pull/2"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "Lib/test/test_pyrepl/test_unix_console.py||Lib/test/test_pyrepl/test_unix_console.py": [
          "File: Lib/test/test_pyrepl/test_unix_console.py -> Lib/test/test_pyrepl/test_unix_console.py"
        ],
        "Lib/test/test_pyrepl/test_windows_console.py||Lib/test/test_pyrepl/test_windows_console.py": [
          "File: Lib/test/test_pyrepl/test_windows_console.py -> Lib/test/test_pyrepl/test_windows_console.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: import sys",
          "2: import unittest",
          "5:     raise unittest.SkipTest(\"test only relevant on win32\")",
          "",
          "[Removed Lines]",
          "4: if sys.platform != 'win32':",
          "",
          "[Added Lines]",
          "4: if sys.platform != \"win32\":",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "18359f202de00d7fabf27605528c77a619b7b13d",
      "candidate_info": {
        "commit_hash": "18359f202de00d7fabf27605528c77a619b7b13d",
        "repo": "python/cpython",
        "commit_url": "https://github.com/python/cpython/commit/18359f202de00d7fabf27605528c77a619b7b13d",
        "files": [
          "Lib/test/test_unpack_ex.py"
        ],
        "message": "[3.13] gh-94808: Add test coverage for \"starred kind\" in _PyPegen_set_expr_context (GH-119222) (GH-119263)\n\ngh-94808: Add test coverage for \"starred kind\" in _PyPegen_set_expr_context (GH-119222)\n\nAdd test coverage for \"starred kind\" in _PyPegen_set_expr_context\n(cherry picked from commit 8231a24454c854ea22590fd74733d29e4274122d)\n\nCo-authored-by: Mark Jason Dominus (\u9676\u654f\u4fee) <mjd@pobox.com>",
        "before_after_code_files": [
          "Lib/test/test_unpack_ex.py||Lib/test/test_unpack_ex.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/AcreetionOS-Linux/python/pull/2"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "Lib/test/test_unpack_ex.py||Lib/test/test_unpack_ex.py": [
          "File: Lib/test/test_unpack_ex.py -> Lib/test/test_unpack_ex.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "26:     >>> a == [7, 8, 9]",
          "27:     True",
          "29: Unpack string... fun!",
          "31:     >>> a, *b = 'one'",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "29: Unpack nested implied tuple",
          "31:     >>> [*[*a]] = [[7,8,9]]",
          "32:     >>> a == [[7,8,9]]",
          "33:     True",
          "",
          "---------------"
        ]
      }
    }
  ]
}