{
  "cve_id": "CVE-2019-11932",
  "cve_desc": "A double free vulnerability in the DDGifSlurp function in decoding.c in the android-gif-drawable library before version 1.2.18, as used in WhatsApp for Android before version 2.19.244 and many other Android applications, allows remote attackers to execute arbitrary code or cause a denial of service when the library is used to parse a specially crafted GIF image.",
  "repo": "koral--/android-gif-drawable",
  "patch_hash": "cc5b4f8e43463995a84efd594f89a21f906c2d20",
  "patch_info": {
    "commit_hash": "cc5b4f8e43463995a84efd594f89a21f906c2d20",
    "repo": "koral--/android-gif-drawable",
    "commit_url": "https://github.com/koral--/android-gif-drawable/commit/cc5b4f8e43463995a84efd594f89a21f906c2d20",
    "files": [
      "android-gif-drawable/src/main/c/decoding.c"
    ],
    "message": "Do not realloc array if new raster size is 0.\n\nif realloc() is called with 0 size it may return NULL and this will be incorrectly handled\nas not enough memory and (also) rasterBits will be freed by realloc but we will not update\nit.",
    "before_after_code_files": [
      "android-gif-drawable/src/main/c/decoding.c||android-gif-drawable/src/main/c/decoding.c"
    ]
  },
  "patch_diff": {
    "android-gif-drawable/src/main/c/decoding.c||android-gif-drawable/src/main/c/decoding.c": [
      "File: android-gif-drawable/src/main/c/decoding.c -> android-gif-drawable/src/main/c/decoding.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "56:     }",
      "58:     if (decode) {",
      "61:      const uint_fast32_t newRasterSize = gifFilePtr->Image.Width * gifFilePtr->Image.Height;",
      "62:      if (newRasterSize > info->rasterSize || widthOverflow > 0 || heightOverflow > 0) {",
      "63:       void *tmpRasterBits = reallocarray(info->rasterBits, newRasterSize, sizeof(GifPixelType));",
      "64:       if (tmpRasterBits == NULL) {",
      "",
      "[Removed Lines]",
      "59:      int_fast32_t widthOverflow = gifFilePtr->Image.Width - info->originalWidth;",
      "60:      int_fast32_t heightOverflow = gifFilePtr->Image.Height - info->originalHeight;",
      "",
      "[Added Lines]",
      "60:      if (newRasterSize == 0) {",
      "61:       free(info->rasterBits);",
      "62:       info->rasterBits = NULL;",
      "63:       info->rasterSize = newRasterSize;",
      "64:       return;",
      "65:      }",
      "66:      const int_fast32_t widthOverflow = gifFilePtr->Image.Width - info->originalWidth;",
      "67:      const int_fast32_t heightOverflow = gifFilePtr->Image.Height - info->originalHeight;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "ab2f70dfbdd325365cd9cd21c093eca46e8fb53b",
      "candidate_info": {
        "commit_hash": "ab2f70dfbdd325365cd9cd21c093eca46e8fb53b",
        "repo": "koral--/android-gif-drawable",
        "commit_url": "https://github.com/koral--/android-gif-drawable/commit/ab2f70dfbdd325365cd9cd21c093eca46e8fb53b",
        "files": [
          "android-gif-drawable/build.gradle",
          "build.gradle"
        ],
        "message": "Add jacoco plugin Unify dependency version definitions",
        "before_after_code_files": [
          "android-gif-drawable/build.gradle||android-gif-drawable/build.gradle",
          "build.gradle||build.gradle"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/koral--/android-gif-drawable/pull/689"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "android-gif-drawable/build.gradle||android-gif-drawable/build.gradle": [
          "File: android-gif-drawable/build.gradle -> android-gif-drawable/build.gradle",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: }",
          "5: apply plugin: 'com.android.library'",
          "6: apply from: 'gradle-mvn-push.gradle'",
          "8: version = VERSION_NAME",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "6: apply plugin: 'jacoco-android'",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "65: dependencies {",
          "66:     compileOnly \"androidx.annotation:annotation:$versions.androidxAnnotations\"",
          "67:     testCompileOnly \"androidx.annotation:annotation:$versions.androidxAnnotations\"",
          "76:     androidTestImplementation \"androidx.test.ext:junit:$versions.androidXextJunit\"",
          "78:     androidTestImplementation \"androidx.test:rules:$versions.androidxTest\"",
          "80:     androidTestCompileOnly \"androidx.annotation:annotation:$versions.androidxAnnotations\"",
          "81: }",
          "",
          "[Removed Lines]",
          "68:     testImplementation 'junit:junit:4.12'",
          "69:     testImplementation 'org.mockito:mockito-core:2.25.1'",
          "70:     testImplementation 'org.robolectric:robolectric:4.2.1'",
          "71:     testImplementation 'org.assertj:assertj-core:3.12.1'",
          "72:     testImplementation 'net.jodah:concurrentunit:0.4.4'",
          "73:     testImplementation 'org.khronos:opengl-api:gl1.1-android-2.1_r1'",
          "74:     androidTestImplementation 'junit:junit:4.12'",
          "75:     androidTestImplementation 'org.assertj:assertj-core:1.7.1'",
          "77:     androidTestImplementation 'com.squareup.okhttp3:mockwebserver:3.12.2'",
          "79:     androidTestImplementation \"androidx.test:runner:$versions.androixTtest\"",
          "",
          "[Added Lines]",
          "69:     testImplementation \"junit:junit:$versions.junit\"",
          "70:     testImplementation \"org.mockito:mockito-core:$versions.mockito\"",
          "71:     testImplementation \"org.robolectric:robolectric:$versions.robolectric\"",
          "72:     testImplementation \"org.assertj:assertj-core:$versions.assertj3\"",
          "73:     testImplementation \"net.jodah:concurrentunit:$versions.concurrentunit\"",
          "74:     testImplementation \"org.khronos:opengl-api:$versions.openglApi\"",
          "75:     androidTestImplementation \"junit:junit:$versions.junit\"",
          "76:     androidTestImplementation \"org.assertj:assertj-core:$versions.assertj1\"",
          "78:     androidTestImplementation \"com.squareup.okhttp3:mockwebserver:$versions.mockwebserver\"",
          "80:     androidTestImplementation \"androidx.test:runner:$versions.androidxTest\"",
          "",
          "---------------"
        ],
        "build.gradle||build.gradle": [
          "File: build.gradle -> build.gradle",
          "--- Hunk 1 ---",
          "[Context before]",
          "12:                 kotlin             : '1.3.21',",
          "13:                 intellijAnnotations: '13.0',",
          "14:                 material           : '1.0.0',",
          "16:         ]",
          "17:     }",
          "18:     repositories {",
          "",
          "[Removed Lines]",
          "15:                 androidXextJunit   : '1.0.0'",
          "",
          "[Added Lines]",
          "15:                 androidXextJunit   : '1.0.0',",
          "16:                 jacocoAndroid      : '0.1.4',",
          "17:                 androidGradlePlugin: '3.3.2',",
          "18:                 junit              : '4.12',",
          "19:                 mockito            : '2.25.1',",
          "20:                 robolectric        : '4.2.1',",
          "21:                 assertj3           : '3.12.1',",
          "22:                 assertj1           : '1.7.1',",
          "23:                 concurrentunit     : '0.4.4',",
          "24:                 openglApi          : 'gl1.1-android-2.1_r1',",
          "25:                 mockwebserver      : '3.12.2',",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "21:         jcenter()",
          "22:     }",
          "23:     dependencies {",
          "25:         classpath \"org.jetbrains.kotlin:kotlin-gradle-plugin:$versions.kotlin\"",
          "26:     }",
          "27: }",
          "",
          "[Removed Lines]",
          "24:         classpath 'com.android.tools.build:gradle:3.3.2'",
          "",
          "[Added Lines]",
          "34:         classpath \"com.android.tools.build:gradle:$versions.androidGradlePlugin\"",
          "35:         classpath \"com.dicedmelon.gradle:jacoco-android:$versions.jacocoAndroid\"",
          "",
          "---------------"
        ]
      }
    }
  ]
}