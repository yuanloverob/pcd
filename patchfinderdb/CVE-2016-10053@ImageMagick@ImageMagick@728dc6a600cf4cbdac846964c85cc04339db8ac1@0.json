{
  "cve_id": "CVE-2016-10053",
  "cve_desc": "The WriteTIFFImage function in coders/tiff.c in ImageMagick before 6.9.5-8 allows remote attackers to cause a denial of service (divide-by-zero error and application crash) via a crafted file.",
  "repo": "ImageMagick/ImageMagick",
  "patch_hash": "728dc6a600cf4cbdac846964c85cc04339db8ac1",
  "patch_info": {
    "commit_hash": "728dc6a600cf4cbdac846964c85cc04339db8ac1",
    "repo": "ImageMagick/ImageMagick",
    "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/728dc6a600cf4cbdac846964c85cc04339db8ac1",
    "files": [
      "ChangeLog",
      "coders/tiff.c"
    ],
    "message": "Fix TIFF divide by zero (bug report from Donghai Zhu)",
    "before_after_code_files": [
      "coders/tiff.c||coders/tiff.c"
    ]
  },
  "patch_diff": {
    "coders/tiff.c||coders/tiff.c": [
      "File: coders/tiff.c -> coders/tiff.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "3479:       case UnsignedQuantumFormat:",
      "3480:       {",
      "3481:         (void) TIFFSetField(tiff,TIFFTAG_SAMPLEFORMAT,SAMPLEFORMAT_UINT);",
      "3483:       }",
      "3484:       default:",
      "3485:         break;",
      "",
      "[Removed Lines]",
      "3482:         break;",
      "",
      "[Added Lines]",
      "3482:         break;",
      "3483:       }",
      "3484:       default:",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "10aa64cb92dacc9703f74d07333ec7e4595b3de6",
      "candidate_info": {
        "commit_hash": "10aa64cb92dacc9703f74d07333ec7e4595b3de6",
        "repo": "ImageMagick/ImageMagick",
        "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/10aa64cb92dacc9703f74d07333ec7e4595b3de6",
        "files": [
          "coders/tiff.c"
        ],
        "message": "https://github.com/ImageMagick/ImageMagick/issues/262",
        "before_after_code_files": [
          "coders/tiff.c||coders/tiff.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "coders/tiff.c||coders/tiff.c"
          ],
          "candidate": [
            "coders/tiff.c||coders/tiff.c"
          ]
        }
      },
      "candidate_diff": {
        "coders/tiff.c||coders/tiff.c": [
          "File: coders/tiff.c -> coders/tiff.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "3083:       default:",
          "3084:         break;",
          "3085:     }",
          "3090:   (void) image;",
          "3091: #endif",
          "3092: }",
          "",
          "[Removed Lines]",
          "3086:   }",
          "3088: #else",
          "3089:   (void) tiff;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "3479:       case UnsignedQuantumFormat:",
          "3480:       {",
          "3481:         (void) TIFFSetField(tiff,TIFFTAG_SAMPLEFORMAT,SAMPLEFORMAT_UINT);",
          "3483:       }",
          "3484:       default:",
          "3485:         break;",
          "",
          "[Removed Lines]",
          "3482:         break;",
          "",
          "[Added Lines]",
          "3478:         break;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "3499:     switch (compress_tag)",
          "3500:     {",
          "3501:       case COMPRESSION_JPEG:",
          "3503: #if defined(JPEG_SUPPORT)",
          "3504:         const char",
          "",
          "[Removed Lines]",
          "3502:       {",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "3539:                 if (image->colorspace == YCbCrColorspace)",
          "3540:                   (void) TIFFSetField(tiff,TIFFTAG_YCBCRSUBSAMPLING,(uint16)",
          "3541:                     geometry_info.rho,(uint16) geometry_info.sigma);",
          "3544:         (void) TIFFGetFieldDefaulted(tiff,TIFFTAG_BITSPERSAMPLE,",
          "3545:           &bits_per_sample);",
          "3546:         if (bits_per_sample == 12)",
          "",
          "[Removed Lines]",
          "3542:               }",
          "3543:           }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "3557:         if (((photometric == PHOTOMETRIC_RGB) ||",
          "3558:              (photometric == PHOTOMETRIC_MINISBLACK)) &&",
          "3559:             ((bits_per_sample == 8) || (bits_per_sample == 16)))",
          "3565:       }",
          "3566:       case COMPRESSION_CCITTFAX3:",
          "3567:       {",
          "3575:           rows_per_strip=(uint32) image->rows;",
          "3577:         break;",
          "3578:       }",
          "3579:       case COMPRESSION_CCITTFAX4:",
          "3585:           rows_per_strip=(uint32) image->rows;",
          "3586:         break;",
          "3587:       }",
          "",
          "[Removed Lines]",
          "3560:           (void) TIFFSetField(tiff,TIFFTAG_PREDICTOR,PREDICTOR_HORIZONTAL);",
          "3561:         (void) TIFFSetField(tiff,TIFFTAG_ZIPQUALITY,(long) (",
          "3562:           image_info->quality == UndefinedCompressionQuality ? 7 :",
          "3563:           MagickMin((ssize_t) image_info->quality/10,9)));",
          "3564:         break;",
          "3569:           Byte-aligned EOL.",
          "3571:         rows_per_strip=(16*1024*1024UL)/image->columns;",
          "3572:         if (rows_per_strip < 1)",
          "3573:           rows_per_strip=1;",
          "3574:         if (rows_per_strip > image->rows)",
          "3576:         (void) TIFFSetField(tiff,TIFFTAG_GROUP3OPTIONS,4);",
          "3580:       {",
          "3581:         rows_per_strip=(16*1024*1024UL)/image->columns;",
          "3582:         if (rows_per_strip < 1)",
          "3583:           rows_per_strip=1;",
          "3584:         if (rows_per_strip > image->rows)",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "3605: #endif",
          "3606:       case COMPRESSION_LZW:",
          "3607:       {",
          "3612:             ((bits_per_sample == 8) || (bits_per_sample == 16)))",
          "3613:           (void) TIFFSetField(tiff,TIFFTAG_PREDICTOR,PREDICTOR_HORIZONTAL);",
          "3614:         break;",
          "",
          "[Removed Lines]",
          "3608:         (void) TIFFGetFieldDefaulted(tiff,TIFFTAG_BITSPERSAMPLE,",
          "3609:           &bits_per_sample);",
          "3610:         if (((photometric == PHOTOMETRIC_RGB) ||",
          "3611:              (photometric == PHOTOMETRIC_MINISBLACK)) &&",
          "",
          "[Added Lines]",
          "3584:         (void) TIFFGetFieldDefaulted(tiff,TIFFTAG_BITSPERSAMPLE,",
          "",
          "---------------"
        ]
      }
    }
  ]
}