{
  "cve_id": "CVE-2015-5336",
  "cve_desc": "Multiple cross-site scripting (XSS) vulnerabilities in the survey module in Moodle through 2.6.11, 2.7.x before 2.7.11, 2.8.x before 2.8.9, and 2.9.x before 2.9.3 allow remote authenticated users to inject arbitrary web script or HTML by leveraging the student role and entering a crafted survey answer.",
  "repo": "moodle/moodle",
  "patch_hash": "31d0bf81af079bc285ea439ac5160f9e45697c88",
  "patch_info": {
    "commit_hash": "31d0bf81af079bc285ea439ac5160f9e45697c88",
    "repo": "moodle/moodle",
    "commit_url": "https://github.com/moodle/moodle/commit/31d0bf81af079bc285ea439ac5160f9e45697c88",
    "files": [
      "mod/survey/lib.php",
      "mod/survey/report.php"
    ],
    "message": "MDL-49940 mod_survey: Fix XSS on survey module",
    "before_after_code_files": [
      "mod/survey/lib.php||mod/survey/lib.php",
      "mod/survey/report.php||mod/survey/report.php"
    ]
  },
  "patch_diff": {
    "mod/survey/lib.php||mod/survey/lib.php": [
      "File: mod/survey/lib.php -> mod/survey/lib.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "189:                 } else {",
      "190:                     $answertext = \"No answer\";",
      "191:                 }",
      "193:             }",
      "194:             echo html_writer::table($table);",
      "",
      "[Removed Lines]",
      "192:                 $table->data[] = array(\"<b>$questiontext</b>\", $answertext);",
      "",
      "[Added Lines]",
      "192:                 $table->data[] = array(\"<b>$questiontext</b>\", s($answertext));",
      "",
      "---------------"
    ],
    "mod/survey/report.php||mod/survey/report.php": [
      "File: mod/survey/report.php -> mod/survey/report.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "356:                        $OUTPUT->user_picture($a, array('courseid'=>$course->id)),",
      "357:                        \"<a href=\\\"report.php?id=$id&amp;action=student&amp;student=$a->userid\\\">\".fullname($a).\"</a>\",",
      "358:                        userdate($a->time),",
      "361:             }",
      "362:         }",
      "",
      "[Removed Lines]",
      "359:                        $answer1, $answer2);",
      "",
      "[Added Lines]",
      "359:                        s($answer1), s($answer2));",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "12c232df76885effa5ebac08e3094d6db5aa9223",
      "candidate_info": {
        "commit_hash": "12c232df76885effa5ebac08e3094d6db5aa9223",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/12c232df76885effa5ebac08e3094d6db5aa9223",
        "files": [
          "mod/survey/lib.php",
          "mod/survey/report.php"
        ],
        "message": "MDL-49940 mod_survey: Fix XSS on survey module",
        "before_after_code_files": [
          "mod/survey/lib.php||mod/survey/lib.php",
          "mod/survey/report.php||mod/survey/report.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "mod/survey/lib.php||mod/survey/lib.php",
            "mod/survey/report.php||mod/survey/report.php"
          ],
          "candidate": [
            "mod/survey/lib.php||mod/survey/lib.php",
            "mod/survey/report.php||mod/survey/report.php"
          ]
        }
      },
      "candidate_diff": {
        "mod/survey/lib.php||mod/survey/lib.php": [
          "File: mod/survey/lib.php -> mod/survey/lib.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "189:                 } else {",
          "190:                     $answertext = \"No answer\";",
          "191:                 }",
          "193:             }",
          "194:             echo html_writer::table($table);",
          "",
          "[Removed Lines]",
          "192:                 $table->data[] = array(\"<b>$questiontext</b>\", $answertext);",
          "",
          "[Added Lines]",
          "192:                 $table->data[] = array(\"<b>$questiontext</b>\", s($answertext));",
          "",
          "---------------"
        ],
        "mod/survey/report.php||mod/survey/report.php": [
          "File: mod/survey/report.php -> mod/survey/report.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "358:                        $OUTPUT->user_picture($a, array('courseid'=>$course->id)),",
          "359:                        \"<a href=\\\"report.php?id=$id&amp;action=student&amp;student=$a->userid\\\">\".fullname($a).\"</a>\",",
          "360:                        userdate($a->time),",
          "363:             }",
          "364:         }",
          "",
          "[Removed Lines]",
          "361:                        $answer1, $answer2);",
          "",
          "[Added Lines]",
          "361:                        s($answer1), s($answer2));",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "fd14d2902fab15fa6affecc427bb11d3869d9afe",
      "candidate_info": {
        "commit_hash": "fd14d2902fab15fa6affecc427bb11d3869d9afe",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/fd14d2902fab15fa6affecc427bb11d3869d9afe",
        "files": [
          "mod/survey/lib.php",
          "mod/survey/report.php"
        ],
        "message": "MDL-49940 mod_survey: Fix XSS on survey module",
        "before_after_code_files": [
          "mod/survey/lib.php||mod/survey/lib.php",
          "mod/survey/report.php||mod/survey/report.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "mod/survey/lib.php||mod/survey/lib.php",
            "mod/survey/report.php||mod/survey/report.php"
          ],
          "candidate": [
            "mod/survey/lib.php||mod/survey/lib.php",
            "mod/survey/report.php||mod/survey/report.php"
          ]
        }
      },
      "candidate_diff": {
        "mod/survey/lib.php||mod/survey/lib.php": [
          "File: mod/survey/lib.php -> mod/survey/lib.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "189:                 } else {",
          "190:                     $answertext = \"No answer\";",
          "191:                 }",
          "193:             }",
          "194:             echo html_writer::table($table);",
          "",
          "[Removed Lines]",
          "192:                 $table->data[] = array(\"<b>$questiontext</b>\", $answertext);",
          "",
          "[Added Lines]",
          "192:                 $table->data[] = array(\"<b>$questiontext</b>\", s($answertext));",
          "",
          "---------------"
        ],
        "mod/survey/report.php||mod/survey/report.php": [
          "File: mod/survey/report.php -> mod/survey/report.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "358:                        $OUTPUT->user_picture($a, array('courseid'=>$course->id)),",
          "359:                        \"<a href=\\\"report.php?id=$id&amp;action=student&amp;student=$a->userid\\\">\".fullname($a).\"</a>\",",
          "360:                        userdate($a->time),",
          "363:             }",
          "364:         }",
          "",
          "[Removed Lines]",
          "361:                        $answer1, $answer2);",
          "",
          "[Added Lines]",
          "361:                        s($answer1), s($answer2));",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "b4f4232e1cf76334e4b8dda9cf68962b121e6bc0",
      "candidate_info": {
        "commit_hash": "b4f4232e1cf76334e4b8dda9cf68962b121e6bc0",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/b4f4232e1cf76334e4b8dda9cf68962b121e6bc0",
        "files": [
          "mod/survey/lib.php",
          "mod/survey/report.php"
        ],
        "message": "MDL-49940 mod_survey: Fix XSS on survey module",
        "before_after_code_files": [
          "mod/survey/lib.php||mod/survey/lib.php",
          "mod/survey/report.php||mod/survey/report.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "mod/survey/lib.php||mod/survey/lib.php",
            "mod/survey/report.php||mod/survey/report.php"
          ],
          "candidate": [
            "mod/survey/lib.php||mod/survey/lib.php",
            "mod/survey/report.php||mod/survey/report.php"
          ]
        }
      },
      "candidate_diff": {
        "mod/survey/lib.php||mod/survey/lib.php": [
          "File: mod/survey/lib.php -> mod/survey/lib.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "189:                 } else {",
          "190:                     $answertext = \"No answer\";",
          "191:                 }",
          "193:             }",
          "194:             echo html_writer::table($table);",
          "",
          "[Removed Lines]",
          "192:                 $table->data[] = array(\"<b>$questiontext</b>\", $answertext);",
          "",
          "[Added Lines]",
          "192:                 $table->data[] = array(\"<b>$questiontext</b>\", s($answertext));",
          "",
          "---------------"
        ],
        "mod/survey/report.php||mod/survey/report.php": [
          "File: mod/survey/report.php -> mod/survey/report.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "358:                        $OUTPUT->user_picture($a, array('courseid'=>$course->id)),",
          "359:                        \"<a href=\\\"report.php?id=$id&amp;action=student&amp;student=$a->userid\\\">\".fullname($a).\"</a>\",",
          "360:                        userdate($a->time),",
          "363:             }",
          "364:         }",
          "",
          "[Removed Lines]",
          "361:                        $answer1, $answer2);",
          "",
          "[Added Lines]",
          "361:                        s($answer1), s($answer2));",
          "",
          "---------------"
        ]
      }
    }
  ]
}