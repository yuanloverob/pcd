{
  "cve_id": "CVE-2016-10161",
  "cve_desc": "The object_common1 function in ext/standard/var_unserializer.c in PHP before 5.6.30, 7.0.x before 7.0.15, and 7.1.x before 7.1.1 allows remote attackers to cause a denial of service (buffer over-read and application crash) via crafted serialized data that is mishandled in a finish_nested_data call.",
  "repo": "php/php-src",
  "patch_hash": "16b3003ffc6393e250f069aa28a78dc5a2c064b2",
  "patch_info": {
    "commit_hash": "16b3003ffc6393e250f069aa28a78dc5a2c064b2",
    "repo": "php/php-src",
    "commit_url": "https://github.com/php/php-src/commit/16b3003ffc6393e250f069aa28a78dc5a2c064b2",
    "files": [
      "ext/standard/tests/serialize/bug73825.phpt",
      "ext/standard/var_unserializer.c",
      "ext/standard/var_unserializer.re"
    ],
    "message": "Fix bug #73825 - Heap out of bounds read on unserialize in finish_nested_data()",
    "before_after_code_files": [
      "ext/standard/tests/serialize/bug73825.phpt||ext/standard/tests/serialize/bug73825.phpt",
      "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
      "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
    ]
  },
  "patch_diff": {
    "ext/standard/tests/serialize/bug73825.phpt||ext/standard/tests/serialize/bug73825.phpt": [
      "File: ext/standard/tests/serialize/bug73825.phpt -> ext/standard/tests/serialize/bug73825.phpt",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: --TEST--",
      "2: Bug #73825 Heap out of bounds read on unserialize in finish_nested_data()",
      "3: --FILE--",
      "4: <?php",
      "5: $obj = unserialize('O:8:\"00000000\":');",
      "6: var_dump($obj);",
      "7: ?>",
      "8: --EXPECTF--",
      "9: Warning: Bad unserialize data in %sbug73825.php on line %d",
      "11: Notice: unserialize(): Error at offset 13 of 15 bytes in %sbug73825.php on line %d",
      "12: bool(false)",
      "",
      "---------------"
    ],
    "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
      "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "405: {",
      "406:  long elements;",
      "408:  elements = parse_iv2((*p) + 2, p);",
      "410:  (*p) += 2;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "408:  if( *p >= max - 2) {",
      "409:   zend_error(E_WARNING, \"Bad unserialize data\");",
      "410:   return -1;",
      "411:  }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "417:   zend_error(E_WARNING, \"Erroneous data format for unserializing '%s'\", ce->name);",
      "419:  }",
      "421:  return elements;",
      "",
      "[Removed Lines]",
      "418:   return 0;",
      "",
      "[Added Lines]",
      "423:   return -1;",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "496: {",
      "497:  YYCTYPE yych;",
      "498:  static const unsigned char yybm[] = {",
      "",
      "[Removed Lines]",
      "495: #line 496 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "500: #line 501 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "552:  yych = *(YYMARKER = ++YYCURSOR);",
      "553:  if (yych == ':') goto yy95;",
      "554: yy3:",
      "556:  { return 0; }",
      "558: yy4:",
      "559:  yych = *(YYMARKER = ++YYCURSOR);",
      "560:  if (yych == ':') goto yy89;",
      "",
      "[Removed Lines]",
      "555: #line 861 \"ext/standard/var_unserializer.re\"",
      "557: #line 558 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "560: #line 875 \"ext/standard/var_unserializer.re\"",
      "562: #line 563 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "597:  goto yy3;",
      "598: yy14:",
      "599:  ++YYCURSOR;",
      "601:  {",
      "603:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
      "605: }",
      "607: yy16:",
      "608:  yych = *++YYCURSOR;",
      "609:  goto yy3;",
      "",
      "[Removed Lines]",
      "600: #line 855 \"ext/standard/var_unserializer.re\"",
      "606: #line 607 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "605: #line 869 \"ext/standard/var_unserializer.re\"",
      "611: #line 612 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "634:  yych = *++YYCURSOR;",
      "635:  if (yych != '\"') goto yy18;",
      "636:  ++YYCURSOR;",
      "638:  {",
      "639:  size_t len, len2, len3, maxlen;",
      "640:  long elements;",
      "",
      "[Removed Lines]",
      "637: #line 708 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "642: #line 717 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "775:  elements = object_common1(UNSERIALIZE_PASSTHRU, ce);",
      "777:  if (incomplete_class) {",
      "778:   php_store_class_name(*rval, class_name, len2);",
      "779:  }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "782:  if (elements < 0) {",
      "783:     efree(class_name);",
      "784:     return 0;",
      "785:  }",
      "",
      "---------------",
      "--- Hunk 8 ---",
      "[Context before]",
      "782:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
      "783: }",
      "785: yy25:",
      "786:  yych = *++YYCURSOR;",
      "787:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "784: #line 785 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "794: #line 795 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 9 ---",
      "[Context before]",
      "806:  yych = *++YYCURSOR;",
      "807:  if (yych != '\"') goto yy18;",
      "808:  ++YYCURSOR;",
      "810:  {",
      "811:     if (!var_hash) return 0;",
      "813:  INIT_PZVAL(*rval);",
      "817: }",
      "819: yy32:",
      "820:  yych = *++YYCURSOR;",
      "821:  if (yych == '+') goto yy33;",
      "",
      "[Removed Lines]",
      "809: #line 699 \"ext/standard/var_unserializer.re\"",
      "815:  return object_common2(UNSERIALIZE_PASSTHRU,",
      "816:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
      "818: #line 819 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "819: #line 704 \"ext/standard/var_unserializer.re\"",
      "821:  long elements;",
      "826:  elements = object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR);",
      "827:  if (elements < 0) {",
      "828:   return 0;",
      "829:  }",
      "830:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
      "832: #line 833 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 10 ---",
      "[Context before]",
      "836:  yych = *++YYCURSOR;",
      "837:  if (yych != '{') goto yy18;",
      "838:  ++YYCURSOR;",
      "840:  {",
      "841:  long elements = parse_iv(start + 2);",
      "",
      "[Removed Lines]",
      "839: #line 678 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "853: #line 683 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 11 ---",
      "[Context before]",
      "858:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
      "859: }",
      "861: yy39:",
      "862:  yych = *++YYCURSOR;",
      "863:  if (yych == '+') goto yy40;",
      "",
      "[Removed Lines]",
      "860: #line 861 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "874: #line 875 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 12 ---",
      "[Context before]",
      "878:  yych = *++YYCURSOR;",
      "879:  if (yych != '\"') goto yy18;",
      "880:  ++YYCURSOR;",
      "882:  {",
      "883:  size_t len, maxlen;",
      "884:  char *str;",
      "",
      "[Removed Lines]",
      "881: #line 643 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "895: #line 648 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 13 ---",
      "[Context before]",
      "913:  ZVAL_STRINGL(*rval, str, len, 0);",
      "914:  return 1;",
      "915: }",
      "917: yy46:",
      "918:  yych = *++YYCURSOR;",
      "919:  if (yych == '+') goto yy47;",
      "",
      "[Removed Lines]",
      "916: #line 917 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "930: #line 931 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 14 ---",
      "[Context before]",
      "934:  yych = *++YYCURSOR;",
      "935:  if (yych != '\"') goto yy18;",
      "936:  ++YYCURSOR;",
      "938:  {",
      "939:  size_t len, maxlen;",
      "940:  char *str;",
      "",
      "[Removed Lines]",
      "937: #line 610 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "951: #line 615 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 15 ---",
      "[Context before]",
      "967:  ZVAL_STRINGL(*rval, str, len, 1);",
      "968:  return 1;",
      "969: }",
      "971: yy53:",
      "972:  yych = *++YYCURSOR;",
      "973:  if (yych <= '/') {",
      "",
      "[Removed Lines]",
      "970: #line 971 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "984: #line 985 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 16 ---",
      "[Context before]",
      "1055:  }",
      "1056: yy63:",
      "1057:  ++YYCURSOR;",
      "1059:  {",
      "1060: #if SIZEOF_LONG == 4",
      "1061: use_double:",
      "",
      "[Removed Lines]",
      "1058: #line 600 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1072: #line 605 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 17 ---",
      "[Context before]",
      "1065:  ZVAL_DOUBLE(*rval, zend_strtod((const char *)start + 2, NULL));",
      "1066:  return 1;",
      "1067: }",
      "1069: yy65:",
      "1070:  yych = *++YYCURSOR;",
      "1071:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1068: #line 1069 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1082: #line 1083 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 18 ---",
      "[Context before]",
      "1124:  yych = *++YYCURSOR;",
      "1125:  if (yych != ';') goto yy18;",
      "1126:  ++YYCURSOR;",
      "1128:  {",
      "1130:  INIT_PZVAL(*rval);",
      "",
      "[Removed Lines]",
      "1127: #line 585 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1141: #line 590 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 19 ---",
      "[Context before]",
      "1140:  return 1;",
      "1141: }",
      "1143: yy76:",
      "1144:  yych = *++YYCURSOR;",
      "1145:  if (yych == 'N') goto yy73;",
      "",
      "[Removed Lines]",
      "1142: #line 1143 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1156: #line 1157 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 20 ---",
      "[Context before]",
      "1166:  if (yych <= '9') goto yy79;",
      "1167:  if (yych != ';') goto yy18;",
      "1168:  ++YYCURSOR;",
      "1170:  {",
      "1171: #if SIZEOF_LONG == 4",
      "1172:  int digits = YYCURSOR - start - 3;",
      "",
      "[Removed Lines]",
      "1169: #line 558 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1183: #line 563 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 21 ---",
      "[Context before]",
      "1193:  ZVAL_LONG(*rval, parse_iv(start + 2));",
      "1194:  return 1;",
      "1195: }",
      "1197: yy83:",
      "1198:  yych = *++YYCURSOR;",
      "1199:  if (yych <= '/') goto yy18;",
      "",
      "[Removed Lines]",
      "1196: #line 1197 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1210: #line 1211 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 22 ---",
      "[Context before]",
      "1201:  yych = *++YYCURSOR;",
      "1202:  if (yych != ';') goto yy18;",
      "1203:  ++YYCURSOR;",
      "1205:  {",
      "1207:  INIT_PZVAL(*rval);",
      "1208:  ZVAL_BOOL(*rval, parse_iv(start + 2));",
      "1209:  return 1;",
      "1210: }",
      "1212: yy87:",
      "1213:  ++YYCURSOR;",
      "1215:  {",
      "1217:  INIT_PZVAL(*rval);",
      "1218:  ZVAL_NULL(*rval);",
      "1219:  return 1;",
      "1220: }",
      "1222: yy89:",
      "1223:  yych = *++YYCURSOR;",
      "1224:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1204: #line 551 \"ext/standard/var_unserializer.re\"",
      "1211: #line 1212 \"ext/standard/var_unserializer.c\"",
      "1214: #line 544 \"ext/standard/var_unserializer.re\"",
      "1221: #line 1222 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1218: #line 556 \"ext/standard/var_unserializer.re\"",
      "1225: #line 1226 \"ext/standard/var_unserializer.c\"",
      "1228: #line 549 \"ext/standard/var_unserializer.re\"",
      "1235: #line 1236 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 23 ---",
      "[Context before]",
      "1241:  if (yych <= '9') goto yy91;",
      "1242:  if (yych != ';') goto yy18;",
      "1243:  ++YYCURSOR;",
      "1245:  {",
      "1246:  long id;",
      "",
      "[Removed Lines]",
      "1244: #line 521 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1258: #line 526 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 24 ---",
      "[Context before]",
      "1265:  return 1;",
      "1266: }",
      "1268: yy95:",
      "1269:  yych = *++YYCURSOR;",
      "1270:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1267: #line 1268 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1281: #line 1282 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 25 ---",
      "[Context before]",
      "1287:  if (yych <= '9') goto yy97;",
      "1288:  if (yych != ';') goto yy18;",
      "1289:  ++YYCURSOR;",
      "1291:  {",
      "1292:  long id;",
      "",
      "[Removed Lines]",
      "1290: #line 500 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1304: #line 505 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 26 ---",
      "[Context before]",
      "1309:  return 1;",
      "1310: }",
      "1312: }",
      "1316:  return 0;",
      "",
      "[Removed Lines]",
      "1311: #line 1312 \"ext/standard/var_unserializer.c\"",
      "1313: #line 863 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1325: #line 1326 \"ext/standard/var_unserializer.c\"",
      "1327: #line 877 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------"
    ],
    "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
      "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
      "--- Hunk 1 ---",
      "[Context before]",
      "409: {",
      "410:  long elements;",
      "412:  elements = parse_iv2((*p) + 2, p);",
      "414:  (*p) += 2;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "412:  if( *p >= max - 2) {",
      "413:   zend_error(E_WARNING, \"Bad unserialize data\");",
      "414:   return -1;",
      "415:  }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "421:   zend_error(E_WARNING, \"Erroneous data format for unserializing '%s'\", ce->name);",
      "423:  }",
      "425:  return elements;",
      "",
      "[Removed Lines]",
      "422:   return 0;",
      "",
      "[Added Lines]",
      "427:   return -1;",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "697: }",
      "699: \"o:\" iv \":\" [\"] {",
      "700:     if (!var_hash) return 0;",
      "702:  INIT_PZVAL(*rval);",
      "706: }",
      "708: object \":\" uiv \":\" [\"] {",
      "",
      "[Removed Lines]",
      "704:  return object_common2(UNSERIALIZE_PASSTHRU,",
      "705:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
      "",
      "[Added Lines]",
      "705:  long elements;",
      "710:  elements = object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR);",
      "711:  if (elements < 0) {",
      "712:   return 0;",
      "713:  }",
      "714:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "845:  elements = object_common1(UNSERIALIZE_PASSTHRU, ce);",
      "847:  if (incomplete_class) {",
      "848:   php_store_class_name(*rval, class_name, len2);",
      "849:  }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "856:  if (elements < 0) {",
      "857:     efree(class_name);",
      "858:     return 0;",
      "859:  }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "be54eb7db10c6aa838cef969822a5ae0f4e605e3",
      "candidate_info": {
        "commit_hash": "be54eb7db10c6aa838cef969822a5ae0f4e605e3",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/be54eb7db10c6aa838cef969822a5ae0f4e605e3",
        "files": [
          "NEWS",
          "Zend/zend_hash.c",
          "Zend/zend_hash.h",
          "ext/soap/tests/bug70211.phpt",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Fixed bug #70211 (php 7 ZEND_HASH_IF_FULL_DO_RESIZE use after free)",
        "before_after_code_files": [
          "Zend/zend_hash.c||Zend/zend_hash.c",
          "Zend/zend_hash.h||Zend/zend_hash.h",
          "ext/soap/tests/bug70211.phpt||ext/soap/tests/bug70211.phpt",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "Zend/zend_hash.c||Zend/zend_hash.c": [
          "File: Zend/zend_hash.c -> Zend/zend_hash.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "807:  }",
          "808: }",
          "810: ZEND_API int ZEND_FASTCALL zend_hash_rehash(HashTable *ht)",
          "811: {",
          "812:  Bucket *p;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "810: ZEND_API int ZEND_FASTCALL zend_hash_resize(HashTable *ht, uint32_t size) {",
          "811:  void *old_data = HT_GET_DATA_ADDR(ht);",
          "812:  Bucket *old_buckets = ht->arData;",
          "814:  HANDLE_BLOCK_INTERRUPTIONS();",
          "815:  ht->nTableSize = zend_hash_check_size(size);",
          "816:  ht->nTableMask = -ht->nTableSize;",
          "817:  HT_SET_DATA_ADDR(ht, pemalloc(HT_SIZE(ht), ht->u.flags & HASH_FLAG_PERSISTENT));",
          "818:  memcpy(ht->arData, old_buckets, sizeof(Bucket) * ht->nNumUsed);",
          "819:  pefree(old_data, ht->u.flags & HASH_FLAG_PERSISTENT);",
          "820:  zend_hash_rehash(ht);",
          "821:  HANDLE_UNBLOCK_INTERRUPTIONS();",
          "822: }",
          "",
          "---------------"
        ],
        "Zend/zend_hash.h||Zend/zend_hash.h": [
          "File: Zend/zend_hash.h -> Zend/zend_hash.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "212: #define zend_hash_next_free_element(ht) \\",
          "213:  (ht)->nNextFreeElement",
          "215: ZEND_API int ZEND_FASTCALL zend_hash_rehash(HashTable *ht);",
          "217: ZEND_API HashTable* ZEND_FASTCALL zend_array_dup(HashTable *source);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "215: ZEND_API int ZEND_FASTCALL zend_hash_resize(HashTable *ht, uint32_t size);",
          "",
          "---------------"
        ],
        "ext/soap/tests/bug70211.phpt||ext/soap/tests/bug70211.phpt": [
          "File: ext/soap/tests/bug70211.phpt -> ext/soap/tests/bug70211.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #70211 (php 7 ZEND_HASH_IF_FULL_DO_RESIZE use after free)",
          "3: --FILE--",
          "4: <?php",
          "6: $addr = 0x4141414141414141;",
          "8: function ptr2str($ptr)",
          "9: {",
          "10:     $out = \"\";",
          "11:     for ($i=0; $i<8; $i++) {",
          "12:         $out .= chr($ptr & 0xff);",
          "13:         $ptr >>= 8;",
          "14:     }",
          "15:     return $out;",
          "16: }",
          "18: $sf = new SoapFault('1', 'string', 'detail', 'header','line', str_repeat(\"A\",232).ptr2str($addr));",
          "19: $ob = unserialize(\"a:3:{i:0;\".serialize($sf).'i:1;r:12;i:2;r:10;}');",
          "21: var_dump($ob[1]);",
          "22: ?>",
          "23: --EXPECT--",
          "24: string(6) \"detail\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "470: {",
          "471:  zval retval;",
          "472:  zval fname;",
          "474:  if (Z_TYPE_P(rval) != IS_OBJECT) {",
          "475:   return 0;",
          "476:  }",
          "480:   return 0;",
          "481:  }",
          "",
          "[Removed Lines]",
          "479:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_OBJPROP_P(rval), elements, 1)) {",
          "",
          "[Added Lines]",
          "473:  HashTable *ht = Z_OBJPROP_P(rval);",
          "479:  zend_hash_resize(ht, zend_hash_num_elements(ht) + elements);",
          "480:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, ht, elements, 1)) {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "528:  start = cursor;",
          "532: {",
          "533:  YYCTYPE yych;",
          "534:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "531: #line 532 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "532: #line 533 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "588:  yych = *(YYMARKER = ++YYCURSOR);",
          "589:  if (yych == ':') goto yy95;",
          "590: yy3:",
          "592:  { return 0; }",
          "594: yy4:",
          "595:  yych = *(YYMARKER = ++YYCURSOR);",
          "596:  if (yych == ':') goto yy89;",
          "",
          "[Removed Lines]",
          "591: #line 879 \"ext/standard/var_unserializer.re\"",
          "593: #line 594 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "592: #line 880 \"ext/standard/var_unserializer.re\"",
          "594: #line 595 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "633:  goto yy3;",
          "634: yy14:",
          "635:  ++YYCURSOR;",
          "637:  {",
          "639:  php_error_docref(NULL, E_NOTICE, \"Unexpected end of serialized data\");",
          "641: }",
          "643: yy16:",
          "644:  yych = *++YYCURSOR;",
          "645:  goto yy3;",
          "",
          "[Removed Lines]",
          "636: #line 873 \"ext/standard/var_unserializer.re\"",
          "642: #line 643 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "637: #line 874 \"ext/standard/var_unserializer.re\"",
          "643: #line 644 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "669:  yych = *++YYCURSOR;",
          "670:  if (yych != '\"') goto yy18;",
          "671:  ++YYCURSOR;",
          "673:  {",
          "674:  size_t len, len2, len3, maxlen;",
          "675:  zend_long elements;",
          "",
          "[Removed Lines]",
          "672: #line 728 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "673: #line 729 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "815:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "816: }",
          "818: yy25:",
          "819:  yych = *++YYCURSOR;",
          "820:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "817: #line 818 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "818: #line 819 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "839:  yych = *++YYCURSOR;",
          "840:  if (yych != '\"') goto yy18;",
          "841:  ++YYCURSOR;",
          "843:  {",
          "",
          "[Removed Lines]",
          "842: #line 720 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "843: #line 721 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "847:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "848:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "849: }",
          "851: yy32:",
          "852:  yych = *++YYCURSOR;",
          "853:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "850: #line 851 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "851: #line 852 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "868:  yych = *++YYCURSOR;",
          "869:  if (yych != '{') goto yy18;",
          "870:  ++YYCURSOR;",
          "872:  {",
          "873:  zend_long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "871: #line 699 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "872: #line 700 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "890:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "891: }",
          "893: yy39:",
          "894:  yych = *++YYCURSOR;",
          "895:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "892: #line 893 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "893: #line 894 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "910:  yych = *++YYCURSOR;",
          "911:  if (yych != '\"') goto yy18;",
          "912:  ++YYCURSOR;",
          "914:  {",
          "915:  size_t len, maxlen;",
          "916:  zend_string *str;",
          "",
          "[Removed Lines]",
          "913: #line 671 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "914: #line 672 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "938:  ZVAL_STR(rval, str);",
          "939:  return 1;",
          "940: }",
          "942: yy46:",
          "943:  yych = *++YYCURSOR;",
          "944:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "941: #line 942 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "942: #line 943 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "959:  yych = *++YYCURSOR;",
          "960:  if (yych != '\"') goto yy18;",
          "961:  ++YYCURSOR;",
          "963:  {",
          "964:  size_t len, maxlen;",
          "965:  char *str;",
          "",
          "[Removed Lines]",
          "962: #line 644 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "963: #line 645 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "986:  ZVAL_STRINGL(rval, str, len);",
          "987:  return 1;",
          "988: }",
          "990: yy53:",
          "991:  yych = *++YYCURSOR;",
          "992:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "989: #line 990 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "990: #line 991 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1074:  }",
          "1075: yy63:",
          "1076:  ++YYCURSOR;",
          "1078:  {",
          "1079: #if SIZEOF_ZEND_LONG == 4",
          "1080: use_double:",
          "",
          "[Removed Lines]",
          "1077: #line 635 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1078: #line 636 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1083:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1084:  return 1;",
          "1085: }",
          "1087: yy65:",
          "1088:  yych = *++YYCURSOR;",
          "1089:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1086: #line 1087 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1087: #line 1088 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1142:  yych = *++YYCURSOR;",
          "1143:  if (yych != ';') goto yy18;",
          "1144:  ++YYCURSOR;",
          "1146:  {",
          "",
          "[Removed Lines]",
          "1145: #line 619 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1146: #line 620 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "1159:  return 1;",
          "1160: }",
          "1162: yy76:",
          "1163:  yych = *++YYCURSOR;",
          "1164:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1161: #line 1162 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1162: #line 1163 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1185:  if (yych <= '9') goto yy79;",
          "1186:  if (yych != ';') goto yy18;",
          "1187:  ++YYCURSOR;",
          "1189:  {",
          "1190: #if SIZEOF_ZEND_LONG == 4",
          "1191:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1188: #line 593 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1189: #line 594 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1211:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1212:  return 1;",
          "1213: }",
          "1215: yy83:",
          "1216:  yych = *++YYCURSOR;",
          "1217:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1214: #line 1215 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1215: #line 1216 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "1219:  yych = *++YYCURSOR;",
          "1220:  if (yych != ';') goto yy18;",
          "1221:  ++YYCURSOR;",
          "1223:  {",
          "1225:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1226:  return 1;",
          "1227: }",
          "1229: yy87:",
          "1230:  ++YYCURSOR;",
          "1232:  {",
          "1234:  ZVAL_NULL(rval);",
          "1235:  return 1;",
          "1236: }",
          "1238: yy89:",
          "1239:  yych = *++YYCURSOR;",
          "1240:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1222: #line 587 \"ext/standard/var_unserializer.re\"",
          "1228: #line 1229 \"ext/standard/var_unserializer.c\"",
          "1231: #line 581 \"ext/standard/var_unserializer.re\"",
          "1237: #line 1238 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1223: #line 588 \"ext/standard/var_unserializer.re\"",
          "1229: #line 1230 \"ext/standard/var_unserializer.c\"",
          "1232: #line 582 \"ext/standard/var_unserializer.re\"",
          "1238: #line 1239 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "1257:  if (yych <= '9') goto yy91;",
          "1258:  if (yych != ';') goto yy18;",
          "1259:  ++YYCURSOR;",
          "1261:  {",
          "1262:  zend_long id;",
          "",
          "[Removed Lines]",
          "1260: #line 558 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1261: #line 559 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "1281:  return 1;",
          "1282: }",
          "1284: yy95:",
          "1285:  yych = *++YYCURSOR;",
          "1286:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1283: #line 1284 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1284: #line 1285 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "1303:  if (yych <= '9') goto yy97;",
          "1304:  if (yych != ';') goto yy18;",
          "1305:  ++YYCURSOR;",
          "1307:  {",
          "1308:  zend_long id;",
          "",
          "[Removed Lines]",
          "1306: #line 536 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1307: #line 537 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 25 ---",
          "[Context before]",
          "1326:  return 1;",
          "1327: }",
          "1329: }",
          "1333:  return 0;",
          "",
          "[Removed Lines]",
          "1328: #line 1329 \"ext/standard/var_unserializer.c\"",
          "1330: #line 881 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1329: #line 1330 \"ext/standard/var_unserializer.c\"",
          "1331: #line 882 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "474: {",
          "475:  zval retval;",
          "476:  zval fname;",
          "478:  if (Z_TYPE_P(rval) != IS_OBJECT) {",
          "479:   return 0;",
          "480:  }",
          "484:   return 0;",
          "485:  }",
          "",
          "[Removed Lines]",
          "483:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_OBJPROP_P(rval), elements, 1)) {",
          "",
          "[Added Lines]",
          "477:  HashTable *ht = Z_OBJPROP_P(rval);",
          "483:  zend_hash_resize(ht, zend_hash_num_elements(ht) + elements);",
          "484:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, ht, elements, 1)) {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "6b2813c3a735af0cf66c5c921752b36f169be000",
      "candidate_info": {
        "commit_hash": "6b2813c3a735af0cf66c5c921752b36f169be000",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/6b2813c3a735af0cf66c5c921752b36f169be000",
        "files": [
          "NEWS",
          "ext/standard/tests/serialize/bug68044.phpt",
          "ext/standard/tests/serialize/bug74101.phpt",
          "ext/standard/tests/serialize/bug74614.phpt",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Fixed bug #75152 (signed integer overflow in parse_iv)",
        "before_after_code_files": [
          "ext/standard/tests/serialize/bug68044.phpt||ext/standard/tests/serialize/bug68044.phpt",
          "ext/standard/tests/serialize/bug74101.phpt||ext/standard/tests/serialize/bug74101.phpt",
          "ext/standard/tests/serialize/bug74614.phpt||ext/standard/tests/serialize/bug74614.phpt",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/tests/serialize/bug68044.phpt||ext/standard/tests/serialize/bug68044.phpt": [
          "File: ext/standard/tests/serialize/bug68044.phpt -> ext/standard/tests/serialize/bug68044.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "6: ?>",
          "7: ===DONE==",
          "8: --EXPECTF--",
          "9: Warning: Insufficient data for unserializing - %d required, 1 present in %s%ebug68044.php on line 2",
          "11: Notice: unserialize(): Error at offset 32 of 33 bytes in %s%ebug68044.php on line 2",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "9: Warning: unserialize(): Numerical result out of range in %sbug68044.php on line %d",
          "",
          "---------------"
        ],
        "ext/standard/tests/serialize/bug74101.phpt||ext/standard/tests/serialize/bug74101.phpt": [
          "File: ext/standard/tests/serialize/bug74101.phpt -> ext/standard/tests/serialize/bug74101.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "6: var_dump(unserialize($s));",
          "7: ?>",
          "8: --EXPECTF--",
          "10: bool(false)",
          "",
          "[Removed Lines]",
          "9: Notice: unserialize(): Error at offset 48 of 74 bytes in %s on line %d",
          "",
          "[Added Lines]",
          "9: Warning: unserialize(): Numerical result out of range in %sbug74101.php on line %d",
          "11: Notice: unserialize(): Error at offset 48 of 74 bytes in %sbug74101.php on line %d",
          "",
          "---------------"
        ],
        "ext/standard/tests/serialize/bug74614.phpt||ext/standard/tests/serialize/bug74614.phpt": [
          "File: ext/standard/tests/serialize/bug74614.phpt -> ext/standard/tests/serialize/bug74614.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "8: ?>",
          "9: --EXPECTF--",
          "10: Notice: unserialize(): Error at offset %d of 113 bytes in %s on line %d",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "10: Warning: unserialize(): Numerical result out of range in %sbug74614.php on line %d",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "324: static inline zend_long parse_iv2(const unsigned char *p, const unsigned char **q)",
          "325: {",
          "327:  zend_long result = 0;",
          "336:  }",
          "346:  }",
          "349:  return result;",
          "350: }",
          "",
          "[Removed Lines]",
          "326:  char cursor;",
          "328:  int neg = 0;",
          "330:  switch (*p) {",
          "331:   case '-':",
          "332:    neg++;",
          "334:   case '+':",
          "335:    p++;",
          "338:  while (1) {",
          "339:   cursor = (char)*p;",
          "340:   if (cursor >= '0' && cursor <= '9') {",
          "341:    result = result * 10 + (size_t)(cursor - (unsigned char)'0');",
          "342:   } else {",
          "343:    break;",
          "344:   }",
          "345:   p++;",
          "347:  if (q) *q = p;",
          "348:  if (neg) return -result;",
          "",
          "[Added Lines]",
          "327:  char *end;",
          "329:  errno = 0;",
          "330:  result = ZEND_STRTOL((const char*)p, &end, 0);",
          "332:  if (q) {",
          "336:  if (errno) {",
          "337:   php_error_docref(NULL, E_WARNING, \"%s\", strerror(errno));",
          "338:   return result;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "611:  start = cursor;",
          "615: {",
          "616:  YYCTYPE yych;",
          "617:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "614: #line 615 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "606: #line 607 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "669: yy2:",
          "670:  ++YYCURSOR;",
          "671: yy3:",
          "673:  { return 0; }",
          "675: yy4:",
          "676:  yych = *(YYMARKER = ++YYCURSOR);",
          "677:  if (yych == ':') goto yy17;",
          "",
          "[Removed Lines]",
          "672: #line 990 \"ext/standard/var_unserializer.re\"",
          "674: #line 675 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "664: #line 982 \"ext/standard/var_unserializer.re\"",
          "666: #line 667 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "718:  goto yy3;",
          "719: yy15:",
          "720:  ++YYCURSOR;",
          "722:  {",
          "724:  php_error_docref(NULL, E_NOTICE, \"Unexpected end of serialized data\");",
          "726: }",
          "728: yy17:",
          "729:  yych = *++YYCURSOR;",
          "730:  if (yybm[0+yych] & 128) {",
          "",
          "[Removed Lines]",
          "721: #line 984 \"ext/standard/var_unserializer.re\"",
          "727: #line 728 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "713: #line 976 \"ext/standard/var_unserializer.re\"",
          "719: #line 720 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "736:  goto yy3;",
          "737: yy19:",
          "738:  ++YYCURSOR;",
          "740:  {",
          "742:  ZVAL_NULL(rval);",
          "743:  return 1;",
          "744: }",
          "746: yy21:",
          "747:  yych = *++YYCURSOR;",
          "748:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "739: #line 668 \"ext/standard/var_unserializer.re\"",
          "745: #line 746 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "731: #line 660 \"ext/standard/var_unserializer.re\"",
          "737: #line 738 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "992:  goto yy18;",
          "993: yy63:",
          "994:  ++YYCURSOR;",
          "996:  {",
          "997:  zend_long id;",
          "",
          "[Removed Lines]",
          "995: #line 619 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "987: #line 611 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "1018:  return 1;",
          "1019: }",
          "1021: yy65:",
          "1022:  yych = *++YYCURSOR;",
          "1023:  if (yych == '\"') goto yy84;",
          "",
          "[Removed Lines]",
          "1020: #line 1021 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1012: #line 1013 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "1028:  goto yy18;",
          "1029: yy67:",
          "1030:  ++YYCURSOR;",
          "1032:  {",
          "1034:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1035:  return 1;",
          "1036: }",
          "1038: yy69:",
          "1039:  ++YYCURSOR;",
          "1040:  if ((YYLIMIT - YYCURSOR) < 4) YYFILL(4);",
          "",
          "[Removed Lines]",
          "1031: #line 674 \"ext/standard/var_unserializer.re\"",
          "1037: #line 1038 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1023: #line 666 \"ext/standard/var_unserializer.re\"",
          "1029: #line 1030 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "1054:  }",
          "1055: yy71:",
          "1056:  ++YYCURSOR;",
          "1058:  {",
          "1059: #if SIZEOF_ZEND_LONG == 4",
          "1060: use_double:",
          "",
          "[Removed Lines]",
          "1057: #line 722 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1049: #line 714 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "1063:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1064:  return 1;",
          "1065: }",
          "1067: yy73:",
          "1068:  yych = *++YYCURSOR;",
          "1069:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1066: #line 1067 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1058: #line 1059 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "1085:  goto yy18;",
          "1086: yy76:",
          "1087:  ++YYCURSOR;",
          "1089:  {",
          "1090: #if SIZEOF_ZEND_LONG == 4",
          "1091:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1088: #line 680 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1080: #line 672 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "1111:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1112:  return 1;",
          "1113: }",
          "1115: yy78:",
          "1116:  yych = *++YYCURSOR;",
          "1117:  if (yych == '\"') goto yy92;",
          "1118:  goto yy18;",
          "1119: yy79:",
          "1120:  ++YYCURSOR;",
          "1122:  {",
          "1123:  zend_long id;",
          "",
          "[Removed Lines]",
          "1114: #line 1115 \"ext/standard/var_unserializer.c\"",
          "1121: #line 644 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1106: #line 1107 \"ext/standard/var_unserializer.c\"",
          "1113: #line 636 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "1143:  return 1;",
          "1144: }",
          "1146: yy81:",
          "1147:  yych = *++YYCURSOR;",
          "1148:  if (yych == '\"') goto yy94;",
          "1149:  goto yy18;",
          "1150: yy82:",
          "1151:  ++YYCURSOR;",
          "1153:  {",
          "1154:  size_t len, len2, len3, maxlen;",
          "1155:  zend_long elements;",
          "",
          "[Removed Lines]",
          "1145: #line 1146 \"ext/standard/var_unserializer.c\"",
          "1152: #line 832 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1137: #line 1138 \"ext/standard/var_unserializer.c\"",
          "1144: #line 824 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "1302:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "1303: }",
          "1305: yy84:",
          "1306:  ++YYCURSOR;",
          "1308:  {",
          "1309:  size_t len, maxlen;",
          "1310:  zend_string *str;",
          "",
          "[Removed Lines]",
          "1304: #line 1305 \"ext/standard/var_unserializer.c\"",
          "1307: #line 763 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1296: #line 1297 \"ext/standard/var_unserializer.c\"",
          "1299: #line 755 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1338:  ZVAL_STR(rval, str);",
          "1339:  return 1;",
          "1340: }",
          "1342: yy86:",
          "1343:  ++YYCURSOR;",
          "1345:  {",
          "1346:  zend_long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "1341: #line 1342 \"ext/standard/var_unserializer.c\"",
          "1344: #line 797 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1333: #line 1334 \"ext/standard/var_unserializer.c\"",
          "1336: #line 789 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1366:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "1367: }",
          "1369: yy88:",
          "1370:  yych = *++YYCURSOR;",
          "1371:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1368: #line 1369 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1360: #line 1361 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1390:  goto yy18;",
          "1391: yy92:",
          "1392:  ++YYCURSOR;",
          "1394:  {",
          "1395:  zend_long elements;",
          "1396:     if (!var_hash) return 0;",
          "",
          "[Removed Lines]",
          "1393: #line 821 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1385: #line 813 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "1401:  }",
          "1402:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "1403: }",
          "1405: yy94:",
          "1406:  ++YYCURSOR;",
          "1408:  {",
          "1409:  size_t len, maxlen;",
          "1410:  char *str;",
          "",
          "[Removed Lines]",
          "1404: #line 1405 \"ext/standard/var_unserializer.c\"",
          "1407: #line 731 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1396: #line 1397 \"ext/standard/var_unserializer.c\"",
          "1399: #line 723 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1436:  ZVAL_STRINGL(rval, str, len);",
          "1437:  return 1;",
          "1438: }",
          "1440: yy96:",
          "1441:  yych = *++YYCURSOR;",
          "1442:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1439: #line 1440 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1431: #line 1432 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1444:  goto yy18;",
          "1445: yy97:",
          "1446:  ++YYCURSOR;",
          "1448:  {",
          "",
          "[Removed Lines]",
          "1447: #line 706 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1439: #line 698 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "1461:  return 1;",
          "1462: }",
          "1464: }",
          "1468:  return 0;",
          "",
          "[Removed Lines]",
          "1463: #line 1464 \"ext/standard/var_unserializer.c\"",
          "1465: #line 992 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1455: #line 1456 \"ext/standard/var_unserializer.c\"",
          "1457: #line 984 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "328: static inline zend_long parse_iv2(const unsigned char *p, const unsigned char **q)",
          "329: {",
          "331:  zend_long result = 0;",
          "340:  }",
          "350:  }",
          "353:  return result;",
          "354: }",
          "",
          "[Removed Lines]",
          "330:  char cursor;",
          "332:  int neg = 0;",
          "334:  switch (*p) {",
          "335:   case '-':",
          "336:    neg++;",
          "338:   case '+':",
          "339:    p++;",
          "342:  while (1) {",
          "343:   cursor = (char)*p;",
          "344:   if (cursor >= '0' && cursor <= '9') {",
          "345:    result = result * 10 + (size_t)(cursor - (unsigned char)'0');",
          "346:   } else {",
          "347:    break;",
          "348:   }",
          "349:   p++;",
          "351:  if (q) *q = p;",
          "352:  if (neg) return -result;",
          "",
          "[Added Lines]",
          "331:  char *end;",
          "333:  errno = 0;",
          "334:  result = ZEND_STRTOL((const char*)p, &end, 0);",
          "336:  if (q) {",
          "340:  if (errno) {",
          "341:   php_error_docref(NULL, E_WARNING, \"%s\", strerror(errno));",
          "342:   return result;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "b7052ef16dccd5858626bb7899193cdc16853861",
      "candidate_info": {
        "commit_hash": "b7052ef16dccd5858626bb7899193cdc16853861",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/b7052ef16dccd5858626bb7899193cdc16853861",
        "files": [
          "ext/standard/php_var.h",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Revert \"Fixed unserialize implementation (it's complicated, this issue took me 4 hours :<, need some review)\"\n\nThis reverts commit 80a178015d6b162ff0ba7a8e8f5a08c88829cc3c.",
        "before_after_code_files": [
          "ext/standard/php_var.h||ext/standard/php_var.h",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/php_var.h||ext/standard/php_var.h": [
          "File: ext/standard/php_var.h -> ext/standard/php_var.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "113:  } \\",
          "114: } while (0)",
          "116: PHPAPI void var_push_dtor(php_unserialize_data_t *var_hash, zval *val);",
          "117: PHPAPI void var_push_dtor_no_addref(php_unserialize_data_t *var_hashx, zval *rval);",
          "118: PHPAPI void var_destroy(php_unserialize_data_t *var_hash);",
          "120: PHPAPI zend_class_entry *php_create_empty_class(char *class_name, int len);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "116: PHPAPI void var_replace(php_unserialize_data_t *var_hash, zval *ozval, zval *nzval);",
          "121: #define PHP_VAR_UNSERIALIZE_ZVAL_CHANGED(var_hash, ozval, nzval) \\",
          "122:  var_replace((var_hash), (ozval), &(nzval))",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "29: #define VAR_ENTRIES_DBG 0",
          "31: typedef struct {",
          "33:  long used_slots;",
          "34:  void *next;",
          "35: } var_entries;",
          "",
          "[Removed Lines]",
          "32:  zval data[VAR_ENTRIES_MAX];",
          "",
          "[Added Lines]",
          "32:  zval *data[VAR_ENTRIES_MAX];",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "55:   (*var_hashx)->last = var_hash;",
          "56:  }",
          "60: }",
          "62: PHPAPI void var_push_dtor(php_unserialize_data_t *var_hashx, zval *rval)",
          "",
          "[Removed Lines]",
          "58:  ZVAL_COPY_VALUE(&var_hash->data[var_hash->used_slots], rval);",
          "59:  var_hash->used_slots++;",
          "",
          "[Added Lines]",
          "58:  var_hash->data[var_hash->used_slots++] = rval;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "80:   (*var_hashx)->last_dtor = var_hash;",
          "81:  }",
          "85: }",
          "87: PHPAPI void var_push_dtor_no_addref(php_unserialize_data_t *var_hashx, zval *rval)",
          "",
          "[Removed Lines]",
          "83:  ZVAL_COPY(&var_hash->data[var_hash->used_slots], rval);",
          "84:  var_hash->used_slots++;",
          "",
          "[Added Lines]",
          "82:  Z_ADDREF_P(rval);",
          "83:  var_hash->data[var_hash->used_slots++] = rval;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "105:   (*var_hashx)->last_dtor = var_hash;",
          "106:  }",
          "110: }",
          "112: static int var_access(php_unserialize_data_t *var_hashx, long id, zval **store)",
          "",
          "[Removed Lines]",
          "108:  ZVAL_COPY_VALUE(&var_hash->data[var_hash->used_slots], rval);",
          "109:  var_hash->used_slots++;",
          "",
          "[Added Lines]",
          "107:  var_hash->data[var_hash->used_slots++] = rval;",
          "108: }",
          "110: PHPAPI void var_replace(php_unserialize_data_t *var_hashx, zval *ozval, zval *nzval)",
          "111: {",
          "112:  long i;",
          "113:  var_entries *var_hash = (*var_hashx)->first;",
          "114: #if VAR_ENTRIES_DBG",
          "115:  fprintf(stderr, \"var_replace(%ld): %d\\n\", var_hash?var_hash->used_slots:-1L, Z_TYPE_PP(nzval));",
          "116: #endif",
          "118:  while (var_hash) {",
          "119:   for (i = 0; i < var_hash->used_slots; i++) {",
          "120:    if (var_hash->data[i] == ozval) {",
          "121:     var_hash->data[i] = nzval;",
          "123:    }",
          "124:   }",
          "125:   var_hash = var_hash->next;",
          "126:  }",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "150:  while (var_hash) {",
          "151:   for (i = 0; i < var_hash->used_slots; i++) {",
          "153:   }",
          "154:   next = var_hash->next;",
          "155:   efree(var_hash);",
          "",
          "[Removed Lines]",
          "152:    zval_ptr_dtor(&var_hash->data[i]);",
          "",
          "[Added Lines]",
          "169:    zval_ptr_dtor(var_hash->data[i]);",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "209: #define YYMARKER marker",
          "",
          "[Removed Lines]",
          "212: #line 217 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "229: #line 234 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "282:    return 0;",
          "283:   }",
          "290:   if (Z_TYPE(key) != IS_LONG && Z_TYPE(key) != IS_STRING) {",
          "291:    zval_dtor(&key);",
          "292:    return 0;",
          "",
          "[Removed Lines]",
          "285:   if (var_hash && !Z_ISREF(key)) {",
          "286:    var_push(var_hash, &key);",
          "287:   }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "298:    return 0;",
          "299:   }",
          "305:   if (!objprops) {",
          "306:    switch (Z_TYPE(key)) {",
          "307:    case IS_LONG:",
          "",
          "[Removed Lines]",
          "301:   if (var_hash && !Z_ISREF(data)) {",
          "302:    var_push(var_hash, &data);",
          "303:   }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "428:   return 0;",
          "429:  }",
          "431:  start = cursor;",
          "437: {",
          "438:  YYCTYPE yych;",
          "439:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "436: #line 437 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "439:  if (var_hash && cursor[0] != 'R') {",
          "440:   var_push(var_hash, rval);",
          "441:  }",
          "448: #line 449 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "493:  yych = *(YYMARKER = ++YYCURSOR);",
          "494:  if (yych == ':') goto yy95;",
          "495: yy3:",
          "497:  { return 0; }",
          "499: yy4:",
          "500:  yych = *(YYMARKER = ++YYCURSOR);",
          "501:  if (yych == ':') goto yy89;",
          "",
          "[Removed Lines]",
          "496: #line 774 \"ext/standard/var_unserializer.re\"",
          "498: #line 499 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "508: #line 786 \"ext/standard/var_unserializer.re\"",
          "510: #line 511 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "538:  goto yy3;",
          "539: yy14:",
          "540:  ++YYCURSOR;",
          "542:  {",
          "544:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
          "546: }",
          "548: yy16:",
          "549:  yych = *++YYCURSOR;",
          "550:  goto yy3;",
          "",
          "[Removed Lines]",
          "541: #line 768 \"ext/standard/var_unserializer.re\"",
          "547: #line 548 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "553: #line 780 \"ext/standard/var_unserializer.re\"",
          "559: #line 560 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "574:  yych = *++YYCURSOR;",
          "575:  if (yych != '\"') goto yy18;",
          "576:  ++YYCURSOR;",
          "578:  {",
          "579:  size_t len, len2, len3, maxlen;",
          "580:  long elements;",
          "",
          "[Removed Lines]",
          "577: #line 629 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "589: #line 641 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "714:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "715: }",
          "717: yy25:",
          "718:  yych = *++YYCURSOR;",
          "719:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "716: #line 717 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "728: #line 729 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "738:  yych = *++YYCURSOR;",
          "739:  if (yych != '\"') goto yy18;",
          "740:  ++YYCURSOR;",
          "742:  {",
          "",
          "[Removed Lines]",
          "741: #line 621 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "753: #line 633 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "746:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "747:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "748: }",
          "750: yy32:",
          "751:  yych = *++YYCURSOR;",
          "752:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "749: #line 750 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "761: #line 762 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "767:  yych = *++YYCURSOR;",
          "768:  if (yych != '{') goto yy18;",
          "769:  ++YYCURSOR;",
          "771:  {",
          "772:  long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "770: #line 603 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "782: #line 615 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "786:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "787: }",
          "789: yy39:",
          "790:  yych = *++YYCURSOR;",
          "791:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "788: #line 789 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "800: #line 801 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "806:  yych = *++YYCURSOR;",
          "807:  if (yych != '\"') goto yy18;",
          "808:  ++YYCURSOR;",
          "810:  {",
          "811:  size_t len, maxlen;",
          "812:  char *str;",
          "",
          "[Removed Lines]",
          "809: #line 574 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "821: #line 586 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "835:  ZVAL_STRINGL(rval, str, len);",
          "836:  return 1;",
          "837: }",
          "839: yy46:",
          "840:  yych = *++YYCURSOR;",
          "841:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "838: #line 839 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "850: #line 851 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "856:  yych = *++YYCURSOR;",
          "857:  if (yych != '\"') goto yy18;",
          "858:  ++YYCURSOR;",
          "860:  {",
          "861:  size_t len, maxlen;",
          "862:  char *str;",
          "",
          "[Removed Lines]",
          "859: #line 547 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "871: #line 559 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "883:  ZVAL_STRINGL(rval, str, len);",
          "884:  return 1;",
          "885: }",
          "887: yy53:",
          "888:  yych = *++YYCURSOR;",
          "889:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "886: #line 887 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "898: #line 899 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "971:  }",
          "972: yy63:",
          "973:  ++YYCURSOR;",
          "975:  {",
          "976: #if SIZEOF_LONG == 4",
          "977: use_double:",
          "",
          "[Removed Lines]",
          "974: #line 538 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "986: #line 550 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "980:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "981:  return 1;",
          "982: }",
          "984: yy65:",
          "985:  yych = *++YYCURSOR;",
          "986:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "983: #line 984 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "995: #line 996 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "1039:  yych = *++YYCURSOR;",
          "1040:  if (yych != ';') goto yy18;",
          "1041:  ++YYCURSOR;",
          "1043:  {",
          "",
          "[Removed Lines]",
          "1042: #line 522 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1054: #line 534 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 25 ---",
          "[Context before]",
          "1056:  return 1;",
          "1057: }",
          "1059: yy76:",
          "1060:  yych = *++YYCURSOR;",
          "1061:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1058: #line 1059 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1070: #line 1071 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 26 ---",
          "[Context before]",
          "1082:  if (yych <= '9') goto yy79;",
          "1083:  if (yych != ';') goto yy18;",
          "1084:  ++YYCURSOR;",
          "1086:  {",
          "1087: #if SIZEOF_LONG == 4",
          "1088:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1085: #line 496 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1097: #line 508 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 27 ---",
          "[Context before]",
          "1108:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1109:  return 1;",
          "1110: }",
          "1112: yy83:",
          "1113:  yych = *++YYCURSOR;",
          "1114:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1111: #line 1112 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1123: #line 1124 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 28 ---",
          "[Context before]",
          "1116:  yych = *++YYCURSOR;",
          "1117:  if (yych != ';') goto yy18;",
          "1118:  ++YYCURSOR;",
          "1120:  {",
          "1122:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1123:  return 1;",
          "1124: }",
          "1126: yy87:",
          "1127:  ++YYCURSOR;",
          "1129:  {",
          "1131:  ZVAL_NULL(rval);",
          "1132:  return 1;",
          "1133: }",
          "1135: yy89:",
          "1136:  yych = *++YYCURSOR;",
          "1137:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1119: #line 490 \"ext/standard/var_unserializer.re\"",
          "1125: #line 1126 \"ext/standard/var_unserializer.c\"",
          "1128: #line 484 \"ext/standard/var_unserializer.re\"",
          "1134: #line 1135 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1131: #line 502 \"ext/standard/var_unserializer.re\"",
          "1137: #line 1138 \"ext/standard/var_unserializer.c\"",
          "1140: #line 496 \"ext/standard/var_unserializer.re\"",
          "1146: #line 1147 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 29 ---",
          "[Context before]",
          "1154:  if (yych <= '9') goto yy91;",
          "1155:  if (yych != ';') goto yy18;",
          "1156:  ++YYCURSOR;",
          "1158:  {",
          "1159:  long id;",
          "",
          "[Removed Lines]",
          "1157: #line 461 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1169: #line 473 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 30 ---",
          "[Context before]",
          "1178:  return 1;",
          "1179: }",
          "1181: yy95:",
          "1182:  yych = *++YYCURSOR;",
          "1183:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1180: #line 1181 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1192: #line 1193 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 31 ---",
          "[Context before]",
          "1200:  if (yych <= '9') goto yy97;",
          "1201:  if (yych != ';') goto yy18;",
          "1202:  ++YYCURSOR;",
          "1204:  {",
          "1205:  long id;",
          "",
          "[Removed Lines]",
          "1203: #line 441 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1215: #line 453 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 32 ---",
          "[Context before]",
          "1221:  return 1;",
          "1222: }",
          "1224: }",
          "1228:  return 0;",
          "",
          "[Removed Lines]",
          "1223: #line 1224 \"ext/standard/var_unserializer.c\"",
          "1225: #line 776 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1235: #line 1236 \"ext/standard/var_unserializer.c\"",
          "1237: #line 788 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "27: #define VAR_ENTRIES_DBG 0",
          "29: typedef struct {",
          "31:  long used_slots;",
          "32:  void *next;",
          "33: } var_entries;",
          "",
          "[Removed Lines]",
          "30:  zval data[VAR_ENTRIES_MAX];",
          "",
          "[Added Lines]",
          "30:  zval *data[VAR_ENTRIES_MAX];",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "53:   (*var_hashx)->last = var_hash;",
          "54:  }",
          "58: }",
          "60: PHPAPI void var_push_dtor(php_unserialize_data_t *var_hashx, zval *rval)",
          "",
          "[Removed Lines]",
          "56:  ZVAL_COPY_VALUE(&var_hash->data[var_hash->used_slots], rval);",
          "57:  var_hash->used_slots++;",
          "",
          "[Added Lines]",
          "56:  var_hash->data[var_hash->used_slots++] = rval;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "78:   (*var_hashx)->last_dtor = var_hash;",
          "79:  }",
          "83: }",
          "85: PHPAPI void var_push_dtor_no_addref(php_unserialize_data_t *var_hashx, zval *rval)",
          "",
          "[Removed Lines]",
          "81:  ZVAL_COPY(&var_hash->data[var_hash->used_slots], rval);",
          "82:  var_hash->used_slots++;",
          "",
          "[Added Lines]",
          "80:  Z_ADDREF_P(rval);",
          "81:  var_hash->data[var_hash->used_slots++] = rval;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "103:   (*var_hashx)->last_dtor = var_hash;",
          "104:  }",
          "108: }",
          "110: static int var_access(php_unserialize_data_t *var_hashx, long id, zval **store)",
          "",
          "[Removed Lines]",
          "106:  ZVAL_COPY_VALUE(&var_hash->data[var_hash->used_slots], rval);",
          "107:  var_hash->used_slots++;",
          "",
          "[Added Lines]",
          "105:  var_hash->data[var_hash->used_slots++] = rval;",
          "106: }",
          "108: PHPAPI void var_replace(php_unserialize_data_t *var_hashx, zval *ozval, zval *nzval)",
          "109: {",
          "110:  long i;",
          "111:  var_entries *var_hash = (*var_hashx)->first;",
          "112: #if VAR_ENTRIES_DBG",
          "113:  fprintf(stderr, \"var_replace(%ld): %d\\n\", var_hash?var_hash->used_slots:-1L, Z_TYPE_PP(nzval));",
          "114: #endif",
          "116:  while (var_hash) {",
          "117:   for (i = 0; i < var_hash->used_slots; i++) {",
          "118:    if (var_hash->data[i] == ozval) {",
          "119:     var_hash->data[i] = nzval;",
          "121:    }",
          "122:   }",
          "123:   var_hash = var_hash->next;",
          "124:  }",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "148:  while (var_hash) {",
          "149:   for (i = 0; i < var_hash->used_slots; i++) {",
          "151:   }",
          "152:   next = var_hash->next;",
          "153:   efree(var_hash);",
          "",
          "[Removed Lines]",
          "150:    zval_ptr_dtor(&var_hash->data[i]);",
          "",
          "[Added Lines]",
          "167:    zval_ptr_dtor(var_hash->data[i]);",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "286:    return 0;",
          "287:   }",
          "294:   if (Z_TYPE(key) != IS_LONG && Z_TYPE(key) != IS_STRING) {",
          "295:    zval_dtor(&key);",
          "296:    return 0;",
          "",
          "[Removed Lines]",
          "289:   if (var_hash && !Z_ISREF(key)) {",
          "290:    var_push(var_hash, &key);",
          "291:   }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "302:    return 0;",
          "303:   }",
          "309:   if (!objprops) {",
          "310:    switch (Z_TYPE(key)) {",
          "311:    case IS_LONG:",
          "",
          "[Removed Lines]",
          "305:   if (var_hash && !Z_ISREF(data)) {",
          "306:    var_push(var_hash, &data);",
          "307:   }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "432:   return 0;",
          "433:  }",
          "435:  start = cursor;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "443:  if (var_hash && cursor[0] != 'R') {",
          "444:   var_push(var_hash, rval);",
          "445:  }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "f8c514ba6b7962a219296a837b2dbc22f749e736",
      "candidate_info": {
        "commit_hash": "f8c514ba6b7962a219296a837b2dbc22f749e736",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/f8c514ba6b7962a219296a837b2dbc22f749e736",
        "files": [
          "ext/standard/tests/serialize/bug25378.phpt",
          "ext/standard/tests/serialize/bug74111.phpt",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Fixed bug #74111",
        "before_after_code_files": [
          "ext/standard/tests/serialize/bug25378.phpt||ext/standard/tests/serialize/bug25378.phpt",
          "ext/standard/tests/serialize/bug74111.phpt||ext/standard/tests/serialize/bug74111.phpt",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/tests/serialize/bug25378.phpt||ext/standard/tests/serialize/bug25378.phpt": [
          "File: ext/standard/tests/serialize/bug25378.phpt -> ext/standard/tests/serialize/bug25378.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "42: Notice: unserialize(): Error at offset 17 of 33 bytes in %sbug25378.php on line %d",
          "43: bool(false)",
          "46: bool(false)",
          "48: Notice: unserialize(): Error at offset 2 of 13 bytes in %sbug25378.php on line %d",
          "",
          "[Removed Lines]",
          "45: Notice: unserialize(): Error at offset 33 of 32 bytes in %sbug25378.php on line %d",
          "",
          "[Added Lines]",
          "45: Notice: unserialize(): Error at offset 32 of 32 bytes in %sbug25378.php on line %d",
          "",
          "---------------"
        ],
        "ext/standard/tests/serialize/bug74111.phpt||ext/standard/tests/serialize/bug74111.phpt": [
          "File: ext/standard/tests/serialize/bug74111.phpt -> ext/standard/tests/serialize/bug74111.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #74111: Heap buffer overread (READ: 1) finish_nested_data from unserialize",
          "3: --FILE--",
          "4: <?php",
          "5: $s = 'O:8:\"stdClass\":00000000';",
          "6: var_dump(unserialize($s));",
          "7: ?>",
          "8: --EXPECTF--",
          "9: Notice: unserialize(): Error at offset 25 of 23 bytes in %s on line %d",
          "10: bool(false)",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "407: static inline int finish_nested_data(UNSERIALIZE_PARAMETER)",
          "408: {",
          "416: }",
          "418: static inline int object_custom(UNSERIALIZE_PARAMETER, zend_class_entry *ce)",
          "",
          "[Removed Lines]",
          "409:  if (*((*p)++) == '}')",
          "410:   return 1;",
          "412: #if SOMETHING_NEW_MIGHT_LEAD_TO_CRASH_ENABLE_IF_YOU_ARE_BRAVE",
          "413:  zval_ptr_dtor(rval);",
          "414: #endif",
          "415:  return 0;",
          "",
          "[Added Lines]",
          "409:  if (*p >= max || **p != '}') {",
          "410:   return 0;",
          "411:  }",
          "413:  (*p)++;",
          "414:  return 1;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "533: {",
          "534:  YYCTYPE yych;",
          "535:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "532: #line 533 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "531: #line 532 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "570:  yych = *YYCURSOR;",
          "571:  switch (yych) {",
          "572:  case 'C':",
          "574:  case 'N': goto yy5;",
          "581:  case 'o': goto yy12;",
          "586:  }",
          "587: yy2:",
          "589: yy3:",
          "591:  { return 0; }",
          "592: #line 593 \"ext/standard/var_unserializer.c\"",
          "593: yy4:",
          "594:  yych = *(YYMARKER = ++YYCURSOR);",
          "596:  goto yy3;",
          "597: yy5:",
          "598:  yych = *++YYCURSOR;",
          "600:  goto yy3;",
          "601: yy6:",
          "602:  yych = *(YYMARKER = ++YYCURSOR);",
          "604:  goto yy3;",
          "605: yy7:",
          "606:  yych = *(YYMARKER = ++YYCURSOR);",
          "608:  goto yy3;",
          "609: yy8:",
          "610:  yych = *(YYMARKER = ++YYCURSOR);",
          "612:  goto yy3;",
          "613: yy9:",
          "614:  yych = *(YYMARKER = ++YYCURSOR);",
          "616:  goto yy3;",
          "617: yy10:",
          "618:  yych = *(YYMARKER = ++YYCURSOR);",
          "620:  goto yy3;",
          "621: yy11:",
          "622:  yych = *(YYMARKER = ++YYCURSOR);",
          "624:  goto yy3;",
          "625: yy12:",
          "626:  yych = *(YYMARKER = ++YYCURSOR);",
          "628:  goto yy3;",
          "629: yy13:",
          "630:  yych = *(YYMARKER = ++YYCURSOR);",
          "632:  goto yy3;",
          "633: yy14:",
          "638:  ++YYCURSOR;",
          "640:  {",
          "642:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
          "644: }",
          "646: yy17:",
          "647:  yych = *++YYCURSOR;",
          "648:  if (yybm[0+yych] & 128) {",
          "650:  }",
          "652: yy18:",
          "653:  YYCURSOR = YYMARKER;",
          "654:  goto yy3;",
          "655: yy19:",
          "666:  yych = *++YYCURSOR;",
          "675:  }",
          "687:  goto yy18;",
          "690:  if (yych <= '/') goto yy18;",
          "694:  yych = *++YYCURSOR;",
          "703:   }",
          "709:   } else {",
          "712:   }",
          "713:  }",
          "724:  }",
          "735:  }",
          "737:  yych = *++YYCURSOR;",
          "738:  if (yych <= ',') {",
          "741:  } else {",
          "743:   if (yych <= '/') goto yy18;",
          "745:   goto yy18;",
          "746:  }",
          "748:  yych = *++YYCURSOR;",
          "750:  if (yych <= '/') goto yy18;",
          "760:  ++YYCURSOR;",
          "761:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "762:  yych = *YYCURSOR;",
          "766:  if (yych <= '/') goto yy18;",
          "770:  yych = *++YYCURSOR;",
          "774:  ++YYCURSOR;",
          "777:  if (yych <= '/') goto yy18;",
          "778:  if (yych <= '9') goto yy34;",
          "780:  goto yy18;",
          "782:  yych = *++YYCURSOR;",
          "783:  if (yych <= '/') goto yy18;",
          "784:  if (yych >= ':') goto yy18;",
          "786:  ++YYCURSOR;",
          "787:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "788:  yych = *YYCURSOR;",
          "789:  if (yych <= '/') goto yy18;",
          "794:  yych = *++YYCURSOR;",
          "798:  ++YYCURSOR;",
          "823:  }",
          "851:  }",
          "861:  yych = *++YYCURSOR;",
          "862:  if (yych <= '/') goto yy18;",
          "871:  goto yy18;",
          "873:  yych = *++YYCURSOR;",
          "874:  if (yych <= '/') goto yy18;",
          "875:  if (yych >= ':') goto yy18;",
          "877:  ++YYCURSOR;",
          "878:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "879:  yych = *YYCURSOR;",
          "880:  if (yych <= '/') goto yy18;",
          "885:  yych = *++YYCURSOR;",
          "889:  ++YYCURSOR;",
          "892:  if (yych <= '/') goto yy18;",
          "895:  goto yy18;",
          "897:  yych = *++YYCURSOR;",
          "898:  if (yych <= '/') goto yy18;",
          "899:  if (yych >= ':') goto yy18;",
          "901:  ++YYCURSOR;",
          "902:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "903:  yych = *YYCURSOR;",
          "904:  if (yych <= '/') goto yy18;",
          "909:  yych = *++YYCURSOR;",
          "913:  ++YYCURSOR;",
          "915:  {",
          "923:   return 0;",
          "924:  }",
          "928:  }",
          "933:  return 1;",
          "934: }",
          "937:  yych = *++YYCURSOR;",
          "939:  goto yy18;",
          "941:  yych = *++YYCURSOR;",
          "943:  goto yy18;",
          "945:  ++YYCURSOR;",
          "955:  ++YYCURSOR;",
          "956:  if ((YYLIMIT - YYCURSOR) < 4) YYFILL(4);",
          "957:  yych = *YYCURSOR;",
          "958:  if (yych <= ';') {",
          "959:   if (yych <= '/') goto yy18;",
          "961:   if (yych <= ':') goto yy18;",
          "962:  } else {",
          "963:   if (yych <= 'E') {",
          "964:    if (yych <= 'D') goto yy18;",
          "966:   } else {",
          "968:    goto yy18;",
          "969:   }",
          "970:  }",
          "972:  ++YYCURSOR;",
          "974:  {",
          "975: #if SIZEOF_LONG == 4",
          "976: use_double:",
          "",
          "[Removed Lines]",
          "573:  case 'O': goto yy4;",
          "575:  case 'R': goto yy6;",
          "576:  case 'S': goto yy7;",
          "577:  case 'a': goto yy8;",
          "578:  case 'b': goto yy9;",
          "579:  case 'd': goto yy10;",
          "580:  case 'i': goto yy11;",
          "582:  case 'r': goto yy13;",
          "583:  case 's': goto yy14;",
          "584:  case '}': goto yy15;",
          "585:  default: goto yy2;",
          "588:  ++YYCURSOR;",
          "590: #line 909 \"ext/standard/var_unserializer.re\"",
          "595:  if (yych == ':') goto yy17;",
          "599:  if (yych == ';') goto yy19;",
          "603:  if (yych == ':') goto yy21;",
          "607:  if (yych == ':') goto yy22;",
          "611:  if (yych == ':') goto yy23;",
          "615:  if (yych == ':') goto yy24;",
          "619:  if (yych == ':') goto yy25;",
          "623:  if (yych == ':') goto yy26;",
          "627:  if (yych == ':') goto yy27;",
          "631:  if (yych == ':') goto yy28;",
          "634:  yych = *(YYMARKER = ++YYCURSOR);",
          "635:  if (yych == ':') goto yy29;",
          "636:  goto yy3;",
          "637: yy15:",
          "639: #line 903 \"ext/standard/var_unserializer.re\"",
          "645: #line 646 \"ext/standard/var_unserializer.c\"",
          "649:   goto yy31;",
          "651:  if (yych == '+') goto yy30;",
          "656:  ++YYCURSOR;",
          "657: #line 581 \"ext/standard/var_unserializer.re\"",
          "658:  {",
          "660:  INIT_PZVAL(*rval);",
          "661:  ZVAL_NULL(*rval);",
          "662:  return 1;",
          "663: }",
          "664: #line 665 \"ext/standard/var_unserializer.c\"",
          "665: yy21:",
          "667:  if (yych <= ',') {",
          "668:   if (yych == '+') goto yy33;",
          "669:   goto yy18;",
          "670:  } else {",
          "671:   if (yych <= '-') goto yy33;",
          "672:   if (yych <= '/') goto yy18;",
          "673:   if (yych <= '9') goto yy34;",
          "674:   goto yy18;",
          "676: yy22:",
          "677:  yych = *++YYCURSOR;",
          "678:  if (yych == '+') goto yy36;",
          "679:  if (yych <= '/') goto yy18;",
          "680:  if (yych <= '9') goto yy37;",
          "681:  goto yy18;",
          "682: yy23:",
          "683:  yych = *++YYCURSOR;",
          "684:  if (yych == '+') goto yy39;",
          "685:  if (yych <= '/') goto yy18;",
          "686:  if (yych <= '9') goto yy40;",
          "688: yy24:",
          "689:  yych = *++YYCURSOR;",
          "691:  if (yych <= '1') goto yy42;",
          "692:  goto yy18;",
          "693: yy25:",
          "695:  if (yych <= '/') {",
          "696:   if (yych <= ',') {",
          "697:    if (yych == '+') goto yy43;",
          "698:    goto yy18;",
          "699:   } else {",
          "700:    if (yych <= '-') goto yy44;",
          "701:    if (yych <= '.') goto yy45;",
          "702:    goto yy18;",
          "704:  } else {",
          "705:   if (yych <= 'I') {",
          "706:    if (yych <= '9') goto yy46;",
          "707:    if (yych <= 'H') goto yy18;",
          "708:    goto yy48;",
          "710:    if (yych == 'N') goto yy49;",
          "711:    goto yy18;",
          "714: yy26:",
          "715:  yych = *++YYCURSOR;",
          "716:  if (yych <= ',') {",
          "717:   if (yych == '+') goto yy50;",
          "718:   goto yy18;",
          "719:  } else {",
          "720:   if (yych <= '-') goto yy50;",
          "721:   if (yych <= '/') goto yy18;",
          "722:   if (yych <= '9') goto yy51;",
          "723:   goto yy18;",
          "725: yy27:",
          "726:  yych = *++YYCURSOR;",
          "727:  if (yych <= ',') {",
          "728:   if (yych == '+') goto yy53;",
          "729:   goto yy18;",
          "730:  } else {",
          "731:   if (yych <= '-') goto yy53;",
          "732:   if (yych <= '/') goto yy18;",
          "733:   if (yych <= '9') goto yy54;",
          "734:   goto yy18;",
          "736: yy28:",
          "739:   if (yych == '+') goto yy56;",
          "740:   goto yy18;",
          "742:   if (yych <= '-') goto yy56;",
          "744:   if (yych <= '9') goto yy57;",
          "747: yy29:",
          "749:  if (yych == '+') goto yy59;",
          "751:  if (yych <= '9') goto yy60;",
          "752:  goto yy18;",
          "753: yy30:",
          "754:  yych = *++YYCURSOR;",
          "755:  if (yybm[0+yych] & 128) {",
          "756:   goto yy31;",
          "757:  }",
          "758:  goto yy18;",
          "759: yy31:",
          "763:  if (yybm[0+yych] & 128) {",
          "764:   goto yy31;",
          "765:  }",
          "767:  if (yych <= ':') goto yy62;",
          "768:  goto yy18;",
          "769: yy33:",
          "771:  if (yych <= '/') goto yy18;",
          "772:  if (yych >= ':') goto yy18;",
          "773: yy34:",
          "775:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "776:  yych = *YYCURSOR;",
          "779:  if (yych == ';') goto yy63;",
          "781: yy36:",
          "785: yy37:",
          "790:  if (yych <= '9') goto yy37;",
          "791:  if (yych <= ':') goto yy65;",
          "792:  goto yy18;",
          "793: yy39:",
          "795:  if (yych <= '/') goto yy18;",
          "796:  if (yych >= ':') goto yy18;",
          "797: yy40:",
          "799:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "800:  yych = *YYCURSOR;",
          "801:  if (yych <= '/') goto yy18;",
          "802:  if (yych <= '9') goto yy40;",
          "803:  if (yych <= ':') goto yy66;",
          "804:  goto yy18;",
          "805: yy42:",
          "806:  yych = *++YYCURSOR;",
          "807:  if (yych == ';') goto yy67;",
          "808:  goto yy18;",
          "809: yy43:",
          "810:  yych = *++YYCURSOR;",
          "811:  if (yych == '.') goto yy45;",
          "812:  if (yych <= '/') goto yy18;",
          "813:  if (yych <= '9') goto yy46;",
          "814:  goto yy18;",
          "815: yy44:",
          "816:  yych = *++YYCURSOR;",
          "817:  if (yych <= '/') {",
          "818:   if (yych != '.') goto yy18;",
          "819:  } else {",
          "820:   if (yych <= '9') goto yy46;",
          "821:   if (yych == 'I') goto yy48;",
          "822:   goto yy18;",
          "824: yy45:",
          "825:  yych = *++YYCURSOR;",
          "826:  if (yych <= '/') goto yy18;",
          "827:  if (yych <= '9') goto yy69;",
          "828:  goto yy18;",
          "829: yy46:",
          "830:  ++YYCURSOR;",
          "831:  if ((YYLIMIT - YYCURSOR) < 4) YYFILL(4);",
          "832:  yych = *YYCURSOR;",
          "833:  if (yych <= ':') {",
          "834:   if (yych <= '.') {",
          "835:    if (yych <= '-') goto yy18;",
          "836:    goto yy69;",
          "837:   } else {",
          "838:    if (yych <= '/') goto yy18;",
          "839:    if (yych <= '9') goto yy46;",
          "840:    goto yy18;",
          "841:   }",
          "842:  } else {",
          "843:   if (yych <= 'E') {",
          "844:    if (yych <= ';') goto yy71;",
          "845:    if (yych <= 'D') goto yy18;",
          "846:    goto yy73;",
          "847:   } else {",
          "848:    if (yych == 'e') goto yy73;",
          "849:    goto yy18;",
          "850:   }",
          "852: yy48:",
          "853:  yych = *++YYCURSOR;",
          "854:  if (yych == 'N') goto yy74;",
          "855:  goto yy18;",
          "856: yy49:",
          "857:  yych = *++YYCURSOR;",
          "858:  if (yych == 'A') goto yy75;",
          "859:  goto yy18;",
          "860: yy50:",
          "863:  if (yych >= ':') goto yy18;",
          "864: yy51:",
          "865:  ++YYCURSOR;",
          "866:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "867:  yych = *YYCURSOR;",
          "868:  if (yych <= '/') goto yy18;",
          "869:  if (yych <= '9') goto yy51;",
          "870:  if (yych == ';') goto yy76;",
          "872: yy53:",
          "876: yy54:",
          "881:  if (yych <= '9') goto yy54;",
          "882:  if (yych <= ':') goto yy78;",
          "883:  goto yy18;",
          "884: yy56:",
          "886:  if (yych <= '/') goto yy18;",
          "887:  if (yych >= ':') goto yy18;",
          "888: yy57:",
          "890:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "891:  yych = *YYCURSOR;",
          "893:  if (yych <= '9') goto yy57;",
          "894:  if (yych == ';') goto yy79;",
          "896: yy59:",
          "900: yy60:",
          "905:  if (yych <= '9') goto yy60;",
          "906:  if (yych <= ':') goto yy81;",
          "907:  goto yy18;",
          "908: yy62:",
          "910:  if (yych == '\"') goto yy82;",
          "911:  goto yy18;",
          "912: yy63:",
          "914: #line 537 \"ext/standard/var_unserializer.re\"",
          "916:  long id;",
          "919:  if (!var_hash) return 0;",
          "921:  id = parse_iv(start + 2) - 1;",
          "922:  if (id == -1 || var_access(var_hash, id, &rval_ref) != SUCCESS) {",
          "926:  if (*rval != NULL) {",
          "927:   var_push_dtor_no_addref(var_hash, rval);",
          "930:  Z_ADDREF_PP(rval);",
          "931:  Z_SET_ISREF_PP(rval);",
          "935: #line 936 \"ext/standard/var_unserializer.c\"",
          "936: yy65:",
          "938:  if (yych == '\"') goto yy84;",
          "940: yy66:",
          "942:  if (yych == '{') goto yy86;",
          "944: yy67:",
          "946: #line 588 \"ext/standard/var_unserializer.re\"",
          "947:  {",
          "949:  INIT_PZVAL(*rval);",
          "950:  ZVAL_BOOL(*rval, parse_iv(start + 2));",
          "951:  return 1;",
          "952: }",
          "953: #line 954 \"ext/standard/var_unserializer.c\"",
          "954: yy69:",
          "960:   if (yych <= '9') goto yy69;",
          "965:    goto yy73;",
          "967:    if (yych == 'e') goto yy73;",
          "971: yy71:",
          "973: #line 637 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "572:  case 'O': goto yy13;",
          "574:  case 'R': goto yy2;",
          "575:  case 'S': goto yy10;",
          "576:  case 'a': goto yy11;",
          "577:  case 'b': goto yy6;",
          "578:  case 'd': goto yy8;",
          "579:  case 'i': goto yy7;",
          "581:  case 'r': goto yy4;",
          "582:  case 's': goto yy9;",
          "583:  case '}': goto yy14;",
          "584:  default: goto yy16;",
          "587:  yych = *(YYMARKER = ++YYCURSOR);",
          "588:  if (yych == ':') goto yy95;",
          "590: #line 908 \"ext/standard/var_unserializer.re\"",
          "595:  if (yych == ':') goto yy89;",
          "599:  if (yych == ';') goto yy87;",
          "603:  if (yych == ':') goto yy83;",
          "607:  if (yych == ':') goto yy77;",
          "611:  if (yych == ':') goto yy53;",
          "615:  if (yych == ':') goto yy46;",
          "619:  if (yych == ':') goto yy39;",
          "623:  if (yych == ':') goto yy32;",
          "627:  if (yych == ':') goto yy25;",
          "631:  if (yych == ':') goto yy17;",
          "635: #line 902 \"ext/standard/var_unserializer.re\"",
          "641: #line 642 \"ext/standard/var_unserializer.c\"",
          "642: yy16:",
          "643:  yych = *++YYCURSOR;",
          "644:  goto yy3;",
          "648:   goto yy20;",
          "650:  if (yych == '+') goto yy19;",
          "656:  if (yybm[0+yych] & 128) {",
          "657:   goto yy20;",
          "660: yy20:",
          "661:  ++YYCURSOR;",
          "662:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "663:  yych = *YYCURSOR;",
          "664:  if (yybm[0+yych] & 128) {",
          "665:   goto yy20;",
          "666:  }",
          "668:  if (yych >= ';') goto yy18;",
          "670:  if (yych != '\"') goto yy18;",
          "671:  ++YYCURSOR;",
          "672: #line 748 \"ext/standard/var_unserializer.re\"",
          "673:  {",
          "674:  size_t len, len2, len3, maxlen;",
          "675:  long elements;",
          "676:  char *class_name;",
          "677:  zend_class_entry *ce;",
          "678:  zend_class_entry **pce;",
          "679:  int incomplete_class = 0;",
          "681:  int custom_object = 0;",
          "683:  zval *user_func;",
          "684:  zval *retval_ptr;",
          "685:  zval **args[1];",
          "686:  zval *arg_func_name;",
          "688:     if (!var_hash) return 0;",
          "689:  if (*start == 'C') {",
          "690:   custom_object = 1;",
          "691:  }",
          "693:  INIT_PZVAL(*rval);",
          "694:  len2 = len = parse_uiv(start + 2);",
          "695:  maxlen = max - YYCURSOR;",
          "696:  if (maxlen < len || len == 0) {",
          "698:   return 0;",
          "699:  }",
          "701:  class_name = (char*)YYCURSOR;",
          "703:  YYCURSOR += len;",
          "705:  if (*(YYCURSOR) != '\"') {",
          "707:   return 0;",
          "708:  }",
          "709:  if (*(YYCURSOR+1) != ':') {",
          "711:   return 0;",
          "712:  }",
          "714:  len3 = strspn(class_name, \"0123456789_abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\\177\\200\\201\\202\\203\\204\\205\\206\\207\\210\\211\\212\\213\\214\\215\\216\\217\\220\\221\\222\\223\\224\\225\\226\\227\\230\\231\\232\\233\\234\\235\\236\\237\\240\\241\\242\\243\\244\\245\\246\\247\\250\\251\\252\\253\\254\\255\\256\\257\\260\\261\\262\\263\\264\\265\\266\\267\\270\\271\\272\\273\\274\\275\\276\\277\\300\\301\\302\\303\\304\\305\\306\\307\\310\\311\\312\\313\\314\\315\\316\\317\\320\\321\\322\\323\\324\\325\\326\\327\\330\\331\\332\\333\\334\\335\\336\\337\\340\\341\\342\\343\\344\\345\\346\\347\\350\\351\\352\\353\\354\\355\\356\\357\\360\\361\\362\\363\\364\\365\\366\\367\\370\\371\\372\\373\\374\\375\\376\\377\\\\\");",
          "715:  if (len3 != len)",
          "716:  {",
          "718:   return 0;",
          "719:  }",
          "721:  class_name = estrndup(class_name, len);",
          "723:  do {",
          "725:   BG(serialize_lock)++;",
          "726:   if (zend_lookup_class(class_name, len2, &pce TSRMLS_CC) == SUCCESS) {",
          "727:    BG(serialize_lock)--;",
          "728:    if (EG(exception)) {",
          "729:     efree(class_name);",
          "730:     return 0;",
          "731:    }",
          "732:    ce = *pce;",
          "733:    break;",
          "735:   BG(serialize_lock)--;",
          "737:   if (EG(exception)) {",
          "738:    efree(class_name);",
          "739:    return 0;",
          "740:   }",
          "743:   if ((PG(unserialize_callback_func) == NULL) || (PG(unserialize_callback_func)[0] == '\\0')) {",
          "744:    incomplete_class = 1;",
          "745:    ce = PHP_IC_ENTRY;",
          "746:    break;",
          "747:   }",
          "750:   MAKE_STD_ZVAL(user_func);",
          "751:   ZVAL_STRING(user_func, PG(unserialize_callback_func), 1);",
          "752:   args[0] = &arg_func_name;",
          "753:   MAKE_STD_ZVAL(arg_func_name);",
          "754:   ZVAL_STRING(arg_func_name, class_name, 1);",
          "755:   BG(serialize_lock)++;",
          "756:   if (call_user_function_ex(CG(function_table), NULL, user_func, &retval_ptr, 1, args, 0, NULL TSRMLS_CC) != SUCCESS) {",
          "757:    BG(serialize_lock)--;",
          "758:    if (EG(exception)) {",
          "759:     efree(class_name);",
          "760:     zval_ptr_dtor(&user_func);",
          "761:     zval_ptr_dtor(&arg_func_name);",
          "762:     return 0;",
          "763:    }",
          "764:    php_error_docref(NULL TSRMLS_CC, E_WARNING, \"defined (%s) but not found\", user_func->value.str.val);",
          "765:    incomplete_class = 1;",
          "766:    ce = PHP_IC_ENTRY;",
          "767:    zval_ptr_dtor(&user_func);",
          "768:    zval_ptr_dtor(&arg_func_name);",
          "769:    break;",
          "770:   }",
          "771:   BG(serialize_lock)--;",
          "772:   if (retval_ptr) {",
          "773:    zval_ptr_dtor(&retval_ptr);",
          "774:   }",
          "775:   if (EG(exception)) {",
          "776:    efree(class_name);",
          "777:    zval_ptr_dtor(&user_func);",
          "778:    zval_ptr_dtor(&arg_func_name);",
          "779:    return 0;",
          "780:   }",
          "783:   BG(serialize_lock)++;",
          "784:   if (zend_lookup_class(class_name, len2, &pce TSRMLS_CC) == SUCCESS) {",
          "785:    ce = *pce;",
          "787:    php_error_docref(NULL TSRMLS_CC, E_WARNING, \"Function %s() hasn't defined the class it was called for\", user_func->value.str.val);",
          "788:    incomplete_class = 1;",
          "789:    ce = PHP_IC_ENTRY;",
          "790:   }",
          "791:   BG(serialize_lock)--;",
          "793:   zval_ptr_dtor(&user_func);",
          "794:   zval_ptr_dtor(&arg_func_name);",
          "795:   break;",
          "796:  } while (1);",
          "800:  if (custom_object) {",
          "801:   int ret;",
          "803:   ret = object_custom(UNSERIALIZE_PASSTHRU, ce);",
          "805:   if (ret && incomplete_class) {",
          "806:    php_store_class_name(*rval, class_name, len2);",
          "808:   efree(class_name);",
          "809:   return ret;",
          "812:  elements = object_common1(UNSERIALIZE_PASSTHRU, ce);",
          "814:  if (elements < 0) {",
          "815:     efree(class_name);",
          "816:     return 0;",
          "819:  if (incomplete_class) {",
          "820:   php_store_class_name(*rval, class_name, len2);",
          "822:  efree(class_name);",
          "824:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "825: }",
          "826: #line 827 \"ext/standard/var_unserializer.c\"",
          "827: yy25:",
          "830:   if (yych != '+') goto yy18;",
          "832:   if (yych <= '-') goto yy26;",
          "834:   if (yych <= '9') goto yy27;",
          "837: yy26:",
          "840:  if (yych >= ':') goto yy18;",
          "841: yy27:",
          "846:  if (yych <= '9') goto yy27;",
          "847:  if (yych >= ';') goto yy18;",
          "849:  if (yych != '\"') goto yy18;",
          "851: #line 735 \"ext/standard/var_unserializer.re\"",
          "852:  {",
          "853:  long elements;",
          "854:     if (!var_hash) return 0;",
          "856:  INIT_PZVAL(*rval);",
          "858:  elements = object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR);",
          "859:  if (elements < 0) {",
          "860:   return 0;",
          "861:  }",
          "862:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "863: }",
          "864: #line 865 \"ext/standard/var_unserializer.c\"",
          "865: yy32:",
          "866:  yych = *++YYCURSOR;",
          "867:  if (yych == '+') goto yy33;",
          "871: yy33:",
          "875: yy34:",
          "880:  if (yych <= '9') goto yy34;",
          "881:  if (yych >= ';') goto yy18;",
          "883:  if (yych != '{') goto yy18;",
          "885: #line 714 \"ext/standard/var_unserializer.re\"",
          "886:  {",
          "887:  long elements = parse_iv(start + 2);",
          "890:     if (!var_hash) return 0;",
          "892:  if (elements < 0) {",
          "893:   return 0;",
          "896:  INIT_PZVAL(*rval);",
          "898:  array_init_size(*rval, elements);",
          "900:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_ARRVAL_PP(rval), elements, 0)) {",
          "901:   return 0;",
          "904:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "905: }",
          "906: #line 907 \"ext/standard/var_unserializer.c\"",
          "907: yy39:",
          "909:  if (yych == '+') goto yy40;",
          "911:  if (yych <= '9') goto yy41;",
          "913: yy40:",
          "917: yy41:",
          "922:  if (yych <= '9') goto yy41;",
          "923:  if (yych >= ';') goto yy18;",
          "925:  if (yych != '\"') goto yy18;",
          "927: #line 679 \"ext/standard/var_unserializer.re\"",
          "928:  {",
          "929:  size_t len, maxlen;",
          "930:  char *str;",
          "932:  len = parse_uiv(start + 2);",
          "933:  maxlen = max - YYCURSOR;",
          "934:  if (maxlen < len) {",
          "936:   return 0;",
          "937:  }",
          "939:  if ((str = unserialize_str(&YYCURSOR, &len, maxlen)) == NULL) {",
          "940:   return 0;",
          "941:  }",
          "943:  if (*(YYCURSOR) != '\"') {",
          "944:   efree(str);",
          "946:   return 0;",
          "947:  }",
          "949:  if (*(YYCURSOR + 1) != ';') {",
          "950:   efree(str);",
          "952:   return 0;",
          "953:  }",
          "955:  YYCURSOR += 2;",
          "958:  INIT_PZVAL(*rval);",
          "959:  ZVAL_STRINGL(*rval, str, len, 0);",
          "960:  return 1;",
          "961: }",
          "962: #line 963 \"ext/standard/var_unserializer.c\"",
          "963: yy46:",
          "964:  yych = *++YYCURSOR;",
          "965:  if (yych == '+') goto yy47;",
          "967:  if (yych <= '9') goto yy48;",
          "969: yy47:",
          "973: yy48:",
          "978:  if (yych <= '9') goto yy48;",
          "979:  if (yych >= ';') goto yy18;",
          "981:  if (yych != '\"') goto yy18;",
          "983: #line 646 \"ext/standard/var_unserializer.re\"",
          "985:  size_t len, maxlen;",
          "986:  char *str;",
          "988:  len = parse_uiv(start + 2);",
          "989:  maxlen = max - YYCURSOR;",
          "990:  if (maxlen < len) {",
          "992:   return 0;",
          "993:  }",
          "995:  str = (char*)YYCURSOR;",
          "997:  YYCURSOR += len;",
          "999:  if (*(YYCURSOR) != '\"') {",
          "1004:  if (*(YYCURSOR + 1) != ';') {",
          "1006:   return 0;",
          "1009:  YYCURSOR += 2;",
          "1012:  INIT_PZVAL(*rval);",
          "1013:  ZVAL_STRINGL(*rval, str, len, 1);",
          "1016: #line 1017 \"ext/standard/var_unserializer.c\"",
          "1017: yy53:",
          "1018:  yych = *++YYCURSOR;",
          "1019:  if (yych <= '/') {",
          "1020:   if (yych <= ',') {",
          "1021:    if (yych == '+') goto yy57;",
          "1022:    goto yy18;",
          "1023:   } else {",
          "1024:    if (yych <= '-') goto yy55;",
          "1025:    if (yych <= '.') goto yy60;",
          "1026:    goto yy18;",
          "1027:   }",
          "1028:  } else {",
          "1029:   if (yych <= 'I') {",
          "1030:    if (yych <= '9') goto yy58;",
          "1031:    if (yych <= 'H') goto yy18;",
          "1032:    goto yy56;",
          "1033:   } else {",
          "1034:    if (yych != 'N') goto yy18;",
          "1035:   }",
          "1036:  }",
          "1038:  if (yych == 'A') goto yy76;",
          "1040: yy55:",
          "1041:  yych = *++YYCURSOR;",
          "1042:  if (yych <= '/') {",
          "1043:   if (yych == '.') goto yy60;",
          "1044:   goto yy18;",
          "1045:  } else {",
          "1046:   if (yych <= '9') goto yy58;",
          "1047:   if (yych != 'I') goto yy18;",
          "1048:  }",
          "1049: yy56:",
          "1051:  if (yych == 'N') goto yy72;",
          "1053: yy57:",
          "1054:  yych = *++YYCURSOR;",
          "1055:  if (yych == '.') goto yy60;",
          "1056:  if (yych <= '/') goto yy18;",
          "1057:  if (yych >= ':') goto yy18;",
          "1058: yy58:",
          "1060:  if ((YYLIMIT - YYCURSOR) < 4) YYFILL(4);",
          "1061:  yych = *YYCURSOR;",
          "1062:  if (yych <= ':') {",
          "1063:   if (yych <= '.') {",
          "1064:    if (yych <= '-') goto yy18;",
          "1065:    goto yy70;",
          "1066:   } else {",
          "1067:    if (yych <= '/') goto yy18;",
          "1068:    if (yych <= '9') goto yy58;",
          "1069:    goto yy18;",
          "1070:   }",
          "1071:  } else {",
          "1072:   if (yych <= 'E') {",
          "1073:    if (yych <= ';') goto yy63;",
          "1074:    if (yych <= 'D') goto yy18;",
          "1075:    goto yy65;",
          "1076:   } else {",
          "1077:    if (yych == 'e') goto yy65;",
          "1078:    goto yy18;",
          "1079:   }",
          "1080:  }",
          "1081: yy60:",
          "1082:  yych = *++YYCURSOR;",
          "1083:  if (yych <= '/') goto yy18;",
          "1084:  if (yych >= ':') goto yy18;",
          "1085: yy61:",
          "1091:   if (yych <= '9') goto yy61;",
          "1096:    goto yy65;",
          "1098:    if (yych == 'e') goto yy65;",
          "1102: yy63:",
          "1104: #line 636 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "980:  ZVAL_DOUBLE(*rval, zend_strtod((const char *)start + 2, NULL));",
          "981:  return 1;",
          "982: }",
          "985:  yych = *++YYCURSOR;",
          "986:  if (yych <= ',') {",
          "989:  } else {",
          "991:   if (yych <= '/') goto yy18;",
          "993:   goto yy18;",
          "994:  }",
          "996:  yych = *++YYCURSOR;",
          "998:  goto yy18;",
          "1000:  yych = *++YYCURSOR;",
          "1002:  goto yy18;",
          "1004:  ++YYCURSOR;",
          "1022:   } else {",
          "1024:   }",
          "1025:  }",
          "1034:  yych = *++YYCURSOR;",
          "1038:  ++YYCURSOR;",
          "1040:  {",
          "1055:  }",
          "1060:  return 1;",
          "1061: }",
          "1064:  yych = *++YYCURSOR;",
          "1066:  goto yy18;",
          "1068:  ++YYCURSOR;",
          "1070:  {",
          "1116:  }",
          "1160:    }",
          "1183:   } else {",
          "1204:   }",
          "1218:  }",
          "1222: }",
          "1225:  ++YYCURSOR;",
          "1227:  {",
          "1257:  INIT_PZVAL(*rval);",
          "1259:  return 1;",
          "1260: }",
          "1263:  ++YYCURSOR;",
          "1265:  {",
          "1275:  INIT_PZVAL(*rval);",
          "1284: }",
          "1287:  yych = *++YYCURSOR;",
          "1288:  if (yych <= ',') {",
          "1291:  } else {",
          "1293:   if (yych <= '/') goto yy18;",
          "1295:  }",
          "1297:  ++YYCURSOR;",
          "1298:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "1299:  yych = *YYCURSOR;",
          "1300:  if (yych <= '/') goto yy18;",
          "1309:  ++YYCURSOR;",
          "1311:  {",
          "1335:   return 0;",
          "1336:  }",
          "1350:  }",
          "1357:  return 1;",
          "1358: }",
          "1360: yy96:",
          "1361:  yych = *++YYCURSOR;",
          "1362:  if (yych <= '/') goto yy18;",
          "1365: yy97:",
          "1366:  ++YYCURSOR;",
          "1368:  {",
          "1378:  }",
          "1380:  return 1;",
          "1381: }",
          "1383: }",
          "1387:  return 0;",
          "",
          "[Removed Lines]",
          "983: #line 984 \"ext/standard/var_unserializer.c\"",
          "984: yy73:",
          "987:   if (yych == '+') goto yy88;",
          "988:   goto yy18;",
          "990:   if (yych <= '-') goto yy88;",
          "992:   if (yych <= '9') goto yy89;",
          "995: yy74:",
          "997:  if (yych == 'F') goto yy91;",
          "999: yy75:",
          "1001:  if (yych == 'N') goto yy91;",
          "1003: yy76:",
          "1005: #line 595 \"ext/standard/var_unserializer.re\"",
          "1006:  {",
          "1007: #if SIZEOF_LONG == 4",
          "1008:  int digits = YYCURSOR - start - 3;",
          "1010:  if (start[2] == '-' || start[2] == '+') {",
          "1011:   digits--;",
          "1012:  }",
          "1015:  if (digits >= MAX_LENGTH_OF_LONG - 1) {",
          "1016:   if (digits == MAX_LENGTH_OF_LONG - 1) {",
          "1017:    int cmp = strncmp(YYCURSOR - MAX_LENGTH_OF_LONG, long_min_digits, MAX_LENGTH_OF_LONG - 1);",
          "1019:    if (!(cmp < 0 || (cmp == 0 && start[2] == '-'))) {",
          "1020:     goto use_double;",
          "1021:    }",
          "1023:    goto use_double;",
          "1026: #endif",
          "1028:  INIT_PZVAL(*rval);",
          "1029:  ZVAL_LONG(*rval, parse_iv(start + 2));",
          "1030:  return 1;",
          "1031: }",
          "1032: #line 1033 \"ext/standard/var_unserializer.c\"",
          "1033: yy78:",
          "1035:  if (yych == '\"') goto yy92;",
          "1036:  goto yy18;",
          "1037: yy79:",
          "1039: #line 558 \"ext/standard/var_unserializer.re\"",
          "1041:  long id;",
          "1044:  if (!var_hash) return 0;",
          "1046:  id = parse_iv(start + 2) - 1;",
          "1047:  if (id == -1 || var_access(var_hash, id, &rval_ref) != SUCCESS) {",
          "1048:   return 0;",
          "1049:  }",
          "1051:  if (*rval == *rval_ref) return 0;",
          "1053:  if (*rval != NULL) {",
          "1054:   var_push_dtor_no_addref(var_hash, rval);",
          "1057:  Z_ADDREF_PP(rval);",
          "1058:  Z_UNSET_ISREF_PP(rval);",
          "1062: #line 1063 \"ext/standard/var_unserializer.c\"",
          "1063: yy81:",
          "1065:  if (yych == '\"') goto yy94;",
          "1067: yy82:",
          "1069: #line 749 \"ext/standard/var_unserializer.re\"",
          "1071:  size_t len, len2, len3, maxlen;",
          "1072:  long elements;",
          "1073:  char *class_name;",
          "1074:  zend_class_entry *ce;",
          "1075:  zend_class_entry **pce;",
          "1076:  int incomplete_class = 0;",
          "1078:  int custom_object = 0;",
          "1080:  zval *user_func;",
          "1081:  zval *retval_ptr;",
          "1082:  zval **args[1];",
          "1083:  zval *arg_func_name;",
          "1085:     if (!var_hash) return 0;",
          "1086:  if (*start == 'C') {",
          "1087:   custom_object = 1;",
          "1088:  }",
          "1090:  INIT_PZVAL(*rval);",
          "1091:  len2 = len = parse_uiv(start + 2);",
          "1092:  maxlen = max - YYCURSOR;",
          "1093:  if (maxlen < len || len == 0) {",
          "1095:   return 0;",
          "1096:  }",
          "1098:  class_name = (char*)YYCURSOR;",
          "1100:  YYCURSOR += len;",
          "1102:  if (*(YYCURSOR) != '\"') {",
          "1104:   return 0;",
          "1105:  }",
          "1106:  if (*(YYCURSOR+1) != ':') {",
          "1108:   return 0;",
          "1109:  }",
          "1111:  len3 = strspn(class_name, \"0123456789_abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\\177\\200\\201\\202\\203\\204\\205\\206\\207\\210\\211\\212\\213\\214\\215\\216\\217\\220\\221\\222\\223\\224\\225\\226\\227\\230\\231\\232\\233\\234\\235\\236\\237\\240\\241\\242\\243\\244\\245\\246\\247\\250\\251\\252\\253\\254\\255\\256\\257\\260\\261\\262\\263\\264\\265\\266\\267\\270\\271\\272\\273\\274\\275\\276\\277\\300\\301\\302\\303\\304\\305\\306\\307\\310\\311\\312\\313\\314\\315\\316\\317\\320\\321\\322\\323\\324\\325\\326\\327\\330\\331\\332\\333\\334\\335\\336\\337\\340\\341\\342\\343\\344\\345\\346\\347\\350\\351\\352\\353\\354\\355\\356\\357\\360\\361\\362\\363\\364\\365\\366\\367\\370\\371\\372\\373\\374\\375\\376\\377\\\\\");",
          "1112:  if (len3 != len)",
          "1113:  {",
          "1115:   return 0;",
          "1118:  class_name = estrndup(class_name, len);",
          "1120:  do {",
          "1122:   BG(serialize_lock)++;",
          "1123:   if (zend_lookup_class(class_name, len2, &pce TSRMLS_CC) == SUCCESS) {",
          "1124:    BG(serialize_lock)--;",
          "1125:    if (EG(exception)) {",
          "1126:     efree(class_name);",
          "1127:     return 0;",
          "1128:    }",
          "1129:    ce = *pce;",
          "1130:    break;",
          "1131:   }",
          "1132:   BG(serialize_lock)--;",
          "1134:   if (EG(exception)) {",
          "1135:    efree(class_name);",
          "1136:    return 0;",
          "1137:   }",
          "1140:   if ((PG(unserialize_callback_func) == NULL) || (PG(unserialize_callback_func)[0] == '\\0')) {",
          "1141:    incomplete_class = 1;",
          "1142:    ce = PHP_IC_ENTRY;",
          "1143:    break;",
          "1144:   }",
          "1147:   MAKE_STD_ZVAL(user_func);",
          "1148:   ZVAL_STRING(user_func, PG(unserialize_callback_func), 1);",
          "1149:   args[0] = &arg_func_name;",
          "1150:   MAKE_STD_ZVAL(arg_func_name);",
          "1151:   ZVAL_STRING(arg_func_name, class_name, 1);",
          "1152:   BG(serialize_lock)++;",
          "1153:   if (call_user_function_ex(CG(function_table), NULL, user_func, &retval_ptr, 1, args, 0, NULL TSRMLS_CC) != SUCCESS) {",
          "1154:    BG(serialize_lock)--;",
          "1155:    if (EG(exception)) {",
          "1156:     efree(class_name);",
          "1157:     zval_ptr_dtor(&user_func);",
          "1158:     zval_ptr_dtor(&arg_func_name);",
          "1159:     return 0;",
          "1161:    php_error_docref(NULL TSRMLS_CC, E_WARNING, \"defined (%s) but not found\", user_func->value.str.val);",
          "1162:    incomplete_class = 1;",
          "1163:    ce = PHP_IC_ENTRY;",
          "1164:    zval_ptr_dtor(&user_func);",
          "1165:    zval_ptr_dtor(&arg_func_name);",
          "1166:    break;",
          "1167:   }",
          "1168:   BG(serialize_lock)--;",
          "1169:   if (retval_ptr) {",
          "1170:    zval_ptr_dtor(&retval_ptr);",
          "1171:   }",
          "1172:   if (EG(exception)) {",
          "1173:    efree(class_name);",
          "1174:    zval_ptr_dtor(&user_func);",
          "1175:    zval_ptr_dtor(&arg_func_name);",
          "1176:    return 0;",
          "1177:   }",
          "1180:   BG(serialize_lock)++;",
          "1181:   if (zend_lookup_class(class_name, len2, &pce TSRMLS_CC) == SUCCESS) {",
          "1182:    ce = *pce;",
          "1184:    php_error_docref(NULL TSRMLS_CC, E_WARNING, \"Function %s() hasn't defined the class it was called for\", user_func->value.str.val);",
          "1185:    incomplete_class = 1;",
          "1186:    ce = PHP_IC_ENTRY;",
          "1187:   }",
          "1188:   BG(serialize_lock)--;",
          "1190:   zval_ptr_dtor(&user_func);",
          "1191:   zval_ptr_dtor(&arg_func_name);",
          "1192:   break;",
          "1193:  } while (1);",
          "1197:  if (custom_object) {",
          "1198:   int ret;",
          "1200:   ret = object_custom(UNSERIALIZE_PASSTHRU, ce);",
          "1202:   if (ret && incomplete_class) {",
          "1203:    php_store_class_name(*rval, class_name, len2);",
          "1205:   efree(class_name);",
          "1206:   return ret;",
          "1207:  }",
          "1209:  elements = object_common1(UNSERIALIZE_PASSTHRU, ce);",
          "1211:  if (elements < 0) {",
          "1212:     efree(class_name);",
          "1213:     return 0;",
          "1214:  }",
          "1216:  if (incomplete_class) {",
          "1217:   php_store_class_name(*rval, class_name, len2);",
          "1219:  efree(class_name);",
          "1221:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "1223: #line 1224 \"ext/standard/var_unserializer.c\"",
          "1224: yy84:",
          "1226: #line 680 \"ext/standard/var_unserializer.re\"",
          "1228:  size_t len, maxlen;",
          "1229:  char *str;",
          "1231:  len = parse_uiv(start + 2);",
          "1232:  maxlen = max - YYCURSOR;",
          "1233:  if (maxlen < len) {",
          "1235:   return 0;",
          "1236:  }",
          "1238:  if ((str = unserialize_str(&YYCURSOR, &len, maxlen)) == NULL) {",
          "1239:   return 0;",
          "1240:  }",
          "1242:  if (*(YYCURSOR) != '\"') {",
          "1243:   efree(str);",
          "1245:   return 0;",
          "1246:  }",
          "1248:  if (*(YYCURSOR + 1) != ';') {",
          "1249:   efree(str);",
          "1251:   return 0;",
          "1252:  }",
          "1254:  YYCURSOR += 2;",
          "1258:  ZVAL_STRINGL(*rval, str, len, 0);",
          "1261: #line 1262 \"ext/standard/var_unserializer.c\"",
          "1262: yy86:",
          "1264: #line 715 \"ext/standard/var_unserializer.re\"",
          "1266:  long elements = parse_iv(start + 2);",
          "1269:     if (!var_hash) return 0;",
          "1271:  if (elements < 0) {",
          "1272:   return 0;",
          "1273:  }",
          "1277:  array_init_size(*rval, elements);",
          "1279:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_ARRVAL_PP(rval), elements, 0)) {",
          "1280:   return 0;",
          "1281:  }",
          "1283:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "1285: #line 1286 \"ext/standard/var_unserializer.c\"",
          "1286: yy88:",
          "1289:   if (yych == '+') goto yy96;",
          "1290:   goto yy18;",
          "1292:   if (yych <= '-') goto yy96;",
          "1294:   if (yych >= ':') goto yy18;",
          "1296: yy89:",
          "1301:  if (yych <= '9') goto yy89;",
          "1302:  if (yych == ';') goto yy71;",
          "1303:  goto yy18;",
          "1304: yy91:",
          "1305:  yych = *++YYCURSOR;",
          "1306:  if (yych == ';') goto yy97;",
          "1307:  goto yy18;",
          "1308: yy92:",
          "1310: #line 736 \"ext/standard/var_unserializer.re\"",
          "1312:  long elements;",
          "1313:     if (!var_hash) return 0;",
          "1315:  INIT_PZVAL(*rval);",
          "1317:  elements = object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR);",
          "1318:  if (elements < 0) {",
          "1319:   return 0;",
          "1320:  }",
          "1321:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "1322: }",
          "1323: #line 1324 \"ext/standard/var_unserializer.c\"",
          "1324: yy94:",
          "1325:  ++YYCURSOR;",
          "1326: #line 647 \"ext/standard/var_unserializer.re\"",
          "1327:  {",
          "1328:  size_t len, maxlen;",
          "1329:  char *str;",
          "1331:  len = parse_uiv(start + 2);",
          "1332:  maxlen = max - YYCURSOR;",
          "1333:  if (maxlen < len) {",
          "1338:  str = (char*)YYCURSOR;",
          "1340:  YYCURSOR += len;",
          "1342:  if (*(YYCURSOR) != '\"') {",
          "1344:   return 0;",
          "1345:  }",
          "1347:  if (*(YYCURSOR + 1) != ';') {",
          "1349:   return 0;",
          "1352:  YYCURSOR += 2;",
          "1355:  INIT_PZVAL(*rval);",
          "1356:  ZVAL_STRINGL(*rval, str, len, 1);",
          "1359: #line 1360 \"ext/standard/var_unserializer.c\"",
          "1363:  if (yych <= '9') goto yy89;",
          "1364:  goto yy18;",
          "1367: #line 622 \"ext/standard/var_unserializer.re\"",
          "1370:  INIT_PZVAL(*rval);",
          "1372:  if (!strncmp(start + 2, \"NAN\", 3)) {",
          "1373:   ZVAL_DOUBLE(*rval, php_get_nan());",
          "1374:  } else if (!strncmp(start + 2, \"INF\", 3)) {",
          "1375:   ZVAL_DOUBLE(*rval, php_get_inf());",
          "1376:  } else if (!strncmp(start + 2, \"-INF\", 4)) {",
          "1377:   ZVAL_DOUBLE(*rval, -php_get_inf());",
          "1382: #line 1383 \"ext/standard/var_unserializer.c\"",
          "1384: #line 911 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1114: #line 1115 \"ext/standard/var_unserializer.c\"",
          "1115: yy65:",
          "1118:   if (yych != '+') goto yy18;",
          "1120:   if (yych <= '-') goto yy66;",
          "1122:   if (yych <= '9') goto yy67;",
          "1125: yy66:",
          "1127:  if (yych <= ',') {",
          "1128:   if (yych == '+') goto yy69;",
          "1129:   goto yy18;",
          "1130:  } else {",
          "1131:   if (yych <= '-') goto yy69;",
          "1132:   if (yych <= '/') goto yy18;",
          "1133:   if (yych >= ':') goto yy18;",
          "1134:  }",
          "1135: yy67:",
          "1136:  ++YYCURSOR;",
          "1137:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "1138:  yych = *YYCURSOR;",
          "1139:  if (yych <= '/') goto yy18;",
          "1140:  if (yych <= '9') goto yy67;",
          "1141:  if (yych == ';') goto yy63;",
          "1143: yy69:",
          "1145:  if (yych <= '/') goto yy18;",
          "1146:  if (yych <= '9') goto yy67;",
          "1148: yy70:",
          "1150:  if ((YYLIMIT - YYCURSOR) < 4) YYFILL(4);",
          "1151:  yych = *YYCURSOR;",
          "1152:  if (yych <= ';') {",
          "1153:   if (yych <= '/') goto yy18;",
          "1154:   if (yych <= '9') goto yy70;",
          "1155:   if (yych <= ':') goto yy18;",
          "1156:   goto yy63;",
          "1157:  } else {",
          "1158:   if (yych <= 'E') {",
          "1159:    if (yych <= 'D') goto yy18;",
          "1160:    goto yy65;",
          "1162:    if (yych == 'e') goto yy65;",
          "1163:    goto yy18;",
          "1166: yy72:",
          "1168:  if (yych != 'F') goto yy18;",
          "1169: yy73:",
          "1170:  yych = *++YYCURSOR;",
          "1171:  if (yych != ';') goto yy18;",
          "1173: #line 621 \"ext/standard/var_unserializer.re\"",
          "1176:  INIT_PZVAL(*rval);",
          "1178:  if (!strncmp(start + 2, \"NAN\", 3)) {",
          "1179:   ZVAL_DOUBLE(*rval, php_get_nan());",
          "1180:  } else if (!strncmp(start + 2, \"INF\", 3)) {",
          "1181:   ZVAL_DOUBLE(*rval, php_get_inf());",
          "1182:  } else if (!strncmp(start + 2, \"-INF\", 4)) {",
          "1183:   ZVAL_DOUBLE(*rval, -php_get_inf());",
          "1188: #line 1189 \"ext/standard/var_unserializer.c\"",
          "1189: yy76:",
          "1191:  if (yych == 'N') goto yy73;",
          "1193: yy77:",
          "1194:  yych = *++YYCURSOR;",
          "1195:  if (yych <= ',') {",
          "1196:   if (yych != '+') goto yy18;",
          "1197:  } else {",
          "1198:   if (yych <= '-') goto yy78;",
          "1199:   if (yych <= '/') goto yy18;",
          "1200:   if (yych <= '9') goto yy79;",
          "1201:   goto yy18;",
          "1202:  }",
          "1203: yy78:",
          "1204:  yych = *++YYCURSOR;",
          "1205:  if (yych <= '/') goto yy18;",
          "1206:  if (yych >= ':') goto yy18;",
          "1207: yy79:",
          "1209:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "1210:  yych = *YYCURSOR;",
          "1211:  if (yych <= '/') goto yy18;",
          "1212:  if (yych <= '9') goto yy79;",
          "1213:  if (yych != ';') goto yy18;",
          "1214:  ++YYCURSOR;",
          "1215: #line 594 \"ext/standard/var_unserializer.re\"",
          "1217: #if SIZEOF_LONG == 4",
          "1218:  int digits = YYCURSOR - start - 3;",
          "1220:  if (start[2] == '-' || start[2] == '+') {",
          "1221:   digits--;",
          "1225:  if (digits >= MAX_LENGTH_OF_LONG - 1) {",
          "1226:   if (digits == MAX_LENGTH_OF_LONG - 1) {",
          "1227:    int cmp = strncmp(YYCURSOR - MAX_LENGTH_OF_LONG, long_min_digits, MAX_LENGTH_OF_LONG - 1);",
          "1229:    if (!(cmp < 0 || (cmp == 0 && start[2] == '-'))) {",
          "1230:     goto use_double;",
          "1233:    goto use_double;",
          "1236: #endif",
          "1238:  INIT_PZVAL(*rval);",
          "1239:  ZVAL_LONG(*rval, parse_iv(start + 2));",
          "1240:  return 1;",
          "1242: #line 1243 \"ext/standard/var_unserializer.c\"",
          "1243: yy83:",
          "1244:  yych = *++YYCURSOR;",
          "1245:  if (yych <= '/') goto yy18;",
          "1246:  if (yych >= '2') goto yy18;",
          "1247:  yych = *++YYCURSOR;",
          "1248:  if (yych != ';') goto yy18;",
          "1250: #line 587 \"ext/standard/var_unserializer.re\"",
          "1254:  ZVAL_BOOL(*rval, parse_iv(start + 2));",
          "1257: #line 1258 \"ext/standard/var_unserializer.c\"",
          "1258: yy87:",
          "1260: #line 580 \"ext/standard/var_unserializer.re\"",
          "1264:  ZVAL_NULL(*rval);",
          "1265:  return 1;",
          "1267: #line 1268 \"ext/standard/var_unserializer.c\"",
          "1268: yy89:",
          "1271:   if (yych != '+') goto yy18;",
          "1273:   if (yych <= '-') goto yy90;",
          "1275:   if (yych <= '9') goto yy91;",
          "1276:   goto yy18;",
          "1278: yy90:",
          "1279:  yych = *++YYCURSOR;",
          "1280:  if (yych <= '/') goto yy18;",
          "1281:  if (yych >= ':') goto yy18;",
          "1282: yy91:",
          "1287:  if (yych <= '9') goto yy91;",
          "1288:  if (yych != ';') goto yy18;",
          "1290: #line 557 \"ext/standard/var_unserializer.re\"",
          "1292:  long id;",
          "1295:  if (!var_hash) return 0;",
          "1297:  id = parse_iv(start + 2) - 1;",
          "1298:  if (id == -1 || var_access(var_hash, id, &rval_ref) != SUCCESS) {",
          "1302:  if (*rval == *rval_ref) return 0;",
          "1304:  if (*rval != NULL) {",
          "1305:   var_push_dtor_no_addref(var_hash, rval);",
          "1308:  Z_ADDREF_PP(rval);",
          "1309:  Z_UNSET_ISREF_PP(rval);",
          "1313: #line 1314 \"ext/standard/var_unserializer.c\"",
          "1314: yy95:",
          "1315:  yych = *++YYCURSOR;",
          "1316:  if (yych <= ',') {",
          "1317:   if (yych != '+') goto yy18;",
          "1318:  } else {",
          "1319:   if (yych <= '-') goto yy96;",
          "1320:   if (yych <= '/') goto yy18;",
          "1321:   if (yych <= '9') goto yy97;",
          "1322:   goto yy18;",
          "1323:  }",
          "1327:  if (yych >= ':') goto yy18;",
          "1330:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "1331:  yych = *YYCURSOR;",
          "1332:  if (yych <= '/') goto yy18;",
          "1333:  if (yych <= '9') goto yy97;",
          "1334:  if (yych != ';') goto yy18;",
          "1335:  ++YYCURSOR;",
          "1336: #line 536 \"ext/standard/var_unserializer.re\"",
          "1338:  long id;",
          "1341:  if (!var_hash) return 0;",
          "1343:  id = parse_iv(start + 2) - 1;",
          "1344:  if (id == -1 || var_access(var_hash, id, &rval_ref) != SUCCESS) {",
          "1345:   return 0;",
          "1346:  }",
          "1348:  if (*rval != NULL) {",
          "1349:   var_push_dtor_no_addref(var_hash, rval);",
          "1352:  Z_ADDREF_PP(rval);",
          "1353:  Z_SET_ISREF_PP(rval);",
          "1357: #line 1358 \"ext/standard/var_unserializer.c\"",
          "1359: #line 910 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "411: static inline int finish_nested_data(UNSERIALIZE_PARAMETER)",
          "412: {",
          "420: }",
          "422: static inline int object_custom(UNSERIALIZE_PARAMETER, zend_class_entry *ce)",
          "",
          "[Removed Lines]",
          "413:  if (*((*p)++) == '}')",
          "414:   return 1;",
          "416: #if SOMETHING_NEW_MIGHT_LEAD_TO_CRASH_ENABLE_IF_YOU_ARE_BRAVE",
          "417:  zval_ptr_dtor(rval);",
          "418: #endif",
          "419:  return 0;",
          "",
          "[Added Lines]",
          "413:  if (*p >= max || **p != '}') {",
          "414:   return 0;",
          "415:  }",
          "417:  (*p)++;",
          "418:  return 1;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "61ba5f84774938617f78d65c06e5933cff2d8af3",
      "candidate_info": {
        "commit_hash": "61ba5f84774938617f78d65c06e5933cff2d8af3",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/61ba5f84774938617f78d65c06e5933cff2d8af3",
        "files": [
          "ext/standard/tests/serialize/bug25378.phpt",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Fixed bug #74111",
        "before_after_code_files": [
          "ext/standard/tests/serialize/bug25378.phpt||ext/standard/tests/serialize/bug25378.phpt",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/tests/serialize/bug25378.phpt||ext/standard/tests/serialize/bug25378.phpt": [
          "File: ext/standard/tests/serialize/bug25378.phpt -> ext/standard/tests/serialize/bug25378.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "42: Notice: unserialize(): Error at offset 17 of 33 bytes in %sbug25378.php on line %d",
          "43: bool(false)",
          "46: bool(false)",
          "48: Notice: unserialize(): Error at offset 2 of 13 bytes in %sbug25378.php on line %d",
          "",
          "[Removed Lines]",
          "45: Notice: unserialize(): Error at offset 33 of 32 bytes in %sbug25378.php on line %d",
          "",
          "[Added Lines]",
          "45: Notice: unserialize(): Error at offset 32 of 32 bytes in %sbug25378.php on line %d",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "474: static inline int finish_nested_data(UNSERIALIZE_PARAMETER)",
          "475: {",
          "483: }",
          "485: static inline int object_custom(UNSERIALIZE_PARAMETER, zend_class_entry *ce)",
          "",
          "[Removed Lines]",
          "476:  if (*((*p)++) == '}')",
          "477:   return 1;",
          "479: #if SOMETHING_NEW_MIGHT_LEAD_TO_CRASH_ENABLE_IF_YOU_ARE_BRAVE",
          "480:  zval_ptr_dtor(rval);",
          "481: #endif",
          "482:  return 0;",
          "",
          "[Added Lines]",
          "476:  if (*p >= max || **p != '}') {",
          "477:   return 0;",
          "478:  }",
          "480:  (*p)++;",
          "481:  return 1;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "621:  start = cursor;",
          "625: {",
          "626:  YYCTYPE yych;",
          "627:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "624: #line 625 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "623: #line 624 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "679: yy2:",
          "680:  ++YYCURSOR;",
          "681: yy3:",
          "683:  { return 0; }",
          "685: yy4:",
          "686:  yych = *(YYMARKER = ++YYCURSOR);",
          "687:  if (yych == ':') goto yy17;",
          "",
          "[Removed Lines]",
          "682: #line 1002 \"ext/standard/var_unserializer.re\"",
          "684: #line 685 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "681: #line 1001 \"ext/standard/var_unserializer.re\"",
          "683: #line 684 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "728:  goto yy3;",
          "729: yy15:",
          "730:  ++YYCURSOR;",
          "732:  {",
          "734:  php_error_docref(NULL, E_NOTICE, \"Unexpected end of serialized data\");",
          "736: }",
          "738: yy17:",
          "739:  yych = *++YYCURSOR;",
          "740:  if (yybm[0+yych] & 128) {",
          "",
          "[Removed Lines]",
          "731: #line 996 \"ext/standard/var_unserializer.re\"",
          "737: #line 738 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "730: #line 995 \"ext/standard/var_unserializer.re\"",
          "736: #line 737 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "746:  goto yy3;",
          "747: yy19:",
          "748:  ++YYCURSOR;",
          "750:  {",
          "752:  ZVAL_NULL(rval);",
          "753:  return 1;",
          "754: }",
          "756: yy21:",
          "757:  yych = *++YYCURSOR;",
          "758:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "749: #line 680 \"ext/standard/var_unserializer.re\"",
          "755: #line 756 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "748: #line 679 \"ext/standard/var_unserializer.re\"",
          "754: #line 755 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "1002:  goto yy18;",
          "1003: yy63:",
          "1004:  ++YYCURSOR;",
          "1006:  {",
          "1007:  zend_long id;",
          "",
          "[Removed Lines]",
          "1005: #line 629 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1004: #line 628 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "1029:  return 1;",
          "1030: }",
          "1032: yy65:",
          "1033:  yych = *++YYCURSOR;",
          "1034:  if (yych == '\"') goto yy84;",
          "",
          "[Removed Lines]",
          "1031: #line 1032 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1030: #line 1031 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "1039:  goto yy18;",
          "1040: yy67:",
          "1041:  ++YYCURSOR;",
          "1043:  {",
          "1045:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1046:  return 1;",
          "1047: }",
          "1049: yy69:",
          "1050:  ++YYCURSOR;",
          "1051:  if ((YYLIMIT - YYCURSOR) < 4) YYFILL(4);",
          "",
          "[Removed Lines]",
          "1042: #line 686 \"ext/standard/var_unserializer.re\"",
          "1048: #line 1049 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1041: #line 685 \"ext/standard/var_unserializer.re\"",
          "1047: #line 1048 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "1065:  }",
          "1066: yy71:",
          "1067:  ++YYCURSOR;",
          "1069:  {",
          "1070: #if SIZEOF_ZEND_LONG == 4",
          "1071: use_double:",
          "",
          "[Removed Lines]",
          "1068: #line 734 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1067: #line 733 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "1074:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1075:  return 1;",
          "1076: }",
          "1078: yy73:",
          "1079:  yych = *++YYCURSOR;",
          "1080:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1077: #line 1078 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1076: #line 1077 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "1096:  goto yy18;",
          "1097: yy76:",
          "1098:  ++YYCURSOR;",
          "1100:  {",
          "1101: #if SIZEOF_ZEND_LONG == 4",
          "1102:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1099: #line 692 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1098: #line 691 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "1122:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1123:  return 1;",
          "1124: }",
          "1126: yy78:",
          "1127:  yych = *++YYCURSOR;",
          "1128:  if (yych == '\"') goto yy92;",
          "1129:  goto yy18;",
          "1130: yy79:",
          "1131:  ++YYCURSOR;",
          "1133:  {",
          "1134:  zend_long id;",
          "",
          "[Removed Lines]",
          "1125: #line 1126 \"ext/standard/var_unserializer.c\"",
          "1132: #line 655 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1124: #line 1125 \"ext/standard/var_unserializer.c\"",
          "1131: #line 654 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "1155:  return 1;",
          "1156: }",
          "1158: yy81:",
          "1159:  yych = *++YYCURSOR;",
          "1160:  if (yych == '\"') goto yy94;",
          "1161:  goto yy18;",
          "1162: yy82:",
          "1163:  ++YYCURSOR;",
          "1165:  {",
          "1166:  size_t len, len2, len3, maxlen;",
          "1167:  zend_long elements;",
          "",
          "[Removed Lines]",
          "1157: #line 1158 \"ext/standard/var_unserializer.c\"",
          "1164: #line 844 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1156: #line 1157 \"ext/standard/var_unserializer.c\"",
          "1163: #line 843 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "1314:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "1315: }",
          "1317: yy84:",
          "1318:  ++YYCURSOR;",
          "1320:  {",
          "1321:  size_t len, maxlen;",
          "1322:  zend_string *str;",
          "",
          "[Removed Lines]",
          "1316: #line 1317 \"ext/standard/var_unserializer.c\"",
          "1319: #line 775 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1315: #line 1316 \"ext/standard/var_unserializer.c\"",
          "1318: #line 774 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1350:  ZVAL_STR(rval, str);",
          "1351:  return 1;",
          "1352: }",
          "1354: yy86:",
          "1355:  ++YYCURSOR;",
          "1357:  {",
          "1358:  zend_long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "1353: #line 1354 \"ext/standard/var_unserializer.c\"",
          "1356: #line 809 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1352: #line 1353 \"ext/standard/var_unserializer.c\"",
          "1355: #line 808 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1378:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "1379: }",
          "1381: yy88:",
          "1382:  yych = *++YYCURSOR;",
          "1383:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1380: #line 1381 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1379: #line 1380 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1402:  goto yy18;",
          "1403: yy92:",
          "1404:  ++YYCURSOR;",
          "1406:  {",
          "1407:  zend_long elements;",
          "1408:     if (!var_hash) return 0;",
          "",
          "[Removed Lines]",
          "1405: #line 833 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1404: #line 832 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "1413:  }",
          "1414:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "1415: }",
          "1417: yy94:",
          "1418:  ++YYCURSOR;",
          "1420:  {",
          "1421:  size_t len, maxlen;",
          "1422:  char *str;",
          "",
          "[Removed Lines]",
          "1416: #line 1417 \"ext/standard/var_unserializer.c\"",
          "1419: #line 743 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1415: #line 1416 \"ext/standard/var_unserializer.c\"",
          "1418: #line 742 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1448:  ZVAL_STRINGL(rval, str, len);",
          "1449:  return 1;",
          "1450: }",
          "1452: yy96:",
          "1453:  yych = *++YYCURSOR;",
          "1454:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1451: #line 1452 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1450: #line 1451 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1456:  goto yy18;",
          "1457: yy97:",
          "1458:  ++YYCURSOR;",
          "1460:  {",
          "",
          "[Removed Lines]",
          "1459: #line 718 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1458: #line 717 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "1473:  return 1;",
          "1474: }",
          "1476: }",
          "1480:  return 0;",
          "",
          "[Removed Lines]",
          "1475: #line 1476 \"ext/standard/var_unserializer.c\"",
          "1477: #line 1004 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1474: #line 1475 \"ext/standard/var_unserializer.c\"",
          "1476: #line 1003 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "478: static inline int finish_nested_data(UNSERIALIZE_PARAMETER)",
          "479: {",
          "487: }",
          "489: static inline int object_custom(UNSERIALIZE_PARAMETER, zend_class_entry *ce)",
          "",
          "[Removed Lines]",
          "480:  if (*((*p)++) == '}')",
          "481:   return 1;",
          "483: #if SOMETHING_NEW_MIGHT_LEAD_TO_CRASH_ENABLE_IF_YOU_ARE_BRAVE",
          "484:  zval_ptr_dtor(rval);",
          "485: #endif",
          "486:  return 0;",
          "",
          "[Added Lines]",
          "480:  if (*p >= max || **p != '}') {",
          "481:   return 0;",
          "482:  }",
          "484:  (*p)++;",
          "485:  return 1;",
          "",
          "---------------"
        ]
      }
    }
  ]
}