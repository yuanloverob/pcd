{
  "cve_id": "CVE-2019-9214",
  "cve_desc": "In Wireshark 2.4.0 to 2.4.12 and 2.6.0 to 2.6.6, the RPCAP dissector could crash. This was addressed in epan/dissectors/packet-rpcap.c by avoiding an attempted dereference of a NULL conversation.",
  "repo": "wireshark/wireshark",
  "patch_hash": "2f048c932d0c063bd53651d0fd8f31a66eede741",
  "patch_info": {
    "commit_hash": "2f048c932d0c063bd53651d0fd8f31a66eede741",
    "repo": "wireshark/wireshark",
    "commit_url": "https://github.com/wireshark/wireshark/commit/2f048c932d0c063bd53651d0fd8f31a66eede741",
    "files": [
      "epan/dissectors/packet-rpcap.c"
    ],
    "message": "rpcap: check conversation existence before dereferencing it.\n\nBug: 15536\nChange-Id: I370b7f4b3f647243490cbfadc120f0198c62b09b\nReviewed-on: https://code.wireshark.org/review/32232\nPetri-Dish: Dario Lombardo <lomato@gmail.com>\nTested-by: Petri Dish Buildbot\nReviewed-by: Anders Broman <a.broman58@gmail.com>",
    "before_after_code_files": [
      "epan/dissectors/packet-rpcap.c||epan/dissectors/packet-rpcap.c"
    ]
  },
  "patch_diff": {
    "epan/dissectors/packet-rpcap.c||epan/dissectors/packet-rpcap.c": [
      "File: epan/dissectors/packet-rpcap.c -> epan/dissectors/packet-rpcap.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1143:     conversation_t *conversation = find_conversation_pinfo (pinfo, 0);",
      "1145:                                                   pinfo->num,",
      "1146:                                                   rpcap_tcp_handle);",
      "1147:     tcp_dissect_pdus (tvb, pinfo, tree, rpcap_desegment, 8,",
      "",
      "[Removed Lines]",
      "1144:     conversation_set_dissector_from_frame_number (conversation,",
      "",
      "[Added Lines]",
      "1144:     if (conversation)",
      "1145:       conversation_set_dissector_from_frame_number (conversation,",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "c32d343ff47941e7e7714d36b36f311a92b14350",
      "candidate_info": {
        "commit_hash": "c32d343ff47941e7e7714d36b36f311a92b14350",
        "repo": "wireshark/wireshark",
        "commit_url": "https://github.com/wireshark/wireshark/commit/c32d343ff47941e7e7714d36b36f311a92b14350",
        "files": [
          "epan/dissectors/packet-rpcap.c"
        ],
        "message": "rpcap: check conversation existence before dereferencing it.\n\nBug: 15536\nChange-Id: I370b7f4b3f647243490cbfadc120f0198c62b09b\nReviewed-on: https://code.wireshark.org/review/32232\nPetri-Dish: Dario Lombardo <lomato@gmail.com>\nTested-by: Petri Dish Buildbot\nReviewed-by: Anders Broman <a.broman58@gmail.com>\n(cherry picked from commit 2f048c932d0c063bd53651d0fd8f31a66eede741)\nReviewed-on: https://code.wireshark.org/review/32235\nReviewed-by: Gerald Combs <gerald@wireshark.org>",
        "before_after_code_files": [
          "epan/dissectors/packet-rpcap.c||epan/dissectors/packet-rpcap.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "epan/dissectors/packet-rpcap.c||epan/dissectors/packet-rpcap.c"
          ],
          "candidate": [
            "epan/dissectors/packet-rpcap.c||epan/dissectors/packet-rpcap.c"
          ]
        }
      },
      "candidate_diff": {
        "epan/dissectors/packet-rpcap.c||epan/dissectors/packet-rpcap.c": [
          "File: epan/dissectors/packet-rpcap.c -> epan/dissectors/packet-rpcap.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1146:     conversation_t *conversation = find_conversation_pinfo (pinfo, 0);",
          "1148:                                                   pinfo->num,",
          "1149:                                                   rpcap_tcp_handle);",
          "1150:     tcp_dissect_pdus (tvb, pinfo, tree, rpcap_desegment, 8,",
          "",
          "[Removed Lines]",
          "1147:     conversation_set_dissector_from_frame_number (conversation,",
          "",
          "[Added Lines]",
          "1147:     if (conversation)",
          "1148:       conversation_set_dissector_from_frame_number (conversation,",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "ff0dca55714495be1fc21255984ca59ae2e89259",
      "candidate_info": {
        "commit_hash": "ff0dca55714495be1fc21255984ca59ae2e89259",
        "repo": "wireshark/wireshark",
        "commit_url": "https://github.com/wireshark/wireshark/commit/ff0dca55714495be1fc21255984ca59ae2e89259",
        "files": [
          "epan/dissectors/packet-rpcap.c"
        ],
        "message": "rpcap: check conversation existence before dereferencing it.\n\nBug: 15536\nChange-Id: I370b7f4b3f647243490cbfadc120f0198c62b09b\nReviewed-on: https://code.wireshark.org/review/32232\nPetri-Dish: Dario Lombardo <lomato@gmail.com>\nTested-by: Petri Dish Buildbot\nReviewed-by: Anders Broman <a.broman58@gmail.com>\n(cherry picked from commit 2f048c932d0c063bd53651d0fd8f31a66eede741)\nReviewed-on: https://code.wireshark.org/review/32234\nReviewed-by: Gerald Combs <gerald@wireshark.org>",
        "before_after_code_files": [
          "epan/dissectors/packet-rpcap.c||epan/dissectors/packet-rpcap.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "epan/dissectors/packet-rpcap.c||epan/dissectors/packet-rpcap.c"
          ],
          "candidate": [
            "epan/dissectors/packet-rpcap.c||epan/dissectors/packet-rpcap.c"
          ]
        }
      },
      "candidate_diff": {
        "epan/dissectors/packet-rpcap.c||epan/dissectors/packet-rpcap.c": [
          "File: epan/dissectors/packet-rpcap.c -> epan/dissectors/packet-rpcap.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1143:     conversation_t *conversation = find_conversation_pinfo (pinfo, 0);",
          "1145:                                                   pinfo->num,",
          "1146:                                                   rpcap_tcp_handle);",
          "1147:     tcp_dissect_pdus (tvb, pinfo, tree, rpcap_desegment, 8,",
          "",
          "[Removed Lines]",
          "1144:     conversation_set_dissector_from_frame_number (conversation,",
          "",
          "[Added Lines]",
          "1144:     if (conversation)",
          "1145:       conversation_set_dissector_from_frame_number (conversation,",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "c557bb0910be271e49563756411a690a1bc53ce5",
      "candidate_info": {
        "commit_hash": "c557bb0910be271e49563756411a690a1bc53ce5",
        "repo": "wireshark/wireshark",
        "commit_url": "https://github.com/wireshark/wireshark/commit/c557bb0910be271e49563756411a690a1bc53ce5",
        "files": [
          "epan/dissectors/packet-rpcap.c"
        ],
        "message": "rpcap: check conversation existence before dereferencing it.\n\nConflicts:\n\tepan/dissectors/packet-rpcap.c\n\nBug: 15536\nChange-Id: I370b7f4b3f647243490cbfadc120f0198c62b09b\nReviewed-on: https://code.wireshark.org/review/32232\nPetri-Dish: Dario Lombardo <lomato@gmail.com>\nTested-by: Petri Dish Buildbot\nReviewed-by: Anders Broman <a.broman58@gmail.com>\n(cherry picked from commit 2f048c932d0c063bd53651d0fd8f31a66eede741)\nReviewed-on: https://code.wireshark.org/review/32236\nReviewed-by: Gerald Combs <gerald@wireshark.org>",
        "before_after_code_files": [
          "epan/dissectors/packet-rpcap.c||epan/dissectors/packet-rpcap.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "epan/dissectors/packet-rpcap.c||epan/dissectors/packet-rpcap.c"
          ],
          "candidate": [
            "epan/dissectors/packet-rpcap.c||epan/dissectors/packet-rpcap.c"
          ]
        }
      },
      "candidate_diff": {
        "epan/dissectors/packet-rpcap.c||epan/dissectors/packet-rpcap.c": [
          "File: epan/dissectors/packet-rpcap.c -> epan/dissectors/packet-rpcap.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1162:     conversation_t *conversation = find_or_create_conversation (pinfo);",
          "1164:                                                   pinfo->num,",
          "1165:                                                   rpcap_tcp_handle);",
          "1166:     tcp_dissect_pdus (tvb, pinfo, tree, rpcap_desegment, 8,",
          "",
          "[Removed Lines]",
          "1163:     conversation_set_dissector_from_frame_number (conversation,",
          "",
          "[Added Lines]",
          "1163:     if (conversation)",
          "1164:       conversation_set_dissector_from_frame_number (conversation,",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "d58a3ffe4f69366f25fd192e41a89b4769c7d22c",
      "candidate_info": {
        "commit_hash": "d58a3ffe4f69366f25fd192e41a89b4769c7d22c",
        "repo": "wireshark/wireshark",
        "commit_url": "https://github.com/wireshark/wireshark/commit/d58a3ffe4f69366f25fd192e41a89b4769c7d22c",
        "files": [
          "epan/dissectors/packet-rpcap.c"
        ],
        "message": "Once we've identified a TCP segment as rpcap, use rpcap for the connection.\n\nOne reason to use Wireshark is to diagnose protocol errors, so don't,\nfor example, treat too-short packets, in a TCP connection where we've\nalready seen rpcap packets, as not being rpcap packets.  (Yes, that *is*\na bug, in the libpcap master, that I found and fixed.)\n\nChange-Id: I9a81e5b9a2910331574164395302247a446e805b\nReviewed-on: https://code.wireshark.org/review/31809\nReviewed-by: Guy Harris <guy@alum.mit.edu>",
        "before_after_code_files": [
          "epan/dissectors/packet-rpcap.c||epan/dissectors/packet-rpcap.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "epan/dissectors/packet-rpcap.c||epan/dissectors/packet-rpcap.c"
          ],
          "candidate": [
            "epan/dissectors/packet-rpcap.c||epan/dissectors/packet-rpcap.c"
          ]
        }
      },
      "candidate_diff": {
        "epan/dissectors/packet-rpcap.c||epan/dissectors/packet-rpcap.c": [
          "File: epan/dissectors/packet-rpcap.c -> epan/dissectors/packet-rpcap.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "204: static expert_field ei_caplen_too_big = EI_INIT;",
          "206: static dissector_handle_t pcap_pktdata_handle;",
          "209: static gboolean rpcap_desegment = TRUE;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "207: static dissector_handle_t rpcap_tcp_handle;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1086: }",
          "1089: static gboolean",
          "1090: dissect_rpcap_heur_tcp (tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void *data)",
          "1091: {",
          "1092:   if (check_rpcap_heur (tvb, TRUE)) {",
          "1094:     tcp_dissect_pdus (tvb, pinfo, tree, rpcap_desegment, 8,",
          "1095:                       get_rpcap_pdu_len, dissect_rpcap, data);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1090: static int",
          "1091: dissect_rpcap_tcp (tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void *data)",
          "1092: {",
          "1093:   tcp_dissect_pdus (tvb, pinfo, tree, rpcap_desegment, 8,",
          "1094:                     get_rpcap_pdu_len, dissect_rpcap, data);",
          "1095:   return tvb_captured_length (tvb);",
          "1096: }",
          "1108:     conversation_t *conversation = find_conversation_pinfo (pinfo, 0);",
          "1109:     conversation_set_dissector_from_frame_number (conversation,",
          "1110:                                                   pinfo->num,",
          "1111:                                                   rpcap_tcp_handle);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1468:     heur_dissector_add (\"tcp\", dissect_rpcap_heur_tcp, \"RPCAP over TCP\", \"rpcap_tcp\", proto_rpcap, HEURISTIC_ENABLE);",
          "1469:     heur_dissector_add (\"udp\", dissect_rpcap_heur_udp, \"RPCAP over UDP\", \"rpcap_udp\", proto_rpcap, HEURISTIC_ENABLE);",
          "1470:   }",
          "1472:   info_added = FALSE;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1489:     rpcap_tcp_handle = create_dissector_handle(dissect_rpcap_tcp, proto_rpcap);",
          "",
          "---------------"
        ]
      }
    }
  ]
}