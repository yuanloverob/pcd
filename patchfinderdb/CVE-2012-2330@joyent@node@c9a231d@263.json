{
  "cve_id": "CVE-2012-2330",
  "cve_desc": "The Update method in src/node_http_parser.cc in Node.js before 0.6.17 and 0.7 before 0.7.8 does not properly check the length of a string, which allows remote attackers to obtain sensitive information (request header contents) and possibly spoof HTTP headers via a zero length string.",
  "repo": "joyent/node",
  "patch_hash": "c9a231db0e59658be419d926b1dfa17b939ba158",
  "patch_info": {
    "commit_hash": "c9a231db0e59658be419d926b1dfa17b939ba158",
    "repo": "joyent/node",
    "commit_url": "https://github.com/joyent/node/commit/c9a231d",
    "files": [
      "src/node_http_parser.cc"
    ],
    "message": "typo in node_http_parser",
    "before_after_code_files": [
      "src/node_http_parser.cc||src/node_http_parser.cc"
    ]
  },
  "patch_diff": {
    "src/node_http_parser.cc||src/node_http_parser.cc": [
      "File: src/node_http_parser.cc -> src/node_http_parser.cc",
      "--- Hunk 1 ---",
      "[Context before]",
      "191:   void Update(const char* str, size_t size) {",
      "192:     if (str_ == NULL)",
      "193:       str_ = str;",
      "197:       char* s = new char[size_ + size];",
      "",
      "[Removed Lines]",
      "194:     else if (on_heap_ || str_ + size != str) {",
      "",
      "[Added Lines]",
      "194:     else if (on_heap_ || str_ + size_ != str) {",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "58e5d69250df16a7a4746a0c028320e2ef821672",
      "candidate_info": {
        "commit_hash": "58e5d69250df16a7a4746a0c028320e2ef821672",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/58e5d69250df16a7a4746a0c028320e2ef821672",
        "files": [
          "common.gypi",
          "tools/gyp_addon"
        ],
        "message": "build: fix the case where config.gypi doesn't exist",
        "before_after_code_files": [
          "common.gypi||common.gypi"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "common.gypi||common.gypi": [
          "File: common.gypi -> common.gypi",
          "--- Hunk 1 ---",
          "[Context before]",
          "10:   },",
          "12:   'target_defaults': {",
          "13:     'configurations': {",
          "14:       'Debug': {",
          "15:         'defines': [ 'DEBUG', '_DEBUG' ],",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "13:     'default_configuration': 'Debug',",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "fd61bfc73195063d984e7a1d3594015c7d5f4e25",
      "candidate_info": {
        "commit_hash": "fd61bfc73195063d984e7a1d3594015c7d5f4e25",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/fd61bfc73195063d984e7a1d3594015c7d5f4e25",
        "files": [
          "doc/api/readline.markdown",
          "lib/readline.js",
          "lib/repl.js"
        ],
        "message": "readline: ^Z (SIGSTP) handling\n\nBugfix and update.\n\n- Fixed bug where Node's REPL wouldn't continue when returning from ^Z\n  (SIGTSTP)\n- Removed old readline callback\n\nReadline API update with docs.\n\n- ^Z (SIGTSTP) is now bypassed on Windows systems.\n- SIGCONT is now bypassed on Windows systems.\n- Docs updated to reflect above.",
        "before_after_code_files": [
          "lib/readline.js||lireadline.js",
          "lib/repl.js||lirepl.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "lib/readline.js||lireadline.js": [
          "File: lib/readline.js -> lireadline.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "531:         break;",
          "533:       case 'z':",
          "534:         if (this.listeners('SIGTSTP').length) {",
          "535:           this.emit('SIGTSTP');",
          "536:         } else {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "547:           })(this));",
          "548:           process.kill(process.pid, 'SIGTSTP');",
          "549:         }",
          "552:       case 'w': // delete backwards to a word boundary",
          "553:       case 'backspace':",
          "",
          "[Removed Lines]",
          "550:         return;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "569:       case 'right':",
          "570:         this._wordRight();",
          "571:     }",
          "573:   } else if (key.meta) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "lib/repl.js||lirepl.js": [
          "File: lib/repl.js -> lirepl.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "153:     self.displayPrompt();",
          "154:   });",
          "157:     sawSIGINT = false;",
          "158:     var skipCatchall = false;",
          "159:     cmd = trimWhitespace(cmd);",
          "",
          "[Removed Lines]",
          "156:   rli.addListener('line', function(cmd) {",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "258:     };",
          "259:   });",
          "263:   });",
          "265:   self.displayPrompt();",
          "",
          "[Removed Lines]",
          "261:   rli.addListener('close', function() {",
          "262:     self.inputStream.destroy();",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "2cde4983199473a1bf1650ef485f94b68194aa85",
      "candidate_info": {
        "commit_hash": "2cde4983199473a1bf1650ef485f94b68194aa85",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/2cde4983199473a1bf1650ef485f94b68194aa85",
        "files": [
          "test/simple/test-http-parser-bad-ref.js"
        ],
        "message": "Add another test to test-http-parser-bad-ref.js demoing #2438",
        "before_after_code_files": [
          "test/simple/test-http-parser-bad-ref.js||test/simple/test-http-parser-bad-ref.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "test/simple/test-http-parser-bad-ref.js||test/simple/test-http-parser-bad-ref.js": [
          "File: test/simple/test-http-parser-bad-ref.js -> test/simple/test-http-parser-bad-ref.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "15: }",
          "17: function demoBug(part1, part2) {",
          "18:   var parser = new HTTPParser('REQUEST');",
          "20:   parser.headers = [];",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "18:   flushPool();",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "56:     parser.execute(b, 0, b.length);",
          "57:     parser.finish();",
          "58:   })();",
          "59: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "62:   flushPool();",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "64:         'Content-Length: 4\\r\\n\\r\\n' +",
          "65:         'pong');",
          "68: process.on('exit', function() {",
          "71:   console.log(\"done!\");",
          "72: });",
          "",
          "[Removed Lines]",
          "69:   assert.equal(1, headersComplete);",
          "70:   assert.equal(1, messagesComplete);",
          "",
          "[Added Lines]",
          "71: demoBug('POST /1/22 HTTP/1.1\\r\\n' +",
          "72:         'Content-Type: tex', 't/plain\\r\\n' +",
          "73:         'Content-Length: 4\\r\\n\\r\\n' +",
          "74:         'pong');",
          "77:   assert.equal(2, headersComplete);",
          "78:   assert.equal(2, messagesComplete);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "5209dad9073136153fa901d1c80f96458b4d3cf8",
      "candidate_info": {
        "commit_hash": "5209dad9073136153fa901d1c80f96458b4d3cf8",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/5209dad9073136153fa901d1c80f96458b4d3cf8",
        "files": [
          "test/gc/test-net-timeout.js"
        ],
        "message": "test-net-timeout: make it pass on Windows\n\nThe test didn't take into account that some time might pass before\nlibuv makes close callbacks. This is now fixed.",
        "before_after_code_files": [
          "test/gc/test-net-timeout.js||test/gc/test-net-timeout.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "test/gc/test-net-timeout.js||test/gc/test-net-timeout.js": [
          "File: test/gc/test-net-timeout.js -> test/gc/test-net-timeout.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "56:   console.log('Done: %d/%d', done, todo);",
          "57:   console.log('Collected: %d/%d', countGC, count);",
          "58:   if (done === todo) {",
          "62:   }",
          "63: }",
          "",
          "[Removed Lines]",
          "59:     console.log('All should be collected now.');",
          "60:     assert(count === countGC);",
          "61:     process.exit(0);",
          "",
          "[Added Lines]",
          "60:     setTimeout(function() {",
          "61:       gc();",
          "62:       console.log('All should be collected now.');",
          "63:       console.log('Collected: %d/%d', countGC, count);",
          "64:       assert(count === countGC);",
          "65:       process.exit(0);",
          "66:     }, 200);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "202df30aabc78fa571cf77ad93146b3c4d99fc6e",
      "candidate_info": {
        "commit_hash": "202df30aabc78fa571cf77ad93146b3c4d99fc6e",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/202df30aabc78fa571cf77ad93146b3c4d99fc6e",
        "files": [
          "common.gypi",
          "configure",
          "deps/v8/build/common.gypi"
        ],
        "message": "build: disable unsafe optimizations\n\nCompile at -O2 and disable optimizations that trigger gcc bugs.\n\nSome people still reported mksnapshot crashes after commit b40f813 (\"build: fix\nspurious mksnapshot crashes for good\" - so much for that).\n\nAverage performance of the -O2 binary is on par with the -O3 binary. Variance\non the http_simple bytes/8 benchmark appears to be slightly greater but small\nenough that the possibly of it being noise cannot be excluded.\n\nThe new binary very slightly but consistently outperforms the -O3 binary (by\nabout 0.5%) on the mostly CPU-bound bytes/102400 benchmark. That could be an\nartifact of the system I benchmarked it on, a Core 2 Duo with a puny 32 kB of\nL1 instruction cache. The smaller binary seems to play nicer with the cache.",
        "before_after_code_files": [
          "common.gypi||common.gypi",
          "deps/v8/build/common.gypi||deps/v8/build/common.gypi"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "common.gypi||common.gypi": [
          "File: common.gypi -> common.gypi",
          "--- Hunk 1 ---",
          "[Context before]",
          "8:     'component%': 'static_library',  # NB. these names match with what V8 expects",
          "9:     'msvs_multi_core_compile': '0',  # we do enable multicore compiles, but not using the V8 way",
          "11:     # Enable V8's post-mortem debugging only on unix flavors.",
          "12:     'conditions': [",
          "13:       ['OS != \"win\"', {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "11:     # Turn on optimizations that may trigger compiler bugs.",
          "12:     # Use at your own risk. Do *NOT* report bugs if this option is enabled.",
          "13:     'node_unsafe_optimizations%': 0,",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "41:         },",
          "42:       },",
          "43:       'Release': {",
          "50:         'conditions': [",
          "51:           ['target_arch==\"x64\"', {",
          "52:             'msvs_configuration_platform': 'x64',",
          "53:           }],",
          "",
          "[Removed Lines]",
          "44:         # Do *NOT* enable -ffunction-sections or -fdata-sections again.",
          "45:         # We don't link with -Wl,--gc-sections so they're effectively no-ops.",
          "46:         # Worse, they trigger very nasty bugs in some versions of gcc, notably",
          "47:         # v4.4.6 on x86_64-redhat-linux (i.e. RHEL and CentOS).",
          "48:         'cflags!': [ '-ffunction-sections', '-fdata-sections' ],",
          "49:         'cflags': [ '-O3' ],",
          "",
          "[Added Lines]",
          "49:           ['node_unsafe_optimizations==1', {",
          "50:             'cflags': [ '-O3', '-ffunction-sections', '-fdata-sections' ],",
          "51:             'ldflags': [ '-Wl,--gc-sections' ],",
          "52:           }, {",
          "53:             'cflags': [ '-O2', '-fno-strict-aliasing', '-fno-tree-vrp' ],",
          "54:             'cflags!': [ '-O3',",
          "55:                          '-fstrict-aliasing',",
          "56:                          '-ffunction-sections',",
          "57:                          '-fdata-sections' ],",
          "58:           }],",
          "",
          "---------------"
        ],
        "deps/v8/build/common.gypi||deps/v8/build/common.gypi": [
          "File: deps/v8/build/common.gypi -> deps/v8/build/common.gypi",
          "--- Hunk 1 ---",
          "[Context before]",
          "332:         'conditions': [",
          "333:           ['OS==\"linux\" or OS==\"freebsd\" or OS==\"openbsd\" or OS==\"netbsd\" \\",
          "334:             or OS==\"android\"', {",
          "339:             'cflags': [",
          "340:               '-fdata-sections',",
          "341:               '-ffunction-sections',",
          "",
          "[Removed Lines]",
          "335:             'cflags!': [",
          "336:               '-O2',",
          "337:               '-Os',",
          "338:             ],",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    }
  ]
}