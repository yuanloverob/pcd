{
  "cve_id": "CVE-2011-1941",
  "cve_desc": "Open redirect vulnerability in the redirector feature in phpMyAdmin 3.4.x before 3.4.1 allows remote attackers to redirect users to arbitrary web sites and conduct phishing attacks via unspecified vectors.",
  "repo": "phpmyadmin/composer",
  "patch_hash": "ecfc8ba4f7b4ea612c58ab5726054ed0f28e200d",
  "patch_info": {
    "commit_hash": "ecfc8ba4f7b4ea612c58ab5726054ed0f28e200d",
    "repo": "phpmyadmin/composer",
    "commit_url": "https://github.com/phpmyadmin/composer/commit/ecfc8ba4f7b4ea612c58ab5726054ed0f28e200d",
    "files": [
      "libraries/common.inc.php",
      "libraries/core.lib.php",
      "url.php"
    ],
    "message": "Make redirector require valid token",
    "before_after_code_files": [
      "libraries/common.inc.php||libraries/common.inc.php",
      "libraries/core.lib.php||libraries/core.lib.php",
      "url.php||url.php"
    ]
  },
  "patch_diff": {
    "libraries/common.inc.php||libraries/common.inc.php": [
      "File: libraries/common.inc.php -> libraries/common.inc.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "477:         'media_type', 'custom_type', 'bs_reference',",
      "479:         'bs_db', 'bs_table', 'bs_ref', 'bs_new_mime_type',",
      "482:     );",
      "",
      "[Removed Lines]",
      "481:         'url'",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ],
    "libraries/core.lib.php||libraries/core.lib.php": [
      "File: libraries/core.lib.php -> libraries/core.lib.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "683: function PMA_linkURL($url) {",
      "684:     if (!preg_match('#^https?://#', $url)) {",
      "685:         return $url;",
      "686:     } elseif (defined('PMA_SETUP')) {",
      "688:     } else {",
      "690:     }",
      "691: }",
      "",
      "[Removed Lines]",
      "687:         return '../url.php?url=' . $url;",
      "689:         return './url.php?url=' . $url;",
      "",
      "[Added Lines]",
      "684:     $params = array();",
      "685:     $params['url'] = $url;",
      "686:     $goto = 'url.php' . PMA_generate_common_url($params);",
      "690:         return '../' . $goto;",
      "692:         return './' . $goto;",
      "",
      "---------------"
    ],
    "url.php||url.php": [
      "File: url.php -> url.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "11: require_once './libraries/common.inc.php';",
      "14:     header('Location: ' . $cfg['PmaAbsoluteUri']);",
      "15: } else {",
      "17: }",
      "18: ?>",
      "",
      "[Removed Lines]",
      "6: define('PMA_MINIMUM_COMMON', TRUE);",
      "13: if (empty($GLOBALS['url']) || ! preg_match('/^https?:\\/\\/[^\\n\\r]*$/', $GLOBALS['url'])) {",
      "16:     header('Location: ' . $GLOBALS['url']);",
      "",
      "[Added Lines]",
      "11: if (! PMA_isValid($_GET['url']) || ! preg_match('/^https?:\\/\\/[^\\n\\r]*$/', $_GET['url'])) {",
      "14:     header('Location: ' . $_GET['url']);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "b7a8179eb6bf0f1643970ac57a70b5b513a1cd4f",
      "candidate_info": {
        "commit_hash": "b7a8179eb6bf0f1643970ac57a70b5b513a1cd4f",
        "repo": "phpmyadmin/composer",
        "commit_url": "https://github.com/phpmyadmin/composer/commit/b7a8179eb6bf0f1643970ac57a70b5b513a1cd4f",
        "files": [
          "libraries/core.lib.php"
        ],
        "message": "Can not use redirector for setup.\n\nWe currently have no reasonable way to protect it there.",
        "before_after_code_files": [
          "libraries/core.lib.php||libraries/core.lib.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "libraries/core.lib.php||libraries/core.lib.php"
          ],
          "candidate": [
            "libraries/core.lib.php||libraries/core.lib.php"
          ]
        }
      },
      "candidate_diff": {
        "libraries/core.lib.php||libraries/core.lib.php": [
          "File: libraries/core.lib.php -> libraries/core.lib.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "683: function PMA_linkURL($url) {",
          "688:         return $url;",
          "691:     } else {",
          "693:     }",
          "694: }",
          "",
          "[Removed Lines]",
          "684:     $params = array();",
          "685:     $params['url'] = $url;",
          "686:     $goto = 'url.php' . PMA_generate_common_url($params);",
          "687:     if (!preg_match('#^https?://#', $url)) {",
          "689:     } elseif (defined('PMA_SETUP')) {",
          "690:         return '../' . $goto;",
          "692:         return './' . $goto;",
          "",
          "[Added Lines]",
          "684:     if (!preg_match('#^https?://#', $url) || defined('PMA_SETUP')) {",
          "687:         $params = array();",
          "688:         $params['url'] = $url;",
          "689:         return './url.php' . PMA_generate_common_url($params);",
          "",
          "---------------"
        ]
      }
    }
  ]
}