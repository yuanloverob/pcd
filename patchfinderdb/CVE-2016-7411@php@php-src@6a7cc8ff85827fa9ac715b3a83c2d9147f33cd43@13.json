{
  "cve_id": "CVE-2016-7411",
  "cve_desc": "ext/standard/var_unserializer.re in PHP before 5.6.26 mishandles object-deserialization failures, which allows remote attackers to cause a denial of service (memory corruption) or possibly have unspecified other impact via an unserialize call that references a partially constructed object.",
  "repo": "php/php-src",
  "patch_hash": "6a7cc8ff85827fa9ac715b3a83c2d9147f33cd43",
  "patch_info": {
    "commit_hash": "6a7cc8ff85827fa9ac715b3a83c2d9147f33cd43",
    "repo": "php/php-src",
    "commit_url": "https://github.com/php/php-src/commit/6a7cc8ff85827fa9ac715b3a83c2d9147f33cd43",
    "files": [
      "Zend/zend_objects_API.c",
      "ext/standard/tests/serialize/bug73052.phpt",
      "ext/standard/var_unserializer.c",
      "ext/standard/var_unserializer.re"
    ],
    "message": "Fix bug #73052 - Memory Corruption in During Deserialized-object Destruction",
    "before_after_code_files": [
      "Zend/zend_objects_API.c||Zend/zend_objects_API.c",
      "ext/standard/tests/serialize/bug73052.phpt||ext/standard/tests/serialize/bug73052.phpt",
      "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
      "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
    ]
  },
  "patch_diff": {
    "Zend/zend_objects_API.c||Zend/zend_objects_API.c": [
      "File: Zend/zend_objects_API.c -> Zend/zend_objects_API.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "306: {",
      "307:  zend_object_handle handle = Z_OBJ_HANDLE_P(zobject);",
      "308:  zend_object_store_bucket *obj_bucket = &EG(objects_store).object_buckets[handle];",
      "311:  obj_bucket->destructor_called = 1;",
      "312: }",
      "",
      "[Removed Lines]",
      "310:  obj_bucket->bucket.obj.handlers = Z_OBJ_HT_P(zobject);;",
      "",
      "[Added Lines]",
      "310:  obj_bucket->bucket.obj.handlers = Z_OBJ_HT_P(zobject);",
      "",
      "---------------"
    ],
    "ext/standard/tests/serialize/bug73052.phpt||ext/standard/tests/serialize/bug73052.phpt": [
      "File: ext/standard/tests/serialize/bug73052.phpt -> ext/standard/tests/serialize/bug73052.phpt",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: --TEST--",
      "2: Bug #73052: Memory Corruption in During Deserialized-object Destruction",
      "3: --FILE--",
      "4: <?php",
      "6: class obj {",
      "7:     var $ryat;",
      "8:     public function __destruct() {",
      "9:         $this->ryat = null;",
      "10:     }",
      "11: }",
      "13: $poc = 'O:3:\"obj\":1:{';",
      "14: var_dump(unserialize($poc));",
      "15: ?>",
      "16: --EXPECTF--",
      "17: Notice: unserialize(): Error at offset 13 of 13 bytes in %sbug73052.php on line %d",
      "18: bool(false)",
      "",
      "---------------"
    ],
    "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
      "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "438:      if(Z_TYPE_PP(rval) == IS_OBJECT) {",
      "439:         zend_hash_clean(Z_OBJPROP_PP(rval));",
      "440:      }",
      "441:      ZVAL_NULL(*rval);",
      "442:   return 0;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "440:         zend_object_store_ctor_failed(*rval TSRMLS_CC);",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "495: {",
      "496:  YYCTYPE yych;",
      "497:  static const unsigned char yybm[] = {",
      "",
      "[Removed Lines]",
      "494: #line 495 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "495: #line 496 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "551:  yych = *(YYMARKER = ++YYCURSOR);",
      "552:  if (yych == ':') goto yy95;",
      "553: yy3:",
      "555:  { return 0; }",
      "557: yy4:",
      "558:  yych = *(YYMARKER = ++YYCURSOR);",
      "559:  if (yych == ':') goto yy89;",
      "",
      "[Removed Lines]",
      "554: #line 860 \"ext/standard/var_unserializer.re\"",
      "556: #line 557 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "555: #line 861 \"ext/standard/var_unserializer.re\"",
      "557: #line 558 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "596:  goto yy3;",
      "597: yy14:",
      "598:  ++YYCURSOR;",
      "600:  {",
      "602:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
      "604: }",
      "606: yy16:",
      "607:  yych = *++YYCURSOR;",
      "608:  goto yy3;",
      "",
      "[Removed Lines]",
      "599: #line 854 \"ext/standard/var_unserializer.re\"",
      "605: #line 606 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "600: #line 855 \"ext/standard/var_unserializer.re\"",
      "606: #line 607 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "633:  yych = *++YYCURSOR;",
      "634:  if (yych != '\"') goto yy18;",
      "635:  ++YYCURSOR;",
      "637:  {",
      "638:  size_t len, len2, len3, maxlen;",
      "639:  long elements;",
      "",
      "[Removed Lines]",
      "636: #line 707 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "637: #line 708 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "781:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
      "782: }",
      "784: yy25:",
      "785:  yych = *++YYCURSOR;",
      "786:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "783: #line 784 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "784: #line 785 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "805:  yych = *++YYCURSOR;",
      "806:  if (yych != '\"') goto yy18;",
      "807:  ++YYCURSOR;",
      "809:  {",
      "810:     if (!var_hash) return 0;",
      "",
      "[Removed Lines]",
      "808: #line 698 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "809: #line 699 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 8 ---",
      "[Context before]",
      "814:  return object_common2(UNSERIALIZE_PASSTHRU,",
      "815:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
      "816: }",
      "818: yy32:",
      "819:  yych = *++YYCURSOR;",
      "820:  if (yych == '+') goto yy33;",
      "",
      "[Removed Lines]",
      "817: #line 818 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "818: #line 819 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 9 ---",
      "[Context before]",
      "835:  yych = *++YYCURSOR;",
      "836:  if (yych != '{') goto yy18;",
      "837:  ++YYCURSOR;",
      "839:  {",
      "840:  long elements = parse_iv(start + 2);",
      "",
      "[Removed Lines]",
      "838: #line 677 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "839: #line 678 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 10 ---",
      "[Context before]",
      "857:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
      "858: }",
      "860: yy39:",
      "861:  yych = *++YYCURSOR;",
      "862:  if (yych == '+') goto yy40;",
      "",
      "[Removed Lines]",
      "859: #line 860 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "860: #line 861 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 11 ---",
      "[Context before]",
      "877:  yych = *++YYCURSOR;",
      "878:  if (yych != '\"') goto yy18;",
      "879:  ++YYCURSOR;",
      "881:  {",
      "882:  size_t len, maxlen;",
      "883:  char *str;",
      "",
      "[Removed Lines]",
      "880: #line 642 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "881: #line 643 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 12 ---",
      "[Context before]",
      "912:  ZVAL_STRINGL(*rval, str, len, 0);",
      "913:  return 1;",
      "914: }",
      "916: yy46:",
      "917:  yych = *++YYCURSOR;",
      "918:  if (yych == '+') goto yy47;",
      "",
      "[Removed Lines]",
      "915: #line 916 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "916: #line 917 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 13 ---",
      "[Context before]",
      "933:  yych = *++YYCURSOR;",
      "934:  if (yych != '\"') goto yy18;",
      "935:  ++YYCURSOR;",
      "937:  {",
      "938:  size_t len, maxlen;",
      "939:  char *str;",
      "",
      "[Removed Lines]",
      "936: #line 609 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "937: #line 610 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 14 ---",
      "[Context before]",
      "966:  ZVAL_STRINGL(*rval, str, len, 1);",
      "967:  return 1;",
      "968: }",
      "970: yy53:",
      "971:  yych = *++YYCURSOR;",
      "972:  if (yych <= '/') {",
      "",
      "[Removed Lines]",
      "969: #line 970 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "970: #line 971 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 15 ---",
      "[Context before]",
      "1054:  }",
      "1055: yy63:",
      "1056:  ++YYCURSOR;",
      "1058:  {",
      "1059: #if SIZEOF_LONG == 4",
      "1060: use_double:",
      "",
      "[Removed Lines]",
      "1057: #line 599 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1058: #line 600 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 16 ---",
      "[Context before]",
      "1064:  ZVAL_DOUBLE(*rval, zend_strtod((const char *)start + 2, NULL));",
      "1065:  return 1;",
      "1066: }",
      "1068: yy65:",
      "1069:  yych = *++YYCURSOR;",
      "1070:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1067: #line 1068 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1068: #line 1069 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 17 ---",
      "[Context before]",
      "1123:  yych = *++YYCURSOR;",
      "1124:  if (yych != ';') goto yy18;",
      "1125:  ++YYCURSOR;",
      "1127:  {",
      "1129:  INIT_PZVAL(*rval);",
      "",
      "[Removed Lines]",
      "1126: #line 584 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1127: #line 585 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 18 ---",
      "[Context before]",
      "1139:  return 1;",
      "1140: }",
      "1142: yy76:",
      "1143:  yych = *++YYCURSOR;",
      "1144:  if (yych == 'N') goto yy73;",
      "",
      "[Removed Lines]",
      "1141: #line 1142 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1142: #line 1143 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 19 ---",
      "[Context before]",
      "1165:  if (yych <= '9') goto yy79;",
      "1166:  if (yych != ';') goto yy18;",
      "1167:  ++YYCURSOR;",
      "1169:  {",
      "1170: #if SIZEOF_LONG == 4",
      "1171:  int digits = YYCURSOR - start - 3;",
      "",
      "[Removed Lines]",
      "1168: #line 557 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1169: #line 558 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 20 ---",
      "[Context before]",
      "1192:  ZVAL_LONG(*rval, parse_iv(start + 2));",
      "1193:  return 1;",
      "1194: }",
      "1196: yy83:",
      "1197:  yych = *++YYCURSOR;",
      "1198:  if (yych <= '/') goto yy18;",
      "",
      "[Removed Lines]",
      "1195: #line 1196 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1196: #line 1197 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 21 ---",
      "[Context before]",
      "1200:  yych = *++YYCURSOR;",
      "1201:  if (yych != ';') goto yy18;",
      "1202:  ++YYCURSOR;",
      "1204:  {",
      "1206:  INIT_PZVAL(*rval);",
      "1207:  ZVAL_BOOL(*rval, parse_iv(start + 2));",
      "1208:  return 1;",
      "1209: }",
      "1211: yy87:",
      "1212:  ++YYCURSOR;",
      "1214:  {",
      "1216:  INIT_PZVAL(*rval);",
      "1217:  ZVAL_NULL(*rval);",
      "1218:  return 1;",
      "1219: }",
      "1221: yy89:",
      "1222:  yych = *++YYCURSOR;",
      "1223:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1203: #line 550 \"ext/standard/var_unserializer.re\"",
      "1210: #line 1211 \"ext/standard/var_unserializer.c\"",
      "1213: #line 543 \"ext/standard/var_unserializer.re\"",
      "1220: #line 1221 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1204: #line 551 \"ext/standard/var_unserializer.re\"",
      "1211: #line 1212 \"ext/standard/var_unserializer.c\"",
      "1214: #line 544 \"ext/standard/var_unserializer.re\"",
      "1221: #line 1222 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 22 ---",
      "[Context before]",
      "1240:  if (yych <= '9') goto yy91;",
      "1241:  if (yych != ';') goto yy18;",
      "1242:  ++YYCURSOR;",
      "1244:  {",
      "1245:  long id;",
      "",
      "[Removed Lines]",
      "1243: #line 520 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1244: #line 521 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 23 ---",
      "[Context before]",
      "1264:  return 1;",
      "1265: }",
      "1267: yy95:",
      "1268:  yych = *++YYCURSOR;",
      "1269:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1266: #line 1267 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1267: #line 1268 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 24 ---",
      "[Context before]",
      "1286:  if (yych <= '9') goto yy97;",
      "1287:  if (yych != ';') goto yy18;",
      "1288:  ++YYCURSOR;",
      "1290:  {",
      "1291:  long id;",
      "",
      "[Removed Lines]",
      "1289: #line 499 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1290: #line 500 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 25 ---",
      "[Context before]",
      "1308:  return 1;",
      "1309: }",
      "1311: }",
      "1315:  return 0;",
      "",
      "[Removed Lines]",
      "1310: #line 1311 \"ext/standard/var_unserializer.c\"",
      "1312: #line 862 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1311: #line 1312 \"ext/standard/var_unserializer.c\"",
      "1313: #line 863 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------"
    ],
    "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
      "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
      "--- Hunk 1 ---",
      "[Context before]",
      "442:      if(Z_TYPE_PP(rval) == IS_OBJECT) {",
      "443:         zend_hash_clean(Z_OBJPROP_PP(rval));",
      "444:      }",
      "445:      ZVAL_NULL(*rval);",
      "446:   return 0;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "444:         zend_object_store_ctor_failed(*rval TSRMLS_CC);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "8b0deb8cd2d54fb9f786a87feb95ee2a00771f6f",
      "candidate_info": {
        "commit_hash": "8b0deb8cd2d54fb9f786a87feb95ee2a00771f6f",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/8b0deb8cd2d54fb9f786a87feb95ee2a00771f6f",
        "files": [
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "fix unserializer patch",
        "before_after_code_files": [
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "366:     if (Z_TYPE_P(old_data) == IS_INDIRECT) {",
          "367:      old_data = Z_INDIRECT_P(old_data);",
          "368:     }",
          "370:     var_push_dtor(var_hash, old_data);",
          "372:    }",
          "374:   }",
          "376:   zval_dtor(&key);",
          "",
          "[Removed Lines]",
          "369:     zval_ptr_dtor(old_data);",
          "371:     ZVAL_UNDEF(old_data);",
          "373:    data = zend_hash_update(ht, Z_STR(key), &d);",
          "",
          "[Added Lines]",
          "371:    data = zend_hash_update_ind(ht, Z_STR(key), &d);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "509:  start = cursor;",
          "513: {",
          "514:  YYCTYPE yych;",
          "515:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "512: #line 513 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "510: #line 511 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "569:  yych = *(YYMARKER = ++YYCURSOR);",
          "570:  if (yych == ':') goto yy95;",
          "571: yy3:",
          "573:  { return 0; }",
          "575: yy4:",
          "576:  yych = *(YYMARKER = ++YYCURSOR);",
          "577:  if (yych == ':') goto yy89;",
          "",
          "[Removed Lines]",
          "572: #line 860 \"ext/standard/var_unserializer.re\"",
          "574: #line 575 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "570: #line 858 \"ext/standard/var_unserializer.re\"",
          "572: #line 573 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "614:  goto yy3;",
          "615: yy14:",
          "616:  ++YYCURSOR;",
          "618:  {",
          "620:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
          "622: }",
          "624: yy16:",
          "625:  yych = *++YYCURSOR;",
          "626:  goto yy3;",
          "",
          "[Removed Lines]",
          "617: #line 854 \"ext/standard/var_unserializer.re\"",
          "623: #line 624 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "615: #line 852 \"ext/standard/var_unserializer.re\"",
          "621: #line 622 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "651:  yych = *++YYCURSOR;",
          "652:  if (yych != '\"') goto yy18;",
          "653:  ++YYCURSOR;",
          "655:  {",
          "656:  size_t len, len2, len3, maxlen;",
          "657:  zend_long elements;",
          "",
          "[Removed Lines]",
          "654: #line 709 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "652: #line 707 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "797:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "798: }",
          "800: yy25:",
          "801:  yych = *++YYCURSOR;",
          "802:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "799: #line 800 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "797: #line 798 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "821:  yych = *++YYCURSOR;",
          "822:  if (yych != '\"') goto yy18;",
          "823:  ++YYCURSOR;",
          "825:  {",
          "",
          "[Removed Lines]",
          "824: #line 701 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "822: #line 699 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "829:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "830:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "831: }",
          "833: yy32:",
          "834:  yych = *++YYCURSOR;",
          "835:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "832: #line 833 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "830: #line 831 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "850:  yych = *++YYCURSOR;",
          "851:  if (yych != '{') goto yy18;",
          "852:  ++YYCURSOR;",
          "854:  {",
          "855:  zend_long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "853: #line 680 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "851: #line 678 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "872:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "873: }",
          "875: yy39:",
          "876:  yych = *++YYCURSOR;",
          "877:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "874: #line 875 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "872: #line 873 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "892:  yych = *++YYCURSOR;",
          "893:  if (yych != '\"') goto yy18;",
          "894:  ++YYCURSOR;",
          "896:  {",
          "897:  size_t len, maxlen;",
          "898:  zend_string *str;",
          "",
          "[Removed Lines]",
          "895: #line 652 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "893: #line 650 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "920:  ZVAL_STR(rval, str);",
          "921:  return 1;",
          "922: }",
          "924: yy46:",
          "925:  yych = *++YYCURSOR;",
          "926:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "923: #line 924 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "921: #line 922 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "941:  yych = *++YYCURSOR;",
          "942:  if (yych != '\"') goto yy18;",
          "943:  ++YYCURSOR;",
          "945:  {",
          "946:  size_t len, maxlen;",
          "947:  char *str;",
          "",
          "[Removed Lines]",
          "944: #line 625 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "942: #line 623 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "968:  ZVAL_STRINGL(rval, str, len);",
          "969:  return 1;",
          "970: }",
          "972: yy53:",
          "973:  yych = *++YYCURSOR;",
          "974:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "971: #line 972 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "969: #line 970 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1056:  }",
          "1057: yy63:",
          "1058:  ++YYCURSOR;",
          "1060:  {",
          "1061: #if SIZEOF_ZEND_LONG == 4",
          "1062: use_double:",
          "",
          "[Removed Lines]",
          "1059: #line 616 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1057: #line 614 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1065:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1066:  return 1;",
          "1067: }",
          "1069: yy65:",
          "1070:  yych = *++YYCURSOR;",
          "1071:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1068: #line 1069 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1066: #line 1067 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1124:  yych = *++YYCURSOR;",
          "1125:  if (yych != ';') goto yy18;",
          "1126:  ++YYCURSOR;",
          "1128:  {",
          "",
          "[Removed Lines]",
          "1127: #line 600 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1125: #line 598 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "1141:  return 1;",
          "1142: }",
          "1144: yy76:",
          "1145:  yych = *++YYCURSOR;",
          "1146:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1143: #line 1144 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1141: #line 1142 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1167:  if (yych <= '9') goto yy79;",
          "1168:  if (yych != ';') goto yy18;",
          "1169:  ++YYCURSOR;",
          "1171:  {",
          "1172: #if SIZEOF_ZEND_LONG == 4",
          "1173:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1170: #line 574 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1168: #line 572 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1193:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1194:  return 1;",
          "1195: }",
          "1197: yy83:",
          "1198:  yych = *++YYCURSOR;",
          "1199:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1196: #line 1197 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1194: #line 1195 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "1201:  yych = *++YYCURSOR;",
          "1202:  if (yych != ';') goto yy18;",
          "1203:  ++YYCURSOR;",
          "1205:  {",
          "1207:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1208:  return 1;",
          "1209: }",
          "1211: yy87:",
          "1212:  ++YYCURSOR;",
          "1214:  {",
          "1216:  ZVAL_NULL(rval);",
          "1217:  return 1;",
          "1218: }",
          "1220: yy89:",
          "1221:  yych = *++YYCURSOR;",
          "1222:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1204: #line 568 \"ext/standard/var_unserializer.re\"",
          "1210: #line 1211 \"ext/standard/var_unserializer.c\"",
          "1213: #line 562 \"ext/standard/var_unserializer.re\"",
          "1219: #line 1220 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1202: #line 566 \"ext/standard/var_unserializer.re\"",
          "1208: #line 1209 \"ext/standard/var_unserializer.c\"",
          "1211: #line 560 \"ext/standard/var_unserializer.re\"",
          "1217: #line 1218 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "1239:  if (yych <= '9') goto yy91;",
          "1240:  if (yych != ';') goto yy18;",
          "1241:  ++YYCURSOR;",
          "1243:  {",
          "1244:  zend_long id;",
          "",
          "[Removed Lines]",
          "1242: #line 539 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1240: #line 537 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "1263:  return 1;",
          "1264: }",
          "1266: yy95:",
          "1267:  yych = *++YYCURSOR;",
          "1268:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1265: #line 1266 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1263: #line 1264 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "1285:  if (yych <= '9') goto yy97;",
          "1286:  if (yych != ';') goto yy18;",
          "1287:  ++YYCURSOR;",
          "1289:  {",
          "1290:  zend_long id;",
          "",
          "[Removed Lines]",
          "1288: #line 517 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1286: #line 515 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 25 ---",
          "[Context before]",
          "1308:  return 1;",
          "1309: }",
          "1311: }",
          "1315:  return 0;",
          "",
          "[Removed Lines]",
          "1310: #line 1311 \"ext/standard/var_unserializer.c\"",
          "1312: #line 862 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1308: #line 1309 \"ext/standard/var_unserializer.c\"",
          "1310: #line 860 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "370:     if (Z_TYPE_P(old_data) == IS_INDIRECT) {",
          "371:      old_data = Z_INDIRECT_P(old_data);",
          "372:     }",
          "374:     var_push_dtor(var_hash, old_data);",
          "376:    }",
          "378:   }",
          "380:   zval_dtor(&key);",
          "",
          "[Removed Lines]",
          "373:     zval_ptr_dtor(old_data);",
          "375:     ZVAL_UNDEF(old_data);",
          "377:    data = zend_hash_update(ht, Z_STR(key), &d);",
          "",
          "[Added Lines]",
          "375:    data = zend_hash_update_ind(ht, Z_STR(key), &d);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "5602f6421372848a6fbb23fbe6bbca47d94dd49a",
      "candidate_info": {
        "commit_hash": "5602f6421372848a6fbb23fbe6bbca47d94dd49a",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/5602f6421372848a6fbb23fbe6bbca47d94dd49a",
        "files": [
          "ext/dba/php_dba.h",
          "ext/exif/exif.c",
          "ext/mysqlnd/mysqlnd_priv.h",
          "ext/readline/readline.c",
          "ext/soap/php_http.c",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re",
          "main/php_streams.h",
          "sapi/phpdbg/phpdbg_wait.c"
        ],
        "message": "Eliminate usages of _PP macros\n\nThese are either in debug code (fix them), commented out (drop\nthem) or in dead compatibility macros (drop them).\n\nOne usage was in php_stream_get_from_zval(), which we have not used\nsince at least PHP 5.2 and, judging from the fact that nobody\ncomplained about it causing compile errors in PHP 7, nobody else\nuses it either, so drop it.\n\nThere are still remaining uses in mysqli embedded and odbc birdstep.\nThese probably need to be dropped outright.",
        "before_after_code_files": [
          "ext/dbphp_dba.h||ext/dba/php_dba.h",
          "ext/exif/exif.c||ext/exif/exif.c",
          "ext/mysqlnd/mysqlnd_priv.h||ext/mysqlnd/mysqlnd_priv.h",
          "ext/readline/readline.c||ext/readline/readline.c",
          "ext/soap/php_http.c||ext/soap/php_http.c",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re",
          "main/php_streams.h||main/php_streams.h",
          "sapi/phpdbg/phpdbg_wait.c||sapi/phpdbg/phpdbg_wait.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/dbphp_dba.h||ext/dba/php_dba.h": [
          "File: ext/dbphp_dba.h -> ext/dba/php_dba.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "ext/exif/exif.c||ext/exif/exif.c": [
          "File: ext/exif/exif.c -> ext/exif/exif.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "4074:  exif_discard_imageinfo(&ImageInfo);",
          "4076: #ifdef EXIF_DEBUG",
          "4078: #endif",
          "4079: }",
          "",
          "[Removed Lines]",
          "4077:  php_error_docref1(NULL, Z_STRVAL_PP(p_name), E_NOTICE, \"done\");",
          "",
          "[Added Lines]",
          "4077:  php_error_docref1(NULL, p_name, E_NOTICE, \"done\");",
          "",
          "---------------"
        ],
        "ext/mysqlnd/mysqlnd_priv.h||ext/mysqlnd/mysqlnd_priv.h": [
          "File: ext/mysqlnd/mysqlnd_priv.h -> ext/mysqlnd/mysqlnd_priv.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "23: #ifndef MYSQLND_PRIV_H",
          "24: #define MYSQLND_PRIV_H",
          "36: #ifdef ZTS",
          "37: #include \"TSRM.h\"",
          "38: #endif",
          "44: #define MYSQLND_STR_W_LEN(str)  str, (sizeof(str) - 1)",
          "46: #define MYSQLND_DEBUG_DUMP_TIME    1",
          "",
          "[Removed Lines]",
          "26: #ifndef Z_ADDREF_P",
          "28: #define Z_ADDREF_P(pz)    (++(pz)->refcount)",
          "29: #define Z_DELREF_P(pz)    (--(pz)->refcount)",
          "30: #define Z_REFCOUNT_P(pz)   ((pz)->refcount)",
          "31: #define Z_SET_REFCOUNT_P(pz, rc) ((pz)->refcount = rc)",
          "32: #define Z_REFCOUNT_PP(ppz)   Z_REFCOUNT_P(*(ppz))",
          "33: #define Z_DELREF_PP(ppz)   Z_DELREF_P(*(ppz))",
          "34: #endif",
          "40: #ifndef pestrndup",
          "41: #define pestrndup(s, length, persistent) ((persistent)?zend_strndup((s),(length)):estrndup((s),(length)))",
          "42: #endif",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "ext/readline/readline.c||ext/readline/readline.c": [
          "File: ext/readline/readline.c -> ext/readline/readline.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "305:    oldval = rl_erase_empty_line;",
          "306:    if (value) {",
          "307:     convert_to_long_ex(value);",
          "309:    }",
          "310:    RETVAL_LONG(oldval);",
          "311: #endif",
          "",
          "[Removed Lines]",
          "308:     rl_erase_empty_line = Z_LVAL_PP(value);",
          "",
          "[Added Lines]",
          "308:     rl_erase_empty_line = Z_LVAL_P(value);",
          "",
          "---------------"
        ],
        "ext/soap/php_http.c||ext/soap/php_http.c": [
          "File: ext/soap/php_http.c -> ext/soap/php_http.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "700:       PHP_MD5Update(&md5ctx, (unsigned char*)phpurl->query, strlen(phpurl->query));",
          "701:      }",
          "713:      PHP_MD5Final(hash, &md5ctx);",
          "714:      make_digest(HA2, hash);",
          "",
          "[Removed Lines]",
          "705:      if (zend_hash_find(Z_ARRVAL_PP(digest), \"qop\", sizeof(\"qop\"), (void **)&tmp) == SUCCESS &&",
          "706:          Z_TYPE_PP(tmp) == IS_STRING &&",
          "707:          Z_STRLEN_PP(tmp) == sizeof(\"auth-int\")-1 &&",
          "708:          stricmp(Z_STRVAL_PP(tmp), \"auth-int\") == 0) {",
          "709:       PHP_MD5Update(&md5ctx, \":\", 1);",
          "710:       PHP_MD5Update(&md5ctx, HEntity, HASHHEXLEN);",
          "711:      }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "44: {",
          "45:  var_entries *var_hash = (*var_hashx)->last;",
          "46: #if VAR_ENTRIES_DBG",
          "48: #endif",
          "50:  if (!var_hash || var_hash->used_slots == VAR_ENTRIES_MAX) {",
          "",
          "[Removed Lines]",
          "47:  fprintf(stderr, \"var_push(%ld): %d\\n\", var_hash?var_hash->used_slots:-1L, Z_TYPE_PP(rval));",
          "",
          "[Added Lines]",
          "47:  fprintf(stderr, \"var_push(%ld): %d\\n\", var_hash?var_hash->used_slots:-1L, Z_TYPE_P(rval));",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "104:  zend_long i;",
          "105:  var_entries *var_hash = (*var_hashx)->first;",
          "106: #if VAR_ENTRIES_DBG",
          "108: #endif",
          "110:  while (var_hash) {",
          "",
          "[Removed Lines]",
          "107:  fprintf(stderr, \"var_replace(%ld): %d\\n\", var_hash?var_hash->used_slots:-1L, Z_TYPE_PP(nzval));",
          "",
          "[Added Lines]",
          "107:  fprintf(stderr, \"var_replace(%ld): %d\\n\", var_hash?var_hash->used_slots:-1L, Z_TYPE_P(nzval));",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "651:  if (yybm[0+yych] & 128) {",
          "652:   goto yy20;",
          "653:  }",
          "656:  yych = *++YYCURSOR;",
          "657:  if (yych != '\"') goto yy18;",
          "658:  ++YYCURSOR;",
          "",
          "[Removed Lines]",
          "654:  if (yych <= '/') goto yy18;",
          "655:  if (yych >= ';') goto yy18;",
          "",
          "[Added Lines]",
          "654:  if (yych != ':') goto yy18;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "802:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "803: }",
          "805: yy25:",
          "806:  yych = *++YYCURSOR;",
          "807:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "804: #line 805 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "803: #line 804 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "833:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "834:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "835: }",
          "837: yy32:",
          "838:  yych = *++YYCURSOR;",
          "839:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "836: #line 837 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "835: #line 836 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "879:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "880: }",
          "882: yy39:",
          "883:  yych = *++YYCURSOR;",
          "884:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "881: #line 882 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "880: #line 881 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "927:  ZVAL_STR(rval, str);",
          "928:  return 1;",
          "929: }",
          "931: yy46:",
          "932:  yych = *++YYCURSOR;",
          "933:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "930: #line 931 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "929: #line 930 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "975:  ZVAL_STRINGL(rval, str, len);",
          "976:  return 1;",
          "977: }",
          "979: yy53:",
          "980:  yych = *++YYCURSOR;",
          "981:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "978: #line 979 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "977: #line 978 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "1072:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1073:  return 1;",
          "1074: }",
          "1076: yy65:",
          "1077:  yych = *++YYCURSOR;",
          "1078:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1075: #line 1076 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1074: #line 1075 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "1148:  return 1;",
          "1149: }",
          "1151: yy76:",
          "1152:  yych = *++YYCURSOR;",
          "1153:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1150: #line 1151 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1149: #line 1150 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "1200:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1201:  return 1;",
          "1202: }",
          "1204: yy83:",
          "1205:  yych = *++YYCURSOR;",
          "1206:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1203: #line 1204 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1202: #line 1203 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "1214:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1215:  return 1;",
          "1216: }",
          "1218: yy87:",
          "1219:  ++YYCURSOR;",
          "1220: #line 573 \"ext/standard/var_unserializer.re\"",
          "",
          "[Removed Lines]",
          "1217: #line 1218 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1216: #line 1217 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "1223:  ZVAL_NULL(rval);",
          "1224:  return 1;",
          "1225: }",
          "1227: yy89:",
          "1228:  yych = *++YYCURSOR;",
          "1229:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1226: #line 1227 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1225: #line 1226 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "1272:  return 1;",
          "1273: }",
          "1275: yy95:",
          "1276:  yych = *++YYCURSOR;",
          "1277:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1274: #line 1275 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1273: #line 1274 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1321:  return 1;",
          "1322: }",
          "1324: }",
          "1325: #line 875 \"ext/standard/var_unserializer.re\"",
          "",
          "[Removed Lines]",
          "1323: #line 1324 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1322: #line 1323 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "42: {",
          "43:  var_entries *var_hash = (*var_hashx)->last;",
          "44: #if VAR_ENTRIES_DBG",
          "46: #endif",
          "48:  if (!var_hash || var_hash->used_slots == VAR_ENTRIES_MAX) {",
          "",
          "[Removed Lines]",
          "45:  fprintf(stderr, \"var_push(%ld): %d\\n\", var_hash?var_hash->used_slots:-1L, Z_TYPE_PP(rval));",
          "",
          "[Added Lines]",
          "45:  fprintf(stderr, \"var_push(%ld): %d\\n\", var_hash?var_hash->used_slots:-1L, Z_TYPE_P(rval));",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "102:  zend_long i;",
          "103:  var_entries *var_hash = (*var_hashx)->first;",
          "104: #if VAR_ENTRIES_DBG",
          "106: #endif",
          "108:  while (var_hash) {",
          "",
          "[Removed Lines]",
          "105:  fprintf(stderr, \"var_replace(%ld): %d\\n\", var_hash?var_hash->used_slots:-1L, Z_TYPE_PP(nzval));",
          "",
          "[Added Lines]",
          "105:  fprintf(stderr, \"var_replace(%ld): %d\\n\", var_hash?var_hash->used_slots:-1L, Z_TYPE_P(nzval));",
          "",
          "---------------"
        ],
        "main/php_streams.h||main/php_streams.h": [
          "File: main/php_streams.h -> main/php_streams.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "568: #define php_stream_open_wrapper(path, mode, options, opened) _php_stream_open_wrapper_ex((path), (mode), (options), (opened), NULL STREAMS_CC)",
          "569: #define php_stream_open_wrapper_ex(path, mode, options, opened, context) _php_stream_open_wrapper_ex((path), (mode), (options), (opened), (context) STREAMS_CC)",
          "578: PHPAPI void php_stream_wrapper_log_error(php_stream_wrapper *wrapper, int options, const char *fmt, ...) PHP_ATTRIBUTE_FORMAT(printf, 3, 4);",
          "",
          "[Removed Lines]",
          "571: #define php_stream_get_from_zval(stream, zstream, mode, options, opened, context) \\",
          "572:   if (Z_TYPE_PP((zstream)) == IS_RESOURCE) { \\",
          "573:    php_stream_from_zval((stream), (zstream)); \\",
          "574:   } else (stream) = Z_TYPE_PP((zstream)) == IS_STRING ?  \\",
          "575:    php_stream_open_wrapper_ex(Z_STRVAL_PP((zstream)), (mode), (options), (opened), (context)) : NULL",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "sapi/phpdbg/phpdbg_wait.c||sapi/phpdbg/phpdbg_wait.c": [
          "File: sapi/phpdbg/phpdbg_wait.c -> sapi/phpdbg/phpdbg_wait.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "281:     pefree(elm, zend_extensions.persistent);",
          "282:     zend_extensions.count--;",
          "283:    } else {",
          "289:     zend_hash_del(Z_ARRVAL_P(zvp), strkey);",
          "290:    }",
          "291:   }",
          "",
          "[Removed Lines]",
          "285:     if (Z_TYPE(key) == IS_LONG) {",
          "286:      zend_hash_index_del(Z_ARRVAL_PP(zvpp), Z_LVAL(key));",
          "287:     }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "b7052ef16dccd5858626bb7899193cdc16853861",
      "candidate_info": {
        "commit_hash": "b7052ef16dccd5858626bb7899193cdc16853861",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/b7052ef16dccd5858626bb7899193cdc16853861",
        "files": [
          "ext/standard/php_var.h",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Revert \"Fixed unserialize implementation (it's complicated, this issue took me 4 hours :<, need some review)\"\n\nThis reverts commit 80a178015d6b162ff0ba7a8e8f5a08c88829cc3c.",
        "before_after_code_files": [
          "ext/standard/php_var.h||ext/standard/php_var.h",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/php_var.h||ext/standard/php_var.h": [
          "File: ext/standard/php_var.h -> ext/standard/php_var.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "113:  } \\",
          "114: } while (0)",
          "116: PHPAPI void var_push_dtor(php_unserialize_data_t *var_hash, zval *val);",
          "117: PHPAPI void var_push_dtor_no_addref(php_unserialize_data_t *var_hashx, zval *rval);",
          "118: PHPAPI void var_destroy(php_unserialize_data_t *var_hash);",
          "120: PHPAPI zend_class_entry *php_create_empty_class(char *class_name, int len);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "116: PHPAPI void var_replace(php_unserialize_data_t *var_hash, zval *ozval, zval *nzval);",
          "121: #define PHP_VAR_UNSERIALIZE_ZVAL_CHANGED(var_hash, ozval, nzval) \\",
          "122:  var_replace((var_hash), (ozval), &(nzval))",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "29: #define VAR_ENTRIES_DBG 0",
          "31: typedef struct {",
          "33:  long used_slots;",
          "34:  void *next;",
          "35: } var_entries;",
          "",
          "[Removed Lines]",
          "32:  zval data[VAR_ENTRIES_MAX];",
          "",
          "[Added Lines]",
          "32:  zval *data[VAR_ENTRIES_MAX];",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "55:   (*var_hashx)->last = var_hash;",
          "56:  }",
          "60: }",
          "62: PHPAPI void var_push_dtor(php_unserialize_data_t *var_hashx, zval *rval)",
          "",
          "[Removed Lines]",
          "58:  ZVAL_COPY_VALUE(&var_hash->data[var_hash->used_slots], rval);",
          "59:  var_hash->used_slots++;",
          "",
          "[Added Lines]",
          "58:  var_hash->data[var_hash->used_slots++] = rval;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "80:   (*var_hashx)->last_dtor = var_hash;",
          "81:  }",
          "85: }",
          "87: PHPAPI void var_push_dtor_no_addref(php_unserialize_data_t *var_hashx, zval *rval)",
          "",
          "[Removed Lines]",
          "83:  ZVAL_COPY(&var_hash->data[var_hash->used_slots], rval);",
          "84:  var_hash->used_slots++;",
          "",
          "[Added Lines]",
          "82:  Z_ADDREF_P(rval);",
          "83:  var_hash->data[var_hash->used_slots++] = rval;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "105:   (*var_hashx)->last_dtor = var_hash;",
          "106:  }",
          "110: }",
          "112: static int var_access(php_unserialize_data_t *var_hashx, long id, zval **store)",
          "",
          "[Removed Lines]",
          "108:  ZVAL_COPY_VALUE(&var_hash->data[var_hash->used_slots], rval);",
          "109:  var_hash->used_slots++;",
          "",
          "[Added Lines]",
          "107:  var_hash->data[var_hash->used_slots++] = rval;",
          "108: }",
          "110: PHPAPI void var_replace(php_unserialize_data_t *var_hashx, zval *ozval, zval *nzval)",
          "111: {",
          "112:  long i;",
          "113:  var_entries *var_hash = (*var_hashx)->first;",
          "114: #if VAR_ENTRIES_DBG",
          "115:  fprintf(stderr, \"var_replace(%ld): %d\\n\", var_hash?var_hash->used_slots:-1L, Z_TYPE_PP(nzval));",
          "116: #endif",
          "118:  while (var_hash) {",
          "119:   for (i = 0; i < var_hash->used_slots; i++) {",
          "120:    if (var_hash->data[i] == ozval) {",
          "121:     var_hash->data[i] = nzval;",
          "123:    }",
          "124:   }",
          "125:   var_hash = var_hash->next;",
          "126:  }",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "150:  while (var_hash) {",
          "151:   for (i = 0; i < var_hash->used_slots; i++) {",
          "153:   }",
          "154:   next = var_hash->next;",
          "155:   efree(var_hash);",
          "",
          "[Removed Lines]",
          "152:    zval_ptr_dtor(&var_hash->data[i]);",
          "",
          "[Added Lines]",
          "169:    zval_ptr_dtor(var_hash->data[i]);",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "209: #define YYMARKER marker",
          "",
          "[Removed Lines]",
          "212: #line 217 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "229: #line 234 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "282:    return 0;",
          "283:   }",
          "290:   if (Z_TYPE(key) != IS_LONG && Z_TYPE(key) != IS_STRING) {",
          "291:    zval_dtor(&key);",
          "292:    return 0;",
          "",
          "[Removed Lines]",
          "285:   if (var_hash && !Z_ISREF(key)) {",
          "286:    var_push(var_hash, &key);",
          "287:   }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "298:    return 0;",
          "299:   }",
          "305:   if (!objprops) {",
          "306:    switch (Z_TYPE(key)) {",
          "307:    case IS_LONG:",
          "",
          "[Removed Lines]",
          "301:   if (var_hash && !Z_ISREF(data)) {",
          "302:    var_push(var_hash, &data);",
          "303:   }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "428:   return 0;",
          "429:  }",
          "431:  start = cursor;",
          "437: {",
          "438:  YYCTYPE yych;",
          "439:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "436: #line 437 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "439:  if (var_hash && cursor[0] != 'R') {",
          "440:   var_push(var_hash, rval);",
          "441:  }",
          "448: #line 449 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "493:  yych = *(YYMARKER = ++YYCURSOR);",
          "494:  if (yych == ':') goto yy95;",
          "495: yy3:",
          "497:  { return 0; }",
          "499: yy4:",
          "500:  yych = *(YYMARKER = ++YYCURSOR);",
          "501:  if (yych == ':') goto yy89;",
          "",
          "[Removed Lines]",
          "496: #line 774 \"ext/standard/var_unserializer.re\"",
          "498: #line 499 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "508: #line 786 \"ext/standard/var_unserializer.re\"",
          "510: #line 511 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "538:  goto yy3;",
          "539: yy14:",
          "540:  ++YYCURSOR;",
          "542:  {",
          "544:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
          "546: }",
          "548: yy16:",
          "549:  yych = *++YYCURSOR;",
          "550:  goto yy3;",
          "",
          "[Removed Lines]",
          "541: #line 768 \"ext/standard/var_unserializer.re\"",
          "547: #line 548 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "553: #line 780 \"ext/standard/var_unserializer.re\"",
          "559: #line 560 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "574:  yych = *++YYCURSOR;",
          "575:  if (yych != '\"') goto yy18;",
          "576:  ++YYCURSOR;",
          "578:  {",
          "579:  size_t len, len2, len3, maxlen;",
          "580:  long elements;",
          "",
          "[Removed Lines]",
          "577: #line 629 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "589: #line 641 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "714:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "715: }",
          "717: yy25:",
          "718:  yych = *++YYCURSOR;",
          "719:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "716: #line 717 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "728: #line 729 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "738:  yych = *++YYCURSOR;",
          "739:  if (yych != '\"') goto yy18;",
          "740:  ++YYCURSOR;",
          "742:  {",
          "",
          "[Removed Lines]",
          "741: #line 621 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "753: #line 633 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "746:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "747:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "748: }",
          "750: yy32:",
          "751:  yych = *++YYCURSOR;",
          "752:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "749: #line 750 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "761: #line 762 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "767:  yych = *++YYCURSOR;",
          "768:  if (yych != '{') goto yy18;",
          "769:  ++YYCURSOR;",
          "771:  {",
          "772:  long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "770: #line 603 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "782: #line 615 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "786:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "787: }",
          "789: yy39:",
          "790:  yych = *++YYCURSOR;",
          "791:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "788: #line 789 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "800: #line 801 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "806:  yych = *++YYCURSOR;",
          "807:  if (yych != '\"') goto yy18;",
          "808:  ++YYCURSOR;",
          "810:  {",
          "811:  size_t len, maxlen;",
          "812:  char *str;",
          "",
          "[Removed Lines]",
          "809: #line 574 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "821: #line 586 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "835:  ZVAL_STRINGL(rval, str, len);",
          "836:  return 1;",
          "837: }",
          "839: yy46:",
          "840:  yych = *++YYCURSOR;",
          "841:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "838: #line 839 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "850: #line 851 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "856:  yych = *++YYCURSOR;",
          "857:  if (yych != '\"') goto yy18;",
          "858:  ++YYCURSOR;",
          "860:  {",
          "861:  size_t len, maxlen;",
          "862:  char *str;",
          "",
          "[Removed Lines]",
          "859: #line 547 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "871: #line 559 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "883:  ZVAL_STRINGL(rval, str, len);",
          "884:  return 1;",
          "885: }",
          "887: yy53:",
          "888:  yych = *++YYCURSOR;",
          "889:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "886: #line 887 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "898: #line 899 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "971:  }",
          "972: yy63:",
          "973:  ++YYCURSOR;",
          "975:  {",
          "976: #if SIZEOF_LONG == 4",
          "977: use_double:",
          "",
          "[Removed Lines]",
          "974: #line 538 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "986: #line 550 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "980:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "981:  return 1;",
          "982: }",
          "984: yy65:",
          "985:  yych = *++YYCURSOR;",
          "986:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "983: #line 984 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "995: #line 996 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "1039:  yych = *++YYCURSOR;",
          "1040:  if (yych != ';') goto yy18;",
          "1041:  ++YYCURSOR;",
          "1043:  {",
          "",
          "[Removed Lines]",
          "1042: #line 522 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1054: #line 534 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 25 ---",
          "[Context before]",
          "1056:  return 1;",
          "1057: }",
          "1059: yy76:",
          "1060:  yych = *++YYCURSOR;",
          "1061:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1058: #line 1059 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1070: #line 1071 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 26 ---",
          "[Context before]",
          "1082:  if (yych <= '9') goto yy79;",
          "1083:  if (yych != ';') goto yy18;",
          "1084:  ++YYCURSOR;",
          "1086:  {",
          "1087: #if SIZEOF_LONG == 4",
          "1088:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1085: #line 496 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1097: #line 508 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 27 ---",
          "[Context before]",
          "1108:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1109:  return 1;",
          "1110: }",
          "1112: yy83:",
          "1113:  yych = *++YYCURSOR;",
          "1114:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1111: #line 1112 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1123: #line 1124 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 28 ---",
          "[Context before]",
          "1116:  yych = *++YYCURSOR;",
          "1117:  if (yych != ';') goto yy18;",
          "1118:  ++YYCURSOR;",
          "1120:  {",
          "1122:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1123:  return 1;",
          "1124: }",
          "1126: yy87:",
          "1127:  ++YYCURSOR;",
          "1129:  {",
          "1131:  ZVAL_NULL(rval);",
          "1132:  return 1;",
          "1133: }",
          "1135: yy89:",
          "1136:  yych = *++YYCURSOR;",
          "1137:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1119: #line 490 \"ext/standard/var_unserializer.re\"",
          "1125: #line 1126 \"ext/standard/var_unserializer.c\"",
          "1128: #line 484 \"ext/standard/var_unserializer.re\"",
          "1134: #line 1135 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1131: #line 502 \"ext/standard/var_unserializer.re\"",
          "1137: #line 1138 \"ext/standard/var_unserializer.c\"",
          "1140: #line 496 \"ext/standard/var_unserializer.re\"",
          "1146: #line 1147 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 29 ---",
          "[Context before]",
          "1154:  if (yych <= '9') goto yy91;",
          "1155:  if (yych != ';') goto yy18;",
          "1156:  ++YYCURSOR;",
          "1158:  {",
          "1159:  long id;",
          "",
          "[Removed Lines]",
          "1157: #line 461 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1169: #line 473 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 30 ---",
          "[Context before]",
          "1178:  return 1;",
          "1179: }",
          "1181: yy95:",
          "1182:  yych = *++YYCURSOR;",
          "1183:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1180: #line 1181 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1192: #line 1193 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 31 ---",
          "[Context before]",
          "1200:  if (yych <= '9') goto yy97;",
          "1201:  if (yych != ';') goto yy18;",
          "1202:  ++YYCURSOR;",
          "1204:  {",
          "1205:  long id;",
          "",
          "[Removed Lines]",
          "1203: #line 441 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1215: #line 453 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 32 ---",
          "[Context before]",
          "1221:  return 1;",
          "1222: }",
          "1224: }",
          "1228:  return 0;",
          "",
          "[Removed Lines]",
          "1223: #line 1224 \"ext/standard/var_unserializer.c\"",
          "1225: #line 776 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1235: #line 1236 \"ext/standard/var_unserializer.c\"",
          "1237: #line 788 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "27: #define VAR_ENTRIES_DBG 0",
          "29: typedef struct {",
          "31:  long used_slots;",
          "32:  void *next;",
          "33: } var_entries;",
          "",
          "[Removed Lines]",
          "30:  zval data[VAR_ENTRIES_MAX];",
          "",
          "[Added Lines]",
          "30:  zval *data[VAR_ENTRIES_MAX];",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "53:   (*var_hashx)->last = var_hash;",
          "54:  }",
          "58: }",
          "60: PHPAPI void var_push_dtor(php_unserialize_data_t *var_hashx, zval *rval)",
          "",
          "[Removed Lines]",
          "56:  ZVAL_COPY_VALUE(&var_hash->data[var_hash->used_slots], rval);",
          "57:  var_hash->used_slots++;",
          "",
          "[Added Lines]",
          "56:  var_hash->data[var_hash->used_slots++] = rval;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "78:   (*var_hashx)->last_dtor = var_hash;",
          "79:  }",
          "83: }",
          "85: PHPAPI void var_push_dtor_no_addref(php_unserialize_data_t *var_hashx, zval *rval)",
          "",
          "[Removed Lines]",
          "81:  ZVAL_COPY(&var_hash->data[var_hash->used_slots], rval);",
          "82:  var_hash->used_slots++;",
          "",
          "[Added Lines]",
          "80:  Z_ADDREF_P(rval);",
          "81:  var_hash->data[var_hash->used_slots++] = rval;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "103:   (*var_hashx)->last_dtor = var_hash;",
          "104:  }",
          "108: }",
          "110: static int var_access(php_unserialize_data_t *var_hashx, long id, zval **store)",
          "",
          "[Removed Lines]",
          "106:  ZVAL_COPY_VALUE(&var_hash->data[var_hash->used_slots], rval);",
          "107:  var_hash->used_slots++;",
          "",
          "[Added Lines]",
          "105:  var_hash->data[var_hash->used_slots++] = rval;",
          "106: }",
          "108: PHPAPI void var_replace(php_unserialize_data_t *var_hashx, zval *ozval, zval *nzval)",
          "109: {",
          "110:  long i;",
          "111:  var_entries *var_hash = (*var_hashx)->first;",
          "112: #if VAR_ENTRIES_DBG",
          "113:  fprintf(stderr, \"var_replace(%ld): %d\\n\", var_hash?var_hash->used_slots:-1L, Z_TYPE_PP(nzval));",
          "114: #endif",
          "116:  while (var_hash) {",
          "117:   for (i = 0; i < var_hash->used_slots; i++) {",
          "118:    if (var_hash->data[i] == ozval) {",
          "119:     var_hash->data[i] = nzval;",
          "121:    }",
          "122:   }",
          "123:   var_hash = var_hash->next;",
          "124:  }",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "148:  while (var_hash) {",
          "149:   for (i = 0; i < var_hash->used_slots; i++) {",
          "151:   }",
          "152:   next = var_hash->next;",
          "153:   efree(var_hash);",
          "",
          "[Removed Lines]",
          "150:    zval_ptr_dtor(&var_hash->data[i]);",
          "",
          "[Added Lines]",
          "167:    zval_ptr_dtor(var_hash->data[i]);",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "286:    return 0;",
          "287:   }",
          "294:   if (Z_TYPE(key) != IS_LONG && Z_TYPE(key) != IS_STRING) {",
          "295:    zval_dtor(&key);",
          "296:    return 0;",
          "",
          "[Removed Lines]",
          "289:   if (var_hash && !Z_ISREF(key)) {",
          "290:    var_push(var_hash, &key);",
          "291:   }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "302:    return 0;",
          "303:   }",
          "309:   if (!objprops) {",
          "310:    switch (Z_TYPE(key)) {",
          "311:    case IS_LONG:",
          "",
          "[Removed Lines]",
          "305:   if (var_hash && !Z_ISREF(data)) {",
          "306:    var_push(var_hash, &data);",
          "307:   }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "432:   return 0;",
          "433:  }",
          "435:  start = cursor;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "443:  if (var_hash && cursor[0] != 'R') {",
          "444:   var_push(var_hash, rval);",
          "445:  }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "9152214c1e20723f73b5f7b6c77b1183327bcf69",
      "candidate_info": {
        "commit_hash": "9152214c1e20723f73b5f7b6c77b1183327bcf69",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/9152214c1e20723f73b5f7b6c77b1183327bcf69",
        "files": [
          "ext/standard/tests/serialize/bug68594.phpt",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Merge branch 'PHP-5.6'\n\n* PHP-5.6:\n  update news\n  add CVE\n  add missing test file\n  Fix bug #68594 - Use after free vulnerability in unserialize()\n\nConflicts:\n\text/standard/var_unserializer.c\n\text/standard/var_unserializer.re",
        "before_after_code_files": [
          "ext/standard/tests/serialize/bug68594.phpt||ext/standard/tests/serialize/bug68594.phpt",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/tests/serialize/bug68594.phpt||ext/standard/tests/serialize/bug68594.phpt": [
          "File: ext/standard/tests/serialize/bug68594.phpt -> ext/standard/tests/serialize/bug68594.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #68545 Use after free vulnerability in unserialize()",
          "3: --FILE--",
          "4: <?php",
          "5: for ($i=4; $i<100; $i++) {",
          "6:  $m = new StdClass();",
          "8:  $u = array(1);",
          "10:  $m->aaa = array(1,2,&$u,4,5);",
          "11:  $m->bbb = 1;",
          "12:  $m->ccc = &$u;",
          "13:  $m->ddd = str_repeat(\"A\", $i);",
          "15:  $z = serialize($m);",
          "16:  $z = str_replace(\"bbb\", \"aaa\", $z);",
          "17:  $y = unserialize($z);",
          "18:  $z = serialize($y);",
          "19: }",
          "20: ?>",
          "21: ===DONE===",
          "22: --EXPECTF--",
          "23: ===DONE===",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "362:   } else {",
          "364:    convert_to_string(&key);",
          "372:     }",
          "380:   }",
          "382:   zval_dtor(&key);",
          "",
          "[Removed Lines]",
          "366: #if 1",
          "367:    data = zend_hash_update_ind(ht, Z_STR(key), &d);",
          "368: #else",
          "369:    if ((data = zend_hash_find(ht, Z_STR(key))) != NULL) {",
          "370:     if (Z_TYPE_P(data) == IS_INDIRECT) {",
          "371:      data = Z_INDIRECT_P(data);",
          "373:     zval_ptr_dtor(data);",
          "375:     ZVAL_UNDEF(data);",
          "376:    } else {",
          "377:     data = zend_hash_update(ht, Z_STR(key), &d);",
          "378:    }",
          "379: #endif",
          "",
          "[Added Lines]",
          "365:    if ((old_data = zend_hash_find(ht, Z_STR(key))) != NULL) {",
          "366:     if (Z_TYPE_P(old_data) == IS_INDIRECT) {",
          "367:      old_data = Z_INDIRECT_P(old_data);",
          "369:     zval_ptr_dtor(old_data);",
          "370:     var_push_dtor(var_hash, old_data);",
          "371:     ZVAL_UNDEF(old_data);",
          "372:    }",
          "373:    data = zend_hash_update(ht, Z_STR(key), &d);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "515:  start = cursor;",
          "519: {",
          "520:  YYCTYPE yych;",
          "521:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "518: #line 519 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "512: #line 513 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "575:  yych = *(YYMARKER = ++YYCURSOR);",
          "576:  if (yych == ':') goto yy95;",
          "577: yy3:",
          "579:  { return 0; }",
          "581: yy4:",
          "582:  yych = *(YYMARKER = ++YYCURSOR);",
          "583:  if (yych == ':') goto yy89;",
          "",
          "[Removed Lines]",
          "578: #line 866 \"ext/standard/var_unserializer.re\"",
          "580: #line 581 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "572: #line 860 \"ext/standard/var_unserializer.re\"",
          "574: #line 575 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "620:  goto yy3;",
          "621: yy14:",
          "622:  ++YYCURSOR;",
          "624:  {",
          "626:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
          "628: }",
          "630: yy16:",
          "631:  yych = *++YYCURSOR;",
          "632:  goto yy3;",
          "",
          "[Removed Lines]",
          "623: #line 860 \"ext/standard/var_unserializer.re\"",
          "629: #line 630 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "617: #line 854 \"ext/standard/var_unserializer.re\"",
          "623: #line 624 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "652:  if (yybm[0+yych] & 128) {",
          "653:   goto yy20;",
          "654:  }",
          "656:  yych = *++YYCURSOR;",
          "657:  if (yych != '\"') goto yy18;",
          "658:  ++YYCURSOR;",
          "660:  {",
          "661:  size_t len, len2, len3, maxlen;",
          "662:  zend_long elements;",
          "",
          "[Removed Lines]",
          "655:  if (yych != ':') goto yy18;",
          "659: #line 715 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "649:  if (yych <= '/') goto yy18;",
          "650:  if (yych >= ';') goto yy18;",
          "654: #line 709 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "802:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "803: }",
          "805: yy25:",
          "806:  yych = *++YYCURSOR;",
          "807:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "804: #line 805 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "799: #line 800 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "826:  yych = *++YYCURSOR;",
          "827:  if (yych != '\"') goto yy18;",
          "828:  ++YYCURSOR;",
          "830:  {",
          "",
          "[Removed Lines]",
          "829: #line 707 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "824: #line 701 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "834:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "835:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "836: }",
          "838: yy32:",
          "839:  yych = *++YYCURSOR;",
          "840:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "837: #line 838 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "832: #line 833 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "855:  yych = *++YYCURSOR;",
          "856:  if (yych != '{') goto yy18;",
          "857:  ++YYCURSOR;",
          "859:  {",
          "860:  zend_long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "858: #line 686 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "853: #line 680 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "877:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "878: }",
          "880: yy39:",
          "881:  yych = *++YYCURSOR;",
          "882:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "879: #line 880 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "874: #line 875 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "897:  yych = *++YYCURSOR;",
          "898:  if (yych != '\"') goto yy18;",
          "899:  ++YYCURSOR;",
          "901:  {",
          "902:  size_t len, maxlen;",
          "903:  zend_string *str;",
          "",
          "[Removed Lines]",
          "900: #line 658 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "895: #line 652 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "925:  ZVAL_STR(rval, str);",
          "926:  return 1;",
          "927: }",
          "929: yy46:",
          "930:  yych = *++YYCURSOR;",
          "931:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "928: #line 929 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "923: #line 924 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "946:  yych = *++YYCURSOR;",
          "947:  if (yych != '\"') goto yy18;",
          "948:  ++YYCURSOR;",
          "950:  {",
          "951:  size_t len, maxlen;",
          "952:  char *str;",
          "",
          "[Removed Lines]",
          "949: #line 631 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "944: #line 625 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "973:  ZVAL_STRINGL(rval, str, len);",
          "974:  return 1;",
          "975: }",
          "977: yy53:",
          "978:  yych = *++YYCURSOR;",
          "979:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "976: #line 977 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "971: #line 972 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1061:  }",
          "1062: yy63:",
          "1063:  ++YYCURSOR;",
          "1065:  {",
          "1066: #if SIZEOF_ZEND_LONG == 4",
          "1067: use_double:",
          "",
          "[Removed Lines]",
          "1064: #line 622 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1059: #line 616 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1070:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1071:  return 1;",
          "1072: }",
          "1074: yy65:",
          "1075:  yych = *++YYCURSOR;",
          "1076:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1073: #line 1074 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1068: #line 1069 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1129:  yych = *++YYCURSOR;",
          "1130:  if (yych != ';') goto yy18;",
          "1131:  ++YYCURSOR;",
          "1133:  {",
          "",
          "[Removed Lines]",
          "1132: #line 606 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1127: #line 600 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "1146:  return 1;",
          "1147: }",
          "1149: yy76:",
          "1150:  yych = *++YYCURSOR;",
          "1151:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1148: #line 1149 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1143: #line 1144 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1172:  if (yych <= '9') goto yy79;",
          "1173:  if (yych != ';') goto yy18;",
          "1174:  ++YYCURSOR;",
          "1176:  {",
          "1177: #if SIZEOF_ZEND_LONG == 4",
          "1178:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1175: #line 580 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1170: #line 574 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1198:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1199:  return 1;",
          "1200: }",
          "1202: yy83:",
          "1203:  yych = *++YYCURSOR;",
          "1204:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1201: #line 1202 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1196: #line 1197 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "1206:  yych = *++YYCURSOR;",
          "1207:  if (yych != ';') goto yy18;",
          "1208:  ++YYCURSOR;",
          "1210:  {",
          "1212:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1213:  return 1;",
          "1214: }",
          "1216: yy87:",
          "1217:  ++YYCURSOR;",
          "1219:  {",
          "1221:  ZVAL_NULL(rval);",
          "1222:  return 1;",
          "1223: }",
          "1225: yy89:",
          "1226:  yych = *++YYCURSOR;",
          "1227:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1209: #line 574 \"ext/standard/var_unserializer.re\"",
          "1215: #line 1216 \"ext/standard/var_unserializer.c\"",
          "1218: #line 568 \"ext/standard/var_unserializer.re\"",
          "1224: #line 1225 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1204: #line 568 \"ext/standard/var_unserializer.re\"",
          "1210: #line 1211 \"ext/standard/var_unserializer.c\"",
          "1213: #line 562 \"ext/standard/var_unserializer.re\"",
          "1219: #line 1220 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "1244:  if (yych <= '9') goto yy91;",
          "1245:  if (yych != ';') goto yy18;",
          "1246:  ++YYCURSOR;",
          "1248:  {",
          "1249:  zend_long id;",
          "",
          "[Removed Lines]",
          "1247: #line 545 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1242: #line 539 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "1268:  return 1;",
          "1269: }",
          "1271: yy95:",
          "1272:  yych = *++YYCURSOR;",
          "1273:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1270: #line 1271 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1265: #line 1266 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "1290:  if (yych <= '9') goto yy97;",
          "1291:  if (yych != ';') goto yy18;",
          "1292:  ++YYCURSOR;",
          "1294:  {",
          "1295:  zend_long id;",
          "",
          "[Removed Lines]",
          "1293: #line 523 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1288: #line 517 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 25 ---",
          "[Context before]",
          "1313:  return 1;",
          "1314: }",
          "1316: }",
          "1320:  return 0;",
          "",
          "[Removed Lines]",
          "1315: #line 1316 \"ext/standard/var_unserializer.c\"",
          "1317: #line 868 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1310: #line 1311 \"ext/standard/var_unserializer.c\"",
          "1312: #line 862 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "366:   } else {",
          "368:    convert_to_string(&key);",
          "376:     }",
          "384:   }",
          "386:   zval_dtor(&key);",
          "",
          "[Removed Lines]",
          "370: #if 1",
          "371:    data = zend_hash_update_ind(ht, Z_STR(key), &d);",
          "372: #else",
          "373:    if ((data = zend_hash_find(ht, Z_STR(key))) != NULL) {",
          "374:     if (Z_TYPE_P(data) == IS_INDIRECT) {",
          "375:      data = Z_INDIRECT_P(data);",
          "377:     zval_ptr_dtor(data);",
          "379:     ZVAL_UNDEF(data);",
          "380:    } else {",
          "381:     data = zend_hash_update(ht, Z_STR(key), &d);",
          "382:    }",
          "383: #endif",
          "",
          "[Added Lines]",
          "369:    if ((old_data = zend_hash_find(ht, Z_STR(key))) != NULL) {",
          "370:     if (Z_TYPE_P(old_data) == IS_INDIRECT) {",
          "371:      old_data = Z_INDIRECT_P(old_data);",
          "373:     zval_ptr_dtor(old_data);",
          "374:     var_push_dtor(var_hash, old_data);",
          "375:     ZVAL_UNDEF(old_data);",
          "376:    }",
          "377:    data = zend_hash_update(ht, Z_STR(key), &d);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "ba8f3ba05f8545a243881547dcd5a1dcfe4d4fb2",
      "candidate_info": {
        "commit_hash": "ba8f3ba05f8545a243881547dcd5a1dcfe4d4fb2",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/ba8f3ba05f8545a243881547dcd5a1dcfe4d4fb2",
        "files": [
          "Zend/zend_objects_API.c",
          "ext/standard/tests/serialize/bug73052.phpt",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Fix bug #73052 - Memory Corruption in During Deserialized-object Destruction",
        "before_after_code_files": [
          "Zend/zend_objects_API.c||Zend/zend_objects_API.c",
          "ext/standard/tests/serialize/bug73052.phpt||ext/standard/tests/serialize/bug73052.phpt",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "Zend/zend_objects_API.c||Zend/zend_objects_API.c",
            "ext/standard/tests/serialize/bug73052.phpt||ext/standard/tests/serialize/bug73052.phpt",
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "Zend/zend_objects_API.c||Zend/zend_objects_API.c",
            "ext/standard/tests/serialize/bug73052.phpt||ext/standard/tests/serialize/bug73052.phpt",
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "Zend/zend_objects_API.c||Zend/zend_objects_API.c": [
          "File: Zend/zend_objects_API.c -> Zend/zend_objects_API.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "306: {",
          "307:  zend_object_handle handle = Z_OBJ_HANDLE_P(zobject);",
          "308:  zend_object_store_bucket *obj_bucket = &EG(objects_store).object_buckets[handle];",
          "311:  obj_bucket->destructor_called = 1;",
          "312: }",
          "",
          "[Removed Lines]",
          "310:  obj_bucket->bucket.obj.handlers = Z_OBJ_HT_P(zobject);;",
          "",
          "[Added Lines]",
          "310:  obj_bucket->bucket.obj.handlers = Z_OBJ_HT_P(zobject);",
          "",
          "---------------"
        ],
        "ext/standard/tests/serialize/bug73052.phpt||ext/standard/tests/serialize/bug73052.phpt": [
          "File: ext/standard/tests/serialize/bug73052.phpt -> ext/standard/tests/serialize/bug73052.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #73052: Memory Corruption in During Deserialized-object Destruction",
          "3: --FILE--",
          "4: <?php",
          "6: class obj {",
          "7:     var $ryat;",
          "8:     public function __destruct() {",
          "9:         $this->ryat = null;",
          "10:     }",
          "11: }",
          "13: $poc = 'O:3:\"obj\":1:{';",
          "14: var_dump(unserialize($poc));",
          "15: ?>",
          "16: --EXPECTF--",
          "17: Notice: unserialize(): Error at offset 13 of 13 bytes in %sbug73052.php on line %d",
          "18: bool(false)",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "438:      if(Z_TYPE_PP(rval) == IS_OBJECT) {",
          "439:         zend_hash_clean(Z_OBJPROP_PP(rval));",
          "440:      }",
          "441:      ZVAL_NULL(*rval);",
          "442:   return 0;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "440:         zend_object_store_ctor_failed(*rval TSRMLS_CC);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "495: {",
          "496:  YYCTYPE yych;",
          "497:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "494: #line 495 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "495: #line 496 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "551:  yych = *(YYMARKER = ++YYCURSOR);",
          "552:  if (yych == ':') goto yy95;",
          "553: yy3:",
          "555:  { return 0; }",
          "557: yy4:",
          "558:  yych = *(YYMARKER = ++YYCURSOR);",
          "559:  if (yych == ':') goto yy89;",
          "",
          "[Removed Lines]",
          "554: #line 860 \"ext/standard/var_unserializer.re\"",
          "556: #line 557 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "555: #line 861 \"ext/standard/var_unserializer.re\"",
          "557: #line 558 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "596:  goto yy3;",
          "597: yy14:",
          "598:  ++YYCURSOR;",
          "600:  {",
          "602:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
          "604: }",
          "606: yy16:",
          "607:  yych = *++YYCURSOR;",
          "608:  goto yy3;",
          "",
          "[Removed Lines]",
          "599: #line 854 \"ext/standard/var_unserializer.re\"",
          "605: #line 606 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "600: #line 855 \"ext/standard/var_unserializer.re\"",
          "606: #line 607 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "633:  yych = *++YYCURSOR;",
          "634:  if (yych != '\"') goto yy18;",
          "635:  ++YYCURSOR;",
          "637:  {",
          "638:  size_t len, len2, len3, maxlen;",
          "639:  long elements;",
          "",
          "[Removed Lines]",
          "636: #line 707 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "637: #line 708 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "781:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "782: }",
          "784: yy25:",
          "785:  yych = *++YYCURSOR;",
          "786:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "783: #line 784 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "784: #line 785 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "805:  yych = *++YYCURSOR;",
          "806:  if (yych != '\"') goto yy18;",
          "807:  ++YYCURSOR;",
          "809:  {",
          "810:     if (!var_hash) return 0;",
          "",
          "[Removed Lines]",
          "808: #line 698 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "809: #line 699 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "814:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "815:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "816: }",
          "818: yy32:",
          "819:  yych = *++YYCURSOR;",
          "820:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "817: #line 818 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "818: #line 819 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "835:  yych = *++YYCURSOR;",
          "836:  if (yych != '{') goto yy18;",
          "837:  ++YYCURSOR;",
          "839:  {",
          "840:  long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "838: #line 677 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "839: #line 678 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "857:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "858: }",
          "860: yy39:",
          "861:  yych = *++YYCURSOR;",
          "862:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "859: #line 860 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "860: #line 861 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "877:  yych = *++YYCURSOR;",
          "878:  if (yych != '\"') goto yy18;",
          "879:  ++YYCURSOR;",
          "881:  {",
          "882:  size_t len, maxlen;",
          "883:  char *str;",
          "",
          "[Removed Lines]",
          "880: #line 642 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "881: #line 643 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "912:  ZVAL_STRINGL(*rval, str, len, 0);",
          "913:  return 1;",
          "914: }",
          "916: yy46:",
          "917:  yych = *++YYCURSOR;",
          "918:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "915: #line 916 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "916: #line 917 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "933:  yych = *++YYCURSOR;",
          "934:  if (yych != '\"') goto yy18;",
          "935:  ++YYCURSOR;",
          "937:  {",
          "938:  size_t len, maxlen;",
          "939:  char *str;",
          "",
          "[Removed Lines]",
          "936: #line 609 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "937: #line 610 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "966:  ZVAL_STRINGL(*rval, str, len, 1);",
          "967:  return 1;",
          "968: }",
          "970: yy53:",
          "971:  yych = *++YYCURSOR;",
          "972:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "969: #line 970 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "970: #line 971 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1054:  }",
          "1055: yy63:",
          "1056:  ++YYCURSOR;",
          "1058:  {",
          "1059: #if SIZEOF_LONG == 4",
          "1060: use_double:",
          "",
          "[Removed Lines]",
          "1057: #line 599 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1058: #line 600 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1064:  ZVAL_DOUBLE(*rval, zend_strtod((const char *)start + 2, NULL));",
          "1065:  return 1;",
          "1066: }",
          "1068: yy65:",
          "1069:  yych = *++YYCURSOR;",
          "1070:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1067: #line 1068 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1068: #line 1069 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1123:  yych = *++YYCURSOR;",
          "1124:  if (yych != ';') goto yy18;",
          "1125:  ++YYCURSOR;",
          "1127:  {",
          "1129:  INIT_PZVAL(*rval);",
          "",
          "[Removed Lines]",
          "1126: #line 584 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1127: #line 585 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "1139:  return 1;",
          "1140: }",
          "1142: yy76:",
          "1143:  yych = *++YYCURSOR;",
          "1144:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1141: #line 1142 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1142: #line 1143 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1165:  if (yych <= '9') goto yy79;",
          "1166:  if (yych != ';') goto yy18;",
          "1167:  ++YYCURSOR;",
          "1169:  {",
          "1170: #if SIZEOF_LONG == 4",
          "1171:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1168: #line 557 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1169: #line 558 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1192:  ZVAL_LONG(*rval, parse_iv(start + 2));",
          "1193:  return 1;",
          "1194: }",
          "1196: yy83:",
          "1197:  yych = *++YYCURSOR;",
          "1198:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1195: #line 1196 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1196: #line 1197 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "1200:  yych = *++YYCURSOR;",
          "1201:  if (yych != ';') goto yy18;",
          "1202:  ++YYCURSOR;",
          "1204:  {",
          "1206:  INIT_PZVAL(*rval);",
          "1207:  ZVAL_BOOL(*rval, parse_iv(start + 2));",
          "1208:  return 1;",
          "1209: }",
          "1211: yy87:",
          "1212:  ++YYCURSOR;",
          "1214:  {",
          "1216:  INIT_PZVAL(*rval);",
          "1217:  ZVAL_NULL(*rval);",
          "1218:  return 1;",
          "1219: }",
          "1221: yy89:",
          "1222:  yych = *++YYCURSOR;",
          "1223:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1203: #line 550 \"ext/standard/var_unserializer.re\"",
          "1210: #line 1211 \"ext/standard/var_unserializer.c\"",
          "1213: #line 543 \"ext/standard/var_unserializer.re\"",
          "1220: #line 1221 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1204: #line 551 \"ext/standard/var_unserializer.re\"",
          "1211: #line 1212 \"ext/standard/var_unserializer.c\"",
          "1214: #line 544 \"ext/standard/var_unserializer.re\"",
          "1221: #line 1222 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "1240:  if (yych <= '9') goto yy91;",
          "1241:  if (yych != ';') goto yy18;",
          "1242:  ++YYCURSOR;",
          "1244:  {",
          "1245:  long id;",
          "",
          "[Removed Lines]",
          "1243: #line 520 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1244: #line 521 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "1264:  return 1;",
          "1265: }",
          "1267: yy95:",
          "1268:  yych = *++YYCURSOR;",
          "1269:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1266: #line 1267 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1267: #line 1268 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "1286:  if (yych <= '9') goto yy97;",
          "1287:  if (yych != ';') goto yy18;",
          "1288:  ++YYCURSOR;",
          "1290:  {",
          "1291:  long id;",
          "",
          "[Removed Lines]",
          "1289: #line 499 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1290: #line 500 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 25 ---",
          "[Context before]",
          "1308:  return 1;",
          "1309: }",
          "1311: }",
          "1315:  return 0;",
          "",
          "[Removed Lines]",
          "1310: #line 1311 \"ext/standard/var_unserializer.c\"",
          "1312: #line 862 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1311: #line 1312 \"ext/standard/var_unserializer.c\"",
          "1313: #line 863 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "442:      if(Z_TYPE_PP(rval) == IS_OBJECT) {",
          "443:         zend_hash_clean(Z_OBJPROP_PP(rval));",
          "444:      }",
          "445:      ZVAL_NULL(*rval);",
          "446:   return 0;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "444:         zend_object_store_ctor_failed(*rval TSRMLS_CC);",
          "",
          "---------------"
        ]
      }
    }
  ]
}