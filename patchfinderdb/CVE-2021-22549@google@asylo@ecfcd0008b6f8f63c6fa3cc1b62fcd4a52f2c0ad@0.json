{
  "cve_id": "CVE-2021-22549",
  "cve_desc": "An attacker can modify the address to point to trusted memory to overwrite arbitrary trusted memory. It is recommended to update past 0.6.2 or git commit https://github.com/google/asylo/commit/53ed5d8fd8118ced1466e509606dd2f473707a5c",
  "repo": "google/asylo",
  "patch_hash": "ecfcd0008b6f8f63c6fa3cc1b62fcd4a52f2c0ad",
  "patch_info": {
    "commit_hash": "ecfcd0008b6f8f63c6fa3cc1b62fcd4a52f2c0ad",
    "repo": "google/asylo",
    "commit_url": "https://github.com/google/asylo/commit/ecfcd0008b6f8f63c6fa3cc1b62fcd4a52f2c0ad",
    "files": [
      "asylo/platform/primitives/sgx/trusted_sgx.cc"
    ],
    "message": "Store untrusted input to enclave variable\n\nThe untrusted input pointer should be stored to trusted variable before\nchecking to avoid unexpected modifications after checking.\n\nPiperOrigin-RevId: 362553830\nChange-Id: I743f9bd3487de60269e247d74f2188f2ffc06d01",
    "before_after_code_files": [
      "asylo/platform/primitives/sgx/trusted_sgx.cc||asylo/platform/primitives/sgx/trusted_sgx.cc"
    ]
  },
  "patch_diff": {
    "asylo/platform/primitives/sgx/trusted_sgx.cc||asylo/platform/primitives/sgx/trusted_sgx.cc": [
      "File: asylo/platform/primitives/sgx/trusted_sgx.cc -> asylo/platform/primitives/sgx/trusted_sgx.cc",
      "--- Hunk 1 ---",
      "[Context before]",
      "281:     if (sgx_params->input_size > 0) {",
      "283:       sgx_params->input = untrusted_cache->Malloc(sgx_params->input_size);",
      "286:         TrustedPrimitives::BestEffortAbort(",
      "287:             \"UntrustedCall: sgx_param input should be in untrusted memory\");",
      "288:       }",
      "290:     }",
      "291:   }",
      "292:   sgx_params->output_size = 0;",
      "",
      "[Removed Lines]",
      "284:       if (!TrustedPrimitives::IsOutsideEnclave(sgx_params->input,",
      "285:                                                sgx_params->input_size)) {",
      "289:       input->Serialize(const_cast<void *>(sgx_params->input));",
      "",
      "[Added Lines]",
      "284:       const void *input_pointer = sgx_params->input;",
      "285:       uint64_t input_size = sgx_params->input_size;",
      "286:       if (!TrustedPrimitives::IsOutsideEnclave(input_pointer, input_size)) {",
      "290:       input->Serialize(const_cast<void *>(input_pointer));",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "83e145f0384ca3fc63d1406476254f70ee1adbff",
      "candidate_info": {
        "commit_hash": "83e145f0384ca3fc63d1406476254f70ee1adbff",
        "repo": "google/asylo",
        "commit_url": "https://github.com/google/asylo/commit/83e145f0384ca3fc63d1406476254f70ee1adbff",
        "files": [
          "asylo/platform/primitives/sgx/trusted_sgx.cc"
        ],
        "message": "Check sgx_param input is outside enclave\n\nPiperOrigin-RevId: 346450518\nChange-Id: I53e6a3a6de581d1696ccfd801c35b4b9711fe9c8",
        "before_after_code_files": [
          "asylo/platform/primitives/sgx/trusted_sgx.cc||asylo/platform/primitives/sgx/trusted_sgx.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "asylo/platform/primitives/sgx/trusted_sgx.cc||asylo/platform/primitives/sgx/trusted_sgx.cc"
          ],
          "candidate": [
            "asylo/platform/primitives/sgx/trusted_sgx.cc||asylo/platform/primitives/sgx/trusted_sgx.cc"
          ]
        }
      },
      "candidate_diff": {
        "asylo/platform/primitives/sgx/trusted_sgx.cc||asylo/platform/primitives/sgx/trusted_sgx.cc": [
          "File: asylo/platform/primitives/sgx/trusted_sgx.cc -> asylo/platform/primitives/sgx/trusted_sgx.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "282:     if (sgx_params->input_size > 0) {",
          "284:       sgx_params->input = untrusted_cache->Malloc(sgx_params->input_size);",
          "285:       input->Serialize(const_cast<void *>(sgx_params->input));",
          "286:     }",
          "287:   }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "285:       if (!TrustedPrimitives::IsOutsideEnclave(sgx_params->input,",
          "286:                                                sgx_params->input_size)) {",
          "287:         TrustedPrimitives::BestEffortAbort(",
          "288:             \"UntrustedCall: sgx_param input should be in untrusted memory\");",
          "289:       }",
          "",
          "---------------"
        ]
      }
    }
  ]
}