{
  "cve_id": "CVE-2016-5099",
  "cve_desc": "Cross-site scripting (XSS) vulnerability in phpMyAdmin 4.4.x before 4.4.15.6 and 4.6.x before 4.6.2 allows remote attackers to inject arbitrary web script or HTML via special characters that are mishandled during double URL decoding.",
  "repo": "phpmyadmin/phpmyadmin",
  "patch_hash": "b061096abd992801fbbd805ef6ff74e627528780",
  "patch_info": {
    "commit_hash": "b061096abd992801fbbd805ef6ff74e627528780",
    "repo": "phpmyadmin/phpmyadmin",
    "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/b061096abd992801fbbd805ef6ff74e627528780",
    "files": [
      "libraries/DisplayResults.php",
      "libraries/mult_submits.lib.php",
      "tbl_row_action.php"
    ],
    "message": "Avoid not neeedded urlencode/urldecode steps in multi submits\n\nSigned-off-by: Michal \u010ciha\u0159 <michal@cihar.com>",
    "before_after_code_files": [
      "libraries/DisplayResults.php||libraries/DisplayResults.php",
      "libraries/mult_submits.lib.php||libraries/mult_submits.lib.php",
      "tbl_row_action.php||tbl_row_action.php"
    ]
  },
  "patch_diff": {
    "libraries/DisplayResults.php||libraries/DisplayResults.php": [
      "File: libraries/DisplayResults.php -> libraries/DisplayResults.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "2788:                 $whereClauseMap[$row_no][$this->__get('table')] = $where_clause;",
      "2789:                 $this->__set('whereClauseMap', $whereClauseMap);",
      "2794:                 if ($displayParts['edit_lnk'] == self::UPDATE_ROW) {",
      "",
      "[Removed Lines]",
      "2791:                 $where_clause_html = urlencode($where_clause);",
      "",
      "[Added Lines]",
      "2791:                 $where_clause_html = htmlspecialchars($where_clause);",
      "",
      "---------------"
    ],
    "libraries/mult_submits.lib.php||libraries/mult_submits.lib.php": [
      "File: libraries/mult_submits.lib.php -> libraries/mult_submits.lib.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "44:         if ($what == 'row_delete') {",
      "45:             $_url_params['selected'][] = 'DELETE FROM '",
      "46:                 . PMA\\libraries\\Util::backquote($table)",
      "48:         } else {",
      "49:             $_url_params['selected'][] = $sval;",
      "50:         }",
      "",
      "[Removed Lines]",
      "47:                 . ' WHERE ' . urldecode($sval) . ' LIMIT 1;';",
      "",
      "[Added Lines]",
      "47:                 . ' WHERE ' . $sval . ' LIMIT 1;';",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "499:                 . ';<br />';",
      "500:             break;",
      "501:         case 'drop_db':",
      "",
      "[Removed Lines]",
      "498:                 . ' WHERE ' . urldecode(htmlspecialchars($sval))",
      "",
      "[Added Lines]",
      "498:                 . ' WHERE ' . htmlspecialchars($sval)",
      "",
      "---------------"
    ],
    "tbl_row_action.php||tbl_row_action.php": [
      "File: tbl_row_action.php -> tbl_row_action.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "86:             && is_array($_REQUEST['rows_to_delete'])",
      "87:         ) {",
      "88:             foreach ($_REQUEST['rows_to_delete'] as $i => $i_where_clause) {",
      "90:             }",
      "91:         }",
      "92:         $active_page = 'tbl_change.php';",
      "",
      "[Removed Lines]",
      "89:                 $where_clause[] = urldecode($i_where_clause);",
      "",
      "[Added Lines]",
      "89:                 $where_clause[] = $i_where_clause;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "106:             && is_array($_REQUEST['rows_to_delete'])",
      "107:         ) {",
      "108:             foreach ($_REQUEST['rows_to_delete'] as $i => $i_where_clause) {",
      "110:             }",
      "111:         }",
      "112:         $active_page = 'tbl_export.php';",
      "",
      "[Removed Lines]",
      "109:                 $where_clause[] = urldecode($i_where_clause);",
      "",
      "[Added Lines]",
      "109:                 $where_clause[] = $i_where_clause;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "78e71897be0902eb1d5d3d30a33b4417cd7d4d87",
      "candidate_info": {
        "commit_hash": "78e71897be0902eb1d5d3d30a33b4417cd7d4d87",
        "repo": "phpmyadmin/phpmyadmin",
        "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/78e71897be0902eb1d5d3d30a33b4417cd7d4d87",
        "files": [
          "libraries/DisplayResults.class.php",
          "libraries/mult_submits.lib.php",
          "tbl_row_action.php"
        ],
        "message": "Avoid not neeedded urlencode/urldecode steps in multi submits\n\nSigned-off-by: Michal \u010ciha\u0159 <michal@cihar.com>",
        "before_after_code_files": [
          "libraries/DisplayResults.class.php||libraries/DisplayResults.class.php",
          "libraries/mult_submits.lib.php||libraries/mult_submits.lib.php",
          "tbl_row_action.php||tbl_row_action.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libraries/mult_submits.lib.php||libraries/mult_submits.lib.php",
            "tbl_row_action.php||tbl_row_action.php"
          ],
          "candidate": [
            "libraries/mult_submits.lib.php||libraries/mult_submits.lib.php",
            "tbl_row_action.php||tbl_row_action.php"
          ]
        }
      },
      "candidate_diff": {
        "libraries/DisplayResults.class.php||libraries/DisplayResults.class.php": [
          "File: libraries/DisplayResults.class.php -> libraries/DisplayResults.class.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "2645:                     $this->__get('fields_meta'),",
          "2646:                     $row",
          "2647:                 );",
          "2651:             $del_url = $del_str = $edit_anchor_class",
          "",
          "[Removed Lines]",
          "2648:             $where_clause_html = urlencode($where_clause);",
          "",
          "[Added Lines]",
          "2648:             $where_clause_html = htmlspecialchars($where_clause);",
          "",
          "---------------"
        ],
        "libraries/mult_submits.lib.php||libraries/mult_submits.lib.php": [
          "File: libraries/mult_submits.lib.php -> libraries/mult_submits.lib.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "46:         if ($what == 'row_delete') {",
          "47:             $_url_params['selected'][] = 'DELETE FROM '",
          "48:                 . PMA_Util::backquote($db) . '.' . PMA_Util::backquote($table)",
          "50:         } else {",
          "51:             $_url_params['selected'][] = $sval;",
          "52:         }",
          "",
          "[Removed Lines]",
          "49:                 . ' WHERE ' . urldecode($sval) . ' LIMIT 1;';",
          "",
          "[Added Lines]",
          "49:                 . ' WHERE ' . $sval . ' LIMIT 1;';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "571:                 . ';<br />';",
          "572:             break;",
          "573:         case 'drop_db':",
          "",
          "[Removed Lines]",
          "570:                 . ' WHERE ' . urldecode(htmlspecialchars($sval))",
          "",
          "[Added Lines]",
          "570:                 . ' WHERE ' . htmlspecialchars($sval)",
          "",
          "---------------"
        ],
        "tbl_row_action.php||tbl_row_action.php": [
          "File: tbl_row_action.php -> tbl_row_action.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "77:             && is_array($_REQUEST['rows_to_delete'])",
          "78:         ) {",
          "79:             foreach ($_REQUEST['rows_to_delete'] as $i => $i_where_clause) {",
          "81:             }",
          "82:         }",
          "83:         $active_page = 'tbl_change.php';",
          "",
          "[Removed Lines]",
          "80:                 $where_clause[] = urldecode($i_where_clause);",
          "",
          "[Added Lines]",
          "80:                 $where_clause[] = $i_where_clause;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "97:             && is_array($_REQUEST['rows_to_delete'])",
          "98:         ) {",
          "99:             foreach ($_REQUEST['rows_to_delete'] as $i => $i_where_clause) {",
          "101:             }",
          "102:         }",
          "103:         $active_page = 'tbl_export.php';",
          "",
          "[Removed Lines]",
          "100:                 $where_clause[] = urldecode($i_where_clause);",
          "",
          "[Added Lines]",
          "100:                 $where_clause[] = $i_where_clause;",
          "",
          "---------------"
        ]
      }
    }
  ]
}