{
  "cve_id": "CVE-2016-5734",
  "cve_desc": "phpMyAdmin 4.0.x before 4.0.10.16, 4.4.x before 4.4.15.7, and 4.6.x before 4.6.3 does not properly choose delimiters to prevent use of the preg_replace e (aka eval) modifier, which might allow remote attackers to execute arbitrary PHP code via a crafted string, as demonstrated by the table search-and-replace implementation.",
  "repo": "phpmyadmin/phpmyadmin",
  "patch_hash": "1cc7466db3a05e95fe57a6702f41773e6829d54b",
  "patch_info": {
    "commit_hash": "1cc7466db3a05e95fe57a6702f41773e6829d54b",
    "repo": "phpmyadmin/phpmyadmin",
    "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/1cc7466db3a05e95fe57a6702f41773e6829d54b",
    "files": [
      "import.php",
      "libraries/Tracker.php",
      "libraries/plugins/export/ExportSql.php",
      "templates/columns_definitions/transformation.phtml",
      "test/libraries/core/PMA_warnMissingExtension_test.php"
    ],
    "message": "Quote delimiter before using preg_replace\n\nSigned-off-by: Michal \u010ciha\u0159 <michal@cihar.com>",
    "before_after_code_files": [
      "import.php||import.php",
      "libraries/Tracker.php||libraries/Tracker.php",
      "libraries/plugins/export/ExportSql.php||libraries/plugins/export/ExportSql.php",
      "templates/columns_definitions/transformation.phtml||templates/columns_definitions/transformation.phtml",
      "test/libraries/core/PMA_warnMissingExtension_test.php||test/libraries/core/PMA_warnMissingExtension_test.php"
    ]
  },
  "patch_diff": {
    "import.php||import.php": [
      "File: import.php -> import.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "111:         && is_array($_REQUEST['parameters'])) {",
      "112:         $parameters = $_REQUEST['parameters'];",
      "113:         foreach ($parameters as $parameter => $replacement) {",
      "116:             $sql_query = preg_replace(",
      "117:                 '/' . $quoted . '([^a-zA-Z0-9_])/',",
      "",
      "[Removed Lines]",
      "114:             $quoted = preg_quote($parameter);",
      "",
      "[Added Lines]",
      "114:             $quoted = preg_quote($parameter, '/');",
      "",
      "---------------"
    ],
    "libraries/Tracker.php||libraries/Tracker.php": [
      "File: libraries/Tracker.php -> libraries/Tracker.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "905:                 $query = preg_replace(",
      "907:                     '',",
      "908:                     $query",
      "909:                 );",
      "",
      "[Removed Lines]",
      "906:                     '/`' . preg_quote($dbname) . '`\\s?\\./',",
      "",
      "[Added Lines]",
      "906:                     '/`' . preg_quote($dbname, '/') . '`\\s?\\./',",
      "",
      "---------------"
    ],
    "libraries/plugins/export/ExportSql.php||libraries/plugins/export/ExportSql.php": [
      "File: libraries/plugins/export/ExportSql.php -> libraries/plugins/export/ExportSql.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "1507:             if ($view) {",
      "1508:                 $create_query = preg_replace(",
      "1510:                     '',",
      "1511:                     $create_query",
      "1512:                 );",
      "",
      "[Removed Lines]",
      "1509:                     '/' . preg_quote(Util::backquote($db)) . '\\./',",
      "",
      "[Added Lines]",
      "1509:                     '/' . preg_quote(Util::backquote($db), '/') . '\\./',",
      "",
      "---------------"
    ],
    "templates/columns_definitions/transformation.phtml||templates/columns_definitions/transformation.phtml": [
      "File: templates/columns_definitions/transformation.phtml -> templates/columns_definitions/transformation.phtml",
      "--- Hunk 1 ---",
      "[Context before]",
      "7:             <?php",
      "8:                 $checked = isset($columnMeta['Field'])",
      "9:                          && isset($mime_map[$columnMeta['Field']][$type])",
      "11:                                         $mime_map[$columnMeta['Field']][$type]) ? 'selected ' : '';",
      "12:                 $tooltip = PMA_getTransformationDescription(",
      "13:                     $available_mime[$type . '_file'][$mimekey]",
      "",
      "[Removed Lines]",
      "10:                          && preg_match('@' . preg_quote($available_mime[$type . '_file'][$mimekey]) . '3?@i',",
      "",
      "[Added Lines]",
      "10:                          && preg_match('@' . preg_quote($available_mime[$type . '_file'][$mimekey], '@') . '3?@i',",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "24:             </option>",
      "25:         <?php endforeach; ?>",
      "26:     <?php endif; ?>",
      "",
      "[Removed Lines]",
      "27: </select>",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ],
    "test/libraries/core/PMA_warnMissingExtension_test.php||test/libraries/core/PMA_warnMissingExtension_test.php": [
      "File: test/libraries/core/PMA_warnMissingExtension_test.php -> test/libraries/core/PMA_warnMissingExtension_test.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "59:             . '\" target=\"Documentation\"><em>' . $ext",
      "60:             . '</em></a> extension is missing. Please check your PHP configuration.';",
      "64:         PMA_warnMissingExtension($ext, true);",
      "65:     }",
      "",
      "[Removed Lines]",
      "62:         $this->expectOutputRegex('@' . preg_quote($warn) . '@');",
      "",
      "[Added Lines]",
      "62:         $this->expectOutputRegex('@' . preg_quote($warn, '@') . '@');",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "351019c07429d2d6498e9abaa693ce8d88eadb5f",
      "candidate_info": {
        "commit_hash": "351019c07429d2d6498e9abaa693ce8d88eadb5f",
        "repo": "phpmyadmin/phpmyadmin",
        "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/351019c07429d2d6498e9abaa693ce8d88eadb5f",
        "files": [
          "libraries/tbl_columns_definition_form.inc.php"
        ],
        "message": "Quote delimiter before using preg_replace\n\nSigned-off-by: Michal \u010ciha\u0159 <michal@cihar.com>",
        "before_after_code_files": [
          "libraries/tbl_columns_definition_form.inc.php||libraries/tbl_columns_definition_form.inc.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_message": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "libraries/tbl_columns_definition_form.inc.php||libraries/tbl_columns_definition_form.inc.php": [
          "File: libraries/tbl_columns_definition_form.inc.php -> libraries/tbl_columns_definition_form.inc.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "692:                     && isset($mime_map[$row['Field']]['transformation'])",
          "693:                     && preg_match(",
          "694:                         '@' . preg_quote(",
          "696:                         ) . '3?@i',",
          "697:                         $mime_map[$row['Field']]['transformation']",
          "698:                     )",
          "",
          "[Removed Lines]",
          "695:                             $available_mime['transformation_file'][$mimekey]",
          "",
          "[Added Lines]",
          "695:                             $available_mime['transformation_file'][$mimekey], '@'",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "daf375163eb7125282d24494e287e4825a931e1e",
      "candidate_info": {
        "commit_hash": "daf375163eb7125282d24494e287e4825a931e1e",
        "repo": "phpmyadmin/phpmyadmin",
        "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/daf375163eb7125282d24494e287e4825a931e1e",
        "files": [
          "libraries/Tracker.class.php",
          "libraries/plugins/export/ExportSql.class.php",
          "libraries/tbl_columns_definition_form.lib.php",
          "test/libraries/core/PMA_warnMissingExtension_test.php"
        ],
        "message": "Quote delimiter before using preg_replace\n\nSigned-off-by: Michal \u010ciha\u0159 <michal@cihar.com>",
        "before_after_code_files": [
          "libraries/Tracker.class.php||libraries/Tracker.class.php",
          "libraries/plugins/export/ExportSql.class.php||libraries/plugins/export/ExportSql.class.php",
          "libraries/tbl_columns_definition_form.lib.php||libraries/tbl_columns_definition_form.lib.php",
          "test/libraries/core/PMA_warnMissingExtension_test.php||test/libraries/core/PMA_warnMissingExtension_test.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_message": 1,
        "olp_code_files": {
          "patch": [
            "test/libraries/core/PMA_warnMissingExtension_test.php||test/libraries/core/PMA_warnMissingExtension_test.php"
          ],
          "candidate": [
            "test/libraries/core/PMA_warnMissingExtension_test.php||test/libraries/core/PMA_warnMissingExtension_test.php"
          ]
        }
      },
      "candidate_diff": {
        "libraries/Tracker.class.php||libraries/Tracker.class.php": [
          "File: libraries/Tracker.class.php -> libraries/Tracker.class.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "922:                 $query = preg_replace(",
          "924:                     '',",
          "925:                     $query",
          "926:                 );",
          "",
          "[Removed Lines]",
          "923:                     '/`' . preg_quote($dbname) . '`\\s?\\./',",
          "",
          "[Added Lines]",
          "923:                     '/`' . preg_quote($dbname, '/') . '`\\s?\\./',",
          "",
          "---------------"
        ],
        "libraries/plugins/export/ExportSql.class.php||libraries/plugins/export/ExportSql.class.php": [
          "File: libraries/plugins/export/ExportSql.class.php -> libraries/plugins/export/ExportSql.class.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "1253:             if ($view) {",
          "1254:                 $create_query = preg_replace(",
          "1256:                     '',",
          "1257:                     $create_query",
          "1258:                 );",
          "",
          "[Removed Lines]",
          "1255:                     '/' . preg_quote(PMA_Util::backquote($db)) . '\\./',",
          "",
          "[Added Lines]",
          "1255:                     '/' . preg_quote(PMA_Util::backquote($db), '/') . '\\./',",
          "",
          "---------------"
        ],
        "libraries/tbl_columns_definition_form.lib.php||libraries/tbl_columns_definition_form.lib.php": [
          "File: libraries/tbl_columns_definition_form.lib.php -> libraries/tbl_columns_definition_form.lib.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "792:                 && isset($mime_map[$columnMeta['Field']][$type])",
          "793:                 && preg_match(",
          "794:                     '@' . preg_quote(",
          "796:                     ) . '3?@i',",
          "797:                     $mime_map[$columnMeta['Field']][$type]",
          "798:                 )",
          "",
          "[Removed Lines]",
          "795:                         $available_mime[$type . '_file'][$mimekey]",
          "",
          "[Added Lines]",
          "795:                         $available_mime[$type . '_file'][$mimekey], '@'",
          "",
          "---------------"
        ],
        "test/libraries/core/PMA_warnMissingExtension_test.php||test/libraries/core/PMA_warnMissingExtension_test.php": [
          "File: test/libraries/core/PMA_warnMissingExtension_test.php -> test/libraries/core/PMA_warnMissingExtension_test.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "64:             . '\" target=\"Documentation\"><em>' . $ext",
          "65:             . '</em></a> extension is missing. Please check your PHP configuration.';",
          "69:         PMA_warnMissingExtension($ext, true);",
          "70:     }",
          "",
          "[Removed Lines]",
          "67:         $this->expectOutputRegex('@' . preg_quote($warn) . '@');",
          "",
          "[Added Lines]",
          "67:         $this->expectOutputRegex('@' . preg_quote($warn, '@') . '@');",
          "",
          "---------------"
        ]
      }
    }
  ]
}