{
  "cve_id": "CVE-2015-0278",
  "cve_desc": "libuv before 0.10.34 does not properly drop group privileges, which allows context-dependent attackers to gain privileges via unspecified vectors.",
  "repo": "libuv/libuv",
  "patch_hash": "66ab38918c911bcff025562cf06237d7fedaba0c",
  "patch_info": {
    "commit_hash": "66ab38918c911bcff025562cf06237d7fedaba0c",
    "repo": "libuv/libuv",
    "commit_url": "https://github.com/libuv/libuv/commit/66ab38918c911bcff025562cf06237d7fedaba0c",
    "files": [
      "src/unix/process.c"
    ],
    "message": "unix: call setgoups before calling setuid/setgid\n\nPartial fix for #1093",
    "before_after_code_files": [
      "src/unix/process.c||src/unix/process.c"
    ]
  },
  "patch_diff": {
    "src/unix/process.c||src/unix/process.c": [
      "File: src/unix/process.c -> src/unix/process.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "330:     _exit(127);",
      "331:   }",
      "333:   if ((options->flags & UV_PROCESS_SETGID) && setgid(options->gid)) {",
      "334:     uv__write_int(error_fd, -errno);",
      "335:     perror(\"setgid()\");",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "333:   if (options->flags & (UV_PROCESS_SETUID | UV_PROCESS_SETGID)) {",
      "341:     SAVE_ERRNO(setgroups(0, NULL));",
      "342:   }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "ae0ed8c49d0d313c935c22077511148b6e8408a4",
      "candidate_info": {
        "commit_hash": "ae0ed8c49d0d313c935c22077511148b6e8408a4",
        "repo": "libuv/libuv",
        "commit_url": "https://github.com/libuv/libuv/commit/ae0ed8c49d0d313c935c22077511148b6e8408a4",
        "files": [
          ".mailmap",
          "AUTHORS",
          "ChangeLog",
          "src/version.c"
        ],
        "message": "2013.12.14, Version 0.11.16 (Unstable)\n\nChanges since version 0.11.15:\n\n* fsevents: remove kFSEventStreamCreateFlagNoDefer polyfill (ci-innoq)\n\n* libuv: add more getaddrinfo errors (Steven Kabbes)\n\n* unix: fix accept() EMFILE error handling (Ben Noordhuis)\n\n* linux: fix up SO_REUSEPORT back-port (Ben Noordhuis)\n\n* fsevents: fix subfolder check (Fedor Indutny)\n\n* fsevents: fix invalid memory access (huxingyi)\n\n* windows/timer: fix uv_hrtime discontinuity (Bert Belder)\n\n* unix: fix various memory leaks and undef behavior (Fedor Indutny)\n\n* unix, windows: always update loop time (Sa\u00fal Ibarra Corretg\u00e9)\n\n* windows: translate system errors in uv_spawn (Alexis Campailla)\n\n* windows: uv_spawn code refactor (Alexis Campailla)\n\n* unix, windows: detect errors in uv_ip4/6_addr (Yorkie)\n\n* stream: introduce uv_try_write(...) (Fedor Indutny)",
        "before_after_code_files": [
          "src/version.c||src/version.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/libuv/libuv/pull/41"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/version.c||src/version.c": [
          "File: src/version.c -> src/version.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "32: #define UV_VERSION_MAJOR 0",
          "33: #define UV_VERSION_MINOR 11",
          "34: #define UV_VERSION_PATCH 16",
          "38: #define UV_VERSION  ((UV_VERSION_MAJOR << 16) | \\",
          "",
          "[Removed Lines]",
          "35: #define UV_VERSION_IS_RELEASE 0",
          "",
          "[Added Lines]",
          "35: #define UV_VERSION_IS_RELEASE 1",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "bddf357baf44b93df36e7a1a128717462dff6615",
      "candidate_info": {
        "commit_hash": "bddf357baf44b93df36e7a1a128717462dff6615",
        "repo": "libuv/libuv",
        "commit_url": "https://github.com/libuv/libuv/commit/bddf357baf44b93df36e7a1a128717462dff6615",
        "files": [
          "test/test-loop-stop.c"
        ],
        "message": "test: relax timing assumption of loop_stop\n\nThe loop_stop test makes an implicit assumption about the triggering\ntiming of a repeating trigger, which may not hold true on slower or\nvirtualized machines, thus failing the test as shown at [0] and\ndiscussed at [1].\nThis commit relaxes the assumption, without mandating the exact number\nof runs.\n\n[0] http://ur1.ca/fr5bw\n[1] https://groups.google.com/d/msg/libuv/5-fNIC7hIAo/yqznDmwHDAIJ\n\nSigned-off-by: Luca Bruno <lucab@debian.org>",
        "before_after_code_files": [
          "test/test-loop-stop.c||test/test-loop-stop.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/libuv/libuv/pull/41"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "test/test-loop-stop.c||test/test-loop-stop.c": [
          "File: test/test-loop-stop.c -> test/test-loop-stop.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "63:   r = uv_run(uv_default_loop(), UV_RUN_NOWAIT);",
          "64:   ASSERT(r != 0);",
          "67:   r = uv_run(uv_default_loop(), UV_RUN_DEFAULT);",
          "68:   ASSERT(r == 0);",
          "",
          "[Removed Lines]",
          "65:   ASSERT(prepare_called == 3);",
          "",
          "[Added Lines]",
          "65:   ASSERT(prepare_called > 1);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "bbf6a144e1c8f07e9a752a3fff3a6bc8276a0d9c",
      "candidate_info": {
        "commit_hash": "bbf6a144e1c8f07e9a752a3fff3a6bc8276a0d9c",
        "repo": "libuv/libuv",
        "commit_url": "https://github.com/libuv/libuv/commit/bbf6a144e1c8f07e9a752a3fff3a6bc8276a0d9c",
        "files": [
          "uv.gyp"
        ],
        "message": "gyp: remove UNLIMITED_SELECT from dependent define\n\nIt isn't really needed here.",
        "before_after_code_files": [
          "uv.gyp||uv.gyp"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/libuv/libuv/pull/41"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "uv.gyp||uv.gyp": [
          "File: uv.gyp -> uv.gyp",
          "--- Hunk 1 ---",
          "[Context before]",
          "46:             ],",
          "47:           }],",
          "48:           ['OS == \"mac\"', {",
          "53:           }],",
          "54:           ['OS == \"linux\"', {",
          "55:             'defines': [ '_POSIX_C_SOURCE=200112' ],",
          "",
          "[Removed Lines]",
          "49:             'defines': [",
          "50:               '_DARWIN_USE_64_BIT_INODE=1',",
          "51:               '_DARWIN_UNLIMITED_SELECT=1',",
          "52:             ],",
          "",
          "[Added Lines]",
          "49:             'defines': [ '_DARWIN_USE_64_BIT_INODE=1' ],",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "c44f264641bd60bdc53b6e3f2e56d82ba43011d8",
      "candidate_info": {
        "commit_hash": "c44f264641bd60bdc53b6e3f2e56d82ba43011d8",
        "repo": "libuv/libuv",
        "commit_url": "https://github.com/libuv/libuv/commit/c44f264641bd60bdc53b6e3f2e56d82ba43011d8",
        "files": [
          "src/win/error.c"
        ],
        "message": "windows: map ERROR_INVALID_DRIVE to UV_ENOENT",
        "before_after_code_files": [
          "src/win/error.c||src/win/error.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/libuv/libuv/pull/41"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/win/error.c||src/win/error.c": [
          "File: src/win/error.c -> src/win/error.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "133:     case ERROR_DIRECTORY:                   return UV_ENOENT;",
          "134:     case ERROR_FILE_NOT_FOUND:              return UV_ENOENT;",
          "135:     case ERROR_INVALID_NAME:                return UV_ENOENT;",
          "136:     case ERROR_INVALID_REPARSE_DATA:        return UV_ENOENT;",
          "137:     case ERROR_MOD_NOT_FOUND:               return UV_ENOENT;",
          "138:     case ERROR_PATH_NOT_FOUND:              return UV_ENOENT;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "136:     case ERROR_INVALID_DRIVE:               return UV_ENOENT;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "ff3ee844422eb138ecb2d16f4f5ecffa9968bb1d",
      "candidate_info": {
        "commit_hash": "ff3ee844422eb138ecb2d16f4f5ecffa9968bb1d",
        "repo": "libuv/libuv",
        "commit_url": "https://github.com/libuv/libuv/commit/ff3ee844422eb138ecb2d16f4f5ecffa9968bb1d",
        "files": [
          "android-configure",
          "common.gypi",
          "uv.gyp"
        ],
        "message": "build: set OS==\"android\" for android builds\n\nWork around the build name issues by instead manually adding the build\ntarget for android builds using '-DOS=android'\n\nThis additionally resolves problems caused by the OS variable being\nrewritten from \"android\" to \"linux\" in gyp. This causes errors, as\nreal-time support (-lrt) and pthread support (-lpthread) is not\navailable in the android NDK toolchain as libraries.\n\nThe functions present in these libraries are included automatically\nduring the build instead during the android compilation process.",
        "before_after_code_files": [
          "common.gypi||common.gypi",
          "uv.gyp||uv.gyp"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/libuv/libuv/pull/41"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "common.gypi||common.gypi": [
          "File: common.gypi -> common.gypi",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: {",
          "2:   'variables': {",
          "4:     'visibility%': 'hidden',         # V8's visibility setting",
          "5:     'target_arch%': 'ia32',          # set v8's target architecture",
          "6:     'host_arch%': 'ia32',            # set v8's host architecture",
          "",
          "[Removed Lines]",
          "3:     'android_build%': 0,",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "130:           }]",
          "131:         ]",
          "132:       }],",
          "134:         'cflags': [ '-Wall' ],",
          "135:         'cflags_cc': [ '-fno-rtti', '-fno-exceptions' ],",
          "136:         'target_conditions': [",
          "",
          "[Removed Lines]",
          "133:       ['OS in \"freebsd linux openbsd solaris\" or android_build == 1', {",
          "",
          "[Added Lines]",
          "132:       ['OS in \"freebsd linux openbsd solaris android\"', {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "150:             'cflags': [ '-pthreads' ],",
          "151:             'ldflags': [ '-pthreads' ],",
          "152:           }],",
          "154:             'cflags': [ '-pthread' ],",
          "155:             'ldflags': [ '-pthread' ],",
          "156:           }],",
          "",
          "[Removed Lines]",
          "153:           [ 'OS != \"solaris\" and android_build == 0', {",
          "",
          "[Added Lines]",
          "152:           [ 'OS not in \"solaris android\"', {",
          "",
          "---------------"
        ],
        "uv.gyp||uv.gyp": [
          "File: uv.gyp -> uv.gyp",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: {",
          "2:   'variables': {",
          "4:     'uv_use_dtrace%': 'false',",
          "5:     # uv_parent_path is the relative path to libuv in the parent project",
          "6:     # this is only relevant when dtrace is enabled and libuv is a child project",
          "",
          "[Removed Lines]",
          "3:     'android_build%': 0,",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "22:           ['OS==\"solaris\"', {",
          "23:             'cflags': [ '-pthreads' ],",
          "24:           }],",
          "26:             'cflags': [ '-pthread' ],",
          "27:           }],",
          "28:         ],",
          "",
          "[Removed Lines]",
          "25:           ['OS != \"solaris\" and android_build == 0', {",
          "",
          "[Added Lines]",
          "24:           ['OS not in \"solaris android\"', {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "162:               ['OS==\"solaris\"', {",
          "163:                 'ldflags': [ '-pthreads' ],",
          "164:               }],",
          "166:                 'ldflags': [ '-pthread' ],",
          "167:               }],",
          "168:             ],",
          "",
          "[Removed Lines]",
          "165:               ['OS != \"solaris\" and android_build == 0', {",
          "",
          "[Added Lines]",
          "164:               ['OS != \"solaris\" and OS != \"android\"', {",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "180:             }],",
          "181:           ],",
          "182:         }],",
          "184:           'sources': [ 'src/unix/proctitle.c' ],",
          "185:         }],",
          "186:         [ 'OS==\"mac\"', {",
          "",
          "[Removed Lines]",
          "183:         [ 'OS in \"linux mac\" or android_build == 1', {",
          "",
          "[Added Lines]",
          "182:         [ 'OS in \"linux mac android\"', {",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "216:             'libraries': [ '-ldl', '-lrt' ],",
          "217:           },",
          "218:         }],",
          "220:           'sources': [",
          "221:             'src/unix/linux-core.c',",
          "222:             'src/unix/linux-inotify.c',",
          "",
          "[Removed Lines]",
          "219:         [ 'android_build == 1', {",
          "",
          "[Added Lines]",
          "218:         [ 'OS==\"android\"', {",
          "",
          "---------------"
        ]
      }
    }
  ]
}