{
  "cve_id": "CVE-2014-3670",
  "cve_desc": "The exif_ifd_make_value function in exif.c in the EXIF extension in PHP before 5.4.34, 5.5.x before 5.5.18, and 5.6.x before 5.6.2 operates on floating-point arrays incorrectly, which allows remote attackers to cause a denial of service (heap memory corruption and application crash) or possibly execute arbitrary code via a crafted JPEG image with TIFF thumbnail data that is improperly handled by the exif_thumbnail function.",
  "repo": "php/php-src",
  "patch_hash": "ddb207e7fa2e9adeba021a1303c3781efda5409b",
  "patch_info": {
    "commit_hash": "ddb207e7fa2e9adeba021a1303c3781efda5409b",
    "repo": "php/php-src",
    "commit_url": "https://github.com/php/php-src/commit/ddb207e7fa2e9adeba021a1303c3781efda5409b",
    "files": [
      "ext/exif/exif.c",
      "ext/exif/tests/bug68113.jpg",
      "ext/exif/tests/bug68113.phpt"
    ],
    "message": "Fix bug #68113 (Heap corruption in exif_thumbnail())",
    "before_after_code_files": [
      "ext/exif/exif.c||ext/exif/exif.c",
      "ext/exif/tests/bug68113.phpt||ext/exif/tests/bug68113.phpt"
    ]
  },
  "patch_diff": {
    "ext/exif/exif.c||ext/exif/exif.c": [
      "File: ext/exif/exif.c -> ext/exif/exif.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "2426:      data_ptr += 8;",
      "2427:      break;",
      "2428:     case TAG_FMT_SINGLE:",
      "2430:      data_ptr += 4;",
      "2431:      break;",
      "2432:     case TAG_FMT_DOUBLE:",
      "2434:      data_ptr += 8;",
      "2435:      break;",
      "2436:    }",
      "",
      "[Removed Lines]",
      "2429:      memmove(data_ptr, &info_data->value.f, byte_count);",
      "2433:      memmove(data_ptr, &info_data->value.d, byte_count);",
      "",
      "[Added Lines]",
      "2429:      memmove(data_ptr, &info_value->f, 4);",
      "2433:      memmove(data_ptr, &info_value->d, 8);",
      "",
      "---------------"
    ],
    "ext/exif/tests/bug68113.phpt||ext/exif/tests/bug68113.phpt": [
      "File: ext/exif/tests/bug68113.phpt -> ext/exif/tests/bug68113.phpt",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: --TEST--",
      "2: Bug #68113 (Heap corruption in exif_thumbnail())",
      "3: --SKIPIF--",
      "4: <?php",
      "5: extension_loaded(\"exif\") or die(\"skip need exif\");",
      "6: ?>",
      "7: --FILE--",
      "8: <?php",
      "9: var_dump(exif_thumbnail(__DIR__.\"/bug68113.jpg\"));",
      "10: ?>",
      "11: Done",
      "12: --EXPECTF--",
      "13: Warning: exif_thumbnail(bug68113.jpg): File structure corrupted in %s/bug68113.php on line 2",
      "15: Warning: exif_thumbnail(bug68113.jpg): Invalid JPEG file in %s/bug68113.php on line 2",
      "16: bool(false)",
      "17: Done",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "287c91c1f060dc85a8bdb51488c50db8614448b7",
      "candidate_info": {
        "commit_hash": "287c91c1f060dc85a8bdb51488c50db8614448b7",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/287c91c1f060dc85a8bdb51488c50db8614448b7",
        "files": [
          "NEWS",
          "ext/exif/exif.c",
          "ext/exif/tests/bug68113.jpg",
          "ext/exif/tests/bug68113.phpt"
        ],
        "message": "Fix bug #68113 (Heap corruption in exif_thumbnail())",
        "before_after_code_files": [
          "ext/exif/exif.c||ext/exif/exif.c",
          "ext/exif/tests/bug68113.phpt||ext/exif/tests/bug68113.phpt"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_message": 1,
        "olp_code_files": {
          "patch": [
            "ext/exif/exif.c||ext/exif/exif.c",
            "ext/exif/tests/bug68113.phpt||ext/exif/tests/bug68113.phpt"
          ],
          "candidate": [
            "ext/exif/exif.c||ext/exif/exif.c",
            "ext/exif/tests/bug68113.phpt||ext/exif/tests/bug68113.phpt"
          ]
        }
      },
      "candidate_diff": {
        "ext/exif/exif.c||ext/exif/exif.c": [
          "File: ext/exif/exif.c -> ext/exif/exif.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2426:      data_ptr += 8;",
          "2427:      break;",
          "2428:     case TAG_FMT_SINGLE:",
          "2430:      data_ptr += 4;",
          "2431:      break;",
          "2432:     case TAG_FMT_DOUBLE:",
          "2434:      data_ptr += 8;",
          "2435:      break;",
          "2436:    }",
          "",
          "[Removed Lines]",
          "2429:      memmove(data_ptr, &info_data->value.f, byte_count);",
          "2433:      memmove(data_ptr, &info_data->value.d, byte_count);",
          "",
          "[Added Lines]",
          "2429:      memmove(data_ptr, &info_value->f, 4);",
          "2433:      memmove(data_ptr, &info_value->d, 8);",
          "",
          "---------------"
        ],
        "ext/exif/tests/bug68113.phpt||ext/exif/tests/bug68113.phpt": [
          "File: ext/exif/tests/bug68113.phpt -> ext/exif/tests/bug68113.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #68113 (Heap corruption in exif_thumbnail())",
          "3: --SKIPIF--",
          "4: <?php",
          "5: extension_loaded(\"exif\") or die(\"skip need exif\");",
          "6: ?>",
          "7: --FILE--",
          "8: <?php",
          "9: var_dump(exif_thumbnail(__DIR__.\"/bug68113.jpg\"));",
          "10: ?>",
          "11: Done",
          "12: --EXPECTF--",
          "13: Warning: exif_thumbnail(bug68113.jpg): File structure corrupted in %s/bug68113.php on line 2",
          "15: Warning: exif_thumbnail(bug68113.jpg): Invalid JPEG file in %s/bug68113.php on line 2",
          "16: bool(false)",
          "17: Done",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "f9ba0a157f2d7e6d027285cb2ef964a919e67b8e",
      "candidate_info": {
        "commit_hash": "f9ba0a157f2d7e6d027285cb2ef964a919e67b8e",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/f9ba0a157f2d7e6d027285cb2ef964a919e67b8e",
        "files": [
          "ext/exif/exif.c",
          "ext/exif/tests/bug68113.jpg",
          "ext/exif/tests/bug68113.phpt"
        ],
        "message": "Fix bug #68113 (Heap corruption in exif_thumbnail())",
        "before_after_code_files": [
          "ext/exif/exif.c||ext/exif/exif.c",
          "ext/exif/tests/bug68113.phpt||ext/exif/tests/bug68113.phpt"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_message": 1,
        "olp_code_files": {
          "patch": [
            "ext/exif/exif.c||ext/exif/exif.c",
            "ext/exif/tests/bug68113.phpt||ext/exif/tests/bug68113.phpt"
          ],
          "candidate": [
            "ext/exif/exif.c||ext/exif/exif.c",
            "ext/exif/tests/bug68113.phpt||ext/exif/tests/bug68113.phpt"
          ]
        }
      },
      "candidate_diff": {
        "ext/exif/exif.c||ext/exif/exif.c": [
          "File: ext/exif/exif.c -> ext/exif/exif.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2416:      data_ptr += 8;",
          "2417:      break;",
          "2418:     case TAG_FMT_SINGLE:",
          "2420:      data_ptr += 4;",
          "2421:      break;",
          "2422:     case TAG_FMT_DOUBLE:",
          "2424:      data_ptr += 8;",
          "2425:      break;",
          "2426:    }",
          "",
          "[Removed Lines]",
          "2419:      memmove(data_ptr, &info_data->value.f, byte_count);",
          "2423:      memmove(data_ptr, &info_data->value.d, byte_count);",
          "",
          "[Added Lines]",
          "2419:      memmove(data_ptr, &info_value->f, 4);",
          "2423:      memmove(data_ptr, &info_value->d, 8);",
          "",
          "---------------"
        ],
        "ext/exif/tests/bug68113.phpt||ext/exif/tests/bug68113.phpt": [
          "File: ext/exif/tests/bug68113.phpt -> ext/exif/tests/bug68113.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #68113 (Heap corruption in exif_thumbnail())",
          "3: --SKIPIF--",
          "4: <?php",
          "5: extension_loaded(\"exif\") or die(\"skip need exif\");",
          "6: ?>",
          "7: --FILE--",
          "8: <?php",
          "9: var_dump(exif_thumbnail(__DIR__.\"/bug68113.jpg\"));",
          "10: ?>",
          "11: Done",
          "12: --EXPECTF--",
          "13: Warning: exif_thumbnail(bug68113.jpg): File structure corrupted in %s/bug68113.php on line 2",
          "15: Warning: exif_thumbnail(bug68113.jpg): Invalid JPEG file in %s/bug68113.php on line 2",
          "16: bool(false)",
          "17: Done",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "4a38cc0a3c4db2ac42a5063df0f6ee1ec70b30ff",
      "candidate_info": {
        "commit_hash": "4a38cc0a3c4db2ac42a5063df0f6ee1ec70b30ff",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/4a38cc0a3c4db2ac42a5063df0f6ee1ec70b30ff",
        "files": [
          "ext/exif/exif.c",
          "ext/exif/tests/bug68113.jpg",
          "ext/exif/tests/bug68113.phpt"
        ],
        "message": "Fix bug #68113 (Heap corruption in exif_thumbnail())",
        "before_after_code_files": [
          "ext/exif/exif.c||ext/exif/exif.c",
          "ext/exif/tests/bug68113.phpt||ext/exif/tests/bug68113.phpt"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_message": 1,
        "olp_code_files": {
          "patch": [
            "ext/exif/exif.c||ext/exif/exif.c",
            "ext/exif/tests/bug68113.phpt||ext/exif/tests/bug68113.phpt"
          ],
          "candidate": [
            "ext/exif/exif.c||ext/exif/exif.c",
            "ext/exif/tests/bug68113.phpt||ext/exif/tests/bug68113.phpt"
          ]
        }
      },
      "candidate_diff": {
        "ext/exif/exif.c||ext/exif/exif.c": [
          "File: ext/exif/exif.c -> ext/exif/exif.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2413:      data_ptr += 8;",
          "2414:      break;",
          "2415:     case TAG_FMT_SINGLE:",
          "2417:      data_ptr += 4;",
          "2418:      break;",
          "2419:     case TAG_FMT_DOUBLE:",
          "2421:      data_ptr += 8;",
          "2422:      break;",
          "2423:    }",
          "",
          "[Removed Lines]",
          "2416:      memmove(data_ptr, &info_data->value.f, byte_count);",
          "2420:      memmove(data_ptr, &info_data->value.d, byte_count);",
          "",
          "[Added Lines]",
          "2416:      memmove(data_ptr, &info_value->f, 4);",
          "2420:      memmove(data_ptr, &info_value->d, 8);",
          "",
          "---------------"
        ],
        "ext/exif/tests/bug68113.phpt||ext/exif/tests/bug68113.phpt": [
          "File: ext/exif/tests/bug68113.phpt -> ext/exif/tests/bug68113.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #68113 (Heap corruption in exif_thumbnail())",
          "3: --SKIPIF--",
          "4: <?php",
          "5: extension_loaded(\"exif\") or die(\"skip need exif\");",
          "6: ?>",
          "7: --FILE--",
          "8: <?php",
          "9: var_dump(exif_thumbnail(__DIR__.\"/bug68113.jpg\"));",
          "10: ?>",
          "11: Done",
          "12: --EXPECTF--",
          "13: Warning: exif_thumbnail(bug68113.jpg): File structure corrupted in %s/bug68113.php on line 2",
          "15: Warning: exif_thumbnail(bug68113.jpg): Invalid JPEG file in %s/bug68113.php on line 2",
          "16: bool(false)",
          "17: Done",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "09f2355eec0b800905d59f9e96ae09d242ba7673",
      "candidate_info": {
        "commit_hash": "09f2355eec0b800905d59f9e96ae09d242ba7673",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/09f2355eec0b800905d59f9e96ae09d242ba7673",
        "files": [
          "ext/exif/tests/bug68113.phpt"
        ],
        "message": "fix dir separator in test",
        "before_after_code_files": [
          "ext/exif/tests/bug68113.phpt||ext/exif/tests/bug68113.phpt"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/exif/tests/bug68113.phpt||ext/exif/tests/bug68113.phpt"
          ],
          "candidate": [
            "ext/exif/tests/bug68113.phpt||ext/exif/tests/bug68113.phpt"
          ]
        }
      },
      "candidate_diff": {
        "ext/exif/tests/bug68113.phpt||ext/exif/tests/bug68113.phpt": [
          "File: ext/exif/tests/bug68113.phpt -> ext/exif/tests/bug68113.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "10: ?>",
          "11: Done",
          "12: --EXPECTF--",
          "16: bool(false)",
          "",
          "[Removed Lines]",
          "13: Warning: exif_thumbnail(bug68113.jpg): File structure corrupted in %s/bug68113.php on line 2",
          "15: Warning: exif_thumbnail(bug68113.jpg): Invalid JPEG file in %s/bug68113.php on line 2",
          "17: Done",
          "",
          "[Added Lines]",
          "13: Warning: exif_thumbnail(bug68113.jpg): File structure corrupted in %s%ebug68113.php on line 2",
          "15: Warning: exif_thumbnail(bug68113.jpg): Invalid JPEG file in %s%ebug68113.php on line 2",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "5818f5db624c4351210b43f465720bed83c575d8",
      "candidate_info": {
        "commit_hash": "5818f5db624c4351210b43f465720bed83c575d8",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/5818f5db624c4351210b43f465720bed83c575d8",
        "files": [
          "ext/exif/exif.c",
          "ext/exif/tests/bug68113.jpg",
          "ext/exif/tests/bug68113.phpt"
        ],
        "message": "Fix bug #68113 (Heap corruption in exif_thumbnail())",
        "before_after_code_files": [
          "ext/exif/exif.c||ext/exif/exif.c",
          "ext/exif/tests/bug68113.phpt||ext/exif/tests/bug68113.phpt"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "ext/exif/exif.c||ext/exif/exif.c",
            "ext/exif/tests/bug68113.phpt||ext/exif/tests/bug68113.phpt"
          ],
          "candidate": [
            "ext/exif/exif.c||ext/exif/exif.c",
            "ext/exif/tests/bug68113.phpt||ext/exif/tests/bug68113.phpt"
          ]
        }
      },
      "candidate_diff": {
        "ext/exif/exif.c||ext/exif/exif.c": [
          "File: ext/exif/exif.c -> ext/exif/exif.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2416:      data_ptr += 8;",
          "2417:      break;",
          "2418:     case TAG_FMT_SINGLE:",
          "2420:      data_ptr += 4;",
          "2421:      break;",
          "2422:     case TAG_FMT_DOUBLE:",
          "2424:      data_ptr += 8;",
          "2425:      break;",
          "2426:    }",
          "",
          "[Removed Lines]",
          "2419:      memmove(data_ptr, &info_data->value.f, byte_count);",
          "2423:      memmove(data_ptr, &info_data->value.d, byte_count);",
          "",
          "[Added Lines]",
          "2419:      memmove(data_ptr, &info_value->f, 4);",
          "2423:      memmove(data_ptr, &info_value->d, 8);",
          "",
          "---------------"
        ],
        "ext/exif/tests/bug68113.phpt||ext/exif/tests/bug68113.phpt": [
          "File: ext/exif/tests/bug68113.phpt -> ext/exif/tests/bug68113.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #68113 (Heap corruption in exif_thumbnail())",
          "3: --SKIPIF--",
          "4: <?php",
          "5: extension_loaded(\"exif\") or die(\"skip need exif\");",
          "6: ?>",
          "7: --FILE--",
          "8: <?php",
          "9: var_dump(exif_thumbnail(__DIR__.\"/bug68113.jpg\"));",
          "10: ?>",
          "11: Done",
          "12: --EXPECTF--",
          "13: Warning: exif_thumbnail(bug68113.jpg): File structure corrupted in %s/bug68113.php on line 2",
          "15: Warning: exif_thumbnail(bug68113.jpg): Invalid JPEG file in %s/bug68113.php on line 2",
          "16: bool(false)",
          "17: Done",
          "",
          "---------------"
        ]
      }
    }
  ]
}