{
  "cve_id": "CVE-2017-6505",
  "cve_desc": "The ohci_service_ed_list function in hw/usb/hcd-ohci.c in QEMU (aka Quick Emulator) before 2.9.0 allows local guest OS users to cause a denial of service (infinite loop) via vectors involving the number of link endpoint list descriptors, a different vulnerability than CVE-2017-9330.",
  "repo": "qemu/qemu",
  "patch_hash": "95ed56939eb2eaa4e2f349fe6dcd13ca4edfd8fb",
  "patch_info": {
    "commit_hash": "95ed56939eb2eaa4e2f349fe6dcd13ca4edfd8fb",
    "repo": "qemu/qemu",
    "commit_url": "https://github.com/qemu/qemu/commit/95ed56939eb2eaa4e2f349fe6dcd13ca4edfd8fb",
    "files": [
      "hw/usb/hcd-ohci.c"
    ],
    "message": "usb: ohci: limit the number of link eds\n\nThe guest may builds an infinite loop with link eds. This patch\nlimit the number of linked ed to avoid this.\n\nSigned-off-by: Li Qiang <liqiang6-s@360.cn>\nMessage-id: 5899a02e.45ca240a.6c373.93c1@mx.google.com\nSigned-off-by: Gerd Hoffmann <kraxel@redhat.com>",
    "before_after_code_files": [
      "hw/usb/hcd-ohci.c||hw/usb/hcd-ohci.c"
    ]
  },
  "patch_diff": {
    "hw/usb/hcd-ohci.c||hw/usb/hcd-ohci.c": [
      "File: hw/usb/hcd-ohci.c -> hw/usb/hcd-ohci.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "43: #define OHCI_MAX_PORTS 15",
      "45: static int64_t usb_frame_time;",
      "46: static int64_t usb_bit_time;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "45: #define ED_LINK_LIMIT 4",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "1184:     uint32_t next_ed;",
      "1185:     uint32_t cur;",
      "1186:     int active;",
      "1188:     active = 0;",
      "1190:     if (head == 0)",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1189:     uint32_t link_cnt = 0;",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "1200:         next_ed = ed.next & OHCI_DPTR_MASK;",
      "1202:         if ((ed.head & OHCI_ED_H) || (ed.flags & OHCI_ED_K)) {",
      "1203:             uint32_t addr;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1204:         if (++link_cnt > ED_LINK_LIMIT) {",
      "1205:             ohci_die(ohci);",
      "1206:             return 0;",
      "1207:         }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "ab6b1105a2259c7072905887f71caa850ce63190",
      "candidate_info": {
        "commit_hash": "ab6b1105a2259c7072905887f71caa850ce63190",
        "repo": "qemu/qemu",
        "commit_url": "https://github.com/qemu/qemu/commit/ab6b1105a2259c7072905887f71caa850ce63190",
        "files": [
          "hw/usb/hcd-ohci.c"
        ],
        "message": "ohci: relax link check\n\nThe strict td link limit added by commit \"95ed569 usb: ohci: limit the\nnumber of link eds\" causes problems with macos guests.  Lets raise the\nlimit.\n\nReported-by: Programmingkid <programmingkidx@gmail.com>\nReported-by: Howard Spoelstra <hsp.cat7@gmail.com>\nSigned-off-by: Gerd Hoffmann <kraxel@redhat.com>\nReviewed-by: BALATON Zoltan <balaton@eik.bme.hu>\nReviewed-by: John Arbuckle <programmingkidx@gmail.com>\nMessage-id: 1488876018-31576-1-git-send-email-kraxel@redhat.com",
        "before_after_code_files": [
          "hw/usb/hcd-ohci.c||hw/usb/hcd-ohci.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "hw/usb/hcd-ohci.c||hw/usb/hcd-ohci.c"
          ],
          "candidate": [
            "hw/usb/hcd-ohci.c||hw/usb/hcd-ohci.c"
          ]
        }
      },
      "candidate_diff": {
        "hw/usb/hcd-ohci.c||hw/usb/hcd-ohci.c": [
          "File: hw/usb/hcd-ohci.c -> hw/usb/hcd-ohci.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "43: #define OHCI_MAX_PORTS 15",
          "47: static int64_t usb_frame_time;",
          "48: static int64_t usb_bit_time;",
          "",
          "[Removed Lines]",
          "45: #define ED_LINK_LIMIT 4",
          "",
          "[Added Lines]",
          "45: #define ED_LINK_LIMIT 32",
          "",
          "---------------"
        ]
      }
    }
  ]
}