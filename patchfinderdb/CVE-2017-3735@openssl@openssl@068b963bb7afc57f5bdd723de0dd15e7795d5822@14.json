{
  "cve_id": "CVE-2017-3735",
  "cve_desc": "While parsing an IPAddressFamily extension in an X.509 certificate, it is possible to do a one-byte overread. This would result in an incorrect text display of the certificate. This bug has been present since 2006 and is present in all versions of OpenSSL before 1.0.2m and 1.1.0g.",
  "repo": "openssl/openssl",
  "patch_hash": "068b963bb7afc57f5bdd723de0dd15e7795d5822",
  "patch_info": {
    "commit_hash": "068b963bb7afc57f5bdd723de0dd15e7795d5822",
    "repo": "openssl/openssl",
    "commit_url": "https://github.com/openssl/openssl/commit/068b963bb7afc57f5bdd723de0dd15e7795d5822",
    "files": [
      "crypto/x509v3/v3_addr.c"
    ],
    "message": "Avoid out-of-bounds read\n\nFixes CVE 2017-3735\n\nReviewed-by: Kurt Roeckx <kurt@roeckx.be>\n(Merged from https://github.com/openssl/openssl/pull/4276)\n\n(cherry picked from commit b23171744b01e473ebbfd6edad70c1c3825ffbcd)",
    "before_after_code_files": [
      "crypto/x509v3/v3_addr.c||crypto/x509v3/v3_addr.c"
    ]
  },
  "patch_diff": {
    "crypto/x509v3/v3_addr.c||crypto/x509v3/v3_addr.c": [
      "File: crypto/x509v3/v3_addr.c -> crypto/x509v3/v3_addr.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "85: unsigned int X509v3_addr_get_afi(const IPAddressFamily *f)",
      "86: {",
      "91: }",
      "",
      "[Removed Lines]",
      "87:     return ((f != NULL &&",
      "88:              f->addressFamily != NULL && f->addressFamily->data != NULL)",
      "89:             ? ((f->addressFamily->data[0] << 8) | (f->addressFamily->data[1]))",
      "90:             : 0);",
      "",
      "[Added Lines]",
      "87:     if (f == NULL",
      "88:             || f->addressFamily == NULL",
      "89:             || f->addressFamily->data == NULL",
      "90:             || f->addressFamily->length < 2)",
      "91:         return 0;",
      "92:     return (f->addressFamily->data[0] << 8) | f->addressFamily->data[1];",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "8e3f60de0c7d7f34a4d9126e27dd3416d64f2011",
      "candidate_info": {
        "commit_hash": "8e3f60de0c7d7f34a4d9126e27dd3416d64f2011",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/8e3f60de0c7d7f34a4d9126e27dd3416d64f2011",
        "files": [
          "util/perl/TLSProxy/Proxy.pm"
        ],
        "message": "Catch SIGPIPE in TLSProxy::Proxy::clientstart\n\nReviewed-by: Richard Levitte <levitte@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/5071)\n\n(cherry picked from commit 438e57a43f096d37bf316869b98780e24596a5e8)",
        "before_after_code_files": [
          "util/perl/TLSProxy/Proxy.pm||util/perl/TLSProxy/Proxy.pm"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "util/perl/TLSProxy/Proxy.pm||util/perl/TLSProxy/Proxy.pm": [
          "File: util/perl/TLSProxy/Proxy.pm -> util/perl/TLSProxy/Proxy.pm",
          "--- Hunk 1 ---",
          "[Context before]",
          "280:     #Wait for either the server socket or the client socket to become readable",
          "281:     my @ready;",
          "282:     while(!(TLSProxy::Message->end) && (@ready = $sel->can_read)) {",
          "283:         foreach my $hand (@ready) {",
          "284:             if ($hand == $server_sock) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "282:     local $SIG{PIPE} = \"IGNORE\";",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "fd91e61f522b236d80347f0910f778314fb6ae18",
      "candidate_info": {
        "commit_hash": "fd91e61f522b236d80347f0910f778314fb6ae18",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/fd91e61f522b236d80347f0910f778314fb6ae18",
        "files": [
          "e_os.h"
        ],
        "message": "Add parentheses around macro argument of OSSL_NELEM.\n\nReviewed-by: Richard Levitte <levitte@openssl.org>\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/3039)\n\n(cherry picked from commit 26dc47f3c44c7fb4488d1becaf997737486f4922)",
        "before_after_code_files": [
          "e_os.h||e_os.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "e_os.h||e_os.h": [
          "File: e_os.h -> e_os.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "521: # endif",
          "526: #ifdef  __cplusplus",
          "527: }",
          "",
          "[Removed Lines]",
          "524: #define OSSL_NELEM(x)    (sizeof(x)/sizeof(x[0]))",
          "",
          "[Added Lines]",
          "524: #define OSSL_NELEM(x)    (sizeof(x)/sizeof((x)[0]))",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "56c13d2bfa1983d71bcfcc5dfaf3592c5c6978e2",
      "candidate_info": {
        "commit_hash": "56c13d2bfa1983d71bcfcc5dfaf3592c5c6978e2",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/56c13d2bfa1983d71bcfcc5dfaf3592c5c6978e2",
        "files": [
          "apps/s_socket.c"
        ],
        "message": "Fix bogus use of BIO_sock_should_retry.\n\nReviewed-by: Andy Polyakov <appro@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/3948)\n\n(cherry picked from commit daaaa3cb7e506466b38de995b3e5149f4045bdff)",
        "before_after_code_files": [
          "apps/s_socket.c||apps/s_socket.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "apps/s_socket.c||apps/s_socket.c": [
          "File: apps/s_socket.c -> apps/s_socket.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "171:         if (type == SOCK_STREAM) {",
          "172:             do {",
          "173:                 sock = BIO_accept_ex(asock, NULL, 0);",
          "175:             if (sock < 0) {",
          "176:                 ERR_print_errors(bio_err);",
          "177:                 BIO_closesocket(asock);",
          "",
          "[Removed Lines]",
          "174:             } while (sock < 0 && BIO_sock_should_retry(ret));",
          "",
          "[Added Lines]",
          "174:             } while (sock < 0 && BIO_sock_should_retry(sock));",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "833104e6bdfc41db06bf22e129d0ab43278628c5",
      "candidate_info": {
        "commit_hash": "833104e6bdfc41db06bf22e129d0ab43278628c5",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/833104e6bdfc41db06bf22e129d0ab43278628c5",
        "files": [
          "crypto/buffer/buffer.c"
        ],
        "message": "Fix crash in BUF_MEM_grow_clean.\n\nReviewed-by: Tim Hudson <tjh@openssl.org>\nReviewed-by: Ben Kaduk <kaduk@mit.edu>\n(Merged from https://github.com/openssl/openssl/pull/3896)\n\n(cherry picked from commit e1ca9e1f6db97052a0ebea6591f323b12b1e0020)",
        "before_after_code_files": [
          "crypto/buffer/buffer.c||crypto/buffer/buffer.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "crypto/buffer/buffer.c||crypto/buffer/buffer.c": [
          "File: crypto/buffer/buffer.c -> crypto/buffer/buffer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "63:     ret = OPENSSL_secure_malloc(len);",
          "64:     if (str->data != NULL) {",
          "66:             memcpy(ret, str->data, str->length);",
          "68:     }",
          "69:     return (ret);",
          "70: }",
          "",
          "[Removed Lines]",
          "65:         if (ret != NULL)",
          "67:         OPENSSL_secure_free(str->data);",
          "",
          "[Added Lines]",
          "65:         if (ret != NULL) {",
          "67:             OPENSSL_secure_free(str->data);",
          "68:             str->data = NULL;",
          "69:         }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "19c708d77d6b61fbd46c13d43f2b078eae5362f9",
      "candidate_info": {
        "commit_hash": "19c708d77d6b61fbd46c13d43f2b078eae5362f9",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/19c708d77d6b61fbd46c13d43f2b078eae5362f9",
        "files": [
          "doc/ssl/SSL_CTX_dane_enable.pod",
          "include/openssl/ssl.h",
          "ssl/ssl_lib.c"
        ],
        "message": "Make data argument const in SSL_dane_tlsa_add\n\nThe data argument of SSL_dane_tlsa_add is used read-only, so it\nshould be const.\n\nReviewed-by: Viktor Dukhovni <viktor@openssl.org>\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/5056)\n\n(cherry picked from commit a41a6120cdcb7e883481bc1bed55e7157c9255c4)",
        "before_after_code_files": [
          "include/openssl/ssl.h||include/openssl/ssl.h",
          "ssl/ssl_lib.c||ssl/ssl_lib.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "include/openssl/ssl.h||include/openssl/ssl.h": [
          "File: include/openssl/ssl.h -> include/openssl/ssl.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "1529:                                   uint8_t mtype, uint8_t ord);",
          "1530: __owur int SSL_dane_enable(SSL *s, const char *basedomain);",
          "1531: __owur int SSL_dane_tlsa_add(SSL *s, uint8_t usage, uint8_t selector,",
          "1533: __owur int SSL_get0_dane_authority(SSL *s, X509 **mcert, EVP_PKEY **mspki);",
          "1534: __owur int SSL_get0_dane_tlsa(SSL *s, uint8_t *usage, uint8_t *selector,",
          "1535:                               uint8_t *mtype, unsigned const char **data,",
          "",
          "[Removed Lines]",
          "1532:                              uint8_t mtype, unsigned char *data, size_t dlen);",
          "",
          "[Added Lines]",
          "1532:                              uint8_t mtype, unsigned const char *data, size_t dlen);",
          "",
          "---------------"
        ],
        "ssl/ssl_lib.c||ssl/ssl_lib.c": [
          "File: ssl/ssl_lib.c -> ssl/ssl_lib.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "320: static int dane_tlsa_add(SSL_DANE *dane,",
          "321:                          uint8_t usage,",
          "322:                          uint8_t selector,",
          "324: {",
          "325:     danetls_record *t;",
          "326:     const EVP_MD *md = NULL;",
          "",
          "[Removed Lines]",
          "323:                          uint8_t mtype, unsigned char *data, size_t dlen)",
          "",
          "[Added Lines]",
          "323:                          uint8_t mtype, unsigned const char *data, size_t dlen)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1076: }",
          "1078: int SSL_dane_tlsa_add(SSL *s, uint8_t usage, uint8_t selector,",
          "1080: {",
          "1081:     return dane_tlsa_add(&s->dane, usage, selector, mtype, data, dlen);",
          "1082: }",
          "",
          "[Removed Lines]",
          "1079:                       uint8_t mtype, unsigned char *data, size_t dlen)",
          "",
          "[Added Lines]",
          "1079:                       uint8_t mtype, unsigned const char *data, size_t dlen)",
          "",
          "---------------"
        ]
      }
    }
  ]
}