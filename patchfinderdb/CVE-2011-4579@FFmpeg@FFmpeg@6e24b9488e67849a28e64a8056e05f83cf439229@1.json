{
  "cve_id": "CVE-2011-4579",
  "cve_desc": "The svq1_decode_frame function in the SVQ1 decoder (svq1dec.c) in libavcodec in FFmpeg 0.5.x before 0.5.7, 0.6.x before 0.6.4, 0.7.x before 0.7.9, and 0.8.x before 0.8.8; and in Libav 0.5.x before 0.5.6, 0.6.x before 0.6.4, and 0.7.x before 0.7.3 allows remote attackers to cause a denial of service (memory corruption) via a crafted SVQ1 stream, related to \"dimensions changed.\"",
  "repo": "FFmpeg/FFmpeg",
  "patch_hash": "6e24b9488e67849a28e64a8056e05f83cf439229",
  "patch_info": {
    "commit_hash": "6e24b9488e67849a28e64a8056e05f83cf439229",
    "repo": "FFmpeg/FFmpeg",
    "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/6e24b9488e67849a28e64a8056e05f83cf439229",
    "files": [
      "libavcodec/svq1dec.c"
    ],
    "message": "svq1dec: call avcodec_set_dimensions() after dimensions changed.\n\nFixes NGS00148, CVE-2011-4579\n\nFound-by: Phillip Langlois\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>",
    "before_after_code_files": [
      "libavcodec/svq1dec.c||libavcodec/svq1dec.c"
    ]
  },
  "patch_diff": {
    "libavcodec/svq1dec.c||libavcodec/svq1dec.c": [
      "File: libavcodec/svq1dec.c -> libavcodec/svq1dec.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "659:     av_dlog(s->avctx, \"Error in svq1_decode_frame_header %i\\n\",result);",
      "660:     return result;",
      "661:   }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "662:   avcodec_set_dimensions(avctx, s->width, s->height);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "7b9fc769e40a7709fa59a54e2a810f76364eee4b",
      "candidate_info": {
        "commit_hash": "7b9fc769e40a7709fa59a54e2a810f76364eee4b",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/7b9fc769e40a7709fa59a54e2a810f76364eee4b",
        "files": [
          "libavcodec/svq1dec.c"
        ],
        "message": "svq1dec: use more common way to check if result is not zero\n\nSigned-off-by: Paul B Mahol <onemda@gmail.com>",
        "before_after_code_files": [
          "libavcodec/svq1dec.c||libavcodec/svq1dec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "libavcodec/svq1dec.c||libavcodec/svq1dec.c"
          ],
          "candidate": [
            "libavcodec/svq1dec.c||libavcodec/svq1dec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavcodec/svq1dec.c||libavcodec/svq1dec.c": [
          "File: libavcodec/svq1dec.c -> libavcodec/svq1dec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "333:     }",
          "335:     result = svq1_decode_motion_vector(bitbuf, &mv, pmv);",
          "338:         return result;",
          "340:     motion[0].x         =",
          "",
          "[Removed Lines]",
          "337:     if (result != 0)",
          "",
          "[Added Lines]",
          "336:     if (result)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "378:     }",
          "380:     result = svq1_decode_motion_vector(bitbuf, &mv, pmv);",
          "383:         return result;",
          "",
          "[Removed Lines]",
          "382:     if (result != 0)",
          "",
          "[Added Lines]",
          "380:     if (result)",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "391:         pmv[1] = &motion[(x / 8) + 3];",
          "392:     }",
          "393:     result = svq1_decode_motion_vector(bitbuf, &motion[0], pmv);",
          "396:         return result;",
          "",
          "[Removed Lines]",
          "395:     if (result != 0)",
          "",
          "[Added Lines]",
          "392:     if (result)",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "400:     pmv[2] = &motion[(x / 8) + 1];",
          "402:     result = svq1_decode_motion_vector(bitbuf, &motion[(x / 8) + 2], pmv);",
          "405:         return result;",
          "",
          "[Removed Lines]",
          "404:     if (result != 0)",
          "",
          "[Added Lines]",
          "400:     if (result)",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "409:     pmv[3] = &motion[(x / 8) + 3];",
          "411:     result = svq1_decode_motion_vector(bitbuf, pmv[3], pmv);",
          "414:         return result;",
          "",
          "[Removed Lines]",
          "413:     if (result != 0)",
          "",
          "[Added Lines]",
          "408:     if (result)",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "467:     case SVQ1_BLOCK_INTER:",
          "468:         result = svq1_motion_inter_block(s, bitbuf, current, previous,",
          "469:                                          pitch, motion, x, y);",
          "472:             av_dlog(s->avctx, \"Error in svq1_motion_inter_block %i\\n\", result);",
          "473:             break;",
          "474:         }",
          "",
          "[Removed Lines]",
          "471:         if (result != 0) {",
          "",
          "[Added Lines]",
          "465:         if (result) {",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "478:     case SVQ1_BLOCK_INTER_4V:",
          "479:         result = svq1_motion_inter_4v_block(s, bitbuf, current, previous,",
          "480:                                             pitch, motion, x, y);",
          "483:             av_dlog(s->avctx,",
          "484:                     \"Error in svq1_motion_inter_4v_block %i\\n\", result);",
          "485:             break;",
          "",
          "[Removed Lines]",
          "482:         if (result != 0) {",
          "",
          "[Added Lines]",
          "475:         if (result) {",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "617:     }",
          "619:     result = svq1_decode_frame_header(&s->gb, s);",
          "622:         av_dlog(s->avctx, \"Error in svq1_decode_frame_header %i\\n\", result);",
          "623:         return result;",
          "624:     }",
          "",
          "[Removed Lines]",
          "621:     if (result != 0) {",
          "",
          "[Added Lines]",
          "613:     if (result) {",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "672:                 for (x = 0; x < width; x += 16) {",
          "673:                     result = svq1_decode_block_intra(&s->gb, &current[x],",
          "674:                                                      linesize);",
          "676:                         av_log(s->avctx, AV_LOG_INFO,",
          "677:                                \"Error in svq1_decode_block %i (keyframe)\\n\",",
          "678:                                result);",
          "",
          "[Removed Lines]",
          "675:                     if (result != 0) {",
          "",
          "[Added Lines]",
          "667:                     if (result) {",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "690:                     result = svq1_decode_delta_block(s, &s->gb, &current[x],",
          "691:                                                      previous, linesize,",
          "692:                                                      pmv, x, y);",
          "694:                         av_dlog(s->avctx,",
          "695:                                 \"Error in svq1_decode_delta_block %i\\n\",",
          "696:                                 result);",
          "",
          "[Removed Lines]",
          "693:                     if (result != 0) {",
          "",
          "[Added Lines]",
          "685:                     if (result) {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "661ee45f8881bb551eb403472e60c38a7c2818aa",
      "candidate_info": {
        "commit_hash": "661ee45f8881bb551eb403472e60c38a7c2818aa",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/661ee45f8881bb551eb403472e60c38a7c2818aa",
        "files": [
          "libavcodec/svq1dec.c"
        ],
        "message": "svq1dec: call avcodec_set_dimensions() after dimensions changed. Fixes NGS00148\n\nFound-by: Phillip Langlois\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>\n(cherry picked from commit 4931c8f0f10bf8dedcf626104a6b85bfefadc6f2)\n\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>",
        "before_after_code_files": [
          "libavcodec/svq1dec.c||libavcodec/svq1dec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavcodec/svq1dec.c||libavcodec/svq1dec.c"
          ],
          "candidate": [
            "libavcodec/svq1dec.c||libavcodec/svq1dec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavcodec/svq1dec.c||libavcodec/svq1dec.c": [
          "File: libavcodec/svq1dec.c -> libavcodec/svq1dec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "658:     av_dlog(s->avctx, \"Error in svq1_decode_frame_header %i\\n\",result);",
          "659:     return result;",
          "660:   }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "661:   avcodec_set_dimensions(avctx, s->width, s->height);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "cc2580e6e98c6a9687aae6d62341d188fa31efd5",
      "candidate_info": {
        "commit_hash": "cc2580e6e98c6a9687aae6d62341d188fa31efd5",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/cc2580e6e98c6a9687aae6d62341d188fa31efd5",
        "files": [
          "libavcodec/svq1dec.c"
        ],
        "message": "svq1dec: call avcodec_set_dimensions() after dimensions changed. Fixes NGS00148\n\nFound-by: Phillip Langlois\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>\n(cherry picked from commit 4931c8f0f10bf8dedcf626104a6b85bfefadc6f2)\n\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>\n(cherry picked from commit 661ee45f8881bb551eb403472e60c38a7c2818aa)\n\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>",
        "before_after_code_files": [
          "libavcodec/svq1dec.c||libavcodec/svq1dec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavcodec/svq1dec.c||libavcodec/svq1dec.c"
          ],
          "candidate": [
            "libavcodec/svq1dec.c||libavcodec/svq1dec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavcodec/svq1dec.c||libavcodec/svq1dec.c": [
          "File: libavcodec/svq1dec.c -> libavcodec/svq1dec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "676: #endif",
          "677:     return result;",
          "678:   }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "679:   avcodec_set_dimensions(avctx, s->width, s->height);",
          "",
          "---------------"
        ]
      }
    }
  ]
}