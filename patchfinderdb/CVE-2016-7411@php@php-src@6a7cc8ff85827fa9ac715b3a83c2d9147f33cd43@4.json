{
  "cve_id": "CVE-2016-7411",
  "cve_desc": "ext/standard/var_unserializer.re in PHP before 5.6.26 mishandles object-deserialization failures, which allows remote attackers to cause a denial of service (memory corruption) or possibly have unspecified other impact via an unserialize call that references a partially constructed object.",
  "repo": "php/php-src",
  "patch_hash": "6a7cc8ff85827fa9ac715b3a83c2d9147f33cd43",
  "patch_info": {
    "commit_hash": "6a7cc8ff85827fa9ac715b3a83c2d9147f33cd43",
    "repo": "php/php-src",
    "commit_url": "https://github.com/php/php-src/commit/6a7cc8ff85827fa9ac715b3a83c2d9147f33cd43",
    "files": [
      "Zend/zend_objects_API.c",
      "ext/standard/tests/serialize/bug73052.phpt",
      "ext/standard/var_unserializer.c",
      "ext/standard/var_unserializer.re"
    ],
    "message": "Fix bug #73052 - Memory Corruption in During Deserialized-object Destruction",
    "before_after_code_files": [
      "Zend/zend_objects_API.c||Zend/zend_objects_API.c",
      "ext/standard/tests/serialize/bug73052.phpt||ext/standard/tests/serialize/bug73052.phpt",
      "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
      "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
    ]
  },
  "patch_diff": {
    "Zend/zend_objects_API.c||Zend/zend_objects_API.c": [
      "File: Zend/zend_objects_API.c -> Zend/zend_objects_API.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "306: {",
      "307:  zend_object_handle handle = Z_OBJ_HANDLE_P(zobject);",
      "308:  zend_object_store_bucket *obj_bucket = &EG(objects_store).object_buckets[handle];",
      "311:  obj_bucket->destructor_called = 1;",
      "312: }",
      "",
      "[Removed Lines]",
      "310:  obj_bucket->bucket.obj.handlers = Z_OBJ_HT_P(zobject);;",
      "",
      "[Added Lines]",
      "310:  obj_bucket->bucket.obj.handlers = Z_OBJ_HT_P(zobject);",
      "",
      "---------------"
    ],
    "ext/standard/tests/serialize/bug73052.phpt||ext/standard/tests/serialize/bug73052.phpt": [
      "File: ext/standard/tests/serialize/bug73052.phpt -> ext/standard/tests/serialize/bug73052.phpt",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: --TEST--",
      "2: Bug #73052: Memory Corruption in During Deserialized-object Destruction",
      "3: --FILE--",
      "4: <?php",
      "6: class obj {",
      "7:     var $ryat;",
      "8:     public function __destruct() {",
      "9:         $this->ryat = null;",
      "10:     }",
      "11: }",
      "13: $poc = 'O:3:\"obj\":1:{';",
      "14: var_dump(unserialize($poc));",
      "15: ?>",
      "16: --EXPECTF--",
      "17: Notice: unserialize(): Error at offset 13 of 13 bytes in %sbug73052.php on line %d",
      "18: bool(false)",
      "",
      "---------------"
    ],
    "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
      "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "438:      if(Z_TYPE_PP(rval) == IS_OBJECT) {",
      "439:         zend_hash_clean(Z_OBJPROP_PP(rval));",
      "440:      }",
      "441:      ZVAL_NULL(*rval);",
      "442:   return 0;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "440:         zend_object_store_ctor_failed(*rval TSRMLS_CC);",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "495: {",
      "496:  YYCTYPE yych;",
      "497:  static const unsigned char yybm[] = {",
      "",
      "[Removed Lines]",
      "494: #line 495 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "495: #line 496 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "551:  yych = *(YYMARKER = ++YYCURSOR);",
      "552:  if (yych == ':') goto yy95;",
      "553: yy3:",
      "555:  { return 0; }",
      "557: yy4:",
      "558:  yych = *(YYMARKER = ++YYCURSOR);",
      "559:  if (yych == ':') goto yy89;",
      "",
      "[Removed Lines]",
      "554: #line 860 \"ext/standard/var_unserializer.re\"",
      "556: #line 557 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "555: #line 861 \"ext/standard/var_unserializer.re\"",
      "557: #line 558 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "596:  goto yy3;",
      "597: yy14:",
      "598:  ++YYCURSOR;",
      "600:  {",
      "602:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
      "604: }",
      "606: yy16:",
      "607:  yych = *++YYCURSOR;",
      "608:  goto yy3;",
      "",
      "[Removed Lines]",
      "599: #line 854 \"ext/standard/var_unserializer.re\"",
      "605: #line 606 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "600: #line 855 \"ext/standard/var_unserializer.re\"",
      "606: #line 607 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "633:  yych = *++YYCURSOR;",
      "634:  if (yych != '\"') goto yy18;",
      "635:  ++YYCURSOR;",
      "637:  {",
      "638:  size_t len, len2, len3, maxlen;",
      "639:  long elements;",
      "",
      "[Removed Lines]",
      "636: #line 707 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "637: #line 708 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "781:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
      "782: }",
      "784: yy25:",
      "785:  yych = *++YYCURSOR;",
      "786:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "783: #line 784 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "784: #line 785 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "805:  yych = *++YYCURSOR;",
      "806:  if (yych != '\"') goto yy18;",
      "807:  ++YYCURSOR;",
      "809:  {",
      "810:     if (!var_hash) return 0;",
      "",
      "[Removed Lines]",
      "808: #line 698 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "809: #line 699 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 8 ---",
      "[Context before]",
      "814:  return object_common2(UNSERIALIZE_PASSTHRU,",
      "815:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
      "816: }",
      "818: yy32:",
      "819:  yych = *++YYCURSOR;",
      "820:  if (yych == '+') goto yy33;",
      "",
      "[Removed Lines]",
      "817: #line 818 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "818: #line 819 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 9 ---",
      "[Context before]",
      "835:  yych = *++YYCURSOR;",
      "836:  if (yych != '{') goto yy18;",
      "837:  ++YYCURSOR;",
      "839:  {",
      "840:  long elements = parse_iv(start + 2);",
      "",
      "[Removed Lines]",
      "838: #line 677 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "839: #line 678 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 10 ---",
      "[Context before]",
      "857:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
      "858: }",
      "860: yy39:",
      "861:  yych = *++YYCURSOR;",
      "862:  if (yych == '+') goto yy40;",
      "",
      "[Removed Lines]",
      "859: #line 860 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "860: #line 861 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 11 ---",
      "[Context before]",
      "877:  yych = *++YYCURSOR;",
      "878:  if (yych != '\"') goto yy18;",
      "879:  ++YYCURSOR;",
      "881:  {",
      "882:  size_t len, maxlen;",
      "883:  char *str;",
      "",
      "[Removed Lines]",
      "880: #line 642 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "881: #line 643 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 12 ---",
      "[Context before]",
      "912:  ZVAL_STRINGL(*rval, str, len, 0);",
      "913:  return 1;",
      "914: }",
      "916: yy46:",
      "917:  yych = *++YYCURSOR;",
      "918:  if (yych == '+') goto yy47;",
      "",
      "[Removed Lines]",
      "915: #line 916 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "916: #line 917 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 13 ---",
      "[Context before]",
      "933:  yych = *++YYCURSOR;",
      "934:  if (yych != '\"') goto yy18;",
      "935:  ++YYCURSOR;",
      "937:  {",
      "938:  size_t len, maxlen;",
      "939:  char *str;",
      "",
      "[Removed Lines]",
      "936: #line 609 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "937: #line 610 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 14 ---",
      "[Context before]",
      "966:  ZVAL_STRINGL(*rval, str, len, 1);",
      "967:  return 1;",
      "968: }",
      "970: yy53:",
      "971:  yych = *++YYCURSOR;",
      "972:  if (yych <= '/') {",
      "",
      "[Removed Lines]",
      "969: #line 970 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "970: #line 971 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 15 ---",
      "[Context before]",
      "1054:  }",
      "1055: yy63:",
      "1056:  ++YYCURSOR;",
      "1058:  {",
      "1059: #if SIZEOF_LONG == 4",
      "1060: use_double:",
      "",
      "[Removed Lines]",
      "1057: #line 599 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1058: #line 600 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 16 ---",
      "[Context before]",
      "1064:  ZVAL_DOUBLE(*rval, zend_strtod((const char *)start + 2, NULL));",
      "1065:  return 1;",
      "1066: }",
      "1068: yy65:",
      "1069:  yych = *++YYCURSOR;",
      "1070:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1067: #line 1068 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1068: #line 1069 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 17 ---",
      "[Context before]",
      "1123:  yych = *++YYCURSOR;",
      "1124:  if (yych != ';') goto yy18;",
      "1125:  ++YYCURSOR;",
      "1127:  {",
      "1129:  INIT_PZVAL(*rval);",
      "",
      "[Removed Lines]",
      "1126: #line 584 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1127: #line 585 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 18 ---",
      "[Context before]",
      "1139:  return 1;",
      "1140: }",
      "1142: yy76:",
      "1143:  yych = *++YYCURSOR;",
      "1144:  if (yych == 'N') goto yy73;",
      "",
      "[Removed Lines]",
      "1141: #line 1142 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1142: #line 1143 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 19 ---",
      "[Context before]",
      "1165:  if (yych <= '9') goto yy79;",
      "1166:  if (yych != ';') goto yy18;",
      "1167:  ++YYCURSOR;",
      "1169:  {",
      "1170: #if SIZEOF_LONG == 4",
      "1171:  int digits = YYCURSOR - start - 3;",
      "",
      "[Removed Lines]",
      "1168: #line 557 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1169: #line 558 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 20 ---",
      "[Context before]",
      "1192:  ZVAL_LONG(*rval, parse_iv(start + 2));",
      "1193:  return 1;",
      "1194: }",
      "1196: yy83:",
      "1197:  yych = *++YYCURSOR;",
      "1198:  if (yych <= '/') goto yy18;",
      "",
      "[Removed Lines]",
      "1195: #line 1196 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1196: #line 1197 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 21 ---",
      "[Context before]",
      "1200:  yych = *++YYCURSOR;",
      "1201:  if (yych != ';') goto yy18;",
      "1202:  ++YYCURSOR;",
      "1204:  {",
      "1206:  INIT_PZVAL(*rval);",
      "1207:  ZVAL_BOOL(*rval, parse_iv(start + 2));",
      "1208:  return 1;",
      "1209: }",
      "1211: yy87:",
      "1212:  ++YYCURSOR;",
      "1214:  {",
      "1216:  INIT_PZVAL(*rval);",
      "1217:  ZVAL_NULL(*rval);",
      "1218:  return 1;",
      "1219: }",
      "1221: yy89:",
      "1222:  yych = *++YYCURSOR;",
      "1223:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1203: #line 550 \"ext/standard/var_unserializer.re\"",
      "1210: #line 1211 \"ext/standard/var_unserializer.c\"",
      "1213: #line 543 \"ext/standard/var_unserializer.re\"",
      "1220: #line 1221 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1204: #line 551 \"ext/standard/var_unserializer.re\"",
      "1211: #line 1212 \"ext/standard/var_unserializer.c\"",
      "1214: #line 544 \"ext/standard/var_unserializer.re\"",
      "1221: #line 1222 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 22 ---",
      "[Context before]",
      "1240:  if (yych <= '9') goto yy91;",
      "1241:  if (yych != ';') goto yy18;",
      "1242:  ++YYCURSOR;",
      "1244:  {",
      "1245:  long id;",
      "",
      "[Removed Lines]",
      "1243: #line 520 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1244: #line 521 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 23 ---",
      "[Context before]",
      "1264:  return 1;",
      "1265: }",
      "1267: yy95:",
      "1268:  yych = *++YYCURSOR;",
      "1269:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1266: #line 1267 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1267: #line 1268 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 24 ---",
      "[Context before]",
      "1286:  if (yych <= '9') goto yy97;",
      "1287:  if (yych != ';') goto yy18;",
      "1288:  ++YYCURSOR;",
      "1290:  {",
      "1291:  long id;",
      "",
      "[Removed Lines]",
      "1289: #line 499 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1290: #line 500 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 25 ---",
      "[Context before]",
      "1308:  return 1;",
      "1309: }",
      "1311: }",
      "1315:  return 0;",
      "",
      "[Removed Lines]",
      "1310: #line 1311 \"ext/standard/var_unserializer.c\"",
      "1312: #line 862 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1311: #line 1312 \"ext/standard/var_unserializer.c\"",
      "1313: #line 863 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------"
    ],
    "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
      "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
      "--- Hunk 1 ---",
      "[Context before]",
      "442:      if(Z_TYPE_PP(rval) == IS_OBJECT) {",
      "443:         zend_hash_clean(Z_OBJPROP_PP(rval));",
      "444:      }",
      "445:      ZVAL_NULL(*rval);",
      "446:   return 0;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "444:         zend_object_store_ctor_failed(*rval TSRMLS_CC);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "aeb30576f6e6f4458c922a5c7ac15ec1a25625f9",
      "candidate_info": {
        "commit_hash": "aeb30576f6e6f4458c922a5c7ac15ec1a25625f9",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/aeb30576f6e6f4458c922a5c7ac15ec1a25625f9",
        "files": [
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re",
          "standard/tests/serialize/bug68545.phpt"
        ],
        "message": "Merge branch 'PHP-5.6'\n\n* PHP-5.6:\n  updated NEWS\n  Fixed bug #68545 NULL pointer dereference in unserialize.c\n  Updated NEWS\n  Updated NEWS\n\nConflicts:\n\text/standard/var_unserializer.c\n\text/standard/var_unserializer.re",
        "before_after_code_files": [
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re",
          "standard/tests/serialize/bug68545.phpt||standard/tests/serialize/bug68545.phpt"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "67: PHPAPI void var_push_dtor(php_unserialize_data_t *var_hashx, zval *rval)",
          "68: {",
          "70: #if VAR_ENTRIES_DBG",
          "71:  fprintf(stderr, \"var_push_dtor(%ld): %d\\n\", var_hash?var_hash->used_slots:-1L, Z_TYPE_PP(rval));",
          "72: #endif",
          "",
          "[Removed Lines]",
          "69:  var_dtor_entries *var_hash = (*var_hashx)->last_dtor;",
          "",
          "[Added Lines]",
          "69:  var_dtor_entries *var_hash;",
          "71:  if (!var_hashx || !*var_hashx) {",
          "72:   return;",
          "73:  }",
          "75:  var_hash = (*var_hashx)->last_dtor;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "253: #define YYMARKER marker",
          "",
          "[Removed Lines]",
          "256: #line 261 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "262: #line 267 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "509:  start = cursor;",
          "513: {",
          "514:  YYCTYPE yych;",
          "515:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "512: #line 513 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "518: #line 519 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "569:  yych = *(YYMARKER = ++YYCURSOR);",
          "570:  if (yych == ':') goto yy95;",
          "571: yy3:",
          "573:  { return 0; }",
          "575: yy4:",
          "576:  yych = *(YYMARKER = ++YYCURSOR);",
          "577:  if (yych == ':') goto yy89;",
          "",
          "[Removed Lines]",
          "572: #line 860 \"ext/standard/var_unserializer.re\"",
          "574: #line 575 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "578: #line 866 \"ext/standard/var_unserializer.re\"",
          "580: #line 581 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "614:  goto yy3;",
          "615: yy14:",
          "616:  ++YYCURSOR;",
          "618:  {",
          "620:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
          "622: }",
          "624: yy16:",
          "625:  yych = *++YYCURSOR;",
          "626:  goto yy3;",
          "",
          "[Removed Lines]",
          "617: #line 854 \"ext/standard/var_unserializer.re\"",
          "623: #line 624 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "623: #line 860 \"ext/standard/var_unserializer.re\"",
          "629: #line 630 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "646:  if (yybm[0+yych] & 128) {",
          "647:   goto yy20;",
          "648:  }",
          "651:  yych = *++YYCURSOR;",
          "652:  if (yych != '\"') goto yy18;",
          "653:  ++YYCURSOR;",
          "655:  {",
          "656:  size_t len, len2, len3, maxlen;",
          "657:  zend_long elements;",
          "",
          "[Removed Lines]",
          "649:  if (yych <= '/') goto yy18;",
          "650:  if (yych >= ';') goto yy18;",
          "654: #line 709 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "655:  if (yych != ':') goto yy18;",
          "659: #line 715 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "797:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "798: }",
          "800: yy25:",
          "801:  yych = *++YYCURSOR;",
          "802:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "799: #line 800 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "804: #line 805 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "821:  yych = *++YYCURSOR;",
          "822:  if (yych != '\"') goto yy18;",
          "823:  ++YYCURSOR;",
          "825:  {",
          "",
          "[Removed Lines]",
          "824: #line 701 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "829: #line 707 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "829:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "830:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "831: }",
          "833: yy32:",
          "834:  yych = *++YYCURSOR;",
          "835:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "832: #line 833 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "837: #line 838 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "850:  yych = *++YYCURSOR;",
          "851:  if (yych != '{') goto yy18;",
          "852:  ++YYCURSOR;",
          "854:  {",
          "855:  zend_long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "853: #line 680 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "858: #line 686 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "872:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "873: }",
          "875: yy39:",
          "876:  yych = *++YYCURSOR;",
          "877:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "874: #line 875 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "879: #line 880 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "892:  yych = *++YYCURSOR;",
          "893:  if (yych != '\"') goto yy18;",
          "894:  ++YYCURSOR;",
          "896:  {",
          "897:  size_t len, maxlen;",
          "898:  zend_string *str;",
          "",
          "[Removed Lines]",
          "895: #line 652 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "900: #line 658 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "920:  ZVAL_STR(rval, str);",
          "921:  return 1;",
          "922: }",
          "924: yy46:",
          "925:  yych = *++YYCURSOR;",
          "926:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "923: #line 924 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "928: #line 929 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "941:  yych = *++YYCURSOR;",
          "942:  if (yych != '\"') goto yy18;",
          "943:  ++YYCURSOR;",
          "945:  {",
          "946:  size_t len, maxlen;",
          "947:  char *str;",
          "",
          "[Removed Lines]",
          "944: #line 625 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "949: #line 631 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "968:  ZVAL_STRINGL(rval, str, len);",
          "969:  return 1;",
          "970: }",
          "972: yy53:",
          "973:  yych = *++YYCURSOR;",
          "974:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "971: #line 972 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "976: #line 977 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1056:  }",
          "1057: yy63:",
          "1058:  ++YYCURSOR;",
          "1060:  {",
          "1061: #if SIZEOF_ZEND_LONG == 4",
          "1062: use_double:",
          "",
          "[Removed Lines]",
          "1059: #line 616 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1064: #line 622 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1065:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1066:  return 1;",
          "1067: }",
          "1069: yy65:",
          "1070:  yych = *++YYCURSOR;",
          "1071:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1068: #line 1069 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1073: #line 1074 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "1124:  yych = *++YYCURSOR;",
          "1125:  if (yych != ';') goto yy18;",
          "1126:  ++YYCURSOR;",
          "1128:  {",
          "",
          "[Removed Lines]",
          "1127: #line 600 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1132: #line 606 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1141:  return 1;",
          "1142: }",
          "1144: yy76:",
          "1145:  yych = *++YYCURSOR;",
          "1146:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1143: #line 1144 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1148: #line 1149 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1167:  if (yych <= '9') goto yy79;",
          "1168:  if (yych != ';') goto yy18;",
          "1169:  ++YYCURSOR;",
          "1171:  {",
          "1172: #if SIZEOF_ZEND_LONG == 4",
          "1173:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1170: #line 574 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1175: #line 580 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "1193:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1194:  return 1;",
          "1195: }",
          "1197: yy83:",
          "1198:  yych = *++YYCURSOR;",
          "1199:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1196: #line 1197 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1201: #line 1202 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "1201:  yych = *++YYCURSOR;",
          "1202:  if (yych != ';') goto yy18;",
          "1203:  ++YYCURSOR;",
          "1205:  {",
          "1207:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1208:  return 1;",
          "1209: }",
          "1211: yy87:",
          "1212:  ++YYCURSOR;",
          "1214:  {",
          "1216:  ZVAL_NULL(rval);",
          "1217:  return 1;",
          "1218: }",
          "1220: yy89:",
          "1221:  yych = *++YYCURSOR;",
          "1222:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1204: #line 568 \"ext/standard/var_unserializer.re\"",
          "1210: #line 1211 \"ext/standard/var_unserializer.c\"",
          "1213: #line 562 \"ext/standard/var_unserializer.re\"",
          "1219: #line 1220 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1209: #line 574 \"ext/standard/var_unserializer.re\"",
          "1215: #line 1216 \"ext/standard/var_unserializer.c\"",
          "1218: #line 568 \"ext/standard/var_unserializer.re\"",
          "1224: #line 1225 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "1239:  if (yych <= '9') goto yy91;",
          "1240:  if (yych != ';') goto yy18;",
          "1241:  ++YYCURSOR;",
          "1243:  {",
          "1244:  zend_long id;",
          "",
          "[Removed Lines]",
          "1242: #line 539 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1247: #line 545 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "1263:  return 1;",
          "1264: }",
          "1266: yy95:",
          "1267:  yych = *++YYCURSOR;",
          "1268:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1265: #line 1266 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1270: #line 1271 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 25 ---",
          "[Context before]",
          "1285:  if (yych <= '9') goto yy97;",
          "1286:  if (yych != ';') goto yy18;",
          "1287:  ++YYCURSOR;",
          "1289:  {",
          "1290:  zend_long id;",
          "",
          "[Removed Lines]",
          "1288: #line 517 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1293: #line 523 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 26 ---",
          "[Context before]",
          "1308:  return 1;",
          "1309: }",
          "1311: }",
          "1315:  return 0;",
          "",
          "[Removed Lines]",
          "1310: #line 1311 \"ext/standard/var_unserializer.c\"",
          "1312: #line 862 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1315: #line 1316 \"ext/standard/var_unserializer.c\"",
          "1317: #line 868 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "65: PHPAPI void var_push_dtor(php_unserialize_data_t *var_hashx, zval *rval)",
          "66: {",
          "68: #if VAR_ENTRIES_DBG",
          "69:  fprintf(stderr, \"var_push_dtor(%ld): %d\\n\", var_hash?var_hash->used_slots:-1L, Z_TYPE_PP(rval));",
          "70: #endif",
          "",
          "[Removed Lines]",
          "67:  var_dtor_entries *var_hash = (*var_hashx)->last_dtor;",
          "",
          "[Added Lines]",
          "67:  var_dtor_entries *var_hash;",
          "69:  if (!var_hashx || !*var_hashx) {",
          "70:   return;",
          "71:  }",
          "73:  var_hash = (*var_hashx)->last_dtor;",
          "",
          "---------------"
        ],
        "standard/tests/serialize/bug68545.phpt||standard/tests/serialize/bug68545.phpt": [
          "File: standard/tests/serialize/bug68545.phpt -> standard/tests/serialize/bug68545.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #68545 NULL pointer dereference in unserialize.c:var_push_dtor",
          "3: --FILE--",
          "4: <?php",
          "5: var_dump(unserialize('a:6:{a:6:{s:3:\"322\";s:3:\"bar\";s:3:\"bar\";s:3:\"foo\";a:6:{a:6:{s:3:\"322\";s:3:\"bar\";s:3:\"bar\";s:3:\"foo\";s:3:\"bar\";a:6:{a:6:{s:3:\"322\";s:3:\"bar\";s:3:\"bar\";s:3:\"foo\";a:6:{a:6:{s:3:\"322\";s:3:\"bar\";s:3:\"b22\";s:3:\"bar\";s:3:\"bar\";s:3:\"foo\";s:3:\"bar\";a:6:{a:6:{s:3:\"322\";s:3:\"bar\";s:3:\"bar\";s:3:\"foo\";s:3:\"bar\";s:3:\"bar\";'));",
          "6: ?>",
          "7: ===DONE===",
          "8: --EXPECTF--",
          "9: Notice: unserialize(): Error at offset %d of %d bytes in %sbug68545.php on line %d",
          "10: bool(false)",
          "11: ===DONE===",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "6ee5e813ab5e97624a8474269ed5bdb7f6b85de5",
      "candidate_info": {
        "commit_hash": "6ee5e813ab5e97624a8474269ed5bdb7f6b85de5",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/6ee5e813ab5e97624a8474269ed5bdb7f6b85de5",
        "files": [
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "var_push_dtor_no_addref() is useles (var_push_dtor() doesn't work properly as well)",
        "before_after_code_files": [
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "83:  var_hash->data[var_hash->used_slots++] = rval;",
          "84: }",
          "86: PHPAPI void var_push_dtor_no_addref(php_unserialize_data_t *var_hashx, zval *rval)",
          "87: {",
          "88:  var_entries *var_hash = (*var_hashx)->last_dtor;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "87: #if 0",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "107:  var_hash->data[var_hash->used_slots++] = rval;",
          "108: }",
          "110: static int var_access(php_unserialize_data_t *var_hashx, long id, zval **store)",
          "111: {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "111: #endif",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "207: #define YYMARKER marker",
          "",
          "[Removed Lines]",
          "210: #line 215 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "213: #line 218 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "439:  start = cursor;",
          "443: {",
          "444:  YYCTYPE yych;",
          "445:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "442: #line 443 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "445: #line 446 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "499:  yych = *(YYMARKER = ++YYCURSOR);",
          "500:  if (yych == ':') goto yy95;",
          "501: yy3:",
          "503:  { return 0; }",
          "505: yy4:",
          "506:  yych = *(YYMARKER = ++YYCURSOR);",
          "507:  if (yych == ':') goto yy89;",
          "",
          "[Removed Lines]",
          "502: #line 789 \"ext/standard/var_unserializer.re\"",
          "504: #line 505 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "505: #line 792 \"ext/standard/var_unserializer.re\"",
          "507: #line 508 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "544:  goto yy3;",
          "545: yy14:",
          "546:  ++YYCURSOR;",
          "548:  {",
          "550:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
          "552: }",
          "554: yy16:",
          "555:  yych = *++YYCURSOR;",
          "556:  goto yy3;",
          "",
          "[Removed Lines]",
          "547: #line 783 \"ext/standard/var_unserializer.re\"",
          "553: #line 554 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "550: #line 786 \"ext/standard/var_unserializer.re\"",
          "556: #line 557 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "580:  yych = *++YYCURSOR;",
          "581:  if (yych != '\"') goto yy18;",
          "582:  ++YYCURSOR;",
          "584:  {",
          "585:  size_t len, len2, len3, maxlen;",
          "586:  long elements;",
          "",
          "[Removed Lines]",
          "583: #line 644 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "586: #line 647 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "720:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "721: }",
          "723: yy25:",
          "724:  yych = *++YYCURSOR;",
          "725:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "722: #line 723 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "725: #line 726 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "744:  yych = *++YYCURSOR;",
          "745:  if (yych != '\"') goto yy18;",
          "746:  ++YYCURSOR;",
          "748:  {",
          "",
          "[Removed Lines]",
          "747: #line 636 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "750: #line 639 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "752:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "753:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "754: }",
          "756: yy32:",
          "757:  yych = *++YYCURSOR;",
          "758:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "755: #line 756 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "758: #line 759 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "773:  yych = *++YYCURSOR;",
          "774:  if (yych != '{') goto yy18;",
          "775:  ++YYCURSOR;",
          "777:  {",
          "778:  long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "776: #line 615 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "779: #line 618 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "795:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "796: }",
          "798: yy39:",
          "799:  yych = *++YYCURSOR;",
          "800:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "797: #line 798 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "800: #line 801 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "815:  yych = *++YYCURSOR;",
          "816:  if (yych != '\"') goto yy18;",
          "817:  ++YYCURSOR;",
          "819:  {",
          "820:  size_t len, maxlen;",
          "",
          "[Removed Lines]",
          "818: #line 585 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "821: #line 588 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "845:  efree(str);",
          "846:  return 1;",
          "847: }",
          "849: yy46:",
          "850:  yych = *++YYCURSOR;",
          "851:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "848: #line 849 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "851: #line 852 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "866:  yych = *++YYCURSOR;",
          "867:  if (yych != '\"') goto yy18;",
          "868:  ++YYCURSOR;",
          "870:  {",
          "871:  size_t len, maxlen;",
          "872:  char *str;",
          "",
          "[Removed Lines]",
          "869: #line 558 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "872: #line 561 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "893:  ZVAL_STRINGL(rval, str, len);",
          "894:  return 1;",
          "895: }",
          "897: yy53:",
          "898:  yych = *++YYCURSOR;",
          "899:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "896: #line 897 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "899: #line 900 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "981:  }",
          "982: yy63:",
          "983:  ++YYCURSOR;",
          "985:  {",
          "986: #if SIZEOF_LONG == 4",
          "987: use_double:",
          "",
          "[Removed Lines]",
          "984: #line 549 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "987: #line 552 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "990:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "991:  return 1;",
          "992: }",
          "994: yy65:",
          "995:  yych = *++YYCURSOR;",
          "996:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "993: #line 994 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "996: #line 997 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1049:  yych = *++YYCURSOR;",
          "1050:  if (yych != ';') goto yy18;",
          "1051:  ++YYCURSOR;",
          "1053:  {",
          "",
          "[Removed Lines]",
          "1052: #line 533 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1055: #line 536 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1066:  return 1;",
          "1067: }",
          "1069: yy76:",
          "1070:  yych = *++YYCURSOR;",
          "1071:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1068: #line 1069 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1071: #line 1072 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "1092:  if (yych <= '9') goto yy79;",
          "1093:  if (yych != ';') goto yy18;",
          "1094:  ++YYCURSOR;",
          "1096:  {",
          "1097: #if SIZEOF_LONG == 4",
          "1098:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1095: #line 507 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1098: #line 510 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "1118:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1119:  return 1;",
          "1120: }",
          "1122: yy83:",
          "1123:  yych = *++YYCURSOR;",
          "1124:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1121: #line 1122 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1124: #line 1125 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "1126:  yych = *++YYCURSOR;",
          "1127:  if (yych != ';') goto yy18;",
          "1128:  ++YYCURSOR;",
          "1130:  {",
          "1132:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1133:  return 1;",
          "1134: }",
          "1136: yy87:",
          "1137:  ++YYCURSOR;",
          "1139:  {",
          "1141:  ZVAL_NULL(rval);",
          "1142:  return 1;",
          "1143: }",
          "1145: yy89:",
          "1146:  yych = *++YYCURSOR;",
          "1147:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1129: #line 501 \"ext/standard/var_unserializer.re\"",
          "1135: #line 1136 \"ext/standard/var_unserializer.c\"",
          "1138: #line 495 \"ext/standard/var_unserializer.re\"",
          "1144: #line 1145 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1132: #line 504 \"ext/standard/var_unserializer.re\"",
          "1138: #line 1139 \"ext/standard/var_unserializer.c\"",
          "1141: #line 498 \"ext/standard/var_unserializer.re\"",
          "1147: #line 1148 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "1164:  if (yych <= '9') goto yy91;",
          "1165:  if (yych != ';') goto yy18;",
          "1166:  ++YYCURSOR;",
          "1168:  {",
          "1169:  long id;",
          "",
          "[Removed Lines]",
          "1167: #line 472 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1170: #line 475 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 25 ---",
          "[Context before]",
          "1185:  ZVAL_COPY(rval, rval_ref);",
          "1188:  return 1;",
          "1189: }",
          "1191: yy95:",
          "1192:  yych = *++YYCURSOR;",
          "1193:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1182:  if (!ZVAL_IS_UNDEF(rval)) {",
          "1183:   var_push_dtor_no_addref(var_hash, rval);",
          "1184:  }",
          "1190: #line 1191 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1193: #line 1194 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 26 ---",
          "[Context before]",
          "1210:  if (yych <= '9') goto yy97;",
          "1211:  if (yych != ';') goto yy18;",
          "1212:  ++YYCURSOR;",
          "1214:  {",
          "1215:  long id;",
          "",
          "[Removed Lines]",
          "1213: #line 447 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1216: #line 450 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 27 ---",
          "[Context before]",
          "1236:  return 1;",
          "1237: }",
          "1239: }",
          "1243:  return 0;",
          "",
          "[Removed Lines]",
          "1238: #line 1239 \"ext/standard/var_unserializer.c\"",
          "1240: #line 791 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1241: #line 1242 \"ext/standard/var_unserializer.c\"",
          "1243: #line 794 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "81:  var_hash->data[var_hash->used_slots++] = rval;",
          "82: }",
          "84: PHPAPI void var_push_dtor_no_addref(php_unserialize_data_t *var_hashx, zval *rval)",
          "85: {",
          "86:  var_entries *var_hash = (*var_hashx)->last_dtor;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "85: #if 0",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "105:  var_hash->data[var_hash->used_slots++] = rval;",
          "106: }",
          "108: static int var_access(php_unserialize_data_t *var_hashx, long id, zval **store)",
          "109: {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "109: #endif",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "489:  ZVAL_COPY(rval, rval_ref);",
          "",
          "[Removed Lines]",
          "486:  if (!ZVAL_IS_UNDEF(rval)) {",
          "487:   var_push_dtor_no_addref(var_hash, rval);",
          "488:  }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "be54eb7db10c6aa838cef969822a5ae0f4e605e3",
      "candidate_info": {
        "commit_hash": "be54eb7db10c6aa838cef969822a5ae0f4e605e3",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/be54eb7db10c6aa838cef969822a5ae0f4e605e3",
        "files": [
          "NEWS",
          "Zend/zend_hash.c",
          "Zend/zend_hash.h",
          "ext/soap/tests/bug70211.phpt",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Fixed bug #70211 (php 7 ZEND_HASH_IF_FULL_DO_RESIZE use after free)",
        "before_after_code_files": [
          "Zend/zend_hash.c||Zend/zend_hash.c",
          "Zend/zend_hash.h||Zend/zend_hash.h",
          "ext/soap/tests/bug70211.phpt||ext/soap/tests/bug70211.phpt",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "Zend/zend_hash.c||Zend/zend_hash.c": [
          "File: Zend/zend_hash.c -> Zend/zend_hash.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "807:  }",
          "808: }",
          "810: ZEND_API int ZEND_FASTCALL zend_hash_rehash(HashTable *ht)",
          "811: {",
          "812:  Bucket *p;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "810: ZEND_API int ZEND_FASTCALL zend_hash_resize(HashTable *ht, uint32_t size) {",
          "811:  void *old_data = HT_GET_DATA_ADDR(ht);",
          "812:  Bucket *old_buckets = ht->arData;",
          "814:  HANDLE_BLOCK_INTERRUPTIONS();",
          "815:  ht->nTableSize = zend_hash_check_size(size);",
          "816:  ht->nTableMask = -ht->nTableSize;",
          "817:  HT_SET_DATA_ADDR(ht, pemalloc(HT_SIZE(ht), ht->u.flags & HASH_FLAG_PERSISTENT));",
          "818:  memcpy(ht->arData, old_buckets, sizeof(Bucket) * ht->nNumUsed);",
          "819:  pefree(old_data, ht->u.flags & HASH_FLAG_PERSISTENT);",
          "820:  zend_hash_rehash(ht);",
          "821:  HANDLE_UNBLOCK_INTERRUPTIONS();",
          "822: }",
          "",
          "---------------"
        ],
        "Zend/zend_hash.h||Zend/zend_hash.h": [
          "File: Zend/zend_hash.h -> Zend/zend_hash.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "212: #define zend_hash_next_free_element(ht) \\",
          "213:  (ht)->nNextFreeElement",
          "215: ZEND_API int ZEND_FASTCALL zend_hash_rehash(HashTable *ht);",
          "217: ZEND_API HashTable* ZEND_FASTCALL zend_array_dup(HashTable *source);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "215: ZEND_API int ZEND_FASTCALL zend_hash_resize(HashTable *ht, uint32_t size);",
          "",
          "---------------"
        ],
        "ext/soap/tests/bug70211.phpt||ext/soap/tests/bug70211.phpt": [
          "File: ext/soap/tests/bug70211.phpt -> ext/soap/tests/bug70211.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #70211 (php 7 ZEND_HASH_IF_FULL_DO_RESIZE use after free)",
          "3: --FILE--",
          "4: <?php",
          "6: $addr = 0x4141414141414141;",
          "8: function ptr2str($ptr)",
          "9: {",
          "10:     $out = \"\";",
          "11:     for ($i=0; $i<8; $i++) {",
          "12:         $out .= chr($ptr & 0xff);",
          "13:         $ptr >>= 8;",
          "14:     }",
          "15:     return $out;",
          "16: }",
          "18: $sf = new SoapFault('1', 'string', 'detail', 'header','line', str_repeat(\"A\",232).ptr2str($addr));",
          "19: $ob = unserialize(\"a:3:{i:0;\".serialize($sf).'i:1;r:12;i:2;r:10;}');",
          "21: var_dump($ob[1]);",
          "22: ?>",
          "23: --EXPECT--",
          "24: string(6) \"detail\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "470: {",
          "471:  zval retval;",
          "472:  zval fname;",
          "474:  if (Z_TYPE_P(rval) != IS_OBJECT) {",
          "475:   return 0;",
          "476:  }",
          "480:   return 0;",
          "481:  }",
          "",
          "[Removed Lines]",
          "479:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_OBJPROP_P(rval), elements, 1)) {",
          "",
          "[Added Lines]",
          "473:  HashTable *ht = Z_OBJPROP_P(rval);",
          "479:  zend_hash_resize(ht, zend_hash_num_elements(ht) + elements);",
          "480:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, ht, elements, 1)) {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "528:  start = cursor;",
          "532: {",
          "533:  YYCTYPE yych;",
          "534:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "531: #line 532 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "532: #line 533 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "588:  yych = *(YYMARKER = ++YYCURSOR);",
          "589:  if (yych == ':') goto yy95;",
          "590: yy3:",
          "592:  { return 0; }",
          "594: yy4:",
          "595:  yych = *(YYMARKER = ++YYCURSOR);",
          "596:  if (yych == ':') goto yy89;",
          "",
          "[Removed Lines]",
          "591: #line 879 \"ext/standard/var_unserializer.re\"",
          "593: #line 594 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "592: #line 880 \"ext/standard/var_unserializer.re\"",
          "594: #line 595 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "633:  goto yy3;",
          "634: yy14:",
          "635:  ++YYCURSOR;",
          "637:  {",
          "639:  php_error_docref(NULL, E_NOTICE, \"Unexpected end of serialized data\");",
          "641: }",
          "643: yy16:",
          "644:  yych = *++YYCURSOR;",
          "645:  goto yy3;",
          "",
          "[Removed Lines]",
          "636: #line 873 \"ext/standard/var_unserializer.re\"",
          "642: #line 643 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "637: #line 874 \"ext/standard/var_unserializer.re\"",
          "643: #line 644 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "669:  yych = *++YYCURSOR;",
          "670:  if (yych != '\"') goto yy18;",
          "671:  ++YYCURSOR;",
          "673:  {",
          "674:  size_t len, len2, len3, maxlen;",
          "675:  zend_long elements;",
          "",
          "[Removed Lines]",
          "672: #line 728 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "673: #line 729 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "815:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "816: }",
          "818: yy25:",
          "819:  yych = *++YYCURSOR;",
          "820:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "817: #line 818 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "818: #line 819 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "839:  yych = *++YYCURSOR;",
          "840:  if (yych != '\"') goto yy18;",
          "841:  ++YYCURSOR;",
          "843:  {",
          "",
          "[Removed Lines]",
          "842: #line 720 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "843: #line 721 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "847:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "848:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "849: }",
          "851: yy32:",
          "852:  yych = *++YYCURSOR;",
          "853:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "850: #line 851 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "851: #line 852 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "868:  yych = *++YYCURSOR;",
          "869:  if (yych != '{') goto yy18;",
          "870:  ++YYCURSOR;",
          "872:  {",
          "873:  zend_long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "871: #line 699 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "872: #line 700 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "890:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "891: }",
          "893: yy39:",
          "894:  yych = *++YYCURSOR;",
          "895:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "892: #line 893 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "893: #line 894 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "910:  yych = *++YYCURSOR;",
          "911:  if (yych != '\"') goto yy18;",
          "912:  ++YYCURSOR;",
          "914:  {",
          "915:  size_t len, maxlen;",
          "916:  zend_string *str;",
          "",
          "[Removed Lines]",
          "913: #line 671 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "914: #line 672 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "938:  ZVAL_STR(rval, str);",
          "939:  return 1;",
          "940: }",
          "942: yy46:",
          "943:  yych = *++YYCURSOR;",
          "944:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "941: #line 942 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "942: #line 943 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "959:  yych = *++YYCURSOR;",
          "960:  if (yych != '\"') goto yy18;",
          "961:  ++YYCURSOR;",
          "963:  {",
          "964:  size_t len, maxlen;",
          "965:  char *str;",
          "",
          "[Removed Lines]",
          "962: #line 644 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "963: #line 645 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "986:  ZVAL_STRINGL(rval, str, len);",
          "987:  return 1;",
          "988: }",
          "990: yy53:",
          "991:  yych = *++YYCURSOR;",
          "992:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "989: #line 990 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "990: #line 991 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1074:  }",
          "1075: yy63:",
          "1076:  ++YYCURSOR;",
          "1078:  {",
          "1079: #if SIZEOF_ZEND_LONG == 4",
          "1080: use_double:",
          "",
          "[Removed Lines]",
          "1077: #line 635 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1078: #line 636 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1083:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1084:  return 1;",
          "1085: }",
          "1087: yy65:",
          "1088:  yych = *++YYCURSOR;",
          "1089:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1086: #line 1087 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1087: #line 1088 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1142:  yych = *++YYCURSOR;",
          "1143:  if (yych != ';') goto yy18;",
          "1144:  ++YYCURSOR;",
          "1146:  {",
          "",
          "[Removed Lines]",
          "1145: #line 619 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1146: #line 620 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "1159:  return 1;",
          "1160: }",
          "1162: yy76:",
          "1163:  yych = *++YYCURSOR;",
          "1164:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1161: #line 1162 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1162: #line 1163 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1185:  if (yych <= '9') goto yy79;",
          "1186:  if (yych != ';') goto yy18;",
          "1187:  ++YYCURSOR;",
          "1189:  {",
          "1190: #if SIZEOF_ZEND_LONG == 4",
          "1191:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1188: #line 593 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1189: #line 594 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1211:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1212:  return 1;",
          "1213: }",
          "1215: yy83:",
          "1216:  yych = *++YYCURSOR;",
          "1217:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1214: #line 1215 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1215: #line 1216 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "1219:  yych = *++YYCURSOR;",
          "1220:  if (yych != ';') goto yy18;",
          "1221:  ++YYCURSOR;",
          "1223:  {",
          "1225:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1226:  return 1;",
          "1227: }",
          "1229: yy87:",
          "1230:  ++YYCURSOR;",
          "1232:  {",
          "1234:  ZVAL_NULL(rval);",
          "1235:  return 1;",
          "1236: }",
          "1238: yy89:",
          "1239:  yych = *++YYCURSOR;",
          "1240:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1222: #line 587 \"ext/standard/var_unserializer.re\"",
          "1228: #line 1229 \"ext/standard/var_unserializer.c\"",
          "1231: #line 581 \"ext/standard/var_unserializer.re\"",
          "1237: #line 1238 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1223: #line 588 \"ext/standard/var_unserializer.re\"",
          "1229: #line 1230 \"ext/standard/var_unserializer.c\"",
          "1232: #line 582 \"ext/standard/var_unserializer.re\"",
          "1238: #line 1239 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "1257:  if (yych <= '9') goto yy91;",
          "1258:  if (yych != ';') goto yy18;",
          "1259:  ++YYCURSOR;",
          "1261:  {",
          "1262:  zend_long id;",
          "",
          "[Removed Lines]",
          "1260: #line 558 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1261: #line 559 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "1281:  return 1;",
          "1282: }",
          "1284: yy95:",
          "1285:  yych = *++YYCURSOR;",
          "1286:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1283: #line 1284 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1284: #line 1285 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "1303:  if (yych <= '9') goto yy97;",
          "1304:  if (yych != ';') goto yy18;",
          "1305:  ++YYCURSOR;",
          "1307:  {",
          "1308:  zend_long id;",
          "",
          "[Removed Lines]",
          "1306: #line 536 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1307: #line 537 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 25 ---",
          "[Context before]",
          "1326:  return 1;",
          "1327: }",
          "1329: }",
          "1333:  return 0;",
          "",
          "[Removed Lines]",
          "1328: #line 1329 \"ext/standard/var_unserializer.c\"",
          "1330: #line 881 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1329: #line 1330 \"ext/standard/var_unserializer.c\"",
          "1331: #line 882 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "474: {",
          "475:  zval retval;",
          "476:  zval fname;",
          "478:  if (Z_TYPE_P(rval) != IS_OBJECT) {",
          "479:   return 0;",
          "480:  }",
          "484:   return 0;",
          "485:  }",
          "",
          "[Removed Lines]",
          "483:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_OBJPROP_P(rval), elements, 1)) {",
          "",
          "[Added Lines]",
          "477:  HashTable *ht = Z_OBJPROP_P(rval);",
          "483:  zend_hash_resize(ht, zend_hash_num_elements(ht) + elements);",
          "484:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, ht, elements, 1)) {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "7e042224a26282938b866a49ca3d4af1b368c0cc",
      "candidate_info": {
        "commit_hash": "7e042224a26282938b866a49ca3d4af1b368c0cc",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/7e042224a26282938b866a49ca3d4af1b368c0cc",
        "files": [
          "NEWS",
          "ext/standard/tests/serialize/bug71940.phpt",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Fixed bug #71940 (Unserialize crushes on restore object reference)",
        "before_after_code_files": [
          "ext/standard/tests/serialize/bug71940.phpt||ext/standard/tests/serialize/bug71940.phpt",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/tests/serialize/bug71940.phpt||ext/standard/tests/serialize/bug71940.phpt": [
          "File: ext/standard/tests/serialize/bug71940.phpt -> ext/standard/tests/serialize/bug71940.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #71940 (Unserialize crushes on restore object reference)",
          "3: --FILE--",
          "4: <?php",
          "6: class Identity",
          "7: {",
          "8:     private $role;",
          "10:     public function __construct($role)",
          "11:     {",
          "12:         $this->role = $role;",
          "13:     }",
          "14: }",
          "16: class Entry implements \\Serializable",
          "17: {",
          "18:     private $identity;",
          "20:     public function __construct(Identity $identity)",
          "21:     {",
          "22:         $this->identity = $identity;",
          "23:     }",
          "25:     public function serialize()",
          "26:     {",
          "27:         return serialize(array($this->identity));",
          "28:     }",
          "30:     public function unserialize($serialized)",
          "31:     {",
          "32:         list($this->identity) = unserialize($serialized);",
          "33:     }",
          "34: }",
          "36: $identity = new Identity('test');",
          "37: $identityRef = &$identity;",
          "39: $entry1 = new Entry($identity);",
          "40: $entry2 = new Entry($identityRef);",
          "42: $serialized = serialize([$entry1, $entry2]);",
          "43: print_r(unserialize($serialized));",
          "45: ?>",
          "46: --EXPECTF--",
          "47: Array",
          "48: (",
          "49:     [0] => Entry Object",
          "50:         (",
          "51:             [identity:Entry:private] => Identity Object",
          "52:                 (",
          "53:                     [role:Identity:private] => test",
          "54:                 )",
          "56:         )",
          "58:     [1] => Entry Object",
          "59:         (",
          "60:             [identity:Entry:private] => Identity Object",
          "61:                 (",
          "62:                     [role:Identity:private] => test",
          "63:                 )",
          "65:         )",
          "67: )",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "574:  yych = *(YYMARKER = ++YYCURSOR);",
          "575:  if (yych == ':') goto yy95;",
          "576: yy3:",
          "578:  { return 0; }",
          "579: #line 580 \"ext/standard/var_unserializer.c\"",
          "580: yy4:",
          "",
          "[Removed Lines]",
          "577: #line 884 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "577: #line 886 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "619:  goto yy3;",
          "620: yy14:",
          "621:  ++YYCURSOR;",
          "623:  {",
          "625:  php_error_docref(NULL, E_NOTICE, \"Unexpected end of serialized data\");",
          "",
          "[Removed Lines]",
          "622: #line 878 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "622: #line 880 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "655:  yych = *++YYCURSOR;",
          "656:  if (yych != '\"') goto yy18;",
          "657:  ++YYCURSOR;",
          "659:  {",
          "660:  size_t len, len2, len3, maxlen;",
          "661:  zend_long elements;",
          "",
          "[Removed Lines]",
          "658: #line 733 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "658: #line 735 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "825:  yych = *++YYCURSOR;",
          "826:  if (yych != '\"') goto yy18;",
          "827:  ++YYCURSOR;",
          "829:  {",
          "830:     if (!var_hash) return 0;",
          "",
          "[Removed Lines]",
          "828: #line 726 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "828: #line 728 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "865:  }",
          "867:  array_init_size(rval, elements);",
          "870:  if (elements) {",
          "871:   zend_hash_real_init(Z_ARRVAL_P(rval), 0);",
          "872:  }",
          "874:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_ARRVAL_P(rval), elements, 0)) {",
          "875:   return 0;",
          "876:  }",
          "878:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "879: }",
          "881: yy39:",
          "882:  yych = *++YYCURSOR;",
          "883:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "880: #line 881 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "875:  var_push_dtor(var_hash, rval);",
          "882: #line 883 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "932:  ZVAL_STR(rval, str);",
          "933:  return 1;",
          "934: }",
          "936: yy46:",
          "937:  yych = *++YYCURSOR;",
          "938:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "935: #line 936 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "937: #line 938 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "985:  ZVAL_STRINGL(rval, str, len);",
          "986:  return 1;",
          "987: }",
          "989: yy53:",
          "990:  yych = *++YYCURSOR;",
          "991:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "988: #line 989 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "990: #line 991 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "1082:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1083:  return 1;",
          "1084: }",
          "1086: yy65:",
          "1087:  yych = *++YYCURSOR;",
          "1088:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1085: #line 1086 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1087: #line 1088 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "1158:  return 1;",
          "1159: }",
          "1161: yy76:",
          "1162:  yych = *++YYCURSOR;",
          "1163:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1160: #line 1161 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1162: #line 1163 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "1210:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1211:  return 1;",
          "1212: }",
          "1214: yy83:",
          "1215:  yych = *++YYCURSOR;",
          "1216:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1213: #line 1214 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1215: #line 1216 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "1224:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1225:  return 1;",
          "1226: }",
          "1228: yy87:",
          "1229:  ++YYCURSOR;",
          "1230: #line 573 \"ext/standard/var_unserializer.re\"",
          "",
          "[Removed Lines]",
          "1227: #line 1228 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1229: #line 1230 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "1233:  ZVAL_NULL(rval);",
          "1234:  return 1;",
          "1235: }",
          "1237: yy89:",
          "1238:  yych = *++YYCURSOR;",
          "1239:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1236: #line 1237 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1238: #line 1239 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "1282:  return 1;",
          "1283: }",
          "1285: yy95:",
          "1286:  yych = *++YYCURSOR;",
          "1287:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1284: #line 1285 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1286: #line 1287 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "1331:  return 1;",
          "1332: }",
          "1334: }",
          "1338:  return 0;",
          "",
          "[Removed Lines]",
          "1333: #line 1334 \"ext/standard/var_unserializer.c\"",
          "1335: #line 886 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1335: #line 1336 \"ext/standard/var_unserializer.c\"",
          "1337: #line 888 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "710:  }",
          "712:  array_init_size(rval, elements);",
          "715:  if (elements) {",
          "716:   zend_hash_real_init(Z_ARRVAL_P(rval), 0);",
          "717:  }",
          "719:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_ARRVAL_P(rval), elements, 0)) {",
          "720:   return 0;",
          "721:  }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "720:  var_push_dtor(var_hash, rval);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "62c448ab8b0f38489af4b9c02061506b65b00c91",
      "candidate_info": {
        "commit_hash": "62c448ab8b0f38489af4b9c02061506b65b00c91",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/62c448ab8b0f38489af4b9c02061506b65b00c91",
        "files": [
          "Zend/zend_hash.c",
          "Zend/zend_hash.h",
          "ext/standard/var.c",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Fixed serialize/unserialize problems",
        "before_after_code_files": [
          "Zend/zend_hash.c||Zend/zend_hash.c",
          "Zend/zend_hash.h||Zend/zend_hash.h",
          "ext/standard/var.c||ext/standard/var.c",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "Zend/zend_hash.c||Zend/zend_hash.c": [
          "File: Zend/zend_hash.c -> Zend/zend_hash.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "138:  HANDLE_UNBLOCK_INTERRUPTIONS();",
          "139: }",
          "141: ZEND_API void zend_hash_packed_to_hash(HashTable *ht)",
          "142: {",
          "143:  HANDLE_BLOCK_INTERRUPTIONS();",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "141: ZEND_API void zend_hash_real_init(HashTable *ht, int packed)",
          "142: {",
          "143:  IS_CONSISTENT(ht);",
          "145:  CHECK_INIT(ht, packed);",
          "146: }",
          "",
          "---------------"
        ],
        "Zend/zend_hash.h||Zend/zend_hash.h": [
          "File: Zend/zend_hash.h -> Zend/zend_hash.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "66: #define zend_hash_init(ht, nSize, pHashFunction, pDestructor, persistent)      _zend_hash_init((ht), (nSize), (pDestructor), (persistent) ZEND_FILE_LINE_CC)",
          "67: #define zend_hash_init_ex(ht, nSize, pHashFunction, pDestructor, persistent, bApplyProtection)  _zend_hash_init_ex((ht), (nSize), (pDestructor), (persistent), (bApplyProtection) ZEND_FILE_LINE_CC)",
          "70: ZEND_API void zend_hash_to_packed(HashTable *ht);",
          "",
          "[Removed Lines]",
          "69: ZEND_API  void zend_hash_packed_to_hash(HashTable *ht);",
          "",
          "[Added Lines]",
          "69: ZEND_API void zend_hash_real_init(HashTable *ht, int packed);",
          "70: ZEND_API void zend_hash_packed_to_hash(HashTable *ht);",
          "",
          "---------------"
        ],
        "ext/standard/var.c||ext/standard/var.c": [
          "File: ext/standard/var.c -> ext/standard/var.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "736:  ZVAL_UNDEF(&var_already);",
          "739:   php_add_var_hash(var_hash, Z_ISREF_P(struc)? Z_REFVAL_P(struc) : struc, &var_already TSRMLS_CC) == FAILURE) {",
          "740:   if (Z_ISREF_P(struc)) {",
          "741:    smart_str_appendl(buf, \"R:\", 2);",
          "",
          "[Removed Lines]",
          "738:  if (var_hash &&",
          "",
          "[Added Lines]",
          "738:  if (var_hash &&",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "896:      if ((data = zend_hash_get_current_data_ex(myht, &pos)) == NULL",
          "898:       || (Z_TYPE_P(data) == IS_ARRAY && Z_ARRVAL_P(data)->nApplyCount > 1)",
          "899:      ) {",
          "900:       smart_str_appendl(buf, \"N;\", 2);",
          "",
          "[Removed Lines]",
          "897:       || Z_ARR_P(data) == Z_ARR_P(struc)",
          "",
          "[Added Lines]",
          "896:       || (Z_TYPE_P(data) == IS_ARRAY && Z_TYPE_P(struc) == IS_ARRAY && Z_ARR_P(data) == Z_ARR_P(struc))",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "29: #define VAR_ENTRIES_DBG 0",
          "31: typedef struct {",
          "33:  long used_slots;",
          "34:  void *next;",
          "35: } var_entries;",
          "38: {",
          "39:  var_entries *var_hash = (*var_hashx)->last;",
          "40: #if VAR_ENTRIES_DBG",
          "",
          "[Removed Lines]",
          "32:  zval data[VAR_ENTRIES_MAX];",
          "37: static inline zval *var_push(php_unserialize_data_t *var_hashx, zval *rval)",
          "",
          "[Added Lines]",
          "32:  zval *data[VAR_ENTRIES_MAX];",
          "37: static inline void var_push(php_unserialize_data_t *var_hashx, zval *rval)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "55:   (*var_hashx)->last = var_hash;",
          "56:  }",
          "60: }",
          "62: PHPAPI void var_push_dtor(php_unserialize_data_t *var_hashx, zval *rval)",
          "",
          "[Removed Lines]",
          "58:  ZVAL_COPY_VALUE(&var_hash->data[var_hash->used_slots], rval);",
          "59:  return &var_hash->data[var_hash->used_slots++];",
          "",
          "[Added Lines]",
          "58:  var_hash->data[var_hash->used_slots++] = rval;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "80:   (*var_hashx)->last_dtor = var_hash;",
          "81:  }",
          "85: }",
          "87: PHPAPI void var_push_dtor_no_addref(php_unserialize_data_t *var_hashx, zval *rval)",
          "",
          "[Removed Lines]",
          "83:  ZVAL_COPY(&var_hash->data[var_hash->used_slots], rval);",
          "84:  var_hash->used_slots++;",
          "",
          "[Added Lines]",
          "82:  Z_ADDREF_P(rval);",
          "83:  var_hash->data[var_hash->used_slots++] = rval;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "105:   (*var_hashx)->last_dtor = var_hash;",
          "106:  }",
          "110: }",
          "112: static int var_access(php_unserialize_data_t *var_hashx, long id, zval **store)",
          "",
          "[Removed Lines]",
          "108:  ZVAL_COPY_VALUE(&var_hash->data[var_hash->used_slots], rval);",
          "109:  var_hash->used_slots++;",
          "",
          "[Added Lines]",
          "107:  var_hash->data[var_hash->used_slots++] = rval;",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "150:  while (var_hash) {",
          "151:   for (i = 0; i < var_hash->used_slots; i++) {",
          "153:   }",
          "154:   next = var_hash->next;",
          "155:   efree(var_hash);",
          "",
          "[Removed Lines]",
          "152:    zval_ptr_dtor(&var_hash->data[i]);",
          "",
          "[Added Lines]",
          "150:    zval_ptr_dtor(var_hash->data[i]);",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "209: #define YYMARKER marker",
          "",
          "[Removed Lines]",
          "212: #line 217 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "210: #line 215 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "277:  while (elements-- > 0) {",
          "278:   zval key, *data, d, *old_data;",
          "281:    return 0;",
          "282:   }",
          "",
          "[Removed Lines]",
          "280:   if (!php_var_unserialize_intern(&key, p, max, NULL TSRMLS_CC)) {",
          "",
          "[Added Lines]",
          "278:   if (!php_var_unserialize(&key, p, max, NULL TSRMLS_CC)) {",
          "279:    zval_dtor(&key);",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "286:    return 0;",
          "287:   }",
          "301:   if (!objprops) {",
          "302:    switch (Z_TYPE(key)) {",
          "",
          "[Removed Lines]",
          "289:   if (var_hash && (*p)[0] != 'R') {",
          "290:    data = var_push(var_hash, data);",
          "291:   } else {",
          "292:    data = &d;",
          "293:   }",
          "295:   ZVAL_UNDEF(data);",
          "296:   if (!php_var_unserialize_intern(data, p, max, var_hash TSRMLS_CC)) {",
          "297:    zval_dtor(&key);",
          "298:    return 0;",
          "299:   }",
          "",
          "[Added Lines]",
          "288:   data = NULL;",
          "289:   ZVAL_UNDEF(&d);",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "304:     if ((old_data = zend_hash_index_find(ht, Z_LVAL(key))) != NULL) {",
          "305:      var_push_dtor(var_hash, old_data);",
          "306:     }",
          "308:     break;",
          "309:    case IS_STRING:",
          "310:     if ((old_data = zend_symtable_find(ht, Z_STR(key))) != NULL) {",
          "311:      var_push_dtor(var_hash, old_data);",
          "312:     }",
          "314:     break;",
          "315:    }",
          "316:   } else {",
          "318:    convert_to_string(&key);",
          "320:   }",
          "322:   zval_dtor(&key);",
          "324:   if (elements && *(*p-1) != ';' && *(*p-1) != '}') {",
          "325:    (*p)--;",
          "326:    return 0;",
          "",
          "[Removed Lines]",
          "307:     zend_hash_index_update(ht, Z_LVAL(key), data);",
          "313:     zend_symtable_update(ht, Z_STR(key), data);",
          "319:    zend_hash_update(ht, Z_STR(key), data);",
          "",
          "[Added Lines]",
          "297:     data = zend_hash_index_update(ht, Z_LVAL(key), &d);",
          "303:     data = zend_symtable_update(ht, Z_STR(key), &d);",
          "309:    data = zend_hash_update(ht, Z_STR(key), &d);",
          "314:   if (!php_var_unserialize(data, p, max, var_hash TSRMLS_CC)) {",
          "315:    return 0;",
          "316:   }",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "390:   return 0;",
          "391:  }",
          "393:  if (Z_OBJCE_P(rval) != PHP_IC_ENTRY &&",
          "394:   zend_hash_str_exists(&Z_OBJCE_P(rval)->function_table, \"__wakeup\", sizeof(\"__wakeup\")-1)) {",
          "396:   ZVAL_STRINGL(&fname, \"__wakeup\", sizeof(\"__wakeup\") - 1);",
          "397:   BG(serialize_lock)++;",
          "398:   call_user_function_ex(CG(function_table), rval, &fname, &retval, 0, 0, 1, NULL TSRMLS_CC);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "387:  if (Z_ISREF_P(rval)) {",
          "388:   rval = Z_REFVAL_P(rval);",
          "389:  }",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "413: #endif",
          "415: PHPAPI int php_var_unserialize(UNSERIALIZE_PARAMETER)",
          "425: {",
          "426:  const unsigned char *cursor, *limit, *marker, *start;",
          "427:  zval *rval_ref;",
          "",
          "[Removed Lines]",
          "416: {",
          "417:  if (var_hash && (*p)[0] != 'R') {",
          "418:   var_push(var_hash, rval);",
          "419:  }",
          "421:  return php_var_unserialize_intern(UNSERIALIZE_PASSTHRU);",
          "422: }",
          "424: PHPAPI int php_var_unserialize_intern(UNSERIALIZE_PARAMETER)",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "433:   return 0;",
          "434:  }",
          "436:  start = cursor;",
          "440: {",
          "441:  YYCTYPE yych;",
          "442:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "439: #line 440 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "424:  if (var_hash && (*p)[0] != 'R') {",
          "425:   var_push(var_hash, rval);",
          "426:  }",
          "431: #line 432 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "496:  yych = *(YYMARKER = ++YYCURSOR);",
          "497:  if (yych == ':') goto yy95;",
          "498: yy3:",
          "500:  { return 0; }",
          "502: yy4:",
          "503:  yych = *(YYMARKER = ++YYCURSOR);",
          "504:  if (yych == ':') goto yy89;",
          "",
          "[Removed Lines]",
          "499: #line 777 \"ext/standard/var_unserializer.re\"",
          "501: #line 502 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "491: #line 778 \"ext/standard/var_unserializer.re\"",
          "493: #line 494 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "541:  goto yy3;",
          "542: yy14:",
          "543:  ++YYCURSOR;",
          "545:  {",
          "547:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
          "549: }",
          "551: yy16:",
          "552:  yych = *++YYCURSOR;",
          "553:  goto yy3;",
          "",
          "[Removed Lines]",
          "544: #line 771 \"ext/standard/var_unserializer.re\"",
          "550: #line 551 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "536: #line 772 \"ext/standard/var_unserializer.re\"",
          "542: #line 543 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "577:  yych = *++YYCURSOR;",
          "578:  if (yych != '\"') goto yy18;",
          "579:  ++YYCURSOR;",
          "581:  {",
          "582:  size_t len, len2, len3, maxlen;",
          "583:  long elements;",
          "",
          "[Removed Lines]",
          "580: #line 632 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "572: #line 633 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "717:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "718: }",
          "720: yy25:",
          "721:  yych = *++YYCURSOR;",
          "722:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "719: #line 720 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "711: #line 712 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "741:  yych = *++YYCURSOR;",
          "742:  if (yych != '\"') goto yy18;",
          "743:  ++YYCURSOR;",
          "745:  {",
          "",
          "[Removed Lines]",
          "744: #line 624 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "736: #line 625 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "749:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "750:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "751: }",
          "753: yy32:",
          "754:  yych = *++YYCURSOR;",
          "755:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "752: #line 753 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "744: #line 745 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "770:  yych = *++YYCURSOR;",
          "771:  if (yych != '{') goto yy18;",
          "772:  ++YYCURSOR;",
          "774:  {",
          "775:  long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "773: #line 606 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "765: #line 604 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "781:  }",
          "783:  array_init_size(rval, elements);",
          "785:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_ARRVAL_P(rval), elements, 0)) {",
          "786:   return 0;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "778:  zend_hash_real_init(Z_ARRVAL_P(rval), 0);",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "789:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "790: }",
          "792: yy39:",
          "793:  yych = *++YYCURSOR;",
          "794:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "791: #line 792 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "786: #line 787 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "809:  yych = *++YYCURSOR;",
          "810:  if (yych != '\"') goto yy18;",
          "811:  ++YYCURSOR;",
          "813:  {",
          "814:  size_t len, maxlen;",
          "815:  char *str;",
          "817:  len = parse_uiv(start + 2);",
          "",
          "[Removed Lines]",
          "812: #line 577 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "807: #line 574 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "834:  YYCURSOR += 2;",
          "838:  ZVAL_STRINGL(rval, str, len);",
          "839:  return 1;",
          "840: }",
          "842: yy46:",
          "843:  yych = *++YYCURSOR;",
          "844:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "841: #line 842 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "834:  efree(str);",
          "837: #line 838 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "859:  yych = *++YYCURSOR;",
          "860:  if (yych != '\"') goto yy18;",
          "861:  ++YYCURSOR;",
          "863:  {",
          "864:  size_t len, maxlen;",
          "865:  char *str;",
          "",
          "[Removed Lines]",
          "862: #line 550 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "858: #line 547 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 25 ---",
          "[Context before]",
          "886:  ZVAL_STRINGL(rval, str, len);",
          "887:  return 1;",
          "888: }",
          "890: yy53:",
          "891:  yych = *++YYCURSOR;",
          "892:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "889: #line 890 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "885: #line 886 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 26 ---",
          "[Context before]",
          "974:  }",
          "975: yy63:",
          "976:  ++YYCURSOR;",
          "978:  {",
          "979: #if SIZEOF_LONG == 4",
          "980: use_double:",
          "",
          "[Removed Lines]",
          "977: #line 541 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "973: #line 538 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 27 ---",
          "[Context before]",
          "983:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "984:  return 1;",
          "985: }",
          "987: yy65:",
          "988:  yych = *++YYCURSOR;",
          "989:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "986: #line 987 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "982: #line 983 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 28 ---",
          "[Context before]",
          "1042:  yych = *++YYCURSOR;",
          "1043:  if (yych != ';') goto yy18;",
          "1044:  ++YYCURSOR;",
          "1046:  {",
          "",
          "[Removed Lines]",
          "1045: #line 525 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1041: #line 522 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 29 ---",
          "[Context before]",
          "1059:  return 1;",
          "1060: }",
          "1062: yy76:",
          "1063:  yych = *++YYCURSOR;",
          "1064:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1061: #line 1062 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1057: #line 1058 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 30 ---",
          "[Context before]",
          "1085:  if (yych <= '9') goto yy79;",
          "1086:  if (yych != ';') goto yy18;",
          "1087:  ++YYCURSOR;",
          "1089:  {",
          "1090: #if SIZEOF_LONG == 4",
          "1091:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1088: #line 499 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1084: #line 496 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 31 ---",
          "[Context before]",
          "1111:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1112:  return 1;",
          "1113: }",
          "1115: yy83:",
          "1116:  yych = *++YYCURSOR;",
          "1117:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1114: #line 1115 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1110: #line 1111 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 32 ---",
          "[Context before]",
          "1119:  yych = *++YYCURSOR;",
          "1120:  if (yych != ';') goto yy18;",
          "1121:  ++YYCURSOR;",
          "1123:  {",
          "1125:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1126:  return 1;",
          "1127: }",
          "1129: yy87:",
          "1130:  ++YYCURSOR;",
          "1132:  {",
          "1134:  ZVAL_NULL(rval);",
          "1135:  return 1;",
          "1136: }",
          "1138: yy89:",
          "1139:  yych = *++YYCURSOR;",
          "1140:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1122: #line 493 \"ext/standard/var_unserializer.re\"",
          "1128: #line 1129 \"ext/standard/var_unserializer.c\"",
          "1131: #line 487 \"ext/standard/var_unserializer.re\"",
          "1137: #line 1138 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1118: #line 490 \"ext/standard/var_unserializer.re\"",
          "1124: #line 1125 \"ext/standard/var_unserializer.c\"",
          "1127: #line 484 \"ext/standard/var_unserializer.re\"",
          "1133: #line 1134 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 33 ---",
          "[Context before]",
          "1157:  if (yych <= '9') goto yy91;",
          "1158:  if (yych != ';') goto yy18;",
          "1159:  ++YYCURSOR;",
          "1161:  {",
          "1162:  long id;",
          "",
          "[Removed Lines]",
          "1160: #line 464 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1156: #line 461 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 34 ---",
          "[Context before]",
          "1170:  }",
          "1175:  if (!ZVAL_IS_UNDEF(rval)) {",
          "1176:   var_push_dtor_no_addref(var_hash, rval);",
          "",
          "[Removed Lines]",
          "1173:  if (rval == rval_ref) return 0;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 35 ---",
          "[Context before]",
          "1181:  return 1;",
          "1182: }",
          "1184: yy95:",
          "1185:  yych = *++YYCURSOR;",
          "1186:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1183: #line 1184 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1179: #line 1180 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 36 ---",
          "[Context before]",
          "1203:  if (yych <= '9') goto yy97;",
          "1204:  if (yych != ';') goto yy18;",
          "1205:  ++YYCURSOR;",
          "1207:  {",
          "1208:  long id;",
          "",
          "[Removed Lines]",
          "1206: #line 444 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1202: #line 436 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 37 ---",
          "[Context before]",
          "1218:  if (!ZVAL_IS_UNDEF(rval)) {",
          "1219:   zval_ptr_dtor(rval);",
          "1220:  }",
          "1224:  return 1;",
          "1225: }",
          "1227: }",
          "1231:  return 0;",
          "",
          "[Removed Lines]",
          "1221:  ZVAL_COPY(rval, rval_ref);",
          "1226: #line 1227 \"ext/standard/var_unserializer.c\"",
          "1228: #line 779 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1217:  if (Z_ISREF_P(rval_ref)) {",
          "1218:   ZVAL_COPY(rval, rval_ref);",
          "1219:  } else {",
          "1220:   ZVAL_NEW_REF(rval_ref, rval_ref);",
          "1221:   ZVAL_COPY(rval, rval_ref);",
          "1222:  }",
          "1227: #line 1228 \"ext/standard/var_unserializer.c\"",
          "1229: #line 780 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "27: #define VAR_ENTRIES_DBG 0",
          "29: typedef struct {",
          "31:  long used_slots;",
          "32:  void *next;",
          "33: } var_entries;",
          "36: {",
          "37:  var_entries *var_hash = (*var_hashx)->last;",
          "38: #if VAR_ENTRIES_DBG",
          "",
          "[Removed Lines]",
          "30:  zval data[VAR_ENTRIES_MAX];",
          "35: static inline zval *var_push(php_unserialize_data_t *var_hashx, zval *rval)",
          "",
          "[Added Lines]",
          "30:  zval *data[VAR_ENTRIES_MAX];",
          "35: static inline void var_push(php_unserialize_data_t *var_hashx, zval *rval)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "53:   (*var_hashx)->last = var_hash;",
          "54:  }",
          "58: }",
          "60: PHPAPI void var_push_dtor(php_unserialize_data_t *var_hashx, zval *rval)",
          "",
          "[Removed Lines]",
          "56:  ZVAL_COPY_VALUE(&var_hash->data[var_hash->used_slots], rval);",
          "57:  return &var_hash->data[var_hash->used_slots++];",
          "",
          "[Added Lines]",
          "56:  var_hash->data[var_hash->used_slots++] = rval;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "78:   (*var_hashx)->last_dtor = var_hash;",
          "79:  }",
          "83: }",
          "85: PHPAPI void var_push_dtor_no_addref(php_unserialize_data_t *var_hashx, zval *rval)",
          "",
          "[Removed Lines]",
          "81:  ZVAL_COPY(&var_hash->data[var_hash->used_slots], rval);",
          "82:  var_hash->used_slots++;",
          "",
          "[Added Lines]",
          "80:  Z_ADDREF_P(rval);",
          "81:  var_hash->data[var_hash->used_slots++] = rval;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "103:   (*var_hashx)->last_dtor = var_hash;",
          "104:  }",
          "108: }",
          "110: static int var_access(php_unserialize_data_t *var_hashx, long id, zval **store)",
          "",
          "[Removed Lines]",
          "106:  ZVAL_COPY_VALUE(&var_hash->data[var_hash->used_slots], rval);",
          "107:  var_hash->used_slots++;",
          "",
          "[Added Lines]",
          "105:  var_hash->data[var_hash->used_slots++] = rval;",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "148:  while (var_hash) {",
          "149:   for (i = 0; i < var_hash->used_slots; i++) {",
          "151:   }",
          "152:   next = var_hash->next;",
          "153:   efree(var_hash);",
          "",
          "[Removed Lines]",
          "150:    zval_ptr_dtor(&var_hash->data[i]);",
          "",
          "[Added Lines]",
          "148:    zval_ptr_dtor(var_hash->data[i]);",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "281:  while (elements-- > 0) {",
          "282:   zval key, *data, d, *old_data;",
          "285:    return 0;",
          "286:   }",
          "",
          "[Removed Lines]",
          "284:   if (!php_var_unserialize_intern(&key, p, max, NULL TSRMLS_CC)) {",
          "",
          "[Added Lines]",
          "282:   if (!php_var_unserialize(&key, p, max, NULL TSRMLS_CC)) {",
          "283:    zval_dtor(&key);",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "290:    return 0;",
          "291:   }",
          "305:   if (!objprops) {",
          "306:    switch (Z_TYPE(key)) {",
          "",
          "[Removed Lines]",
          "293:   if (var_hash && (*p)[0] != 'R') {",
          "294:    data = var_push(var_hash, data);",
          "295:   } else {",
          "296:    data = &d;",
          "297:   }",
          "299:   ZVAL_UNDEF(data);",
          "300:   if (!php_var_unserialize_intern(data, p, max, var_hash TSRMLS_CC)) {",
          "301:    zval_dtor(&key);",
          "302:    return 0;",
          "303:   }",
          "",
          "[Added Lines]",
          "292:   data = NULL;",
          "293:   ZVAL_UNDEF(&d);",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "308:     if ((old_data = zend_hash_index_find(ht, Z_LVAL(key))) != NULL) {",
          "309:      var_push_dtor(var_hash, old_data);",
          "310:     }",
          "312:     break;",
          "313:    case IS_STRING:",
          "314:     if ((old_data = zend_symtable_find(ht, Z_STR(key))) != NULL) {",
          "315:      var_push_dtor(var_hash, old_data);",
          "316:     }",
          "318:     break;",
          "319:    }",
          "320:   } else {",
          "322:    convert_to_string(&key);",
          "324:   }",
          "326:   zval_dtor(&key);",
          "328:   if (elements && *(*p-1) != ';' && *(*p-1) != '}') {",
          "329:    (*p)--;",
          "330:    return 0;",
          "",
          "[Removed Lines]",
          "311:     zend_hash_index_update(ht, Z_LVAL(key), data);",
          "317:     zend_symtable_update(ht, Z_STR(key), data);",
          "323:    zend_hash_update(ht, Z_STR(key), data);",
          "",
          "[Added Lines]",
          "301:     data = zend_hash_index_update(ht, Z_LVAL(key), &d);",
          "307:     data = zend_symtable_update(ht, Z_STR(key), &d);",
          "313:    data = zend_hash_update(ht, Z_STR(key), &d);",
          "318:   if (!php_var_unserialize(data, p, max, var_hash TSRMLS_CC)) {",
          "319:    return 0;",
          "320:   }",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "394:   return 0;",
          "395:  }",
          "397:  if (Z_OBJCE_P(rval) != PHP_IC_ENTRY &&",
          "398:   zend_hash_str_exists(&Z_OBJCE_P(rval)->function_table, \"__wakeup\", sizeof(\"__wakeup\")-1)) {",
          "400:   ZVAL_STRINGL(&fname, \"__wakeup\", sizeof(\"__wakeup\") - 1);",
          "401:   BG(serialize_lock)++;",
          "402:   call_user_function_ex(CG(function_table), rval, &fname, &retval, 0, 0, 1, NULL TSRMLS_CC);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "391:  if (Z_ISREF_P(rval)) {",
          "392:   rval = Z_REFVAL_P(rval);",
          "393:  }",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "417: #endif",
          "419: PHPAPI int php_var_unserialize(UNSERIALIZE_PARAMETER)",
          "429: {",
          "430:  const unsigned char *cursor, *limit, *marker, *start;",
          "431:  zval *rval_ref;",
          "",
          "[Removed Lines]",
          "420: {",
          "421:  if (var_hash && (*p)[0] != 'R') {",
          "422:   var_push(var_hash, rval);",
          "423:  }",
          "425:  return php_var_unserialize_intern(UNSERIALIZE_PASSTHRU);",
          "426: }",
          "428: PHPAPI int php_var_unserialize_intern(UNSERIALIZE_PARAMETER)",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "437:   return 0;",
          "438:  }",
          "440:  start = cursor;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "428:  if (var_hash && (*p)[0] != 'R') {",
          "429:   var_push(var_hash, rval);",
          "430:  }",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "455:  if (!ZVAL_IS_UNDEF(rval)) {",
          "456:   zval_ptr_dtor(rval);",
          "457:  }",
          "461:  return 1;",
          "",
          "[Removed Lines]",
          "458:  ZVAL_COPY(rval, rval_ref);",
          "",
          "[Added Lines]",
          "450:  if (Z_ISREF_P(rval_ref)) {",
          "451:   ZVAL_COPY(rval, rval_ref);",
          "452:  } else {",
          "453:   ZVAL_NEW_REF(rval_ref, rval_ref);",
          "454:   ZVAL_COPY(rval, rval_ref);",
          "455:  }",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "473:  }",
          "478:  if (!ZVAL_IS_UNDEF(rval)) {",
          "479:   var_push_dtor_no_addref(var_hash, rval);",
          "",
          "[Removed Lines]",
          "476:  if (rval == rval_ref) return 0;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "598:  YYCURSOR += 2;",
          "602:  ZVAL_STRINGL(rval, str, len);",
          "603:  return 1;",
          "604: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "600:  efree(str);",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "613:  }",
          "615:  array_init_size(rval, elements);",
          "617:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_ARRVAL_P(rval), elements, 0)) {",
          "618:   return 0;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "616:  zend_hash_real_init(Z_ARRVAL_P(rval), 0);",
          "",
          "---------------"
        ]
      }
    }
  ]
}