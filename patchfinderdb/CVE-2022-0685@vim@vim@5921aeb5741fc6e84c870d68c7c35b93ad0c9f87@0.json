{
  "cve_id": "CVE-2022-0685",
  "cve_desc": "Use of Out-of-range Pointer Offset in GitHub repository vim/vim prior to 8.2.4418.",
  "repo": "vim/vim",
  "patch_hash": "5921aeb5741fc6e84c870d68c7c35b93ad0c9f87",
  "patch_info": {
    "commit_hash": "5921aeb5741fc6e84c870d68c7c35b93ad0c9f87",
    "repo": "vim/vim",
    "commit_url": "https://github.com/vim/vim/commit/5921aeb5741fc6e84c870d68c7c35b93ad0c9f87",
    "files": [
      "src/charset.c",
      "src/filepath.c",
      "src/proto/charset.pro",
      "src/testdir/test_autochdir.vim",
      "src/version.c"
    ],
    "message": "patch 8.2.4418: crash when using special multi-byte character\n\nProblem:    Crash when using special multi-byte character.\nSolution:   Don't use isalpha() for an arbitrary character.",
    "before_after_code_files": [
      "src/charset.c||src/charset.c",
      "src/filepath.c||src/filepath.c",
      "src/proto/charset.pro||src/proto/charset.pro",
      "src/testdir/test_autochdir.vim||src/testdir/test_autochdir.vim",
      "src/version.c||src/version.c"
    ]
  },
  "patch_diff": {
    "src/charset.c||src/charset.c": [
      "File: src/charset.c -> src/charset.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1644:     return isupper(c);",
      "1645: }",
      "1647:     int",
      "1648: vim_toupper(int c)",
      "1649: {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1647:     int",
      "1648: vim_isalpha(int c)",
      "1649: {",
      "1650:     return vim_islower(c) || vim_isupper(c);",
      "1651: }",
      "",
      "---------------"
    ],
    "src/filepath.c||src/filepath.c": [
      "File: src/filepath.c -> src/filepath.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "3626:  else if (path_end >= path + wildoff",
      "3627:     && (vim_strchr((char_u *)\"*?[{~$\", *path_end) != NULL",
      "3628:         || (!p_fic && (flags & EW_ICASE)",
      "3630:      e = p;",
      "3631:  if (has_mbyte)",
      "3632:  {",
      "",
      "[Removed Lines]",
      "3629:           && isalpha(PTR2CHAR(path_end)))))",
      "",
      "[Added Lines]",
      "3629:        && vim_isalpha(PTR2CHAR(path_end)))))",
      "",
      "---------------"
    ],
    "src/proto/charset.pro||src/proto/charset.pro": [
      "File: src/proto/charset.pro -> src/proto/charset.pro",
      "--- Hunk 1 ---",
      "[Context before]",
      "50: int vim_isbdigit(int c);",
      "51: int vim_islower(int c);",
      "52: int vim_isupper(int c);",
      "53: int vim_toupper(int c);",
      "54: int vim_tolower(int c);",
      "55: char_u *skiptowhite(char_u *p);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "53: int vim_isalpha(int c);",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "63: int rem_backslash(char_u *str);",
      "64: void backslash_halve(char_u *p);",
      "65: char_u *backslash_halve_save(char_u *p);",
      "",
      "[Removed Lines]",
      "66: void ebcdic2ascii(char_u *buffer, int len);",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ],
    "src/testdir/test_autochdir.vim||src/testdir/test_autochdir.vim": [
      "File: src/testdir/test_autochdir.vim -> src/testdir/test_autochdir.vim",
      "--- Hunk 1 ---",
      "[Context before]",
      "110:   call delete('Xautodir', 'rf')",
      "111: endfunc",
      "113: \" vim: shiftwidth=2 sts=2 expandtab",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "113: func Test_multibyte()",
      "114:   \" using an invalid character should not cause a crash",
      "115:   set wic",
      "116:   call assert_fails('tc \ufffd\ufffd\ufffd\ufffd\ufffd*', 'E344:')",
      "117:   set nowic",
      "118: endfunc",
      "",
      "---------------"
    ],
    "src/version.c||src/version.c": [
      "File: src/version.c -> src/version.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "751: static int included_patches[] =",
      "754:     4417,",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "754:     4418,",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "adbb383e0f2bb59286ea8133f02c448fd334958f",
      "candidate_info": {
        "commit_hash": "adbb383e0f2bb59286ea8133f02c448fd334958f",
        "repo": "vim/vim",
        "commit_url": "https://github.com/vim/vim/commit/adbb383e0f2bb59286ea8133f02c448fd334958f",
        "files": [
          "src/testdir/test_autochdir.vim",
          "src/version.c"
        ],
        "message": "patch 8.2.4422: autochdir test fails on MS-Windows\n\nProblem:    Autochdir test fails on MS-Windows.\nSolution:   Expecta nother error on MS-Windows.",
        "before_after_code_files": [
          "src/testdir/test_autochdir.vim||src/testdir/test_autochdir.vim",
          "src/version.c||src/version.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/testdir/test_autochdir.vim||src/testdir/test_autochdir.vim",
            "src/version.c||src/version.c"
          ],
          "candidate": [
            "src/testdir/test_autochdir.vim||src/testdir/test_autochdir.vim",
            "src/version.c||src/version.c"
          ]
        }
      },
      "candidate_diff": {
        "src/testdir/test_autochdir.vim||src/testdir/test_autochdir.vim": [
          "File: src/testdir/test_autochdir.vim -> src/testdir/test_autochdir.vim",
          "--- Hunk 1 ---",
          "[Context before]",
          "113: func Test_multibyte()",
          "114:   \" using an invalid character should not cause a crash",
          "115:   set wic",
          "117:   set nowic",
          "118: endfunc",
          "",
          "[Removed Lines]",
          "116:   call assert_fails('tc \ufffd\ufffd\ufffd\ufffd\ufffd*', 'E344:')",
          "",
          "[Added Lines]",
          "116:   call assert_fails('tc \ufffd\ufffd\ufffd\ufffd\ufffd*', has('win32') ? 'E480:' : 'E344:')",
          "",
          "---------------"
        ],
        "src/version.c||src/version.c": [
          "File: src/version.c -> src/version.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "751: static int included_patches[] =",
          "754:     4421,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "754:     4422,",
          "",
          "---------------"
        ]
      }
    }
  ]
}