{
  "cve_id": "CVE-2017-13083",
  "cve_desc": "Akeo Consulting Rufus prior to version 2.17.1187 does not adequately validate the integrity of updates downloaded over HTTP, allowing an attacker to easily convince a user to execute arbitrary code",
  "repo": "pbatard/rufus",
  "patch_hash": "c3c39f7f8a11f612c4ebf7affce25ec6928eb1cb",
  "patch_info": {
    "commit_hash": "c3c39f7f8a11f612c4ebf7affce25ec6928eb1cb",
    "repo": "pbatard/rufus",
    "commit_url": "https://github.com/pbatard/rufus/commit/c3c39f7f8a11f612c4ebf7affce25ec6928eb1cb",
    "files": [
      "res/localization/rufus.loc",
      "src/pki.c",
      "src/rufus.rc",
      "src/stdlg.c"
    ],
    "message": "[pki] fix https://www.kb.cert.org/vuls/id/403768\n\n* This commit effectively fixes https://www.kb.cert.org/vuls/id/403768 (CVE-2017-13083) as\n  it is described per its revision 11, which is the latest revision at the time of this commit,\n  by disabling Windows prompts, enacted during signature validation, that allow the user to\n  bypass the intended signature verification checks.\n* It needs to be pointed out that the vulnerability (\"allow(ing) the use of a self-signed\n  certificate\"), which relies on the end-user actively ignoring a Windows prompt that tells\n  them that the update failed the signature validation whilst also advising against running it,\n  is being fully addressed, even as the update protocol remains HTTP.\n* It also need to be pointed out that the extended delay (48 hours) between the time the\n  vulnerability was reported and the moment it is fixed in our codebase has to do with\n  the fact that the reporter chose to deviate from standard security practices by not\n  disclosing the details of the vulnerability with us, be it publicly or privately,\n  before creating the cert.org report. The only advance notification we received was a\n  generic note about the use of HTTP vs HTTPS, which, as have established, is not\n  immediately relevant to addressing the reported vulnerability.\n* Closes #1009\n* Note: The other vulnerability scenario described towards the end of #1009, which\n  doesn't have to do with the \"lack of CA checking\", will be addressed separately.",
    "before_after_code_files": [
      "res/localization/rufus.loc||res/localization/rufus.loc",
      "src/pki.c||src/pki.c",
      "src/rufus.rc||src/rufus.rc",
      "src/stdlg.c||src/stdlg.c"
    ]
  },
  "patch_diff": {
    "res/localization/rufus.loc||res/localization/rufus.loc": [
      "File: res/localization/rufus.loc -> res/localization/rufus.loc",
      "--- Hunk 1 ---",
      "[Context before]",
      "487: # eg. \"Partitioning (MBR)...\"",
      "488: t MSG_238 \"Partitioning (%s)...\"",
      "489: t MSG_239 \"Deleting partitions...\"",
      "490: t MSG_241 \"Downloading: %0.1f%%\"",
      "491: t MSG_242 \"Failed to download file.\"",
      "492: t MSG_243 \"Checking for Rufus updates...\"",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "490: t MSG_240 \"The signature for the downloaded update can not be validated. This could mean that your \"",
      "491:  \"system is improperly configured for signature validation or indicate a malicious download.\\n\\n\"",
      "492:  \"The download will be deleted. Please check the log for more details.\"",
      "",
      "---------------"
    ],
    "src/pki.c||src/pki.c": [
      "File: src/pki.c -> src/pki.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "53:  static char error_string[64];",
      "54:  DWORD error_code = GetLastError();",
      "57:   return WindowsErrorString();",
      "59:  switch (error_code) {",
      "",
      "[Removed Lines]",
      "56:  if ((error_code >> 16) != 0x8009)",
      "",
      "[Added Lines]",
      "56:  if (((error_code >> 16) != 0x8009) && ((error_code >> 16) != 0x800B))",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "113:   return \"Cannot complete usage check.\";",
      "114:  case CRYPT_E_NO_TRUSTED_SIGNER:",
      "115:   return \"None of the signers of the cryptographic message or certificate trust list is trusted.\";",
      "116:  default:",
      "117:   static_sprintf(error_string, \"Unknown PKI error 0x%08lX\", error_code);",
      "118:   return error_string;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "116:  case CERT_E_UNTRUSTEDROOT:",
      "117:   return \"The root certificate is not trusted.\";",
      "118:  case TRUST_E_NOSIGNATURE:",
      "119:   return \"Not digitally signed.\";",
      "120:  case TRUST_E_EXPLICIT_DISTRUST:",
      "121:   return \"One of the certificates used was marked as untrusted by the user.\";",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "268:  }",
      "270:  trust_data.cbStruct = sizeof(trust_data);",
      "273:  trust_data.fdwRevocationChecks = WTD_REVOKE_WHOLECHAIN;",
      "",
      "[Removed Lines]",
      "271:  trust_data.dwUIChoice = WTD_UI_ALL;",
      "",
      "[Added Lines]",
      "283:  trust_data.dwUIChoice = WTD_UI_NONE;",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "279:  r = WinVerifyTrust(NULL, &guid_generic_verify, &trust_data);",
      "280:  safe_free(trust_file.pcwszFilePath);",
      "282:  return r;",
      "283: }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "293:  switch (r) {",
      "294:  case ERROR_SUCCESS:",
      "295:   break;",
      "296:  case TRUST_E_NOSIGNATURE:",
      "298:   uprintf(\"PKI: File does not appear to be signed: %s\", WinPKIErrorString());",
      "299:   MessageBoxExU(hDlg, lmprintf(MSG_284), lmprintf(MSG_283), MB_OK | MB_ICONERROR | MB_IS_RTL, selected_langid);",
      "300:   break;",
      "301:  default:",
      "302:   uprintf(\"PKI: Failed to validate signature: %s\", WinPKIErrorString());",
      "303:   MessageBoxExU(hDlg, lmprintf(MSG_240), lmprintf(MSG_283), MB_OK | MB_ICONERROR | MB_IS_RTL, selected_langid);",
      "304:   break;",
      "305:  }",
      "",
      "---------------"
    ],
    "src/rufus.rc||src/rufus.rc": [
      "File: src/rufus.rc -> src/rufus.rc",
      "--- Hunk 1 ---",
      "[Context before]",
      "33: IDD_DIALOG DIALOGEX 12, 12, 242, 376",
      "34: STYLE DS_SETFONT | DS_MODALFRAME | DS_CENTER | WS_MINIMIZEBOX | WS_POPUP | WS_CAPTION | WS_SYSMENU",
      "35: EXSTYLE WS_EX_ACCEPTFILES",
      "37: FONT 8, \"Segoe UI Symbol\", 400, 0, 0x0",
      "38: BEGIN",
      "39:     LTEXT           \"Device\",IDS_DEVICE_TXT,9,6,200,8",
      "",
      "[Removed Lines]",
      "36: CAPTION \"Rufus 2.17.1186\"",
      "",
      "[Added Lines]",
      "36: CAPTION \"Rufus 2.17.1187\"",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "368: VS_VERSION_INFO VERSIONINFO",
      "371:  FILEFLAGSMASK 0x3fL",
      "372: #ifdef _DEBUG",
      "373:  FILEFLAGS 0x1L",
      "",
      "[Removed Lines]",
      "369:  FILEVERSION 2,17,1186,0",
      "370:  PRODUCTVERSION 2,17,1186,0",
      "",
      "[Added Lines]",
      "369:  FILEVERSION 2,17,1187,0",
      "370:  PRODUCTVERSION 2,17,1187,0",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "384:         BEGIN",
      "385:             VALUE \"CompanyName\", \"Akeo Consulting (http://akeo.ie)\"",
      "386:             VALUE \"FileDescription\", \"Rufus\"",
      "388:             VALUE \"InternalName\", \"Rufus\"",
      "389:             VALUE \"LegalCopyright\", \"\ufffd 2011-2017 Pete Batard (GPL v3)\"",
      "390:             VALUE \"LegalTrademarks\", \"http://www.gnu.org/copyleft/gpl.html\"",
      "391:             VALUE \"OriginalFilename\", \"rufus.exe\"",
      "392:             VALUE \"ProductName\", \"Rufus\"",
      "394:         END",
      "395:     END",
      "396:     BLOCK \"VarFileInfo\"",
      "",
      "[Removed Lines]",
      "387:             VALUE \"FileVersion\", \"2.17.1186\"",
      "393:             VALUE \"ProductVersion\", \"2.17.1186\"",
      "",
      "[Added Lines]",
      "387:             VALUE \"FileVersion\", \"2.17.1187\"",
      "393:             VALUE \"ProductVersion\", \"2.17.1187\"",
      "",
      "---------------"
    ],
    "src/stdlg.c||src/stdlg.c": [
      "File: src/stdlg.c -> src/stdlg.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1674:    case 2:  // Launch newer version and close this one",
      "1675:     Sleep(1000); // Add a delay on account of antivirus scanners",
      "1678:      break;",
      "1680:     memset(&si, 0, sizeof(si));",
      "1681:     memset(&pi, 0, sizeof(pi));",
      "",
      "[Removed Lines]",
      "1677:     if (ValidateSignature(hDlg, filepath) != NO_ERROR)",
      "",
      "[Added Lines]",
      "1677:     if (ValidateSignature(hDlg, filepath) != NO_ERROR) {",
      "1679:      _unlinkU(filepath);",
      "1680:      EnableWindow(GetDlgItem(hDlg, IDC_DOWNLOAD), FALSE);",
      "1682:     }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "a528bb3d83491f58685740fbe0d79592bfdb23cc",
      "candidate_info": {
        "commit_hash": "a528bb3d83491f58685740fbe0d79592bfdb23cc",
        "repo": "pbatard/rufus",
        "commit_url": "https://github.com/pbatard/rufus/commit/a528bb3d83491f58685740fbe0d79592bfdb23cc",
        "files": [
          "README.md",
          "res/localization/rufus.loc",
          "src/format.c",
          "src/process.c",
          "src/resource.h",
          "src/rufus.c",
          "src/rufus.h",
          "src/rufus.rc",
          "src/stdlg.c"
        ],
        "message": "[ui] report process(es) that are preventing access on error\n\n* Also revert loc file changes that were introduced in f53b22a077e4bfa7c6eacf9f0dffdaaa7f5ba87b",
        "before_after_code_files": [
          "res/localization/rufus.loc||res/localization/rufus.loc",
          "src/format.c||src/format.c",
          "src/process.c||src/process.c",
          "src/resource.h||src/resource.h",
          "src/rufus.c||src/rufus.c",
          "src/rufus.h||src/rufus.h",
          "src/rufus.rc||src/rufus.rc",
          "src/stdlg.c||src/stdlg.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "res/localization/rufus.loc||res/localization/rufus.loc",
            "src/rufus.rc||src/rufus.rc",
            "src/stdlg.c||src/stdlg.c"
          ],
          "candidate": [
            "res/localization/rufus.loc||res/localization/rufus.loc",
            "src/rufus.rc||src/rufus.rc",
            "src/stdlg.c||src/stdlg.c"
          ]
        }
      },
      "candidate_diff": {
        "res/localization/rufus.loc||res/localization/rufus.loc": [
          "File: res/localization/rufus.loc -> res/localization/rufus.loc",
          "--- Hunk 1 ---",
          "[Context before]",
          "251: t MSG_065 \"Write error.\"",
          "252: t MSG_066 \"Installation failure\"",
          "253: t MSG_067 \"Could not open media. It may be in use by another process. \"",
          "255: t MSG_068 \"Error while partitioning drive.\"",
          "256: t MSG_069 \"Could not copy files to target drive.\"",
          "257: t MSG_070 \"Cancelled by user.\"",
          "",
          "[Removed Lines]",
          "254:  \"Please check the log for additional details.\"",
          "",
          "[Added Lines]",
          "254:  \"Please re-plug the media and try again.\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "5273: t MSG_065 \"Erreur d'\u00e9criture.\"",
          "5274: t MSG_066 \"L'installation a \u00e9chou\u00e9\"",
          "5275: t MSG_067 \"Impossible d'acc\u00e9der au m\u00e9dia. Il peut \u00eatre en cours d'utilisation par une autre application. \"",
          "5277: t MSG_068 \"Erreur de partitionnement.\"",
          "5278: t MSG_069 \"Impossible de copier les fichiers sur le p\u00e9riph\u00e9rique de destination.\"",
          "5279: t MSG_070 \"Op\u00e9ration annul\u00e9e par l'utilisateur.\"",
          "",
          "[Removed Lines]",
          "5276:  \"Veuillez consulter le log pour avoir des d\u00e9tails suppl\u00e9mentaires.\"",
          "",
          "[Added Lines]",
          "5276:  \"Essayer de d\u00e9connecter le m\u00e9dia et essayez \u00e0 nouveau.\"",
          "",
          "---------------"
        ],
        "src/format.c||src/format.c": [
          "File: src/format.c -> src/format.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1325:   (StrArrayAdd(&version_index, get_token_data_file_indexed(\"IMAGE INDEX\", xml_file, i + 1), FALSE) >= 0); i++);",
          "1327:  if (i > 1)",
          "1329:  if (i < 0) {",
          "1330:   wintogo_index = -2; // Cancelled by the user",
          "1331:  } else if (i == 0) {",
          "",
          "[Removed Lines]",
          "1328:   i = Selection(lmprintf(MSG_291), lmprintf(MSG_292), version_name.String, i);",
          "",
          "[Added Lines]",
          "1328:   i = SelectionDialog(lmprintf(MSG_291), lmprintf(MSG_292), version_name.String, i);",
          "",
          "---------------"
        ],
        "src/process.c||src/process.c": [
          "File: src/process.c -> src/process.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "57: PF_TYPE_DECL(NTAPI, NTSTATUS, NtClose, (HANDLE));",
          "59: static PVOID PhHeapHandle = NULL;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "60: extern StrArray BlockingProcess;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "399: BOOL SearchProcess(char* HandleName, BOOL bPartialMatch, BOOL bIgnoreSelf)",
          "400: {",
          "401:  const char *access_rights_str[8] = { \"n\", \"r\", \"w\", \"rw\", \"x\", \"rx\", \"wx\", \"rwx\" };",
          "402:  NTSTATUS status = STATUS_SUCCESS;",
          "403:  PSYSTEM_HANDLE_INFORMATION_EX handles = NULL;",
          "404:  POBJECT_NAME_INFORMATION buffer = NULL;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "403:  char tmp[MAX_PATH];",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "426:  PF_INIT_OR_SET_STATUS(RtlInitUnicodeString, NtDll);",
          "427: #endif",
          "429:  if (NT_SUCCESS(status))",
          "430:   status = PhCreateHeap();",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "431:  StrArrayClear(&BlockingProcess);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "483:    if (bFound) {",
          "485:     bFound = FALSE;",
          "486:     access_rights = 0;",
          "487:    }",
          "",
          "[Removed Lines]",
          "484:     uprintf(\"o '%s' (pid: %ld, access: %s)\", exe_path, pid[cur_pid], access_rights_str[access_rights & 0x7]);",
          "",
          "[Added Lines]",
          "488:     uprintf(\"\u25cf '%s' (pid: %ld, access: %s)\", exe_path, pid[cur_pid], access_rights_str[access_rights & 0x7]);",
          "489:     static_sprintf(tmp, \"\u25cf %s (pid %ld)\", exe_path, pid[cur_pid]);",
          "490:     StrArrayAdd(&BlockingProcess, tmp, TRUE);",
          "",
          "---------------"
        ],
        "src/resource.h||src/resource.h": [
          "File: src/resource.h -> src/resource.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "11: #define IDD_UPDATE_POLICY               107",
          "12: #define IDD_NEW_VERSION                 108",
          "13: #define IDD_CHECKSUM                    109",
          "14: #define IDI_ICON                        120",
          "15: #define IDI_UP                          121",
          "16: #define IDI_DOWN                        122",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "14: #define IDD_LIST                        110",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "148: #define IDC_SELECTION_CHOICE14          1090",
          "149: #define IDC_SELECTION_CHOICE15          1091",
          "150: #define IDC_SELECTION_CHOICEMAX         1092",
          "151: #define IDS_DEVICE_TXT                  2000",
          "152: #define IDS_PARTITION_TYPE_TXT          2001",
          "153: #define IDS_FILESYSTEM_TXT              2002",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "152: #define IDC_LIST_ICON                   1093",
          "153: #define IDC_LIST_TEXT                   1094",
          "154: #define IDC_LIST_LINE                   1095",
          "155: #define IDC_LIST_ITEM1                  1096",
          "156: #define IDC_LIST_ITEM2                  1097",
          "157: #define IDC_LIST_ITEM3                  1098",
          "158: #define IDC_LIST_ITEM4                  1099",
          "159: #define IDC_LIST_ITEM5                  1100",
          "160: #define IDC_LIST_ITEM6                  1101",
          "161: #define IDC_LIST_ITEM7                  1102",
          "162: #define IDC_LIST_ITEM8                  1103",
          "163: #define IDC_LIST_ITEM9                  1104",
          "164: #define IDC_LIST_ITEM10                 1105",
          "165: #define IDC_LIST_ITEM11                 1106",
          "166: #define IDC_LIST_ITEM12                 1107",
          "167: #define IDC_LIST_ITEM13                 1108",
          "168: #define IDC_LIST_ITEM14                 1109",
          "169: #define IDC_LIST_ITEM15                 1110",
          "170: #define IDC_LIST_ITEMMAX                1111",
          "171: #define IDC_SELECTION_CHOICEMAX         1092",
          "",
          "---------------"
        ],
        "src/rufus.c||src/rufus.c": [
          "File: src/rufus.c -> src/rufus.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "114: char embedded_sl_version_str[2][12] = { \"?.??\", \"?.??\" };",
          "115: char embedded_sl_version_ext[2][32];",
          "116: RUFUS_UPDATE update = { {0,0,0}, {0,0}, NULL, NULL};",
          "118: extern char* szStatusMessage;",
          "120: static HANDLE format_thid = NULL, dialog_handle = NULL;",
          "",
          "[Removed Lines]",
          "117: StrArray DriveID, DriveLabel;",
          "",
          "[Added Lines]",
          "117: StrArray DriveID, DriveLabel, BlockingProcess;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1803:  StrArrayCreate(&DriveID, MAX_DRIVES);",
          "1804:  StrArrayCreate(&DriveLabel, MAX_DRIVES);",
          "1806:  CheckDlgButton(hDlg, IDC_QUICKFORMAT, BST_CHECKED);",
          "1807:  CheckDlgButton(hDlg, IDC_BOOT, BST_CHECKED);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1805:  StrArrayCreate(&BlockingProcess, 16);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "2240:    PostQuitMessage(0);",
          "2241:    StrArrayDestroy(&DriveID);",
          "2242:    StrArrayDestroy(&DriveLabel);",
          "2243:    DestroyAllTooltips();",
          "2244:    DestroyWindow(hLogDlg);",
          "2245:    GetWindowRect(hDlg, &relaunch_rc);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2244:    StrArrayDestroy(&BlockingProcess);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "2455:     return (INT_PTR)TRUE;",
          "2456:    }",
          "2457:    FormatStatus = 0;",
          "2458:    format_op_in_progress = TRUE;",
          "2459:    no_confirmation_on_cancel = FALSE;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2460:    StrArrayClear(&BlockingProcess);",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "2493:       char* iso_image = lmprintf(MSG_036);",
          "2494:       char* dd_image = lmprintf(MSG_095);",
          "2495:       char* choices[2] = { lmprintf(MSG_276, iso_image), lmprintf(MSG_277, dd_image) };",
          "2497:        choices, 2);",
          "2498:       if (i < 0) { // Cancel",
          "2499:        format_op_in_progress = FALSE;",
          "",
          "[Removed Lines]",
          "2496:       i = Selection(lmprintf(MSG_274), lmprintf(MSG_275, iso_image, dd_image, iso_image, dd_image),",
          "",
          "[Added Lines]",
          "2499:       i = SelectionDialog(lmprintf(MSG_274), lmprintf(MSG_275, iso_image, dd_image, iso_image, dd_image),",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "2826:    SendMessage(hProgress, PBM_SETSTATE, (WPARAM)PBST_ERROR, 0);",
          "2827:    SetTaskbarProgressState(TASKBAR_ERROR);",
          "2828:    PrintInfo(0, MSG_212);",
          "2830:    MessageBeep(MB_ICONERROR);",
          "2831:    FlashTaskbar(dialog_handle);",
          "2832:   }",
          "2833:   FormatStatus = 0;",
          "2834:   format_op_in_progress = FALSE;",
          "",
          "[Removed Lines]",
          "2829:    Notification(MSG_ERROR, NULL, lmprintf(MSG_042), lmprintf(MSG_043, StrError(FormatStatus, FALSE)));",
          "",
          "[Added Lines]",
          "2834:    if (BlockingProcess.Index > 0)",
          "2835:     ListDialog(lmprintf(MSG_042), lmprintf(MSG_055), BlockingProcess.String, BlockingProcess.Index);",
          "2836:    else",
          "2837:     Notification(MSG_ERROR, NULL, lmprintf(MSG_042), lmprintf(MSG_043, StrError(FormatStatus, FALSE)));",
          "",
          "---------------"
        ],
        "src/rufus.h||src/rufus.h": [
          "File: src/rufus.h -> src/rufus.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "432: extern void DestroyTooltip(HWND hWnd);",
          "433: extern void DestroyAllTooltips(void);",
          "434: extern BOOL Notification(int type, const notification_info* more_info, char* title, char* format, ...);",
          "436: extern SIZE GetTextSize(HWND hCtrl);",
          "437: extern BOOL ExtractDOS(const char* path);",
          "438: extern BOOL ExtractISO(const char* src_iso, const char* dest_dir, BOOL scan);",
          "",
          "[Removed Lines]",
          "435: extern int Selection(char* title, char* message, char** choices, int size);",
          "",
          "[Added Lines]",
          "435: extern int SelectionDialog(char* title, char* message, char** choices, int size);",
          "436: extern void ListDialog(char* title, char* message, char** items, int size);",
          "",
          "---------------"
        ],
        "src/rufus.rc||src/rufus.rc": [
          "File: src/rufus.rc -> src/rufus.rc",
          "--- Hunk 1 ---",
          "[Context before]",
          "33: IDD_DIALOG DIALOGEX 12, 12, 242, 376",
          "34: STYLE DS_SETFONT | DS_MODALFRAME | DS_CENTER | WS_MINIMIZEBOX | WS_POPUP | WS_CAPTION | WS_SYSMENU",
          "35: EXSTYLE WS_EX_ACCEPTFILES",
          "37: FONT 8, \"Segoe UI Symbol\", 400, 0, 0x0",
          "38: BEGIN",
          "39:     LTEXT           \"Device\",IDS_DEVICE_TXT,9,6,200,8",
          "",
          "[Removed Lines]",
          "36: CAPTION \"Rufus 2.15.1124\"",
          "",
          "[Added Lines]",
          "36: CAPTION \"Rufus 2.15.1125\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "164:     CONTROL         \"Choice 16\",IDC_SELECTION_CHOICEMAX,\"Button\",BS_AUTORADIOBUTTON | NOT WS_VISIBLE,35,213,269,10,WS_EX_TRANSPARENT",
          "165: END",
          "167: IDD_UPDATE_POLICY DIALOGEX 0, 0, 287, 198",
          "168: STYLE DS_SETFONT | DS_MODALFRAME | WS_POPUP | WS_CAPTION | WS_SYSMENU",
          "169: CAPTION \"Update policy and settings\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "167: IDD_LIST DIALOGEX 0, 0, 312, 59",
          "168: STYLE DS_SETFONT | DS_NOFAILCREATE | DS_CENTER | WS_POPUP | WS_VISIBLE | WS_CAPTION | WS_THICKFRAME",
          "169: CAPTION \"Rufus\"",
          "170: FONT 8, \"Segoe UI Symbol\", 400, 0, 0x0",
          "171: BEGIN",
          "172:     LTEXT           \"\",IDC_LIST_LINE,0,0,312,32",
          "173:     LTEXT           \"\",IDC_STATIC,0,0,312,31",
          "174:     ICON            IDI_ICON,IDC_LIST_ICON,6,6,20,20,0,WS_EX_TRANSPARENT",
          "175:     LTEXT           \"Message\",IDC_LIST_TEXT,35,5,269,8",
          "176:     PUSHBUTTON      \"OK\",IDOK,254,39,50,14",
          "177:     LTEXT           \"List 1\",IDC_LIST_ITEM1,35,17,269,10,SS_PATHELLIPSIS",
          "178:     LTEXT           \"List 2\",IDC_LIST_ITEM2,35,28,269,10,NOT WS_VISIBLE|SS_PATHELLIPSIS",
          "179:     LTEXT           \"List 3\",IDC_LIST_ITEM3,35,39,269,10,NOT WS_VISIBLE|SS_PATHELLIPSIS",
          "180:     LTEXT           \"List 4\",IDC_LIST_ITEM4,35,50,269,10,NOT WS_VISIBLE|SS_PATHELLIPSIS",
          "181:     LTEXT           \"List 5\",IDC_LIST_ITEM5,35,61,269,10,NOT WS_VISIBLE|SS_PATHELLIPSIS",
          "182:     LTEXT           \"List 6\",IDC_LIST_ITEM6,35,72,269,10,NOT WS_VISIBLE|SS_PATHELLIPSIS",
          "183:     LTEXT           \"List 7\",IDC_LIST_ITEM7,35,73,269,10,NOT WS_VISIBLE|SS_PATHELLIPSIS",
          "184:     LTEXT           \"List 8\",IDC_LIST_ITEM8,35,84,269,10,NOT WS_VISIBLE|SS_PATHELLIPSIS",
          "185:     LTEXT           \"List 9\",IDC_LIST_ITEM9,35,95,269,10,NOT WS_VISIBLE|SS_PATHELLIPSIS",
          "186:     LTEXT           \"List 10\",IDC_LIST_ITEM10,35,106,269,10,NOT WS_VISIBLE|SS_PATHELLIPSIS",
          "187:     LTEXT           \"List 11\",IDC_LIST_ITEM11,35,117,269,10,NOT WS_VISIBLE|SS_PATHELLIPSIS",
          "188:     LTEXT           \"List 12\",IDC_LIST_ITEM12,35,128,269,10,NOT WS_VISIBLE|SS_PATHELLIPSIS",
          "189:     LTEXT           \"List 13\",IDC_LIST_ITEM13,35,139,269,10,NOT WS_VISIBLE|SS_PATHELLIPSIS",
          "190:     LTEXT           \"List 14\",IDC_LIST_ITEM14,35,150,269,10,NOT WS_VISIBLE|SS_PATHELLIPSIS",
          "191:     LTEXT           \"List 15\",IDC_LIST_ITEM15,35,161,269,10,NOT WS_VISIBLE|SS_PATHELLIPSIS",
          "192:     LTEXT           \"List 16\",IDC_LIST_ITEMMAX,35,172,269,10,NOT WS_VISIBLE|SS_PATHELLIPSIS",
          "193: END",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "210: BEGIN",
          "211:     \"resource.h\\0\"",
          "212: END",
          "215: BEGIN",
          "216:     \"#ifndef _USING_V110_SDK71_\\r\\n\"",
          "217:     \"#define _USING_V110_SDK71_\\r\\n\"",
          "",
          "[Removed Lines]",
          "209: 1 TEXTINCLUDE",
          "214: 2 TEXTINCLUDE",
          "",
          "[Added Lines]",
          "237: 1 TEXTINCLUDE",
          "242: 2 TEXTINCLUDE",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "223:     \"\\0\"",
          "224: END",
          "227: BEGIN",
          "228:     \"\\r\\n\"",
          "229:     \"#ifdef RUFUS_LOC\\r\\n\"",
          "",
          "[Removed Lines]",
          "226: 3 TEXTINCLUDE",
          "",
          "[Added Lines]",
          "254: 3 TEXTINCLUDE",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "317:     BEGIN",
          "318:     END",
          "320:     IDD_UPDATE_POLICY, DIALOG",
          "321:     BEGIN",
          "322:     END",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "348:     IDD_LIST, DIALOG",
          "349:     BEGIN",
          "350:     END",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "336: VS_VERSION_INFO VERSIONINFO",
          "339:  FILEFLAGSMASK 0x3fL",
          "340: #ifdef _DEBUG",
          "341:  FILEFLAGS 0x1L",
          "",
          "[Removed Lines]",
          "337:  FILEVERSION 2,15,1124,0",
          "338:  PRODUCTVERSION 2,15,1124,0",
          "",
          "[Added Lines]",
          "369:  FILEVERSION 2,15,1125,0",
          "370:  PRODUCTVERSION 2,15,1125,0",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "352:         BEGIN",
          "353:             VALUE \"CompanyName\", \"Akeo Consulting (http://akeo.ie)\"",
          "354:             VALUE \"FileDescription\", \"Rufus\"",
          "356:             VALUE \"InternalName\", \"Rufus\"",
          "357:             VALUE \"LegalCopyright\", \"\ufffd 2011-2017 Pete Batard (GPL v3)\"",
          "358:             VALUE \"LegalTrademarks\", \"http://www.gnu.org/copyleft/gpl.html\"",
          "359:             VALUE \"OriginalFilename\", \"rufus.exe\"",
          "360:             VALUE \"ProductName\", \"Rufus\"",
          "362:         END",
          "363:     END",
          "364:     BLOCK \"VarFileInfo\"",
          "",
          "[Removed Lines]",
          "355:             VALUE \"FileVersion\", \"2.15.1124\"",
          "361:             VALUE \"ProductVersion\", \"2.15.1124\"",
          "",
          "[Added Lines]",
          "387:             VALUE \"FileVersion\", \"2.15.1125\"",
          "393:             VALUE \"ProductVersion\", \"2.15.1125\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "413: IDR_FD_KB2_SYS          RCDATA                  \"../res/freedos/KEYBRD2.SYS\"",
          "414: IDR_FD_KB3_SYS          RCDATA                  \"../res/freedos/KEYBRD3.SYS\"",
          "415: IDR_FD_KB4_SYS          RCDATA                  \"../res/freedos/KEYBRD4.SYS\"",
          "434: IDR_XT_HOGGER           RCDATA                  \"../res/hogger/hogger.exe\"",
          "435: IDR_UEFI_NTFS           RCDATA                  \"../res/uefi/uefi-ntfs.img\"",
          "436: IDR_TOGO_SAN_POLICY_XML RCDATA                  \"../res/togo/san_policy.xml\"",
          "",
          "[Removed Lines]",
          "416: IDR_FD_EGA1_CPX         RCDATA                  \"../res/freedos/ega.cpx\"",
          "417: IDR_FD_EGA2_CPX         RCDATA                  \"../res/freedos/ega2.cpx\"",
          "418: IDR_FD_EGA3_CPX         RCDATA                  \"../res/freedos/ega3.cpx\"",
          "419: IDR_FD_EGA4_CPX         RCDATA                  \"../res/freedos/ega4.cpx\"",
          "420: IDR_FD_EGA5_CPX         RCDATA                  \"../res/freedos/ega5.cpx\"",
          "421: IDR_FD_EGA6_CPX         RCDATA                  \"../res/freedos/ega6.cpx\"",
          "422: IDR_FD_EGA7_CPX         RCDATA                  \"../res/freedos/ega7.cpx\"",
          "423: IDR_FD_EGA8_CPX         RCDATA                  \"../res/freedos/ega8.cpx\"",
          "424: IDR_FD_EGA9_CPX         RCDATA                  \"../res/freedos/ega9.cpx\"",
          "425: IDR_FD_EGA10_CPX        RCDATA                  \"../res/freedos/ega10.cpx\"",
          "426: IDR_FD_EGA11_CPX        RCDATA                  \"../res/freedos/ega11.cpx\"",
          "427: IDR_FD_EGA12_CPX        RCDATA                  \"../res/freedos/ega12.cpx\"",
          "428: IDR_FD_EGA13_CPX        RCDATA                  \"../res/freedos/ega13.cpx\"",
          "429: IDR_FD_EGA14_CPX        RCDATA                  \"../res/freedos/ega14.cpx\"",
          "430: IDR_FD_EGA15_CPX        RCDATA                  \"../res/freedos/ega15.cpx\"",
          "431: IDR_FD_EGA16_CPX        RCDATA                  \"../res/freedos/ega16.cpx\"",
          "432: IDR_FD_EGA17_CPX        RCDATA                  \"../res/freedos/ega17.cpx\"",
          "433: IDR_FD_EGA18_CPX        RCDATA                  \"../res/freedos/ega18.cpx\"",
          "",
          "[Added Lines]",
          "448: IDR_FD_EGA1_CPX         RCDATA                  \"../res/freedos/EGA.CPX\"",
          "449: IDR_FD_EGA2_CPX         RCDATA                  \"../res/freedos/EGA2.CPX\"",
          "450: IDR_FD_EGA3_CPX         RCDATA                  \"../res/freedos/EGA3.CPX\"",
          "451: IDR_FD_EGA4_CPX         RCDATA                  \"../res/freedos/EGA4.CPX\"",
          "452: IDR_FD_EGA5_CPX         RCDATA                  \"../res/freedos/EGA5.CPX\"",
          "453: IDR_FD_EGA6_CPX         RCDATA                  \"../res/freedos/EGA6.CPX\"",
          "454: IDR_FD_EGA7_CPX         RCDATA                  \"../res/freedos/EGA7.CPX\"",
          "455: IDR_FD_EGA8_CPX         RCDATA                  \"../res/freedos/EGA8.CPX\"",
          "456: IDR_FD_EGA9_CPX         RCDATA                  \"../res/freedos/EGA9.CPX\"",
          "457: IDR_FD_EGA10_CPX        RCDATA                  \"../res/freedos/EGA10.CPX\"",
          "458: IDR_FD_EGA11_CPX        RCDATA                  \"../res/freedos/EGA11.CPX\"",
          "459: IDR_FD_EGA12_CPX        RCDATA                  \"../res/freedos/EGA12.CPX\"",
          "460: IDR_FD_EGA13_CPX        RCDATA                  \"../res/freedos/EGA13.CPX\"",
          "461: IDR_FD_EGA14_CPX        RCDATA                  \"../res/freedos/EGA14.CPX\"",
          "462: IDR_FD_EGA15_CPX        RCDATA                  \"../res/freedos/EGA15.CPX\"",
          "463: IDR_FD_EGA16_CPX        RCDATA                  \"../res/freedos/EGA16.CPX\"",
          "464: IDR_FD_EGA17_CPX        RCDATA                  \"../res/freedos/EGA17.CPX\"",
          "465: IDR_FD_EGA18_CPX        RCDATA                  \"../res/freedos/EGA18.CPX\"",
          "",
          "---------------"
        ],
        "src/stdlg.c||src/stdlg.c": [
          "File: src/stdlg.c -> src/stdlg.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "52: static HICON hMessageIcon = (HICON)INVALID_HANDLE_VALUE;",
          "53: static char* szMessageText = NULL;",
          "54: static char* szMessageTitle = NULL;",
          "57: static HWND hBrowseEdit;",
          "58: extern HWND hUpdatesDlg;",
          "59: static WNDPROC pOrgBrowseWndproc;",
          "",
          "[Removed Lines]",
          "55: static char **szSelectionChoice;",
          "56: static int nSelectionChoices;",
          "",
          "[Added Lines]",
          "55: static char **szDialogItem;",
          "56: static int nDialogItems;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "866:  switch (message) {",
          "867:  case WM_INITDIALOG:",
          "870:    uprintf(\"Warning: Too many options requested for Selection (%d vs %d)\",",
          "873:   }",
          "",
          "[Removed Lines]",
          "869:   if (nSelectionChoices > (IDC_SELECTION_CHOICEMAX - IDC_SELECTION_CHOICE1 + 1)) {",
          "871:     nSelectionChoices, IDC_SELECTION_CHOICEMAX - IDC_SELECTION_CHOICE1);",
          "872:    nSelectionChoices = IDC_SELECTION_CHOICEMAX - IDC_SELECTION_CHOICE1;",
          "",
          "[Added Lines]",
          "869:   if (nDialogItems > (IDC_SELECTION_CHOICEMAX - IDC_SELECTION_CHOICE1 + 1)) {",
          "871:     nDialogItems, IDC_SELECTION_CHOICEMAX - IDC_SELECTION_CHOICE1);",
          "872:    nDialogItems = IDC_SELECTION_CHOICEMAX - IDC_SELECTION_CHOICE1;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "889:   SendMessage(hDlg, WM_SETFONT, (WPARAM)hDlgFont, MAKELPARAM(TRUE, 0));",
          "890:   SendMessage(GetDlgItem(hDlg, IDC_SELECTION_TEXT), WM_SETFONT, (WPARAM)hDlgFont, MAKELPARAM(TRUE, 0));",
          "892:    SendMessage(GetDlgItem(hDlg, IDC_SELECTION_CHOICE1 + i), WM_SETFONT, (WPARAM)hDlgFont, MAKELPARAM(TRUE, 0));",
          "893:   SendMessage(GetDlgItem(hDlg, IDYES), WM_SETFONT, (WPARAM)hDlgFont, MAKELPARAM(TRUE, 0));",
          "894:   SendMessage(GetDlgItem(hDlg, IDNO), WM_SETFONT, (WPARAM)hDlgFont, MAKELPARAM(TRUE, 0));",
          "",
          "[Removed Lines]",
          "891:   for (i = 0; i < nSelectionChoices; i++)",
          "",
          "[Added Lines]",
          "891:   for (i = 0; i < nDialogItems; i++)",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "903:   SetWindowTextU(hDlg, szMessageTitle);",
          "904:   SetWindowTextU(GetDlgItem(hDlg, IDCANCEL), lmprintf(MSG_007));",
          "905:   SetWindowTextU(GetDlgItem(hDlg, IDC_SELECTION_TEXT), szMessageText);",
          "908:    ShowWindow(GetDlgItem(hDlg, IDC_SELECTION_CHOICE1 + i), SW_SHOW);",
          "909:   }",
          "",
          "[Removed Lines]",
          "906:   for (i = 0; i < nSelectionChoices; i++) {",
          "907:    SetWindowTextU(GetDlgItem(hDlg, IDC_SELECTION_CHOICE1 + i), szSelectionChoice[i]);",
          "",
          "[Added Lines]",
          "906:   for (i = 0; i < nDialogItems; i++) {",
          "907:    SetWindowTextU(GetDlgItem(hDlg, IDC_SELECTION_CHOICE1 + i), szDialogItem[i]);",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "918:   if (hDC != NULL)",
          "919:    ReleaseDC(hCtrl, hDC);",
          "920:   ResizeMoveCtrl(hDlg, hCtrl, 0, 0, 0, dh, 1.0f);",
          "922:    ResizeMoveCtrl(hDlg, GetDlgItem(hDlg, IDC_SELECTION_CHOICE1 + i), 0, dh, 0, 0, 1.0f);",
          "927:   }",
          "928:   ResizeMoveCtrl(hDlg, hDlg, 0, 0, 0, dh, 1.0f);",
          "929:   ResizeMoveCtrl(hDlg, GetDlgItem(hDlg, -1), 0, 0, 0, dh, 1.0f); // IDC_STATIC = -1",
          "",
          "[Removed Lines]",
          "921:   for (i = 0; i < nSelectionChoices; i++)",
          "923:   if (nSelectionChoices > 2) {",
          "924:    GetWindowRect(GetDlgItem(hDlg, IDC_SELECTION_CHOICE1), &rect);",
          "925:    GetWindowRect(GetDlgItem(hDlg, IDC_SELECTION_CHOICE2), &rect2);",
          "926:    dh += (nSelectionChoices - 2) * (rect2.top - rect.top) + 5;",
          "",
          "[Added Lines]",
          "921:   for (i = 0; i < nDialogItems; i++)",
          "923:   if (nDialogItems > 2) {",
          "924:    GetWindowRect(GetDlgItem(hDlg, IDC_SELECTION_CHOICE2), &rect);",
          "925:    GetWindowRect(GetDlgItem(hDlg, IDC_SELECTION_CHOICE1 + nDialogItems - 1), &rect2);",
          "926:    dh += rect2.top - rect.top;",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "954:  case WM_COMMAND:",
          "955:   switch (LOWORD(wParam)) {",
          "956:   case IDOK:",
          "958:     (Button_GetCheck(GetDlgItem(hDlg, IDC_SELECTION_CHOICE1 + i)) != BST_CHECKED); i++);",
          "960:     r = i + 1;",
          "962:   case IDNO:",
          "",
          "[Removed Lines]",
          "957:    for (i = 0; (i < nSelectionChoices) &&",
          "959:    if (i < nSelectionChoices)",
          "",
          "[Added Lines]",
          "957:    for (i = 0; (i < nDialogItems) &&",
          "959:    if (i < nDialogItems)",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "970: }",
          "976: {",
          "977:  int ret;",
          "979:  dialog_showing++;",
          "980:  szMessageTitle = title;",
          "981:  szMessageText = message;",
          "984:  ret = (int)MyDialogBox(hMainInstance, IDD_SELECTION, hMainDialog, SelectionCallback);",
          "985:  dialog_showing--;",
          "987:  return ret;",
          "988: }",
          "990: static struct {",
          "991:  HWND hTip;  // Tooltip handle",
          "992:  HWND hCtrl;  // Handle of the control the tooltip belongs to",
          "",
          "[Removed Lines]",
          "975: int Selection(char* title, char* message, char** choices, int size)",
          "982:  szSelectionChoice = choices;",
          "983:  nSelectionChoices = size;",
          "",
          "[Added Lines]",
          "975: int SelectionDialog(char* title, char* message, char** choices, int size)",
          "982:  szDialogItem = choices;",
          "983:  nDialogItems = size;",
          "993: INT_PTR CALLBACK ListCallback(HWND hDlg, UINT message, WPARAM wParam, LPARAM lParam)",
          "994: {",
          "995:  LRESULT loc;",
          "996:  int i, dh, r  = -1;",
          "998:  static LRESULT disabled[9] = { HTLEFT, HTRIGHT, HTTOP, HTBOTTOM, HTSIZE,",
          "999:   HTTOPLEFT, HTTOPRIGHT, HTBOTTOMLEFT, HTBOTTOMRIGHT };",
          "1000:  static HBRUSH background_brush, separator_brush;",
          "1002:  NONCLIENTMETRICS ncm;",
          "1003:  RECT rect, rect2;",
          "1004:  HFONT hDlgFont;",
          "1005:  HWND hCtrl;",
          "1006:  HDC hDC;",
          "1008:  switch (message) {",
          "1009:  case WM_INITDIALOG:",
          "1011:   if (nDialogItems > (IDC_LIST_ITEMMAX - IDC_LIST_ITEM1 + 1)) {",
          "1012:    uprintf(\"Warning: Too many items requested for List (%d vs %d)\",",
          "1013:     nDialogItems, IDC_LIST_ITEMMAX - IDC_LIST_ITEM1);",
          "1014:    nDialogItems = IDC_LIST_ITEMMAX - IDC_LIST_ITEM1;",
          "1015:   }",
          "1018:   ncm.cbSize = sizeof(ncm);",
          "1021: #if defined(_MSC_VER) && (_MSC_VER >= 1500) && (_WIN32_WINNT >= _WIN32_WINNT_VISTA)",
          "1022:   if (nWindowsVersion >= WINDOWS_VISTA) {",
          "1025:    ncm.cbSize -= sizeof(ncm.iPaddedBorderWidth);",
          "1026:   }",
          "1027: #endif",
          "1028:   SystemParametersInfo(SPI_GETNONCLIENTMETRICS, ncm.cbSize, &ncm, 0);",
          "1029:   hDlgFont = CreateFontIndirect(&(ncm.lfMessageFont));",
          "1031:   SendMessage(hDlg, WM_SETFONT, (WPARAM)hDlgFont, MAKELPARAM(TRUE, 0));",
          "1032:   SendMessage(GetDlgItem(hDlg, IDC_LIST_TEXT), WM_SETFONT, (WPARAM)hDlgFont, MAKELPARAM(TRUE, 0));",
          "1033:   for (i = 0; i < nDialogItems; i++)",
          "1034:    SendMessage(GetDlgItem(hDlg, IDC_LIST_ITEM1 + i), WM_SETFONT, (WPARAM)hDlgFont, MAKELPARAM(TRUE, 0));",
          "1035:   SendMessage(GetDlgItem(hDlg, IDYES), WM_SETFONT, (WPARAM)hDlgFont, MAKELPARAM(TRUE, 0));",
          "1036:   SendMessage(GetDlgItem(hDlg, IDNO), WM_SETFONT, (WPARAM)hDlgFont, MAKELPARAM(TRUE, 0));",
          "1038:   apply_localization(IDD_LIST, hDlg);",
          "1039:   background_brush = CreateSolidBrush(GetSysColor(COLOR_WINDOW));",
          "1040:   separator_brush = CreateSolidBrush(GetSysColor(COLOR_3DLIGHT));",
          "1041:   SetTitleBarIcon(hDlg);",
          "1042:   CenterDialog(hDlg);",
          "1044:   Static_SetIcon(GetDlgItem(hDlg, IDC_LIST_ICON), LoadIcon(NULL, IDI_EXCLAMATION));",
          "1045:   SetWindowTextU(hDlg, szMessageTitle);",
          "1046:   SetWindowTextU(GetDlgItem(hDlg, IDCANCEL), lmprintf(MSG_007));",
          "1047:   SetWindowTextU(GetDlgItem(hDlg, IDC_LIST_TEXT), szMessageText);",
          "1048:   for (i = 0; i < nDialogItems; i++) {",
          "1049:    SetWindowTextU(GetDlgItem(hDlg, IDC_LIST_ITEM1 + i), szDialogItem[i]);",
          "1050:    ShowWindow(GetDlgItem(hDlg, IDC_LIST_ITEM1 + i), SW_SHOW);",
          "1051:   }",
          "1053:   hCtrl = GetDlgItem(hDlg, IDC_LIST_TEXT);",
          "1054:   hDC = GetDC(hCtrl);",
          "1055:   SelectFont(hDC, hDlgFont); // Yes, you *MUST* reapply the font to the DC, even after SetWindowText!",
          "1056:   GetWindowRect(hCtrl, &rect);",
          "1057:   dh = rect.bottom - rect.top;",
          "1058:   DrawTextU(hDC, szMessageText, -1, &rect, DT_CALCRECT | DT_WORDBREAK);",
          "1059:   dh = rect.bottom - rect.top - dh;",
          "1060:   if (hDC != NULL)",
          "1061:    ReleaseDC(hCtrl, hDC);",
          "1062:   ResizeMoveCtrl(hDlg, hCtrl, 0, 0, 0, dh, 1.0f);",
          "1063:   for (i = 0; i < nDialogItems; i++)",
          "1064:    ResizeMoveCtrl(hDlg, GetDlgItem(hDlg, IDC_LIST_ITEM1 + i), 0, dh, 0, 0, 1.0f);",
          "1065:   if (nDialogItems > 1) {",
          "1066:    GetWindowRect(GetDlgItem(hDlg, IDC_LIST_ITEM1), &rect);",
          "1067:    GetWindowRect(GetDlgItem(hDlg, IDC_LIST_ITEM1 + nDialogItems - 1), &rect2);",
          "1068:    dh += rect2.top - rect.top;",
          "1069:   }",
          "1070:   ResizeMoveCtrl(hDlg, hDlg, 0, 0, 0, dh, 1.0f);",
          "1071:   ResizeMoveCtrl(hDlg, GetDlgItem(hDlg, -1), 0, 0, 0, dh, 1.0f); // IDC_STATIC = -1",
          "1072:   ResizeMoveCtrl(hDlg, GetDlgItem(hDlg, IDC_LIST_LINE), 0, dh, 0, 0, 1.0f);",
          "1073:   ResizeMoveCtrl(hDlg, GetDlgItem(hDlg, IDOK), 0, dh, 0, 0, 1.0f);",
          "1074:   ResizeMoveCtrl(hDlg, GetDlgItem(hDlg, IDCANCEL), 0, dh, 0, 0, 1.0f);",
          "1075:   return (INT_PTR)TRUE;",
          "1076:  case WM_CTLCOLORSTATIC:",
          "1078:   SetBkMode((HDC)wParam, TRANSPARENT);",
          "1079:   if ((HWND)lParam == GetDlgItem(hDlg, IDC_NOTIFICATION_LINE)) {",
          "1080:    return (INT_PTR)separator_brush;",
          "1081:   }",
          "1082:   return (INT_PTR)background_brush;",
          "1083:  case WM_NCHITTEST:",
          "1085:   loc = DefWindowProc(hDlg, message, wParam, lParam);",
          "1086:   for (i = 0; i < 9; i++) {",
          "1087:    if (loc == disabled[i]) {",
          "1088:     return (INT_PTR)TRUE;",
          "1089:    }",
          "1090:   }",
          "1091:   return (INT_PTR)FALSE;",
          "1092:  case WM_COMMAND:",
          "1093:   switch (LOWORD(wParam)) {",
          "1094:   case IDOK:",
          "1095:   case IDNO:",
          "1096:   case IDCANCEL:",
          "1097:    EndDialog(hDlg, r);",
          "1098:    return (INT_PTR)TRUE;",
          "1099:   }",
          "1100:   break;",
          "1101:  }",
          "1102:  return (INT_PTR)FALSE;",
          "1103: }",
          "1108: void ListDialog(char* title, char* message, char** items, int size)",
          "1109: {",
          "1110:  dialog_showing++;",
          "1111:  szMessageTitle = title;",
          "1112:  szMessageText = message;",
          "1113:  szDialogItem = items;",
          "1114:  nDialogItems = size;",
          "1115:  MyDialogBox(hMainInstance, IDD_LIST, hMainDialog, ListCallback);",
          "1116:  dialog_showing--;",
          "1117: }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "659f2fae342e315abfaf1d24185248a3006fc26f",
      "candidate_info": {
        "commit_hash": "659f2fae342e315abfaf1d24185248a3006fc26f",
        "repo": "pbatard/rufus",
        "commit_url": "https://github.com/pbatard/rufus/commit/659f2fae342e315abfaf1d24185248a3006fc26f",
        "files": [
          "res/localization/rufus.loc",
          "src/rufus.rc"
        ],
        "message": "[loc] update Simplified Chinese translation to latest\n\n* Also fix a typo\n* Closes #905",
        "before_after_code_files": [
          "res/localization/rufus.loc||res/localization/rufus.loc",
          "src/rufus.rc||src/rufus.rc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "res/localization/rufus.loc||res/localization/rufus.loc",
            "src/rufus.rc||src/rufus.rc"
          ],
          "candidate": [
            "res/localization/rufus.loc||res/localization/rufus.loc",
            "src/rufus.rc||src/rufus.rc"
          ]
        }
      },
      "candidate_diff": {
        "res/localization/rufus.loc||res/localization/rufus.loc": [
          "File: res/localization/rufus.loc -> res/localization/rufus.loc",
          "--- Hunk 1 ---",
          "[Context before]",
          "1975: ################################################################################",
          "1976: l \"zh-CN\" \"Chinese Simplified (\u7b80\u4f53\u4e2d\u6587)\" 0x0804, 0x1004",
          "1978: b \"en-US\"",
          "1980: # Main dialog",
          "",
          "[Removed Lines]",
          "1977: v 1.0.20",
          "",
          "[Added Lines]",
          "1977: v 1.0.21",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2223: t MSG_112 \"\u683c\u5f0f\u5316\u4e00\u4e2a\u5927 UDF \u5377\u53ef\u80fd\u9700\u8981\u5f88\u957f\u65f6\u95f4\u3002\u4ee5 USB 2.0 \u901f\u5ea6\u9884\u8ba1\u5269\u4f59\u65f6\u95f4\uff1a%d:%02d\uff0c\u5728\u6b64\u671f\u95f4\u8fdb\u5ea6\u6761\u53ef\u80fd\u4f1a\u5448\u7981\u6b62\u72b6\u6001\u3002\u8bf7\u8010\u5fc3\u7b49\u5f85\uff01\"",
          "2224: t MSG_113 \"\u5927\u5bb9\u91cf UDF \u5377\"",
          "2225: t MSG_114 \"\u8fd9\u4e2a\u955c\u50cf\u4f7f\u7528 Syslinux %s%s\uff0c\u800c\u672c\u7a0b\u5e8f\u4ec5\u5305\u542b Syslinux %s%s \u7684\u5b89\u88c5\u6587\u4ef6\u3002\\n\\n\"",
          "2227:  \"- \u9009\u62e9 '\u662f' \u8fde\u63a5\u7f51\u7edc\u5e76\u4e0b\u8f7d\u8fd9\u4e9b\u6587\u4ef6\\n\"",
          "2228:  \"- \u9009\u62e9 '\u5426' \u53d6\u6d88\u6b64\u9879\u64cd\u4f5c\\n\\n\"",
          "2229:  \"\u6ce8\u610f\uff1a\u6587\u4ef6\u5c06\u4f1a\u88ab\u4e0b\u8f7d\u5230\u5f53\u524d\u5e94\u7528\u7a0b\u5e8f\u76ee\u5f55\uff0c\u5982\u679c\u5b58\u5728\u5219\u4f1a\u81ea\u52a8\u9009\u7528\u3002\\n\"",
          "",
          "[Removed Lines]",
          "2226:  \"\u7531\u4e8e\u65b0\u7248\u672c\u7684 Syslinux \u548c\u5176\u5b83\u7248\u672c\u7684\u4e0d\u80fd\u517c\u5bb9\uff0c\u800c Rufus \u4e5f\u4e0d\u53ef\u80fd\u529e\u5b83\u4eec\u5168\u90e8\uff0c\u9700\u8981\u4ece\u4e92\u8054\u7f51\u4e0b\u8f7d\u4e24\u4e2a\u989d\u5916\u7684\u6587\u4ef6('ldlinux.sys' \u548c 'ldlinux.bss'):\\n\"",
          "",
          "[Added Lines]",
          "2226:  \"\u7531\u4e8e\u65b0\u7248\u672c\u7684 Syslinux \u548c\u5176\u5b83\u7248\u672c\u7684\u4e0d\u80fd\u517c\u5bb9\uff0c\u800c Rufus \u4e5f\u4e0d\u53ef\u80fd\u5305\u62ec\u5b83\u4eec\u5168\u90e8\uff0c\u9700\u8981\u4ece\u4e92\u8054\u7f51\u4e0b\u8f7d\u4e24\u4e2a\u989d\u5916\u7684\u6587\u4ef6('ldlinux.sys' \u548c 'ldlinux.bss'):\\n\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "2413: t MSG_285 \"\u5df2\u4e0b\u8f7d\u7684\u53ef\u6267\u884c\u6587\u4ef6\u662f\u7531 '%s' \u7b7e\u7f72\u7684\u3002\\n\u8fd9\u4e2a\u4e0d\u662f\u6211\u4eec\u80fd\u591f\u8bc6\u522b\u7684\u7b7e\u540d\uff0c\u800c\u4e14\u8fd9\u4e2a\u53ef\u80fd\u610f\u5473\u7740\u67d0\u79cd\u5f62\u5f0f\u7684\u6076\u610f\u6d3b\u52a8...\\n\u60a8\u662f\u5426\u786e\u8ba4\u60a8\u60f3\u8fd0\u884c\u8fd9\u4e2a\u6587\u4ef6?\"",
          "2414: t MSG_286 \"\u6b63\u5728\u6e05\u7a7a\u78c1\u76d8: %0.1f%% \u5df2\u5b8c\u6210\"",
          "2415: t MSG_287 \"\u68c0\u6d4b\u975eUSB\u7684\u53ef\u79fb\u9664\u8bbe\u5907\"",
          "2417: ################################################################################",
          "2418: l \"zh-TW\" \"Chinese Traditional (\u6b63\u9ad4\u4e2d\u6587)\" 0x0404, 0x0c04, 0x1404, 0x7c04",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2416: t MSG_288 \"\u7f3a\u5c11\u7ba1\u7406\u5458\u6743\u9650\"",
          "2417: t MSG_289 \"\u6b64\u7a0b\u5e8f\u53ea\u80fd\u4ee5\u7ba1\u7406\u5458\u6743\u9650\u6267\u884c\"",
          "2418: t MSG_290 \"\u6587\u4ef6\u7d22\u5f15\"",
          "2419: t MSG_291 \"\u7248\u672c\u9009\u62e9\"",
          "2420: t MSG_292 \"\u8bf7\u9009\u62e9\u4f60\u8981\u5b89\u88c5\u7684 Windows \u7248\u672c:\"",
          "2421: t MSG_293 \"\u4e0d\u652f\u6301\u7684 Windows \u7248\u672c\"",
          "2422: t MSG_294 \"Rufus \u5df2\u4e0d\u518d\u652f\u6301\u6b64 Windows \u7248\u672c\u3002\"",
          "",
          "---------------"
        ],
        "src/rufus.rc||src/rufus.rc": [
          "File: src/rufus.rc -> src/rufus.rc",
          "--- Hunk 1 ---",
          "[Context before]",
          "33: IDD_DIALOG DIALOGEX 12, 12, 242, 376",
          "34: STYLE DS_SETFONT | DS_MODALFRAME | DS_CENTER | WS_MINIMIZEBOX | WS_POPUP | WS_CAPTION | WS_SYSMENU",
          "35: EXSTYLE WS_EX_ACCEPTFILES",
          "37: FONT 8, \"Segoe UI Symbol\", 400, 0, 0x0",
          "38: BEGIN",
          "39:     LTEXT           \"Device\",IDS_DEVICE_TXT,9,6,200,8",
          "",
          "[Removed Lines]",
          "36: CAPTION \"Rufus 2.13.1064\"",
          "",
          "[Added Lines]",
          "36: CAPTION \"Rufus 2.13.1065\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "336: VS_VERSION_INFO VERSIONINFO",
          "339:  FILEFLAGSMASK 0x3fL",
          "340: #ifdef _DEBUG",
          "341:  FILEFLAGS 0x1L",
          "",
          "[Removed Lines]",
          "337:  FILEVERSION 2,13,1064,0",
          "338:  PRODUCTVERSION 2,13,1064,0",
          "",
          "[Added Lines]",
          "337:  FILEVERSION 2,13,1065,0",
          "338:  PRODUCTVERSION 2,13,1065,0",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "352:         BEGIN",
          "353:             VALUE \"CompanyName\", \"Akeo Consulting (http://akeo.ie)\"",
          "354:             VALUE \"FileDescription\", \"Rufus\"",
          "356:             VALUE \"InternalName\", \"Rufus\"",
          "357:             VALUE \"LegalCopyright\", \"\ufffd 2011-2017 Pete Batard (GPL v3)\"",
          "358:             VALUE \"LegalTrademarks\", \"http://www.gnu.org/copyleft/gpl.html\"",
          "359:             VALUE \"OriginalFilename\", \"rufus.exe\"",
          "360:             VALUE \"ProductName\", \"Rufus\"",
          "362:         END",
          "363:     END",
          "364:     BLOCK \"VarFileInfo\"",
          "",
          "[Removed Lines]",
          "355:             VALUE \"FileVersion\", \"2.13.1064\"",
          "361:             VALUE \"ProductVersion\", \"2.13.1064\"",
          "",
          "[Added Lines]",
          "355:             VALUE \"FileVersion\", \"2.13.1065\"",
          "361:             VALUE \"ProductVersion\", \"2.13.1065\"",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "7ef65b551ac47fa1ae3646f19d2c69d5ee0f4850",
      "candidate_info": {
        "commit_hash": "7ef65b551ac47fa1ae3646f19d2c69d5ee0f4850",
        "repo": "pbatard/rufus",
        "commit_url": "https://github.com/pbatard/rufus/commit/7ef65b551ac47fa1ae3646f19d2c69d5ee0f4850",
        "files": [
          "ChangeLog.txt",
          "src/net.c",
          "src/rufus.h",
          "src/rufus.rc",
          "src/stdlg.c"
        ],
        "message": "[misc] yay, more XP fixes...\n\n* Since I half expect 2.16 to be the last version of Rufus to support Windows XP",
        "before_after_code_files": [
          "src/net.c||src/net.c",
          "src/rufus.h||src/rufus.h",
          "src/rufus.rc||src/rufus.rc",
          "src/stdlg.c||src/stdlg.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/rufus.rc||src/rufus.rc",
            "src/stdlg.c||src/stdlg.c"
          ],
          "candidate": [
            "src/rufus.rc||src/rufus.rc",
            "src/stdlg.c||src/stdlg.c"
          ]
        }
      },
      "candidate_diff": {
        "src/net.c||src/net.c": [
          "File: src/net.c -> src/net.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "404: {",
          "405:  BOOL releases_only, found_new_version = FALSE;",
          "406:  int status = 0;",
          "408:  int i, j, k, max_channel, verbose = 0, verpos[4];",
          "409:  static const char* archname[] = {\"win_x86\", \"win_x64\"};",
          "410:  static const char* channel[] = {\"release\", \"beta\", \"test\"};  // release channel",
          "",
          "[Removed Lines]",
          "407:  const char* server_url = RUFUS_URL \"/\";",
          "",
          "[Added Lines]",
          "407:  const char* server_url = UPDATE_URL \"/\";",
          "",
          "---------------"
        ],
        "src/rufus.h||src/rufus.h": [
          "File: src/rufus.h -> src/rufus.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "73: #define DD_BUFFER_SIZE              65536  // Minimum size of the buffer we use for DD operations",
          "74: #define UBUFFER_SIZE                2048",
          "75: #define RUFUS_URL                   \"https://rufus.akeo.ie\"",
          "76: #define DOWNLOAD_URL                RUFUS_URL \"/downloads\"",
          "77: #define FILES_URL                   RUFUS_URL \"/files\"",
          "78: #define SEVENZIP_URL                \"http://www.7-zip.org\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "76: #define UPDATE_URL                  \"http://rufus.akeo.ie\" // Stupid XP can't handle a recent SSL implementation...",
          "",
          "---------------"
        ],
        "src/rufus.rc||src/rufus.rc": [
          "File: src/rufus.rc -> src/rufus.rc",
          "--- Hunk 1 ---",
          "[Context before]",
          "33: IDD_DIALOG DIALOGEX 12, 12, 242, 376",
          "34: STYLE DS_SETFONT | DS_MODALFRAME | DS_CENTER | WS_MINIMIZEBOX | WS_POPUP | WS_CAPTION | WS_SYSMENU",
          "35: EXSTYLE WS_EX_ACCEPTFILES",
          "37: FONT 8, \"Segoe UI Symbol\", 400, 0, 0x0",
          "38: BEGIN",
          "39:     LTEXT           \"Device\",IDS_DEVICE_TXT,9,6,200,8",
          "",
          "[Removed Lines]",
          "36: CAPTION \"Rufus 2.16.1155\"",
          "",
          "[Added Lines]",
          "36: CAPTION \"Rufus 2.16.1156\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "368: VS_VERSION_INFO VERSIONINFO",
          "371:  FILEFLAGSMASK 0x3fL",
          "372: #ifdef _DEBUG",
          "373:  FILEFLAGS 0x1L",
          "",
          "[Removed Lines]",
          "369:  FILEVERSION 2,16,1155,0",
          "370:  PRODUCTVERSION 2,16,1155,0",
          "",
          "[Added Lines]",
          "369:  FILEVERSION 2,16,1156,0",
          "370:  PRODUCTVERSION 2,16,1156,0",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "384:         BEGIN",
          "385:             VALUE \"CompanyName\", \"Akeo Consulting (http://akeo.ie)\"",
          "386:             VALUE \"FileDescription\", \"Rufus\"",
          "388:             VALUE \"InternalName\", \"Rufus\"",
          "389:             VALUE \"LegalCopyright\", \"\ufffd 2011-2017 Pete Batard (GPL v3)\"",
          "390:             VALUE \"LegalTrademarks\", \"http://www.gnu.org/copyleft/gpl.html\"",
          "391:             VALUE \"OriginalFilename\", \"rufus.exe\"",
          "392:             VALUE \"ProductName\", \"Rufus\"",
          "394:         END",
          "395:     END",
          "396:     BLOCK \"VarFileInfo\"",
          "",
          "[Removed Lines]",
          "387:             VALUE \"FileVersion\", \"2.16.1155\"",
          "393:             VALUE \"ProductVersion\", \"2.16.1155\"",
          "",
          "[Added Lines]",
          "387:             VALUE \"FileVersion\", \"2.16.1156\"",
          "393:             VALUE \"ProductVersion\", \"2.16.1156\"",
          "",
          "---------------"
        ],
        "src/stdlg.c||src/stdlg.c": [
          "File: src/stdlg.c -> src/stdlg.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "722:  switch (message) {",
          "723:  case WM_INITDIALOG:",
          "732:    ncm.cbSize -= sizeof(ncm.iPaddedBorderWidth);",
          "733:   }",
          "744:   apply_localization(IDD_NOTIFICATION, hDlg);",
          "745:   background_brush = CreateSolidBrush(GetSysColor(COLOR_WINDOW));",
          "",
          "[Removed Lines]",
          "725:   ncm.cbSize = sizeof(ncm);",
          "728:   #if defined(_MSC_VER) && (_MSC_VER >= 1500) && (_WIN32_WINNT >= _WIN32_WINNT_VISTA)",
          "729:   if (nWindowsVersion >= WINDOWS_VISTA) {",
          "734:   #endif",
          "735:   SystemParametersInfo(SPI_GETNONCLIENTMETRICS, ncm.cbSize, &ncm, 0);",
          "736:   hDlgFont = CreateFontIndirect(&(ncm.lfMessageFont));",
          "738:   SendMessage(hDlg, WM_SETFONT, (WPARAM)hDlgFont, MAKELPARAM(TRUE, 0));",
          "739:   SendMessage(GetDlgItem(hDlg, IDC_NOTIFICATION_TEXT), WM_SETFONT, (WPARAM)hDlgFont, MAKELPARAM(TRUE, 0));",
          "740:   SendMessage(GetDlgItem(hDlg, IDC_MORE_INFO), WM_SETFONT, (WPARAM)hDlgFont, MAKELPARAM(TRUE, 0));",
          "741:   SendMessage(GetDlgItem(hDlg, IDYES), WM_SETFONT, (WPARAM)hDlgFont, MAKELPARAM(TRUE, 0));",
          "742:   SendMessage(GetDlgItem(hDlg, IDNO), WM_SETFONT, (WPARAM)hDlgFont, MAKELPARAM(TRUE, 0));",
          "",
          "[Added Lines]",
          "724:   if (nWindowsVersion >= WINDOWS_VISTA) { // of course, this stuff doesn't work on XP!",
          "726:    ncm.cbSize = sizeof(ncm);",
          "729:    #if defined(_MSC_VER) && (_MSC_VER >= 1500) && (_WIN32_WINNT >= _WIN32_WINNT_VISTA)",
          "731:    #endif",
          "732:    SystemParametersInfo(SPI_GETNONCLIENTMETRICS, ncm.cbSize, &ncm, 0);",
          "733:    hDlgFont = CreateFontIndirect(&(ncm.lfMessageFont));",
          "735:    SendMessage(hDlg, WM_SETFONT, (WPARAM)hDlgFont, MAKELPARAM(TRUE, 0));",
          "736:    SendMessage(GetDlgItem(hDlg, IDC_NOTIFICATION_TEXT), WM_SETFONT, (WPARAM)hDlgFont, MAKELPARAM(TRUE, 0));",
          "737:    SendMessage(GetDlgItem(hDlg, IDC_MORE_INFO), WM_SETFONT, (WPARAM)hDlgFont, MAKELPARAM(TRUE, 0));",
          "738:    SendMessage(GetDlgItem(hDlg, IDYES), WM_SETFONT, (WPARAM)hDlgFont, MAKELPARAM(TRUE, 0));",
          "739:    SendMessage(GetDlgItem(hDlg, IDNO), WM_SETFONT, (WPARAM)hDlgFont, MAKELPARAM(TRUE, 0));",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "d7e977e1f16ae141f88da84dfb269c67495b66eb",
      "candidate_info": {
        "commit_hash": "d7e977e1f16ae141f88da84dfb269c67495b66eb",
        "repo": "pbatard/rufus",
        "commit_url": "https://github.com/pbatard/rufus/commit/d7e977e1f16ae141f88da84dfb269c67495b66eb",
        "files": [
          "src/format.c",
          "src/rufus.c",
          "src/rufus.rc"
        ],
        "message": "[core] enable FAT32 for Windows install when dual UEFI+BIOS is enabled",
        "before_after_code_files": [
          "src/format.c||src/format.c",
          "src/rufus.c||src/rufus.c",
          "src/rufus.rc||src/rufus.rc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/rufus.rc||src/rufus.rc"
          ],
          "candidate": [
            "src/rufus.rc||src/rufus.rc"
          ]
        }
      },
      "candidate_diff": {
        "src/format.c||src/format.c": [
          "File: src/format.c -> src/format.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1106:     if (!write_fat_32_ros_br(fp, 0)) break;",
          "1107:    } else if ((bt == BT_ISO) && HAS_KOLIBRIOS(img_report)) {",
          "1108:     if (!write_fat_32_kos_br(fp, 0)) break;",
          "1109:    } else {",
          "1110:     if (!write_fat_32_br(fp, 0)) break;",
          "1111:    }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1109:    } else if ((bt == BT_ISO) && HAS_BOOTMGR(img_report)) {",
          "1110:     if (!write_fat_32_pe_br(fp, 0)) break;",
          "1111:    } else if ((bt == BT_ISO) && HAS_WINPE(img_report)) {",
          "1112:     if (!write_fat_32_nt_br(fp, 0)) break;",
          "",
          "---------------"
        ],
        "src/rufus.c||src/rufus.c": [
          "File: src/rufus.c -> src/rufus.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1323:       (!HAS_SYSLINUX(img_report) || (SL_MAJOR(img_report.sl_version) <= 5)))",
          "1324:      || ((IS_FAT(fs)) && (!HAS_SYSLINUX(img_report)) && (!allow_dual_uefi_bios) && !IS_EFI_BOOTABLE(img_report) &&",
          "1325:       (!HAS_REACTOS(img_report)) && !HAS_KOLIBRIOS(img_report) && (!HAS_GRUB(img_report)))",
          "1328:    MessageBoxExU(hMainDialog, lmprintf(MSG_096), lmprintf(MSG_092), MB_OK|MB_ICONERROR|MB_IS_RTL, selected_langid);",
          "1329:    return FALSE;",
          "",
          "[Removed Lines]",
          "1326:      || ((IS_FAT(fs)) && (HAS_WINDOWS(img_report) || HAS_INSTALL_WIM(img_report))) ) {",
          "",
          "[Added Lines]",
          "1326:      || ((IS_FAT(fs)) && (HAS_WINDOWS(img_report) || HAS_INSTALL_WIM(img_report)) && (!allow_dual_uefi_bios)) ) {",
          "",
          "---------------"
        ],
        "src/rufus.rc||src/rufus.rc": [
          "File: src/rufus.rc -> src/rufus.rc",
          "--- Hunk 1 ---",
          "[Context before]",
          "33: IDD_DIALOG DIALOGEX 12, 12, 242, 376",
          "34: STYLE DS_SETFONT | DS_MODALFRAME | DS_CENTER | WS_MINIMIZEBOX | WS_POPUP | WS_CAPTION | WS_SYSMENU",
          "35: EXSTYLE WS_EX_ACCEPTFILES",
          "37: FONT 8, \"Segoe UI Symbol\", 400, 0, 0x0",
          "38: BEGIN",
          "39:     LTEXT           \"Device\",IDS_DEVICE_TXT,9,6,200,8",
          "",
          "[Removed Lines]",
          "36: CAPTION \"Rufus 2.12.1013\"",
          "",
          "[Added Lines]",
          "36: CAPTION \"Rufus 2.12.1014\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "336: VS_VERSION_INFO VERSIONINFO",
          "339:  FILEFLAGSMASK 0x3fL",
          "340: #ifdef _DEBUG",
          "341:  FILEFLAGS 0x1L",
          "",
          "[Removed Lines]",
          "337:  FILEVERSION 2,12,1013,0",
          "338:  PRODUCTVERSION 2,12,1013,0",
          "",
          "[Added Lines]",
          "337:  FILEVERSION 2,12,1014,0",
          "338:  PRODUCTVERSION 2,12,1014,0",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "352:         BEGIN",
          "353:             VALUE \"CompanyName\", \"Akeo Consulting (http://akeo.ie)\"",
          "354:             VALUE \"FileDescription\", \"Rufus\"",
          "356:             VALUE \"InternalName\", \"Rufus\"",
          "357:             VALUE \"LegalCopyright\", \"\ufffd 2011-2017 Pete Batard (GPL v3)\"",
          "358:             VALUE \"LegalTrademarks\", \"http://www.gnu.org/copyleft/gpl.html\"",
          "359:             VALUE \"OriginalFilename\", \"rufus.exe\"",
          "360:             VALUE \"ProductName\", \"Rufus\"",
          "362:         END",
          "363:     END",
          "364:     BLOCK \"VarFileInfo\"",
          "",
          "[Removed Lines]",
          "355:             VALUE \"FileVersion\", \"2.12.1013\"",
          "361:             VALUE \"ProductVersion\", \"2.12.1013\"",
          "",
          "[Added Lines]",
          "355:             VALUE \"FileVersion\", \"2.12.1014\"",
          "361:             VALUE \"ProductVersion\", \"2.12.1014\"",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "d4a4506b16eacee7f4c0bfeb50ecddd0b2a7d5be",
      "candidate_info": {
        "commit_hash": "d4a4506b16eacee7f4c0bfeb50ecddd0b2a7d5be",
        "repo": "pbatard/rufus",
        "commit_url": "https://github.com/pbatard/rufus/commit/d4a4506b16eacee7f4c0bfeb50ecddd0b2a7d5be",
        "files": [
          "src/iso.c",
          "src/rufus.rc"
        ],
        "message": "[iso] improve write performance during ISO extraction\n\n* Now preallocate the file size for each extracted file, to help the target\n  filesystem avoid fragmentation issues and thus increase writing speed.\n* Closes #1170",
        "before_after_code_files": [
          "src/iso.c||src/iso.c",
          "src/rufus.rc||src/rufus.rc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/rufus.rc||src/rufus.rc"
          ],
          "candidate": [
            "src/rufus.rc||src/rufus.rc"
          ]
        }
      },
      "candidate_diff": {
        "src/iso.c||src/iso.c": [
          "File: src/iso.c -> src/iso.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "361:  safe_closehandle(dir_handle);",
          "362: }",
          "365: static int udf_extract_files(udf_t *p_udf, udf_dirent_t *p_udf_dirent, const char *psz_path)",
          "366: {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "365: static void __inline preallocate_filesize(HANDLE hFile, int64_t file_length)",
          "366: {",
          "367:  SetFileInformationByHandle(hFile, FileEndOfFileInfo, &file_length, sizeof(file_length));",
          "370:  SetFileInformationByHandle(hFile, FileAllocationInfo, &file_length, sizeof(file_length));",
          "371: }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "440:      uprintf(stupid_antivirus);",
          "441:     else",
          "442:      goto out;",
          "456:     }",
          "460:    }",
          "461:    if ((preserve_timestamps) && (!SetFileTime(file_handle, to_filetime(udf_get_attribute_time(p_udf_dirent)),",
          "462:     to_filetime(udf_get_access_time(p_udf_dirent)), to_filetime(udf_get_modification_time(p_udf_dirent)))))",
          "",
          "[Removed Lines]",
          "443:    } else while (file_length > 0) {",
          "444:     if (FormatStatus) goto out;",
          "445:     memset(buf, 0, UDF_BLOCKSIZE);",
          "446:     read = udf_read_block(p_udf_dirent, buf, 1);",
          "447:     if (read < 0) {",
          "448:      uprintf(\"  Error reading UDF file %s\", &psz_fullpath[strlen(psz_extract_dir)]);",
          "449:      goto out;",
          "450:     }",
          "451:     buf_size = (DWORD)MIN(file_length, read);",
          "452:     ISO_BLOCKING(r = WriteFileWithRetry(file_handle, buf, buf_size, &wr_size, WRITE_RETRIES));",
          "453:     if (!r) {",
          "454:      uprintf(\"  Error writing file: %s\", WindowsErrorString());",
          "455:      goto out;",
          "457:     file_length -= read;",
          "458:     if (nb_blocks++ % PROGRESS_THRESHOLD == 0)",
          "459:      UpdateProgress(OP_DOS, 100.0f*nb_blocks/total_blocks);",
          "",
          "[Added Lines]",
          "452:    } else {",
          "453:     preallocate_filesize(file_handle, file_length);",
          "454:     while (file_length > 0) {",
          "455:      if (FormatStatus) goto out;",
          "456:      memset(buf, 0, UDF_BLOCKSIZE);",
          "457:      read = udf_read_block(p_udf_dirent, buf, 1);",
          "458:      if (read < 0) {",
          "459:       uprintf(\"  Error reading UDF file %s\", &psz_fullpath[strlen(psz_extract_dir)]);",
          "460:       goto out;",
          "461:      }",
          "462:      buf_size = (DWORD)MIN(file_length, read);",
          "463:      ISO_BLOCKING(r = WriteFileWithRetry(file_handle, buf, buf_size, &wr_size, WRITE_RETRIES));",
          "464:      if (!r) {",
          "465:       uprintf(\"  Error writing file: %s\", WindowsErrorString());",
          "466:       goto out;",
          "467:      }",
          "468:      file_length -= read;",
          "469:      if (nb_blocks++ % PROGRESS_THRESHOLD == 0)",
          "470:       UpdateProgress(OP_DOS, 100.0f*nb_blocks/total_blocks);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "586:      uprintf(stupid_antivirus);",
          "587:     else",
          "588:      goto out;",
          "599:      }",
          "609:     }",
          "610:    }",
          "611:    if (preserve_timestamps) {",
          "",
          "[Removed Lines]",
          "589:    } else for (j=0; j<p_statbuf->extents; j++) {",
          "590:     extent_length = p_statbuf->extsize[j];",
          "591:     for (i=0; extent_length>0; i++) {",
          "592:      if (FormatStatus) goto out;",
          "593:      memset(buf, 0, ISO_BLOCKSIZE);",
          "594:      lsn = p_statbuf->lsn[j] + (lsn_t)i;",
          "595:      if (iso9660_iso_seek_read(p_iso, buf, lsn, 1) != ISO_BLOCKSIZE) {",
          "596:       uprintf(\"  Error reading ISO9660 file %s at LSN %lu\",",
          "597:        psz_iso_name, (long unsigned int)lsn);",
          "598:       goto out;",
          "600:      buf_size = (DWORD)MIN(extent_length, ISO_BLOCKSIZE);",
          "601:      ISO_BLOCKING(r = WriteFileWithRetry(file_handle, buf, buf_size, &wr_size, WRITE_RETRIES));",
          "602:      if (!r) {",
          "603:       uprintf(\"  Error writing file: %s\", WindowsErrorString());",
          "604:       goto out;",
          "605:      }",
          "606:      extent_length -= ISO_BLOCKSIZE;",
          "607:      if (nb_blocks++ % PROGRESS_THRESHOLD == 0)",
          "608:       UpdateProgress(OP_DOS, 100.0f*nb_blocks/total_blocks);",
          "",
          "[Added Lines]",
          "601:    } else {",
          "602:     preallocate_filesize(file_handle, file_length);",
          "603:     for (j=0; j<p_statbuf->extents; j++) {",
          "604:      extent_length = p_statbuf->extsize[j];",
          "605:      for (i=0; extent_length>0; i++) {",
          "606:       if (FormatStatus) goto out;",
          "607:       memset(buf, 0, ISO_BLOCKSIZE);",
          "608:       lsn = p_statbuf->lsn[j] + (lsn_t)i;",
          "609:       if (iso9660_iso_seek_read(p_iso, buf, lsn, 1) != ISO_BLOCKSIZE) {",
          "610:        uprintf(\"  Error reading ISO9660 file %s at LSN %lu\",",
          "611:         psz_iso_name, (long unsigned int)lsn);",
          "612:        goto out;",
          "613:       }",
          "614:       buf_size = (DWORD)MIN(extent_length, ISO_BLOCKSIZE);",
          "615:       ISO_BLOCKING(r = WriteFileWithRetry(file_handle, buf, buf_size, &wr_size, WRITE_RETRIES));",
          "616:       if (!r) {",
          "617:        uprintf(\"  Error writing file: %s\", WindowsErrorString());",
          "618:        goto out;",
          "619:       }",
          "620:       extent_length -= ISO_BLOCKSIZE;",
          "621:       if (nb_blocks++ % PROGRESS_THRESHOLD == 0)",
          "622:        UpdateProgress(OP_DOS, 100.0f*nb_blocks/total_blocks);",
          "",
          "---------------"
        ],
        "src/rufus.rc||src/rufus.rc": [
          "File: src/rufus.rc -> src/rufus.rc",
          "--- Hunk 1 ---",
          "[Context before]",
          "33: IDD_DIALOG DIALOGEX 12, 12, 232, 326",
          "34: STYLE DS_SETFONT | DS_MODALFRAME | DS_CENTER | WS_MINIMIZEBOX | WS_POPUP | WS_CAPTION | WS_SYSMENU",
          "35: EXSTYLE WS_EX_ACCEPTFILES",
          "37: FONT 9, \"Segoe UI Symbol\", 400, 0, 0x0",
          "38: BEGIN",
          "39:     LTEXT           \"Drive Properties\",IDS_DRIVE_PROPERTIES_TXT,8,6,53,12,NOT WS_GROUP",
          "",
          "[Removed Lines]",
          "36: CAPTION \"Rufus 3.1.1322\"",
          "",
          "[Added Lines]",
          "36: CAPTION \"Rufus 3.1.1323\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "391: VS_VERSION_INFO VERSIONINFO",
          "394:  FILEFLAGSMASK 0x3fL",
          "395: #ifdef _DEBUG",
          "396:  FILEFLAGS 0x1L",
          "",
          "[Removed Lines]",
          "392:  FILEVERSION 3,1,1322,0",
          "393:  PRODUCTVERSION 3,1,1322,0",
          "",
          "[Added Lines]",
          "392:  FILEVERSION 3,1,1323,0",
          "393:  PRODUCTVERSION 3,1,1323,0",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "407:         BEGIN",
          "408:             VALUE \"CompanyName\", \"Akeo Consulting (http://akeo.ie)\"",
          "409:             VALUE \"FileDescription\", \"Rufus\"",
          "411:             VALUE \"InternalName\", \"Rufus\"",
          "412:             VALUE \"LegalCopyright\", \"\ufffd 2011-2018 Pete Batard (GPL v3)\"",
          "413:             VALUE \"LegalTrademarks\", \"http://www.gnu.org/copyleft/gpl.html\"",
          "414:             VALUE \"OriginalFilename\", \"rufus.exe\"",
          "415:             VALUE \"ProductName\", \"Rufus\"",
          "417:         END",
          "418:     END",
          "419:     BLOCK \"VarFileInfo\"",
          "",
          "[Removed Lines]",
          "410:             VALUE \"FileVersion\", \"3.1.1322\"",
          "416:             VALUE \"ProductVersion\", \"3.1.1322\"",
          "",
          "[Added Lines]",
          "410:             VALUE \"FileVersion\", \"3.1.1323\"",
          "416:             VALUE \"ProductVersion\", \"3.1.1323\"",
          "",
          "---------------"
        ]
      }
    }
  ]
}