{
  "cve_id": "CVE-2021-27135",
  "cve_desc": "xterm before Patch #366 allows remote attackers to execute arbitrary code or cause a denial of service (segmentation fault) via a crafted UTF-8 combining character sequence.",
  "repo": "ThomasDickey/xterm-snapshots",
  "patch_hash": "82ba55b8f994ab30ff561a347b82ea340ba7075c",
  "patch_info": {
    "commit_hash": "82ba55b8f994ab30ff561a347b82ea340ba7075c",
    "repo": "ThomasDickey/xterm-snapshots",
    "commit_url": "https://github.com/ThomasDickey/xterm-snapshots/commit/82ba55b8f994ab30ff561a347b82ea340ba7075c",
    "files": [
      "MANIFEST",
      "button.c",
      "xterm.log.html"
    ],
    "message": "snapshot of project \"xterm\", label xterm-365d",
    "before_after_code_files": [
      "button.c||button.c",
      "xterm.log.html||xterm.log.html"
    ]
  },
  "patch_diff": {
    "button.c||button.c": [
      "File: button.c -> button.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "4323:     int i;",
      "4324:     int eol;",
      "4325:     int need = 0;",
      "4326:     Char *line;",
      "4327:     Char *lp;",
      "4328:     CELL first = *cellc;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "4326:     size_t have = 0;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "4359:     if_OPT_WIDE_CHARS(screen, {",
      "4361:     });",
      "",
      "[Removed Lines]",
      "4360:  need *= 4;",
      "",
      "[Added Lines]",
      "4361:  if (need > 0) {",
      "4362:      if (screen->max_combining > 0)",
      "4363:   need += screen->max_combining;",
      "4364:      need *= 6;",
      "4365:  }",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "4395:     }",
      "4402: }",
      "4404: #if OPT_PASTE64",
      "",
      "[Removed Lines]",
      "4398:     TRACE((\"Salted TEXT:%u:%s\\n\", (unsigned) (lp - line),",
      "4399:     visibleChars(line, (unsigned) (lp - line))));",
      "4401:     scp->data_length = (size_t) (lp - line);",
      "",
      "[Added Lines]",
      "4403:     have = (size_t) (lp - line);",
      "4408:     if ((have * 2) < (size_t) need) {",
      "4409:  scp->data_limit = have + 1;",
      "4410:  line = realloc(line, scp->data_limit);",
      "4411:     }",
      "4413:     TRACE((\"Salted TEXT:%u:%s\\n\", (unsigned) have,",
      "4414:     visibleChars(line, (unsigned) have)));",
      "4416:     scp->data_length = have;",
      "",
      "---------------"
    ],
    "xterm.log.html||xterm.log.html": [
      "File: xterm.log.html -> xterm.log.html",
      "--- Hunk 1 ---",
      "[Context before]",
      "34:   -->",
      "35: <!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01//EN\">",
      "36: <html>",
      "",
      "[Removed Lines]",
      "33:   $XTermId: xterm.log.html,v 1.2309 2021/02/09 01:30:44 tom Exp $",
      "",
      "[Added Lines]",
      "33:   $XTermId: xterm.log.html,v 1.2311 2021/02/09 21:59:33 tom Exp $",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "1013:   <h1><a name=\"xterm_dev\" id=\"xterm_dev\">Development</a></h1>",
      "1015:   <ul>",
      "1016:     <li>with <code>alwaysHighlight</code> true, xterm does not",
      "1017:     properly track focus. The <em>screen-&gt;select</em>",
      "1018:     <code>FOCUS</code> flag remains always on, which prevents",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1016:     <li>correct upper-limit for selection buffer, accounting for",
      "1017:     combining characters (report by Tavis Ormandy).</li>",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "cfeb6163a923f1b239925b8c6e2f73b1515b52fd",
      "candidate_info": {
        "commit_hash": "cfeb6163a923f1b239925b8c6e2f73b1515b52fd",
        "repo": "ThomasDickey/xterm-snapshots",
        "commit_url": "https://github.com/ThomasDickey/xterm-snapshots/commit/cfeb6163a923f1b239925b8c6e2f73b1515b52fd",
        "files": [
          "MANIFEST",
          "button.c",
          "xterm.log.html"
        ],
        "message": "snapshot of project \"xterm\", label xterm-365d",
        "before_after_code_files": [
          "button.c||button.c",
          "xterm.log.html||xterm.log.html"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "button.c||button.c",
            "xterm.log.html||xterm.log.html"
          ],
          "candidate": [
            "button.c||button.c",
            "xterm.log.html||xterm.log.html"
          ]
        }
      },
      "candidate_diff": {
        "button.c||button.c": [
          "File: button.c -> button.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "4323:     int i;",
          "4324:     int eol;",
          "4325:     int need = 0;",
          "4326:     Char *line;",
          "4327:     Char *lp;",
          "4328:     CELL first = *cellc;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "4326:     size_t have = 0;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "4359:     if_OPT_WIDE_CHARS(screen, {",
          "4361:     });",
          "",
          "[Removed Lines]",
          "4360:  need *= 4;",
          "",
          "[Added Lines]",
          "4361:  if (need > 0) {",
          "4362:      if (screen->max_combining > 0)",
          "4363:   need += screen->max_combining;",
          "4364:      need *= 6;",
          "4365:  }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "4395:     }",
          "4402: }",
          "4404: #if OPT_PASTE64",
          "",
          "[Removed Lines]",
          "4398:     TRACE((\"Salted TEXT:%u:%s\\n\", (unsigned) (lp - line),",
          "4399:     visibleChars(line, (unsigned) (lp - line))));",
          "4401:     scp->data_length = (size_t) (lp - line);",
          "",
          "[Added Lines]",
          "4403:     have = (size_t) (lp - line);",
          "4408:     if ((have * 2) < (size_t) need) {",
          "4409:  scp->data_limit = have + 1;",
          "4410:  line = realloc(line, scp->data_limit);",
          "4411:     }",
          "4413:     TRACE((\"Salted TEXT:%u:%s\\n\", (unsigned) have,",
          "4414:     visibleChars(line, (unsigned) have)));",
          "4416:     scp->data_length = have;",
          "",
          "---------------"
        ],
        "xterm.log.html||xterm.log.html": [
          "File: xterm.log.html -> xterm.log.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "34:   -->",
          "35: <!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01//EN\">",
          "36: <html>",
          "",
          "[Removed Lines]",
          "33:   $XTermId: xterm.log.html,v 1.2309 2021/02/09 01:30:44 tom Exp $",
          "",
          "[Added Lines]",
          "33:   $XTermId: xterm.log.html,v 1.2311 2021/02/09 21:59:33 tom Exp $",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1013:   <h1><a name=\"xterm_dev\" id=\"xterm_dev\">Development</a></h1>",
          "1015:   <ul>",
          "1016:     <li>with <code>alwaysHighlight</code> true, xterm does not",
          "1017:     properly track focus. The <em>screen-&gt;select</em>",
          "1018:     <code>FOCUS</code> flag remains always on, which prevents",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1016:     <li>correct upper-limit for selection buffer, accounting for",
          "1017:     combining characters (report by Tavis Ormandy).</li>",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "82ba55b8f994ab30ff561a347b82ea340ba7075c",
      "candidate_info": {
        "commit_hash": "82ba55b8f994ab30ff561a347b82ea340ba7075c",
        "repo": "ThomasDickey/xterm-snapshots",
        "commit_url": "https://github.com/ThomasDickey/xterm-snapshots/commit/82ba55b8f994ab30ff561a347b82ea340ba7075c",
        "files": [
          "MANIFEST",
          "button.c",
          "xterm.log.html"
        ],
        "message": "snapshot of project \"xterm\", label xterm-365d",
        "before_after_code_files": [
          "button.c||button.c",
          "xterm.log.html||xterm.log.html"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "button.c||button.c",
            "xterm.log.html||xterm.log.html"
          ],
          "candidate": [
            "button.c||button.c",
            "xterm.log.html||xterm.log.html"
          ]
        }
      },
      "candidate_diff": {
        "button.c||button.c": [
          "File: button.c -> button.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "4323:     int i;",
          "4324:     int eol;",
          "4325:     int need = 0;",
          "4326:     Char *line;",
          "4327:     Char *lp;",
          "4328:     CELL first = *cellc;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "4326:     size_t have = 0;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "4359:     if_OPT_WIDE_CHARS(screen, {",
          "4361:     });",
          "",
          "[Removed Lines]",
          "4360:  need *= 4;",
          "",
          "[Added Lines]",
          "4361:  if (need > 0) {",
          "4362:      if (screen->max_combining > 0)",
          "4363:   need += screen->max_combining;",
          "4364:      need *= 6;",
          "4365:  }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "4395:     }",
          "4402: }",
          "4404: #if OPT_PASTE64",
          "",
          "[Removed Lines]",
          "4398:     TRACE((\"Salted TEXT:%u:%s\\n\", (unsigned) (lp - line),",
          "4399:     visibleChars(line, (unsigned) (lp - line))));",
          "4401:     scp->data_length = (size_t) (lp - line);",
          "",
          "[Added Lines]",
          "4403:     have = (size_t) (lp - line);",
          "4408:     if ((have * 2) < (size_t) need) {",
          "4409:  scp->data_limit = have + 1;",
          "4410:  line = realloc(line, scp->data_limit);",
          "4411:     }",
          "4413:     TRACE((\"Salted TEXT:%u:%s\\n\", (unsigned) have,",
          "4414:     visibleChars(line, (unsigned) have)));",
          "4416:     scp->data_length = have;",
          "",
          "---------------"
        ],
        "xterm.log.html||xterm.log.html": [
          "File: xterm.log.html -> xterm.log.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "34:   -->",
          "35: <!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01//EN\">",
          "36: <html>",
          "",
          "[Removed Lines]",
          "33:   $XTermId: xterm.log.html,v 1.2309 2021/02/09 01:30:44 tom Exp $",
          "",
          "[Added Lines]",
          "33:   $XTermId: xterm.log.html,v 1.2311 2021/02/09 21:59:33 tom Exp $",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1013:   <h1><a name=\"xterm_dev\" id=\"xterm_dev\">Development</a></h1>",
          "1015:   <ul>",
          "1016:     <li>with <code>alwaysHighlight</code> true, xterm does not",
          "1017:     properly track focus. The <em>screen-&gt;select</em>",
          "1018:     <code>FOCUS</code> flag remains always on, which prevents",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1016:     <li>correct upper-limit for selection buffer, accounting for",
          "1017:     combining characters (report by Tavis Ormandy).</li>",
          "",
          "---------------"
        ]
      }
    }
  ]
}