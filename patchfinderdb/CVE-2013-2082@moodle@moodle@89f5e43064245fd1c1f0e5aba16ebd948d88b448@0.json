{
  "cve_id": "CVE-2013-2082",
  "cve_desc": "Moodle through 2.1.10, 2.2.x before 2.2.10, 2.3.x before 2.3.7, and 2.4.x before 2.4.4 does not enforce capability requirements for reading blog comments, which allows remote attackers to obtain sensitive information via a crafted request.",
  "repo": "moodle/moodle",
  "patch_hash": "89f5e43064245fd1c1f0e5aba16ebd948d88b448",
  "patch_info": {
    "commit_hash": "89f5e43064245fd1c1f0e5aba16ebd948d88b448",
    "repo": "moodle/moodle",
    "commit_url": "https://github.com/moodle/moodle/commit/89f5e43064245fd1c1f0e5aba16ebd948d88b448",
    "files": [
      "blog/lib.php"
    ],
    "message": "MDL-37245 Blog: Fixed comments.",
    "before_after_code_files": [
      "blog/lib.php||blog/lib.php"
    ]
  },
  "patch_diff": {
    "blog/lib.php||blog/lib.php": [
      "File: blog/lib.php -> blog/lib.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "65:     global $CFG, $USER, $DB;",
      "67:     if (empty($CFG->enableblogs)) {",
      "69:     }",
      "71:     if (isloggedin() && $USER->id == $targetuserid) {",
      "73:     }",
      "75:     $sitecontext = context_system::instance();",
      "76:     if (has_capability('moodle/blog:manageentries', $sitecontext)) {",
      "78:     }",
      "81:     if ($blogentry && $blogentry->publishstate == 'draft' && !has_capability('moodle/blog:viewdrafts', $sitecontext)) {",
      "83:     }",
      "",
      "[Removed Lines]",
      "68:         return false; // blog system disabled",
      "72:         return true; // can view own entries in any case",
      "77:         return true; // can manage all entries",
      "82:         return false;  // can not view draft of others",
      "",
      "[Added Lines]",
      "68:         return false; // Blog system disabled.",
      "72:         return true; // Can view own entries in any case.",
      "77:         return true; // Can manage all entries.",
      "82:         return false;  // Can not view draft of others.",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "87:         return false;",
      "88:     }",
      "90:     switch ($CFG->bloglevel) {",
      "91:         case BLOG_GLOBAL_LEVEL:",
      "92:             return true;",
      "93:         break;",
      "95:         case BLOG_SITE_LEVEL:",
      "97:                 return true;",
      "98:             }",
      "99:             return false;",
      "",
      "[Removed Lines]",
      "96:             if (isloggedin()) { // not logged in viewers forbidden",
      "",
      "[Added Lines]",
      "97:             if (isloggedin()) { // Not logged in viewers forbidden.",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "b6f8473cdb77bd759e9cb8ceb467cbb95cf0fcdd",
      "candidate_info": {
        "commit_hash": "b6f8473cdb77bd759e9cb8ceb467cbb95cf0fcdd",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/b6f8473cdb77bd759e9cb8ceb467cbb95cf0fcdd",
        "files": [
          "blog/lib.php"
        ],
        "message": "MDL-37245 Blog: Fixed comments.",
        "before_after_code_files": [
          "blog/lib.php||blog/lib.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "blog/lib.php||blog/lib.php"
          ],
          "candidate": [
            "blog/lib.php||blog/lib.php"
          ]
        }
      },
      "candidate_diff": {
        "blog/lib.php||blog/lib.php": [
          "File: blog/lib.php -> blog/lib.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "65:     global $CFG, $USER, $DB;",
          "67:     if (empty($CFG->enableblogs)) {",
          "69:     }",
          "71:     if (isloggedin() && $USER->id == $targetuserid) {",
          "73:     }",
          "75:     $sitecontext = context_system::instance();",
          "76:     if (has_capability('moodle/blog:manageentries', $sitecontext)) {",
          "78:     }",
          "81:     if ($blogentry && $blogentry->publishstate == 'draft' && !has_capability('moodle/blog:viewdrafts', $sitecontext)) {",
          "83:     }",
          "",
          "[Removed Lines]",
          "68:         return false; // blog system disabled",
          "72:         return true; // can view own entries in any case",
          "77:         return true; // can manage all entries",
          "82:         return false;  // can not view draft of others",
          "",
          "[Added Lines]",
          "68:         return false; // Blog system disabled.",
          "72:         return true; // Can view own entries in any case.",
          "77:         return true; // Can manage all entries.",
          "82:         return false;  // Can not view draft of others.",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "87:         return false;",
          "88:     }",
          "90:     switch ($CFG->bloglevel) {",
          "91:         case BLOG_GLOBAL_LEVEL:",
          "92:             return true;",
          "93:         break;",
          "95:         case BLOG_SITE_LEVEL:",
          "97:                 return true;",
          "98:             }",
          "99:             return false;",
          "",
          "[Removed Lines]",
          "96:             if (isloggedin()) { // not logged in viewers forbidden",
          "",
          "[Added Lines]",
          "97:             if (isloggedin()) { // Not logged in viewers forbidden.",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "4b5dcd72d5d1bec150ecccde12f48beecff94afb",
      "candidate_info": {
        "commit_hash": "4b5dcd72d5d1bec150ecccde12f48beecff94afb",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/4b5dcd72d5d1bec150ecccde12f48beecff94afb",
        "files": [
          "blog/lib.php"
        ],
        "message": "MDL-37245 Blog: Fixed comments.\n\nConflicts:\n\n\tblog/lib.php\n\nSigned-off-by: Rajesh Taneja <rajesh@moodle.com>\n\nConflicts:\n\n\tblog/lib.php",
        "before_after_code_files": [
          "blog/lib.php||blog/lib.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_olp_changes": 1,
        "olp_code_files": {
          "patch": [
            "blog/lib.php||blog/lib.php"
          ],
          "candidate": [
            "blog/lib.php||blog/lib.php"
          ]
        }
      },
      "candidate_diff": {
        "blog/lib.php||blog/lib.php": [
          "File: blog/lib.php -> blog/lib.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "65:     global $CFG, $USER, $DB;",
          "67:     if (empty($CFG->bloglevel)) {",
          "69:     }",
          "71:     if (isloggedin() && $USER->id == $targetuserid) {",
          "73:     }",
          "75:     $sitecontext = get_context_instance(CONTEXT_SYSTEM);",
          "76:     if (has_capability('moodle/blog:manageentries', $sitecontext)) {",
          "78:     }",
          "81:     if ($blogentry && $blogentry->publishstate == 'draft' && !has_capability('moodle/blog:viewdrafts', $sitecontext)) {",
          "83:     }",
          "",
          "[Removed Lines]",
          "68:         return false; // blog system disabled",
          "72:         return true; // can view own entries in any case",
          "77:         return true; // can manage all entries",
          "82:         return false;  // can not view draft of others",
          "",
          "[Added Lines]",
          "68:         return false; // Blog system disabled.",
          "72:         return true; // Can view own entries in any case.",
          "77:         return true; // Can manage all entries.",
          "82:         return false;  // Can not view draft of others.",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "87:         return false;",
          "88:     }",
          "90:     switch ($CFG->bloglevel) {",
          "91:         case BLOG_GLOBAL_LEVEL:",
          "92:             return true;",
          "93:         break;",
          "95:         case BLOG_SITE_LEVEL:",
          "97:                 return true;",
          "98:             }",
          "99:             return false;",
          "",
          "[Removed Lines]",
          "96:             if (isloggedin()) { // not logged in viewers forbidden",
          "",
          "[Added Lines]",
          "97:             if (isloggedin()) { // Not logged in viewers forbidden.",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "b9c29ff6d3a37092b07c61976e9c380842f77da0",
      "candidate_info": {
        "commit_hash": "b9c29ff6d3a37092b07c61976e9c380842f77da0",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/b9c29ff6d3a37092b07c61976e9c380842f77da0",
        "files": [
          "blog/lib.php"
        ],
        "message": "MDL-37245 Blog: Fixed comments.\n\nConflicts:\n\n\tblog/lib.php\n\nSigned-off-by: Rajesh Taneja <rajesh@moodle.com>\n\nConflicts:\n\n\tblog/lib.php",
        "before_after_code_files": [
          "blog/lib.php||blog/lib.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_olp_changes": 1,
        "olp_code_files": {
          "patch": [
            "blog/lib.php||blog/lib.php"
          ],
          "candidate": [
            "blog/lib.php||blog/lib.php"
          ]
        }
      },
      "candidate_diff": {
        "blog/lib.php||blog/lib.php": [
          "File: blog/lib.php -> blog/lib.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "65:     global $CFG, $USER, $DB;",
          "67:     if (empty($CFG->bloglevel)) {",
          "69:     }",
          "71:     if (isloggedin() && $USER->id == $targetuserid) {",
          "73:     }",
          "75:     $sitecontext = get_context_instance(CONTEXT_SYSTEM);",
          "76:     if (has_capability('moodle/blog:manageentries', $sitecontext)) {",
          "78:     }",
          "81:     if ($blogentry && $blogentry->publishstate == 'draft' && !has_capability('moodle/blog:viewdrafts', $sitecontext)) {",
          "83:     }",
          "",
          "[Removed Lines]",
          "68:         return false; // blog system disabled",
          "72:         return true; // can view own entries in any case",
          "77:         return true; // can manage all entries",
          "82:         return false;  // can not view draft of others",
          "",
          "[Added Lines]",
          "68:         return false; // Blog system disabled.",
          "72:         return true; // Can view own entries in any case.",
          "77:         return true; // Can manage all entries.",
          "82:         return false;  // Can not view draft of others.",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "87:         return false;",
          "88:     }",
          "90:     switch ($CFG->bloglevel) {",
          "91:         case BLOG_GLOBAL_LEVEL:",
          "92:             return true;",
          "93:         break;",
          "95:         case BLOG_SITE_LEVEL:",
          "97:                 return true;",
          "98:             }",
          "99:             return false;",
          "",
          "[Removed Lines]",
          "96:             if (isloggedin()) { // not logged in viewers forbidden",
          "",
          "[Added Lines]",
          "97:             if (isloggedin()) { // Not logged in viewers forbidden.",
          "",
          "---------------"
        ]
      }
    }
  ]
}