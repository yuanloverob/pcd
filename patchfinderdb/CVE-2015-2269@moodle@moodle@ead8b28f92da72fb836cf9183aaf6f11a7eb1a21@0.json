{
  "cve_id": "CVE-2015-2269",
  "cve_desc": "Multiple cross-site scripting (XSS) vulnerabilities in lib/javascript-static.js in Moodle through 2.5.9, 2.6.x before 2.6.9, 2.7.x before 2.7.6, and 2.8.x before 2.8.4 allow remote authenticated users to inject arbitrary web script or HTML via a (1) alt or (2) title attribute in an IMG element.",
  "repo": "moodle/moodle",
  "patch_hash": "ead8b28f92da72fb836cf9183aaf6f11a7eb1a21",
  "patch_info": {
    "commit_hash": "ead8b28f92da72fb836cf9183aaf6f11a7eb1a21",
    "repo": "moodle/moodle",
    "commit_url": "https://github.com/moodle/moodle/commit/ead8b28f92da72fb836cf9183aaf6f11a7eb1a21",
    "files": [
      "lib/javascript-static.js"
    ],
    "message": "MDL-49144 blocks: Sanitise alt and title for block controls",
    "before_after_code_files": [
      "lib/javascript-static.js||lib/javascript-static.js"
    ]
  },
  "patch_diff": {
    "lib/javascript-static.js||lib/javascript-static.js": [
      "File: lib/javascript-static.js -> lib/javascript-static.js",
      "--- Hunk 1 ---",
      "[Context before]",
      "597:                     this.set('block', '#'+this.get('id'));",
      "598:                     var b = this.get('block'),",
      "599:                         t = b.one('.title'),",
      "601:                     if (t && (a = t.one('.block_action'))) {",
      "604:                         hide.on('keypress', this.updateStateKey, this, true);",
      "607:                         show.on('keypress', this.updateStateKey, this, false);",
      "608:                         a.insert(show, 0).insert(hide, 0);",
      "609:                     }",
      "610:                 },",
      "",
      "[Removed Lines]",
      "600:                         a = null;",
      "602:                         var hide = Y.Node.create('<img class=\"block-hider-hide\" tabindex=\"0\" alt=\"'+config.tooltipVisible+'\" title=\"'+config.tooltipVisible+'\" />');",
      "603:                         hide.setAttribute('src', this.get('iconVisible')).on('click', this.updateState, this, true);",
      "605:                         var show = Y.Node.create('<img class=\"block-hider-show\" tabindex=\"0\" alt=\"'+config.tooltipHidden+'\" title=\"'+config.tooltipHidden+'\" />');",
      "606:                         show.setAttribute('src', this.get('iconHidden')).on('click', this.updateState, this, false);",
      "",
      "[Added Lines]",
      "600:                         a = null,",
      "601:                         hide,",
      "602:                         show;",
      "604:                         hide = Y.Node.create('<img />')",
      "605:                             .addClass('block-hider-hide')",
      "606:                             .setAttrs({",
      "607:                                 alt:        config.tooltipVisible,",
      "608:                                 src:        this.get('iconVisible'),",
      "609:                                 tabindex:   0,",
      "610:                                 'title':    config.tooltipVisible",
      "611:                             });",
      "613:                         hide.on('click', this.updateState, this, true);",
      "615:                         show = Y.Node.create('<img />')",
      "616:                             .addClass('block-hider-show')",
      "617:                             .setAttrs({",
      "618:                                 alt:        config.tooltipHidden,",
      "619:                                 src:        this.get('iconHidden'),",
      "620:                                 tabindex:   0,",
      "621:                                 'title':    config.tooltipHidden",
      "622:                             });",
      "624:                         show.on('click', this.updateState, this, false);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "5339e23057deca62c8b77724ba90249a1f5637e8",
      "candidate_info": {
        "commit_hash": "5339e23057deca62c8b77724ba90249a1f5637e8",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/5339e23057deca62c8b77724ba90249a1f5637e8",
        "files": [
          "lib/javascript-static.js"
        ],
        "message": "MDL-49144 blocks: Sanitise alt and title for block controls",
        "before_after_code_files": [
          "lib/javascript-static.js||lib/javascript-static.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "lib/javascript-static.js||lib/javascript-static.js"
          ],
          "candidate": [
            "lib/javascript-static.js||lib/javascript-static.js"
          ]
        }
      },
      "candidate_diff": {
        "lib/javascript-static.js||lib/javascript-static.js": [
          "File: lib/javascript-static.js -> lib/javascript-static.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "710:                     this.set('block', '#'+this.get('id'));",
          "711:                     var b = this.get('block'),",
          "712:                         t = b.one('.title'),",
          "714:                     if (t && (a = t.one('.block_action'))) {",
          "717:                         hide.on('keypress', this.updateStateKey, this, true);",
          "720:                         show.on('keypress', this.updateStateKey, this, false);",
          "721:                         a.insert(show, 0).insert(hide, 0);",
          "722:                     }",
          "723:                 },",
          "",
          "[Removed Lines]",
          "713:                         a = null;",
          "715:                         var hide = Y.Node.create('<img class=\"block-hider-hide\" tabindex=\"0\" alt=\"'+config.tooltipVisible+'\" title=\"'+config.tooltipVisible+'\" />');",
          "716:                         hide.setAttribute('src', this.get('iconVisible')).on('click', this.updateState, this, true);",
          "718:                         var show = Y.Node.create('<img class=\"block-hider-show\" tabindex=\"0\" alt=\"'+config.tooltipHidden+'\" title=\"'+config.tooltipHidden+'\" />');",
          "719:                         show.setAttribute('src', this.get('iconHidden')).on('click', this.updateState, this, false);",
          "",
          "[Added Lines]",
          "713:                         a = null,",
          "714:                         hide,",
          "715:                         show;",
          "717:                         hide = Y.Node.create('<img />')",
          "718:                             .addClass('block-hider-hide')",
          "719:                             .setAttrs({",
          "720:                                 alt:        config.tooltipVisible,",
          "721:                                 src:        this.get('iconVisible'),",
          "722:                                 tabindex:   0,",
          "723:                                 'title':    config.tooltipVisible",
          "724:                             });",
          "726:                         hide.on('click', this.updateState, this, true);",
          "728:                         show = Y.Node.create('<img />')",
          "729:                             .addClass('block-hider-show')",
          "730:                             .setAttrs({",
          "731:                                 alt:        config.tooltipHidden,",
          "732:                                 src:        this.get('iconHidden'),",
          "733:                                 tabindex:   0,",
          "734:                                 'title':    config.tooltipHidden",
          "735:                             });",
          "737:                         show.on('click', this.updateState, this, false);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "51094c656081cb39ff012f674dd55738ea4b7f4a",
      "candidate_info": {
        "commit_hash": "51094c656081cb39ff012f674dd55738ea4b7f4a",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/51094c656081cb39ff012f674dd55738ea4b7f4a",
        "files": [
          "lib/javascript-static.js"
        ],
        "message": "MDL-49144 blocks: Sanitise alt and title for block controls",
        "before_after_code_files": [
          "lib/javascript-static.js||lib/javascript-static.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "lib/javascript-static.js||lib/javascript-static.js"
          ],
          "candidate": [
            "lib/javascript-static.js||lib/javascript-static.js"
          ]
        }
      },
      "candidate_diff": {
        "lib/javascript-static.js||lib/javascript-static.js": [
          "File: lib/javascript-static.js -> lib/javascript-static.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "597:                     this.set('block', '#'+this.get('id'));",
          "598:                     var b = this.get('block'),",
          "599:                         t = b.one('.title'),",
          "601:                     if (t && (a = t.one('.block_action'))) {",
          "604:                         hide.on('keypress', this.updateStateKey, this, true);",
          "607:                         show.on('keypress', this.updateStateKey, this, false);",
          "608:                         a.insert(show, 0).insert(hide, 0);",
          "609:                     }",
          "610:                 },",
          "",
          "[Removed Lines]",
          "600:                         a = null;",
          "602:                         var hide = Y.Node.create('<img class=\"block-hider-hide\" tabindex=\"0\" alt=\"'+config.tooltipVisible+'\" title=\"'+config.tooltipVisible+'\" />');",
          "603:                         hide.setAttribute('src', this.get('iconVisible')).on('click', this.updateState, this, true);",
          "605:                         var show = Y.Node.create('<img class=\"block-hider-show\" tabindex=\"0\" alt=\"'+config.tooltipHidden+'\" title=\"'+config.tooltipHidden+'\" />');",
          "606:                         show.setAttribute('src', this.get('iconHidden')).on('click', this.updateState, this, false);",
          "",
          "[Added Lines]",
          "600:                         a = null,",
          "601:                         hide,",
          "602:                         show;",
          "604:                         hide = Y.Node.create('<img />')",
          "605:                             .addClass('block-hider-hide')",
          "606:                             .setAttrs({",
          "607:                                 alt:        config.tooltipVisible,",
          "608:                                 src:        this.get('iconVisible'),",
          "609:                                 tabindex:   0,",
          "610:                                 'title':    config.tooltipVisible",
          "611:                             });",
          "613:                         hide.on('click', this.updateState, this, true);",
          "615:                         show = Y.Node.create('<img />')",
          "616:                             .addClass('block-hider-show')",
          "617:                             .setAttrs({",
          "618:                                 alt:        config.tooltipHidden,",
          "619:                                 src:        this.get('iconHidden'),",
          "620:                                 tabindex:   0,",
          "621:                                 'title':    config.tooltipHidden",
          "622:                             });",
          "624:                         show.on('click', this.updateState, this, false);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "3a89cea7f71c2a818a610b62134cc6f3a88b4d5f",
      "candidate_info": {
        "commit_hash": "3a89cea7f71c2a818a610b62134cc6f3a88b4d5f",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/3a89cea7f71c2a818a610b62134cc6f3a88b4d5f",
        "files": [
          "lib/javascript-static.js"
        ],
        "message": "MDL-49144 blocks: Sanitise alt and title for block controls",
        "before_after_code_files": [
          "lib/javascript-static.js||lib/javascript-static.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "lib/javascript-static.js||lib/javascript-static.js"
          ],
          "candidate": [
            "lib/javascript-static.js||lib/javascript-static.js"
          ]
        }
      },
      "candidate_diff": {
        "lib/javascript-static.js||lib/javascript-static.js": [
          "File: lib/javascript-static.js -> lib/javascript-static.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "597:                     this.set('block', '#'+this.get('id'));",
          "598:                     var b = this.get('block'),",
          "599:                         t = b.one('.title'),",
          "601:                     if (t && (a = t.one('.block_action'))) {",
          "604:                         hide.on('keypress', this.updateStateKey, this, true);",
          "607:                         show.on('keypress', this.updateStateKey, this, false);",
          "608:                         a.insert(show, 0).insert(hide, 0);",
          "609:                     }",
          "610:                 },",
          "",
          "[Removed Lines]",
          "600:                         a = null;",
          "602:                         var hide = Y.Node.create('<img class=\"block-hider-hide\" tabindex=\"0\" alt=\"'+config.tooltipVisible+'\" title=\"'+config.tooltipVisible+'\" />');",
          "603:                         hide.setAttribute('src', this.get('iconVisible')).on('click', this.updateState, this, true);",
          "605:                         var show = Y.Node.create('<img class=\"block-hider-show\" tabindex=\"0\" alt=\"'+config.tooltipHidden+'\" title=\"'+config.tooltipHidden+'\" />');",
          "606:                         show.setAttribute('src', this.get('iconHidden')).on('click', this.updateState, this, false);",
          "",
          "[Added Lines]",
          "600:                         a = null,",
          "601:                         hide,",
          "602:                         show;",
          "604:                         hide = Y.Node.create('<img />')",
          "605:                             .addClass('block-hider-hide')",
          "606:                             .setAttrs({",
          "607:                                 alt:        config.tooltipVisible,",
          "608:                                 src:        this.get('iconVisible'),",
          "609:                                 tabindex:   0,",
          "610:                                 'title':    config.tooltipVisible",
          "611:                             });",
          "613:                         hide.on('click', this.updateState, this, true);",
          "615:                         show = Y.Node.create('<img />')",
          "616:                             .addClass('block-hider-show')",
          "617:                             .setAttrs({",
          "618:                                 alt:        config.tooltipHidden,",
          "619:                                 src:        this.get('iconHidden'),",
          "620:                                 tabindex:   0,",
          "621:                                 'title':    config.tooltipHidden",
          "622:                             });",
          "624:                         show.on('click', this.updateState, this, false);",
          "",
          "---------------"
        ]
      }
    }
  ]
}