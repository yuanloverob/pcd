{
  "cve_id": "CVE-2019-20079",
  "cve_desc": "The autocmd feature in window.c in Vim before 8.1.2136 accesses freed memory.",
  "repo": "vim/vim",
  "patch_hash": "ec66c41d84e574baf8009dbc0bd088d2bc5b2421",
  "patch_info": {
    "commit_hash": "ec66c41d84e574baf8009dbc0bd088d2bc5b2421",
    "repo": "vim/vim",
    "commit_url": "https://github.com/vim/vim/commit/ec66c41d84e574baf8009dbc0bd088d2bc5b2421",
    "files": [
      "src/testdir/test_autocmd.vim",
      "src/version.c",
      "src/window.c"
    ],
    "message": "patch 8.1.2136: using freed memory with autocmd from fuzzer\n\nProblem:    using freed memory with autocmd from fuzzer. (Dhiraj Mishra,\n            Dominique Pelle)\nSolution:   Avoid using \"wp\" after autocommands. (closes #5041)",
    "before_after_code_files": [
      "src/testdir/test_autocmd.vim||src/testdir/test_autocmd.vim",
      "src/version.c||src/version.c",
      "src/window.c||src/window.c"
    ]
  },
  "patch_diff": {
    "src/testdir/test_autocmd.vim||src/testdir/test_autocmd.vim": [
      "File: src/testdir/test_autocmd.vim -> src/testdir/test_autocmd.vim",
      "--- Hunk 1 ---",
      "[Context before]",
      "2288:   call StopVimInTerminal(buf)",
      "2289:   call delete(filename)",
      "2290: endfunc",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "2292: func Test_autocmd_was_using_freed_memory()",
      "2293:   pedit xx",
      "2294:   n x",
      "2295:   au WinEnter * quit",
      "2296:   split",
      "2297:   au! WinEnter",
      "2298: endfunc",
      "",
      "---------------"
    ],
    "src/version.c||src/version.c": [
      "File: src/version.c -> src/version.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "754: static int included_patches[] =",
      "757:     2135,",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "757:     2136,",
      "",
      "---------------"
    ],
    "src/window.c||src/window.c": [
      "File: src/window.c -> src/window.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "4655: #endif",
      "4656:     curwin->w_redr_status = TRUE;",
      "4657: #ifdef FEAT_TERMINAL",
      "4660:  redraw_mode = TRUE;",
      "4661: #endif",
      "",
      "[Removed Lines]",
      "4658:     if (bt_terminal(wp->w_buffer))",
      "",
      "[Added Lines]",
      "4659:     if (bt_terminal(curwin->w_buffer))",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "fbbd102be0f017b316f483893a95e4e78c286c9b",
      "candidate_info": {
        "commit_hash": "fbbd102be0f017b316f483893a95e4e78c286c9b",
        "repo": "vim/vim",
        "commit_url": "https://github.com/vim/vim/commit/fbbd102be0f017b316f483893a95e4e78c286c9b",
        "files": [
          "src/version.c",
          "src/window.c"
        ],
        "message": "patch 8.1.2122: cannot build without terminal feature\n\nProblem:    Cannot build without terminal feature.\nSolution:   Add #ifdef.",
        "before_after_code_files": [
          "src/version.c||src/version.c",
          "src/window.c||src/window.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/version.c||src/version.c",
            "src/window.c||src/window.c"
          ],
          "candidate": [
            "src/version.c||src/version.c",
            "src/window.c||src/window.c"
          ]
        }
      },
      "candidate_diff": {
        "src/version.c||src/version.c": [
          "File: src/version.c -> src/version.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "754: static int included_patches[] =",
          "757:     2121,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "757:     2122,",
          "",
          "---------------"
        ],
        "src/window.c||src/window.c": [
          "File: src/window.c -> src/window.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "4654:     maketitle();",
          "4655: #endif",
          "4656:     curwin->w_redr_status = TRUE;",
          "4657:     if (bt_terminal(wp->w_buffer))",
          "4659:  redraw_mode = TRUE;",
          "4660:     redraw_tabline = TRUE;",
          "4661:     if (restart_edit)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "4657: #ifdef FEAT_TERMINAL",
          "4661: #endif",
          "",
          "---------------"
        ]
      }
    }
  ]
}