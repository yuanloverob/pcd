{
  "cve_id": "CVE-2019-19242",
  "cve_desc": "SQLite 3.30.1 mishandles pExpr->y.pTab, as demonstrated by the TK_COLUMN case in sqlite3ExprCodeTarget in expr.c.",
  "repo": "sqlite/sqlite",
  "patch_hash": "57f7ece78410a8aae86aa4625fb7556897db384c",
  "patch_info": {
    "commit_hash": "57f7ece78410a8aae86aa4625fb7556897db384c",
    "repo": "sqlite/sqlite",
    "commit_url": "https://github.com/sqlite/sqlite/commit/57f7ece78410a8aae86aa4625fb7556897db384c",
    "files": [
      "manifest",
      "manifest.uuid",
      "src/expr.c",
      "src/wherecode.c",
      "test/gencol1.test"
    ],
    "message": "Fix a problem that comes up when using generated columns that evaluate to a constant in an index and then making use of that index in a join.\n\nFossilOrigin-Name: 8b12e95fec7ce6e0de82a04ca3dfcf1a8e62e233b7382aa28a8a9be6e862b1af",
    "before_after_code_files": [
      "manifest.uuid||manifest.uuid",
      "src/expr.c||src/expr.c",
      "src/wherecode.c||src/wherecode.c",
      "test/gencol1.test||test/gencol1.test"
    ]
  },
  "patch_diff": {
    "manifest.uuid||manifest.uuid": [
      "File: manifest.uuid -> manifest.uuid",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "1: 2d53a30cc23e53033af8e8666457654db5dcc453ed6cd176ce1d0bff4f528159",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ],
    "src/expr.c||src/expr.c": [
      "File: src/expr.c -> src/expr.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "3607:         int iReg = sqlite3ExprCodeTarget(pParse, pExpr->pLeft,target);",
      "3609:         if( aff>SQLITE_AFF_BLOB ){",
      "3610:           static const char zAff[] = \"B\\000C\\000D\\000E\";",
      "3611:           assert( SQLITE_AFF_BLOB=='A' );",
      "",
      "[Removed Lines]",
      "3608:         int aff = sqlite3TableColumnAffinity(pExpr->y.pTab, pExpr->iColumn);",
      "",
      "[Added Lines]",
      "3608:         int aff;",
      "3609:         if( pExpr->y.pTab ){",
      "3610:           aff = sqlite3TableColumnAffinity(pExpr->y.pTab, pExpr->iColumn);",
      "3611:         }else{",
      "3612:           aff = pExpr->affExpr;",
      "3613:         }",
      "",
      "---------------"
    ],
    "src/wherecode.c||src/wherecode.c": [
      "File: src/wherecode.c -> src/wherecode.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1141:   if( pExpr->op==TK_COLUMN ){",
      "1142:     IdxExprTrans *pX = p->u.pIdxTrans;",
      "1143:     if( pExpr->iTable==pX->iTabCur && pExpr->iColumn==pX->iTabCol ){",
      "1144:       pExpr->iTable = pX->iIdxCur;",
      "1145:       pExpr->iColumn = pX->iIdxCol;",
      "1146:       pExpr->y.pTab = 0;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1144:       assert( pExpr->y.pTab!=0 );",
      "1145:       pExpr->affExpr = sqlite3TableColumnAffinity(pExpr->y.pTab,pExpr->iColumn);",
      "",
      "---------------"
    ],
    "test/gencol1.test||test/gencol1.test": [
      "File: test/gencol1.test -> test/gencol1.test",
      "--- Hunk 1 ---",
      "[Context before]",
      "243:   UPDATE t0 SET c0 = NULL;",
      "244: } {1 {generated column loop on \"c2\"}}",
      "247: finish_test",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "246: # 2019-11-21 Problems in the new generated column logic",
      "247: # reported by Yongheng Chen and Rui Zhong",
      "248: do_execsql_test gencol1-9.10 {",
      "249:   DROP TABLE IF EXISTS t1;",
      "250:   DROP TABLE IF EXISTS t2;",
      "251:   CREATE TABLE t1(aa , bb AS (17) UNIQUE);",
      "252:   INSERT INTO t1 VALUES(17);",
      "253:   CREATE TABLE t2(cc);",
      "254:   INSERT INTO t2 VALUES(41);",
      "255:   SELECT * FROM t2 JOIN t1 WHERE t1.bb=t1.aa AND t1.bb=17;",
      "256: } {41 17 17}",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "4ddf7f42115eb93c489f966e035dec00af57aa39",
      "candidate_info": {
        "commit_hash": "4ddf7f42115eb93c489f966e035dec00af57aa39",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/4ddf7f42115eb93c489f966e035dec00af57aa39",
        "files": [
          "manifest",
          "manifest.uuid",
          "test/fuzzdata8.db"
        ],
        "message": "New test case loaded into test/fuzzdata8.db.\n\nFossilOrigin-Name: 00ae0c6c4815366bd2f36bc054b13bc7b568dd0a3caceddf0eba4db33f010ee4",
        "before_after_code_files": [
          "manifest.uuid||manifest.uuid"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: d5250db6322103326f0d5782ba049996d9ce8784f9e53a3112fb6f09f888f1c3",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "228a52d973c5eae8557adfc5da3b5b1ebcffdbec",
      "candidate_info": {
        "commit_hash": "228a52d973c5eae8557adfc5da3b5b1ebcffdbec",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/228a52d973c5eae8557adfc5da3b5b1ebcffdbec",
        "files": [
          "manifest",
          "manifest.uuid"
        ],
        "message": "Version 3.30.0\n\nFossilOrigin-Name: c20a35336432025445f9f7e289d0cc3e4003fb17f45a4ce74c6269c407c6e09f",
        "before_after_code_files": [
          "manifest.uuid||manifest.uuid"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: 7f9a4b6015ac332a04d3e394a6b3210fc95253d8786a261178a5639cb8d9d987",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "0971ef45abb33fd7f44510aa095efcdae776301b",
      "candidate_info": {
        "commit_hash": "0971ef45abb33fd7f44510aa095efcdae776301b",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/0971ef45abb33fd7f44510aa095efcdae776301b",
        "files": [
          "manifest",
          "manifest.uuid",
          "src/vdbe.c",
          "test/corruptL.test"
        ],
        "message": "Fix an assert() in the OP_Delete opcode that could fail with a corrupt database.\n\nFossilOrigin-Name: 915388ab39ba3ca8681cd2613b91314aa965967f23a5bface90f54a3d6423300",
        "before_after_code_files": [
          "manifest.uuid||manifest.uuid",
          "src/vdbe.c||src/vdbe.c",
          "test/corruptL.test||test/corruptL.test"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: 5dfc4fe98a4821cbdbfd7dfddf221b00251b2a26bf58767a3956b64e9a4e92da",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/vdbe.c||src/vdbe.c": [
          "File: src/vdbe.c -> src/vdbe.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "4786:     i64 iKey = sqlite3BtreeIntegerKey(pC->uc.pCursor);",
          "4788:   }",
          "4789: #endif",
          "",
          "[Removed Lines]",
          "4787:     assert( pC->movetoTarget==iKey );",
          "",
          "[Added Lines]",
          "4787:     assert( CORRUPT_DB || pC->movetoTarget==iKey );",
          "",
          "---------------"
        ],
        "test/corruptL.test||test/corruptL.test": [
          "File: test/corruptL.test -> test/corruptL.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "1008: } {1 {database disk image is malformed}}",
          "1011: finish_test",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1011: #-------------------------------------------------------------------------",
          "1012: reset_db",
          "1013: do_test 11.0 {",
          "1014:   sqlite3 db {}",
          "1015:   db deserialize [decode_hexdb {",
          "1016: | size 595 pagesize 512 filename x.db",
          "1017: | page 1 offset 0",
          "1018: |      0: 53 51 4c 69 74 65 20 66 6f 72 6d 61 74 20 33 00   SQLite format 3.",
          "1019: |     16: 02 00 00 01 00 40 20 20 00 01 00 0c 00 00 00 07   .....@  ........",
          "1020: |     32: 00 00 00 05 07 a1 1f fa 00 00 00 08 00 00 00 04   ................",
          "1021: |     48: 00 00 01 00 00 49 00 00 00 00 00 05 00 00 00 00   .....I..........",
          "1022: |     80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 1c   ................",
          "1023: |     96: 00 2e 2c 50 0d 00 00 00 06 01 06 00 01 da 01 b0   ..,P............",
          "1024: |    112: 01 56 01 86 01 2a 01 06 00 00 62 00 00 00 00 00   .V...*....b.....",
          "1025: |    128: 00 ed e2 78 74 64 33 ff 43 52 45 41 54 45 20 49   ...xtd3.CREATE I",
          "1026: |    144: 4e 44 45 58 20 74 33 78 20 4f 4e 20 74 33 28 38   NDEX t3x ON t3(8",
          "1027: |    160: 29 2e 04 06 17 15 11 01 45 69 6e 64 65 68 74 32   ).......Eindeht2",
          "1028: |    176: 63 64 74 31 e5 43 52 45 41 54 45 20 49 4e 44 45   cdt1.CREATE INDE",
          "1029: |    192: 58 20 74 32 63 c4 20 4f 4e 20 74 32 28 63 2c 64   X t2c. ON t2(c,d",
          "1030: |    208: 29 28 05 06 17 01 11 11 3d 74 61 6c 36 74 62 74   )(......=tal6tbt",
          "1031: |    224: 65 32 04 43 52 45 41 54 45 20 54 41 42 4c 45 20   e2.CREATE TABLE",
          "1032: |    240: 74 00 04 00 00 00 00 00 00 00 00 00 00 00 00 00   t...............",
          "1033: |    256: 00 00 00 00 00 00 22 07 06 17 11 11 01 30 e8 03   .............0..",
          "1034: |    272: 62 6c 65 74 34 74 35 02 43 52 45 41 54 45 20 54   blet4t5.CREATE T",
          "1035: |    288: 41 42 4c 45 20 74 34 28 94 29 2a 06 06 17 13 11   ABLE t4(.)*.....",
          "1036: |    304: 01 3f 69 33 74 6e 65 78 78 74 64 33 ff 43 52 45   .?i3tnexxtd3.CRE",
          "1037: |    320: 41 54 45 20 49 4e 44 45 58 20 74 33 78 20 4f 4e   ATE INDEX t3x ON",
          "1038: |    336: 20 74 31 28 38 29 2e 04 06 17 15 11 01 45 69 6e    t1(8).......Ein",
          "1039: |    352: 64 65 68 74 32 63 64 74 31 e5 43 52 45 41 54 45   deht2cdt1.CREATE",
          "1040: |    368: 20 49 4e 44 45 58 20 74 32 63 c4 20 4f 4e 20 74    INDEX t2c. ON t",
          "1041: |    384: 32 28 63 2c 64 29 28 05 06 17 01 11 11 3d 74 61   2(c,d)(......=ta",
          "1042: |    400: 6c 32 74 62 74 65 32 04 43 52 45 41 54 45 20 54   l2tbte2.CREATE T",
          "1043: |    416: 41 42 4c 45 20 74 33 28 63 2c 78 2c 65 2c 66 29   ABLE t3(c,x,e,f)",
          "1044: |    432: 28 02 06 17 11 11 01 3d 74 61 9e 93 65 74 32 74   (......=ta..et2t",
          "1045: |    448: 32 03 43 52 45 41 54 45 20 54 41 42 4c 45 20 74   2.CREATE TABLE t",
          "1046: |    464: 32 28 63 2c 64 2c 65 2c 66 29 24 01 06 17 11 11   2(c,d,e,f)$.....",
          "1047: |    480: 01 35 55 61 62 6c 88 74 31 74 31 02 43 52 45 41   .5Uabl.t1t1.CREA",
          "1048: |    496: 54 45 20 54 41 42 4c 45 20 74 31 28 61 2c 62 29   TE TABLE t1(a,b)",
          "1049: | page 2 offset 512",
          "1050: |      0: 0d 00 00 00 0d 25 00 01 cf 00 01 fa 01 f3 01 de   .....%..........",
          "1051: |     16: 01 00 00 00 fd 00 00 0d 00 00 00 00 45 20 54 41   ............E TA",
          "1052: |     32: 42 4c 45 20 74 34 28 94 29 2a 06 06 17 13 11 01   BLE t4(.)*......",
          "1053: |     48: 3f 69 33 74 6e 65 78 78 74 64 33 ff 43 52 45 a0   ?i3tnexxtd3.CRE.",
          "1054: |     64: a0 a0 a0 a0 a0 a0 a0 a0 a0 a0 a0 a0 74 13 11 01   ............t...",
          "1055: |     80: 49 45 74 00 00 00 00 00 00 00 00 00 00 00 00 00   IEt.............",
          "1056: | end x.db",
          "1057: }]} {}",
          "1059: do_catchsql_test 11.1 {",
          "1060:   DELETE FROM t3 WHERE x IN (SELECT x FROM t4);",
          "1061: } {1 {database disk image is malformed}}",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "76f8318e315e24ebd22e25e6222bb9df8bc2e401",
      "candidate_info": {
        "commit_hash": "76f8318e315e24ebd22e25e6222bb9df8bc2e401",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/76f8318e315e24ebd22e25e6222bb9df8bc2e401",
        "files": [
          "Makefile.in",
          "Makefile.msc",
          "main.mk",
          "manifest",
          "manifest.uuid"
        ],
        "message": "Remove the \"fastfuzztest\" makefile target.  Use only \"fuzztest\".\n\nFossilOrigin-Name: e17571c789db31123642d0ed1f3d8764e070019e0deb8b88cce58d2183551cdf",
        "before_after_code_files": [
          "Makefile.in||Makefile.in",
          "Makefile.msc||Makefile.msc",
          "main.mk||main.mk",
          "manifest.uuid||manifest.uuid"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "Makefile.in||Makefile.in": [
          "File: Makefile.in -> Makefile.in",
          "--- Hunk 1 ---",
          "[Context before]",
          "1242:  ./fuzzcheck$(TEXE) $(FUZZDATA)",
          "1243:  ./sessionfuzz$(TEXE) run $(TOP)/test/sessionfuzz-data1.db",
          "1249: valgrindfuzz: fuzzcheck$(TEXT) $(FUZZDATA) sessionfuzz$(TEXE) $(TOP)/test/sessionfuzz-data1.db",
          "1250:  valgrind ./fuzzcheck$(TEXE) --cell-size-check --limit-mem 10M --timeout 600 $(FUZZDATA)",
          "1251:  valgrind ./sessionfuzz$(TEXE) run $(TOP)/test/sessionfuzz-data1.db",
          "",
          "[Removed Lines]",
          "1245: fastfuzztest: fuzzcheck$(TEXE) $(FUZZDATA) sessionfuzz$(TEXE) $(TOP)/test/sessionfuzz-data1.db",
          "1246:  ./fuzzcheck$(TEXE) --limit-mem 100M $(FUZZDATA)",
          "1247:  ./sessionfuzz$(TEXE) run $(TOP)/test/sessionfuzz-data1.db",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1263: # This is the common case.  Run many tests that do not take too long,",
          "1264: # including fuzzcheck, sqlite3_analyzer, and sqldiff tests.",
          "1265: #",
          "1268: # Run a test using valgrind.  This can take a really long time",
          "1269: # because valgrind is so much slower than a native machine.",
          "",
          "[Removed Lines]",
          "1266: test: fastfuzztest sourcetest $(TESTPROGS) tcltest",
          "",
          "[Added Lines]",
          "1262: test: fuzztest sourcetest $(TESTPROGS) tcltest",
          "",
          "---------------"
        ],
        "Makefile.msc||Makefile.msc": [
          "File: Makefile.msc -> Makefile.msc",
          "--- Hunk 1 ---",
          "[Context before]",
          "2404: fuzztest: fuzzcheck.exe",
          "2405:  .\\fuzzcheck.exe $(FUZZDATA)",
          "2410: # Minimal testing that runs in less than 3 minutes (on a fast machine)",
          "2411: #",
          "2412: quicktest: testfixture.exe sourcetest",
          "",
          "[Removed Lines]",
          "2407: fastfuzztest: fuzzcheck.exe",
          "2408:  .\\fuzzcheck.exe --limit-mem 100M $(FUZZDATA)",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2416: # This is the common case.  Run many tests that do not take too long,",
          "2417: # including fuzzcheck, sqlite3_analyzer, and sqldiff tests.",
          "2418: #",
          "2420:  @set PATH=$(LIBTCLPATH);$(PATH)",
          "2421:  .\\testfixture.exe $(TOP)\\test\\veryquick.test $(TESTOPTS)",
          "",
          "[Removed Lines]",
          "2419: test: $(TESTPROGS) sourcetest fastfuzztest",
          "",
          "[Added Lines]",
          "2416: test: $(TESTPROGS) sourcetest fuzztest",
          "",
          "---------------"
        ],
        "main.mk||main.mk": [
          "File: main.mk -> main.mk",
          "--- Hunk 1 ---",
          "[Context before]",
          "934:  ./fuzzcheck$(EXE) $(FUZZDATA)",
          "935:  ./sessionfuzz run $(TOP)/test/sessionfuzz-data1.db",
          "941: valgrindfuzz: fuzzcheck$(EXE) $(FUZZDATA) sessionfuzz$(EXE) $(TOP)/test/sessionfuzz-data1.db",
          "942:  valgrind ./fuzzcheck$(EXE) --cell-size-check --limit-mem 10M --timeout 600 $(FUZZDATA)",
          "943:  valgrind ./sessionfuzz run $(TOP)/test/sessionfuzz-data1.db",
          "",
          "[Removed Lines]",
          "937: fastfuzztest: fuzzcheck$(EXE) $(FUZZDATA) sessionfuzz$(EXE) $(TOP)/test/sessionfuzz-data1.db",
          "938:  ./fuzzcheck$(EXE) --limit-mem 100M $(FUZZDATA)",
          "939:  ./sessionfuzz run $(TOP)/test/sessionfuzz-data1.db",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "956: # The default test case.  Runs most of the faster standard TCL tests,",
          "957: # and fuzz tests, and sqlite3_analyzer and sqldiff tests.",
          "960: # Run a test using valgrind.  This can take a really long time",
          "961: # because valgrind is so much slower than a native machine.",
          "",
          "[Removed Lines]",
          "958: test: fastfuzztest sourcetest $(TESTPROGS) tcltest",
          "",
          "[Added Lines]",
          "954: test: fuzztest sourcetest $(TESTPROGS) tcltest",
          "",
          "---------------"
        ],
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: b68d21e93a0839b42f49845918df7738ee7fa2a05c7f4ae2f89fdbb5e47ad8eb",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "2d441ce3f3c10af9dd884b11cadd5a14ae566b01",
      "candidate_info": {
        "commit_hash": "2d441ce3f3c10af9dd884b11cadd5a14ae566b01",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/2d441ce3f3c10af9dd884b11cadd5a14ae566b01",
        "files": [
          "ext/misc/fossildelta.c",
          "manifest",
          "manifest.uuid"
        ],
        "message": "Add the delta_parse(DELTA) table-valued function to the fossildelta extension.\n\nFossilOrigin-Name: d91fcc267bf1be795dfdb1fbfb40c2aea79ddff247a51d26462136c325b7a6d3",
        "before_after_code_files": [
          "ext/misc/fossildelta.c||ext/misc/fossildelta.c",
          "manifest.uuid||manifest.uuid"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "ext/misc/fossildelta.c||ext/misc/fossildelta.c": [
          "File: ext/misc/fossildelta.c -> ext/misc/fossildelta.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "138:   static const signed char zValue[] = {",
          "139:     -1, -1, -1, -1, -1, -1, -1, -1,   -1, -1, -1, -1, -1, -1, -1, -1,",
          "140:     -1, -1, -1, -1, -1, -1, -1, -1,   -1, -1, -1, -1, -1, -1, -1, -1,",
          "",
          "[Removed Lines]",
          "137: static unsigned int getInt(const char **pz, int *pLen){",
          "",
          "[Added Lines]",
          "137: static unsigned int deltaGetInt(const char **pz, int *pLen){",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "485: static int delta_output_size(const char *zDelta, int lenDelta){",
          "486:   int size;",
          "488:   if( *zDelta!='\\n' ){",
          "490:     return -1;",
          "",
          "[Removed Lines]",
          "487:   size = getInt(&zDelta, &lenDelta);",
          "",
          "[Added Lines]",
          "487:   size = deltaGetInt(&zDelta, &lenDelta);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "526:   char *zOrigOut = zOut;",
          "527: #endif",
          "530:   if( *zDelta!='\\n' ){",
          "532:     return -1;",
          "",
          "[Removed Lines]",
          "529:   limit = getInt(&zDelta, &lenDelta);",
          "",
          "[Added Lines]",
          "529:   limit = deltaGetInt(&zDelta, &lenDelta);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "534:   zDelta++; lenDelta--;",
          "535:   while( *zDelta && lenDelta>0 ){",
          "536:     unsigned int cnt, ofst;",
          "538:     switch( zDelta[0] ){",
          "539:       case '@': {",
          "540:         zDelta++; lenDelta--;",
          "542:         if( lenDelta>0 && zDelta[0]!=',' ){",
          "544:           return -1;",
          "",
          "[Removed Lines]",
          "537:     cnt = getInt(&zDelta, &lenDelta);",
          "541:         ofst = getInt(&zDelta, &lenDelta);",
          "",
          "[Added Lines]",
          "537:     cnt = deltaGetInt(&zDelta, &lenDelta);",
          "541:         ofst = deltaGetInt(&zDelta, &lenDelta);",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "599:   return -1;",
          "600: }",
          "",
          "[Removed Lines]",
          "607: static int delta_analyze(",
          "612: ){",
          "613:   unsigned int nInsert = 0;",
          "614:   unsigned int nCopy = 0;",
          "616:   (void)getInt(&zDelta, &lenDelta);",
          "617:   if( *zDelta!='\\n' ){",
          "619:     return -1;",
          "620:   }",
          "621:   zDelta++; lenDelta--;",
          "622:   while( *zDelta && lenDelta>0 ){",
          "623:     unsigned int cnt;",
          "624:     cnt = getInt(&zDelta, &lenDelta);",
          "625:     switch( zDelta[0] ){",
          "626:       case '@': {",
          "627:         zDelta++; lenDelta--;",
          "628:         (void)getInt(&zDelta, &lenDelta);",
          "629:         if( lenDelta>0 && zDelta[0]!=',' ){",
          "631:           return -1;",
          "632:         }",
          "633:         zDelta++; lenDelta--;",
          "634:         nCopy += cnt;",
          "635:         break;",
          "636:       }",
          "637:       case ':': {",
          "638:         zDelta++; lenDelta--;",
          "639:         nInsert += cnt;",
          "640:         if( cnt>lenDelta ){",
          "642:           return -1;",
          "643:         }",
          "644:         zDelta += cnt;",
          "645:         lenDelta -= cnt;",
          "646:         break;",
          "647:       }",
          "648:       case ';': {",
          "651:         return 0;",
          "652:       }",
          "653:       default: {",
          "655:         return -1;",
          "656:       }",
          "657:     }",
          "658:   }",
          "660:   return -1;",
          "661: }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "765:   }",
          "766: }",
          "769: #ifdef _WIN32",
          "770: __declspec(dllexport)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "710: typedef struct deltaparsevtab_vtab deltaparsevtab_vtab;",
          "711: typedef struct deltaparsevtab_cursor deltaparsevtab_cursor;",
          "712: struct deltaparsevtab_vtab {",
          "715: };",
          "716: struct deltaparsevtab_cursor {",
          "724: };",
          "728: static const char *azOp[] = {",
          "729:   \"SIZE\", \"COPY\", \"INSERT\", \"CHECKSUM\", \"ERROR\", \"EOF\"",
          "730: };",
          "731: #define DELTAPARSE_OP_SIZE         0",
          "732: #define DELTAPARSE_OP_COPY         1",
          "733: #define DELTAPARSE_OP_INSERT       2",
          "734: #define DELTAPARSE_OP_CHECKSUM     3",
          "735: #define DELTAPARSE_OP_ERROR        4",
          "736: #define DELTAPARSE_OP_EOF          5",
          "751: static int deltaparsevtabConnect(",
          "752:   sqlite3 *db,",
          "753:   void *pAux,",
          "754:   int argc, const char *const*argv,",
          "755:   sqlite3_vtab **ppVtab,",
          "756:   char **pzErr",
          "757: ){",
          "758:   deltaparsevtab_vtab *pNew;",
          "759:   int rc;",
          "761:   rc = sqlite3_declare_vtab(db,",
          "762:            \"CREATE TABLE x(op,a1,a2,delta HIDDEN)\"",
          "763:        );",
          "765: #define DELTAPARSEVTAB_OP     0",
          "766: #define DELTAPARSEVTAB_A1     1",
          "767: #define DELTAPARSEVTAB_A2     2",
          "768: #define DELTAPARSEVTAB_DELTA  3",
          "769:   if( rc==SQLITE_OK ){",
          "770:     pNew = sqlite3_malloc64( sizeof(*pNew) );",
          "772:     if( pNew==0 ) return SQLITE_NOMEM;",
          "773:     memset(pNew, 0, sizeof(*pNew));",
          "774:   }",
          "775:   return rc;",
          "776: }",
          "781: static int deltaparsevtabDisconnect(sqlite3_vtab *pVtab){",
          "782:   deltaparsevtab_vtab *p = (deltaparsevtab_vtab*)pVtab;",
          "783:   sqlite3_free(p);",
          "784:   return SQLITE_OK;",
          "785: }",
          "790: static int deltaparsevtabOpen(sqlite3_vtab *p, sqlite3_vtab_cursor **ppCursor){",
          "791:   deltaparsevtab_cursor *pCur;",
          "792:   pCur = sqlite3_malloc( sizeof(*pCur) );",
          "793:   if( pCur==0 ) return SQLITE_NOMEM;",
          "794:   memset(pCur, 0, sizeof(*pCur));",
          "796:   return SQLITE_OK;",
          "797: }",
          "802: static int deltaparsevtabClose(sqlite3_vtab_cursor *cur){",
          "803:   deltaparsevtab_cursor *pCur = (deltaparsevtab_cursor*)cur;",
          "804:   sqlite3_free(pCur);",
          "805:   return SQLITE_OK;",
          "806: }",
          "812: static int deltaparsevtabNext(sqlite3_vtab_cursor *cur){",
          "813:   deltaparsevtab_cursor *pCur = (deltaparsevtab_cursor*)cur;",
          "814:   const char *z;",
          "815:   int i = 0;",
          "817:   pCur->iCursor = pCur->iNext;",
          "818:   z = pCur->aDelta + pCur->iCursor;",
          "819:   pCur->a1 = deltaGetInt(&z, &i);",
          "820:   switch( z[0] ){",
          "821:     case '@': {",
          "822:       z++;",
          "823:       pCur->a2 = deltaGetInt(&z, &i);",
          "824:       pCur->eOp = DELTAPARSE_OP_COPY;",
          "825:       pCur->iNext = (int)(&z[1] - pCur->aDelta);",
          "826:       break;",
          "827:     }",
          "828:     case ':': {",
          "829:       z++;",
          "830:       pCur->a2 = (unsigned int)(z - pCur->aDelta);",
          "831:       pCur->eOp = DELTAPARSE_OP_INSERT;",
          "832:       pCur->iNext = (int)(&z[pCur->a1] - pCur->aDelta);",
          "833:       break;",
          "834:     }",
          "835:     case ';': {",
          "836:       pCur->eOp = DELTAPARSE_OP_CHECKSUM;",
          "837:       pCur->iNext = pCur->nDelta;",
          "838:       break;",
          "839:     }",
          "840:     default: {",
          "841:       if( pCur->iNext==pCur->nDelta ){",
          "842:         pCur->eOp = DELTAPARSE_OP_EOF;",
          "843:       }else{",
          "844:         pCur->eOp = DELTAPARSE_OP_ERROR;",
          "845:         pCur->iNext = pCur->nDelta;",
          "846:       }",
          "847:       break;",
          "848:     }",
          "849:   }",
          "850:   return SQLITE_OK;",
          "851: }",
          "857: static int deltaparsevtabColumn(",
          "861: ){",
          "862:   deltaparsevtab_cursor *pCur = (deltaparsevtab_cursor*)cur;",
          "863:   switch( i ){",
          "864:     case DELTAPARSEVTAB_OP: {",
          "865:       sqlite3_result_text(ctx, azOp[pCur->eOp], -1, SQLITE_STATIC);",
          "866:       break;",
          "867:     }",
          "868:     case DELTAPARSEVTAB_A1: {",
          "869:       sqlite3_result_int(ctx, pCur->a1);",
          "870:       break;",
          "871:     }",
          "872:     case DELTAPARSEVTAB_A2: {",
          "873:       if( pCur->eOp==DELTAPARSE_OP_COPY ){",
          "874:         sqlite3_result_int(ctx, pCur->a2);",
          "875:       }else if( pCur->eOp==DELTAPARSE_OP_INSERT ){",
          "876:         sqlite3_result_blob(ctx, pCur->aDelta+pCur->a2, pCur->a1,",
          "877:                             SQLITE_TRANSIENT);",
          "878:       }",
          "879:       break;",
          "880:     }",
          "881:     case DELTAPARSEVTAB_DELTA: {",
          "882:       sqlite3_result_blob(ctx, pCur->aDelta, pCur->nDelta, SQLITE_TRANSIENT);",
          "883:       break;",
          "884:     }",
          "885:   }",
          "886:   return SQLITE_OK;",
          "887: }",
          "893: static int deltaparsevtabRowid(sqlite3_vtab_cursor *cur, sqlite_int64 *pRowid){",
          "894:   deltaparsevtab_cursor *pCur = (deltaparsevtab_cursor*)cur;",
          "896:   return SQLITE_OK;",
          "897: }",
          "903: static int deltaparsevtabEof(sqlite3_vtab_cursor *cur){",
          "904:   deltaparsevtab_cursor *pCur = (deltaparsevtab_cursor*)cur;",
          "905:   return pCur->eOp==DELTAPARSE_OP_EOF;",
          "906: }",
          "914: static int deltaparsevtabFilter(",
          "915:   sqlite3_vtab_cursor *pVtabCursor,",
          "916:   int idxNum, const char *idxStr,",
          "917:   int argc, sqlite3_value **argv",
          "918: ){",
          "919:   deltaparsevtab_cursor *pCur = (deltaparsevtab_cursor *)pVtabCursor;",
          "920:   const char *a;",
          "921:   int i = 0;",
          "922:   pCur->eOp = DELTAPARSE_OP_ERROR;",
          "923:   if( idxNum!=1 ){",
          "924:     return SQLITE_OK;",
          "925:   }",
          "926:   pCur->nDelta = sqlite3_value_bytes(argv[0]);",
          "927:   a = (const char*)sqlite3_value_blob(argv[0]);",
          "928:   if( pCur->nDelta==0 || a==0 ){",
          "929:     return SQLITE_OK;",
          "930:   }",
          "931:   pCur->aDelta = sqlite3_malloc64( pCur->nDelta+1 );",
          "932:   if( pCur->aDelta==0 ){",
          "933:     pCur->nDelta = 0;",
          "934:     return SQLITE_NOMEM;",
          "935:   }",
          "936:   memcpy(pCur->aDelta, a, pCur->nDelta);",
          "937:   pCur->aDelta[pCur->nDelta] = 0;",
          "938:   a = pCur->aDelta;",
          "939:   pCur->eOp = DELTAPARSE_OP_SIZE;",
          "940:   pCur->a1 = deltaGetInt(&a, &i);",
          "941:   if( a[0]!='\\n' ){",
          "942:     pCur->eOp = DELTAPARSE_OP_ERROR;",
          "943:     pCur->a1 = pCur->a2 = 0;",
          "944:     pCur->iNext = pCur->nDelta;",
          "945:     return SQLITE_OK;",
          "946:   }",
          "947:   a++;",
          "948:   pCur->iNext = (unsigned int)(a - pCur->aDelta);",
          "949:   return SQLITE_OK;",
          "950: }",
          "958: static int deltaparsevtabBestIndex(",
          "959:   sqlite3_vtab *tab,",
          "960:   sqlite3_index_info *pIdxInfo",
          "961: ){",
          "962:   int i;",
          "963:   for(i=0; i<pIdxInfo->nConstraint; i++){",
          "964:     if( pIdxInfo->aConstraint[i].iColumn != DELTAPARSEVTAB_DELTA ) continue;",
          "965:     if( pIdxInfo->aConstraint[i].usable==0 ) continue;",
          "966:     if( pIdxInfo->aConstraint[i].op!=SQLITE_INDEX_CONSTRAINT_EQ ) continue;",
          "967:     pIdxInfo->aConstraintUsage[i].argvIndex = 1;",
          "968:     pIdxInfo->aConstraintUsage[i].omit = 1;",
          "969:     pIdxInfo->estimatedCost = (double)1;",
          "970:     pIdxInfo->estimatedRows = 10;",
          "971:     pIdxInfo->idxNum = 1;",
          "972:     return SQLITE_OK;",
          "973:   }",
          "974:   pIdxInfo->idxNum = 0;",
          "975:   pIdxInfo->estimatedCost = (double)0x7fffffff;",
          "976:   pIdxInfo->estimatedRows = 0x7fffffff;",
          "977:   return SQLITE_OK;",
          "978: }",
          "984: static sqlite3_module deltaparsevtabModule = {",
          "1009: };",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "787:     rc = sqlite3_create_function(db, \"delta_output_size\", 1, SQLITE_UTF8, 0,",
          "788:                                  deltaOutputSizeFunc, 0, 0);",
          "789:   }",
          "790:   return rc;",
          "791: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1034:   if( rc==SQLITE_OK ){",
          "1035:     rc = sqlite3_create_module(db, \"delta_parse\", &deltaparsevtabModule, 0);",
          "1036:   }",
          "",
          "---------------"
        ],
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: b80cafa6f8a5c6ff1dc9efd2f670777ab131ace2df1eb431cedc8cfa901baf18",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    }
  ]
}