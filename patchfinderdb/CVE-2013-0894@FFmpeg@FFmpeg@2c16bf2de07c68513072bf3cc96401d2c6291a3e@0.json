{
  "cve_id": "CVE-2013-0894",
  "cve_desc": "Buffer overflow in the vorbis_parse_setup_hdr_floors function in the Vorbis decoder in vorbisdec.c in libavcodec in FFmpeg through 1.1.3, as used in Google Chrome before 25.0.1364.97 on Windows and Linux and before 25.0.1364.99 on Mac OS X and other products, allows remote attackers to cause a denial of service (divide-by-zero error or out-of-bounds array access) or possibly have unspecified other impact via vectors involving a zero value for a bark map size.",
  "repo": "FFmpeg/FFmpeg",
  "patch_hash": "2c16bf2de07c68513072bf3cc96401d2c6291a3e",
  "patch_info": {
    "commit_hash": "2c16bf2de07c68513072bf3cc96401d2c6291a3e",
    "repo": "FFmpeg/FFmpeg",
    "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/2c16bf2de07c68513072bf3cc96401d2c6291a3e",
    "files": [
      "libavcodec/vorbisdec.c"
    ],
    "message": "vorbisdec: Check bark_map_size.\n\nThis fixes potential divisions by zero and out of array accesses.\n\nReported-by: Dale Curtis <dalecurtis@chromium.org>\nFound-by: inferno@chromium.org\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>",
    "before_after_code_files": [
      "libavcodec/vorbisdec.c||libavcodec/vorbisdec.c"
    ]
  },
  "patch_diff": {
    "libavcodec/vorbisdec.c||libavcodec/vorbisdec.c": [
      "File: libavcodec/vorbisdec.c -> libavcodec/vorbisdec.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "597:                        \"Floor 0 amplitude bits is 0.\\n\");",
      "598:                 return AVERROR_INVALIDDATA;",
      "599:             }",
      "600:             floor_setup->data.t0.amplitude_offset = get_bits(gb, 8);",
      "601:             floor_setup->data.t0.num_books        = get_bits(gb, 4) + 1;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "600:             if (floor_setup->data.t0.bark_map_size == 0) {",
      "601:                 av_log(vc->avccontext, AV_LOG_ERROR, \"Floor 0 bark map size is 0.\\n\");",
      "602:                 return AVERROR_INVALIDDATA;",
      "603:             }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "3926ebc7029d97f2aa8c1d834a9a67d821c43db8",
      "candidate_info": {
        "commit_hash": "3926ebc7029d97f2aa8c1d834a9a67d821c43db8",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/3926ebc7029d97f2aa8c1d834a9a67d821c43db8",
        "files": [
          "libavcodec/vorbisdec.c"
        ],
        "message": "vorbisdec: Check bark_map_size.\n\nThis fixes potential divisions by zero and out of array accesses.\n\nReported-by: Dale Curtis <dalecurtis@chromium.org>\nFound-by: inferno@chromium.org\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>\n(cherry picked from commit 2c16bf2de07c68513072bf3cc96401d2c6291a3e)\n\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>",
        "before_after_code_files": [
          "libavcodec/vorbisdec.c||libavcodec/vorbisdec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavcodec/vorbisdec.c||libavcodec/vorbisdec.c"
          ],
          "candidate": [
            "libavcodec/vorbisdec.c||libavcodec/vorbisdec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavcodec/vorbisdec.c||libavcodec/vorbisdec.c": [
          "File: libavcodec/vorbisdec.c -> libavcodec/vorbisdec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "595:                        \"Floor 0 amplitude bits is 0.\\n\");",
          "596:                 return AVERROR_INVALIDDATA;",
          "597:             }",
          "598:             floor_setup->data.t0.amplitude_offset = get_bits(gb, 8);",
          "599:             floor_setup->data.t0.num_books        = get_bits(gb, 4) + 1;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "598:             if (floor_setup->data.t0.bark_map_size == 0) {",
          "599:                 av_log(vc->avccontext, AV_LOG_ERROR, \"Floor 0 bark map size is 0.\\n\");",
          "600:                 return AVERROR_INVALIDDATA;",
          "601:             }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "0916d0f9d1b94b4bb88382edae45b9276746574d",
      "candidate_info": {
        "commit_hash": "0916d0f9d1b94b4bb88382edae45b9276746574d",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/0916d0f9d1b94b4bb88382edae45b9276746574d",
        "files": [
          "libavcodec/vorbisdec.c"
        ],
        "message": "vorbisdec: Check bark_map_size.\n\nThis fixes potential divisions by zero and out of array accesses.\n\nReported-by: Dale Curtis <dalecurtis@chromium.org>\nFound-by: inferno@chromium.org\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>\n(cherry picked from commit 2c16bf2de07c68513072bf3cc96401d2c6291a3e)\n\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>",
        "before_after_code_files": [
          "libavcodec/vorbisdec.c||libavcodec/vorbisdec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavcodec/vorbisdec.c||libavcodec/vorbisdec.c"
          ],
          "candidate": [
            "libavcodec/vorbisdec.c||libavcodec/vorbisdec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavcodec/vorbisdec.c||libavcodec/vorbisdec.c": [
          "File: libavcodec/vorbisdec.c -> libavcodec/vorbisdec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "599:                        \"Floor 0 amplitude bits is 0.\\n\");",
          "600:                 return AVERROR_INVALIDDATA;",
          "601:             }",
          "602:             floor_setup->data.t0.amplitude_offset = get_bits(gb, 8);",
          "603:             floor_setup->data.t0.num_books        = get_bits(gb, 4) + 1;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "602:             if (floor_setup->data.t0.bark_map_size == 0) {",
          "603:                 av_log(vc->avccontext, AV_LOG_ERROR, \"Floor 0 bark map size is 0.\\n\");",
          "604:                 return AVERROR_INVALIDDATA;",
          "605:             }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "e050af9a809bd4e223c89e280ebd94da0e1034b5",
      "candidate_info": {
        "commit_hash": "e050af9a809bd4e223c89e280ebd94da0e1034b5",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/e050af9a809bd4e223c89e280ebd94da0e1034b5",
        "files": [
          "libavcodec/vorbisdec.c"
        ],
        "message": "vorbisdec: Error on bark_map_size equal to 0.\n\nThe value is used to calculate output LSP curve and a division by zero\nand out of array accesses would occur.\n\nCVE-2013-0894\n\nCC: libav-stable@libav.org\n\nReported-by: Dale Curtis <dalecurtis@chromium.org>\nFound-by: inferno@chromium.org\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>\nSigned-off-by: Luca Barbato <lu_zero@gentoo.org>\n(cherry picked from commit 11dcecfcca0eca1a571792c4fa3c21fb2cfddddc)\n\nSigned-off-by: Reinhard Tartler <siretart@tauware.de>\n(cherry picked from commit 494ddd377ada76ed555f7a3f49391455daa099c9)\n\nSigned-off-by: Reinhard Tartler <siretart@tauware.de>",
        "before_after_code_files": [
          "libavcodec/vorbisdec.c||libavcodec/vorbisdec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavcodec/vorbisdec.c||libavcodec/vorbisdec.c"
          ],
          "candidate": [
            "libavcodec/vorbisdec.c||libavcodec/vorbisdec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavcodec/vorbisdec.c||libavcodec/vorbisdec.c": [
          "File: libavcodec/vorbisdec.c -> libavcodec/vorbisdec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "587:             floor_setup->data.t0.order          = get_bits(gb,  8);",
          "588:             floor_setup->data.t0.rate           = get_bits(gb, 16);",
          "589:             floor_setup->data.t0.bark_map_size  = get_bits(gb, 16);",
          "590:             floor_setup->data.t0.amplitude_bits = get_bits(gb,  6);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "590:             if (floor_setup->data.t0.bark_map_size == 0) {",
          "591:                 av_log(vc->avccontext, AV_LOG_ERROR,",
          "592:                        \"Floor 0 bark map size is 0.\\n\");",
          "593:                 return AVERROR_INVALIDDATA;",
          "594:             }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "494ddd377ada76ed555f7a3f49391455daa099c9",
      "candidate_info": {
        "commit_hash": "494ddd377ada76ed555f7a3f49391455daa099c9",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/494ddd377ada76ed555f7a3f49391455daa099c9",
        "files": [
          "libavcodec/vorbisdec.c"
        ],
        "message": "vorbisdec: Error on bark_map_size equal to 0.\n\nThe value is used to calculate output LSP curve and a division by zero\nand out of array accesses would occur.\n\nCVE-2013-0894\n\nCC: libav-stable@libav.org\n\nReported-by: Dale Curtis <dalecurtis@chromium.org>\nFound-by: inferno@chromium.org\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>\nSigned-off-by: Luca Barbato <lu_zero@gentoo.org>\n(cherry picked from commit 11dcecfcca0eca1a571792c4fa3c21fb2cfddddc)\n\nSigned-off-by: Reinhard Tartler <siretart@tauware.de>",
        "before_after_code_files": [
          "libavcodec/vorbisdec.c||libavcodec/vorbisdec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavcodec/vorbisdec.c||libavcodec/vorbisdec.c"
          ],
          "candidate": [
            "libavcodec/vorbisdec.c||libavcodec/vorbisdec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavcodec/vorbisdec.c||libavcodec/vorbisdec.c": [
          "File: libavcodec/vorbisdec.c -> libavcodec/vorbisdec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "597:                 return AVERROR_INVALIDDATA;",
          "598:             }",
          "599:             floor_setup->data.t0.bark_map_size  = get_bits(gb, 16);",
          "600:             floor_setup->data.t0.amplitude_bits = get_bits(gb,  6);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "600:             if (floor_setup->data.t0.bark_map_size == 0) {",
          "601:                 av_log(vc->avccontext, AV_LOG_ERROR,",
          "602:                        \"Floor 0 bark map size is 0.\\n\");",
          "603:                 return AVERROR_INVALIDDATA;",
          "604:             }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "d86a5ce03f6993aaf7a28f2c2b29a788d7ea76ab",
      "candidate_info": {
        "commit_hash": "d86a5ce03f6993aaf7a28f2c2b29a788d7ea76ab",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/d86a5ce03f6993aaf7a28f2c2b29a788d7ea76ab",
        "files": [
          "libavcodec/vorbisdec.c"
        ],
        "message": "vorbisdec: Error on bark_map_size equal to 0.\n\nThe value is used to calculate output LSP curve and a division by zero\nand out of array accesses would occur.\n\nCVE-2013-0894\n\nCC: libav-stable@libav.org\n\nReported-by: Dale Curtis <dalecurtis@chromium.org>\nFound-by: inferno@chromium.org\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>\nSigned-off-by: Luca Barbato <lu_zero@gentoo.org>\n(cherry picked from commit 11dcecfcca0eca1a571792c4fa3c21fb2cfddddc)\n\nSigned-off-by: Reinhard Tartler <siretart@tauware.de>\n(cherry picked from commit 494ddd377ada76ed555f7a3f49391455daa099c9)\n\nSigned-off-by: Reinhard Tartler <siretart@tauware.de>",
        "before_after_code_files": [
          "libavcodec/vorbisdec.c||libavcodec/vorbisdec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavcodec/vorbisdec.c||libavcodec/vorbisdec.c"
          ],
          "candidate": [
            "libavcodec/vorbisdec.c||libavcodec/vorbisdec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavcodec/vorbisdec.c||libavcodec/vorbisdec.c": [
          "File: libavcodec/vorbisdec.c -> libavcodec/vorbisdec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "572:             floor_setup->data.t0.order          = get_bits(gb,  8);",
          "573:             floor_setup->data.t0.rate           = get_bits(gb, 16);",
          "574:             floor_setup->data.t0.bark_map_size  = get_bits(gb, 16);",
          "575:             floor_setup->data.t0.amplitude_bits = get_bits(gb,  6);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "575:             if (floor_setup->data.t0.bark_map_size == 0) {",
          "576:                 av_log(vc->avccontext, AV_LOG_ERROR,",
          "577:                        \"Floor 0 bark map size is 0.\\n\");",
          "578:                 return AVERROR_INVALIDDATA;",
          "579:             }",
          "",
          "---------------"
        ]
      }
    }
  ]
}