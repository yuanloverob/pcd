{
  "cve_id": "CVE-2012-2330",
  "cve_desc": "The Update method in src/node_http_parser.cc in Node.js before 0.6.17 and 0.7 before 0.7.8 does not properly check the length of a string, which allows remote attackers to obtain sensitive information (request header contents) and possibly spoof HTTP headers via a zero length string.",
  "repo": "joyent/node",
  "patch_hash": "c9a231db0e59658be419d926b1dfa17b939ba158",
  "patch_info": {
    "commit_hash": "c9a231db0e59658be419d926b1dfa17b939ba158",
    "repo": "joyent/node",
    "commit_url": "https://github.com/joyent/node/commit/c9a231d",
    "files": [
      "src/node_http_parser.cc"
    ],
    "message": "typo in node_http_parser",
    "before_after_code_files": [
      "src/node_http_parser.cc||src/node_http_parser.cc"
    ]
  },
  "patch_diff": {
    "src/node_http_parser.cc||src/node_http_parser.cc": [
      "File: src/node_http_parser.cc -> src/node_http_parser.cc",
      "--- Hunk 1 ---",
      "[Context before]",
      "191:   void Update(const char* str, size_t size) {",
      "192:     if (str_ == NULL)",
      "193:       str_ = str;",
      "197:       char* s = new char[size_ + size];",
      "",
      "[Removed Lines]",
      "194:     else if (on_heap_ || str_ + size != str) {",
      "",
      "[Added Lines]",
      "194:     else if (on_heap_ || str_ + size_ != str) {",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "45b772d8cb3fb2c3a4a07f30056879bc054ee627",
      "candidate_info": {
        "commit_hash": "45b772d8cb3fb2c3a4a07f30056879bc054ee627",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/45b772d8cb3fb2c3a4a07f30056879bc054ee627",
        "files": [
          "lib/fs.js"
        ],
        "message": "fs.readFile: Emit 'close' if we don't expect a close later\n\nThis fixes a regression introduced by 40b7302",
        "before_after_code_files": [
          "lib/fs.js||lifs.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "lib/fs.js||lifs.js": [
          "File: lib/fs.js -> lifs.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "88:   readStream.on('error', function(er) {",
          "89:     error = er;",
          "90:     readStream.destroy();",
          "91:   });",
          "93:   readStream.on('close', function() {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "e1199fa335e0cdbe11c8d2d7480409ce741d4406",
      "candidate_info": {
        "commit_hash": "e1199fa335e0cdbe11c8d2d7480409ce741d4406",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/e1199fa335e0cdbe11c8d2d7480409ce741d4406",
        "files": [
          "lib/tls.js"
        ],
        "message": "tls: fix CryptoStream.setKeepAlive()",
        "before_after_code_files": [
          "lib/tls.js||litls.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "lib/tls.js||litls.js": [
          "File: lib/tls.js -> litls.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "179: CryptoStream.prototype.setKeepAlive = function(enable, initialDelay) {",
          "181: };",
          "",
          "[Removed Lines]",
          "180:   if (this.socket) this.socket.setNoDelay(enable, initialDelay);",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "2134aa3d5c622fc3c3b02ccb713fcde0e0df479a",
      "candidate_info": {
        "commit_hash": "2134aa3d5c622fc3c3b02ccb713fcde0e0df479a",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/2134aa3d5c622fc3c3b02ccb713fcde0e0df479a",
        "files": [
          "AUTHORS",
          "ChangeLog",
          "src/node_version.h"
        ],
        "message": "2012.06.29, Version 0.8.1 (stable)\n\n* V8: upgrade to v3.11.10.12\n\n* npm: upgrade to v1.1.33\n  - Support for parallel use of the cache folder\n  - Retry on registry timeouts or network failures (Trent Mick)\n  - Reduce 'engines' failures to a warning\n  - Use new zsh completion if aviailable (Jeremy Cantrell)\n\n* Fix #3577 Un-break require('sys')\n\n* util: speed up formatting of large arrays/objects (Ben Noordhuis)\n\n* windows: make fs.realpath(Sync) work with UNC paths (Bert Belder)\n\n* build: fix --shared-v8 option (Ben Noordhuis)\n\n* doc: `detached` is a boolean (Andreas Madsen)\n\n* build: use proper python interpreter (Ben Noordhuis)\n\n* build: expand ~ in `./configure --prefix=~/a/b/c` (Ben Noordhuis)\n\n* build: handle CC env var with spaces (Gabriel de Perthuis)\n\n* build: fix V8 build when compiling with gcc 4.5 (Ben Noordhuis)\n\n* build: fix --shared-v8 option (Ben Noordhuis)\n\n* windows msi: Fix icon issue which caused huge file size (Bert Belder)\n\n* unix: assume that dlopen() may clobber dlerror() (Ben Noordhuis)\n\n* sunos: fix memory corruption bugs (Ben Noordhuis)\n\n* windows: better (f)utimes and (f)stat (Bert Belder)",
        "before_after_code_files": [
          "src/node_version.h||src/node_version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/node_version.h||src/node_version.h": [
          "File: src/node_version.h -> src/node_version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "25: #define NODE_MAJOR_VERSION 0",
          "26: #define NODE_MINOR_VERSION 8",
          "27: #define NODE_PATCH_VERSION 1",
          "30: #ifndef NODE_STRINGIFY",
          "31: #define NODE_STRINGIFY(n) NODE_STRINGIFY_HELPER(n)",
          "",
          "[Removed Lines]",
          "28: #define NODE_VERSION_IS_RELEASE 0",
          "",
          "[Added Lines]",
          "28: #define NODE_VERSION_IS_RELEASE 1",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "eb1ff034183b5178b26bb0d302e60e85b9dc3e20",
      "candidate_info": {
        "commit_hash": "eb1ff034183b5178b26bb0d302e60e85b9dc3e20",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/eb1ff034183b5178b26bb0d302e60e85b9dc3e20",
        "files": [
          "deps/v8/src/mark-compact.cc"
        ],
        "message": "v8: Fix missing initialization of mark-compact flags.\n\nR=svenpanne@chromium.org\n\nReview URL: https://chromiumcodereview.appspot.com/9662056\n\nCherry-pick of https://v8.googlecode.com/svn/branches/bleeding_edge@11006",
        "before_after_code_files": [
          "deps/v8/src/mark-compact.cc||deps/v8/src/mark-compact.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "deps/v8/src/mark-compact.cc||deps/v8/src/mark-compact.cc": [
          "File: deps/v8/src/mark-compact.cc -> deps/v8/src/mark-compact.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "60:       state_(IDLE),",
          "61: #endif",
          "62:       sweep_precisely_(false),",
          "63:       compacting_(false),",
          "64:       was_marked_incrementally_(false),",
          "65:       collect_maps_(FLAG_collect_maps),",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "63:       reduce_memory_footprint_(false),",
          "64:       abort_incremental_marking_(false),",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "e747daf60426e900fcd433148c391419bd5c2e65",
      "candidate_info": {
        "commit_hash": "e747daf60426e900fcd433148c391419bd5c2e65",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/e747daf60426e900fcd433148c391419bd5c2e65",
        "files": [
          "src/udp_wrap.cc"
        ],
        "message": "udp: make variable names consistent",
        "before_after_code_files": [
          "src/udp_wrap.cc||src/udp_wrap.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/udp_wrap.cc||src/udp_wrap.cc": [
          "File: src/udp_wrap.cc -> src/udp_wrap.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "66: Local<Object> AddressToJS(const sockaddr* addr);",
          "71: static Persistent<String> buffer_sym;",
          "72: static Persistent<String> oncomplete_sym;",
          "73: static Persistent<String> onmessage_sym;",
          "",
          "[Removed Lines]",
          "68: static Persistent<String> address_symbol;",
          "69: static Persistent<String> port_symbol;",
          "70: static Persistent<String> family_symbol;",
          "",
          "[Added Lines]",
          "68: static Persistent<String> address_sym;",
          "69: static Persistent<String> port_sym;",
          "70: static Persistent<String> family_sym;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "131:   HandleScope scope;",
          "133:   buffer_sym = NODE_PSYMBOL(\"buffer\");",
          "136:   oncomplete_sym = NODE_PSYMBOL(\"oncomplete\");",
          "137:   onmessage_sym = NODE_PSYMBOL(\"onmessage\");",
          "140:   Local<FunctionTemplate> t = FunctionTemplate::New(New);",
          "141:   t->InstanceTemplate()->SetInternalFieldCount(1);",
          "",
          "[Removed Lines]",
          "134:   port_symbol = NODE_PSYMBOL(\"port\");",
          "135:   address_symbol = NODE_PSYMBOL(\"address\");",
          "138:   family_symbol = NODE_PSYMBOL(\"family\");",
          "",
          "[Added Lines]",
          "134:   port_sym = NODE_PSYMBOL(\"port\");",
          "135:   address_sym = NODE_PSYMBOL(\"address\");",
          "138:   family_sym = NODE_PSYMBOL(\"family\");",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "459:     uv_inet_ntop(AF_INET6, &a6->sin6_addr, ip, sizeof ip);",
          "460:     port = ntohs(a6->sin6_port);",
          "461:     family_name = \"IPv6\";",
          "465:     break;",
          "467:   case AF_INET:",
          "",
          "[Removed Lines]",
          "462:     info->Set(address_symbol, String::New(ip));",
          "463:     info->Set(family_symbol, String::New(family_name));",
          "464:     info->Set(port_symbol, Integer::New(port));",
          "",
          "[Added Lines]",
          "462:     info->Set(address_sym, String::New(ip));",
          "463:     info->Set(family_sym, String::New(family_name));",
          "464:     info->Set(port_sym, Integer::New(port));",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "469:     uv_inet_ntop(AF_INET, &a4->sin_addr, ip, sizeof ip);",
          "470:     port = ntohs(a4->sin_port);",
          "471:     family_name = \"IPv4\";",
          "475:     break;",
          "477:   default:",
          "479:   }",
          "481:   return scope.Close(info);",
          "",
          "[Removed Lines]",
          "472:     info->Set(address_symbol, String::New(ip));",
          "473:     info->Set(family_symbol, String::New(family_name));",
          "474:     info->Set(port_symbol, Integer::New(port));",
          "478:     info->Set(address_symbol, String::Empty());",
          "",
          "[Added Lines]",
          "472:     info->Set(address_sym, String::New(ip));",
          "473:     info->Set(family_sym, String::New(family_name));",
          "474:     info->Set(port_sym, Integer::New(port));",
          "478:     info->Set(address_sym, String::Empty());",
          "",
          "---------------"
        ]
      }
    }
  ]
}