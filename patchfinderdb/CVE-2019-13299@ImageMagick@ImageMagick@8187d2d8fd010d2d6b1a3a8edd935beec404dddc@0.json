{
  "cve_id": "CVE-2019-13299",
  "cve_desc": "ImageMagick 7.0.8-50 Q16 has a heap-based buffer over-read at MagickCore/pixel-accessor.h in GetPixelChannel.",
  "repo": "ImageMagick/ImageMagick",
  "patch_hash": "8187d2d8fd010d2d6b1a3a8edd935beec404dddc",
  "patch_info": {
    "commit_hash": "8187d2d8fd010d2d6b1a3a8edd935beec404dddc",
    "repo": "ImageMagick/ImageMagick",
    "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/8187d2d8fd010d2d6b1a3a8edd935beec404dddc",
    "files": [
      "MagickCore/pixel-accessor.h"
    ],
    "message": "https://github.com/ImageMagick/ImageMagick/issues/1610",
    "before_after_code_files": [
      "MagickCore/pixel-accessor.h||MagickCore/pixel-accessor.h"
    ]
  },
  "patch_diff": {
    "MagickCore/pixel-accessor.h||MagickCore/pixel-accessor.h": [
      "File: MagickCore/pixel-accessor.h -> MagickCore/pixel-accessor.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "111: static inline Quantum GetPixelChannel(const Image *magick_restrict image,",
      "112:   const PixelChannel channel,const Quantum *magick_restrict pixel)",
      "113: {",
      "115:     return((Quantum) 0);",
      "116:   return(pixel[image->channel_map[channel].offset]);",
      "117: }",
      "",
      "[Removed Lines]",
      "114:   if (image->channel_map[channel].traits == UndefinedPixelTrait)",
      "",
      "[Added Lines]",
      "114:   if (image->channel_map[image->channel_map[channel].offset].traits == UndefinedPixelTrait)",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "933bf025119f0de25ee589b706c09c8bb46d5a48",
      "candidate_info": {
        "commit_hash": "933bf025119f0de25ee589b706c09c8bb46d5a48",
        "repo": "ImageMagick/ImageMagick",
        "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/933bf025119f0de25ee589b706c09c8bb46d5a48",
        "files": [
          "MagickCore/statistic.c"
        ],
        "message": "https://github.com/ImageMagick/ImageMagick/issues/1610",
        "before_after_code_files": [
          "MagickCore/statistic.c||MagickCore/statistic.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_message": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "MagickCore/statistic.c||MagickCore/statistic.c": [
          "File: MagickCore/statistic.c -> MagickCore/statistic.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "582:                 break;",
          "583:               }",
          "584:             for (i=0; i < (ssize_t) GetPixelChannels(image); i++)",
          "586:               PixelChannel channel = GetPixelChannelChannel(image,i);",
          "587:               PixelTrait evaluate_traits=GetPixelChannelTraits(image,channel);",
          "588:               PixelTrait traits = GetPixelChannelTraits(next,channel);",
          "589:               if ((traits == UndefinedPixelTrait) ||",
          "590:                   (evaluate_traits == UndefinedPixelTrait))",
          "591:                 continue;",
          "592:               if ((traits & UpdatePixelTrait) == 0)",
          "594:               evaluate_pixel[j].channel[i]=ApplyEvaluateOperator(",
          "595:                 random_info[id],GetPixelChannel(image,channel,p),op,",
          "596:                 evaluate_pixel[j].channel[i]);",
          "",
          "[Removed Lines]",
          "585:             {",
          "593:                 continue;",
          "",
          "[Added Lines]",
          "586:               PixelChannel channel = GetPixelChannelChannel(image,i);",
          "593:                 continue;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "688:             for (i=0; i < (ssize_t) GetPixelChannels(next); i++)",
          "689:             {",
          "691:               PixelTrait traits = GetPixelChannelTraits(next,channel);",
          "692:               PixelTrait evaluate_traits=GetPixelChannelTraits(image,channel);",
          "693:               if ((traits == UndefinedPixelTrait) ||",
          "694:                   (evaluate_traits == UndefinedPixelTrait))",
          "695:                 continue;",
          "696:               if ((traits & UpdatePixelTrait) == 0)",
          "698:               evaluate_pixel[x].channel[i]=ApplyEvaluateOperator(",
          "699:                 random_info[id],GetPixelChannel(image,channel,p),j == 0 ?",
          "700:                 AddEvaluateOperator : op,evaluate_pixel[x].channel[i]);",
          "",
          "[Removed Lines]",
          "690:               PixelChannel channel = GetPixelChannelChannel(image,i);",
          "697:                 continue;",
          "",
          "[Added Lines]",
          "690:               PixelChannel channel = GetPixelChannelChannel(image,i);",
          "697:                 continue;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "d4fc44b58a14f76b1ac997517d742ee12c9dc5d3",
      "candidate_info": {
        "commit_hash": "d4fc44b58a14f76b1ac997517d742ee12c9dc5d3",
        "repo": "ImageMagick/ImageMagick",
        "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/d4fc44b58a14f76b1ac997517d742ee12c9dc5d3",
        "files": [
          "MagickCore/enhance.c",
          "MagickCore/pixel-accessor.h"
        ],
        "message": "https://github.com/ImageMagick/ImageMagick/issues/1611",
        "before_after_code_files": [
          "MagickCore/enhance.c||MagickCore/enhance.c",
          "MagickCore/pixel-accessor.h||MagickCore/pixel-accessor.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "MagickCore/pixel-accessor.h||MagickCore/pixel-accessor.h"
          ],
          "candidate": [
            "MagickCore/pixel-accessor.h||MagickCore/pixel-accessor.h"
          ]
        }
      },
      "candidate_diff": {
        "MagickCore/enhance.c||MagickCore/enhance.c": [
          "File: MagickCore/enhance.c -> MagickCore/enhance.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1973:       EnhancePixel(8.0); EnhancePixel(20.0); EnhancePixel(40.0);",
          "1974:         EnhancePixel(20.0); EnhancePixel(8.0);",
          "1975:       r=p+4*GetPixelChannels(image)*(image->columns+4);",
          "1977:         EnhancePixel(8.0); EnhancePixel(5.0);",
          "1978:       if (total_weight > MagickEpsilon)",
          "1979:         {",
          "",
          "[Removed Lines]",
          "1976:       EnhancePixel(5.0); EnhancePixel(8.0); EnhancePixel(10.0);",
          "",
          "[Added Lines]",
          "1976:       EnhancePixel(5.0); EnhancePixel(8.0); EnhancePixel(10.0);",
          "",
          "---------------"
        ],
        "MagickCore/pixel-accessor.h||MagickCore/pixel-accessor.h": [
          "File: MagickCore/pixel-accessor.h -> MagickCore/pixel-accessor.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "111: static inline Quantum GetPixelChannel(const Image *magick_restrict image,",
          "112:   const PixelChannel channel,const Quantum *magick_restrict pixel)",
          "113: {",
          "115:     return((Quantum) 0);",
          "116:   return(pixel[image->channel_map[channel].offset]);",
          "117: }",
          "",
          "[Removed Lines]",
          "114:   if (image->channel_map[image->channel_map[channel].offset].traits == UndefinedPixelTrait)",
          "",
          "[Added Lines]",
          "114:   if (image->channel_map[channel].traits == UndefinedPixelTrait)",
          "",
          "---------------"
        ]
      }
    }
  ]
}