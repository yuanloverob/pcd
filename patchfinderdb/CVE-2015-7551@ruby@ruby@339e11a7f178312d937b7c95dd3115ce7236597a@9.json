{
  "cve_id": "CVE-2015-7551",
  "cve_desc": "The Fiddle::Handle implementation in ext/fiddle/handle.c in Ruby before 2.0.0-p648, 2.1 before 2.1.8, and 2.2 before 2.2.4, as distributed in Apple OS X before 10.11.4 and other products, mishandles tainting, which allows context-dependent attackers to execute arbitrary code or cause a denial of service (application crash) via a crafted string, related to the DL module and the libffi library.  NOTE: this vulnerability exists because of a CVE-2009-5147 regression.",
  "repo": "ruby/ruby",
  "patch_hash": "339e11a7f178312d937b7c95dd3115ce7236597a",
  "patch_info": {
    "commit_hash": "339e11a7f178312d937b7c95dd3115ce7236597a",
    "repo": "ruby/ruby",
    "commit_url": "https://github.com/ruby/ruby/commit/339e11a7f178312d937b7c95dd3115ce7236597a",
    "files": [
      "ChangeLog",
      "ext/fiddle/handle.c",
      "test/fiddle/test_handle.rb",
      "version.h"
    ],
    "message": "merge revision(s): 53153 and 23405@ruby_1_9_1\n\n\t* ext/fiddle/handle.c: check tainted string arguments.\n\t  Patch provided by tenderlove and nobu.\n\n\t* test/fiddle/test_handle.rb (class TestHandle): add test for above.\n\n\t* ext/dl/handle.c (rb_dlhandle_initialize): prohibits DL::dlopen\n\t  with a tainted name of library.\n\t  Patch by sheepman <sheepman AT sheepman.sakura.ne.jp>.\n\n\t* ext/dl/handle.c (rb_dlhandle_sym): ditto\n\n\n\ngit-svn-id: svn+ssh://ci.ruby-lang.org/ruby/branches/ruby_2_1@53156 b2dd03c8-39d4-4d8f-98ff-823fe69b080e",
    "before_after_code_files": [
      "ext/fiddle/handle.c||ext/fiddle/handle.c",
      "test/fiddle/test_handle.rb||test/fiddle/test_handle.rb",
      "version.h||version.h"
    ]
  },
  "patch_diff": {
    "ext/fiddle/handle.c||ext/fiddle/handle.c": [
      "File: ext/fiddle/handle.c -> ext/fiddle/handle.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1: #include <ruby.h>",
      "2: #include <fiddle.h>",
      "4: VALUE rb_cHandle;",
      "6: struct dl_handle {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "4: #define SafeStringValueCStr(v) (rb_check_safe_obj(rb_string_value(&v)), StringValueCStr(v))",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "143:  cflag = RTLD_LAZY | RTLD_GLOBAL;",
      "144:  break;",
      "145:       case 1:",
      "147:  cflag = RTLD_LAZY | RTLD_GLOBAL;",
      "148:  break;",
      "149:       case 2:",
      "151:  cflag = NUM2INT(flag);",
      "152:  break;",
      "153:       default:",
      "",
      "[Removed Lines]",
      "146:  clib = NIL_P(lib) ? NULL : StringValuePtr(lib);",
      "150:  clib = NIL_P(lib) ? NULL : StringValuePtr(lib);",
      "",
      "[Added Lines]",
      "148:  clib = NIL_P(lib) ? NULL : SafeStringValueCStr(lib);",
      "152:  clib = NIL_P(lib) ? NULL : SafeStringValueCStr(lib);",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "263:     return PTR2NUM(fiddle_handle);",
      "264: }",
      "",
      "[Removed Lines]",
      "266: static VALUE fiddle_handle_sym(void *handle, const char *symbol);",
      "",
      "[Added Lines]",
      "268: static VALUE fiddle_handle_sym(void *handle, VALUE symbol);",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "282:  rb_raise(rb_eFiddleError, \"closed handle\");",
      "283:     }",
      "286: }",
      "288: #ifndef RTLD_NEXT",
      "",
      "[Removed Lines]",
      "285:     return fiddle_handle_sym(fiddle_handle->ptr, StringValueCStr(sym));",
      "",
      "[Added Lines]",
      "287:     return fiddle_handle_sym(fiddle_handle->ptr, sym);",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "305: static VALUE",
      "306: rb_fiddle_handle_s_sym(VALUE self, VALUE sym)",
      "307: {",
      "309: }",
      "311: static VALUE",
      "313: {",
      "314: #if defined(HAVE_DLERROR)",
      "315:     const char *err;",
      "",
      "[Removed Lines]",
      "308:     return fiddle_handle_sym(RTLD_NEXT, StringValueCStr(sym));",
      "312: fiddle_handle_sym(void *handle, const char *name)",
      "",
      "[Added Lines]",
      "310:     return fiddle_handle_sym(RTLD_NEXT, sym);",
      "314: fiddle_handle_sym(void *handle, VALUE symbol)",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "318: # define CHECK_DLERROR",
      "319: #endif",
      "320:     void (*func)();",
      "322:     rb_secure(2);",
      "323: #ifdef HAVE_DLERROR",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "323:     const char *name = SafeStringValueCStr(symbol);",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "367:     }",
      "368: #endif",
      "369:     if( !func ){",
      "371:     }",
      "373:     return PTR2NUM(func);",
      "",
      "[Removed Lines]",
      "370:  rb_raise(rb_eFiddleError, \"unknown symbol \\\"%s\\\"\", name);",
      "",
      "[Added Lines]",
      "373:  rb_raise(rb_eFiddleError, \"unknown symbol \\\"%\"PRIsVALUE\"\\\"\", symbol);",
      "",
      "---------------"
    ],
    "test/fiddle/test_handle.rb||test/fiddle/test_handle.rb": [
      "File: test/fiddle/test_handle.rb -> test/fiddle/test_handle.rb",
      "--- Hunk 1 ---",
      "[Context before]",
      "11:     include Test::Unit::Assertions",
      "13:     def test_to_i",
      "14:       handle = Fiddle::Handle.new(LIBC_SO)",
      "15:       assert_kind_of Integer, handle.to_i",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "13:     def test_safe_handle_open",
      "14:       t = Thread.new do",
      "15:         $SAFE = 1",
      "16:         Fiddle::Handle.new(LIBC_SO.taint)",
      "17:       end",
      "18:       assert_raise(SecurityError) { t.value }",
      "19:     end",
      "21:     def test_safe_function_lookup",
      "22:       t = Thread.new do",
      "23:         h = Fiddle::Handle.new(LIBC_SO)",
      "24:         $SAFE = 1",
      "25:         h[\"qsort\".taint]",
      "26:       end",
      "27:       assert_raise(SecurityError) { t.value }",
      "28:     end",
      "",
      "---------------"
    ],
    "version.h||version.h": [
      "File: version.h -> version.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "1: #define RUBY_VERSION \"2.1.8\"",
      "2: #define RUBY_RELEASE_DATE \"2015-12-16\"",
      "5: #define RUBY_RELEASE_YEAR 2015",
      "6: #define RUBY_RELEASE_MONTH 12",
      "",
      "[Removed Lines]",
      "3: #define RUBY_PATCHLEVEL 438",
      "",
      "[Added Lines]",
      "3: #define RUBY_PATCHLEVEL 439",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "674725f1e83627b04da8a0a83da83a4454e3796e",
      "candidate_info": {
        "commit_hash": "674725f1e83627b04da8a0a83da83a4454e3796e",
        "repo": "ruby/ruby",
        "commit_url": "https://github.com/ruby/ruby/commit/674725f1e83627b04da8a0a83da83a4454e3796e",
        "files": [
          "ChangeLog",
          "test/rubygems/test_gem_commands_environment_command.rb",
          "version.h"
        ],
        "message": "* test/rubygems/test_gem_commands_environment_command.rb (test_execute):   version number may be two-digit.\n\ngit-svn-id: svn+ssh://ci.ruby-lang.org/ruby/branches/ruby_2_1@54462 b2dd03c8-39d4-4d8f-98ff-823fe69b080e",
        "before_after_code_files": [
          "test/rubygems/test_gem_commands_environment_command.rb||test/rubygems/test_gem_commands_environment_command.rb",
          "version.h||version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.h||version.h"
          ],
          "candidate": [
            "version.h||version.h"
          ]
        }
      },
      "candidate_diff": {
        "test/rubygems/test_gem_commands_environment_command.rb||test/rubygems/test_gem_commands_environment_command.rb": [
          "File: test/rubygems/test_gem_commands_environment_command.rb -> test/rubygems/test_gem_commands_environment_command.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "22:     end",
          "24:     assert_match %r|RUBYGEMS VERSION: (\\d\\.)+\\d|, @ui.output",
          "26:     assert_match %r|INSTALLATION DIRECTORY: #{Regexp.escape @gemhome}|,",
          "27:                  @ui.output",
          "28:     assert_match %r|RUBYGEMS PREFIX: |, @ui.output",
          "",
          "[Removed Lines]",
          "25:     assert_match %r|RUBY VERSION: \\d\\.\\d\\.\\d \\(.*\\) \\[.*\\]|, @ui.output",
          "",
          "[Added Lines]",
          "25:     assert_match %r|RUBY VERSION: \\d+\\.\\d+\\.\\d+ \\(.*\\) \\[.*\\]|, @ui.output",
          "",
          "---------------"
        ],
        "version.h||version.h": [
          "File: version.h -> version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: #define RUBY_VERSION \"2.1.10\"",
          "2: #define RUBY_RELEASE_DATE \"2016-04-01\"",
          "5: #define RUBY_RELEASE_YEAR 2016",
          "6: #define RUBY_RELEASE_MONTH 4",
          "",
          "[Removed Lines]",
          "3: #define RUBY_PATCHLEVEL 491",
          "",
          "[Added Lines]",
          "3: #define RUBY_PATCHLEVEL 492",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "c7458b51f754ad2cf6f397e319b12e7d1d7b6465",
      "candidate_info": {
        "commit_hash": "c7458b51f754ad2cf6f397e319b12e7d1d7b6465",
        "repo": "ruby/ruby",
        "commit_url": "https://github.com/ruby/ruby/commit/c7458b51f754ad2cf6f397e319b12e7d1d7b6465",
        "files": [
          "ChangeLog",
          "ext/zlib/zlib.c",
          "version.h"
        ],
        "message": "merge revision(s) 50834: [Backport #11221]\n\n\t* ext/zlib/zlib.c: Fix indentation for rdoc.\n\t  [Bug #11221][ruby-core:69465]\n\n\ngit-svn-id: svn+ssh://ci.ruby-lang.org/ruby/branches/ruby_2_1@51178 b2dd03c8-39d4-4d8f-98ff-823fe69b080e",
        "before_after_code_files": [
          "ext/zlib/zlib.c||ext/zlib/zlib.c",
          "version.h||version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.h||version.h"
          ],
          "candidate": [
            "version.h||version.h"
          ]
        }
      },
      "candidate_diff": {
        "ext/zlib/zlib.c||ext/zlib/zlib.c": [
          "File: ext/zlib/zlib.c -> ext/zlib/zlib.c"
        ],
        "version.h||version.h": [
          "File: version.h -> version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: #define RUBY_VERSION \"2.1.7\"",
          "2: #define RUBY_RELEASE_DATE \"2015-07-07\"",
          "5: #define RUBY_RELEASE_YEAR 2015",
          "6: #define RUBY_RELEASE_MONTH 7",
          "",
          "[Removed Lines]",
          "3: #define RUBY_PATCHLEVEL 378",
          "",
          "[Added Lines]",
          "3: #define RUBY_PATCHLEVEL 379",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "c7edfc37fff5a1b6636e6582a882419cc32942c9",
      "candidate_info": {
        "commit_hash": "c7edfc37fff5a1b6636e6582a882419cc32942c9",
        "repo": "ruby/ruby",
        "commit_url": "https://github.com/ruby/ruby/commit/c7edfc37fff5a1b6636e6582a882419cc32942c9",
        "files": [
          "ChangeLog",
          "version.h",
          "win32/win32.c"
        ],
        "message": "merge revision(s) r48690: [Backport #10563]\n\n\t* win32/win32.c (w32_spawn): `v2` is used not only for `shell` but also\n\t  `cmd`, so must not free before using `cmd`.\n\t  [ruby-core:66648] [Bug #10563]\n\n\ngit-svn-id: svn+ssh://ci.ruby-lang.org/ruby/branches/ruby_2_1@49997 b2dd03c8-39d4-4d8f-98ff-823fe69b080e",
        "before_after_code_files": [
          "version.h||version.h",
          "win32/win32.c||win32/win32.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.h||version.h"
          ],
          "candidate": [
            "version.h||version.h"
          ]
        }
      },
      "candidate_diff": {
        "version.h||version.h": [
          "File: version.h -> version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: #define RUBY_VERSION \"2.1.5\"",
          "2: #define RUBY_RELEASE_DATE \"2015-03-18\"",
          "5: #define RUBY_RELEASE_YEAR 2015",
          "6: #define RUBY_RELEASE_MONTH 3",
          "",
          "[Removed Lines]",
          "3: #define RUBY_PATCHLEVEL 318",
          "",
          "[Added Lines]",
          "3: #define RUBY_PATCHLEVEL 319",
          "",
          "---------------"
        ],
        "win32/win32.c||win32/win32.c": [
          "File: win32/win32.c -> win32/win32.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1320:     }",
          "1322:     if (!e && shell && !(wshell = mbstr_to_wstr(cp, shell, -1, NULL))) e = E2BIG;",
          "1324:     if (cmd_sep) *cmd_sep = sep;",
          "1325:     if (!e && cmd && !(wcmd = mbstr_to_wstr(cp, cmd, -1, NULL))) e = E2BIG;",
          "1326:     if (v) ALLOCV_END(v);",
          "1328:     if (!e) {",
          "",
          "[Removed Lines]",
          "1323:     if (v2) ALLOCV_END(v2);",
          "",
          "[Added Lines]",
          "1325:     if (v2) ALLOCV_END(v2);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "67ec7b5391a61985580db0abbae86f595a86d0d9",
      "candidate_info": {
        "commit_hash": "67ec7b5391a61985580db0abbae86f595a86d0d9",
        "repo": "ruby/ruby",
        "commit_url": "https://github.com/ruby/ruby/commit/67ec7b5391a61985580db0abbae86f595a86d0d9",
        "files": [
          "ChangeLog",
          "insns.def",
          "test/ruby/test_iseq.rb",
          "test/ruby/test_optimization.rb",
          "version.h"
        ],
        "message": "merge revision(s) 52928: [Backport #11784]\n\n\t* insns.def (opt_case_dispatch): check Float#=== redefinition\n\n\t* test/ruby/test_optimization.rb (test_opt_case_dispatch): new\n\t  [ruby-core:71920] [Bug #11784]\n\n\ngit-svn-id: svn+ssh://ci.ruby-lang.org/ruby/branches/ruby_2_1@53145 b2dd03c8-39d4-4d8f-98ff-823fe69b080e",
        "before_after_code_files": [
          "insns.def||insns.def",
          "test/ruby/test_iseq.rb||test/ruby/test_iseq.rb",
          "test/ruby/test_optimization.rb||test/ruby/test_optimization.rb",
          "version.h||version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.h||version.h"
          ],
          "candidate": [
            "version.h||version.h"
          ]
        }
      },
      "candidate_diff": {
        "insns.def||insns.def": [
          "File: insns.def -> insns.def",
          "--- Hunk 1 ---",
          "[Context before]",
          "1286:  if (BASIC_OP_UNREDEFINED_P(BOP_EQQ,",
          "1287:        SYMBOL_REDEFINED_OP_FLAG |",
          "1288:        FIXNUM_REDEFINED_OP_FLAG |",
          "1289:        BIGNUM_REDEFINED_OP_FLAG |",
          "1290:        STRING_REDEFINED_OP_FLAG)) {",
          "1291:      st_data_t val;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1289:        FLOAT_REDEFINED_OP_FLAG |",
          "",
          "---------------"
        ],
        "test/ruby/test_iseq.rb||test/ruby/test_iseq.rb": [
          "File: test/ruby/test_iseq.rb -> test/ruby/test_iseq.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "52:     assert_raise_with_message(TypeError, /:foobar/) {RubyVM::InstructionSequence.load(ary)}",
          "53:   end if defined?(RubyVM::InstructionSequence.load)",
          "55:   def test_disasm_encoding",
          "56:     src = \"\\u{3042} = 1; \\u{3042}\"",
          "57:     enc, Encoding.default_internal = Encoding.default_internal, src.encoding",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "55:   def test_loaded_cdhash_mark",
          "56:     iseq = RubyVM::InstructionSequence.compile(<<-'end;', __FILE__, __FILE__, __LINE__+1)",
          "57:       def bug(kw)",
          "58:         case kw",
          "59:         when \"false\" then false",
          "60:         when \"true\"  then true",
          "61:         when \"nil\"   then nil",
          "62:         else raise(\"unhandled argument: #{kw.inspect}\")",
          "63:         end",
          "64:       end",
          "65:     end;",
          "66:     assert_separately([], <<-\"end;\")",
          "67:       iseq = #{iseq.to_a.inspect}",
          "68:       RubyVM::InstructionSequence.load(iseq).eval",
          "69:       assert_equal(false, bug(\"false\"))",
          "70:       GC.start",
          "71:       assert_equal(false, bug(\"false\"))",
          "72:     end;",
          "73:   end if defined?(RubyVM::InstructionSequence.load)",
          "",
          "---------------"
        ],
        "test/ruby/test_optimization.rb||test/ruby/test_optimization.rb": [
          "File: test/ruby/test_optimization.rb -> test/ruby/test_optimization.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: require 'test/unit'",
          "3: class TestRubyOptimization < Test::Unit::TestCase",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2: require_relative 'envutil'",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "200:     EOF",
          "201:     assert_equal(123, delay { 123 }.call, bug6901)",
          "202:   end",
          "203: end",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "205:   def test_opt_case_dispatch",
          "206:     code = <<-EOF",
          "207:       case foo",
          "208:       when \"foo\" then :foo",
          "209:       when :sym then :sym",
          "210:       when 6 then :fix",
          "211:       when 0.1 then :float",
          "212:       when 0xffffffffffffffff then :big",
          "213:       else",
          "214:         :nomatch",
          "215:       end",
          "216:     EOF",
          "217:     check = {",
          "218:       'foo' => :foo,",
          "219:       :sym => :sym,",
          "220:       6 => :fix,",
          "221:       0.1 => :float,",
          "222:       0xffffffffffffffff => :big,",
          "223:     }",
          "224:     iseq = RubyVM::InstructionSequence.compile(code)",
          "225:     assert_match %r{\\bopt_case_dispatch\\b}, iseq.disasm",
          "226:     check.each do |foo, expect|",
          "227:       assert_equal expect, eval(\"foo = #{foo.inspect}\\n#{code}\")",
          "228:     end",
          "229:     assert_equal :nomatch, eval(\"foo = :blah\\n#{code}\")",
          "230:     check.each do |foo, _|",
          "231:       klass = foo.class.to_s",
          "232:       assert_separately([], <<-\"end;\") # do",
          "233:         class #{klass}",
          "234:           undef ===",
          "235:           def ===(*args)",
          "236:             false",
          "237:           end",
          "238:         end",
          "239:         foo = #{foo.inspect}",
          "240:         ret = #{code}",
          "241:         assert_equal :nomatch, ret, foo.inspect",
          "242:       end;",
          "243:     end",
          "244:   end",
          "",
          "---------------"
        ],
        "version.h||version.h": [
          "File: version.h -> version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: #define RUBY_VERSION \"2.1.8\"",
          "5: #define RUBY_RELEASE_YEAR 2015",
          "6: #define RUBY_RELEASE_MONTH 12",
          "9: #include \"ruby/version.h\"",
          "",
          "[Removed Lines]",
          "2: #define RUBY_RELEASE_DATE \"2015-12-08\"",
          "3: #define RUBY_PATCHLEVEL 434",
          "7: #define RUBY_RELEASE_DAY 8",
          "",
          "[Added Lines]",
          "2: #define RUBY_RELEASE_DATE \"2015-12-16\"",
          "3: #define RUBY_PATCHLEVEL 435",
          "7: #define RUBY_RELEASE_DAY 16",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "bdf81a66cf3d0781bdf87802e4f8a6d9fed4ade9",
      "candidate_info": {
        "commit_hash": "bdf81a66cf3d0781bdf87802e4f8a6d9fed4ade9",
        "repo": "ruby/ruby",
        "commit_url": "https://github.com/ruby/ruby/commit/bdf81a66cf3d0781bdf87802e4f8a6d9fed4ade9",
        "files": [
          "ChangeLog",
          "ext/-test-/printf/printf.c",
          "version.h"
        ],
        "message": "merge revision(s) 50305: [Backport #11065]\n\n\t* ext/-test-/printf/printf.c (uint_to_str): renamed to get rid of\n\t  conflict on cygwin.  [ruby-core:68877] [Bug #11065]\n\n\ngit-svn-id: svn+ssh://ci.ruby-lang.org/ruby/branches/ruby_2_1@50577 b2dd03c8-39d4-4d8f-98ff-823fe69b080e",
        "before_after_code_files": [
          "ext/-test-/printf/printf.c||ext/-test-/printf/printf.c",
          "version.h||version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.h||version.h"
          ],
          "candidate": [
            "version.h||version.h"
          ]
        }
      },
      "candidate_diff": {
        "ext/-test-/printf/printf.c||ext/-test-/printf/printf.c": [
          "File: ext/-test-/printf/printf.c -> ext/-test-/printf/printf.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "28: }",
          "30: static char *",
          "32: {",
          "33:     char *e0 = e;",
          "34:     if (e <= p) return p;",
          "",
          "[Removed Lines]",
          "31: utoa(char *p, char *e, unsigned int x)",
          "",
          "[Added Lines]",
          "31: uint_to_str(char *p, char *e, unsigned int x)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "80:  }",
          "81:  if (!NIL_P(v = rb_hash_aref(opt, ID2SYM(rb_intern(\"width\"))))) {",
          "83:  }",
          "84:  if (!NIL_P(v = rb_hash_aref(opt, ID2SYM(rb_intern(\"prec\"))))) {",
          "86:      if (FIXNUM_P(v))",
          "88:  }",
          "89:     }",
          "",
          "[Removed Lines]",
          "82:      p = utoa(p, format + sizeof(format), NUM2UINT(v));",
          "87:   p = utoa(p, format + sizeof(format), NUM2UINT(v));",
          "",
          "[Added Lines]",
          "82:      p = uint_to_str(p, format + sizeof(format), NUM2UINT(v));",
          "87:   p = uint_to_str(p, format + sizeof(format), NUM2UINT(v));",
          "",
          "---------------"
        ],
        "version.h||version.h": [
          "File: version.h -> version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: #define RUBY_VERSION \"2.1.7\"",
          "2: #define RUBY_RELEASE_DATE \"2015-05-21\"",
          "5: #define RUBY_RELEASE_YEAR 2015",
          "6: #define RUBY_RELEASE_MONTH 5",
          "",
          "[Removed Lines]",
          "3: #define RUBY_PATCHLEVEL 350",
          "",
          "[Added Lines]",
          "3: #define RUBY_PATCHLEVEL 351",
          "",
          "---------------"
        ]
      }
    }
  ]
}