{
  "cve_id": "CVE-2017-3730",
  "cve_desc": "In OpenSSL 1.1.0 before 1.1.0d, if a malicious server supplies bad parameters for a DHE or ECDHE key exchange then this can result in the client attempting to dereference a NULL pointer leading to a client crash. This could be exploited in a Denial of Service attack.",
  "repo": "openssl/openssl",
  "patch_hash": "efbe126e3ebb9123ac9d058aa2bb044261342aaa",
  "patch_info": {
    "commit_hash": "efbe126e3ebb9123ac9d058aa2bb044261342aaa",
    "repo": "openssl/openssl",
    "commit_url": "https://github.com/openssl/openssl/commit/efbe126e3ebb9123ac9d058aa2bb044261342aaa",
    "files": [
      "ssl/statem/statem_clnt.c"
    ],
    "message": "Fix missing NULL checks in CKE processing\n\nReviewed-by: Rich Salz <rsalz@openssl.org>",
    "before_after_code_files": [
      "ssl/statem/statem_clnt.c||ssl/statem/statem_clnt.c"
    ]
  },
  "patch_diff": {
    "ssl/statem/statem_clnt.c||ssl/statem/statem_clnt.c": [
      "File: ssl/statem/statem_clnt.c -> ssl/statem/statem_clnt.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "2258:         return 0;",
      "2259:     }",
      "2260:     ckey = ssl_generate_pkey(skey);",
      "2261:     dh_clnt = EVP_PKEY_get0_DH(ckey);",
      "2263:     if (dh_clnt == NULL || ssl_derive(s, ckey, skey) == 0) {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "2261:     if (ckey == NULL) {",
      "2262:         SSLerr(SSL_F_TLS_CONSTRUCT_CKE_DHE, ERR_R_INTERNAL_ERROR);",
      "2263:         return 0;",
      "2264:     }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "2296:     }",
      "2298:     ckey = ssl_generate_pkey(skey);",
      "2300:     if (ssl_derive(s, ckey, skey) == 0) {",
      "2301:         SSLerr(SSL_F_TLS_CONSTRUCT_CKE_ECDHE, ERR_R_EVP_LIB);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "2304:     if (ckey == NULL) {",
      "2305:         SSLerr(SSL_F_TLS_CONSTRUCT_CKE_ECDHE, ERR_R_INTERNAL_ERROR);",
      "2306:         goto err;",
      "2307:     }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "15ef80b5b12ddd1b9496ca6e1bbae78b2dfdda98",
      "candidate_info": {
        "commit_hash": "15ef80b5b12ddd1b9496ca6e1bbae78b2dfdda98",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/15ef80b5b12ddd1b9496ca6e1bbae78b2dfdda98",
        "files": [
          "crypto/x509/x_name.c"
        ],
        "message": "Fix X509_NAME decode for malloc failures.\n\nThe original X509_NAME decode free code was buggy: this\ncould result in double free or leaks if a malloc failure\noccurred.\n\nSimplify and fix the logic.\n\nThanks to Guido Vranken for reporting this issue.\n\nReviewed-by: Matt Caswell <matt@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/1691)\n(cherry picked from commit 6dcba070a94b1ead92f3e327cf207a0b7db6596f)",
        "before_after_code_files": [
          "crypto/x509/x_name.c||crypto/x509/x_name.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "crypto/x509/x_name.c||crypto/x509/x_name.c": [
          "File: crypto/x509/x_name.c -> crypto/x509/x_name.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "126: }",
          "128: static int x509_name_ex_d2i(ASN1_VALUE **val,",
          "129:                             const unsigned char **in, long len,",
          "130:                             const ASN1_ITEM *it, int tag, int aclass,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "128: static void name_entry_stack_free(STACK_OF(X509_NAME_ENTRY) *ents)",
          "129: {",
          "130:     sk_X509_NAME_ENTRY_pop_free(ents, X509_NAME_ENTRY_free);",
          "131: }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "173:         for (j = 0; j < sk_X509_NAME_ENTRY_num(entries); j++) {",
          "174:             entry = sk_X509_NAME_ENTRY_value(entries, j);",
          "175:             entry->set = i;",
          "182:                 goto err;",
          "189:         }",
          "192:     }",
          "195:     intname.s = NULL;",
          "196:     ret = x509_name_canon(nm.x);",
          "197:     if (!ret)",
          "",
          "[Removed Lines]",
          "176:             if (!sk_X509_NAME_ENTRY_push(nm.x->entries, entry)) {",
          "181:                 sk_X509_NAME_ENTRY_pop_free(entries, X509_NAME_ENTRY_free);",
          "183:             }",
          "188:             sk_X509_NAME_ENTRY_set(entries, j, NULL);",
          "190:         sk_X509_NAME_ENTRY_free(entries);",
          "191:         sk_STACK_OF_X509_NAME_ENTRY_set(intname.s, i, NULL);",
          "194:     sk_STACK_OF_X509_NAME_ENTRY_free(intname.s);",
          "",
          "[Added Lines]",
          "181:             if (!sk_X509_NAME_ENTRY_push(nm.x->entries, entry))",
          "190:     sk_STACK_OF_X509_NAME_ENTRY_pop_free(intname.s, sk_X509_NAME_ENTRY_free);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "202:     return ret;",
          "204:  err:",
          "205:     X509_NAME_free(nm.x);",
          "207:     ASN1err(ASN1_F_X509_NAME_EX_D2I, ERR_R_NESTED_ASN1_ERROR);",
          "208:     return 0;",
          "209: }",
          "",
          "[Removed Lines]",
          "206:     sk_STACK_OF_X509_NAME_ENTRY_pop_free(intname.s, sk_X509_NAME_ENTRY_free);",
          "",
          "[Added Lines]",
          "205:     if (intname.s != NULL) {",
          "206:         sk_X509_NAME_ENTRY_zero(nm.x->entries);",
          "207:         sk_STACK_OF_X509_NAME_ENTRY_pop_free(intname.s, name_entry_stack_free);",
          "208:     }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "f5c1ee58c1cc246dc2f0b9b50f40c659fc302ad0",
      "candidate_info": {
        "commit_hash": "f5c1ee58c1cc246dc2f0b9b50f40c659fc302ad0",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/f5c1ee58c1cc246dc2f0b9b50f40c659fc302ad0",
        "files": [
          "include/openssl/x509v3.h"
        ],
        "message": "Document what EXFLAG_SET is for in x509v3.h\n\nReviewed-by: Kurt Roeckx <kurt@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/2314)\n(cherry picked from commit 2d60c923141e7853c268364f26195343a5e995bf)",
        "before_after_code_files": [
          "include/openssl/x509v3.h||include/openssl/x509v3.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "include/openssl/x509v3.h||include/openssl/x509v3.h": [
          "File: include/openssl/x509v3.h -> include/openssl/x509v3.h"
        ]
      }
    },
    {
      "candidate_hash": "ac2c44c6289f9716de4c4beeb284a818eacde517",
      "candidate_info": {
        "commit_hash": "ac2c44c6289f9716de4c4beeb284a818eacde517",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/ac2c44c6289f9716de4c4beeb284a818eacde517",
        "files": [
          "CHANGES",
          "NEWS",
          "README",
          "include/openssl/opensslv.h"
        ],
        "message": "Prepare for 1.1.0a release\n\nReviewed-by: Richard Levitte <levitte@openssl.org>",
        "before_after_code_files": [
          "include/openssl/opensslv.h||include/openssl/opensslv.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "include/openssl/opensslv.h||include/openssl/opensslv.h": [
          "File: include/openssl/opensslv.h -> include/openssl/opensslv.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "43: # ifdef OPENSSL_FIPS",
          "45: # else",
          "47: # endif",
          "",
          "[Removed Lines]",
          "42: # define OPENSSL_VERSION_NUMBER  0x10100010L",
          "44: #  define OPENSSL_VERSION_TEXT    \"OpenSSL 1.1.0a-fips-dev  xx XXX xxxx\"",
          "46: #  define OPENSSL_VERSION_TEXT    \"OpenSSL 1.1.0a-dev  xx XXX xxxx\"",
          "",
          "[Added Lines]",
          "42: # define OPENSSL_VERSION_NUMBER  0x1010001fL",
          "44: #  define OPENSSL_VERSION_TEXT    \"OpenSSL 1.1.0a-fips  22 Sep 2016\"",
          "46: #  define OPENSSL_VERSION_TEXT    \"OpenSSL 1.1.0a  22 Sep 2016\"",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "3c55aec6e9f68ec45162e85434d2911fa67e8f15",
      "candidate_info": {
        "commit_hash": "3c55aec6e9f68ec45162e85434d2911fa67e8f15",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/3c55aec6e9f68ec45162e85434d2911fa67e8f15",
        "files": [
          "crypto/bn/bn_intern.c"
        ],
        "message": "Don't call memcpy with NULL as source\n\nCalling it with lenght 0 and NULL as source is undefined behaviour.\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\nGH: #2089\n(cherry picked from commit eeab356c298248108b82157ef51172ba040646f7)",
        "before_after_code_files": [
          "crypto/bn/bn_intern.c||crypto/bn/bn_intern.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "crypto/bn/bn_intern.c||crypto/bn/bn_intern.c": [
          "File: crypto/bn/bn_intern.c -> crypto/bn/bn_intern.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "167:         return 0;",
          "169:     memset(out, 0, sizeof(*out) * size);",
          "171:     return 1;",
          "172: }",
          "",
          "[Removed Lines]",
          "170:     memcpy(out, in->d, sizeof(*out) * in->top);",
          "",
          "[Added Lines]",
          "170:     if (in->d != NULL)",
          "171:         memcpy(out, in->d, sizeof(*out) * in->top);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "fd7138ddeed4b577c1a37cc58fef6e715753698d",
      "candidate_info": {
        "commit_hash": "fd7138ddeed4b577c1a37cc58fef6e715753698d",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/fd7138ddeed4b577c1a37cc58fef6e715753698d",
        "files": [
          "crypto/ct/ct_locl.h",
          "include/openssl/ct.h"
        ],
        "message": "Reword documentation for {SCT_CTX/CT_POLICY_EVAL_CTX}_set_time\n\nDo not call the time \"current\", as a different time can be provided.\nFor example, a time slightly in the future, to provide tolerance for\nCT logs with a clock that is running fast.\n\nReviewed-by: Viktor Dukhovni <viktor@openssl.org>\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/1554)\n(cherry picked from commit 1871a5aa8a538c2b8ac3d302c1e9e72867f5ee0f)",
        "before_after_code_files": [
          "crypto/ct/ct_locl.h||crypto/ct/ct_locl.h",
          "include/openssl/ct.h||include/openssl/ct.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "crypto/ct/ct_locl.h||crypto/ct/ct_locl.h": [
          "File: crypto/ct/ct_locl.h -> crypto/ct/ct_locl.h"
        ],
        "include/openssl/ct.h||include/openssl/ct.h": [
          "File: include/openssl/ct.h -> include/openssl/ct.h"
        ]
      }
    }
  ]
}