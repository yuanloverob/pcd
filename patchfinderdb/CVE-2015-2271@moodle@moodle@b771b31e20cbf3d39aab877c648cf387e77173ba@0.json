{
  "cve_id": "CVE-2015-2271",
  "cve_desc": "tag/user.php in Moodle through 2.5.9, 2.6.x before 2.6.9, 2.7.x before 2.7.6, and 2.8.x before 2.8.4 does not consider the moodle/tag:flag capability before proceeding with a flaginappropriate action, which allows remote authenticated users to bypass intended access restrictions via the \"Flag as inappropriate\" feature.",
  "repo": "moodle/moodle",
  "patch_hash": "b771b31e20cbf3d39aab877c648cf387e77173ba",
  "patch_info": {
    "commit_hash": "b771b31e20cbf3d39aab877c648cf387e77173ba",
    "repo": "moodle/moodle",
    "commit_url": "https://github.com/moodle/moodle/commit/b771b31e20cbf3d39aab877c648cf387e77173ba",
    "files": [
      "tag/user.php"
    ],
    "message": "MDL-49084 core_tag: add capability check to flag as inappropriate action",
    "before_after_code_files": [
      "tag/user.php||tag/user.php"
    ]
  },
  "patch_diff": {
    "tag/user.php||tag/user.php": [
      "File: tag/user.php -> tag/user.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "45:         break;",
      "47:     case 'flaginappropriate':",
      "49:         $tagid = tag_get_id($tag);",
      "51:         tag_set_flag($tagid);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "48:         require_capability('moodle/tag:flag', context_system::instance());",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "8b4e370840dad1ec4ca6c7cef8a4d6b78e0458b7",
      "candidate_info": {
        "commit_hash": "8b4e370840dad1ec4ca6c7cef8a4d6b78e0458b7",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/8b4e370840dad1ec4ca6c7cef8a4d6b78e0458b7",
        "files": [
          "tag/user.php"
        ],
        "message": "MDL-49084 core_tag: add capability check to flag as inappropriate action",
        "before_after_code_files": [
          "tag/user.php||tag/user.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tag/user.php||tag/user.php"
          ],
          "candidate": [
            "tag/user.php||tag/user.php"
          ]
        }
      },
      "candidate_diff": {
        "tag/user.php||tag/user.php": [
          "File: tag/user.php -> tag/user.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "44:         break;",
          "46:     case 'flaginappropriate':",
          "48:         $tagid = tag_get_id($tag);",
          "50:         add_to_log(SITEID, 'tag', 'flag', 'index.php?id='. $tagid, $tagid, '', $USER->id);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "47:         require_capability('moodle/tag:flag', context_system::instance());",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "64e2179478849ec09c3537716e70ae8a1684b58b",
      "candidate_info": {
        "commit_hash": "64e2179478849ec09c3537716e70ae8a1684b58b",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/64e2179478849ec09c3537716e70ae8a1684b58b",
        "files": [
          "tag/user.php"
        ],
        "message": "MDL-49084 core_tag: add capability check to flag as inappropriate action",
        "before_after_code_files": [
          "tag/user.php||tag/user.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tag/user.php||tag/user.php"
          ],
          "candidate": [
            "tag/user.php||tag/user.php"
          ]
        }
      },
      "candidate_diff": {
        "tag/user.php||tag/user.php": [
          "File: tag/user.php -> tag/user.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "45:         break;",
          "47:     case 'flaginappropriate':",
          "49:         $tagid = tag_get_id($tag);",
          "51:         tag_set_flag($tagid);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "48:         require_capability('moodle/tag:flag', context_system::instance());",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "1a344ea46f4bdedf6b8c87ae9a419e0617e1ac27",
      "candidate_info": {
        "commit_hash": "1a344ea46f4bdedf6b8c87ae9a419e0617e1ac27",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/1a344ea46f4bdedf6b8c87ae9a419e0617e1ac27",
        "files": [
          "tag/user.php"
        ],
        "message": "MDL-49084 core_tag: add capability check to flag as inappropriate action",
        "before_after_code_files": [
          "tag/user.php||tag/user.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tag/user.php||tag/user.php"
          ],
          "candidate": [
            "tag/user.php||tag/user.php"
          ]
        }
      },
      "candidate_diff": {
        "tag/user.php||tag/user.php": [
          "File: tag/user.php -> tag/user.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "45:         break;",
          "47:     case 'flaginappropriate':",
          "49:         $tagid = tag_get_id($tag);",
          "51:         tag_set_flag($tagid);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "48:         require_capability('moodle/tag:flag', context_system::instance());",
          "",
          "---------------"
        ]
      }
    }
  ]
}