{
  "cve_id": "CVE-2018-7334",
  "cve_desc": "In Wireshark 2.4.0 to 2.4.4 and 2.2.0 to 2.2.12, the UMTS MAC dissector could crash. This was addressed in epan/dissectors/packet-umts_mac.c by rejecting a certain reserved value.",
  "repo": "wireshark/wireshark",
  "patch_hash": "9dfd17b104fd048aa07ab2ae5b87bfd94b07c807",
  "patch_info": {
    "commit_hash": "9dfd17b104fd048aa07ab2ae5b87bfd94b07c807",
    "repo": "wireshark/wireshark",
    "commit_url": "https://github.com/wireshark/wireshark/commit/9dfd17b104fd048aa07ab2ae5b87bfd94b07c807",
    "files": [
      "epan/dissectors/packet-umts_mac.c"
    ],
    "message": "UMTS MAC: protect against an out of bounds access\n\nBug: 14339\nChange-Id: Idd145b00218fb37c0c193df5af2f89a9503a036e\nReviewed-on: https://code.wireshark.org/review/25297\nPetri-Dish: Pascal Quantin <pascal.quantin@gmail.com>\nTested-by: Petri Dish Buildbot\nReviewed-by: Pascal Quantin <pascal.quantin@gmail.com>",
    "before_after_code_files": [
      "epan/dissectors/packet-umts_mac.c||epan/dissectors/packet-umts_mac.c"
    ]
  },
  "patch_diff": {
    "epan/dissectors/packet-umts_mac.c||epan/dissectors/packet-umts_mac.c": [
      "File: epan/dissectors/packet-umts_mac.c -> epan/dissectors/packet-umts_mac.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "94: static expert_field ei_mac_macis_sdu_middle = EI_INIT;",
      "95: static expert_field ei_mac_macis_sdu_last = EI_INIT;",
      "96: static expert_field ei_mac_macis_sdu_complete = EI_INIT;",
      "99: static dissector_handle_t rlc_pcch_handle;",
      "100: static dissector_handle_t rlc_ccch_handle;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "97: static expert_field ei_mac_reserved_c_t = EI_INIT;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "406:         case TCTF_DCCH_DTCH_RACH_FDD:",
      "408:             c_t = tvb_get_bits8(tvb,bitoffs-4,4);",
      "409:             rlcinf->mode[chan] = lchId_rlc_map[c_t+1];",
      "410:             macinf->content[chan] = lchId_type_table[c_t+1];",
      "411:             rlcinf->rbid[chan] = c_t+1;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "409:             if (c_t == 15) {",
      "411:                 expert_add_info(pinfo, NULL, &ei_mac_reserved_c_t);",
      "412:                 break;",
      "413:             }",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "501:             c_t = tvb_get_bits8(tvb,bitoffs-4,4);",
      "502:             rlcinf->mode[fpinf->cur_tb] = lchId_rlc_map[c_t+1];",
      "503:             macinf->content[fpinf->cur_tb] = lchId_type_table[c_t+1];",
      "504:             switch (macinf->content[fpinf->cur_tb]) {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "507:             if (c_t == 15) {",
      "509:                 expert_add_info(pinfo, NULL, &ei_mac_reserved_c_t);",
      "510:                 break;",
      "511:             }",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "1545:         { &ei_mac_macis_sdu_middle, { \"mac.macis_sdu.middle\", PI_REASSEMBLE, PI_CHAT, \"This MAC-is SDU is a middle segment of a MAC-d PDU or MAC-c PDU\", EXPFILL }},",
      "1546:         { &ei_mac_macis_sdu_last, { \"mac.macis_sdu.last\", PI_REASSEMBLE, PI_CHAT, \"This MAC-is SDU is the last segment of a MAC-d PDU or MAC-c PDU\", EXPFILL }},",
      "1547:         { &ei_mac_macis_sdu_complete, { \"mac.macis_sdu.complete\", PI_REASSEMBLE, PI_CHAT, \"This MAC-is SDU is a complete MAC-d PDU or MAC-c PDU\", EXPFILL }},",
      "1548:     };",
      "1550:     expert_module_t* expert_umts_mac;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1558:         { &ei_mac_reserved_c_t, { \"mac.reserved_ct\", PI_PROTOCOL, PI_WARN, \"C/T has a reserved value, PDU is discarded\", EXPFILL }}",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "8ed705e1227d3d582e3f0de435bba606d053d686",
      "candidate_info": {
        "commit_hash": "8ed705e1227d3d582e3f0de435bba606d053d686",
        "repo": "wireshark/wireshark",
        "commit_url": "https://github.com/wireshark/wireshark/commit/8ed705e1227d3d582e3f0de435bba606d053d686",
        "files": [
          "epan/dissectors/packet-umts_mac.c"
        ],
        "message": "UMTS MAC: protect against an out of bounds access\n\nBug: 14339\nChange-Id: Idd145b00218fb37c0c193df5af2f89a9503a036e\nReviewed-on: https://code.wireshark.org/review/25297\nPetri-Dish: Pascal Quantin <pascal.quantin@gmail.com>\nTested-by: Petri Dish Buildbot\nReviewed-by: Pascal Quantin <pascal.quantin@gmail.com>\n(cherry picked from commit 9dfd17b104fd048aa07ab2ae5b87bfd94b07c807)\nReviewed-on: https://code.wireshark.org/review/25303",
        "before_after_code_files": [
          "epan/dissectors/packet-umts_mac.c||epan/dissectors/packet-umts_mac.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "epan/dissectors/packet-umts_mac.c||epan/dissectors/packet-umts_mac.c"
          ],
          "candidate": [
            "epan/dissectors/packet-umts_mac.c||epan/dissectors/packet-umts_mac.c"
          ]
        }
      },
      "candidate_diff": {
        "epan/dissectors/packet-umts_mac.c||epan/dissectors/packet-umts_mac.c": [
          "File: epan/dissectors/packet-umts_mac.c -> epan/dissectors/packet-umts_mac.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "91: static expert_field ei_mac_macis_sdu_middle = EI_INIT;",
          "92: static expert_field ei_mac_macis_sdu_last = EI_INIT;",
          "93: static expert_field ei_mac_macis_sdu_complete = EI_INIT;",
          "96: static dissector_handle_t rlc_pcch_handle;",
          "97: static dissector_handle_t rlc_ccch_handle;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "94: static expert_field ei_mac_reserved_c_t = EI_INIT;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "333:         case TCTF_DCCH_DTCH_RACH_FDD:",
          "335:             c_t = tvb_get_bits8(tvb,bitoffs-4,4);",
          "336:             rlcinf->mode[chan] = lchId_rlc_map[c_t+1];",
          "337:             macinf->content[chan] = lchId_type_table[c_t+1];",
          "338:             rlcinf->rbid[chan] = c_t+1;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "336:             if (c_t == 15) {",
          "338:                 expert_add_info(pinfo, NULL, &ei_mac_reserved_c_t);",
          "339:                 break;",
          "340:             }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "428:             c_t = tvb_get_bits8(tvb,bitoffs-4,4);",
          "429:             rlcinf->mode[fpinf->cur_tb] = lchId_rlc_map[c_t+1];",
          "430:             macinf->content[fpinf->cur_tb] = lchId_type_table[c_t+1];",
          "431:             switch (macinf->content[fpinf->cur_tb]) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "434:             if (c_t == 15) {",
          "436:                 expert_add_info(pinfo, NULL, &ei_mac_reserved_c_t);",
          "437:                 break;",
          "438:             }",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1459:         { &ei_mac_macis_sdu_middle, { \"mac.macis_sdu.middle\", PI_REASSEMBLE, PI_CHAT, \"This MAC-is SDU is a middle segment of a MAC-d PDU or MAC-c PDU\", EXPFILL }},",
          "1460:         { &ei_mac_macis_sdu_last, { \"mac.macis_sdu.last\", PI_REASSEMBLE, PI_CHAT, \"This MAC-is SDU is the last segment of a MAC-d PDU or MAC-c PDU\", EXPFILL }},",
          "1461:         { &ei_mac_macis_sdu_complete, { \"mac.macis_sdu.complete\", PI_REASSEMBLE, PI_CHAT, \"This MAC-is SDU is a complete MAC-d PDU or MAC-c PDU\", EXPFILL }},",
          "1462:     };",
          "1464:     expert_module_t* expert_umts_mac;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1472:         { &ei_mac_reserved_c_t, { \"mac.reserved_ct\", PI_PROTOCOL, PI_WARN, \"C/T has a reserved value, PDU is discarded\", EXPFILL }}",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "8d4398752e49b33407da29f423b636afb72cce72",
      "candidate_info": {
        "commit_hash": "8d4398752e49b33407da29f423b636afb72cce72",
        "repo": "wireshark/wireshark",
        "commit_url": "https://github.com/wireshark/wireshark/commit/8d4398752e49b33407da29f423b636afb72cce72",
        "files": [
          "epan/dissectors/packet-umts_mac.c"
        ],
        "message": "UMTS MAC: protect against an out of bounds access\n\nBug: 14339\nChange-Id: Idd145b00218fb37c0c193df5af2f89a9503a036e\nReviewed-on: https://code.wireshark.org/review/25297\nPetri-Dish: Pascal Quantin <pascal.quantin@gmail.com>\nTested-by: Petri Dish Buildbot\nReviewed-by: Pascal Quantin <pascal.quantin@gmail.com>\n(cherry picked from commit 9dfd17b104fd048aa07ab2ae5b87bfd94b07c807)\nReviewed-on: https://code.wireshark.org/review/25302\nReviewed-by: Michael Mann <mmann78@netscape.net>",
        "before_after_code_files": [
          "epan/dissectors/packet-umts_mac.c||epan/dissectors/packet-umts_mac.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "epan/dissectors/packet-umts_mac.c||epan/dissectors/packet-umts_mac.c"
          ],
          "candidate": [
            "epan/dissectors/packet-umts_mac.c||epan/dissectors/packet-umts_mac.c"
          ]
        }
      },
      "candidate_diff": {
        "epan/dissectors/packet-umts_mac.c||epan/dissectors/packet-umts_mac.c": [
          "File: epan/dissectors/packet-umts_mac.c -> epan/dissectors/packet-umts_mac.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "94: static expert_field ei_mac_macis_sdu_middle = EI_INIT;",
          "95: static expert_field ei_mac_macis_sdu_last = EI_INIT;",
          "96: static expert_field ei_mac_macis_sdu_complete = EI_INIT;",
          "99: static dissector_handle_t rlc_pcch_handle;",
          "100: static dissector_handle_t rlc_ccch_handle;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "97: static expert_field ei_mac_reserved_c_t = EI_INIT;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "397:         case TCTF_DCCH_DTCH_RACH_FDD:",
          "399:             c_t = tvb_get_bits8(tvb,bitoffs-4,4);",
          "400:             rlcinf->mode[chan] = lchId_rlc_map[c_t+1];",
          "401:             macinf->content[chan] = lchId_type_table[c_t+1];",
          "402:             rlcinf->rbid[chan] = c_t+1;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "400:             if (c_t == 15) {",
          "402:                 expert_add_info(pinfo, NULL, &ei_mac_reserved_c_t);",
          "403:                 break;",
          "404:             }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "492:             c_t = tvb_get_bits8(tvb,bitoffs-4,4);",
          "493:             rlcinf->mode[fpinf->cur_tb] = lchId_rlc_map[c_t+1];",
          "494:             macinf->content[fpinf->cur_tb] = lchId_type_table[c_t+1];",
          "495:             switch (macinf->content[fpinf->cur_tb]) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "498:             if (c_t == 15) {",
          "500:                 expert_add_info(pinfo, NULL, &ei_mac_reserved_c_t);",
          "501:                 break;",
          "502:             }",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1536:         { &ei_mac_macis_sdu_middle, { \"mac.macis_sdu.middle\", PI_REASSEMBLE, PI_CHAT, \"This MAC-is SDU is a middle segment of a MAC-d PDU or MAC-c PDU\", EXPFILL }},",
          "1537:         { &ei_mac_macis_sdu_last, { \"mac.macis_sdu.last\", PI_REASSEMBLE, PI_CHAT, \"This MAC-is SDU is the last segment of a MAC-d PDU or MAC-c PDU\", EXPFILL }},",
          "1538:         { &ei_mac_macis_sdu_complete, { \"mac.macis_sdu.complete\", PI_REASSEMBLE, PI_CHAT, \"This MAC-is SDU is a complete MAC-d PDU or MAC-c PDU\", EXPFILL }},",
          "1539:     };",
          "1541:     expert_module_t* expert_umts_mac;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1549:         { &ei_mac_reserved_c_t, { \"mac.reserved_ct\", PI_PROTOCOL, PI_WARN, \"C/T has a reserved value, PDU is discarded\", EXPFILL }}",
          "",
          "---------------"
        ]
      }
    }
  ]
}