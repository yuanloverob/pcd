{
  "cve_id": "CVE-2013-1833",
  "cve_desc": "Multiple cross-site scripting (XSS) vulnerabilities in the File Picker module in Moodle 2.x through 2.1.10, 2.2.x before 2.2.8, 2.3.x before 2.3.5, and 2.4.x before 2.4.2 allow remote authenticated users to inject arbitrary web script or HTML via a crafted filename.",
  "repo": "moodle/moodle",
  "patch_hash": "954b35451112c333c0ae77dff25dafbf41587c26",
  "patch_info": {
    "commit_hash": "954b35451112c333c0ae77dff25dafbf41587c26",
    "repo": "moodle/moodle",
    "commit_url": "https://github.com/moodle/moodle/commit/954b35451112c333c0ae77dff25dafbf41587c26",
    "files": [
      "lib/form/filemanager.js",
      "lib/outputrequirementslib.php",
      "repository/filepicker.js",
      "repository/filepicker.php"
    ],
    "message": "MDL-37507 repositories: improved formatting of external resources",
    "before_after_code_files": [
      "lib/form/filemanager.js||lib/form/filemanager.js",
      "lib/outputrequirementslib.php||lib/outputrequirementslib.php",
      "repository/filepicker.js||repository/filepicker.js",
      "repository/filepicker.php||repository/filepicker.php"
    ]
  },
  "patch_diff": {
    "lib/form/filemanager.js||lib/form/filemanager.js": [
      "File: lib/form/filemanager.js -> lib/form/filemanager.js",
      "--- Hunk 1 ---",
      "[Context before]",
      "255:             this.msg_dlg.set('headerContent', header);",
      "256:             this.msg_dlg_node.removeClass('fp-msg-info').removeClass('fp-msg-error').addClass('fp-msg-'+type)",
      "258:             this.msg_dlg.show();",
      "259:         },",
      "260:         is_disabled: function() {",
      "",
      "[Removed Lines]",
      "257:             this.msg_dlg_node.one('.fp-msg-text').setContent(msg);",
      "",
      "[Added Lines]",
      "257:             this.msg_dlg_node.one('.fp-msg-text').setContent(Y.Escape.html(msg));",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "325:                     }",
      "326:                     this.mkdir_dialog.show();",
      "327:                     Y.one('#fm-newname-'+scope.client_id).focus();",
      "329:                 }, this);",
      "330:             } else {",
      "331:                 this.filemanager.addClass('fm-nomkdir');",
      "",
      "[Removed Lines]",
      "328:                     Y.all('#fm-curpath-'+scope.client_id).setContent(this.currentpath)",
      "",
      "[Added Lines]",
      "328:                     Y.all('#fm-curpath-'+scope.client_id).setContent(Y.Escape.html(this.currentpath))",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "412:                     } else {",
      "413:                         el.addClass('odd');",
      "414:                     }",
      "416:                         on('click', function(e, path) {",
      "417:                             e.preventDefault();",
      "418:                             if (!this.is_disabled()) {",
      "",
      "[Removed Lines]",
      "415:                     el.one('.fp-path-folder-name').setContent(p[i].name).",
      "",
      "[Added Lines]",
      "415:                     el.one('.fp-path-folder-name').setContent(Y.Escape.html(p[i].name)).",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "602:             for (var i in licenses) {",
      "603:                 var option = Y.Node.create('<option/>').",
      "604:                     set('value', licenses[i].shortname).",
      "606:                 node.appendChild(option)",
      "607:             }",
      "608:         },",
      "",
      "[Removed Lines]",
      "605:                     setContent(licenses[i].fullname);",
      "",
      "[Added Lines]",
      "605:                     setContent(Y.Escape.html(licenses[i].fullname));",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "621:             node.setContent('');",
      "622:             for (var i in list) {",
      "623:                 node.appendChild(Y.Node.create('<option/>').",
      "625:             }",
      "626:         },",
      "627:         update_file: function(confirmed) {",
      "",
      "[Removed Lines]",
      "624:                     set('value', list[i]).setContent(list[i]))",
      "",
      "[Added Lines]",
      "624:                     set('value', list[i]).setContent(Y.Escape.html(list[i])));",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "923:                 if (selectnode.one('.fp-'+attrs[i])) {",
      "924:                     var value = (node[attrs[i]+'_f']) ? node[attrs[i]+'_f'] : (node[attrs[i]] ? node[attrs[i]] : '');",
      "925:                     selectnode.one('.fp-'+attrs[i]).addClassIf('fp-unknown', ''+value == '')",
      "927:                 }",
      "928:             }",
      "",
      "[Removed Lines]",
      "926:                         .one('.fp-value').setContent(value);",
      "",
      "[Added Lines]",
      "926:                         .one('.fp-value').setContent(Y.Escape.html(value));",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "948:                             selectnode.one('.fp-original').removeClass('fp-loading');",
      "949:                             if (obj.original) {",
      "950:                                 node.original = obj.original;",
      "952:                             } else {",
      "953:                                 selectnode.one('.fp-original .fp-value').setContent(M.str.repository.unknownsource);",
      "954:                             }",
      "",
      "[Removed Lines]",
      "951:                                 selectnode.one('.fp-original .fp-value').setContent(node.original);",
      "",
      "[Added Lines]",
      "951:                                 selectnode.one('.fp-original .fp-value').setContent(Y.Escape.html(node.original));",
      "",
      "---------------",
      "--- Hunk 8 ---",
      "[Context before]",
      "976:                                 for (var i in obj.references) {",
      "977:                                     node.reflist += '<li>'+obj.references[i]+'</li>';",
      "978:                                 }",
      "980:                             } else {",
      "981:                                 selectnode.one('.fp-reflist .fp-value').setContent('');",
      "982:                             }",
      "",
      "[Removed Lines]",
      "979:                                 selectnode.one('.fp-reflist .fp-value').setContent(node.reflist);",
      "",
      "[Added Lines]",
      "979:                                 selectnode.one('.fp-reflist .fp-value').setContent(Y.Escape.html(node.reflist));",
      "",
      "---------------"
    ],
    "lib/outputrequirementslib.php||lib/outputrequirementslib.php": [
      "File: lib/outputrequirementslib.php -> lib/outputrequirementslib.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "395:                 case 'core_filepicker':",
      "396:                     $module = array('name'     => 'core_filepicker',",
      "397:                                     'fullpath' => '/repository/filepicker.js',",
      "399:                                     'strings'  => array(array('lastmodified', 'moodle'), array('name', 'moodle'), array('type', 'repository'), array('size', 'repository'),",
      "400:                                                         array('invalidjson', 'repository'), array('error', 'moodle'), array('info', 'moodle'),",
      "401:                                                         array('nofilesattached', 'repository'), array('filepicker', 'repository'), array('logout', 'repository'),",
      "",
      "[Removed Lines]",
      "398:                                     'requires' => array('base', 'node', 'node-event-simulate', 'json', 'async-queue', 'io-base', 'io-upload-iframe', 'io-form', 'yui2-treeview', 'panel', 'cookie', 'datatable', 'datatable-sort', 'resize-plugin', 'dd-plugin', 'moodle-core_filepicker'),",
      "",
      "[Added Lines]",
      "398:                                     'requires' => array('base', 'node', 'node-event-simulate', 'json', 'async-queue', 'io-base', 'io-upload-iframe', 'io-form', 'yui2-treeview', 'panel', 'cookie', 'datatable', 'datatable-sort', 'resize-plugin', 'dd-plugin', 'escape', 'moodle-core_filepicker'),",
      "",
      "---------------"
    ],
    "repository/filepicker.js||repository/filepicker.js": [
      "File: repository/filepicker.js -> repository/filepicker.js",
      "--- Hunk 1 ---",
      "[Context before]",
      "176:         var file_get_filename = function(node) {",
      "177:             return node.title ? node.title : node.fullname;",
      "180:         var file_get_displayname = function(node) {",
      "184:         var file_get_description = function(node) {",
      "188:         var build_tree = function(node, level) {",
      "",
      "[Removed Lines]",
      "178:         }",
      "181:             return node.shorttitle ? node.shorttitle : file_get_filename(node);",
      "182:         }",
      "185:             return node.description ? node.description : (node.thumbnail_title ? node.thumbnail_title : file_get_filename(node));",
      "186:         }",
      "",
      "[Added Lines]",
      "178:         };",
      "181:             var displayname = node.shorttitle ? node.shorttitle : file_get_filename(node);",
      "182:             return Y.Escape.html(displayname);",
      "183:         };",
      "186:             var description = '';",
      "187:             if (node.description) {",
      "188:                 description = node.description;",
      "189:             } else if (node.thumbnail_title) {",
      "190:                 description = node.thumbnail_title;",
      "191:             } else {",
      "192:                 description = file_get_filename(node);",
      "193:             }",
      "194:             return Y.Escape.html(description);",
      "195:         };",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "401:                 imgdiv.setStyleAdv('width', width).setStyleAdv('height', height);",
      "402:                 var img = Y.Node.create('<img/>').setAttrs({",
      "403:                         title: file_get_description(node),",
      "405:                     setStyle('maxWidth', ''+width+'px').",
      "406:                     setStyle('maxHeight', ''+height+'px');",
      "407:                 img.setImgSrc(src, node.realthumbnail, lazyloading);",
      "",
      "[Removed Lines]",
      "404:                         alt: node.thumbnail_alt ? node.thumbnail_alt : file_get_filename(node)}).",
      "",
      "[Added Lines]",
      "413:                         alt: Y.Escape.html(node.thumbnail_alt ? node.thumbnail_alt : file_get_filename(node))}).",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "738:             this.fpnode.one('.fp-content').setContent(M.core_filepicker.templates.error);",
      "739:             this.fpnode.one('.fp-content .fp-error').",
      "740:                 addClass(errorcode).",
      "742:         },",
      "744:         print_msg: function(msg, type) {",
      "",
      "[Removed Lines]",
      "741:                 setContent(errortext);",
      "",
      "[Added Lines]",
      "750:                 setContent(Y.Escape.html(errortext));",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "769:             this.msg_dlg.set('headerContent', header);",
      "770:             this.msg_dlg_node.removeClass('fp-msg-info').removeClass('fp-msg-error').addClass('fp-msg-'+type)",
      "772:             this.msg_dlg.show();",
      "773:         },",
      "774:         view_files: function(appenditems) {",
      "",
      "[Removed Lines]",
      "771:             this.msg_dlg_node.one('.fp-msg-text').setContent(msg);",
      "",
      "[Added Lines]",
      "780:             this.msg_dlg_node.one('.fp-msg-text').setContent(Y.Escape.html(msg));",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "1106:                 if (selectnode.one('.fp-'+attrs[i])) {",
      "1107:                     var value = (args[attrs[i]+'_f']) ? args[attrs[i]+'_f'] : (args[attrs[i]] ? args[attrs[i]] : '');",
      "1108:                     selectnode.one('.fp-'+attrs[i]).addClassIf('fp-unknown', ''+value == '')",
      "1110:                 }",
      "1111:             }",
      "1112:         },",
      "",
      "[Removed Lines]",
      "1109:                         .one('.fp-value').setContent(value);",
      "",
      "[Added Lines]",
      "1118:                         .one('.fp-value').setContent(Y.Escape.html(value));",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "1354:                             this.hide_header();",
      "1355:                             this.list({'repo_id':repository_id});",
      "1356:                         }, this /*handler running scope*/, repository.id/*second argument of handler*/);",
      "1358:                     node.one('.fp-repo-icon').set('src', repository.icon);",
      "1359:                     if (i==0) {",
      "1360:                         node.addClass('first');",
      "",
      "[Removed Lines]",
      "1357:                     node.one('.fp-repo-name').setContent(repository.name);",
      "",
      "[Added Lines]",
      "1366:                     node.one('.fp-repo-name').setContent(Y.Escape.html(repository.name));",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "1609:                 var option = Y.Node.create('<option/>').",
      "1610:                     set('selected', (this.options.defaultlicense==licenses[i].shortname)).",
      "1611:                     set('value', licenses[i].shortname).",
      "1613:                 node.appendChild(option)",
      "1614:             }",
      "1615:         },",
      "",
      "[Removed Lines]",
      "1612:                     setContent(licenses[i].fullname);",
      "",
      "[Added Lines]",
      "1621:                     setContent(Y.Escape.html(licenses[i].fullname));",
      "",
      "---------------",
      "--- Hunk 8 ---",
      "[Context before]",
      "1869:                     } else {",
      "1870:                         el.addClass('odd');",
      "1871:                     }",
      "1873:                     el.on('click',",
      "1874:                             function(e, path) {",
      "1875:                                 e.preventDefault();",
      "",
      "[Removed Lines]",
      "1872:                     el.all('.fp-path-folder-name').setContent(p[i].name);",
      "",
      "[Added Lines]",
      "1881:                     el.all('.fp-path-folder-name').setContent(Y.Escape.html(p[i].name));",
      "",
      "---------------"
    ],
    "repository/filepicker.php||repository/filepicker.php": [
      "File: repository/filepicker.php -> repository/filepicker.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "142:             if (isset($item['thumbnail_width'])) {",
      "143:                 $style .= 'max-width:'.$item['thumbnail_width'].'px;';",
      "144:             }",
      "146:             echo '</td><td>';",
      "147:             if (!empty($item['url'])) {",
      "149:             } else {",
      "151:             }",
      "152:             echo '</td>';",
      "153:             echo '<td>';",
      "",
      "[Removed Lines]",
      "145:             echo html_writer::empty_tag('img', array('src' => $item['thumbnail'], 'style' => $style));",
      "148:                 echo html_writer::link($item['url'], $item['title'], array('target'=>'_blank'));",
      "150:                 echo $item['title'];",
      "",
      "[Added Lines]",
      "145:             echo html_writer::empty_tag('img', array('src' => $item['thumbnail'], 'alt' => '', 'style' => $style));",
      "148:                 echo html_writer::link($item['url'], s($item['title']), array('target'=>'_blank'));",
      "150:                 echo s($item['title']);",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "204:                         'draftpath'=>$draftpath,",
      "205:                         'savepath'=>$savepath",
      "206:                         ));",
      "208:                     echo '<span> / </span>';",
      "209:                 }",
      "210:             }",
      "",
      "[Removed Lines]",
      "207:                     echo '<strong>' . html_writer::link($pathurl, $p['name']) . '</strong>';",
      "",
      "[Added Lines]",
      "207:                     echo '<strong>' . html_writer::link($pathurl, s($p['name'])) . '</strong>';",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "241:                 echo html_writer::empty_tag('img', array('src' => $item['thumbnail'], 'style' => $style));",
      "242:                 echo '</td><td>';",
      "243:                 if (!empty($item['url'])) {",
      "245:                 } else {",
      "247:                 }",
      "248:                 echo '</td>';",
      "249:                 echo '<td>';",
      "",
      "[Removed Lines]",
      "244:                     echo html_writer::link($item['url'], $item['title'], array('target'=>'_blank'));",
      "246:                     echo $item['title'];",
      "",
      "[Added Lines]",
      "244:                     echo html_writer::link($item['url'], s($item['title']), array('target'=>'_blank'));",
      "246:                     echo s($item['title']);",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "393:         $aurl->params(array('savepath'=>$savepath, 'action' => 'list', 'repo_id' => $info->id, 'draftpath'=>$draftpath));",
      "395:         echo '<li>';",
      "398:         echo '</li>';",
      "399:     }",
      "400:     echo '</ul>';",
      "",
      "[Removed Lines]",
      "396:         echo '<img src=\"'.$info->icon.'\" alt=\"'.$info->name.'\" width=\"16\" height=\"16\" /> ';",
      "397:         echo html_writer::link($aurl, $info->name);",
      "",
      "[Added Lines]",
      "396:         echo html_writer::empty_tag('img', array('src'=>$info->icon, 'alt'=>$info->name, 'class'=>'icon icon-pre'));",
      "397:         echo html_writer::link($aurl, s($info->name));",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "ca2a7956b2957d8495e154409694d205bb4ae3ef",
      "candidate_info": {
        "commit_hash": "ca2a7956b2957d8495e154409694d205bb4ae3ef",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/ca2a7956b2957d8495e154409694d205bb4ae3ef",
        "files": [
          "lib/form/filemanager.js",
          "lib/outputrequirementslib.php",
          "repository/filepicker.js",
          "repository/filepicker.php"
        ],
        "message": "MDL-37507 repositories: improved formatting of external resources",
        "before_after_code_files": [
          "lib/form/filemanager.js||lib/form/filemanager.js",
          "lib/outputrequirementslib.php||lib/outputrequirementslib.php",
          "repository/filepicker.js||repository/filepicker.js",
          "repository/filepicker.php||repository/filepicker.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_message": 1,
        "olp_code_files": {
          "patch": [
            "lib/form/filemanager.js||lib/form/filemanager.js",
            "lib/outputrequirementslib.php||lib/outputrequirementslib.php",
            "repository/filepicker.js||repository/filepicker.js",
            "repository/filepicker.php||repository/filepicker.php"
          ],
          "candidate": [
            "lib/form/filemanager.js||lib/form/filemanager.js",
            "lib/outputrequirementslib.php||lib/outputrequirementslib.php",
            "repository/filepicker.js||repository/filepicker.js",
            "repository/filepicker.php||repository/filepicker.php"
          ]
        }
      },
      "candidate_diff": {
        "lib/form/filemanager.js||lib/form/filemanager.js": [
          "File: lib/form/filemanager.js -> lib/form/filemanager.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "252:             this.msg_dlg.set('headerContent', header);",
          "253:             this.msg_dlg_node.removeClass('fp-msg-info').removeClass('fp-msg-error').addClass('fp-msg-'+type)",
          "255:             this.msg_dlg.show();",
          "256:         },",
          "257:         is_disabled: function() {",
          "",
          "[Removed Lines]",
          "254:             this.msg_dlg_node.one('.fp-msg-text').setContent(msg);",
          "",
          "[Added Lines]",
          "254:             this.msg_dlg_node.one('.fp-msg-text').setContent(Y.Escape.html(msg));",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "322:                     }",
          "323:                     this.mkdir_dialog.show();",
          "324:                     Y.one('#fm-newname-'+scope.client_id).focus();",
          "326:                 }, this);",
          "327:             } else {",
          "328:                 this.filemanager.addClass('fm-nomkdir');",
          "",
          "[Removed Lines]",
          "325:                     Y.all('#fm-curpath-'+scope.client_id).setContent(this.currentpath)",
          "",
          "[Added Lines]",
          "325:                     Y.all('#fm-curpath-'+scope.client_id).setContent(Y.Escape.html(this.currentpath))",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "409:                     } else {",
          "410:                         el.addClass('odd');",
          "411:                     }",
          "413:                         on('click', function(e, path) {",
          "414:                             e.preventDefault();",
          "415:                             if (!this.is_disabled()) {",
          "",
          "[Removed Lines]",
          "412:                     el.one('.fp-path-folder-name').setContent(p[i].name).",
          "",
          "[Added Lines]",
          "412:                     el.one('.fp-path-folder-name').setContent(Y.Escape.html(p[i].name)).",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "599:             for (var i in licenses) {",
          "600:                 var option = Y.Node.create('<option/>').",
          "601:                     set('value', licenses[i].shortname).",
          "603:                 node.appendChild(option)",
          "604:             }",
          "605:         },",
          "",
          "[Removed Lines]",
          "602:                     setContent(licenses[i].fullname);",
          "",
          "[Added Lines]",
          "602:                     setContent(Y.Escape.html(licenses[i].fullname));",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "618:             node.setContent('');",
          "619:             for (var i in list) {",
          "620:                 node.appendChild(Y.Node.create('<option/>').",
          "622:             }",
          "623:         },",
          "624:         update_file: function(confirmed) {",
          "",
          "[Removed Lines]",
          "621:                     set('value', list[i]).setContent(list[i]))",
          "",
          "[Added Lines]",
          "621:                     set('value', list[i]).setContent(Y.Escape.html(list[i])));",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "920:                 if (selectnode.one('.fp-'+attrs[i])) {",
          "921:                     var value = (node[attrs[i]+'_f']) ? node[attrs[i]+'_f'] : (node[attrs[i]] ? node[attrs[i]] : '');",
          "922:                     selectnode.one('.fp-'+attrs[i]).addClassIf('fp-unknown', ''+value == '')",
          "924:                 }",
          "925:             }",
          "",
          "[Removed Lines]",
          "923:                         .one('.fp-value').setContent(value);",
          "",
          "[Added Lines]",
          "923:                         .one('.fp-value').setContent(Y.Escape.html(value));",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "945:                             selectnode.one('.fp-original').removeClass('fp-loading');",
          "946:                             if (obj.original) {",
          "947:                                 node.original = obj.original;",
          "949:                             } else {",
          "950:                                 selectnode.one('.fp-original .fp-value').setContent(M.str.repository.unknownsource);",
          "951:                             }",
          "",
          "[Removed Lines]",
          "948:                                 selectnode.one('.fp-original .fp-value').setContent(node.original);",
          "",
          "[Added Lines]",
          "948:                                 selectnode.one('.fp-original .fp-value').setContent(Y.Escape.html(node.original));",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "973:                                 for (var i in obj.references) {",
          "974:                                     node.reflist += '<li>'+obj.references[i]+'</li>';",
          "975:                                 }",
          "977:                             } else {",
          "978:                                 selectnode.one('.fp-reflist .fp-value').setContent('');",
          "979:                             }",
          "",
          "[Removed Lines]",
          "976:                                 selectnode.one('.fp-reflist .fp-value').setContent(node.reflist);",
          "",
          "[Added Lines]",
          "976:                                 selectnode.one('.fp-reflist .fp-value').setContent(Y.Escape.html(node.reflist));",
          "",
          "---------------"
        ],
        "lib/outputrequirementslib.php||lib/outputrequirementslib.php": [
          "File: lib/outputrequirementslib.php -> lib/outputrequirementslib.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "450:                 case 'core_filepicker':",
          "451:                     $module = array('name'     => 'core_filepicker',",
          "452:                                     'fullpath' => '/repository/filepicker.js',",
          "454:                                     'strings'  => array(array('lastmodified', 'moodle'), array('name', 'moodle'), array('type', 'repository'), array('size', 'repository'),",
          "455:                                                         array('invalidjson', 'repository'), array('error', 'moodle'), array('info', 'moodle'),",
          "456:                                                         array('nofilesattached', 'repository'), array('filepicker', 'repository'), array('logout', 'repository'),",
          "",
          "[Removed Lines]",
          "453:                                     'requires' => array('base', 'node', 'node-event-simulate', 'json', 'async-queue', 'io-base', 'io-upload-iframe', 'io-form', 'yui2-treeview', 'panel', 'cookie', 'datatable', 'datatable-sort', 'resize-plugin', 'dd-plugin', 'moodle-core_filepicker'),",
          "",
          "[Added Lines]",
          "453:                                     'requires' => array('base', 'node', 'node-event-simulate', 'json', 'async-queue', 'io-base', 'io-upload-iframe', 'io-form', 'yui2-treeview', 'panel', 'cookie', 'datatable', 'datatable-sort', 'resize-plugin', 'dd-plugin', 'escape', 'moodle-core_filepicker'),",
          "",
          "---------------"
        ],
        "repository/filepicker.js||repository/filepicker.js": [
          "File: repository/filepicker.js -> repository/filepicker.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "176:         var file_get_filename = function(node) {",
          "177:             return node.title ? node.title : node.fullname;",
          "180:         var file_get_displayname = function(node) {",
          "184:         var file_get_description = function(node) {",
          "188:         var build_tree = function(node, level) {",
          "",
          "[Removed Lines]",
          "178:         }",
          "181:             return node.shorttitle ? node.shorttitle : file_get_filename(node);",
          "182:         }",
          "185:             return node.description ? node.description : (node.thumbnail_title ? node.thumbnail_title : file_get_filename(node));",
          "186:         }",
          "",
          "[Added Lines]",
          "178:         };",
          "181:             var displayname = node.shorttitle ? node.shorttitle : file_get_filename(node);",
          "182:             return Y.Escape.html(displayname);",
          "183:         };",
          "186:             var description = '';",
          "187:             if (node.description) {",
          "188:                 description = node.description;",
          "189:             } else if (node.thumbnail_title) {",
          "190:                 description = node.thumbnail_title;",
          "191:             } else {",
          "192:                 description = file_get_filename(node);",
          "193:             }",
          "194:             return Y.Escape.html(description);",
          "195:         };",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "401:                 imgdiv.setStyleAdv('width', width).setStyleAdv('height', height);",
          "402:                 var img = Y.Node.create('<img/>').setAttrs({",
          "403:                         title: file_get_description(node),",
          "405:                     setStyle('maxWidth', ''+width+'px').",
          "406:                     setStyle('maxHeight', ''+height+'px');",
          "407:                 img.setImgSrc(src, node.realthumbnail, lazyloading);",
          "",
          "[Removed Lines]",
          "404:                         alt: node.thumbnail_alt ? node.thumbnail_alt : file_get_filename(node)}).",
          "",
          "[Added Lines]",
          "413:                         alt: Y.Escape.html(node.thumbnail_alt ? node.thumbnail_alt : file_get_filename(node))}).",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "736:             this.fpnode.one('.fp-content').setContent(M.core_filepicker.templates.error);",
          "737:             this.fpnode.one('.fp-content .fp-error').",
          "738:                 addClass(errorcode).",
          "740:         },",
          "742:         print_msg: function(msg, type) {",
          "",
          "[Removed Lines]",
          "739:                 setContent(errortext);",
          "",
          "[Added Lines]",
          "748:                 setContent(Y.Escape.html(errortext));",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "767:             this.msg_dlg.set('headerContent', header);",
          "768:             this.msg_dlg_node.removeClass('fp-msg-info').removeClass('fp-msg-error').addClass('fp-msg-'+type)",
          "770:             this.msg_dlg.show();",
          "771:         },",
          "772:         view_files: function(appenditems) {",
          "",
          "[Removed Lines]",
          "769:             this.msg_dlg_node.one('.fp-msg-text').setContent(msg);",
          "",
          "[Added Lines]",
          "778:             this.msg_dlg_node.one('.fp-msg-text').setContent(Y.Escape.html(msg));",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1104:                 if (selectnode.one('.fp-'+attrs[i])) {",
          "1105:                     var value = (args[attrs[i]+'_f']) ? args[attrs[i]+'_f'] : (args[attrs[i]] ? args[attrs[i]] : '');",
          "1106:                     selectnode.one('.fp-'+attrs[i]).addClassIf('fp-unknown', ''+value == '')",
          "1108:                 }",
          "1109:             }",
          "1110:         },",
          "",
          "[Removed Lines]",
          "1107:                         .one('.fp-value').setContent(value);",
          "",
          "[Added Lines]",
          "1116:                         .one('.fp-value').setContent(Y.Escape.html(value));",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "1350:                             this.hide_header();",
          "1351:                             this.list({'repo_id':repository_id});",
          "1352:                         }, this /*handler running scope*/, repository.id/*second argument of handler*/);",
          "1354:                     node.one('.fp-repo-icon').set('src', repository.icon);",
          "1355:                     if (i==0) {",
          "1356:                         node.addClass('first');",
          "",
          "[Removed Lines]",
          "1353:                     node.one('.fp-repo-name').setContent(repository.name);",
          "",
          "[Added Lines]",
          "1362:                     node.one('.fp-repo-name').setContent(Y.Escape.html(repository.name));",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "1605:                 var option = Y.Node.create('<option/>').",
          "1606:                     set('selected', (this.options.defaultlicense==licenses[i].shortname)).",
          "1607:                     set('value', licenses[i].shortname).",
          "1609:                 node.appendChild(option)",
          "1610:             }",
          "1611:         },",
          "",
          "[Removed Lines]",
          "1608:                     setContent(licenses[i].fullname);",
          "",
          "[Added Lines]",
          "1617:                     setContent(Y.Escape.html(licenses[i].fullname));",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "1867:                     } else {",
          "1868:                         el.addClass('odd');",
          "1869:                     }",
          "1871:                     el.on('click',",
          "1872:                             function(e, path) {",
          "1873:                                 e.preventDefault();",
          "",
          "[Removed Lines]",
          "1870:                     el.all('.fp-path-folder-name').setContent(p[i].name);",
          "",
          "[Added Lines]",
          "1879:                     el.all('.fp-path-folder-name').setContent(Y.Escape.html(p[i].name));",
          "",
          "---------------"
        ],
        "repository/filepicker.php||repository/filepicker.php": [
          "File: repository/filepicker.php -> repository/filepicker.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "141:             if (isset($item['thumbnail_width'])) {",
          "142:                 $style .= 'max-width:'.$item['thumbnail_width'].'px;';",
          "143:             }",
          "145:             echo '</td><td>';",
          "146:             if (!empty($item['url'])) {",
          "148:             } else {",
          "150:             }",
          "151:             echo '</td>';",
          "152:             echo '<td>';",
          "",
          "[Removed Lines]",
          "144:             echo html_writer::empty_tag('img', array('src' => $item['thumbnail'], 'style' => $style));",
          "147:                 echo html_writer::link($item['url'], $item['title'], array('target'=>'_blank'));",
          "149:                 echo $item['title'];",
          "",
          "[Added Lines]",
          "144:             echo html_writer::empty_tag('img', array('src' => $item['thumbnail'], 'alt' => '', 'style' => $style));",
          "147:                 echo html_writer::link($item['url'], s($item['title']), array('target'=>'_blank'));",
          "149:                 echo s($item['title']);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "203:                         'draftpath'=>$draftpath,",
          "204:                         'savepath'=>$savepath",
          "205:                         ));",
          "207:                     echo '<span> / </span>';",
          "208:                 }",
          "209:             }",
          "",
          "[Removed Lines]",
          "206:                     echo '<strong>' . html_writer::link($pathurl, $p['name']) . '</strong>';",
          "",
          "[Added Lines]",
          "206:                     echo '<strong>' . html_writer::link($pathurl, s($p['name'])) . '</strong>';",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "240:                 echo html_writer::empty_tag('img', array('src' => $item['thumbnail'], 'style' => $style));",
          "241:                 echo '</td><td>';",
          "242:                 if (!empty($item['url'])) {",
          "244:                 } else {",
          "246:                 }",
          "247:                 echo '</td>';",
          "248:                 echo '<td>';",
          "",
          "[Removed Lines]",
          "243:                     echo html_writer::link($item['url'], $item['title'], array('target'=>'_blank'));",
          "245:                     echo $item['title'];",
          "",
          "[Added Lines]",
          "243:                     echo html_writer::link($item['url'], s($item['title']), array('target'=>'_blank'));",
          "245:                     echo s($item['title']);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "387:         $aurl->params(array('savepath'=>$savepath, 'action' => 'list', 'repo_id' => $info->id, 'draftpath'=>$draftpath));",
          "389:         echo '<li>';",
          "392:         echo '</li>';",
          "393:     }",
          "394:     echo '</ul>';",
          "",
          "[Removed Lines]",
          "390:         echo '<img src=\"'.$info->icon.'\" alt=\"'.$info->name.'\" width=\"16\" height=\"16\" /> ';",
          "391:         echo html_writer::link($aurl, $info->name);",
          "",
          "[Added Lines]",
          "390:         echo html_writer::empty_tag('img', array('src'=>$info->icon, 'alt'=>$info->name, 'class'=>'icon icon-pre'));",
          "391:         echo html_writer::link($aurl, s($info->name));",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "75822af579ec07cca1c6781a7c989625dcdd5463",
      "candidate_info": {
        "commit_hash": "75822af579ec07cca1c6781a7c989625dcdd5463",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/75822af579ec07cca1c6781a7c989625dcdd5463",
        "files": [
          "lib/form/filemanager.js",
          "lib/outputrequirementslib.php",
          "repository/filepicker.js",
          "repository/filepicker.php"
        ],
        "message": "MDL-37507 repositories: improved formatting of external resources",
        "before_after_code_files": [
          "lib/form/filemanager.js||lib/form/filemanager.js",
          "lib/outputrequirementslib.php||lib/outputrequirementslib.php",
          "repository/filepicker.js||repository/filepicker.js",
          "repository/filepicker.php||repository/filepicker.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_message": 1,
        "olp_code_files": {
          "patch": [
            "lib/form/filemanager.js||lib/form/filemanager.js",
            "lib/outputrequirementslib.php||lib/outputrequirementslib.php",
            "repository/filepicker.js||repository/filepicker.js",
            "repository/filepicker.php||repository/filepicker.php"
          ],
          "candidate": [
            "lib/form/filemanager.js||lib/form/filemanager.js",
            "lib/outputrequirementslib.php||lib/outputrequirementslib.php",
            "repository/filepicker.js||repository/filepicker.js",
            "repository/filepicker.php||repository/filepicker.php"
          ]
        }
      },
      "candidate_diff": {
        "lib/form/filemanager.js||lib/form/filemanager.js": [
          "File: lib/form/filemanager.js -> lib/form/filemanager.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "255:             this.msg_dlg.set('headerContent', header);",
          "256:             this.msg_dlg_node.removeClass('fp-msg-info').removeClass('fp-msg-error').addClass('fp-msg-'+type)",
          "258:             this.msg_dlg.show();",
          "259:         },",
          "260:         is_disabled: function() {",
          "",
          "[Removed Lines]",
          "257:             this.msg_dlg_node.one('.fp-msg-text').setContent(msg);",
          "",
          "[Added Lines]",
          "257:             this.msg_dlg_node.one('.fp-msg-text').setContent(Y.Escape.html(msg));",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "325:                     }",
          "326:                     this.mkdir_dialog.show();",
          "327:                     Y.one('#fm-newname-'+scope.client_id).focus();",
          "329:                 }, this);",
          "330:             } else {",
          "331:                 this.filemanager.addClass('fm-nomkdir');",
          "",
          "[Removed Lines]",
          "328:                     Y.all('#fm-curpath-'+scope.client_id).setContent(this.currentpath)",
          "",
          "[Added Lines]",
          "328:                     Y.all('#fm-curpath-'+scope.client_id).setContent(Y.Escape.html(this.currentpath))",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "412:                     } else {",
          "413:                         el.addClass('odd');",
          "414:                     }",
          "416:                         on('click', function(e, path) {",
          "417:                             e.preventDefault();",
          "418:                             if (!this.is_disabled()) {",
          "",
          "[Removed Lines]",
          "415:                     el.one('.fp-path-folder-name').setContent(p[i].name).",
          "",
          "[Added Lines]",
          "415:                     el.one('.fp-path-folder-name').setContent(Y.Escape.html(p[i].name)).",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "602:             for (var i in licenses) {",
          "603:                 var option = Y.Node.create('<option/>').",
          "604:                     set('value', licenses[i].shortname).",
          "606:                 node.appendChild(option)",
          "607:             }",
          "608:         },",
          "",
          "[Removed Lines]",
          "605:                     setContent(licenses[i].fullname);",
          "",
          "[Added Lines]",
          "605:                     setContent(Y.Escape.html(licenses[i].fullname));",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "621:             node.setContent('');",
          "622:             for (var i in list) {",
          "623:                 node.appendChild(Y.Node.create('<option/>').",
          "625:             }",
          "626:         },",
          "627:         update_file: function(confirmed) {",
          "",
          "[Removed Lines]",
          "624:                     set('value', list[i]).setContent(list[i]))",
          "",
          "[Added Lines]",
          "624:                     set('value', list[i]).setContent(Y.Escape.html(list[i])));",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "923:                 if (selectnode.one('.fp-'+attrs[i])) {",
          "924:                     var value = (node[attrs[i]+'_f']) ? node[attrs[i]+'_f'] : (node[attrs[i]] ? node[attrs[i]] : '');",
          "925:                     selectnode.one('.fp-'+attrs[i]).addClassIf('fp-unknown', ''+value == '')",
          "927:                 }",
          "928:             }",
          "",
          "[Removed Lines]",
          "926:                         .one('.fp-value').setContent(value);",
          "",
          "[Added Lines]",
          "926:                         .one('.fp-value').setContent(Y.Escape.html(value));",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "948:                             selectnode.one('.fp-original').removeClass('fp-loading');",
          "949:                             if (obj.original) {",
          "950:                                 node.original = obj.original;",
          "952:                             } else {",
          "953:                                 selectnode.one('.fp-original .fp-value').setContent(M.str.repository.unknownsource);",
          "954:                             }",
          "",
          "[Removed Lines]",
          "951:                                 selectnode.one('.fp-original .fp-value').setContent(node.original);",
          "",
          "[Added Lines]",
          "951:                                 selectnode.one('.fp-original .fp-value').setContent(Y.Escape.html(node.original));",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "976:                                 for (var i in obj.references) {",
          "977:                                     node.reflist += '<li>'+obj.references[i]+'</li>';",
          "978:                                 }",
          "980:                             } else {",
          "981:                                 selectnode.one('.fp-reflist .fp-value').setContent('');",
          "982:                             }",
          "",
          "[Removed Lines]",
          "979:                                 selectnode.one('.fp-reflist .fp-value').setContent(node.reflist);",
          "",
          "[Added Lines]",
          "979:                                 selectnode.one('.fp-reflist .fp-value').setContent(Y.Escape.html(node.reflist));",
          "",
          "---------------"
        ],
        "lib/outputrequirementslib.php||lib/outputrequirementslib.php": [
          "File: lib/outputrequirementslib.php -> lib/outputrequirementslib.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "377:                 case 'core_filepicker':",
          "378:                     $module = array('name'     => 'core_filepicker',",
          "379:                                     'fullpath' => '/repository/filepicker.js',",
          "381:                                     'strings'  => array(array('lastmodified', 'moodle'), array('name', 'moodle'), array('type', 'repository'), array('size', 'repository'),",
          "382:                                                         array('invalidjson', 'repository'), array('error', 'moodle'), array('info', 'moodle'),",
          "383:                                                         array('nofilesattached', 'repository'), array('filepicker', 'repository'), array('logout', 'repository'),",
          "",
          "[Removed Lines]",
          "380:                                     'requires' => array('base', 'node', 'node-event-simulate', 'json', 'async-queue', 'io-base', 'io-upload-iframe', 'io-form', 'yui2-treeview', 'panel', 'cookie', 'datatable', 'datatable-sort', 'resize-plugin', 'dd-plugin', 'moodle-core_filepicker'),",
          "",
          "[Added Lines]",
          "380:                                     'requires' => array('base', 'node', 'node-event-simulate', 'json', 'async-queue', 'io-base', 'io-upload-iframe', 'io-form', 'yui2-treeview', 'panel', 'cookie', 'datatable', 'datatable-sort', 'resize-plugin', 'dd-plugin', 'escape', 'moodle-core_filepicker'),",
          "",
          "---------------"
        ],
        "repository/filepicker.js||repository/filepicker.js": [
          "File: repository/filepicker.js -> repository/filepicker.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "176:         var file_get_filename = function(node) {",
          "177:             return node.title ? node.title : node.fullname;",
          "180:         var file_get_displayname = function(node) {",
          "184:         var file_get_description = function(node) {",
          "188:         var build_tree = function(node, level) {",
          "",
          "[Removed Lines]",
          "178:         }",
          "181:             return node.shorttitle ? node.shorttitle : file_get_filename(node);",
          "182:         }",
          "185:             return node.description ? node.description : (node.thumbnail_title ? node.thumbnail_title : file_get_filename(node));",
          "186:         }",
          "",
          "[Added Lines]",
          "178:         };",
          "181:             var displayname = node.shorttitle ? node.shorttitle : file_get_filename(node);",
          "182:             return Y.Escape.html(displayname);",
          "183:         };",
          "186:             var description = '';",
          "187:             if (node.description) {",
          "188:                 description = node.description;",
          "189:             } else if (node.thumbnail_title) {",
          "190:                 description = node.thumbnail_title;",
          "191:             } else {",
          "192:                 description = file_get_filename(node);",
          "193:             }",
          "194:             return Y.Escape.html(description);",
          "195:         };",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "401:                 imgdiv.setStyleAdv('width', width).setStyleAdv('height', height);",
          "402:                 var img = Y.Node.create('<img/>').setAttrs({",
          "403:                         title: file_get_description(node),",
          "405:                     setStyle('maxWidth', ''+width+'px').",
          "406:                     setStyle('maxHeight', ''+height+'px');",
          "407:                 img.setImgSrc(src, node.realthumbnail, lazyloading);",
          "",
          "[Removed Lines]",
          "404:                         alt: node.thumbnail_alt ? node.thumbnail_alt : file_get_filename(node)}).",
          "",
          "[Added Lines]",
          "413:                         alt: Y.Escape.html(node.thumbnail_alt ? node.thumbnail_alt : file_get_filename(node))}).",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "738:             this.fpnode.one('.fp-content').setContent(M.core_filepicker.templates.error);",
          "739:             this.fpnode.one('.fp-content .fp-error').",
          "740:                 addClass(errorcode).",
          "742:         },",
          "744:         print_msg: function(msg, type) {",
          "",
          "[Removed Lines]",
          "741:                 setContent(errortext);",
          "",
          "[Added Lines]",
          "750:                 setContent(Y.Escape.html(errortext));",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "769:             this.msg_dlg.set('headerContent', header);",
          "770:             this.msg_dlg_node.removeClass('fp-msg-info').removeClass('fp-msg-error').addClass('fp-msg-'+type)",
          "772:             this.msg_dlg.show();",
          "773:         },",
          "774:         view_files: function(appenditems) {",
          "",
          "[Removed Lines]",
          "771:             this.msg_dlg_node.one('.fp-msg-text').setContent(msg);",
          "",
          "[Added Lines]",
          "780:             this.msg_dlg_node.one('.fp-msg-text').setContent(Y.Escape.html(msg));",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1106:                 if (selectnode.one('.fp-'+attrs[i])) {",
          "1107:                     var value = (args[attrs[i]+'_f']) ? args[attrs[i]+'_f'] : (args[attrs[i]] ? args[attrs[i]] : '');",
          "1108:                     selectnode.one('.fp-'+attrs[i]).addClassIf('fp-unknown', ''+value == '')",
          "1110:                 }",
          "1111:             }",
          "1112:         },",
          "",
          "[Removed Lines]",
          "1109:                         .one('.fp-value').setContent(value);",
          "",
          "[Added Lines]",
          "1118:                         .one('.fp-value').setContent(Y.Escape.html(value));",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "1354:                             this.hide_header();",
          "1355:                             this.list({'repo_id':repository_id});",
          "1356:                         }, this /*handler running scope*/, repository.id/*second argument of handler*/);",
          "1358:                     node.one('.fp-repo-icon').set('src', repository.icon);",
          "1359:                     if (i==0) {",
          "1360:                         node.addClass('first');",
          "",
          "[Removed Lines]",
          "1357:                     node.one('.fp-repo-name').setContent(repository.name);",
          "",
          "[Added Lines]",
          "1366:                     node.one('.fp-repo-name').setContent(Y.Escape.html(repository.name));",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "1609:                 var option = Y.Node.create('<option/>').",
          "1610:                     set('selected', (this.options.defaultlicense==licenses[i].shortname)).",
          "1611:                     set('value', licenses[i].shortname).",
          "1613:                 node.appendChild(option)",
          "1614:             }",
          "1615:         },",
          "",
          "[Removed Lines]",
          "1612:                     setContent(licenses[i].fullname);",
          "",
          "[Added Lines]",
          "1621:                     setContent(Y.Escape.html(licenses[i].fullname));",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "1869:                     } else {",
          "1870:                         el.addClass('odd');",
          "1871:                     }",
          "1873:                     el.on('click',",
          "1874:                             function(e, path) {",
          "1875:                                 e.preventDefault();",
          "",
          "[Removed Lines]",
          "1872:                     el.all('.fp-path-folder-name').setContent(p[i].name);",
          "",
          "[Added Lines]",
          "1881:                     el.all('.fp-path-folder-name').setContent(Y.Escape.html(p[i].name));",
          "",
          "---------------"
        ],
        "repository/filepicker.php||repository/filepicker.php": [
          "File: repository/filepicker.php -> repository/filepicker.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "142:             if (isset($item['thumbnail_width'])) {",
          "143:                 $style .= 'max-width:'.$item['thumbnail_width'].'px;';",
          "144:             }",
          "146:             echo '</td><td>';",
          "147:             if (!empty($item['url'])) {",
          "149:             } else {",
          "151:             }",
          "152:             echo '</td>';",
          "153:             echo '<td>';",
          "",
          "[Removed Lines]",
          "145:             echo html_writer::empty_tag('img', array('src' => $item['thumbnail'], 'style' => $style));",
          "148:                 echo html_writer::link($item['url'], $item['title'], array('target'=>'_blank'));",
          "150:                 echo $item['title'];",
          "",
          "[Added Lines]",
          "145:             echo html_writer::empty_tag('img', array('src' => $item['thumbnail'], 'alt' => '', 'style' => $style));",
          "148:                 echo html_writer::link($item['url'], s($item['title']), array('target'=>'_blank'));",
          "150:                 echo s($item['title']);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "204:                         'draftpath'=>$draftpath,",
          "205:                         'savepath'=>$savepath",
          "206:                         ));",
          "208:                     echo '<span> / </span>';",
          "209:                 }",
          "210:             }",
          "",
          "[Removed Lines]",
          "207:                     echo '<strong>' . html_writer::link($pathurl, $p['name']) . '</strong>';",
          "",
          "[Added Lines]",
          "207:                     echo '<strong>' . html_writer::link($pathurl, s($p['name'])) . '</strong>';",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "241:                 echo html_writer::empty_tag('img', array('src' => $item['thumbnail'], 'style' => $style));",
          "242:                 echo '</td><td>';",
          "243:                 if (!empty($item['url'])) {",
          "245:                 } else {",
          "247:                 }",
          "248:                 echo '</td>';",
          "249:                 echo '<td>';",
          "",
          "[Removed Lines]",
          "244:                     echo html_writer::link($item['url'], $item['title'], array('target'=>'_blank'));",
          "246:                     echo $item['title'];",
          "",
          "[Added Lines]",
          "244:                     echo html_writer::link($item['url'], s($item['title']), array('target'=>'_blank'));",
          "246:                     echo s($item['title']);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "393:         $aurl->params(array('savepath'=>$savepath, 'action' => 'list', 'repo_id' => $info->id, 'draftpath'=>$draftpath));",
          "395:         echo '<li>';",
          "398:         echo '</li>';",
          "399:     }",
          "400:     echo '</ul>';",
          "",
          "[Removed Lines]",
          "396:         echo '<img src=\"'.$info->icon.'\" alt=\"'.$info->name.'\" width=\"16\" height=\"16\" /> ';",
          "397:         echo html_writer::link($aurl, $info->name);",
          "",
          "[Added Lines]",
          "396:         echo html_writer::empty_tag('img', array('src'=>$info->icon, 'alt'=>$info->name, 'class'=>'icon icon-pre'));",
          "397:         echo html_writer::link($aurl, s($info->name));",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "93e9ea9989ec6e91153d9651c9a4bc7dac1cf9ce",
      "candidate_info": {
        "commit_hash": "93e9ea9989ec6e91153d9651c9a4bc7dac1cf9ce",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/93e9ea9989ec6e91153d9651c9a4bc7dac1cf9ce",
        "files": [
          "lib/form/filemanager.js",
          "lib/outputrequirementslib.php",
          "repository/filepicker.js",
          "repository/filepicker.php"
        ],
        "message": "MDL-37507 repositories: improved formatting of external resources",
        "before_after_code_files": [
          "lib/form/filemanager.js||lib/form/filemanager.js",
          "lib/outputrequirementslib.php||lib/outputrequirementslib.php",
          "repository/filepicker.js||repository/filepicker.js",
          "repository/filepicker.php||repository/filepicker.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_message": 1,
        "olp_code_files": {
          "patch": [
            "lib/form/filemanager.js||lib/form/filemanager.js",
            "lib/outputrequirementslib.php||lib/outputrequirementslib.php",
            "repository/filepicker.js||repository/filepicker.js",
            "repository/filepicker.php||repository/filepicker.php"
          ],
          "candidate": [
            "lib/form/filemanager.js||lib/form/filemanager.js",
            "lib/outputrequirementslib.php||lib/outputrequirementslib.php",
            "repository/filepicker.js||repository/filepicker.js",
            "repository/filepicker.php||repository/filepicker.php"
          ]
        }
      },
      "candidate_diff": {
        "lib/form/filemanager.js||lib/form/filemanager.js": [
          "File: lib/form/filemanager.js -> lib/form/filemanager.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "287:                     var pathid  = 'fm-path-node-'+this.client_id;",
          "288:                     pathid += ('-'+count);",
          "291:                     breadcrumb.appendChild(arrow);",
          "292:                     breadcrumb.appendChild(crumb);",
          "",
          "[Removed Lines]",
          "290:                     var crumb = Y.Node.create('<a href=\"###\" id=\"'+pathid+'\">'+path[p].name+'</a>');",
          "",
          "[Added Lines]",
          "290:                     var crumb = Y.Node.create('<a href=\"###\" id=\"'+pathid+'\">'+Y.Escape.html(path[p].name)+'</a>');",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "399:                         }",
          "400:                     break;",
          "401:                 }",
          "404:                 if (list[i].sortorder == 1) {",
          "405:                     html = html.replace('___fullname___', '<strong><a title=\"'+fullname+'\" href=\"'+url+'\" id=\"'+fileid+'\"><img src=\"'+list[i].icon+'\" /> ' + fullname + '</a></strong>');",
          "",
          "[Removed Lines]",
          "402:                 var fullname = list[i].fullname;",
          "",
          "[Added Lines]",
          "402:                 var fullname = Y.Escape.html(list[i].fullname);",
          "",
          "---------------"
        ],
        "lib/outputrequirementslib.php||lib/outputrequirementslib.php": [
          "File: lib/outputrequirementslib.php -> lib/outputrequirementslib.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "402:                 case 'core_filepicker':",
          "403:                     $module = array('name'     => 'core_filepicker',",
          "404:                                     'fullpath' => '/repository/filepicker.js',",
          "406:                                     'strings'  => array(array('add', 'repository'), array('back', 'repository'), array('cancel', 'moodle'), array('close', 'repository'),",
          "407:                                                         array('cleancache', 'repository'), array('copying', 'repository'), array('date', 'repository'), array('downloadsucc', 'repository'),",
          "408:                                                         array('emptylist', 'repository'), array('error', 'repository'), array('federatedsearch', 'repository'),",
          "",
          "[Removed Lines]",
          "405:                                     'requires' => array('base', 'node', 'node-event-simulate', 'json', 'async-queue', 'io-base', 'io-upload-iframe', 'io-form', 'yui2-button', 'yui2-container', 'yui2-layout', 'yui2-menu', 'yui2-treeview', 'yui2-dragdrop', 'yui2-cookie'),",
          "",
          "[Added Lines]",
          "405:                                     'requires' => array('base', 'node', 'node-event-simulate', 'json', 'async-queue', 'io-base', 'io-upload-iframe', 'io-form', 'escape', 'yui2-button', 'yui2-container', 'yui2-layout', 'yui2-menu', 'yui2-treeview', 'yui2-dragdrop', 'yui2-cookie'),",
          "",
          "---------------"
        ],
        "repository/filepicker.js||repository/filepicker.js": [
          "File: repository/filepicker.js -> repository/filepicker.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "492:                     filename = node.shorttitle;",
          "493:                 }",
          "494:                 var filename_id = 'filname-link-'+client_id+'-'+String(count);",
          "498:                 if(node.thumbnail_width){",
          "",
          "[Removed Lines]",
          "495:                 title.innerHTML += '<a href=\"###\" id=\"'+filename_id+'\" title=\"'+node.title+'\"><span>'+filename+\"</span></a>\";",
          "",
          "[Added Lines]",
          "495:                 title.innerHTML += '<a href=\"###\" id=\"'+filename_id+'\" title=\"'+Y.Escape.html(node.title)+'\"><span>'+Y.Escape.html(filename)+\"</span></a>\";",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "508:                 }",
          "509:                 var img = document.createElement('img');",
          "510:                 img.src = node.thumbnail;",
          "512:                 if(node.thumbnail_alt) {",
          "514:                 }",
          "515:                 if(node.thumbnail_title) {",
          "517:                 }",
          "519:                 var link = document.createElement('A');",
          "",
          "[Removed Lines]",
          "511:                 img.title = node.title;",
          "513:                     img.alt = node.thumbnail_alt;",
          "516:                     img.title = node.thumbnail_title;",
          "",
          "[Added Lines]",
          "511:                 img.title = Y.Escape.html(node.title);",
          "513:                     img.alt = Y.Escape.html(node.thumbnail_alt);",
          "516:                     img.title = Y.Escape.html(node.thumbnail_title);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "584:             var panel = Y.one('#panel-'+client_id);",
          "585:             var form_id = 'fp-rename-form-'+client_id;",
          "586:             var html = '<div class=\"fp-rename-form\" id=\"'+form_id+'\">';",
          "588:             html += '<table width=\"100%\">';",
          "589:             html += '<tr><td class=\"mdl-right\"><label for=\"newname-'+client_id+'\">'+M.str.repository.saveas+':</label></td>';",
          "592:             var le_checked = '';",
          "593:             var le_style = '';",
          "",
          "[Removed Lines]",
          "587:             html += '<p><img src=\"'+args.thumbnail+'\" /></p>';",
          "590:             html += '<td class=\"mdl-left\"><input type=\"text\" id=\"newname-'+client_id+'\" value=\"'+args.title+'\" /></td></tr>';",
          "",
          "[Added Lines]",
          "587:             html += '<p><img src=\"'+args.thumbnail+'\" alt=\"\" /></p>';",
          "590:             html += '<td class=\"mdl-left\"><input type=\"text\" id=\"newname-'+client_id+'\" value=\"'+Y.Escape.html(args.title)+'\" /></td></tr>';",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "606:             if (!args.hasauthor) {",
          "608:                 html += '<tr><td class=\"mdl-right\"><label for=\"text-author\">'+M.str.repository.author+' :</label></td>';",
          "610:                 html += '</tr>';",
          "611:             }",
          "",
          "[Removed Lines]",
          "609:                 html += '<td class=\"mdl-left\"><input id=\"text-author-'+client_id+'\" type=\"text\" name=\"author\" value=\"'+this.options.author+'\" /></td>';",
          "",
          "[Added Lines]",
          "609:                 html += '<td class=\"mdl-left\"><input id=\"text-author-'+client_id+'\" type=\"text\" name=\"author\" value=\"'+Y.Escape.html(this.options.author)+'\" /></td>';",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "625:                     } else {",
          "626:                         var selected = '';",
          "627:                     }",
          "629:                 }",
          "630:                 html += '</select></td></tr>';",
          "631:             }",
          "",
          "[Removed Lines]",
          "628:                     html += '<option value=\"'+licenses[i].shortname+'\"'+selected+'>'+licenses[i].fullname+'</option>';",
          "",
          "[Added Lines]",
          "628:                     html += '<option value=\"'+licenses[i].shortname+'\"'+selected+'>'+Y.Escape.html(licenses[i].fullname)+'</option>';",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "1324:             }",
          "1326:             if(!r.norefresh) {",
          "1328:                 var refresh = Y.Node.create(html);",
          "1329:                 refresh.on('click', function() {",
          "1330:                     this.list();",
          "",
          "[Removed Lines]",
          "1327:                 var html = '<a href=\"###\"><img src=\"'+M.util.image_url('a/refresh')+'\" /> '+M.str.repository.refresh+'</a>';",
          "",
          "[Added Lines]",
          "1327:                 var html = '<a href=\"###\"><img src=\"'+M.util.image_url('a/refresh')+'\" alt=\"\" /> '+M.str.repository.refresh+'</a>';",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "1333:             }",
          "1334:             if(!r.nologin) {",
          "1335:                 var label = r.logouttext?r.logouttext:M.str.repository.logout;",
          "1337:                 var logout = Y.Node.create(html);",
          "1338:                 logout.on('click', function() {",
          "1339:                     this.request({",
          "",
          "[Removed Lines]",
          "1336:                 var html = '<a href=\"###\"><img src=\"'+M.util.image_url('a/logout')+'\" /> '+label+'</a>';",
          "",
          "[Added Lines]",
          "1336:                 var html = '<a href=\"###\"><img src=\"'+M.util.image_url('a/logout')+'\" alt=\"\" /> '+label+'</a>';",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "1357:                 var mgr = document.createElement('A');",
          "1358:                 mgr.href = r.manage;",
          "1359:                 mgr.target = \"_blank\";",
          "1361:                 toolbar.appendChild(mgr);",
          "1362:             }",
          "1363:             if(r.help) {",
          "1364:                 var help = document.createElement('A');",
          "1365:                 help.href = r.help;",
          "1366:                 help.target = \"_blank\";",
          "1368:                 toolbar.appendChild(help);",
          "1369:             }",
          "1370:             if(r.message) {",
          "",
          "[Removed Lines]",
          "1360:                 mgr.innerHTML = '<img src=\"'+M.util.image_url('a/setting')+'\" /> '+M.str.repository.manageurl;",
          "1367:                 help.innerHTML = '<img src=\"'+M.util.image_url('a/help')+'\" /> '+M.str.repository.help;",
          "",
          "[Added Lines]",
          "1360:                 mgr.innerHTML = '<img src=\"'+M.util.image_url('a/setting')+'\" alt=\"\" /> '+M.str.repository.manageurl;",
          "1367:                 help.innerHTML = '<img src=\"'+M.util.image_url('a/help')+'\" alt=\"\" /> '+M.str.repository.help;",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "1487:                     var link_path = p[i].path;",
          "1488:                     var link = document.createElement('A');",
          "1489:                     link.href = \"###\";",
          "1491:                     link.id = 'path-node-'+client_id+'-'+i;",
          "1492:                     var sep = Y.Node.create('<span>/</span>');",
          "1493:                     path.appendChild(link);",
          "",
          "[Removed Lines]",
          "1490:                     link.innerHTML = p[i].name;",
          "",
          "[Added Lines]",
          "1490:                     link.innerHTML = Y.Escape.html(p[i].name);",
          "",
          "---------------"
        ],
        "repository/filepicker.php||repository/filepicker.php": [
          "File: repository/filepicker.php -> repository/filepicker.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "136:         echo '<table>';",
          "137:         foreach ($search_result['list'] as $item) {",
          "138:             echo '<tr>';",
          "140:             echo '</td><td>';",
          "141:             if (!empty($item['url'])) {",
          "143:             } else {",
          "145:             }",
          "146:             echo '</td>';",
          "147:             echo '<td>';",
          "",
          "[Removed Lines]",
          "139:             echo '<td><img src=\"'.$item['thumbnail'].'\" />';",
          "142:                 echo html_writer::link($item['url'], $item['title'], array('target'=>'_blank'));",
          "144:                 echo $item['title'];",
          "",
          "[Added Lines]",
          "139:             echo '<td><img src=\"'.$item['thumbnail'].'\" alt=\"\" />';",
          "142:                 echo html_writer::link($item['url'], s($item['title']), array('target'=>'_blank'));",
          "144:                 echo s($item['title']);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "198:                         'draftpath'=>$draftpath,",
          "199:                         'savepath'=>$savepath",
          "200:                         ));",
          "202:                     echo '<span> / </span>';",
          "203:                 }",
          "204:             }",
          "",
          "[Removed Lines]",
          "201:                     echo '<strong>' . html_writer::link($pathurl, $p['name']) . '</strong>';",
          "",
          "[Added Lines]",
          "201:                     echo '<strong>' . html_writer::link($pathurl, s($p['name'])) . '</strong>';",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "227:                 echo '<td><img src=\"'.$item['thumbnail'].'\" />';",
          "228:                 echo '</td><td>';",
          "229:                 if (!empty($item['url'])) {",
          "231:                 } else {",
          "233:                 }",
          "234:                 echo '</td>';",
          "235:                 echo '<td>';",
          "",
          "[Removed Lines]",
          "230:                     echo html_writer::link($item['url'], $item['title'], array('target'=>'_blank'));",
          "232:                     echo $item['title'];",
          "",
          "[Added Lines]",
          "230:                     echo html_writer::link($item['url'], s($item['title']), array('target'=>'_blank'));",
          "232:                     echo s($item['title']);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "338:         $aurl->params(array('savepath'=>$savepath, 'action' => 'list', 'repo_id' => $info->id, 'draftpath'=>$draftpath));",
          "340:         echo '<li>';",
          "343:         echo '</li>';",
          "344:     }",
          "345:     echo '</ul>';",
          "",
          "[Removed Lines]",
          "341:         echo '<img src=\"'.$info->icon.'\" alt=\"'.$info->name.'\" width=\"16\" height=\"16\" /> ';",
          "342:         echo html_writer::link($aurl, $info->name);",
          "",
          "[Added Lines]",
          "341:         echo html_writer::empty_tag('img', array('src'=>$info->icon, 'alt'=>$info->name, 'class'=>'icon icon-pre'));",
          "342:         echo html_writer::link($aurl, s($info->name));",
          "",
          "---------------"
        ]
      }
    }
  ]
}