{
  "cve_id": "CVE-2021-45930",
  "cve_desc": "Qt SVG in Qt 5.0.0 through 5.15.2 and 6.0.0 through 6.2.1 has an out-of-bounds write in QtPrivate::QCommonArrayOps<QPainterPath::Element>::growAppend (called from QPainterPath::addPath and QPathClipper::intersect).",
  "repo": "qt/qtsvg",
  "patch_hash": "a3b753c2d077313fc9eb93af547051b956e383fc",
  "patch_info": {
    "commit_hash": "a3b753c2d077313fc9eb93af547051b956e383fc",
    "repo": "qt/qtsvg",
    "commit_url": "https://github.com/qt/qtsvg/commit/a3b753c2d077313fc9eb93af547051b956e383fc",
    "files": [
      "src/svg/qsvghandler.cpp"
    ],
    "message": "Do stricter error checking when parsing path nodes\n\nThe SVG spec mandates that path parsing should terminate on the first\nerror encountered, and an error be reported. To improve the handling\nof corrupt files, implement such error handling, and also limit the\nnumber of QPainterPath elements to a reasonable range.\n\nFixes: QTBUG-96044\nChange-Id: Ic5e65d6b658516d6f1317c72de365c8c7ad81891\nReviewed-by: Allan Sandfeld Jensen <allan.jensen@qt.io>\nReviewed-by: Robert L\u00f6hning <robert.loehning@qt.io>\n(cherry picked from commit 36cfd9efb9b22b891adee9c48d30202289cfa620)\nReviewed-by: Qt Cherry-pick Bot <cherrypick_bot@qt-project.org>",
    "before_after_code_files": [
      "src/svg/qsvghandler.cpp||src/svg/qsvghandler.cpp"
    ]
  },
  "patch_diff": {
    "src/svg/qsvghandler.cpp||src/svg/qsvghandler.cpp": [
      "File: src/svg/qsvghandler.cpp -> src/svg/qsvghandler.cpp",
      "--- Hunk 1 ---",
      "[Context before]",
      "1612: static bool parsePathDataFast(const QStringRef &dataStr, QPainterPath &path)",
      "1613: {",
      "1614:     qreal x0 = 0, y0 = 0;              // starting point",
      "1615:     qreal x = 0, y = 0;                // current point",
      "1616:     char lastMode = 0;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1614:     const int maxElementCount = 0x7fff; // Assume file corruption if more path elements than this",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "1618:     const QChar *str = dataStr.constData();",
      "1619:     const QChar *end = str + dataStr.size();",
      "1622:         while (str->isSpace() && (str + 1) != end)",
      "1623:             ++str;",
      "1624:         QChar pathElem = *str;",
      "",
      "[Removed Lines]",
      "1621:     while (str != end) {",
      "",
      "[Added Lines]",
      "1622:     bool ok = true;",
      "1623:     while (ok && str != end) {",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "1632:             arg.append(0);//dummy",
      "1633:         const qreal *num = arg.constData();",
      "1634:         int count = arg.count();",
      "1636:             qreal offsetX = x;        // correction offsets",
      "1637:             qreal offsetY = y;        // for relative commands",
      "1638:             switch (pathElem.unicode()) {",
      "1639:             case 'm': {",
      "1640:                 if (count < 2) {",
      "1643:                     break;",
      "1644:                 }",
      "1645:                 x = x0 = num[0] + offsetX;",
      "",
      "[Removed Lines]",
      "1635:         while (count > 0) {",
      "1641:                     num++;",
      "1642:                     count--;",
      "",
      "[Added Lines]",
      "1637:         while (ok && count > 0) {",
      "1643:                     ok = false;",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "1656:                 break;",
      "1657:             case 'M': {",
      "1658:                 if (count < 2) {",
      "1661:                     break;",
      "1662:                 }",
      "1663:                 x = x0 = num[0];",
      "",
      "[Removed Lines]",
      "1659:                     num++;",
      "1660:                     count--;",
      "",
      "[Added Lines]",
      "1660:                     ok = false;",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "1683:                 break;",
      "1684:             case 'l': {",
      "1685:                 if (count < 2) {",
      "1688:                     break;",
      "1689:                 }",
      "1690:                 x = num[0] + offsetX;",
      "",
      "[Removed Lines]",
      "1686:                     num++;",
      "1687:                     count--;",
      "",
      "[Added Lines]",
      "1686:                     ok = false;",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "1697:                 break;",
      "1698:             case 'L': {",
      "1699:                 if (count < 2) {",
      "1702:                     break;",
      "1703:                 }",
      "1704:                 x = num[0];",
      "",
      "[Removed Lines]",
      "1700:                     num++;",
      "1701:                     count--;",
      "",
      "[Added Lines]",
      "1699:                     ok = false;",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "1738:                 break;",
      "1739:             case 'c': {",
      "1740:                 if (count < 6) {",
      "1743:                     break;",
      "1744:                 }",
      "1745:                 QPointF c1(num[0] + offsetX, num[1] + offsetY);",
      "",
      "[Removed Lines]",
      "1741:                     num += count;",
      "1742:                     count = 0;",
      "",
      "[Added Lines]",
      "1739:                     ok = false;",
      "",
      "---------------",
      "--- Hunk 8 ---",
      "[Context before]",
      "1755:             }",
      "1756:             case 'C': {",
      "1757:                 if (count < 6) {",
      "1760:                     break;",
      "1761:                 }",
      "1762:                 QPointF c1(num[0], num[1]);",
      "",
      "[Removed Lines]",
      "1758:                     num += count;",
      "1759:                     count = 0;",
      "",
      "[Added Lines]",
      "1755:                     ok = false;",
      "",
      "---------------",
      "--- Hunk 9 ---",
      "[Context before]",
      "1772:             }",
      "1773:             case 's': {",
      "1774:                 if (count < 4) {",
      "1777:                     break;",
      "1778:                 }",
      "1779:                 QPointF c1;",
      "",
      "[Removed Lines]",
      "1775:                     num += count;",
      "1776:                     count = 0;",
      "",
      "[Added Lines]",
      "1771:                     ok = false;",
      "",
      "---------------",
      "--- Hunk 10 ---",
      "[Context before]",
      "1794:             }",
      "1795:             case 'S': {",
      "1796:                 if (count < 4) {",
      "1799:                     break;",
      "1800:                 }",
      "1801:                 QPointF c1;",
      "",
      "[Removed Lines]",
      "1797:                     num += count;",
      "1798:                     count = 0;",
      "",
      "[Added Lines]",
      "1792:                     ok = false;",
      "",
      "---------------",
      "--- Hunk 11 ---",
      "[Context before]",
      "1816:             }",
      "1817:             case 'q': {",
      "1818:                 if (count < 4) {",
      "1821:                     break;",
      "1822:                 }",
      "1823:                 QPointF c(num[0] + offsetX, num[1] + offsetY);",
      "",
      "[Removed Lines]",
      "1819:                     num += count;",
      "1820:                     count = 0;",
      "",
      "[Added Lines]",
      "1813:                     ok = false;",
      "",
      "---------------",
      "--- Hunk 12 ---",
      "[Context before]",
      "1832:             }",
      "1833:             case 'Q': {",
      "1834:                 if (count < 4) {",
      "1837:                     break;",
      "1838:                 }",
      "1839:                 QPointF c(num[0], num[1]);",
      "",
      "[Removed Lines]",
      "1835:                     num += count;",
      "1836:                     count = 0;",
      "",
      "[Added Lines]",
      "1828:                     ok = false;",
      "",
      "---------------",
      "--- Hunk 13 ---",
      "[Context before]",
      "1848:             }",
      "1849:             case 't': {",
      "1850:                 if (count < 2) {",
      "1853:                     break;",
      "1854:                 }",
      "1855:                 QPointF e(num[0] + offsetX, num[1] + offsetY);",
      "",
      "[Removed Lines]",
      "1851:                     num += count;",
      "1852:                     count = 0;",
      "",
      "[Added Lines]",
      "1843:                     ok = false;",
      "",
      "---------------",
      "--- Hunk 14 ---",
      "[Context before]",
      "1869:             }",
      "1870:             case 'T': {",
      "1871:                 if (count < 2) {",
      "1874:                     break;",
      "1875:                 }",
      "1876:                 QPointF e(num[0], num[1]);",
      "",
      "[Removed Lines]",
      "1872:                     num += count;",
      "1873:                     count = 0;",
      "",
      "[Added Lines]",
      "1863:                     ok = false;",
      "",
      "---------------",
      "--- Hunk 15 ---",
      "[Context before]",
      "1890:             }",
      "1891:             case 'a': {",
      "1892:                 if (count < 7) {",
      "1895:                     break;",
      "1896:                 }",
      "1897:                 qreal rx = (*num++);",
      "",
      "[Removed Lines]",
      "1893:                     num += count;",
      "1894:                     count = 0;",
      "",
      "[Added Lines]",
      "1883:                     ok = false;",
      "",
      "---------------",
      "--- Hunk 16 ---",
      "[Context before]",
      "1913:                 break;",
      "1914:             case 'A': {",
      "1915:                 if (count < 7) {",
      "1918:                     break;",
      "1919:                 }",
      "1920:                 qreal rx = (*num++);",
      "",
      "[Removed Lines]",
      "1916:                     num += count;",
      "1917:                     count = 0;",
      "",
      "[Added Lines]",
      "1905:                     ok = false;",
      "",
      "---------------",
      "--- Hunk 17 ---",
      "[Context before]",
      "1935:             }",
      "1936:                 break;",
      "1937:             default:",
      "1939:             }",
      "1940:             lastMode = pathElem.toLatin1();",
      "1941:         }",
      "1942:     }",
      "1944: }",
      "1946: static bool parseStyle(QSvgNode *node,",
      "",
      "[Removed Lines]",
      "1938:                 return false;",
      "1943:     return true;",
      "",
      "[Added Lines]",
      "1926:                 ok = false;",
      "1927:                 break;",
      "1930:             if (path.elementCount() > maxElementCount)",
      "1931:                 ok = false;",
      "1934:     return ok;",
      "",
      "---------------",
      "--- Hunk 18 ---",
      "[Context before]",
      "2977:     QPainterPath qpath;",
      "2978:     qpath.setFillRule(Qt::WindingFill);",
      "2982:     QSvgNode *path = new QSvgPath(parent, qpath);",
      "2983:     return path;",
      "",
      "[Removed Lines]",
      "2980:     parsePathDataFast(data, qpath);",
      "",
      "[Added Lines]",
      "2970:     if (!parsePathDataFast(data, qpath))",
      "2971:         qCWarning(lcSvgHandler, \"Invalid path data; path truncated.\");",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "79bb9f51fa374106a612d17c9d98d35d807be670",
      "candidate_info": {
        "commit_hash": "79bb9f51fa374106a612d17c9d98d35d807be670",
        "repo": "qt/qtsvg",
        "commit_url": "https://github.com/qt/qtsvg/commit/79bb9f51fa374106a612d17c9d98d35d807be670",
        "files": [
          "src/svg/qsvghandler.cpp"
        ],
        "message": "Do stricter error checking when parsing path nodes\n\nThe SVG spec mandates that path parsing should terminate on the first\nerror encountered, and an error be reported. To improve the handling\nof corrupt files, implement such error handling, and also limit the\nnumber of QPainterPath elements to a reasonable range.\n\nFixes: QTBUG-96044\nChange-Id: Ic5e65d6b658516d6f1317c72de365c8c7ad81891\nReviewed-by: Allan Sandfeld Jensen <allan.jensen@qt.io>\nReviewed-by: Robert L\u00f6hning <robert.loehning@qt.io>\n(cherry picked from commit 36cfd9efb9b22b891adee9c48d30202289cfa620)\nReviewed-by: Qt Cherry-pick Bot <cherrypick_bot@qt-project.org>",
        "before_after_code_files": [
          "src/svg/qsvghandler.cpp||src/svg/qsvghandler.cpp"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "src/svg/qsvghandler.cpp||src/svg/qsvghandler.cpp"
          ],
          "candidate": [
            "src/svg/qsvghandler.cpp||src/svg/qsvghandler.cpp"
          ]
        }
      },
      "candidate_diff": {
        "src/svg/qsvghandler.cpp||src/svg/qsvghandler.cpp": [
          "File: src/svg/qsvghandler.cpp -> src/svg/qsvghandler.cpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "1598: static bool parsePathDataFast(QStringView dataStr, QPainterPath &path)",
          "1599: {",
          "1600:     qreal x0 = 0, y0 = 0;              // starting point",
          "1601:     qreal x = 0, y = 0;                // current point",
          "1602:     char lastMode = 0;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1600:     const int maxElementCount = 0x7fff; // Assume file corruption if more path elements than this",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1604:     const QChar *str = dataStr.constData();",
          "1605:     const QChar *end = str + dataStr.size();",
          "1608:         while (str->isSpace() && (str + 1) != end)",
          "1609:             ++str;",
          "1610:         QChar pathElem = *str;",
          "",
          "[Removed Lines]",
          "1607:     while (str != end) {",
          "",
          "[Added Lines]",
          "1608:     bool ok = true;",
          "1609:     while (ok && str != end) {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1621:             arg.append(0);//dummy",
          "1622:         const qreal *num = arg.constData();",
          "1623:         int count = arg.count();",
          "1625:             qreal offsetX = x;        // correction offsets",
          "1626:             qreal offsetY = y;        // for relative commands",
          "1627:             switch (pathElem.unicode()) {",
          "1628:             case 'm': {",
          "1629:                 if (count < 2) {",
          "1632:                     break;",
          "1633:                 }",
          "1634:                 x = x0 = num[0] + offsetX;",
          "",
          "[Removed Lines]",
          "1624:         while (count > 0) {",
          "1630:                     num++;",
          "1631:                     count--;",
          "",
          "[Added Lines]",
          "1626:         while (ok && count > 0) {",
          "1632:                     ok = false;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1645:                 break;",
          "1646:             case 'M': {",
          "1647:                 if (count < 2) {",
          "1650:                     break;",
          "1651:                 }",
          "1652:                 x = x0 = num[0];",
          "",
          "[Removed Lines]",
          "1648:                     num++;",
          "1649:                     count--;",
          "",
          "[Added Lines]",
          "1649:                     ok = false;",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1672:                 break;",
          "1673:             case 'l': {",
          "1674:                 if (count < 2) {",
          "1677:                     break;",
          "1678:                 }",
          "1679:                 x = num[0] + offsetX;",
          "",
          "[Removed Lines]",
          "1675:                     num++;",
          "1676:                     count--;",
          "",
          "[Added Lines]",
          "1675:                     ok = false;",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "1686:                 break;",
          "1687:             case 'L': {",
          "1688:                 if (count < 2) {",
          "1691:                     break;",
          "1692:                 }",
          "1693:                 x = num[0];",
          "",
          "[Removed Lines]",
          "1689:                     num++;",
          "1690:                     count--;",
          "",
          "[Added Lines]",
          "1688:                     ok = false;",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "1727:                 break;",
          "1728:             case 'c': {",
          "1729:                 if (count < 6) {",
          "1732:                     break;",
          "1733:                 }",
          "1734:                 QPointF c1(num[0] + offsetX, num[1] + offsetY);",
          "",
          "[Removed Lines]",
          "1730:                     num += count;",
          "1731:                     count = 0;",
          "",
          "[Added Lines]",
          "1728:                     ok = false;",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "1744:             }",
          "1745:             case 'C': {",
          "1746:                 if (count < 6) {",
          "1749:                     break;",
          "1750:                 }",
          "1751:                 QPointF c1(num[0], num[1]);",
          "",
          "[Removed Lines]",
          "1747:                     num += count;",
          "1748:                     count = 0;",
          "",
          "[Added Lines]",
          "1744:                     ok = false;",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "1761:             }",
          "1762:             case 's': {",
          "1763:                 if (count < 4) {",
          "1766:                     break;",
          "1767:                 }",
          "1768:                 QPointF c1;",
          "",
          "[Removed Lines]",
          "1764:                     num += count;",
          "1765:                     count = 0;",
          "",
          "[Added Lines]",
          "1760:                     ok = false;",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "1783:             }",
          "1784:             case 'S': {",
          "1785:                 if (count < 4) {",
          "1788:                     break;",
          "1789:                 }",
          "1790:                 QPointF c1;",
          "",
          "[Removed Lines]",
          "1786:                     num += count;",
          "1787:                     count = 0;",
          "",
          "[Added Lines]",
          "1781:                     ok = false;",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "1805:             }",
          "1806:             case 'q': {",
          "1807:                 if (count < 4) {",
          "1810:                     break;",
          "1811:                 }",
          "1812:                 QPointF c(num[0] + offsetX, num[1] + offsetY);",
          "",
          "[Removed Lines]",
          "1808:                     num += count;",
          "1809:                     count = 0;",
          "",
          "[Added Lines]",
          "1802:                     ok = false;",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "1821:             }",
          "1822:             case 'Q': {",
          "1823:                 if (count < 4) {",
          "1826:                     break;",
          "1827:                 }",
          "1828:                 QPointF c(num[0], num[1]);",
          "",
          "[Removed Lines]",
          "1824:                     num += count;",
          "1825:                     count = 0;",
          "",
          "[Added Lines]",
          "1817:                     ok = false;",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "1837:             }",
          "1838:             case 't': {",
          "1839:                 if (count < 2) {",
          "1842:                     break;",
          "1843:                 }",
          "1844:                 QPointF e(num[0] + offsetX, num[1] + offsetY);",
          "",
          "[Removed Lines]",
          "1840:                     num += count;",
          "1841:                     count = 0;",
          "",
          "[Added Lines]",
          "1832:                     ok = false;",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "1858:             }",
          "1859:             case 'T': {",
          "1860:                 if (count < 2) {",
          "1863:                     break;",
          "1864:                 }",
          "1865:                 QPointF e(num[0], num[1]);",
          "",
          "[Removed Lines]",
          "1861:                     num += count;",
          "1862:                     count = 0;",
          "",
          "[Added Lines]",
          "1852:                     ok = false;",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1879:             }",
          "1880:             case 'a': {",
          "1881:                 if (count < 7) {",
          "1884:                     break;",
          "1885:                 }",
          "1886:                 qreal rx = (*num++);",
          "",
          "[Removed Lines]",
          "1882:                     num += count;",
          "1883:                     count = 0;",
          "",
          "[Added Lines]",
          "1872:                     ok = false;",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1902:                 break;",
          "1903:             case 'A': {",
          "1904:                 if (count < 7) {",
          "1907:                     break;",
          "1908:                 }",
          "1909:                 qreal rx = (*num++);",
          "",
          "[Removed Lines]",
          "1905:                     num += count;",
          "1906:                     count = 0;",
          "",
          "[Added Lines]",
          "1894:                     ok = false;",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1924:             }",
          "1925:                 break;",
          "1926:             default:",
          "1928:             }",
          "1929:             lastMode = pathElem.toLatin1();",
          "1930:         }",
          "1931:     }",
          "1933: }",
          "1935: static bool parseStyle(QSvgNode *node,",
          "",
          "[Removed Lines]",
          "1927:                 return false;",
          "1932:     return true;",
          "",
          "[Added Lines]",
          "1915:                 ok = false;",
          "1916:                 break;",
          "1919:             if (path.elementCount() > maxElementCount)",
          "1920:                 ok = false;",
          "1923:     return ok;",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "2988:     QPainterPath qpath;",
          "2989:     qpath.setFillRule(Qt::WindingFill);",
          "2993:     QSvgNode *path = new QSvgPath(parent, qpath);",
          "2994:     return path;",
          "",
          "[Removed Lines]",
          "2991:     parsePathDataFast(data, qpath);",
          "",
          "[Added Lines]",
          "2981:     if (!parsePathDataFast(data, qpath))",
          "2982:         qCWarning(lcSvgHandler, \"Invalid path data; path truncated.\");",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "6958581c5cfa6ceb75edcd8b64699b2e71af29f7",
      "candidate_info": {
        "commit_hash": "6958581c5cfa6ceb75edcd8b64699b2e71af29f7",
        "repo": "qt/qtsvg",
        "commit_url": "https://github.com/qt/qtsvg/commit/6958581c5cfa6ceb75edcd8b64699b2e71af29f7",
        "files": [
          "src/svg/qsvghandler.cpp"
        ],
        "message": "Do stricter error checking when parsing path nodes\n\nThe SVG spec mandates that path parsing should terminate on the first\nerror encountered, and an error be reported. To improve the handling\nof corrupt files, implement such error handling, and also limit the\nnumber of QPainterPath elements to a reasonable range.\n\nFixes: QTBUG-96044\nChange-Id: Ic5e65d6b658516d6f1317c72de365c8c7ad81891\nReviewed-by: Allan Sandfeld Jensen <allan.jensen@qt.io>\nReviewed-by: Robert L\u00f6hning <robert.loehning@qt.io>\n(cherry picked from commit 36cfd9efb9b22b891adee9c48d30202289cfa620)\nReviewed-by: Qt Cherry-pick Bot <cherrypick_bot@qt-project.org>",
        "before_after_code_files": [
          "src/svg/qsvghandler.cpp||src/svg/qsvghandler.cpp"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "src/svg/qsvghandler.cpp||src/svg/qsvghandler.cpp"
          ],
          "candidate": [
            "src/svg/qsvghandler.cpp||src/svg/qsvghandler.cpp"
          ]
        }
      },
      "candidate_diff": {
        "src/svg/qsvghandler.cpp||src/svg/qsvghandler.cpp": [
          "File: src/svg/qsvghandler.cpp -> src/svg/qsvghandler.cpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "1627: static bool parsePathDataFast(const QStringRef &dataStr, QPainterPath &path)",
          "1628: {",
          "1629:     qreal x0 = 0, y0 = 0;              // starting point",
          "1630:     qreal x = 0, y = 0;                // current point",
          "1631:     char lastMode = 0;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1629:     const int maxElementCount = 0x7fff; // Assume file corruption if more path elements than this",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1633:     const QChar *str = dataStr.constData();",
          "1634:     const QChar *end = str + dataStr.size();",
          "1637:         while (str->isSpace() && (str + 1) != end)",
          "1638:             ++str;",
          "1639:         QChar pathElem = *str;",
          "",
          "[Removed Lines]",
          "1636:     while (str != end) {",
          "",
          "[Added Lines]",
          "1637:     bool ok = true;",
          "1638:     while (ok && str != end) {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1650:             arg.append(0);//dummy",
          "1651:         const qreal *num = arg.constData();",
          "1652:         int count = arg.count();",
          "1654:             qreal offsetX = x;        // correction offsets",
          "1655:             qreal offsetY = y;        // for relative commands",
          "1656:             switch (pathElem.unicode()) {",
          "1657:             case 'm': {",
          "1658:                 if (count < 2) {",
          "1661:                     break;",
          "1662:                 }",
          "1663:                 x = x0 = num[0] + offsetX;",
          "",
          "[Removed Lines]",
          "1653:         while (count > 0) {",
          "1659:                     num++;",
          "1660:                     count--;",
          "",
          "[Added Lines]",
          "1655:         while (ok && count > 0) {",
          "1661:                     ok = false;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1674:                 break;",
          "1675:             case 'M': {",
          "1676:                 if (count < 2) {",
          "1679:                     break;",
          "1680:                 }",
          "1681:                 x = x0 = num[0];",
          "",
          "[Removed Lines]",
          "1677:                     num++;",
          "1678:                     count--;",
          "",
          "[Added Lines]",
          "1678:                     ok = false;",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1701:                 break;",
          "1702:             case 'l': {",
          "1703:                 if (count < 2) {",
          "1706:                     break;",
          "1707:                 }",
          "1708:                 x = num[0] + offsetX;",
          "",
          "[Removed Lines]",
          "1704:                     num++;",
          "1705:                     count--;",
          "",
          "[Added Lines]",
          "1704:                     ok = false;",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "1715:                 break;",
          "1716:             case 'L': {",
          "1717:                 if (count < 2) {",
          "1720:                     break;",
          "1721:                 }",
          "1722:                 x = num[0];",
          "",
          "[Removed Lines]",
          "1718:                     num++;",
          "1719:                     count--;",
          "",
          "[Added Lines]",
          "1717:                     ok = false;",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "1756:                 break;",
          "1757:             case 'c': {",
          "1758:                 if (count < 6) {",
          "1761:                     break;",
          "1762:                 }",
          "1763:                 QPointF c1(num[0] + offsetX, num[1] + offsetY);",
          "",
          "[Removed Lines]",
          "1759:                     num += count;",
          "1760:                     count = 0;",
          "",
          "[Added Lines]",
          "1757:                     ok = false;",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "1773:             }",
          "1774:             case 'C': {",
          "1775:                 if (count < 6) {",
          "1778:                     break;",
          "1779:                 }",
          "1780:                 QPointF c1(num[0], num[1]);",
          "",
          "[Removed Lines]",
          "1776:                     num += count;",
          "1777:                     count = 0;",
          "",
          "[Added Lines]",
          "1773:                     ok = false;",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "1790:             }",
          "1791:             case 's': {",
          "1792:                 if (count < 4) {",
          "1795:                     break;",
          "1796:                 }",
          "1797:                 QPointF c1;",
          "",
          "[Removed Lines]",
          "1793:                     num += count;",
          "1794:                     count = 0;",
          "",
          "[Added Lines]",
          "1789:                     ok = false;",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "1812:             }",
          "1813:             case 'S': {",
          "1814:                 if (count < 4) {",
          "1817:                     break;",
          "1818:                 }",
          "1819:                 QPointF c1;",
          "",
          "[Removed Lines]",
          "1815:                     num += count;",
          "1816:                     count = 0;",
          "",
          "[Added Lines]",
          "1810:                     ok = false;",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "1834:             }",
          "1835:             case 'q': {",
          "1836:                 if (count < 4) {",
          "1839:                     break;",
          "1840:                 }",
          "1841:                 QPointF c(num[0] + offsetX, num[1] + offsetY);",
          "",
          "[Removed Lines]",
          "1837:                     num += count;",
          "1838:                     count = 0;",
          "",
          "[Added Lines]",
          "1831:                     ok = false;",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "1850:             }",
          "1851:             case 'Q': {",
          "1852:                 if (count < 4) {",
          "1855:                     break;",
          "1856:                 }",
          "1857:                 QPointF c(num[0], num[1]);",
          "",
          "[Removed Lines]",
          "1853:                     num += count;",
          "1854:                     count = 0;",
          "",
          "[Added Lines]",
          "1846:                     ok = false;",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "1866:             }",
          "1867:             case 't': {",
          "1868:                 if (count < 2) {",
          "1871:                     break;",
          "1872:                 }",
          "1873:                 QPointF e(num[0] + offsetX, num[1] + offsetY);",
          "",
          "[Removed Lines]",
          "1869:                     num += count;",
          "1870:                     count = 0;",
          "",
          "[Added Lines]",
          "1861:                     ok = false;",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "1887:             }",
          "1888:             case 'T': {",
          "1889:                 if (count < 2) {",
          "1892:                     break;",
          "1893:                 }",
          "1894:                 QPointF e(num[0], num[1]);",
          "",
          "[Removed Lines]",
          "1890:                     num += count;",
          "1891:                     count = 0;",
          "",
          "[Added Lines]",
          "1881:                     ok = false;",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1908:             }",
          "1909:             case 'a': {",
          "1910:                 if (count < 7) {",
          "1913:                     break;",
          "1914:                 }",
          "1915:                 qreal rx = (*num++);",
          "",
          "[Removed Lines]",
          "1911:                     num += count;",
          "1912:                     count = 0;",
          "",
          "[Added Lines]",
          "1901:                     ok = false;",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1931:                 break;",
          "1932:             case 'A': {",
          "1933:                 if (count < 7) {",
          "1936:                     break;",
          "1937:                 }",
          "1938:                 qreal rx = (*num++);",
          "",
          "[Removed Lines]",
          "1934:                     num += count;",
          "1935:                     count = 0;",
          "",
          "[Added Lines]",
          "1923:                     ok = false;",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1953:             }",
          "1954:                 break;",
          "1955:             default:",
          "1957:             }",
          "1958:             lastMode = pathElem.toLatin1();",
          "1959:         }",
          "1960:     }",
          "1962: }",
          "1964: static bool parseStyle(QSvgNode *node,",
          "",
          "[Removed Lines]",
          "1956:                 return false;",
          "1961:     return true;",
          "",
          "[Added Lines]",
          "1944:                 ok = false;",
          "1945:                 break;",
          "1948:             if (path.elementCount() > maxElementCount)",
          "1949:                 ok = false;",
          "1952:     return ok;",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "2996:     QPainterPath qpath;",
          "2997:     qpath.setFillRule(Qt::WindingFill);",
          "3001:     QSvgNode *path = new QSvgPath(parent, qpath);",
          "3002:     return path;",
          "",
          "[Removed Lines]",
          "2999:     parsePathDataFast(data, qpath);",
          "",
          "[Added Lines]",
          "2989:     if (!parsePathDataFast(data, qpath))",
          "2990:         qCWarning(lcSvgHandler, \"Invalid path data; path truncated.\");",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "36cfd9efb9b22b891adee9c48d30202289cfa620",
      "candidate_info": {
        "commit_hash": "36cfd9efb9b22b891adee9c48d30202289cfa620",
        "repo": "qt/qtsvg",
        "commit_url": "https://github.com/qt/qtsvg/commit/36cfd9efb9b22b891adee9c48d30202289cfa620",
        "files": [
          "src/svg/qsvghandler.cpp"
        ],
        "message": "Do stricter error checking when parsing path nodes\n\nThe SVG spec mandates that path parsing should terminate on the first\nerror encountered, and an error be reported. To improve the handling\nof corrupt files, implement such error handling, and also limit the\nnumber of QPainterPath elements to a reasonable range.\n\nFixes: QTBUG-96044\nPick-to: 6.2 5.15 5.12\nChange-Id: Ic5e65d6b658516d6f1317c72de365c8c7ad81891\nReviewed-by: Allan Sandfeld Jensen <allan.jensen@qt.io>\nReviewed-by: Robert L\u00f6hning <robert.loehning@qt.io>",
        "before_after_code_files": [
          "src/svg/qsvghandler.cpp||src/svg/qsvghandler.cpp"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "src/svg/qsvghandler.cpp||src/svg/qsvghandler.cpp"
          ],
          "candidate": [
            "src/svg/qsvghandler.cpp||src/svg/qsvghandler.cpp"
          ]
        }
      },
      "candidate_diff": {
        "src/svg/qsvghandler.cpp||src/svg/qsvghandler.cpp": [
          "File: src/svg/qsvghandler.cpp -> src/svg/qsvghandler.cpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "1596: static bool parsePathDataFast(QStringView dataStr, QPainterPath &path)",
          "1597: {",
          "1598:     qreal x0 = 0, y0 = 0;              // starting point",
          "1599:     qreal x = 0, y = 0;                // current point",
          "1600:     char lastMode = 0;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1598:     const int maxElementCount = 0x7fff; // Assume file corruption if more path elements than this",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1602:     const QChar *str = dataStr.constData();",
          "1603:     const QChar *end = str + dataStr.size();",
          "1606:         while (str->isSpace() && (str + 1) != end)",
          "1607:             ++str;",
          "1608:         QChar pathElem = *str;",
          "",
          "[Removed Lines]",
          "1605:     while (str != end) {",
          "",
          "[Added Lines]",
          "1606:     bool ok = true;",
          "1607:     while (ok && str != end) {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1619:             arg.append(0);//dummy",
          "1620:         const qreal *num = arg.constData();",
          "1621:         int count = arg.count();",
          "1623:             qreal offsetX = x;        // correction offsets",
          "1624:             qreal offsetY = y;        // for relative commands",
          "1625:             switch (pathElem.unicode()) {",
          "1626:             case 'm': {",
          "1627:                 if (count < 2) {",
          "1630:                     break;",
          "1631:                 }",
          "1632:                 x = x0 = num[0] + offsetX;",
          "",
          "[Removed Lines]",
          "1622:         while (count > 0) {",
          "1628:                     num++;",
          "1629:                     count--;",
          "",
          "[Added Lines]",
          "1624:         while (ok && count > 0) {",
          "1630:                     ok = false;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1643:                 break;",
          "1644:             case 'M': {",
          "1645:                 if (count < 2) {",
          "1648:                     break;",
          "1649:                 }",
          "1650:                 x = x0 = num[0];",
          "",
          "[Removed Lines]",
          "1646:                     num++;",
          "1647:                     count--;",
          "",
          "[Added Lines]",
          "1647:                     ok = false;",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1670:                 break;",
          "1671:             case 'l': {",
          "1672:                 if (count < 2) {",
          "1675:                     break;",
          "1676:                 }",
          "1677:                 x = num[0] + offsetX;",
          "",
          "[Removed Lines]",
          "1673:                     num++;",
          "1674:                     count--;",
          "",
          "[Added Lines]",
          "1673:                     ok = false;",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "1684:                 break;",
          "1685:             case 'L': {",
          "1686:                 if (count < 2) {",
          "1689:                     break;",
          "1690:                 }",
          "1691:                 x = num[0];",
          "",
          "[Removed Lines]",
          "1687:                     num++;",
          "1688:                     count--;",
          "",
          "[Added Lines]",
          "1686:                     ok = false;",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "1725:                 break;",
          "1726:             case 'c': {",
          "1727:                 if (count < 6) {",
          "1730:                     break;",
          "1731:                 }",
          "1732:                 QPointF c1(num[0] + offsetX, num[1] + offsetY);",
          "",
          "[Removed Lines]",
          "1728:                     num += count;",
          "1729:                     count = 0;",
          "",
          "[Added Lines]",
          "1726:                     ok = false;",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "1742:             }",
          "1743:             case 'C': {",
          "1744:                 if (count < 6) {",
          "1747:                     break;",
          "1748:                 }",
          "1749:                 QPointF c1(num[0], num[1]);",
          "",
          "[Removed Lines]",
          "1745:                     num += count;",
          "1746:                     count = 0;",
          "",
          "[Added Lines]",
          "1742:                     ok = false;",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "1759:             }",
          "1760:             case 's': {",
          "1761:                 if (count < 4) {",
          "1764:                     break;",
          "1765:                 }",
          "1766:                 QPointF c1;",
          "",
          "[Removed Lines]",
          "1762:                     num += count;",
          "1763:                     count = 0;",
          "",
          "[Added Lines]",
          "1758:                     ok = false;",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "1781:             }",
          "1782:             case 'S': {",
          "1783:                 if (count < 4) {",
          "1786:                     break;",
          "1787:                 }",
          "1788:                 QPointF c1;",
          "",
          "[Removed Lines]",
          "1784:                     num += count;",
          "1785:                     count = 0;",
          "",
          "[Added Lines]",
          "1779:                     ok = false;",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "1803:             }",
          "1804:             case 'q': {",
          "1805:                 if (count < 4) {",
          "1808:                     break;",
          "1809:                 }",
          "1810:                 QPointF c(num[0] + offsetX, num[1] + offsetY);",
          "",
          "[Removed Lines]",
          "1806:                     num += count;",
          "1807:                     count = 0;",
          "",
          "[Added Lines]",
          "1800:                     ok = false;",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "1819:             }",
          "1820:             case 'Q': {",
          "1821:                 if (count < 4) {",
          "1824:                     break;",
          "1825:                 }",
          "1826:                 QPointF c(num[0], num[1]);",
          "",
          "[Removed Lines]",
          "1822:                     num += count;",
          "1823:                     count = 0;",
          "",
          "[Added Lines]",
          "1815:                     ok = false;",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "1835:             }",
          "1836:             case 't': {",
          "1837:                 if (count < 2) {",
          "1840:                     break;",
          "1841:                 }",
          "1842:                 QPointF e(num[0] + offsetX, num[1] + offsetY);",
          "",
          "[Removed Lines]",
          "1838:                     num += count;",
          "1839:                     count = 0;",
          "",
          "[Added Lines]",
          "1830:                     ok = false;",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "1856:             }",
          "1857:             case 'T': {",
          "1858:                 if (count < 2) {",
          "1861:                     break;",
          "1862:                 }",
          "1863:                 QPointF e(num[0], num[1]);",
          "",
          "[Removed Lines]",
          "1859:                     num += count;",
          "1860:                     count = 0;",
          "",
          "[Added Lines]",
          "1850:                     ok = false;",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1877:             }",
          "1878:             case 'a': {",
          "1879:                 if (count < 7) {",
          "1882:                     break;",
          "1883:                 }",
          "1884:                 qreal rx = (*num++);",
          "",
          "[Removed Lines]",
          "1880:                     num += count;",
          "1881:                     count = 0;",
          "",
          "[Added Lines]",
          "1870:                     ok = false;",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1900:                 break;",
          "1901:             case 'A': {",
          "1902:                 if (count < 7) {",
          "1905:                     break;",
          "1906:                 }",
          "1907:                 qreal rx = (*num++);",
          "",
          "[Removed Lines]",
          "1903:                     num += count;",
          "1904:                     count = 0;",
          "",
          "[Added Lines]",
          "1892:                     ok = false;",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1922:             }",
          "1923:                 break;",
          "1924:             default:",
          "1926:             }",
          "1927:             lastMode = pathElem.toLatin1();",
          "1928:         }",
          "1929:     }",
          "1931: }",
          "1933: static bool parseStyle(QSvgNode *node,",
          "",
          "[Removed Lines]",
          "1925:                 return false;",
          "1930:     return true;",
          "",
          "[Added Lines]",
          "1913:                 ok = false;",
          "1914:                 break;",
          "1917:             if (path.elementCount() > maxElementCount)",
          "1918:                 ok = false;",
          "1921:     return ok;",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "2986:     QPainterPath qpath;",
          "2987:     qpath.setFillRule(Qt::WindingFill);",
          "2991:     QSvgNode *path = new QSvgPath(parent, qpath);",
          "2992:     return path;",
          "",
          "[Removed Lines]",
          "2989:     parsePathDataFast(data, qpath);",
          "",
          "[Added Lines]",
          "2979:     if (!parsePathDataFast(data, qpath))",
          "2980:         qCWarning(lcSvgHandler, \"Invalid path data; path truncated.\");",
          "",
          "---------------"
        ]
      }
    }
  ]
}