{
  "cve_id": "CVE-2016-7130",
  "cve_desc": "The php_wddx_pop_element function in ext/wddx/wddx.c in PHP before 5.6.25 and 7.x before 7.0.10 allows remote attackers to cause a denial of service (NULL pointer dereference and application crash) or possibly have unspecified other impact via an invalid base64 binary value, as demonstrated by a wddx_deserialize call that mishandles a binary element in a wddxPacket XML document.",
  "repo": "php/php-src",
  "patch_hash": "698a691724c0a949295991e5df091ce16f899e02",
  "patch_info": {
    "commit_hash": "698a691724c0a949295991e5df091ce16f899e02",
    "repo": "php/php-src",
    "commit_url": "https://github.com/php/php-src/commit/698a691724c0a949295991e5df091ce16f899e02",
    "files": [
      "ext/wddx/tests/bug72750.phpt",
      "ext/wddx/wddx.c"
    ],
    "message": "Fix bug #72750: wddx_deserialize null dereference",
    "before_after_code_files": [
      "ext/wddx/tests/bug72750.phpt||ext/wddx/tests/bug72750.phpt",
      "ext/wddx/wddx.c||ext/wddx/wddx.c"
    ]
  },
  "patch_diff": {
    "ext/wddx/tests/bug72750.phpt||ext/wddx/tests/bug72750.phpt": [
      "File: ext/wddx/tests/bug72750.phpt -> ext/wddx/tests/bug72750.phpt",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: --TEST--",
      "2: Bug #72750: wddx_deserialize null dereference",
      "3: --SKIPIF--",
      "4: <?php",
      "5: if (!extension_loaded('wddx')) {",
      "6:     die('skip. wddx not available');",
      "7: }",
      "8: ?>",
      "9: --FILE--",
      "10: <?php",
      "12: $xml = <<< XML",
      "13: <?xml version='1.0'?>",
      "14: <!DOCTYPE wddxPacket SYSTEM 'wddx_0100.dtd'>",
      "15: <wddxPacket version='1.0'>",
      "16: <header/>",
      "17:         <data>",
      "18:                 <struct>",
      "19:                      <var name='aBinary'>",
      "20:                          <binary length='11'>\\\\tYmluYXJRhdGE=</binary>",
      "21:                      </var>",
      "22:                  </struct>",
      "23:         </data>",
      "24: </wddxPacket>",
      "25: XML;",
      "27: $array = wddx_deserialize($xml);",
      "28: var_dump($array);",
      "29: ?>",
      "30: --EXPECT--",
      "31: array(1) {",
      "32:   [\"aBinary\"]=>",
      "33:   string(0) \"\"",
      "34: }",
      "",
      "---------------"
    ],
    "ext/wddx/wddx.c||ext/wddx/wddx.c": [
      "File: ext/wddx/wddx.c -> ext/wddx/wddx.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "960:    new_str = php_base64_decode(Z_STRVAL_P(ent1->data), Z_STRLEN_P(ent1->data), &new_len);",
      "961:    STR_FREE(Z_STRVAL_P(ent1->data));",
      "964:   }",
      "",
      "[Removed Lines]",
      "962:    Z_STRVAL_P(ent1->data) = new_str;",
      "963:    Z_STRLEN_P(ent1->data) = new_len;",
      "",
      "[Added Lines]",
      "962:    if (new_str) {",
      "963:     Z_STRVAL_P(ent1->data) = new_str;",
      "964:     Z_STRLEN_P(ent1->data) = new_len;",
      "965:    } else {",
      "966:     ZVAL_EMPTY_STRING(ent1->data);",
      "967:    }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "f1486f0fd63e888028e625a5ae02f10cc729c4c7",
      "candidate_info": {
        "commit_hash": "f1486f0fd63e888028e625a5ae02f10cc729c4c7",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/f1486f0fd63e888028e625a5ae02f10cc729c4c7",
        "files": [
          "ext/wddx/tests/bug72750.phpt",
          "ext/wddx/wddx.c"
        ],
        "message": "Fix bug #72750: wddx_deserialize null dereference\n\n(cherry picked from commit 6930a1d12c47aa1d2675837852910d177b0ceb11)\n\nConflicts:\n\text/wddx/wddx.c",
        "before_after_code_files": [
          "ext/wddx/tests/bug72750.phpt||ext/wddx/tests/bug72750.phpt",
          "ext/wddx/wddx.c||ext/wddx/wddx.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_issue": 1,
        "olp_code_files": {
          "patch": [
            "ext/wddx/tests/bug72750.phpt||ext/wddx/tests/bug72750.phpt",
            "ext/wddx/wddx.c||ext/wddx/wddx.c"
          ],
          "candidate": [
            "ext/wddx/tests/bug72750.phpt||ext/wddx/tests/bug72750.phpt",
            "ext/wddx/wddx.c||ext/wddx/wddx.c"
          ]
        }
      },
      "candidate_diff": {
        "ext/wddx/tests/bug72750.phpt||ext/wddx/tests/bug72750.phpt": [
          "File: ext/wddx/tests/bug72750.phpt -> ext/wddx/tests/bug72750.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #72750: wddx_deserialize null dereference",
          "3: --SKIPIF--",
          "4: <?php",
          "5: if (!extension_loaded('wddx')) {",
          "6:     die('skip. wddx not available');",
          "7: }",
          "8: ?>",
          "9: --FILE--",
          "10: <?php",
          "12: $xml = <<< XML",
          "13: <?xml version='1.0'?>",
          "14: <!DOCTYPE wddxPacket SYSTEM 'wddx_0100.dtd'>",
          "15: <wddxPacket version='1.0'>",
          "16: <header/>",
          "17:         <data>",
          "18:                 <struct>",
          "19:                      <var name='aBinary'>",
          "20:                          <binary length='11'>\\\\tYmluYXJRhdGE=</binary>",
          "21:                      </var>",
          "22:                  </struct>",
          "23:         </data>",
          "24: </wddxPacket>",
          "25: XML;",
          "27: $array = wddx_deserialize($xml);",
          "28: var_dump($array);",
          "29: ?>",
          "30: --EXPECT--",
          "31: array(1) {",
          "32:   [\"aBinary\"]=>",
          "33:   string(0) \"\"",
          "34: }",
          "",
          "---------------"
        ],
        "ext/wddx/wddx.c||ext/wddx/wddx.c": [
          "File: ext/wddx/wddx.c -> ext/wddx/wddx.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "897:    zend_string *new_str = php_base64_decode(",
          "898:     (unsigned char *)Z_STRVAL(ent1->data), Z_STRLEN(ent1->data));",
          "899:    zval_ptr_dtor(&ent1->data);",
          "901:   }",
          "",
          "[Removed Lines]",
          "900:    ZVAL_STR(&ent1->data, new_str);",
          "",
          "[Added Lines]",
          "900:    if (new_str) {",
          "901:     ZVAL_STR(&ent1->data, new_str);",
          "902:    } else {",
          "903:     ZVAL_EMPTY_STRING(&ent1->data);",
          "904:    }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "b2d89c93e85504ccfcd865213685b89ec1cafcf9",
      "candidate_info": {
        "commit_hash": "b2d89c93e85504ccfcd865213685b89ec1cafcf9",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/b2d89c93e85504ccfcd865213685b89ec1cafcf9",
        "files": [
          "ext/wddx/tests/bug72750.phpt",
          "ext/wddx/wddx.c"
        ],
        "message": "Fix bug #72750: wddx_deserialize null dereference\n\n(cherry picked from commit 6930a1d12c47aa1d2675837852910d177b0ceb11)\n\nConflicts:\n\text/wddx/wddx.c\n\n(cherry picked from commit f1486f0fd63e888028e625a5ae02f10cc729c4c7)",
        "before_after_code_files": [
          "ext/wddx/tests/bug72750.phpt||ext/wddx/tests/bug72750.phpt",
          "ext/wddx/wddx.c||ext/wddx/wddx.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "ext/wddx/tests/bug72750.phpt||ext/wddx/tests/bug72750.phpt",
            "ext/wddx/wddx.c||ext/wddx/wddx.c"
          ],
          "candidate": [
            "ext/wddx/tests/bug72750.phpt||ext/wddx/tests/bug72750.phpt",
            "ext/wddx/wddx.c||ext/wddx/wddx.c"
          ]
        }
      },
      "candidate_diff": {
        "ext/wddx/tests/bug72750.phpt||ext/wddx/tests/bug72750.phpt": [
          "File: ext/wddx/tests/bug72750.phpt -> ext/wddx/tests/bug72750.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #72750: wddx_deserialize null dereference",
          "3: --SKIPIF--",
          "4: <?php",
          "5: if (!extension_loaded('wddx')) {",
          "6:     die('skip. wddx not available');",
          "7: }",
          "8: ?>",
          "9: --FILE--",
          "10: <?php",
          "12: $xml = <<< XML",
          "13: <?xml version='1.0'?>",
          "14: <!DOCTYPE wddxPacket SYSTEM 'wddx_0100.dtd'>",
          "15: <wddxPacket version='1.0'>",
          "16: <header/>",
          "17:         <data>",
          "18:                 <struct>",
          "19:                      <var name='aBinary'>",
          "20:                          <binary length='11'>\\\\tYmluYXJRhdGE=</binary>",
          "21:                      </var>",
          "22:                  </struct>",
          "23:         </data>",
          "24: </wddxPacket>",
          "25: XML;",
          "27: $array = wddx_deserialize($xml);",
          "28: var_dump($array);",
          "29: ?>",
          "30: --EXPECT--",
          "31: array(1) {",
          "32:   [\"aBinary\"]=>",
          "33:   string(0) \"\"",
          "34: }",
          "",
          "---------------"
        ],
        "ext/wddx/wddx.c||ext/wddx/wddx.c": [
          "File: ext/wddx/wddx.c -> ext/wddx/wddx.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "897:    zend_string *new_str = php_base64_decode(",
          "898:     (unsigned char *)Z_STRVAL(ent1->data), Z_STRLEN(ent1->data));",
          "899:    zval_ptr_dtor(&ent1->data);",
          "901:   }",
          "",
          "[Removed Lines]",
          "900:    ZVAL_STR(&ent1->data, new_str);",
          "",
          "[Added Lines]",
          "900:    if (new_str) {",
          "901:     ZVAL_STR(&ent1->data, new_str);",
          "902:    } else {",
          "903:     ZVAL_EMPTY_STRING(&ent1->data);",
          "904:    }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "82b95bb758ac707a2372f2edaed70589b6f374d3",
      "candidate_info": {
        "commit_hash": "82b95bb758ac707a2372f2edaed70589b6f374d3",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/82b95bb758ac707a2372f2edaed70589b6f374d3",
        "files": [
          "ext/wddx/tests/bug72750.phpt",
          "ext/wddx/wddx.c"
        ],
        "message": "Fix bug #72750: wddx_deserialize null dereference",
        "before_after_code_files": [
          "ext/wddx/tests/bug72750.phpt||ext/wddx/tests/bug72750.phpt",
          "ext/wddx/wddx.c||ext/wddx/wddx.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "ext/wddx/tests/bug72750.phpt||ext/wddx/tests/bug72750.phpt",
            "ext/wddx/wddx.c||ext/wddx/wddx.c"
          ],
          "candidate": [
            "ext/wddx/tests/bug72750.phpt||ext/wddx/tests/bug72750.phpt",
            "ext/wddx/wddx.c||ext/wddx/wddx.c"
          ]
        }
      },
      "candidate_diff": {
        "ext/wddx/tests/bug72750.phpt||ext/wddx/tests/bug72750.phpt": [
          "File: ext/wddx/tests/bug72750.phpt -> ext/wddx/tests/bug72750.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #72750: wddx_deserialize null dereference",
          "3: --SKIPIF--",
          "4: <?php",
          "5: if (!extension_loaded('wddx')) {",
          "6:     die('skip. wddx not available');",
          "7: }",
          "8: ?>",
          "9: --FILE--",
          "10: <?php",
          "12: $xml = <<< XML",
          "13: <?xml version='1.0'?>",
          "14: <!DOCTYPE wddxPacket SYSTEM 'wddx_0100.dtd'>",
          "15: <wddxPacket version='1.0'>",
          "16: <header/>",
          "17:         <data>",
          "18:                 <struct>",
          "19:                      <var name='aBinary'>",
          "20:                          <binary length='11'>\\\\tYmluYXJRhdGE=</binary>",
          "21:                      </var>",
          "22:                  </struct>",
          "23:         </data>",
          "24: </wddxPacket>",
          "25: XML;",
          "27: $array = wddx_deserialize($xml);",
          "28: var_dump($array);",
          "29: ?>",
          "30: --EXPECT--",
          "31: array(1) {",
          "32:   [\"aBinary\"]=>",
          "33:   string(0) \"\"",
          "34: }",
          "",
          "---------------"
        ],
        "ext/wddx/wddx.c||ext/wddx/wddx.c": [
          "File: ext/wddx/wddx.c -> ext/wddx/wddx.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "960:    new_str = php_base64_decode(Z_STRVAL_P(ent1->data), Z_STRLEN_P(ent1->data), &new_len);",
          "961:    STR_FREE(Z_STRVAL_P(ent1->data));",
          "964:   }",
          "",
          "[Removed Lines]",
          "962:    Z_STRVAL_P(ent1->data) = new_str;",
          "963:    Z_STRLEN_P(ent1->data) = new_len;",
          "",
          "[Added Lines]",
          "962:    if (new_str) {",
          "963:     Z_STRVAL_P(ent1->data) = new_str;",
          "964:     Z_STRLEN_P(ent1->data) = new_len;",
          "965:    } else {",
          "966:     ZVAL_EMPTY_STRING(ent1->data);",
          "967:    }",
          "",
          "---------------"
        ]
      }
    }
  ]
}