{
  "cve_id": "CVE-2020-7670",
  "cve_desc": "agoo prior to 2.14.0 allows request smuggling attacks where agoo is used as a backend and a frontend proxy also being vulnerable. HTTP pipelining issues and request smuggling attacks might be possible due to incorrect Content-Length and Transfer encoding header parsing. It is possible to conduct HTTP request smuggling attacks where `agoo` is used as part of a chain of backend servers due to insufficient `Content-Length` and `Transfer Encoding` parsing.",
  "repo": "ohler55/agoo",
  "patch_hash": "23d03535cf7b50d679a60a953a0cae9519a4a130",
  "patch_info": {
    "commit_hash": "23d03535cf7b50d679a60a953a0cae9519a4a130",
    "repo": "ohler55/agoo",
    "commit_url": "https://github.com/ohler55/agoo/commit/23d03535cf7b50d679a60a953a0cae9519a4a130",
    "files": [
      "CHANGELOG.md",
      "ext/agoo/con.c",
      "ext/agoo/con.h",
      "ext/agoo/http.c",
      "ext/agoo/req.h",
      "ext/agoo/request.c",
      "ext/agoo/server.c",
      "ext/agoo/websocket.c",
      "lib/agoo/version.rb",
      "test/base_handler_test.rb",
      "test/rack_handler_test.rb"
    ],
    "message": "Remote addr (#99)\n\n* REMOTE_ADDR added\n\n* Ready for merge",
    "before_after_code_files": [
      "ext/agoo/con.c||ext/agoo/con.c",
      "ext/agoo/con.h||ext/agoo/con.h",
      "ext/agoo/http.c||ext/agoo/http.c",
      "ext/agoo/req.h||ext/agoo/req.h",
      "ext/agoo/request.c||ext/agoo/request.c",
      "ext/agoo/server.c||ext/agoo/server.c",
      "ext/agoo/websocket.c||ext/agoo/websocket.c",
      "lib/agoo/version.rb||lib/agoo/version.rb",
      "test/base_handler_test.rb||test/base_handler_test.rb",
      "test/rack_handler_test.rb||test/rack_handler_test.rb"
    ]
  },
  "patch_diff": {
    "ext/agoo/con.c||ext/agoo/con.c": [
      "File: ext/agoo/con.c -> ext/agoo/con.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "63:     if (NULL == (c = (agooCon)AGOO_CALLOC(1, sizeof(struct _agooCon)))) {",
      "64:  AGOO_ERR_MEM(err, \"Connection\");",
      "65:     } else {",
      "66:  c->sock = sock;",
      "67:  c->id = id;",
      "68:  c->timeout = dtime() + CON_TIMEOUT;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "69:  struct sockaddr_storage addr;",
      "70:  socklen_t  len = sizeof(addr);",
      "72:  getpeername(sock, (struct sockaddr*)&addr, &len);",
      "73:  if (addr.ss_family == AF_INET) {",
      "74:      struct sockaddr_in *s = (struct sockaddr_in*)&addr;",
      "76:      inet_ntop(AF_INET, &s->sin_addr, c->remote, sizeof(c->remote));",
      "77:  } else {",
      "78:      struct sockaddr_in6 *s = (struct sockaddr_in6*)&addr;",
      "80:      inet_ntop(AF_INET6, &s->sin6_addr, c->remote, sizeof(c->remote));",
      "81:  }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "437:     c->req->method = method;",
      "438:     c->req->upgrade = AGOO_UP_NONE;",
      "439:     c->req->up = NULL;",
      "440:     c->req->path.start = c->req->msg + (path.start - c->buf);",
      "441:     c->req->path.len = (int)(path.end - path.start);",
      "442:     c->req->query.start = c->req->msg + (query - c->buf);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "456:     memcpy(c->req->remote, c->remote, sizeof(c->remote));",
      "",
      "---------------"
    ],
    "ext/agoo/con.h||ext/agoo/con.h": [
      "File: ext/agoo/con.h -> ext/agoo/con.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "3: #ifndef AGOO_CON_H",
      "4: #define AGOO_CON_H",
      "6: #include <poll.h>",
      "7: #include <pthread.h>",
      "8: #include <stdbool.h>",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "6: #include <arpa/inet.h>",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "45:     struct _agooBind  *bind;",
      "46:     struct pollfd  *pp;",
      "47:     uint64_t   id;",
      "48:     char   buf[MAX_HEADER_SIZE];",
      "49:     size_t   bcnt;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "49:     char   remote[INET6_ADDRSTRLEN];",
      "",
      "---------------"
    ],
    "ext/agoo/http.c||ext/agoo/http.c": [
      "File: ext/agoo/http.c -> ext/agoo/http.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "50:     \"Accept-Encoding\",",
      "51:     \"Accept-Features\",",
      "52:     \"Accept-Language\",",
      "54:     \"Accept-Patch\",",
      "55:     \"Accept-Post\",",
      "56:     \"Accept-Ranges\",",
      "",
      "[Removed Lines]",
      "53:     \"Accept-Language\",",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "74:     \"Approved\",",
      "75:     \"Archive\",",
      "76:     \"Archived-At\",",
      "78:     \"Article-Names\",",
      "79:     \"Article-Updates\",",
      "80:     \"Authentication-Control\",",
      "",
      "[Removed Lines]",
      "77:     \"Archived-At\",",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "99:     \"Cc\",",
      "100:     \"Close\",",
      "101:     \"Comments\",",
      "103:     \"Compliance\",",
      "104:     \"Connection\",",
      "105:     \"Content-Alternative\",",
      "106:     \"Content-Base\",",
      "108:     \"Content-Description\",",
      "109:     \"Content-Disposition\",",
      "111:     \"Content-Duration\",",
      "112:     \"Content-Encoding\",",
      "113:     \"Content-ID\",",
      "115:     \"Content-Identifier\",",
      "116:     \"Content-Language\",",
      "118:     \"Content-Length\",",
      "119:     \"Content-Location\",",
      "122:     \"Content-MD5\",",
      "123:     \"Content-Range\",",
      "124:     \"Content-Return\",",
      "125:     \"Content-Script-Type\",",
      "126:     \"Content-Style-Type\",",
      "127:     \"Content-Transfer-Encoding\",",
      "129:     \"Content-Translation-Type\",",
      "130:     \"Content-Type\",",
      "132:     \"Content-Version\",",
      "133:     \"Content-features\",",
      "134:     \"Control\",",
      "",
      "[Removed Lines]",
      "102:     \"Comments\",",
      "107:     \"Content-Base\",",
      "110:     \"Content-Disposition\",",
      "114:     \"Content-ID\",",
      "117:     \"Content-Language\",",
      "120:     \"Content-Location\",",
      "121:     \"Content-MD5\",",
      "128:     \"Content-Transfer-Encoding\",",
      "131:     \"Content-Type\",",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "141:     \"DAV\",",
      "142:     \"DKIM-Signature\",",
      "143:     \"DL-Expansion-History\",",
      "146:     \"Date\",",
      "147:     \"Date-Received\",",
      "148:     \"Default-Style\",",
      "",
      "[Removed Lines]",
      "144:     \"Date\",",
      "145:     \"Date\",",
      "",
      "[Added Lines]",
      "133:     \"DNT\",",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "182:     \"Downgraded-Sender\",",
      "183:     \"Downgraded-To\",",
      "184:     \"EDIINT-Features\",",
      "186:     \"ETag\",",
      "187:     \"Eesst-Version\",",
      "188:     \"Encoding\",",
      "",
      "[Removed Lines]",
      "185:     \"EDIINT-Features\",",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "190:     \"Errors-To\",",
      "191:     \"Expect\",",
      "192:     \"Expires\",",
      "195:     \"Expiry-Date\",",
      "196:     \"Ext\",",
      "197:     \"Followup-To\",",
      "198:     \"Form-Sub\",",
      "199:     \"Forwarded\",",
      "200:     \"From\",",
      "203:     \"Generate-Delivery-Report\",",
      "204:     \"GetProfile\",",
      "205:     \"HTTP2-Settings\",",
      "",
      "[Removed Lines]",
      "193:     \"Expires\",",
      "194:     \"Expires\",",
      "201:     \"From\",",
      "202:     \"From\",",
      "",
      "[Added Lines]",
      "186:     \"Front-End-Https\",",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "219:     \"Injection-Date\",",
      "220:     \"Injection-Info\",",
      "221:     \"Jabber-ID\",",
      "223:     \"Keep-Alive\",",
      "224:     \"Keywords\",",
      "226:     \"Label\",",
      "227:     \"Language\",",
      "228:     \"Last-Modified\",",
      "",
      "[Removed Lines]",
      "222:     \"Jabber-ID\",",
      "225:     \"Keywords\",",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 8 ---",
      "[Context before]",
      "240:     \"Location\",",
      "241:     \"Lock-Token\",",
      "242:     \"MIME-Version\",",
      "244:     \"MMHS-Acp127-Message-Identifier\",",
      "245:     \"MMHS-Authorizing-Users\",",
      "246:     \"MMHS-Codress-Message-Indicator\",",
      "",
      "[Removed Lines]",
      "243:     \"MIME-Version\",",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 9 ---",
      "[Context before]",
      "262:     \"Memento-Datetime\",",
      "263:     \"Message-Context\",",
      "264:     \"Message-ID\",",
      "267:     \"Message-Type\",",
      "268:     \"Meter\",",
      "269:     \"Method-Check\",",
      "",
      "[Removed Lines]",
      "265:     \"Message-ID\",",
      "266:     \"Message-ID\",",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 10 ---",
      "[Context before]",
      "279:     \"Optional-WWW-Authenticate\",",
      "280:     \"Ordering-Type\",",
      "281:     \"Organization\",",
      "283:     \"Origin\",",
      "284:     \"Original-Encoded-Information-Types\",",
      "285:     \"Original-From\",",
      "",
      "[Removed Lines]",
      "282:     \"Organization\",",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 11 ---",
      "[Context before]",
      "292:     \"P3P\",",
      "293:     \"PEP\",",
      "294:     \"PICS-Label\",",
      "296:     \"Path\",",
      "297:     \"Pep-Info\",",
      "298:     \"Position\",",
      "",
      "[Removed Lines]",
      "295:     \"PICS-Label\",",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 12 ---",
      "[Context before]",
      "311:     \"Proxy-Authenticate\",",
      "312:     \"Proxy-Authentication-Info\",",
      "313:     \"Proxy-Authorization\",",
      "314:     \"Proxy-Features\",",
      "315:     \"Proxy-Instruction\",",
      "316:     \"Public\",",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "291:     \"Proxy-Connection\",",
      "",
      "---------------",
      "--- Hunk 13 ---",
      "[Context before]",
      "321:     \"Received-SPF\",",
      "322:     \"Redirect-Ref\",",
      "323:     \"References\",",
      "325:     \"Referer\",",
      "326:     \"Referer-Root\",",
      "327:     \"Relay-Version\",",
      "328:     \"Reply-By\",",
      "329:     \"Reply-To\",",
      "331:     \"Require-Recipient-Valid-Since\",",
      "332:     \"Resent-Bcc\",",
      "333:     \"Resent-Cc\",",
      "",
      "[Removed Lines]",
      "324:     \"References\",",
      "330:     \"Reply-To\",",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 14 ---",
      "[Context before]",
      "345:     \"SIO-Label-History\",",
      "346:     \"SLUG\",",
      "347:     \"Safe\",",
      "348:     \"Schedule-Reply\",",
      "349:     \"Schedule-Tag\",",
      "350:     \"Sec-WebSocket-Accept\",",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "324:     \"Save-Data\",",
      "",
      "---------------",
      "--- Hunk 15 ---",
      "[Context before]",
      "367:     \"Strict-Transport-Security\",",
      "368:     \"SubOK\",",
      "369:     \"Subject\",",
      "371:     \"Subst\",",
      "372:     \"Summary\",",
      "373:     \"Supersedes\",",
      "375:     \"Surrogate-Capability\",",
      "376:     \"Surrogate-Control\",",
      "377:     \"TCN\",",
      "",
      "[Removed Lines]",
      "370:     \"Subject\",",
      "374:     \"Supersedes\",",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 16 ---",
      "[Context before]",
      "390:     \"UA-Windowpixels\",",
      "391:     \"URI\",",
      "392:     \"Upgrade\",",
      "393:     \"Urgency\",",
      "394:     \"User-Agent\",",
      "396:     \"VBR-Info\",",
      "397:     \"Variant-Vary\",",
      "398:     \"Vary\",",
      "",
      "[Removed Lines]",
      "395:     \"User-Agent\",",
      "",
      "[Added Lines]",
      "368:     \"Upgrade-Insecure-Requests\",",
      "",
      "---------------",
      "--- Hunk 17 ---",
      "[Context before]",
      "401:     \"WWW-Authenticate\",",
      "402:     \"Want-Digest\",",
      "403:     \"Warning\",",
      "405:     \"X-Archived-At\",",
      "406:     \"X-Content-Type-Options\",",
      "407:     \"X-Device-Accept\",",
      "408:     \"X-Device-Accept-Charset\",",
      "409:     \"X-Device-Accept-Encoding\",",
      "410:     \"X-Device-Accept-Language\",",
      "411:     \"X-Device-User-Agent\",",
      "412:     \"X-Frame-Options\",",
      "413:     \"X-Mittente\",",
      "414:     \"X-PGP-Sig\",",
      "415:     \"X-Ricevuta\",",
      "416:     \"X-Riferimento-Message-ID\",",
      "417:     \"X-TipoRicevuta\",",
      "418:     \"X-Trasporto\",",
      "419:     \"X-VerificaSicurezza\",",
      "420:     \"X-XSS-Protection\",",
      "421:     \"X400-Content-Identifier\",",
      "422:     \"X400-Content-Return\",",
      "",
      "[Removed Lines]",
      "404:     \"X-Archived-At\",",
      "",
      "[Added Lines]",
      "379:     \"X-ATT-DeviceId\",",
      "382:     \"X-Correlation-ID\",",
      "383:     \"X-Csrf-Token\",",
      "389:     \"X-Forwarded-For\",",
      "390:     \"X-Forwarded-Host\",",
      "391:     \"X-Forwarded-Proto\",",
      "393:     \"X-Http-Method-Override\",",
      "396:     \"X-Request-ID\",",
      "397:     \"X-Requested-With\",",
      "402:     \"X-UIDH\",",
      "404:     \"X-Wap-Profile\",",
      "",
      "---------------"
    ],
    "ext/agoo/req.h||ext/agoo/req.h": [
      "File: ext/agoo/req.h -> ext/agoo/req.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "3: #ifndef AGOO_REQ_H",
      "4: #define AGOO_REQ_H",
      "6: #include <stdint.h>",
      "8: #include \"hook.h\"",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "6: #include <arpa/inet.h>",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "32:     struct _agooStr  query;",
      "33:     struct _agooStr  header;",
      "34:     struct _agooStr  body;",
      "35:     void   *env;",
      "36:     agooHook   hook;",
      "37:     size_t   mlen;   // allocated msg length",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "36:     char   remote[INET6_ADDRSTRLEN];",
      "",
      "---------------"
    ],
    "ext/agoo/request.c||ext/agoo/request.c": [
      "File: ext/agoo/request.c -> ext/agoo/request.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "43: static VALUE rack_url_scheme_val = Qundef;",
      "44: static VALUE rack_version_val = Qundef;",
      "45: static VALUE rack_version_val_val = Qundef;",
      "46: static VALUE request_method_val = Qundef;",
      "47: static VALUE script_name_val = Qundef;",
      "48: static VALUE server_name_val = Qundef;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "46: static VALUE remote_addr_val = Qundef;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "96:     return req_method((agooReq)DATA_PTR(self));",
      "97: }",
      "99: static VALUE",
      "100: req_script_name(agooReq r) {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "100: static VALUE",
      "101: req_remote_addr(agooReq r) {",
      "103:     if (NULL == r) {",
      "104:  rb_raise(rb_eArgError, \"Request is no longer valid.\");",
      "105:     }",
      "106:     return rb_str_new(r->remote, strlen(r->remote));",
      "107: }",
      "115: static VALUE",
      "116: remote_addr(VALUE self) {",
      "117:     return req_remote_addr((agooReq)DATA_PTR(self));",
      "118: }",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "367: static void",
      "368: add_header_value(VALUE hh, const char *key, int klen, const char *val, int vlen) {",
      "369:     if (sizeof(content_type) - 1 == klen && 0 == strncasecmp(key, content_type, sizeof(content_type) - 1)) {",
      "371:     } else if (sizeof(content_length) - 1 == klen && 0 == strncasecmp(key, content_length, sizeof(content_length) - 1)) {",
      "373:     } else {",
      "374:  char  hkey[1024];",
      "375:  char  *k = hkey;",
      "376:  volatile VALUE sval = rb_str_new(val, vlen);",
      "378:  strcpy(hkey, \"HTTP_\");",
      "379:  k = hkey + 5;",
      "",
      "[Removed Lines]",
      "370:  rb_hash_aset(hh, content_type_val, rb_str_new(val, vlen));",
      "372:  rb_hash_aset(hh, content_length_val, rb_str_new(val, vlen));",
      "",
      "[Added Lines]",
      "391:     VALUE v;",
      "394:  if (Qnil == (v = rb_hash_lookup2(hh, content_type_val, Qnil))) {",
      "395:      rb_hash_aset(hh, content_type_val, rb_str_new(val, vlen));",
      "396:  } else {",
      "397:      volatile VALUE a = rb_ary_new();",
      "399:      rb_ary_push(a, v);",
      "400:      rb_ary_push(a, rb_str_new(val, vlen));",
      "401:      rb_hash_aset(hh, content_type_val, a);",
      "402:  }",
      "404:  if (Qnil == (v = rb_hash_lookup2(hh, content_length_val, Qnil))) {",
      "405:      rb_hash_aset(hh, content_length_val, rb_str_new(val, vlen));",
      "406:  } else {",
      "407:      rb_raise(rb_eArgError, \"Multiple Content-Length headers.\");",
      "408:  }",
      "413:  volatile VALUE kval;",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "393:      }",
      "394:  }",
      "396:     }",
      "397: }",
      "",
      "[Removed Lines]",
      "395:  rb_hash_aset(hh, rb_str_new(hkey, klen + 5), sval);",
      "",
      "[Added Lines]",
      "432:  kval = rb_str_new(hkey, klen + 5);",
      "433:  if (Qnil == (v = rb_hash_lookup2(hh, kval, Qnil))) {",
      "434:      rb_hash_aset(hh, kval, sval);",
      "435:  } else {",
      "436:      volatile VALUE a = rb_ary_new();",
      "438:      rb_ary_push(a, v);",
      "439:      rb_ary_push(a, sval);",
      "440:      rb_hash_aset(hh, kval, a);",
      "441:  }",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "545:  rb_hash_aset(env, script_name_val, req_script_name(req));",
      "546:  rb_hash_aset(env, path_info_val, req_path_info(req));",
      "547:  rb_hash_aset(env, query_string_val, req_query_string(req));",
      "549:  rb_hash_aset(env, server_port_val, req_server_port(req));",
      "550:  fill_headers(req, env);",
      "551:  rb_hash_aset(env, rack_version_val, rack_version_val_val);",
      "552:  rb_hash_aset(env, rack_url_scheme_val, req_rack_url_scheme(req));",
      "",
      "[Removed Lines]",
      "548:  rb_hash_aset(env, server_name_val, req_server_name(req));",
      "",
      "[Added Lines]",
      "594:  rb_hash_aset(env, remote_addr_val, req_remote_addr(req));",
      "596:  rb_hash_aset(env, server_name_val, req_server_name(req));",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "663:     rb_define_method(req_class, \"query_string\", query_string, 0);",
      "664:     rb_define_method(req_class, \"server_name\", server_name, 0);",
      "665:     rb_define_method(req_class, \"server_port\", server_port, 0);",
      "666:     rb_define_method(req_class, \"rack_version\", rack_version, 0);",
      "667:     rb_define_method(req_class, \"rack_url_scheme\", rack_url_scheme, 0);",
      "668:     rb_define_method(req_class, \"rack_input\", rack_input, 0);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "713:     rb_define_method(req_class, \"remote_addr\", remote_addr, 0);",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "713:     rack_upgrade_val = rb_str_new_cstr(\"rack.upgrade?\"); rb_gc_register_address(&rack_upgrade_val);",
      "714:     rack_url_scheme_val = rb_str_new_cstr(\"rack.url_scheme\"); rb_gc_register_address(&rack_url_scheme_val);",
      "715:     rack_version_val = rb_str_new_cstr(\"rack.version\");  rb_gc_register_address(&rack_version_val);",
      "716:     request_method_val = rb_str_new_cstr(\"REQUEST_METHOD\"); rb_gc_register_address(&request_method_val);",
      "717:     script_name_val = rb_str_new_cstr(\"SCRIPT_NAME\");  rb_gc_register_address(&script_name_val);",
      "718:     server_name_val = rb_str_new_cstr(\"SERVER_NAME\");  rb_gc_register_address(&server_name_val);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "764:     remote_addr_val = rb_str_new_cstr(\"REMOTE_ADDR\");  rb_gc_register_address(&remote_addr_val);",
      "",
      "---------------"
    ],
    "ext/agoo/server.c||ext/agoo/server.c": [
      "File: ext/agoo/server.c -> ext/agoo/server.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "161:       setsockopt(client_sock, SOL_SOCKET, SO_KEEPALIVE, &optval, sizeof(optval));",
      "162:       setsockopt(client_sock, IPPROTO_TCP, TCP_NODELAY, &optval, sizeof(optval));",
      "166:       con_cnt = atomic_fetch_add(&agoo_server.con_cnt, 1);",
      "167:       if (agoo_server.loop_max > agoo_server.loop_cnt && agoo_server.loop_cnt * LOOP_UP < con_cnt) {",
      "",
      "[Removed Lines]",
      "163:       agoo_log_cat(&agoo_con_cat, \"Server with pid %d accepted connection %llu on %s [%d]\",",
      "164:      getpid(), (unsigned long long)cnt, b->id, con->sock);",
      "",
      "[Added Lines]",
      "163:       agoo_log_cat(&agoo_con_cat, \"Server with pid %d accepted connection %llu on %s [%d] from %s\",",
      "164:      getpid(), (unsigned long long)cnt, b->id, con->sock, con->remote);",
      "",
      "---------------"
    ],
    "ext/agoo/websocket.c||ext/agoo/websocket.c": [
      "File: ext/agoo/websocket.c -> ext/agoo/websocket.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "189:     c->req->method = (AGOO_WS_OP_BIN == op) ? AGOO_ON_BIN : AGOO_ON_MSG;",
      "190:     c->req->upgrade = AGOO_UP_NONE;",
      "191:     c->req->up = c->up;",
      "192:     c->req->res = NULL;",
      "193:     if (c->up->on_msg) {",
      "194:  c->req->hook = agoo_hook_create(AGOO_NONE, NULL, c->up->ctx, PUSH_HOOK, &agoo_server.eval_queue);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "192:     memcpy(c->req->remote, c->remote, sizeof(c->remote));",
      "",
      "---------------"
    ],
    "lib/agoo/version.rb||lib/agoo/version.rb": [
      "File: lib/agoo/version.rb -> lib/agoo/version.rb",
      "--- Hunk 1 ---",
      "[Context before]",
      "2: module Agoo",
      "3:   # Agoo version.",
      "5: end",
      "",
      "[Removed Lines]",
      "4:   VERSION = '2.13.0'",
      "",
      "[Added Lines]",
      "4:   VERSION = '2.14.0'",
      "",
      "---------------"
    ],
    "test/base_handler_test.rb||test/base_handler_test.rb": [
      "File: test/base_handler_test.rb -> test/base_handler_test.rb"
    ],
    "test/rack_handler_test.rb||test/rack_handler_test.rb": [
      "File: test/rack_handler_test.rb -> test/rack_handler_test.rb",
      "--- Hunk 1 ---",
      "[Context before]",
      "105:       \"PATH_INFO\" => \"/tellme\",",
      "106:       \"QUERY_STRING\" => \"a=1\",",
      "107:       \"REQUEST_METHOD\" => \"GET\",",
      "108:       \"SCRIPT_NAME\" => \"\",",
      "109:       \"SERVER_NAME\" => \"localhost\",",
      "110:       \"SERVER_PORT\" => \"6467\",",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "108:       \"REMOTE_ADDR\" => \"127.0.0.1\",",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "f1975c3610fdde601da55bf006297fc99270756a",
      "candidate_info": {
        "commit_hash": "f1975c3610fdde601da55bf006297fc99270756a",
        "repo": "ohler55/agoo",
        "commit_url": "https://github.com/ohler55/agoo/commit/f1975c3610fdde601da55bf006297fc99270756a",
        "files": [
          "CHANGELOG.md",
          "ext/agoo/bind.c",
          "lib/agoo/version.rb"
        ],
        "message": "Protect SO_REUSEPORT use",
        "before_after_code_files": [
          "ext/agoo/bind.c||ext/agoo/bind.c",
          "lib/agoo/version.rb||liagoo/version.rb"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "lib/agoo/version.rb||lib/agoo/version.rb"
          ],
          "candidate": [
            "lib/agoo/version.rb||liagoo/version.rb"
          ]
        }
      },
      "candidate_diff": {
        "ext/agoo/bind.c||ext/agoo/bind.c": [
          "File: ext/agoo/bind.c -> ext/agoo/bind.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "286: #ifdef OSX_OS",
          "287:     setsockopt(b->fd, SOL_SOCKET, SO_NOSIGPIPE, &optval, sizeof(optval));",
          "288: #endif",
          "289:     setsockopt(b->fd, SOL_SOCKET, SO_REUSEPORT, &optval, sizeof(optval));",
          "290:     setsockopt(b->fd, IPPROTO_TCP, TCP_NODELAY, &optval, sizeof(optval));",
          "291:     if (AF_INET6 == b->family) {",
          "292:  struct sockaddr_in6 addr;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "289: #ifdef SO_REUSEPORT",
          "291: #endif",
          "",
          "---------------"
        ],
        "lib/agoo/version.rb||liagoo/version.rb": [
          "File: lib/agoo/version.rb -> liagoo/version.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "2: module Agoo",
          "3:   # Agoo version.",
          "5: end",
          "",
          "[Removed Lines]",
          "4:   VERSION = '2.12.0'",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "3b5ea57a3f71aa208114f755bd8478dd25bdb730",
      "candidate_info": {
        "commit_hash": "3b5ea57a3f71aa208114f755bd8478dd25bdb730",
        "repo": "ohler55/agoo",
        "commit_url": "https://github.com/ohler55/agoo/commit/3b5ea57a3f71aa208114f755bd8478dd25bdb730",
        "files": [
          "CHANGELOG.md",
          "lib/agoo/version.rb"
        ],
        "message": "Release prep",
        "before_after_code_files": [
          "lib/agoo/version.rb||lib/agoo/version.rb"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "lib/agoo/version.rb||lib/agoo/version.rb"
          ],
          "candidate": [
            "lib/agoo/version.rb||lib/agoo/version.rb"
          ]
        }
      },
      "candidate_diff": {
        "lib/agoo/version.rb||lib/agoo/version.rb": [
          "File: lib/agoo/version.rb -> lib/agoo/version.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "2: module Agoo",
          "3:   # Agoo version.",
          "5: end",
          "",
          "[Removed Lines]",
          "4:   VERSION = '2.14.0'",
          "",
          "[Added Lines]",
          "4:   VERSION = '2.14.1'",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "1888878d3aca3e3c257bfc5d247ceee683756980",
      "candidate_info": {
        "commit_hash": "1888878d3aca3e3c257bfc5d247ceee683756980",
        "repo": "ohler55/agoo",
        "commit_url": "https://github.com/ohler55/agoo/commit/1888878d3aca3e3c257bfc5d247ceee683756980",
        "files": [
          "CHANGELOG.md",
          "ext/agoo/gqlintro.c",
          "lib/agoo/version.rb"
        ],
        "message": "__Field deprecatedReason is no longer listed as 'reason'",
        "before_after_code_files": [
          "ext/agoo/gqlintro.c||ext/agoo/gqlintro.c",
          "lib/agoo/version.rb||lib/agoo/version.rb"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "lib/agoo/version.rb||lib/agoo/version.rb"
          ],
          "candidate": [
            "lib/agoo/version.rb||lib/agoo/version.rb"
          ]
        }
      },
      "candidate_diff": {
        "ext/agoo/gqlintro.c||ext/agoo/gqlintro.c": [
          "File: ext/agoo/gqlintro.c -> ext/agoo/gqlintro.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "162:  NULL == gql_type_field(err, type, \"args\", input_list, NULL, NULL, 0, true) ||",
          "163:  NULL == gql_type_field(err, type, \"type\", type_type, NULL, NULL, 0, true) ||",
          "164:  NULL == gql_type_field(err, type, \"isDeprecated\", &gql_bool_type, NULL, NULL, 0, true) ||",
          "167:  return err->code;",
          "168:     }",
          "",
          "[Removed Lines]",
          "165:  NULL == gql_type_field(err, type, \"reason\", &gql_string_type, NULL, NULL, 0, false)) {",
          "",
          "[Added Lines]",
          "165:  NULL == gql_type_field(err, type, \"deprecationReason\", &gql_string_type, NULL, NULL, 0, false)) {",
          "",
          "---------------"
        ],
        "lib/agoo/version.rb||lib/agoo/version.rb": [
          "File: lib/agoo/version.rb -> lib/agoo/version.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "2: module Agoo",
          "3:   # Agoo version.",
          "5: end",
          "",
          "[Removed Lines]",
          "4:   VERSION = '2.11.3'",
          "",
          "[Added Lines]",
          "4:   VERSION = '2.11.4'",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "9c0a5c71f16ef62009e302414a15a32e42ca19db",
      "candidate_info": {
        "commit_hash": "9c0a5c71f16ef62009e302414a15a32e42ca19db",
        "repo": "ohler55/agoo",
        "commit_url": "https://github.com/ohler55/agoo/commit/9c0a5c71f16ef62009e302414a15a32e42ca19db",
        "files": [
          "CHANGELOG.md",
          "ext/agoo/rgraphql.c",
          "ext/agoo/rserver.c",
          "lib/agoo/version.rb"
        ],
        "message": "rescue2 termination change",
        "before_after_code_files": [
          "ext/agoo/rgraphql.c||ext/agoo/rgraphql.c",
          "ext/agoo/rserver.c||ext/agoo/rserver.c",
          "lib/agoo/version.rb||liagoo/version.rb"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "lib/agoo/version.rb||lib/agoo/version.rb"
          ],
          "candidate": [
            "lib/agoo/version.rb||liagoo/version.rb"
          ]
        }
      },
      "candidate_diff": {
        "ext/agoo/rgraphql.c||ext/agoo/rgraphql.c": [
          "File: ext/agoo/rgraphql.c -> ext/agoo/rgraphql.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "105: static void*",
          "106: protect_eval(void *x) {",
          "109:     return NULL;",
          "110: }",
          "",
          "[Removed Lines]",
          "107:     rb_rescue2(call_eval, (VALUE)x, rescue_error, (VALUE)x, rb_eException, 0);",
          "",
          "[Added Lines]",
          "107:     rb_rescue2(call_eval, (VALUE)x, rescue_error, (VALUE)x, rb_eException, (VALUE)0);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "682:  printf(\"*-*-* %s\\n\", err.msg);",
          "683:  exit(6);",
          "684:     }",
          "686:     if (AGOO_ERR_OK != err.code) {",
          "687:  printf(\"*-*-* %s\\n\", err.msg);",
          "688:  exit(7);",
          "",
          "[Removed Lines]",
          "685:     rb_rescue2(rescue_yield, Qnil, rescue_yield_error, (VALUE)&err, rb_eException, 0);",
          "",
          "[Added Lines]",
          "685:     rb_rescue2(rescue_yield, Qnil, rescue_yield_error, (VALUE)&err, rb_eException, (VALUE)0);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "953: static void*",
          "954: protected_build_headers(void *x) {",
          "956: }",
          "958: static agooText",
          "",
          "[Removed Lines]",
          "955:     return (void*)rb_rescue2(inner_build_headers, (VALUE)x, rescue_build_header, (VALUE)x, rb_eException, 0);",
          "",
          "[Added Lines]",
          "955:     return (void*)rb_rescue2(inner_build_headers, (VALUE)x, rescue_build_header, (VALUE)x, rb_eException, (VALUE)0);",
          "",
          "---------------"
        ],
        "ext/agoo/rserver.c||ext/agoo/rserver.c": [
          "File: ext/agoo/rserver.c -> ext/agoo/rserver.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "385: static void*",
          "386: handle_base(void *x) {",
          "389:     return NULL;",
          "390: }",
          "",
          "[Removed Lines]",
          "387:     rb_rescue2(handle_base_inner, (VALUE)x, rescue_error, (VALUE)x, rb_eException, 0);",
          "",
          "[Added Lines]",
          "387:     rb_rescue2(handle_base_inner, (VALUE)x, rescue_error, (VALUE)x, rb_eException, (VALUE)0);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "613: static void*",
          "614: handle_rack(void *x) {",
          "",
          "[Removed Lines]",
          "616:     rb_rescue2(handle_rack_inner, (VALUE)x, rescue_error, (VALUE)x, rb_eException, 0);",
          "",
          "[Added Lines]",
          "616:     rb_rescue2(handle_rack_inner, (VALUE)x, rescue_error, (VALUE)x, rb_eException, (VALUE)0);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "639: static void*",
          "640: handle_wab(void *x) {",
          "643:     return NULL;",
          "644: }",
          "",
          "[Removed Lines]",
          "641:     rb_rescue2(handle_wab_inner, (VALUE)x, rescue_error, (VALUE)x, rb_eException, 0);",
          "",
          "[Added Lines]",
          "641:     rb_rescue2(handle_wab_inner, (VALUE)x, rescue_error, (VALUE)x, rb_eException, (VALUE)0);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "697: static void*",
          "698: handle_push(void *x) {",
          "700:     return NULL;",
          "701: }",
          "",
          "[Removed Lines]",
          "699:     rb_rescue2(handle_push_inner, (VALUE)x, rescue_error, (VALUE)x, rb_eException, 0);",
          "",
          "[Added Lines]",
          "699:     rb_rescue2(handle_push_inner, (VALUE)x, rescue_error, (VALUE)x, rb_eException, (VALUE)0);",
          "",
          "---------------"
        ],
        "lib/agoo/version.rb||liagoo/version.rb": [
          "File: lib/agoo/version.rb -> liagoo/version.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "2: module Agoo",
          "3:   # Agoo version.",
          "5: end",
          "",
          "[Removed Lines]",
          "4:   VERSION = '2.12.2'",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "e9ccb5a851a283fe1fd8dad50f74b4f748075390",
      "candidate_info": {
        "commit_hash": "e9ccb5a851a283fe1fd8dad50f74b4f748075390",
        "repo": "ohler55/agoo",
        "commit_url": "https://github.com/ohler55/agoo/commit/e9ccb5a851a283fe1fd8dad50f74b4f748075390",
        "files": [
          "CHANGELOG.md",
          "ext/agoo/con.c",
          "ext/agoo/doc.c",
          "ext/agoo/gqleval.c",
          "ext/agoo/gqljson.c",
          "ext/agoo/graphql.h",
          "ext/agoo/page.c",
          "ext/agoo/pub.c",
          "ext/agoo/rgraphql.c",
          "ext/agoo/rserver.c",
          "ext/agoo/sdl.c",
          "ext/agoo/sectime.c",
          "lib/agoo/version.rb",
          "test/graphql_test.rb"
        ],
        "message": "Missing option variable bug fixed",
        "before_after_code_files": [
          "ext/agoo/con.c||ext/agoo/con.c",
          "ext/agoo/doc.c||ext/agoo/doc.c",
          "ext/agoo/gqleval.c||ext/agoo/gqleval.c",
          "ext/agoo/gqljson.c||ext/agoo/gqljson.c",
          "ext/agoo/graphql.h||ext/agoo/graphql.h",
          "ext/agoo/page.c||ext/agoo/page.c",
          "ext/agoo/pub.c||ext/agoo/pub.c",
          "ext/agoo/rgraphql.c||ext/agoo/rgraphql.c",
          "ext/agoo/rserver.c||ext/agoo/rserver.c",
          "ext/agoo/sdl.c||ext/agoo/sdl.c",
          "ext/agoo/sectime.c||ext/agoo/sectime.c",
          "lib/agoo/version.rb||lib/agoo/version.rb",
          "test/graphql_test.rb||test/graphql_test.rb"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/agoo/con.c||ext/agoo/con.c",
            "lib/agoo/version.rb||lib/agoo/version.rb"
          ],
          "candidate": [
            "ext/agoo/con.c||ext/agoo/con.c",
            "lib/agoo/version.rb||lib/agoo/version.rb"
          ]
        }
      },
      "candidate_diff": {
        "ext/agoo/con.c||ext/agoo/con.c": [
          "File: ext/agoo/con.c -> ext/agoo/con.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "509:     if (AGOO_CON_HTTPS == c->bind->kind) {",
          "510: #ifdef HAVE_OPENSSL_SSL_H",
          "511:  if (NULL != c->req) {",
          "513:  } else {",
          "515:  }",
          "516:  if (0 > cnt) {",
          "520:      if (0 == e) {",
          "521:   return false;",
          "",
          "[Removed Lines]",
          "512:      cnt = SSL_read(c->ssl, c->req->msg + c->bcnt, c->req->mlen - c->bcnt);",
          "514:      cnt = SSL_read(c->ssl, c->buf + c->bcnt, sizeof(c->buf) - c->bcnt - 1);",
          "518:      int  e = ERR_get_error();",
          "",
          "[Added Lines]",
          "512:      cnt = SSL_read(c->ssl, c->req->msg + c->bcnt, (int)(c->req->mlen - c->bcnt));",
          "514:      cnt = SSL_read(c->ssl, c->buf + c->bcnt, (int)(sizeof(c->buf) - c->bcnt - 1));",
          "518:      int  e = (int)ERR_get_error();",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "661:     }",
          "662:     if (AGOO_CON_HTTPS == c->bind->kind) {",
          "663: #ifdef HAVE_OPENSSL_SSL_H",
          "665:      unsigned long e = ERR_get_error();",
          "667:      if (0 == e) {",
          "",
          "[Removed Lines]",
          "664:  if (0 >= (cnt = SSL_write(c->ssl, message->text + c->wcnt, message->len - c->wcnt))) {",
          "",
          "[Added Lines]",
          "664:  if (0 >= (cnt = SSL_write(c->ssl, message->text + c->wcnt, (int)(message->len - c->wcnt)))) {",
          "",
          "---------------"
        ],
        "ext/agoo/doc.c||ext/agoo/doc.c": [
          "File: ext/agoo/doc.c -> ext/agoo/doc.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "340:  doc->cur++;",
          "341:  start++;",
          "342:  agoo_doc_read_token(doc);",
          "344:  break;",
          "345:     case '\"': {",
          "346:  const char *end;",
          "",
          "[Removed Lines]",
          "343:  value = gql_var_create(err, start, doc->cur - start);",
          "",
          "[Added Lines]",
          "343:  value = gql_var_create(err, start, (int)(doc->cur - start));",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "355:  } else {",
          "356:      end = doc->cur - 1;",
          "357:  }",
          "359:  break;",
          "360:     }",
          "361:     case '-':",
          "",
          "[Removed Lines]",
          "358:  value = gql_string_create(err, start, end - start);",
          "",
          "[Added Lines]",
          "358:  value = gql_string_create(err, start, (int)(end - start));",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "377:  if (doc->cur - start == 4 && 0 == strncmp(\"null\", start, 4)) {",
          "378:      value = gql_null_create(err);",
          "379:  } else {",
          "381:  }",
          "382:  break;",
          "383:     case 't':",
          "",
          "[Removed Lines]",
          "380:      value = gql_token_create(err, start, doc->cur - start, type);",
          "",
          "[Added Lines]",
          "380:      value = gql_token_create(err, start, (int)(doc->cur - start), type);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "385:  if (doc->cur - start == 4 && 0 == strncmp(\"true\", start, 4)) {",
          "386:      value = gql_bool_create(err, true);",
          "387:  } else {",
          "389:  }",
          "390:  break;",
          "391:     case 'f':",
          "",
          "[Removed Lines]",
          "388:      value = gql_token_create(err, start, doc->cur - start, type);",
          "",
          "[Added Lines]",
          "388:      value = gql_token_create(err, start, (int)(doc->cur - start), type);",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "393:  if (doc->cur - start == 5 && 0 == strncmp(\"false\", start, 5)) {",
          "394:      value = gql_bool_create(err, false);",
          "395:  } else {",
          "397:  }",
          "398:  break;",
          "399:     case '[':",
          "",
          "[Removed Lines]",
          "396:      value = gql_token_create(err, start, doc->cur - start, type);",
          "",
          "[Added Lines]",
          "396:      value = gql_token_create(err, start, (int)(doc->cur - start), type);",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "467:  break;",
          "468:     default: // Enum value",
          "469:  agoo_doc_read_token(doc);",
          "471:  break;",
          "472:     }",
          "473:     return value;",
          "",
          "[Removed Lines]",
          "470:  value = gql_token_create(err, start, doc->cur - start, type);",
          "",
          "[Added Lines]",
          "470:  value = gql_token_create(err, start, (int)(doc->cur - start), type);",
          "",
          "---------------"
        ],
        "ext/agoo/gqleval.c||ext/agoo/gqleval.c": [
          "File: ext/agoo/gqleval.c -> ext/agoo/gqleval.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "48:     long long  frac = (long long)now % 1000000000LL;",
          "49:     struct _agooTime at;",
          "50:     const char  *code = agoo_err_str(err->code);",
          "53:     agoo_sectime(t, &at);",
          "54:     cnt = snprintf(buf, sizeof(buf),",
          "",
          "[Removed Lines]",
          "51:     int   clen = strlen(code);",
          "",
          "[Added Lines]",
          "51:     int   clen = (int)strlen(code);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "521:    goto DONE;",
          "522:       }",
          "523:       query = s;",
          "525:   } else if (0 == strcmp(\"operationName\", m->key)) {",
          "526:       if (NULL == (s = gql_string_get(m->value))) {",
          "527:    agoo_err_set(err, AGOO_ERR_TYPE, \"operationName must be an string\");",
          "528:    goto DONE;",
          "529:       }",
          "530:       op_name = s;",
          "532:   } else if (0 == strcmp(\"variables\", m->key)) {",
          "533:       gqlLink link;",
          "",
          "[Removed Lines]",
          "524:       qlen = strlen(s);",
          "531:       oplen = strlen(s);",
          "",
          "[Added Lines]",
          "524:       qlen = (int)strlen(s);",
          "531:       oplen = (int)strlen(s);",
          "",
          "---------------"
        ],
        "ext/agoo/gqljson.c||ext/agoo/gqljson.c": [
          "File: ext/agoo/gqljson.c -> ext/agoo/gqljson.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "116:  if (INT32_MAX < i) {",
          "117:      value = gql_i64_create(err, si);",
          "118:  } else {",
          "120:  }",
          "121:     } else { // decimal",
          "122:  double d = (double)i + (double)num / (double)div;",
          "",
          "[Removed Lines]",
          "119:      value = gql_int_create(err, si);",
          "",
          "[Added Lines]",
          "119:      value = gql_int_create(err, (int)si);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "256:      return NULL;",
          "257:  }",
          "258:     }",
          "260:     doc->cur++; // past trailing \"",
          "261: DONE:",
          "262:     agoo_text_release(t);",
          "",
          "[Removed Lines]",
          "259:     value = gql_string_create(err, t->text, t->len);",
          "",
          "[Added Lines]",
          "259:     value = gql_string_create(err, t->text, (int)(t->len));",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "458: gql_json_parse(agooErr err, const char *json, size_t len) {",
          "459:     struct _agooDoc doc;",
          "463:     return parse_value(err, &doc);",
          "464: }",
          "",
          "[Removed Lines]",
          "461:     agoo_doc_init(&doc, json, len);",
          "",
          "[Added Lines]",
          "461:     agoo_doc_init(&doc, json, (int)(len));",
          "",
          "---------------"
        ],
        "ext/agoo/graphql.h||ext/agoo/graphql.h": [
          "File: ext/agoo/graphql.h -> ext/agoo/graphql.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "54: struct _gqlDirUse;",
          "55: struct _gqlField;",
          "56: struct _gqlLink;",
          "58: struct _gqlType;",
          "59: struct _gqlValue;",
          "",
          "[Removed Lines]",
          "57: struct _gqlLink;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "ext/agoo/page.c||ext/agoo/page.c": [
          "File: ext/agoo/page.c -> ext/agoo/page.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "523:  }",
          "524:  plen = (int)strlen(path);",
          "525:  if (NULL != cache.root) {",
          "528:      if (0 == strncmp(cache.root, p->path, rlen) && '/' == p->path[rlen]) {",
          "529:   rel_path = p->path + rlen + 1;",
          "",
          "[Removed Lines]",
          "526:      int rlen = strlen(cache.root);",
          "",
          "[Added Lines]",
          "526:      int rlen = (int)strlen(cache.root);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "657:     rewind(f);",
          "659:     if (NULL != cache.root) {",
          "662:  if (0 == strncmp(cache.root, path, rlen) && '/' == path[rlen]) {",
          "663:      rel_path = path + rlen + 1;",
          "",
          "[Removed Lines]",
          "660:  int rlen = strlen(cache.root);",
          "",
          "[Added Lines]",
          "660:  int rlen = (int)strlen(cache.root);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "972:     } else if (NULL == (hr->mime = AGOO_STRDUP(mime))) {",
          "973:  goto ERROR;",
          "974:     }",
          "976:     hr->next = cache.head_rules;",
          "977:     cache.head_rules = hr;",
          "",
          "[Removed Lines]",
          "975:     hr->len = strlen(hr->key) + strlen(hr->value) + 4;",
          "",
          "[Added Lines]",
          "975:     hr->len = (int)strlen(hr->key) + (int)strlen(hr->value) + 4;",
          "",
          "---------------"
        ],
        "ext/agoo/pub.c||ext/agoo/pub.c": [
          "File: ext/agoo/pub.c -> ext/agoo/pub.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "105:  if (NULL == src->subject) {",
          "106:      p->subject = NULL;",
          "107:  } else {",
          "109:  }",
          "110:  p->msg = src->msg;",
          "111:  if (NULL != p->msg) {",
          "",
          "[Removed Lines]",
          "108:      p->subject = agoo_subject_create(src->subject->pattern, strlen(src->subject->pattern));",
          "",
          "[Added Lines]",
          "108:      p->subject = agoo_subject_create(src->subject->pattern, (int)strlen(src->subject->pattern));",
          "",
          "---------------"
        ],
        "ext/agoo/rgraphql.c||ext/agoo/rgraphql.c": [
          "File: ext/agoo/rgraphql.c -> ext/agoo/rgraphql.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "233:      break;",
          "234:  case RUBY_T_STRING:",
          "235:      v = ref_to_string(ref);",
          "237:      break;",
          "238:  case RUBY_T_ARRAY: {",
          "239:      gqlValue v;",
          "",
          "[Removed Lines]",
          "236:      value = gql_string_create(err, rb_string_value_ptr(&v), RSTRING_LEN(v));",
          "",
          "[Added Lines]",
          "236:      value = gql_string_create(err, rb_string_value_ptr(&v), (int)RSTRING_LEN(v));",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "265:      if (i < INT32_MIN || INT32_MAX < i) {",
          "266:   value = gql_i64_create(err, i);",
          "267:      } else {",
          "269:      }",
          "270:      break;",
          "271:  }",
          "",
          "[Removed Lines]",
          "268:   value = gql_int_create(err, i);",
          "",
          "[Added Lines]",
          "268:   value = gql_int_create(err, (int)i);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "282:  }",
          "283:  default:",
          "284:      v = ref_to_string(ref);",
          "286:      break;",
          "287:  }",
          "288:     } else if (GQL_SCALAR == type->kind) {",
          "",
          "[Removed Lines]",
          "285:      value = gql_string_create(err, rb_string_value_ptr(&v), RSTRING_LEN(v));",
          "",
          "[Added Lines]",
          "285:      value = gql_string_create(err, rb_string_value_ptr(&v), (int)RSTRING_LEN(v));",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "307:  case GQL_SCALAR_TOKEN:",
          "308:  case GQL_SCALAR_ID:",
          "309:      v = ref_to_string(ref);",
          "311:      break;",
          "312:  case GQL_SCALAR_TIME: {",
          "313:      VALUE clas = rb_obj_class((VALUE)ref);",
          "",
          "[Removed Lines]",
          "310:      value = gql_string_create(err, rb_string_value_ptr(&v), RSTRING_LEN(v));",
          "",
          "[Added Lines]",
          "310:      value = gql_string_create(err, rb_string_value_ptr(&v), (int)RSTRING_LEN(v));",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "319:  }",
          "320:  case GQL_SCALAR_UUID:",
          "321:      v = ref_to_string(ref);",
          "323:      break;",
          "324:  case GQL_SCALAR_LIST: {",
          "325:      gqlValue v;",
          "",
          "[Removed Lines]",
          "322:      value = gql_uuid_str_create(err, rb_string_value_ptr(&v), RSTRING_LEN(v));",
          "",
          "[Added Lines]",
          "322:      value = gql_uuid_str_create(err, rb_string_value_ptr(&v), (int)RSTRING_LEN(v));",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "347:  }",
          "348:     } else if (GQL_ENUM == type->kind) {",
          "349:  v = ref_to_string(ref);",
          "351:     } else {",
          "352:  rb_raise(rb_eStandardError, \"Can not coerce a non-scalar into a %s.\", type->name);",
          "353:     }",
          "",
          "[Removed Lines]",
          "350:  value = gql_string_create(err, rb_string_value_ptr(&v), RSTRING_LEN(v));",
          "",
          "[Added Lines]",
          "350:  value = gql_string_create(err, rb_string_value_ptr(&v), (int)RSTRING_LEN(v));",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "410:      } else {",
          "411:   v = sa->value;",
          "412:      }",
          "413:      if (NULL != field) {",
          "414:   gqlArg fa;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "413:      if (NULL == v) {",
          "414:   v = gql_null_create(err);",
          "415:      }",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "431:     if (GQL_SUBSCRIPTION == doc->op->kind && RUBY_T_STRING == rb_type(child)) {",
          "432:  gqlValue c;",
          "435:      AGOO_ERR_OK != gql_object_set(err, result, \"subject\", c)) {",
          "436:      return err->code;",
          "437:  }",
          "",
          "[Removed Lines]",
          "434:  if (NULL == (c = gql_string_create(err, rb_string_value_ptr(&child), RSTRING_LEN(child))) ||",
          "",
          "[Added Lines]",
          "437:  if (NULL == (c = gql_string_create(err, rb_string_value_ptr(&child), (int)RSTRING_LEN(child))) ||",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "669:  rb_raise(rb_eStandardError, \"GraphQL root not set. Use Agoo::GraphQL.schema.\");",
          "670:     }",
          "671:     rb_check_type(sdl, T_STRING);",
          "673:  rb_raise(rb_eStandardError, \"%s\", err.msg);",
          "674:     }",
          "675:     return Qnil;",
          "",
          "[Removed Lines]",
          "672:     if (AGOO_ERR_OK != sdl_parse(&err, StringValuePtr(sdl), RSTRING_LEN(sdl))) {",
          "",
          "[Added Lines]",
          "675:     if (AGOO_ERR_OK != sdl_parse(&err, StringValuePtr(sdl), (int)RSTRING_LEN(sdl))) {",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "712:  sdl[len] = '\\0';",
          "713:     }",
          "714:     fclose(f);",
          "716:  xfree(sdl);",
          "717:  rb_raise(rb_eStandardError, \"%s\", err.msg);",
          "718:     }",
          "",
          "[Removed Lines]",
          "715:     if (AGOO_ERR_OK != sdl_parse(&err, sdl, len)) {",
          "",
          "[Added Lines]",
          "718:     if (AGOO_ERR_OK != sdl_parse(&err, sdl, (int)len)) {",
          "",
          "---------------"
        ],
        "ext/agoo/rserver.c||ext/agoo/rserver.c": [
          "File: ext/agoo/rserver.c -> ext/agoo/rserver.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "995:   if (NULL == t) {",
          "996:       rb_raise(rb_eNoMemError, \"Failed to allocate memory for a response.\");",
          "997:   }",
          "999:       rb_raise(rb_eArgError, \"%s\", err.msg);",
          "1000:   }",
          "1001:   agoo_text_release(t);",
          "",
          "[Removed Lines]",
          "998:   if (NULL == agoo_page_immutable(&err, pat, t->text, t->len)) {",
          "",
          "[Added Lines]",
          "998:   if (NULL == agoo_page_immutable(&err, pat, t->text, (int)t->len)) {",
          "",
          "---------------"
        ],
        "ext/agoo/sdl.c||ext/agoo/sdl.c": [
          "File: ext/agoo/sdl.c -> ext/agoo/sdl.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "867:  case 's': // schema or scalar",
          "868:      if (6 < (doc.end - doc.cur) && 'c' == doc.cur[1]) {",
          "869:   if ('a' == doc.cur[2]) {",
          "871:    return err->code;",
          "872:       }",
          "873:       desc = NULL;",
          "874:       dlen = 0;",
          "875:       break;",
          "876:   } else {",
          "878:    return err->code;",
          "879:       }",
          "880:       desc = NULL;",
          "",
          "[Removed Lines]",
          "870:       if (AGOO_ERR_OK != make_scalar(err, &doc, desc, dlen, extend_next)) {",
          "877:       if (AGOO_ERR_OK != make_schema(err, &doc, desc, dlen, extend_next)) {",
          "",
          "[Added Lines]",
          "870:       if (AGOO_ERR_OK != make_scalar(err, &doc, desc, (int)dlen, extend_next)) {",
          "877:       if (AGOO_ERR_OK != make_schema(err, &doc, desc, (int)dlen, extend_next)) {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "886:  case 'e': // enum or extend",
          "887:      if (4 < (doc.end - doc.cur)) {",
          "888:   if ('n' == doc.cur[1]) {",
          "890:    return err->code;",
          "891:       }",
          "892:       desc = NULL;",
          "",
          "[Removed Lines]",
          "889:       if (AGOO_ERR_OK != make_enum(err, &doc, desc, dlen, extend_next)) {",
          "",
          "[Added Lines]",
          "889:       if (AGOO_ERR_OK != make_enum(err, &doc, desc, (int)dlen, extend_next)) {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "904:      }",
          "905:      return agoo_doc_err(&doc, err, \"Unknown directive\");",
          "906:  case 'u': // union",
          "908:   return err->code;",
          "909:      }",
          "910:      desc = NULL;",
          "911:      dlen = 0;",
          "912:      break;",
          "913:  case 'd': // directive",
          "915:   return err->code;",
          "916:      }",
          "917:      desc = NULL;",
          "918:      dlen = 0;",
          "919:      break;",
          "920:  case 't': // type",
          "922:   return err->code;",
          "923:      }",
          "924:      desc = NULL;",
          "",
          "[Removed Lines]",
          "907:      if (AGOO_ERR_OK != make_union(err, &doc, desc, dlen, extend_next)) {",
          "914:      if (AGOO_ERR_OK != make_directive(err, &doc, desc, dlen)) {",
          "921:      if (AGOO_ERR_OK != make_type(err, &doc, desc, dlen, extend_next)) {",
          "",
          "[Added Lines]",
          "907:      if (AGOO_ERR_OK != make_union(err, &doc, desc, (int)dlen, extend_next)) {",
          "914:      if (AGOO_ERR_OK != make_directive(err, &doc, desc, (int)dlen)) {",
          "921:      if (AGOO_ERR_OK != make_type(err, &doc, desc, (int)dlen, extend_next)) {",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "927:  case 'i': // interface, input",
          "928:      if (5 < (doc.end - doc.cur) && 'n' == doc.cur[1]) {",
          "929:   if ('p' == doc.cur[2]) {",
          "931:    return err->code;",
          "932:       }",
          "933:       desc = NULL;",
          "934:       dlen = 0;",
          "935:       break;",
          "936:   } else {",
          "938:    return err->code;",
          "939:       }",
          "940:       desc = NULL;",
          "",
          "[Removed Lines]",
          "930:       if (AGOO_ERR_OK != make_input(err, &doc, desc, dlen, extend_next)) {",
          "937:       if (AGOO_ERR_OK != make_interface(err, &doc, desc, dlen, extend_next)) {",
          "",
          "[Added Lines]",
          "930:       if (AGOO_ERR_OK != make_input(err, &doc, desc, (int)dlen, extend_next)) {",
          "937:       if (AGOO_ERR_OK != make_interface(err, &doc, desc, (int)dlen, extend_next)) {",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1001:   break;",
          "1002:      }",
          "1003:  }",
          "1005:      for (var = gdoc->vars; NULL != var; var = var->next) {",
          "1006:   if (0 == strcmp(var_name, var->name)) {",
          "1007:       break;",
          "",
          "[Removed Lines]",
          "1004:  if (NULL == var) {",
          "",
          "[Added Lines]",
          "1004:  if (NULL == var || NULL == var->value) {",
          "",
          "---------------"
        ],
        "ext/agoo/sectime.c||ext/agoo/sectime.c": [
          "File: ext/agoo/sectime.c -> ext/agoo/sectime.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "110:      }",
          "111:  }",
          "112:     }",
          "114:     if (leap) {",
          "115:  ms = eom_leap_secs;",
          "116:     } else {",
          "",
          "[Removed Lines]",
          "113:     at->year = (qc - shift) * 400 + c * 100 + qy * 4 + y;",
          "",
          "[Added Lines]",
          "113:     at->year = (int)((qc - shift) * 400 + c * 100 + qy * 4 + y);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "125:      break;",
          "126:  }",
          "127:     }",
          "129:     secs = secs - (int64_t)at->day * 86400LL;",
          "130:     at->day++;",
          "132:     secs = secs - (int64_t)at->hour * 3600LL;",
          "134:     secs = secs - (int64_t)at->min * 60LL;",
          "136: }",
          "",
          "[Removed Lines]",
          "128:     at->day = secs / 86400LL;",
          "131:     at->hour = secs / 3600LL;",
          "133:     at->min = secs / 60LL;",
          "135:     at->sec = secs;",
          "",
          "[Added Lines]",
          "128:     at->day = (int)(secs / 86400LL);",
          "131:     at->hour = (int)(secs / 3600LL);",
          "133:     at->min = (int)(secs / 60LL);",
          "135:     at->sec = (int)secs;",
          "",
          "---------------"
        ],
        "lib/agoo/version.rb||lib/agoo/version.rb": [
          "File: lib/agoo/version.rb -> lib/agoo/version.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "2: module Agoo",
          "3:   # Agoo version.",
          "5: end",
          "",
          "[Removed Lines]",
          "4:   VERSION = '2.11.5'",
          "",
          "[Added Lines]",
          "4:   VERSION = '2.11.6'",
          "",
          "---------------"
        ],
        "test/graphql_test.rb||test/graphql_test.rb": [
          "File: test/graphql_test.rb -> test/graphql_test.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "325:   end",
          "327:   def test_json_vars_query",
          "330:     expect = %^{",
          "331:   \"data\":{",
          "332:     \"artist\":{",
          "",
          "[Removed Lines]",
          "328:     #uri = URI('http://localhost:6472/graphql?query={artist(name:$name){name}}&indent=2&variables={\"name\":\"Fazerdaze\"}')",
          "329:     uri = URI('http://localhost:6472/graphql?query={artist(name:\"Fazerdaze\"){name}}&indent=2&variables={\"name\":\"Fazerdaze\"}')",
          "",
          "[Added Lines]",
          "328:     uri = URI('http://localhost:6472/graphql?query={artist(name:$name){name}}&indent=2&variables={\"name\":\"Fazerdaze\"}')",
          "329:     #uri = URI('http://localhost:6472/graphql?query={artist(name:\"Fazerdaze\"){name}}&indent=2&variables={\"name\":\"Fazerdaze\"}')",
          "",
          "---------------"
        ]
      }
    }
  ]
}