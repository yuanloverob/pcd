{
  "cve_id": "CVE-2019-18805",
  "cve_desc": "An issue was discovered in net/ipv4/sysctl_net_ipv4.c in the Linux kernel before 5.0.11. There is a net/ipv4/tcp_input.c signed integer overflow in tcp_ack_update_rtt() when userspace writes a very large integer to /proc/sys/net/ipv4/tcp_min_rtt_wlen, leading to a denial of service or possibly unspecified other impact, aka CID-19fad20d15a6.",
  "repo": "torvalds/linux",
  "patch_hash": "19fad20d15a6494f47f85d869f00b11343ee5c78",
  "patch_info": {
    "commit_hash": "19fad20d15a6494f47f85d869f00b11343ee5c78",
    "repo": "torvalds/linux",
    "commit_url": "https://github.com/torvalds/linux/commit/19fad20d15a6494f47f85d869f00b11343ee5c78",
    "files": [
      "Documentation/networking/ip-sysctl.txt",
      "net/ipv4/sysctl_net_ipv4.c"
    ],
    "message": "ipv4: set the tcp_min_rtt_wlen range from 0 to one day\n\nThere is a UBSAN report as below:\nUBSAN: Undefined behaviour in net/ipv4/tcp_input.c:2877:56\nsigned integer overflow:\n2147483647 * 1000 cannot be represented in type 'int'\nCPU: 3 PID: 0 Comm: swapper/3 Not tainted 5.1.0-rc4-00058-g582549e #1\nCall Trace:\n <IRQ>\n dump_stack+0x8c/0xba\n ubsan_epilogue+0x11/0x60\n handle_overflow+0x12d/0x170\n ? ttwu_do_wakeup+0x21/0x320\n __ubsan_handle_mul_overflow+0x12/0x20\n tcp_ack_update_rtt+0x76c/0x780\n tcp_clean_rtx_queue+0x499/0x14d0\n tcp_ack+0x69e/0x1240\n ? __wake_up_sync_key+0x2c/0x50\n ? update_group_capacity+0x50/0x680\n tcp_rcv_established+0x4e2/0xe10\n tcp_v4_do_rcv+0x22b/0x420\n tcp_v4_rcv+0xfe8/0x1190\n ip_protocol_deliver_rcu+0x36/0x180\n ip_local_deliver+0x15b/0x1a0\n ip_rcv+0xac/0xd0\n __netif_receive_skb_one_core+0x7f/0xb0\n __netif_receive_skb+0x33/0xc0\n netif_receive_skb_internal+0x84/0x1c0\n napi_gro_receive+0x2a0/0x300\n receive_buf+0x3d4/0x2350\n ? detach_buf_split+0x159/0x390\n virtnet_poll+0x198/0x840\n ? reweight_entity+0x243/0x4b0\n net_rx_action+0x25c/0x770\n __do_softirq+0x19b/0x66d\n irq_exit+0x1eb/0x230\n do_IRQ+0x7a/0x150\n common_interrupt+0xf/0xf\n </IRQ>\n\nIt can be reproduced by:\n  echo 2147483647 > /proc/sys/net/ipv4/tcp_min_rtt_wlen\n\nFixes: f672258391b42 (\"tcp: track min RTT using windowed min-filter\")\nSigned-off-by: ZhangXiaoxu <zhangxiaoxu5@huawei.com>\nSigned-off-by: David S. Miller <davem@davemloft.net>",
    "before_after_code_files": [
      "net/ipv4/sysctl_net_ipv4.c||net/ipv4/sysctl_net_ipv4.c"
    ]
  },
  "patch_diff": {
    "net/ipv4/sysctl_net_ipv4.c||net/ipv4/sysctl_net_ipv4.c": [
      "File: net/ipv4/sysctl_net_ipv4.c -> net/ipv4/sysctl_net_ipv4.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "49: static int ip_ping_group_range_max[] = { GID_T_MAX, GID_T_MAX };",
      "50: static int comp_sack_nr_max = 255;",
      "51: static u32 u32_max_div_HZ = UINT_MAX / HZ;",
      "54: static int sysctl_tcp_low_latency __read_mostly;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "52: static int one_day_secs = 24 * 3600;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "1151:   .data  = &init_net.ipv4.sysctl_tcp_min_rtt_wlen,",
      "1152:   .maxlen  = sizeof(int),",
      "1153:   .mode  = 0644,",
      "1155:  },",
      "1156:  {",
      "1157:   .procname = \"tcp_autocorking\",",
      "",
      "[Removed Lines]",
      "1154:   .proc_handler = proc_dointvec",
      "",
      "[Added Lines]",
      "1155:   .proc_handler = proc_dointvec_minmax,",
      "1156:   .extra1  = &zero,",
      "1157:   .extra2  = &one_day_secs",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "b9abbdfa88024d52c8084d8f46ea4f161606c692",
      "candidate_info": {
        "commit_hash": "b9abbdfa88024d52c8084d8f46ea4f161606c692",
        "repo": "torvalds/linux",
        "commit_url": "https://github.com/torvalds/linux/commit/b9abbdfa88024d52c8084d8f46ea4f161606c692",
        "files": [
          "tools/perf/util/map.c"
        ],
        "message": "perf tools: Fix map reference counting\n\nBy calling maps__insert() we assume to get 2 references on the map,\nwhich we relese within maps__remove call.\n\nHowever if there's already same map name, we currently don't bump the\nreference and can crash, like:\n\n  Program received signal SIGABRT, Aborted.\n  0x00007ffff75e60f5 in raise () from /lib64/libc.so.6\n\n  (gdb) bt\n  #0  0x00007ffff75e60f5 in raise () from /lib64/libc.so.6\n  #1  0x00007ffff75d0895 in abort () from /lib64/libc.so.6\n  #2  0x00007ffff75d0769 in __assert_fail_base.cold () from /lib64/libc.so.6\n  #3  0x00007ffff75de596 in __assert_fail () from /lib64/libc.so.6\n  #4  0x00000000004fc006 in refcount_sub_and_test (i=1, r=0x1224e88) at tools/include/linux/refcount.h:131\n  #5  refcount_dec_and_test (r=0x1224e88) at tools/include/linux/refcount.h:148\n  #6  map__put (map=0x1224df0) at util/map.c:299\n  #7  0x00000000004fdb95 in __maps__remove (map=0x1224df0, maps=0xb17d80) at util/map.c:953\n  #8  maps__remove (maps=0xb17d80, map=0x1224df0) at util/map.c:959\n  #9  0x00000000004f7d8a in map_groups__remove (map=<optimized out>, mg=<optimized out>) at util/map_groups.h:65\n  #10 machine__process_ksymbol_unregister (sample=<optimized out>, event=0x7ffff7279670, machine=<optimized out>) at util/machine.c:728\n  #11 machine__process_ksymbol (machine=<optimized out>, event=0x7ffff7279670, sample=<optimized out>) at util/machine.c:741\n  #12 0x00000000004fffbb in perf_session__deliver_event (session=0xb11390, event=0x7ffff7279670, tool=0x7fffffffc7b0, file_offset=13936) at util/session.c:1362\n  #13 0x00000000005039bb in do_flush (show_progress=false, oe=0xb17e80) at util/ordered-events.c:243\n  #14 __ordered_events__flush (oe=0xb17e80, how=OE_FLUSH__ROUND, timestamp=<optimized out>) at util/ordered-events.c:322\n  #15 0x00000000005005e4 in perf_session__process_user_event (session=session@entry=0xb11390, event=event@entry=0x7ffff72a4af8,\n  ...\n\nAdd the map to the list and getting the reference event if we find the\nmap with same name.\n\nSigned-off-by: Jiri Olsa <jolsa@kernel.org>\nCc: Adrian Hunter <adrian.hunter@intel.com>\nCc: Alexander Shishkin <alexander.shishkin@linux.intel.com>\nCc: Alexei Starovoitov <ast@kernel.org>\nCc: Andi Kleen <ak@linux.intel.com>\nCc: Daniel Borkmann <daniel@iogearbox.net>\nCc: Eric Saint-Etienne <eric.saint.etienne@oracle.com>\nCc: Namhyung Kim <namhyung@kernel.org>\nCc: Peter Zijlstra <peterz@infradead.org>\nCc: Song Liu <songliubraving@fb.com>\nFixes: 1e6285699b30 (\"perf symbols: Fix slowness due to -ffunction-section\")\nLink: http://lkml.kernel.org/r/20190416160127.30203-10-jolsa@kernel.org\nSigned-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>",
        "before_after_code_files": [
          "tools/perf/util/map.c||tools/perf/util/map.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_issue": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "tools/perf/util/map.c||tools/perf/util/map.c": [
          "File: tools/perf/util/map.c -> tools/perf/util/map.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "926:   rc = strcmp(m->dso->short_name, map->dso->short_name);",
          "927:   if (rc < 0)",
          "928:    p = &(*p)->rb_left;",
          "931:   else",
          "933:  }",
          "934:  rb_link_node(&map->rb_node_name, parent, p);",
          "935:  rb_insert_color(&map->rb_node_name, &maps->names);",
          "",
          "[Removed Lines]",
          "929:   else if (rc  > 0)",
          "930:    p = &(*p)->rb_right;",
          "932:    return;",
          "",
          "[Added Lines]",
          "930:    p = &(*p)->rb_right;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "898bc40bfcc26abb6e06e960d6d4754c36c58b50",
      "candidate_info": {
        "commit_hash": "898bc40bfcc26abb6e06e960d6d4754c36c58b50",
        "repo": "torvalds/linux",
        "commit_url": "https://github.com/torvalds/linux/commit/898bc40bfcc26abb6e06e960d6d4754c36c58b50",
        "files": [
          "drivers/media/usb/au0828/au0828-video.c"
        ],
        "message": "media: au0828: Fix NULL pointer dereference in au0828_analog_stream_enable()\n\nFix au0828_analog_stream_enable() to check if device is in the right\nstate first. When unbind happens while bind is in progress, usbdev\npointer could be invalid in au0828_analog_stream_enable() and a call\nto usb_ifnum_to_if() will result in the null pointer dereference.\n\nThis problem is found with the new media_dev_allocator.sh test.\n\nkernel: [  590.359623] BUG: unable to handle kernel NULL pointer dereference at 00000000000004e8\nkernel: [  590.359627] #PF error: [normal kernel read fault]\nkernel: [  590.359629] PGD 0 P4D 0\nkernel: [  590.359632] Oops: 0000 [#1] SMP PTI\nkernel: [  590.359634] CPU: 3 PID: 1458 Comm: v4l_id Not tainted 5.1.0-rc2+ #30\nkernel: [  590.359636] Hardware name: Dell Inc. OptiPlex 7 90/0HY9JP, BIOS A18 09/24/2013\nkernel: [  590.359641] RIP: 0010:usb_ifnum_to_if+0x6/0x60\nkernel: [  590.359643] Code: 5d 41 5e 41 5f 5d c3 48 83 c4\n 10 b8 fa ff ff ff 5b 41 5c 41 5d 41 5e 41 5f 5d c3 b8 fa ff ff ff c3 0f 1f 00 6\n6 66 66 66 90 55 <48> 8b 97 e8 04 00 00 48 89 e5 48 85 d2 74 41 0f b6 4a 04 84 c\n9 74\nkernel: [  590.359645] RSP: 0018:ffffad3cc3c1fc00 EFLAGS: 00010246\nkernel: [  590.359646] RAX: 0000000000000000 RBX: ffff8ded b1f3c000 RCX: 1f377e4500000000\nkernel: [  590.359648] RDX: ffff8dedfa3a6b50 RSI: 00000000 00000000 RDI: 0000000000000000\nkernel: [  590.359649] RBP: ffffad3cc3c1fc28 R08: 00000000 8574acc2 R09: ffff8dedfa3a6b50\nkernel: [  590.359650] R10: 0000000000000001 R11: 00000000 00000000 R12: 0000000000000000\nkernel: [  590.359652] R13: ffff8dedb1f3f0f0 R14: ffffffff adcf7ec0 R15: 0000000000000000\nkernel: [  590.359654] FS:  00007f7917198540(0000) GS:ffff 8dee258c0000(0000) knlGS:0000000000000000\nkernel: [  590.359655] CS:  0010 DS: 0000 ES: 0000 CR0: 00 00000080050033\nkernel: [  590.359657] CR2: 00000000000004e8 CR3: 00000001 a388e002 CR4: 00000000000606e0\nkernel: [  590.359658] Call Trace:\nkernel: [  590.359664]  ? au0828_analog_stream_enable+0x2c/0x180\nkernel: [  590.359666]  au0828_v4l2_open+0xa4/0x110\nkernel: [  590.359670]  v4l2_open+0x8b/0x120\nkernel: [  590.359674]  chrdev_open+0xa6/0x1c0\nkernel: [  590.359676]  ? cdev_put.part.3+0x20/0x20\nkernel: [  590.359678]  do_dentry_open+0x1f6/0x360\nkernel: [  590.359681]  vfs_open+0x2f/0x40\nkernel: [  590.359684]  path_openat+0x299/0xc20\nkernel: [  590.359688]  do_filp_open+0x9b/0x110\nkernel: [  590.359695]  ? _raw_spin_unlock+0x27/0x40\nkernel: [  590.359697]  ? __alloc_fd+0xb2/0x160\nkernel: [  590.359700]  do_sys_open+0x1ba/0x260\nkernel: [  590.359702]  ? do_sys_open+0x1ba/0x260\nkernel: [  590.359712]  __x64_sys_openat+0x20/0x30\nkernel: [  590.359715]  do_syscall_64+0x5a/0x120\nkernel: [  590.359718]  entry_SYSCALL_64_after_hwframe+0x44/0xa9\n\nSigned-off-by: Shuah Khan <shuah@kernel.org>\nSigned-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>\nSigned-off-by: Mauro Carvalho Chehab <mchehab+samsung@kernel.org>",
        "before_after_code_files": [
          "drivers/mediusb/au0828/au0828-video.c||drivers/media/usau0828/au0828-video.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_issue": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "drivers/mediusb/au0828/au0828-video.c||drivers/media/usau0828/au0828-video.c": [
          "File: drivers/mediusb/au0828/au0828-video.c -> drivers/media/usau0828/au0828-video.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "99534023490686ce4453c45e5cb813535b9bff95",
      "candidate_info": {
        "commit_hash": "99534023490686ce4453c45e5cb813535b9bff95",
        "repo": "torvalds/linux",
        "commit_url": "https://github.com/torvalds/linux/commit/99534023490686ce4453c45e5cb813535b9bff95",
        "files": [
          "drivers/gpu/drm/i915/i915_gem.c"
        ],
        "message": "drm/i915: Avoid use-after-free in reporting create.size\n\nWe have to avoid chasing after a userspace race!\n\n<3>[  473.114328] BUG: KASAN: use-after-free in i915_gem_create+0x1d2/0x1f0 [i915]\n<3>[  473.114389] Read of size 8 at addr ffff88815bf1d840 by task gem_flink_race/1541\n\n<4>[  473.114464] CPU: 1 PID: 1541 Comm: gem_flink_race Tainted: G     U            5.1.0-rc4-g7d07e025e786-kasan_88+ #1\n<4>[  473.114469] Hardware name: To Be Filled By O.E.M. To Be Filled By O.E.M./J4205-ITX, BIOS P1.10 09/29/2016\n<4>[  473.114474] Call Trace:\n<4>[  473.114488]  dump_stack+0x7c/0xbb\n<4>[  473.114612]  ? i915_gem_create+0x1d2/0x1f0 [i915]\n<4>[  473.114621]  print_address_description+0x65/0x270\n<4>[  473.114728]  ? i915_gem_create+0x1d2/0x1f0 [i915]\n<4>[  473.114839]  ? i915_gem_create+0x1d2/0x1f0 [i915]\n<4>[  473.114848]  kasan_report+0x149/0x18d\n<4>[  473.114962]  ? i915_gem_create+0x1d2/0x1f0 [i915]\n<4>[  473.115069]  i915_gem_create+0x1d2/0x1f0 [i915]\n<4>[  473.115176]  ? i915_gem_object_create.part.28+0x4b0/0x4b0 [i915]\n<4>[  473.115289]  ? i915_gem_dumb_create+0x1a0/0x1a0 [i915]\n<4>[  473.115297]  drm_ioctl_kernel+0x192/0x260\n<4>[  473.115306]  ? drm_ioctl_permit+0x280/0x280\n<4>[  473.115326]  drm_ioctl+0x67c/0x960\n<4>[  473.115438]  ? i915_gem_dumb_create+0x1a0/0x1a0 [i915]\n<4>[  473.115448]  ? drm_getstats+0x20/0x20\n<4>[  473.115459]  ? __lock_acquire+0xa66/0x3fe0\n<4>[  473.115474]  ? _raw_spin_unlock_irqrestore+0x39/0x60\n<4>[  473.115485]  ? debug_object_active_state+0x2ea/0x4e0\n<4>[  473.115496]  ? debug_show_all_locks+0x2d0/0x2d0\n<4>[  473.115513]  do_vfs_ioctl+0x18d/0xfa0\n<4>[  473.115522]  ? check_flags.part.27+0x440/0x440\n<4>[  473.115532]  ? ioctl_preallocate+0x1a0/0x1a0\n<4>[  473.115547]  ? __fget+0x2ac/0x410\n<4>[  473.115561]  ? __ia32_sys_dup3+0xb0/0xb0\n<4>[  473.115569]  ? rwlock_bug.part.0+0x90/0x90\n<4>[  473.115590]  ksys_ioctl+0x35/0x70\n<4>[  473.115597]  ? lockdep_hardirqs_off+0x1cb/0x2b0\n<4>[  473.115608]  __x64_sys_ioctl+0x6a/0xb0\n<4>[  473.115614]  ? lockdep_hardirqs_on+0x342/0x590\n<4>[  473.115623]  do_syscall_64+0x97/0x400\n<4>[  473.115633]  entry_SYSCALL_64_after_hwframe+0x49/0xbe\n<4>[  473.115641] RIP: 0033:0x7fce590d55d7\n<4>[  473.115649] Code: b3 66 90 48 8b 05 b1 48 2d 00 64 c7 00 26 00 00 00 48 c7 c0 ff ff ff ff c3 66 2e 0f 1f 84 00 00 00 00 00 b8 10 00 00 00 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 81 48 2d 00 f7 d8 64 89 01 48\n<4>[  473.115655] RSP: 002b:00007fce4d525ba8 EFLAGS: 00000246 ORIG_RAX: 0000000000000010\n<4>[  473.115662] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fce590d55d7\n<4>[  473.115667] RDX: 00007fce4d525c10 RSI: 00000000c010645b RDI: 0000000000000007\n<4>[  473.115672] RBP: 00007fce4d525c10 R08: 00007fce4d526700 R09: 00007fce4d526700\n<4>[  473.115677] R10: 0000000000000054 R11: 0000000000000246 R12: 00000000c010645b\n<4>[  473.115682] R13: 0000000000000007 R14: 0000000000000000 R15: 00007ffe0e4a7450\n\n<3>[  473.115731] Allocated by task 1541:\n<4>[  473.115766]  kmem_cache_alloc+0xce/0x290\n<4>[  473.115895]  i915_gem_object_create.part.28+0x1c/0x4b0 [i915]\n<4>[  473.116000]  i915_gem_create+0xe3/0x1f0 [i915]\n<4>[  473.116008]  drm_ioctl_kernel+0x192/0x260\n<4>[  473.116013]  drm_ioctl+0x67c/0x960\n<4>[  473.116020]  do_vfs_ioctl+0x18d/0xfa0\n<4>[  473.116026]  ksys_ioctl+0x35/0x70\n<4>[  473.116032]  __x64_sys_ioctl+0x6a/0xb0\n<4>[  473.116038]  do_syscall_64+0x97/0x400\n<4>[  473.116044]  entry_SYSCALL_64_after_hwframe+0x49/0xbe\n\n<3>[  473.116071] Freed by task 1542:\n<4>[  473.116101]  kmem_cache_free+0xb7/0x2f0\n<4>[  473.116205]  __i915_gem_free_objects+0x7d4/0xe10 [i915]\n<4>[  473.116311]  i915_gem_create_ioctl+0xaa/0xd0 [i915]\n<4>[  473.116318]  drm_ioctl_kernel+0x192/0x260\n<4>[  473.116323]  drm_ioctl+0x67c/0x960\n<4>[  473.116330]  do_vfs_ioctl+0x18d/0xfa0\n<4>[  473.116335]  ksys_ioctl+0x35/0x70\n<4>[  473.116341]  __x64_sys_ioctl+0x6a/0xb0\n<4>[  473.116347]  do_syscall_64+0x97/0x400\n<4>[  473.116354]  entry_SYSCALL_64_after_hwframe+0x49/0xbe\n\nTestcase: igt/gem_flink_race/flink_close\nFixes: e163484afa8d (\"drm/i915: Update size upon return from GEM_CREATE\")\nSigned-off-by: Chris Wilson <chris@chris-wilson.co.uk>\nCc: Micha\u0142 Winiarski <michal.winiarski@intel.com>\nReviewed-by: Tvrtko Ursulin <tvrtko.ursulin@intel.com>\nLink: https://patchwork.freedesktop.org/patch/msgid/20190417132507.27133-1-chris@chris-wilson.co.uk",
        "before_after_code_files": [
          "drivers/gpu/drm/i915/i915_gem.c||drivers/gpu/drm/i915/i915_gem.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_issue": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "drivers/gpu/drm/i915/i915_gem.c||drivers/gpu/drm/i915/i915_gem.c": [
          "File: drivers/gpu/drm/i915/i915_gem.c -> drivers/gpu/drm/i915/i915_gem.c"
        ]
      }
    },
    {
      "candidate_hash": "36a2ba07757df790b4a874efb1a105b9330a9ae7",
      "candidate_info": {
        "commit_hash": "36a2ba07757df790b4a874efb1a105b9330a9ae7",
        "repo": "torvalds/linux",
        "commit_url": "https://github.com/torvalds/linux/commit/36a2ba07757df790b4a874efb1a105b9330a9ae7",
        "files": [
          "drivers/acpi/arm64/iort.c"
        ],
        "message": "ACPI/IORT: Reject platform device creation on NUMA node mapping failure\n\nIn a system where, through IORT firmware mappings, the SMMU device is\nmapped to a NUMA node that is not online, the kernel bootstrap results\nin the following crash:\n\n  Unable to handle kernel paging request at virtual address 0000000000001388\n  Mem abort info:\n    ESR = 0x96000004\n    Exception class = DABT (current EL), IL = 32 bits\n    SET = 0, FnV = 0\n    EA = 0, S1PTW = 0\n  Data abort info:\n    ISV = 0, ISS = 0x00000004\n    CM = 0, WnR = 0\n  [0000000000001388] user address but active_mm is swapper\n  Internal error: Oops: 96000004 [#1] SMP\n  Modules linked in:\n  CPU: 5 PID: 1 Comm: swapper/0 Not tainted 5.0.0 #15\n  pstate: 80c00009 (Nzcv daif +PAN +UAO)\n  pc : __alloc_pages_nodemask+0x13c/0x1068\n  lr : __alloc_pages_nodemask+0xdc/0x1068\n  ...\n  Process swapper/0 (pid: 1, stack limit = 0x(____ptrval____))\n  Call trace:\n   __alloc_pages_nodemask+0x13c/0x1068\n   new_slab+0xec/0x570\n   ___slab_alloc+0x3e0/0x4f8\n   __slab_alloc+0x60/0x80\n   __kmalloc_node_track_caller+0x10c/0x478\n   devm_kmalloc+0x44/0xb0\n   pinctrl_bind_pins+0x4c/0x188\n   really_probe+0x78/0x2b8\n   driver_probe_device+0x64/0x110\n   device_driver_attach+0x74/0x98\n   __driver_attach+0x9c/0xe8\n   bus_for_each_dev+0x84/0xd8\n   driver_attach+0x30/0x40\n   bus_add_driver+0x170/0x218\n   driver_register+0x64/0x118\n   __platform_driver_register+0x54/0x60\n   arm_smmu_driver_init+0x24/0x2c\n   do_one_initcall+0xbc/0x328\n   kernel_init_freeable+0x304/0x3ac\n   kernel_init+0x18/0x110\n   ret_from_fork+0x10/0x1c\n  Code: f90013b5 b9410fa1 1a9f0694 b50014c2 (b9400804)\n  ---[ end trace dfeaed4c373a32da ]--\n\nChange the dev_set_proximity() hook prototype so that it returns a\nvalue and make it return failure if the PXM->NUMA-node mapping\ncorresponds to an offline node, fixing the crash.\n\nAcked-by: Lorenzo Pieralisi <lorenzo.pieralisi@arm.com>\nSigned-off-by: Kefeng Wang <wangkefeng.wang@huawei.com>\nLink: https://lore.kernel.org/linux-arm-kernel/20190315021940.86905-1-wangkefeng.wang@huawei.com/\nSigned-off-by: Will Deacon <will.deacon@arm.com>",
        "before_after_code_files": [
          "drivers/acpi/arm64/iort.c||drivers/acpi/arm64/iort.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_issue": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "drivers/acpi/arm64/iort.c||drivers/acpi/arm64/iort.c": [
          "File: drivers/acpi/arm64/iort.c -> drivers/acpi/arm64/iort.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1236:            struct acpi_iort_node *node)",
          "1237: {",
          "1238:  struct acpi_iort_smmu_v3 *smmu;",
          "1240:  smmu = (struct acpi_iort_smmu_v3 *)node->node_data;",
          "1241:  if (smmu->flags & ACPI_IORT_SMMU_V3_PXM_VALID) {",
          "1243:   pr_info(\"SMMU-v3[%llx] Mapped to Proximity domain %d\\n\",",
          "1244:    smmu->base_address,",
          "1245:    smmu->pxm);",
          "1246:  }",
          "1247: }",
          "1248: #else",
          "1249: #define arm_smmu_v3_set_proximity NULL",
          "",
          "[Removed Lines]",
          "1235: static void  __init arm_smmu_v3_set_proximity(struct device *dev,",
          "1242:   set_dev_node(dev, acpi_map_pxm_to_node(smmu->pxm));",
          "",
          "[Added Lines]",
          "1235: static int  __init arm_smmu_v3_set_proximity(struct device *dev,",
          "1242:   int node = acpi_map_pxm_to_node(smmu->pxm);",
          "1244:   if (node != NUMA_NO_NODE && !node_online(node))",
          "1245:    return -EINVAL;",
          "1247:   set_dev_node(dev, node);",
          "1252:  return 0;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1318:  int (*dev_count_resources)(struct acpi_iort_node *node);",
          "1319:  void (*dev_init_resources)(struct resource *res,",
          "1320:          struct acpi_iort_node *node);",
          "1322:         struct acpi_iort_node *node);",
          "1323: };",
          "",
          "[Removed Lines]",
          "1321:  void (*dev_set_proximity)(struct device *dev,",
          "",
          "[Added Lines]",
          "1327:  int (*dev_set_proximity)(struct device *dev,",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1369:  if (!pdev)",
          "1370:   return -ENOMEM;",
          "1375:  count = ops->dev_count_resources(node);",
          "",
          "[Removed Lines]",
          "1372:  if (ops->dev_set_proximity)",
          "1373:   ops->dev_set_proximity(&pdev->dev, node);",
          "",
          "[Added Lines]",
          "1378:  if (ops->dev_set_proximity) {",
          "1379:   ret = ops->dev_set_proximity(&pdev->dev, node);",
          "1380:   if (ret)",
          "1381:    goto dev_put;",
          "1382:  }",
          "",
          "---------------"
        ]
      }
    }
  ]
}