{
  "cve_id": "CVE-2015-7551",
  "cve_desc": "The Fiddle::Handle implementation in ext/fiddle/handle.c in Ruby before 2.0.0-p648, 2.1 before 2.1.8, and 2.2 before 2.2.4, as distributed in Apple OS X before 10.11.4 and other products, mishandles tainting, which allows context-dependent attackers to execute arbitrary code or cause a denial of service (application crash) via a crafted string, related to the DL module and the libffi library.  NOTE: this vulnerability exists because of a CVE-2009-5147 regression.",
  "repo": "ruby/ruby",
  "patch_hash": "339e11a7f178312d937b7c95dd3115ce7236597a",
  "patch_info": {
    "commit_hash": "339e11a7f178312d937b7c95dd3115ce7236597a",
    "repo": "ruby/ruby",
    "commit_url": "https://github.com/ruby/ruby/commit/339e11a7f178312d937b7c95dd3115ce7236597a",
    "files": [
      "ChangeLog",
      "ext/fiddle/handle.c",
      "test/fiddle/test_handle.rb",
      "version.h"
    ],
    "message": "merge revision(s): 53153 and 23405@ruby_1_9_1\n\n\t* ext/fiddle/handle.c: check tainted string arguments.\n\t  Patch provided by tenderlove and nobu.\n\n\t* test/fiddle/test_handle.rb (class TestHandle): add test for above.\n\n\t* ext/dl/handle.c (rb_dlhandle_initialize): prohibits DL::dlopen\n\t  with a tainted name of library.\n\t  Patch by sheepman <sheepman AT sheepman.sakura.ne.jp>.\n\n\t* ext/dl/handle.c (rb_dlhandle_sym): ditto\n\n\n\ngit-svn-id: svn+ssh://ci.ruby-lang.org/ruby/branches/ruby_2_1@53156 b2dd03c8-39d4-4d8f-98ff-823fe69b080e",
    "before_after_code_files": [
      "ext/fiddle/handle.c||ext/fiddle/handle.c",
      "test/fiddle/test_handle.rb||test/fiddle/test_handle.rb",
      "version.h||version.h"
    ]
  },
  "patch_diff": {
    "ext/fiddle/handle.c||ext/fiddle/handle.c": [
      "File: ext/fiddle/handle.c -> ext/fiddle/handle.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1: #include <ruby.h>",
      "2: #include <fiddle.h>",
      "4: VALUE rb_cHandle;",
      "6: struct dl_handle {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "4: #define SafeStringValueCStr(v) (rb_check_safe_obj(rb_string_value(&v)), StringValueCStr(v))",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "143:  cflag = RTLD_LAZY | RTLD_GLOBAL;",
      "144:  break;",
      "145:       case 1:",
      "147:  cflag = RTLD_LAZY | RTLD_GLOBAL;",
      "148:  break;",
      "149:       case 2:",
      "151:  cflag = NUM2INT(flag);",
      "152:  break;",
      "153:       default:",
      "",
      "[Removed Lines]",
      "146:  clib = NIL_P(lib) ? NULL : StringValuePtr(lib);",
      "150:  clib = NIL_P(lib) ? NULL : StringValuePtr(lib);",
      "",
      "[Added Lines]",
      "148:  clib = NIL_P(lib) ? NULL : SafeStringValueCStr(lib);",
      "152:  clib = NIL_P(lib) ? NULL : SafeStringValueCStr(lib);",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "263:     return PTR2NUM(fiddle_handle);",
      "264: }",
      "",
      "[Removed Lines]",
      "266: static VALUE fiddle_handle_sym(void *handle, const char *symbol);",
      "",
      "[Added Lines]",
      "268: static VALUE fiddle_handle_sym(void *handle, VALUE symbol);",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "282:  rb_raise(rb_eFiddleError, \"closed handle\");",
      "283:     }",
      "286: }",
      "288: #ifndef RTLD_NEXT",
      "",
      "[Removed Lines]",
      "285:     return fiddle_handle_sym(fiddle_handle->ptr, StringValueCStr(sym));",
      "",
      "[Added Lines]",
      "287:     return fiddle_handle_sym(fiddle_handle->ptr, sym);",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "305: static VALUE",
      "306: rb_fiddle_handle_s_sym(VALUE self, VALUE sym)",
      "307: {",
      "309: }",
      "311: static VALUE",
      "313: {",
      "314: #if defined(HAVE_DLERROR)",
      "315:     const char *err;",
      "",
      "[Removed Lines]",
      "308:     return fiddle_handle_sym(RTLD_NEXT, StringValueCStr(sym));",
      "312: fiddle_handle_sym(void *handle, const char *name)",
      "",
      "[Added Lines]",
      "310:     return fiddle_handle_sym(RTLD_NEXT, sym);",
      "314: fiddle_handle_sym(void *handle, VALUE symbol)",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "318: # define CHECK_DLERROR",
      "319: #endif",
      "320:     void (*func)();",
      "322:     rb_secure(2);",
      "323: #ifdef HAVE_DLERROR",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "323:     const char *name = SafeStringValueCStr(symbol);",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "367:     }",
      "368: #endif",
      "369:     if( !func ){",
      "371:     }",
      "373:     return PTR2NUM(func);",
      "",
      "[Removed Lines]",
      "370:  rb_raise(rb_eFiddleError, \"unknown symbol \\\"%s\\\"\", name);",
      "",
      "[Added Lines]",
      "373:  rb_raise(rb_eFiddleError, \"unknown symbol \\\"%\"PRIsVALUE\"\\\"\", symbol);",
      "",
      "---------------"
    ],
    "test/fiddle/test_handle.rb||test/fiddle/test_handle.rb": [
      "File: test/fiddle/test_handle.rb -> test/fiddle/test_handle.rb",
      "--- Hunk 1 ---",
      "[Context before]",
      "11:     include Test::Unit::Assertions",
      "13:     def test_to_i",
      "14:       handle = Fiddle::Handle.new(LIBC_SO)",
      "15:       assert_kind_of Integer, handle.to_i",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "13:     def test_safe_handle_open",
      "14:       t = Thread.new do",
      "15:         $SAFE = 1",
      "16:         Fiddle::Handle.new(LIBC_SO.taint)",
      "17:       end",
      "18:       assert_raise(SecurityError) { t.value }",
      "19:     end",
      "21:     def test_safe_function_lookup",
      "22:       t = Thread.new do",
      "23:         h = Fiddle::Handle.new(LIBC_SO)",
      "24:         $SAFE = 1",
      "25:         h[\"qsort\".taint]",
      "26:       end",
      "27:       assert_raise(SecurityError) { t.value }",
      "28:     end",
      "",
      "---------------"
    ],
    "version.h||version.h": [
      "File: version.h -> version.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "1: #define RUBY_VERSION \"2.1.8\"",
      "2: #define RUBY_RELEASE_DATE \"2015-12-16\"",
      "5: #define RUBY_RELEASE_YEAR 2015",
      "6: #define RUBY_RELEASE_MONTH 12",
      "",
      "[Removed Lines]",
      "3: #define RUBY_PATCHLEVEL 438",
      "",
      "[Added Lines]",
      "3: #define RUBY_PATCHLEVEL 439",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "6827f86c519421fbbcc772c83845ada36f6bc5d5",
      "candidate_info": {
        "commit_hash": "6827f86c519421fbbcc772c83845ada36f6bc5d5",
        "repo": "ruby/ruby",
        "commit_url": "https://github.com/ruby/ruby/commit/6827f86c519421fbbcc772c83845ada36f6bc5d5",
        "files": [
          "ChangeLog",
          "insns.def",
          "version.h"
        ],
        "message": "merge revision(s) 54028: [Backport #12158]\n\n\t* insns.def (opt_mod): show its method name on ZeroDivisionError.\n\t  [Bug #12158]\n\n\ngit-svn-id: svn+ssh://ci.ruby-lang.org/ruby/branches/ruby_2_1@54271 b2dd03c8-39d4-4d8f-98ff-823fe69b080e",
        "before_after_code_files": [
          "insns.def||insns.def",
          "version.h||version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.h||version.h"
          ],
          "candidate": [
            "version.h||version.h"
          ]
        }
      },
      "candidate_diff": {
        "insns.def||insns.def": [
          "File: insns.def -> insns.def",
          "--- Hunk 1 ---",
          "[Context before]",
          "1553:      long div, mod;",
          "1555:      if (y == 0)",
          "1557:      if (y < 0) {",
          "1558:   if (x < 0)",
          "1559:       div = -x / -y;",
          "",
          "[Removed Lines]",
          "1556:   rb_num_zerodiv();",
          "",
          "[Added Lines]",
          "1556:   goto INSN_LABEL(normal_dispatch);",
          "",
          "---------------"
        ],
        "version.h||version.h": [
          "File: version.h -> version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: #define RUBY_VERSION \"2.1.9\"",
          "2: #define RUBY_RELEASE_DATE \"2016-03-25\"",
          "5: #define RUBY_RELEASE_YEAR 2016",
          "6: #define RUBY_RELEASE_MONTH 3",
          "",
          "[Removed Lines]",
          "3: #define RUBY_PATCHLEVEL 468",
          "",
          "[Added Lines]",
          "3: #define RUBY_PATCHLEVEL 469",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "560c2da384574e3ccbeb9f4b15747a2e22eeb621",
      "candidate_info": {
        "commit_hash": "560c2da384574e3ccbeb9f4b15747a2e22eeb621",
        "repo": "ruby/ruby",
        "commit_url": "https://github.com/ruby/ruby/commit/560c2da384574e3ccbeb9f4b15747a2e22eeb621",
        "files": [
          "ChangeLog",
          "test/ruby/test_process.rb",
          "version.h"
        ],
        "message": "merge revision(s) 54010: [Backport #12154]\n\n\t* test/ruby/test_process.rb (test_execopts_gid): Skip a test\n\t  that is known to fail on AIX. AIX allows setgid to\n\t  a supplementary group, but Ruby does not allow the \"-e\"\n\t  option when setgid'ed, so the test does not work as intended.\n\n\ngit-svn-id: svn+ssh://ci.ruby-lang.org/ruby/branches/ruby_2_1@54269 b2dd03c8-39d4-4d8f-98ff-823fe69b080e",
        "before_after_code_files": [
          "test/ruby/test_process.rb||test/ruby/test_process.rb",
          "version.h||version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.h||version.h"
          ],
          "candidate": [
            "version.h||version.h"
          ]
        }
      },
      "candidate_diff": {
        "test/ruby/test_process.rb||test/ruby/test_process.rb": [
          "File: test/ruby/test_process.rb -> test/ruby/test_process.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "1644:       assert_nothing_raised(feature6975) do",
          "1645:         begin",
          "1646:           g = IO.popen([RUBY, \"-e\", \"print Process.gid\", gid: group], &:read)",
          "1648:         rescue Errno::EPERM, NotImplementedError",
          "1649:         end",
          "1650:       end",
          "",
          "[Removed Lines]",
          "1647:           assert_equal(gid, g, feature6975)",
          "",
          "[Added Lines]",
          "1647:           # AIX allows a non-root process to setgid to its supplementary group,",
          "1648:           # while other UNIXes do not. (This might be AIX's violation of the POSIX standard.)",
          "1649:           # However, Ruby does not allow a setgid'ed Ruby process to use the -e option.",
          "1650:           # As a result, the Ruby process invoked by \"IO.popen([RUBY, \"-e\", ...\" above fails",
          "1651:           # with a message like \"no -e allowed while running setgid (SecurityError)\" to stderr,",
          "1652:           # the exis status is set to 1, and the variable \"g\" is set to an empty string.",
          "1653:           # To conclude, on AIX, if the \"gid\" variable is a supplementary group,",
          "1654:           # the assert_equal next can fail, so skip it.",
          "1655:           assert_equal(gid, g, feature6975) unless $?.exitstatus == 1 && /aix/ =~ RUBY_PLATFORM && gid != Process.gid",
          "",
          "---------------"
        ],
        "version.h||version.h": [
          "File: version.h -> version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: #define RUBY_VERSION \"2.1.9\"",
          "2: #define RUBY_RELEASE_DATE \"2016-03-25\"",
          "5: #define RUBY_RELEASE_YEAR 2016",
          "6: #define RUBY_RELEASE_MONTH 3",
          "",
          "[Removed Lines]",
          "3: #define RUBY_PATCHLEVEL 466",
          "",
          "[Added Lines]",
          "3: #define RUBY_PATCHLEVEL 467",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "85f3339697f48cdc292374d3ae6b079d67c22274",
      "candidate_info": {
        "commit_hash": "85f3339697f48cdc292374d3ae6b079d67c22274",
        "repo": "ruby/ruby",
        "commit_url": "https://github.com/ruby/ruby/commit/85f3339697f48cdc292374d3ae6b079d67c22274",
        "files": [
          "ext/io/console/io-console.gemspec",
          "version.h"
        ],
        "message": "merge revision(s) r48878: [Backport #9591]\n\n\tio-console.gemspec: bump up\n\n\t* ext/io/console/io-console.gemspec: bump up to 0.4.3.\n\ngit-svn-id: svn+ssh://ci.ruby-lang.org/ruby/branches/ruby_2_1@50127 b2dd03c8-39d4-4d8f-98ff-823fe69b080e",
        "before_after_code_files": [
          "ext/io/console/io-console.gemspec||ext/io/console/io-console.gemspec",
          "version.h||version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.h||version.h"
          ],
          "candidate": [
            "version.h||version.h"
          ]
        }
      },
      "candidate_diff": {
        "ext/io/console/io-console.gemspec||ext/io/console/io-console.gemspec": [
          "File: ext/io/console/io-console.gemspec -> ext/io/console/io-console.gemspec",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: # -*- ruby -*-",
          "3: date = %w$Date::                           $[1]",
          "5: Gem::Specification.new do |s|",
          "",
          "[Removed Lines]",
          "2: _VERSION = \"0.4.2\"",
          "",
          "[Added Lines]",
          "2: _VERSION = \"0.4.3\"",
          "",
          "---------------"
        ],
        "version.h||version.h": [
          "File: version.h -> version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: #define RUBY_VERSION \"2.1.5\"",
          "2: #define RUBY_RELEASE_DATE \"2015-03-30\"",
          "5: #define RUBY_RELEASE_YEAR 2015",
          "6: #define RUBY_RELEASE_MONTH 3",
          "",
          "[Removed Lines]",
          "3: #define RUBY_PATCHLEVEL 322",
          "",
          "[Added Lines]",
          "3: #define RUBY_PATCHLEVEL 323",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "9f8d00ff9aa85d097def654494b16c2ce09d8e92",
      "candidate_info": {
        "commit_hash": "9f8d00ff9aa85d097def654494b16c2ce09d8e92",
        "repo": "ruby/ruby",
        "commit_url": "https://github.com/ruby/ruby/commit/9f8d00ff9aa85d097def654494b16c2ce09d8e92",
        "files": [
          "ChangeLog",
          "compile.c",
          "test/ruby/test_settracefunc.rb",
          "version.h"
        ],
        "message": "merge revision(s) 48609: [Backport #10449] [Backport #11651]\n\n\t* compile.c (iseq_compile_each): remove duplicated line event.\n\t  [Bug #10449]\n\n\t* test/ruby/test_settracefunc.rb: add and fix tests.\n\n\ngit-svn-id: svn+ssh://ci.ruby-lang.org/ruby/branches/ruby_2_1@52640 b2dd03c8-39d4-4d8f-98ff-823fe69b080e",
        "before_after_code_files": [
          "compile.c||compile.c",
          "test/ruby/test_settracefunc.rb||test/ruby/test_settracefunc.rb",
          "version.h||version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.h||version.h"
          ],
          "candidate": [
            "version.h||version.h"
          ]
        }
      },
      "candidate_diff": {
        "compile.c||compile.c": [
          "File: compile.c -> compile.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "3264:  return COMPILE_OK;",
          "3265:     }",
          "3268:     debug_node_start(node);",
          "3270:     type = nd_type(node);",
          "3277:     switch (type) {",
          "3278:       case NODE_BLOCK:{",
          "3279:  while (node && nd_type(node) == NODE_BLOCK) {",
          "",
          "[Removed Lines]",
          "3267:     iseq->compile_data->last_line = line = (int)nd_line(node);",
          "3272:     if (node->flags & NODE_FL_NEWLINE) {",
          "3273:  ADD_TRACE(ret, line, RUBY_EVENT_LINE);",
          "3274:  saved_last_element = ret->last;",
          "3275:     }",
          "",
          "[Added Lines]",
          "3267:     line = (int)nd_line(node);",
          "3269:     if (iseq->compile_data->last_line == line) {",
          "3271:     }",
          "3272:     else {",
          "3273:  if (node->flags & NODE_FL_NEWLINE) {",
          "3274:      iseq->compile_data->last_line = line;",
          "3275:      ADD_TRACE(ret, line, RUBY_EVENT_LINE);",
          "3276:      saved_last_element = ret->last;",
          "3277:  }",
          "3278:     }",
          "",
          "---------------"
        ],
        "test/ruby/test_settracefunc.rb||test/ruby/test_settracefunc.rb": [
          "File: test/ruby/test_settracefunc.rb -> test/ruby/test_settracefunc.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "509:      [:return,  16, \"xyzzy\", xyzzy.class, :bar,             xyzzy,       :XYZZY_bar, xyzzy],",
          "510:      [:return,  12, \"xyzzy\", xyzzy.class, :foo,             xyzzy,       :XYZZY_foo, xyzzy],",
          "511:      [:line,    20, \"xyzzy\", TestSetTraceFunc, method,      self,        :outer, :nothing],",
          "513:      [:c_call,  20, \"xyzzy\", Kernel,      :raise,           self,        :outer, :nothing],",
          "514:      [:c_call,  20, \"xyzzy\", Exception,   :exception,       RuntimeError, :outer, :nothing],",
          "515:      [:c_call,  20, \"xyzzy\", Exception,   :initialize,      raised_exc,  :outer, :nothing],",
          "",
          "[Removed Lines]",
          "512:      [:line,    20, \"xyzzy\", TestSetTraceFunc, method,      self,        :outer, :nothing],",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "565:   def test_tracepoint",
          "566:     events1, answer_events = *trace_by_tracepoint(:line, :class, :end, :call, :return, :c_call, :c_return, :raise)",
          "573:       end",
          "576:     answer_events.zip(events1){|answer, event|",
          "577:       assert_equal answer, event, mesg",
          "578:     }",
          "",
          "[Removed Lines]",
          "568:     mesg = events1.map{|e|",
          "569:       if false",
          "570:         p [:event, e[0]]",
          "571:         p [:line_file, e[1], e[2]]",
          "572:         p [:id, e[4]]",
          "574:       \"#{e[0]} - #{e[2]}:#{e[1]} id: #{e[4]}\"",
          "575:     }.join(\"\\n\")",
          "",
          "[Added Lines]",
          "567:     ms = [events1, answer_events].map{|evs|",
          "568:       evs.map{|e|",
          "569:         \"#{e[0]} - #{e[2]}:#{e[1]} id; #{e[4]}\"",
          "570:       }",
          "571:     }",
          "573:     mesg = ms[0].zip(ms[1]).map{|a, b|",
          "574:       if a != b",
          "575:         \"#{a} <-> #{b}\"",
          "577:     }.compact.join(\"\\n\")",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1417:     end",
          "1418:   end",
          "1420:   class Bug10724",
          "1421:     def initialize",
          "1422:       loop{return}",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1422:   def test_no_duplicate_line_events",
          "1423:     lines = []",
          "1424:     dummy = []",
          "1426:     TracePoint.new(:line){|tp|",
          "1427:       next unless target_thread?",
          "1428:       lines << tp.lineno",
          "1429:     }.enable{",
          "1430:       dummy << (1) + (2)",
          "1431:       dummy << (1) + (2)",
          "1432:     }",
          "1433:     assert_equal [__LINE__ - 3, __LINE__ - 2], lines, 'Bug #10449'",
          "1434:   end",
          "",
          "---------------"
        ],
        "version.h||version.h": [
          "File: version.h -> version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: #define RUBY_VERSION \"2.1.8\"",
          "2: #define RUBY_RELEASE_DATE \"2015-11-18\"",
          "5: #define RUBY_RELEASE_YEAR 2015",
          "6: #define RUBY_RELEASE_MONTH 11",
          "",
          "[Removed Lines]",
          "3: #define RUBY_PATCHLEVEL 415",
          "",
          "[Added Lines]",
          "3: #define RUBY_PATCHLEVEL 416",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "410699b90e2bb1d2ac2c0d49c204d2576d8335a1",
      "candidate_info": {
        "commit_hash": "410699b90e2bb1d2ac2c0d49c204d2576d8335a1",
        "repo": "ruby/ruby",
        "commit_url": "https://github.com/ruby/ruby/commit/410699b90e2bb1d2ac2c0d49c204d2576d8335a1",
        "files": [
          "ChangeLog",
          "ext/thread/thread.c",
          "test/thread/test_cv.rb",
          "test/thread/test_queue.rb",
          "version.h"
        ],
        "message": "merge revision(s) r44681: [Backport #9440]\n\n\t* ext/thread/thread.c (Init_thread): ConditionVariable and Queue\n\t  are not able to copy.  [ruby-core:59961] [Bug #9440]\n\n\ngit-svn-id: svn+ssh://ci.ruby-lang.org/ruby/branches/ruby_2_1@50044 b2dd03c8-39d4-4d8f-98ff-823fe69b080e",
        "before_after_code_files": [
          "ext/thread/thread.c||ext/thread/thread.c",
          "test/thread/test_cv.rb||test/thread/test_cv.rb",
          "test/thread/test_queue.rb||test/thread/test_queue.rb",
          "version.h||version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.h||version.h"
          ],
          "candidate": [
            "version.h||version.h"
          ]
        }
      },
      "candidate_diff": {
        "ext/thread/thread.c||ext/thread/thread.c": [
          "File: ext/thread/thread.c -> ext/thread/thread.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "591:     rb_define_method(rb_cConditionVariable, \"initialize\", rb_condvar_initialize, 0);",
          "592:     rb_define_method(rb_cConditionVariable, \"marshal_dump\", undumpable, 0);",
          "593:     rb_define_method(rb_cConditionVariable, \"wait\", rb_condvar_wait, -1);",
          "594:     rb_define_method(rb_cConditionVariable, \"signal\", rb_condvar_signal, 0);",
          "595:     rb_define_method(rb_cConditionVariable, \"broadcast\", rb_condvar_broadcast, 0);",
          "597:     rb_define_method(rb_cQueue, \"initialize\", rb_queue_initialize, 0);",
          "598:     rb_define_method(rb_cQueue, \"marshal_dump\", undumpable, 0);",
          "599:     rb_define_method(rb_cQueue, \"push\", rb_queue_push, 1);",
          "600:     rb_define_method(rb_cQueue, \"pop\", rb_queue_pop, -1);",
          "601:     rb_define_method(rb_cQueue, \"empty?\", rb_queue_empty_p, 0);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "593:     rb_undef_method(rb_cConditionVariable, \"initialize_copy\");",
          "600:     rb_undef_method(rb_cQueue, \"initialize_copy\");",
          "",
          "---------------"
        ],
        "test/thread/test_cv.rb||test/thread/test_cv.rb": [
          "File: test/thread/test_cv.rb -> test/thread/test_cv.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "195:     assert_nothing_raised(Exception) { mutex.synchronize {condvar.broadcast} }",
          "196:   end",
          "198:   (DumpableCV = ConditionVariable.dup).class_eval {remove_method :marshal_dump}",
          "200:   def test_dump",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "198:   def test_dup",
          "199:     bug9440 = '[ruby-core:59961] [Bug #9440]'",
          "200:     condvar = ConditionVariable.new",
          "201:     assert_raise(NoMethodError, bug9440) do",
          "202:       condvar.dup",
          "203:     end",
          "204:   end",
          "",
          "---------------"
        ],
        "test/thread/test_queue.rb||test/thread/test_queue.rb": [
          "File: test/thread/test_queue.rb -> test/thread/test_queue.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "220:     end",
          "221:   end",
          "223:   (DumpableQueue = Queue.dup).class_eval {remove_method :marshal_dump}",
          "225:   def test_dump",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "223:   def test_dup",
          "224:     bug9440 = '[ruby-core:59961] [Bug #9440]'",
          "225:     q = Queue.new",
          "226:     assert_raise(NoMethodError, bug9440) do",
          "227:       q.dup",
          "228:     end",
          "229:   end",
          "",
          "---------------"
        ],
        "version.h||version.h": [
          "File: version.h -> version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: #define RUBY_VERSION \"2.1.5\"",
          "5: #define RUBY_RELEASE_YEAR 2015",
          "6: #define RUBY_RELEASE_MONTH 3",
          "9: #include \"ruby/version.h\"",
          "",
          "[Removed Lines]",
          "2: #define RUBY_RELEASE_DATE \"2015-03-18\"",
          "3: #define RUBY_PATCHLEVEL 319",
          "7: #define RUBY_RELEASE_DAY 18",
          "",
          "[Added Lines]",
          "2: #define RUBY_RELEASE_DATE \"2015-03-22\"",
          "3: #define RUBY_PATCHLEVEL 320",
          "7: #define RUBY_RELEASE_DAY 22",
          "",
          "---------------"
        ]
      }
    }
  ]
}