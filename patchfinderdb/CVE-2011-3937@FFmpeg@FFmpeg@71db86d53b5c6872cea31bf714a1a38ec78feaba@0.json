{
  "cve_id": "CVE-2011-3937",
  "cve_desc": "The H.263 codec (libavcodec/h263dec.c) in FFmpeg 0.7.x before 0.7.12, 0.8.x before 0.8.11, and unspecified versions before 0.10, and in Libav 0.5.x before 0.5.9, 0.6.x before 0.6.6, 0.7.x before 0.7.5, and 0.8.x before 0.8.1 has unspecified impact and attack vectors related to \"width/height changing with frame threads.\"",
  "repo": "FFmpeg/FFmpeg",
  "patch_hash": "71db86d53b5c6872cea31bf714a1a38ec78feaba",
  "patch_info": {
    "commit_hash": "71db86d53b5c6872cea31bf714a1a38ec78feaba",
    "repo": "FFmpeg/FFmpeg",
    "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/71db86d53b5c6872cea31bf714a1a38ec78feaba",
    "files": [
      "libavcodec/h263dec.c"
    ],
    "message": "h263dec: Disallow width/height changing with frame threads.\n\nFixes CVE-2011-3937\n\nFound-by: Mateusz \"j00ru\" Jurczyk and Gynvael Coldwind\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>",
    "before_after_code_files": [
      "libavcodec/h263dec.c||libavcodec/h263dec.c"
    ]
  },
  "patch_diff": {
    "libavcodec/h263dec.c||libavcodec/h263dec.c": [
      "File: libavcodec/h263dec.c -> libavcodec/h263dec.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "556: #if HAVE_MMX",
      "557:     if (s->codec_id == CODEC_ID_MPEG4 && s->xvid_build>=0 && avctx->idct_algo == FF_IDCT_AUTO && (av_get_cpu_flags() & AV_CPU_FLAG_MMX)) {",
      "558:         avctx->idct_algo= FF_IDCT_XVIDMMX;",
      "561:         s->picture_number=0;",
      "562:     }",
      "563: #endif",
      "",
      "[Removed Lines]",
      "559:         avctx->coded_width= 0; // force reinit",
      "",
      "[Added Lines]",
      "559:         ff_dct_common_init(s);",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "571:         || s->height != avctx->coded_height) {",
      "573:         ParseContext pc= s->parse_context; //FIXME move these demuxng hack to avformat",
      "574:         s->parse_context.buffer=0;",
      "575:         ff_MPV_common_end(s);",
      "576:         s->parse_context= pc;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "574:         if (HAVE_THREADS && (s->avctx->active_thread_type&FF_THREAD_FRAME)) {",
      "575:             av_log_missing_feature(s->avctx, \"Width/height/bit depth/chroma idc changing with threads is\", 0);",
      "576:             return -1;   // width / height changed during parallelized decoding",
      "577:         }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "522645e38f6d0aa78ebf3afb356e7427bf4eb248",
      "candidate_info": {
        "commit_hash": "522645e38f6d0aa78ebf3afb356e7427bf4eb248",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/522645e38f6d0aa78ebf3afb356e7427bf4eb248",
        "files": [
          "libavcodec/h263dec.c"
        ],
        "message": "h263dec: Disallow width/height changing with frame threads.\n\nFixes CVE-2011-3937\n\nFound-by: Mateusz \"j00ru\" Jurczyk and Gynvael Coldwind\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>\n(cherry picked from commit 71db86d53b5c6872cea31bf714a1a38ec78feaba)\n\nConflicts:\n\n\tlibavcodec/h263dec.c\n\nSigned-off-by: Alex Converse <alex.converse@gmail.com>",
        "before_after_code_files": [
          "libavcodec/h263dec.c||libavcodec/h263dec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavcodec/h263dec.c||libavcodec/h263dec.c"
          ],
          "candidate": [
            "libavcodec/h263dec.c||libavcodec/h263dec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavcodec/h263dec.c||libavcodec/h263dec.c": [
          "File: libavcodec/h263dec.c -> libavcodec/h263dec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "556: #if HAVE_MMX",
          "557:     if (s->codec_id == CODEC_ID_MPEG4 && s->xvid_build>=0 && avctx->idct_algo == FF_IDCT_AUTO && (av_get_cpu_flags() & AV_CPU_FLAG_MMX)) {",
          "558:         avctx->idct_algo= FF_IDCT_XVIDMMX;",
          "561:         s->picture_number=0;",
          "562:     }",
          "563: #endif",
          "",
          "[Removed Lines]",
          "559:         avctx->coded_width= 0; // force reinit",
          "",
          "[Added Lines]",
          "559:         ff_dct_common_init(s);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "571:         || s->height != avctx->coded_height) {",
          "573:         ParseContext pc= s->parse_context; //FIXME move these demuxng hack to avformat",
          "574:         s->parse_context.buffer=0;",
          "575:         MPV_common_end(s);",
          "576:         s->parse_context= pc;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "574:         if (HAVE_THREADS && (s->avctx->active_thread_type&FF_THREAD_FRAME)) {",
          "575:             av_log_missing_feature(s->avctx, \"Width/height/bit depth/chroma idc changing with threads is\", 0);",
          "576:             return -1;   // width / height changed during parallelized decoding",
          "577:         }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "58361100188a1f80bcd9b6c58a4ce588032da1ad",
      "candidate_info": {
        "commit_hash": "58361100188a1f80bcd9b6c58a4ce588032da1ad",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/58361100188a1f80bcd9b6c58a4ce588032da1ad",
        "files": [
          "libavcodec/h263dec.c"
        ],
        "message": "h263dec: Disallow width/height changing with frame threads.\n\nFixes CVE-2011-3937\n\nFound-by: Mateusz \"j00ru\" Jurczyk and Gynvael Coldwind\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>\n(cherry picked from commit 71db86d53b5c6872cea31bf714a1a38ec78feaba)\n\nConflicts:\n\n\tlibavcodec/h263dec.c\n\nSigned-off-by: Reinhard Tartler <siretart@tauware.de>",
        "before_after_code_files": [
          "libavcodec/h263dec.c||libavcodec/h263dec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavcodec/h263dec.c||libavcodec/h263dec.c"
          ],
          "candidate": [
            "libavcodec/h263dec.c||libavcodec/h263dec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavcodec/h263dec.c||libavcodec/h263dec.c": [
          "File: libavcodec/h263dec.c -> libavcodec/h263dec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "579:         ParseContext pc= s->parse_context; //FIXME move these demuxng hack to avformat",
          "581:         s->parse_context.buffer=0;",
          "582:         MPV_common_end(s);",
          "583:         s->parse_context= pc;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "581:         if (HAVE_THREADS && (s->avctx->active_thread_type&FF_THREAD_FRAME)) {",
          "582:             av_log_missing_feature(s->avctx, \"Width/height/bit depth/chroma idc changing with threads is\", 0);",
          "583:             return -1;   // width / height changed during parallelized decoding",
          "584:         }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "4be63587e110c05cda3101abf2e3745d919f3fae",
      "candidate_info": {
        "commit_hash": "4be63587e110c05cda3101abf2e3745d919f3fae",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/4be63587e110c05cda3101abf2e3745d919f3fae",
        "files": [
          "libavcodec/h263dec.c"
        ],
        "message": "h263dec: Disallow width/height changing with frame threads.\n\nFixes CVE-2011-3937\n\nFound-by: Mateusz \"j00ru\" Jurczyk and Gynvael Coldwind\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>\n(cherry picked from commit 71db86d53b5c6872cea31bf714a1a38ec78feaba)\n\nConflicts:\n\n\tlibavcodec/h263dec.c\n\nSigned-off-by: Alex Converse <alex.converse@gmail.com>\nSigned-off-by: Reinhard Tartler <siretart@tauware.de>",
        "before_after_code_files": [
          "libavcodec/h263dec.c||libavcodec/h263dec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavcodec/h263dec.c||libavcodec/h263dec.c"
          ],
          "candidate": [
            "libavcodec/h263dec.c||libavcodec/h263dec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavcodec/h263dec.c||libavcodec/h263dec.c": [
          "File: libavcodec/h263dec.c -> libavcodec/h263dec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "552: #if HAVE_MMX",
          "553:     if (s->codec_id == CODEC_ID_MPEG4 && s->xvid_build>=0 && avctx->idct_algo == FF_IDCT_AUTO && (av_get_cpu_flags() & AV_CPU_FLAG_MMX)) {",
          "554:         avctx->idct_algo= FF_IDCT_XVIDMMX;",
          "557:         s->picture_number=0;",
          "558:     }",
          "559: #endif",
          "",
          "[Removed Lines]",
          "555:         avctx->coded_width= 0; // force reinit",
          "",
          "[Added Lines]",
          "555:         ff_dct_common_init(s);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "567:         || s->height != avctx->coded_height) {",
          "569:         ParseContext pc= s->parse_context; //FIXME move these demuxng hack to avformat",
          "570:         s->parse_context.buffer=0;",
          "571:         MPV_common_end(s);",
          "572:         s->parse_context= pc;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "570:         if (HAVE_THREADS && (s->avctx->active_thread_type&FF_THREAD_FRAME)) {",
          "571:             av_log_missing_feature(s->avctx, \"Width/height/bit depth/chroma idc changing with threads is\", 0);",
          "572:             return -1;   // width / height changed during parallelized decoding",
          "573:         }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "3313f31f012a434a7c7aac6cb2c554d5cbac88fc",
      "candidate_info": {
        "commit_hash": "3313f31f012a434a7c7aac6cb2c554d5cbac88fc",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/3313f31f012a434a7c7aac6cb2c554d5cbac88fc",
        "files": [
          "libavcodec/h263dec.c"
        ],
        "message": "h263dec: Disallow width/height changing with frame threads.\n\nFixes CVE-2011-3937\n\nFound-by: Mateusz \"j00ru\" Jurczyk and Gynvael Coldwind\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>\n(cherry picked from commit 71db86d53b5c6872cea31bf714a1a38ec78feaba)\n\nConflicts:\n\n\tlibavcodec/h263dec.c\n\nSigned-off-by: Alex Converse <alex.converse@gmail.com>\nSigned-off-by: Reinhard Tartler <siretart@tauware.de>\n(cherry picked from commit 4be63587e110c05cda3101abf2e3745d919f3fae)\n\nConflicts:\n\n\tlibavcodec/h263dec.c\n\nSigned-off-by: Reinhard Tartler <siretart@tauware.de>",
        "before_after_code_files": [
          "libavcodec/h263dec.c||libavcodec/h263dec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavcodec/h263dec.c||libavcodec/h263dec.c"
          ],
          "candidate": [
            "libavcodec/h263dec.c||libavcodec/h263dec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavcodec/h263dec.c||libavcodec/h263dec.c": [
          "File: libavcodec/h263dec.c -> libavcodec/h263dec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "575:         ParseContext pc= s->parse_context; //FIXME move these demuxng hack to avformat",
          "577:         s->parse_context.buffer=0;",
          "578:         MPV_common_end(s);",
          "579:         s->parse_context= pc;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "577:         if (HAVE_THREADS && (s->avctx->active_thread_type&FF_THREAD_FRAME)) {",
          "578:             av_log_missing_feature(s->avctx, \"Width/height/bit depth/chroma idc changing with threads is\", 0);",
          "579:             return -1;   // width / height changed during parallelized decoding",
          "580:         }",
          "",
          "---------------"
        ]
      }
    }
  ]
}