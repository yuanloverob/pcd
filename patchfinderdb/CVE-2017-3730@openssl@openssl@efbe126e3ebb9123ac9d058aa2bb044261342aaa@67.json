{
  "cve_id": "CVE-2017-3730",
  "cve_desc": "In OpenSSL 1.1.0 before 1.1.0d, if a malicious server supplies bad parameters for a DHE or ECDHE key exchange then this can result in the client attempting to dereference a NULL pointer leading to a client crash. This could be exploited in a Denial of Service attack.",
  "repo": "openssl/openssl",
  "patch_hash": "efbe126e3ebb9123ac9d058aa2bb044261342aaa",
  "patch_info": {
    "commit_hash": "efbe126e3ebb9123ac9d058aa2bb044261342aaa",
    "repo": "openssl/openssl",
    "commit_url": "https://github.com/openssl/openssl/commit/efbe126e3ebb9123ac9d058aa2bb044261342aaa",
    "files": [
      "ssl/statem/statem_clnt.c"
    ],
    "message": "Fix missing NULL checks in CKE processing\n\nReviewed-by: Rich Salz <rsalz@openssl.org>",
    "before_after_code_files": [
      "ssl/statem/statem_clnt.c||ssl/statem/statem_clnt.c"
    ]
  },
  "patch_diff": {
    "ssl/statem/statem_clnt.c||ssl/statem/statem_clnt.c": [
      "File: ssl/statem/statem_clnt.c -> ssl/statem/statem_clnt.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "2258:         return 0;",
      "2259:     }",
      "2260:     ckey = ssl_generate_pkey(skey);",
      "2261:     dh_clnt = EVP_PKEY_get0_DH(ckey);",
      "2263:     if (dh_clnt == NULL || ssl_derive(s, ckey, skey) == 0) {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "2261:     if (ckey == NULL) {",
      "2262:         SSLerr(SSL_F_TLS_CONSTRUCT_CKE_DHE, ERR_R_INTERNAL_ERROR);",
      "2263:         return 0;",
      "2264:     }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "2296:     }",
      "2298:     ckey = ssl_generate_pkey(skey);",
      "2300:     if (ssl_derive(s, ckey, skey) == 0) {",
      "2301:         SSLerr(SSL_F_TLS_CONSTRUCT_CKE_ECDHE, ERR_R_EVP_LIB);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "2304:     if (ckey == NULL) {",
      "2305:         SSLerr(SSL_F_TLS_CONSTRUCT_CKE_ECDHE, ERR_R_INTERNAL_ERROR);",
      "2306:         goto err;",
      "2307:     }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "722d42e1ea710ba036563a68dc7c4e987bf4991b",
      "candidate_info": {
        "commit_hash": "722d42e1ea710ba036563a68dc7c4e987bf4991b",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/722d42e1ea710ba036563a68dc7c4e987bf4991b",
        "files": [
          "ssl/statem/statem_srvr.c"
        ],
        "message": "Do not overallocate for tmp.ciphers_raw\n\nWell, not as much, at least.\n\nCommit 07afdf3c3ac97af4f2b4eec22a97f7230f8227e0 changed things so\nthat for SSLv2 format ClientHellos we store the cipher list in the\nTLS format, i.e., with two bytes per cipher, to be consistent with\nhistorical behavior.\n\nHowever, the space allocated for the array still performed the computation\nwith three bytes per cipher, a needless over-allocation (though a relatively\nsmall one, all things considered).\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\nReviewed-by: Matt Caswell <matt@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/2281)\n(cherry picked from commit f1429b85c5821e55224e5878da9d0fa420a41f71)",
        "before_after_code_files": [
          "ssl/statem/statem_srvr.c||ssl/statem/statem_srvr.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "ssl/statem/statem_srvr.c||ssl/statem/statem_srvr.c": [
          "File: ssl/statem/statem_srvr.c -> ssl/statem/statem_srvr.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "3280:         if (raw == NULL) {",
          "3282:             goto err;",
          "",
          "[Removed Lines]",
          "3279:         raw = s->s3->tmp.ciphers_raw = OPENSSL_malloc(numciphers * n);",
          "",
          "[Added Lines]",
          "3279:         raw = OPENSSL_malloc(numciphers * TLS_CIPHER_LEN);",
          "3280:         s->s3->tmp.ciphers_raw = raw;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "0de5e4f0924d5101a02480f9b42513d28db1307e",
      "candidate_info": {
        "commit_hash": "0de5e4f0924d5101a02480f9b42513d28db1307e",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/0de5e4f0924d5101a02480f9b42513d28db1307e",
        "files": [
          "Configurations/unix-Makefile.tmpl",
          "Configure"
        ],
        "message": "Remove automatic RPATH - add user rpath support\n\nMake Configure recognise -rpath and -R to support user added rpaths\nfor OSF1 and Solaris.  For convenience, add a variable LIBRPATH in the\nUnix Makefile, which the users can use as follows:\n\n    ./config [options] -Wl,-rpath,\\$(LIBRPATH)\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(cherry picked from commit fad599f7f147ee71e5581211fb654c2c8c491cd8)",
        "before_after_code_files": [
          "Configurations/unix-Makefile.tmpl||Configurations/unix-Makefile.tmpl"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "Configurations/unix-Makefile.tmpl||Configurations/unix-Makefile.tmpl": [
          "File: Configurations/unix-Makefile.tmpl -> Configurations/unix-Makefile.tmpl",
          "--- Hunk 1 ---",
          "[Context before]",
          "153: ENGINESDIR={- use File::Spec::Functions;",
          "154:               catdir($prefix,$libdir,\"engines-$sover\") -}",
          "156: MANDIR=$(INSTALLTOP)/share/man",
          "157: DOCDIR=$(INSTALLTOP)/share/doc/$(BASENAME)",
          "158: HTMLDIR=$(DOCDIR)/html",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "156: # Convenience variable for those who want to set the rpath in shared",
          "157: # libraries and applications",
          "158: LIBRPATH=$(INSTALLTOP)/$(LIBDIR)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1064:   APPNAME=$bin$exeext OBJECTS=\"$objs\" \\\\",
          "1065:   LIBDEPS='\\$(PLIB_LDFLAGS) '\"$linklibs\"' \\$(EX_LIBS)' \\\\",
          "1066:   CC='\\$(CC)' CFLAGS='\\$(CFLAGS) \\$(BIN_CFLAGS)' \\\\",
          "1068:   link_app.$shlib_target",
          "1069: EOF",
          "1070:   }",
          "",
          "[Removed Lines]",
          "1067:   LDFLAGS='\\$(LDFLAGS)' LIBRPATH='\\$(INSTALLTOP)/\\$(LIBDIR)' \\\\",
          "",
          "[Added Lines]",
          "1071:   LDFLAGS='\\$(LDFLAGS)' \\\\",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "e9fcdd2e69052412e67cbbf6e8b5bdc5b545d364",
      "candidate_info": {
        "commit_hash": "e9fcdd2e69052412e67cbbf6e8b5bdc5b545d364",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/e9fcdd2e69052412e67cbbf6e8b5bdc5b545d364",
        "files": [
          "test/d2i-tests/bad-cms.der",
          "test/d2i_test.c",
          "test/recipes/25-test_d2i.t"
        ],
        "message": "add test for CVE-2016-7053\n\nReviewed-by: Richard Levitte <levitte@openssl.org>",
        "before_after_code_files": [
          "test/d2i_test.c||test/d2i_test.c",
          "test/recipes/25-test_d2i.t||test/recipes/25-test_d2i.t"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "test/d2i_test.c||test/d2i_test.c": [
          "File: test/d2i_test.c -> test/d2i_test.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "20: #include <openssl/err.h>",
          "21: #include <openssl/x509.h>",
          "22: #include <openssl/x509v3.h>",
          "23: #include \"e_os.h\"",
          "25: static const ASN1_ITEM *item_type;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "23: #include <openssl/cms.h>",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "149:         ASN1_ITEM_ref(ASN1_ANY),",
          "150:         ASN1_ITEM_ref(X509),",
          "151:         ASN1_ITEM_ref(GENERAL_NAME),",
          "153:     };",
          "155:     static error_enum expected_errors[] = {",
          "",
          "[Removed Lines]",
          "152:         ASN1_ITEM_ref(ASN1_INTEGER)",
          "",
          "[Added Lines]",
          "153:         ASN1_ITEM_ref(ASN1_INTEGER),",
          "154:         ASN1_ITEM_ref(CMS_ContentInfo)",
          "",
          "---------------"
        ],
        "test/recipes/25-test_d2i.t||test/recipes/25-test_d2i.t": [
          "File: test/recipes/25-test_d2i.t -> test/recipes/25-test_d2i.t",
          "--- Hunk 1 ---",
          "[Context before]",
          "16: setup(\"test_d2i\");",
          "20: ok(run(test([\"d2i_test\", \"X509\", \"decode\",",
          "21:              srctop_file('test','d2i-tests','bad_cert.der')])),",
          "",
          "[Removed Lines]",
          "18: plan tests => 13;",
          "",
          "[Added Lines]",
          "18: plan tests => 14;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "79: ok(run(test([\"d2i_test\", \"ASN1_INTEGER\", \"decode\",",
          "80:              srctop_file('test','d2i-tests','bad-int-padminus1.der')])),",
          "81:    \"Running d2i_test bad-int-padminus1.der INTEGER\");",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "83: # Invalid CMS structure with decode error in CHOICE value.",
          "84: # Test for CVE-2016-7053",
          "86: ok(run(test([\"d2i_test\", \"CMS_ContentInfo\", \"decode\",",
          "87:              srctop_file('test','d2i-tests','bad-cms.der')])),",
          "88:    \"Running d2i_test bad-cms.der CMS ContentInfo\");",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "0d17628067daef233f2196a822775af083ec1660",
      "candidate_info": {
        "commit_hash": "0d17628067daef233f2196a822775af083ec1660",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/0d17628067daef233f2196a822775af083ec1660",
        "files": [
          "crypto/x509v3/v3_cpols.c"
        ],
        "message": "Fix a crash with malformed user notice policy numbers\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\nReviewed-by: Richard Levitte <levitte@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/2352)\n(cherry picked from commit fe4075f25962dbd302d856c11ac47adb84edc9ca)",
        "before_after_code_files": [
          "crypto/x509v3/v3_cpols.c||crypto/x509v3/v3_cpols.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "crypto/x509v3/v3_cpols.c||crypto/x509v3/v3_cpols.c": [
          "File: crypto/x509v3/v3_cpols.c -> crypto/x509v3/v3_cpols.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "345:     return 1;",
          "347:  merr:",
          "348:     X509V3err(X509V3_F_NREF_NOS, ERR_R_MALLOC_FAILURE);",
          "350:  err:",
          "352:     return 0;",
          "353: }",
          "",
          "[Removed Lines]",
          "351:     sk_ASN1_INTEGER_pop_free(nnums, ASN1_STRING_free);",
          "",
          "[Added Lines]",
          "348:     ASN1_INTEGER_free(aint);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "1968ea9850f7e50609284756ca78e465e5ee4fb9",
      "candidate_info": {
        "commit_hash": "1968ea9850f7e50609284756ca78e465e5ee4fb9",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/1968ea9850f7e50609284756ca78e465e5ee4fb9",
        "files": [
          "test/evp_test.c"
        ],
        "message": "test/evp_test.c: If no algorithm was specified, don't try to check for DES\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/2319)\n(cherry picked from commit 31b69e9a26c5b127ce273bc5834b9e13e5e25556)",
        "before_after_code_files": [
          "test/evp_test.c||test/evp_test.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "test/evp_test.c||test/evp_test.c": [
          "File: test/evp_test.c -> test/evp_test.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1245:     size_t mac_len;",
          "1247: #ifdef OPENSSL_NO_DES",
          "1250:         err = NULL;",
          "1251:         goto err;",
          "",
          "[Removed Lines]",
          "1248:     if (strstr(mdata->alg, \"DES\") != NULL) {",
          "",
          "[Added Lines]",
          "1248:     if (mdata->alg != NULL && strstr(mdata->alg, \"DES\") != NULL) {",
          "",
          "---------------"
        ]
      }
    }
  ]
}