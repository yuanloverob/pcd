{
  "cve_id": "CVE-2015-0273",
  "cve_desc": "Multiple use-after-free vulnerabilities in ext/date/php_date.c in PHP before 5.4.38, 5.5.x before 5.5.22, and 5.6.x before 5.6.6 allow remote attackers to execute arbitrary code via crafted serialized input containing a (1) R or (2) r type specifier in (a) DateTimeZone data handled by the php_date_timezone_initialize_from_hash function or (b) DateTime data handled by the php_date_initialize_from_hash function.",
  "repo": "php/php-src",
  "patch_hash": "7b1898183032eeabc64a086ff040af991cebcd93",
  "patch_info": {
    "commit_hash": "7b1898183032eeabc64a086ff040af991cebcd93",
    "repo": "php/php-src",
    "commit_url": "https://github.com/php/php-src/commit/7b1898183032eeabc64a086ff040af991cebcd93",
    "files": [
      "ext/date/php_date.c",
      "ext/date/tests/bug68942_2.phpt"
    ],
    "message": "Fix bug #68942 (Use after free vulnerability in unserialize() with DateTimeZone)\n\nConflicts:\n\text/date/php_date.c",
    "before_after_code_files": [
      "ext/date/php_date.c||ext/date/php_date.c",
      "ext/date/tests/bug68942_2.phpt||ext/date/tests/bug68942_2.phpt"
    ]
  },
  "patch_diff": {
    "ext/date/php_date.c||ext/date/php_date.c": [
      "File: ext/date/php_date.c -> ext/date/php_date.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "2575:  timelib_tzinfo   *tzi;",
      "2576:  php_timezone_obj *tzobj;",
      "2585:     switch (Z_LVAL_PP(z_timezone_type)) {",
      "2586:      case TIMELIB_ZONETYPE_OFFSET:",
      "",
      "[Removed Lines]",
      "2578:  if (zend_hash_find(myht, \"date\", 5, (void**) &z_date) == SUCCESS) {",
      "2579:   convert_to_string(*z_date);",
      "2580:   if (zend_hash_find(myht, \"timezone_type\", 14, (void**) &z_timezone_type) == SUCCESS) {",
      "2581:    convert_to_long(*z_timezone_type);",
      "2582:    if (zend_hash_find(myht, \"timezone\", 9, (void**) &z_timezone) == SUCCESS) {",
      "2583:     convert_to_string(*z_timezone);",
      "",
      "[Added Lines]",
      "2578:  if (zend_hash_find(myht, \"date\", 5, (void**) &z_date) == SUCCESS && Z_TYPE_PP(z_date) == IS_STRING) {",
      "2579:   if (zend_hash_find(myht, \"timezone_type\", 14, (void**) &z_timezone_type) == SUCCESS && Z_TYPE_PP(z_timezone_type) == IS_LONG) {",
      "2580:    if (zend_hash_find(myht, \"timezone\", 9, (void**) &z_timezone) == SUCCESS && Z_TYPE_PP(z_timezone) == IS_STRING) {",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "2596:      case TIMELIB_ZONETYPE_ID: {",
      "2597:       int ret;",
      "2600:       tzi = php_date_parse_tzfile(Z_STRVAL_PP(z_timezone), DATE_TIMEZONEDB TSRMLS_CC);",
      "",
      "[Removed Lines]",
      "2598:       convert_to_string(*z_timezone);",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ],
    "ext/date/tests/bug68942_2.phpt||ext/date/tests/bug68942_2.phpt": [
      "File: ext/date/tests/bug68942_2.phpt -> ext/date/tests/bug68942_2.phpt",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: --TEST--",
      "2: Bug #68942 (Use after free vulnerability in unserialize() with DateTime).",
      "3: --FILE--",
      "4: <?php",
      "5: $data = unserialize('a:2:{i:0;O:8:\"DateTime\":3:{s:4:\"date\";s:26:\"2000-01-01 00:00:00.000000\";s:13:\"timezone_type\";a:2:{i:0;i:1;i:1;i:2;}s:8:\"timezone\";s:1:\"A\";}i:1;R:5;}');",
      "6: var_dump($data);",
      "7: ?>",
      "8: --EXPECTF--",
      "9: Fatal error: Invalid serialization data for DateTime object in %s/bug68942_2.php on line %d",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "625ab10f990911fb474430ac7c83dfaea13346dd",
      "candidate_info": {
        "commit_hash": "625ab10f990911fb474430ac7c83dfaea13346dd",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/625ab10f990911fb474430ac7c83dfaea13346dd",
        "files": [
          "ext/date/php_date.c",
          "ext/date/tests/bug68942.phpt",
          "ext/date/tests/bug68942_2.phpt"
        ],
        "message": "Fix bug #68942 (Use after free vulnerability in unserialize() with DateTimeZone)",
        "before_after_code_files": [
          "ext/date/php_date.c||ext/date/php_date.c",
          "ext/date/tests/bug68942.phpt||ext/date/tests/bug68942.phpt",
          "ext/date/tests/bug68942_2.phpt||ext/date/tests/bug68942_2.phpt"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_issue": 1,
        "olp_code_files": {
          "patch": [
            "ext/date/php_date.c||ext/date/php_date.c",
            "ext/date/tests/bug68942_2.phpt||ext/date/tests/bug68942_2.phpt"
          ],
          "candidate": [
            "ext/date/php_date.c||ext/date/php_date.c",
            "ext/date/tests/bug68942_2.phpt||ext/date/tests/bug68942_2.phpt"
          ]
        }
      },
      "candidate_diff": {
        "ext/date/php_date.c||ext/date/php_date.c": [
          "File: ext/date/php_date.c -> ext/date/php_date.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2720:  php_timezone_obj *tzobj;",
          "2722:  z_date = zend_hash_str_find(myht, \"date\", sizeof(\"data\")-1);",
          "2725:   z_timezone_type = zend_hash_str_find(myht, \"timezone_type\", sizeof(\"timezone_type\")-1);",
          "2728:    z_timezone = zend_hash_str_find(myht, \"timezone\", sizeof(\"timezone\")-1);",
          "2732:     switch (Z_LVAL_P(z_timezone_type)) {",
          "2733:      case TIMELIB_ZONETYPE_OFFSET:",
          "2734:      case TIMELIB_ZONETYPE_ABBR: {",
          "",
          "[Removed Lines]",
          "2723:  if (z_date) {",
          "2724:   convert_to_string(z_date);",
          "2726:   if (z_timezone_type) {",
          "2727:    convert_to_long(z_timezone_type);",
          "2729:    if (z_timezone) {",
          "2730:     convert_to_string(z_timezone);",
          "",
          "[Added Lines]",
          "2723:  if (z_date && Z_TYPE_P(z_date) == IS_STRING) {",
          "2725:   if (z_timezone_type && Z_TYPE_P(z_timezone_type) == IS_LONG) {",
          "2727:    if (z_timezone && Z_TYPE_P(z_timezone) == IS_STRING) {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2743:      case TIMELIB_ZONETYPE_ID: {",
          "2744:       int ret;",
          "2747:       tzi = php_date_parse_tzfile(Z_STRVAL_P(z_timezone), DATE_TIMEZONEDB);",
          "",
          "[Removed Lines]",
          "2745:       convert_to_string(z_timezone);",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "3658:  if ((z_timezone_type = zend_hash_str_find(myht, \"timezone_type\", sizeof(\"timezone_type\")-1)) != NULL) {",
          "3659:   if ((z_timezone = zend_hash_str_find(myht, \"timezone\", sizeof(\"timezone\")-1)) != NULL) {",
          "3661:    if (SUCCESS == timezone_initialize(*tzobj, Z_STRVAL_P(z_timezone))) {",
          "3662:     return SUCCESS;",
          "3663:    }",
          "",
          "[Removed Lines]",
          "3660:    convert_to_long(z_timezone_type);",
          "",
          "[Added Lines]",
          "3655:    if(Z_TYPE_P(z_timezone_type) != IS_LONG) {",
          "3656:     return FAILURE;",
          "3657:    }",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "3683:  php_date_instantiate(date_ce_timezone, return_value);",
          "3684:  tzobj = Z_PHPTIMEZONE_P(return_value);",
          "3686: }",
          "",
          "[Removed Lines]",
          "3685:  php_date_timezone_initialize_from_hash(&return_value, &tzobj, myht);",
          "",
          "[Added Lines]",
          "3682:  if(php_date_timezone_initialize_from_hash(&return_value, &tzobj, myht) != SUCCESS) {",
          "3683:   php_error_docref(NULL, E_ERROR, \"Timezone initialization failed\");",
          "3684:  }",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "3699:  myht = Z_OBJPROP_P(object);",
          "3702: }",
          "",
          "[Removed Lines]",
          "3701:  php_date_timezone_initialize_from_hash(&return_value, &tzobj, myht);",
          "",
          "[Added Lines]",
          "3700:  if(php_date_timezone_initialize_from_hash(&return_value, &tzobj, myht) != SUCCESS) {",
          "3701:   php_error_docref(NULL, E_ERROR, \"Timezone initialization failed\");",
          "3702:  }",
          "",
          "---------------"
        ],
        "ext/date/tests/bug68942.phpt||ext/date/tests/bug68942.phpt": [
          "File: ext/date/tests/bug68942.phpt -> ext/date/tests/bug68942.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #68942 (Use after free vulnerability in unserialize() with DateTimeZone).",
          "3: --FILE--",
          "4: <?php",
          "5: $data = unserialize('a:2:{i:0;O:12:\"DateTimeZone\":2:{s:13:\"timezone_type\";a:2:{i:0;i:1;i:1;i:2;}s:8:\"timezone\";s:1:\"A\";}i:1;R:4;}');",
          "6: var_dump($data);",
          "7: ?>",
          "8: --EXPECTF--",
          "9: Fatal error: DateTimeZone::__wakeup(): Timezone initialization failed in %s/bug68942.php on line %d",
          "",
          "---------------"
        ],
        "ext/date/tests/bug68942_2.phpt||ext/date/tests/bug68942_2.phpt": [
          "File: ext/date/tests/bug68942_2.phpt -> ext/date/tests/bug68942_2.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #68942 (Use after free vulnerability in unserialize() with DateTime).",
          "3: --FILE--",
          "4: <?php",
          "5: $data = unserialize('a:2:{i:0;O:8:\"DateTime\":3:{s:4:\"date\";s:26:\"2000-01-01 00:00:00.000000\";s:13:\"timezone_type\";a:2:{i:0;i:1;i:1;i:2;}s:8:\"timezone\";s:1:\"A\";}i:1;R:5;}');",
          "6: var_dump($data);",
          "7: ?>",
          "8: --EXPECTF--",
          "9: Fatal error: Invalid serialization data for DateTime object in %s/bug68942_2.php on line %d",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "e441d71baae89bdc5dc6f75407b4a8f5e42b8fa9",
      "candidate_info": {
        "commit_hash": "e441d71baae89bdc5dc6f75407b4a8f5e42b8fa9",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/e441d71baae89bdc5dc6f75407b4a8f5e42b8fa9",
        "files": [
          "ext/date/php_date.c"
        ],
        "message": "fix bug#68942's patch\n\nFix type confusion bug in unserialize() with DateTimeZone. https://bugs.php.net/bug.php?id=68942",
        "before_after_code_files": [
          "ext/date/php_date.c||ext/date/php_date.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_issue": 1,
        "olp_code_files": {
          "patch": [
            "ext/date/php_date.c||ext/date/php_date.c"
          ],
          "candidate": [
            "ext/date/php_date.c||ext/date/php_date.c"
          ]
        }
      },
      "candidate_diff": {
        "ext/date/php_date.c||ext/date/php_date.c": [
          "File: ext/date/php_date.c -> ext/date/php_date.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "3713:  zval            **z_timezone_type = NULL;",
          "3715:  if (zend_hash_find(myht, \"timezone_type\", 14, (void**) &z_timezone_type) == SUCCESS && Z_TYPE_PP(z_timezone_type) == IS_LONG) {",
          "3717:    if (SUCCESS == timezone_initialize(*tzobj, Z_STRVAL_PP(z_timezone) TSRMLS_CC)) {",
          "3718:     return SUCCESS;",
          "3719:    }",
          "",
          "[Removed Lines]",
          "3716:   if (zend_hash_find(myht, \"timezone\", 9, (void**) &z_timezone) == SUCCESS) {",
          "",
          "[Added Lines]",
          "3716:   if (zend_hash_find(myht, \"timezone\", 9, (void**) &z_timezone) == SUCCESS && Z_TYPE_PP(z_timezone) == IS_STRING) {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "29a4e710de6a73341da3d268343fdfc072ba682a",
      "candidate_info": {
        "commit_hash": "29a4e710de6a73341da3d268343fdfc072ba682a",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/29a4e710de6a73341da3d268343fdfc072ba682a",
        "files": [
          "NEWS",
          "ext/date/php_date.c",
          "ext/date/tests/bug68942.phpt",
          "ext/date/tests/bug68942_2.phpt"
        ],
        "message": "Fix bug #68942 (Use after free vulnerability in unserialize() with DateTimeZone)",
        "before_after_code_files": [
          "ext/date/php_date.c||ext/date/php_date.c",
          "ext/date/tests/bug68942.phpt||ext/date/tests/bug68942.phpt",
          "ext/date/tests/bug68942_2.phpt||ext/date/tests/bug68942_2.phpt"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_issue": 1,
        "olp_code_files": {
          "patch": [
            "ext/date/php_date.c||ext/date/php_date.c",
            "ext/date/tests/bug68942_2.phpt||ext/date/tests/bug68942_2.phpt"
          ],
          "candidate": [
            "ext/date/php_date.c||ext/date/php_date.c",
            "ext/date/tests/bug68942_2.phpt||ext/date/tests/bug68942_2.phpt"
          ]
        }
      },
      "candidate_diff": {
        "ext/date/php_date.c||ext/date/php_date.c": [
          "File: ext/date/php_date.c -> ext/date/php_date.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2779:  timelib_tzinfo   *tzi;",
          "2780:  php_timezone_obj *tzobj;",
          "2789:     switch (Z_LVAL_PP(z_timezone_type)) {",
          "2790:      case TIMELIB_ZONETYPE_OFFSET:",
          "",
          "[Removed Lines]",
          "2782:  if (zend_hash_find(myht, \"date\", 5, (void**) &z_date) == SUCCESS) {",
          "2783:   convert_to_string(*z_date);",
          "2784:   if (zend_hash_find(myht, \"timezone_type\", 14, (void**) &z_timezone_type) == SUCCESS) {",
          "2785:    convert_to_long(*z_timezone_type);",
          "2786:    if (zend_hash_find(myht, \"timezone\", 9, (void**) &z_timezone) == SUCCESS) {",
          "2787:     convert_to_string(*z_timezone);",
          "",
          "[Added Lines]",
          "2782:  if (zend_hash_find(myht, \"date\", 5, (void**) &z_date) == SUCCESS && Z_TYPE_PP(z_date) == IS_STRING) {",
          "2783:   if (zend_hash_find(myht, \"timezone_type\", 14, (void**) &z_timezone_type) == SUCCESS && Z_TYPE_PP(z_timezone_type) == IS_LONG) {",
          "2784:    if (zend_hash_find(myht, \"timezone\", 9, (void**) &z_timezone) == SUCCESS && Z_TYPE_PP(z_timezone) == IS_STRING) {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2800:      case TIMELIB_ZONETYPE_ID: {",
          "2801:       int ret;",
          "2804:       tzi = php_date_parse_tzfile(Z_STRVAL_PP(z_timezone), DATE_TIMEZONEDB TSRMLS_CC);",
          "",
          "[Removed Lines]",
          "2802:       convert_to_string(*z_timezone);",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "3716:  zval            **z_timezone = NULL;",
          "3717:  zval            **z_timezone_type = NULL;",
          "3720:   if (zend_hash_find(myht, \"timezone\", 9, (void**) &z_timezone) == SUCCESS) {",
          "3722:    if (SUCCESS == timezone_initialize(*tzobj, Z_STRVAL_PP(z_timezone) TSRMLS_CC)) {",
          "3723:     return SUCCESS;",
          "3724:    }",
          "",
          "[Removed Lines]",
          "3719:  if (zend_hash_find(myht, \"timezone_type\", 14, (void**) &z_timezone_type) == SUCCESS) {",
          "3721:    convert_to_long(*z_timezone_type);",
          "",
          "[Added Lines]",
          "3715:  if (zend_hash_find(myht, \"timezone_type\", 14, (void**) &z_timezone_type) == SUCCESS && Z_TYPE_PP(z_timezone_type) == IS_LONG) {",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "3744:  php_date_instantiate(date_ce_timezone, return_value TSRMLS_CC);",
          "3745:  tzobj = (php_timezone_obj *) zend_object_store_get_object(return_value TSRMLS_CC);",
          "3747: }",
          "",
          "[Removed Lines]",
          "3746:  php_date_timezone_initialize_from_hash(&return_value, &tzobj, myht TSRMLS_CC);",
          "",
          "[Added Lines]",
          "3741:  if(php_date_timezone_initialize_from_hash(&return_value, &tzobj, myht TSRMLS_CC) != SUCCESS) {",
          "3742:   php_error_docref(NULL, E_ERROR, \"Timezone initialization failed\");",
          "3743:  }",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "3760:  myht = Z_OBJPROP_P(object);",
          "3763: }",
          "",
          "[Removed Lines]",
          "3762:  php_date_timezone_initialize_from_hash(&return_value, &tzobj, myht TSRMLS_CC);",
          "",
          "[Added Lines]",
          "3759:  if(php_date_timezone_initialize_from_hash(&return_value, &tzobj, myht TSRMLS_CC) != SUCCESS) {",
          "3760:   php_error_docref(NULL, E_ERROR, \"Timezone initialization failed\");",
          "3761:  }",
          "",
          "---------------"
        ],
        "ext/date/tests/bug68942.phpt||ext/date/tests/bug68942.phpt": [
          "File: ext/date/tests/bug68942.phpt -> ext/date/tests/bug68942.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #68942 (Use after free vulnerability in unserialize() with DateTimeZone).",
          "3: --FILE--",
          "4: <?php",
          "5: $data = unserialize('a:2:{i:0;O:12:\"DateTimeZone\":2:{s:13:\"timezone_type\";a:2:{i:0;i:1;i:1;i:2;}s:8:\"timezone\";s:1:\"A\";}i:1;R:4;}');",
          "6: var_dump($data);",
          "7: ?>",
          "8: --EXPECTF--",
          "9: Fatal error: DateTimeZone::__wakeup(): Timezone initialization failed in %s/bug68942.php on line %d",
          "",
          "---------------"
        ],
        "ext/date/tests/bug68942_2.phpt||ext/date/tests/bug68942_2.phpt": [
          "File: ext/date/tests/bug68942_2.phpt -> ext/date/tests/bug68942_2.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #68942 (Use after free vulnerability in unserialize() with DateTime).",
          "3: --FILE--",
          "4: <?php",
          "5: $data = unserialize('a:2:{i:0;O:8:\"DateTime\":3:{s:4:\"date\";s:26:\"2000-01-01 00:00:00.000000\";s:13:\"timezone_type\";a:2:{i:0;i:1;i:1;i:2;}s:8:\"timezone\";s:1:\"A\";}i:1;R:5;}');",
          "6: var_dump($data);",
          "7: ?>",
          "8: --EXPECTF--",
          "9: Fatal error: Invalid serialization data for DateTime object in %s/bug68942_2.php on line %d",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "8c88b6e81c4565b0102a9022d647817845f0c18d",
      "candidate_info": {
        "commit_hash": "8c88b6e81c4565b0102a9022d647817845f0c18d",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/8c88b6e81c4565b0102a9022d647817845f0c18d",
        "files": [
          "NEWS",
          "ext/date/php_date.c",
          "ext/date/tests/bug66721.phpt"
        ],
        "message": "Fix bug #66721\n\nAdd NULL check to php_date_parse_tzfile's retval",
        "before_after_code_files": [
          "ext/date/php_date.c||ext/date/php_date.c",
          "ext/date/tests/bug66721.phpt||ext/date/tests/bug66721.phpt"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/date/php_date.c||ext/date/php_date.c"
          ],
          "candidate": [
            "ext/date/php_date.c||ext/date/php_date.c"
          ]
        }
      },
      "candidate_diff": {
        "ext/date/php_date.c||ext/date/php_date.c": [
          "File: ext/date/php_date.c -> ext/date/php_date.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2588:       tzi = php_date_parse_tzfile(Z_STRVAL_PP(z_timezone), DATE_TIMEZONEDB TSRMLS_CC);",
          "2590:       ALLOC_INIT_ZVAL(tmp_obj);",
          "2591:       tzobj = zend_object_store_get_object(php_date_instantiate(date_ce_timezone, tmp_obj TSRMLS_CC) TSRMLS_CC);",
          "2592:       tzobj->type = TIMELIB_ZONETYPE_ID;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2590:       if (tzi == NULL) {",
          "2591:        return 0;",
          "2592:       }",
          "",
          "---------------"
        ],
        "ext/date/tests/bug66721.phpt||ext/date/tests/bug66721.phpt": [
          "File: ext/date/tests/bug66721.phpt -> ext/date/tests/bug66721.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Test for bug #66721: __wakeup of DateTime segfaults when invalid object data is supplied",
          "3: --CREDITS--",
          "4: Boro Sitnikovski <buritomath@yahoo.com>",
          "5: --FILE--",
          "6: <?php",
          "7: $y = 'O:8:\"DateTime\":3:{s:4:\"date\";s:19:\"2014-02-15 02:00:51\";s:13:\"timezone_type\";i:3;s:8:\"timezone\";s:10:\"1234567890\";}';",
          "8: var_dump(unserialize($y));",
          "9: ?>",
          "10: --EXPECTF--",
          "11: Fatal error: Invalid serialization data for DateTime object in %s on line %d",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "51cd5a1d09ce3dd3027eace601661a2bc5745851",
      "candidate_info": {
        "commit_hash": "51cd5a1d09ce3dd3027eace601661a2bc5745851",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/51cd5a1d09ce3dd3027eace601661a2bc5745851",
        "files": [
          "ext/date/php_date.c",
          "ext/date/tests/bug68942_2.phpt"
        ],
        "message": "Fix bug #68942 (Use after free vulnerability in unserialize() with DateTimeZone)\n\nConflicts:\n\text/date/php_date.c",
        "before_after_code_files": [
          "ext/date/php_date.c||ext/date/php_date.c",
          "ext/date/tests/bug68942_2.phpt||ext/date/tests/bug68942_2.phpt"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "ext/date/php_date.c||ext/date/php_date.c",
            "ext/date/tests/bug68942_2.phpt||ext/date/tests/bug68942_2.phpt"
          ],
          "candidate": [
            "ext/date/php_date.c||ext/date/php_date.c",
            "ext/date/tests/bug68942_2.phpt||ext/date/tests/bug68942_2.phpt"
          ]
        }
      },
      "candidate_diff": {
        "ext/date/php_date.c||ext/date/php_date.c": [
          "File: ext/date/php_date.c -> ext/date/php_date.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2779:  timelib_tzinfo   *tzi;",
          "2780:  php_timezone_obj *tzobj;",
          "2789:     switch (Z_LVAL_PP(z_timezone_type)) {",
          "2790:      case TIMELIB_ZONETYPE_OFFSET:",
          "",
          "[Removed Lines]",
          "2782:  if (zend_hash_find(myht, \"date\", 5, (void**) &z_date) == SUCCESS) {",
          "2783:   convert_to_string(*z_date);",
          "2784:   if (zend_hash_find(myht, \"timezone_type\", 14, (void**) &z_timezone_type) == SUCCESS) {",
          "2785:    convert_to_long(*z_timezone_type);",
          "2786:    if (zend_hash_find(myht, \"timezone\", 9, (void**) &z_timezone) == SUCCESS) {",
          "2787:     convert_to_string(*z_timezone);",
          "",
          "[Added Lines]",
          "2782:  if (zend_hash_find(myht, \"date\", 5, (void**) &z_date) == SUCCESS && Z_TYPE_PP(z_date) == IS_STRING) {",
          "2783:   if (zend_hash_find(myht, \"timezone_type\", 14, (void**) &z_timezone_type) == SUCCESS && Z_TYPE_PP(z_timezone_type) == IS_LONG) {",
          "2784:    if (zend_hash_find(myht, \"timezone\", 9, (void**) &z_timezone) == SUCCESS && Z_TYPE_PP(z_timezone) == IS_STRING) {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2800:      case TIMELIB_ZONETYPE_ID: {",
          "2801:       int ret;",
          "2804:       tzi = php_date_parse_tzfile(Z_STRVAL_PP(z_timezone), DATE_TIMEZONEDB TSRMLS_CC);",
          "",
          "[Removed Lines]",
          "2802:       convert_to_string(*z_timezone);",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "ext/date/tests/bug68942_2.phpt||ext/date/tests/bug68942_2.phpt": [
          "File: ext/date/tests/bug68942_2.phpt -> ext/date/tests/bug68942_2.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #68942 (Use after free vulnerability in unserialize() with DateTime).",
          "3: --FILE--",
          "4: <?php",
          "5: $data = unserialize('a:2:{i:0;O:8:\"DateTime\":3:{s:4:\"date\";s:26:\"2000-01-01 00:00:00.000000\";s:13:\"timezone_type\";a:2:{i:0;i:1;i:1;i:2;}s:8:\"timezone\";s:1:\"A\";}i:1;R:5;}');",
          "6: var_dump($data);",
          "7: ?>",
          "8: --EXPECTF--",
          "9: Fatal error: Invalid serialization data for DateTime object in %s/bug68942_2.php on line %d",
          "",
          "---------------"
        ]
      }
    }
  ]
}