{
  "cve_id": "CVE-2016-10161",
  "cve_desc": "The object_common1 function in ext/standard/var_unserializer.c in PHP before 5.6.30, 7.0.x before 7.0.15, and 7.1.x before 7.1.1 allows remote attackers to cause a denial of service (buffer over-read and application crash) via crafted serialized data that is mishandled in a finish_nested_data call.",
  "repo": "php/php-src",
  "patch_hash": "16b3003ffc6393e250f069aa28a78dc5a2c064b2",
  "patch_info": {
    "commit_hash": "16b3003ffc6393e250f069aa28a78dc5a2c064b2",
    "repo": "php/php-src",
    "commit_url": "https://github.com/php/php-src/commit/16b3003ffc6393e250f069aa28a78dc5a2c064b2",
    "files": [
      "ext/standard/tests/serialize/bug73825.phpt",
      "ext/standard/var_unserializer.c",
      "ext/standard/var_unserializer.re"
    ],
    "message": "Fix bug #73825 - Heap out of bounds read on unserialize in finish_nested_data()",
    "before_after_code_files": [
      "ext/standard/tests/serialize/bug73825.phpt||ext/standard/tests/serialize/bug73825.phpt",
      "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
      "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
    ]
  },
  "patch_diff": {
    "ext/standard/tests/serialize/bug73825.phpt||ext/standard/tests/serialize/bug73825.phpt": [
      "File: ext/standard/tests/serialize/bug73825.phpt -> ext/standard/tests/serialize/bug73825.phpt",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: --TEST--",
      "2: Bug #73825 Heap out of bounds read on unserialize in finish_nested_data()",
      "3: --FILE--",
      "4: <?php",
      "5: $obj = unserialize('O:8:\"00000000\":');",
      "6: var_dump($obj);",
      "7: ?>",
      "8: --EXPECTF--",
      "9: Warning: Bad unserialize data in %sbug73825.php on line %d",
      "11: Notice: unserialize(): Error at offset 13 of 15 bytes in %sbug73825.php on line %d",
      "12: bool(false)",
      "",
      "---------------"
    ],
    "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
      "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "405: {",
      "406:  long elements;",
      "408:  elements = parse_iv2((*p) + 2, p);",
      "410:  (*p) += 2;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "408:  if( *p >= max - 2) {",
      "409:   zend_error(E_WARNING, \"Bad unserialize data\");",
      "410:   return -1;",
      "411:  }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "417:   zend_error(E_WARNING, \"Erroneous data format for unserializing '%s'\", ce->name);",
      "419:  }",
      "421:  return elements;",
      "",
      "[Removed Lines]",
      "418:   return 0;",
      "",
      "[Added Lines]",
      "423:   return -1;",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "496: {",
      "497:  YYCTYPE yych;",
      "498:  static const unsigned char yybm[] = {",
      "",
      "[Removed Lines]",
      "495: #line 496 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "500: #line 501 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "552:  yych = *(YYMARKER = ++YYCURSOR);",
      "553:  if (yych == ':') goto yy95;",
      "554: yy3:",
      "556:  { return 0; }",
      "558: yy4:",
      "559:  yych = *(YYMARKER = ++YYCURSOR);",
      "560:  if (yych == ':') goto yy89;",
      "",
      "[Removed Lines]",
      "555: #line 861 \"ext/standard/var_unserializer.re\"",
      "557: #line 558 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "560: #line 875 \"ext/standard/var_unserializer.re\"",
      "562: #line 563 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "597:  goto yy3;",
      "598: yy14:",
      "599:  ++YYCURSOR;",
      "601:  {",
      "603:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
      "605: }",
      "607: yy16:",
      "608:  yych = *++YYCURSOR;",
      "609:  goto yy3;",
      "",
      "[Removed Lines]",
      "600: #line 855 \"ext/standard/var_unserializer.re\"",
      "606: #line 607 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "605: #line 869 \"ext/standard/var_unserializer.re\"",
      "611: #line 612 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "634:  yych = *++YYCURSOR;",
      "635:  if (yych != '\"') goto yy18;",
      "636:  ++YYCURSOR;",
      "638:  {",
      "639:  size_t len, len2, len3, maxlen;",
      "640:  long elements;",
      "",
      "[Removed Lines]",
      "637: #line 708 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "642: #line 717 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "775:  elements = object_common1(UNSERIALIZE_PASSTHRU, ce);",
      "777:  if (incomplete_class) {",
      "778:   php_store_class_name(*rval, class_name, len2);",
      "779:  }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "782:  if (elements < 0) {",
      "783:     efree(class_name);",
      "784:     return 0;",
      "785:  }",
      "",
      "---------------",
      "--- Hunk 8 ---",
      "[Context before]",
      "782:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
      "783: }",
      "785: yy25:",
      "786:  yych = *++YYCURSOR;",
      "787:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "784: #line 785 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "794: #line 795 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 9 ---",
      "[Context before]",
      "806:  yych = *++YYCURSOR;",
      "807:  if (yych != '\"') goto yy18;",
      "808:  ++YYCURSOR;",
      "810:  {",
      "811:     if (!var_hash) return 0;",
      "813:  INIT_PZVAL(*rval);",
      "817: }",
      "819: yy32:",
      "820:  yych = *++YYCURSOR;",
      "821:  if (yych == '+') goto yy33;",
      "",
      "[Removed Lines]",
      "809: #line 699 \"ext/standard/var_unserializer.re\"",
      "815:  return object_common2(UNSERIALIZE_PASSTHRU,",
      "816:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
      "818: #line 819 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "819: #line 704 \"ext/standard/var_unserializer.re\"",
      "821:  long elements;",
      "826:  elements = object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR);",
      "827:  if (elements < 0) {",
      "828:   return 0;",
      "829:  }",
      "830:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
      "832: #line 833 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 10 ---",
      "[Context before]",
      "836:  yych = *++YYCURSOR;",
      "837:  if (yych != '{') goto yy18;",
      "838:  ++YYCURSOR;",
      "840:  {",
      "841:  long elements = parse_iv(start + 2);",
      "",
      "[Removed Lines]",
      "839: #line 678 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "853: #line 683 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 11 ---",
      "[Context before]",
      "858:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
      "859: }",
      "861: yy39:",
      "862:  yych = *++YYCURSOR;",
      "863:  if (yych == '+') goto yy40;",
      "",
      "[Removed Lines]",
      "860: #line 861 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "874: #line 875 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 12 ---",
      "[Context before]",
      "878:  yych = *++YYCURSOR;",
      "879:  if (yych != '\"') goto yy18;",
      "880:  ++YYCURSOR;",
      "882:  {",
      "883:  size_t len, maxlen;",
      "884:  char *str;",
      "",
      "[Removed Lines]",
      "881: #line 643 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "895: #line 648 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 13 ---",
      "[Context before]",
      "913:  ZVAL_STRINGL(*rval, str, len, 0);",
      "914:  return 1;",
      "915: }",
      "917: yy46:",
      "918:  yych = *++YYCURSOR;",
      "919:  if (yych == '+') goto yy47;",
      "",
      "[Removed Lines]",
      "916: #line 917 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "930: #line 931 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 14 ---",
      "[Context before]",
      "934:  yych = *++YYCURSOR;",
      "935:  if (yych != '\"') goto yy18;",
      "936:  ++YYCURSOR;",
      "938:  {",
      "939:  size_t len, maxlen;",
      "940:  char *str;",
      "",
      "[Removed Lines]",
      "937: #line 610 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "951: #line 615 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 15 ---",
      "[Context before]",
      "967:  ZVAL_STRINGL(*rval, str, len, 1);",
      "968:  return 1;",
      "969: }",
      "971: yy53:",
      "972:  yych = *++YYCURSOR;",
      "973:  if (yych <= '/') {",
      "",
      "[Removed Lines]",
      "970: #line 971 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "984: #line 985 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 16 ---",
      "[Context before]",
      "1055:  }",
      "1056: yy63:",
      "1057:  ++YYCURSOR;",
      "1059:  {",
      "1060: #if SIZEOF_LONG == 4",
      "1061: use_double:",
      "",
      "[Removed Lines]",
      "1058: #line 600 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1072: #line 605 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 17 ---",
      "[Context before]",
      "1065:  ZVAL_DOUBLE(*rval, zend_strtod((const char *)start + 2, NULL));",
      "1066:  return 1;",
      "1067: }",
      "1069: yy65:",
      "1070:  yych = *++YYCURSOR;",
      "1071:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1068: #line 1069 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1082: #line 1083 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 18 ---",
      "[Context before]",
      "1124:  yych = *++YYCURSOR;",
      "1125:  if (yych != ';') goto yy18;",
      "1126:  ++YYCURSOR;",
      "1128:  {",
      "1130:  INIT_PZVAL(*rval);",
      "",
      "[Removed Lines]",
      "1127: #line 585 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1141: #line 590 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 19 ---",
      "[Context before]",
      "1140:  return 1;",
      "1141: }",
      "1143: yy76:",
      "1144:  yych = *++YYCURSOR;",
      "1145:  if (yych == 'N') goto yy73;",
      "",
      "[Removed Lines]",
      "1142: #line 1143 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1156: #line 1157 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 20 ---",
      "[Context before]",
      "1166:  if (yych <= '9') goto yy79;",
      "1167:  if (yych != ';') goto yy18;",
      "1168:  ++YYCURSOR;",
      "1170:  {",
      "1171: #if SIZEOF_LONG == 4",
      "1172:  int digits = YYCURSOR - start - 3;",
      "",
      "[Removed Lines]",
      "1169: #line 558 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1183: #line 563 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 21 ---",
      "[Context before]",
      "1193:  ZVAL_LONG(*rval, parse_iv(start + 2));",
      "1194:  return 1;",
      "1195: }",
      "1197: yy83:",
      "1198:  yych = *++YYCURSOR;",
      "1199:  if (yych <= '/') goto yy18;",
      "",
      "[Removed Lines]",
      "1196: #line 1197 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1210: #line 1211 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 22 ---",
      "[Context before]",
      "1201:  yych = *++YYCURSOR;",
      "1202:  if (yych != ';') goto yy18;",
      "1203:  ++YYCURSOR;",
      "1205:  {",
      "1207:  INIT_PZVAL(*rval);",
      "1208:  ZVAL_BOOL(*rval, parse_iv(start + 2));",
      "1209:  return 1;",
      "1210: }",
      "1212: yy87:",
      "1213:  ++YYCURSOR;",
      "1215:  {",
      "1217:  INIT_PZVAL(*rval);",
      "1218:  ZVAL_NULL(*rval);",
      "1219:  return 1;",
      "1220: }",
      "1222: yy89:",
      "1223:  yych = *++YYCURSOR;",
      "1224:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1204: #line 551 \"ext/standard/var_unserializer.re\"",
      "1211: #line 1212 \"ext/standard/var_unserializer.c\"",
      "1214: #line 544 \"ext/standard/var_unserializer.re\"",
      "1221: #line 1222 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1218: #line 556 \"ext/standard/var_unserializer.re\"",
      "1225: #line 1226 \"ext/standard/var_unserializer.c\"",
      "1228: #line 549 \"ext/standard/var_unserializer.re\"",
      "1235: #line 1236 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 23 ---",
      "[Context before]",
      "1241:  if (yych <= '9') goto yy91;",
      "1242:  if (yych != ';') goto yy18;",
      "1243:  ++YYCURSOR;",
      "1245:  {",
      "1246:  long id;",
      "",
      "[Removed Lines]",
      "1244: #line 521 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1258: #line 526 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 24 ---",
      "[Context before]",
      "1265:  return 1;",
      "1266: }",
      "1268: yy95:",
      "1269:  yych = *++YYCURSOR;",
      "1270:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1267: #line 1268 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1281: #line 1282 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 25 ---",
      "[Context before]",
      "1287:  if (yych <= '9') goto yy97;",
      "1288:  if (yych != ';') goto yy18;",
      "1289:  ++YYCURSOR;",
      "1291:  {",
      "1292:  long id;",
      "",
      "[Removed Lines]",
      "1290: #line 500 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1304: #line 505 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 26 ---",
      "[Context before]",
      "1309:  return 1;",
      "1310: }",
      "1312: }",
      "1316:  return 0;",
      "",
      "[Removed Lines]",
      "1311: #line 1312 \"ext/standard/var_unserializer.c\"",
      "1313: #line 863 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1325: #line 1326 \"ext/standard/var_unserializer.c\"",
      "1327: #line 877 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------"
    ],
    "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
      "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
      "--- Hunk 1 ---",
      "[Context before]",
      "409: {",
      "410:  long elements;",
      "412:  elements = parse_iv2((*p) + 2, p);",
      "414:  (*p) += 2;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "412:  if( *p >= max - 2) {",
      "413:   zend_error(E_WARNING, \"Bad unserialize data\");",
      "414:   return -1;",
      "415:  }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "421:   zend_error(E_WARNING, \"Erroneous data format for unserializing '%s'\", ce->name);",
      "423:  }",
      "425:  return elements;",
      "",
      "[Removed Lines]",
      "422:   return 0;",
      "",
      "[Added Lines]",
      "427:   return -1;",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "697: }",
      "699: \"o:\" iv \":\" [\"] {",
      "700:     if (!var_hash) return 0;",
      "702:  INIT_PZVAL(*rval);",
      "706: }",
      "708: object \":\" uiv \":\" [\"] {",
      "",
      "[Removed Lines]",
      "704:  return object_common2(UNSERIALIZE_PASSTHRU,",
      "705:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
      "",
      "[Added Lines]",
      "705:  long elements;",
      "710:  elements = object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR);",
      "711:  if (elements < 0) {",
      "712:   return 0;",
      "713:  }",
      "714:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "845:  elements = object_common1(UNSERIALIZE_PASSTHRU, ce);",
      "847:  if (incomplete_class) {",
      "848:   php_store_class_name(*rval, class_name, len2);",
      "849:  }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "856:  if (elements < 0) {",
      "857:     efree(class_name);",
      "858:     return 0;",
      "859:  }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "b99ff1439d98eaa7bad55fea157ccfe640945ff5",
      "candidate_info": {
        "commit_hash": "b99ff1439d98eaa7bad55fea157ccfe640945ff5",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/b99ff1439d98eaa7bad55fea157ccfe640945ff5",
        "files": [
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "fix datatype\n\n(cherry picked from commit a29264eb8c933f8569e62f1d6d6eba524e76ef70)",
        "before_after_code_files": [
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1365:  ++YYCURSOR;",
          "1366: #line 794 \"ext/standard/var_unserializer.re\"",
          "1367:  {",
          "1369:     if (!var_hash) return 0;",
          "1371:  elements = object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR);",
          "",
          "[Removed Lines]",
          "1368:  long elements;",
          "",
          "[Added Lines]",
          "1368:  zend_long elements;",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "792: }",
          "794: \"o:\" iv \":\" [\"] {",
          "796:     if (!var_hash) return 0;",
          "798:  elements = object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR);",
          "",
          "[Removed Lines]",
          "795:  long elements;",
          "",
          "[Added Lines]",
          "795:  zend_long elements;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "878b8f046593085365466f20c756a2d429164707",
      "candidate_info": {
        "commit_hash": "878b8f046593085365466f20c756a2d429164707",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/878b8f046593085365466f20c756a2d429164707",
        "files": [
          "NEWS",
          "ext/standard/tests/serialize/bug70213.phpt",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Merge branch 'PHP-7.0' into PHP-7.1",
        "before_after_code_files": [
          "ext/standard/tests/serialize/bug70213.phpt||ext/standard/tests/serialize/bug70213.phpt",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/tests/serialize/bug70213.phpt||ext/standard/tests/serialize/bug70213.phpt": [
          "File: ext/standard/tests/serialize/bug70213.phpt -> ext/standard/tests/serialize/bug70213.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #70213: Unserialize context shared on double class lookup",
          "3: --FILE--",
          "4: <?php",
          "6: ini_set('unserialize_callback_func', 'evil');",
          "8: function evil() {",
          "9:  function __autoload($arg) {",
          "10:         var_dump(unserialize('R:1;'));",
          "11:     }",
          "12: }",
          "14: var_dump(unserialize('a:2:{i:0;i:42;i:1;O:4:\"evil\":0:{}}'));",
          "16: ?>",
          "17: --EXPECTF--",
          "18: Notice: unserialize(): Error at offset 4 of 4 bytes in %s on line %d",
          "19: bool(false)",
          "21: Warning: unserialize(): Function evil() hasn't defined the class it was called for in %s on line %d",
          "22: array(2) {",
          "23:   [0]=>",
          "24:   int(42)",
          "25:   [1]=>",
          "26:   object(__PHP_Incomplete_Class)#1 (1) {",
          "27:     [\"__PHP_Incomplete_Class_Name\"]=>",
          "28:     string(4) \"evil\"",
          "29:   }",
          "30: }",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "647: yy2:",
          "648:  ++YYCURSOR;",
          "649: yy3:",
          "651:  { return 0; }",
          "652: #line 653 \"ext/standard/var_unserializer.c\"",
          "653: yy4:",
          "",
          "[Removed Lines]",
          "650: #line 959 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "650: #line 961 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "696:  goto yy3;",
          "697: yy15:",
          "698:  ++YYCURSOR;",
          "700:  {",
          "702:  php_error_docref(NULL, E_NOTICE, \"Unexpected end of serialized data\");",
          "",
          "[Removed Lines]",
          "699: #line 953 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "699: #line 955 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1240:   }",
          "1243:   if ((ce = zend_lookup_class(class_name)) == NULL) {",
          "1244:    php_error_docref(NULL, E_WARNING, \"Function %s() hasn't defined the class it was called for\", Z_STRVAL(user_func));",
          "1245:    incomplete_class = 1;",
          "1246:    ce = PHP_IC_ENTRY;",
          "1247:   }",
          "1249:   zval_ptr_dtor(&user_func);",
          "1250:   zval_ptr_dtor(&args[0]);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1243:   BG(serialize_lock)++;",
          "1249:   BG(serialize_lock)--;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1275:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "1276: }",
          "1278: yy84:",
          "1279:  ++YYCURSOR;",
          "1280: #line 743 \"ext/standard/var_unserializer.re\"",
          "",
          "[Removed Lines]",
          "1277: #line 1278 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1279: #line 1280 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1311:  ZVAL_STR(rval, str);",
          "1312:  return 1;",
          "1313: }",
          "1315: yy86:",
          "1316:  ++YYCURSOR;",
          "1317: #line 777 \"ext/standard/var_unserializer.re\"",
          "",
          "[Removed Lines]",
          "1314: #line 1315 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1316: #line 1317 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "1339:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "1340: }",
          "1342: yy88:",
          "1343:  yych = *++YYCURSOR;",
          "1344:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1341: #line 1342 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1343: #line 1344 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "1370:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "1371:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "1372: }",
          "1374: yy94:",
          "1375:  ++YYCURSOR;",
          "1376: #line 711 \"ext/standard/var_unserializer.re\"",
          "",
          "[Removed Lines]",
          "1373: #line 1374 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1375: #line 1376 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "1405:  ZVAL_STRINGL(rval, str, len);",
          "1406:  return 1;",
          "1407: }",
          "1409: yy96:",
          "1410:  yych = *++YYCURSOR;",
          "1411:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1408: #line 1409 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1410: #line 1411 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "1430:  return 1;",
          "1431: }",
          "1433: }",
          "1437:  return 0;",
          "",
          "[Removed Lines]",
          "1432: #line 1433 \"ext/standard/var_unserializer.c\"",
          "1434: #line 961 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1434: #line 1435 \"ext/standard/var_unserializer.c\"",
          "1436: #line 963 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "915:   }",
          "918:   if ((ce = zend_lookup_class(class_name)) == NULL) {",
          "919:    php_error_docref(NULL, E_WARNING, \"Function %s() hasn't defined the class it was called for\", Z_STRVAL(user_func));",
          "920:    incomplete_class = 1;",
          "921:    ce = PHP_IC_ENTRY;",
          "922:   }",
          "924:   zval_ptr_dtor(&user_func);",
          "925:   zval_ptr_dtor(&args[0]);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "918:   BG(serialize_lock)++;",
          "924:   BG(serialize_lock)--;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "a0203ea14318c0009efcf99d9735ada783a02d14",
      "candidate_info": {
        "commit_hash": "a0203ea14318c0009efcf99d9735ada783a02d14",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/a0203ea14318c0009efcf99d9735ada783a02d14",
        "files": [
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "fix datatype",
        "before_after_code_files": [
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1349:  ++YYCURSOR;",
          "1350: #line 842 \"ext/standard/var_unserializer.re\"",
          "1351:  {",
          "1353:     if (!var_hash) return 0;",
          "1355:  elements = object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR);",
          "",
          "[Removed Lines]",
          "1352:  long elements;",
          "",
          "[Added Lines]",
          "1352:  zend_long elements;",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "840: }",
          "842: \"o:\" uiv \":\" [\"] {",
          "844:     if (!var_hash) return 0;",
          "846:  elements = object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR);",
          "",
          "[Removed Lines]",
          "843:  long elements;",
          "",
          "[Added Lines]",
          "843:  zend_long elements;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "bcd64a9bdd8afcf7f91a12e700d12d12eedc136b",
      "candidate_info": {
        "commit_hash": "bcd64a9bdd8afcf7f91a12e700d12d12eedc136b",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/bcd64a9bdd8afcf7f91a12e700d12d12eedc136b",
        "files": [
          "ext/spl/spl_array.c",
          "ext/standard/tests/serialize/bug71311.phpt",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Fixed bug #71311: Use-after-free vulnerability in SPL(ArrayObject, unserialize)",
        "before_after_code_files": [
          "ext/spl/spl_array.c||ext/spl/spl_array.c",
          "ext/standard/tests/serialize/bug71311.phpt||ext/standard/tests/serialize/bug71311.phpt",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/spl/spl_array.c||ext/spl/spl_array.c": [
          "File: ext/spl/spl_array.c -> ext/spl/spl_array.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1778:   intern->ar_flags &= ~SPL_ARRAY_CLONE_MASK;",
          "1779:   intern->ar_flags |= flags & SPL_ARRAY_CLONE_MASK;",
          "1780:   zval_ptr_dtor(&intern->array);",
          "1781:   if (!php_var_unserialize(&intern->array, &p, s + buf_len, &var_hash)) {",
          "1782:    goto outexcept;",
          "1783:   }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1781:   ZVAL_UNDEF(&intern->array);",
          "",
          "---------------"
        ],
        "ext/standard/tests/serialize/bug71311.phpt||ext/standard/tests/serialize/bug71311.phpt": [
          "File: ext/standard/tests/serialize/bug71311.phpt -> ext/standard/tests/serialize/bug71311.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #71311 Use-after-free vulnerability in SPL(ArrayObject, unserialize)",
          "3: --FILE--",
          "4: <?php",
          "5: $data = unserialize(\"C:11:\\\"ArrayObject\\\":11:{x:i:0;r:3;XX\");",
          "6: var_dump($data);",
          "7: ?>",
          "8: --EXPECTF--",
          "9: Fatal error: Uncaught UnexpectedValueException: Error at offset 10 of 11 bytes in %s/bug71311.php:2",
          "10: Stack trace:",
          "11: #0 [internal function]: ArrayObject->unserialize('x:i:0;r:3;X')",
          "12: #1 %s/bug71311.php(2): unserialize('%s')",
          "13: #2 {main}",
          "14:   thrown in %s/bug71311.php on line 2",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "574:  yych = *(YYMARKER = ++YYCURSOR);",
          "575:  if (yych == ':') goto yy95;",
          "576: yy3:",
          "578:  { return 0; }",
          "579: #line 580 \"ext/standard/var_unserializer.c\"",
          "580: yy4:",
          "",
          "[Removed Lines]",
          "577: #line 869 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "577: #line 873 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "619:  goto yy3;",
          "620: yy14:",
          "621:  ++YYCURSOR;",
          "623:  {",
          "625:  php_error_docref(NULL, E_NOTICE, \"Unexpected end of serialized data\");",
          "",
          "[Removed Lines]",
          "622: #line 863 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "622: #line 867 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "651:  if (yybm[0+yych] & 128) {",
          "652:   goto yy20;",
          "653:  }",
          "655:  yych = *++YYCURSOR;",
          "656:  if (yych != '\"') goto yy18;",
          "657:  ++YYCURSOR;",
          "659:  {",
          "660:  size_t len, len2, len3, maxlen;",
          "661:  zend_long elements;",
          "",
          "[Removed Lines]",
          "654:  if (yych != ':') goto yy18;",
          "658: #line 718 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "654:  if (yych <= '/') goto yy18;",
          "655:  if (yych >= ';') goto yy18;",
          "659: #line 722 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "801:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "802: }",
          "804: yy25:",
          "805:  yych = *++YYCURSOR;",
          "806:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "803: #line 804 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "804: #line 805 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "825:  yych = *++YYCURSOR;",
          "826:  if (yych != '\"') goto yy18;",
          "827:  ++YYCURSOR;",
          "829:  {",
          "830:     if (!var_hash) return 0;",
          "832:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "833:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "834: }",
          "836: yy32:",
          "837:  yych = *++YYCURSOR;",
          "838:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "828: #line 711 \"ext/standard/var_unserializer.re\"",
          "835: #line 836 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "829: #line 715 \"ext/standard/var_unserializer.re\"",
          "836: #line 837 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "853:  yych = *++YYCURSOR;",
          "854:  if (yych != '{') goto yy18;",
          "855:  ++YYCURSOR;",
          "857:  {",
          "858:  zend_long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "856: #line 687 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "857: #line 691 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "878:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "879: }",
          "881: yy39:",
          "882:  yych = *++YYCURSOR;",
          "883:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "880: #line 881 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "881: #line 882 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "898:  yych = *++YYCURSOR;",
          "899:  if (yych != '\"') goto yy18;",
          "900:  ++YYCURSOR;",
          "902:  {",
          "903:  size_t len, maxlen;",
          "904:  zend_string *str;",
          "",
          "[Removed Lines]",
          "901: #line 659 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "902: #line 663 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "926:  ZVAL_STR(rval, str);",
          "927:  return 1;",
          "928: }",
          "930: yy46:",
          "931:  yych = *++YYCURSOR;",
          "932:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "929: #line 930 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "930: #line 931 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "947:  yych = *++YYCURSOR;",
          "948:  if (yych != '\"') goto yy18;",
          "949:  ++YYCURSOR;",
          "951:  {",
          "952:  size_t len, maxlen;",
          "953:  char *str;",
          "",
          "[Removed Lines]",
          "950: #line 632 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "951: #line 636 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "974:  ZVAL_STRINGL(rval, str, len);",
          "975:  return 1;",
          "976: }",
          "978: yy53:",
          "979:  yych = *++YYCURSOR;",
          "980:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "977: #line 978 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "978: #line 979 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "1062:  }",
          "1063: yy63:",
          "1064:  ++YYCURSOR;",
          "1066:  {",
          "1067: #if SIZEOF_ZEND_LONG == 4",
          "1068: use_double:",
          "",
          "[Removed Lines]",
          "1065: #line 623 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1066: #line 627 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "1071:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1072:  return 1;",
          "1073: }",
          "1075: yy65:",
          "1076:  yych = *++YYCURSOR;",
          "1077:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1074: #line 1075 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1075: #line 1076 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "1130:  yych = *++YYCURSOR;",
          "1131:  if (yych != ';') goto yy18;",
          "1132:  ++YYCURSOR;",
          "1134:  {",
          "",
          "[Removed Lines]",
          "1133: #line 607 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1134: #line 611 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1147:  return 1;",
          "1148: }",
          "1150: yy76:",
          "1151:  yych = *++YYCURSOR;",
          "1152:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1149: #line 1150 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1150: #line 1151 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1173:  if (yych <= '9') goto yy79;",
          "1174:  if (yych != ';') goto yy18;",
          "1175:  ++YYCURSOR;",
          "1177:  {",
          "1178: #if SIZEOF_ZEND_LONG == 4",
          "1179:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1176: #line 581 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1177: #line 585 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1199:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1200:  return 1;",
          "1201: }",
          "1203: yy83:",
          "1204:  yych = *++YYCURSOR;",
          "1205:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1202: #line 1203 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1203: #line 1204 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "1207:  yych = *++YYCURSOR;",
          "1208:  if (yych != ';') goto yy18;",
          "1209:  ++YYCURSOR;",
          "1211:  {",
          "1213:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1214:  return 1;",
          "1215: }",
          "1217: yy87:",
          "1218:  ++YYCURSOR;",
          "1220:  {",
          "1222:  ZVAL_NULL(rval);",
          "1223:  return 1;",
          "1224: }",
          "1226: yy89:",
          "1227:  yych = *++YYCURSOR;",
          "1228:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1210: #line 575 \"ext/standard/var_unserializer.re\"",
          "1216: #line 1217 \"ext/standard/var_unserializer.c\"",
          "1219: #line 569 \"ext/standard/var_unserializer.re\"",
          "1225: #line 1226 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1211: #line 579 \"ext/standard/var_unserializer.re\"",
          "1217: #line 1218 \"ext/standard/var_unserializer.c\"",
          "1220: #line 573 \"ext/standard/var_unserializer.re\"",
          "1226: #line 1227 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1257:   return 0;",
          "1258:  }",
          "1260:  if (Z_ISUNDEF_P(rval_ref) || (Z_ISREF_P(rval_ref) && Z_ISUNDEF_P(Z_REFVAL_P(rval_ref)))) {",
          "1261:   ZVAL_UNDEF(rval);",
          "1262:   return 1;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1261:  if (rval_ref == rval) {",
          "1262:   return 0;",
          "1263:  }",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1267:  return 1;",
          "1268: }",
          "1270: yy95:",
          "1271:  yych = *++YYCURSOR;",
          "1272:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1269: #line 1270 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1274: #line 1275 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "1316:  return 1;",
          "1317: }",
          "1319: }",
          "1323:  return 0;",
          "",
          "[Removed Lines]",
          "1318: #line 1319 \"ext/standard/var_unserializer.c\"",
          "1320: #line 871 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1323: #line 1324 \"ext/standard/var_unserializer.c\"",
          "1325: #line 875 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "556:   return 0;",
          "557:  }",
          "559:  if (Z_ISUNDEF_P(rval_ref) || (Z_ISREF_P(rval_ref) && Z_ISUNDEF_P(Z_REFVAL_P(rval_ref)))) {",
          "560:   ZVAL_UNDEF(rval);",
          "561:   return 1;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "559:  if (rval_ref == rval) {",
          "560:   return 0;",
          "561:  }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "747d21cfd2a7414b8d5ace203524f61eab2b8323",
      "candidate_info": {
        "commit_hash": "747d21cfd2a7414b8d5ace203524f61eab2b8323",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/747d21cfd2a7414b8d5ace203524f61eab2b8323",
        "files": [
          "ext/standard/php_var.h",
          "ext/standard/tests/serialize/bug72785.phpt",
          "ext/standard/tests/serialize/unserialize_error_001.phpt",
          "ext/standard/var.c",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Fix bug #72785 - allowed_classes only applies to outermost unserialize()",
        "before_after_code_files": [
          "ext/standard/php_var.h||ext/standard/php_var.h",
          "ext/standard/tests/serialize/bug72785.phpt||ext/standard/tests/serialize/bug72785.phpt",
          "ext/standard/tests/serialize/unserialize_error_001.phpt||ext/standard/tests/serialize/unserialize_error_001.phpt",
          "ext/standard/var.c||ext/standard/var.c",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/php_var.h||ext/standard/php_var.h": [
          "File: ext/standard/php_var.h -> ext/standard/php_var.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "45: PHPAPI int php_var_unserialize(zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash);",
          "46: PHPAPI int php_var_unserialize_ref(zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash);",
          "47: PHPAPI int php_var_unserialize_intern(zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash);",
          "50: PHPAPI php_serialize_data_t php_var_serialize_init(void);",
          "51: PHPAPI void php_var_serialize_destroy(php_serialize_data_t d);",
          "52: PHPAPI php_unserialize_data_t php_var_unserialize_init(void);",
          "53: PHPAPI void php_var_unserialize_destroy(php_unserialize_data_t d);",
          "55: #define PHP_VAR_SERIALIZE_INIT(d) \\",
          "56:  (d) = php_var_serialize_init()",
          "",
          "[Removed Lines]",
          "48: PHPAPI int php_var_unserialize_ex(zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash, HashTable *classes);",
          "",
          "[Added Lines]",
          "53: PHPAPI void php_var_unserialize_set_allowed_classes(php_unserialize_data_t d, HashTable *classes);",
          "",
          "---------------"
        ],
        "ext/standard/tests/serialize/bug72785.phpt||ext/standard/tests/serialize/bug72785.phpt": [
          "File: ext/standard/tests/serialize/bug72785.phpt -> ext/standard/tests/serialize/bug72785.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #72785: allowed_classes only applies to outermost unserialize()",
          "3: --FILE--",
          "4: <?php",
          "7: class A {}",
          "9: $p = 'x:i:0;a:1:{i:0;O:1:\"A\":0:{}};m:a:0:{}';",
          "10: $s = 'C:11:\"ArrayObject\":' . strlen($p) . ':{' . $p . '}';",
          "11: var_dump(unserialize($s, ['allowed_classes' => ['ArrayObject']]));",
          "13: ?>",
          "14: --EXPECT--",
          "15: object(ArrayObject)#1 (1) {",
          "16:   [\"storage\":\"ArrayObject\":private]=>",
          "17:   array(1) {",
          "18:     [0]=>",
          "19:     object(__PHP_Incomplete_Class)#2 (1) {",
          "20:       [\"__PHP_Incomplete_Class_Name\"]=>",
          "21:       string(1) \"A\"",
          "22:     }",
          "23:   }",
          "24: }",
          "",
          "---------------"
        ],
        "ext/standard/tests/serialize/unserialize_error_001.phpt||ext/standard/tests/serialize/unserialize_error_001.phpt": [
          "File: ext/standard/tests/serialize/unserialize_error_001.phpt -> ext/standard/tests/serialize/unserialize_error_001.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "13: var_dump(unserialize($s, [\"allowed_classes\" => 1]));",
          "15: --EXPECTF--",
          "",
          "[Removed Lines]",
          "16: array(3) {",
          "17:   [0]=>",
          "18:   object(__PHP_Incomplete_Class)#%d (2) {",
          "19:     [\"__PHP_Incomplete_Class_Name\"]=>",
          "20:     string(3) \"foo\"",
          "21:     [\"x\"]=>",
          "22:     string(3) \"bar\"",
          "23:   }",
          "24:   [1]=>",
          "25:   int(2)",
          "26:   [2]=>",
          "27:   string(1) \"3\"",
          "28: }",
          "29: array(3) {",
          "30:   [0]=>",
          "31:   object(__PHP_Incomplete_Class)#%d (2) {",
          "32:     [\"__PHP_Incomplete_Class_Name\"]=>",
          "33:     string(3) \"foo\"",
          "34:     [\"x\"]=>",
          "35:     string(3) \"bar\"",
          "36:   }",
          "37:   [1]=>",
          "38:   int(2)",
          "39:   [2]=>",
          "40:   string(1) \"3\"",
          "41: }",
          "42: array(3) {",
          "43:   [0]=>",
          "44:   object(foo)#%d (1) {",
          "45:     [\"x\"]=>",
          "46:     string(3) \"bar\"",
          "47:   }",
          "48:   [1]=>",
          "49:   int(2)",
          "50:   [2]=>",
          "51:   string(1) \"3\"",
          "52: }",
          "",
          "[Added Lines]",
          "16: Warning: unserialize(): allowed_classes option should be array or boolean in %s on line %d",
          "17: bool(false)",
          "19: Warning: unserialize(): allowed_classes option should be array or boolean in %s on line %d",
          "20: bool(false)",
          "22: Warning: unserialize(): allowed_classes option should be array or boolean in %s on line %d",
          "23: bool(false)",
          "",
          "---------------"
        ],
        "ext/standard/var.c||ext/standard/var.c": [
          "File: ext/standard/var.c -> ext/standard/var.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1079:  PHP_VAR_UNSERIALIZE_INIT(var_hash);",
          "1080:  if(options != NULL) {",
          "1081:   classes = zend_hash_str_find(Z_ARRVAL_P(options), \"allowed_classes\", sizeof(\"allowed_classes\")-1);",
          "1082:   if(classes && (Z_TYPE_P(classes) == IS_ARRAY || !zend_is_true(classes))) {",
          "1083:    ALLOC_HASHTABLE(class_hash);",
          "1084:    zend_hash_init(class_hash, (Z_TYPE_P(classes) == IS_ARRAY)?zend_hash_num_elements(Z_ARRVAL_P(classes)):0, NULL, NULL, 0);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1082:   if (classes && Z_TYPE_P(classes) != IS_ARRAY && Z_TYPE_P(classes) != IS_TRUE && Z_TYPE_P(classes) != IS_FALSE) {",
          "1083:    php_error_docref(NULL, E_WARNING, \"allowed_classes option should be array or boolean\");",
          "1084:    PHP_VAR_UNSERIALIZE_DESTROY(var_hash);",
          "1085:    RETURN_FALSE;",
          "1086:   }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1094:           zend_string_release(lcname);",
          "1095:    } ZEND_HASH_FOREACH_END();",
          "1096:   }",
          "1097:  }",
          "1100:   PHP_VAR_UNSERIALIZE_DESTROY(var_hash);",
          "1101:   if (class_hash) {",
          "1102:    zend_hash_destroy(class_hash);",
          "",
          "[Removed Lines]",
          "1099:  if (!php_var_unserialize_ex(return_value, &p, p + buf_len, &var_hash, class_hash)) {",
          "",
          "[Added Lines]",
          "1103:   php_var_unserialize_set_allowed_classes(var_hash, class_hash);",
          "1106:  if (!php_var_unserialize(return_value, &p, p + buf_len, &var_hash)) {",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "29:  void *last;",
          "30:  void *first_dtor;",
          "31:  void *last_dtor;",
          "32: };",
          "34: PHPAPI php_unserialize_data_t php_var_unserialize_init() {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "32:  HashTable *allowed_classes;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "58:  }",
          "59: }",
          "63: #define VAR_ENTRIES_MAX 1024",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "62: PHPAPI void php_var_unserialize_set_allowed_classes(php_unserialize_data_t d, HashTable *classes) {",
          "63:  d->allowed_classes = classes;",
          "64: }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "246:  return str;",
          "247: }",
          "250: {",
          "251:  zend_string *lcname;",
          "252:  int res;",
          "253:  ALLOCA_FLAG(use_heap)",
          "",
          "[Removed Lines]",
          "249: static inline int unserialize_allowed_class(zend_string *class_name, HashTable *classes)",
          "",
          "[Added Lines]",
          "254: static inline int unserialize_allowed_class(",
          "255:   zend_string *class_name, php_unserialize_data_t *var_hashx)",
          "257:  HashTable *classes = (*var_hashx)->allowed_classes;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "273: #define YYMARKER marker",
          "",
          "[Removed Lines]",
          "276: #line 281 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "283: #line 288 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "333:  return result;",
          "334: }",
          "339: static int php_var_unserialize_internal(UNSERIALIZE_PARAMETER);",
          "",
          "[Removed Lines]",
          "336: #define UNSERIALIZE_PARAMETER zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash, HashTable *classes",
          "337: #define UNSERIALIZE_PASSTHRU rval, p, max, var_hash, classes",
          "",
          "[Added Lines]",
          "343: #define UNSERIALIZE_PARAMETER zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash",
          "344: #define UNSERIALIZE_PASSTHRU rval, p, max, var_hash",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "347:   ZVAL_UNDEF(&key);",
          "350:    zval_dtor(&key);",
          "351:    return 0;",
          "352:   }",
          "",
          "[Removed Lines]",
          "349:   if (!php_var_unserialize_internal(&key, p, max, NULL, classes)) {",
          "",
          "[Added Lines]",
          "356:   if (!php_var_unserialize_internal(&key, p, max, NULL)) {",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "402:    }",
          "403:   }",
          "406:    zval_dtor(&key);",
          "407:    return 0;",
          "408:   }",
          "",
          "[Removed Lines]",
          "405:   if (!php_var_unserialize_internal(data, p, max, var_hash, classes)) {",
          "",
          "[Added Lines]",
          "412:   if (!php_var_unserialize_internal(data, p, max, var_hash)) {",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "533: # pragma optimize(\"\", on)",
          "534: #endif",
          "543: {",
          "544:  var_entries *orig_var_entries = (*var_hash)->last;",
          "545:  zend_long orig_used_slots = orig_var_entries ? orig_var_entries->used_slots : 0;",
          "",
          "[Removed Lines]",
          "536: PHPAPI int php_var_unserialize(zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash)",
          "537: {",
          "538:  HashTable *classes = NULL;",
          "539:  return php_var_unserialize_ex(UNSERIALIZE_PASSTHRU);",
          "540: }",
          "542: PHPAPI int php_var_unserialize_ex(UNSERIALIZE_PARAMETER)",
          "",
          "[Added Lines]",
          "543: PHPAPI int php_var_unserialize(UNSERIALIZE_PARAMETER)",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "585:  start = cursor;",
          "589: {",
          "590:  YYCTYPE yych;",
          "591:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "588: #line 589 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "589: #line 590 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "645:  yych = *(YYMARKER = ++YYCURSOR);",
          "646:  if (yych == ':') goto yy95;",
          "647: yy3:",
          "649:  { return 0; }",
          "651: yy4:",
          "652:  yych = *(YYMARKER = ++YYCURSOR);",
          "653:  if (yych == ':') goto yy89;",
          "",
          "[Removed Lines]",
          "648: #line 955 \"ext/standard/var_unserializer.re\"",
          "650: #line 651 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "649: #line 956 \"ext/standard/var_unserializer.re\"",
          "651: #line 652 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "690:  goto yy3;",
          "691: yy14:",
          "692:  ++YYCURSOR;",
          "694:  {",
          "696:  php_error_docref(NULL, E_NOTICE, \"Unexpected end of serialized data\");",
          "698: }",
          "700: yy16:",
          "701:  yych = *++YYCURSOR;",
          "702:  goto yy3;",
          "",
          "[Removed Lines]",
          "693: #line 949 \"ext/standard/var_unserializer.re\"",
          "699: #line 700 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "694: #line 950 \"ext/standard/var_unserializer.re\"",
          "700: #line 701 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "722:  if (yybm[0+yych] & 128) {",
          "723:   goto yy20;",
          "724:  }",
          "726:  yych = *++YYCURSOR;",
          "727:  if (yych != '\"') goto yy18;",
          "728:  ++YYCURSOR;",
          "730:  {",
          "731:  size_t len, len2, len3, maxlen;",
          "732:  zend_long elements;",
          "",
          "[Removed Lines]",
          "725:  if (yych != ':') goto yy18;",
          "729: #line 804 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "726:  if (yych <= '/') goto yy18;",
          "727:  if (yych >= ';') goto yy18;",
          "731: #line 805 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "776:  class_name = zend_string_init(str, len, 0);",
          "778:  do {",
          "780:    incomplete_class = 1;",
          "781:    ce = PHP_IC_ENTRY;",
          "782:    break;",
          "",
          "[Removed Lines]",
          "779:   if(!unserialize_allowed_class(class_name, classes)) {",
          "",
          "[Added Lines]",
          "781:   if(!unserialize_allowed_class(class_name, var_hash)) {",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "872:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "873: }",
          "875: yy25:",
          "876:  yych = *++YYCURSOR;",
          "877:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "874: #line 875 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "876: #line 877 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "896:  yych = *++YYCURSOR;",
          "897:  if (yych != '\"') goto yy18;",
          "898:  ++YYCURSOR;",
          "900:  {",
          "901:     if (!var_hash) return 0;",
          "903:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "904:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "905: }",
          "907: yy32:",
          "908:  yych = *++YYCURSOR;",
          "909:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "899: #line 797 \"ext/standard/var_unserializer.re\"",
          "906: #line 907 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "901: #line 798 \"ext/standard/var_unserializer.re\"",
          "908: #line 909 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "924:  yych = *++YYCURSOR;",
          "925:  if (yych != '{') goto yy18;",
          "926:  ++YYCURSOR;",
          "928:  {",
          "929:  zend_long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "927: #line 773 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "929: #line 774 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "949:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "950: }",
          "952: yy39:",
          "953:  yych = *++YYCURSOR;",
          "954:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "951: #line 952 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "953: #line 954 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "969:  yych = *++YYCURSOR;",
          "970:  if (yych != '\"') goto yy18;",
          "971:  ++YYCURSOR;",
          "973:  {",
          "974:  size_t len, maxlen;",
          "975:  zend_string *str;",
          "",
          "[Removed Lines]",
          "972: #line 739 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "974: #line 740 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1003:  ZVAL_STR(rval, str);",
          "1004:  return 1;",
          "1005: }",
          "1007: yy46:",
          "1008:  yych = *++YYCURSOR;",
          "1009:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "1006: #line 1007 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1008: #line 1009 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1024:  yych = *++YYCURSOR;",
          "1025:  if (yych != '\"') goto yy18;",
          "1026:  ++YYCURSOR;",
          "1028:  {",
          "1029:  size_t len, maxlen;",
          "1030:  char *str;",
          "",
          "[Removed Lines]",
          "1027: #line 707 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1029: #line 708 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "1056:  ZVAL_STRINGL(rval, str, len);",
          "1057:  return 1;",
          "1058: }",
          "1060: yy53:",
          "1061:  yych = *++YYCURSOR;",
          "1062:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "1059: #line 1060 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1061: #line 1062 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "1144:  }",
          "1145: yy63:",
          "1146:  ++YYCURSOR;",
          "1148:  {",
          "1149: #if SIZEOF_ZEND_LONG == 4",
          "1150: use_double:",
          "",
          "[Removed Lines]",
          "1147: #line 698 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1149: #line 699 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "1153:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1154:  return 1;",
          "1155: }",
          "1157: yy65:",
          "1158:  yych = *++YYCURSOR;",
          "1159:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1156: #line 1157 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1158: #line 1159 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "1212:  yych = *++YYCURSOR;",
          "1213:  if (yych != ';') goto yy18;",
          "1214:  ++YYCURSOR;",
          "1216:  {",
          "",
          "[Removed Lines]",
          "1215: #line 682 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1217: #line 683 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 25 ---",
          "[Context before]",
          "1229:  return 1;",
          "1230: }",
          "1232: yy76:",
          "1233:  yych = *++YYCURSOR;",
          "1234:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1231: #line 1232 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1233: #line 1234 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 26 ---",
          "[Context before]",
          "1255:  if (yych <= '9') goto yy79;",
          "1256:  if (yych != ';') goto yy18;",
          "1257:  ++YYCURSOR;",
          "1259:  {",
          "1260: #if SIZEOF_ZEND_LONG == 4",
          "1261:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1258: #line 656 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1260: #line 657 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 27 ---",
          "[Context before]",
          "1281:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1282:  return 1;",
          "1283: }",
          "1285: yy83:",
          "1286:  yych = *++YYCURSOR;",
          "1287:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1284: #line 1285 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1286: #line 1287 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 28 ---",
          "[Context before]",
          "1289:  yych = *++YYCURSOR;",
          "1290:  if (yych != ';') goto yy18;",
          "1291:  ++YYCURSOR;",
          "1293:  {",
          "1295:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1296:  return 1;",
          "1297: }",
          "1299: yy87:",
          "1300:  ++YYCURSOR;",
          "1302:  {",
          "1304:  ZVAL_NULL(rval);",
          "1305:  return 1;",
          "1306: }",
          "1308: yy89:",
          "1309:  yych = *++YYCURSOR;",
          "1310:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1292: #line 650 \"ext/standard/var_unserializer.re\"",
          "1298: #line 1299 \"ext/standard/var_unserializer.c\"",
          "1301: #line 644 \"ext/standard/var_unserializer.re\"",
          "1307: #line 1308 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1294: #line 651 \"ext/standard/var_unserializer.re\"",
          "1300: #line 1301 \"ext/standard/var_unserializer.c\"",
          "1303: #line 645 \"ext/standard/var_unserializer.re\"",
          "1309: #line 1310 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 29 ---",
          "[Context before]",
          "1327:  if (yych <= '9') goto yy91;",
          "1328:  if (yych != ';') goto yy18;",
          "1329:  ++YYCURSOR;",
          "1331:  {",
          "1332:  zend_long id;",
          "",
          "[Removed Lines]",
          "1330: #line 619 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1332: #line 620 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 30 ---",
          "[Context before]",
          "1353:  return 1;",
          "1354: }",
          "1356: yy95:",
          "1357:  yych = *++YYCURSOR;",
          "1358:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1355: #line 1356 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1357: #line 1358 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 31 ---",
          "[Context before]",
          "1375:  if (yych <= '9') goto yy97;",
          "1376:  if (yych != ';') goto yy18;",
          "1377:  ++YYCURSOR;",
          "1379:  {",
          "1380:  zend_long id;",
          "",
          "[Removed Lines]",
          "1378: #line 593 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1380: #line 594 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 32 ---",
          "[Context before]",
          "1402:  return 1;",
          "1403: }",
          "1405: }",
          "1409:  return 0;",
          "",
          "[Removed Lines]",
          "1404: #line 1405 \"ext/standard/var_unserializer.c\"",
          "1406: #line 957 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1406: #line 1407 \"ext/standard/var_unserializer.c\"",
          "1408: #line 958 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "27:  void *last;",
          "28:  void *first_dtor;",
          "29:  void *last_dtor;",
          "30: };",
          "32: PHPAPI php_unserialize_data_t php_var_unserialize_init() {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "30:  HashTable *allowed_classes;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "56:  }",
          "57: }",
          "61: #define VAR_ENTRIES_MAX 1024",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "60: PHPAPI void php_var_unserialize_set_allowed_classes(php_unserialize_data_t d, HashTable *classes) {",
          "61:  d->allowed_classes = classes;",
          "62: }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "244:  return str;",
          "245: }",
          "248: {",
          "249:  zend_string *lcname;",
          "250:  int res;",
          "251:  ALLOCA_FLAG(use_heap)",
          "",
          "[Removed Lines]",
          "247: static inline int unserialize_allowed_class(zend_string *class_name, HashTable *classes)",
          "",
          "[Added Lines]",
          "252: static inline int unserialize_allowed_class(",
          "253:   zend_string *class_name, php_unserialize_data_t *var_hashx)",
          "255:  HashTable *classes = (*var_hashx)->allowed_classes;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "337:  return result;",
          "338: }",
          "343: static int php_var_unserialize_internal(UNSERIALIZE_PARAMETER);",
          "",
          "[Removed Lines]",
          "340: #define UNSERIALIZE_PARAMETER zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash, HashTable *classes",
          "341: #define UNSERIALIZE_PASSTHRU rval, p, max, var_hash, classes",
          "",
          "[Added Lines]",
          "347: #define UNSERIALIZE_PARAMETER zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash",
          "348: #define UNSERIALIZE_PASSTHRU rval, p, max, var_hash",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "351:   ZVAL_UNDEF(&key);",
          "354:    zval_dtor(&key);",
          "355:    return 0;",
          "356:   }",
          "",
          "[Removed Lines]",
          "353:   if (!php_var_unserialize_internal(&key, p, max, NULL, classes)) {",
          "",
          "[Added Lines]",
          "360:   if (!php_var_unserialize_internal(&key, p, max, NULL)) {",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "406:    }",
          "407:   }",
          "410:    zval_dtor(&key);",
          "411:    return 0;",
          "412:   }",
          "",
          "[Removed Lines]",
          "409:   if (!php_var_unserialize_internal(data, p, max, var_hash, classes)) {",
          "",
          "[Added Lines]",
          "416:   if (!php_var_unserialize_internal(data, p, max, var_hash)) {",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "537: # pragma optimize(\"\", on)",
          "538: #endif",
          "547: {",
          "548:  var_entries *orig_var_entries = (*var_hash)->last;",
          "549:  zend_long orig_used_slots = orig_var_entries ? orig_var_entries->used_slots : 0;",
          "",
          "[Removed Lines]",
          "540: PHPAPI int php_var_unserialize(zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash)",
          "541: {",
          "542:  HashTable *classes = NULL;",
          "543:  return php_var_unserialize_ex(UNSERIALIZE_PASSTHRU);",
          "544: }",
          "546: PHPAPI int php_var_unserialize_ex(UNSERIALIZE_PARAMETER)",
          "",
          "[Added Lines]",
          "547: PHPAPI int php_var_unserialize(UNSERIALIZE_PARAMETER)",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "850:  class_name = zend_string_init(str, len, 0);",
          "852:  do {",
          "854:    incomplete_class = 1;",
          "855:    ce = PHP_IC_ENTRY;",
          "856:    break;",
          "",
          "[Removed Lines]",
          "853:   if(!unserialize_allowed_class(class_name, classes)) {",
          "",
          "[Added Lines]",
          "854:   if(!unserialize_allowed_class(class_name, var_hash)) {",
          "",
          "---------------"
        ]
      }
    }
  ]
}