{
  "cve_id": "CVE-2019-19966",
  "cve_desc": "In the Linux kernel before 5.1.6, there is a use-after-free in cpia2_exit() in drivers/media/usb/cpia2/cpia2_v4l.c that will cause denial of service, aka CID-dea37a972655.",
  "repo": "torvalds/linux",
  "patch_hash": "dea37a97265588da604c6ba80160a287b72c7bfd",
  "patch_info": {
    "commit_hash": "dea37a97265588da604c6ba80160a287b72c7bfd",
    "repo": "torvalds/linux",
    "commit_url": "https://github.com/torvalds/linux/commit/dea37a97265588da604c6ba80160a287b72c7bfd",
    "files": [
      "drivers/media/usb/cpia2/cpia2_v4l.c"
    ],
    "message": "media: cpia2: Fix use-after-free in cpia2_exit\n\nSyzkaller report this:\n\nBUG: KASAN: use-after-free in sysfs_remove_file_ns+0x5f/0x70 fs/sysfs/file.c:468\nRead of size 8 at addr ffff8881f59a6b70 by task syz-executor.0/8363\n\nCPU: 0 PID: 8363 Comm: syz-executor.0 Not tainted 5.0.0-rc8+ #3\nHardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.10.2-1ubuntu1 04/01/2014\nCall Trace:\n __dump_stack lib/dump_stack.c:77 [inline]\n dump_stack+0xfa/0x1ce lib/dump_stack.c:113\n print_address_description+0x65/0x270 mm/kasan/report.c:187\n kasan_report+0x149/0x18d mm/kasan/report.c:317\n sysfs_remove_file_ns+0x5f/0x70 fs/sysfs/file.c:468\n sysfs_remove_file include/linux/sysfs.h:519 [inline]\n driver_remove_file+0x40/0x50 drivers/base/driver.c:122\n usb_remove_newid_files drivers/usb/core/driver.c:212 [inline]\n usb_deregister+0x12a/0x3b0 drivers/usb/core/driver.c:1005\n cpia2_exit+0xa/0x16 [cpia2]\n __do_sys_delete_module kernel/module.c:1018 [inline]\n __se_sys_delete_module kernel/module.c:961 [inline]\n __x64_sys_delete_module+0x3dc/0x5e0 kernel/module.c:961\n do_syscall_64+0x147/0x600 arch/x86/entry/common.c:290\n entry_SYSCALL_64_after_hwframe+0x49/0xbe\nRIP: 0033:0x462e99\nCode: f7 d8 64 89 02 b8 ff ff ff ff c3 66 0f 1f 44 00 00 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 c7 c1 bc ff ff ff f7 d8 64 89 01 48\nRSP: 002b:00007f86f3754c58 EFLAGS: 00000246 ORIG_RAX: 00000000000000b0\nRAX: ffffffffffffffda RBX: 000000000073bf00 RCX: 0000000000462e99\nRDX: 0000000000000000 RSI: 0000000000000000 RDI: 0000000020000300\nRBP: 0000000000000002 R08: 0000000000000000 R09: 0000000000000000\nR10: 0000000000000000 R11: 0000000000000246 R12: 00007f86f37556bc\nR13: 00000000004bcca9 R14: 00000000006f6b48 R15: 00000000ffffffff\n\nAllocated by task 8363:\n set_track mm/kasan/common.c:85 [inline]\n __kasan_kmalloc.constprop.3+0xa0/0xd0 mm/kasan/common.c:495\n kmalloc include/linux/slab.h:545 [inline]\n kzalloc include/linux/slab.h:740 [inline]\n bus_add_driver+0xc0/0x610 drivers/base/bus.c:651\n driver_register+0x1bb/0x3f0 drivers/base/driver.c:170\n usb_register_driver+0x267/0x520 drivers/usb/core/driver.c:965\n 0xffffffffc1b4817c\n do_one_initcall+0xfa/0x5ca init/main.c:887\n do_init_module+0x204/0x5f6 kernel/module.c:3460\n load_module+0x66b2/0x8570 kernel/module.c:3808\n __do_sys_finit_module+0x238/0x2a0 kernel/module.c:3902\n do_syscall_64+0x147/0x600 arch/x86/entry/common.c:290\n entry_SYSCALL_64_after_hwframe+0x49/0xbe\n\nFreed by task 8363:\n set_track mm/kasan/common.c:85 [inline]\n __kasan_slab_free+0x130/0x180 mm/kasan/common.c:457\n slab_free_hook mm/slub.c:1430 [inline]\n slab_free_freelist_hook mm/slub.c:1457 [inline]\n slab_free mm/slub.c:3005 [inline]\n kfree+0xe1/0x270 mm/slub.c:3957\n kobject_cleanup lib/kobject.c:662 [inline]\n kobject_release lib/kobject.c:691 [inline]\n kref_put include/linux/kref.h:67 [inline]\n kobject_put+0x146/0x240 lib/kobject.c:708\n bus_remove_driver+0x10e/0x220 drivers/base/bus.c:732\n driver_unregister+0x6c/0xa0 drivers/base/driver.c:197\n usb_register_driver+0x341/0x520 drivers/usb/core/driver.c:980\n 0xffffffffc1b4817c\n do_one_initcall+0xfa/0x5ca init/main.c:887\n do_init_module+0x204/0x5f6 kernel/module.c:3460\n load_module+0x66b2/0x8570 kernel/module.c:3808\n __do_sys_finit_module+0x238/0x2a0 kernel/module.c:3902\n do_syscall_64+0x147/0x600 arch/x86/entry/common.c:290\n entry_SYSCALL_64_after_hwframe+0x49/0xbe\n\nThe buggy address belongs to the object at ffff8881f59a6b40\n which belongs to the cache kmalloc-256 of size 256\nThe buggy address is located 48 bytes inside of\n 256-byte region [ffff8881f59a6b40, ffff8881f59a6c40)\nThe buggy address belongs to the page:\npage:ffffea0007d66980 count:1 mapcount:0 mapping:ffff8881f6c02e00 index:0x0\nflags: 0x2fffc0000000200(slab)\nraw: 02fffc0000000200 dead000000000100 dead000000000200 ffff8881f6c02e00\nraw: 0000000000000000 00000000800c000c 00000001ffffffff 0000000000000000\npage dumped because: kasan: bad access detected\n\nMemory state around the buggy address:\n ffff8881f59a6a00: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n ffff8881f59a6a80: 00 00 00 00 00 00 00 00 00 00 fc fc fc fc fc fc\n>ffff8881f59a6b00: fc fc fc fc fc fc fc fc fb fb fb fb fb fb fb fb\n                                                             ^\n ffff8881f59a6b80: fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb\n ffff8881f59a6c00: fb fb fb fb fb fb fb fb fc fc fc fc fc fc fc fc\n\ncpia2_init does not check return value of cpia2_init, if it failed\nin usb_register_driver, there is already cleanup using driver_unregister.\nNo need call cpia2_usb_cleanup on module exit.\n\nReported-by: Hulk Robot <hulkci@huawei.com>\nSigned-off-by: YueHaibing <yuehaibing@huawei.com>\nSigned-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>\nSigned-off-by: Mauro Carvalho Chehab <mchehab+samsung@kernel.org>",
    "before_after_code_files": [
      "drivers/media/usb/cpia2/cpia2_v4l.c||drivers/media/usb/cpia2/cpia2_v4l.c"
    ]
  },
  "patch_diff": {
    "drivers/media/usb/cpia2/cpia2_v4l.c||drivers/media/usb/cpia2/cpia2_v4l.c": [
      "File: drivers/media/usb/cpia2/cpia2_v4l.c -> drivers/media/usb/cpia2/cpia2_v4l.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1240:  LOG(\"%s v%s\\n\",",
      "1241:      ABOUT, CPIA_VERSION);",
      "1242:  check_parameters();",
      "1245: }",
      "",
      "[Removed Lines]",
      "1243:  cpia2_usb_init();",
      "1244:  return 0;",
      "",
      "[Added Lines]",
      "1243:  return cpia2_usb_init();",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "39df730b09774bd860e39ea208a48d15078236cb",
      "candidate_info": {
        "commit_hash": "39df730b09774bd860e39ea208a48d15078236cb",
        "repo": "torvalds/linux",
        "commit_url": "https://github.com/torvalds/linux/commit/39df730b09774bd860e39ea208a48d15078236cb",
        "files": [
          "tools/perf/util/parse-events.c"
        ],
        "message": "perf list: Don't forget to drop the reference to the allocated thread_map\n\nDetected via gcc's ASan:\n\n  Direct leak of 2048 byte(s) in 64 object(s) allocated from:\n    6     #0 0x7f606512e370 in __interceptor_realloc (/usr/lib/x86_64-linux-gnu/libasan.so.5+0xee370)\n    7     #1 0x556b0f1d7ddd in thread_map__realloc util/thread_map.c:43\n    8     #2 0x556b0f1d84c7 in thread_map__new_by_tid util/thread_map.c:85\n    9     #3 0x556b0f0e045e in is_event_supported util/parse-events.c:2250\n   10     #4 0x556b0f0e1aa1 in print_hwcache_events util/parse-events.c:2382\n   11     #5 0x556b0f0e3231 in print_events util/parse-events.c:2514\n   12     #6 0x556b0ee0a66e in cmd_list /home/changbin/work/linux/tools/perf/builtin-list.c:58\n   13     #7 0x556b0f01e0ae in run_builtin /home/changbin/work/linux/tools/perf/perf.c:302\n   14     #8 0x556b0f01e859 in handle_internal_command /home/changbin/work/linux/tools/perf/perf.c:354\n   15     #9 0x556b0f01edc8 in run_argv /home/changbin/work/linux/tools/perf/perf.c:398\n   16     #10 0x556b0f01f71f in main /home/changbin/work/linux/tools/perf/perf.c:520\n   17     #11 0x7f6062ccf09a in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2409a)\n\nSigned-off-by: Changbin Du <changbin.du@gmail.com>\nReviewed-by: Jiri Olsa <jolsa@kernel.org>\nCc: Alexei Starovoitov <ast@kernel.org>\nCc: Daniel Borkmann <daniel@iogearbox.net>\nCc: Namhyung Kim <namhyung@kernel.org>\nCc: Peter Zijlstra <peterz@infradead.org>\nCc: Steven Rostedt (VMware) <rostedt@goodmis.org>\nFixes: 89896051f8da (\"perf tools: Do not put a variable sized type not at the end of a struct\")\nLink: http://lkml.kernel.org/r/20190316080556.3075-3-changbin.du@gmail.com\nSigned-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>",
        "before_after_code_files": [
          "tools/perf/util/parse-events.c||tools/perf/util/parse-events.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_issue": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "tools/perf/util/parse-events.c||tools/perf/util/parse-events.c": [
          "File: tools/perf/util/parse-events.c -> tools/perf/util/parse-events.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2271:   perf_evsel__delete(evsel);",
          "2272:  }",
          "2274:  return ret;",
          "2275: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2274:  thread_map__put(tmap);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "7494cec6cb3ba7385a6a223b81906384f15aae34",
      "candidate_info": {
        "commit_hash": "7494cec6cb3ba7385a6a223b81906384f15aae34",
        "repo": "torvalds/linux",
        "commit_url": "https://github.com/torvalds/linux/commit/7494cec6cb3ba7385a6a223b81906384f15aae34",
        "files": [
          "virt/kvm/arm/vgic/vgic-its.c"
        ],
        "message": "KVM: arm/arm64: vgic-its: Take the srcu lock when parsing the memslots\n\nCalling kvm_is_visible_gfn() implies that we're parsing the memslots,\nand doing this without the srcu lock is frown upon:\n\n[12704.164532] =============================\n[12704.164544] WARNING: suspicious RCU usage\n[12704.164560] 5.1.0-rc1-00008-g600025238f51-dirty #16 Tainted: G        W\n[12704.164573] -----------------------------\n[12704.164589] ./include/linux/kvm_host.h:605 suspicious rcu_dereference_check() usage!\n[12704.164602] other info that might help us debug this:\n[12704.164616] rcu_scheduler_active = 2, debug_locks = 1\n[12704.164631] 6 locks held by qemu-system-aar/13968:\n[12704.164644]  #0: 000000007ebdae4f (&kvm->lock){+.+.}, at: vgic_its_set_attr+0x244/0x3a0\n[12704.164691]  #1: 000000007d751022 (&its->its_lock){+.+.}, at: vgic_its_set_attr+0x250/0x3a0\n[12704.164726]  #2: 00000000219d2706 (&vcpu->mutex){+.+.}, at: lock_all_vcpus+0x64/0xd0\n[12704.164761]  #3: 00000000a760aecd (&vcpu->mutex){+.+.}, at: lock_all_vcpus+0x64/0xd0\n[12704.164794]  #4: 000000000ef8e31d (&vcpu->mutex){+.+.}, at: lock_all_vcpus+0x64/0xd0\n[12704.164827]  #5: 000000007a872093 (&vcpu->mutex){+.+.}, at: lock_all_vcpus+0x64/0xd0\n[12704.164861] stack backtrace:\n[12704.164878] CPU: 2 PID: 13968 Comm: qemu-system-aar Tainted: G        W         5.1.0-rc1-00008-g600025238f51-dirty #16\n[12704.164887] Hardware name: rockchip evb_rk3399/evb_rk3399, BIOS 2019.04-rc3-00124-g2feec69fb1 03/15/2019\n[12704.164896] Call trace:\n[12704.164910]  dump_backtrace+0x0/0x138\n[12704.164920]  show_stack+0x24/0x30\n[12704.164934]  dump_stack+0xbc/0x104\n[12704.164946]  lockdep_rcu_suspicious+0xcc/0x110\n[12704.164958]  gfn_to_memslot+0x174/0x190\n[12704.164969]  kvm_is_visible_gfn+0x28/0x70\n[12704.164980]  vgic_its_check_id.isra.0+0xec/0x1e8\n[12704.164991]  vgic_its_save_tables_v0+0x1ac/0x330\n[12704.165001]  vgic_its_set_attr+0x298/0x3a0\n[12704.165012]  kvm_device_ioctl_attr+0x9c/0xd8\n[12704.165022]  kvm_device_ioctl+0x8c/0xf8\n[12704.165035]  do_vfs_ioctl+0xc8/0x960\n[12704.165045]  ksys_ioctl+0x8c/0xa0\n[12704.165055]  __arm64_sys_ioctl+0x28/0x38\n[12704.165067]  el0_svc_common+0xd8/0x138\n[12704.165078]  el0_svc_handler+0x38/0x78\n[12704.165089]  el0_svc+0x8/0xc\n\nMake sure the lock is taken when doing this.\n\nFixes: bf308242ab98 (\"KVM: arm/arm64: VGIC/ITS: protect kvm_read_guest() calls with SRCU lock\")\nReviewed-by: Eric Auger <eric.auger@redhat.com>\nSigned-off-by: Marc Zyngier <marc.zyngier@arm.com>",
        "before_after_code_files": [
          "virt/kvm/arm/vgic/vgic-its.c||virt/kvm/arm/vgic/vgic-its.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_issue": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "virt/kvm/arm/vgic/vgic-its.c||virt/kvm/arm/vgic/vgic-its.c": [
          "File: virt/kvm/arm/vgic/vgic-its.c -> virt/kvm/arm/vgic/vgic-its.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "754:  u64 indirect_ptr, type = GITS_BASER_TYPE(baser);",
          "755:  phys_addr_t base = GITS_BASER_ADDR_48_to_52(baser);",
          "756:  int esz = GITS_BASER_ENTRY_SIZE(baser);",
          "758:  gfn_t gfn;",
          "760:  switch (type) {",
          "761:  case GITS_BASER_TYPE_DEVICE:",
          "",
          "[Removed Lines]",
          "757:  int index;",
          "",
          "[Added Lines]",
          "757:  int index, idx;",
          "759:  bool ret;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "783:   if (eaddr)",
          "786:  }",
          "",
          "[Removed Lines]",
          "785:   return kvm_is_visible_gfn(its->dev->kvm, gfn);",
          "",
          "[Added Lines]",
          "787:   goto out;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "813:  if (eaddr)",
          "816: }",
          "818: static int vgic_its_alloc_collection(struct vgic_its *its,",
          "",
          "[Removed Lines]",
          "815:  return kvm_is_visible_gfn(its->dev->kvm, gfn);",
          "",
          "[Added Lines]",
          "818: out:",
          "819:  idx = srcu_read_lock(&its->dev->kvm->srcu);",
          "820:  ret = kvm_is_visible_gfn(its->dev->kvm, gfn);",
          "821:  srcu_read_unlock(&its->dev->kvm->srcu, idx);",
          "822:  return ret;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "54569ba4b06d5baedae4614bde33a25a191473ba",
      "candidate_info": {
        "commit_hash": "54569ba4b06d5baedae4614bde33a25a191473ba",
        "repo": "torvalds/linux",
        "commit_url": "https://github.com/torvalds/linux/commit/54569ba4b06d5baedae4614bde33a25a191473ba",
        "files": [
          "tools/perf/util/config.c"
        ],
        "message": "perf config: Fix a memory leak in collect_config()\n\nDetected with gcc's ASan:\n\n  Direct leak of 66 byte(s) in 5 object(s) allocated from:\n      #0 0x7ff3b1f32070 in __interceptor_strdup (/usr/lib/x86_64-linux-gnu/libasan.so.5+0x3b070)\n      #1 0x560c8761034d in collect_config util/config.c:597\n      #2 0x560c8760d9cb in get_value util/config.c:169\n      #3 0x560c8760dfd7 in perf_parse_file util/config.c:285\n      #4 0x560c8760e0d2 in perf_config_from_file util/config.c:476\n      #5 0x560c876108fd in perf_config_set__init util/config.c:661\n      #6 0x560c87610c72 in perf_config_set__new util/config.c:709\n      #7 0x560c87610d2f in perf_config__init util/config.c:718\n      #8 0x560c87610e5d in perf_config util/config.c:730\n      #9 0x560c875ddea0 in main /home/changbin/work/linux/tools/perf/perf.c:442\n      #10 0x7ff3afb8609a in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2409a)\n\nSigned-off-by: Changbin Du <changbin.du@gmail.com>\nReviewed-by: Jiri Olsa <jolsa@kernel.org>\nCc: Alexei Starovoitov <ast@kernel.org>\nCc: Daniel Borkmann <daniel@iogearbox.net>\nCc: Namhyung Kim <namhyung@kernel.org>\nCc: Peter Zijlstra <peterz@infradead.org>\nCc: Steven Rostedt (VMware) <rostedt@goodmis.org>\nCc: Taeung Song <treeze.taeung@gmail.com>\nFixes: 20105ca1240c (\"perf config: Introduce perf_config_set class\")\nLink: http://lkml.kernel.org/r/20190316080556.3075-6-changbin.du@gmail.com\nSigned-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>",
        "before_after_code_files": [
          "tools/perf/util/config.c||tools/perf/util/config.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_issue": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "tools/perf/util/config.c||tools/perf/util/config.c": [
          "File: tools/perf/util/config.c -> tools/perf/util/config.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "633:  }",
          "635:  ret = set_value(item, value);",
          "638: out_free:",
          "639:  free(key);",
          "641: }",
          "643: int perf_config_set__collect(struct perf_config_set *set, const char *file_name,",
          "",
          "[Removed Lines]",
          "636:  return ret;",
          "640:  return -1;",
          "",
          "[Added Lines]",
          "639:  return ret;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "8bde8516893da5a5fdf06121f74d11b52ab92df5",
      "candidate_info": {
        "commit_hash": "8bde8516893da5a5fdf06121f74d11b52ab92df5",
        "repo": "torvalds/linux",
        "commit_url": "https://github.com/torvalds/linux/commit/8bde8516893da5a5fdf06121f74d11b52ab92df5",
        "files": [
          "tools/perf/util/build-id.c",
          "tools/perf/util/parse-events.c"
        ],
        "message": "perf build-id: Fix memory leak in print_sdt_events()\n\nDetected with gcc's ASan:\n\n  Direct leak of 4356 byte(s) in 120 object(s) allocated from:\n      #0 0x7ff1a2b5a070 in __interceptor_strdup (/usr/lib/x86_64-linux-gnu/libasan.so.5+0x3b070)\n      #1 0x55719aef4814 in build_id_cache__origname util/build-id.c:215\n      #2 0x55719af649b6 in print_sdt_events util/parse-events.c:2339\n      #3 0x55719af66272 in print_events util/parse-events.c:2542\n      #4 0x55719ad1ecaa in cmd_list /home/changbin/work/linux/tools/perf/builtin-list.c:58\n      #5 0x55719aec745d in run_builtin /home/changbin/work/linux/tools/perf/perf.c:302\n      #6 0x55719aec7d1a in handle_internal_command /home/changbin/work/linux/tools/perf/perf.c:354\n      #7 0x55719aec8184 in run_argv /home/changbin/work/linux/tools/perf/perf.c:398\n      #8 0x55719aeca41a in main /home/changbin/work/linux/tools/perf/perf.c:520\n      #9 0x7ff1a07ae09a in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2409a)\n\nSigned-off-by: Changbin Du <changbin.du@gmail.com>\nReviewed-by: Jiri Olsa <jolsa@kernel.org>\nCc: Alexei Starovoitov <ast@kernel.org>\nCc: Daniel Borkmann <daniel@iogearbox.net>\nCc: Masami Hiramatsu <masami.hiramatsu.pt@hitachi.com>\nCc: Namhyung Kim <namhyung@kernel.org>\nCc: Peter Zijlstra <peterz@infradead.org>\nCc: Steven Rostedt (VMware) <rostedt@goodmis.org>\nFixes: 40218daea1db (\"perf list: Show SDT and pre-cached events\")\nLink: http://lkml.kernel.org/r/20190316080556.3075-7-changbin.du@gmail.com\nSigned-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>",
        "before_after_code_files": [
          "tools/perf/util/build-id.c||tools/perf/util/build-id.c",
          "tools/perf/util/parse-events.c||tools/perf/util/parse-events.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_issue": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "tools/perf/util/build-id.c||tools/perf/util/build-id.c": [
          "File: tools/perf/util/build-id.c -> tools/perf/util/build-id.c"
        ],
        "tools/perf/util/parse-events.c||tools/perf/util/parse-events.c": [
          "File: tools/perf/util/parse-events.c -> tools/perf/util/parse-events.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2342:     printf(\"  %-50s [%s]\\n\", buf, \"SDT event\");",
          "2343:     free(buf);",
          "2344:    }",
          "2345:   } else",
          "2346:    printf(\"  %-50s [%s]\\n\", nd->s, \"SDT event\");",
          "2347:   if (nd2) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2345:    free(path);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "d982b33133284fa7efa0e52ae06b88f9be3ea764",
      "candidate_info": {
        "commit_hash": "d982b33133284fa7efa0e52ae06b88f9be3ea764",
        "repo": "torvalds/linux",
        "commit_url": "https://github.com/torvalds/linux/commit/d982b33133284fa7efa0e52ae06b88f9be3ea764",
        "files": [
          "tools/perf/tests/evsel-tp-sched.c"
        ],
        "message": "perf tests: Fix a memory leak in test__perf_evsel__tp_sched_test()\n\n  =================================================================\n  ==20875==ERROR: LeakSanitizer: detected memory leaks\n\n  Direct leak of 1160 byte(s) in 1 object(s) allocated from:\n      #0 0x7f1b6fc84138 in calloc (/usr/lib/x86_64-linux-gnu/libasan.so.5+0xee138)\n      #1 0x55bd50005599 in zalloc util/util.h:23\n      #2 0x55bd500068f5 in perf_evsel__newtp_idx util/evsel.c:327\n      #3 0x55bd4ff810fc in perf_evsel__newtp /home/work/linux/tools/perf/util/evsel.h:216\n      #4 0x55bd4ff81608 in test__perf_evsel__tp_sched_test tests/evsel-tp-sched.c:69\n      #5 0x55bd4ff528e6 in run_test tests/builtin-test.c:358\n      #6 0x55bd4ff52baf in test_and_print tests/builtin-test.c:388\n      #7 0x55bd4ff543fe in __cmd_test tests/builtin-test.c:583\n      #8 0x55bd4ff5572f in cmd_test tests/builtin-test.c:722\n      #9 0x55bd4ffc4087 in run_builtin /home/changbin/work/linux/tools/perf/perf.c:302\n      #10 0x55bd4ffc45c6 in handle_internal_command /home/changbin/work/linux/tools/perf/perf.c:354\n      #11 0x55bd4ffc49ca in run_argv /home/changbin/work/linux/tools/perf/perf.c:398\n      #12 0x55bd4ffc5138 in main /home/changbin/work/linux/tools/perf/perf.c:520\n      #13 0x7f1b6e34809a in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2409a)\n\n  Indirect leak of 19 byte(s) in 1 object(s) allocated from:\n      #0 0x7f1b6fc83f30 in __interceptor_malloc (/usr/lib/x86_64-linux-gnu/libasan.so.5+0xedf30)\n      #1 0x7f1b6e3ac30f in vasprintf (/lib/x86_64-linux-gnu/libc.so.6+0x8830f)\n\nSigned-off-by: Changbin Du <changbin.du@gmail.com>\nReviewed-by: Jiri Olsa <jolsa@kernel.org>\nCc: Alexei Starovoitov <ast@kernel.org>\nCc: Daniel Borkmann <daniel@iogearbox.net>\nCc: Namhyung Kim <namhyung@kernel.org>\nCc: Peter Zijlstra <peterz@infradead.org>\nCc: Steven Rostedt (VMware) <rostedt@goodmis.org>\nFixes: 6a6cd11d4e57 (\"perf test: Add test for the sched tracepoint format fields\")\nLink: http://lkml.kernel.org/r/20190316080556.3075-17-changbin.du@gmail.com\nSigned-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>",
        "before_after_code_files": [
          "tools/perf/tests/evsel-tp-sched.c||tools/perf/tests/evsel-tp-sched.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_issue": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "tools/perf/tests/evsel-tp-sched.c||tools/perf/tests/evsel-tp-sched.c": [
          "File: tools/perf/tests/evsel-tp-sched.c -> tools/perf/tests/evsel-tp-sched.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "85:  if (perf_evsel__test_field(evsel, \"target_cpu\", 4, true))",
          "86:   ret = -1;",
          "88:  return ret;",
          "89: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "88:  perf_evsel__delete(evsel);",
          "",
          "---------------"
        ]
      }
    }
  ]
}