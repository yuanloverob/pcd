{
  "cve_id": "CVE-2016-10161",
  "cve_desc": "The object_common1 function in ext/standard/var_unserializer.c in PHP before 5.6.30, 7.0.x before 7.0.15, and 7.1.x before 7.1.1 allows remote attackers to cause a denial of service (buffer over-read and application crash) via crafted serialized data that is mishandled in a finish_nested_data call.",
  "repo": "php/php-src",
  "patch_hash": "16b3003ffc6393e250f069aa28a78dc5a2c064b2",
  "patch_info": {
    "commit_hash": "16b3003ffc6393e250f069aa28a78dc5a2c064b2",
    "repo": "php/php-src",
    "commit_url": "https://github.com/php/php-src/commit/16b3003ffc6393e250f069aa28a78dc5a2c064b2",
    "files": [
      "ext/standard/tests/serialize/bug73825.phpt",
      "ext/standard/var_unserializer.c",
      "ext/standard/var_unserializer.re"
    ],
    "message": "Fix bug #73825 - Heap out of bounds read on unserialize in finish_nested_data()",
    "before_after_code_files": [
      "ext/standard/tests/serialize/bug73825.phpt||ext/standard/tests/serialize/bug73825.phpt",
      "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
      "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
    ]
  },
  "patch_diff": {
    "ext/standard/tests/serialize/bug73825.phpt||ext/standard/tests/serialize/bug73825.phpt": [
      "File: ext/standard/tests/serialize/bug73825.phpt -> ext/standard/tests/serialize/bug73825.phpt",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: --TEST--",
      "2: Bug #73825 Heap out of bounds read on unserialize in finish_nested_data()",
      "3: --FILE--",
      "4: <?php",
      "5: $obj = unserialize('O:8:\"00000000\":');",
      "6: var_dump($obj);",
      "7: ?>",
      "8: --EXPECTF--",
      "9: Warning: Bad unserialize data in %sbug73825.php on line %d",
      "11: Notice: unserialize(): Error at offset 13 of 15 bytes in %sbug73825.php on line %d",
      "12: bool(false)",
      "",
      "---------------"
    ],
    "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
      "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "405: {",
      "406:  long elements;",
      "408:  elements = parse_iv2((*p) + 2, p);",
      "410:  (*p) += 2;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "408:  if( *p >= max - 2) {",
      "409:   zend_error(E_WARNING, \"Bad unserialize data\");",
      "410:   return -1;",
      "411:  }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "417:   zend_error(E_WARNING, \"Erroneous data format for unserializing '%s'\", ce->name);",
      "419:  }",
      "421:  return elements;",
      "",
      "[Removed Lines]",
      "418:   return 0;",
      "",
      "[Added Lines]",
      "423:   return -1;",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "496: {",
      "497:  YYCTYPE yych;",
      "498:  static const unsigned char yybm[] = {",
      "",
      "[Removed Lines]",
      "495: #line 496 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "500: #line 501 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "552:  yych = *(YYMARKER = ++YYCURSOR);",
      "553:  if (yych == ':') goto yy95;",
      "554: yy3:",
      "556:  { return 0; }",
      "558: yy4:",
      "559:  yych = *(YYMARKER = ++YYCURSOR);",
      "560:  if (yych == ':') goto yy89;",
      "",
      "[Removed Lines]",
      "555: #line 861 \"ext/standard/var_unserializer.re\"",
      "557: #line 558 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "560: #line 875 \"ext/standard/var_unserializer.re\"",
      "562: #line 563 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "597:  goto yy3;",
      "598: yy14:",
      "599:  ++YYCURSOR;",
      "601:  {",
      "603:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
      "605: }",
      "607: yy16:",
      "608:  yych = *++YYCURSOR;",
      "609:  goto yy3;",
      "",
      "[Removed Lines]",
      "600: #line 855 \"ext/standard/var_unserializer.re\"",
      "606: #line 607 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "605: #line 869 \"ext/standard/var_unserializer.re\"",
      "611: #line 612 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "634:  yych = *++YYCURSOR;",
      "635:  if (yych != '\"') goto yy18;",
      "636:  ++YYCURSOR;",
      "638:  {",
      "639:  size_t len, len2, len3, maxlen;",
      "640:  long elements;",
      "",
      "[Removed Lines]",
      "637: #line 708 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "642: #line 717 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "775:  elements = object_common1(UNSERIALIZE_PASSTHRU, ce);",
      "777:  if (incomplete_class) {",
      "778:   php_store_class_name(*rval, class_name, len2);",
      "779:  }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "782:  if (elements < 0) {",
      "783:     efree(class_name);",
      "784:     return 0;",
      "785:  }",
      "",
      "---------------",
      "--- Hunk 8 ---",
      "[Context before]",
      "782:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
      "783: }",
      "785: yy25:",
      "786:  yych = *++YYCURSOR;",
      "787:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "784: #line 785 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "794: #line 795 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 9 ---",
      "[Context before]",
      "806:  yych = *++YYCURSOR;",
      "807:  if (yych != '\"') goto yy18;",
      "808:  ++YYCURSOR;",
      "810:  {",
      "811:     if (!var_hash) return 0;",
      "813:  INIT_PZVAL(*rval);",
      "817: }",
      "819: yy32:",
      "820:  yych = *++YYCURSOR;",
      "821:  if (yych == '+') goto yy33;",
      "",
      "[Removed Lines]",
      "809: #line 699 \"ext/standard/var_unserializer.re\"",
      "815:  return object_common2(UNSERIALIZE_PASSTHRU,",
      "816:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
      "818: #line 819 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "819: #line 704 \"ext/standard/var_unserializer.re\"",
      "821:  long elements;",
      "826:  elements = object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR);",
      "827:  if (elements < 0) {",
      "828:   return 0;",
      "829:  }",
      "830:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
      "832: #line 833 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 10 ---",
      "[Context before]",
      "836:  yych = *++YYCURSOR;",
      "837:  if (yych != '{') goto yy18;",
      "838:  ++YYCURSOR;",
      "840:  {",
      "841:  long elements = parse_iv(start + 2);",
      "",
      "[Removed Lines]",
      "839: #line 678 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "853: #line 683 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 11 ---",
      "[Context before]",
      "858:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
      "859: }",
      "861: yy39:",
      "862:  yych = *++YYCURSOR;",
      "863:  if (yych == '+') goto yy40;",
      "",
      "[Removed Lines]",
      "860: #line 861 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "874: #line 875 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 12 ---",
      "[Context before]",
      "878:  yych = *++YYCURSOR;",
      "879:  if (yych != '\"') goto yy18;",
      "880:  ++YYCURSOR;",
      "882:  {",
      "883:  size_t len, maxlen;",
      "884:  char *str;",
      "",
      "[Removed Lines]",
      "881: #line 643 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "895: #line 648 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 13 ---",
      "[Context before]",
      "913:  ZVAL_STRINGL(*rval, str, len, 0);",
      "914:  return 1;",
      "915: }",
      "917: yy46:",
      "918:  yych = *++YYCURSOR;",
      "919:  if (yych == '+') goto yy47;",
      "",
      "[Removed Lines]",
      "916: #line 917 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "930: #line 931 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 14 ---",
      "[Context before]",
      "934:  yych = *++YYCURSOR;",
      "935:  if (yych != '\"') goto yy18;",
      "936:  ++YYCURSOR;",
      "938:  {",
      "939:  size_t len, maxlen;",
      "940:  char *str;",
      "",
      "[Removed Lines]",
      "937: #line 610 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "951: #line 615 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 15 ---",
      "[Context before]",
      "967:  ZVAL_STRINGL(*rval, str, len, 1);",
      "968:  return 1;",
      "969: }",
      "971: yy53:",
      "972:  yych = *++YYCURSOR;",
      "973:  if (yych <= '/') {",
      "",
      "[Removed Lines]",
      "970: #line 971 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "984: #line 985 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 16 ---",
      "[Context before]",
      "1055:  }",
      "1056: yy63:",
      "1057:  ++YYCURSOR;",
      "1059:  {",
      "1060: #if SIZEOF_LONG == 4",
      "1061: use_double:",
      "",
      "[Removed Lines]",
      "1058: #line 600 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1072: #line 605 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 17 ---",
      "[Context before]",
      "1065:  ZVAL_DOUBLE(*rval, zend_strtod((const char *)start + 2, NULL));",
      "1066:  return 1;",
      "1067: }",
      "1069: yy65:",
      "1070:  yych = *++YYCURSOR;",
      "1071:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1068: #line 1069 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1082: #line 1083 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 18 ---",
      "[Context before]",
      "1124:  yych = *++YYCURSOR;",
      "1125:  if (yych != ';') goto yy18;",
      "1126:  ++YYCURSOR;",
      "1128:  {",
      "1130:  INIT_PZVAL(*rval);",
      "",
      "[Removed Lines]",
      "1127: #line 585 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1141: #line 590 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 19 ---",
      "[Context before]",
      "1140:  return 1;",
      "1141: }",
      "1143: yy76:",
      "1144:  yych = *++YYCURSOR;",
      "1145:  if (yych == 'N') goto yy73;",
      "",
      "[Removed Lines]",
      "1142: #line 1143 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1156: #line 1157 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 20 ---",
      "[Context before]",
      "1166:  if (yych <= '9') goto yy79;",
      "1167:  if (yych != ';') goto yy18;",
      "1168:  ++YYCURSOR;",
      "1170:  {",
      "1171: #if SIZEOF_LONG == 4",
      "1172:  int digits = YYCURSOR - start - 3;",
      "",
      "[Removed Lines]",
      "1169: #line 558 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1183: #line 563 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 21 ---",
      "[Context before]",
      "1193:  ZVAL_LONG(*rval, parse_iv(start + 2));",
      "1194:  return 1;",
      "1195: }",
      "1197: yy83:",
      "1198:  yych = *++YYCURSOR;",
      "1199:  if (yych <= '/') goto yy18;",
      "",
      "[Removed Lines]",
      "1196: #line 1197 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1210: #line 1211 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 22 ---",
      "[Context before]",
      "1201:  yych = *++YYCURSOR;",
      "1202:  if (yych != ';') goto yy18;",
      "1203:  ++YYCURSOR;",
      "1205:  {",
      "1207:  INIT_PZVAL(*rval);",
      "1208:  ZVAL_BOOL(*rval, parse_iv(start + 2));",
      "1209:  return 1;",
      "1210: }",
      "1212: yy87:",
      "1213:  ++YYCURSOR;",
      "1215:  {",
      "1217:  INIT_PZVAL(*rval);",
      "1218:  ZVAL_NULL(*rval);",
      "1219:  return 1;",
      "1220: }",
      "1222: yy89:",
      "1223:  yych = *++YYCURSOR;",
      "1224:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1204: #line 551 \"ext/standard/var_unserializer.re\"",
      "1211: #line 1212 \"ext/standard/var_unserializer.c\"",
      "1214: #line 544 \"ext/standard/var_unserializer.re\"",
      "1221: #line 1222 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1218: #line 556 \"ext/standard/var_unserializer.re\"",
      "1225: #line 1226 \"ext/standard/var_unserializer.c\"",
      "1228: #line 549 \"ext/standard/var_unserializer.re\"",
      "1235: #line 1236 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 23 ---",
      "[Context before]",
      "1241:  if (yych <= '9') goto yy91;",
      "1242:  if (yych != ';') goto yy18;",
      "1243:  ++YYCURSOR;",
      "1245:  {",
      "1246:  long id;",
      "",
      "[Removed Lines]",
      "1244: #line 521 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1258: #line 526 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 24 ---",
      "[Context before]",
      "1265:  return 1;",
      "1266: }",
      "1268: yy95:",
      "1269:  yych = *++YYCURSOR;",
      "1270:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1267: #line 1268 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1281: #line 1282 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 25 ---",
      "[Context before]",
      "1287:  if (yych <= '9') goto yy97;",
      "1288:  if (yych != ';') goto yy18;",
      "1289:  ++YYCURSOR;",
      "1291:  {",
      "1292:  long id;",
      "",
      "[Removed Lines]",
      "1290: #line 500 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1304: #line 505 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 26 ---",
      "[Context before]",
      "1309:  return 1;",
      "1310: }",
      "1312: }",
      "1316:  return 0;",
      "",
      "[Removed Lines]",
      "1311: #line 1312 \"ext/standard/var_unserializer.c\"",
      "1313: #line 863 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1325: #line 1326 \"ext/standard/var_unserializer.c\"",
      "1327: #line 877 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------"
    ],
    "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
      "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
      "--- Hunk 1 ---",
      "[Context before]",
      "409: {",
      "410:  long elements;",
      "412:  elements = parse_iv2((*p) + 2, p);",
      "414:  (*p) += 2;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "412:  if( *p >= max - 2) {",
      "413:   zend_error(E_WARNING, \"Bad unserialize data\");",
      "414:   return -1;",
      "415:  }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "421:   zend_error(E_WARNING, \"Erroneous data format for unserializing '%s'\", ce->name);",
      "423:  }",
      "425:  return elements;",
      "",
      "[Removed Lines]",
      "422:   return 0;",
      "",
      "[Added Lines]",
      "427:   return -1;",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "697: }",
      "699: \"o:\" iv \":\" [\"] {",
      "700:     if (!var_hash) return 0;",
      "702:  INIT_PZVAL(*rval);",
      "706: }",
      "708: object \":\" uiv \":\" [\"] {",
      "",
      "[Removed Lines]",
      "704:  return object_common2(UNSERIALIZE_PASSTHRU,",
      "705:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
      "",
      "[Added Lines]",
      "705:  long elements;",
      "710:  elements = object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR);",
      "711:  if (elements < 0) {",
      "712:   return 0;",
      "713:  }",
      "714:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "845:  elements = object_common1(UNSERIALIZE_PASSTHRU, ce);",
      "847:  if (incomplete_class) {",
      "848:   php_store_class_name(*rval, class_name, len2);",
      "849:  }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "856:  if (elements < 0) {",
      "857:     efree(class_name);",
      "858:     return 0;",
      "859:  }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "aeb30576f6e6f4458c922a5c7ac15ec1a25625f9",
      "candidate_info": {
        "commit_hash": "aeb30576f6e6f4458c922a5c7ac15ec1a25625f9",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/aeb30576f6e6f4458c922a5c7ac15ec1a25625f9",
        "files": [
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re",
          "standard/tests/serialize/bug68545.phpt"
        ],
        "message": "Merge branch 'PHP-5.6'\n\n* PHP-5.6:\n  updated NEWS\n  Fixed bug #68545 NULL pointer dereference in unserialize.c\n  Updated NEWS\n  Updated NEWS\n\nConflicts:\n\text/standard/var_unserializer.c\n\text/standard/var_unserializer.re",
        "before_after_code_files": [
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re",
          "standard/tests/serialize/bug68545.phpt||standard/tests/serialize/bug68545.phpt"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "67: PHPAPI void var_push_dtor(php_unserialize_data_t *var_hashx, zval *rval)",
          "68: {",
          "70: #if VAR_ENTRIES_DBG",
          "71:  fprintf(stderr, \"var_push_dtor(%ld): %d\\n\", var_hash?var_hash->used_slots:-1L, Z_TYPE_PP(rval));",
          "72: #endif",
          "",
          "[Removed Lines]",
          "69:  var_dtor_entries *var_hash = (*var_hashx)->last_dtor;",
          "",
          "[Added Lines]",
          "69:  var_dtor_entries *var_hash;",
          "71:  if (!var_hashx || !*var_hashx) {",
          "72:   return;",
          "73:  }",
          "75:  var_hash = (*var_hashx)->last_dtor;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "253: #define YYMARKER marker",
          "",
          "[Removed Lines]",
          "256: #line 261 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "262: #line 267 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "509:  start = cursor;",
          "513: {",
          "514:  YYCTYPE yych;",
          "515:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "512: #line 513 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "518: #line 519 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "569:  yych = *(YYMARKER = ++YYCURSOR);",
          "570:  if (yych == ':') goto yy95;",
          "571: yy3:",
          "573:  { return 0; }",
          "575: yy4:",
          "576:  yych = *(YYMARKER = ++YYCURSOR);",
          "577:  if (yych == ':') goto yy89;",
          "",
          "[Removed Lines]",
          "572: #line 860 \"ext/standard/var_unserializer.re\"",
          "574: #line 575 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "578: #line 866 \"ext/standard/var_unserializer.re\"",
          "580: #line 581 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "614:  goto yy3;",
          "615: yy14:",
          "616:  ++YYCURSOR;",
          "618:  {",
          "620:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
          "622: }",
          "624: yy16:",
          "625:  yych = *++YYCURSOR;",
          "626:  goto yy3;",
          "",
          "[Removed Lines]",
          "617: #line 854 \"ext/standard/var_unserializer.re\"",
          "623: #line 624 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "623: #line 860 \"ext/standard/var_unserializer.re\"",
          "629: #line 630 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "646:  if (yybm[0+yych] & 128) {",
          "647:   goto yy20;",
          "648:  }",
          "651:  yych = *++YYCURSOR;",
          "652:  if (yych != '\"') goto yy18;",
          "653:  ++YYCURSOR;",
          "655:  {",
          "656:  size_t len, len2, len3, maxlen;",
          "657:  zend_long elements;",
          "",
          "[Removed Lines]",
          "649:  if (yych <= '/') goto yy18;",
          "650:  if (yych >= ';') goto yy18;",
          "654: #line 709 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "655:  if (yych != ':') goto yy18;",
          "659: #line 715 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "797:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "798: }",
          "800: yy25:",
          "801:  yych = *++YYCURSOR;",
          "802:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "799: #line 800 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "804: #line 805 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "821:  yych = *++YYCURSOR;",
          "822:  if (yych != '\"') goto yy18;",
          "823:  ++YYCURSOR;",
          "825:  {",
          "",
          "[Removed Lines]",
          "824: #line 701 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "829: #line 707 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "829:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "830:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "831: }",
          "833: yy32:",
          "834:  yych = *++YYCURSOR;",
          "835:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "832: #line 833 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "837: #line 838 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "850:  yych = *++YYCURSOR;",
          "851:  if (yych != '{') goto yy18;",
          "852:  ++YYCURSOR;",
          "854:  {",
          "855:  zend_long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "853: #line 680 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "858: #line 686 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "872:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "873: }",
          "875: yy39:",
          "876:  yych = *++YYCURSOR;",
          "877:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "874: #line 875 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "879: #line 880 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "892:  yych = *++YYCURSOR;",
          "893:  if (yych != '\"') goto yy18;",
          "894:  ++YYCURSOR;",
          "896:  {",
          "897:  size_t len, maxlen;",
          "898:  zend_string *str;",
          "",
          "[Removed Lines]",
          "895: #line 652 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "900: #line 658 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "920:  ZVAL_STR(rval, str);",
          "921:  return 1;",
          "922: }",
          "924: yy46:",
          "925:  yych = *++YYCURSOR;",
          "926:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "923: #line 924 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "928: #line 929 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "941:  yych = *++YYCURSOR;",
          "942:  if (yych != '\"') goto yy18;",
          "943:  ++YYCURSOR;",
          "945:  {",
          "946:  size_t len, maxlen;",
          "947:  char *str;",
          "",
          "[Removed Lines]",
          "944: #line 625 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "949: #line 631 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "968:  ZVAL_STRINGL(rval, str, len);",
          "969:  return 1;",
          "970: }",
          "972: yy53:",
          "973:  yych = *++YYCURSOR;",
          "974:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "971: #line 972 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "976: #line 977 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1056:  }",
          "1057: yy63:",
          "1058:  ++YYCURSOR;",
          "1060:  {",
          "1061: #if SIZEOF_ZEND_LONG == 4",
          "1062: use_double:",
          "",
          "[Removed Lines]",
          "1059: #line 616 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1064: #line 622 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1065:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1066:  return 1;",
          "1067: }",
          "1069: yy65:",
          "1070:  yych = *++YYCURSOR;",
          "1071:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1068: #line 1069 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1073: #line 1074 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "1124:  yych = *++YYCURSOR;",
          "1125:  if (yych != ';') goto yy18;",
          "1126:  ++YYCURSOR;",
          "1128:  {",
          "",
          "[Removed Lines]",
          "1127: #line 600 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1132: #line 606 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1141:  return 1;",
          "1142: }",
          "1144: yy76:",
          "1145:  yych = *++YYCURSOR;",
          "1146:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1143: #line 1144 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1148: #line 1149 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1167:  if (yych <= '9') goto yy79;",
          "1168:  if (yych != ';') goto yy18;",
          "1169:  ++YYCURSOR;",
          "1171:  {",
          "1172: #if SIZEOF_ZEND_LONG == 4",
          "1173:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1170: #line 574 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1175: #line 580 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "1193:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1194:  return 1;",
          "1195: }",
          "1197: yy83:",
          "1198:  yych = *++YYCURSOR;",
          "1199:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1196: #line 1197 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1201: #line 1202 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "1201:  yych = *++YYCURSOR;",
          "1202:  if (yych != ';') goto yy18;",
          "1203:  ++YYCURSOR;",
          "1205:  {",
          "1207:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1208:  return 1;",
          "1209: }",
          "1211: yy87:",
          "1212:  ++YYCURSOR;",
          "1214:  {",
          "1216:  ZVAL_NULL(rval);",
          "1217:  return 1;",
          "1218: }",
          "1220: yy89:",
          "1221:  yych = *++YYCURSOR;",
          "1222:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1204: #line 568 \"ext/standard/var_unserializer.re\"",
          "1210: #line 1211 \"ext/standard/var_unserializer.c\"",
          "1213: #line 562 \"ext/standard/var_unserializer.re\"",
          "1219: #line 1220 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1209: #line 574 \"ext/standard/var_unserializer.re\"",
          "1215: #line 1216 \"ext/standard/var_unserializer.c\"",
          "1218: #line 568 \"ext/standard/var_unserializer.re\"",
          "1224: #line 1225 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "1239:  if (yych <= '9') goto yy91;",
          "1240:  if (yych != ';') goto yy18;",
          "1241:  ++YYCURSOR;",
          "1243:  {",
          "1244:  zend_long id;",
          "",
          "[Removed Lines]",
          "1242: #line 539 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1247: #line 545 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "1263:  return 1;",
          "1264: }",
          "1266: yy95:",
          "1267:  yych = *++YYCURSOR;",
          "1268:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1265: #line 1266 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1270: #line 1271 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 25 ---",
          "[Context before]",
          "1285:  if (yych <= '9') goto yy97;",
          "1286:  if (yych != ';') goto yy18;",
          "1287:  ++YYCURSOR;",
          "1289:  {",
          "1290:  zend_long id;",
          "",
          "[Removed Lines]",
          "1288: #line 517 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1293: #line 523 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 26 ---",
          "[Context before]",
          "1308:  return 1;",
          "1309: }",
          "1311: }",
          "1315:  return 0;",
          "",
          "[Removed Lines]",
          "1310: #line 1311 \"ext/standard/var_unserializer.c\"",
          "1312: #line 862 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1315: #line 1316 \"ext/standard/var_unserializer.c\"",
          "1317: #line 868 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "65: PHPAPI void var_push_dtor(php_unserialize_data_t *var_hashx, zval *rval)",
          "66: {",
          "68: #if VAR_ENTRIES_DBG",
          "69:  fprintf(stderr, \"var_push_dtor(%ld): %d\\n\", var_hash?var_hash->used_slots:-1L, Z_TYPE_PP(rval));",
          "70: #endif",
          "",
          "[Removed Lines]",
          "67:  var_dtor_entries *var_hash = (*var_hashx)->last_dtor;",
          "",
          "[Added Lines]",
          "67:  var_dtor_entries *var_hash;",
          "69:  if (!var_hashx || !*var_hashx) {",
          "70:   return;",
          "71:  }",
          "73:  var_hash = (*var_hashx)->last_dtor;",
          "",
          "---------------"
        ],
        "standard/tests/serialize/bug68545.phpt||standard/tests/serialize/bug68545.phpt": [
          "File: standard/tests/serialize/bug68545.phpt -> standard/tests/serialize/bug68545.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #68545 NULL pointer dereference in unserialize.c:var_push_dtor",
          "3: --FILE--",
          "4: <?php",
          "5: var_dump(unserialize('a:6:{a:6:{s:3:\"322\";s:3:\"bar\";s:3:\"bar\";s:3:\"foo\";a:6:{a:6:{s:3:\"322\";s:3:\"bar\";s:3:\"bar\";s:3:\"foo\";s:3:\"bar\";a:6:{a:6:{s:3:\"322\";s:3:\"bar\";s:3:\"bar\";s:3:\"foo\";a:6:{a:6:{s:3:\"322\";s:3:\"bar\";s:3:\"b22\";s:3:\"bar\";s:3:\"bar\";s:3:\"foo\";s:3:\"bar\";a:6:{a:6:{s:3:\"322\";s:3:\"bar\";s:3:\"bar\";s:3:\"foo\";s:3:\"bar\";s:3:\"bar\";'));",
          "6: ?>",
          "7: ===DONE===",
          "8: --EXPECTF--",
          "9: Notice: unserialize(): Error at offset %d of %d bytes in %sbug68545.php on line %d",
          "10: bool(false)",
          "11: ===DONE===",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "6a6cdecbdbe0846451eaee38f7bc55a81c651d80",
      "candidate_info": {
        "commit_hash": "6a6cdecbdbe0846451eaee38f7bc55a81c651d80",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/6a6cdecbdbe0846451eaee38f7bc55a81c651d80",
        "files": [
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Improved unserialize()",
        "before_after_code_files": [
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "322: #define UNSERIALIZE_PARAMETER zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash, HashTable *classes",
          "323: #define UNSERIALIZE_PASSTHRU rval, p, max, var_hash, classes",
          "326: {",
          "327:  while (elements-- > 0) {",
          "328:   zval key, *data, d, *old_data;",
          "330:   ZVAL_UNDEF(&key);",
          "",
          "[Removed Lines]",
          "325: static inline int process_nested_data(UNSERIALIZE_PARAMETER, HashTable *ht, zend_long elements, int objprops)",
          "",
          "[Added Lines]",
          "325: static zend_always_inline int process_nested_data(UNSERIALIZE_PARAMETER, HashTable *ht, zend_long elements, int objprops)",
          "329:   zend_ulong idx;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "334:    return 0;",
          "335:   }",
          "342:   data = NULL;",
          "343:   ZVAL_UNDEF(&d);",
          "345:   if (!objprops) {",
          "350:      var_push_dtor(var_hash, old_data);",
          "351:     }",
          "357:      var_push_dtor(var_hash, old_data);",
          "358:     }",
          "361:    }",
          "362:   } else {",
          "368:     }",
          "372:   }",
          "374:   zval_dtor(&key);",
          "",
          "[Removed Lines]",
          "337:   if (Z_TYPE(key) != IS_LONG && Z_TYPE(key) != IS_STRING) {",
          "338:    zval_dtor(&key);",
          "339:    return 0;",
          "340:   }",
          "346:    switch (Z_TYPE(key)) {",
          "347:    case IS_LONG:",
          "348:     if ((old_data = zend_hash_index_find(ht, Z_LVAL(key))) != NULL) {",
          "352:     data = zend_hash_index_update(ht, Z_LVAL(key), &d);",
          "353:     break;",
          "354:    case IS_STRING:",
          "355:     if ((old_data = zend_symtable_find(ht, Z_STR(key))) != NULL) {",
          "359:     data = zend_symtable_update(ht, Z_STR(key), &d);",
          "360:     break;",
          "364:    convert_to_string(&key);",
          "365:    if ((old_data = zend_hash_find(ht, Z_STR(key))) != NULL) {",
          "366:     if (Z_TYPE_P(old_data) == IS_INDIRECT) {",
          "367:      old_data = Z_INDIRECT_P(old_data);",
          "369:     var_push_dtor(var_hash, old_data);",
          "370:    }",
          "371:    data = zend_hash_update_ind(ht, Z_STR(key), &d);",
          "",
          "[Added Lines]",
          "342:    if (Z_TYPE(key) == IS_LONG) {",
          "343:     idx = Z_LVAL(key);",
          "344: numeric_key:",
          "345:     if (UNEXPECTED((old_data = zend_hash_index_find(ht, idx)) != NULL)) {",
          "348:      data = zend_hash_index_update(ht, idx, &d);",
          "349:     } else {",
          "350:      data = zend_hash_index_add_new(ht, idx, &d);",
          "351:     }",
          "352:    } else if (Z_TYPE(key) == IS_STRING) {",
          "353:     if (UNEXPECTED(ZEND_HANDLE_NUMERIC(Z_STR(key), idx))) {",
          "354:      goto numeric_key;",
          "356:     if (UNEXPECTED((old_data = zend_hash_find(ht, Z_STR(key))) != NULL)) {",
          "359:      data = zend_hash_update(ht, Z_STR(key), &d);",
          "360:     } else {",
          "361:      data = zend_hash_add_new(ht, Z_STR(key), &d);",
          "363:    } else {",
          "364:     zval_dtor(&key);",
          "365:     return 0;",
          "368:    if (EXPECTED(Z_TYPE(key) == IS_STRING)) {",
          "369: string_key:",
          "370:     if ((old_data = zend_hash_find(ht, Z_STR(key))) != NULL) {",
          "371:      if (Z_TYPE_P(old_data) == IS_INDIRECT) {",
          "372:       old_data = Z_INDIRECT_P(old_data);",
          "373:      }",
          "374:      var_push_dtor(var_hash, old_data);",
          "375:      data = zend_hash_update_ind(ht, Z_STR(key), &d);",
          "376:     } else {",
          "377:      data = zend_hash_add_new(ht, Z_STR(key), &d);",
          "379:    } else if (Z_TYPE(key) == IS_LONG) {",
          "381:     convert_to_string(&key);",
          "382:     goto string_key;",
          "383:    } else {",
          "384:     zval_dtor(&key);",
          "385:     return 0;",
          "386:    }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "507:  start = cursor;",
          "511: {",
          "512:  YYCTYPE yych;",
          "513:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "510: #line 511 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "525: #line 526 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "567:  yych = *(YYMARKER = ++YYCURSOR);",
          "568:  if (yych == ':') goto yy95;",
          "569: yy3:",
          "571:  { return 0; }",
          "573: yy4:",
          "574:  yych = *(YYMARKER = ++YYCURSOR);",
          "575:  if (yych == ':') goto yy89;",
          "",
          "[Removed Lines]",
          "570: #line 858 \"ext/standard/var_unserializer.re\"",
          "572: #line 573 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "585: #line 873 \"ext/standard/var_unserializer.re\"",
          "587: #line 588 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "612:  goto yy3;",
          "613: yy14:",
          "614:  ++YYCURSOR;",
          "616:  {",
          "618:  php_error_docref(NULL, E_NOTICE, \"Unexpected end of serialized data\");",
          "620: }",
          "622: yy16:",
          "623:  yych = *++YYCURSOR;",
          "624:  goto yy3;",
          "",
          "[Removed Lines]",
          "615: #line 852 \"ext/standard/var_unserializer.re\"",
          "621: #line 622 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "630: #line 867 \"ext/standard/var_unserializer.re\"",
          "636: #line 637 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "644:  if (yybm[0+yych] & 128) {",
          "645:   goto yy20;",
          "646:  }",
          "649:  yych = *++YYCURSOR;",
          "650:  if (yych != '\"') goto yy18;",
          "651:  ++YYCURSOR;",
          "653:  {",
          "654:  size_t len, len2, len3, maxlen;",
          "655:  zend_long elements;",
          "",
          "[Removed Lines]",
          "647:  if (yych <= '/') goto yy18;",
          "648:  if (yych >= ';') goto yy18;",
          "652: #line 707 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "662:  if (yych != ':') goto yy18;",
          "666: #line 722 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "795:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "796: }",
          "798: yy25:",
          "799:  yych = *++YYCURSOR;",
          "800:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "797: #line 798 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "811: #line 812 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "819:  yych = *++YYCURSOR;",
          "820:  if (yych != '\"') goto yy18;",
          "821:  ++YYCURSOR;",
          "823:  {",
          "",
          "[Removed Lines]",
          "822: #line 699 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "836: #line 714 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "827:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "828:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "829: }",
          "831: yy32:",
          "832:  yych = *++YYCURSOR;",
          "833:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "830: #line 831 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "844: #line 845 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "848:  yych = *++YYCURSOR;",
          "849:  if (yych != '{') goto yy18;",
          "850:  ++YYCURSOR;",
          "852:  {",
          "853:  zend_long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "851: #line 678 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "865: #line 693 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "870:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "871: }",
          "873: yy39:",
          "874:  yych = *++YYCURSOR;",
          "875:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "872: #line 873 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "886: #line 887 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "890:  yych = *++YYCURSOR;",
          "891:  if (yych != '\"') goto yy18;",
          "892:  ++YYCURSOR;",
          "894:  {",
          "895:  size_t len, maxlen;",
          "896:  zend_string *str;",
          "",
          "[Removed Lines]",
          "893: #line 650 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "907: #line 665 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "918:  ZVAL_STR(rval, str);",
          "919:  return 1;",
          "920: }",
          "922: yy46:",
          "923:  yych = *++YYCURSOR;",
          "924:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "921: #line 922 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "935: #line 936 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "939:  yych = *++YYCURSOR;",
          "940:  if (yych != '\"') goto yy18;",
          "941:  ++YYCURSOR;",
          "943:  {",
          "944:  size_t len, maxlen;",
          "945:  char *str;",
          "",
          "[Removed Lines]",
          "942: #line 623 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "956: #line 638 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "966:  ZVAL_STRINGL(rval, str, len);",
          "967:  return 1;",
          "968: }",
          "970: yy53:",
          "971:  yych = *++YYCURSOR;",
          "972:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "969: #line 970 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "983: #line 984 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1054:  }",
          "1055: yy63:",
          "1056:  ++YYCURSOR;",
          "1058:  {",
          "1059: #if SIZEOF_ZEND_LONG == 4",
          "1060: use_double:",
          "",
          "[Removed Lines]",
          "1057: #line 614 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1071: #line 629 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1063:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1064:  return 1;",
          "1065: }",
          "1067: yy65:",
          "1068:  yych = *++YYCURSOR;",
          "1069:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1066: #line 1067 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1080: #line 1081 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "1122:  yych = *++YYCURSOR;",
          "1123:  if (yych != ';') goto yy18;",
          "1124:  ++YYCURSOR;",
          "1126:  {",
          "",
          "[Removed Lines]",
          "1125: #line 598 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1139: #line 613 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1139:  return 1;",
          "1140: }",
          "1142: yy76:",
          "1143:  yych = *++YYCURSOR;",
          "1144:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1141: #line 1142 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1155: #line 1156 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1165:  if (yych <= '9') goto yy79;",
          "1166:  if (yych != ';') goto yy18;",
          "1167:  ++YYCURSOR;",
          "1169:  {",
          "1170: #if SIZEOF_ZEND_LONG == 4",
          "1171:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1168: #line 572 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1182: #line 587 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "1191:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1192:  return 1;",
          "1193: }",
          "1195: yy83:",
          "1196:  yych = *++YYCURSOR;",
          "1197:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1194: #line 1195 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1208: #line 1209 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "1199:  yych = *++YYCURSOR;",
          "1200:  if (yych != ';') goto yy18;",
          "1201:  ++YYCURSOR;",
          "1203:  {",
          "1205:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1206:  return 1;",
          "1207: }",
          "1209: yy87:",
          "1210:  ++YYCURSOR;",
          "1212:  {",
          "1214:  ZVAL_NULL(rval);",
          "1215:  return 1;",
          "1216: }",
          "1218: yy89:",
          "1219:  yych = *++YYCURSOR;",
          "1220:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1202: #line 566 \"ext/standard/var_unserializer.re\"",
          "1208: #line 1209 \"ext/standard/var_unserializer.c\"",
          "1211: #line 560 \"ext/standard/var_unserializer.re\"",
          "1217: #line 1218 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1216: #line 581 \"ext/standard/var_unserializer.re\"",
          "1222: #line 1223 \"ext/standard/var_unserializer.c\"",
          "1225: #line 575 \"ext/standard/var_unserializer.re\"",
          "1231: #line 1232 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "1237:  if (yych <= '9') goto yy91;",
          "1238:  if (yych != ';') goto yy18;",
          "1239:  ++YYCURSOR;",
          "1241:  {",
          "1242:  zend_long id;",
          "",
          "[Removed Lines]",
          "1240: #line 537 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1254: #line 552 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "1261:  return 1;",
          "1262: }",
          "1264: yy95:",
          "1265:  yych = *++YYCURSOR;",
          "1266:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1263: #line 1264 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1277: #line 1278 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 25 ---",
          "[Context before]",
          "1283:  if (yych <= '9') goto yy97;",
          "1284:  if (yych != ';') goto yy18;",
          "1285:  ++YYCURSOR;",
          "1287:  {",
          "1288:  zend_long id;",
          "",
          "[Removed Lines]",
          "1286: #line 515 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1300: #line 530 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 26 ---",
          "[Context before]",
          "1306:  return 1;",
          "1307: }",
          "1309: }",
          "1313:  return 0;",
          "",
          "[Removed Lines]",
          "1308: #line 1309 \"ext/standard/var_unserializer.c\"",
          "1310: #line 860 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1322: #line 1323 \"ext/standard/var_unserializer.c\"",
          "1324: #line 875 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "326: #define UNSERIALIZE_PARAMETER zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash, HashTable *classes",
          "327: #define UNSERIALIZE_PASSTHRU rval, p, max, var_hash, classes",
          "330: {",
          "331:  while (elements-- > 0) {",
          "332:   zval key, *data, d, *old_data;",
          "334:   ZVAL_UNDEF(&key);",
          "",
          "[Removed Lines]",
          "329: static inline int process_nested_data(UNSERIALIZE_PARAMETER, HashTable *ht, zend_long elements, int objprops)",
          "",
          "[Added Lines]",
          "329: static zend_always_inline int process_nested_data(UNSERIALIZE_PARAMETER, HashTable *ht, zend_long elements, int objprops)",
          "333:   zend_ulong idx;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "338:    return 0;",
          "339:   }",
          "346:   data = NULL;",
          "347:   ZVAL_UNDEF(&d);",
          "349:   if (!objprops) {",
          "354:      var_push_dtor(var_hash, old_data);",
          "355:     }",
          "361:      var_push_dtor(var_hash, old_data);",
          "362:     }",
          "365:    }",
          "366:   } else {",
          "372:     }",
          "376:   }",
          "378:   zval_dtor(&key);",
          "",
          "[Removed Lines]",
          "341:   if (Z_TYPE(key) != IS_LONG && Z_TYPE(key) != IS_STRING) {",
          "342:    zval_dtor(&key);",
          "343:    return 0;",
          "344:   }",
          "350:    switch (Z_TYPE(key)) {",
          "351:    case IS_LONG:",
          "352:     if ((old_data = zend_hash_index_find(ht, Z_LVAL(key))) != NULL) {",
          "356:     data = zend_hash_index_update(ht, Z_LVAL(key), &d);",
          "357:     break;",
          "358:    case IS_STRING:",
          "359:     if ((old_data = zend_symtable_find(ht, Z_STR(key))) != NULL) {",
          "363:     data = zend_symtable_update(ht, Z_STR(key), &d);",
          "364:     break;",
          "368:    convert_to_string(&key);",
          "369:    if ((old_data = zend_hash_find(ht, Z_STR(key))) != NULL) {",
          "370:     if (Z_TYPE_P(old_data) == IS_INDIRECT) {",
          "371:      old_data = Z_INDIRECT_P(old_data);",
          "373:     var_push_dtor(var_hash, old_data);",
          "374:    }",
          "375:    data = zend_hash_update_ind(ht, Z_STR(key), &d);",
          "",
          "[Added Lines]",
          "346:    if (Z_TYPE(key) == IS_LONG) {",
          "347:     idx = Z_LVAL(key);",
          "348: numeric_key:",
          "349:     if (UNEXPECTED((old_data = zend_hash_index_find(ht, idx)) != NULL)) {",
          "352:      data = zend_hash_index_update(ht, idx, &d);",
          "353:     } else {",
          "354:      data = zend_hash_index_add_new(ht, idx, &d);",
          "356:    } else if (Z_TYPE(key) == IS_STRING) {",
          "357:     if (UNEXPECTED(ZEND_HANDLE_NUMERIC(Z_STR(key), idx))) {",
          "358:      goto numeric_key;",
          "359:     }",
          "360:     if (UNEXPECTED((old_data = zend_hash_find(ht, Z_STR(key))) != NULL)) {",
          "363:      data = zend_hash_update(ht, Z_STR(key), &d);",
          "364:     } else {",
          "365:      data = zend_hash_add_new(ht, Z_STR(key), &d);",
          "367:    } else {",
          "368:     zval_dtor(&key);",
          "369:     return 0;",
          "372:    if (EXPECTED(Z_TYPE(key) == IS_STRING)) {",
          "373: string_key:",
          "374:     if ((old_data = zend_hash_find(ht, Z_STR(key))) != NULL) {",
          "375:      if (Z_TYPE_P(old_data) == IS_INDIRECT) {",
          "376:       old_data = Z_INDIRECT_P(old_data);",
          "377:      }",
          "378:      var_push_dtor(var_hash, old_data);",
          "379:      data = zend_hash_update_ind(ht, Z_STR(key), &d);",
          "380:     } else {",
          "381:      data = zend_hash_add_new(ht, Z_STR(key), &d);",
          "383:    } else if (Z_TYPE(key) == IS_LONG) {",
          "385:     convert_to_string(&key);",
          "386:     goto string_key;",
          "387:    } else {",
          "388:     zval_dtor(&key);",
          "389:     return 0;",
          "390:    }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "2c567eae283308bbc1cb9836546b8dbf0146932c",
      "candidate_info": {
        "commit_hash": "2c567eae283308bbc1cb9836546b8dbf0146932c",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/2c567eae283308bbc1cb9836546b8dbf0146932c",
        "files": [
          "ext/standard/tests/serialize/bug74101.phpt",
          "ext/standard/tests/serialize/bug74614.phpt",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Merge branch 'PHP-7.0' into PHP-7.1\n\n* PHP-7.0:\n  Fixed bug #74101 and bug #74614",
        "before_after_code_files": [
          "ext/standard/tests/serialize/bug74101.phpt||ext/standard/tests/serialize/bug74101.phpt",
          "ext/standard/tests/serialize/bug74614.phpt||ext/standard/tests/serialize/bug74614.phpt",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/tests/serialize/bug74101.phpt||ext/standard/tests/serialize/bug74101.phpt": [
          "File: ext/standard/tests/serialize/bug74101.phpt -> ext/standard/tests/serialize/bug74101.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #74101: Unserialize Heap Use-After-Free (READ: 1) in zval_get_type",
          "3: --FILE--",
          "4: <?php",
          "5: $s = 'O:9:\"Exception\":799999999999999999999999999997:0i:0;a:0:{}i:2;i:0;i:0;R:2;';",
          "6: var_dump(unserialize($s));",
          "7: ?>",
          "8: --EXPECTF--",
          "9: Notice: unserialize(): Error at offset 48 of 74 bytes in %s on line %d",
          "10: bool(false)",
          "",
          "---------------"
        ],
        "ext/standard/tests/serialize/bug74614.phpt||ext/standard/tests/serialize/bug74614.phpt": [
          "File: ext/standard/tests/serialize/bug74614.phpt -> ext/standard/tests/serialize/bug74614.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #74614: Use-after-free in PHP7's unserialize()",
          "3: --FILE--",
          "4: <?php",
          "6: unserialize('a:3020000000000000000000000000000001:{i:0;a:0:{}i:1;i:2;i:2;i:3;i:3;i:4;i:4;i:5;i:5;i:6;i:6;i:7;i:7;i:8;i:8;R:2;}');",
          "8: ?>",
          "9: --EXPECTF--",
          "10: Notice: unserialize(): Error at offset 38 of 113 bytes in %s on line %d",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "548:   && zend_hash_str_exists(&Z_OBJCE_P(rval)->function_table, \"__wakeup\", sizeof(\"__wakeup\")-1);",
          "550:  ht = Z_OBJPROP_P(rval);",
          "551:  zend_hash_extend(ht, zend_hash_num_elements(ht) + elements, (ht->u.flags & HASH_FLAG_PACKED));",
          "552:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, ht, elements, 1)) {",
          "553:   if (has_wakeup) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "551:  if (elements >= HT_MAX_SIZE - zend_hash_num_elements(ht)) {",
          "552:   return 0;",
          "553:  }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "617:  start = cursor;",
          "621: {",
          "622:  YYCTYPE yych;",
          "623:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "620: #line 621 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "624: #line 625 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "675: yy2:",
          "676:  ++YYCURSOR;",
          "677: yy3:",
          "679:  { return 0; }",
          "681: yy4:",
          "682:  yych = *(YYMARKER = ++YYCURSOR);",
          "683:  if (yych == ':') goto yy17;",
          "",
          "[Removed Lines]",
          "678: #line 998 \"ext/standard/var_unserializer.re\"",
          "680: #line 681 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "682: #line 1002 \"ext/standard/var_unserializer.re\"",
          "684: #line 685 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "724:  goto yy3;",
          "725: yy15:",
          "726:  ++YYCURSOR;",
          "728:  {",
          "730:  php_error_docref(NULL, E_NOTICE, \"Unexpected end of serialized data\");",
          "732: }",
          "734: yy17:",
          "735:  yych = *++YYCURSOR;",
          "736:  if (yybm[0+yych] & 128) {",
          "",
          "[Removed Lines]",
          "727: #line 992 \"ext/standard/var_unserializer.re\"",
          "733: #line 734 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "731: #line 996 \"ext/standard/var_unserializer.re\"",
          "737: #line 738 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "742:  goto yy3;",
          "743: yy19:",
          "744:  ++YYCURSOR;",
          "746:  {",
          "748:  ZVAL_NULL(rval);",
          "749:  return 1;",
          "750: }",
          "752: yy21:",
          "753:  yych = *++YYCURSOR;",
          "754:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "745: #line 676 \"ext/standard/var_unserializer.re\"",
          "751: #line 752 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "749: #line 680 \"ext/standard/var_unserializer.re\"",
          "755: #line 756 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "998:  goto yy18;",
          "999: yy63:",
          "1000:  ++YYCURSOR;",
          "1002:  {",
          "1003:  zend_long id;",
          "",
          "[Removed Lines]",
          "1001: #line 625 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1005: #line 629 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "1025:  return 1;",
          "1026: }",
          "1028: yy65:",
          "1029:  yych = *++YYCURSOR;",
          "1030:  if (yych == '\"') goto yy84;",
          "",
          "[Removed Lines]",
          "1027: #line 1028 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1031: #line 1032 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "1035:  goto yy18;",
          "1036: yy67:",
          "1037:  ++YYCURSOR;",
          "1039:  {",
          "1041:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1042:  return 1;",
          "1043: }",
          "1045: yy69:",
          "1046:  ++YYCURSOR;",
          "1047:  if ((YYLIMIT - YYCURSOR) < 4) YYFILL(4);",
          "",
          "[Removed Lines]",
          "1038: #line 682 \"ext/standard/var_unserializer.re\"",
          "1044: #line 1045 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1042: #line 686 \"ext/standard/var_unserializer.re\"",
          "1048: #line 1049 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "1061:  }",
          "1062: yy71:",
          "1063:  ++YYCURSOR;",
          "1065:  {",
          "1066: #if SIZEOF_ZEND_LONG == 4",
          "1067: use_double:",
          "",
          "[Removed Lines]",
          "1064: #line 730 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1068: #line 734 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "1070:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1071:  return 1;",
          "1072: }",
          "1074: yy73:",
          "1075:  yych = *++YYCURSOR;",
          "1076:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1073: #line 1074 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1077: #line 1078 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "1092:  goto yy18;",
          "1093: yy76:",
          "1094:  ++YYCURSOR;",
          "1096:  {",
          "1097: #if SIZEOF_ZEND_LONG == 4",
          "1098:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1095: #line 688 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1099: #line 692 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "1118:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1119:  return 1;",
          "1120: }",
          "1122: yy78:",
          "1123:  yych = *++YYCURSOR;",
          "1124:  if (yych == '\"') goto yy92;",
          "1125:  goto yy18;",
          "1126: yy79:",
          "1127:  ++YYCURSOR;",
          "1129:  {",
          "1130:  zend_long id;",
          "",
          "[Removed Lines]",
          "1121: #line 1122 \"ext/standard/var_unserializer.c\"",
          "1128: #line 651 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1125: #line 1126 \"ext/standard/var_unserializer.c\"",
          "1132: #line 655 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "1151:  return 1;",
          "1152: }",
          "1154: yy81:",
          "1155:  yych = *++YYCURSOR;",
          "1156:  if (yych == '\"') goto yy94;",
          "1157:  goto yy18;",
          "1158: yy82:",
          "1159:  ++YYCURSOR;",
          "1161:  {",
          "1162:  size_t len, len2, len3, maxlen;",
          "1163:  zend_long elements;",
          "",
          "[Removed Lines]",
          "1153: #line 1154 \"ext/standard/var_unserializer.c\"",
          "1160: #line 840 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1157: #line 1158 \"ext/standard/var_unserializer.c\"",
          "1164: #line 844 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "1310:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "1311: }",
          "1313: yy84:",
          "1314:  ++YYCURSOR;",
          "1316:  {",
          "1317:  size_t len, maxlen;",
          "1318:  zend_string *str;",
          "",
          "[Removed Lines]",
          "1312: #line 1313 \"ext/standard/var_unserializer.c\"",
          "1315: #line 771 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1316: #line 1317 \"ext/standard/var_unserializer.c\"",
          "1319: #line 775 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1346:  ZVAL_STR(rval, str);",
          "1347:  return 1;",
          "1348: }",
          "1350: yy86:",
          "1351:  ++YYCURSOR;",
          "1353:  {",
          "1354:  zend_long elements = parse_iv(start + 2);",
          "1357:     if (!var_hash) return 0;",
          "1360:   return 0;",
          "1361:  }",
          "",
          "[Removed Lines]",
          "1349: #line 1350 \"ext/standard/var_unserializer.c\"",
          "1352: #line 805 \"ext/standard/var_unserializer.re\"",
          "1359:  if (elements < 0) {",
          "",
          "[Added Lines]",
          "1353: #line 1354 \"ext/standard/var_unserializer.c\"",
          "1356: #line 809 \"ext/standard/var_unserializer.re\"",
          "1363:  if (elements < 0 || elements >= HT_MAX_SIZE) {",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1374:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "1375: }",
          "1377: yy88:",
          "1378:  yych = *++YYCURSOR;",
          "1379:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1376: #line 1377 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1380: #line 1381 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1398:  goto yy18;",
          "1399: yy92:",
          "1400:  ++YYCURSOR;",
          "1402:  {",
          "1403:  long elements;",
          "1404:     if (!var_hash) return 0;",
          "1406:  elements = object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR);",
          "1408:   return 0;",
          "1409:  }",
          "1410:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "1411: }",
          "1413: yy94:",
          "1414:  ++YYCURSOR;",
          "1416:  {",
          "1417:  size_t len, maxlen;",
          "1418:  char *str;",
          "",
          "[Removed Lines]",
          "1401: #line 829 \"ext/standard/var_unserializer.re\"",
          "1407:  if (elements < 0) {",
          "1412: #line 1413 \"ext/standard/var_unserializer.c\"",
          "1415: #line 739 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1405: #line 833 \"ext/standard/var_unserializer.re\"",
          "1411:  if (elements < 0 || elements >= HT_MAX_SIZE) {",
          "1416: #line 1417 \"ext/standard/var_unserializer.c\"",
          "1419: #line 743 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "1444:  ZVAL_STRINGL(rval, str, len);",
          "1445:  return 1;",
          "1446: }",
          "1448: yy96:",
          "1449:  yych = *++YYCURSOR;",
          "1450:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1447: #line 1448 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1451: #line 1452 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1452:  goto yy18;",
          "1453: yy97:",
          "1454:  ++YYCURSOR;",
          "1456:  {",
          "",
          "[Removed Lines]",
          "1455: #line 714 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1459: #line 718 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1469:  return 1;",
          "1470: }",
          "1472: }",
          "1476:  return 0;",
          "",
          "[Removed Lines]",
          "1471: #line 1472 \"ext/standard/var_unserializer.c\"",
          "1473: #line 1000 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1475: #line 1476 \"ext/standard/var_unserializer.c\"",
          "1477: #line 1004 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "552:   && zend_hash_str_exists(&Z_OBJCE_P(rval)->function_table, \"__wakeup\", sizeof(\"__wakeup\")-1);",
          "554:  ht = Z_OBJPROP_P(rval);",
          "555:  zend_hash_extend(ht, zend_hash_num_elements(ht) + elements, (ht->u.flags & HASH_FLAG_PACKED));",
          "556:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, ht, elements, 1)) {",
          "557:   if (has_wakeup) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "555:  if (elements >= HT_MAX_SIZE - zend_hash_num_elements(ht)) {",
          "556:   return 0;",
          "557:  }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "809:     if (!var_hash) return 0;",
          "812:   return 0;",
          "813:  }",
          "",
          "[Removed Lines]",
          "811:  if (elements < 0) {",
          "",
          "[Added Lines]",
          "815:  if (elements < 0 || elements >= HT_MAX_SIZE) {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "831:     if (!var_hash) return 0;",
          "833:  elements = object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR);",
          "835:   return 0;",
          "836:  }",
          "837:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "",
          "[Removed Lines]",
          "834:  if (elements < 0) {",
          "",
          "[Added Lines]",
          "838:  if (elements < 0 || elements >= HT_MAX_SIZE) {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "448c9be157f4147e121f1a2a524536c75c9c6059",
      "candidate_info": {
        "commit_hash": "448c9be157f4147e121f1a2a524536c75c9c6059",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/448c9be157f4147e121f1a2a524536c75c9c6059",
        "files": [
          "ext/standard/tests/strings/bug72663.phpt",
          "ext/standard/tests/strings/bug72663_2.phpt",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Fix bug #72663 - destroy broken object when unserializing",
        "before_after_code_files": [
          "ext/standard/tests/strings/bug72663.phpt||ext/standard/tests/strings/bug72663.phpt",
          "ext/standard/tests/strings/bug72663_2.phpt||ext/standard/tests/strings/bug72663_2.phpt",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/tests/strings/bug72663.phpt||ext/standard/tests/strings/bug72663.phpt": [
          "File: ext/standard/tests/strings/bug72663.phpt -> ext/standard/tests/strings/bug72663.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #72663: Create an Unexpected Object and Don't Invoke __wakeup() in Deserialization",
          "3: --FILE--",
          "4: <?php",
          "5: class obj implements Serializable {",
          "6:     var $data;",
          "7:     function serialize() {",
          "8:         return serialize($this->data);",
          "9:     }",
          "10:     function unserialize($data) {",
          "11:         $this->data = unserialize($data);",
          "12:     }",
          "13: }",
          "15: $inner = 'a:1:{i:0;O:9:\"Exception\":2:{s:7:\"'.\"\\0\".'*'.\"\\0\".'file\";R:4;}';",
          "16: $exploit = 'a:2:{i:0;C:3:\"obj\":'.strlen($inner).':{'.$inner.'}i:1;R:4;}';",
          "18: $data = unserialize($exploit);",
          "19: echo $data[1];",
          "20: ?>",
          "21: DONE",
          "22: --EXPECTF--",
          "23: Notice: unserialize(): Unexpected end of serialized data in %sbug72663.php on line %d",
          "25: Notice: unserialize(): Error at offset 46 of 47 bytes in %sbug72663.php on line %d",
          "26: DONE",
          "",
          "---------------"
        ],
        "ext/standard/tests/strings/bug72663_2.phpt||ext/standard/tests/strings/bug72663_2.phpt": [
          "File: ext/standard/tests/strings/bug72663_2.phpt -> ext/standard/tests/strings/bug72663_2.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #72663: Create an Unexpected Object and Don't Invoke __wakeup() in Deserialization",
          "3: --FILE--",
          "4: <?php",
          "6: ini_set('session.serialize_handler', 'php_serialize');",
          "7: session_start();",
          "8: $sess = 'O:9:\"Exception\":2:{s:7:\"'.\"\\0\".'*'.\"\\0\".'file\";R:1;}';",
          "9: session_decode($sess);",
          "10: var_dump($_SESSION);",
          "11: ?>",
          "12: DONE",
          "13: --EXPECTF--",
          "14: Notice: session_decode(): Unexpected end of serialized data in %sbug72663_2.php on line %d",
          "15: array(0) {",
          "16: }",
          "17: DONE",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "434:  }",
          "436:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_OBJPROP_PP(rval), elements, 1)) {",
          "437:   return 0;",
          "438:  }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "438:      zend_hash_clean(Z_OBJPROP_PP(rval));",
          "439:      ZVAL_NULL(*rval);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "486: {",
          "487:  YYCTYPE yych;",
          "488:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "485: #line 486 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "488: #line 489 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "542:  yych = *(YYMARKER = ++YYCURSOR);",
          "543:  if (yych == ':') goto yy95;",
          "544: yy3:",
          "546:  { return 0; }",
          "548: yy4:",
          "549:  yych = *(YYMARKER = ++YYCURSOR);",
          "550:  if (yych == ':') goto yy89;",
          "",
          "[Removed Lines]",
          "545: #line 851 \"ext/standard/var_unserializer.re\"",
          "547: #line 548 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "548: #line 854 \"ext/standard/var_unserializer.re\"",
          "550: #line 551 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "587:  goto yy3;",
          "588: yy14:",
          "589:  ++YYCURSOR;",
          "591:  {",
          "593:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
          "595: }",
          "597: yy16:",
          "598:  yych = *++YYCURSOR;",
          "599:  goto yy3;",
          "",
          "[Removed Lines]",
          "590: #line 845 \"ext/standard/var_unserializer.re\"",
          "596: #line 597 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "593: #line 848 \"ext/standard/var_unserializer.re\"",
          "599: #line 600 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "619:  if (yybm[0+yych] & 128) {",
          "620:   goto yy20;",
          "621:  }",
          "623:  yych = *++YYCURSOR;",
          "624:  if (yych != '\"') goto yy18;",
          "625:  ++YYCURSOR;",
          "627:  {",
          "628:  size_t len, len2, len3, maxlen;",
          "629:  long elements;",
          "",
          "[Removed Lines]",
          "622:  if (yych != ':') goto yy18;",
          "626: #line 698 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "625:  if (yych <= '/') goto yy18;",
          "626:  if (yych >= ';') goto yy18;",
          "630: #line 701 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "771:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "772: }",
          "774: yy25:",
          "775:  yych = *++YYCURSOR;",
          "776:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "773: #line 774 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "777: #line 778 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "795:  yych = *++YYCURSOR;",
          "796:  if (yych != '\"') goto yy18;",
          "797:  ++YYCURSOR;",
          "799:  {",
          "800:     if (!var_hash) return 0;",
          "",
          "[Removed Lines]",
          "798: #line 689 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "802: #line 692 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "804:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "805:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "806: }",
          "808: yy32:",
          "809:  yych = *++YYCURSOR;",
          "810:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "807: #line 808 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "811: #line 812 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "825:  yych = *++YYCURSOR;",
          "826:  if (yych != '{') goto yy18;",
          "827:  ++YYCURSOR;",
          "829:  {",
          "830:  long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "828: #line 668 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "832: #line 671 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "847:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "848: }",
          "850: yy39:",
          "851:  yych = *++YYCURSOR;",
          "852:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "849: #line 850 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "853: #line 854 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "867:  yych = *++YYCURSOR;",
          "868:  if (yych != '\"') goto yy18;",
          "869:  ++YYCURSOR;",
          "871:  {",
          "872:  size_t len, maxlen;",
          "873:  char *str;",
          "",
          "[Removed Lines]",
          "870: #line 633 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "874: #line 636 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "902:  ZVAL_STRINGL(*rval, str, len, 0);",
          "903:  return 1;",
          "904: }",
          "906: yy46:",
          "907:  yych = *++YYCURSOR;",
          "908:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "905: #line 906 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "909: #line 910 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "923:  yych = *++YYCURSOR;",
          "924:  if (yych != '\"') goto yy18;",
          "925:  ++YYCURSOR;",
          "927:  {",
          "928:  size_t len, maxlen;",
          "929:  char *str;",
          "",
          "[Removed Lines]",
          "926: #line 600 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "930: #line 603 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "956:  ZVAL_STRINGL(*rval, str, len, 1);",
          "957:  return 1;",
          "958: }",
          "960: yy53:",
          "961:  yych = *++YYCURSOR;",
          "962:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "959: #line 960 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "963: #line 964 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1044:  }",
          "1045: yy63:",
          "1046:  ++YYCURSOR;",
          "1048:  {",
          "1049: #if SIZEOF_LONG == 4",
          "1050: use_double:",
          "",
          "[Removed Lines]",
          "1047: #line 590 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1051: #line 593 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1054:  ZVAL_DOUBLE(*rval, zend_strtod((const char *)start + 2, NULL));",
          "1055:  return 1;",
          "1056: }",
          "1058: yy65:",
          "1059:  yych = *++YYCURSOR;",
          "1060:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1057: #line 1058 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1061: #line 1062 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1113:  yych = *++YYCURSOR;",
          "1114:  if (yych != ';') goto yy18;",
          "1115:  ++YYCURSOR;",
          "1117:  {",
          "1119:  INIT_PZVAL(*rval);",
          "",
          "[Removed Lines]",
          "1116: #line 575 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1120: #line 578 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "1129:  return 1;",
          "1130: }",
          "1132: yy76:",
          "1133:  yych = *++YYCURSOR;",
          "1134:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1131: #line 1132 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1135: #line 1136 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1155:  if (yych <= '9') goto yy79;",
          "1156:  if (yych != ';') goto yy18;",
          "1157:  ++YYCURSOR;",
          "1159:  {",
          "1160: #if SIZEOF_LONG == 4",
          "1161:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1158: #line 548 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1162: #line 551 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1182:  ZVAL_LONG(*rval, parse_iv(start + 2));",
          "1183:  return 1;",
          "1184: }",
          "1186: yy83:",
          "1187:  yych = *++YYCURSOR;",
          "1188:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1185: #line 1186 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1189: #line 1190 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "1190:  yych = *++YYCURSOR;",
          "1191:  if (yych != ';') goto yy18;",
          "1192:  ++YYCURSOR;",
          "1194:  {",
          "1196:  INIT_PZVAL(*rval);",
          "1197:  ZVAL_BOOL(*rval, parse_iv(start + 2));",
          "1198:  return 1;",
          "1199: }",
          "1201: yy87:",
          "1202:  ++YYCURSOR;",
          "1204:  {",
          "1206:  INIT_PZVAL(*rval);",
          "1207:  ZVAL_NULL(*rval);",
          "1208:  return 1;",
          "1209: }",
          "1211: yy89:",
          "1212:  yych = *++YYCURSOR;",
          "1213:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1193: #line 541 \"ext/standard/var_unserializer.re\"",
          "1200: #line 1201 \"ext/standard/var_unserializer.c\"",
          "1203: #line 534 \"ext/standard/var_unserializer.re\"",
          "1210: #line 1211 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1197: #line 544 \"ext/standard/var_unserializer.re\"",
          "1204: #line 1205 \"ext/standard/var_unserializer.c\"",
          "1207: #line 537 \"ext/standard/var_unserializer.re\"",
          "1214: #line 1215 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "1230:  if (yych <= '9') goto yy91;",
          "1231:  if (yych != ';') goto yy18;",
          "1232:  ++YYCURSOR;",
          "1234:  {",
          "1235:  long id;",
          "",
          "[Removed Lines]",
          "1233: #line 511 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1237: #line 514 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "1254:  return 1;",
          "1255: }",
          "1257: yy95:",
          "1258:  yych = *++YYCURSOR;",
          "1259:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1256: #line 1257 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1260: #line 1261 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "1276:  if (yych <= '9') goto yy97;",
          "1277:  if (yych != ';') goto yy18;",
          "1278:  ++YYCURSOR;",
          "1280:  {",
          "1281:  long id;",
          "",
          "[Removed Lines]",
          "1279: #line 490 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1283: #line 493 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 25 ---",
          "[Context before]",
          "1298:  return 1;",
          "1299: }",
          "1301: }",
          "1305:  return 0;",
          "",
          "[Removed Lines]",
          "1300: #line 1301 \"ext/standard/var_unserializer.c\"",
          "1302: #line 853 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1304: #line 1305 \"ext/standard/var_unserializer.c\"",
          "1306: #line 856 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "438:  }",
          "440:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_OBJPROP_PP(rval), elements, 1)) {",
          "441:   return 0;",
          "442:  }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "442:      zend_hash_clean(Z_OBJPROP_PP(rval));",
          "443:      ZVAL_NULL(*rval);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "03da5f8e30cc65584d38d478ea566062ff99579b",
      "candidate_info": {
        "commit_hash": "03da5f8e30cc65584d38d478ea566062ff99579b",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/03da5f8e30cc65584d38d478ea566062ff99579b",
        "files": [
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Try to intern unserualized string keys",
        "before_after_code_files": [
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "389: #define UNSERIALIZE_PARAMETER zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash",
          "390: #define UNSERIALIZE_PASSTHRU rval, p, max, var_hash",
          "394: static zend_always_inline int process_nested_data(UNSERIALIZE_PARAMETER, HashTable *ht, zend_long elements, int objprops)",
          "395: {",
          "",
          "[Removed Lines]",
          "392: static int php_var_unserialize_internal(UNSERIALIZE_PARAMETER);",
          "",
          "[Added Lines]",
          "392: static int php_var_unserialize_internal(UNSERIALIZE_PARAMETER, int as_key);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "400:   ZVAL_UNDEF(&key);",
          "403:    zval_ptr_dtor(&key);",
          "404:    return 0;",
          "405:   }",
          "",
          "[Removed Lines]",
          "402:   if (!php_var_unserialize_internal(&key, p, max, NULL)) {",
          "",
          "[Added Lines]",
          "402:   if (!php_var_unserialize_internal(&key, p, max, NULL, 1)) {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "438: string_key:",
          "439:     {",
          "440:      zend_property_info *existing_propinfo;",
          "442:      const char *unmangled_class = NULL;",
          "443:      const char *unmangled_prop;",
          "444:      size_t unmangled_prop_len;",
          "",
          "[Removed Lines]",
          "441:      zend_string *new_key, *unmangled;",
          "",
          "[Added Lines]",
          "441:      zend_string *new_key;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "448:       return 0;",
          "449:      }",
          "461:         new_key = zend_mangle_property_name(",
          "465:        } else {",
          "470:        }",
          "472:       } else {",
          "475:       }",
          "480:      }",
          "482:      if ((old_data = zend_hash_find(ht, Z_STR(key))) != NULL) {",
          "",
          "[Removed Lines]",
          "451:      unmangled = zend_string_init(unmangled_prop, unmangled_prop_len, 0);",
          "452:      if (Z_TYPE_P(rval) == IS_OBJECT",
          "453:        && ((existing_propinfo = zend_hash_find_ptr(&Z_OBJCE_P(rval)->properties_info, unmangled)) != NULL)",
          "454:        && (existing_propinfo->flags & ZEND_ACC_PPP_MASK)) {",
          "455:       if (existing_propinfo->flags & ZEND_ACC_PROTECTED) {",
          "456:        new_key = zend_mangle_property_name(",
          "457:         \"*\", 1, ZSTR_VAL(unmangled), ZSTR_LEN(unmangled), 0);",
          "458:        zend_string_release(unmangled);",
          "459:       } else if (existing_propinfo->flags & ZEND_ACC_PRIVATE) {",
          "460:        if (unmangled_class != NULL && strcmp(unmangled_class, \"*\") != 0) {",
          "462:          unmangled_class, strlen(unmangled_class),",
          "463:          ZSTR_VAL(unmangled), ZSTR_LEN(unmangled),",
          "464:          0);",
          "466:         new_key = zend_mangle_property_name(",
          "467:          ZSTR_VAL(existing_propinfo->ce->name), ZSTR_LEN(existing_propinfo->ce->name),",
          "468:          ZSTR_VAL(unmangled), ZSTR_LEN(unmangled),",
          "469:          0);",
          "471:        zend_string_release(unmangled);",
          "473:        ZEND_ASSERT(existing_propinfo->flags & ZEND_ACC_PUBLIC);",
          "474:        new_key = unmangled;",
          "476:       zend_string_release(Z_STR(key));",
          "477:       ZVAL_STR(&key, new_key);",
          "478:      } else {",
          "479:       zend_string_release(unmangled);",
          "",
          "[Added Lines]",
          "451:      if (Z_TYPE_P(rval) == IS_OBJECT) {",
          "452:       zend_string *unmangled = zend_string_init(unmangled_prop, unmangled_prop_len, 0);",
          "454:       if (((existing_propinfo = zend_hash_find_ptr(&Z_OBJCE_P(rval)->properties_info, unmangled)) != NULL)",
          "455:         && (existing_propinfo->flags & ZEND_ACC_PPP_MASK)) {",
          "456:        if (existing_propinfo->flags & ZEND_ACC_PROTECTED) {",
          "458:          \"*\", 1, ZSTR_VAL(unmangled), ZSTR_LEN(unmangled), 0);",
          "459:         zend_string_release(unmangled);",
          "460:        } else if (existing_propinfo->flags & ZEND_ACC_PRIVATE) {",
          "461:         if (unmangled_class != NULL && strcmp(unmangled_class, \"*\") != 0) {",
          "462:          new_key = zend_mangle_property_name(",
          "463:           unmangled_class, strlen(unmangled_class),",
          "464:           ZSTR_VAL(unmangled), ZSTR_LEN(unmangled),",
          "465:           0);",
          "466:         } else {",
          "467:          new_key = zend_mangle_property_name(",
          "468:           ZSTR_VAL(existing_propinfo->ce->name), ZSTR_LEN(existing_propinfo->ce->name),",
          "469:           ZSTR_VAL(unmangled), ZSTR_LEN(unmangled),",
          "470:           0);",
          "471:         }",
          "472:         zend_string_release(unmangled);",
          "474:         ZEND_ASSERT(existing_propinfo->flags & ZEND_ACC_PUBLIC);",
          "475:         new_key = unmangled;",
          "477:        zend_string_release(Z_STR(key));",
          "478:        ZVAL_STR(&key, new_key);",
          "480:        zend_string_release(unmangled);",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "499:    }",
          "500:   }",
          "503:    zval_ptr_dtor(&key);",
          "504:    return 0;",
          "505:   }",
          "",
          "[Removed Lines]",
          "502:   if (!php_var_unserialize_internal(data, p, max, var_hash)) {",
          "",
          "[Added Lines]",
          "504:   if (!php_var_unserialize_internal(data, p, max, var_hash, 0)) {",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "625:  zend_long orig_used_slots = orig_var_entries ? orig_var_entries->used_slots : 0;",
          "626:  int result;",
          "630:  if (!result) {",
          "",
          "[Removed Lines]",
          "628:  result = php_var_unserialize_internal(UNSERIALIZE_PASSTHRU);",
          "",
          "[Added Lines]",
          "630:  result = php_var_unserialize_internal(UNSERIALIZE_PASSTHRU, 0);",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "646:  return result;",
          "647: }",
          "650: {",
          "651:  const unsigned char *cursor, *limit, *marker, *start;",
          "652:  zval *rval_ref;",
          "",
          "[Removed Lines]",
          "649: static int php_var_unserialize_internal(UNSERIALIZE_PARAMETER)",
          "",
          "[Added Lines]",
          "651: static int php_var_unserialize_internal(UNSERIALIZE_PARAMETER, int as_key)",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "665:  start = cursor;",
          "669: {",
          "670:  YYCTYPE yych;",
          "671:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "668: #line 669 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "670: #line 671 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "723: yy2:",
          "724:  ++YYCURSOR;",
          "725: yy3:",
          "727:  { return 0; }",
          "729: yy4:",
          "730:  yych = *(YYMARKER = ++YYCURSOR);",
          "731:  if (yych == ':') goto yy17;",
          "",
          "[Removed Lines]",
          "726: #line 1066 \"ext/standard/var_unserializer.re\"",
          "728: #line 729 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "728: #line 1070 \"ext/standard/var_unserializer.re\"",
          "730: #line 731 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "772:  goto yy3;",
          "773: yy15:",
          "774:  ++YYCURSOR;",
          "776:  {",
          "778:  php_error_docref(NULL, E_NOTICE, \"Unexpected end of serialized data\");",
          "780: }",
          "782: yy17:",
          "783:  yych = *++YYCURSOR;",
          "784:  if (yybm[0+yych] & 128) {",
          "",
          "[Removed Lines]",
          "775: #line 1060 \"ext/standard/var_unserializer.re\"",
          "781: #line 782 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "777: #line 1064 \"ext/standard/var_unserializer.re\"",
          "783: #line 784 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "789:  goto yy3;",
          "790: yy19:",
          "791:  ++YYCURSOR;",
          "793:  {",
          "795:  ZVAL_NULL(rval);",
          "796:  return 1;",
          "797: }",
          "799: yy21:",
          "800:  yych = *++YYCURSOR;",
          "801:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "792: #line 723 \"ext/standard/var_unserializer.re\"",
          "798: #line 799 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "794: #line 725 \"ext/standard/var_unserializer.re\"",
          "800: #line 801 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "999:  goto yy18;",
          "1000: yy57:",
          "1001:  ++YYCURSOR;",
          "1003:  {",
          "1004:  zend_long id;",
          "",
          "[Removed Lines]",
          "1002: #line 673 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1004: #line 675 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "1025:  return 1;",
          "1026: }",
          "1028: yy59:",
          "1029:  yych = *++YYCURSOR;",
          "1030:  if (yych == '\"') goto yy80;",
          "",
          "[Removed Lines]",
          "1027: #line 1028 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1029: #line 1030 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "1035:  goto yy18;",
          "1036: yy61:",
          "1037:  ++YYCURSOR;",
          "1039:  {",
          "1041:  ZVAL_FALSE(rval);",
          "1042:  return 1;",
          "1043: }",
          "1045: yy63:",
          "1046:  ++YYCURSOR;",
          "1048:  {",
          "1050:  ZVAL_TRUE(rval);",
          "1051:  return 1;",
          "1052: }",
          "1054: yy65:",
          "1055:  ++YYCURSOR;",
          "1056:  if ((YYLIMIT - YYCURSOR) < 3) YYFILL(3);",
          "",
          "[Removed Lines]",
          "1038: #line 729 \"ext/standard/var_unserializer.re\"",
          "1044: #line 1045 \"ext/standard/var_unserializer.c\"",
          "1047: #line 735 \"ext/standard/var_unserializer.re\"",
          "1053: #line 1054 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1040: #line 731 \"ext/standard/var_unserializer.re\"",
          "1046: #line 1047 \"ext/standard/var_unserializer.c\"",
          "1049: #line 737 \"ext/standard/var_unserializer.re\"",
          "1055: #line 1056 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1070:  }",
          "1071: yy67:",
          "1072:  ++YYCURSOR;",
          "1074:  {",
          "1075: #if SIZEOF_ZEND_LONG == 4",
          "1076: use_double:",
          "",
          "[Removed Lines]",
          "1073: #line 783 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1075: #line 785 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1079:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1080:  return 1;",
          "1081: }",
          "1083: yy69:",
          "1084:  yych = *++YYCURSOR;",
          "1085:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1082: #line 1083 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1084: #line 1085 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1101:  goto yy18;",
          "1102: yy72:",
          "1103:  ++YYCURSOR;",
          "1105:  {",
          "1106: #if SIZEOF_ZEND_LONG == 4",
          "1107:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1104: #line 741 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1106: #line 743 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "1127:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1128:  return 1;",
          "1129: }",
          "1131: yy74:",
          "1132:  yych = *++YYCURSOR;",
          "1133:  if (yych == '\"') goto yy88;",
          "1134:  goto yy18;",
          "1135: yy75:",
          "1136:  ++YYCURSOR;",
          "1138:  {",
          "1139:  zend_long id;",
          "",
          "[Removed Lines]",
          "1130: #line 1131 \"ext/standard/var_unserializer.c\"",
          "1137: #line 698 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1132: #line 1133 \"ext/standard/var_unserializer.c\"",
          "1139: #line 700 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1160:  return 1;",
          "1161: }",
          "1163: yy77:",
          "1164:  yych = *++YYCURSOR;",
          "1165:  if (yych == '\"') goto yy90;",
          "1166:  goto yy18;",
          "1167: yy78:",
          "1168:  ++YYCURSOR;",
          "1170:  {",
          "1171:  size_t len, len2, len3, maxlen;",
          "1172:  zend_long elements;",
          "",
          "[Removed Lines]",
          "1162: #line 1163 \"ext/standard/var_unserializer.c\"",
          "1169: #line 908 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1164: #line 1165 \"ext/standard/var_unserializer.c\"",
          "1171: #line 912 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1319:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "1320: }",
          "1322: yy80:",
          "1323:  ++YYCURSOR;",
          "1325:  {",
          "1326:  size_t len, maxlen;",
          "1327:  zend_string *str;",
          "",
          "[Removed Lines]",
          "1321: #line 1322 \"ext/standard/var_unserializer.c\"",
          "1324: #line 830 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1323: #line 1324 \"ext/standard/var_unserializer.c\"",
          "1326: #line 834 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "1355:  ZVAL_STR(rval, str);",
          "1356:  return 1;",
          "1357: }",
          "1359: yy82:",
          "1360:  ++YYCURSOR;",
          "1362:  {",
          "1363:  zend_long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "1358: #line 1359 \"ext/standard/var_unserializer.c\"",
          "1361: #line 864 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1360: #line 1361 \"ext/standard/var_unserializer.c\"",
          "1363: #line 868 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "1392:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "1393: }",
          "1395: yy84:",
          "1396:  yych = *++YYCURSOR;",
          "1397:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1394: #line 1395 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1396: #line 1397 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "1410:  goto yy18;",
          "1411: yy88:",
          "1412:  ++YYCURSOR;",
          "1414:  {",
          "1415:  zend_long elements;",
          "1416:     if (!var_hash) return 0;",
          "",
          "[Removed Lines]",
          "1413: #line 897 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1415: #line 901 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "1421:  }",
          "1422:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "1423: }",
          "1425: yy90:",
          "1426:  ++YYCURSOR;",
          "1428:  {",
          "1429:  size_t len, maxlen;",
          "1430:  char *str;",
          "",
          "[Removed Lines]",
          "1424: #line 1425 \"ext/standard/var_unserializer.c\"",
          "1427: #line 792 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1426: #line 1427 \"ext/standard/var_unserializer.c\"",
          "1429: #line 794 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 25 ---",
          "[Context before]",
          "1457:   ZVAL_EMPTY_STRING(rval);",
          "1458:  } else if (len == 1) {",
          "1459:   ZVAL_INTERNED_STR(rval, ZSTR_CHAR((zend_uchar)*str));",
          "1460:  } else {",
          "1461:   ZVAL_STRINGL(rval, str, len);",
          "1462:  }",
          "1463:  return 1;",
          "1464: }",
          "1466: yy92:",
          "1467:  ++YYCURSOR;",
          "1469:  {",
          "",
          "[Removed Lines]",
          "1465: #line 1466 \"ext/standard/var_unserializer.c\"",
          "1468: #line 767 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1462:  } else if (as_key) {",
          "1463:   ZVAL_STR(rval, zend_string_init_interned(str, len, 0));",
          "1469: #line 1470 \"ext/standard/var_unserializer.c\"",
          "1472: #line 769 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 26 ---",
          "[Context before]",
          "1482:  return 1;",
          "1483: }",
          "1485: }",
          "1489:  return 0;",
          "",
          "[Removed Lines]",
          "1484: #line 1485 \"ext/standard/var_unserializer.c\"",
          "1486: #line 1068 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1488: #line 1489 \"ext/standard/var_unserializer.c\"",
          "1490: #line 1072 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "393: #define UNSERIALIZE_PARAMETER zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash",
          "394: #define UNSERIALIZE_PASSTHRU rval, p, max, var_hash",
          "398: static zend_always_inline int process_nested_data(UNSERIALIZE_PARAMETER, HashTable *ht, zend_long elements, int objprops)",
          "399: {",
          "",
          "[Removed Lines]",
          "396: static int php_var_unserialize_internal(UNSERIALIZE_PARAMETER);",
          "",
          "[Added Lines]",
          "396: static int php_var_unserialize_internal(UNSERIALIZE_PARAMETER, int as_key);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "404:   ZVAL_UNDEF(&key);",
          "407:    zval_ptr_dtor(&key);",
          "408:    return 0;",
          "409:   }",
          "",
          "[Removed Lines]",
          "406:   if (!php_var_unserialize_internal(&key, p, max, NULL)) {",
          "",
          "[Added Lines]",
          "406:   if (!php_var_unserialize_internal(&key, p, max, NULL, 1)) {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "442: string_key:",
          "443:     {",
          "444:      zend_property_info *existing_propinfo;",
          "446:      const char *unmangled_class = NULL;",
          "447:      const char *unmangled_prop;",
          "448:      size_t unmangled_prop_len;",
          "",
          "[Removed Lines]",
          "445:      zend_string *new_key, *unmangled;",
          "",
          "[Added Lines]",
          "445:      zend_string *new_key;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "452:       return 0;",
          "453:      }",
          "465:         new_key = zend_mangle_property_name(",
          "469:        } else {",
          "474:        }",
          "476:       } else {",
          "479:       }",
          "484:      }",
          "486:      if ((old_data = zend_hash_find(ht, Z_STR(key))) != NULL) {",
          "",
          "[Removed Lines]",
          "455:      unmangled = zend_string_init(unmangled_prop, unmangled_prop_len, 0);",
          "456:      if (Z_TYPE_P(rval) == IS_OBJECT",
          "457:        && ((existing_propinfo = zend_hash_find_ptr(&Z_OBJCE_P(rval)->properties_info, unmangled)) != NULL)",
          "458:        && (existing_propinfo->flags & ZEND_ACC_PPP_MASK)) {",
          "459:       if (existing_propinfo->flags & ZEND_ACC_PROTECTED) {",
          "460:        new_key = zend_mangle_property_name(",
          "461:         \"*\", 1, ZSTR_VAL(unmangled), ZSTR_LEN(unmangled), 0);",
          "462:        zend_string_release(unmangled);",
          "463:       } else if (existing_propinfo->flags & ZEND_ACC_PRIVATE) {",
          "464:        if (unmangled_class != NULL && strcmp(unmangled_class, \"*\") != 0) {",
          "466:          unmangled_class, strlen(unmangled_class),",
          "467:          ZSTR_VAL(unmangled), ZSTR_LEN(unmangled),",
          "468:          0);",
          "470:         new_key = zend_mangle_property_name(",
          "471:          ZSTR_VAL(existing_propinfo->ce->name), ZSTR_LEN(existing_propinfo->ce->name),",
          "472:          ZSTR_VAL(unmangled), ZSTR_LEN(unmangled),",
          "473:          0);",
          "475:        zend_string_release(unmangled);",
          "477:        ZEND_ASSERT(existing_propinfo->flags & ZEND_ACC_PUBLIC);",
          "478:        new_key = unmangled;",
          "480:       zend_string_release(Z_STR(key));",
          "481:       ZVAL_STR(&key, new_key);",
          "482:      } else {",
          "483:       zend_string_release(unmangled);",
          "",
          "[Added Lines]",
          "455:      if (Z_TYPE_P(rval) == IS_OBJECT) {",
          "456:       zend_string *unmangled = zend_string_init(unmangled_prop, unmangled_prop_len, 0);",
          "458:       if (((existing_propinfo = zend_hash_find_ptr(&Z_OBJCE_P(rval)->properties_info, unmangled)) != NULL)",
          "459:         && (existing_propinfo->flags & ZEND_ACC_PPP_MASK)) {",
          "460:        if (existing_propinfo->flags & ZEND_ACC_PROTECTED) {",
          "462:          \"*\", 1, ZSTR_VAL(unmangled), ZSTR_LEN(unmangled), 0);",
          "463:         zend_string_release(unmangled);",
          "464:        } else if (existing_propinfo->flags & ZEND_ACC_PRIVATE) {",
          "465:         if (unmangled_class != NULL && strcmp(unmangled_class, \"*\") != 0) {",
          "466:          new_key = zend_mangle_property_name(",
          "467:           unmangled_class, strlen(unmangled_class),",
          "468:           ZSTR_VAL(unmangled), ZSTR_LEN(unmangled),",
          "469:           0);",
          "470:         } else {",
          "471:          new_key = zend_mangle_property_name(",
          "472:           ZSTR_VAL(existing_propinfo->ce->name), ZSTR_LEN(existing_propinfo->ce->name),",
          "473:           ZSTR_VAL(unmangled), ZSTR_LEN(unmangled),",
          "474:           0);",
          "475:         }",
          "476:         zend_string_release(unmangled);",
          "478:         ZEND_ASSERT(existing_propinfo->flags & ZEND_ACC_PUBLIC);",
          "479:         new_key = unmangled;",
          "481:        zend_string_release(Z_STR(key));",
          "482:        ZVAL_STR(&key, new_key);",
          "484:        zend_string_release(unmangled);",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "503:    }",
          "504:   }",
          "507:    zval_ptr_dtor(&key);",
          "508:    return 0;",
          "509:   }",
          "",
          "[Removed Lines]",
          "506:   if (!php_var_unserialize_internal(data, p, max, var_hash)) {",
          "",
          "[Added Lines]",
          "508:   if (!php_var_unserialize_internal(data, p, max, var_hash, 0)) {",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "629:  zend_long orig_used_slots = orig_var_entries ? orig_var_entries->used_slots : 0;",
          "630:  int result;",
          "634:  if (!result) {",
          "",
          "[Removed Lines]",
          "632:  result = php_var_unserialize_internal(UNSERIALIZE_PASSTHRU);",
          "",
          "[Added Lines]",
          "634:  result = php_var_unserialize_internal(UNSERIALIZE_PASSTHRU, 0);",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "650:  return result;",
          "651: }",
          "654: {",
          "655:  const unsigned char *cursor, *limit, *marker, *start;",
          "656:  zval *rval_ref;",
          "",
          "[Removed Lines]",
          "653: static int php_var_unserialize_internal(UNSERIALIZE_PARAMETER)",
          "",
          "[Added Lines]",
          "655: static int php_var_unserialize_internal(UNSERIALIZE_PARAMETER, int as_key)",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "821:   ZVAL_EMPTY_STRING(rval);",
          "822:  } else if (len == 1) {",
          "823:   ZVAL_INTERNED_STR(rval, ZSTR_CHAR((zend_uchar)*str));",
          "824:  } else {",
          "825:   ZVAL_STRINGL(rval, str, len);",
          "826:  }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "826:  } else if (as_key) {",
          "827:   ZVAL_STR(rval, zend_string_init_interned(str, len, 0));",
          "",
          "---------------"
        ]
      }
    }
  ]
}