{
  "cve_id": "CVE-2017-3730",
  "cve_desc": "In OpenSSL 1.1.0 before 1.1.0d, if a malicious server supplies bad parameters for a DHE or ECDHE key exchange then this can result in the client attempting to dereference a NULL pointer leading to a client crash. This could be exploited in a Denial of Service attack.",
  "repo": "openssl/openssl",
  "patch_hash": "efbe126e3ebb9123ac9d058aa2bb044261342aaa",
  "patch_info": {
    "commit_hash": "efbe126e3ebb9123ac9d058aa2bb044261342aaa",
    "repo": "openssl/openssl",
    "commit_url": "https://github.com/openssl/openssl/commit/efbe126e3ebb9123ac9d058aa2bb044261342aaa",
    "files": [
      "ssl/statem/statem_clnt.c"
    ],
    "message": "Fix missing NULL checks in CKE processing\n\nReviewed-by: Rich Salz <rsalz@openssl.org>",
    "before_after_code_files": [
      "ssl/statem/statem_clnt.c||ssl/statem/statem_clnt.c"
    ]
  },
  "patch_diff": {
    "ssl/statem/statem_clnt.c||ssl/statem/statem_clnt.c": [
      "File: ssl/statem/statem_clnt.c -> ssl/statem/statem_clnt.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "2258:         return 0;",
      "2259:     }",
      "2260:     ckey = ssl_generate_pkey(skey);",
      "2261:     dh_clnt = EVP_PKEY_get0_DH(ckey);",
      "2263:     if (dh_clnt == NULL || ssl_derive(s, ckey, skey) == 0) {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "2261:     if (ckey == NULL) {",
      "2262:         SSLerr(SSL_F_TLS_CONSTRUCT_CKE_DHE, ERR_R_INTERNAL_ERROR);",
      "2263:         return 0;",
      "2264:     }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "2296:     }",
      "2298:     ckey = ssl_generate_pkey(skey);",
      "2300:     if (ssl_derive(s, ckey, skey) == 0) {",
      "2301:         SSLerr(SSL_F_TLS_CONSTRUCT_CKE_ECDHE, ERR_R_EVP_LIB);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "2304:     if (ckey == NULL) {",
      "2305:         SSLerr(SSL_F_TLS_CONSTRUCT_CKE_ECDHE, ERR_R_INTERNAL_ERROR);",
      "2306:         goto err;",
      "2307:     }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "61b1eb2c67542c85311843300f49d019f80afc6c",
      "candidate_info": {
        "commit_hash": "61b1eb2c67542c85311843300f49d019f80afc6c",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/61b1eb2c67542c85311843300f49d019f80afc6c",
        "files": [
          "ssl/record/rec_layer_d1.c"
        ],
        "message": "Fix an Uninit read in DTLS\n\nIf we have a handshake fragment waiting then dtls1_read_bytes() was not\ncorrectly setting the value of recvd_type, leading to an uninit read.\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(cherry picked from commit 2f2d6e3e3ccd1ae7bba9f1af62f97dfca986e083)",
        "before_after_code_files": [
          "ssl/record/rec_layer_d1.c||ssl/record/rec_layer_d1.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "ssl/record/rec_layer_d1.c||ssl/record/rec_layer_d1.c": [
          "File: ssl/record/rec_layer_d1.c -> ssl/record/rec_layer_d1.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "363:         return ret;",
          "",
          "[Removed Lines]",
          "362:     if ((ret = have_handshake_fragment(s, type, buf, len)))",
          "",
          "[Added Lines]",
          "362:     if ((ret = have_handshake_fragment(s, type, buf, len))) {",
          "365:     }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "86d9b572e184262f8c14e8c31f87caa300691d39",
      "candidate_info": {
        "commit_hash": "86d9b572e184262f8c14e8c31f87caa300691d39",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/86d9b572e184262f8c14e8c31f87caa300691d39",
        "files": [
          "crypto/threads_pthread.c"
        ],
        "message": "Grouped data declarations [skip ci] Reviewed-by: Rich Salz <rsalz@openssl.org> Reviewed-by: Richard Levitte <levitte@openssl.org> (Merged from https://github.com/openssl/openssl/pull/1981) (cherry picked from commit bc1dba209533f2033a4de0d93380fc0f485e6f7e)",
        "before_after_code_files": [
          "crypto/threads_pthread.c||crypto/threads_pthread.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "crypto/threads_pthread.c||crypto/threads_pthread.c": [
          "File: crypto/threads_pthread.c -> crypto/threads_pthread.c"
        ]
      }
    },
    {
      "candidate_hash": "a4905bf6423105cda266ea3dfa70c207b4b7c2ac",
      "candidate_info": {
        "commit_hash": "a4905bf6423105cda266ea3dfa70c207b4b7c2ac",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/a4905bf6423105cda266ea3dfa70c207b4b7c2ac",
        "files": [
          "crypto/dh/dh_meth.c",
          "crypto/dsa/dsa_meth.c",
          "crypto/rsa/rsa_meth.c"
        ],
        "message": "Raise an error on memory alloc failure.\n\nBoth strdup or malloc failure should raise an err.\n\nReviewed-by: Andy Polyakov <appro@openssl.org>\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/1905)\n(cherry picked from commit bad6b116a2d3c005330e618c726f172fd0fefc2a)",
        "before_after_code_files": [
          "crypto/dh/dh_meth.c||crypto/dh/dh_meth.c",
          "crypto/dsdsa_meth.c||crypto/dsa/dsa_meth.c",
          "crypto/rsrsa_meth.c||crypto/rsa/rsa_meth.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "crypto/dh/dh_meth.c||crypto/dh/dh_meth.c": [
          "File: crypto/dh/dh_meth.c -> crypto/dh/dh_meth.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "14: DH_METHOD *DH_meth_new(const char *name, int flags)",
          "15: {",
          "18:     if (dhm != NULL) {",
          "25:         dhm->flags = flags;",
          "26:     }",
          "29: }",
          "31: void DH_meth_free(DH_METHOD *dhm)",
          "",
          "[Removed Lines]",
          "16:     DH_METHOD *dhm = OPENSSL_zalloc(sizeof(DH_METHOD));",
          "19:         dhm->name = OPENSSL_strdup(name);",
          "20:         if (dhm->name == NULL) {",
          "21:             OPENSSL_free(dhm);",
          "22:             DHerr(DH_F_DH_METH_NEW, ERR_R_MALLOC_FAILURE);",
          "23:             return NULL;",
          "24:         }",
          "28:     return dhm;",
          "",
          "[Added Lines]",
          "16:     DH_METHOD *dhm = OPENSSL_zalloc(sizeof(*dhm));",
          "21:         dhm->name = OPENSSL_strdup(name);",
          "22:         if (dhm->name != NULL)",
          "23:             return dhm;",
          "25:         OPENSSL_free(dhm);",
          "28:     DHerr(DH_F_DH_METH_NEW, ERR_R_MALLOC_FAILURE);",
          "29:     return NULL;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "39: DH_METHOD *DH_meth_dup(const DH_METHOD *dhm)",
          "40: {",
          "45:     if (ret != NULL) {",
          "46:         memcpy(ret, dhm, sizeof(*dhm));",
          "47:         ret->name = OPENSSL_strdup(dhm->name);",
          "53:     }",
          "56: }",
          "58: const char *DH_meth_get0_name(const DH_METHOD *dhm)",
          "",
          "[Removed Lines]",
          "41:     DH_METHOD *ret;",
          "43:     ret = OPENSSL_malloc(sizeof(DH_METHOD));",
          "48:         if (ret->name == NULL) {",
          "49:             OPENSSL_free(ret);",
          "50:             DHerr(DH_F_DH_METH_DUP, ERR_R_MALLOC_FAILURE);",
          "51:             return NULL;",
          "52:         }",
          "55:     return ret;",
          "",
          "[Added Lines]",
          "42:     DH_METHOD *ret = OPENSSL_malloc(sizeof(*ret));",
          "48:         if (ret->name != NULL)",
          "49:             return ret;",
          "51:         OPENSSL_free(ret);",
          "54:     DHerr(DH_F_DH_METH_DUP, ERR_R_MALLOC_FAILURE);",
          "55:     return NULL;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "63: int DH_meth_set1_name(DH_METHOD *dhm, const char *name)",
          "64: {",
          "68:     if (tmpname == NULL) {",
          "69:         DHerr(DH_F_DH_METH_SET1_NAME, ERR_R_MALLOC_FAILURE);",
          "70:         return 0;",
          "",
          "[Removed Lines]",
          "65:     char *tmpname;",
          "67:     tmpname = OPENSSL_strdup(name);",
          "",
          "[Added Lines]",
          "65:     char *tmpname = OPENSSL_strdup(name);",
          "",
          "---------------"
        ],
        "crypto/dsdsa_meth.c||crypto/dsa/dsa_meth.c": [
          "File: crypto/dsdsa_meth.c -> crypto/dsa/dsa_meth.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "24:     DSA_METHOD *dsam = OPENSSL_zalloc(sizeof(*dsam));",
          "29:         dsam->name = OPENSSL_strdup(name);",
          "30:         if (dsam->name != NULL)",
          "31:             return dsam;",
          "33:         OPENSSL_free(dsam);",
          "36:     DSAerr(DSA_F_DSA_METH_NEW, ERR_R_MALLOC_FAILURE);",
          "37:     return NULL;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "50:     DSA_METHOD *ret = OPENSSL_malloc(sizeof(*ret));",
          "56:         if (ret->name != NULL)",
          "57:             return ret;",
          "59:         OPENSSL_free(ret);",
          "62:     DSAerr(DSA_F_DSA_METH_DUP, ERR_R_MALLOC_FAILURE);",
          "63:     return NULL;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "73:     char *tmpname = OPENSSL_strdup(name);",
          "",
          "---------------"
        ],
        "crypto/rsrsa_meth.c||crypto/rsa/rsa_meth.c": [
          "File: crypto/rsrsa_meth.c -> crypto/rsa/rsa_meth.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "16:     RSA_METHOD *meth = OPENSSL_zalloc(sizeof(*meth));",
          "21:         meth->name = OPENSSL_strdup(name);",
          "22:         if (meth->name != NULL)",
          "23:             return meth;",
          "25:         OPENSSL_free(meth);",
          "28:     RSAerr(RSA_F_RSA_METH_NEW, ERR_R_MALLOC_FAILURE);",
          "29:     return NULL;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "42:     RSA_METHOD *ret = OPENSSL_malloc(sizeof(*ret));",
          "48:         if (ret->name != NULL)",
          "49:             return ret;",
          "51:         OPENSSL_free(ret);",
          "54:     RSAerr(RSA_F_RSA_METH_DUP, ERR_R_MALLOC_FAILURE);",
          "55:     return NULL;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "65:     char *tmpname = OPENSSL_strdup(name);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "df8dca7ac8d71b2fe5ec3a378c547dbfeb081d7e",
      "candidate_info": {
        "commit_hash": "df8dca7ac8d71b2fe5ec3a378c547dbfeb081d7e",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/df8dca7ac8d71b2fe5ec3a378c547dbfeb081d7e",
        "files": [
          "Configurations/unix-Makefile.tmpl"
        ],
        "message": "Unix Makefile: Make sure to use $(PERL) when running ./Configure\n\nFor consistency, it's better to use the perl that was specified to\nConfigure last time it was called.\n\nUse case:\n\nperl v5.8.8 was first along $PATH, perl v5.22.2 was available and\nspecified as: PERL=/opt/local/bin/perl ./config.  When make wanted to\nreconfigure and called './Configure reconf', configuration broke down,\ncomplaining about a perl that's too old.\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/1884)\n(cherry picked from commit 12ccb021be9e1c4c947e020ea2079e985b329a8a)",
        "before_after_code_files": [
          "Configurations/unix-Makefile.tmpl||Configurations/unix-Makefile.tmpl"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "Configurations/unix-Makefile.tmpl||Configurations/unix-Makefile.tmpl": [
          "File: Configurations/unix-Makefile.tmpl -> Configurations/unix-Makefile.tmpl",
          "--- Hunk 1 ---",
          "[Context before]",
          "761:  cd $(SRCDIR); ls -l $(TARFILE).gz",
          "763: dist:",
          "766: # Helper targets #####################################################",
          "",
          "[Removed Lines]",
          "764:  @$(MAKE) PREPARE_CMD='./Configure dist' tar",
          "",
          "[Added Lines]",
          "764:  @$(MAKE) PREPARE_CMD='$(PERL) ./Configure dist' tar",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "820: configdata.pm: $(SRCDIR)/Configure $(SRCDIR)/config {- join(\" \", @{$config{build_file_templates}}, @{$config{build_infos}}, @{$config{conf_files}}) -}",
          "821:  @echo \"Detected changed: $?\"",
          "822:  @echo \"Reconfiguring...\"",
          "824:  @echo \"**************************************************\"",
          "825:  @echo \"***                                            ***\"",
          "826:  @echo \"***   Please run the same make command again   ***\"",
          "",
          "[Removed Lines]",
          "823:  $(SRCDIR)/Configure reconf",
          "",
          "[Added Lines]",
          "823:  $(PERL) $(SRCDIR)/Configure reconf",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "baee63371d568a2439cd1dddf584bcdf19b7cbbc",
      "candidate_info": {
        "commit_hash": "baee63371d568a2439cd1dddf584bcdf19b7cbbc",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/baee63371d568a2439cd1dddf584bcdf19b7cbbc",
        "files": [
          "ssl/t1_trce.c"
        ],
        "message": "Ensure trace recognises X25519\n\nUsing the -trace option to s_server or s_client was incorrectly printing\nUNKNOWN for the X25519 curve.\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(cherry picked from commit 2d11f5b2ca863d4bd9e20b224932b247ed85842b)",
        "before_after_code_files": [
          "ssl/t1_trce.c||ssl/t1_trce.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "ssl/t1_trce.c||ssl/t1_trce.c": [
          "File: ssl/t1_trce.c -> ssl/t1_trce.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "490:     {26, \"brainpoolP256r1\"},",
          "491:     {27, \"brainpoolP384r1\"},",
          "492:     {28, \"brainpoolP512r1\"},",
          "493:     {0xFF01, \"arbitrary_explicit_prime_curves\"},",
          "494:     {0xFF02, \"arbitrary_explicit_char2_curves\"}",
          "495: };",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "493:     {29, \"ecdh_x25519\"},",
          "",
          "---------------"
        ]
      }
    }
  ]
}