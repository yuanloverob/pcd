{
  "cve_id": "CVE-2014-3546",
  "cve_desc": "Moodle through 2.3.11, 2.4.x before 2.4.11, 2.5.x before 2.5.7, 2.6.x before 2.6.4, and 2.7.x before 2.7.1 does not enforce certain capability requirements in (1) notes/index.php and (2) user/edit.php, which allows remote attackers to obtain potentially sensitive username and course information via a modified URL.",
  "repo": "moodle/moodle",
  "patch_hash": "9dbf62d23017a91fcbf63bba7f2eb4835f77b8c9",
  "patch_info": {
    "commit_hash": "9dbf62d23017a91fcbf63bba7f2eb4835f77b8c9",
    "repo": "moodle/moodle",
    "commit_url": "https://github.com/moodle/moodle/commit/9dbf62d23017a91fcbf63bba7f2eb4835f77b8c9",
    "files": [
      "notes/index.php",
      "user/edit.php"
    ],
    "message": "MDL-45760 make sure to check permission before setting header",
    "before_after_code_files": [
      "user/edit.php||user/edit.php"
    ]
  },
  "patch_diff": {
    "user/edit.php||user/edit.php": [
      "File: user/edit.php -> user/edit.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "103: $systemcontext   = context_system::instance();",
      "104: $personalcontext = context_user::instance($user->id);",
      "117: if ($user->id == $USER->id) {",
      "",
      "[Removed Lines]",
      "106: $PAGE->set_pagelayout('admin');",
      "107: $PAGE->set_context($personalcontext);",
      "108: if ($USER->id != $user->id) {",
      "109:     $PAGE->navigation->extend_for_user($user);",
      "110: } else {",
      "111:     if ($node = $PAGE->navigation->find('myprofile', navigation_node::TYPE_ROOTNODE)) {",
      "112:         $node->force_open();",
      "113:     }",
      "114: }",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "140:     die;",
      "141: }",
      "144: if ($cancelemailchange) {",
      "145:     cancel_email_update($user->id);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "133: $PAGE->set_pagelayout('admin');",
      "134: $PAGE->set_context($personalcontext);",
      "135: if ($USER->id != $user->id) {",
      "136:     $PAGE->navigation->extend_for_user($user);",
      "137: } else {",
      "138:     if ($node = $PAGE->navigation->find('myprofile', navigation_node::TYPE_ROOTNODE)) {",
      "139:         $node->force_open();",
      "140:     }",
      "141: }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "2ca9e09dab3ff374e1026780b23c63751f4ee312",
      "candidate_info": {
        "commit_hash": "2ca9e09dab3ff374e1026780b23c63751f4ee312",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/2ca9e09dab3ff374e1026780b23c63751f4ee312",
        "files": [
          "notes/index.php",
          "user/edit.php"
        ],
        "message": "MDL-45760 make sure to check permission before setting header",
        "before_after_code_files": [
          "user/edit.php||user/edit.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "user/edit.php||user/edit.php"
          ],
          "candidate": [
            "user/edit.php||user/edit.php"
          ]
        }
      },
      "candidate_diff": {
        "user/edit.php||user/edit.php": [
          "File: user/edit.php -> user/edit.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "103: $systemcontext   = context_system::instance();",
          "104: $personalcontext = context_user::instance($user->id);",
          "117: if ($user->id == $USER->id) {",
          "",
          "[Removed Lines]",
          "106: $PAGE->set_pagelayout('admin');",
          "107: $PAGE->set_context($personalcontext);",
          "108: if ($USER->id != $user->id) {",
          "109:     $PAGE->navigation->extend_for_user($user);",
          "110: } else {",
          "111:     if ($node = $PAGE->navigation->find('myprofile', navigation_node::TYPE_ROOTNODE)) {",
          "112:         $node->force_open();",
          "113:     }",
          "114: }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "140:     die;",
          "141: }",
          "144: if ($cancelemailchange) {",
          "145:     cancel_email_update($user->id);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "133: $PAGE->set_pagelayout('admin');",
          "134: $PAGE->set_context($personalcontext);",
          "135: if ($USER->id != $user->id) {",
          "136:     $PAGE->navigation->extend_for_user($user);",
          "137: } else {",
          "138:     if ($node = $PAGE->navigation->find('myprofile', navigation_node::TYPE_ROOTNODE)) {",
          "139:         $node->force_open();",
          "140:     }",
          "141: }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "74556525de9617c593c3e08269d6d541c6576c90",
      "candidate_info": {
        "commit_hash": "74556525de9617c593c3e08269d6d541c6576c90",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/74556525de9617c593c3e08269d6d541c6576c90",
        "files": [
          "notes/index.php",
          "user/edit.php"
        ],
        "message": "MDL-45760 make sure to check permission before setting header",
        "before_after_code_files": [
          "user/edit.php||user/edit.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_message": 1,
        "olp_code_files": {
          "patch": [
            "user/edit.php||user/edit.php"
          ],
          "candidate": [
            "user/edit.php||user/edit.php"
          ]
        }
      },
      "candidate_diff": {
        "user/edit.php||user/edit.php": [
          "File: user/edit.php -> user/edit.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "104: $systemcontext   = context_system::instance();",
          "105: $personalcontext = context_user::instance($user->id);",
          "118: if ($user->id == $USER->id) {",
          "",
          "[Removed Lines]",
          "107: $PAGE->set_pagelayout('admin');",
          "108: $PAGE->set_context($personalcontext);",
          "109: if ($USER->id != $user->id) {",
          "110:     $PAGE->navigation->extend_for_user($user);",
          "111: } else {",
          "112:     if ($node = $PAGE->navigation->find('myprofile', navigation_node::TYPE_ROOTNODE)) {",
          "113:         $node->force_open();",
          "114:     }",
          "115: }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "141:     die;",
          "142: }",
          "145: if ($cancelemailchange) {",
          "146:     cancel_email_update($user->id);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "134: $PAGE->set_pagelayout('admin');",
          "135: $PAGE->set_context($personalcontext);",
          "136: if ($USER->id != $user->id) {",
          "137:     $PAGE->navigation->extend_for_user($user);",
          "138: } else {",
          "139:     if ($node = $PAGE->navigation->find('myprofile', navigation_node::TYPE_ROOTNODE)) {",
          "140:         $node->force_open();",
          "141:     }",
          "142: }",
          "",
          "---------------"
        ]
      }
    }
  ]
}