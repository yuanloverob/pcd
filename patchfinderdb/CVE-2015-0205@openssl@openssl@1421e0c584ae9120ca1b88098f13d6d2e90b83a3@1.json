{
  "cve_id": "CVE-2015-0205",
  "cve_desc": "The ssl3_get_cert_verify function in s3_srvr.c in OpenSSL 1.0.0 before 1.0.0p and 1.0.1 before 1.0.1k accepts client authentication with a Diffie-Hellman (DH) certificate without requiring a CertificateVerify message, which allows remote attackers to obtain access without knowledge of a private key via crafted TLS Handshake Protocol traffic to a server that recognizes a Certification Authority with DH support.",
  "repo": "openssl/openssl",
  "patch_hash": "1421e0c584ae9120ca1b88098f13d6d2e90b83a3",
  "patch_info": {
    "commit_hash": "1421e0c584ae9120ca1b88098f13d6d2e90b83a3",
    "repo": "openssl/openssl",
    "commit_url": "https://github.com/openssl/openssl/commit/1421e0c584ae9120ca1b88098f13d6d2e90b83a3",
    "files": [
      "ssl/s3_srvr.c"
    ],
    "message": "Unauthenticated DH client certificate fix.\n\nFix to prevent use of DH client certificates without sending\ncertificate verify message.\n\nIf we've used a client certificate to generate the premaster secret\nssl3_get_client_key_exchange returns 2 and ssl3_get_cert_verify is\nnever called.\n\nWe can only skip the certificate verify message in\nssl3_get_cert_verify if the client didn't send a certificate.\n\nThanks to Karthikeyan Bhargavan for reporting this issue.\nCVE-2015-0205\nReviewed-by: Matt Caswell <matt@openssl.org>",
    "before_after_code_files": [
      "ssl/s3_srvr.c||ssl/s3_srvr.c"
    ]
  },
  "patch_diff": {
    "ssl/s3_srvr.c||ssl/s3_srvr.c": [
      "File: ssl/s3_srvr.c -> ssl/s3_srvr.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "3056:  if (s->s3->tmp.message_type != SSL3_MT_CERTIFICATE_VERIFY)",
      "3057:   {",
      "3058:   s->s3->tmp.reuse_message=1;",
      "3060:    {",
      "3061:    al=SSL_AD_UNEXPECTED_MESSAGE;",
      "3062:    SSLerr(SSL_F_SSL3_GET_CERT_VERIFY,SSL_R_MISSING_VERIFY_MESSAGE);",
      "",
      "[Removed Lines]",
      "3059:   if ((peer != NULL) && (type & EVP_PKT_SIGN))",
      "",
      "[Added Lines]",
      "3059:   if (peer != NULL)",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "98a0f9660d374f58f79ee0efcc8c1672a805e8e8",
      "candidate_info": {
        "commit_hash": "98a0f9660d374f58f79ee0efcc8c1672a805e8e8",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/98a0f9660d374f58f79ee0efcc8c1672a805e8e8",
        "files": [
          "ssl/s3_srvr.c"
        ],
        "message": "Unauthenticated DH client certificate fix.\n\nFix to prevent use of DH client certificates without sending\ncertificate verify message.\n\nIf we've used a client certificate to generate the premaster secret\nssl3_get_client_key_exchange returns 2 and ssl3_get_cert_verify is\nnever called.\n\nWe can only skip the certificate verify message in\nssl3_get_cert_verify if the client didn't send a certificate.\n\nThanks to Karthikeyan Bhargavan for reporting this issue.\nCVE-2015-0205\nReviewed-by: Matt Caswell <matt@openssl.org>",
        "before_after_code_files": [
          "ssl/s3_srvr.c||ssl/s3_srvr.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "ssl/s3_srvr.c||ssl/s3_srvr.c"
          ],
          "candidate": [
            "ssl/s3_srvr.c||ssl/s3_srvr.c"
          ]
        }
      },
      "candidate_diff": {
        "ssl/s3_srvr.c||ssl/s3_srvr.c": [
          "File: ssl/s3_srvr.c -> ssl/s3_srvr.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "3014:  if (s->s3->tmp.message_type != SSL3_MT_CERTIFICATE_VERIFY)",
          "3015:   {",
          "3016:   s->s3->tmp.reuse_message=1;",
          "3018:    {",
          "3019:    al=SSL_AD_UNEXPECTED_MESSAGE;",
          "3020:    SSLerr(SSL_F_SSL3_GET_CERT_VERIFY,SSL_R_MISSING_VERIFY_MESSAGE);",
          "",
          "[Removed Lines]",
          "3017:   if ((peer != NULL) && (type & EVP_PKT_SIGN))",
          "",
          "[Added Lines]",
          "3017:   if (peer != NULL)",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "be3fb8d15dd5a233eab0c454677d538e64d17f82",
      "candidate_info": {
        "commit_hash": "be3fb8d15dd5a233eab0c454677d538e64d17f82",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/be3fb8d15dd5a233eab0c454677d538e64d17f82",
        "files": [
          "ssl/s3_srvr.c"
        ],
        "message": "Unauthenticated DH client certificate fix.\n\nFix to prevent use of DH client certificates without sending\ncertificate verify message.\n\nIf we've used a client certificate to generate the premaster secret\nssl3_get_client_key_exchange returns 2 and ssl3_get_cert_verify is\nnever called.\n\nWe can only skip the certificate verify message in\nssl3_get_cert_verify if the client didn't send a certificate.\n\nThanks to Karthikeyan Bhargavan for reporting this issue.\nCVE-2015-0205\nReviewed-by: Matt Caswell <matt@openssl.org>",
        "before_after_code_files": [
          "ssl/s3_srvr.c||ssl/s3_srvr.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "ssl/s3_srvr.c||ssl/s3_srvr.c"
          ],
          "candidate": [
            "ssl/s3_srvr.c||ssl/s3_srvr.c"
          ]
        }
      },
      "candidate_diff": {
        "ssl/s3_srvr.c||ssl/s3_srvr.c": [
          "File: ssl/s3_srvr.c -> ssl/s3_srvr.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "3016:  if (s->s3->tmp.message_type != SSL3_MT_CERTIFICATE_VERIFY)",
          "3017:   {",
          "3018:   s->s3->tmp.reuse_message=1;",
          "3020:    {",
          "3021:    al=SSL_AD_UNEXPECTED_MESSAGE;",
          "3022:    SSLerr(SSL_F_SSL3_GET_CERT_VERIFY,SSL_R_MISSING_VERIFY_MESSAGE);",
          "",
          "[Removed Lines]",
          "3019:   if ((peer != NULL) && (type & EVP_PKT_SIGN))",
          "",
          "[Added Lines]",
          "3019:   if (peer != NULL)",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "f7fe3d235abf201343c20a59f9d9c8957acc62ff",
      "candidate_info": {
        "commit_hash": "f7fe3d235abf201343c20a59f9d9c8957acc62ff",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/f7fe3d235abf201343c20a59f9d9c8957acc62ff",
        "files": [
          "ssl/s3_srvr.c"
        ],
        "message": "Unauthenticated DH client certificate fix.\n\nFix to prevent use of DH client certificates without sending\ncertificate verify message.\n\nIf we've used a client certificate to generate the premaster secret\nssl3_get_client_key_exchange returns 2 and ssl3_get_cert_verify is\nnever called.\n\nWe can only skip the certificate verify message in\nssl3_get_cert_verify if the client didn't send a certificate.\n\nThanks to Karthikeyan Bhargavan for reporting this issue.\nCVE-2015-0205\nReviewed-by: Matt Caswell <matt@openssl.org>",
        "before_after_code_files": [
          "ssl/s3_srvr.c||ssl/s3_srvr.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "ssl/s3_srvr.c||ssl/s3_srvr.c"
          ],
          "candidate": [
            "ssl/s3_srvr.c||ssl/s3_srvr.c"
          ]
        }
      },
      "candidate_diff": {
        "ssl/s3_srvr.c||ssl/s3_srvr.c": [
          "File: ssl/s3_srvr.c -> ssl/s3_srvr.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2765:  if (s->s3->tmp.message_type != SSL3_MT_CERTIFICATE_VERIFY)",
          "2766:   {",
          "2767:   s->s3->tmp.reuse_message=1;",
          "2769:    {",
          "2770:    al=SSL_AD_UNEXPECTED_MESSAGE;",
          "2771:    SSLerr(SSL_F_SSL3_GET_CERT_VERIFY,SSL_R_MISSING_VERIFY_MESSAGE);",
          "",
          "[Removed Lines]",
          "2768:   if ((peer != NULL) && (type & EVP_PKT_SIGN))",
          "",
          "[Added Lines]",
          "2768:   if (peer != NULL)",
          "",
          "---------------"
        ]
      }
    }
  ]
}