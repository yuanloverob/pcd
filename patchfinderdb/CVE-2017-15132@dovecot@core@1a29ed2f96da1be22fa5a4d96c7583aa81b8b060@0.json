{
  "cve_id": "CVE-2017-15132",
  "cve_desc": "A flaw was found in dovecot 2.0 up to 2.2.33 and 2.3.0. An abort of SASL authentication results in a memory leak in dovecot's auth client used by login processes. The leak has impact in high performance configuration where same login processes are reused and can cause the process to crash due to memory exhaustion.",
  "repo": "dovecot/core",
  "patch_hash": "1a29ed2f96da1be22fa5a4d96c7583aa81b8b060",
  "patch_info": {
    "commit_hash": "1a29ed2f96da1be22fa5a4d96c7583aa81b8b060",
    "repo": "dovecot/core",
    "commit_url": "https://github.com/dovecot/core/commit/1a29ed2f96da1be22fa5a4d96c7583aa81b8b060",
    "files": [
      "src/lib-auth/auth-client-request.c"
    ],
    "message": "lib-auth: Fix memory leak in auth_client_request_abort()\n\nThis caused memory leaks when authentication was aborted. For example\nwith IMAP:\n\na AUTHENTICATE PLAIN\n*\n\nBroken by 9137c55411aa39d41c1e705ddc34d5bd26c65021",
    "before_after_code_files": [
      "src/lib-auth/auth-client-request.c||src/lib-auth/auth-client-request.c"
    ]
  },
  "patch_diff": {
    "src/lib-auth/auth-client-request.c||src/lib-auth/auth-client-request.c": [
      "File: src/lib-auth/auth-client-request.c -> src/lib-auth/auth-client-request.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "187:  auth_client_send_cancel(request->conn->client, request->id);",
      "188:  call_callback(request, AUTH_REQUEST_STATUS_ABORT, NULL, NULL);",
      "189: }",
      "191: unsigned int auth_client_request_get_id(struct auth_client_request *request)",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "189:  pool_unref(&request->pool);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "4e28c31250096ee5e8c739c03f8290f95c473ce0",
      "candidate_info": {
        "commit_hash": "4e28c31250096ee5e8c739c03f8290f95c473ce0",
        "repo": "dovecot/core",
        "commit_url": "https://github.com/dovecot/core/commit/4e28c31250096ee5e8c739c03f8290f95c473ce0",
        "files": [
          "src/lib-auth/auth-client-request.c"
        ],
        "message": "lib-auth: Fix memory leak in auth_client_request_abort()\n\nThis caused memory leaks when authentication was aborted. For example\nwith IMAP:\n\na AUTHENTICATE PLAIN\n*\n\nBroken by 9137c55411aa39d41c1e705ddc34d5bd26c65021",
        "before_after_code_files": [
          "src/lib-auth/auth-client-request.c||src/lib-auth/auth-client-request.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "src/lib-auth/auth-client-request.c||src/lib-auth/auth-client-request.c"
          ],
          "candidate": [
            "src/lib-auth/auth-client-request.c||src/lib-auth/auth-client-request.c"
          ]
        }
      },
      "candidate_diff": {
        "src/lib-auth/auth-client-request.c||src/lib-auth/auth-client-request.c": [
          "File: src/lib-auth/auth-client-request.c -> src/lib-auth/auth-client-request.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "181:  auth_client_send_cancel(request->conn->client, request->id);",
          "182:  call_callback(request, AUTH_REQUEST_STATUS_ABORT, NULL, NULL);",
          "183: }",
          "185: unsigned int auth_client_request_get_id(struct auth_client_request *request)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "183:  pool_unref(&request->pool);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "a008617e811673064fd657acf517dc4a12493d29",
      "candidate_info": {
        "commit_hash": "a008617e811673064fd657acf517dc4a12493d29",
        "repo": "dovecot/core",
        "commit_url": "https://github.com/dovecot/core/commit/a008617e811673064fd657acf517dc4a12493d29",
        "files": [
          "src/lib-auth/auth-client-request.c"
        ],
        "message": "lib-auth: Fix memory leak in auth_client_request_abort()\n\nThis caused memory leaks when authentication was aborted. For example\nwith IMAP:\n\na AUTHENTICATE PLAIN\n*\n\nBroken by 9137c55411aa39d41c1e705ddc34d5bd26c65021",
        "before_after_code_files": [
          "src/lib-auth/auth-client-request.c||src/lib-auth/auth-client-request.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "src/lib-auth/auth-client-request.c||src/lib-auth/auth-client-request.c"
          ],
          "candidate": [
            "src/lib-auth/auth-client-request.c||src/lib-auth/auth-client-request.c"
          ]
        }
      },
      "candidate_diff": {
        "src/lib-auth/auth-client-request.c||src/lib-auth/auth-client-request.c": [
          "File: src/lib-auth/auth-client-request.c -> src/lib-auth/auth-client-request.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "181:  auth_client_send_cancel(request->conn->client, request->id);",
          "182:  call_callback(request, AUTH_REQUEST_STATUS_ABORT, NULL, NULL);",
          "183: }",
          "185: unsigned int auth_client_request_get_id(struct auth_client_request *request)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "183:  pool_unref(&request->pool);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "b569776009d29e099e2508f47ecca924267f0b01",
      "candidate_info": {
        "commit_hash": "b569776009d29e099e2508f47ecca924267f0b01",
        "repo": "dovecot/core",
        "commit_url": "https://github.com/dovecot/core/commit/b569776009d29e099e2508f47ecca924267f0b01",
        "files": [
          "src/lib-auth/auth-client-request.c"
        ],
        "message": "lib-auth: Fix memory leak in auth_client_request_abort()\n\nThis caused memory leaks when authentication was aborted. For example\nwith IMAP:\n\na AUTHENTICATE PLAIN\n*\n\nBroken by 9137c55411aa39d41c1e705ddc34d5bd26c65021",
        "before_after_code_files": [
          "src/lib-auth/auth-client-request.c||src/lib-auth/auth-client-request.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "src/lib-auth/auth-client-request.c||src/lib-auth/auth-client-request.c"
          ],
          "candidate": [
            "src/lib-auth/auth-client-request.c||src/lib-auth/auth-client-request.c"
          ]
        }
      },
      "candidate_diff": {
        "src/lib-auth/auth-client-request.c||src/lib-auth/auth-client-request.c": [
          "File: src/lib-auth/auth-client-request.c -> src/lib-auth/auth-client-request.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "169:  auth_client_send_cancel(request->conn->client, request->id);",
          "170:  call_callback(request, AUTH_REQUEST_STATUS_ABORT, NULL, NULL);",
          "171: }",
          "173: unsigned int auth_client_request_get_id(struct auth_client_request *request)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "171:  pool_unref(&request->pool);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "77fe38480ca650d91464059c842ac1ccb5e2297c",
      "candidate_info": {
        "commit_hash": "77fe38480ca650d91464059c842ac1ccb5e2297c",
        "repo": "dovecot/core",
        "commit_url": "https://github.com/dovecot/core/commit/77fe38480ca650d91464059c842ac1ccb5e2297c",
        "files": [
          "src/lib-auth/auth-client-request.c"
        ],
        "message": "lib-auth: Fix memory leak in auth_client_request_abort()\n\nThis caused memory leaks when authentication was aborted. For example\nwith IMAP:\n\na AUTHENTICATE PLAIN\n*\n\nBroken by 9137c55411aa39d41c1e705ddc34d5bd26c65021",
        "before_after_code_files": [
          "src/lib-auth/auth-client-request.c||src/lib-auth/auth-client-request.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "src/lib-auth/auth-client-request.c||src/lib-auth/auth-client-request.c"
          ],
          "candidate": [
            "src/lib-auth/auth-client-request.c||src/lib-auth/auth-client-request.c"
          ]
        }
      },
      "candidate_diff": {
        "src/lib-auth/auth-client-request.c||src/lib-auth/auth-client-request.c": [
          "File: src/lib-auth/auth-client-request.c -> src/lib-auth/auth-client-request.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "169:  auth_client_send_cancel(request->conn->client, request->id);",
          "170:  call_callback(request, AUTH_REQUEST_STATUS_ABORT, NULL, NULL);",
          "171: }",
          "173: unsigned int auth_client_request_get_id(struct auth_client_request *request)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "171:  pool_unref(&request->pool);",
          "",
          "---------------"
        ]
      }
    }
  ]
}