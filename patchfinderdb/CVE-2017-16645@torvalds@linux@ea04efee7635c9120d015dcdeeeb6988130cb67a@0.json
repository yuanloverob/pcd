{
  "cve_id": "CVE-2017-16645",
  "cve_desc": "The ims_pcu_get_cdc_union_desc function in drivers/input/misc/ims-pcu.c in the Linux kernel through 4.13.11 allows local users to cause a denial of service (ims_pcu_parse_cdc_data out-of-bounds read and system crash) or possibly have unspecified other impact via a crafted USB device.",
  "repo": "torvalds/linux",
  "patch_hash": "ea04efee7635c9120d015dcdeeeb6988130cb67a",
  "patch_info": {
    "commit_hash": "ea04efee7635c9120d015dcdeeeb6988130cb67a",
    "repo": "torvalds/linux",
    "commit_url": "https://github.com/torvalds/linux/commit/ea04efee7635c9120d015dcdeeeb6988130cb67a",
    "files": [
      "drivers/input/misc/ims-pcu.c"
    ],
    "message": "Input: ims-psu - check if CDC union descriptor is sane\n\nBefore trying to use CDC union descriptor, try to validate whether that it\nis sane by checking that intf->altsetting->extra is big enough and that\ndescriptor bLength is not too big and not too small.\n\nReported-by: Andrey Konovalov <andreyknvl@google.com>\nSigned-off-by: Dmitry Torokhov <dmitry.torokhov@gmail.com>",
    "before_after_code_files": [
      "drivers/input/misc/ims-pcu.c||drivers/input/misc/ims-pcu.c"
    ]
  },
  "patch_diff": {
    "drivers/input/misc/ims-pcu.c||drivers/input/misc/ims-pcu.c": [
      "File: drivers/input/misc/ims-pcu.c -> drivers/input/misc/ims-pcu.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1635:   return NULL;",
      "1636:  }",
      "1639:   union_desc = (struct usb_cdc_union_desc *)buf;",
      "1641:   if (union_desc->bDescriptorType == USB_DT_CS_INTERFACE &&",
      "1642:       union_desc->bDescriptorSubType == USB_CDC_UNION_TYPE) {",
      "1643:    dev_dbg(&intf->dev, \"Found union header\\n\");",
      "1645:   }",
      "1647:   buflen -= union_desc->bLength;",
      "",
      "[Removed Lines]",
      "1638:  while (buflen > 0) {",
      "1644:    return union_desc;",
      "",
      "[Added Lines]",
      "1638:  while (buflen >= sizeof(*union_desc)) {",
      "1641:   if (union_desc->bLength > buflen) {",
      "1642:    dev_err(&intf->dev, \"Too large descriptor\\n\");",
      "1643:    return NULL;",
      "1644:   }",
      "1650:    if (union_desc->bLength >= sizeof(*union_desc))",
      "1651:     return union_desc;",
      "1653:    dev_err(&intf->dev,",
      "1654:     \"Union descriptor to short (%d vs %zd\\n)\",",
      "1655:     union_desc->bLength, sizeof(*union_desc));",
      "1656:    return NULL;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "5ddc3c656bfb5c90d0196ff72b908d0343fef85e",
      "candidate_info": {
        "commit_hash": "5ddc3c656bfb5c90d0196ff72b908d0343fef85e",
        "repo": "torvalds/linux",
        "commit_url": "https://github.com/torvalds/linux/commit/5ddc3c656bfb5c90d0196ff72b908d0343fef85e",
        "files": [
          "drivers/input/misc/ims-pcu.c"
        ],
        "message": "Input: ims-pcu - fix typo in the error message\n\n1. change \"to\" to \"too\".\n2. move \")\" to the front of \"\\n\", which discovered by Joe Perches.\n\nSigned-off-by: Zhen Lei <thunder.leizhen@huawei.com>\nReviewed-by: Joe Perches <joe@perches.com>\nSigned-off-by: Dmitry Torokhov <dmitry.torokhov@gmail.com>",
        "before_after_code_files": [
          "drivers/input/misc/ims-pcu.c||drivers/input/misc/ims-pcu.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "drivers/input/misc/ims-pcu.c||drivers/input/misc/ims-pcu.c"
          ],
          "candidate": [
            "drivers/input/misc/ims-pcu.c||drivers/input/misc/ims-pcu.c"
          ]
        }
      },
      "candidate_diff": {
        "drivers/input/misc/ims-pcu.c||drivers/input/misc/ims-pcu.c": [
          "File: drivers/input/misc/ims-pcu.c -> drivers/input/misc/ims-pcu.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1651:     return union_desc;",
          "1653:    dev_err(&intf->dev,",
          "1655:     union_desc->bLength, sizeof(*union_desc));",
          "1656:    return NULL;",
          "1657:   }",
          "",
          "[Removed Lines]",
          "1654:     \"Union descriptor to short (%d vs %zd\\n)\",",
          "",
          "[Added Lines]",
          "1654:     \"Union descriptor too short (%d vs %zd)\\n\",",
          "",
          "---------------"
        ]
      }
    }
  ]
}