{
  "cve_id": "CVE-2016-7526",
  "cve_desc": "coders/wpg.c in ImageMagick allows remote attackers to cause a denial of service (out-of-bounds write) via a crafted file.",
  "repo": "ImageMagick/ImageMagick",
  "patch_hash": "998c687fb83993c13fa711d75f59a95b38ceab77",
  "patch_info": {
    "commit_hash": "998c687fb83993c13fa711d75f59a95b38ceab77",
    "repo": "ImageMagick/ImageMagick",
    "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/998c687fb83993c13fa711d75f59a95b38ceab77",
    "files": [
      "coders/wpg.c"
    ],
    "message": "Fixed out-of-bounds write reported in: https://github.com/ImageMagick/ImageMagick/issues/102",
    "before_after_code_files": [
      "coders/wpg.c||coders/wpg.c"
    ]
  },
  "patch_diff": {
    "coders/wpg.c||coders/wpg.c": [
      "File: coders/wpg.c -> coders/wpg.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "317:         break;",
      "318:       }",
      "321:         q=QueueAuthenticPixels(image,0,y,image->columns,1,exception);",
      "322:         if (q == (Quantum *) NULL)",
      "323:           break;",
      "",
      "[Removed Lines]",
      "320:       {",
      "",
      "[Added Lines]",
      "320:       {",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "334:             index=ConstrainColormapIndex(image,(*p >> 2) & 0x3,exception);",
      "335:             SetPixelIndex(image,index,q);",
      "336:             SetPixelViaPixelInfo(image,image->colormap+(ssize_t) index,q);",
      "338:             index=ConstrainColormapIndex(image,(*p) & 0x3,exception);",
      "339:             SetPixelIndex(image,index,q);",
      "340:             SetPixelViaPixelInfo(image,image->colormap+(ssize_t) index,q);",
      "341:             p++;",
      "",
      "[Removed Lines]",
      "337:             q+=GetPixelChannels(image);",
      "",
      "[Added Lines]",
      "338:             index=ConstrainColormapIndex(image,(*p) & 0x3,exception);",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "343:         }",
      "344:        if ((image->columns % 4) != 0)",
      "345:           {",
      "348:             SetPixelViaPixelInfo(image,image->colormap+(ssize_t) index,q);",
      "349:             q+=GetPixelChannels(image);",
      "350:             if ((image->columns % 4) >= 1)",
      "352:               {",
      "355:                 SetPixelViaPixelInfo(image,image->colormap+(ssize_t) index,q);",
      "356:                 q+=GetPixelChannels(image);",
      "357:                 if ((image->columns % 4) >= 2)",
      "",
      "[Removed Lines]",
      "346:             index=ConstrainColormapIndex(image,(*p >> 6) & 0x3,exception);",
      "347:             SetPixelIndex(image,index,q);",
      "353:                 index=ConstrainColormapIndex(image,(*p >> 4) & 0x3,exception);",
      "354:                 SetPixelIndex(image,index,q);",
      "",
      "[Added Lines]",
      "346:             index=ConstrainColormapIndex(image,(*p >> 6) & 0x3,exception);",
      "352:                 index=ConstrainColormapIndex(image,(*p >> 4) & 0x3,exception);",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "427:           SetPixelRed(image,ScaleCharToQuantum(*p++),q);",
      "428:           SetPixelGreen(image,ScaleCharToQuantum(*p++),q);",
      "429:           SetPixelBlue(image,ScaleCharToQuantum(*p++),q);",
      "431:         }",
      "432:       if (!SyncAuthenticPixels(image,exception))",
      "433:         break;",
      "",
      "[Removed Lines]",
      "430:           q+=GetPixelChannels(image);",
      "",
      "[Added Lines]",
      "428:           q+=GetPixelChannels(image);",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "1183:                     {",
      "1184:                       Image",
      "1187:                       flip_image = FlipImage(image, exception);",
      "1188:                       if (flip_image != (Image *) NULL) {",
      "1189:                         DuplicateBlob(flip_image,image);",
      "1190:                         (void) RemoveLastImageFromList(&image);",
      "1191:                         AppendImageToList(&image,flip_image);",
      "1192:                       }",
      "1193:                     }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "1198:                       Image",
      "1202:                         0x0FFF), exception);",
      "1204:                         DuplicateBlob(rotate_image,image);",
      "1205:                         (void) RemoveLastImageFromList(&image);",
      "1206:                         AppendImageToList(&image,rotate_image);",
      "",
      "[Removed Lines]",
      "1201:                       rotate_image=RotateImage(image,(BitmapHeader2.RotAngle &",
      "1203:                       if (rotate_image != (Image *) NULL) {",
      "",
      "[Added Lines]",
      "1198:                       rotate_image=RotateImage(image,(BitmapHeader2.RotAngle &",
      "1200:                       if (rotate_image != (Image *) NULL) {",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "1209:                 }",
      "1213:               image->depth=8;",
      "1214:               if (image->next == (Image *) NULL)",
      "1215:                 goto Finish;",
      "",
      "[Removed Lines]",
      "1212:               AcquireNextImage(image_info,image,exception);",
      "",
      "[Added Lines]",
      "1209:               AcquireNextImage(image_info,image,exception);",
      "",
      "---------------",
      "--- Hunk 8 ---",
      "[Context before]",
      "1303:                   break;",
      "1304:                 case 8:",
      "1305:                   bpp=24;",
      "1307:                 default:",
      "1309:                 }",
      "",
      "[Removed Lines]",
      "1306:                   break;",
      "",
      "[Added Lines]",
      "1303:                   break;",
      "",
      "---------------",
      "--- Hunk 9 ---",
      "[Context before]",
      "1343:                     for(i=0; i< (ssize_t) image->rows; i++)",
      "1344:                       {",
      "1346:                         InsertRow(image,BImgBuff,i,bpp,exception);",
      "1347:                       }",
      "",
      "[Removed Lines]",
      "1345:                         (void) ReadBlob(image,ldblk,BImgBuff);",
      "",
      "[Added Lines]",
      "1342:                         (void) ReadBlob(image,ldblk,BImgBuff);",
      "",
      "---------------",
      "--- Hunk 10 ---",
      "[Context before]",
      "1386:                      (void) RemoveLastImageFromList(&image);",
      "1387:                      AppendImageToList(&image,flip_image);",
      "1388:                     }",
      "1392:                      Tx(0,1)= 0;   Tx(1,1)=-1;   Tx(2,1)=0;",
      "1393:                      Tx(0,2)= 0;   Tx(1,2)=(WPG._2Rect.Y_ur+WPG._2Rect.Y_ll);",
      "",
      "[Removed Lines]",
      "1390:                      float_matrix Tx(3,3);",
      "1391:                      Tx(0,0)= 1;   Tx(1,0)= 0;   Tx(2,0)=0;",
      "",
      "[Added Lines]",
      "1387:                      float_matrix Tx(3,3);",
      "1388:                      Tx(0,0)= 1;   Tx(1,0)= 0;   Tx(2,0)=0;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "b60d1ed0af37c50b91a40937825b4c61e8458095",
      "candidate_info": {
        "commit_hash": "b60d1ed0af37c50b91a40937825b4c61e8458095",
        "repo": "ImageMagick/ImageMagick",
        "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/b60d1ed0af37c50b91a40937825b4c61e8458095",
        "files": [
          "coders/wpg.c"
        ],
        "message": "https://github.com/ImageMagick/ImageMagick/issues/102",
        "before_after_code_files": [
          "coders/wpg.c||coders/wpg.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "coders/wpg.c||coders/wpg.c"
          ],
          "candidate": [
            "coders/wpg.c||coders/wpg.c"
          ]
        }
      },
      "candidate_diff": {
        "coders/wpg.c||coders/wpg.c": [
          "File: coders/wpg.c -> coders/wpg.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "317:         break;",
          "318:       }",
          "321:         q=QueueAuthenticPixels(image,0,y,image->columns,1,exception);",
          "322:         if (q == (Quantum *) NULL)",
          "323:           break;",
          "",
          "[Removed Lines]",
          "320:       {",
          "",
          "[Added Lines]",
          "320:       {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "ade7ab830073081a2d9b929a348ad7e6e82c3656",
      "candidate_info": {
        "commit_hash": "ade7ab830073081a2d9b929a348ad7e6e82c3656",
        "repo": "ImageMagick/ImageMagick",
        "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/ade7ab830073081a2d9b929a348ad7e6e82c3656",
        "files": [
          "coders/wpg.c"
        ],
        "message": "...",
        "before_after_code_files": [
          "coders/wpg.c||coders/wpg.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "coders/wpg.c||coders/wpg.c"
          ],
          "candidate": [
            "coders/wpg.c||coders/wpg.c"
          ]
        }
      },
      "candidate_diff": {
        "coders/wpg.c||coders/wpg.c": [
          "File: coders/wpg.c -> coders/wpg.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1184:                   if(BitmapHeader2.RotAngle & 0x8000)",
          "1185:                     {",
          "1186:                       Image",
          "1189:                       flop_image = FlopImage(image, exception);",
          "1190:                       if (flop_image != (Image *) NULL) {",
          "1191:                         DuplicateBlob(flop_image,image);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1197:                   if(BitmapHeader2.RotAngle & 0x2000)",
          "1198:                     {",
          "1199:                       Image",
          "1202:                       flip_image = FlipImage(image, exception);",
          "1203:                       if (flip_image != (Image *) NULL) {",
          "1204:                         DuplicateBlob(flip_image,image);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1211:                     {",
          "1212:                       Image",
          "1216:                         0x0FFF), exception);",
          "1217:                       if (rotate_image != (Image *) NULL) {",
          "1218:                         DuplicateBlob(rotate_image,image);",
          "",
          "[Removed Lines]",
          "1215:                       rotate_image=RotateImage(image,(BitmapHeader2.RotAngle &",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1379:               if(CTM[0][0]<0 && !image_info->ping)",
          "1381:                   Image",
          "1384:                   flop_image = FlopImage(image, exception);",
          "1385:                   if (flop_image != (Image *) NULL) {",
          "1386:                     DuplicateBlob(flop_image,image);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1396:               if(CTM[1][1]<0 && !image_info->ping)",
          "1398:                   Image",
          "1401:                    flip_image = FlipImage(image, exception);",
          "1402:                    if (flip_image != (Image *) NULL) {",
          "1403:                      DuplicateBlob(flip_image,image);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    }
  ]
}