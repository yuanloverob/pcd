{
  "cve_id": "CVE-2021-29528",
  "cve_desc": "TensorFlow is an end-to-end open source platform for machine learning. An attacker can trigger a division by 0 in `tf.raw_ops.QuantizedMul`. This is because the implementation(https://github.com/tensorflow/tensorflow/blob/55900e961ed4a23b438392024912154a2c2f5e85/tensorflow/core/kernels/quantized_mul_op.cc#L188-L198) does a division by a quantity that is controlled by the caller. The fix will be included in TensorFlow 2.5.0. We will also cherrypick this commit on TensorFlow 2.4.2, TensorFlow 2.3.3, TensorFlow 2.2.3 and TensorFlow 2.1.4, as these are also affected and still in supported range.",
  "repo": "tensorflow/tensorflow",
  "patch_hash": "a1b11d2fdd1e51bfe18bb1ede804f60abfa92da6",
  "patch_info": {
    "commit_hash": "a1b11d2fdd1e51bfe18bb1ede804f60abfa92da6",
    "repo": "tensorflow/tensorflow",
    "commit_url": "https://github.com/tensorflow/tensorflow/commit/a1b11d2fdd1e51bfe18bb1ede804f60abfa92da6",
    "files": [
      "tensorflow/core/kernels/quantized_mul_op.cc"
    ],
    "message": "Fix one division by zero\n\nPiperOrigin-RevId: 369474832\nChange-Id: I1082858ed78d9b2e4738ce30b231955973d49e1e",
    "before_after_code_files": [
      "tensorflow/core/kernels/quantized_mul_op.cc||tensorflow/core/kernels/quantized_mul_op.cc"
    ]
  },
  "patch_diff": {
    "tensorflow/core/kernels/quantized_mul_op.cc||tensorflow/core/kernels/quantized_mul_op.cc": [
      "File: tensorflow/core/kernels/quantized_mul_op.cc -> tensorflow/core/kernels/quantized_mul_op.cc",
      "--- Hunk 1 ---",
      "[Context before]",
      "347:         tensor_num_elements = x.NumElements();",
      "348:         tensor_offset = offset_x;",
      "349:       }",
      "350:       VectorTensorMultiply<T, Toutput>(",
      "351:           vector_data, vector_offset, vector_num_elements, tensor_data,",
      "352:           tensor_offset, tensor_num_elements, z_data);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "350:       if (vector_num_elements == 0) {",
      "351:         context->SetStatus(",
      "352:             errors::InvalidArgument(\"vector must have at least 1 element\"));",
      "353:         return;",
      "354:       }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "781f6d685ada855359970c40650a0d497ea9668f",
      "candidate_info": {
        "commit_hash": "781f6d685ada855359970c40650a0d497ea9668f",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/781f6d685ada855359970c40650a0d497ea9668f",
        "files": [
          "tensorflow/core/kernels/quantized_mul_op.cc"
        ],
        "message": "Fix one division by zero\n\nPiperOrigin-RevId: 369474832\nChange-Id: I1082858ed78d9b2e4738ce30b231955973d49e1e",
        "before_after_code_files": [
          "tensorflow/core/kernels/quantized_mul_op.cc||tensorflow/core/kernels/quantized_mul_op.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/core/kernels/quantized_mul_op.cc||tensorflow/core/kernels/quantized_mul_op.cc"
          ],
          "candidate": [
            "tensorflow/core/kernels/quantized_mul_op.cc||tensorflow/core/kernels/quantized_mul_op.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/core/kernels/quantized_mul_op.cc||tensorflow/core/kernels/quantized_mul_op.cc": [
          "File: tensorflow/core/kernels/quantized_mul_op.cc -> tensorflow/core/kernels/quantized_mul_op.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "347:         tensor_num_elements = x.NumElements();",
          "348:         tensor_offset = offset_x;",
          "349:       }",
          "350:       VectorTensorMultiply<T, Toutput>(",
          "351:           vector_data, vector_offset, vector_num_elements, tensor_data,",
          "352:           tensor_offset, tensor_num_elements, z_data);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "350:       if (vector_num_elements == 0) {",
          "351:         context->SetStatus(",
          "352:             errors::InvalidArgument(\"vector must have at least 1 element\"));",
          "353:         return;",
          "354:       }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "4305d81290a50330ae35b7cf69431c8a2128421f",
      "candidate_info": {
        "commit_hash": "4305d81290a50330ae35b7cf69431c8a2128421f",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/4305d81290a50330ae35b7cf69431c8a2128421f",
        "files": [
          "tensorflow/core/kernels/quantized_mul_op.cc"
        ],
        "message": "Fix one division by zero\n\nPiperOrigin-RevId: 369474832\nChange-Id: I1082858ed78d9b2e4738ce30b231955973d49e1e",
        "before_after_code_files": [
          "tensorflow/core/kernels/quantized_mul_op.cc||tensorflow/core/kernels/quantized_mul_op.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/core/kernels/quantized_mul_op.cc||tensorflow/core/kernels/quantized_mul_op.cc"
          ],
          "candidate": [
            "tensorflow/core/kernels/quantized_mul_op.cc||tensorflow/core/kernels/quantized_mul_op.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/core/kernels/quantized_mul_op.cc||tensorflow/core/kernels/quantized_mul_op.cc": [
          "File: tensorflow/core/kernels/quantized_mul_op.cc -> tensorflow/core/kernels/quantized_mul_op.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "347:         tensor_num_elements = x.NumElements();",
          "348:         tensor_offset = offset_x;",
          "349:       }",
          "350:       VectorTensorMultiply<T, Toutput>(",
          "351:           vector_data, vector_offset, vector_num_elements, tensor_data,",
          "352:           tensor_offset, tensor_num_elements, z_data);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "350:       if (vector_num_elements == 0) {",
          "351:         context->SetStatus(",
          "352:             errors::InvalidArgument(\"vector must have at least 1 element\"));",
          "353:         return;",
          "354:       }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "2fdcef989a366d5dbb78e763af597dd954dcbcd5",
      "candidate_info": {
        "commit_hash": "2fdcef989a366d5dbb78e763af597dd954dcbcd5",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/2fdcef989a366d5dbb78e763af597dd954dcbcd5",
        "files": [
          "tensorflow/core/kernels/quantized_mul_op.cc"
        ],
        "message": "Fix one division by zero\n\nPiperOrigin-RevId: 369474832\nChange-Id: I1082858ed78d9b2e4738ce30b231955973d49e1e",
        "before_after_code_files": [
          "tensorflow/core/kernels/quantized_mul_op.cc||tensorflow/core/kernels/quantized_mul_op.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/core/kernels/quantized_mul_op.cc||tensorflow/core/kernels/quantized_mul_op.cc"
          ],
          "candidate": [
            "tensorflow/core/kernels/quantized_mul_op.cc||tensorflow/core/kernels/quantized_mul_op.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/core/kernels/quantized_mul_op.cc||tensorflow/core/kernels/quantized_mul_op.cc": [
          "File: tensorflow/core/kernels/quantized_mul_op.cc -> tensorflow/core/kernels/quantized_mul_op.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "347:         tensor_num_elements = x.NumElements();",
          "348:         tensor_offset = offset_x;",
          "349:       }",
          "350:       VectorTensorMultiply<T, Toutput>(",
          "351:           vector_data, vector_offset, vector_num_elements, tensor_data,",
          "352:           tensor_offset, tensor_num_elements, z_data);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "350:       if (vector_num_elements == 0) {",
          "351:         context->SetStatus(",
          "352:             errors::InvalidArgument(\"vector must have at least 1 element\"));",
          "353:         return;",
          "354:       }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "098f20431384da2e6a407b650f0f84b3457d4304",
      "candidate_info": {
        "commit_hash": "098f20431384da2e6a407b650f0f84b3457d4304",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/098f20431384da2e6a407b650f0f84b3457d4304",
        "files": [
          "tensorflow/core/kernels/quantized_mul_op.cc"
        ],
        "message": "Fix one division by zero\n\nPiperOrigin-RevId: 369474832\nChange-Id: I1082858ed78d9b2e4738ce30b231955973d49e1e",
        "before_after_code_files": [
          "tensorflow/core/kernels/quantized_mul_op.cc||tensorflow/core/kernels/quantized_mul_op.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/core/kernels/quantized_mul_op.cc||tensorflow/core/kernels/quantized_mul_op.cc"
          ],
          "candidate": [
            "tensorflow/core/kernels/quantized_mul_op.cc||tensorflow/core/kernels/quantized_mul_op.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/core/kernels/quantized_mul_op.cc||tensorflow/core/kernels/quantized_mul_op.cc": [
          "File: tensorflow/core/kernels/quantized_mul_op.cc -> tensorflow/core/kernels/quantized_mul_op.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "347:         tensor_num_elements = x.NumElements();",
          "348:         tensor_offset = offset_x;",
          "349:       }",
          "350:       VectorTensorMultiply<T, Toutput>(",
          "351:           vector_data, vector_offset, vector_num_elements, tensor_data,",
          "352:           tensor_offset, tensor_num_elements, z_data);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "350:       if (vector_num_elements == 0) {",
          "351:         context->SetStatus(",
          "352:             errors::InvalidArgument(\"vector must have at least 1 element\"));",
          "353:         return;",
          "354:       }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "234ec0ebe3c1e2e35cea3dcba2a1fa295d77fa29",
      "candidate_info": {
        "commit_hash": "234ec0ebe3c1e2e35cea3dcba2a1fa295d77fa29",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/234ec0ebe3c1e2e35cea3dcba2a1fa295d77fa29",
        "files": [
          "tensorflow/core/kernels/quantized_mul_op.cc"
        ],
        "message": "Fix one division by zero\n\nPiperOrigin-RevId: 369474832\nChange-Id: I1082858ed78d9b2e4738ce30b231955973d49e1e",
        "before_after_code_files": [
          "tensorflow/core/kernels/quantized_mul_op.cc||tensorflow/core/kernels/quantized_mul_op.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/core/kernels/quantized_mul_op.cc||tensorflow/core/kernels/quantized_mul_op.cc"
          ],
          "candidate": [
            "tensorflow/core/kernels/quantized_mul_op.cc||tensorflow/core/kernels/quantized_mul_op.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/core/kernels/quantized_mul_op.cc||tensorflow/core/kernels/quantized_mul_op.cc": [
          "File: tensorflow/core/kernels/quantized_mul_op.cc -> tensorflow/core/kernels/quantized_mul_op.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "347:         tensor_num_elements = x.NumElements();",
          "348:         tensor_offset = offset_x;",
          "349:       }",
          "350:       VectorTensorMultiply<T, Toutput>(",
          "351:           vector_data, vector_offset, vector_num_elements, tensor_data,",
          "352:           tensor_offset, tensor_num_elements, z_data);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "350:       if (vector_num_elements == 0) {",
          "351:         context->SetStatus(",
          "352:             errors::InvalidArgument(\"vector must have at least 1 element\"));",
          "353:         return;",
          "354:       }",
          "",
          "---------------"
        ]
      }
    }
  ]
}