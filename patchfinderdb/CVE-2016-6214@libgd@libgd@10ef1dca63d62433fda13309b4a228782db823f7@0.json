{
  "cve_id": "CVE-2016-6214",
  "cve_desc": "gd_tga.c in the GD Graphics Library (aka libgd) before 2.2.3 allows remote attackers to cause a denial of service (out-of-bounds read) via a crafted TGA file.",
  "repo": "libgd/libgd",
  "patch_hash": "10ef1dca63d62433fda13309b4a228782db823f7",
  "patch_info": {
    "commit_hash": "10ef1dca63d62433fda13309b4a228782db823f7",
    "repo": "libgd/libgd",
    "commit_url": "https://github.com/libgd/libgd/commit/10ef1dca63d62433fda13309b4a228782db823f7",
    "files": [
      "src/gd_tga.c",
      "tests/tga/.gitignore",
      "tests/tga/CMakeLists.txt",
      "tests/tga/Makemodule.am",
      "tests/tga/bug00247a.c",
      "tests/tga/bug00247a.tga"
    ],
    "message": "Unsupported TGA bpp/alphabit combinations should error gracefully\n\nCurrently, only 24bpp without alphabits and 32bpp with 8 alphabits are\nreally supported. All other combinations will be rejected with a warning.",
    "before_after_code_files": [
      "src/gd_tga.c||src/gd_tga.c",
      "tests/tga/Makemodule.am||tests/tga/Makemodule.am",
      "tests/tga/bug00247a.c||tests/tga/bug00247a.c"
    ]
  },
  "patch_diff": {
    "src/gd_tga.c||src/gd_tga.c": [
      "File: src/gd_tga.c -> src/gd_tga.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "99:    if (tga->bits == TGA_BPP_24) {",
      "101:     bitmap_caret += 3;",
      "103:     register int a = tga->bitmap[bitmap_caret + 3];",
      "",
      "[Removed Lines]",
      "102:    } else if (tga->bits == TGA_BPP_32 || tga->alphabits) {",
      "",
      "[Added Lines]",
      "102:    } else if (tga->bits == TGA_BPP_32 && tga->alphabits) {",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "159:  printf(\"wxh: %i %i\\n\", tga->width, tga->height);",
      "160: #endif",
      "170:   return -1;",
      "172:  }",
      "174:  tga->ident = NULL;",
      "",
      "[Removed Lines]",
      "162:  switch(tga->bits) {",
      "163:  case 8:",
      "164:  case 16:",
      "165:  case 24:",
      "166:  case 32:",
      "167:   break;",
      "168:  default:",
      "169:   gd_error(\"bps %i not supported\", tga->bits);",
      "171:   break;",
      "",
      "[Added Lines]",
      "162:  if (!((tga->bits == TGA_BPP_24 && tga->alphabits == 0)",
      "163:   || (tga->bits == TGA_BPP_32 && tga->alphabits == 8)))",
      "164:  {",
      "165:   gd_error_ex(GD_WARNING, \"gd-tga: %u bits per pixel with %u alpha bits not supported\\n\",",
      "166:    tga->bits, tga->alphabits);",
      "",
      "---------------"
    ],
    "tests/tga/Makemodule.am||tests/tga/Makemodule.am": [
      "File: tests/tga/Makemodule.am -> tests/tga/Makemodule.am",
      "--- Hunk 1 ---",
      "[Context before]",
      "1: libgd_test_programs += \\",
      "2:  tga/bug00084 \\",
      "3:  tga/bug00247 \\",
      "4:  tga/tga_null",
      "6: EXTRA_DIST += \\",
      "7:  tga/CMakeLists.txt \\",
      "8:  tga/bug00084.tga \\",
      "",
      "[Removed Lines]",
      "9:  tga/bug00247.tga",
      "",
      "[Added Lines]",
      "4:  tag/bug00247a \\",
      "10:  tga/bug00247.tga \\",
      "11:  tga/bug00247a.tga",
      "",
      "---------------"
    ],
    "tests/tga/bug00247a.c||tests/tga/bug00247a.c": [
      "File: tests/tga/bug00247a.c -> tests/tga/bug00247a.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "2: We test that a 8bpp TGA file will be gracefully rejected by",
      "3: gdImageCreateFromTga().",
      "6: #include <stdio.h>",
      "8: #include \"gd.h\"",
      "9: #include \"gdtest.h\"",
      "11: int main(int argc, char **argv)",
      "12: {",
      "13:     gdImagePtr im;",
      "14:     FILE *fp = gdTestFileOpen(\"tga/bug00247a.tga\");",
      "15:     im = gdImageCreateFromTga(fp);",
      "16:     gdTestAssert(im == NULL);",
      "17:     fclose(fp);",
      "18:     return gdNumFailures();",
      "19: }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "4d8f54bd0bcede37138db29e371611f334092fc2",
      "candidate_info": {
        "commit_hash": "4d8f54bd0bcede37138db29e371611f334092fc2",
        "repo": "libgd/libgd",
        "commit_url": "https://github.com/libgd/libgd/commit/4d8f54bd0bcede37138db29e371611f334092fc2",
        "files": [
          "tests/tga/.gitignore",
          "tests/tga/CMakeLists.txt",
          "tests/tga/Makemodule.am",
          "tests/tga/bug00248a.c",
          "tests/tga/bug00248a.tga"
        ],
        "message": "Add a further regression test for issue #248",
        "before_after_code_files": [
          "tests/tga/Makemodule.am||tests/tga/Makemodule.am",
          "tests/tga/bug00248a.c||tests/tga/bug00248a.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "tests/tga/Makemodule.am||tests/tga/Makemodule.am"
          ],
          "candidate": [
            "tests/tga/Makemodule.am||tests/tga/Makemodule.am"
          ]
        }
      },
      "candidate_diff": {
        "tests/tga/Makemodule.am||tests/tga/Makemodule.am": [
          "File: tests/tga/Makemodule.am -> tests/tga/Makemodule.am",
          "--- Hunk 1 ---",
          "[Context before]",
          "3:  tga/bug00247 \\",
          "4:  tga/bug00247a \\",
          "5:  tga/bug00248 \\",
          "6:  tga/tga_null",
          "8: EXTRA_DIST += \\",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "6:  tga/bug00248a \\",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "10:  tga/bug00084.tga \\",
          "11:  tga/bug00247.tga \\",
          "12:  tga/bug00247a.tga \\",
          "",
          "[Removed Lines]",
          "13:  tga/bug00248.tga",
          "",
          "[Added Lines]",
          "14:  tga/bug00248.tga \\",
          "15:  tga/bug00248a.tga",
          "",
          "---------------"
        ],
        "tests/tga/bug00248a.c||tests/tga/bug00248a.c": [
          "File: tests/tga/bug00248a.c -> tests/tga/bug00248a.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3: #include <stdio.h>",
          "5: #include \"gd.h\"",
          "6: #include \"gdtest.h\"",
          "8: int main()",
          "9: {",
          "10:     gdImagePtr im;",
          "11:     FILE *fp = gdTestFileOpen(\"tga/bug00248a.tga\");",
          "12:     im = gdImageCreateFromTga(fp);",
          "13:     gdTestAssert(im == NULL);",
          "14:     fclose(fp);",
          "15:     return gdNumFailures();",
          "16: }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "cb1a0b7e54e9aa118270c23a4a6fe560e4590dc9",
      "candidate_info": {
        "commit_hash": "cb1a0b7e54e9aa118270c23a4a6fe560e4590dc9",
        "repo": "libgd/libgd",
        "commit_url": "https://github.com/libgd/libgd/commit/cb1a0b7e54e9aa118270c23a4a6fe560e4590dc9",
        "files": [
          "src/gd_tga.c",
          "tests/tga/.gitignore",
          "tests/tga/CMakeLists.txt",
          "tests/tga/Makemodule.am",
          "tests/tga/bug00247a.c",
          "tests/tga/bug00247a.tga"
        ],
        "message": "Unsupported TGA bpp/alphabit combinations should error gracefully\n\nCurrently, only 24bpp without alphabits and 32bpp with 8 alphabits are\nreally supported. All other combinations will be rejected with a warning.",
        "before_after_code_files": [
          "src/gd_tga.c||src/gd_tga.c",
          "tests/tga/Makemodule.am||tests/tga/Makemodule.am",
          "tests/tga/bug00247a.c||tests/tga/bug00247a.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/gd_tga.c||src/gd_tga.c",
            "tests/tga/Makemodule.am||tests/tga/Makemodule.am",
            "tests/tga/bug00247a.c||tests/tga/bug00247a.c"
          ],
          "candidate": [
            "src/gd_tga.c||src/gd_tga.c",
            "tests/tga/Makemodule.am||tests/tga/Makemodule.am",
            "tests/tga/bug00247a.c||tests/tga/bug00247a.c"
          ]
        }
      },
      "candidate_diff": {
        "src/gd_tga.c||src/gd_tga.c": [
          "File: src/gd_tga.c -> src/gd_tga.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "99:    if (tga->bits == TGA_BPP_24) {",
          "101:     bitmap_caret += 3;",
          "103:     register int a = tga->bitmap[bitmap_caret + 3];",
          "",
          "[Removed Lines]",
          "102:    } else if (tga->bits == TGA_BPP_32 || tga->alphabits) {",
          "",
          "[Added Lines]",
          "102:    } else if (tga->bits == TGA_BPP_32 && tga->alphabits) {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "159:  printf(\"wxh: %i %i\\n\", tga->width, tga->height);",
          "160: #endif",
          "170:   return -1;",
          "172:  }",
          "174:  tga->ident = NULL;",
          "",
          "[Removed Lines]",
          "162:  switch(tga->bits) {",
          "163:  case 8:",
          "164:  case 16:",
          "165:  case 24:",
          "166:  case 32:",
          "167:   break;",
          "168:  default:",
          "169:   gd_error(\"bps %i not supported\", tga->bits);",
          "171:   break;",
          "",
          "[Added Lines]",
          "162:  if (!((tga->bits == TGA_BPP_24 && tga->alphabits == 0)",
          "163:   || (tga->bits == TGA_BPP_32 && tga->alphabits == 8)))",
          "164:  {",
          "165:   gd_error_ex(GD_WARNING, \"gd-tga: %u bits per pixel with %u alpha bits not supported\\n\",",
          "166:    tga->bits, tga->alphabits);",
          "",
          "---------------"
        ],
        "tests/tga/Makemodule.am||tests/tga/Makemodule.am": [
          "File: tests/tga/Makemodule.am -> tests/tga/Makemodule.am",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: libgd_test_programs += \\",
          "2:  tga/bug00084 \\",
          "3:  tga/bug00247 \\",
          "4:  tga/tga_null",
          "6: EXTRA_DIST += \\",
          "7:  tga/CMakeLists.txt \\",
          "8:  tga/bug00084.tga \\",
          "",
          "[Removed Lines]",
          "9:  tga/bug00247.tga",
          "",
          "[Added Lines]",
          "4:  tga/bug00247a \\",
          "10:  tga/bug00247.tga \\",
          "11:  tga/bug00247a.tga",
          "",
          "---------------"
        ],
        "tests/tga/bug00247a.c||tests/tga/bug00247a.c": [
          "File: tests/tga/bug00247a.c -> tests/tga/bug00247a.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2: We test that a 8bpp TGA file will be gracefully rejected by",
          "3: gdImageCreateFromTga().",
          "6: #include <stdio.h>",
          "8: #include \"gd.h\"",
          "9: #include \"gdtest.h\"",
          "11: int main(int argc, char **argv)",
          "12: {",
          "13:     gdImagePtr im;",
          "14:     FILE *fp = gdTestFileOpen(\"tga/bug00247a.tga\");",
          "15:     im = gdImageCreateFromTga(fp);",
          "16:     gdTestAssert(im == NULL);",
          "17:     fclose(fp);",
          "18:     return gdNumFailures();",
          "19: }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "4f8e26f2a40ffaa3a5b77be6a49989a1a42e2b83",
      "candidate_info": {
        "commit_hash": "4f8e26f2a40ffaa3a5b77be6a49989a1a42e2b83",
        "repo": "libgd/libgd",
        "commit_url": "https://github.com/libgd/libgd/commit/4f8e26f2a40ffaa3a5b77be6a49989a1a42e2b83",
        "files": [
          "src/gd_tga.c",
          "tests/tga/CMakeLists.txt",
          "tests/tga/Makemodule.am",
          "tests/tga/tga_read.c",
          "tests/tga/tga_read_rgb.png",
          "tests/tga/tga_read_rgb.tga",
          "tests/tga/tga_read_rgb_rle.tga"
        ],
        "message": "Fix #290: TGA RLE decoding is broken\n\nWe make it work only, for now. Actually, it doesn't make sense that\n`oTga::bitmap` is an `int *` as we're storing only bytes there. If this\nwill be changed, we can even get rid of the `conversion_buffer` in\n`read_image_tga` altogether, and read the image data into the\n`decompression_buffer` (if RLE'd) or the `tga->bitmap` (if uncompressed)\ndirectly.",
        "before_after_code_files": [
          "src/gd_tga.c||src/gd_tga.c",
          "tests/tgMakemodule.am||tests/tga/Makemodule.am",
          "tests/tgtga_read.c||tests/tga/tga_read.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/gd_tga.c||src/gd_tga.c",
            "tests/tga/Makemodule.am||tests/tga/Makemodule.am"
          ],
          "candidate": [
            "src/gd_tga.c||src/gd_tga.c",
            "tests/tgMakemodule.am||tests/tga/Makemodule.am"
          ]
        }
      },
      "candidate_diff": {
        "src/gd_tga.c||src/gd_tga.c": [
          "File: src/gd_tga.c -> src/gd_tga.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "207: {",
          "208:  int pixel_block_size = (tga->bits / 8);",
          "209:  int image_block_size = (tga->width * tga->height) * pixel_block_size;",
          "211:  unsigned char* conversion_buffer = NULL;",
          "212:  int buffer_caret = 0;",
          "213:  int bitmap_caret = 0;",
          "214:  int i = 0;",
          "215:  int encoded_pixels;",
          "217:  if(overflow2(tga->width, tga->height)) {",
          "218:   return -1;",
          "",
          "[Removed Lines]",
          "210:  uint8_t* decompression_buffer = NULL;",
          "",
          "[Added Lines]",
          "210:  int* decompression_buffer = NULL;",
          "216:  int rle_size;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "270:   if (decompression_buffer == NULL) {",
          "271:    return -1;",
          "272:   }",
          "",
          "[Removed Lines]",
          "269:   decompression_buffer = (uint8_t*) gdMalloc(image_block_size * sizeof(uint8_t));",
          "",
          "[Added Lines]",
          "270:   decompression_buffer = (int*) gdMalloc(image_block_size * sizeof(int));",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "277:    return -1;",
          "278:   }",
          "281:    gdFree(conversion_buffer);",
          "282:    gdFree(decompression_buffer);",
          "283:    return -1;",
          "",
          "[Removed Lines]",
          "280:   if (gdGetBuf(conversion_buffer, image_block_size, ctx) != image_block_size) {",
          "",
          "[Added Lines]",
          "281:   rle_size = gdGetBuf(conversion_buffer, image_block_size, ctx);",
          "282:   if (rle_size <= 0) {",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "286:   buffer_caret = 0;",
          "289:    decompression_buffer[buffer_caret] = (int)conversion_buffer[buffer_caret];",
          "290:    buffer_caret++;",
          "291:   }",
          "",
          "[Removed Lines]",
          "288:   while( buffer_caret < image_block_size) {",
          "",
          "[Added Lines]",
          "290:   while( buffer_caret < rle_size) {",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "298:     encoded_pixels = ( ( decompression_buffer[ buffer_caret ] & ~TGA_RLE_FLAG ) + 1 );",
          "299:     buffer_caret++;",
          "302:      gdFree( decompression_buffer );",
          "303:      gdFree( conversion_buffer );",
          "304:      return -1;",
          "305:     }",
          "307:     for (i = 0; i < encoded_pixels; i++) {",
          "309:      bitmap_caret += pixel_block_size;",
          "310:     }",
          "311:     buffer_caret += pixel_block_size;",
          "",
          "[Removed Lines]",
          "301:     if ((bitmap_caret + (encoded_pixels * pixel_block_size)) >= image_block_size) {",
          "308:      memcpy(tga->bitmap + bitmap_caret, decompression_buffer + buffer_caret, pixel_block_size);",
          "",
          "[Added Lines]",
          "303:     if ((bitmap_caret + (encoded_pixels * pixel_block_size)) > image_block_size) {",
          "310:      memcpy(tga->bitmap + bitmap_caret, decompression_buffer + buffer_caret, pixel_block_size * sizeof(int));",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "314:     encoded_pixels = decompression_buffer[ buffer_caret ] + 1;",
          "315:     buffer_caret++;",
          "318:      gdFree( decompression_buffer );",
          "319:      gdFree( conversion_buffer );",
          "320:      return -1;",
          "321:     }",
          "324:     bitmap_caret += (encoded_pixels * pixel_block_size);",
          "325:     buffer_caret += (encoded_pixels * pixel_block_size);",
          "326:    }",
          "",
          "[Removed Lines]",
          "317:     if ((bitmap_caret + (encoded_pixels * pixel_block_size)) >= image_block_size) {",
          "323:     memcpy(tga->bitmap + bitmap_caret, decompression_buffer + buffer_caret, encoded_pixels * pixel_block_size);",
          "",
          "[Added Lines]",
          "319:     if ((bitmap_caret + (encoded_pixels * pixel_block_size)) > image_block_size) {",
          "325:     memcpy(tga->bitmap + bitmap_caret, decompression_buffer + buffer_caret, encoded_pixels * pixel_block_size * sizeof(int));",
          "",
          "---------------"
        ],
        "tests/tgMakemodule.am||tests/tga/Makemodule.am": [
          "File: tests/tgMakemodule.am -> tests/tga/Makemodule.am",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "7:  tga/tga_null \\",
          "8:  tga/tga_read",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "16:  tga/bug00248a.tga \\",
          "17:  tga/tga_read_rgb.png \\",
          "18:  tga/tga_read_rgb.tga \\",
          "19:  tga/tga_read_rgb_rle.tga",
          "",
          "---------------"
        ],
        "tests/tgtga_read.c||tests/tga/tga_read.c": [
          "File: tests/tgtga_read.c -> tests/tga/tga_read.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "6: #include \"gd.h\"",
          "7: #include \"gdtest.h\"",
          "10: static void assert_equals(char *exp, char *orig);",
          "13: int main()",
          "14: {",
          "15:     assert_equals(\"tga_read_rgb.png\", \"tga_read_rgb.tga\");",
          "16:     assert_equals(\"tga_read_rgb.png\", \"tga_read_rgb_rle.tga\");",
          "18:     return gdNumFailures();",
          "19: }",
          "22: static void assert_equals(char *exp, char *orig)",
          "23: {",
          "24:     gdImagePtr im;",
          "25:     FILE *fp;",
          "26:     char *filename;",
          "28:     fp = gdTestFileOpen2(\"tga\", orig);",
          "29:     gdTestAssertMsg(fp != NULL, \"can't open %s\", orig);",
          "31:     im = gdImageCreateFromTga(fp);",
          "32:     gdTestAssertMsg(im != NULL, \"can't read %s\", orig);",
          "33:     fclose(fp);",
          "35:     filename = gdTestFilePath2(\"tga\", exp);",
          "36:     gdAssertImageEqualsToFile(filename, im);",
          "37:     gdFree(filename);",
          "39:     gdImageDestroy(im);",
          "40: }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "bd0b820b8647feefcace20ae13856f6028c6a4dd",
      "candidate_info": {
        "commit_hash": "bd0b820b8647feefcace20ae13856f6028c6a4dd",
        "repo": "libgd/libgd",
        "commit_url": "https://github.com/libgd/libgd/commit/bd0b820b8647feefcace20ae13856f6028c6a4dd",
        "files": [
          "tests/tga/.gitignore",
          "tests/tga/CMakeLists.txt",
          "tests/tga/Makemodule.am",
          "tests/tga/bug00248.c",
          "tests/tga/bug00248.tga"
        ],
        "message": "Tests for #248",
        "before_after_code_files": [
          "tests/tga/Makemodule.am||tests/tga/Makemodule.am",
          "tests/tga/bug00248.c||tests/tga/bug00248.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "tests/tga/Makemodule.am||tests/tga/Makemodule.am"
          ],
          "candidate": [
            "tests/tga/Makemodule.am||tests/tga/Makemodule.am"
          ]
        }
      },
      "candidate_diff": {
        "tests/tga/Makemodule.am||tests/tga/Makemodule.am": [
          "File: tests/tga/Makemodule.am -> tests/tga/Makemodule.am",
          "--- Hunk 1 ---",
          "[Context before]",
          "2:  tga/bug00084 \\",
          "3:  tga/bug00247 \\",
          "4:  tga/bug00247a \\",
          "5:  tga/tga_null",
          "7: EXTRA_DIST += \\",
          "8:  tga/CMakeLists.txt \\",
          "9:  tga/bug00084.tga \\",
          "10:  tga/bug00247.tga \\",
          "",
          "[Removed Lines]",
          "11:  tga/bug00247a.tga",
          "",
          "[Added Lines]",
          "5:  tga/bug00248 \\",
          "12:  tga/bug00247a.tga \\",
          "13:  tga/bug00248.tga",
          "",
          "---------------"
        ],
        "tests/tga/bug00248.c||tests/tga/bug00248.c": [
          "File: tests/tga/bug00248.c -> tests/tga/bug00248.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: #include <stdio.h>",
          "3: #include \"gd.h\"",
          "4: #include \"gdtest.h\"",
          "6: int main(int argc, char **argv)",
          "7: {",
          "8:     gdImagePtr im;",
          "9:     FILE *fp = gdTestFileOpen(\"tga/bug00248.tga\");",
          "10:     im = gdImageCreateFromTga(fp);",
          "11:     gdTestAssert(im == NULL);",
          "12:     fclose(fp);",
          "13:     return gdNumFailures();",
          "14: }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "076e0d19d79e8d9a0112eef9eb727187907eac6f",
      "candidate_info": {
        "commit_hash": "076e0d19d79e8d9a0112eef9eb727187907eac6f",
        "repo": "libgd/libgd",
        "commit_url": "https://github.com/libgd/libgd/commit/076e0d19d79e8d9a0112eef9eb727187907eac6f",
        "files": [
          "src/gd_tga.c",
          "tests/tga/.gitignore",
          "tests/tga/CMakeLists.txt",
          "tests/tga/Makemodule.am",
          "tests/tga/bug00247a.c",
          "tests/tga/bug00247a.tga"
        ],
        "message": "Revert \"Unsupported TGA bpp/alphabit combinations should error gracefully\"\n\nThis reverts commit 10ef1dca63d62433fda13309b4a228782db823f7.\n\nThere are build errors, so we revert for now.",
        "before_after_code_files": [
          "src/gd_tga.c||src/gd_tga.c",
          "tests/tga/Makemodule.am||tests/tga/Makemodule.am",
          "tests/tga/bug00247a.c||tests/tga/bug00247a.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/gd_tga.c||src/gd_tga.c",
            "tests/tga/Makemodule.am||tests/tga/Makemodule.am",
            "tests/tga/bug00247a.c||tests/tga/bug00247a.c"
          ],
          "candidate": [
            "src/gd_tga.c||src/gd_tga.c",
            "tests/tga/Makemodule.am||tests/tga/Makemodule.am",
            "tests/tga/bug00247a.c||tests/tga/bug00247a.c"
          ]
        }
      },
      "candidate_diff": {
        "src/gd_tga.c||src/gd_tga.c": [
          "File: src/gd_tga.c -> src/gd_tga.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "99:    if (tga->bits == TGA_BPP_24) {",
          "101:     bitmap_caret += 3;",
          "103:     register int a = tga->bitmap[bitmap_caret + 3];",
          "",
          "[Removed Lines]",
          "102:    } else if (tga->bits == TGA_BPP_32 && tga->alphabits) {",
          "",
          "[Added Lines]",
          "102:    } else if (tga->bits == TGA_BPP_32 || tga->alphabits) {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "159:  printf(\"wxh: %i %i\\n\", tga->width, tga->height);",
          "160: #endif",
          "167:   return -1;",
          "168:  }",
          "170:  tga->ident = NULL;",
          "",
          "[Removed Lines]",
          "162:  if (!((tga->bits == TGA_BPP_24 && tga->alphabits == 0)",
          "163:   || (tga->bits == TGA_BPP_32 && tga->alphabits == 8)))",
          "164:  {",
          "165:   gd_error_ex(GD_WARNING, \"gd-tga: %u bits per pixel with %u alpha bits not supported\\n\",",
          "166:    tga->bits, tga->alphabits);",
          "",
          "[Added Lines]",
          "162:  switch(tga->bits) {",
          "163:  case 8:",
          "164:  case 16:",
          "165:  case 24:",
          "166:  case 32:",
          "167:   break;",
          "168:  default:",
          "169:   gd_error(\"bps %i not supported\", tga->bits);",
          "171:   break;",
          "",
          "---------------"
        ],
        "tests/tga/Makemodule.am||tests/tga/Makemodule.am": [
          "File: tests/tga/Makemodule.am -> tests/tga/Makemodule.am",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: libgd_test_programs += \\",
          "2:  tga/bug00084 \\",
          "3:  tga/bug00247 \\",
          "5:  tga/tga_null",
          "7: EXTRA_DIST += \\",
          "8:  tga/CMakeLists.txt \\",
          "9:  tga/bug00084.tga \\",
          "",
          "[Removed Lines]",
          "4:  tag/bug00247a \\",
          "10:  tga/bug00247.tga \\",
          "11:  tga/bug00247a.tga",
          "",
          "[Added Lines]",
          "9:  tga/bug00247.tga",
          "",
          "---------------"
        ],
        "tests/tga/bug00247a.c||tests/tga/bug00247a.c": [
          "File: tests/tga/bug00247a.c -> tests/tga/bug00247a.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    }
  ]
}