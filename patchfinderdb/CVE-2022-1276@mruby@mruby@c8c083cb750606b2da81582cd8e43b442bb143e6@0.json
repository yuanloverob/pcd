{
  "cve_id": "CVE-2022-1276",
  "cve_desc": "Out-of-bounds Read in mrb_get_args in GitHub repository mruby/mruby prior to 3.2. Possible arbitrary code execution if being exploited.",
  "repo": "mruby/mruby",
  "patch_hash": "c8c083cb750606b2da81582cd8e43b442bb143e6",
  "patch_info": {
    "commit_hash": "c8c083cb750606b2da81582cd8e43b442bb143e6",
    "repo": "mruby/mruby",
    "commit_url": "https://github.com/mruby/mruby/commit/c8c083cb750606b2da81582cd8e43b442bb143e6",
    "files": [
      "mrbgems/mruby-compiler/core/codegen.c"
    ],
    "message": "codegen.c: need to pack argument when `n==13` too.\n\nBecause we have extra 2 arguments coming (kw and rhs).",
    "before_after_code_files": [
      "mrbgems/mruby-compiler/core/codegen.c||mrbgems/mruby-compiler/core/codegen.c"
    ]
  },
  "patch_diff": {
    "mrbgems/mruby-compiler/core/codegen.c||mrbgems/mruby-compiler/core/codegen.c": [
      "File: mrbgems/mruby-compiler/core/codegen.c -> mrbgems/mruby-compiler/core/codegen.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1905:           }",
      "1906:         }",
      "1909:             pop_n(n);",
      "1910:             genop_2(s, OP_ARRAY, cursp(), n);",
      "1911:             push();",
      "",
      "[Removed Lines]",
      "1908:           if (n == 14) {",
      "",
      "[Added Lines]",
      "1908:           if (n == 13 || n == 14) {",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "0849a2885f81cfd82134992c06df3ccd59052ac7",
      "candidate_info": {
        "commit_hash": "0849a2885f81cfd82134992c06df3ccd59052ac7",
        "repo": "mruby/mruby",
        "commit_url": "https://github.com/mruby/mruby/commit/0849a2885f81cfd82134992c06df3ccd59052ac7",
        "files": [
          "mrbgems/mruby-compiler/core/codegen.c"
        ],
        "message": "codegen.c: stack position may be wrong on assignments.\n\nWhen `[]=` access includes keyword arguments.",
        "before_after_code_files": [
          "mrbgems/mruby-compiler/core/codegen.c||mrbgems/mruby-compiler/core/codegen.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "mrbgems/mruby-compiler/core/codegen.c||mrbgems/mruby-compiler/core/codegen.c"
          ],
          "candidate": [
            "mrbgems/mruby-compiler/core/codegen.c||mrbgems/mruby-compiler/core/codegen.c"
          ]
        }
      },
      "candidate_diff": {
        "mrbgems/mruby-compiler/core/codegen.c||mrbgems/mruby-compiler/core/codegen.c": [
          "File: mrbgems/mruby-compiler/core/codegen.c -> mrbgems/mruby-compiler/core/codegen.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1865:           }",
          "1866:         }",
          "1868:           gen_hash(s, tree->cdr->car->cdr, VAL, 0);",
          "1869:           if (n < 14) {",
          "1870:             n++;",
          "1872:           }",
          "1873:           else {",
          "1875:             genop_2(s, OP_ARYPUSH, cursp(), 1);",
          "1876:           }",
          "1877:         }",
          "1878:       }",
          "1879:       if (rhs) {",
          "",
          "[Removed Lines]",
          "1871:             push();",
          "1874:             pop();",
          "",
          "[Added Lines]",
          "1868:           if (n == 14) {",
          "1869:             pop_n(n);",
          "1870:             genop_2(s, OP_ARRAY, cursp(), n);",
          "1871:             push();",
          "1872:             n = 15;",
          "1873:           }",
          "1879:             pop_n(2);",
          "1882:           push();",
          "",
          "---------------"
        ]
      }
    }
  ]
}