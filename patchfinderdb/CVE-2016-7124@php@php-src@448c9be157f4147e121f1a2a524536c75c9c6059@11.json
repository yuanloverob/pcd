{
  "cve_id": "CVE-2016-7124",
  "cve_desc": "ext/standard/var_unserializer.c in PHP before 5.6.25 and 7.x before 7.0.10 mishandles certain invalid objects, which allows remote attackers to cause a denial of service or possibly have unspecified other impact via crafted serialized data that leads to a (1) __destruct call or (2) magic method call.",
  "repo": "php/php-src",
  "patch_hash": "448c9be157f4147e121f1a2a524536c75c9c6059",
  "patch_info": {
    "commit_hash": "448c9be157f4147e121f1a2a524536c75c9c6059",
    "repo": "php/php-src",
    "commit_url": "https://github.com/php/php-src/commit/448c9be157f4147e121f1a2a524536c75c9c6059",
    "files": [
      "ext/standard/tests/strings/bug72663.phpt",
      "ext/standard/tests/strings/bug72663_2.phpt",
      "ext/standard/var_unserializer.c",
      "ext/standard/var_unserializer.re"
    ],
    "message": "Fix bug #72663 - destroy broken object when unserializing",
    "before_after_code_files": [
      "ext/standard/tests/strings/bug72663.phpt||ext/standard/tests/strings/bug72663.phpt",
      "ext/standard/tests/strings/bug72663_2.phpt||ext/standard/tests/strings/bug72663_2.phpt",
      "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
      "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
    ]
  },
  "patch_diff": {
    "ext/standard/tests/strings/bug72663.phpt||ext/standard/tests/strings/bug72663.phpt": [
      "File: ext/standard/tests/strings/bug72663.phpt -> ext/standard/tests/strings/bug72663.phpt",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: --TEST--",
      "2: Bug #72663: Create an Unexpected Object and Don't Invoke __wakeup() in Deserialization",
      "3: --FILE--",
      "4: <?php",
      "5: class obj implements Serializable {",
      "6:     var $data;",
      "7:     function serialize() {",
      "8:         return serialize($this->data);",
      "9:     }",
      "10:     function unserialize($data) {",
      "11:         $this->data = unserialize($data);",
      "12:     }",
      "13: }",
      "15: $inner = 'a:1:{i:0;O:9:\"Exception\":2:{s:7:\"'.\"\\0\".'*'.\"\\0\".'file\";R:4;}';",
      "16: $exploit = 'a:2:{i:0;C:3:\"obj\":'.strlen($inner).':{'.$inner.'}i:1;R:4;}';",
      "18: $data = unserialize($exploit);",
      "19: echo $data[1];",
      "20: ?>",
      "21: DONE",
      "22: --EXPECTF--",
      "23: Notice: unserialize(): Unexpected end of serialized data in %sbug72663.php on line %d",
      "25: Notice: unserialize(): Error at offset 46 of 47 bytes in %sbug72663.php on line %d",
      "26: DONE",
      "",
      "---------------"
    ],
    "ext/standard/tests/strings/bug72663_2.phpt||ext/standard/tests/strings/bug72663_2.phpt": [
      "File: ext/standard/tests/strings/bug72663_2.phpt -> ext/standard/tests/strings/bug72663_2.phpt",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: --TEST--",
      "2: Bug #72663: Create an Unexpected Object and Don't Invoke __wakeup() in Deserialization",
      "3: --FILE--",
      "4: <?php",
      "6: ini_set('session.serialize_handler', 'php_serialize');",
      "7: session_start();",
      "8: $sess = 'O:9:\"Exception\":2:{s:7:\"'.\"\\0\".'*'.\"\\0\".'file\";R:1;}';",
      "9: session_decode($sess);",
      "10: var_dump($_SESSION);",
      "11: ?>",
      "12: DONE",
      "13: --EXPECTF--",
      "14: Notice: session_decode(): Unexpected end of serialized data in %sbug72663_2.php on line %d",
      "15: array(0) {",
      "16: }",
      "17: DONE",
      "",
      "---------------"
    ],
    "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
      "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "434:  }",
      "436:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_OBJPROP_PP(rval), elements, 1)) {",
      "437:   return 0;",
      "438:  }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "438:      zend_hash_clean(Z_OBJPROP_PP(rval));",
      "439:      ZVAL_NULL(*rval);",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "486: {",
      "487:  YYCTYPE yych;",
      "488:  static const unsigned char yybm[] = {",
      "",
      "[Removed Lines]",
      "485: #line 486 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "488: #line 489 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "542:  yych = *(YYMARKER = ++YYCURSOR);",
      "543:  if (yych == ':') goto yy95;",
      "544: yy3:",
      "546:  { return 0; }",
      "548: yy4:",
      "549:  yych = *(YYMARKER = ++YYCURSOR);",
      "550:  if (yych == ':') goto yy89;",
      "",
      "[Removed Lines]",
      "545: #line 851 \"ext/standard/var_unserializer.re\"",
      "547: #line 548 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "548: #line 854 \"ext/standard/var_unserializer.re\"",
      "550: #line 551 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "587:  goto yy3;",
      "588: yy14:",
      "589:  ++YYCURSOR;",
      "591:  {",
      "593:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
      "595: }",
      "597: yy16:",
      "598:  yych = *++YYCURSOR;",
      "599:  goto yy3;",
      "",
      "[Removed Lines]",
      "590: #line 845 \"ext/standard/var_unserializer.re\"",
      "596: #line 597 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "593: #line 848 \"ext/standard/var_unserializer.re\"",
      "599: #line 600 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "619:  if (yybm[0+yych] & 128) {",
      "620:   goto yy20;",
      "621:  }",
      "623:  yych = *++YYCURSOR;",
      "624:  if (yych != '\"') goto yy18;",
      "625:  ++YYCURSOR;",
      "627:  {",
      "628:  size_t len, len2, len3, maxlen;",
      "629:  long elements;",
      "",
      "[Removed Lines]",
      "622:  if (yych != ':') goto yy18;",
      "626: #line 698 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "625:  if (yych <= '/') goto yy18;",
      "626:  if (yych >= ';') goto yy18;",
      "630: #line 701 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "771:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
      "772: }",
      "774: yy25:",
      "775:  yych = *++YYCURSOR;",
      "776:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "773: #line 774 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "777: #line 778 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "795:  yych = *++YYCURSOR;",
      "796:  if (yych != '\"') goto yy18;",
      "797:  ++YYCURSOR;",
      "799:  {",
      "800:     if (!var_hash) return 0;",
      "",
      "[Removed Lines]",
      "798: #line 689 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "802: #line 692 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 8 ---",
      "[Context before]",
      "804:  return object_common2(UNSERIALIZE_PASSTHRU,",
      "805:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
      "806: }",
      "808: yy32:",
      "809:  yych = *++YYCURSOR;",
      "810:  if (yych == '+') goto yy33;",
      "",
      "[Removed Lines]",
      "807: #line 808 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "811: #line 812 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 9 ---",
      "[Context before]",
      "825:  yych = *++YYCURSOR;",
      "826:  if (yych != '{') goto yy18;",
      "827:  ++YYCURSOR;",
      "829:  {",
      "830:  long elements = parse_iv(start + 2);",
      "",
      "[Removed Lines]",
      "828: #line 668 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "832: #line 671 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 10 ---",
      "[Context before]",
      "847:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
      "848: }",
      "850: yy39:",
      "851:  yych = *++YYCURSOR;",
      "852:  if (yych == '+') goto yy40;",
      "",
      "[Removed Lines]",
      "849: #line 850 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "853: #line 854 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 11 ---",
      "[Context before]",
      "867:  yych = *++YYCURSOR;",
      "868:  if (yych != '\"') goto yy18;",
      "869:  ++YYCURSOR;",
      "871:  {",
      "872:  size_t len, maxlen;",
      "873:  char *str;",
      "",
      "[Removed Lines]",
      "870: #line 633 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "874: #line 636 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 12 ---",
      "[Context before]",
      "902:  ZVAL_STRINGL(*rval, str, len, 0);",
      "903:  return 1;",
      "904: }",
      "906: yy46:",
      "907:  yych = *++YYCURSOR;",
      "908:  if (yych == '+') goto yy47;",
      "",
      "[Removed Lines]",
      "905: #line 906 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "909: #line 910 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 13 ---",
      "[Context before]",
      "923:  yych = *++YYCURSOR;",
      "924:  if (yych != '\"') goto yy18;",
      "925:  ++YYCURSOR;",
      "927:  {",
      "928:  size_t len, maxlen;",
      "929:  char *str;",
      "",
      "[Removed Lines]",
      "926: #line 600 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "930: #line 603 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 14 ---",
      "[Context before]",
      "956:  ZVAL_STRINGL(*rval, str, len, 1);",
      "957:  return 1;",
      "958: }",
      "960: yy53:",
      "961:  yych = *++YYCURSOR;",
      "962:  if (yych <= '/') {",
      "",
      "[Removed Lines]",
      "959: #line 960 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "963: #line 964 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 15 ---",
      "[Context before]",
      "1044:  }",
      "1045: yy63:",
      "1046:  ++YYCURSOR;",
      "1048:  {",
      "1049: #if SIZEOF_LONG == 4",
      "1050: use_double:",
      "",
      "[Removed Lines]",
      "1047: #line 590 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1051: #line 593 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 16 ---",
      "[Context before]",
      "1054:  ZVAL_DOUBLE(*rval, zend_strtod((const char *)start + 2, NULL));",
      "1055:  return 1;",
      "1056: }",
      "1058: yy65:",
      "1059:  yych = *++YYCURSOR;",
      "1060:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1057: #line 1058 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1061: #line 1062 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 17 ---",
      "[Context before]",
      "1113:  yych = *++YYCURSOR;",
      "1114:  if (yych != ';') goto yy18;",
      "1115:  ++YYCURSOR;",
      "1117:  {",
      "1119:  INIT_PZVAL(*rval);",
      "",
      "[Removed Lines]",
      "1116: #line 575 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1120: #line 578 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 18 ---",
      "[Context before]",
      "1129:  return 1;",
      "1130: }",
      "1132: yy76:",
      "1133:  yych = *++YYCURSOR;",
      "1134:  if (yych == 'N') goto yy73;",
      "",
      "[Removed Lines]",
      "1131: #line 1132 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1135: #line 1136 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 19 ---",
      "[Context before]",
      "1155:  if (yych <= '9') goto yy79;",
      "1156:  if (yych != ';') goto yy18;",
      "1157:  ++YYCURSOR;",
      "1159:  {",
      "1160: #if SIZEOF_LONG == 4",
      "1161:  int digits = YYCURSOR - start - 3;",
      "",
      "[Removed Lines]",
      "1158: #line 548 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1162: #line 551 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 20 ---",
      "[Context before]",
      "1182:  ZVAL_LONG(*rval, parse_iv(start + 2));",
      "1183:  return 1;",
      "1184: }",
      "1186: yy83:",
      "1187:  yych = *++YYCURSOR;",
      "1188:  if (yych <= '/') goto yy18;",
      "",
      "[Removed Lines]",
      "1185: #line 1186 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1189: #line 1190 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 21 ---",
      "[Context before]",
      "1190:  yych = *++YYCURSOR;",
      "1191:  if (yych != ';') goto yy18;",
      "1192:  ++YYCURSOR;",
      "1194:  {",
      "1196:  INIT_PZVAL(*rval);",
      "1197:  ZVAL_BOOL(*rval, parse_iv(start + 2));",
      "1198:  return 1;",
      "1199: }",
      "1201: yy87:",
      "1202:  ++YYCURSOR;",
      "1204:  {",
      "1206:  INIT_PZVAL(*rval);",
      "1207:  ZVAL_NULL(*rval);",
      "1208:  return 1;",
      "1209: }",
      "1211: yy89:",
      "1212:  yych = *++YYCURSOR;",
      "1213:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1193: #line 541 \"ext/standard/var_unserializer.re\"",
      "1200: #line 1201 \"ext/standard/var_unserializer.c\"",
      "1203: #line 534 \"ext/standard/var_unserializer.re\"",
      "1210: #line 1211 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1197: #line 544 \"ext/standard/var_unserializer.re\"",
      "1204: #line 1205 \"ext/standard/var_unserializer.c\"",
      "1207: #line 537 \"ext/standard/var_unserializer.re\"",
      "1214: #line 1215 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 22 ---",
      "[Context before]",
      "1230:  if (yych <= '9') goto yy91;",
      "1231:  if (yych != ';') goto yy18;",
      "1232:  ++YYCURSOR;",
      "1234:  {",
      "1235:  long id;",
      "",
      "[Removed Lines]",
      "1233: #line 511 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1237: #line 514 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 23 ---",
      "[Context before]",
      "1254:  return 1;",
      "1255: }",
      "1257: yy95:",
      "1258:  yych = *++YYCURSOR;",
      "1259:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1256: #line 1257 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1260: #line 1261 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 24 ---",
      "[Context before]",
      "1276:  if (yych <= '9') goto yy97;",
      "1277:  if (yych != ';') goto yy18;",
      "1278:  ++YYCURSOR;",
      "1280:  {",
      "1281:  long id;",
      "",
      "[Removed Lines]",
      "1279: #line 490 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1283: #line 493 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 25 ---",
      "[Context before]",
      "1298:  return 1;",
      "1299: }",
      "1301: }",
      "1305:  return 0;",
      "",
      "[Removed Lines]",
      "1300: #line 1301 \"ext/standard/var_unserializer.c\"",
      "1302: #line 853 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1304: #line 1305 \"ext/standard/var_unserializer.c\"",
      "1306: #line 856 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------"
    ],
    "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
      "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
      "--- Hunk 1 ---",
      "[Context before]",
      "438:  }",
      "440:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_OBJPROP_PP(rval), elements, 1)) {",
      "441:   return 0;",
      "442:  }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "442:      zend_hash_clean(Z_OBJPROP_PP(rval));",
      "443:      ZVAL_NULL(*rval);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "8b0deb8cd2d54fb9f786a87feb95ee2a00771f6f",
      "candidate_info": {
        "commit_hash": "8b0deb8cd2d54fb9f786a87feb95ee2a00771f6f",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/8b0deb8cd2d54fb9f786a87feb95ee2a00771f6f",
        "files": [
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "fix unserializer patch",
        "before_after_code_files": [
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "366:     if (Z_TYPE_P(old_data) == IS_INDIRECT) {",
          "367:      old_data = Z_INDIRECT_P(old_data);",
          "368:     }",
          "370:     var_push_dtor(var_hash, old_data);",
          "372:    }",
          "374:   }",
          "376:   zval_dtor(&key);",
          "",
          "[Removed Lines]",
          "369:     zval_ptr_dtor(old_data);",
          "371:     ZVAL_UNDEF(old_data);",
          "373:    data = zend_hash_update(ht, Z_STR(key), &d);",
          "",
          "[Added Lines]",
          "371:    data = zend_hash_update_ind(ht, Z_STR(key), &d);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "509:  start = cursor;",
          "513: {",
          "514:  YYCTYPE yych;",
          "515:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "512: #line 513 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "510: #line 511 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "569:  yych = *(YYMARKER = ++YYCURSOR);",
          "570:  if (yych == ':') goto yy95;",
          "571: yy3:",
          "573:  { return 0; }",
          "575: yy4:",
          "576:  yych = *(YYMARKER = ++YYCURSOR);",
          "577:  if (yych == ':') goto yy89;",
          "",
          "[Removed Lines]",
          "572: #line 860 \"ext/standard/var_unserializer.re\"",
          "574: #line 575 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "570: #line 858 \"ext/standard/var_unserializer.re\"",
          "572: #line 573 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "614:  goto yy3;",
          "615: yy14:",
          "616:  ++YYCURSOR;",
          "618:  {",
          "620:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
          "622: }",
          "624: yy16:",
          "625:  yych = *++YYCURSOR;",
          "626:  goto yy3;",
          "",
          "[Removed Lines]",
          "617: #line 854 \"ext/standard/var_unserializer.re\"",
          "623: #line 624 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "615: #line 852 \"ext/standard/var_unserializer.re\"",
          "621: #line 622 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "651:  yych = *++YYCURSOR;",
          "652:  if (yych != '\"') goto yy18;",
          "653:  ++YYCURSOR;",
          "655:  {",
          "656:  size_t len, len2, len3, maxlen;",
          "657:  zend_long elements;",
          "",
          "[Removed Lines]",
          "654: #line 709 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "652: #line 707 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "797:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "798: }",
          "800: yy25:",
          "801:  yych = *++YYCURSOR;",
          "802:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "799: #line 800 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "797: #line 798 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "821:  yych = *++YYCURSOR;",
          "822:  if (yych != '\"') goto yy18;",
          "823:  ++YYCURSOR;",
          "825:  {",
          "",
          "[Removed Lines]",
          "824: #line 701 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "822: #line 699 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "829:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "830:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "831: }",
          "833: yy32:",
          "834:  yych = *++YYCURSOR;",
          "835:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "832: #line 833 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "830: #line 831 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "850:  yych = *++YYCURSOR;",
          "851:  if (yych != '{') goto yy18;",
          "852:  ++YYCURSOR;",
          "854:  {",
          "855:  zend_long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "853: #line 680 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "851: #line 678 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "872:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "873: }",
          "875: yy39:",
          "876:  yych = *++YYCURSOR;",
          "877:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "874: #line 875 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "872: #line 873 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "892:  yych = *++YYCURSOR;",
          "893:  if (yych != '\"') goto yy18;",
          "894:  ++YYCURSOR;",
          "896:  {",
          "897:  size_t len, maxlen;",
          "898:  zend_string *str;",
          "",
          "[Removed Lines]",
          "895: #line 652 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "893: #line 650 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "920:  ZVAL_STR(rval, str);",
          "921:  return 1;",
          "922: }",
          "924: yy46:",
          "925:  yych = *++YYCURSOR;",
          "926:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "923: #line 924 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "921: #line 922 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "941:  yych = *++YYCURSOR;",
          "942:  if (yych != '\"') goto yy18;",
          "943:  ++YYCURSOR;",
          "945:  {",
          "946:  size_t len, maxlen;",
          "947:  char *str;",
          "",
          "[Removed Lines]",
          "944: #line 625 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "942: #line 623 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "968:  ZVAL_STRINGL(rval, str, len);",
          "969:  return 1;",
          "970: }",
          "972: yy53:",
          "973:  yych = *++YYCURSOR;",
          "974:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "971: #line 972 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "969: #line 970 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1056:  }",
          "1057: yy63:",
          "1058:  ++YYCURSOR;",
          "1060:  {",
          "1061: #if SIZEOF_ZEND_LONG == 4",
          "1062: use_double:",
          "",
          "[Removed Lines]",
          "1059: #line 616 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1057: #line 614 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1065:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1066:  return 1;",
          "1067: }",
          "1069: yy65:",
          "1070:  yych = *++YYCURSOR;",
          "1071:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1068: #line 1069 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1066: #line 1067 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1124:  yych = *++YYCURSOR;",
          "1125:  if (yych != ';') goto yy18;",
          "1126:  ++YYCURSOR;",
          "1128:  {",
          "",
          "[Removed Lines]",
          "1127: #line 600 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1125: #line 598 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "1141:  return 1;",
          "1142: }",
          "1144: yy76:",
          "1145:  yych = *++YYCURSOR;",
          "1146:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1143: #line 1144 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1141: #line 1142 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1167:  if (yych <= '9') goto yy79;",
          "1168:  if (yych != ';') goto yy18;",
          "1169:  ++YYCURSOR;",
          "1171:  {",
          "1172: #if SIZEOF_ZEND_LONG == 4",
          "1173:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1170: #line 574 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1168: #line 572 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1193:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1194:  return 1;",
          "1195: }",
          "1197: yy83:",
          "1198:  yych = *++YYCURSOR;",
          "1199:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1196: #line 1197 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1194: #line 1195 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "1201:  yych = *++YYCURSOR;",
          "1202:  if (yych != ';') goto yy18;",
          "1203:  ++YYCURSOR;",
          "1205:  {",
          "1207:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1208:  return 1;",
          "1209: }",
          "1211: yy87:",
          "1212:  ++YYCURSOR;",
          "1214:  {",
          "1216:  ZVAL_NULL(rval);",
          "1217:  return 1;",
          "1218: }",
          "1220: yy89:",
          "1221:  yych = *++YYCURSOR;",
          "1222:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1204: #line 568 \"ext/standard/var_unserializer.re\"",
          "1210: #line 1211 \"ext/standard/var_unserializer.c\"",
          "1213: #line 562 \"ext/standard/var_unserializer.re\"",
          "1219: #line 1220 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1202: #line 566 \"ext/standard/var_unserializer.re\"",
          "1208: #line 1209 \"ext/standard/var_unserializer.c\"",
          "1211: #line 560 \"ext/standard/var_unserializer.re\"",
          "1217: #line 1218 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "1239:  if (yych <= '9') goto yy91;",
          "1240:  if (yych != ';') goto yy18;",
          "1241:  ++YYCURSOR;",
          "1243:  {",
          "1244:  zend_long id;",
          "",
          "[Removed Lines]",
          "1242: #line 539 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1240: #line 537 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "1263:  return 1;",
          "1264: }",
          "1266: yy95:",
          "1267:  yych = *++YYCURSOR;",
          "1268:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1265: #line 1266 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1263: #line 1264 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "1285:  if (yych <= '9') goto yy97;",
          "1286:  if (yych != ';') goto yy18;",
          "1287:  ++YYCURSOR;",
          "1289:  {",
          "1290:  zend_long id;",
          "",
          "[Removed Lines]",
          "1288: #line 517 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1286: #line 515 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 25 ---",
          "[Context before]",
          "1308:  return 1;",
          "1309: }",
          "1311: }",
          "1315:  return 0;",
          "",
          "[Removed Lines]",
          "1310: #line 1311 \"ext/standard/var_unserializer.c\"",
          "1312: #line 862 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1308: #line 1309 \"ext/standard/var_unserializer.c\"",
          "1310: #line 860 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "370:     if (Z_TYPE_P(old_data) == IS_INDIRECT) {",
          "371:      old_data = Z_INDIRECT_P(old_data);",
          "372:     }",
          "374:     var_push_dtor(var_hash, old_data);",
          "376:    }",
          "378:   }",
          "380:   zval_dtor(&key);",
          "",
          "[Removed Lines]",
          "373:     zval_ptr_dtor(old_data);",
          "375:     ZVAL_UNDEF(old_data);",
          "377:    data = zend_hash_update(ht, Z_STR(key), &d);",
          "",
          "[Added Lines]",
          "375:    data = zend_hash_update_ind(ht, Z_STR(key), &d);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "61f2f5a0f760157f9c9d32d7d3df2be47a73e74d",
      "candidate_info": {
        "commit_hash": "61f2f5a0f760157f9c9d32d7d3df2be47a73e74d",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/61f2f5a0f760157f9c9d32d7d3df2be47a73e74d",
        "files": [
          "ext/standard/tests/serialize/bug72663_2.phpt",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Bug #72663 - part 2\n\nIf a (nested) unserialize() call fails, we remove all the values\nthat were inserted into var_hash during that call. This prevents\ntheir use in other unserializations in the same context.",
        "before_after_code_files": [
          "ext/standard/tests/serialize/bug72663_2.phpt||ext/standard/tests/serialize/bug72663_2.phpt",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/tests/serialize/bug72663_2.phpt||ext/standard/tests/serialize/bug72663_2.phpt": [
          "File: ext/standard/tests/serialize/bug72663_2.phpt -> ext/standard/tests/serialize/bug72663_2.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #72663 (2): Don't allow references into failed unserialize",
          "3: --FILE--",
          "4: <?php",
          "6: class obj implements Serializable {",
          "7:     public $data;",
          "8:     function serialize() {",
          "9:         return serialize($this->data);",
          "10:     }",
          "11:     function unserialize($data) {",
          "12:         $this->data = unserialize($data);",
          "13:     }",
          "14: }",
          "16: $inner = 'a:1:{i:0;O:9:\"Exception\":2:{s:7:\"'.\"\\0\".'*'.\"\\0\".'file\";R:4;}';",
          "17: $exploit = 'a:2:{i:0;C:3:\"obj\":'.strlen($inner).':{'.$inner.'}i:1;R:4;}';",
          "18: var_dump(unserialize($exploit));",
          "20: ?>",
          "21: --EXPECTF--",
          "22: Notice: unserialize(): Unexpected end of serialized data in %s on line %d",
          "24: Notice: unserialize(): Error at offset 46 of 47 bytes in %s on line %d",
          "26: Notice: unserialize(): Error at offset 79 of 80 bytes in %s on line %d",
          "27: bool(false)",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "301: #define UNSERIALIZE_PARAMETER zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash, HashTable *classes",
          "302: #define UNSERIALIZE_PASSTHRU rval, p, max, var_hash, classes",
          "304: static zend_always_inline int process_nested_data(UNSERIALIZE_PARAMETER, HashTable *ht, zend_long elements, int objprops)",
          "305: {",
          "306:  while (elements-- > 0) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "304: static int php_var_unserialize_internal(UNSERIALIZE_PARAMETER);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "310:   ZVAL_UNDEF(&key);",
          "313:    zval_dtor(&key);",
          "314:    return 0;",
          "315:   }",
          "",
          "[Removed Lines]",
          "312:   if (!php_var_unserialize_ex(&key, p, max, NULL, classes)) {",
          "",
          "[Added Lines]",
          "314:   if (!php_var_unserialize_internal(&key, p, max, NULL, classes)) {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "365:    }",
          "366:   }",
          "369:    zval_dtor(&key);",
          "370:    return 0;",
          "371:   }",
          "",
          "[Removed Lines]",
          "368:   if (!php_var_unserialize_ex(data, p, max, var_hash, classes)) {",
          "",
          "[Added Lines]",
          "370:   if (!php_var_unserialize_internal(data, p, max, var_hash, classes)) {",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "502:  return php_var_unserialize_ex(UNSERIALIZE_PASSTHRU);",
          "503: }",
          "506: PHPAPI int php_var_unserialize_ex(UNSERIALIZE_PARAMETER)",
          "507: {",
          "508:  const unsigned char *cursor, *limit, *marker, *start;",
          "509:  zval *rval_ref;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "508: {",
          "509:  var_entries *orig_var_entries = (*var_hash)->last;",
          "510:  zend_long orig_used_slots = orig_var_entries ? orig_var_entries->used_slots : 0;",
          "511:  int result;",
          "513:  result = php_var_unserialize_internal(UNSERIALIZE_PASSTHRU);",
          "515:  if (!result) {",
          "519:   var_entries *e = orig_var_entries;",
          "520:   zend_long s = orig_used_slots;",
          "521:   while (e) {",
          "522:    for (; s < e->used_slots; s++) {",
          "523:     e->data[s] = NULL;",
          "524:    }",
          "526:    e = e->next;",
          "527:    s = 0;",
          "528:   }",
          "529:  }",
          "531:  return result;",
          "532: }",
          "534: static int php_var_unserialize_internal(UNSERIALIZE_PARAMETER)",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "522:  start = cursor;",
          "526: {",
          "527:  YYCTYPE yych;",
          "528:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "525: #line 526 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "553: #line 554 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "305: #define UNSERIALIZE_PARAMETER zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash, HashTable *classes",
          "306: #define UNSERIALIZE_PASSTHRU rval, p, max, var_hash, classes",
          "308: static zend_always_inline int process_nested_data(UNSERIALIZE_PARAMETER, HashTable *ht, zend_long elements, int objprops)",
          "309: {",
          "310:  while (elements-- > 0) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "308: static int php_var_unserialize_internal(UNSERIALIZE_PARAMETER);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "314:   ZVAL_UNDEF(&key);",
          "317:    zval_dtor(&key);",
          "318:    return 0;",
          "319:   }",
          "",
          "[Removed Lines]",
          "316:   if (!php_var_unserialize_ex(&key, p, max, NULL, classes)) {",
          "",
          "[Added Lines]",
          "318:   if (!php_var_unserialize_internal(&key, p, max, NULL, classes)) {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "369:    }",
          "370:   }",
          "373:    zval_dtor(&key);",
          "374:    return 0;",
          "375:   }",
          "",
          "[Removed Lines]",
          "372:   if (!php_var_unserialize_ex(data, p, max, var_hash, classes)) {",
          "",
          "[Added Lines]",
          "374:   if (!php_var_unserialize_internal(data, p, max, var_hash, classes)) {",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "506:  return php_var_unserialize_ex(UNSERIALIZE_PASSTHRU);",
          "507: }",
          "510: PHPAPI int php_var_unserialize_ex(UNSERIALIZE_PARAMETER)",
          "511: {",
          "512:  const unsigned char *cursor, *limit, *marker, *start;",
          "513:  zval *rval_ref;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "512: {",
          "513:  var_entries *orig_var_entries = (*var_hash)->last;",
          "514:  zend_long orig_used_slots = orig_var_entries ? orig_var_entries->used_slots : 0;",
          "515:  int result;",
          "517:  result = php_var_unserialize_internal(UNSERIALIZE_PASSTHRU);",
          "519:  if (!result) {",
          "523:   var_entries *e = orig_var_entries;",
          "524:   zend_long s = orig_used_slots;",
          "525:   while (e) {",
          "526:    for (; s < e->used_slots; s++) {",
          "527:     e->data[s] = NULL;",
          "528:    }",
          "530:    e = e->next;",
          "531:    s = 0;",
          "532:   }",
          "533:  }",
          "535:  return result;",
          "536: }",
          "538: static int php_var_unserialize_internal(UNSERIALIZE_PARAMETER)",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "fa2125df6766bb7edac0a0bf433940465da9af4b",
      "candidate_info": {
        "commit_hash": "fa2125df6766bb7edac0a0bf433940465da9af4b",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/fa2125df6766bb7edac0a0bf433940465da9af4b",
        "files": [
          "ext/exif/exif.c",
          "ext/exif/tests/bug73737.phpt",
          "ext/exif/tests/bug73737.tiff",
          "ext/phar/phar.c",
          "ext/phar/tests/bug73764.phar",
          "ext/phar/tests/bug73764.phpt",
          "ext/phar/tests/bug73768.phar",
          "ext/phar/tests/bug73768.phpt",
          "ext/standard/tests/serialize/bug73825.phpt",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Merge branch 'PHP-5.6.30' into PHP-5.6\n\n* PHP-5.6.30:\n  Fix bug #73737 FPE when parsing a tag format\n  Fix bug #73773 - Seg fault when loading hostile phar\n  Fix bug #73825 - Heap out of bounds read on unserialize in finish_nested_data()\n  Fix bug #73768 - Memory corruption when loading hostile phar\n  Fix int overflows in phar (bug #73764)",
        "before_after_code_files": [
          "ext/exif/exif.c||ext/exif/exif.c",
          "ext/exif/tests/bug73737.phpt||ext/exif/tests/bug73737.phpt",
          "ext/phar/phar.c||ext/phar/phar.c",
          "ext/phar/tests/bug73764.phpt||ext/phar/tests/bug73764.phpt",
          "ext/phar/tests/bug73768.phpt||ext/phar/tests/bug73768.phpt",
          "ext/standard/tests/serialize/bug73825.phpt||ext/standard/tests/serialize/bug73825.phpt",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/exif/exif.c||ext/exif/exif.c": [
          "File: ext/exif/exif.c -> ext/exif/exif.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1303:    if (s_den == 0) {",
          "1304:     return 0;",
          "1305:    } else {",
          "1307:    }",
          "1309:   case TAG_FMT_SSHORT:    return php_ifd_get16u(value, motorola_intel);",
          "",
          "[Removed Lines]",
          "1306:     return php_ifd_get32s(value, motorola_intel) / s_den;",
          "",
          "[Added Lines]",
          "1306:     return (size_t)((double)php_ifd_get32s(value, motorola_intel) / s_den);",
          "",
          "---------------"
        ],
        "ext/exif/tests/bug73737.phpt||ext/exif/tests/bug73737.phpt": [
          "File: ext/exif/tests/bug73737.phpt -> ext/exif/tests/bug73737.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #73737 (Crash when parsing a tag format)",
          "3: --SKIPIF--",
          "4: <?php if (!extension_loaded('exif')) print 'skip exif extension not available';?>",
          "5: --FILE--",
          "6: <?php",
          "7:  $exif = exif_thumbnail(__DIR__ . '/bug73737.tiff');",
          "8:  var_dump($exif);",
          "9: ?>",
          "10: --EXPECTF--",
          "11: Warning: exif_thumbnail(bug73737.tiff): Error in TIFF: filesize(x0030) less than start of IFD dir(x10102) in %s line %d",
          "12: bool(false)",
          "",
          "---------------"
        ],
        "ext/phar/phar.c||ext/phar/phar.c": [
          "File: ext/phar/phar.c -> ext/phar/phar.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "982:   if (alias && alias_len && (alias_len != (int)tmp_len || strncmp(alias, buffer, tmp_len)))",
          "983:   {",
          "985:    php_stream_close(fp);",
          "987:    if (signature) {",
          "",
          "[Removed Lines]",
          "984:    buffer[tmp_len] = '\\0';",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "989:    }",
          "991:    if (error) {",
          "993:    }",
          "995:    efree(savebuf);",
          "",
          "[Removed Lines]",
          "992:     spprintf(error, 0, \"cannot load phar \\\"%s\\\" with implicit alias \\\"%s\\\" under different alias \\\"%s\\\"\", fname, buffer, alias);",
          "",
          "[Added Lines]",
          "991:     spprintf(error, 0, \"cannot load phar \\\"%s\\\" with implicit alias \\\"%.*s\\\" under different alias \\\"%s\\\"\", fname, tmp_len, buffer, alias);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1055:  entry.is_persistent = mydata->is_persistent;",
          "1057:  for (manifest_index = 0; manifest_index < manifest_count; ++manifest_index) {",
          "1059:    MAPPHAR_FAIL(\"internal corruption of phar \\\"%s\\\" (truncated manifest entry)\")",
          "1060:   }",
          "",
          "[Removed Lines]",
          "1058:   if (buffer + 4 > endbuffer) {",
          "",
          "[Added Lines]",
          "1057:   if (buffer + 28 > endbuffer) {",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1069:    entry.manifest_pos = manifest_index;",
          "1070:   }",
          "1073:    MAPPHAR_FAIL(\"internal corruption of phar \\\"%s\\\" (truncated manifest entry)\");",
          "1074:   }",
          "",
          "[Removed Lines]",
          "1072:   if (entry.filename_len + 20 > endbuffer - buffer) {",
          "",
          "[Added Lines]",
          "1071:   if (entry.filename_len > endbuffer - buffer - 24) {",
          "",
          "---------------"
        ],
        "ext/phar/tests/bug73764.phpt||ext/phar/tests/bug73764.phpt": [
          "File: ext/phar/tests/bug73764.phpt -> ext/phar/tests/bug73764.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Phar: PHP bug #73764: Crash while loading hostile phar archive",
          "3: --SKIPIF--",
          "4: <?php if (!extension_loaded(\"phar\")) die(\"skip\"); ?>",
          "5: --FILE--",
          "6: <?php",
          "7: chdir(__DIR__);",
          "8: try {",
          "9: $p = Phar::LoadPhar('bug73764.phar', 'alias.phar');",
          "10: echo \"OK\\n\";",
          "11: } catch(PharException $e) {",
          "12:  echo $e->getMessage();",
          "13: }",
          "14: ?>",
          "15: --EXPECTF--",
          "16: internal corruption of phar \"%sbug73764.phar\" (truncated manifest entry)",
          "",
          "---------------"
        ],
        "ext/phar/tests/bug73768.phpt||ext/phar/tests/bug73768.phpt": [
          "File: ext/phar/tests/bug73768.phpt -> ext/phar/tests/bug73768.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Phar: PHP bug #73768: Memory corruption when loading hostile phar",
          "3: --SKIPIF--",
          "4: <?php if (!extension_loaded(\"phar\")) die(\"skip\"); ?>",
          "5: --FILE--",
          "6: <?php",
          "7: chdir(__DIR__);",
          "8: try {",
          "9: $p = Phar::LoadPhar('bug73768.phar', 'alias.phar');",
          "10: echo \"OK\\n\";",
          "11: } catch(PharException $e) {",
          "12:  echo $e->getMessage();",
          "13: }",
          "14: ?>",
          "15: --EXPECTF--",
          "16: cannot load phar \"%sbug73768.phar\" with implicit alias \"\" under different alias \"alias.phar\"",
          "",
          "---------------"
        ],
        "ext/standard/tests/serialize/bug73825.phpt||ext/standard/tests/serialize/bug73825.phpt": [
          "File: ext/standard/tests/serialize/bug73825.phpt -> ext/standard/tests/serialize/bug73825.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #73825 Heap out of bounds read on unserialize in finish_nested_data()",
          "3: --FILE--",
          "4: <?php",
          "5: $obj = unserialize('O:8:\"00000000\":');",
          "6: var_dump($obj);",
          "7: ?>",
          "8: --EXPECTF--",
          "9: Warning: Bad unserialize data in %sbug73825.php on line %d",
          "11: Notice: unserialize(): Error at offset 13 of 15 bytes in %sbug73825.php on line %d",
          "12: bool(false)",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "405: {",
          "406:  long elements;",
          "408:  elements = parse_iv2((*p) + 2, p);",
          "410:  (*p) += 2;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "408:  if( *p >= max - 2) {",
          "409:   zend_error(E_WARNING, \"Bad unserialize data\");",
          "410:   return -1;",
          "411:  }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "417:   zend_error(E_WARNING, \"Erroneous data format for unserializing '%s'\", ce->name);",
          "419:  }",
          "421:  return elements;",
          "",
          "[Removed Lines]",
          "418:   return 0;",
          "",
          "[Added Lines]",
          "423:   return -1;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "496: {",
          "497:  YYCTYPE yych;",
          "498:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "495: #line 496 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "500: #line 501 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "529:     0,   0,   0,   0,   0,   0,   0,   0,",
          "530:     0,   0,   0,   0,   0,   0,   0,   0,",
          "531:  };",
          "532:  if ((YYLIMIT - YYCURSOR) < 7) YYFILL(7);",
          "533:  yych = *YYCURSOR;",
          "534:  switch (yych) {",
          "535:  case 'C':",
          "537:  case 'N': goto yy5;",
          "544:  case 'o': goto yy12;",
          "549:  }",
          "550: yy2:",
          "552: yy3:",
          "554:  { return 0; }",
          "556: yy4:",
          "557:  yych = *(YYMARKER = ++YYCURSOR);",
          "559:  goto yy3;",
          "560: yy5:",
          "561:  yych = *++YYCURSOR;",
          "563:  goto yy3;",
          "564: yy6:",
          "565:  yych = *(YYMARKER = ++YYCURSOR);",
          "567:  goto yy3;",
          "568: yy7:",
          "569:  yych = *(YYMARKER = ++YYCURSOR);",
          "571:  goto yy3;",
          "572: yy8:",
          "573:  yych = *(YYMARKER = ++YYCURSOR);",
          "575:  goto yy3;",
          "576: yy9:",
          "577:  yych = *(YYMARKER = ++YYCURSOR);",
          "579:  goto yy3;",
          "580: yy10:",
          "581:  yych = *(YYMARKER = ++YYCURSOR);",
          "583:  goto yy3;",
          "584: yy11:",
          "585:  yych = *(YYMARKER = ++YYCURSOR);",
          "587:  goto yy3;",
          "588: yy12:",
          "589:  yych = *(YYMARKER = ++YYCURSOR);",
          "591:  goto yy3;",
          "592: yy13:",
          "593:  yych = *(YYMARKER = ++YYCURSOR);",
          "595:  goto yy3;",
          "596: yy14:",
          "601:  ++YYCURSOR;",
          "603:  {",
          "605:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
          "607: }",
          "609: yy17:",
          "610:  yych = *++YYCURSOR;",
          "611:  if (yybm[0+yych] & 128) {",
          "613:  }",
          "615: yy18:",
          "616:  YYCURSOR = YYMARKER;",
          "617:  goto yy3;",
          "618: yy19:",
          "629:  yych = *++YYCURSOR;",
          "638:  }",
          "650:  goto yy18;",
          "653:  if (yych <= '/') goto yy18;",
          "657:  yych = *++YYCURSOR;",
          "666:   }",
          "672:   } else {",
          "675:   }",
          "676:  }",
          "687:  }",
          "698:  }",
          "700:  yych = *++YYCURSOR;",
          "701:  if (yych <= ',') {",
          "704:  } else {",
          "706:   if (yych <= '/') goto yy18;",
          "708:   goto yy18;",
          "709:  }",
          "711:  yych = *++YYCURSOR;",
          "713:  if (yych <= '/') goto yy18;",
          "723:  ++YYCURSOR;",
          "724:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "725:  yych = *YYCURSOR;",
          "729:  if (yych <= '/') goto yy18;",
          "733:  yych = *++YYCURSOR;",
          "737:  ++YYCURSOR;",
          "740:  if (yych <= '/') goto yy18;",
          "741:  if (yych <= '9') goto yy34;",
          "743:  goto yy18;",
          "745:  yych = *++YYCURSOR;",
          "746:  if (yych <= '/') goto yy18;",
          "747:  if (yych >= ':') goto yy18;",
          "749:  ++YYCURSOR;",
          "750:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "751:  yych = *YYCURSOR;",
          "752:  if (yych <= '/') goto yy18;",
          "757:  yych = *++YYCURSOR;",
          "761:  ++YYCURSOR;",
          "786:  }",
          "814:  }",
          "824:  yych = *++YYCURSOR;",
          "825:  if (yych <= '/') goto yy18;",
          "834:  goto yy18;",
          "836:  yych = *++YYCURSOR;",
          "837:  if (yych <= '/') goto yy18;",
          "838:  if (yych >= ':') goto yy18;",
          "840:  ++YYCURSOR;",
          "841:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "842:  yych = *YYCURSOR;",
          "843:  if (yych <= '/') goto yy18;",
          "848:  yych = *++YYCURSOR;",
          "852:  ++YYCURSOR;",
          "855:  if (yych <= '/') goto yy18;",
          "858:  goto yy18;",
          "860:  yych = *++YYCURSOR;",
          "861:  if (yych <= '/') goto yy18;",
          "862:  if (yych >= ':') goto yy18;",
          "864:  ++YYCURSOR;",
          "865:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "866:  yych = *YYCURSOR;",
          "867:  if (yych <= '/') goto yy18;",
          "872:  yych = *++YYCURSOR;",
          "876:  ++YYCURSOR;",
          "878:  {",
          "886:   return 0;",
          "887:  }",
          "891:  }",
          "896:  return 1;",
          "897: }",
          "900:  yych = *++YYCURSOR;",
          "902:  goto yy18;",
          "904:  yych = *++YYCURSOR;",
          "906:  goto yy18;",
          "908:  ++YYCURSOR;",
          "918:  ++YYCURSOR;",
          "919:  if ((YYLIMIT - YYCURSOR) < 4) YYFILL(4);",
          "920:  yych = *YYCURSOR;",
          "921:  if (yych <= ';') {",
          "922:   if (yych <= '/') goto yy18;",
          "924:   if (yych <= ':') goto yy18;",
          "925:  } else {",
          "926:   if (yych <= 'E') {",
          "927:    if (yych <= 'D') goto yy18;",
          "929:   } else {",
          "931:    goto yy18;",
          "932:   }",
          "933:  }",
          "935:  ++YYCURSOR;",
          "937:  {",
          "938: #if SIZEOF_LONG == 4",
          "939: use_double:",
          "",
          "[Removed Lines]",
          "536:  case 'O': goto yy4;",
          "538:  case 'R': goto yy6;",
          "539:  case 'S': goto yy7;",
          "540:  case 'a': goto yy8;",
          "541:  case 'b': goto yy9;",
          "542:  case 'd': goto yy10;",
          "543:  case 'i': goto yy11;",
          "545:  case 'r': goto yy13;",
          "546:  case 's': goto yy14;",
          "547:  case '}': goto yy15;",
          "548:  default: goto yy2;",
          "551:  ++YYCURSOR;",
          "553: #line 863 \"ext/standard/var_unserializer.re\"",
          "555: #line 556 \"ext/standard/var_unserializer.c\"",
          "558:  if (yych == ':') goto yy17;",
          "562:  if (yych == ';') goto yy19;",
          "566:  if (yych == ':') goto yy21;",
          "570:  if (yych == ':') goto yy22;",
          "574:  if (yych == ':') goto yy23;",
          "578:  if (yych == ':') goto yy24;",
          "582:  if (yych == ':') goto yy25;",
          "586:  if (yych == ':') goto yy26;",
          "590:  if (yych == ':') goto yy27;",
          "594:  if (yych == ':') goto yy28;",
          "597:  yych = *(YYMARKER = ++YYCURSOR);",
          "598:  if (yych == ':') goto yy29;",
          "599:  goto yy3;",
          "600: yy15:",
          "602: #line 857 \"ext/standard/var_unserializer.re\"",
          "608: #line 609 \"ext/standard/var_unserializer.c\"",
          "612:   goto yy31;",
          "614:  if (yych == '+') goto yy30;",
          "619:  ++YYCURSOR;",
          "620: #line 544 \"ext/standard/var_unserializer.re\"",
          "621:  {",
          "623:  INIT_PZVAL(*rval);",
          "624:  ZVAL_NULL(*rval);",
          "625:  return 1;",
          "626: }",
          "627: #line 628 \"ext/standard/var_unserializer.c\"",
          "628: yy21:",
          "630:  if (yych <= ',') {",
          "631:   if (yych == '+') goto yy33;",
          "632:   goto yy18;",
          "633:  } else {",
          "634:   if (yych <= '-') goto yy33;",
          "635:   if (yych <= '/') goto yy18;",
          "636:   if (yych <= '9') goto yy34;",
          "637:   goto yy18;",
          "639: yy22:",
          "640:  yych = *++YYCURSOR;",
          "641:  if (yych == '+') goto yy36;",
          "642:  if (yych <= '/') goto yy18;",
          "643:  if (yych <= '9') goto yy37;",
          "644:  goto yy18;",
          "645: yy23:",
          "646:  yych = *++YYCURSOR;",
          "647:  if (yych == '+') goto yy39;",
          "648:  if (yych <= '/') goto yy18;",
          "649:  if (yych <= '9') goto yy40;",
          "651: yy24:",
          "652:  yych = *++YYCURSOR;",
          "654:  if (yych <= '1') goto yy42;",
          "655:  goto yy18;",
          "656: yy25:",
          "658:  if (yych <= '/') {",
          "659:   if (yych <= ',') {",
          "660:    if (yych == '+') goto yy43;",
          "661:    goto yy18;",
          "662:   } else {",
          "663:    if (yych <= '-') goto yy44;",
          "664:    if (yych <= '.') goto yy45;",
          "665:    goto yy18;",
          "667:  } else {",
          "668:   if (yych <= 'I') {",
          "669:    if (yych <= '9') goto yy46;",
          "670:    if (yych <= 'H') goto yy18;",
          "671:    goto yy48;",
          "673:    if (yych == 'N') goto yy49;",
          "674:    goto yy18;",
          "677: yy26:",
          "678:  yych = *++YYCURSOR;",
          "679:  if (yych <= ',') {",
          "680:   if (yych == '+') goto yy50;",
          "681:   goto yy18;",
          "682:  } else {",
          "683:   if (yych <= '-') goto yy50;",
          "684:   if (yych <= '/') goto yy18;",
          "685:   if (yych <= '9') goto yy51;",
          "686:   goto yy18;",
          "688: yy27:",
          "689:  yych = *++YYCURSOR;",
          "690:  if (yych <= ',') {",
          "691:   if (yych == '+') goto yy53;",
          "692:   goto yy18;",
          "693:  } else {",
          "694:   if (yych <= '-') goto yy53;",
          "695:   if (yych <= '/') goto yy18;",
          "696:   if (yych <= '9') goto yy54;",
          "697:   goto yy18;",
          "699: yy28:",
          "702:   if (yych == '+') goto yy56;",
          "703:   goto yy18;",
          "705:   if (yych <= '-') goto yy56;",
          "707:   if (yych <= '9') goto yy57;",
          "710: yy29:",
          "712:  if (yych == '+') goto yy59;",
          "714:  if (yych <= '9') goto yy60;",
          "715:  goto yy18;",
          "716: yy30:",
          "717:  yych = *++YYCURSOR;",
          "718:  if (yybm[0+yych] & 128) {",
          "719:   goto yy31;",
          "720:  }",
          "721:  goto yy18;",
          "722: yy31:",
          "726:  if (yybm[0+yych] & 128) {",
          "727:   goto yy31;",
          "728:  }",
          "730:  if (yych <= ':') goto yy62;",
          "731:  goto yy18;",
          "732: yy33:",
          "734:  if (yych <= '/') goto yy18;",
          "735:  if (yych >= ':') goto yy18;",
          "736: yy34:",
          "738:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "739:  yych = *YYCURSOR;",
          "742:  if (yych == ';') goto yy63;",
          "744: yy36:",
          "748: yy37:",
          "753:  if (yych <= '9') goto yy37;",
          "754:  if (yych <= ':') goto yy65;",
          "755:  goto yy18;",
          "756: yy39:",
          "758:  if (yych <= '/') goto yy18;",
          "759:  if (yych >= ':') goto yy18;",
          "760: yy40:",
          "762:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "763:  yych = *YYCURSOR;",
          "764:  if (yych <= '/') goto yy18;",
          "765:  if (yych <= '9') goto yy40;",
          "766:  if (yych <= ':') goto yy66;",
          "767:  goto yy18;",
          "768: yy42:",
          "769:  yych = *++YYCURSOR;",
          "770:  if (yych == ';') goto yy67;",
          "771:  goto yy18;",
          "772: yy43:",
          "773:  yych = *++YYCURSOR;",
          "774:  if (yych == '.') goto yy45;",
          "775:  if (yych <= '/') goto yy18;",
          "776:  if (yych <= '9') goto yy46;",
          "777:  goto yy18;",
          "778: yy44:",
          "779:  yych = *++YYCURSOR;",
          "780:  if (yych <= '/') {",
          "781:   if (yych != '.') goto yy18;",
          "782:  } else {",
          "783:   if (yych <= '9') goto yy46;",
          "784:   if (yych == 'I') goto yy48;",
          "785:   goto yy18;",
          "787: yy45:",
          "788:  yych = *++YYCURSOR;",
          "789:  if (yych <= '/') goto yy18;",
          "790:  if (yych <= '9') goto yy69;",
          "791:  goto yy18;",
          "792: yy46:",
          "793:  ++YYCURSOR;",
          "794:  if ((YYLIMIT - YYCURSOR) < 4) YYFILL(4);",
          "795:  yych = *YYCURSOR;",
          "796:  if (yych <= ':') {",
          "797:   if (yych <= '.') {",
          "798:    if (yych <= '-') goto yy18;",
          "799:    goto yy69;",
          "800:   } else {",
          "801:    if (yych <= '/') goto yy18;",
          "802:    if (yych <= '9') goto yy46;",
          "803:    goto yy18;",
          "804:   }",
          "805:  } else {",
          "806:   if (yych <= 'E') {",
          "807:    if (yych <= ';') goto yy71;",
          "808:    if (yych <= 'D') goto yy18;",
          "809:    goto yy73;",
          "810:   } else {",
          "811:    if (yych == 'e') goto yy73;",
          "812:    goto yy18;",
          "813:   }",
          "815: yy48:",
          "816:  yych = *++YYCURSOR;",
          "817:  if (yych == 'N') goto yy74;",
          "818:  goto yy18;",
          "819: yy49:",
          "820:  yych = *++YYCURSOR;",
          "821:  if (yych == 'A') goto yy75;",
          "822:  goto yy18;",
          "823: yy50:",
          "826:  if (yych >= ':') goto yy18;",
          "827: yy51:",
          "828:  ++YYCURSOR;",
          "829:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "830:  yych = *YYCURSOR;",
          "831:  if (yych <= '/') goto yy18;",
          "832:  if (yych <= '9') goto yy51;",
          "833:  if (yych == ';') goto yy76;",
          "835: yy53:",
          "839: yy54:",
          "844:  if (yych <= '9') goto yy54;",
          "845:  if (yych <= ':') goto yy78;",
          "846:  goto yy18;",
          "847: yy56:",
          "849:  if (yych <= '/') goto yy18;",
          "850:  if (yych >= ':') goto yy18;",
          "851: yy57:",
          "853:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "854:  yych = *YYCURSOR;",
          "856:  if (yych <= '9') goto yy57;",
          "857:  if (yych == ';') goto yy79;",
          "859: yy59:",
          "863: yy60:",
          "868:  if (yych <= '9') goto yy60;",
          "869:  if (yych <= ':') goto yy81;",
          "870:  goto yy18;",
          "871: yy62:",
          "873:  if (yych == '\"') goto yy82;",
          "874:  goto yy18;",
          "875: yy63:",
          "877: #line 500 \"ext/standard/var_unserializer.re\"",
          "879:  long id;",
          "882:  if (!var_hash) return 0;",
          "884:  id = parse_iv(start + 2) - 1;",
          "885:  if (id == -1 || var_access(var_hash, id, &rval_ref) != SUCCESS) {",
          "889:  if (*rval != NULL) {",
          "890:   var_push_dtor_no_addref(var_hash, rval);",
          "893:  Z_ADDREF_PP(rval);",
          "894:  Z_SET_ISREF_PP(rval);",
          "898: #line 899 \"ext/standard/var_unserializer.c\"",
          "899: yy65:",
          "901:  if (yych == '\"') goto yy84;",
          "903: yy66:",
          "905:  if (yych == '{') goto yy86;",
          "907: yy67:",
          "909: #line 551 \"ext/standard/var_unserializer.re\"",
          "910:  {",
          "912:  INIT_PZVAL(*rval);",
          "913:  ZVAL_BOOL(*rval, parse_iv(start + 2));",
          "914:  return 1;",
          "915: }",
          "916: #line 917 \"ext/standard/var_unserializer.c\"",
          "917: yy69:",
          "923:   if (yych <= '9') goto yy69;",
          "928:    goto yy73;",
          "930:    if (yych == 'e') goto yy73;",
          "934: yy71:",
          "936: #line 600 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "542:  case 'O': goto yy13;",
          "544:  case 'R': goto yy2;",
          "545:  case 'S': goto yy10;",
          "546:  case 'a': goto yy11;",
          "547:  case 'b': goto yy6;",
          "548:  case 'd': goto yy8;",
          "549:  case 'i': goto yy7;",
          "551:  case 'r': goto yy4;",
          "552:  case 's': goto yy9;",
          "553:  case '}': goto yy14;",
          "554:  default: goto yy16;",
          "557:  yych = *(YYMARKER = ++YYCURSOR);",
          "558:  if (yych == ':') goto yy95;",
          "560: #line 877 \"ext/standard/var_unserializer.re\"",
          "562: #line 563 \"ext/standard/var_unserializer.c\"",
          "565:  if (yych == ':') goto yy89;",
          "569:  if (yych == ';') goto yy87;",
          "573:  if (yych == ':') goto yy83;",
          "577:  if (yych == ':') goto yy77;",
          "581:  if (yych == ':') goto yy53;",
          "585:  if (yych == ':') goto yy46;",
          "589:  if (yych == ':') goto yy39;",
          "593:  if (yych == ':') goto yy32;",
          "597:  if (yych == ':') goto yy25;",
          "601:  if (yych == ':') goto yy17;",
          "605: #line 871 \"ext/standard/var_unserializer.re\"",
          "611: #line 612 \"ext/standard/var_unserializer.c\"",
          "612: yy16:",
          "613:  yych = *++YYCURSOR;",
          "614:  goto yy3;",
          "618:   goto yy20;",
          "620:  if (yych == '+') goto yy19;",
          "626:  if (yybm[0+yych] & 128) {",
          "627:   goto yy20;",
          "630: yy20:",
          "631:  ++YYCURSOR;",
          "632:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "633:  yych = *YYCURSOR;",
          "634:  if (yybm[0+yych] & 128) {",
          "635:   goto yy20;",
          "636:  }",
          "638:  if (yych >= ';') goto yy18;",
          "640:  if (yych != '\"') goto yy18;",
          "641:  ++YYCURSOR;",
          "642: #line 717 \"ext/standard/var_unserializer.re\"",
          "643:  {",
          "644:  size_t len, len2, len3, maxlen;",
          "645:  long elements;",
          "646:  char *class_name;",
          "647:  zend_class_entry *ce;",
          "648:  zend_class_entry **pce;",
          "649:  int incomplete_class = 0;",
          "651:  int custom_object = 0;",
          "653:  zval *user_func;",
          "654:  zval *retval_ptr;",
          "655:  zval **args[1];",
          "656:  zval *arg_func_name;",
          "658:     if (!var_hash) return 0;",
          "659:  if (*start == 'C') {",
          "660:   custom_object = 1;",
          "661:  }",
          "663:  INIT_PZVAL(*rval);",
          "664:  len2 = len = parse_uiv(start + 2);",
          "665:  maxlen = max - YYCURSOR;",
          "666:  if (maxlen < len || len == 0) {",
          "668:   return 0;",
          "669:  }",
          "671:  class_name = (char*)YYCURSOR;",
          "673:  YYCURSOR += len;",
          "675:  if (*(YYCURSOR) != '\"') {",
          "677:   return 0;",
          "678:  }",
          "679:  if (*(YYCURSOR+1) != ':') {",
          "681:   return 0;",
          "682:  }",
          "684:  len3 = strspn(class_name, \"0123456789_abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\\177\\200\\201\\202\\203\\204\\205\\206\\207\\210\\211\\212\\213\\214\\215\\216\\217\\220\\221\\222\\223\\224\\225\\226\\227\\230\\231\\232\\233\\234\\235\\236\\237\\240\\241\\242\\243\\244\\245\\246\\247\\250\\251\\252\\253\\254\\255\\256\\257\\260\\261\\262\\263\\264\\265\\266\\267\\270\\271\\272\\273\\274\\275\\276\\277\\300\\301\\302\\303\\304\\305\\306\\307\\310\\311\\312\\313\\314\\315\\316\\317\\320\\321\\322\\323\\324\\325\\326\\327\\330\\331\\332\\333\\334\\335\\336\\337\\340\\341\\342\\343\\344\\345\\346\\347\\350\\351\\352\\353\\354\\355\\356\\357\\360\\361\\362\\363\\364\\365\\366\\367\\370\\371\\372\\373\\374\\375\\376\\377\\\\\");",
          "685:  if (len3 != len)",
          "686:  {",
          "688:   return 0;",
          "689:  }",
          "691:  class_name = estrndup(class_name, len);",
          "693:  do {",
          "695:   BG(serialize_lock)++;",
          "696:   if (zend_lookup_class(class_name, len2, &pce TSRMLS_CC) == SUCCESS) {",
          "697:    BG(serialize_lock)--;",
          "698:    if (EG(exception)) {",
          "699:     efree(class_name);",
          "700:     return 0;",
          "701:    }",
          "702:    ce = *pce;",
          "703:    break;",
          "705:   BG(serialize_lock)--;",
          "707:   if (EG(exception)) {",
          "708:    efree(class_name);",
          "709:    return 0;",
          "710:   }",
          "713:   if ((PG(unserialize_callback_func) == NULL) || (PG(unserialize_callback_func)[0] == '\\0')) {",
          "714:    incomplete_class = 1;",
          "715:    ce = PHP_IC_ENTRY;",
          "716:    break;",
          "717:   }",
          "720:   MAKE_STD_ZVAL(user_func);",
          "721:   ZVAL_STRING(user_func, PG(unserialize_callback_func), 1);",
          "722:   args[0] = &arg_func_name;",
          "723:   MAKE_STD_ZVAL(arg_func_name);",
          "724:   ZVAL_STRING(arg_func_name, class_name, 1);",
          "725:   BG(serialize_lock)++;",
          "726:   if (call_user_function_ex(CG(function_table), NULL, user_func, &retval_ptr, 1, args, 0, NULL TSRMLS_CC) != SUCCESS) {",
          "727:    BG(serialize_lock)--;",
          "728:    if (EG(exception)) {",
          "729:     efree(class_name);",
          "730:     zval_ptr_dtor(&user_func);",
          "731:     zval_ptr_dtor(&arg_func_name);",
          "732:     return 0;",
          "733:    }",
          "734:    php_error_docref(NULL TSRMLS_CC, E_WARNING, \"defined (%s) but not found\", user_func->value.str.val);",
          "735:    incomplete_class = 1;",
          "736:    ce = PHP_IC_ENTRY;",
          "737:    zval_ptr_dtor(&user_func);",
          "738:    zval_ptr_dtor(&arg_func_name);",
          "739:    break;",
          "740:   }",
          "741:   BG(serialize_lock)--;",
          "742:   if (retval_ptr) {",
          "743:    zval_ptr_dtor(&retval_ptr);",
          "744:   }",
          "745:   if (EG(exception)) {",
          "746:    efree(class_name);",
          "747:    zval_ptr_dtor(&user_func);",
          "748:    zval_ptr_dtor(&arg_func_name);",
          "749:    return 0;",
          "750:   }",
          "753:   BG(serialize_lock)++;",
          "754:   if (zend_lookup_class(class_name, len2, &pce TSRMLS_CC) == SUCCESS) {",
          "755:    ce = *pce;",
          "757:    php_error_docref(NULL TSRMLS_CC, E_WARNING, \"Function %s() hasn't defined the class it was called for\", user_func->value.str.val);",
          "758:    incomplete_class = 1;",
          "759:    ce = PHP_IC_ENTRY;",
          "760:   }",
          "761:   BG(serialize_lock)--;",
          "763:   zval_ptr_dtor(&user_func);",
          "764:   zval_ptr_dtor(&arg_func_name);",
          "765:   break;",
          "766:  } while (1);",
          "770:  if (custom_object) {",
          "771:   int ret;",
          "773:   ret = object_custom(UNSERIALIZE_PASSTHRU, ce);",
          "775:   if (ret && incomplete_class) {",
          "776:    php_store_class_name(*rval, class_name, len2);",
          "778:   efree(class_name);",
          "779:   return ret;",
          "782:  elements = object_common1(UNSERIALIZE_PASSTHRU, ce);",
          "784:  if (elements < 0) {",
          "785:     efree(class_name);",
          "786:     return 0;",
          "789:  if (incomplete_class) {",
          "790:   php_store_class_name(*rval, class_name, len2);",
          "792:  efree(class_name);",
          "794:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "795: }",
          "796: #line 797 \"ext/standard/var_unserializer.c\"",
          "797: yy25:",
          "800:   if (yych != '+') goto yy18;",
          "802:   if (yych <= '-') goto yy26;",
          "804:   if (yych <= '9') goto yy27;",
          "807: yy26:",
          "810:  if (yych >= ':') goto yy18;",
          "811: yy27:",
          "816:  if (yych <= '9') goto yy27;",
          "817:  if (yych >= ';') goto yy18;",
          "819:  if (yych != '\"') goto yy18;",
          "821: #line 704 \"ext/standard/var_unserializer.re\"",
          "822:  {",
          "823:  long elements;",
          "824:     if (!var_hash) return 0;",
          "826:  INIT_PZVAL(*rval);",
          "828:  elements = object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR);",
          "829:  if (elements < 0) {",
          "830:   return 0;",
          "831:  }",
          "832:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "833: }",
          "834: #line 835 \"ext/standard/var_unserializer.c\"",
          "835: yy32:",
          "836:  yych = *++YYCURSOR;",
          "837:  if (yych == '+') goto yy33;",
          "841: yy33:",
          "845: yy34:",
          "850:  if (yych <= '9') goto yy34;",
          "851:  if (yych >= ';') goto yy18;",
          "853:  if (yych != '{') goto yy18;",
          "855: #line 683 \"ext/standard/var_unserializer.re\"",
          "856:  {",
          "857:  long elements = parse_iv(start + 2);",
          "860:     if (!var_hash) return 0;",
          "862:  if (elements < 0) {",
          "863:   return 0;",
          "866:  INIT_PZVAL(*rval);",
          "868:  array_init_size(*rval, elements);",
          "870:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_ARRVAL_PP(rval), elements, 0)) {",
          "871:   return 0;",
          "874:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "875: }",
          "876: #line 877 \"ext/standard/var_unserializer.c\"",
          "877: yy39:",
          "879:  if (yych == '+') goto yy40;",
          "881:  if (yych <= '9') goto yy41;",
          "883: yy40:",
          "887: yy41:",
          "892:  if (yych <= '9') goto yy41;",
          "893:  if (yych >= ';') goto yy18;",
          "895:  if (yych != '\"') goto yy18;",
          "897: #line 648 \"ext/standard/var_unserializer.re\"",
          "898:  {",
          "899:  size_t len, maxlen;",
          "900:  char *str;",
          "902:  len = parse_uiv(start + 2);",
          "903:  maxlen = max - YYCURSOR;",
          "904:  if (maxlen < len) {",
          "906:   return 0;",
          "907:  }",
          "909:  if ((str = unserialize_str(&YYCURSOR, &len, maxlen)) == NULL) {",
          "910:   return 0;",
          "911:  }",
          "913:  if (*(YYCURSOR) != '\"') {",
          "914:   efree(str);",
          "916:   return 0;",
          "917:  }",
          "919:  if (*(YYCURSOR + 1) != ';') {",
          "920:   efree(str);",
          "922:   return 0;",
          "923:  }",
          "925:  YYCURSOR += 2;",
          "928:  INIT_PZVAL(*rval);",
          "929:  ZVAL_STRINGL(*rval, str, len, 0);",
          "930:  return 1;",
          "931: }",
          "932: #line 933 \"ext/standard/var_unserializer.c\"",
          "933: yy46:",
          "934:  yych = *++YYCURSOR;",
          "935:  if (yych == '+') goto yy47;",
          "937:  if (yych <= '9') goto yy48;",
          "939: yy47:",
          "943: yy48:",
          "948:  if (yych <= '9') goto yy48;",
          "949:  if (yych >= ';') goto yy18;",
          "951:  if (yych != '\"') goto yy18;",
          "953: #line 615 \"ext/standard/var_unserializer.re\"",
          "955:  size_t len, maxlen;",
          "956:  char *str;",
          "958:  len = parse_uiv(start + 2);",
          "959:  maxlen = max - YYCURSOR;",
          "960:  if (maxlen < len) {",
          "962:   return 0;",
          "963:  }",
          "965:  str = (char*)YYCURSOR;",
          "967:  YYCURSOR += len;",
          "969:  if (*(YYCURSOR) != '\"') {",
          "974:  if (*(YYCURSOR + 1) != ';') {",
          "976:   return 0;",
          "979:  YYCURSOR += 2;",
          "982:  INIT_PZVAL(*rval);",
          "983:  ZVAL_STRINGL(*rval, str, len, 1);",
          "986: #line 987 \"ext/standard/var_unserializer.c\"",
          "987: yy53:",
          "988:  yych = *++YYCURSOR;",
          "989:  if (yych <= '/') {",
          "990:   if (yych <= ',') {",
          "991:    if (yych == '+') goto yy57;",
          "992:    goto yy18;",
          "993:   } else {",
          "994:    if (yych <= '-') goto yy55;",
          "995:    if (yych <= '.') goto yy60;",
          "996:    goto yy18;",
          "997:   }",
          "998:  } else {",
          "999:   if (yych <= 'I') {",
          "1000:    if (yych <= '9') goto yy58;",
          "1001:    if (yych <= 'H') goto yy18;",
          "1002:    goto yy56;",
          "1003:   } else {",
          "1004:    if (yych != 'N') goto yy18;",
          "1005:   }",
          "1006:  }",
          "1008:  if (yych == 'A') goto yy76;",
          "1010: yy55:",
          "1011:  yych = *++YYCURSOR;",
          "1012:  if (yych <= '/') {",
          "1013:   if (yych == '.') goto yy60;",
          "1014:   goto yy18;",
          "1015:  } else {",
          "1016:   if (yych <= '9') goto yy58;",
          "1017:   if (yych != 'I') goto yy18;",
          "1018:  }",
          "1019: yy56:",
          "1021:  if (yych == 'N') goto yy72;",
          "1023: yy57:",
          "1024:  yych = *++YYCURSOR;",
          "1025:  if (yych == '.') goto yy60;",
          "1026:  if (yych <= '/') goto yy18;",
          "1027:  if (yych >= ':') goto yy18;",
          "1028: yy58:",
          "1030:  if ((YYLIMIT - YYCURSOR) < 4) YYFILL(4);",
          "1031:  yych = *YYCURSOR;",
          "1032:  if (yych <= ':') {",
          "1033:   if (yych <= '.') {",
          "1034:    if (yych <= '-') goto yy18;",
          "1035:    goto yy70;",
          "1036:   } else {",
          "1037:    if (yych <= '/') goto yy18;",
          "1038:    if (yych <= '9') goto yy58;",
          "1039:    goto yy18;",
          "1040:   }",
          "1041:  } else {",
          "1042:   if (yych <= 'E') {",
          "1043:    if (yych <= ';') goto yy63;",
          "1044:    if (yych <= 'D') goto yy18;",
          "1045:    goto yy65;",
          "1046:   } else {",
          "1047:    if (yych == 'e') goto yy65;",
          "1048:    goto yy18;",
          "1049:   }",
          "1050:  }",
          "1051: yy60:",
          "1052:  yych = *++YYCURSOR;",
          "1053:  if (yych <= '/') goto yy18;",
          "1054:  if (yych >= ':') goto yy18;",
          "1055: yy61:",
          "1061:   if (yych <= '9') goto yy61;",
          "1066:    goto yy65;",
          "1068:    if (yych == 'e') goto yy65;",
          "1072: yy63:",
          "1074: #line 605 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "943:  ZVAL_DOUBLE(*rval, zend_strtod((const char *)start + 2, NULL));",
          "944:  return 1;",
          "945: }",
          "948:  yych = *++YYCURSOR;",
          "949:  if (yych <= ',') {",
          "952:  } else {",
          "954:   if (yych <= '/') goto yy18;",
          "956:   goto yy18;",
          "957:  }",
          "959:  yych = *++YYCURSOR;",
          "961:  goto yy18;",
          "963:  yych = *++YYCURSOR;",
          "965:  goto yy18;",
          "967:  ++YYCURSOR;",
          "985:   } else {",
          "987:   }",
          "988:  }",
          "991:  INIT_PZVAL(*rval);",
          "993:  return 1;",
          "994: }",
          "997:  yych = *++YYCURSOR;",
          "999:  goto yy18;",
          "1018:  }",
          "1027:  yych = *++YYCURSOR;",
          "1031:  ++YYCURSOR;",
          "1033:  {",
          "1079:  }",
          "1123:    }",
          "1146:   } else {",
          "1167:   }",
          "1170:  }",
          "1180: }",
          "1183:  ++YYCURSOR;",
          "1185:  {",
          "1215:  INIT_PZVAL(*rval);",
          "1217:  return 1;",
          "1218: }",
          "1221:  ++YYCURSOR;",
          "1223:  {",
          "1233:  INIT_PZVAL(*rval);",
          "1242: }",
          "1245:  yych = *++YYCURSOR;",
          "1246:  if (yych <= ',') {",
          "1249:  } else {",
          "1251:   if (yych <= '/') goto yy18;",
          "1253:  }",
          "1255:  ++YYCURSOR;",
          "1256:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "1257:  yych = *YYCURSOR;",
          "1258:  if (yych <= '/') goto yy18;",
          "1267:  ++YYCURSOR;",
          "1269:  {",
          "1289:   return 0;",
          "1290:  }",
          "1304:  }",
          "1311:  return 1;",
          "1312: }",
          "1314: yy96:",
          "1315:  yych = *++YYCURSOR;",
          "1316:  if (yych <= '/') goto yy18;",
          "1319: yy97:",
          "1320:  ++YYCURSOR;",
          "1322:  {",
          "1332:  }",
          "1334:  return 1;",
          "1335: }",
          "1337: }",
          "1341:  return 0;",
          "",
          "[Removed Lines]",
          "946: #line 947 \"ext/standard/var_unserializer.c\"",
          "947: yy73:",
          "950:   if (yych == '+') goto yy88;",
          "951:   goto yy18;",
          "953:   if (yych <= '-') goto yy88;",
          "955:   if (yych <= '9') goto yy89;",
          "958: yy74:",
          "960:  if (yych == 'F') goto yy91;",
          "962: yy75:",
          "964:  if (yych == 'N') goto yy91;",
          "966: yy76:",
          "968: #line 558 \"ext/standard/var_unserializer.re\"",
          "969:  {",
          "970: #if SIZEOF_LONG == 4",
          "971:  int digits = YYCURSOR - start - 3;",
          "973:  if (start[2] == '-' || start[2] == '+') {",
          "974:   digits--;",
          "975:  }",
          "978:  if (digits >= MAX_LENGTH_OF_LONG - 1) {",
          "979:   if (digits == MAX_LENGTH_OF_LONG - 1) {",
          "980:    int cmp = strncmp(YYCURSOR - MAX_LENGTH_OF_LONG, long_min_digits, MAX_LENGTH_OF_LONG - 1);",
          "982:    if (!(cmp < 0 || (cmp == 0 && start[2] == '-'))) {",
          "983:     goto use_double;",
          "984:    }",
          "986:    goto use_double;",
          "989: #endif",
          "992:  ZVAL_LONG(*rval, parse_iv(start + 2));",
          "995: #line 996 \"ext/standard/var_unserializer.c\"",
          "996: yy78:",
          "998:  if (yych == '\"') goto yy92;",
          "1000: yy79:",
          "1001:  ++YYCURSOR;",
          "1002: #line 521 \"ext/standard/var_unserializer.re\"",
          "1003:  {",
          "1004:  long id;",
          "1007:  if (!var_hash) return 0;",
          "1009:  id = parse_iv(start + 2) - 1;",
          "1010:  if (id == -1 || var_access(var_hash, id, &rval_ref) != SUCCESS) {",
          "1011:   return 0;",
          "1012:  }",
          "1014:  if (*rval == *rval_ref) return 0;",
          "1016:  if (*rval != NULL) {",
          "1017:   var_push_dtor_no_addref(var_hash, rval);",
          "1020:  Z_ADDREF_PP(rval);",
          "1021:  Z_UNSET_ISREF_PP(rval);",
          "1023:  return 1;",
          "1024: }",
          "1025: #line 1026 \"ext/standard/var_unserializer.c\"",
          "1026: yy81:",
          "1028:  if (yych == '\"') goto yy94;",
          "1029:  goto yy18;",
          "1030: yy82:",
          "1032: #line 708 \"ext/standard/var_unserializer.re\"",
          "1034:  size_t len, len2, len3, maxlen;",
          "1035:  long elements;",
          "1036:  char *class_name;",
          "1037:  zend_class_entry *ce;",
          "1038:  zend_class_entry **pce;",
          "1039:  int incomplete_class = 0;",
          "1041:  int custom_object = 0;",
          "1043:  zval *user_func;",
          "1044:  zval *retval_ptr;",
          "1045:  zval **args[1];",
          "1046:  zval *arg_func_name;",
          "1048:     if (!var_hash) return 0;",
          "1049:  if (*start == 'C') {",
          "1050:   custom_object = 1;",
          "1051:  }",
          "1053:  INIT_PZVAL(*rval);",
          "1054:  len2 = len = parse_uiv(start + 2);",
          "1055:  maxlen = max - YYCURSOR;",
          "1056:  if (maxlen < len || len == 0) {",
          "1058:   return 0;",
          "1059:  }",
          "1061:  class_name = (char*)YYCURSOR;",
          "1063:  YYCURSOR += len;",
          "1065:  if (*(YYCURSOR) != '\"') {",
          "1067:   return 0;",
          "1068:  }",
          "1069:  if (*(YYCURSOR+1) != ':') {",
          "1071:   return 0;",
          "1072:  }",
          "1074:  len3 = strspn(class_name, \"0123456789_abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\\177\\200\\201\\202\\203\\204\\205\\206\\207\\210\\211\\212\\213\\214\\215\\216\\217\\220\\221\\222\\223\\224\\225\\226\\227\\230\\231\\232\\233\\234\\235\\236\\237\\240\\241\\242\\243\\244\\245\\246\\247\\250\\251\\252\\253\\254\\255\\256\\257\\260\\261\\262\\263\\264\\265\\266\\267\\270\\271\\272\\273\\274\\275\\276\\277\\300\\301\\302\\303\\304\\305\\306\\307\\310\\311\\312\\313\\314\\315\\316\\317\\320\\321\\322\\323\\324\\325\\326\\327\\330\\331\\332\\333\\334\\335\\336\\337\\340\\341\\342\\343\\344\\345\\346\\347\\350\\351\\352\\353\\354\\355\\356\\357\\360\\361\\362\\363\\364\\365\\366\\367\\370\\371\\372\\373\\374\\375\\376\\377\\\\\");",
          "1075:  if (len3 != len)",
          "1076:  {",
          "1078:   return 0;",
          "1081:  class_name = estrndup(class_name, len);",
          "1083:  do {",
          "1085:   BG(serialize_lock)++;",
          "1086:   if (zend_lookup_class(class_name, len2, &pce TSRMLS_CC) == SUCCESS) {",
          "1087:    BG(serialize_lock)--;",
          "1088:    if (EG(exception)) {",
          "1089:     efree(class_name);",
          "1090:     return 0;",
          "1091:    }",
          "1092:    ce = *pce;",
          "1093:    break;",
          "1094:   }",
          "1095:   BG(serialize_lock)--;",
          "1097:   if (EG(exception)) {",
          "1098:    efree(class_name);",
          "1099:    return 0;",
          "1100:   }",
          "1103:   if ((PG(unserialize_callback_func) == NULL) || (PG(unserialize_callback_func)[0] == '\\0')) {",
          "1104:    incomplete_class = 1;",
          "1105:    ce = PHP_IC_ENTRY;",
          "1106:    break;",
          "1107:   }",
          "1110:   MAKE_STD_ZVAL(user_func);",
          "1111:   ZVAL_STRING(user_func, PG(unserialize_callback_func), 1);",
          "1112:   args[0] = &arg_func_name;",
          "1113:   MAKE_STD_ZVAL(arg_func_name);",
          "1114:   ZVAL_STRING(arg_func_name, class_name, 1);",
          "1115:   BG(serialize_lock)++;",
          "1116:   if (call_user_function_ex(CG(function_table), NULL, user_func, &retval_ptr, 1, args, 0, NULL TSRMLS_CC) != SUCCESS) {",
          "1117:    BG(serialize_lock)--;",
          "1118:    if (EG(exception)) {",
          "1119:     efree(class_name);",
          "1120:     zval_ptr_dtor(&user_func);",
          "1121:     zval_ptr_dtor(&arg_func_name);",
          "1122:     return 0;",
          "1124:    php_error_docref(NULL TSRMLS_CC, E_WARNING, \"defined (%s) but not found\", user_func->value.str.val);",
          "1125:    incomplete_class = 1;",
          "1126:    ce = PHP_IC_ENTRY;",
          "1127:    zval_ptr_dtor(&user_func);",
          "1128:    zval_ptr_dtor(&arg_func_name);",
          "1129:    break;",
          "1130:   }",
          "1131:   BG(serialize_lock)--;",
          "1132:   if (retval_ptr) {",
          "1133:    zval_ptr_dtor(&retval_ptr);",
          "1134:   }",
          "1135:   if (EG(exception)) {",
          "1136:    efree(class_name);",
          "1137:    zval_ptr_dtor(&user_func);",
          "1138:    zval_ptr_dtor(&arg_func_name);",
          "1139:    return 0;",
          "1140:   }",
          "1143:   BG(serialize_lock)++;",
          "1144:   if (zend_lookup_class(class_name, len2, &pce TSRMLS_CC) == SUCCESS) {",
          "1145:    ce = *pce;",
          "1147:    php_error_docref(NULL TSRMLS_CC, E_WARNING, \"Function %s() hasn't defined the class it was called for\", user_func->value.str.val);",
          "1148:    incomplete_class = 1;",
          "1149:    ce = PHP_IC_ENTRY;",
          "1150:   }",
          "1151:   BG(serialize_lock)--;",
          "1153:   zval_ptr_dtor(&user_func);",
          "1154:   zval_ptr_dtor(&arg_func_name);",
          "1155:   break;",
          "1156:  } while (1);",
          "1160:  if (custom_object) {",
          "1161:   int ret;",
          "1163:   ret = object_custom(UNSERIALIZE_PASSTHRU, ce);",
          "1165:   if (ret && incomplete_class) {",
          "1166:    php_store_class_name(*rval, class_name, len2);",
          "1168:   efree(class_name);",
          "1169:   return ret;",
          "1172:  elements = object_common1(UNSERIALIZE_PASSTHRU, ce);",
          "1174:  if (incomplete_class) {",
          "1175:   php_store_class_name(*rval, class_name, len2);",
          "1176:  }",
          "1177:  efree(class_name);",
          "1179:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "1181: #line 1182 \"ext/standard/var_unserializer.c\"",
          "1182: yy84:",
          "1184: #line 643 \"ext/standard/var_unserializer.re\"",
          "1186:  size_t len, maxlen;",
          "1187:  char *str;",
          "1189:  len = parse_uiv(start + 2);",
          "1190:  maxlen = max - YYCURSOR;",
          "1191:  if (maxlen < len) {",
          "1193:   return 0;",
          "1194:  }",
          "1196:  if ((str = unserialize_str(&YYCURSOR, &len, maxlen)) == NULL) {",
          "1197:   return 0;",
          "1198:  }",
          "1200:  if (*(YYCURSOR) != '\"') {",
          "1201:   efree(str);",
          "1203:   return 0;",
          "1204:  }",
          "1206:  if (*(YYCURSOR + 1) != ';') {",
          "1207:   efree(str);",
          "1209:   return 0;",
          "1210:  }",
          "1212:  YYCURSOR += 2;",
          "1216:  ZVAL_STRINGL(*rval, str, len, 0);",
          "1219: #line 1220 \"ext/standard/var_unserializer.c\"",
          "1220: yy86:",
          "1222: #line 678 \"ext/standard/var_unserializer.re\"",
          "1224:  long elements = parse_iv(start + 2);",
          "1227:     if (!var_hash) return 0;",
          "1229:  if (elements < 0) {",
          "1230:   return 0;",
          "1231:  }",
          "1235:  array_init_size(*rval, elements);",
          "1237:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_ARRVAL_PP(rval), elements, 0)) {",
          "1238:   return 0;",
          "1239:  }",
          "1241:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "1243: #line 1244 \"ext/standard/var_unserializer.c\"",
          "1244: yy88:",
          "1247:   if (yych == '+') goto yy96;",
          "1248:   goto yy18;",
          "1250:   if (yych <= '-') goto yy96;",
          "1252:   if (yych >= ':') goto yy18;",
          "1254: yy89:",
          "1259:  if (yych <= '9') goto yy89;",
          "1260:  if (yych == ';') goto yy71;",
          "1261:  goto yy18;",
          "1262: yy91:",
          "1263:  yych = *++YYCURSOR;",
          "1264:  if (yych == ';') goto yy97;",
          "1265:  goto yy18;",
          "1266: yy92:",
          "1268: #line 699 \"ext/standard/var_unserializer.re\"",
          "1270:     if (!var_hash) return 0;",
          "1272:  INIT_PZVAL(*rval);",
          "1274:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "1275:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "1276: }",
          "1277: #line 1278 \"ext/standard/var_unserializer.c\"",
          "1278: yy94:",
          "1279:  ++YYCURSOR;",
          "1280: #line 610 \"ext/standard/var_unserializer.re\"",
          "1281:  {",
          "1282:  size_t len, maxlen;",
          "1283:  char *str;",
          "1285:  len = parse_uiv(start + 2);",
          "1286:  maxlen = max - YYCURSOR;",
          "1287:  if (maxlen < len) {",
          "1292:  str = (char*)YYCURSOR;",
          "1294:  YYCURSOR += len;",
          "1296:  if (*(YYCURSOR) != '\"') {",
          "1298:   return 0;",
          "1299:  }",
          "1301:  if (*(YYCURSOR + 1) != ';') {",
          "1303:   return 0;",
          "1306:  YYCURSOR += 2;",
          "1309:  INIT_PZVAL(*rval);",
          "1310:  ZVAL_STRINGL(*rval, str, len, 1);",
          "1313: #line 1314 \"ext/standard/var_unserializer.c\"",
          "1317:  if (yych <= '9') goto yy89;",
          "1318:  goto yy18;",
          "1321: #line 585 \"ext/standard/var_unserializer.re\"",
          "1324:  INIT_PZVAL(*rval);",
          "1326:  if (!strncmp(start + 2, \"NAN\", 3)) {",
          "1327:   ZVAL_DOUBLE(*rval, php_get_nan());",
          "1328:  } else if (!strncmp(start + 2, \"INF\", 3)) {",
          "1329:   ZVAL_DOUBLE(*rval, php_get_inf());",
          "1330:  } else if (!strncmp(start + 2, \"-INF\", 4)) {",
          "1331:   ZVAL_DOUBLE(*rval, -php_get_inf());",
          "1336: #line 1337 \"ext/standard/var_unserializer.c\"",
          "1338: #line 865 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1084: #line 1085 \"ext/standard/var_unserializer.c\"",
          "1085: yy65:",
          "1088:   if (yych != '+') goto yy18;",
          "1090:   if (yych <= '-') goto yy66;",
          "1092:   if (yych <= '9') goto yy67;",
          "1095: yy66:",
          "1097:  if (yych <= ',') {",
          "1098:   if (yych == '+') goto yy69;",
          "1099:   goto yy18;",
          "1100:  } else {",
          "1101:   if (yych <= '-') goto yy69;",
          "1102:   if (yych <= '/') goto yy18;",
          "1103:   if (yych >= ':') goto yy18;",
          "1104:  }",
          "1105: yy67:",
          "1106:  ++YYCURSOR;",
          "1107:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "1108:  yych = *YYCURSOR;",
          "1109:  if (yych <= '/') goto yy18;",
          "1110:  if (yych <= '9') goto yy67;",
          "1111:  if (yych == ';') goto yy63;",
          "1113: yy69:",
          "1115:  if (yych <= '/') goto yy18;",
          "1116:  if (yych <= '9') goto yy67;",
          "1118: yy70:",
          "1120:  if ((YYLIMIT - YYCURSOR) < 4) YYFILL(4);",
          "1121:  yych = *YYCURSOR;",
          "1122:  if (yych <= ';') {",
          "1123:   if (yych <= '/') goto yy18;",
          "1124:   if (yych <= '9') goto yy70;",
          "1125:   if (yych <= ':') goto yy18;",
          "1126:   goto yy63;",
          "1127:  } else {",
          "1128:   if (yych <= 'E') {",
          "1129:    if (yych <= 'D') goto yy18;",
          "1130:    goto yy65;",
          "1132:    if (yych == 'e') goto yy65;",
          "1133:    goto yy18;",
          "1136: yy72:",
          "1137:  yych = *++YYCURSOR;",
          "1138:  if (yych != 'F') goto yy18;",
          "1139: yy73:",
          "1140:  yych = *++YYCURSOR;",
          "1141:  if (yych != ';') goto yy18;",
          "1142:  ++YYCURSOR;",
          "1143: #line 590 \"ext/standard/var_unserializer.re\"",
          "1144:  {",
          "1148:  if (!strncmp(start + 2, \"NAN\", 3)) {",
          "1149:   ZVAL_DOUBLE(*rval, php_get_nan());",
          "1150:  } else if (!strncmp(start + 2, \"INF\", 3)) {",
          "1151:   ZVAL_DOUBLE(*rval, php_get_inf());",
          "1152:  } else if (!strncmp(start + 2, \"-INF\", 4)) {",
          "1153:   ZVAL_DOUBLE(*rval, -php_get_inf());",
          "1154:  }",
          "1158: #line 1159 \"ext/standard/var_unserializer.c\"",
          "1159: yy76:",
          "1161:  if (yych == 'N') goto yy73;",
          "1163: yy77:",
          "1164:  yych = *++YYCURSOR;",
          "1165:  if (yych <= ',') {",
          "1166:   if (yych != '+') goto yy18;",
          "1167:  } else {",
          "1168:   if (yych <= '-') goto yy78;",
          "1169:   if (yych <= '/') goto yy18;",
          "1170:   if (yych <= '9') goto yy79;",
          "1171:   goto yy18;",
          "1173: yy78:",
          "1175:  if (yych <= '/') goto yy18;",
          "1176:  if (yych >= ':') goto yy18;",
          "1177: yy79:",
          "1179:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "1180:  yych = *YYCURSOR;",
          "1181:  if (yych <= '/') goto yy18;",
          "1182:  if (yych <= '9') goto yy79;",
          "1183:  if (yych != ';') goto yy18;",
          "1184:  ++YYCURSOR;",
          "1185: #line 563 \"ext/standard/var_unserializer.re\"",
          "1187: #if SIZEOF_LONG == 4",
          "1188:  int digits = YYCURSOR - start - 3;",
          "1190:  if (start[2] == '-' || start[2] == '+') {",
          "1191:   digits--;",
          "1195:  if (digits >= MAX_LENGTH_OF_LONG - 1) {",
          "1196:   if (digits == MAX_LENGTH_OF_LONG - 1) {",
          "1197:    int cmp = strncmp(YYCURSOR - MAX_LENGTH_OF_LONG, long_min_digits, MAX_LENGTH_OF_LONG - 1);",
          "1199:    if (!(cmp < 0 || (cmp == 0 && start[2] == '-'))) {",
          "1200:     goto use_double;",
          "1203:    goto use_double;",
          "1206: #endif",
          "1208:  INIT_PZVAL(*rval);",
          "1209:  ZVAL_LONG(*rval, parse_iv(start + 2));",
          "1210:  return 1;",
          "1212: #line 1213 \"ext/standard/var_unserializer.c\"",
          "1213: yy83:",
          "1214:  yych = *++YYCURSOR;",
          "1215:  if (yych <= '/') goto yy18;",
          "1216:  if (yych >= '2') goto yy18;",
          "1217:  yych = *++YYCURSOR;",
          "1218:  if (yych != ';') goto yy18;",
          "1220: #line 556 \"ext/standard/var_unserializer.re\"",
          "1224:  ZVAL_BOOL(*rval, parse_iv(start + 2));",
          "1227: #line 1228 \"ext/standard/var_unserializer.c\"",
          "1228: yy87:",
          "1230: #line 549 \"ext/standard/var_unserializer.re\"",
          "1234:  ZVAL_NULL(*rval);",
          "1235:  return 1;",
          "1237: #line 1238 \"ext/standard/var_unserializer.c\"",
          "1238: yy89:",
          "1241:   if (yych != '+') goto yy18;",
          "1243:   if (yych <= '-') goto yy90;",
          "1245:   if (yych <= '9') goto yy91;",
          "1246:   goto yy18;",
          "1248: yy90:",
          "1249:  yych = *++YYCURSOR;",
          "1250:  if (yych <= '/') goto yy18;",
          "1251:  if (yych >= ':') goto yy18;",
          "1252: yy91:",
          "1257:  if (yych <= '9') goto yy91;",
          "1258:  if (yych != ';') goto yy18;",
          "1260: #line 526 \"ext/standard/var_unserializer.re\"",
          "1262:  long id;",
          "1265:  if (!var_hash) return 0;",
          "1267:  id = parse_iv(start + 2) - 1;",
          "1268:  if (id == -1 || var_access(var_hash, id, &rval_ref) != SUCCESS) {",
          "1272:  if (*rval == *rval_ref) return 0;",
          "1274:  if (*rval != NULL) {",
          "1275:   var_push_dtor_no_addref(var_hash, rval);",
          "1278:  Z_ADDREF_PP(rval);",
          "1279:  Z_UNSET_ISREF_PP(rval);",
          "1283: #line 1284 \"ext/standard/var_unserializer.c\"",
          "1284: yy95:",
          "1285:  yych = *++YYCURSOR;",
          "1286:  if (yych <= ',') {",
          "1287:   if (yych != '+') goto yy18;",
          "1288:  } else {",
          "1289:   if (yych <= '-') goto yy96;",
          "1290:   if (yych <= '/') goto yy18;",
          "1291:   if (yych <= '9') goto yy97;",
          "1292:   goto yy18;",
          "1293:  }",
          "1297:  if (yych >= ':') goto yy18;",
          "1300:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "1301:  yych = *YYCURSOR;",
          "1302:  if (yych <= '/') goto yy18;",
          "1303:  if (yych <= '9') goto yy97;",
          "1304:  if (yych != ';') goto yy18;",
          "1305:  ++YYCURSOR;",
          "1306: #line 505 \"ext/standard/var_unserializer.re\"",
          "1308:  long id;",
          "1311:  if (!var_hash) return 0;",
          "1313:  id = parse_iv(start + 2) - 1;",
          "1314:  if (id == -1 || var_access(var_hash, id, &rval_ref) != SUCCESS) {",
          "1315:   return 0;",
          "1316:  }",
          "1318:  if (*rval != NULL) {",
          "1319:   var_push_dtor_no_addref(var_hash, rval);",
          "1322:  Z_ADDREF_PP(rval);",
          "1323:  Z_SET_ISREF_PP(rval);",
          "1327: #line 1328 \"ext/standard/var_unserializer.c\"",
          "1329: #line 879 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "409: {",
          "410:  long elements;",
          "412:  elements = parse_iv2((*p) + 2, p);",
          "414:  (*p) += 2;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "412:  if( *p >= max - 2) {",
          "413:   zend_error(E_WARNING, \"Bad unserialize data\");",
          "414:   return -1;",
          "415:  }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "421:   zend_error(E_WARNING, \"Erroneous data format for unserializing '%s'\", ce->name);",
          "423:  }",
          "425:  return elements;",
          "",
          "[Removed Lines]",
          "422:   return 0;",
          "",
          "[Added Lines]",
          "427:   return -1;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "697: }",
          "699: \"o:\" iv \":\" [\"] {",
          "700:     if (!var_hash) return 0;",
          "702:  INIT_PZVAL(*rval);",
          "706: }",
          "708: object \":\" uiv \":\" [\"] {",
          "",
          "[Removed Lines]",
          "704:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "705:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "",
          "[Added Lines]",
          "705:  long elements;",
          "710:  elements = object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR);",
          "711:  if (elements < 0) {",
          "712:   return 0;",
          "713:  }",
          "714:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "847:  elements = object_common1(UNSERIALIZE_PASSTHRU, ce);",
          "849:  if (incomplete_class) {",
          "850:   php_store_class_name(*rval, class_name, len2);",
          "851:  }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "858:  if (elements < 0) {",
          "859:     efree(class_name);",
          "860:     return 0;",
          "861:  }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "6fc358241b84866e8f688055d577ba2fcaf2bbd3",
      "candidate_info": {
        "commit_hash": "6fc358241b84866e8f688055d577ba2fcaf2bbd3",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/6fc358241b84866e8f688055d577ba2fcaf2bbd3",
        "files": [
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Use specialized efree_size()",
        "before_after_code_files": [
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "178:  while (var_hash) {",
          "179:   next = var_hash->next;",
          "181:   var_hash = next;",
          "182:  }",
          "",
          "[Removed Lines]",
          "180:   efree(var_hash);",
          "",
          "[Added Lines]",
          "180:   efree_size(var_hash, sizeof(var_entries));",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "186:    zval_ptr_dtor(&var_dtor_hash->data[i]);",
          "187:   }",
          "188:   next = var_dtor_hash->next;",
          "190:   var_dtor_hash = next;",
          "191:  }",
          "192: }",
          "",
          "[Removed Lines]",
          "189:   efree(var_dtor_hash);",
          "",
          "[Added Lines]",
          "189:   efree_size(var_dtor_hash, sizeof(var_dtor_entries));",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "665:  if (yybm[0+yych] & 128) {",
          "666:   goto yy20;",
          "667:  }",
          "670:  yych = *++YYCURSOR;",
          "671:  if (yych != '\"') goto yy18;",
          "672:  ++YYCURSOR;",
          "",
          "[Removed Lines]",
          "668:  if (yych <= '/') goto yy18;",
          "669:  if (yych >= ';') goto yy18;",
          "",
          "[Added Lines]",
          "668:  if (yych != ':') goto yy18;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "816:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "817: }",
          "819: yy25:",
          "820:  yych = *++YYCURSOR;",
          "821:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "818: #line 819 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "817: #line 818 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "848:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "849:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "850: }",
          "852: yy32:",
          "853:  yych = *++YYCURSOR;",
          "854:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "851: #line 852 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "850: #line 851 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "891:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "892: }",
          "894: yy39:",
          "895:  yych = *++YYCURSOR;",
          "896:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "893: #line 894 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "892: #line 893 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "939:  ZVAL_STR(rval, str);",
          "940:  return 1;",
          "941: }",
          "943: yy46:",
          "944:  yych = *++YYCURSOR;",
          "945:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "942: #line 943 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "941: #line 942 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "987:  ZVAL_STRINGL(rval, str, len);",
          "988:  return 1;",
          "989: }",
          "991: yy53:",
          "992:  yych = *++YYCURSOR;",
          "993:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "990: #line 991 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "989: #line 990 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "1084:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1085:  return 1;",
          "1086: }",
          "1088: yy65:",
          "1089:  yych = *++YYCURSOR;",
          "1090:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1087: #line 1088 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1086: #line 1087 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "1160:  return 1;",
          "1161: }",
          "1163: yy76:",
          "1164:  yych = *++YYCURSOR;",
          "1165:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1162: #line 1163 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1161: #line 1162 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "1212:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1213:  return 1;",
          "1214: }",
          "1216: yy83:",
          "1217:  yych = *++YYCURSOR;",
          "1218:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1215: #line 1216 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1214: #line 1215 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "1226:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1227:  return 1;",
          "1228: }",
          "1230: yy87:",
          "1231:  ++YYCURSOR;",
          "1232: #line 581 \"ext/standard/var_unserializer.re\"",
          "",
          "[Removed Lines]",
          "1229: #line 1230 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1228: #line 1229 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "1235:  ZVAL_NULL(rval);",
          "1236:  return 1;",
          "1237: }",
          "1239: yy89:",
          "1240:  yych = *++YYCURSOR;",
          "1241:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1238: #line 1239 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1237: #line 1238 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "1282:  return 1;",
          "1283: }",
          "1285: yy95:",
          "1286:  yych = *++YYCURSOR;",
          "1287:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1284: #line 1285 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1283: #line 1284 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1327:  return 1;",
          "1328: }",
          "1330: }",
          "1331: #line 881 \"ext/standard/var_unserializer.re\"",
          "",
          "[Removed Lines]",
          "1329: #line 1330 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1328: #line 1329 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "176:  while (var_hash) {",
          "177:   next = var_hash->next;",
          "179:   var_hash = next;",
          "180:  }",
          "",
          "[Removed Lines]",
          "178:   efree(var_hash);",
          "",
          "[Added Lines]",
          "178:   efree_size(var_hash, sizeof(var_entries));",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "184:    zval_ptr_dtor(&var_dtor_hash->data[i]);",
          "185:   }",
          "186:   next = var_dtor_hash->next;",
          "188:   var_dtor_hash = next;",
          "189:  }",
          "190: }",
          "",
          "[Removed Lines]",
          "187:   efree(var_dtor_hash);",
          "",
          "[Added Lines]",
          "187:   efree_size(var_dtor_hash, sizeof(var_dtor_entries));",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "6ee5e813ab5e97624a8474269ed5bdb7f6b85de5",
      "candidate_info": {
        "commit_hash": "6ee5e813ab5e97624a8474269ed5bdb7f6b85de5",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/6ee5e813ab5e97624a8474269ed5bdb7f6b85de5",
        "files": [
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "var_push_dtor_no_addref() is useles (var_push_dtor() doesn't work properly as well)",
        "before_after_code_files": [
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "83:  var_hash->data[var_hash->used_slots++] = rval;",
          "84: }",
          "86: PHPAPI void var_push_dtor_no_addref(php_unserialize_data_t *var_hashx, zval *rval)",
          "87: {",
          "88:  var_entries *var_hash = (*var_hashx)->last_dtor;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "87: #if 0",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "107:  var_hash->data[var_hash->used_slots++] = rval;",
          "108: }",
          "110: static int var_access(php_unserialize_data_t *var_hashx, long id, zval **store)",
          "111: {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "111: #endif",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "207: #define YYMARKER marker",
          "",
          "[Removed Lines]",
          "210: #line 215 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "213: #line 218 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "439:  start = cursor;",
          "443: {",
          "444:  YYCTYPE yych;",
          "445:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "442: #line 443 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "445: #line 446 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "499:  yych = *(YYMARKER = ++YYCURSOR);",
          "500:  if (yych == ':') goto yy95;",
          "501: yy3:",
          "503:  { return 0; }",
          "505: yy4:",
          "506:  yych = *(YYMARKER = ++YYCURSOR);",
          "507:  if (yych == ':') goto yy89;",
          "",
          "[Removed Lines]",
          "502: #line 789 \"ext/standard/var_unserializer.re\"",
          "504: #line 505 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "505: #line 792 \"ext/standard/var_unserializer.re\"",
          "507: #line 508 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "544:  goto yy3;",
          "545: yy14:",
          "546:  ++YYCURSOR;",
          "548:  {",
          "550:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
          "552: }",
          "554: yy16:",
          "555:  yych = *++YYCURSOR;",
          "556:  goto yy3;",
          "",
          "[Removed Lines]",
          "547: #line 783 \"ext/standard/var_unserializer.re\"",
          "553: #line 554 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "550: #line 786 \"ext/standard/var_unserializer.re\"",
          "556: #line 557 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "580:  yych = *++YYCURSOR;",
          "581:  if (yych != '\"') goto yy18;",
          "582:  ++YYCURSOR;",
          "584:  {",
          "585:  size_t len, len2, len3, maxlen;",
          "586:  long elements;",
          "",
          "[Removed Lines]",
          "583: #line 644 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "586: #line 647 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "720:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "721: }",
          "723: yy25:",
          "724:  yych = *++YYCURSOR;",
          "725:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "722: #line 723 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "725: #line 726 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "744:  yych = *++YYCURSOR;",
          "745:  if (yych != '\"') goto yy18;",
          "746:  ++YYCURSOR;",
          "748:  {",
          "",
          "[Removed Lines]",
          "747: #line 636 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "750: #line 639 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "752:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "753:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "754: }",
          "756: yy32:",
          "757:  yych = *++YYCURSOR;",
          "758:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "755: #line 756 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "758: #line 759 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "773:  yych = *++YYCURSOR;",
          "774:  if (yych != '{') goto yy18;",
          "775:  ++YYCURSOR;",
          "777:  {",
          "778:  long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "776: #line 615 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "779: #line 618 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "795:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "796: }",
          "798: yy39:",
          "799:  yych = *++YYCURSOR;",
          "800:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "797: #line 798 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "800: #line 801 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "815:  yych = *++YYCURSOR;",
          "816:  if (yych != '\"') goto yy18;",
          "817:  ++YYCURSOR;",
          "819:  {",
          "820:  size_t len, maxlen;",
          "",
          "[Removed Lines]",
          "818: #line 585 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "821: #line 588 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "845:  efree(str);",
          "846:  return 1;",
          "847: }",
          "849: yy46:",
          "850:  yych = *++YYCURSOR;",
          "851:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "848: #line 849 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "851: #line 852 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "866:  yych = *++YYCURSOR;",
          "867:  if (yych != '\"') goto yy18;",
          "868:  ++YYCURSOR;",
          "870:  {",
          "871:  size_t len, maxlen;",
          "872:  char *str;",
          "",
          "[Removed Lines]",
          "869: #line 558 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "872: #line 561 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "893:  ZVAL_STRINGL(rval, str, len);",
          "894:  return 1;",
          "895: }",
          "897: yy53:",
          "898:  yych = *++YYCURSOR;",
          "899:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "896: #line 897 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "899: #line 900 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "981:  }",
          "982: yy63:",
          "983:  ++YYCURSOR;",
          "985:  {",
          "986: #if SIZEOF_LONG == 4",
          "987: use_double:",
          "",
          "[Removed Lines]",
          "984: #line 549 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "987: #line 552 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "990:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "991:  return 1;",
          "992: }",
          "994: yy65:",
          "995:  yych = *++YYCURSOR;",
          "996:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "993: #line 994 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "996: #line 997 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1049:  yych = *++YYCURSOR;",
          "1050:  if (yych != ';') goto yy18;",
          "1051:  ++YYCURSOR;",
          "1053:  {",
          "",
          "[Removed Lines]",
          "1052: #line 533 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1055: #line 536 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1066:  return 1;",
          "1067: }",
          "1069: yy76:",
          "1070:  yych = *++YYCURSOR;",
          "1071:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1068: #line 1069 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1071: #line 1072 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "1092:  if (yych <= '9') goto yy79;",
          "1093:  if (yych != ';') goto yy18;",
          "1094:  ++YYCURSOR;",
          "1096:  {",
          "1097: #if SIZEOF_LONG == 4",
          "1098:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1095: #line 507 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1098: #line 510 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "1118:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1119:  return 1;",
          "1120: }",
          "1122: yy83:",
          "1123:  yych = *++YYCURSOR;",
          "1124:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1121: #line 1122 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1124: #line 1125 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "1126:  yych = *++YYCURSOR;",
          "1127:  if (yych != ';') goto yy18;",
          "1128:  ++YYCURSOR;",
          "1130:  {",
          "1132:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1133:  return 1;",
          "1134: }",
          "1136: yy87:",
          "1137:  ++YYCURSOR;",
          "1139:  {",
          "1141:  ZVAL_NULL(rval);",
          "1142:  return 1;",
          "1143: }",
          "1145: yy89:",
          "1146:  yych = *++YYCURSOR;",
          "1147:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1129: #line 501 \"ext/standard/var_unserializer.re\"",
          "1135: #line 1136 \"ext/standard/var_unserializer.c\"",
          "1138: #line 495 \"ext/standard/var_unserializer.re\"",
          "1144: #line 1145 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1132: #line 504 \"ext/standard/var_unserializer.re\"",
          "1138: #line 1139 \"ext/standard/var_unserializer.c\"",
          "1141: #line 498 \"ext/standard/var_unserializer.re\"",
          "1147: #line 1148 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "1164:  if (yych <= '9') goto yy91;",
          "1165:  if (yych != ';') goto yy18;",
          "1166:  ++YYCURSOR;",
          "1168:  {",
          "1169:  long id;",
          "",
          "[Removed Lines]",
          "1167: #line 472 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1170: #line 475 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 25 ---",
          "[Context before]",
          "1185:  ZVAL_COPY(rval, rval_ref);",
          "1188:  return 1;",
          "1189: }",
          "1191: yy95:",
          "1192:  yych = *++YYCURSOR;",
          "1193:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1182:  if (!ZVAL_IS_UNDEF(rval)) {",
          "1183:   var_push_dtor_no_addref(var_hash, rval);",
          "1184:  }",
          "1190: #line 1191 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1193: #line 1194 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 26 ---",
          "[Context before]",
          "1210:  if (yych <= '9') goto yy97;",
          "1211:  if (yych != ';') goto yy18;",
          "1212:  ++YYCURSOR;",
          "1214:  {",
          "1215:  long id;",
          "",
          "[Removed Lines]",
          "1213: #line 447 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1216: #line 450 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 27 ---",
          "[Context before]",
          "1236:  return 1;",
          "1237: }",
          "1239: }",
          "1243:  return 0;",
          "",
          "[Removed Lines]",
          "1238: #line 1239 \"ext/standard/var_unserializer.c\"",
          "1240: #line 791 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1241: #line 1242 \"ext/standard/var_unserializer.c\"",
          "1243: #line 794 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "81:  var_hash->data[var_hash->used_slots++] = rval;",
          "82: }",
          "84: PHPAPI void var_push_dtor_no_addref(php_unserialize_data_t *var_hashx, zval *rval)",
          "85: {",
          "86:  var_entries *var_hash = (*var_hashx)->last_dtor;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "85: #if 0",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "105:  var_hash->data[var_hash->used_slots++] = rval;",
          "106: }",
          "108: static int var_access(php_unserialize_data_t *var_hashx, long id, zval **store)",
          "109: {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "109: #endif",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "489:  ZVAL_COPY(rval, rval_ref);",
          "",
          "[Removed Lines]",
          "486:  if (!ZVAL_IS_UNDEF(rval)) {",
          "487:   var_push_dtor_no_addref(var_hash, rval);",
          "488:  }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    }
  ]
}