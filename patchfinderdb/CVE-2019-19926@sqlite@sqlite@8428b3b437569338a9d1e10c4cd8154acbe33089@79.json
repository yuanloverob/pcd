{
  "cve_id": "CVE-2019-19926",
  "cve_desc": "multiSelect in select.c in SQLite 3.30.1 mishandles certain errors during parsing, as demonstrated by errors from sqlite3WindowRewrite() calls. NOTE: this vulnerability exists because of an incomplete fix for CVE-2019-19880.",
  "repo": "sqlite/sqlite",
  "patch_hash": "8428b3b437569338a9d1e10c4cd8154acbe33089",
  "patch_info": {
    "commit_hash": "8428b3b437569338a9d1e10c4cd8154acbe33089",
    "repo": "sqlite/sqlite",
    "commit_url": "https://github.com/sqlite/sqlite/commit/8428b3b437569338a9d1e10c4cd8154acbe33089",
    "files": [
      "manifest",
      "manifest.uuid",
      "src/select.c"
    ],
    "message": "Continuation of [e2bddcd4c55ba3cb]: Add another spot where it is necessary to abort early due to prior errors in sqlite3WindowRewrite().\n\nFossilOrigin-Name: cba2a2a44cdf138a629109bb0ad088ed4ef67fc66bed3e0373554681a39615d2",
    "before_after_code_files": [
      "manifest.uuid||manifest.uuid",
      "src/select.c||src/select.c"
    ]
  },
  "patch_diff": {
    "manifest.uuid||manifest.uuid": [
      "File: manifest.uuid -> manifest.uuid",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "1: 3d4c0bf8904135fa68c75801bfa738715cacc3b19dc8ad6ef550b11798d4b121",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ],
    "src/select.c||src/select.c": [
      "File: src/select.c -> src/select.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "2809:     }",
      "2810:   #endif",
      "2811:   }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "2812:   if( pParse->nErr ) goto multi_select_end;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "b5f6243f6d851422dc643977cee096786eb0d0fd",
      "candidate_info": {
        "commit_hash": "b5f6243f6d851422dc643977cee096786eb0d0fd",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/b5f6243f6d851422dc643977cee096786eb0d0fd",
        "files": [
          "manifest",
          "manifest.uuid",
          "src/insert.c",
          "src/vdbe.c"
        ],
        "message": "Set the affinity of regular columns prior to computing the values of generated columns.  Ticket [d7c3f125c925c522]\n\nFossilOrigin-Name: d47d66e3d360d8aa6203a855228d2bc40d9a00d69c15f5066b7632d8fb1ed2cc",
        "before_after_code_files": [
          "manifest.uuid||manifest.uuid",
          "src/insert.c||src/insert.c",
          "src/vdbe.c||src/vdbe.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: f065cf003bd2a3a580cb5b9fa2eacd8be075fe8c2bbc5688e9a9406abbfb3804",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/insert.c||src/insert.c": [
          "File: src/insert.c -> src/insert.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "229:   Walker w;",
          "230:   Column *pRedo;",
          "231:   int eProgress;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "232:   VdbeOp *pOp;",
          "234:   assert( pTab->tabFlags & TF_HasGenerated );",
          "235:   testcase( pTab->tabFlags & TF_HasVirtual );",
          "236:   testcase( pTab->tabFlags & TF_HasStored );",
          "241:   sqlite3TableAffinity(pParse->pVdbe, pTab, iRegStore);",
          "242:   if( (pTab->tabFlags & TF_HasStored)!=0",
          "243:    && (pOp = sqlite3VdbeGetOp(pParse->pVdbe,-1))->opcode==OP_Affinity",
          "244:   ){",
          "248:     int ii, jj;",
          "249:     char *zP4 = pOp->p4.z;",
          "250:     assert( zP4!=0 );",
          "251:     assert( pOp->p4type==P4_DYNAMIC );",
          "252:     for(ii=jj=0; zP4[jj]; ii++){",
          "253:       if( pTab->aCol[ii].colFlags & COLFLAG_VIRTUAL ){",
          "254:         continue;",
          "255:       }",
          "256:       if( pTab->aCol[ii].colFlags & COLFLAG_STORED ){",
          "257:         zP4[jj] = SQLITE_AFF_NONE;",
          "258:       }",
          "259:       jj++;",
          "260:     }",
          "261:   }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1191:     if( pTab->tabFlags & TF_HasGenerated ){",
          "1194:       sqlite3ComputeGeneratedColumns(pParse, regRowid+1, pTab);",
          "1195:     }",
          "1196: #endif",
          "",
          "[Removed Lines]",
          "1192:       testcase( pTab->tabFlags & TF_HasVirtual );",
          "1193:       testcase( pTab->tabFlags & TF_HasStored );",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/vdbe.c||src/vdbe.c": [
          "File: src/vdbe.c -> src/vdbe.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2818:   pIn1 = &aMem[pOp->p1];",
          "2819:   while( 1 /*exit-by-break*/ ){",
          "2820:     assert( pIn1 <= &p->aMem[(p->nMem+1 - p->nCursor)] );",
          "2822:     applyAffinity(pIn1, zAffinity[0], encoding);",
          "2823:     if( zAffinity[0]==SQLITE_AFF_REAL && (pIn1->flags & MEM_Int)!=0 ){",
          "",
          "[Removed Lines]",
          "2821:     assert( memIsValid(pIn1) );",
          "",
          "[Added Lines]",
          "2821:     assert( zAffinity[0]==SQLITE_AFF_NONE || memIsValid(pIn1) );",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "ec123e13014c585d1c408e1583714de438b50aff",
      "candidate_info": {
        "commit_hash": "ec123e13014c585d1c408e1583714de438b50aff",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/ec123e13014c585d1c408e1583714de438b50aff",
        "files": [
          "manifest",
          "manifest.uuid",
          "src/walker.c"
        ],
        "message": "Fix an indentation error and improve the placement of an assert() based on a tweet from Yuri Kotov.\n\nFossilOrigin-Name: e6314e386c6877c669bd32788d3886253b0a187bee2c3889f4eaba219f5e52c7",
        "before_after_code_files": [
          "manifest.uuid||manifest.uuid",
          "src/walker.c||src/walker.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: f24e6ca4f23008212ec05cace9202dbeb37ee34530ead91fac2f5e3eac7f6347",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/walker.c||src/walker.c": [
          "File: src/walker.c -> src/walker.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "73:     rc = pWalker->xExprCallback(pWalker, pExpr);",
          "74:     if( rc ) return rc & WRC_Abort;",
          "75:     if( !ExprHasProperty(pExpr,(EP_TokenOnly|EP_Leaf)) ){",
          "76:       if( pExpr->pLeft && walkExpr(pWalker, pExpr->pLeft) ) return WRC_Abort;",
          "78:       if( pExpr->pRight ){",
          "79:         assert( !ExprHasProperty(pExpr, EP_WinFunc) );",
          "80:         pExpr = pExpr->pRight;",
          "",
          "[Removed Lines]",
          "77:        assert( pExpr->x.pList==0 || pExpr->pRight==0 );",
          "",
          "[Added Lines]",
          "76:       assert( pExpr->x.pList==0 || pExpr->pRight==0 );",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "f72a97925d6a382a58cef98510c8bc430e91ee25",
      "candidate_info": {
        "commit_hash": "f72a97925d6a382a58cef98510c8bc430e91ee25",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/f72a97925d6a382a58cef98510c8bc430e91ee25",
        "files": [
          "manifest",
          "manifest.uuid",
          "test/fuzzdata8.db"
        ],
        "message": "Add new test cases to test/fuzzdata8.db\n\nFossilOrigin-Name: f908cd40b275a5753d5167ebb25871300381687adcb3a7fcb1f14b57a20ee3d0",
        "before_after_code_files": [
          "manifest.uuid||manifest.uuid"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: 1e16d3e8fc60d39ca3899759ff15d355fdd7d3e23b325d8d2b0f954e11ce8dce",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "66c48907a2abc90a78760f7281acb1f720adc1c7",
      "candidate_info": {
        "commit_hash": "66c48907a2abc90a78760f7281acb1f720adc1c7",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/66c48907a2abc90a78760f7281acb1f720adc1c7",
        "files": [
          "manifest",
          "manifest.uuid",
          "src/main.c",
          "src/pragma.h",
          "src/shell.c.in",
          "src/sqlite.h.in",
          "src/test1.c",
          "test/alter3.test",
          "test/alter4.test",
          "test/conflict3.test",
          "test/corruptC.test",
          "test/corruptE.test",
          "test/descidx1.test",
          "test/descidx2.test",
          "test/descidx3.test",
          "test/distinct2.test",
          "test/filter1.test",
          "test/format4.test",
          "test/indexexpr2.test",
          "test/insert4.test",
          "test/join.test",
          "test/minmax2.test",
          "test/nulls1.test",
          "test/pragma4.test",
          "test/rowvaluevtab.test",
          "test/tkt-18458b1a.test",
          "test/tkt-a7debbe0.test",
          "test/tkt3292.test",
          "test/window9.test",
          "tool/mkpragmatab.tcl"
        ],
        "message": "Remove the legacy_file_format PRAGMA.  In its place, provide the SQLITE_DBCONFIG_LEGACY_FILE_FORMAT option to sqlite3_db_config(). Fix for ticket [6484e6ce678fffab]\n\nFossilOrigin-Name: 4d424f3047b48fc441475137f30a719d2f079390c86fe2617710ddfb05c5e240",
        "before_after_code_files": [
          "manifest.uuid||manifest.uuid",
          "src/main.c||src/main.c",
          "src/pragma.h||src/pragma.h",
          "src/shell.c.in||src/shell.c.in",
          "src/sqlite.h.in||src/sqlite.h.in",
          "src/test1.c||src/test1.c",
          "test/alter3.test||test/alter3.test",
          "test/alter4.test||test/alter4.test",
          "test/conflict3.test||test/conflict3.test",
          "test/corruptC.test||test/corruptC.test",
          "test/corruptE.test||test/corruptE.test",
          "test/descidx1.test||test/descidx1.test",
          "test/descidx2.test||test/descidx2.test",
          "test/descidx3.test||test/descidx3.test",
          "test/distinct2.test||test/distinct2.test",
          "test/filter1.test||test/filter1.test",
          "test/format4.test||test/format4.test",
          "test/indexexpr2.test||test/indexexpr2.test",
          "test/insert4.test||test/insert4.test",
          "test/join.test||test/join.test",
          "test/minmax2.test||test/minmax2.test",
          "test/nulls1.test||test/nulls1.test",
          "test/pragma4.test||test/pragma4.test",
          "test/rowvaluevtab.test||test/rowvaluevtab.test",
          "test/tkt-18458b1a.test||test/tkt-18458b1a.test",
          "test/tkt-a7debbe0.test||test/tkt-a7debbe0.test",
          "test/tkt3292.test||test/tkt3292.test",
          "test/window9.test||test/window9.test",
          "tool/mkpragmatab.tcl||tool/mkpragmatab.tcl"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: 4fba090e678ef184736277c9ec9a9374c8bd4df4d41f51a3dc6818e2efcc103b",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/main.c||src/main.c": [
          "File: src/main.c -> src/main.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "851:         { SQLITE_DBCONFIG_LEGACY_ALTER_TABLE,    SQLITE_LegacyAlter    },",
          "852:         { SQLITE_DBCONFIG_DQS_DDL,               SQLITE_DqsDDL         },",
          "853:         { SQLITE_DBCONFIG_DQS_DML,               SQLITE_DqsDML         },",
          "854:       };",
          "855:       unsigned int i;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "854:         { SQLITE_DBCONFIG_LEGACY_FILE_FORMAT,    SQLITE_LegacyFileFmt  },",
          "",
          "---------------"
        ],
        "src/pragma.h||src/pragma.h": [
          "File: src/pragma.h -> src/pragma.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "404: #endif",
          "405: #if !defined(SQLITE_OMIT_PAGER_PRAGMAS) && SQLITE_ENABLE_LOCKING_STYLE",
          "406:  {/* zName:     */ \"lock_proxy_file\",",
          "",
          "[Removed Lines]",
          "399:  {/* zName:     */ \"legacy_file_format\",",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/shell.c.in||src/shell.c.in": [
          "File: src/shell.c.in -> src/shell.c.in",
          "--- Hunk 1 ---",
          "[Context before]",
          "7171:         { \"legacy_alter_table\", SQLITE_DBCONFIG_LEGACY_ALTER_TABLE    },",
          "7172:         { \"dqs_dml\",            SQLITE_DBCONFIG_DQS_DML               },",
          "7173:         { \"dqs_ddl\",            SQLITE_DBCONFIG_DQS_DDL               },",
          "7174:     };",
          "7175:     int ii, v;",
          "7176:     open_db(p, 0);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "7174:         { \"legacy_file_format\", SQLITE_DBCONFIG_LEGACY_FILE_FORMAT    },",
          "",
          "---------------"
        ],
        "src/sqlite.h.in||src/sqlite.h.in": [
          "File: src/sqlite.h.in -> src/sqlite.h.in"
        ],
        "src/test1.c||src/test1.c": [
          "File: src/test1.c -> src/test1.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "7682:     { \"LEGACY_ALTER_TABLE\", SQLITE_DBCONFIG_LEGACY_ALTER_TABLE },",
          "7683:     { \"DQS_DML\",            SQLITE_DBCONFIG_DQS_DML },",
          "7684:     { \"DQS_DDL\",            SQLITE_DBCONFIG_DQS_DDL },",
          "7685:   };",
          "7686:   int i;",
          "7688:   const char *zSetting;",
          "7689:   sqlite3 *db;",
          "7693:     return TCL_ERROR;",
          "7694:   }",
          "7695:   if( getDbPointer(interp, Tcl_GetString(objv[1]), &db) ) return TCL_ERROR;",
          "",
          "[Removed Lines]",
          "7687:   int v;",
          "7691:   if( objc!=4 ){",
          "7692:     Tcl_WrongNumArgs(interp, 1, objv, \"DB SETTING VALUE\");",
          "",
          "[Added Lines]",
          "7685:     { \"LEGACY_FILE_FORMAT\", SQLITE_DBCONFIG_LEGACY_FILE_FORMAT },",
          "7688:   int v = 0;",
          "7692:   if( objc!=4 && objc!=3 ){",
          "7693:     Tcl_WrongNumArgs(interp, 1, objv, \"DB SETTING [VALUE]\");",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "7705:       Tcl_NewStringObj(\"unknown sqlite3_db_config setting\", -1));",
          "7706:     return TCL_ERROR;",
          "7707:   }",
          "7709:   sqlite3_db_config(db, aSetting[i].eVal, v, &v);",
          "7710:   Tcl_SetObjResult(interp, Tcl_NewIntObj(v));",
          "7711:   return TCL_OK;",
          "",
          "[Removed Lines]",
          "7708:   if( Tcl_GetIntFromObj(interp, objv[3], &v) ) return TCL_ERROR;",
          "",
          "[Added Lines]",
          "7709:   if( objc==4 ){",
          "7710:     if( Tcl_GetIntFromObj(interp, objv[3], &v) ) return TCL_ERROR;",
          "7711:   }else{",
          "7712:     v = -1;",
          "7713:   }",
          "",
          "---------------"
        ],
        "test/alter3.test||test/alter3.test": [
          "File: test/alter3.test -> test/alter3.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "54: }",
          "56: do_test alter3-1.1 {",
          "57:   execsql {",
          "59:     CREATE TABLE abc(a, b, c);",
          "60:     SELECT sql FROM sqlite_master;",
          "61:   }",
          "",
          "[Removed Lines]",
          "58:     PRAGMA legacy_file_format=ON;",
          "",
          "[Added Lines]",
          "57:   sqlite3_db_config db LEGACY_FILE_FORMAT 1",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "198:   db close",
          "199:   forcedelete test.db",
          "200:   set ::DB [sqlite3 db test.db]",
          "201:   execsql {",
          "203:     CREATE TABLE t1(a, b);",
          "204:     INSERT INTO t1 VALUES(1, 100);",
          "205:     INSERT INTO t1 VALUES(2, 300);",
          "",
          "[Removed Lines]",
          "202:     PRAGMA legacy_file_format=ON;",
          "",
          "[Added Lines]",
          "201:   sqlite3_db_config db LEGACY_FILE_FORMAT 1",
          "",
          "---------------"
        ],
        "test/alter4.test||test/alter4.test": [
          "File: test/alter4.test -> test/alter4.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "383: do_test alter4-10.1 {",
          "384:   db close",
          "385:   sqlite3 db :memory:",
          "386:   db eval {",
          "388:     CREATE TABLE t1(a,b,c);",
          "389:     CREATE INDEX t1a ON t1(a DESC);",
          "390:     INSERT INTO t1 VALUES(1,2,3);",
          "",
          "[Removed Lines]",
          "387:     PRAGMA legacy_file_format=on;",
          "",
          "[Added Lines]",
          "386:   sqlite3_db_config db LEGACY_FILE_FORMAT 1",
          "",
          "---------------"
        ],
        "test/conflict3.test||test/conflict3.test": [
          "File: test/conflict3.test -> test/conflict3.test"
        ],
        "test/corruptC.test||test/corruptC.test": [
          "File: test/corruptC.test -> test/corruptC.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "34: # Construct a compact, dense database for testing.",
          "35: #",
          "36: do_test corruptC-1.1 {",
          "37:   execsql {",
          "38:     PRAGMA auto_vacuum = 0;",
          "40:     BEGIN;",
          "41:     CREATE TABLE t1(x,y);",
          "42:     INSERT INTO t1 VALUES(1,1);",
          "",
          "[Removed Lines]",
          "39:     PRAGMA legacy_file_format=1;",
          "",
          "[Added Lines]",
          "37:   sqlite3_db_config db LEGACY_FILE_FORMAT 1",
          "",
          "---------------"
        ],
        "test/corruptE.test||test/corruptE.test": [
          "File: test/corruptE.test -> test/corruptE.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "36: # Construct a compact, dense database for testing.",
          "37: #",
          "38: do_test corruptE-1.1 {",
          "39:   execsql {",
          "40:     PRAGMA auto_vacuum = 0;",
          "42:     BEGIN;",
          "43:     CREATE TABLE t1(x,y);",
          "44:     INSERT INTO t1 VALUES(1,1);",
          "",
          "[Removed Lines]",
          "41:     PRAGMA legacy_file_format=1;",
          "",
          "[Added Lines]",
          "39:   sqlite3_db_config db LEGACY_FILE_FORMAT 1",
          "",
          "---------------"
        ],
        "test/descidx1.test||test/descidx1.test": [
          "File: test/descidx1.test -> test/descidx1.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "22: #",
          "23: do_not_use_codec",
          "27: # This procedure sets the value of the file-format in file 'test.db'",
          "28: # to $newval. Also, the schema cookie is incremented.",
          "",
          "[Removed Lines]",
          "25: db eval {PRAGMA legacy_file_format=OFF}",
          "",
          "[Added Lines]",
          "25: #db eval {PRAGMA legacy_file_format=OFF}",
          "26: sqlite3_db_config db LEGACY_FILE_FORMAT 0",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "299:     db close",
          "300:     forcedelete test.db test.db-journal",
          "301:     sqlite3 db test.db",
          "303:   } {1}",
          "304: } else {",
          "305:   do_test descidx1-6.1 {",
          "306:     db close",
          "307:     forcedelete test.db test.db-journal",
          "308:     sqlite3 db test.db",
          "310:   } {0}",
          "311: }",
          "312: do_test descidx1-6.2 {",
          "315: } {1}",
          "316: do_test descidx1-6.3 {",
          "317:   execsql {",
          "",
          "[Removed Lines]",
          "302:     execsql {PRAGMA legacy_file_format}",
          "309:     execsql {PRAGMA legacy_file_format}",
          "313:   execsql {PRAGMA legacy_file_format=YES}",
          "314:   execsql {PRAGMA legacy_file_format}",
          "",
          "[Added Lines]",
          "303:     sqlite3_db_config db LEGACY_FILE_FORMAT",
          "310:     sqlite3_db_config db LEGACY_FILE_FORMAT",
          "314:   sqlite3_db_config db LEGACY_FILE_FORMAT 1",
          "315:   sqlite3_db_config db LEGACY_FILE_FORMAT",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "330:   db close",
          "331:   forcedelete test.db test.db-journal",
          "332:   sqlite3 db test.db",
          "335: } {0}",
          "336: do_test descidx1-6.5 {",
          "337:   execsql {",
          "",
          "[Removed Lines]",
          "333:   execsql {PRAGMA legacy_file_format=NO}",
          "334:   execsql {PRAGMA legacy_file_format}",
          "",
          "[Added Lines]",
          "334:   sqlite3_db_config db LEGACY_FILE_FORMAT 0",
          "335:   sqlite3_db_config db LEGACY_FILE_FORMAT",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "351:     get_file_format",
          "352:   } {4}",
          "353:   do_test descidx1-6.7 {",
          "354:     execsql {",
          "356:       VACUUM;",
          "357:     }",
          "358:     get_file_format",
          "",
          "[Removed Lines]",
          "355:       PRAGMA legacy_file_format=ON;",
          "",
          "[Added Lines]",
          "355:     sqlite3_db_config db LEGACY_FILE_FORMAT 1",
          "",
          "---------------"
        ],
        "test/descidx2.test||test/descidx2.test": [
          "File: test/descidx2.test -> test/descidx2.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "23: do_not_use_codec",
          "28: # This procedure sets the value of the file-format in file 'test.db'",
          "29: # to $newval. Also, the schema cookie is incremented.",
          "",
          "[Removed Lines]",
          "26: db eval {PRAGMA legacy_file_format=OFF}",
          "",
          "[Added Lines]",
          "26: #db eval {PRAGMA legacy_file_format=OFF}",
          "27: sqlite3_db_config db LEGACY_FILE_FORMAT 0",
          "",
          "---------------"
        ],
        "test/descidx3.test||test/descidx3.test": [
          "File: test/descidx3.test -> test/descidx3.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "26:   finish_test",
          "27:   return",
          "28: }",
          "31: # This procedure sets the value of the file-format in file 'test.db'",
          "32: # to $newval. Also, the schema cookie is incremented.",
          "",
          "[Removed Lines]",
          "29: db eval {PRAGMA legacy_file_format=OFF}",
          "",
          "[Added Lines]",
          "29: #db eval {PRAGMA legacy_file_format=OFF}",
          "30: sqlite3_db_config db LEGACY_FILE_FORMAT 0",
          "",
          "---------------"
        ],
        "test/distinct2.test||test/distinct2.test": [
          "File: test/distinct2.test -> test/distinct2.test"
        ],
        "test/filter1.test||test/filter1.test": [
          "File: test/filter1.test -> test/filter1.test"
        ],
        "test/format4.test||test/format4.test": [
          "File: test/format4.test -> test/format4.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "17: set testdir [file dirname $argv0]",
          "18: source $testdir/tester.tcl",
          "22: # The size of the database depends on whether or not autovacuum",
          "23: # is enabled.",
          "",
          "[Removed Lines]",
          "20: db eval {PRAGMA legacy_file_format=OFF}",
          "",
          "[Added Lines]",
          "20: #db eval {PRAGMA legacy_file_format=OFF}",
          "21: sqlite3_db_config db LEGACY_FILE_FORMAT 0",
          "",
          "---------------"
        ],
        "test/indexexpr2.test||test/indexexpr2.test": [
          "File: test/indexexpr2.test -> test/indexexpr2.test"
        ],
        "test/insert4.test||test/insert4.test": [
          "File: test/insert4.test -> test/insert4.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "35: # Create tables used for testing.",
          "36: #",
          "37: execsql {",
          "39:   CREATE TABLE t1(a int, b int, check(b>a));",
          "40:   CREATE TABLE t2(x int, y int);",
          "41:   CREATE VIEW v2 AS SELECT y, x FROM t2;",
          "",
          "[Removed Lines]",
          "38:   PRAGMA legacy_file_format = 0;",
          "",
          "[Added Lines]",
          "37: sqlite3_db_config db LEGACY_FILE_FORMAT 0",
          "",
          "---------------"
        ],
        "test/join.test||test/join.test": [
          "File: test/join.test -> test/join.test"
        ],
        "test/minmax2.test||test/minmax2.test": [
          "File: test/minmax2.test -> test/minmax2.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "21: source $testdir/tester.tcl",
          "23: do_test minmax2-1.0 {",
          "24:   execsql {",
          "26:     BEGIN;",
          "27:     CREATE TABLE t1(x, y);",
          "28:     INSERT INTO t1 VALUES(1,1);",
          "",
          "[Removed Lines]",
          "25:     PRAGMA legacy_file_format=0;",
          "",
          "[Added Lines]",
          "24:   sqlite3_db_config db LEGACY_FILE_FORMAT 0",
          "",
          "---------------"
        ],
        "test/nulls1.test||test/nulls1.test": [
          "File: test/nulls1.test -> test/nulls1.test"
        ],
        "test/pragma4.test||test/pragma4.test": [
          "File: test/pragma4.test -> test/pragma4.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "44:  14 \"PRAGMA full_column_names = 1\"",
          "45:  15 \"PRAGMA fullfsync = 1\"",
          "46:  16 \"PRAGMA ignore_check_constraints = 1\"",
          "48:  18 \"PRAGMA page_size = 511\"",
          "49:  19 \"PRAGMA page_size = 512\"",
          "50:  20 \"PRAGMA query_only = false\"",
          "",
          "[Removed Lines]",
          "47:  17 \"PRAGMA legacy_file_format = 1\"",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "test/rowvaluevtab.test||test/rowvaluevtab.test": [
          "File: test/rowvaluevtab.test -> test/rowvaluevtab.test"
        ],
        "test/tkt-18458b1a.test||test/tkt-18458b1a.test": [
          "File: test/tkt-18458b1a.test -> test/tkt-18458b1a.test"
        ],
        "test/tkt-a7debbe0.test||test/tkt-a7debbe0.test": [
          "File: test/tkt-a7debbe0.test -> test/tkt-a7debbe0.test"
        ],
        "test/tkt3292.test||test/tkt3292.test": [
          "File: test/tkt3292.test -> test/tkt3292.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "20: source $testdir/tester.tcl",
          "22: do_test tkt3292-1.1 {",
          "23:   execsql {",
          "25:     CREATE TABLE t1(a INTEGER PRIMARY KEY, b INT);",
          "26:     INSERT INTO t1 VALUES(0, 1);",
          "27:     INSERT INTO t1 VALUES(1, 1);",
          "",
          "[Removed Lines]",
          "24:     PRAGMA legacy_file_format=OFF;",
          "",
          "[Added Lines]",
          "23:   sqlite3_db_config db LEGACY_FILE_FORMAT 0",
          "",
          "---------------"
        ],
        "test/window9.test||test/window9.test": [
          "File: test/window9.test -> test/window9.test"
        ],
        "tool/mkpragmatab.tcl||tool/mkpragmatab.tcl": [
          "File: tool/mkpragmatab.tcl -> tool/mkpragmatab.tcl",
          "--- Hunk 1 ---",
          "[Context before]",
          "41:   ARG:  SQLITE_NullCallback",
          "42:   IF:   !defined(SQLITE_OMIT_FLAG_PRAGMAS)",
          "49:   NAME: fullfsync",
          "50:   TYPE: FLAG",
          "51:   ARG:  SQLITE_FullFSync",
          "",
          "[Removed Lines]",
          "44:   NAME: legacy_file_format",
          "45:   TYPE: FLAG",
          "46:   ARG:  SQLITE_LegacyFileFmt",
          "47:   IF:   !defined(SQLITE_OMIT_FLAG_PRAGMAS)",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "122c5142714ea4fe64d6c993adce418869df1aa2",
      "candidate_info": {
        "commit_hash": "122c5142714ea4fe64d6c993adce418869df1aa2",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/122c5142714ea4fe64d6c993adce418869df1aa2",
        "files": [
          "manifest",
          "manifest.uuid",
          "src/vdbe.c"
        ],
        "message": "Fix a minor typo in a comment.\n\nFossilOrigin-Name: cea8a892f76bddc63b921ffc11ea8dce8f8cf649a2c77aa908c7c5c91eed7f4c",
        "before_after_code_files": [
          "manifest.uuid||manifest.uuid",
          "src/vdbe.c||src/vdbe.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: e77d48d1dd140967b18106044dd45e2ba6cd77b6aa5afa8bf3f0a9c16a50eec4",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/vdbe.c||src/vdbe.c": [
          "File: src/vdbe.c -> src/vdbe.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2812:   assert( pOp->p2>0 );",
          "2813:   assert( zAffinity[pOp->p2]==0 );",
          "2814:   pIn1 = &aMem[pOp->p1];",
          "2816:     assert( pIn1 <= &p->aMem[(p->nMem+1 - p->nCursor)] );",
          "2817:     assert( memIsValid(pIn1) );",
          "2818:     applyAffinity(pIn1, zAffinity[0], encoding);",
          "",
          "[Removed Lines]",
          "2815:   while( 1 /*edit-by-break*/ ){",
          "",
          "[Added Lines]",
          "2815:   while( 1 /*exit-by-break*/ ){",
          "",
          "---------------"
        ]
      }
    }
  ]
}