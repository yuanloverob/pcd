{
  "cve_id": "CVE-2019-10678",
  "cve_desc": "Domoticz before 4.10579 neglects to categorize \\n and \\r as insecure argument options.",
  "repo": "domoticz/domoticz",
  "patch_hash": "2119afbe74ee0c914c1d5c4c859c594c08b0ad42",
  "patch_info": {
    "commit_hash": "2119afbe74ee0c914c1d5c4c859c594c08b0ad42",
    "repo": "domoticz/domoticz",
    "commit_url": "https://github.com/domoticz/domoticz/commit/2119afbe74ee0c914c1d5c4c859c594c08b0ad42",
    "files": [
      "main/Helper.cpp"
    ],
    "message": "Do not allow enters/returns in arguments (thanks to Fabio Carretto)",
    "before_after_code_files": [
      "main/Helper.cpp||main/Helper.cpp"
    ]
  },
  "patch_diff": {
    "main/Helper.cpp||main/Helper.cpp": [
      "File: main/Helper.cpp -> main/Helper.cpp",
      "--- Hunk 1 ---",
      "[Context before]",
      "1014:  \"$\",",
      "1015:  \"<\",",
      "1016:  \">\",",
      "1017:  NULL",
      "1018: };",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1017:  \"\\n\",",
      "1018:  \"\\r\",",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "4e320c7b3faafd54917d8c13f4a4ee0284d31236",
      "candidate_info": {
        "commit_hash": "4e320c7b3faafd54917d8c13f4a4ee0284d31236",
        "repo": "domoticz/domoticz",
        "commit_url": "https://github.com/domoticz/domoticz/commit/4e320c7b3faafd54917d8c13f4a4ee0284d31236",
        "files": [
          ".travis.yml",
          "msbuild/domoticz.vcxproj",
          "msbuild/domoticz.vcxproj.filters"
        ],
        "message": "Travis disabling OSX builds for now (has problems inside the build script)",
        "before_after_code_files": [
          "msbuild/domoticz.vcxproj||msbuild/domoticz.vcxproj",
          "msbuild/domoticz.vcxproj.filters||msbuild/domoticz.vcxproj.filters"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/domoticz/domoticz/pull/3180"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "msbuild/domoticz.vcxproj||msbuild/domoticz.vcxproj": [
          "File: msbuild/domoticz.vcxproj -> msbuild/domoticz.vcxproj",
          "--- Hunk 1 ---",
          "[Context before]",
          "118:     <None Include=\"..\\www\\app\\CamController.js\" />",
          "119:     <None Include=\"..\\www\\app\\CustomIconsController.js\" />",
          "120:     <None Include=\"..\\www\\app\\DashboardController.js\" />",
          "121:     <None Include=\"..\\www\\app\\DevicesController.js\" />",
          "122:     <None Include=\"..\\www\\app\\DPFibaroController.js\" />",
          "123:     <None Include=\"..\\www\\app\\DPGooglePubSubController.js\" />",
          "124:     <None Include=\"..\\www\\app\\DPHttpController.js\" />",
          "125:     <None Include=\"..\\www\\app\\DPInfluxController.js\" />",
          "126:     <None Include=\"..\\www\\app\\EventsController.js\" />",
          "127:     <None Include=\"..\\www\\app\\FloorplanController.js\" />",
          "128:     <None Include=\"..\\www\\app\\FloorplanEditController.js\" />",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "121:     <None Include=\"..\\www\\app\\DeviceLightEdit.js\" />",
          "127:     <None Include=\"..\\www\\app\\DummyController.js\" />",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "144:     <None Include=\"..\\www\\app\\ScenesController.js\" />",
          "145:     <None Include=\"..\\www\\app\\SetupController.js\" />",
          "146:     <None Include=\"..\\www\\app\\TemperatureController.js\" />",
          "147:     <None Include=\"..\\www\\app\\UpdateController.js\" />",
          "148:     <None Include=\"..\\www\\app\\UsersController.js\" />",
          "149:     <None Include=\"..\\www\\app\\UserVariablesController.js\" />",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "149:     <None Include=\"..\\www\\app\\TemperatureCustomLogController.js\" />",
          "150:     <None Include=\"..\\www\\app\\TimerplanController.js\" />",
          "",
          "---------------"
        ],
        "msbuild/domoticz.vcxproj.filters||msbuild/domoticz.vcxproj.filters": [
          "File: msbuild/domoticz.vcxproj.filters -> msbuild/domoticz.vcxproj.filters",
          "--- Hunk 1 ---",
          "[Context before]",
          "1331:     <None Include=\"..\\www\\secpanel\\css\\style.css\">",
          "1332:       <Filter>www\\secpanel\\css</Filter>",
          "1333:     </None>",
          "1334:   </ItemGroup>",
          "1335:   <ItemGroup>",
          "1336:     <ClInclude Include=\"..\\webserver\\Base64.h\">",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1334:     <None Include=\"..\\www\\app\\DeviceLightEdit.js\">",
          "1335:       <Filter>www\\app</Filter>",
          "1336:     </None>",
          "1337:     <None Include=\"..\\www\\app\\DummyController.js\">",
          "1338:       <Filter>www\\app</Filter>",
          "1339:     </None>",
          "1340:     <None Include=\"..\\www\\app\\TemperatureCustomLogController.js\">",
          "1341:       <Filter>www\\app</Filter>",
          "1342:     </None>",
          "1343:     <None Include=\"..\\www\\app\\TimerplanController.js\">",
          "1344:       <Filter>www\\app</Filter>",
          "1345:     </None>",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "89e9d633f02b5ee6c597b7b0c07b37a6febd508c",
      "candidate_info": {
        "commit_hash": "89e9d633f02b5ee6c597b7b0c07b37a6febd508c",
        "repo": "domoticz/domoticz",
        "commit_url": "https://github.com/domoticz/domoticz/commit/89e9d633f02b5ee6c597b7b0c07b37a6febd508c",
        "files": [
          "hardware/P1MeterBase.cpp",
          "hardware/P1MeterBase.h"
        ],
        "message": "P1 Meter, allow 0 for the new as Usage/Amperage/Delivery sensors",
        "before_after_code_files": [
          "hardware/P1MeterBase.cpp||hardware/P1MeterBase.cpp",
          "hardware/P1MeterBase.h||hardware/P1MeterBase.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/domoticz/domoticz/pull/3180"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "hardware/P1MeterBase.cpp||hardware/P1MeterBase.cpp": [
          "File: hardware/P1MeterBase.cpp -> hardware/P1MeterBase.cpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "137:  l_exclmarkfound = 0;",
          "138:  l_bufferpos = 0;",
          "156:  memset(&m_buffer, 0, sizeof(m_buffer));",
          "157:  memset(&l_buffer, 0, sizeof(l_buffer));",
          "",
          "[Removed Lines]",
          "140:  m_voltagel1 = 0;",
          "141:  m_voltagel2 = 0;",
          "142:  m_voltagel3 = 0;",
          "144:  m_amperagel1=0;",
          "145:  m_amperagel2=0;",
          "146:  m_amperagel3=0;",
          "148:  m_powerusel1 = 0;",
          "149:  m_powerusel2 = 0;",
          "150:  m_powerusel3 = 0;",
          "152:  m_powerdell1 = 0;",
          "153:  m_powerdell2 = 0;",
          "154:  m_powerdell3 = 0;",
          "",
          "[Added Lines]",
          "140:  m_voltagel1 = -1;",
          "141:  m_voltagel2 = -1;",
          "142:  m_voltagel3 = -1;",
          "144:  m_bReceivedAmperage = false;",
          "145:  m_amperagel1 = 0;",
          "146:  m_amperagel2 = 0;",
          "147:  m_amperagel3 = 0;",
          "149:  m_powerusel1 = -1;",
          "150:  m_powerusel2 = -1;",
          "151:  m_powerusel3 = -1;",
          "153:  m_powerdell1 = -1;",
          "154:  m_powerdell2 = -1;",
          "155:  m_powerdell3 = -1;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "272:    {",
          "273:     m_lastUpdateTime = atime;",
          "274:     sDecodeRXMessage(this, (const unsigned char *)&m_power, \"Power\", 255);",
          "276:      SendVoltageSensor(0, 1, 255, m_voltagel1, \"Voltage L1\");",
          "277:     }",
          "279:      SendVoltageSensor(0, 2, 255, m_voltagel2, \"Voltage L2\");",
          "280:     }",
          "282:      SendVoltageSensor(0, 3, 255, m_voltagel3, \"Voltage L3\");",
          "283:     }",
          "287:      SendCurrentSensor(1, 255, m_amperagel1, m_amperagel2, m_amperagel3, \"Amperage\" );",
          "288:     }",
          "291:      SendWattMeter(0, 1, 255, m_powerusel1, \"Usage L1\");",
          "292:     }",
          "294:      SendWattMeter(0, 2, 255, m_powerusel2, \"Usage L2\");",
          "295:     }",
          "297:      SendWattMeter(0, 3, 255, m_powerusel3, \"Usage L3\");",
          "298:     }",
          "301:      SendWattMeter(0, 4, 255, m_powerdell1, \"Delivery L1\");",
          "302:     }",
          "304:      SendWattMeter(0, 5, 255, m_powerdell2, \"Delivery L2\");",
          "305:     }",
          "307:      SendWattMeter(0, 6, 255, m_powerdell3, \"Delivery L3\");",
          "308:     }",
          "310:     if ((m_gas.gasusage > 0) && ((m_gas.gasusage != m_lastgasusage) || (difftime(atime, m_lastSharedSendGas) >= 300)))",
          "311:     {",
          "",
          "[Removed Lines]",
          "275:     if (m_voltagel1) {",
          "278:     if (m_voltagel2) {",
          "281:     if (m_voltagel3) {",
          "286:     if (m_amperagel1 || m_amperagel2 || m_amperagel3 ) {",
          "290:     if (m_powerusel1) {",
          "293:     if (m_powerusel2) {",
          "296:     if (m_powerusel3) {",
          "300:       if (m_powerdell1) {",
          "303:     if (m_powerdell2) {",
          "306:     if (m_powerdell3) {",
          "",
          "[Added Lines]",
          "276:     if (m_voltagel1 != -1) {",
          "279:     if (m_voltagel2 != -1) {",
          "282:     if (m_voltagel3 != -1) {",
          "287:     if (m_bReceivedAmperage) {",
          "291:     if (m_powerusel1 != -1) {",
          "294:     if (m_powerusel2 != -1) {",
          "297:     if (m_powerusel3 != -1) {",
          "301:     if (m_powerdell1 != -1) {",
          "304:     if (m_powerdell2 != -1) {",
          "307:     if (m_powerdell3 != -1) {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "469:      m_voltagel3 = temp_volt; //Voltage L3;",
          "470:     break;",
          "471:    case P1TYPE_AMPERAGEL1:",
          "473:     if (temp_ampere < 100)",
          "474:      m_amperagel1 = temp_ampere; //Amperage L1;",
          "475:     break;",
          "476:    case P1TYPE_AMPERAGEL2:",
          "478:     if (temp_ampere < 100)",
          "479:      m_amperagel2 = temp_ampere; //Amperage L2;",
          "480:     break;",
          "481:    case P1TYPE_AMPERAGEL3:",
          "483:     if (temp_ampere < 100)",
          "484:      m_amperagel3 = temp_ampere; //Amperage L3;",
          "486:    case P1TYPE_POWERUSEL1:",
          "487:     temp_power = static_cast<float>(strtod(value, &validate)*1000.0f);",
          "488:     if (temp_power < 10000)",
          "",
          "[Removed Lines]",
          "472:     temp_ampere = strtof(value,&validate);",
          "477:     temp_ampere = strtof(value,&validate);",
          "482:     temp_ampere = strtof(value,&validate);",
          "485:     break;",
          "",
          "[Added Lines]",
          "473:     temp_ampere = strtof(value, &validate);",
          "475:     {",
          "477:      m_bReceivedAmperage = true;",
          "478:     }",
          "481:     temp_ampere = strtof(value, &validate);",
          "483:     {",
          "485:      m_bReceivedAmperage = true;",
          "486:     }",
          "489:     temp_ampere = strtof(value, &validate);",
          "491:     {",
          "493:      m_bReceivedAmperage = true;",
          "494:     }",
          "495:     break;",
          "",
          "---------------"
        ],
        "hardware/P1MeterBase.h||hardware/P1MeterBase.h": [
          "File: hardware/P1MeterBase.h -> hardware/P1MeterBase.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "38:  float m_voltagel2;",
          "39:  float m_voltagel3;",
          "41:  float m_amperagel1;",
          "42:  float m_amperagel2;",
          "43:  float m_amperagel3;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "41:  bool m_bReceivedAmperage;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "47537f832ec6854a1cfcb49e28e31f332beee4ce",
      "candidate_info": {
        "commit_hash": "47537f832ec6854a1cfcb49e28e31f332beee4ce",
        "repo": "domoticz/domoticz",
        "commit_url": "https://github.com/domoticz/domoticz/commit/47537f832ec6854a1cfcb49e28e31f332beee4ce",
        "files": [
          "hardware/EvohomeWeb.cpp"
        ],
        "message": "Corrected PostBinary Call",
        "before_after_code_files": [
          "hardware/EvohomeWeb.cpp||hardware/EvohomeWeb.cpp"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/domoticz/domoticz/pull/3180"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "hardware/EvohomeWeb.cpp||hardware/EvohomeWeb.cpp": [
          "File: hardware/EvohomeWeb.cpp -> hardware/EvohomeWeb.cpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "1919:  std::vector<unsigned char> vHTTPResponse;",
          "1920:  std::vector<std::string> vHeaderData;",
          "1924:  return process_response(vHTTPResponse, vHeaderData, httpOK);",
          "1925: }",
          "",
          "[Removed Lines]",
          "1922:  bool httpOK = HTTPClient::POSTBinary(url, postdata, headers, vHTTPResponse, vHeaderData, HTTPTIMEOUT);",
          "",
          "[Added Lines]",
          "1922:  bool httpOK = HTTPClient::POSTBinary(url, postdata, headers, vHTTPResponse, vHeaderData, true, HTTPTIMEOUT);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "fd39175187e5495b90e7f6b0aa3ddee0ac2f32f2",
      "candidate_info": {
        "commit_hash": "fd39175187e5495b90e7f6b0aa3ddee0ac2f32f2",
        "repo": "domoticz/domoticz",
        "commit_url": "https://github.com/domoticz/domoticz/commit/fd39175187e5495b90e7f6b0aa3ddee0ac2f32f2",
        "files": [
          "CMakeLists.txt",
          "www/app/app.js"
        ],
        "message": "Added missing source file to CMake file",
        "before_after_code_files": [
          "www/app/app.js||www/app/app.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/domoticz/domoticz/pull/3180"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "www/app/app.js||www/app/app.js": [
          "File: www/app/app.js -> www/app/app.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "984:    return backgroundClass;",
          "985:   }",
          "986:   $rootScope.DisplayTrend = function (trend) {",
          "989:    if (typeof trend != 'undefined') {",
          "990:     if (trend > 1)",
          "",
          "[Removed Lines]",
          "987:    alert(item.Name);",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "39f5f91545c55581d84746bcaa5c89b87d536deb",
      "candidate_info": {
        "commit_hash": "39f5f91545c55581d84746bcaa5c89b87d536deb",
        "repo": "domoticz/domoticz",
        "commit_url": "https://github.com/domoticz/domoticz/commit/39f5f91545c55581d84746bcaa5c89b87d536deb",
        "files": [
          "www/app/app.js",
          "www/css/images/bttb.png",
          "www/css/style.css",
          "www/views/lights.html",
          "www/views/scenes.html",
          "www/views/temperature.html",
          "www/views/utility.html",
          "www/views/weather.html"
        ],
        "message": "Back to top implementation",
        "before_after_code_files": [
          "www/app/app.js||www/app/app.js",
          "www/css/style.css||www/css/style.css",
          "www/views/lights.html||www/views/lights.html",
          "www/views/scenes.html||www/views/scenes.html",
          "www/views/temperature.html||www/views/temperature.html",
          "www/views/utility.html||www/views/utility.html",
          "www/views/weather.html||www/views/weather.html"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/domoticz/domoticz/pull/3180"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "www/app/app.js||www/app/app.js": [
          "File: www/app/app.js -> www/app/app.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "201:    }",
          "202:   }",
          "203:  });",
          "204:  app.filter('translate', function() {",
          "205:   return function(input) {",
          "206:    return $.t(input);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "204:  app.directive('gzBackToTop', function(){",
          "205:   return {",
          "206:    restrict: 'E'",
          "207:    , replace: true",
          "208:    , template: '<div class=\"gz-back-to-top\"></div>'",
          "209:    , link: function($scope, element, attrs) {",
          "210:     $(window).scroll(function() {",
          "211:      if ($(window).scrollTop() <= 0) {",
          "212:       $(element).fadeOut();",
          "213:      }",
          "214:      else {",
          "215:       $(element).fadeIn();",
          "216:      }",
          "217:     });",
          "218:     $(element).on('click', function(){",
          "219:      $('html, body').animate({ scrollTop: 0 }, 'fast');",
          "220:     });",
          "221:    }",
          "222:   }",
          "223:  });",
          "",
          "---------------"
        ],
        "www/css/style.css||www/css/style.css": [
          "File: www/css/style.css -> www/css/style.css",
          "--- Hunk 1 ---",
          "[Context before]",
          "1944: #container-speed > .highcharts-container {",
          "1945:     overflow: visible !important;",
          "1946: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1947: .gz-back-to-top {",
          "1948:  position: fixed;",
          "1949:  bottom: 28px;",
          "1950:  right: 20px;",
          "1951:  z-index: 99;",
          "1952:  background: url(images/bttb.png) no-repeat;",
          "1953:  width: 24px;",
          "1954:  height: 24px;",
          "1955:  opacity: 0.5;",
          "1956:  display: none;",
          "1957:  &:hover {",
          "1958:   opacity: 1;",
          "1959:   cursor: pointer;",
          "1960:  }",
          "1961: }",
          "",
          "---------------"
        ],
        "www/views/lights.html||www/views/lights.html": [
          "File: www/views/lights.html -> www/views/lights.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "373:   </table>",
          "374:  </form>",
          "375: </div>",
          "",
          "[Removed Lines]",
          "376: <div id=\"lightcontent\" class=\"container\">",
          "377: </div>",
          "",
          "[Added Lines]",
          "376: <div>",
          "377:  <gz-back-to-top></gz-back-to-top>",
          "378:  <div id=\"lightcontent\" class=\"container\"></div>",
          "379: </div>",
          "",
          "---------------"
        ],
        "www/views/scenes.html||www/views/scenes.html": [
          "File: www/views/scenes.html -> www/views/scenes.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "2: </div>",
          "3: <div id=\"dialog-addscene\">",
          "4:     <form>",
          "",
          "[Removed Lines]",
          "1: <div id=\"scenecontent\" class=\"container\">",
          "",
          "[Added Lines]",
          "1: <div>",
          "2:  <gz-back-to-top></gz-back-to-top>",
          "3:  <div id=\"scenecontent\" class=\"container\"></div>",
          "",
          "---------------"
        ],
        "www/views/temperature.html||www/views/temperature.html": [
          "File: www/views/temperature.html -> www/views/temperature.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "76: </div>",
          "78: <div class=\"container\">",
          "80:  <div id=\"tempcontent\"></div>",
          "82:  <div id=\"temptophtm\">",
          "83:   <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\">",
          "84:    <tr>",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "79: <gz-back-to-top></gz-back-to-top>",
          "",
          "---------------"
        ],
        "www/views/utility.html||www/views/utility.html": [
          "File: www/views/utility.html -> www/views/utility.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "215:     </form>",
          "216: </div>",
          "219: </div>",
          "221: <div id=\"percentagelog\" style=\"display:none;\">",
          "",
          "[Removed Lines]",
          "218: <div id=\"utilitycontent\" class=\"container\">",
          "",
          "[Added Lines]",
          "218: <div>",
          "219:  <gz-back-to-top></gz-back-to-top>",
          "220:  <div id=\"utilitycontent\" class=\"container\"></div>",
          "",
          "---------------"
        ],
        "www/views/weather.html||www/views/weather.html": [
          "File: www/views/weather.html -> www/views/weather.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "278:     </form>",
          "279: </div>",
          "280: <div class=\"container\">",
          "282:  <div id=\"weathercontent\"></div>",
          "284:  <div id=\"weathertophtm\">",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "281:  <gz-back-to-top></gz-back-to-top>",
          "",
          "---------------"
        ]
      }
    }
  ]
}