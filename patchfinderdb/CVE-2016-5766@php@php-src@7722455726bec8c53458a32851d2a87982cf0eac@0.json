{
  "cve_id": "CVE-2016-5766",
  "cve_desc": "Integer overflow in the _gd2GetHeader function in gd_gd2.c in the GD Graphics Library (aka libgd) before 2.2.3, as used in PHP before 5.5.37, 5.6.x before 5.6.23, and 7.x before 7.0.8, allows remote attackers to cause a denial of service (heap-based buffer overflow and application crash) or possibly have unspecified other impact via crafted chunk dimensions in an image.",
  "repo": "php/php-src",
  "patch_hash": "7722455726bec8c53458a32851d2a87982cf0eac",
  "patch_info": {
    "commit_hash": "7722455726bec8c53458a32851d2a87982cf0eac",
    "repo": "php/php-src",
    "commit_url": "https://github.com/php/php-src/commit/7722455726bec8c53458a32851d2a87982cf0eac",
    "files": [
      "ext/gd/libgd/gd_gd2.c",
      "ext/gd/tests/bug72339.gd",
      "ext/gd/tests/bug72339.phpt"
    ],
    "message": "Fixed #72339 Integer Overflow in _gd2GetHeader() resulting in heap overflow",
    "before_after_code_files": [
      "ext/gd/libgd/gd_gd2.c||ext/gd/libgd/gd_gd2.c",
      "ext/gd/tests/bug72339.phpt||ext/gd/tests/bug72339.phpt"
    ]
  },
  "patch_diff": {
    "ext/gd/libgd/gd_gd2.c||ext/gd/libgd/gd_gd2.c": [
      "File: ext/gd/libgd/gd_gd2.c -> ext/gd/libgd/gd_gd2.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "138:  if (gd2_compressed(*fmt)) {",
      "139:   nc = (*ncx) * (*ncy);",
      "140:   GD2_DBG(php_gd_error(\"Reading %d chunk index entries\", nc));",
      "141:   sidx = sizeof(t_chunk_info) * nc;",
      "142:   if (sidx <= 0) {",
      "143:    goto fail1;",
      "144:   }",
      "145:   cidx = gdCalloc(sidx, 1);",
      "146:   for (i = 0; i < nc; i++) {",
      "147:    if (gdGetInt(&cidx[i].offset, in) != 1) {",
      "148:     gdFree(cidx);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "141:   if (overflow2(sidx, nc)) {",
      "142:    goto fail1;",
      "143:   }",
      "149:   if (cidx == NULL) {",
      "150:    goto fail1;",
      "151:   }",
      "",
      "---------------"
    ],
    "ext/gd/tests/bug72339.phpt||ext/gd/tests/bug72339.phpt": [
      "File: ext/gd/tests/bug72339.phpt -> ext/gd/tests/bug72339.phpt",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: --TEST--",
      "2: Bug #72339 Integer Overflow in _gd2GetHeader() resulting in heap overflow",
      "3: --SKIPIF--",
      "4: <?php if (!function_exists(\"imagecreatefromgd2\")) print \"skip\"; ?>",
      "5: --FILE--",
      "6: <?php imagecreatefromgd2(dirname(__FILE__) . DIRECTORY_SEPARATOR . \"bug72339.gd\"); ?>",
      "7: --EXPECTF--",
      "8: Warning: imagecreatefromgd2(): gd warning: product of memory allocation multiplication would exceed INT_MAX, failing operation gracefully",
      "9:  in %sbug72339.php on line %d",
      "11: Warning: imagecreatefromgd2(): '%sbug72339.gd' is not a valid GD2 file in %sbug72339.php on line %d",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "54293d21cbcd1b3bfee331c7011970e629026523",
      "candidate_info": {
        "commit_hash": "54293d21cbcd1b3bfee331c7011970e629026523",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/54293d21cbcd1b3bfee331c7011970e629026523",
        "files": [
          "ext/gd/tests/bug43121.phpt",
          "ext/gd/tests/bug43475.phpt",
          "ext/gd/tests/bug43828.phpt",
          "ext/gd/tests/bug53154.phpt",
          "ext/gd/tests/bug53640.phpt",
          "ext/gd/tests/bug64641.phpt",
          "ext/gd/tests/bug66387.phpt",
          "ext/gd/tests/bug67447.phpt",
          "ext/gd/tests/bug71912.phpt",
          "ext/gd/tests/bug72339.phpt",
          "ext/gd/tests/bug72512.phpt",
          "ext/gd/tests/bug72512_0.phpt",
          "ext/gd/tests/bug72512_1.phpt",
          "ext/gd/tests/github_bug_215.phpt",
          "ext/gd/tests/imagecolorallocatealpha_basic.phpt",
          "ext/gd/tests/imagefilledarc_basic.phpt",
          "ext/gd/tests/imagefilledarc_variation1.phpt",
          "ext/gd/tests/imagefilledarc_variation2.phpt",
          "ext/gd/tests/imagegammacorrect_basic.phpt",
          "ext/gd/tests/imagegammacorrect_variation1.phpt",
          "ext/gd/tests/imagetruecolortopalette_basic.phpt"
        ],
        "message": "Skip tests that are supposed to fail due to bugs in old external libgd",
        "before_after_code_files": [
          "ext/gd/tests/bug43121.phpt||ext/gd/tests/bug43121.phpt",
          "ext/gd/tests/bug43475.phpt||ext/gd/tests/bug43475.phpt",
          "ext/gd/tests/bug43828.phpt||ext/gd/tests/bug43828.phpt",
          "ext/gd/tests/bug53154.phpt||ext/gd/tests/bug53154.phpt",
          "ext/gd/tests/bug53640.phpt||ext/gd/tests/bug53640.phpt",
          "ext/gd/tests/bug64641.phpt||ext/gd/tests/bug64641.phpt",
          "ext/gd/tests/bug66387.phpt||ext/gd/tests/bug66387.phpt",
          "ext/gd/tests/bug67447.phpt||ext/gd/tests/bug67447.phpt",
          "ext/gd/tests/bug71912.phpt||ext/gd/tests/bug71912.phpt",
          "ext/gd/tests/bug72339.phpt||ext/gd/tests/bug72339.phpt",
          "ext/gd/tests/bug72512.phpt||ext/gd/tests/bug72512.phpt",
          "ext/gd/tests/bug72512_0.phpt||ext/gd/tests/bug72512_0.phpt",
          "ext/gd/tests/bug72512_1.phpt||ext/gd/tests/bug72512_1.phpt",
          "ext/gd/tests/github_bug_215.phpt||ext/gd/tests/github_bug_215.phpt",
          "ext/gd/tests/imagecolorallocatealpha_basic.phpt||ext/gd/tests/imagecolorallocatealpha_basic.phpt",
          "ext/gd/tests/imagefilledarc_basic.phpt||ext/gd/tests/imagefilledarc_basic.phpt",
          "ext/gd/tests/imagefilledarc_variation1.phpt||ext/gd/tests/imagefilledarc_variation1.phpt",
          "ext/gd/tests/imagefilledarc_variation2.phpt||ext/gd/tests/imagefilledarc_variation2.phpt",
          "ext/gd/tests/imagegammacorrect_basic.phpt||ext/gd/tests/imagegammacorrect_basic.phpt",
          "ext/gd/tests/imagegammacorrect_variation1.phpt||ext/gd/tests/imagegammacorrect_variation1.phpt",
          "ext/gd/tests/imagetruecolortopalette_basic.phpt||ext/gd/tests/imagetruecolortopalette_basic.phpt"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/gd/tests/bug72339.phpt||ext/gd/tests/bug72339.phpt"
          ],
          "candidate": [
            "ext/gd/tests/bug72339.phpt||ext/gd/tests/bug72339.phpt"
          ]
        }
      },
      "candidate_diff": {
        "ext/gd/tests/bug43121.phpt||ext/gd/tests/bug43121.phpt": [
          "File: ext/gd/tests/bug43121.phpt -> ext/gd/tests/bug43121.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: --SKIPIF--",
          "4: <?php",
          "5:  if (!extension_loaded('gd')) die(\"skip gd extension not available\\n\");",
          "6: ?>",
          "7: --FILE--",
          "8: <?php",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "6:  if (!GD_BUNDLED && version_compare(GD_VERSION, '2.2.0', '<')) {",
          "7:   die(\"skip test requires GD 2.2.0 or higher\");",
          "8:  }",
          "",
          "---------------"
        ],
        "ext/gd/tests/bug43475.phpt||ext/gd/tests/bug43475.phpt": [
          "File: ext/gd/tests/bug43475.phpt -> ext/gd/tests/bug43475.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: --SKIPIF--",
          "4: <?php",
          "5:  if (!extension_loaded('gd')) die(\"skip gd extension not available\\n\");",
          "6: ?>",
          "7: --FILE--",
          "8: <?php",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "6:  if (!GD_BUNDLED && version_compare(GD_VERSION, '2.2.2', '<')) {",
          "7:   die(\"skip test requires GD 2.2.2 or higher\");",
          "8:  }",
          "",
          "---------------"
        ],
        "ext/gd/tests/bug43828.phpt||ext/gd/tests/bug43828.phpt": [
          "File: ext/gd/tests/bug43828.phpt -> ext/gd/tests/bug43828.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: --SKIPIF--",
          "4: <?php",
          "5: if (!extension_loaded('gd')) die('skip ext/gd not available');",
          "6: ?>",
          "7: --FILE--",
          "8: <?php",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "6: if (!GD_BUNDLED && version_compare(GD_VERSION, '2.2.2', '<')) {",
          "7:  die(\"skip test requires GD 2.2.2 or higher\");",
          "8: }",
          "",
          "---------------"
        ],
        "ext/gd/tests/bug53154.phpt||ext/gd/tests/bug53154.phpt": [
          "File: ext/gd/tests/bug53154.phpt -> ext/gd/tests/bug53154.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: --SKIPIF--",
          "4: <?php",
          "5: if (!extension_loaded('gd')) die('skip gd extension not available');",
          "6: ?>",
          "7: --FILE--",
          "8: <?php",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "6: if (!GD_BUNDLED && version_compare(GD_VERSION, '2.2.2', '<')) {",
          "7:     die(\"skip test requires GD 2.2.2 or higher\");",
          "8: }",
          "",
          "---------------"
        ],
        "ext/gd/tests/bug53640.phpt||ext/gd/tests/bug53640.phpt": [
          "File: ext/gd/tests/bug53640.phpt -> ext/gd/tests/bug53640.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: --SKIPIF--",
          "4: <?php",
          "5: if (!extension_loaded('gd')) die('skip gd extension not available');",
          "6: ?>",
          "7: --FILE--",
          "8: <?php",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "6: if (!GD_BUNDLED && version_compare(GD_VERSION, '2.2.3', '<')) {",
          "7:     die(\"skip test requires GD 2.2.3 or higher\");",
          "8: }",
          "",
          "---------------"
        ],
        "ext/gd/tests/bug64641.phpt||ext/gd/tests/bug64641.phpt": [
          "File: ext/gd/tests/bug64641.phpt -> ext/gd/tests/bug64641.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: --SKIPIF--",
          "4: <?php",
          "5: if (!extension_loaded('gd')) die(\"skip gd extension not available\\n\");",
          "6: ?>",
          "7: --FILE--",
          "8: <?php",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "6: if (!GD_BUNDLED && version_compare(GD_VERSION, '2.2.2', '<')) {",
          "7:  die(\"skip test requires GD 2.2.2 or higher\");",
          "8: }",
          "",
          "---------------"
        ],
        "ext/gd/tests/bug66387.phpt||ext/gd/tests/bug66387.phpt": [
          "File: ext/gd/tests/bug66387.phpt -> ext/gd/tests/bug66387.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: --SKIPIF--",
          "4: <?php",
          "5: if (!extension_loaded('gd')) die('skip gd extension not available!');",
          "6: ?>",
          "7: --FILE--",
          "8: <?php",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "6: if (!GD_BUNDLED && version_compare(GD_VERSION, '2.2.1', '<')) {",
          "7:     die(\"skip test requires GD 2.2.1 or higher\");",
          "8: }",
          "",
          "---------------"
        ],
        "ext/gd/tests/bug67447.phpt||ext/gd/tests/bug67447.phpt": [
          "File: ext/gd/tests/bug67447.phpt -> ext/gd/tests/bug67447.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: --TEST--",
          "2: Bug #67447 (imagecrop() adds a black line when cropping)",
          "3: --FILE--",
          "4: <?php",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3: --SKIPIF--",
          "4: <?php",
          "5:  if (!extension_loaded('gd')) {",
          "6:   die(\"skip gd extension not available\\n\");",
          "7:  }",
          "8: ?>",
          "",
          "---------------"
        ],
        "ext/gd/tests/bug71912.phpt||ext/gd/tests/bug71912.phpt": [
          "File: ext/gd/tests/bug71912.phpt -> ext/gd/tests/bug71912.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: --SKIPIF--",
          "4: <?php",
          "5:         if(!extension_loaded('gd')){ die('skip gd extension not available'); }",
          "6:         if(!function_exists('imagecreatefromgd2')) die('skip imagecreatefromgd2() not available');",
          "7: ?>",
          "8: --FILE--",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "6:         if (!GD_BUNDLED && version_compare(GD_VERSION, '2.2.0', '<')) {",
          "7:             die(\"skip test requires GD 2.2.0 or higher\");",
          "8:         }",
          "",
          "---------------"
        ],
        "ext/gd/tests/bug72339.phpt||ext/gd/tests/bug72339.phpt": [
          "File: ext/gd/tests/bug72339.phpt -> ext/gd/tests/bug72339.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: --TEST--",
          "2: Bug #72339 Integer Overflow in _gd2GetHeader() resulting in heap overflow",
          "3: --SKIPIF--",
          "5: --FILE--",
          "6: <?php",
          "7: $fname = dirname(__FILE__) . DIRECTORY_SEPARATOR . \"bug72339.gd\";",
          "",
          "[Removed Lines]",
          "4: <?php if (!function_exists(\"imagecreatefromgd2\")) print \"skip\"; ?>",
          "",
          "[Added Lines]",
          "4: <?php",
          "5: if (!function_exists(\"imagecreatefromgd2\")) print \"skip\";",
          "6: if (!GD_BUNDLED && version_compare(GD_VERSION, '2.2.2', '<')) {",
          "7:  die(\"skip test requires GD 2.2.2 or higher\");",
          "8: }",
          "9: ?>",
          "",
          "---------------"
        ],
        "ext/gd/tests/bug72512.phpt||ext/gd/tests/bug72512.phpt": [
          "File: ext/gd/tests/bug72512.phpt -> ext/gd/tests/bug72512.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: --SKIPIF--",
          "4: <?php",
          "5:  if (!extension_loaded('gd')) die(\"skip gd extension not available\\n\");",
          "6: ?>",
          "7: --FILE--",
          "8: <?php",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "6:  if (!GD_BUNDLED && version_compare(GD_VERSION, '2.2.2', '<')) {",
          "7:   die(\"skip test requires GD 2.2.2 or higher\");",
          "8:  }",
          "",
          "---------------"
        ],
        "ext/gd/tests/bug72512_0.phpt||ext/gd/tests/bug72512_0.phpt": [
          "File: ext/gd/tests/bug72512_0.phpt -> ext/gd/tests/bug72512_0.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: --SKIPIF--",
          "4: <?php",
          "5:  if (!extension_loaded('gd')) die(\"skip gd extension not available\\n\");",
          "6: ?>",
          "7: --FILE--",
          "8: <?php",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "6:  if (!GD_BUNDLED && version_compare(GD_VERSION, '2.2.2', '<')) {",
          "7:   die(\"skip test requires GD 2.2.2 or higher\");",
          "8:  }",
          "",
          "---------------"
        ],
        "ext/gd/tests/bug72512_1.phpt||ext/gd/tests/bug72512_1.phpt": [
          "File: ext/gd/tests/bug72512_1.phpt -> ext/gd/tests/bug72512_1.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: --SKIPIF--",
          "4: <?php",
          "5:  if (!extension_loaded('gd')) die(\"skip gd extension not available\\n\");",
          "6: ?>",
          "7: --FILE--",
          "8: <?php",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "6:  if (!GD_BUNDLED && version_compare(GD_VERSION, '2.2.2', '<')) {",
          "7:   die(\"skip test requires GD 2.2.2 or higher\");",
          "8:  }",
          "",
          "---------------"
        ],
        "ext/gd/tests/github_bug_215.phpt||ext/gd/tests/github_bug_215.phpt": [
          "File: ext/gd/tests/github_bug_215.phpt -> ext/gd/tests/github_bug_215.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: --SKIPIF--",
          "4: <?php",
          "5: if (!extension_loaded(\"gd\")) die(\"skip GD not present\");",
          "6: ?>",
          "7: --FILE--",
          "8: <?php",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "6: if (!GD_BUNDLED && version_compare(GD_VERSION, '2.2.2', '<')) {",
          "7:     die(\"skip test requires GD 2.2.2 or higher\");",
          "8: }",
          "",
          "---------------"
        ],
        "ext/gd/tests/imagecolorallocatealpha_basic.phpt||ext/gd/tests/imagecolorallocatealpha_basic.phpt": [
          "File: ext/gd/tests/imagecolorallocatealpha_basic.phpt -> ext/gd/tests/imagecolorallocatealpha_basic.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: --SKIPIF--",
          "6: <?php",
          "7:  if (!extension_loaded(\"gd\")) die(\"skip GD not present\");",
          "8: ?>",
          "9: --FILE--",
          "10: <?php",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "8:  if (!GD_BUNDLED && version_compare(GD_VERSION, '2.2.2', '<')) {",
          "9:   die(\"skip test requires GD 2.2.2 or higher\");",
          "10:  }",
          "",
          "---------------"
        ],
        "ext/gd/tests/imagefilledarc_basic.phpt||ext/gd/tests/imagefilledarc_basic.phpt": [
          "File: ext/gd/tests/imagefilledarc_basic.phpt -> ext/gd/tests/imagefilledarc_basic.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "6: --SKIPIF--",
          "7: <?php",
          "8: if (!extension_loaded(\"gd\")) die(\"skip GD not present\");",
          "9: ?>",
          "10: --FILE--",
          "11: <?php",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "9: if (!GD_BUNDLED && version_compare(GD_VERSION, '2.2.2', '<')) {",
          "10:  die(\"skip test requires GD 2.2.2 or higher\");",
          "11: }",
          "",
          "---------------"
        ],
        "ext/gd/tests/imagefilledarc_variation1.phpt||ext/gd/tests/imagefilledarc_variation1.phpt": [
          "File: ext/gd/tests/imagefilledarc_variation1.phpt -> ext/gd/tests/imagefilledarc_variation1.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "6: --SKIPIF--",
          "7: <?php",
          "8: if (!extension_loaded(\"gd\")) die(\"skip GD not present\");",
          "9: ?>",
          "10: --FILE--",
          "11: <?php",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "9: if (!GD_BUNDLED && version_compare(GD_VERSION, '2.2.2', '<')) {",
          "10:  die(\"skip test requires GD 2.2.2 or higher\");",
          "11: }",
          "",
          "---------------"
        ],
        "ext/gd/tests/imagefilledarc_variation2.phpt||ext/gd/tests/imagefilledarc_variation2.phpt": [
          "File: ext/gd/tests/imagefilledarc_variation2.phpt -> ext/gd/tests/imagefilledarc_variation2.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "6: --SKIPIF--",
          "7: <?php",
          "8: if (!extension_loaded(\"gd\")) die(\"skip GD not present\");",
          "9: ?>",
          "10: --FILE--",
          "11: <?php",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "9: if (!GD_BUNDLED && version_compare(GD_VERSION, '2.2.2', '<')) {",
          "10:  die(\"skip test requires GD 2.2.2 or higher\");",
          "11: }",
          "",
          "---------------"
        ],
        "ext/gd/tests/imagegammacorrect_basic.phpt||ext/gd/tests/imagegammacorrect_basic.phpt": [
          "File: ext/gd/tests/imagegammacorrect_basic.phpt -> ext/gd/tests/imagegammacorrect_basic.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "6: --SKIPIF--",
          "7: <?php",
          "8:  if (!extension_loaded(\"gd\")) die(\"skip GD not present\");",
          "9: ?>",
          "10: --FILE--",
          "11: <?php",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "9:  if (!GD_BUNDLED && version_compare(GD_VERSION, '2.2.2', '<')) {",
          "10:   die(\"skip test requires GD 2.2.2 or higher\");",
          "11:  }",
          "",
          "---------------"
        ],
        "ext/gd/tests/imagegammacorrect_variation1.phpt||ext/gd/tests/imagegammacorrect_variation1.phpt": [
          "File: ext/gd/tests/imagegammacorrect_variation1.phpt -> ext/gd/tests/imagegammacorrect_variation1.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "6: --SKIPIF--",
          "7: <?php",
          "8:  if (!extension_loaded(\"gd\")) die(\"skip GD not present\");",
          "9: ?>",
          "10: --FILE--",
          "11: <?php",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "9:  if (!GD_BUNDLED && version_compare(GD_VERSION, '2.2.2', '<')) {",
          "10:   die(\"skip test requires GD 2.2.2 or higher\");",
          "11:  }",
          "",
          "---------------"
        ],
        "ext/gd/tests/imagetruecolortopalette_basic.phpt||ext/gd/tests/imagetruecolortopalette_basic.phpt": [
          "File: ext/gd/tests/imagetruecolortopalette_basic.phpt -> ext/gd/tests/imagetruecolortopalette_basic.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: --SKIPIF--",
          "6: <?php",
          "7:  if (!extension_loaded(\"gd\")) die(\"skip GD not present\");",
          "8:  if (!function_exists(\"imagecreatetruecolor\")) die(\"skip GD Version not compatible\");",
          "9: ?>",
          "10: --FILE--",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "8:  if (!GD_BUNDLED && version_compare(GD_VERSION, '2.2.2', '<')) {",
          "9:   die(\"skip test requires GD 2.2.2 or higher\");",
          "10:  }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "8fb3f06ef5f6b35b0d08986340668472a6119ee8",
      "candidate_info": {
        "commit_hash": "8fb3f06ef5f6b35b0d08986340668472a6119ee8",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/8fb3f06ef5f6b35b0d08986340668472a6119ee8",
        "files": [
          "ext/gd/tests/bug72339.gd",
          "ext/gd/tests/bug72339.phpt"
        ],
        "message": "remove the huge test file, generate it on the fly instead",
        "before_after_code_files": [
          "ext/gd/tests/bug72339.phpt||ext/gd/tests/bug72339.phpt"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/gd/tests/bug72339.phpt||ext/gd/tests/bug72339.phpt"
          ],
          "candidate": [
            "ext/gd/tests/bug72339.phpt||ext/gd/tests/bug72339.phpt"
          ]
        }
      },
      "candidate_diff": {
        "ext/gd/tests/bug72339.phpt||ext/gd/tests/bug72339.phpt": [
          "File: ext/gd/tests/bug72339.phpt -> ext/gd/tests/bug72339.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: --SKIPIF--",
          "4: <?php if (!function_exists(\"imagecreatefromgd2\")) print \"skip\"; ?>",
          "5: --FILE--",
          "7: --EXPECTF--",
          "8: Warning: imagecreatefromgd2(): gd warning: product of memory allocation multiplication would exceed INT_MAX, failing operation gracefully",
          "9:  in %sbug72339.php on line %d",
          "",
          "[Removed Lines]",
          "6: <?php imagecreatefromgd2(dirname(__FILE__) . DIRECTORY_SEPARATOR . \"bug72339.gd\"); ?>",
          "",
          "[Added Lines]",
          "6: <?php",
          "7: $fname = dirname(__FILE__) . DIRECTORY_SEPARATOR . \"bug72339.gd\";",
          "9: $fh = fopen($fname, \"w\");",
          "10: fwrite($fh, \"gd2\\x00\");",
          "11: fwrite($fh, pack(\"n\", 2));",
          "12: fwrite($fh, pack(\"n\", 1));",
          "13: fwrite($fh, pack(\"n\", 1));",
          "14: fwrite($fh, pack(\"n\", 0x40));",
          "15: fwrite($fh, pack(\"n\", 2));",
          "16: fwrite($fh, pack(\"n\", 0x5AA0)); // Chunks Wide",
          "17: fwrite($fh, pack(\"n\", 0x5B00)); // Chunks Vertically",
          "18: fwrite($fh, str_repeat(\"\\x41\\x41\\x41\\x41\", 0x1000000)); // overflow data",
          "19: fclose($fh);",
          "21: $im = imagecreatefromgd2($fname);",
          "23: if ($im) {",
          "24:  imagedestroy($im);",
          "25: }",
          "26: unlink($fname);",
          "28: ?>",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "2af71a04b09aeb7dc6ae23e3046affce71111a27",
      "candidate_info": {
        "commit_hash": "2af71a04b09aeb7dc6ae23e3046affce71111a27",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/2af71a04b09aeb7dc6ae23e3046affce71111a27",
        "files": [
          "ext/gd/tests/bug72339.gd",
          "ext/gd/tests/bug72339.phpt"
        ],
        "message": "remove the huge test file, generate it on the fly instead",
        "before_after_code_files": [
          "ext/gd/tests/bug72339.phpt||ext/gd/tests/bug72339.phpt"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/gd/tests/bug72339.phpt||ext/gd/tests/bug72339.phpt"
          ],
          "candidate": [
            "ext/gd/tests/bug72339.phpt||ext/gd/tests/bug72339.phpt"
          ]
        }
      },
      "candidate_diff": {
        "ext/gd/tests/bug72339.phpt||ext/gd/tests/bug72339.phpt": [
          "File: ext/gd/tests/bug72339.phpt -> ext/gd/tests/bug72339.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: --SKIPIF--",
          "4: <?php if (!function_exists(\"imagecreatefromgd2\")) print \"skip\"; ?>",
          "5: --FILE--",
          "7: --EXPECTF--",
          "8: Warning: imagecreatefromgd2(): gd warning: product of memory allocation multiplication would exceed INT_MAX, failing operation gracefully",
          "9:  in %sbug72339.php on line %d",
          "",
          "[Removed Lines]",
          "6: <?php imagecreatefromgd2(dirname(__FILE__) . DIRECTORY_SEPARATOR . \"bug72339.gd\"); ?>",
          "",
          "[Added Lines]",
          "6: <?php",
          "7: $fname = dirname(__FILE__) . DIRECTORY_SEPARATOR . \"bug72339.gd\";",
          "9: $fh = fopen($fname, \"w\");",
          "10: fwrite($fh, \"gd2\\x00\");",
          "11: fwrite($fh, pack(\"n\", 2));",
          "12: fwrite($fh, pack(\"n\", 1));",
          "13: fwrite($fh, pack(\"n\", 1));",
          "14: fwrite($fh, pack(\"n\", 0x40));",
          "15: fwrite($fh, pack(\"n\", 2));",
          "16: fwrite($fh, pack(\"n\", 0x5AA0)); // Chunks Wide",
          "17: fwrite($fh, pack(\"n\", 0x5B00)); // Chunks Vertically",
          "18: fwrite($fh, str_repeat(\"\\x41\\x41\\x41\\x41\", 0x1000000)); // overflow data",
          "19: fclose($fh);",
          "21: $im = imagecreatefromgd2($fname);",
          "23: if ($im) {",
          "24:  imagedestroy($im);",
          "25: }",
          "26: unlink($fname);",
          "28: ?>",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "5f107ab8a66f8b36ac0c0b32e0231bf94e083c94",
      "candidate_info": {
        "commit_hash": "5f107ab8a66f8b36ac0c0b32e0231bf94e083c94",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/5f107ab8a66f8b36ac0c0b32e0231bf94e083c94",
        "files": [
          "ext/gd/libgd/gd_gd2.c"
        ],
        "message": "fix tests",
        "before_after_code_files": [
          "ext/gd/libgd/gd_gd2.c||ext/gd/libgd/gd_gd2.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/gd/libgd/gd_gd2.c||ext/gd/libgd/gd_gd2.c"
          ],
          "candidate": [
            "ext/gd/libgd/gd_gd2.c||ext/gd/libgd/gd_gd2.c"
          ]
        }
      },
      "candidate_diff": {
        "ext/gd/libgd/gd_gd2.c||ext/gd/libgd/gd_gd2.c": [
          "File: ext/gd/libgd/gd_gd2.c -> ext/gd/libgd/gd_gd2.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "138:  if (gd2_compressed(*fmt)) {",
          "139:   nc = (*ncx) * (*ncy);",
          "140:   GD2_DBG(php_gd_error(\"Reading %d chunk index entries\", nc));",
          "142:    goto fail1;",
          "143:   }",
          "144:   sidx = sizeof(t_chunk_info) * nc;",
          "",
          "[Removed Lines]",
          "141:   if (overflow2(sidx, nc)) {",
          "",
          "[Added Lines]",
          "141:   if (overflow2(sizeof(t_chunk_info), nc)) {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "0c7250f260303061425d0d8a348d1a80fa0cc12e",
      "candidate_info": {
        "commit_hash": "0c7250f260303061425d0d8a348d1a80fa0cc12e",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/0c7250f260303061425d0d8a348d1a80fa0cc12e",
        "files": [
          "ext/gd/tests/bug72339.gd",
          "ext/gd/tests/bug72339.phpt"
        ],
        "message": "remove the huge test file, generate it on the fly instead",
        "before_after_code_files": [
          "ext/gd/tests/bug72339.phpt||ext/gd/tests/bug72339.phpt"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/gd/tests/bug72339.phpt||ext/gd/tests/bug72339.phpt"
          ],
          "candidate": [
            "ext/gd/tests/bug72339.phpt||ext/gd/tests/bug72339.phpt"
          ]
        }
      },
      "candidate_diff": {
        "ext/gd/tests/bug72339.phpt||ext/gd/tests/bug72339.phpt": [
          "File: ext/gd/tests/bug72339.phpt -> ext/gd/tests/bug72339.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: --SKIPIF--",
          "4: <?php if (!function_exists(\"imagecreatefromgd2\")) print \"skip\"; ?>",
          "5: --FILE--",
          "7: --EXPECTF--",
          "8: Warning: imagecreatefromgd2(): gd warning: product of memory allocation multiplication would exceed INT_MAX, failing operation gracefully",
          "9:  in %sbug72339.php on line %d",
          "",
          "[Removed Lines]",
          "6: <?php imagecreatefromgd2(dirname(__FILE__) . DIRECTORY_SEPARATOR . \"bug72339.gd\"); ?>",
          "",
          "[Added Lines]",
          "6: <?php",
          "7: $fname = dirname(__FILE__) . DIRECTORY_SEPARATOR . \"bug72339.gd\";",
          "9: $fh = fopen($fname, \"w\");",
          "10: fwrite($fh, \"gd2\\x00\");",
          "11: fwrite($fh, pack(\"n\", 2));",
          "12: fwrite($fh, pack(\"n\", 1));",
          "13: fwrite($fh, pack(\"n\", 1));",
          "14: fwrite($fh, pack(\"n\", 0x40));",
          "15: fwrite($fh, pack(\"n\", 2));",
          "16: fwrite($fh, pack(\"n\", 0x5AA0)); // Chunks Wide",
          "17: fwrite($fh, pack(\"n\", 0x5B00)); // Chunks Vertically",
          "18: fwrite($fh, str_repeat(\"\\x41\\x41\\x41\\x41\", 0x1000000)); // overflow data",
          "19: fclose($fh);",
          "21: $im = imagecreatefromgd2($fname);",
          "23: if ($im) {",
          "24:  imagedestroy($im);",
          "25: }",
          "26: unlink($fname);",
          "28: ?>",
          "",
          "---------------"
        ]
      }
    }
  ]
}