{
  "cve_id": "CVE-2019-6798",
  "cve_desc": "An issue was discovered in phpMyAdmin before 4.8.5. A vulnerability was reported where a specially crafted username can be used to trigger a SQL injection attack through the designer feature.",
  "repo": "phpmyadmin/phpmyadmin",
  "patch_hash": "469934cf7d3bd19a839eb78670590f7511399435",
  "patch_info": {
    "commit_hash": "469934cf7d3bd19a839eb78670590f7511399435",
    "repo": "phpmyadmin/phpmyadmin",
    "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/469934cf7d3bd19a839eb78670590f7511399435",
    "files": [
      "libraries/classes/Database/Designer.php",
      "libraries/classes/Database/Designer/Common.php"
    ],
    "message": "Issue phpmyadmin-security/267 SQL injection in Designer feature\n\nSigned-off-by: Madhura Jayaratne <madhura.cj@gmail.com>",
    "before_after_code_files": [
      "libraries/classes/Database/Designer.php||libraries/classes/Database/Designer.php",
      "libraries/classes/Database/Designer/Common.php||libraries/classes/Database/Designer/Common.php"
    ]
  },
  "patch_diff": {
    "libraries/classes/Database/Designer.php||libraries/classes/Database/Designer.php": [
      "File: libraries/classes/Database/Designer.php -> libraries/classes/Database/Designer.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "200:                 . Util::backquote($cfgRelation['db']) . '.'",
      "201:                 . Util::backquote($cfgRelation['designer_settings'])",
      "202:                 . ' WHERE ' . Util::backquote('username') . ' = \"'",
      "205:             $result = $GLOBALS['dbi']->fetchSingleRow($query);",
      "",
      "[Removed Lines]",
      "203:                 . $GLOBALS['cfg']['Server']['user'] . '\";';",
      "",
      "[Added Lines]",
      "203:                 . $GLOBALS['dbi']->escapeString($GLOBALS['cfg']['Server']['user'])",
      "204:                 . '\";';",
      "",
      "---------------"
    ],
    "libraries/classes/Database/Designer/Common.php||libraries/classes/Database/Designer/Common.php": [
      "File: libraries/classes/Database/Designer/Common.php -> libraries/classes/Database/Designer/Common.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "787:                     . Util::backquote($cfgDesigner['db'])",
      "788:                     . \".\" . Util::backquote($cfgDesigner['table'])",
      "789:                     . \" (username, settings_data)\"",
      "793:                 $success = $this->relation->queryAsControlUser($query);",
      "794:             }",
      "",
      "[Removed Lines]",
      "790:                     . \" VALUES('\" . $cfgDesigner['user'] . \"',\"",
      "791:                     . \" '\" . json_encode($save_data) . \"');\";",
      "",
      "[Added Lines]",
      "790:                     . \" VALUES('\" . $GLOBALS['dbi']->escapeString($cfgDesigner['user'])",
      "791:                     . \"', '\" . json_encode($save_data) . \"');\";",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "d676d6941f9ac1c652873df47f2de96666c1a335",
      "candidate_info": {
        "commit_hash": "d676d6941f9ac1c652873df47f2de96666c1a335",
        "repo": "phpmyadmin/phpmyadmin",
        "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/d676d6941f9ac1c652873df47f2de96666c1a335",
        "files": [
          "libraries/classes/Database/Designer.php",
          "libraries/classes/Database/Designer/Common.php"
        ],
        "message": "Issue phpmyadmin-security/267 SQL injection in Designer feature\n\nSigned-off-by: Madhura Jayaratne <madhura.cj@gmail.com>",
        "before_after_code_files": [
          "libraries/classes/Database/Designer.php||libraries/classes/Database/Designer.php",
          "libraries/classes/Database/Designer/Common.php||libraries/classes/Database/Designer/Common.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_message": 1,
        "olp_code_files": {
          "patch": [
            "libraries/classes/Database/Designer.php||libraries/classes/Database/Designer.php",
            "libraries/classes/Database/Designer/Common.php||libraries/classes/Database/Designer/Common.php"
          ],
          "candidate": [
            "libraries/classes/Database/Designer.php||libraries/classes/Database/Designer.php",
            "libraries/classes/Database/Designer/Common.php||libraries/classes/Database/Designer/Common.php"
          ]
        }
      },
      "candidate_diff": {
        "libraries/classes/Database/Designer.php||libraries/classes/Database/Designer.php": [
          "File: libraries/classes/Database/Designer.php -> libraries/classes/Database/Designer.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "200:                 . Util::backquote($cfgRelation['db']) . '.'",
          "201:                 . Util::backquote($cfgRelation['designer_settings'])",
          "202:                 . ' WHERE ' . Util::backquote('username') . ' = \"'",
          "205:             $result = $GLOBALS['dbi']->fetchSingleRow($query);",
          "",
          "[Removed Lines]",
          "203:                 . $GLOBALS['cfg']['Server']['user'] . '\";';",
          "",
          "[Added Lines]",
          "203:                 . $GLOBALS['dbi']->escapeString($GLOBALS['cfg']['Server']['user'])",
          "204:                 . '\";';",
          "",
          "---------------"
        ],
        "libraries/classes/Database/Designer/Common.php||libraries/classes/Database/Designer/Common.php": [
          "File: libraries/classes/Database/Designer/Common.php -> libraries/classes/Database/Designer/Common.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "787:                     . Util::backquote($cfgDesigner['db'])",
          "788:                     . \".\" . Util::backquote($cfgDesigner['table'])",
          "789:                     . \" (username, settings_data)\"",
          "793:                 $success = $this->relation->queryAsControlUser($query);",
          "794:             }",
          "",
          "[Removed Lines]",
          "790:                     . \" VALUES('\" . $cfgDesigner['user'] . \"',\"",
          "791:                     . \" '\" . json_encode($save_data) . \"');\";",
          "",
          "[Added Lines]",
          "790:                     . \" VALUES('\" . $GLOBALS['dbi']->escapeString($cfgDesigner['user'])",
          "791:                     . \"', '\" . json_encode($save_data) . \"');\";",
          "",
          "---------------"
        ]
      }
    }
  ]
}