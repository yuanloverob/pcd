{
  "cve_id": "CVE-2015-2272",
  "cve_desc": "login/token.php in Moodle through 2.5.9, 2.6.x before 2.6.9, 2.7.x before 2.7.6, and 2.8.x before 2.8.4 allows remote authenticated users to bypass a forced-password-change requirement by creating a web-services token.",
  "repo": "moodle/moodle",
  "patch_hash": "bd3b68c8a7a08b4fef407f68cef14b30dd88336e",
  "patch_info": {
    "commit_hash": "bd3b68c8a7a08b4fef407f68cef14b30dd88336e",
    "repo": "moodle/moodle",
    "commit_url": "https://github.com/moodle/moodle/commit/bd3b68c8a7a08b4fef407f68cef14b30dd88336e",
    "files": [
      "login/token.php"
    ],
    "message": "MDL-48691 webservices: Check if the user must be changing password",
    "before_after_code_files": [
      "login/token.php||login/token.php"
    ]
  },
  "patch_diff": {
    "login/token.php||login/token.php": [
      "File: login/token.php -> login/token.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "64:         }",
      "65:     }",
      "68:     enrol_check_plugins($user);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "68:     if (get_user_preferences('auth_forcepasswordchange', false, $user)) {",
      "69:         if ($userauth->can_change_password()) {",
      "70:             throw new moodle_exception('forcepasswordchangenotice');",
      "71:         } else {",
      "72:             throw new moodle_exception('nopasswordchangeforced', 'auth');",
      "73:         }",
      "74:     }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "0899c0adc036e34e0c37ea1a8d3551610cdb4233",
      "candidate_info": {
        "commit_hash": "0899c0adc036e34e0c37ea1a8d3551610cdb4233",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/0899c0adc036e34e0c37ea1a8d3551610cdb4233",
        "files": [
          "login/token.php"
        ],
        "message": "MDL-48691 webservices: Check if the user must be changing password",
        "before_after_code_files": [
          "login/token.php||login/token.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "login/token.php||login/token.php"
          ],
          "candidate": [
            "login/token.php||login/token.php"
          ]
        }
      },
      "candidate_diff": {
        "login/token.php||login/token.php": [
          "File: login/token.php -> login/token.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "64:         }",
          "65:     }",
          "68:     enrol_check_plugins($user);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "68:     if (get_user_preferences('auth_forcepasswordchange', false, $user)) {",
          "69:         if ($userauth->can_change_password()) {",
          "70:             throw new moodle_exception('forcepasswordchangenotice');",
          "71:         } else {",
          "72:             throw new moodle_exception('nopasswordchangeforced', 'auth');",
          "73:         }",
          "74:     }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "6e284d55b234287169f21e6ef8a9a237d6eedfe4",
      "candidate_info": {
        "commit_hash": "6e284d55b234287169f21e6ef8a9a237d6eedfe4",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/6e284d55b234287169f21e6ef8a9a237d6eedfe4",
        "files": [
          "login/token.php"
        ],
        "message": "MDL-48691 webservices: Check if the user must be changing password",
        "before_after_code_files": [
          "login/token.php||login/token.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "login/token.php||login/token.php"
          ],
          "candidate": [
            "login/token.php||login/token.php"
          ]
        }
      },
      "candidate_diff": {
        "login/token.php||login/token.php": [
          "File: login/token.php -> login/token.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "64:         }",
          "65:     }",
          "68:     enrol_check_plugins($user);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "68:     if (get_user_preferences('auth_forcepasswordchange', false, $user)) {",
          "69:         if ($userauth->can_change_password()) {",
          "70:             throw new moodle_exception('forcepasswordchangenotice');",
          "71:         } else {",
          "72:             throw new moodle_exception('nopasswordchangeforced', 'auth');",
          "73:         }",
          "74:     }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "b0abcbda170b57649e0ed39ac5aca91dbc30337f",
      "candidate_info": {
        "commit_hash": "b0abcbda170b57649e0ed39ac5aca91dbc30337f",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/b0abcbda170b57649e0ed39ac5aca91dbc30337f",
        "files": [
          "login/token.php"
        ],
        "message": "MDL-48691 webservices: Check if the user must be changing password",
        "before_after_code_files": [
          "login/token.php||login/token.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "login/token.php||login/token.php"
          ],
          "candidate": [
            "login/token.php||login/token.php"
          ]
        }
      },
      "candidate_diff": {
        "login/token.php||login/token.php": [
          "File: login/token.php -> login/token.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "64:         }",
          "65:     }",
          "68:     enrol_check_plugins($user);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "68:     if (get_user_preferences('auth_forcepasswordchange', false, $user)) {",
          "69:         if ($userauth->can_change_password()) {",
          "70:             throw new moodle_exception('forcepasswordchangenotice');",
          "71:         } else {",
          "72:             throw new moodle_exception('nopasswordchangeforced', 'auth');",
          "73:         }",
          "74:     }",
          "",
          "---------------"
        ]
      }
    }
  ]
}