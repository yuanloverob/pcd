{
  "cve_id": "CVE-2017-3730",
  "cve_desc": "In OpenSSL 1.1.0 before 1.1.0d, if a malicious server supplies bad parameters for a DHE or ECDHE key exchange then this can result in the client attempting to dereference a NULL pointer leading to a client crash. This could be exploited in a Denial of Service attack.",
  "repo": "openssl/openssl",
  "patch_hash": "efbe126e3ebb9123ac9d058aa2bb044261342aaa",
  "patch_info": {
    "commit_hash": "efbe126e3ebb9123ac9d058aa2bb044261342aaa",
    "repo": "openssl/openssl",
    "commit_url": "https://github.com/openssl/openssl/commit/efbe126e3ebb9123ac9d058aa2bb044261342aaa",
    "files": [
      "ssl/statem/statem_clnt.c"
    ],
    "message": "Fix missing NULL checks in CKE processing\n\nReviewed-by: Rich Salz <rsalz@openssl.org>",
    "before_after_code_files": [
      "ssl/statem/statem_clnt.c||ssl/statem/statem_clnt.c"
    ]
  },
  "patch_diff": {
    "ssl/statem/statem_clnt.c||ssl/statem/statem_clnt.c": [
      "File: ssl/statem/statem_clnt.c -> ssl/statem/statem_clnt.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "2258:         return 0;",
      "2259:     }",
      "2260:     ckey = ssl_generate_pkey(skey);",
      "2261:     dh_clnt = EVP_PKEY_get0_DH(ckey);",
      "2263:     if (dh_clnt == NULL || ssl_derive(s, ckey, skey) == 0) {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "2261:     if (ckey == NULL) {",
      "2262:         SSLerr(SSL_F_TLS_CONSTRUCT_CKE_DHE, ERR_R_INTERNAL_ERROR);",
      "2263:         return 0;",
      "2264:     }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "2296:     }",
      "2298:     ckey = ssl_generate_pkey(skey);",
      "2300:     if (ssl_derive(s, ckey, skey) == 0) {",
      "2301:         SSLerr(SSL_F_TLS_CONSTRUCT_CKE_ECDHE, ERR_R_EVP_LIB);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "2304:     if (ckey == NULL) {",
      "2305:         SSLerr(SSL_F_TLS_CONSTRUCT_CKE_ECDHE, ERR_R_INTERNAL_ERROR);",
      "2306:         goto err;",
      "2307:     }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "799398ca426fa25bd9af229b68977c48f8064974",
      "candidate_info": {
        "commit_hash": "799398ca426fa25bd9af229b68977c48f8064974",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/799398ca426fa25bd9af229b68977c48f8064974",
        "files": [
          "include/openssl/bio.h"
        ],
        "message": "bio.h: fix number of arguments passed to BIO_ptr_ctrl()\n\nReviewed-by: Matt Caswell <matt@openssl.org>\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/1520)\n(cherry picked from commit c2efa78309e39019642f922b2babc1fd35f68768)",
        "before_after_code_files": [
          "include/openssl/bio.h||include/openssl/bio.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "include/openssl/bio.h||include/openssl/bio.h": [
          "File: include/openssl/bio.h -> include/openssl/bio.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "365: #  define BIO_set_conn_port(b,port)     BIO_ctrl(b,BIO_C_SET_CONNECT,1,(char *)port)",
          "366: #  define BIO_set_conn_address(b,addr)  BIO_ctrl(b,BIO_C_SET_CONNECT,2,(char *)addr)",
          "367: #  define BIO_set_conn_ip_family(b,f)   BIO_int_ctrl(b,BIO_C_SET_CONNECT,3,f)",
          "371: #  define BIO_get_conn_ip_family(b)     BIO_ctrl(b,BIO_C_GET_CONNECT,3,NULL)",
          "372: #  define BIO_set_conn_mode(b,n)        BIO_ctrl(b,BIO_C_SET_CONNECT_MODE,(n),NULL)",
          "",
          "[Removed Lines]",
          "368: #  define BIO_get_conn_hostname(b)      ((const char *)BIO_ptr_ctrl(b,BIO_C_GET_CONNECT,0,NULL))",
          "369: #  define BIO_get_conn_port(b)          ((const char *)BIO_ptr_ctrl(b,BIO_C_GET_CONNECT,1,NULL))",
          "370: #  define BIO_get_conn_address(b)       ((const BIO_ADDR *)BIO_ptr_ctrl(b,BIO_C_GET_CONNECT,2,NULL))",
          "",
          "[Added Lines]",
          "368: #  define BIO_get_conn_hostname(b)      ((const char *)BIO_ptr_ctrl(b,BIO_C_GET_CONNECT,0))",
          "369: #  define BIO_get_conn_port(b)          ((const char *)BIO_ptr_ctrl(b,BIO_C_GET_CONNECT,1))",
          "370: #  define BIO_get_conn_address(b)       ((const BIO_ADDR *)BIO_ptr_ctrl(b,BIO_C_GET_CONNECT,2))",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "8ff785f4eb4ff06213fbf68da389132e31a9e4af",
      "candidate_info": {
        "commit_hash": "8ff785f4eb4ff06213fbf68da389132e31a9e4af",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/8ff785f4eb4ff06213fbf68da389132e31a9e4af",
        "files": [
          "Configurations/10-main.conf"
        ],
        "message": "Remove -xtarget=ultra from solaris(64)-sparcv9-cc builds.\n\nThis flag got moved after -xarch=v9 in 1.1.0 and had the unexpected\nside effect of the compiler building for 32-bit v8plusa instead of v9.\n\nGH#1521\nCLA: none; trivial\n\nSigned-off-by: Andy Polyakov <appro@openssl.org>\nReviewed-by: Tim Hudson <tjh@openssl.org>\n(cherry picked from commit fa4618a2805e7115cf47d0cf0d15cb7b3c944bba)",
        "before_after_code_files": [
          "Configurations/10-main.conf||Configurations/10-main.conf"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "Configurations/10-main.conf||Configurations/10-main.conf": [
          "File: Configurations/10-main.conf -> Configurations/10-main.conf",
          "--- Hunk 1 ---",
          "[Context before]",
          "308:     },",
          "309:     \"solaris-sparcv9-cc\" => {",
          "310:         inherit_from     => [ \"solaris-sparcv7-cc\", asm(\"sparcv9_asm\") ],",
          "312:     },",
          "313:     \"solaris64-sparcv9-cc\" => {",
          "314:         inherit_from     => [ \"solaris-sparcv7-cc\", asm(\"sparcv9_asm\") ],",
          "316:         lflags           => add_before(\"-xarch=v9\"),",
          "317:         bn_ops           => \"BN_LLONG RC4_CHAR\",",
          "318:         shared_ldflag    => \"-xarch=v9 -G -dy -z text\",",
          "",
          "[Removed Lines]",
          "311:         cflags           => add_before(\"-xarch=v8plus -xtarget=ultra\"),",
          "315:         cflags           => add_before(\"-xarch=v9 -xtarget=ultra\"),",
          "",
          "[Added Lines]",
          "311:         cflags           => add_before(\"-xarch=v8plus\"),",
          "315:         cflags           => add_before(\"-xarch=v9\"),",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "ce180867a4ae781cd84fdcf01ba6e2320de651ef",
      "candidate_info": {
        "commit_hash": "ce180867a4ae781cd84fdcf01ba6e2320de651ef",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/ce180867a4ae781cd84fdcf01ba6e2320de651ef",
        "files": [
          "apps/enc.c"
        ],
        "message": "Let the output from 'openssl enc -ciphers' go to stdout\n\nAlso, don't exit with an error code\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/2716)\n(cherry picked from commit 341de5f1997d21b60cee69be656f1ae709bccdac)",
        "before_after_code_files": [
          "apps/enc.c||apps/enc.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "apps/enc.c||apps/enc.c": [
          "File: apps/enc.c -> apps/enc.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "134:             ret = 0;",
          "135:             goto end;",
          "136:         case OPT_LIST:",
          "138:             OBJ_NAME_do_all_sorted(OBJ_NAME_TYPE_CIPHER_METH,",
          "141:             goto end;",
          "142:         case OPT_E:",
          "143:             enc = 1;",
          "",
          "[Removed Lines]",
          "137:             BIO_printf(bio_err, \"Supported ciphers:\\n\");",
          "139:                                    show_ciphers, bio_err);",
          "140:             BIO_printf(bio_err, \"\\n\");",
          "",
          "[Added Lines]",
          "137:             BIO_printf(bio_out, \"Supported ciphers:\\n\");",
          "139:                                    show_ciphers, bio_out);",
          "140:             BIO_printf(bio_out, \"\\n\");",
          "141:             ret = 0;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "a55b3959374161e33c68542d27c0fe93c6b7fe81",
      "candidate_info": {
        "commit_hash": "a55b3959374161e33c68542d27c0fe93c6b7fe81",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/a55b3959374161e33c68542d27c0fe93c6b7fe81",
        "files": [
          "apps/apps.c",
          "apps/apps.h"
        ],
        "message": "apps: instead of varying implementation, make setup_engine a function always\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/1643)\n(cherry picked from commit 907c6c86331243897b80f37895a14de1e7957541)",
        "before_after_code_files": [
          "apps/apps.c||apps/apps.c",
          "apps/apps.h||apps/apps.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "apps/apps.c||apps/apps.c": [
          "File: apps/apps.c -> apps/apps.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1243:     }",
          "1244:     return e;",
          "1245: }",
          "1247: ENGINE *setup_engine(const char *engine, int debug)",
          "1248: {",
          "1249:     ENGINE *e = NULL;",
          "1251:     if (engine) {",
          "1252:         if (strcmp(engine, \"auto\") == 0) {",
          "1253:             BIO_printf(bio_err, \"enabling auto ENGINE support\\n\");",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1246: #endif",
          "1252: #ifndef OPENSSL_NO_ENGINE",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1274:         BIO_printf(bio_err, \"engine \\\"%s\\\" set.\\n\", ENGINE_get_id(e));",
          "1275:     }",
          "1276:     return e;",
          "1277: }",
          "1280: void release_engine(ENGINE *e)",
          "1281: {",
          "",
          "[Removed Lines]",
          "1278: #endif",
          "",
          "[Added Lines]",
          "1278: #endif",
          "",
          "---------------"
        ],
        "apps/apps.h||apps/apps.h": [
          "File: apps/apps.h -> apps/apps.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "431: #endif",
          "436: ENGINE *setup_engine(const char *engine, int debug);",
          "438: void release_engine(ENGINE *e);",
          "439: # ifndef OPENSSL_NO_OCSP",
          "440: OCSP_RESPONSE *process_responder(OCSP_REQUEST *req,",
          "441:                                  const char *host, const char *path,",
          "",
          "[Removed Lines]",
          "433: # ifdef OPENSSL_NO_ENGINE",
          "434: #  define setup_engine(engine, debug) NULL",
          "435: # else",
          "437: # endif",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "b37fce59cb7c48776361ac8cb8a808793016eefd",
      "candidate_info": {
        "commit_hash": "b37fce59cb7c48776361ac8cb8a808793016eefd",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/b37fce59cb7c48776361ac8cb8a808793016eefd",
        "files": [
          "apps/ts.c",
          "crypto/ec/ec_ameth.c",
          "ssl/ssl_ciph.c"
        ],
        "message": "mem leak on error path and error propagation fix\n\nReviewed-by: Richard Levitte <levitte@openssl.org>\nReviewed-by: Matt Caswell <matt@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/2559)\n(cherry picked from commit e0670973d5c0b837eb5a9f1670e47107f466fbc7)",
        "before_after_code_files": [
          "apps/ts.c||apps/ts.c",
          "crypto/ec/ec_ameth.c||crypto/ec/ec_ameth.c",
          "ssl/ssl_ciph.c||ssl/ssl_ciph.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "apps/ts.c||apps/ts.c": [
          "File: apps/ts.c -> apps/ts.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "890:             goto err;",
          "891:         f = TS_VFY_VERSION | TS_VFY_SIGNER;",
          "892:         if (data != NULL) {",
          "893:             f |= TS_VFY_DATA;",
          "895:                 goto err;",
          "896:         } else if (digest != NULL) {",
          "897:             long imprint_len;",
          "898:             unsigned char *hexstr = OPENSSL_hexstr2buf(digest, &imprint_len);",
          "",
          "[Removed Lines]",
          "894:             if (TS_VERIFY_CTX_set_data(ctx, BIO_new_file(data, \"rb\")) == NULL)",
          "",
          "[Added Lines]",
          "893:             BIO *out = NULL;",
          "896:             if ((out = BIO_new_file(data, \"rb\")) == NULL)",
          "897:                 goto err;",
          "898:             if (TS_VERIFY_CTX_set_data(ctx, out) == NULL) {",
          "899:                 BIO_free_all(out);",
          "901:             }",
          "",
          "---------------"
        ],
        "crypto/ec/ec_ameth.c||crypto/ec/ec_ameth.c": [
          "File: crypto/ec/ec_ameth.c -> crypto/ec/ec_ameth.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "254:     }",
          "256:     if (!PKCS8_pkey_set0(p8, OBJ_nid2obj(NID_X9_62_id_ecPublicKey), 0,",
          "258:         return 0;",
          "260:     return 1;",
          "261: }",
          "",
          "[Removed Lines]",
          "257:                          ptype, pval, ep, eplen))",
          "",
          "[Added Lines]",
          "257:                          ptype, pval, ep, eplen)) {",
          "258:         OPENSSL_free(ep);",
          "260:     }",
          "",
          "---------------"
        ],
        "ssl/ssl_ciph.c||ssl/ssl_ciph.c": [
          "File: ssl/ssl_ciph.c -> ssl/ssl_ciph.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1827:     if (id < 193 || id > 255) {",
          "1828:         SSLerr(SSL_F_SSL_COMP_ADD_COMPRESSION_METHOD,",
          "1829:                SSL_R_COMPRESSION_ID_NOT_WITHIN_PRIVATE_RANGE);",
          "1831:     }",
          "1833:     CRYPTO_mem_ctrl(CRYPTO_MEM_CHECK_DISABLE);",
          "",
          "[Removed Lines]",
          "1830:         return 0;",
          "",
          "[Added Lines]",
          "1830:         return 1;",
          "",
          "---------------"
        ]
      }
    }
  ]
}