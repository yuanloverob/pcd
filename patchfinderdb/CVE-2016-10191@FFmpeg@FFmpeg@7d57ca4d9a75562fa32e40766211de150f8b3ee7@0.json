{
  "cve_id": "CVE-2016-10191",
  "cve_desc": "Heap-based buffer overflow in libavformat/rtmppkt.c in FFmpeg before 2.8.10, 3.0.x before 3.0.5, 3.1.x before 3.1.6, and 3.2.x before 3.2.2 allows remote attackers to execute arbitrary code by leveraging failure to check for RTMP packet size mismatches.",
  "repo": "FFmpeg/FFmpeg",
  "patch_hash": "7d57ca4d9a75562fa32e40766211de150f8b3ee7",
  "patch_info": {
    "commit_hash": "7d57ca4d9a75562fa32e40766211de150f8b3ee7",
    "repo": "FFmpeg/FFmpeg",
    "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/7d57ca4d9a75562fa32e40766211de150f8b3ee7",
    "files": [
      "libavformat/rtmppkt.c"
    ],
    "message": "avformat/rtmppkt: Check for packet size mismatches\n\nFixes out of array access\n\nFound-by: Paul Cher <paulcher@icloud.com>\nReviewed-by: Paul Cher <paulcher@icloud.com>\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
    "before_after_code_files": [
      "libavformat/rtmppkt.c||libavformat/rtmppkt.c"
    ]
  },
  "patch_diff": {
    "libavformat/rtmppkt.c||libavformat/rtmppkt.c": [
      "File: libavformat/rtmppkt.c -> libavformat/rtmppkt.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "235:     if (hdr != RTMP_PS_TWELVEBYTES)",
      "236:         timestamp += prev_pkt[channel_id].timestamp;",
      "238:     if (!prev_pkt[channel_id].read) {",
      "239:         if ((ret = ff_rtmp_packet_create(p, channel_id, type, timestamp,",
      "240:                                          size)) < 0)",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "238:     if (prev_pkt[channel_id].read && size != prev_pkt[channel_id].size) {",
      "239:         av_log(NULL, AV_LOG_ERROR, \"RTMP packet size mismatch %d != %d\\n\",",
      "240:                 size,",
      "241:                 prev_pkt[channel_id].size);",
      "242:         ff_rtmp_packet_destroy(&prev_pkt[channel_id]);",
      "243:         prev_pkt[channel_id].read = 0;",
      "244:     }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "4c5ebe4b014a208b8c8f52d61c4fb42b98d60e67",
      "candidate_info": {
        "commit_hash": "4c5ebe4b014a208b8c8f52d61c4fb42b98d60e67",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/4c5ebe4b014a208b8c8f52d61c4fb42b98d60e67",
        "files": [
          "libavformat/rtmppkt.c"
        ],
        "message": "avformat/rtmppkt: Check for packet size mismatches\n\nFixes out of array access\n\nFound-by: Paul Cher <paulcher@icloud.com>\nReviewed-by: Paul Cher <paulcher@icloud.com>\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>\n(cherry picked from commit 7d57ca4d9a75562fa32e40766211de150f8b3ee7)\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
        "before_after_code_files": [
          "libavformat/rtmppkt.c||libavformat/rtmppkt.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavformat/rtmppkt.c||libavformat/rtmppkt.c"
          ],
          "candidate": [
            "libavformat/rtmppkt.c||libavformat/rtmppkt.c"
          ]
        }
      },
      "candidate_diff": {
        "libavformat/rtmppkt.c||libavformat/rtmppkt.c": [
          "File: libavformat/rtmppkt.c -> libavformat/rtmppkt.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "235:     if (hdr != RTMP_PS_TWELVEBYTES)",
          "236:         timestamp += prev_pkt[channel_id].timestamp;",
          "238:     if (!prev_pkt[channel_id].read) {",
          "239:         if ((ret = ff_rtmp_packet_create(p, channel_id, type, timestamp,",
          "240:                                          size)) < 0)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "238:     if (prev_pkt[channel_id].read && size != prev_pkt[channel_id].size) {",
          "239:         av_log(NULL, AV_LOG_ERROR, \"RTMP packet size mismatch %d != %d\\n\",",
          "240:                 size,",
          "241:                 prev_pkt[channel_id].size);",
          "242:         ff_rtmp_packet_destroy(&prev_pkt[channel_id]);",
          "243:         prev_pkt[channel_id].read = 0;",
          "244:     }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "a5513ae7bc7cb131e7b7edba57e4cf93121d6c8e",
      "candidate_info": {
        "commit_hash": "a5513ae7bc7cb131e7b7edba57e4cf93121d6c8e",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/a5513ae7bc7cb131e7b7edba57e4cf93121d6c8e",
        "files": [
          "libavformat/rtmppkt.c"
        ],
        "message": "avformat/rtmppkt: Check for packet size mismatches\n\nFixes out of array access\n\nFound-by: Paul Cher <paulcher@icloud.com>\nReviewed-by: Paul Cher <paulcher@icloud.com>\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>\n(cherry picked from commit 7d57ca4d9a75562fa32e40766211de150f8b3ee7)\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
        "before_after_code_files": [
          "libavformat/rtmppkt.c||libavformat/rtmppkt.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "diff_branch_olp_changes": 1,
        "olp_code_files": {
          "patch": [
            "libavformat/rtmppkt.c||libavformat/rtmppkt.c"
          ],
          "candidate": [
            "libavformat/rtmppkt.c||libavformat/rtmppkt.c"
          ]
        }
      },
      "candidate_diff": {
        "libavformat/rtmppkt.c||libavformat/rtmppkt.c": [
          "File: libavformat/rtmppkt.c -> libavformat/rtmppkt.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "235:     if (hdr != RTMP_PS_TWELVEBYTES)",
          "236:         timestamp += prev_pkt[channel_id].timestamp;",
          "238:     if (!prev_pkt[channel_id].read) {",
          "239:         if ((ret = ff_rtmp_packet_create(p, channel_id, type, timestamp,",
          "240:                                          size)) < 0)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "238:     if (prev_pkt[channel_id].read && size != prev_pkt[channel_id].size) {",
          "239:         av_log(NULL, AV_LOG_ERROR, \"RTMP packet size mismatch %d != %d\\n\",",
          "240:                 size,",
          "241:                 prev_pkt[channel_id].size);",
          "242:         ff_rtmp_packet_destroy(&prev_pkt[channel_id]);",
          "243:         prev_pkt[channel_id].read = 0;",
          "244:     }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "5bfb0b02b6fbb38c058659dc09c01602d0d1f523",
      "candidate_info": {
        "commit_hash": "5bfb0b02b6fbb38c058659dc09c01602d0d1f523",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/5bfb0b02b6fbb38c058659dc09c01602d0d1f523",
        "files": [
          "libavformat/rtmppkt.c"
        ],
        "message": "avformat/rtmppkt: Check for packet size mismatches\n\nFixes out of array access\n\nFound-by: Paul Cher <paulcher@icloud.com>\nReviewed-by: Paul Cher <paulcher@icloud.com>\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>\n(cherry picked from commit 7d57ca4d9a75562fa32e40766211de150f8b3ee7)\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
        "before_after_code_files": [
          "libavformat/rtmppkt.c||libavformat/rtmppkt.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "diff_branch_olp_changes": 1,
        "olp_code_files": {
          "patch": [
            "libavformat/rtmppkt.c||libavformat/rtmppkt.c"
          ],
          "candidate": [
            "libavformat/rtmppkt.c||libavformat/rtmppkt.c"
          ]
        }
      },
      "candidate_diff": {
        "libavformat/rtmppkt.c||libavformat/rtmppkt.c": [
          "File: libavformat/rtmppkt.c -> libavformat/rtmppkt.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "235:     if (hdr != RTMP_PS_TWELVEBYTES)",
          "236:         timestamp += prev_pkt[channel_id].timestamp;",
          "238:     if (!prev_pkt[channel_id].read) {",
          "239:         if ((ret = ff_rtmp_packet_create(p, channel_id, type, timestamp,",
          "240:                                          size)) < 0)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "238:     if (prev_pkt[channel_id].read && size != prev_pkt[channel_id].size) {",
          "239:         av_log(NULL, AV_LOG_ERROR, \"RTMP packet size mismatch %d != %d\\n\",",
          "240:                 size,",
          "241:                 prev_pkt[channel_id].size);",
          "242:         ff_rtmp_packet_destroy(&prev_pkt[channel_id]);",
          "243:         prev_pkt[channel_id].read = 0;",
          "244:     }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "32b95471a86ae383c0f76361d954aec511f7043a",
      "candidate_info": {
        "commit_hash": "32b95471a86ae383c0f76361d954aec511f7043a",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/32b95471a86ae383c0f76361d954aec511f7043a",
        "files": [
          "libavformat/rtmppkt.c"
        ],
        "message": "avformat/rtmppkt: Check for packet size mismatches\n\nFixes out of array access\n\nFound-by: Paul Cher <paulcher@icloud.com>\nReviewed-by: Paul Cher <paulcher@icloud.com>\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>\n(cherry picked from commit 7d57ca4d9a75562fa32e40766211de150f8b3ee7)\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
        "before_after_code_files": [
          "libavformat/rtmppkt.c||libavformat/rtmppkt.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "diff_branch_olp_changes": 1,
        "olp_code_files": {
          "patch": [
            "libavformat/rtmppkt.c||libavformat/rtmppkt.c"
          ],
          "candidate": [
            "libavformat/rtmppkt.c||libavformat/rtmppkt.c"
          ]
        }
      },
      "candidate_diff": {
        "libavformat/rtmppkt.c||libavformat/rtmppkt.c": [
          "File: libavformat/rtmppkt.c -> libavformat/rtmppkt.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "235:     if (hdr != RTMP_PS_TWELVEBYTES)",
          "236:         timestamp += prev_pkt[channel_id].timestamp;",
          "238:     if (!prev_pkt[channel_id].read) {",
          "239:         if ((ret = ff_rtmp_packet_create(p, channel_id, type, timestamp,",
          "240:                                          size)) < 0)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "238:     if (prev_pkt[channel_id].read && size != prev_pkt[channel_id].size) {",
          "239:         av_log(NULL, AV_LOG_ERROR, \"RTMP packet size mismatch %d != %d\\n\",",
          "240:                 size,",
          "241:                 prev_pkt[channel_id].size);",
          "242:         ff_rtmp_packet_destroy(&prev_pkt[channel_id]);",
          "243:         prev_pkt[channel_id].read = 0;",
          "244:     }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "b0ebef0578fd88fe3efd66086c43a5b43fbc9f6a",
      "candidate_info": {
        "commit_hash": "b0ebef0578fd88fe3efd66086c43a5b43fbc9f6a",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/b0ebef0578fd88fe3efd66086c43a5b43fbc9f6a",
        "files": [
          "libavformat/rtmppkt.c"
        ],
        "message": "avformat/rtmppkt: Check for packet size mismatches\n\nFixes out of array access\n\nFound-by: Paul Cher <paulcher@icloud.com>\nReviewed-by: Paul Cher <paulcher@icloud.com>\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>\n(cherry picked from commit 7d57ca4d9a75562fa32e40766211de150f8b3ee7)\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
        "before_after_code_files": [
          "libavformat/rtmppkt.c||libavformat/rtmppkt.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "diff_branch_olp_changes": 1,
        "olp_code_files": {
          "patch": [
            "libavformat/rtmppkt.c||libavformat/rtmppkt.c"
          ],
          "candidate": [
            "libavformat/rtmppkt.c||libavformat/rtmppkt.c"
          ]
        }
      },
      "candidate_diff": {
        "libavformat/rtmppkt.c||libavformat/rtmppkt.c": [
          "File: libavformat/rtmppkt.c -> libavformat/rtmppkt.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "235:     if (hdr != RTMP_PS_TWELVEBYTES)",
          "236:         timestamp += prev_pkt[channel_id].timestamp;",
          "238:     if (!prev_pkt[channel_id].read) {",
          "239:         if ((ret = ff_rtmp_packet_create(p, channel_id, type, timestamp,",
          "240:                                          size)) < 0)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "238:     if (prev_pkt[channel_id].read && size != prev_pkt[channel_id].size) {",
          "239:         av_log(NULL, AV_LOG_ERROR, \"RTMP packet size mismatch %d != %d\\n\",",
          "240:                 size,",
          "241:                 prev_pkt[channel_id].size);",
          "242:         ff_rtmp_packet_destroy(&prev_pkt[channel_id]);",
          "243:         prev_pkt[channel_id].read = 0;",
          "244:     }",
          "",
          "---------------"
        ]
      }
    }
  ]
}