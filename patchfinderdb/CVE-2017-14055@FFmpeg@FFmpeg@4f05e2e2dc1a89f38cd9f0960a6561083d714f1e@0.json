{
  "cve_id": "CVE-2017-14055",
  "cve_desc": "In libavformat/mvdec.c in FFmpeg 3.3.3, a DoS in mv_read_header() due to lack of an EOF (End of File) check might cause huge CPU and memory consumption. When a crafted MV file, which claims a large \"nb_frames\" field in the header but does not contain sufficient backing data, is provided, the loop over the frames would consume huge CPU and memory resources, since there is no EOF check inside the loop.",
  "repo": "FFmpeg/FFmpeg",
  "patch_hash": "4f05e2e2dc1a89f38cd9f0960a6561083d714f1e",
  "patch_info": {
    "commit_hash": "4f05e2e2dc1a89f38cd9f0960a6561083d714f1e",
    "repo": "FFmpeg/FFmpeg",
    "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/4f05e2e2dc1a89f38cd9f0960a6561083d714f1e",
    "files": [
      "libavformat/mvdec.c"
    ],
    "message": "avformat/mvdec: Fix DoS due to lack of eof check\n\nFixes: loop.mv\n\nFound-by: Xiaohei and Wangchu from Alibaba Security Team\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
    "before_after_code_files": [
      "libavformat/mvdec.c||libavformat/mvdec.c"
    ]
  },
  "patch_diff": {
    "libavformat/mvdec.c||libavformat/mvdec.c": [
      "File: libavformat/mvdec.c -> libavformat/mvdec.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "342:             uint32_t pos   = avio_rb32(pb);",
      "343:             uint32_t asize = avio_rb32(pb);",
      "344:             uint32_t vsize = avio_rb32(pb);",
      "345:             avio_skip(pb, 8);",
      "346:             av_add_index_entry(ast, pos, timestamp, asize, 0, AVINDEX_KEYFRAME);",
      "347:             av_add_index_entry(vst, pos + asize, i, vsize, 0, AVINDEX_KEYFRAME);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "345:             if (avio_feof(pb))",
      "346:                 return AVERROR_INVALIDDATA;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "d4fc6b211f19365fbae4b4388ec396b293fda249",
      "candidate_info": {
        "commit_hash": "d4fc6b211f19365fbae4b4388ec396b293fda249",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/d4fc6b211f19365fbae4b4388ec396b293fda249",
        "files": [
          "libavformat/mvdec.c"
        ],
        "message": "avformat/mvdec: Fix DoS due to lack of eof check\n\nFixes: loop.mv\n\nFound-by: Xiaohei and Wangchu from Alibaba Security Team\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>\n(cherry picked from commit 4f05e2e2dc1a89f38cd9f0960a6561083d714f1e)\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
        "before_after_code_files": [
          "libavformat/mvdec.c||libavformat/mvdec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavformat/mvdec.c||libavformat/mvdec.c"
          ],
          "candidate": [
            "libavformat/mvdec.c||libavformat/mvdec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavformat/mvdec.c||libavformat/mvdec.c": [
          "File: libavformat/mvdec.c -> libavformat/mvdec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "338:             uint32_t pos   = avio_rb32(pb);",
          "339:             uint32_t asize = avio_rb32(pb);",
          "340:             uint32_t vsize = avio_rb32(pb);",
          "341:             avio_skip(pb, 8);",
          "342:             av_add_index_entry(ast, pos, timestamp, asize, 0, AVINDEX_KEYFRAME);",
          "343:             av_add_index_entry(vst, pos + asize, i, vsize, 0, AVINDEX_KEYFRAME);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "341:             if (avio_feof(pb))",
          "342:                 return AVERROR_INVALIDDATA;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "6b004e23d7fcdd3c69717bc12e6dcc070ab563b2",
      "candidate_info": {
        "commit_hash": "6b004e23d7fcdd3c69717bc12e6dcc070ab563b2",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/6b004e23d7fcdd3c69717bc12e6dcc070ab563b2",
        "files": [
          "libavformat/mvdec.c"
        ],
        "message": "avformat/mvdec: Fix DoS due to lack of eof check\n\nFixes: loop.mv\n\nFound-by: Xiaohei and Wangchu from Alibaba Security Team\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>\n(cherry picked from commit 4f05e2e2dc1a89f38cd9f0960a6561083d714f1e)\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
        "before_after_code_files": [
          "libavformat/mvdec.c||libavformat/mvdec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavformat/mvdec.c||libavformat/mvdec.c"
          ],
          "candidate": [
            "libavformat/mvdec.c||libavformat/mvdec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavformat/mvdec.c||libavformat/mvdec.c": [
          "File: libavformat/mvdec.c -> libavformat/mvdec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "338:             uint32_t pos   = avio_rb32(pb);",
          "339:             uint32_t asize = avio_rb32(pb);",
          "340:             uint32_t vsize = avio_rb32(pb);",
          "341:             avio_skip(pb, 8);",
          "342:             av_add_index_entry(ast, pos, timestamp, asize, 0, AVINDEX_KEYFRAME);",
          "343:             av_add_index_entry(vst, pos + asize, i, vsize, 0, AVINDEX_KEYFRAME);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "341:             if (avio_feof(pb))",
          "342:                 return AVERROR_INVALIDDATA;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "9a73a776816b359cc5befe2ddaa7edef22c4f353",
      "candidate_info": {
        "commit_hash": "9a73a776816b359cc5befe2ddaa7edef22c4f353",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/9a73a776816b359cc5befe2ddaa7edef22c4f353",
        "files": [
          "libavformat/mvdec.c"
        ],
        "message": "avformat/mvdec: Fix DoS due to lack of eof check\n\nFixes: loop.mv\n\nFound-by: Xiaohei and Wangchu from Alibaba Security Team\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>\n(cherry picked from commit 4f05e2e2dc1a89f38cd9f0960a6561083d714f1e)\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
        "before_after_code_files": [
          "libavformat/mvdec.c||libavformat/mvdec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavformat/mvdec.c||libavformat/mvdec.c"
          ],
          "candidate": [
            "libavformat/mvdec.c||libavformat/mvdec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavformat/mvdec.c||libavformat/mvdec.c": [
          "File: libavformat/mvdec.c -> libavformat/mvdec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "338:             uint32_t pos   = avio_rb32(pb);",
          "339:             uint32_t asize = avio_rb32(pb);",
          "340:             uint32_t vsize = avio_rb32(pb);",
          "341:             avio_skip(pb, 8);",
          "342:             av_add_index_entry(ast, pos, timestamp, asize, 0, AVINDEX_KEYFRAME);",
          "343:             av_add_index_entry(vst, pos + asize, i, vsize, 0, AVINDEX_KEYFRAME);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "341:             if (avio_feof(pb))",
          "342:                 return AVERROR_INVALIDDATA;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "28c08ab9434b839f19e8c12668bacd6361beba80",
      "candidate_info": {
        "commit_hash": "28c08ab9434b839f19e8c12668bacd6361beba80",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/28c08ab9434b839f19e8c12668bacd6361beba80",
        "files": [
          "libavformat/mvdec.c"
        ],
        "message": "avformat/mvdec: Fix DoS due to lack of eof check\n\nFixes: loop.mv\n\nFound-by: Xiaohei and Wangchu from Alibaba Security Team\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>\n(cherry picked from commit 4f05e2e2dc1a89f38cd9f0960a6561083d714f1e)\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
        "before_after_code_files": [
          "libavformat/mvdec.c||libavformat/mvdec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavformat/mvdec.c||libavformat/mvdec.c"
          ],
          "candidate": [
            "libavformat/mvdec.c||libavformat/mvdec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavformat/mvdec.c||libavformat/mvdec.c": [
          "File: libavformat/mvdec.c -> libavformat/mvdec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "338:             uint32_t pos   = avio_rb32(pb);",
          "339:             uint32_t asize = avio_rb32(pb);",
          "340:             uint32_t vsize = avio_rb32(pb);",
          "341:             avio_skip(pb, 8);",
          "342:             av_add_index_entry(ast, pos, timestamp, asize, 0, AVINDEX_KEYFRAME);",
          "343:             av_add_index_entry(vst, pos + asize, i, vsize, 0, AVINDEX_KEYFRAME);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "341:             if (avio_feof(pb))",
          "342:                 return AVERROR_INVALIDDATA;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "e910f15fcbb709c4c7208737a6cc39185b41543b",
      "candidate_info": {
        "commit_hash": "e910f15fcbb709c4c7208737a6cc39185b41543b",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/e910f15fcbb709c4c7208737a6cc39185b41543b",
        "files": [
          "libavformat/mvdec.c"
        ],
        "message": "avformat/mvdec: Fix DoS due to lack of eof check\n\nFixes: loop.mv\n\nFound-by: Xiaohei and Wangchu from Alibaba Security Team\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>\n(cherry picked from commit 4f05e2e2dc1a89f38cd9f0960a6561083d714f1e)\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
        "before_after_code_files": [
          "libavformat/mvdec.c||libavformat/mvdec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavformat/mvdec.c||libavformat/mvdec.c"
          ],
          "candidate": [
            "libavformat/mvdec.c||libavformat/mvdec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavformat/mvdec.c||libavformat/mvdec.c": [
          "File: libavformat/mvdec.c -> libavformat/mvdec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "342:             uint32_t pos   = avio_rb32(pb);",
          "343:             uint32_t asize = avio_rb32(pb);",
          "344:             uint32_t vsize = avio_rb32(pb);",
          "345:             avio_skip(pb, 8);",
          "346:             av_add_index_entry(ast, pos, timestamp, asize, 0, AVINDEX_KEYFRAME);",
          "347:             av_add_index_entry(vst, pos + asize, i, vsize, 0, AVINDEX_KEYFRAME);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "345:             if (avio_feof(pb))",
          "346:                 return AVERROR_INVALIDDATA;",
          "",
          "---------------"
        ]
      }
    }
  ]
}