{
  "cve_id": "CVE-2014-7937",
  "cve_desc": "Multiple off-by-one errors in libavcodec/vorbisdec.c in FFmpeg before 2.4.2, as used in Google Chrome before 40.0.2214.91, allow remote attackers to cause a denial of service (use-after-free) or possibly have unspecified other impact via crafted Vorbis I data.",
  "repo": "FFmpeg/FFmpeg",
  "patch_hash": "8c50704ebf1777bee76772c4835d9760b3721057",
  "patch_info": {
    "commit_hash": "8c50704ebf1777bee76772c4835d9760b3721057",
    "repo": "FFmpeg/FFmpeg",
    "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/8c50704ebf1777bee76772c4835d9760b3721057",
    "files": [
      "libavcodec/vorbisdec.c"
    ],
    "message": "avcodec/vorbisdec: Fix off by 1 error in ptns_to_read\n\nFixes read of uninitialized memory\nFixes: asan_heap-uaf_18dac2b_9_asan_heap-uaf_22eb375_208_beta3_test_small.ogg\n\nFound-by: Mateusz \"j00ru\" Jurczyk and Gynvael Coldwind\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>",
    "before_after_code_files": [
      "libavcodec/vorbisdec.c||libavcodec/vorbisdec.c"
    ]
  },
  "patch_diff": {
    "libavcodec/vorbisdec.c||libavcodec/vorbisdec.c": [
      "File: libavcodec/vorbisdec.c -> libavcodec/vorbisdec.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1314:                                            vorbis_residue *vr,",
      "1315:                                            uint8_t *do_not_decode,",
      "1316:                                            unsigned ch_used,",
      "1318: {",
      "1319:     int p, j, i;",
      "1320:     unsigned c_p_c         = vc->codebooks[vr->classbook].dimensions;",
      "",
      "[Removed Lines]",
      "1317:                                            int partition_count)",
      "",
      "[Added Lines]",
      "1317:                                            int partition_count,",
      "1318:                                            int ptns_to_read",
      "1319:                                           )",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "1336:                 for (i = partition_count + c_p_c - 1; i >= partition_count; i--) {",
      "1337:                     temp2 = (((uint64_t)temp) * inverse_class) >> 32;",
      "1340:                         vr->classifs[p + i] = temp - temp2 * vr->classifications;",
      "1341:                     temp = temp2;",
      "1342:                 }",
      "",
      "[Removed Lines]",
      "1339:                     if (i < vr->ptns_to_read)",
      "",
      "[Added Lines]",
      "1341:                     if (i < ptns_to_read)",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "1344:                 for (i = partition_count + c_p_c - 1; i >= partition_count; i--) {",
      "1345:                     temp2 = temp / vr->classifications;",
      "1348:                         vr->classifs[p + i] = temp - temp2 * vr->classifications;",
      "1349:                     temp = temp2;",
      "1350:                 }",
      "1351:             }",
      "1352:         }",
      "1354:     }",
      "1355:     return 0;",
      "1356: }",
      "",
      "[Removed Lines]",
      "1347:                     if (i < vr->ptns_to_read)",
      "1353:         p += vr->ptns_to_read;",
      "",
      "[Added Lines]",
      "1349:                     if (i < ptns_to_read)",
      "1355:         p += ptns_to_read;",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "1404:         for (partition_count = 0; partition_count < ptns_to_read;) {  // SPEC        error",
      "1405:             if (!pass) {",
      "1406:                 int ret;",
      "1408:                     return ret;",
      "1409:             }",
      "1410:             for (i = 0; (i < c_p_c) && (partition_count < ptns_to_read); ++i) {",
      "",
      "[Removed Lines]",
      "1407:                 if ((ret = setup_classifs(vc, vr, do_not_decode, ch_used, partition_count)) < 0)",
      "",
      "[Added Lines]",
      "1409:                 if ((ret = setup_classifs(vc, vr, do_not_decode, ch_used, partition_count, ptns_to_read)) < 0)",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "eefc3ca7bed6c389e2c78c4244ee2a41d25b8963",
      "candidate_info": {
        "commit_hash": "eefc3ca7bed6c389e2c78c4244ee2a41d25b8963",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/eefc3ca7bed6c389e2c78c4244ee2a41d25b8963",
        "files": [
          "libavcodec/vorbisdec.c"
        ],
        "message": "avcodec/vorbisdec: Fix off by 1 error in ptns_to_read\n\nFixes read of uninitialized memory\nFixes: asan_heap-uaf_18dac2b_9_asan_heap-uaf_22eb375_208_beta3_test_small.ogg\n\nFound-by: Mateusz \"j00ru\" Jurczyk and Gynvael Coldwind\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>\n(cherry picked from commit 8c50704ebf1777bee76772c4835d9760b3721057)\n\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>",
        "before_after_code_files": [
          "libavcodec/vorbisdec.c||libavcodec/vorbisdec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavcodec/vorbisdec.c||libavcodec/vorbisdec.c"
          ],
          "candidate": [
            "libavcodec/vorbisdec.c||libavcodec/vorbisdec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavcodec/vorbisdec.c||libavcodec/vorbisdec.c": [
          "File: libavcodec/vorbisdec.c -> libavcodec/vorbisdec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1314:                                            vorbis_residue *vr,",
          "1315:                                            uint8_t *do_not_decode,",
          "1316:                                            unsigned ch_used,",
          "1318: {",
          "1319:     int p, j, i;",
          "1320:     unsigned c_p_c         = vc->codebooks[vr->classbook].dimensions;",
          "",
          "[Removed Lines]",
          "1317:                                            int partition_count)",
          "",
          "[Added Lines]",
          "1317:                                            int partition_count,",
          "1318:                                            int ptns_to_read",
          "1319:                                           )",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1336:                 for (i = partition_count + c_p_c - 1; i >= partition_count; i--) {",
          "1337:                     temp2 = (((uint64_t)temp) * inverse_class) >> 32;",
          "1340:                         vr->classifs[p + i] = temp - temp2 * vr->classifications;",
          "1341:                     temp = temp2;",
          "1342:                 }",
          "",
          "[Removed Lines]",
          "1339:                     if (i < vr->ptns_to_read)",
          "",
          "[Added Lines]",
          "1341:                     if (i < ptns_to_read)",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1344:                 for (i = partition_count + c_p_c - 1; i >= partition_count; i--) {",
          "1345:                     temp2 = temp / vr->classifications;",
          "1348:                         vr->classifs[p + i] = temp - temp2 * vr->classifications;",
          "1349:                     temp = temp2;",
          "1350:                 }",
          "1351:             }",
          "1352:         }",
          "1354:     }",
          "1355:     return 0;",
          "1356: }",
          "",
          "[Removed Lines]",
          "1347:                     if (i < vr->ptns_to_read)",
          "1353:         p += vr->ptns_to_read;",
          "",
          "[Added Lines]",
          "1349:                     if (i < ptns_to_read)",
          "1355:         p += ptns_to_read;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1404:         for (partition_count = 0; partition_count < ptns_to_read;) {  // SPEC        error",
          "1405:             if (!pass) {",
          "1406:                 int ret;",
          "1408:                     return ret;",
          "1409:             }",
          "1410:             for (i = 0; (i < c_p_c) && (partition_count < ptns_to_read); ++i) {",
          "",
          "[Removed Lines]",
          "1407:                 if ((ret = setup_classifs(vc, vr, do_not_decode, ch_used, partition_count)) < 0)",
          "",
          "[Added Lines]",
          "1409:                 if ((ret = setup_classifs(vc, vr, do_not_decode, ch_used, partition_count, ptns_to_read)) < 0)",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "fdc8f4e5b4f12ba5ef2d7645d5ba628f6ddf14c9",
      "candidate_info": {
        "commit_hash": "fdc8f4e5b4f12ba5ef2d7645d5ba628f6ddf14c9",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/fdc8f4e5b4f12ba5ef2d7645d5ba628f6ddf14c9",
        "files": [
          "libavcodec/vorbisdec.c"
        ],
        "message": "avcodec/vorbisdec: Fix off by 1 error in ptns_to_read\n\nFixes read of uninitialized memory\nFixes: asan_heap-uaf_18dac2b_9_asan_heap-uaf_22eb375_208_beta3_test_small.ogg\n\nFound-by: Mateusz \"j00ru\" Jurczyk and Gynvael Coldwind\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>\n(cherry picked from commit 8c50704ebf1777bee76772c4835d9760b3721057)\n\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>",
        "before_after_code_files": [
          "libavcodec/vorbisdec.c||libavcodec/vorbisdec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavcodec/vorbisdec.c||libavcodec/vorbisdec.c"
          ],
          "candidate": [
            "libavcodec/vorbisdec.c||libavcodec/vorbisdec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavcodec/vorbisdec.c||libavcodec/vorbisdec.c": [
          "File: libavcodec/vorbisdec.c -> libavcodec/vorbisdec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1314:                                            vorbis_residue *vr,",
          "1315:                                            uint8_t *do_not_decode,",
          "1316:                                            unsigned ch_used,",
          "1318: {",
          "1319:     int p, j, i;",
          "1320:     unsigned c_p_c         = vc->codebooks[vr->classbook].dimensions;",
          "",
          "[Removed Lines]",
          "1317:                                            int partition_count)",
          "",
          "[Added Lines]",
          "1317:                                            int partition_count,",
          "1318:                                            int ptns_to_read",
          "1319:                                           )",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1336:                 for (i = partition_count + c_p_c - 1; i >= partition_count; i--) {",
          "1337:                     temp2 = (((uint64_t)temp) * inverse_class) >> 32;",
          "1340:                         vr->classifs[p + i] = temp - temp2 * vr->classifications;",
          "1341:                     temp = temp2;",
          "1342:                 }",
          "",
          "[Removed Lines]",
          "1339:                     if (i < vr->ptns_to_read)",
          "",
          "[Added Lines]",
          "1341:                     if (i < ptns_to_read)",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1344:                 for (i = partition_count + c_p_c - 1; i >= partition_count; i--) {",
          "1345:                     temp2 = temp / vr->classifications;",
          "1348:                         vr->classifs[p + i] = temp - temp2 * vr->classifications;",
          "1349:                     temp = temp2;",
          "1350:                 }",
          "1351:             }",
          "1352:         }",
          "1354:     }",
          "1355:     return 0;",
          "1356: }",
          "",
          "[Removed Lines]",
          "1347:                     if (i < vr->ptns_to_read)",
          "1353:         p += vr->ptns_to_read;",
          "",
          "[Added Lines]",
          "1349:                     if (i < ptns_to_read)",
          "1355:         p += ptns_to_read;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1404:         for (partition_count = 0; partition_count < ptns_to_read;) {  // SPEC        error",
          "1405:             if (!pass) {",
          "1406:                 int ret;",
          "1408:                     return ret;",
          "1409:             }",
          "1410:             for (i = 0; (i < c_p_c) && (partition_count < ptns_to_read); ++i) {",
          "",
          "[Removed Lines]",
          "1407:                 if ((ret = setup_classifs(vc, vr, do_not_decode, ch_used, partition_count)) < 0)",
          "",
          "[Added Lines]",
          "1409:                 if ((ret = setup_classifs(vc, vr, do_not_decode, ch_used, partition_count, ptns_to_read)) < 0)",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "653329dfcb43f8190355be7b8cfdca45eb8c599c",
      "candidate_info": {
        "commit_hash": "653329dfcb43f8190355be7b8cfdca45eb8c599c",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/653329dfcb43f8190355be7b8cfdca45eb8c599c",
        "files": [
          "libavcodec/vorbisdec.c"
        ],
        "message": "avcodec/vorbisdec: Fix off by 1 error in ptns_to_read\n\nFixes read of uninitialized memory\nFixes: asan_heap-uaf_18dac2b_9_asan_heap-uaf_22eb375_208_beta3_test_small.ogg\n\nFound-by: Mateusz \"j00ru\" Jurczyk and Gynvael Coldwind\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>\n(cherry picked from commit 8c50704ebf1777bee76772c4835d9760b3721057)\n\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>",
        "before_after_code_files": [
          "libavcodec/vorbisdec.c||libavcodec/vorbisdec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavcodec/vorbisdec.c||libavcodec/vorbisdec.c"
          ],
          "candidate": [
            "libavcodec/vorbisdec.c||libavcodec/vorbisdec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavcodec/vorbisdec.c||libavcodec/vorbisdec.c": [
          "File: libavcodec/vorbisdec.c -> libavcodec/vorbisdec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1314:                                            vorbis_residue *vr,",
          "1315:                                            uint8_t *do_not_decode,",
          "1316:                                            unsigned ch_used,",
          "1318: {",
          "1319:     int p, j, i;",
          "1320:     unsigned c_p_c         = vc->codebooks[vr->classbook].dimensions;",
          "",
          "[Removed Lines]",
          "1317:                                            int partition_count)",
          "",
          "[Added Lines]",
          "1317:                                            int partition_count,",
          "1318:                                            int ptns_to_read",
          "1319:                                           )",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1336:                 for (i = partition_count + c_p_c - 1; i >= partition_count; i--) {",
          "1337:                     temp2 = (((uint64_t)temp) * inverse_class) >> 32;",
          "1340:                         vr->classifs[p + i] = temp - temp2 * vr->classifications;",
          "1341:                     temp = temp2;",
          "1342:                 }",
          "",
          "[Removed Lines]",
          "1339:                     if (i < vr->ptns_to_read)",
          "",
          "[Added Lines]",
          "1341:                     if (i < ptns_to_read)",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1344:                 for (i = partition_count + c_p_c - 1; i >= partition_count; i--) {",
          "1345:                     temp2 = temp / vr->classifications;",
          "1348:                         vr->classifs[p + i] = temp - temp2 * vr->classifications;",
          "1349:                     temp = temp2;",
          "1350:                 }",
          "1351:             }",
          "1352:         }",
          "1354:     }",
          "1355:     return 0;",
          "1356: }",
          "",
          "[Removed Lines]",
          "1347:                     if (i < vr->ptns_to_read)",
          "1353:         p += vr->ptns_to_read;",
          "",
          "[Added Lines]",
          "1349:                     if (i < ptns_to_read)",
          "1355:         p += ptns_to_read;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1404:         for (partition_count = 0; partition_count < ptns_to_read;) {  // SPEC        error",
          "1405:             if (!pass) {",
          "1406:                 int ret;",
          "1408:                     return ret;",
          "1409:             }",
          "1410:             for (i = 0; (i < c_p_c) && (partition_count < ptns_to_read); ++i) {",
          "",
          "[Removed Lines]",
          "1407:                 if ((ret = setup_classifs(vc, vr, do_not_decode, ch_used, partition_count)) < 0)",
          "",
          "[Added Lines]",
          "1409:                 if ((ret = setup_classifs(vc, vr, do_not_decode, ch_used, partition_count, ptns_to_read)) < 0)",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "21808e2181800dabaadca695157ae8e391d6a2aa",
      "candidate_info": {
        "commit_hash": "21808e2181800dabaadca695157ae8e391d6a2aa",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/21808e2181800dabaadca695157ae8e391d6a2aa",
        "files": [
          "libavcodec/vorbisdec.c"
        ],
        "message": "avcodec/vorbisdec: Fix off by 1 error in ptns_to_read\n\nFixes read of uninitialized memory\nFixes: asan_heap-uaf_18dac2b_9_asan_heap-uaf_22eb375_208_beta3_test_small.ogg\n\nFound-by: Mateusz \"j00ru\" Jurczyk and Gynvael Coldwind\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>\n(cherry picked from commit 8c50704ebf1777bee76772c4835d9760b3721057)\n\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>",
        "before_after_code_files": [
          "libavcodec/vorbisdec.c||libavcodec/vorbisdec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavcodec/vorbisdec.c||libavcodec/vorbisdec.c"
          ],
          "candidate": [
            "libavcodec/vorbisdec.c||libavcodec/vorbisdec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavcodec/vorbisdec.c||libavcodec/vorbisdec.c": [
          "File: libavcodec/vorbisdec.c -> libavcodec/vorbisdec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1314:                                            vorbis_residue *vr,",
          "1315:                                            uint8_t *do_not_decode,",
          "1316:                                            unsigned ch_used,",
          "1318: {",
          "1319:     int p, j, i;",
          "1320:     unsigned c_p_c         = vc->codebooks[vr->classbook].dimensions;",
          "",
          "[Removed Lines]",
          "1317:                                            int partition_count)",
          "",
          "[Added Lines]",
          "1317:                                            int partition_count,",
          "1318:                                            int ptns_to_read",
          "1319:                                           )",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1336:                 for (i = partition_count + c_p_c - 1; i >= partition_count; i--) {",
          "1337:                     temp2 = (((uint64_t)temp) * inverse_class) >> 32;",
          "1340:                         vr->classifs[p + i] = temp - temp2 * vr->classifications;",
          "1341:                     temp = temp2;",
          "1342:                 }",
          "",
          "[Removed Lines]",
          "1339:                     if (i < vr->ptns_to_read)",
          "",
          "[Added Lines]",
          "1341:                     if (i < ptns_to_read)",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1344:                 for (i = partition_count + c_p_c - 1; i >= partition_count; i--) {",
          "1345:                     temp2 = temp / vr->classifications;",
          "1348:                         vr->classifs[p + i] = temp - temp2 * vr->classifications;",
          "1349:                     temp = temp2;",
          "1350:                 }",
          "1351:             }",
          "1352:         }",
          "1354:     }",
          "1355:     return 0;",
          "1356: }",
          "",
          "[Removed Lines]",
          "1347:                     if (i < vr->ptns_to_read)",
          "1353:         p += vr->ptns_to_read;",
          "",
          "[Added Lines]",
          "1349:                     if (i < ptns_to_read)",
          "1355:         p += ptns_to_read;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1404:         for (partition_count = 0; partition_count < ptns_to_read;) {  // SPEC        error",
          "1405:             if (!pass) {",
          "1406:                 int ret;",
          "1408:                     return ret;",
          "1409:             }",
          "1410:             for (i = 0; (i < c_p_c) && (partition_count < ptns_to_read); ++i) {",
          "",
          "[Removed Lines]",
          "1407:                 if ((ret = setup_classifs(vc, vr, do_not_decode, ch_used, partition_count)) < 0)",
          "",
          "[Added Lines]",
          "1409:                 if ((ret = setup_classifs(vc, vr, do_not_decode, ch_used, partition_count, ptns_to_read)) < 0)",
          "",
          "---------------"
        ]
      }
    }
  ]
}