{
  "cve_id": "CVE-2017-3730",
  "cve_desc": "In OpenSSL 1.1.0 before 1.1.0d, if a malicious server supplies bad parameters for a DHE or ECDHE key exchange then this can result in the client attempting to dereference a NULL pointer leading to a client crash. This could be exploited in a Denial of Service attack.",
  "repo": "openssl/openssl",
  "patch_hash": "efbe126e3ebb9123ac9d058aa2bb044261342aaa",
  "patch_info": {
    "commit_hash": "efbe126e3ebb9123ac9d058aa2bb044261342aaa",
    "repo": "openssl/openssl",
    "commit_url": "https://github.com/openssl/openssl/commit/efbe126e3ebb9123ac9d058aa2bb044261342aaa",
    "files": [
      "ssl/statem/statem_clnt.c"
    ],
    "message": "Fix missing NULL checks in CKE processing\n\nReviewed-by: Rich Salz <rsalz@openssl.org>",
    "before_after_code_files": [
      "ssl/statem/statem_clnt.c||ssl/statem/statem_clnt.c"
    ]
  },
  "patch_diff": {
    "ssl/statem/statem_clnt.c||ssl/statem/statem_clnt.c": [
      "File: ssl/statem/statem_clnt.c -> ssl/statem/statem_clnt.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "2258:         return 0;",
      "2259:     }",
      "2260:     ckey = ssl_generate_pkey(skey);",
      "2261:     dh_clnt = EVP_PKEY_get0_DH(ckey);",
      "2263:     if (dh_clnt == NULL || ssl_derive(s, ckey, skey) == 0) {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "2261:     if (ckey == NULL) {",
      "2262:         SSLerr(SSL_F_TLS_CONSTRUCT_CKE_DHE, ERR_R_INTERNAL_ERROR);",
      "2263:         return 0;",
      "2264:     }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "2296:     }",
      "2298:     ckey = ssl_generate_pkey(skey);",
      "2300:     if (ssl_derive(s, ckey, skey) == 0) {",
      "2301:         SSLerr(SSL_F_TLS_CONSTRUCT_CKE_ECDHE, ERR_R_EVP_LIB);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "2304:     if (ckey == NULL) {",
      "2305:         SSLerr(SSL_F_TLS_CONSTRUCT_CKE_ECDHE, ERR_R_INTERNAL_ERROR);",
      "2306:         goto err;",
      "2307:     }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "207a9cb3522882d1e9dc764c921425ba47a6def6",
      "candidate_info": {
        "commit_hash": "207a9cb3522882d1e9dc764c921425ba47a6def6",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/207a9cb3522882d1e9dc764c921425ba47a6def6",
        "files": [
          "Configurations/10-main.conf"
        ],
        "message": "VMS: tell the C compiler to use the ISO C94 standard\n\nThe current version of the VMS compiler provides C99 features,\nstrictly language wise.  Unfortunately, even the most recent standard\nlibrary isn't fully updated for that standard, so we need to use an\nearlier standard that the compiler supports.\n\nMost importantly, this affects the __STDC_VERSION__ value, which the\ncompiler unfortunately currently defaults to 199901L.  With this\nchange we won't have to give VMS special treatment when looking for\nfeatures based on that macro.\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/1785)\n(cherry picked from commit 4f3015bb30b7d95bb97408776b70e6a35fb91e8a)",
        "before_after_code_files": [
          "Configurations/10-main.conf||Configurations/10-main.conf"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "Configurations/10-main.conf||Configurations/10-main.conf": [
          "File: Configurations/10-main.conf -> Configurations/10-main.conf",
          "--- Hunk 1 ---",
          "[Context before]",
          "1742:         inherit_from     => [ \"BASE_VMS\" ],",
          "1743:         template         => 1,",
          "1744:         cc               => \"CC/DECC\",",
          "1746:                                    debug   => \"/NOOPTIMIZE/DEBUG\",",
          "1747:                                    release => \"/OPTIMIZE/NODEBUG\"),",
          "1748:         lflags           => picker(default => \"/MAP\",",
          "",
          "[Removed Lines]",
          "1745:         cflags           => picker(default => \"/STANDARD=RELAXED/NOLIST/PREFIX=ALL\",",
          "",
          "[Added Lines]",
          "1745:         cflags           => picker(default => \"/STANDARD=(ISOC94,RELAXED)/NOLIST/PREFIX=ALL\",",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "d7155335a56c2bc0d399336c46fefb497cc1131c",
      "candidate_info": {
        "commit_hash": "d7155335a56c2bc0d399336c46fefb497cc1131c",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/d7155335a56c2bc0d399336c46fefb497cc1131c",
        "files": [
          "Configurations/unix-Makefile.tmpl"
        ],
        "message": "remove test/.rnd on make clean\n\nReviewed-by: Richard Levitte <levitte@openssl.org>\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/2344)\n(cherry picked from commit 122fa088524571a3b60ebf301873f69afdac8f7a)",
        "before_after_code_files": [
          "Configurations/unix-Makefile.tmpl||Configurations/unix-Makefile.tmpl"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "Configurations/unix-Makefile.tmpl||Configurations/unix-Makefile.tmpl": [
          "File: Configurations/unix-Makefile.tmpl -> Configurations/unix-Makefile.tmpl",
          "--- Hunk 1 ---",
          "[Context before]",
          "285:  -$(RM) `find . -name '*{- $objext -}' -a \\! -path \"./.git/*\"`",
          "286:  $(RM) core",
          "287:  $(RM) tags TAGS",
          "288:  $(RM) openssl.pc libcrypto.pc libssl.pc",
          "289:  -$(RM) `find . -type l -a \\! -path \"./.git/*\"`",
          "290:  $(RM) $(TARFILE)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "288:  $(RM) test/.rnd",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "87148d30c9df95e355bb7076f3d69b2697bf6eb8",
      "candidate_info": {
        "commit_hash": "87148d30c9df95e355bb7076f3d69b2697bf6eb8",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/87148d30c9df95e355bb7076f3d69b2697bf6eb8",
        "files": [
          "crypto/aes/asm/aesni-x86_64.pl",
          "crypto/aes/asm/bsaes-x86_64.pl",
          "crypto/aes/asm/vpaes-x86_64.pl",
          "crypto/chacha/asm/chacha-x86.pl",
          "crypto/chacha/asm/chacha-x86_64.pl",
          "crypto/modes/asm/ghash-x86_64.pl",
          "crypto/poly1305/asm/poly1305-x86.pl",
          "crypto/poly1305/asm/poly1305-x86_64.pl",
          "crypto/sha/asm/sha1-x86_64.pl",
          "crypto/sha/asm/sha512-586.pl",
          "crypto/sha/asm/sha512-x86_64.pl"
        ],
        "message": "x86_64 assembly pack: add Goldmont performance results.\n\nReviewed-by: Richard Levitte <levitte@openssl.org>\n(cherry picked from commit ace05265d2d599e350cf84ed60955b7f2b173bc9)",
        "before_after_code_files": [
          "crypto/aes/asm/aesni-x86_64.pl||crypto/aes/asm/aesni-x86_64.pl",
          "crypto/aes/asm/bsaes-x86_64.pl||crypto/aes/asm/bsaes-x86_64.pl",
          "crypto/aes/asm/vpaes-x86_64.pl||crypto/aes/asm/vpaes-x86_64.pl",
          "crypto/chachasm/chacha-x86.pl||crypto/chacha/asm/chacha-x86.pl",
          "crypto/chachasm/chacha-x86_64.pl||crypto/chacha/asm/chacha-x86_64.pl",
          "crypto/modes/asm/ghash-x86_64.pl||crypto/modes/asm/ghash-x86_64.pl",
          "crypto/poly1305/asm/poly1305-x86.pl||crypto/poly1305/asm/poly1305-x86.pl",
          "crypto/poly1305/asm/poly1305-x86_64.pl||crypto/poly1305/asm/poly1305-x86_64.pl",
          "crypto/shasm/sha1-x86_64.pl||crypto/sha/asm/sha1-x86_64.pl",
          "crypto/shasm/sha512-586.pl||crypto/sha/asm/sha512-586.pl",
          "crypto/shasm/sha512-x86_64.pl||crypto/sha/asm/sha512-x86_64.pl"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "crypto/aes/asm/aesni-x86_64.pl||crypto/aes/asm/aesni-x86_64.pl": [
          "File: crypto/aes/asm/aesni-x86_64.pl -> crypto/aes/asm/aesni-x86_64.pl",
          "--- Hunk 1 ---",
          "[Context before]",
          "179: # Haswell 4.44/0.63 0.63 0.73 0.63 0.70",
          "180: # Skylake 2.62/0.63 0.63 0.63 0.63",
          "181: # Silvermont 5.75/3.54 3.56 4.12 3.87(*) 4.11",
          "182: # Bulldozer 5.77/0.70 0.72 0.90 0.70 0.95",
          "183: #",
          "184: # (*) Atom Silvermont ECB result is suboptimal because of penalties",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "182: # Goldmont 3.82/1.26 1.26 1.29 1.29 1.50",
          "",
          "---------------"
        ],
        "crypto/aes/asm/bsaes-x86_64.pl||crypto/aes/asm/bsaes-x86_64.pl": [
          "File: crypto/aes/asm/bsaes-x86_64.pl -> crypto/aes/asm/bsaes-x86_64.pl",
          "--- Hunk 1 ---",
          "[Context before]",
          "48: # Nehalem(**)  7.63  6.88  +11%",
          "49: # Atom      17.1  16.4  +4%",
          "50: # Silvermont -  12.9",
          "51: #",
          "52: # (*) Comparison is not completely fair, because \"this\" is ECB,",
          "53: # i.e. no extra processing such as counter values calculation",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "51: # Goldmont -  8.85",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "87: # Nehalem 7.80",
          "88: # Atom  17.9",
          "89: # Silvermont 14.0",
          "90: #",
          "91: # November 2011.",
          "92: #",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "91: # Goldmont 10.2",
          "",
          "---------------"
        ],
        "crypto/aes/asm/vpaes-x86_64.pl||crypto/aes/asm/vpaes-x86_64.pl": [
          "File: crypto/aes/asm/vpaes-x86_64.pl -> crypto/aes/asm/vpaes-x86_64.pl",
          "--- Hunk 1 ---",
          "[Context before]",
          "38: # Nehalem 29.6/40.3/14.6  10.0/11.8",
          "39: # Atom  57.3/74.2/32.1  60.9/77.2(***)",
          "40: # Silvermont 52.7/64.0/19.5  48.8/60.8(***)",
          "41: #",
          "42: # (*) \"Hyper-threading\" in the context refers rather to cache shared",
          "43: # among multiple cores, than to specifically Intel HTT. As vast",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "41: # Goldmont 38.9/49.0/17.8  10.6/12.6",
          "",
          "---------------"
        ],
        "crypto/chachasm/chacha-x86.pl||crypto/chacha/asm/chacha-x86.pl": [
          "File: crypto/chachasm/chacha-x86.pl -> crypto/chacha/asm/chacha-x86.pl",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "32: # Goldmont 13.4/+40% 4.36",
          "",
          "---------------"
        ],
        "crypto/chachasm/chacha-x86_64.pl||crypto/chacha/asm/chacha-x86_64.pl": [
          "File: crypto/chachasm/chacha-x86_64.pl -> crypto/chacha/asm/chacha-x86_64.pl",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "32: # Goldmont 10.6/+17% 5.10/-  3.28",
          "",
          "---------------"
        ],
        "crypto/modes/asm/ghash-x86_64.pl||crypto/modes/asm/ghash-x86_64.pl": [
          "File: crypto/modes/asm/ghash-x86_64.pl -> crypto/modes/asm/ghash-x86_64.pl",
          "--- Hunk 1 ---",
          "[Context before]",
          "74: # Skylake 0.44(+110%)(if system doesn't support AVX)",
          "75: # Bulldozer 1.49(+27%)",
          "76: # Silvermont 2.88(+13%)",
          "78: # March 2013",
          "79: #",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "77: # Goldmont 1.08(+24%)",
          "",
          "---------------"
        ],
        "crypto/poly1305/asm/poly1305-x86.pl||crypto/poly1305/asm/poly1305-x86.pl": [
          "File: crypto/poly1305/asm/poly1305-x86.pl -> crypto/poly1305/asm/poly1305-x86.pl",
          "--- Hunk 1 ---",
          "[Context before]",
          "30: # Sandy Bridge 3.90/+100% 1.36",
          "31: # Haswell 3.88/+70% 1.18  0.72",
          "32: # Silvermont 11.0/+40% 4.80",
          "33: # VIA Nano 6.71/+90% 2.47",
          "34: # Sledgehammer 3.51/+180% 4.27",
          "35: # Bulldozer 4.53/+140% 1.31",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "33: # Goldmont 4.10/+200% 2.10",
          "",
          "---------------"
        ],
        "crypto/poly1305/asm/poly1305-x86_64.pl||crypto/poly1305/asm/poly1305-x86_64.pl": [
          "File: crypto/poly1305/asm/poly1305-x86_64.pl -> crypto/poly1305/asm/poly1305-x86_64.pl",
          "--- Hunk 1 ---",
          "[Context before]",
          "29: # Haswell 1.14/+175% 1.11  0.65",
          "30: # Skylake 1.13/+120% 0.96  0.51",
          "31: # Silvermont 2.83/+95% -",
          "32: # VIA Nano 1.82/+150% -",
          "33: # Sledgehammer 1.38/+160% -",
          "34: # Bulldozer 2.30/+130% 0.97",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "32: # Goldmont 1.70/+180% -",
          "",
          "---------------"
        ],
        "crypto/shasm/sha1-x86_64.pl||crypto/sha/asm/sha1-x86_64.pl": [
          "File: crypto/shasm/sha1-x86_64.pl -> crypto/sha/asm/sha1-x86_64.pl",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "88: # Goldmont 8.13  6.42/+27% 1.70/+380%(**)",
          "92: # (**) SHAEXT result",
          "",
          "---------------"
        ],
        "crypto/shasm/sha512-586.pl||crypto/sha/asm/sha512-586.pl": [
          "File: crypto/shasm/sha512-586.pl -> crypto/sha/asm/sha512-586.pl",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "39: # Goldmont 80 - 48 19.5 12.0",
          "",
          "---------------"
        ],
        "crypto/shasm/sha512-x86_64.pl||crypto/sha/asm/sha512-x86_64.pl": [
          "File: crypto/shasm/sha512-x86_64.pl -> crypto/sha/asm/sha512-x86_64.pl",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "101: # Goldmont 18.9 14.3(+32%)  4.16(+350%)     12.0    -",
          "103: # (*) whichever best applicable, including SHAEXT;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "b5cd178f9dd057a76147ccd307bd3cb0672ac098",
      "candidate_info": {
        "commit_hash": "b5cd178f9dd057a76147ccd307bd3cb0672ac098",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/b5cd178f9dd057a76147ccd307bd3cb0672ac098",
        "files": [
          "crypto/ec/eck_prn.c"
        ],
        "message": "Increase the size of the stack buffer to prevent an overflow.\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\nReviewed-by: Andy Polyakov <appro@openssl.org>\nReviewed-by: Richard Levitte <levitte@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/2721)\n(cherry picked from commit 8fce04ee3540ba3039bb66df34ea3f076a599ab9)",
        "before_after_code_files": [
          "crypto/ec/eck_prn.c||crypto/ec/eck_prn.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "crypto/ec/eck_prn.c||crypto/ec/eck_prn.c": [
          "File: crypto/ec/eck_prn.c -> crypto/ec/eck_prn.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "238:                      size_t len, int off)",
          "239: {",
          "240:     size_t i;",
          "243:     if (buf == NULL)",
          "244:         return 1;",
          "",
          "[Removed Lines]",
          "241:     char str[128];",
          "",
          "[Added Lines]",
          "241:     char str[128 + 1 + 4];",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "edc18749bd5dfb7e12513d3978f78f9b56104fd6",
      "candidate_info": {
        "commit_hash": "edc18749bd5dfb7e12513d3978f78f9b56104fd6",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/edc18749bd5dfb7e12513d3978f78f9b56104fd6",
        "files": [
          "crypto/threads_win.c"
        ],
        "message": "Fixed deadlock in CRYPTO_THREAD_run_once for Windows\n\nFixed deadlock in CRYPTO_THREAD_run_once() if call to init() is causing\na recursive call to CRYPTO_THREAD_run_once() again that is causing a hot\ndeadloop inside do { } while (result == ONCE_ININIT); section.\n\nCLA: trivial\nReviewed-by: Richard Levitte <levitte@openssl.org>\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/1913)\n\n(cherry picked from commit 349d1cfddcfa33d352240582a3803f2eba39d9a0)",
        "before_after_code_files": [
          "crypto/threads_win.c||crypto/threads_win.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "crypto/threads_win.c||crypto/threads_win.c": [
          "File: crypto/threads_win.c -> crypto/threads_win.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "78:     do {",
          "79:         result = InterlockedCompareExchange(lock, ONCE_ININIT, ONCE_UNINITED);",
          "80:         if (result == ONCE_UNINITED) {",
          "83:             return 1;",
          "84:         }",
          "85:     } while (result == ONCE_ININIT);",
          "",
          "[Removed Lines]",
          "81:             init();",
          "",
          "[Added Lines]",
          "82:             init();",
          "",
          "---------------"
        ]
      }
    }
  ]
}