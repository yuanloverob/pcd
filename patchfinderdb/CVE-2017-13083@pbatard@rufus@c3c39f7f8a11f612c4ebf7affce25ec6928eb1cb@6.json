{
  "cve_id": "CVE-2017-13083",
  "cve_desc": "Akeo Consulting Rufus prior to version 2.17.1187 does not adequately validate the integrity of updates downloaded over HTTP, allowing an attacker to easily convince a user to execute arbitrary code",
  "repo": "pbatard/rufus",
  "patch_hash": "c3c39f7f8a11f612c4ebf7affce25ec6928eb1cb",
  "patch_info": {
    "commit_hash": "c3c39f7f8a11f612c4ebf7affce25ec6928eb1cb",
    "repo": "pbatard/rufus",
    "commit_url": "https://github.com/pbatard/rufus/commit/c3c39f7f8a11f612c4ebf7affce25ec6928eb1cb",
    "files": [
      "res/localization/rufus.loc",
      "src/pki.c",
      "src/rufus.rc",
      "src/stdlg.c"
    ],
    "message": "[pki] fix https://www.kb.cert.org/vuls/id/403768\n\n* This commit effectively fixes https://www.kb.cert.org/vuls/id/403768 (CVE-2017-13083) as\n  it is described per its revision 11, which is the latest revision at the time of this commit,\n  by disabling Windows prompts, enacted during signature validation, that allow the user to\n  bypass the intended signature verification checks.\n* It needs to be pointed out that the vulnerability (\"allow(ing) the use of a self-signed\n  certificate\"), which relies on the end-user actively ignoring a Windows prompt that tells\n  them that the update failed the signature validation whilst also advising against running it,\n  is being fully addressed, even as the update protocol remains HTTP.\n* It also need to be pointed out that the extended delay (48 hours) between the time the\n  vulnerability was reported and the moment it is fixed in our codebase has to do with\n  the fact that the reporter chose to deviate from standard security practices by not\n  disclosing the details of the vulnerability with us, be it publicly or privately,\n  before creating the cert.org report. The only advance notification we received was a\n  generic note about the use of HTTP vs HTTPS, which, as have established, is not\n  immediately relevant to addressing the reported vulnerability.\n* Closes #1009\n* Note: The other vulnerability scenario described towards the end of #1009, which\n  doesn't have to do with the \"lack of CA checking\", will be addressed separately.",
    "before_after_code_files": [
      "res/localization/rufus.loc||res/localization/rufus.loc",
      "src/pki.c||src/pki.c",
      "src/rufus.rc||src/rufus.rc",
      "src/stdlg.c||src/stdlg.c"
    ]
  },
  "patch_diff": {
    "res/localization/rufus.loc||res/localization/rufus.loc": [
      "File: res/localization/rufus.loc -> res/localization/rufus.loc",
      "--- Hunk 1 ---",
      "[Context before]",
      "487: # eg. \"Partitioning (MBR)...\"",
      "488: t MSG_238 \"Partitioning (%s)...\"",
      "489: t MSG_239 \"Deleting partitions...\"",
      "490: t MSG_241 \"Downloading: %0.1f%%\"",
      "491: t MSG_242 \"Failed to download file.\"",
      "492: t MSG_243 \"Checking for Rufus updates...\"",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "490: t MSG_240 \"The signature for the downloaded update can not be validated. This could mean that your \"",
      "491:  \"system is improperly configured for signature validation or indicate a malicious download.\\n\\n\"",
      "492:  \"The download will be deleted. Please check the log for more details.\"",
      "",
      "---------------"
    ],
    "src/pki.c||src/pki.c": [
      "File: src/pki.c -> src/pki.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "53:  static char error_string[64];",
      "54:  DWORD error_code = GetLastError();",
      "57:   return WindowsErrorString();",
      "59:  switch (error_code) {",
      "",
      "[Removed Lines]",
      "56:  if ((error_code >> 16) != 0x8009)",
      "",
      "[Added Lines]",
      "56:  if (((error_code >> 16) != 0x8009) && ((error_code >> 16) != 0x800B))",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "113:   return \"Cannot complete usage check.\";",
      "114:  case CRYPT_E_NO_TRUSTED_SIGNER:",
      "115:   return \"None of the signers of the cryptographic message or certificate trust list is trusted.\";",
      "116:  default:",
      "117:   static_sprintf(error_string, \"Unknown PKI error 0x%08lX\", error_code);",
      "118:   return error_string;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "116:  case CERT_E_UNTRUSTEDROOT:",
      "117:   return \"The root certificate is not trusted.\";",
      "118:  case TRUST_E_NOSIGNATURE:",
      "119:   return \"Not digitally signed.\";",
      "120:  case TRUST_E_EXPLICIT_DISTRUST:",
      "121:   return \"One of the certificates used was marked as untrusted by the user.\";",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "268:  }",
      "270:  trust_data.cbStruct = sizeof(trust_data);",
      "273:  trust_data.fdwRevocationChecks = WTD_REVOKE_WHOLECHAIN;",
      "",
      "[Removed Lines]",
      "271:  trust_data.dwUIChoice = WTD_UI_ALL;",
      "",
      "[Added Lines]",
      "283:  trust_data.dwUIChoice = WTD_UI_NONE;",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "279:  r = WinVerifyTrust(NULL, &guid_generic_verify, &trust_data);",
      "280:  safe_free(trust_file.pcwszFilePath);",
      "282:  return r;",
      "283: }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "293:  switch (r) {",
      "294:  case ERROR_SUCCESS:",
      "295:   break;",
      "296:  case TRUST_E_NOSIGNATURE:",
      "298:   uprintf(\"PKI: File does not appear to be signed: %s\", WinPKIErrorString());",
      "299:   MessageBoxExU(hDlg, lmprintf(MSG_284), lmprintf(MSG_283), MB_OK | MB_ICONERROR | MB_IS_RTL, selected_langid);",
      "300:   break;",
      "301:  default:",
      "302:   uprintf(\"PKI: Failed to validate signature: %s\", WinPKIErrorString());",
      "303:   MessageBoxExU(hDlg, lmprintf(MSG_240), lmprintf(MSG_283), MB_OK | MB_ICONERROR | MB_IS_RTL, selected_langid);",
      "304:   break;",
      "305:  }",
      "",
      "---------------"
    ],
    "src/rufus.rc||src/rufus.rc": [
      "File: src/rufus.rc -> src/rufus.rc",
      "--- Hunk 1 ---",
      "[Context before]",
      "33: IDD_DIALOG DIALOGEX 12, 12, 242, 376",
      "34: STYLE DS_SETFONT | DS_MODALFRAME | DS_CENTER | WS_MINIMIZEBOX | WS_POPUP | WS_CAPTION | WS_SYSMENU",
      "35: EXSTYLE WS_EX_ACCEPTFILES",
      "37: FONT 8, \"Segoe UI Symbol\", 400, 0, 0x0",
      "38: BEGIN",
      "39:     LTEXT           \"Device\",IDS_DEVICE_TXT,9,6,200,8",
      "",
      "[Removed Lines]",
      "36: CAPTION \"Rufus 2.17.1186\"",
      "",
      "[Added Lines]",
      "36: CAPTION \"Rufus 2.17.1187\"",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "368: VS_VERSION_INFO VERSIONINFO",
      "371:  FILEFLAGSMASK 0x3fL",
      "372: #ifdef _DEBUG",
      "373:  FILEFLAGS 0x1L",
      "",
      "[Removed Lines]",
      "369:  FILEVERSION 2,17,1186,0",
      "370:  PRODUCTVERSION 2,17,1186,0",
      "",
      "[Added Lines]",
      "369:  FILEVERSION 2,17,1187,0",
      "370:  PRODUCTVERSION 2,17,1187,0",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "384:         BEGIN",
      "385:             VALUE \"CompanyName\", \"Akeo Consulting (http://akeo.ie)\"",
      "386:             VALUE \"FileDescription\", \"Rufus\"",
      "388:             VALUE \"InternalName\", \"Rufus\"",
      "389:             VALUE \"LegalCopyright\", \"\ufffd 2011-2017 Pete Batard (GPL v3)\"",
      "390:             VALUE \"LegalTrademarks\", \"http://www.gnu.org/copyleft/gpl.html\"",
      "391:             VALUE \"OriginalFilename\", \"rufus.exe\"",
      "392:             VALUE \"ProductName\", \"Rufus\"",
      "394:         END",
      "395:     END",
      "396:     BLOCK \"VarFileInfo\"",
      "",
      "[Removed Lines]",
      "387:             VALUE \"FileVersion\", \"2.17.1186\"",
      "393:             VALUE \"ProductVersion\", \"2.17.1186\"",
      "",
      "[Added Lines]",
      "387:             VALUE \"FileVersion\", \"2.17.1187\"",
      "393:             VALUE \"ProductVersion\", \"2.17.1187\"",
      "",
      "---------------"
    ],
    "src/stdlg.c||src/stdlg.c": [
      "File: src/stdlg.c -> src/stdlg.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1674:    case 2:  // Launch newer version and close this one",
      "1675:     Sleep(1000); // Add a delay on account of antivirus scanners",
      "1678:      break;",
      "1680:     memset(&si, 0, sizeof(si));",
      "1681:     memset(&pi, 0, sizeof(pi));",
      "",
      "[Removed Lines]",
      "1677:     if (ValidateSignature(hDlg, filepath) != NO_ERROR)",
      "",
      "[Added Lines]",
      "1677:     if (ValidateSignature(hDlg, filepath) != NO_ERROR) {",
      "1679:      _unlinkU(filepath);",
      "1680:      EnableWindow(GetDlgItem(hDlg, IDC_DOWNLOAD), FALSE);",
      "1682:     }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "d722ad6dda0d903714a5caecc660f3f7b960f146",
      "candidate_info": {
        "commit_hash": "d722ad6dda0d903714a5caecc660f3f7b960f146",
        "repo": "pbatard/rufus",
        "commit_url": "https://github.com/pbatard/rufus/commit/d722ad6dda0d903714a5caecc660f3f7b960f146",
        "files": [
          "res/localization/rufus.loc",
          "src/rufus.rc"
        ],
        "message": "[loc] update Polish translation to latest",
        "before_after_code_files": [
          "res/localization/rufus.loc||res/localization/rufus.loc",
          "src/rufus.rc||src/rufus.rc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "res/localization/rufus.loc||res/localization/rufus.loc",
            "src/rufus.rc||src/rufus.rc"
          ],
          "candidate": [
            "res/localization/rufus.loc||res/localization/rufus.loc",
            "src/rufus.rc||src/rufus.rc"
          ]
        }
      },
      "candidate_diff": {
        "res/localization/rufus.loc||res/localization/rufus.loc": [
          "File: res/localization/rufus.loc -> res/localization/rufus.loc",
          "--- Hunk 1 ---",
          "[Context before]",
          "11701: ################################################################################",
          "11702: l \"pl-PL\" \"Polish (Polski)\" 0x0415",
          "11704: b \"en-US\"",
          "11705: # my info: 6.9.2015,22:39",
          "",
          "[Removed Lines]",
          "11703: v 1.0.20",
          "",
          "[Added Lines]",
          "11703: v 1.0.21",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "12174:  \"wskazywa\u0107 na pewne formy z\u0142o\u015bliwych zachowa\u0144...\\nCzy na pewno chcesz uruchomi\u0107 ten plik?\"",
          "12175: t MSG_286 \"Zerowanie dysku: uko\u0144czono %0.1f%%\"",
          "12176: t MSG_287 \"Wykrywanie dysk\u00f3w wymiennych nie-USB\"",
          "12178: ################################################################################",
          "12179: l \"pt-BR\" \"Portuguese Brazilian (Portugu\u00eas do Brasil)\" 0x0416",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "12177: t MSG_288 \"Brakuj\u0105ce uprawnienia administratora\"",
          "12178: t MSG_289 \"Ta aplikacja mo\u017ce dzia\u0142a\u0107 wy\u0142\u0105cznie z uprawnieniami administratora\"",
          "12179: t MSG_290 \"Indeksowanie plik\u00f3w\"",
          "12180: t MSG_291 \"Wyb\u00f3r wersji\"",
          "12181: t MSG_292 \"Prosz\u0119 wybra\u0107 wersj\u0119 Windowsa kt\u00f3r\u0105 chcesz zainstalowa\u0107:\"",
          "12182: t MSG_293 \"Niewspierana wersja Windowsa\"",
          "12183: t MSG_294 \"Ta wersja Windowsa nie jest ju\u017c wspierana przez Rufusa.\"",
          "",
          "---------------"
        ],
        "src/rufus.rc||src/rufus.rc": [
          "File: src/rufus.rc -> src/rufus.rc",
          "--- Hunk 1 ---",
          "[Context before]",
          "33: IDD_DIALOG DIALOGEX 12, 12, 242, 376",
          "34: STYLE DS_SETFONT | DS_MODALFRAME | DS_CENTER | WS_MINIMIZEBOX | WS_POPUP | WS_CAPTION | WS_SYSMENU",
          "35: EXSTYLE WS_EX_ACCEPTFILES",
          "37: FONT 8, \"Segoe UI Symbol\", 400, 0, 0x0",
          "38: BEGIN",
          "39:     LTEXT           \"Device\",IDS_DEVICE_TXT,9,6,200,8",
          "",
          "[Removed Lines]",
          "36: CAPTION \"Rufus 2.12.1050\"",
          "",
          "[Added Lines]",
          "36: CAPTION \"Rufus 2.12.1051\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "336: VS_VERSION_INFO VERSIONINFO",
          "339:  FILEFLAGSMASK 0x3fL",
          "340: #ifdef _DEBUG",
          "341:  FILEFLAGS 0x1L",
          "",
          "[Removed Lines]",
          "337:  FILEVERSION 2,12,1050,0",
          "338:  PRODUCTVERSION 2,12,1050,0",
          "",
          "[Added Lines]",
          "337:  FILEVERSION 2,12,1051,0",
          "338:  PRODUCTVERSION 2,12,1051,0",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "352:         BEGIN",
          "353:             VALUE \"CompanyName\", \"Akeo Consulting (http://akeo.ie)\"",
          "354:             VALUE \"FileDescription\", \"Rufus\"",
          "356:             VALUE \"InternalName\", \"Rufus\"",
          "357:             VALUE \"LegalCopyright\", \"\ufffd 2011-2017 Pete Batard (GPL v3)\"",
          "358:             VALUE \"LegalTrademarks\", \"http://www.gnu.org/copyleft/gpl.html\"",
          "359:             VALUE \"OriginalFilename\", \"rufus.exe\"",
          "360:             VALUE \"ProductName\", \"Rufus\"",
          "362:         END",
          "363:     END",
          "364:     BLOCK \"VarFileInfo\"",
          "",
          "[Removed Lines]",
          "355:             VALUE \"FileVersion\", \"2.12.1050\"",
          "361:             VALUE \"ProductVersion\", \"2.12.1050\"",
          "",
          "[Added Lines]",
          "355:             VALUE \"FileVersion\", \"2.12.1051\"",
          "361:             VALUE \"ProductVersion\", \"2.12.1051\"",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "0d0ad389ce0d9f17d4223f6b29e27de7ee3860ac",
      "candidate_info": {
        "commit_hash": "0d0ad389ce0d9f17d4223f6b29e27de7ee3860ac",
        "repo": "pbatard/rufus",
        "commit_url": "https://github.com/pbatard/rufus/commit/0d0ad389ce0d9f17d4223f6b29e27de7ee3860ac",
        "files": [
          "src/rufus.c",
          "src/rufus.rc"
        ],
        "message": "[ui] avoid intempestive log tooltip display and fix partition type preservation\n\n* Because of Windows' poor handling of toolbar buttons' tooltips, an unwanted\n  tooltip could be displayed onscreen after closing the log.\n* Also fix an issue when Rufus would reset the partition type to GPT after a\n  user created an MBR flash drive (e.g. after creating a Windows bootable USB).",
        "before_after_code_files": [
          "src/rufus.c||src/rufus.c",
          "src/rufus.rc||src/rufus.rc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/rufus.rc||src/rufus.rc"
          ],
          "candidate": [
            "src/rufus.rc||src/rufus.rc"
          ]
        }
      },
      "candidate_diff": {
        "src/rufus.c||src/rufus.c": [
          "File: src/rufus.c -> src/rufus.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "328:    preferred_pt = (selected_pt >= 0) ? selected_pt : PARTITION_STYLE_GPT;",
          "329:   else if ((bt == BT_IMAGE) && (image_path != NULL) && (img_report.is_iso)) {",
          "330:    if (HAS_WINDOWS(img_report) && img_report.has_efi)",
          "332:    if (img_report.is_bootable_img)",
          "333:     preferred_pt = (selected_pt >= 0) ? selected_pt : PARTITION_STYLE_MBR;",
          "334:   }",
          "",
          "[Removed Lines]",
          "331:     preferred_pt = allow_dual_uefi_bios? PARTITION_STYLE_MBR : PARTITION_STYLE_GPT;",
          "",
          "[Added Lines]",
          "331:     preferred_pt = allow_dual_uefi_bios? PARTITION_STYLE_MBR :",
          "332:      ((selected_pt >= 0) ? selected_pt : PARTITION_STYLE_GPT);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1022:   case IDCANCEL:",
          "1023:    ShowWindow(hDlg, SW_HIDE);",
          "1024:    log_displayed = FALSE;",
          "1025:    return TRUE;",
          "1026:   case IDC_LOG_CLEAR:",
          "1027:    SetWindowTextA(hLog, \"\");",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1028:    SendMessage(hMainDialog, WM_NEXTDLGCTL, (WPARAM)GetDlgItem(hMainDialog, IDCANCEL), TRUE);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1050:   ShowWindow(hDlg, SW_HIDE);",
          "1051:   reset_localization(IDD_LOG);",
          "1052:   log_displayed = FALSE;",
          "1053:   return TRUE;",
          "1054:  case UM_RESIZE_BUTTONS:",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1059:   SendMessage(hMainDialog, WM_NEXTDLGCTL, (WPARAM)GetDlgItem(hMainDialog, IDCANCEL), TRUE);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "3300:      static_sprintf(szTimer, \"00:00:00\");",
          "3301:      SendMessageA(hStatus, SB_SETTEXTA, SBT_OWNERDRAW | SB_SECTION_RIGHT, (LPARAM)szTimer);",
          "3302:      SetTimer(hMainDialog, TID_APP_TIMER, 1000, ClockTimer);",
          "3303:     }",
          "3304:    }",
          "3305:    if (format_thid != NULL)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3311:      SendMessage(hMainDialog, WM_NEXTDLGCTL, (WPARAM)GetDlgItem(hMainDialog, IDCANCEL), TRUE);",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "3522:     utf8_to_wchar_no_alloc(lmprintf(MSG_272), wtooltip, ARRAYSIZE(wtooltip));",
          "3523:     lpttt->lpszText = wtooltip;",
          "3524:     break;",
          "3525:    }",
          "3526:    break;",
          "3527:   }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3534:    default:",
          "3535:     uprintf(\"TTN_GETDISPINFO called for unknown toolbar button!\");",
          "3536:     break;",
          "",
          "---------------"
        ],
        "src/rufus.rc||src/rufus.rc": [
          "File: src/rufus.rc -> src/rufus.rc",
          "--- Hunk 1 ---",
          "[Context before]",
          "33: IDD_DIALOG DIALOGEX 12, 12, 232, 326",
          "34: STYLE DS_SETFONT | DS_MODALFRAME | DS_CENTER | WS_MINIMIZEBOX | WS_POPUP | WS_CAPTION | WS_SYSMENU",
          "35: EXSTYLE WS_EX_ACCEPTFILES",
          "37: FONT 9, \"Segoe UI Symbol\", 400, 0, 0x0",
          "38: BEGIN",
          "39:     LTEXT           \"Drive Properties\",IDS_DRIVE_PROPERTIES_TXT,8,6,53,12,NOT WS_GROUP",
          "",
          "[Removed Lines]",
          "36: CAPTION \"Rufus 3.0.1283\"",
          "",
          "[Added Lines]",
          "36: CAPTION \"Rufus 3.0.1284\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "391: VS_VERSION_INFO VERSIONINFO",
          "394:  FILEFLAGSMASK 0x3fL",
          "395: #ifdef _DEBUG",
          "396:  FILEFLAGS 0x1L",
          "",
          "[Removed Lines]",
          "392:  FILEVERSION 3,0,1283,0",
          "393:  PRODUCTVERSION 3,0,1283,0",
          "",
          "[Added Lines]",
          "392:  FILEVERSION 3,0,1284,0",
          "393:  PRODUCTVERSION 3,0,1284,0",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "407:         BEGIN",
          "408:             VALUE \"CompanyName\", \"Akeo Consulting (http://akeo.ie)\"",
          "409:             VALUE \"FileDescription\", \"Rufus\"",
          "411:             VALUE \"InternalName\", \"Rufus\"",
          "412:             VALUE \"LegalCopyright\", \"\ufffd 2011-2018 Pete Batard (GPL v3)\"",
          "413:             VALUE \"LegalTrademarks\", \"http://www.gnu.org/copyleft/gpl.html\"",
          "414:             VALUE \"OriginalFilename\", \"rufus.exe\"",
          "415:             VALUE \"ProductName\", \"Rufus\"",
          "417:         END",
          "418:     END",
          "419:     BLOCK \"VarFileInfo\"",
          "",
          "[Removed Lines]",
          "410:             VALUE \"FileVersion\", \"3.0.1283\"",
          "416:             VALUE \"ProductVersion\", \"3.0.1283\"",
          "",
          "[Added Lines]",
          "410:             VALUE \"FileVersion\", \"3.0.1284\"",
          "416:             VALUE \"ProductVersion\", \"3.0.1284\"",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "dcdae34b401528aa2d04511af1995e291596b144",
      "candidate_info": {
        "commit_hash": "dcdae34b401528aa2d04511af1995e291596b144",
        "repo": "pbatard/rufus",
        "commit_url": "https://github.com/pbatard/rufus/commit/dcdae34b401528aa2d04511af1995e291596b144",
        "files": [
          "res/localization/rufus.loc",
          "src/rufus.rc"
        ],
        "message": "[loc] update Norwegian translation to latest",
        "before_after_code_files": [
          "res/localization/rufus.loc||res/localization/rufus.loc",
          "src/rufus.rc||src/rufus.rc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "res/localization/rufus.loc||res/localization/rufus.loc",
            "src/rufus.rc||src/rufus.rc"
          ],
          "candidate": [
            "res/localization/rufus.loc||res/localization/rufus.loc",
            "src/rufus.rc||src/rufus.rc"
          ]
        }
      },
      "candidate_diff": {
        "res/localization/rufus.loc||res/localization/rufus.loc": [
          "File: res/localization/rufus.loc -> res/localization/rufus.loc",
          "--- Hunk 1 ---",
          "[Context before]",
          "10164: ################################################################################",
          "10165: l \"nb-NO\" \"Norwegian (Norsk)\" 0x0414",
          "10167: b \"en-US\"",
          "10169: # Main dialog",
          "10170: g IDD_DIALOG",
          "10171: t IDS_DEVICE_TXT \"Enhet\"",
          "10172: t IDS_BOOT_SELECTION_TXT \"Oppstartstype\"",
          "10174: t IDS_FILE_SYSTEM_TXT \"Filsystem\"",
          "10175: t IDS_CLUSTER_SIZE_TXT \"Cluster-st\u00f8rrelse\"",
          "10177: t IDS_FORMAT_OPTIONS_TXT \"Format-valg\"",
          "10178: t IDC_BAD_BLOCKS \"Sjekk enhet for d\u00e5rlige blokker\"",
          "10179: t IDC_QUICK_FORMAT \"Hurtigformatering\"",
          "",
          "[Removed Lines]",
          "10166: v 1.0.22",
          "10173: t IDS_PARTITION_TYPE_TXT \"Partisjonskjema og m\u00e5lsystem-type\"",
          "10176: t IDS_LABEL_TXT \"Nytt volumnavn\"",
          "",
          "[Added Lines]",
          "10166: v 1.0.23",
          "10171: t IDS_DRIVE_PROPERTIES_TXT \"Stasjons rettigheter\"",
          "10174: t IDC_SELECT \"Velg\"",
          "10175: t IDS_IMAGE_OPTION_TXT \"Bildevalg\"",
          "10176: t IDS_PARTITION_TYPE_TXT \"Partisjonskjema\"",
          "10177: t IDS_TARGET_SYSTEM_TXT \"M\u00e5lsystem\"",
          "10180: t IDS_LABEL_TXT \"Volumnavn\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "10183: t IDC_LIST_USB_HDD \"F\u00f8r opp USB harddisker\"",
          "10184: t IDC_OLD_BIOS_FIXES \"Legger til fiks for gamle BIOSer (ekstra partisjon, etc.)\"",
          "10185: t IDC_RUFUS_MBR \"Bruk Rufus MBR med BIOS ID\"",
          "10187: # About dialog",
          "10188: g IDD_ABOUTBOX",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "10190: t IDS_STATUS_TXT \"Status\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "10230: t MSG_001 \"Annen forekomst oppdaget\"",
          "10231: t MSG_002 \"Annen Rufus-utgave kj\u00f8rer.\\n\"",
          "10232:  \"Vennligst lukk den f\u00f8rste utgaven, f\u00f8r du \u00e5pner en ny.\"",
          "10234:  \"For \u00e5 fortsette denne operasjonen, klikk OK. For \u00e5 avslutte klikk Avbryt.\"",
          "10235: t MSG_004 \"Rufus oppdateringspolitikk\"",
          "10236: t MSG_005 \"Vil du tillate at Rufus ser etter oppdateringer online?\"",
          "",
          "[Removed Lines]",
          "10233: t MSG_003 \"ADVARSEL: ALLE DATA P\u00c5 STASJONEN '%s' VIL BLI \u00d8DELAGT.\\n\"",
          "",
          "[Added Lines]",
          "10238: t MSG_003 \"ADVARSEL: ALLE DATA P\u00c5 STASJONEN '%s' VIL BLI OVERSKREVET.\\n\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "10265: t MSG_029 \"Standard\"",
          "10266: # The following gets appended to the file system, cluster size, etc.",
          "10267: t MSG_030 \"%s (Standard)\"",
          "10271: # Number of bad block check passes (singular for 1 pass, plural for 2 or more passes)",
          "10272: t MSG_034 \"%d Passering\"",
          "10273: t MSG_035 \"%d Passeringer\"",
          "",
          "[Removed Lines]",
          "10268: #t MSG_031 \"%s partisjonskjema for BIOS eller %s\"",
          "10269: #t MSG_032 \"%s partisjonskjema for BIOS\"",
          "10270: #t MSG_033 \"%s partisjonskjema for UEFI\"",
          "",
          "[Added Lines]",
          "10273: t MSG_031 \"BIOS (eller UEFI-CSM)\"",
          "10274: t MSG_032 \"UEFI (ikke CSM)\"",
          "10275: t MSG_033 \"BIOS eller UEFI\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "10307: t MSG_065 \"Skrivefeil.\"",
          "10308: t MSG_066 \"Installasjonsfeil\"",
          "10309: t MSG_067 \"Kunne ikke \u00e5pne media. Er muligens i bruk av en annen prosess. \"",
          "10311: t MSG_068 \"Feil under stasjonspartisjonering.\"",
          "10312: t MSG_069 \"Kunne ikke kopiere filer til m\u00e5lstasjonen.\"",
          "10313: t MSG_070 \"Brukeravbrutt.\"",
          "",
          "[Removed Lines]",
          "10310:  \"Vennligst koble fra og pr\u00f8v \u00e5 koble til p\u00e5 nytt.\"",
          "",
          "[Added Lines]",
          "10315:  \"Vennligst koble fra, og pr\u00f8v \u00e5 koble til p\u00e5 nytt.\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "10346:  \"Vennligst velg en EFI oppstartbar ISO-fil eller sett m\u00e5ltype i BIOS.\"",
          "10347: t MSG_092 \"Ikke st\u00f8ttet filsystem\"",
          "10348: t MSG_093 \"VIKTIGT: DENNE STASJONEN INNEHOLDER FLERE PARTISJONER!!\\n\\n\"",
          "10350:  \"Hvis du \u00f8nsker \u00e5 fortsette, er du selv ansvarlig for evt. tapte data p\u00e5 disse partisjonene.\"",
          "10351: t MSG_094 \"Flere partisjoner oppdaget\"",
          "10352: t MSG_095 \"DD-bilde\"",
          "",
          "[Removed Lines]",
          "10349:  \"Denne inneholder kanskje partisjoner/volumer som ikke er listet og muligens ikke er synlig i Windows. \"",
          "",
          "[Added Lines]",
          "10354:  \"Denne inneholder kanskje partisjoner/volumer som ikke er listet, og muligens ikke er synlig i Windows. \"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "10410:  \"- Velg 'Avbryt' for \u00e5 avbryte\\n\\n\"",
          "10411:  \"OBS: Filen vil bli lastet ned i den aktuelle program-mappen og vil bli brukt \"",
          "10412:  \"automatisk hvis tilgjengelig. Hvis ingen treff kan bli funnet, den innebygde versjonen vil bli brukt.\\n\"",
          "10413: # Tooltips",
          "10414: # Partition Scheme and Target Type",
          "10421: t MSG_153 \"Testm\u00f8nster: 0x%02X\"",
          "10422: t MSG_154 \"Testm\u00f8nster: 0x%02X, 0x%02X\"",
          "10423: t MSG_155 \"Testm\u00f8nster: 0x%02X, 0x%02X, 0x%02X\"",
          "",
          "[Removed Lines]",
          "10415: t MSG_150 \"Som oftest det tryggeste valget. Hvis du har en UEFI-datamaskin og \u00f8nsker \u00e5 installere \"",
          "10416:  \"et operativsystem i EFI-modus uansett, skal du velge en av de andre valgene\"",
          "10417: t MSG_151 \"Bruk dette hvis du vil installere et operativsystem i EFI-modus, men trenger \u00e5 ha tilgang \"",
          "10418:  \"til USB-innholdet fra Windows XP\"",
          "10419: t MSG_152 \"Det foretrukne valget for \u00e5 installere operativsystemet i EFI-modus og n\u00e5r \"",
          "10420:  \"USB-tilgang ikke er p\u00e5krevd av Windows XP\"",
          "",
          "[Added Lines]",
          "10418: t MSG_117 \"Standard Windows instalasjon\"",
          "10419: t MSG_119 \"avanserte stasjonsegenskaper\"",
          "10420: t MSG_120 \"avanserte formatalternativer\"",
          "10421: t MSG_121 \"Vis %s\"",
          "10422: t MSG_122 \"Skjul %s\"",
          "10425: t MSG_150 \"\"Datamaskin typen du planlegger \u00e5 bruke denne oppstartbare stasjonen med. Det er ditt ansvar \u00e5 avgj\u00f8re om\"",
          "10426: \"m\u00e5let ditt er av BIOS eller UEFI-typen f\u00f8r du begynner \u00e5 lage stasjonen, da det kan mislykkes \u00e5 starte opp ellers.\"",
          "10427: t MSG_151 \"'UEFI-CSM' betyr at enheten bare starter opp i BIOS-emuleringsmodus (ogs\u00e5 kjent som 'Legacy Mode') under UEFI, og ikke i innebygde UEFI-modus.\"",
          "10428: t MSG_152 \"'ikke-CSM' betyr at enheten bare starter opp i innebygde UEFI-modus, og ikke i BIOS-emuleringsmodus (ogs\u00e5 kjent som 'Legacy Mode').\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "10428: t MSG_160 \"Avanserte valg\"",
          "10429: t MSG_161 \"Velg antall passeringer for \u00e5 teste etter d\u00e5rlige blokker, bruker forskjellige m\u00f8nstre.\"",
          "10430: t MSG_162 \"Bruk \\\"langsom\\\" formateringsmetode ved \u00e5 fjerne haken i denne ruten.\"",
          "10431: t MSG_164 \"Metoden som vil bli brukt for \u00e5 gj\u00f8re stasjonen oppstartbar\"",
          "10432: t MSG_165 \"Klikk for \u00e5 velge et bilde...\"",
          "10433: t MSG_166 \"Merk denne boksen for \u00e5 tillate visning av internasjonal merkelapp \"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "10439: t MSG_163 \"Metoden som vil bli brukt for \u00e5 lage partisjonene.\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "10582:  \"Vennligst velg modus du \u00f8nsker \u00e5 skrive dette bildet i:\"",
          "10583: t MSG_276 \"Skriv i %s -modus (anbefalt)\"",
          "10584: t MSG_277 \"Skriv i %s -modus\"",
          "10585: t MSG_279 \"Ikke oppstartbar\"",
          "10588: t MSG_282 \"Utelat USB stasjonsl\u00e5s\"",
          "10589: t MSG_283 \"Ugyldig signatur\"",
          "10590: t MSG_284 \"Den nedlastede programfil mangler en digital signatur.\"",
          "",
          "[Removed Lines]",
          "10586: t MSG_280 \"Bildevalg\"",
          "10587: t MSG_281 \"(Vennligst velg et bilde)\"",
          "",
          "[Added Lines]",
          "10594: t MSG_278 \"Sjekker for motstridende prosesser...\"",
          "10596: t MSG_280 \"Disk eller ISO bilde\"",
          "10597: t MSG_281 \"%s (Vennligst velg)\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "10602: t MSG_295 \"Advarsel: Uoffisiell versjon\"",
          "10603: t MSG_296 \"Denne versjonen av Rufus er IKKE laget av dens offisielle utvikler(e).\\n\\nEr du sikker p\u00e5 at du vil kj\u00f8re programmet?\"",
          "10604: t MSG_297 \"Forkortet ISO oppdaget\"",
          "10606:  \"filen fra internett, b\u00f8r du pr\u00f8ve \u00e5 laste ned en ny kopi, og verifisere at MD5- eller SHA-kontrollsummen samsvarer med de offisielle.\\n\\n\"",
          "10607:  \"Legg merke til at du kan beregne MD5 eller SHA i Rufus ved \u00e5 klikke p\u00e5 '#'-knappen.\"",
          "10610: ################################################################################",
          "10611: l \"fa-IR\" \"Persian (\u0641\u0627\u0631\u0633\u06cc)\" 0x0429",
          "",
          "[Removed Lines]",
          "10605: t MSG_298 \"ISO-filen du har valgt, stemmer ikke overens med den deklarerte st\u00f8rrelsen: %s av dataene mangler!\\n\\ nHvis du har lastet ned denne \"",
          "10608: t MSG_117 \"Standard Windows-installasjon\"",
          "",
          "[Added Lines]",
          "10615: t MSG_298 \"ISO-filen du har valgt, stemmer ikke overens med den deklarerte st\u00f8rrelsen: %s av dataene mangler!\\n\\nHvis du har lastet ned denne \"",
          "10618: t MSG_299 \"Tidspunkt bekreftelses feil\"",
          "10619: t MSG_300 \"Rufus kunne ikke bekrefte at tidspunktet av den nedlastede oppdateringen er nyere enn den \"",
          "10620:  \"n\u00e5v\u00e6rende startede.\\n\\nFor \u00e5 forhindre potensielle angrepsscenarier, har oppdateringsprosessen blitt avbrutt og \"",
          "10621:  \"nedlastingen vil bli slettet. Vennligst sjekk loggen for mer informasjon.\"",
          "10622: t MSG_301 \"Vis programinnstillinger\"",
          "10623: t MSG_302 \"Vis informasjon om denne applikasjonen\"",
          "10624: t MSG_303 \"Vis loggen\"",
          "10625: t MSG_304 \"Opprett et diskbilde av den valgte enheten\"",
          "10626: t MSG_305 \"Bruk dette alternativet for \u00e5 angi om du vil bruke denne enheten til \u00e5 installere Windows p\u00e5 en annen disk, \"",
          "10627:  \"eller hvis du vil kj\u00f8re Windows direkte fra denne stasjonen (Windows To Go).\"",
          "",
          "---------------"
        ],
        "src/rufus.rc||src/rufus.rc": [
          "File: src/rufus.rc -> src/rufus.rc",
          "--- Hunk 1 ---",
          "[Context before]",
          "33: IDD_DIALOG DIALOGEX 12, 12, 232, 326",
          "34: STYLE DS_SETFONT | DS_MODALFRAME | DS_CENTER | WS_MINIMIZEBOX | WS_POPUP | WS_CAPTION | WS_SYSMENU",
          "35: EXSTYLE WS_EX_ACCEPTFILES",
          "37: FONT 9, \"Segoe UI Symbol\", 400, 0, 0x0",
          "38: BEGIN",
          "39:     LTEXT           \"Drive Properties\",IDS_DRIVE_PROPERTIES_TXT,8,6,53,12,NOT WS_GROUP",
          "",
          "[Removed Lines]",
          "36: CAPTION \"Rufus 3.0.1240\"",
          "",
          "[Added Lines]",
          "36: CAPTION \"Rufus 3.0.1241\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "373: VS_VERSION_INFO VERSIONINFO",
          "376:  FILEFLAGSMASK 0x3fL",
          "377: #ifdef _DEBUG",
          "378:  FILEFLAGS 0x1L",
          "",
          "[Removed Lines]",
          "374:  FILEVERSION 2,18,1240,0",
          "375:  PRODUCTVERSION 2,18,1240,0",
          "",
          "[Added Lines]",
          "374:  FILEVERSION 2,18,1241,0",
          "375:  PRODUCTVERSION 2,18,1241,0",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "389:         BEGIN",
          "390:             VALUE \"CompanyName\", \"Akeo Consulting (http://akeo.ie)\"",
          "391:             VALUE \"FileDescription\", \"Rufus\"",
          "393:             VALUE \"InternalName\", \"Rufus\"",
          "394:             VALUE \"LegalCopyright\", \"\ufffd 2011-2018 Pete Batard (GPL v3)\"",
          "395:             VALUE \"LegalTrademarks\", \"http://www.gnu.org/copyleft/gpl.html\"",
          "396:             VALUE \"OriginalFilename\", \"rufus.exe\"",
          "397:             VALUE \"ProductName\", \"Rufus\"",
          "399:         END",
          "400:     END",
          "401:     BLOCK \"VarFileInfo\"",
          "",
          "[Removed Lines]",
          "392:             VALUE \"FileVersion\", \"2.18.1240\"",
          "398:             VALUE \"ProductVersion\", \"2.18.1240\"",
          "",
          "[Added Lines]",
          "392:             VALUE \"FileVersion\", \"2.18.1241\"",
          "398:             VALUE \"ProductVersion\", \"2.18.1241\"",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "a73e695ba4dd11a24750984128500ea0dfe2393a",
      "candidate_info": {
        "commit_hash": "a73e695ba4dd11a24750984128500ea0dfe2393a",
        "repo": "pbatard/rufus",
        "commit_url": "https://github.com/pbatard/rufus/commit/a73e695ba4dd11a24750984128500ea0dfe2393a",
        "files": [
          "src/pki.c",
          "src/rufus.c",
          "src/rufus.h",
          "src/rufus.rc",
          "src/stdio.c"
        ],
        "message": "[pki] timestamp validation improvements\n\n* Add timestamp processing for nested signature and check for anomalous differences\n* Also prevent attack scenarios that may attempt to leverage multiple nested signatures or countersigners\n* Simplify code by using CryptDecodeObjectEx/WinVerifyTrustEx and improve timestamp reporting",
        "before_after_code_files": [
          "src/pki.c||src/pki.c",
          "src/rufus.c||src/rufus.c",
          "src/rufus.h||src/rufus.h",
          "src/rufus.rc||src/rufus.rc",
          "src/stdio.c||src/stdio.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/pki.c||src/pki.c",
            "src/rufus.rc||src/rufus.rc"
          ],
          "candidate": [
            "src/pki.c||src/pki.c",
            "src/rufus.rc||src/rufus.rc"
          ]
        }
      },
      "candidate_diff": {
        "src/pki.c||src/pki.c": [
          "File: src/pki.c -> src/pki.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "36: #define ENCODING (X509_ASN_ENCODING | PKCS_7_ASN_ENCODING)",
          "39: const char* cert_name[3] = { \"Akeo Consulting\", \"Akeo Systems\", \"Pete Batard\" };",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "39: #if !defined(szOID_NESTED_SIGNATURE)",
          "40: #define szOID_NESTED_SIGNATURE \"1.3.6.1.4.1.311.2.4.1\"",
          "41: #endif",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "236: {",
          "238:  const uint8_t OID_RFC3161_timeStamp[] = { 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x09, 0x10, 0x01, 0x04 };",
          "240:  DWORD n, dwSize;",
          "241:  PCRYPT_CONTENT_INFO pCounterSignerInfo = NULL;",
          "242:  uint64_t ts = 0ULL;",
          "",
          "[Removed Lines]",
          "239:  BOOL r;",
          "",
          "[Added Lines]",
          "244:  BOOL r, found = FALSE;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "245:  char* timestamp_str;",
          "246:  size_t timestamp_str_size;",
          "249:  for (n = 0; n < pSignerInfo->UnauthAttrs.cAttr; n++) {",
          "250:   if (lstrcmpA(pSignerInfo->UnauthAttrs.rgAttr[n].pszObjId, szOID_RFC3161_counterSign) == 0) {",
          "259:    }",
          "270:     pSignerInfo->UnauthAttrs.rgAttr[n].rgValue[0].pbData,",
          "271:     pSignerInfo->UnauthAttrs.rgAttr[n].rgValue[0].cbData,",
          "273:    if (!r) {",
          "275:     continue;",
          "276:    }",
          "",
          "[Removed Lines]",
          "252:    r = CryptDecodeObject(PKCS_7_ASN_ENCODING, PKCS_CONTENT_INFO,",
          "253:     pSignerInfo->UnauthAttrs.rgAttr[n].rgValue[0].pbData,",
          "254:     pSignerInfo->UnauthAttrs.rgAttr[n].rgValue[0].cbData,",
          "255:     0, NULL, &dwSize);",
          "256:    if (!r) {",
          "257:     uprintf(\"PKI: Could not get CounterSigner (timestamp) data size: %s\", WinPKIErrorString());",
          "258:     continue;",
          "262:    pCounterSignerInfo = calloc(dwSize, 1);",
          "263:    if (pCounterSignerInfo == NULL) {",
          "264:     uprintf(\"PKI: Unable to allocate memory for CounterSigner (timestamp) data\");",
          "265:     continue;",
          "266:    }",
          "269:    r = CryptDecodeObject(PKCS_7_ASN_ENCODING, PKCS_CONTENT_INFO,",
          "272:     0, (PVOID)pCounterSignerInfo, &dwSize);",
          "274:     uprintf(\"PKI: Could not retrieve CounterSigner (timestamp) data: %s\", WinPKIErrorString());",
          "",
          "[Added Lines]",
          "259:    if (found) {",
          "260:     uprintf(\"PKI: Multiple RFC 3161 countersigners found. This could indicate something very nasty...\");",
          "261:     return 0ULL;",
          "263:    found = TRUE;",
          "266:    r = CryptDecodeObjectEx(PKCS_7_ASN_ENCODING, PKCS_CONTENT_INFO,",
          "269:     CRYPT_DECODE_ALLOC_FLAG, NULL, (PVOID)&pCounterSignerInfo, &dwSize);",
          "271:     uprintf(\"PKI: Could not retrieve RFC 3161 countersigner data: %s\", WinPKIErrorString());",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "295:      }",
          "296:     }",
          "297:    }",
          "299:   }",
          "300:  }",
          "301:  return ts;",
          "",
          "[Removed Lines]",
          "298:    safe_free(pCounterSignerInfo);",
          "",
          "[Added Lines]",
          "295:    LocalFree(pCounterSignerInfo);",
          "296:   }",
          "297:  }",
          "298:  return ts;",
          "299: }",
          "302: static uint64_t GetNestedRFC3161TimeStamp(PCMSG_SIGNER_INFO pSignerInfo)",
          "303: {",
          "304:  BOOL r, found = FALSE;",
          "305:  DWORD n, dwSize;",
          "306:  PCRYPT_CONTENT_INFO pNestedSignature = NULL;",
          "307:  PCMSG_SIGNER_INFO pNestedSignerInfo = NULL;",
          "308:  HCRYPTMSG hMsg = NULL;",
          "309:  uint64_t ts = 0ULL;",
          "312:  for (n = 0; ; n++) {",
          "313:   if (pNestedSignature != NULL)",
          "314:    LocalFree(pNestedSignature);",
          "315:   if (hMsg != NULL)",
          "316:    CryptMsgClose(hMsg);",
          "317:   safe_free(pNestedSignerInfo);",
          "318:   if (n >= pSignerInfo->UnauthAttrs.cAttr)",
          "319:    break;",
          "320:   if (lstrcmpA(pSignerInfo->UnauthAttrs.rgAttr[n].pszObjId, szOID_NESTED_SIGNATURE) == 0) {",
          "321:    if (found) {",
          "322:     uprintf(\"PKI: Multiple nested signatures found. This could indicate something very nasty...\");",
          "323:     return 0ULL;",
          "324:    }",
          "325:    found = TRUE;",
          "326:    r = CryptDecodeObjectEx(PKCS_7_ASN_ENCODING, PKCS_CONTENT_INFO,",
          "327:     pSignerInfo->UnauthAttrs.rgAttr[n].rgValue[0].pbData,",
          "328:     pSignerInfo->UnauthAttrs.rgAttr[n].rgValue[0].cbData,",
          "329:     CRYPT_DECODE_ALLOC_FLAG, NULL, (PVOID)&pNestedSignature, &dwSize);",
          "330:    if (!r) {",
          "331:     uprintf(\"PKI: Could not retrieve nested signature data: %s\", WinPKIErrorString());",
          "332:     continue;",
          "333:    }",
          "335:    hMsg = CryptMsgOpenToDecode(ENCODING, CMSG_DETACHED_FLAG, CMSG_SIGNED, (HCRYPTPROV)NULL, NULL, NULL);",
          "336:    if (hMsg == NULL) {",
          "337:     uprintf(\"PKI: Could not create nested signature message: %s\", WinPKIErrorString());",
          "338:     continue;",
          "339:    }",
          "340:    r = CryptMsgUpdate(hMsg, pNestedSignature->Content.pbData, pNestedSignature->Content.cbData, TRUE);",
          "341:    if (!r) {",
          "342:     uprintf(\"PKI: Could not update message: %s\", WinPKIErrorString());",
          "343:     continue;",
          "344:    }",
          "346:    r = CryptMsgGetParam(hMsg, CMSG_SIGNER_INFO_PARAM, 0, NULL, &dwSize);",
          "347:    if (!r) {",
          "348:     uprintf(\"PKI: Failed to get nested signer size: %s\", WinPKIErrorString());",
          "349:     continue;",
          "350:    }",
          "351:    pNestedSignerInfo = (PCMSG_SIGNER_INFO)calloc(dwSize, 1);",
          "352:    if (!pNestedSignerInfo) {",
          "353:     uprintf(\"PKI: Could not allocate memory for nested signer\");",
          "354:     continue;",
          "355:    }",
          "356:    r = CryptMsgGetParam(hMsg, CMSG_SIGNER_INFO_PARAM, 0, (PVOID)pNestedSignerInfo, &dwSize);",
          "357:    if (!r) {",
          "358:     uprintf(\"PKI: Failed to get nested signer information: %s\", WinPKIErrorString());",
          "359:     continue;",
          "360:    }",
          "361:    ts = GetRFC3161TimeStamp(pNestedSignerInfo);",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "313:  PCMSG_SIGNER_INFO pSignerInfo = NULL;",
          "314:  DWORD dwSignerInfo = 0;",
          "315:  wchar_t *szFileName;",
          "319:  if (path == NULL) {",
          "",
          "[Removed Lines]",
          "316:  uint64_t timestamp = 0ULL;",
          "",
          "[Added Lines]",
          "379:  uint64_t timestamp = 0ULL, nested_timestamp;",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "340:   CERT_QUERY_CONTENT_FLAG_PKCS7_SIGNED_EMBED, CERT_QUERY_FORMAT_FLAG_BINARY,",
          "341:   0, &dwEncoding, &dwContentType, &dwFormatType, &hStore, &hMsg, NULL);",
          "342:  if (!r) {",
          "344:   goto out;",
          "345:  }",
          "",
          "[Removed Lines]",
          "343:   uprintf(\"PKI: Failed to get signature for '%s': %s\", (path == NULL) ? mpath : path, WinPKIErrorString());",
          "",
          "[Added Lines]",
          "406:   uprintf(\"PKI: Failed to get signature for '%s': %s\", (path==NULL)?mpath:path, WinPKIErrorString());",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "369:  timestamp = GetRFC3161TimeStamp(pSignerInfo);",
          "371: out:",
          "372:  safe_free(mpath);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "433:  if (timestamp)",
          "434:   uprintf(\"Note: '%s' has timestamp %s\", (path==NULL)?mpath:path, TimestampToHumanReadable(timestamp));",
          "443:  nested_timestamp = GetNestedRFC3161TimeStamp(pSignerInfo);",
          "444:  if (nested_timestamp)",
          "445:   uprintf(\"Note: '%s' has nested timestamp %s\", (path==NULL)?mpath:path, TimestampToHumanReadable(nested_timestamp));",
          "446:  if ((timestamp != 0ULL) && (nested_timestamp != 0ULL)) {",
          "447:   if (_abs64(nested_timestamp - timestamp) > 100) {",
          "448:    uprintf(\"PKI: Signature timestamp and nested timestamp differ by more than a minute. \"",
          "449:     \"This could indicate something very nasty...\", timestamp, nested_timestamp);",
          "450:    timestamp = 0ULL;",
          "451:   }",
          "452:  }",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "437:  trust_data.dwUnionChoice = WTD_CHOICE_FILE;",
          "438:  trust_data.pFile = &trust_file;",
          "441:  safe_free(trust_file.pcwszFilePath);",
          "442:  switch (r) {",
          "443:  case ERROR_SUCCESS:",
          "",
          "[Removed Lines]",
          "440:  r = WinVerifyTrust(NULL, &guid_generic_verify, &trust_data);",
          "",
          "[Added Lines]",
          "523:  r = WinVerifyTrustEx(INVALID_HANDLE_VALUE, &guid_generic_verify, &trust_data);",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "450:   } else {",
          "451:    update_ts = GetSignatureTimeStamp(path);",
          "452:    if (update_ts < current_ts) {",
          "454:     r = TRUST_E_TIME_STAMP;",
          "455:    }",
          "456:   }",
          "",
          "[Removed Lines]",
          "453:     uprintf(\"PKI: Update timestamp (%\" PRIi64 \") is older than ours (%\" PRIi64 \")! - Aborting update\", update_ts, current_ts);",
          "",
          "[Added Lines]",
          "536:     uprintf(\"PKI: Update timestamp (%\" PRIi64 \") is younger than ours (%\" PRIi64 \")! - Aborting update\", update_ts, current_ts);",
          "",
          "---------------"
        ],
        "src/rufus.c||src/rufus.c": [
          "File: src/rufus.c -> src/rufus.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2285:  case WM_COMMAND:",
          "2286: #ifdef RUFUS_TEST",
          "2287:   if (LOWORD(wParam) == IDC_TEST) {",
          "",
          "[Removed Lines]",
          "2288:    ExtractEfiImgFiles(\"C:\\\\rufus\");",
          "",
          "[Added Lines]",
          "2288:    uprintf(\"ts = %lld\", GetSignatureTimeStamp(\"C:\\\\rufus\\\\rufus-2.17_BETA.exe\"));",
          "",
          "---------------"
        ],
        "src/rufus.h||src/rufus.h": [
          "File: src/rufus.h -> src/rufus.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "425: extern const char* StrError(DWORD error_code, BOOL use_default_locale);",
          "426: extern char* GuidToString(const GUID* guid);",
          "427: extern char* SizeToHumanReadable(uint64_t size, BOOL copy_to_log, BOOL fake_units);",
          "428: extern HWND MyCreateDialog(HINSTANCE hInstance, int Dialog_ID, HWND hWndParent, DLGPROC lpDialogFunc);",
          "429: extern INT_PTR MyDialogBox(HINSTANCE hInstance, int Dialog_ID, HWND hWndParent, DLGPROC lpDialogFunc);",
          "430: extern void CenterDialog(HWND hDlg);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "428: extern char* TimestampToHumanReadable(uint64_t ts);",
          "",
          "---------------"
        ],
        "src/rufus.rc||src/rufus.rc": [
          "File: src/rufus.rc -> src/rufus.rc",
          "--- Hunk 1 ---",
          "[Context before]",
          "33: IDD_DIALOG DIALOGEX 12, 12, 242, 376",
          "34: STYLE DS_SETFONT | DS_MODALFRAME | DS_CENTER | WS_MINIMIZEBOX | WS_POPUP | WS_CAPTION | WS_SYSMENU",
          "35: EXSTYLE WS_EX_ACCEPTFILES",
          "37: FONT 8, \"Segoe UI Symbol\", 400, 0, 0x0",
          "38: BEGIN",
          "39:     LTEXT           \"Device\",IDS_DEVICE_TXT,9,6,200,8",
          "",
          "[Removed Lines]",
          "36: CAPTION \"Rufus 2.17.1189\"",
          "",
          "[Added Lines]",
          "36: CAPTION \"Rufus 2.17.1190\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "368: VS_VERSION_INFO VERSIONINFO",
          "371:  FILEFLAGSMASK 0x3fL",
          "372: #ifdef _DEBUG",
          "373:  FILEFLAGS 0x1L",
          "",
          "[Removed Lines]",
          "369:  FILEVERSION 2,17,1189,0",
          "370:  PRODUCTVERSION 2,17,1189,0",
          "",
          "[Added Lines]",
          "369:  FILEVERSION 2,17,1190,0",
          "370:  PRODUCTVERSION 2,17,1190,0",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "384:         BEGIN",
          "385:             VALUE \"CompanyName\", \"Akeo Consulting (http://akeo.ie)\"",
          "386:             VALUE \"FileDescription\", \"Rufus\"",
          "388:             VALUE \"InternalName\", \"Rufus\"",
          "389:             VALUE \"LegalCopyright\", \"\ufffd 2011-2017 Pete Batard (GPL v3)\"",
          "390:             VALUE \"LegalTrademarks\", \"http://www.gnu.org/copyleft/gpl.html\"",
          "391:             VALUE \"OriginalFilename\", \"rufus.exe\"",
          "392:             VALUE \"ProductName\", \"Rufus\"",
          "394:         END",
          "395:     END",
          "396:     BLOCK \"VarFileInfo\"",
          "",
          "[Removed Lines]",
          "387:             VALUE \"FileVersion\", \"2.17.1189\"",
          "393:             VALUE \"ProductVersion\", \"2.17.1189\"",
          "",
          "[Added Lines]",
          "387:             VALUE \"FileVersion\", \"2.17.1190\"",
          "393:             VALUE \"ProductVersion\", \"2.17.1190\"",
          "",
          "---------------"
        ],
        "src/stdio.c||src/stdio.c": [
          "File: src/stdio.c -> src/stdio.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "228:  return str_size;",
          "229: }",
          "232: const char* _StrError(DWORD error_code)",
          "233: {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "232: char* TimestampToHumanReadable(uint64_t ts)",
          "233: {",
          "234:  uint64_t rem = ts, divisor = 10000000000ULL;",
          "235:  uint16_t data[6];",
          "236:  int i;",
          "237:  static char str[64];",
          "239:  for (i = 0; i < 6; i++) {",
          "240:   data[i] = (uint16_t) ((divisor == 0)?rem:(rem / divisor));",
          "241:   rem %= divisor;",
          "242:   divisor /= 100ULL;",
          "243:  }",
          "244:  static_sprintf(str, \"%04d.%02d.%02d %02d:%02d:%02d (UTC)\", data[0], data[1], data[2], data[3], data[4], data[5]);",
          "245:  return str;",
          "246: }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "d7d6caebe1d7d906134a72900933007c4e1fc5c7",
      "candidate_info": {
        "commit_hash": "d7d6caebe1d7d906134a72900933007c4e1fc5c7",
        "repo": "pbatard/rufus",
        "commit_url": "https://github.com/pbatard/rufus/commit/d7d6caebe1d7d906134a72900933007c4e1fc5c7",
        "files": [
          "res/localization/rufus.loc",
          "src/rufus.rc"
        ],
        "message": "[loc] update Greek translation to latest",
        "before_after_code_files": [
          "res/localization/rufus.loc||res/localization/rufus.loc",
          "src/rufus.rc||src/rufus.rc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "res/localization/rufus.loc||res/localization/rufus.loc",
            "src/rufus.rc||src/rufus.rc"
          ],
          "candidate": [
            "res/localization/rufus.loc||res/localization/rufus.loc",
            "src/rufus.rc||src/rufus.rc"
          ]
        }
      },
      "candidate_diff": {
        "res/localization/rufus.loc||res/localization/rufus.loc": [
          "File: res/localization/rufus.loc -> res/localization/rufus.loc",
          "--- Hunk 1 ---",
          "[Context before]",
          "6043: ################################################################################",
          "6044: l \"el-GR\" \"Greek (\u0395\u03bb\u03bb\u03b7\u03bd\u03b9\u03ba\u03ac)\" 0x0408",
          "6046: b \"en-US\"",
          "6048: # Main dialog",
          "",
          "[Removed Lines]",
          "6045: v 1.0.21",
          "",
          "[Added Lines]",
          "6045: v 1.0.22",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "6528: t MSG_292 \"\u03a0\u03b1\u03c1\u03b1\u03ba\u03b1\u03bb\u03ce \u03b5\u03c0\u03b9\u03bb\u03ad\u03be\u03c4\u03b5 \u03c4\u03b7\u03bd \u03ad\u03ba\u03b4\u03bf\u03c3\u03b7 \u03c4\u03c9\u03bd Windows \u03c0\u03bf\u03c5 \u03b8\u03ad\u03bb\u03b5\u03c4\u03b5 \u03bd\u03b1 \u03b5\u03b3\u03ba\u03b1\u03c4\u03b1\u03c3\u03c4\u03ae\u03c3\u03b5\u03c4\u03b5:\"",
          "6529: t MSG_293 \"\u039c\u03b7 \u03c5\u03c0\u03bf\u03c3\u03c4\u03b7\u03c1\u03b9\u03b6\u03cc\u03bc\u03b5\u03bd\u03b7 \u03ad\u03ba\u03b4\u03bf\u03c3\u03b7 Windows.\"",
          "6530: t MSG_294 \"\u03a4\u03bf Rufus \u03b4\u03b5\u03bd \u03c5\u03c0\u03bf\u03c3\u03c4\u03b7\u03c1\u03af\u03b6\u03b5\u03b9 \u03b1\u03c5\u03c4\u03ae \u03c4\u03b7\u03bd \u03ad\u03ba\u03b4\u03bf\u03c3\u03b7 \u03c4\u03c9\u03bd Windows.\"",
          "6532: ################################################################################",
          "6533: l \"he-IL\" \"Hebrew (\u05e2\u05d1\u05e8\u05d9\u05ea)\" 0x040d",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "6531: t MSG_295 \"\u03a0\u03c1\u03bf\u03c3\u03bf\u03c7\u03ae: \u0391\u03bd\u03b5\u03c0\u03af\u03c3\u03b7\u03bc\u03b7 \u03ad\u03ba\u03b4\u03bf\u03c3\u03b7!\"",
          "6532: t MSG_296 \"\u0391\u03c5\u03c4\u03ae \u03b7 \u03ad\u03ba\u03b4\u03bf\u03c3\u03b7 \u03c4\u03bf\u03c5 Rufus \u03b4\u03b5\u03bd \u03ad\u03c7\u03b5\u03b9 \u03b4\u03b7\u03bc\u03b9\u03bf\u03c5\u03c1\u03b3\u03b7\u03b8\u03b5\u03af \u03b1\u03c0\u03bf \u03c4\u03bf\u03c5\u03c2 \u03b5\u03c0\u03af\u03c3\u03b7\u03bc\u03bf\u03c5\u03c2 \u03c0\u03c1\u03bf\u03b3\u03c1\u03b1\u03bc\u03bc\u03b1\u03c4\u03b9\u03c3\u03c4\u03ad\u03c2.\\n\\n \u0395\u03af\u03c3\u03c4\u03b5 \u03c3\u03af\u03b3\u03bf\u03c5\u03c1\u03bf\u03b9 \u03bf\u03c4\u03b9 \u03b8\u03ad\u03bb\u03b5\u03c4\u03b5 \u03bd\u03b1 \u03b5\u03ba\u03c4\u03b5\u03bb\u03ad\u03c3\u03b5\u03c4\u03b5 \u03c4\u03bf \u03c0\u03c1\u03cc\u03b3\u03c1\u03b1\u03bc\u03bc\u03b1?\"",
          "6533: t MSG_297 \"\u03a4\u03bf \u03b1\u03c1\u03c7\u03b5\u03af\u03bf ISO \u03b4\u03b5\u03bd \u03b5\u03af\u03bd\u03b1\u03b9 \u03ad\u03b3\u03ba\u03c5\u03c1\u03bf/\u03bf\u03bb\u03cc\u03ba\u03bb\u03b7\u03c1\u03bf.\"",
          "6534: t MSG_298 \"\u03a4\u03bf \u03b1\u03c1\u03c7\u03b5\u03af\u03bf ISO \u03c0\u03bf\u03c5 \u03b5\u03c0\u03b9\u03bb\u03ad\u03be\u03b1\u03c4\u03b5 \u03b4\u03b5\u03bd \u03b5\u03b9\u03bd\u03b1\u03b9 \u03ad\u03b3\u03ba\u03c5\u03c1\u03bf/\u03bf\u03bb\u03cc\u03ba\u03bb\u03b7\u03c1\u03bf. %s \u03b1\u03c0\u03cc \u03c4\u03b1 \u03b4\u03b5\u03b4\u03bf\u03bc\u03ad\u03bd\u03b1 \u03c4\u03bf\u03c5 \u03b1\u03c1\u03c7\u03b5\u03af\u03bf\u03c5 \u03bb\u03b5\u03af\u03c0\u03bf\u03c5\u03bd.\\n\\n\u0386\u03bd \u03ba\u03b1\u03c4\u03b5\u03b2\u03ac\u03c3\u03b1\u03c4\u03b5 \u03b1\u03c5\u03c4\u03cc \u03c4\u03bf \u03b1\u03c1\u03c7\u03b5\u03af\u03bf \u03b1\u03c0\u03bf \u03c4\u03bf \u03b4\u03b9\u03b1\u03b4\u03af\u03ba\u03c4\u03c5\u03bf, \"",
          "6535:  \"\u03c0\u03c1\u03bf\u03c3\u03c0\u03b1\u03b8\u03ae\u03c3\u03c4\u03b5 \u03bd\u03b1 \u03b5\u03c0\u03b1\u03bd\u03b1\u03bb\u03ac\u03b2\u03b5\u03c4\u03b5 \u03c4\u03b7\u03bd \u03bb\u03ae\u03c8\u03b7 \u03c4\u03bf\u03c5 \u03b1\u03c1\u03c7\u03b5\u03af\u03bf\u03c5. \u0392\u03b5\u03b2\u03b1\u03b9\u03c9\u03b8\u03b5\u03af\u03c4\u03b5 \u03cc\u03c4\u03b9 \u03bf\u03b9 MD5 \u03ae SHA \u03c3\u03c6\u03c1\u03b1\u03b3\u03af\u03b4\u03b5\u03c2 \u03c4\u03bf\u03c5 \u03b1\u03c1\u03c7\u03b5\u03af\u03bf\u03c5 \u03c0\u03bf\u03c5 \u03ba\u03b1\u03c4\u03b5\u03b2\u03ac\u03c3\u03b1\u03c4\u03b5 \u03b5\u03af\u03bd\u03b1\u03b9 \u03af\u03b4\u03b9\u03b5\u03c2 \u03bc\u03b5 \u03b1\u03c5\u03c4\u03b5\u03c2 \u03c4\u03bf\u03c5 \u03b1\u03c1\u03c7\u03b5\u03b9\u03bf\u03c5 \"",
          "6536:  \"\u03c0\u03bf\u03c5 \u03b8\u03ad\u03bb\u03b1\u03c4\u03b5 \u03bd\u03b1 \u03ba\u03b1\u03c4\u03b5\u03b2\u03ac\u03c3\u03b5\u03c4\u03b5.\\n\\n\u039c\u03c0\u03bf\u03c1\u03b5\u03af\u03c4\u03b5 \u03bd\u03b1 \u03b5\u03bb\u03ad\u03b3\u03be\u03b5\u03c4\u03b5 \u03c4\u03b9\u03c2 \u03c3\u03c6\u03c1\u03b1\u03b3\u03af\u03b4\u03b5\u03c2 MD5 \u03ae SHA \u03bc\u03ad\u03c3\u03c9 \u03c4\u03bf\u03c5 Rufus \u03c0\u03b1\u03c4\u03ce\u03bd\u03c4\u03b1\u03c2 \u03c4\u03bf \u03ba\u03bf\u03c5\u03bc\u03c0\u03af '#'.\"",
          "",
          "---------------"
        ],
        "src/rufus.rc||src/rufus.rc": [
          "File: src/rufus.rc -> src/rufus.rc",
          "--- Hunk 1 ---",
          "[Context before]",
          "33: IDD_DIALOG DIALOGEX 12, 12, 242, 376",
          "34: STYLE DS_SETFONT | DS_MODALFRAME | DS_CENTER | WS_MINIMIZEBOX | WS_POPUP | WS_CAPTION | WS_SYSMENU",
          "35: EXSTYLE WS_EX_ACCEPTFILES",
          "37: FONT 8, \"Segoe UI Symbol\", 400, 0, 0x0",
          "38: BEGIN",
          "39:     LTEXT           \"Device\",IDS_DEVICE_TXT,9,6,200,8",
          "",
          "[Removed Lines]",
          "36: CAPTION \"Rufus 2.16.1166\"",
          "",
          "[Added Lines]",
          "36: CAPTION \"Rufus 2.16.1167\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "368: VS_VERSION_INFO VERSIONINFO",
          "371:  FILEFLAGSMASK 0x3fL",
          "372: #ifdef _DEBUG",
          "373:  FILEFLAGS 0x1L",
          "",
          "[Removed Lines]",
          "369:  FILEVERSION 2,16,1166,0",
          "370:  PRODUCTVERSION 2,16,1166,0",
          "",
          "[Added Lines]",
          "369:  FILEVERSION 2,16,1167,0",
          "370:  PRODUCTVERSION 2,16,1167,0",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "384:         BEGIN",
          "385:             VALUE \"CompanyName\", \"Akeo Consulting (http://akeo.ie)\"",
          "386:             VALUE \"FileDescription\", \"Rufus\"",
          "388:             VALUE \"InternalName\", \"Rufus\"",
          "389:             VALUE \"LegalCopyright\", \"\ufffd 2011-2017 Pete Batard (GPL v3)\"",
          "390:             VALUE \"LegalTrademarks\", \"http://www.gnu.org/copyleft/gpl.html\"",
          "391:             VALUE \"OriginalFilename\", \"rufus.exe\"",
          "392:             VALUE \"ProductName\", \"Rufus\"",
          "394:         END",
          "395:     END",
          "396:     BLOCK \"VarFileInfo\"",
          "",
          "[Removed Lines]",
          "387:             VALUE \"FileVersion\", \"2.16.1166\"",
          "393:             VALUE \"ProductVersion\", \"2.16.1166\"",
          "",
          "[Added Lines]",
          "387:             VALUE \"FileVersion\", \"2.16.1167\"",
          "393:             VALUE \"ProductVersion\", \"2.16.1167\"",
          "",
          "---------------"
        ]
      }
    }
  ]
}