{
  "cve_id": "CVE-2016-7124",
  "cve_desc": "ext/standard/var_unserializer.c in PHP before 5.6.25 and 7.x before 7.0.10 mishandles certain invalid objects, which allows remote attackers to cause a denial of service or possibly have unspecified other impact via crafted serialized data that leads to a (1) __destruct call or (2) magic method call.",
  "repo": "php/php-src",
  "patch_hash": "448c9be157f4147e121f1a2a524536c75c9c6059",
  "patch_info": {
    "commit_hash": "448c9be157f4147e121f1a2a524536c75c9c6059",
    "repo": "php/php-src",
    "commit_url": "https://github.com/php/php-src/commit/448c9be157f4147e121f1a2a524536c75c9c6059",
    "files": [
      "ext/standard/tests/strings/bug72663.phpt",
      "ext/standard/tests/strings/bug72663_2.phpt",
      "ext/standard/var_unserializer.c",
      "ext/standard/var_unserializer.re"
    ],
    "message": "Fix bug #72663 - destroy broken object when unserializing",
    "before_after_code_files": [
      "ext/standard/tests/strings/bug72663.phpt||ext/standard/tests/strings/bug72663.phpt",
      "ext/standard/tests/strings/bug72663_2.phpt||ext/standard/tests/strings/bug72663_2.phpt",
      "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
      "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
    ]
  },
  "patch_diff": {
    "ext/standard/tests/strings/bug72663.phpt||ext/standard/tests/strings/bug72663.phpt": [
      "File: ext/standard/tests/strings/bug72663.phpt -> ext/standard/tests/strings/bug72663.phpt",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: --TEST--",
      "2: Bug #72663: Create an Unexpected Object and Don't Invoke __wakeup() in Deserialization",
      "3: --FILE--",
      "4: <?php",
      "5: class obj implements Serializable {",
      "6:     var $data;",
      "7:     function serialize() {",
      "8:         return serialize($this->data);",
      "9:     }",
      "10:     function unserialize($data) {",
      "11:         $this->data = unserialize($data);",
      "12:     }",
      "13: }",
      "15: $inner = 'a:1:{i:0;O:9:\"Exception\":2:{s:7:\"'.\"\\0\".'*'.\"\\0\".'file\";R:4;}';",
      "16: $exploit = 'a:2:{i:0;C:3:\"obj\":'.strlen($inner).':{'.$inner.'}i:1;R:4;}';",
      "18: $data = unserialize($exploit);",
      "19: echo $data[1];",
      "20: ?>",
      "21: DONE",
      "22: --EXPECTF--",
      "23: Notice: unserialize(): Unexpected end of serialized data in %sbug72663.php on line %d",
      "25: Notice: unserialize(): Error at offset 46 of 47 bytes in %sbug72663.php on line %d",
      "26: DONE",
      "",
      "---------------"
    ],
    "ext/standard/tests/strings/bug72663_2.phpt||ext/standard/tests/strings/bug72663_2.phpt": [
      "File: ext/standard/tests/strings/bug72663_2.phpt -> ext/standard/tests/strings/bug72663_2.phpt",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: --TEST--",
      "2: Bug #72663: Create an Unexpected Object and Don't Invoke __wakeup() in Deserialization",
      "3: --FILE--",
      "4: <?php",
      "6: ini_set('session.serialize_handler', 'php_serialize');",
      "7: session_start();",
      "8: $sess = 'O:9:\"Exception\":2:{s:7:\"'.\"\\0\".'*'.\"\\0\".'file\";R:1;}';",
      "9: session_decode($sess);",
      "10: var_dump($_SESSION);",
      "11: ?>",
      "12: DONE",
      "13: --EXPECTF--",
      "14: Notice: session_decode(): Unexpected end of serialized data in %sbug72663_2.php on line %d",
      "15: array(0) {",
      "16: }",
      "17: DONE",
      "",
      "---------------"
    ],
    "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
      "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "434:  }",
      "436:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_OBJPROP_PP(rval), elements, 1)) {",
      "437:   return 0;",
      "438:  }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "438:      zend_hash_clean(Z_OBJPROP_PP(rval));",
      "439:      ZVAL_NULL(*rval);",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "486: {",
      "487:  YYCTYPE yych;",
      "488:  static const unsigned char yybm[] = {",
      "",
      "[Removed Lines]",
      "485: #line 486 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "488: #line 489 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "542:  yych = *(YYMARKER = ++YYCURSOR);",
      "543:  if (yych == ':') goto yy95;",
      "544: yy3:",
      "546:  { return 0; }",
      "548: yy4:",
      "549:  yych = *(YYMARKER = ++YYCURSOR);",
      "550:  if (yych == ':') goto yy89;",
      "",
      "[Removed Lines]",
      "545: #line 851 \"ext/standard/var_unserializer.re\"",
      "547: #line 548 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "548: #line 854 \"ext/standard/var_unserializer.re\"",
      "550: #line 551 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "587:  goto yy3;",
      "588: yy14:",
      "589:  ++YYCURSOR;",
      "591:  {",
      "593:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
      "595: }",
      "597: yy16:",
      "598:  yych = *++YYCURSOR;",
      "599:  goto yy3;",
      "",
      "[Removed Lines]",
      "590: #line 845 \"ext/standard/var_unserializer.re\"",
      "596: #line 597 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "593: #line 848 \"ext/standard/var_unserializer.re\"",
      "599: #line 600 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "619:  if (yybm[0+yych] & 128) {",
      "620:   goto yy20;",
      "621:  }",
      "623:  yych = *++YYCURSOR;",
      "624:  if (yych != '\"') goto yy18;",
      "625:  ++YYCURSOR;",
      "627:  {",
      "628:  size_t len, len2, len3, maxlen;",
      "629:  long elements;",
      "",
      "[Removed Lines]",
      "622:  if (yych != ':') goto yy18;",
      "626: #line 698 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "625:  if (yych <= '/') goto yy18;",
      "626:  if (yych >= ';') goto yy18;",
      "630: #line 701 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "771:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
      "772: }",
      "774: yy25:",
      "775:  yych = *++YYCURSOR;",
      "776:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "773: #line 774 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "777: #line 778 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "795:  yych = *++YYCURSOR;",
      "796:  if (yych != '\"') goto yy18;",
      "797:  ++YYCURSOR;",
      "799:  {",
      "800:     if (!var_hash) return 0;",
      "",
      "[Removed Lines]",
      "798: #line 689 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "802: #line 692 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 8 ---",
      "[Context before]",
      "804:  return object_common2(UNSERIALIZE_PASSTHRU,",
      "805:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
      "806: }",
      "808: yy32:",
      "809:  yych = *++YYCURSOR;",
      "810:  if (yych == '+') goto yy33;",
      "",
      "[Removed Lines]",
      "807: #line 808 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "811: #line 812 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 9 ---",
      "[Context before]",
      "825:  yych = *++YYCURSOR;",
      "826:  if (yych != '{') goto yy18;",
      "827:  ++YYCURSOR;",
      "829:  {",
      "830:  long elements = parse_iv(start + 2);",
      "",
      "[Removed Lines]",
      "828: #line 668 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "832: #line 671 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 10 ---",
      "[Context before]",
      "847:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
      "848: }",
      "850: yy39:",
      "851:  yych = *++YYCURSOR;",
      "852:  if (yych == '+') goto yy40;",
      "",
      "[Removed Lines]",
      "849: #line 850 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "853: #line 854 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 11 ---",
      "[Context before]",
      "867:  yych = *++YYCURSOR;",
      "868:  if (yych != '\"') goto yy18;",
      "869:  ++YYCURSOR;",
      "871:  {",
      "872:  size_t len, maxlen;",
      "873:  char *str;",
      "",
      "[Removed Lines]",
      "870: #line 633 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "874: #line 636 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 12 ---",
      "[Context before]",
      "902:  ZVAL_STRINGL(*rval, str, len, 0);",
      "903:  return 1;",
      "904: }",
      "906: yy46:",
      "907:  yych = *++YYCURSOR;",
      "908:  if (yych == '+') goto yy47;",
      "",
      "[Removed Lines]",
      "905: #line 906 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "909: #line 910 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 13 ---",
      "[Context before]",
      "923:  yych = *++YYCURSOR;",
      "924:  if (yych != '\"') goto yy18;",
      "925:  ++YYCURSOR;",
      "927:  {",
      "928:  size_t len, maxlen;",
      "929:  char *str;",
      "",
      "[Removed Lines]",
      "926: #line 600 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "930: #line 603 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 14 ---",
      "[Context before]",
      "956:  ZVAL_STRINGL(*rval, str, len, 1);",
      "957:  return 1;",
      "958: }",
      "960: yy53:",
      "961:  yych = *++YYCURSOR;",
      "962:  if (yych <= '/') {",
      "",
      "[Removed Lines]",
      "959: #line 960 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "963: #line 964 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 15 ---",
      "[Context before]",
      "1044:  }",
      "1045: yy63:",
      "1046:  ++YYCURSOR;",
      "1048:  {",
      "1049: #if SIZEOF_LONG == 4",
      "1050: use_double:",
      "",
      "[Removed Lines]",
      "1047: #line 590 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1051: #line 593 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 16 ---",
      "[Context before]",
      "1054:  ZVAL_DOUBLE(*rval, zend_strtod((const char *)start + 2, NULL));",
      "1055:  return 1;",
      "1056: }",
      "1058: yy65:",
      "1059:  yych = *++YYCURSOR;",
      "1060:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1057: #line 1058 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1061: #line 1062 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 17 ---",
      "[Context before]",
      "1113:  yych = *++YYCURSOR;",
      "1114:  if (yych != ';') goto yy18;",
      "1115:  ++YYCURSOR;",
      "1117:  {",
      "1119:  INIT_PZVAL(*rval);",
      "",
      "[Removed Lines]",
      "1116: #line 575 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1120: #line 578 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 18 ---",
      "[Context before]",
      "1129:  return 1;",
      "1130: }",
      "1132: yy76:",
      "1133:  yych = *++YYCURSOR;",
      "1134:  if (yych == 'N') goto yy73;",
      "",
      "[Removed Lines]",
      "1131: #line 1132 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1135: #line 1136 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 19 ---",
      "[Context before]",
      "1155:  if (yych <= '9') goto yy79;",
      "1156:  if (yych != ';') goto yy18;",
      "1157:  ++YYCURSOR;",
      "1159:  {",
      "1160: #if SIZEOF_LONG == 4",
      "1161:  int digits = YYCURSOR - start - 3;",
      "",
      "[Removed Lines]",
      "1158: #line 548 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1162: #line 551 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 20 ---",
      "[Context before]",
      "1182:  ZVAL_LONG(*rval, parse_iv(start + 2));",
      "1183:  return 1;",
      "1184: }",
      "1186: yy83:",
      "1187:  yych = *++YYCURSOR;",
      "1188:  if (yych <= '/') goto yy18;",
      "",
      "[Removed Lines]",
      "1185: #line 1186 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1189: #line 1190 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 21 ---",
      "[Context before]",
      "1190:  yych = *++YYCURSOR;",
      "1191:  if (yych != ';') goto yy18;",
      "1192:  ++YYCURSOR;",
      "1194:  {",
      "1196:  INIT_PZVAL(*rval);",
      "1197:  ZVAL_BOOL(*rval, parse_iv(start + 2));",
      "1198:  return 1;",
      "1199: }",
      "1201: yy87:",
      "1202:  ++YYCURSOR;",
      "1204:  {",
      "1206:  INIT_PZVAL(*rval);",
      "1207:  ZVAL_NULL(*rval);",
      "1208:  return 1;",
      "1209: }",
      "1211: yy89:",
      "1212:  yych = *++YYCURSOR;",
      "1213:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1193: #line 541 \"ext/standard/var_unserializer.re\"",
      "1200: #line 1201 \"ext/standard/var_unserializer.c\"",
      "1203: #line 534 \"ext/standard/var_unserializer.re\"",
      "1210: #line 1211 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1197: #line 544 \"ext/standard/var_unserializer.re\"",
      "1204: #line 1205 \"ext/standard/var_unserializer.c\"",
      "1207: #line 537 \"ext/standard/var_unserializer.re\"",
      "1214: #line 1215 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 22 ---",
      "[Context before]",
      "1230:  if (yych <= '9') goto yy91;",
      "1231:  if (yych != ';') goto yy18;",
      "1232:  ++YYCURSOR;",
      "1234:  {",
      "1235:  long id;",
      "",
      "[Removed Lines]",
      "1233: #line 511 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1237: #line 514 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 23 ---",
      "[Context before]",
      "1254:  return 1;",
      "1255: }",
      "1257: yy95:",
      "1258:  yych = *++YYCURSOR;",
      "1259:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1256: #line 1257 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1260: #line 1261 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 24 ---",
      "[Context before]",
      "1276:  if (yych <= '9') goto yy97;",
      "1277:  if (yych != ';') goto yy18;",
      "1278:  ++YYCURSOR;",
      "1280:  {",
      "1281:  long id;",
      "",
      "[Removed Lines]",
      "1279: #line 490 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1283: #line 493 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 25 ---",
      "[Context before]",
      "1298:  return 1;",
      "1299: }",
      "1301: }",
      "1305:  return 0;",
      "",
      "[Removed Lines]",
      "1300: #line 1301 \"ext/standard/var_unserializer.c\"",
      "1302: #line 853 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1304: #line 1305 \"ext/standard/var_unserializer.c\"",
      "1306: #line 856 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------"
    ],
    "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
      "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
      "--- Hunk 1 ---",
      "[Context before]",
      "438:  }",
      "440:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_OBJPROP_PP(rval), elements, 1)) {",
      "441:   return 0;",
      "442:  }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "442:      zend_hash_clean(Z_OBJPROP_PP(rval));",
      "443:      ZVAL_NULL(*rval);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "d76b293ac71aa5bd4e9a433192afef6e0dd5a4ee",
      "candidate_info": {
        "commit_hash": "d76b293ac71aa5bd4e9a433192afef6e0dd5a4ee",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/d76b293ac71aa5bd4e9a433192afef6e0dd5a4ee",
        "files": [
          "ext/standard/var_unserializer.c"
        ],
        "message": "forgot to commit this one",
        "before_after_code_files": [
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "392:    return 0;",
          "393:   }",
          "395:   if (elements && *(*p-1) != ';' && *(*p-1) != '}') {",
          "396:    (*p)--;",
          "397:    return 0;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "395:   var_push_dtor(var_hash, data);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "522:  start = cursor;",
          "526: {",
          "527:  YYCTYPE yych;",
          "528:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "525: #line 526 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "527: #line 528 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "582:  yych = *(YYMARKER = ++YYCURSOR);",
          "583:  if (yych == ':') goto yy95;",
          "584: yy3:",
          "586:  { return 0; }",
          "588: yy4:",
          "589:  yych = *(YYMARKER = ++YYCURSOR);",
          "590:  if (yych == ':') goto yy89;",
          "",
          "[Removed Lines]",
          "585: #line 873 \"ext/standard/var_unserializer.re\"",
          "587: #line 588 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "587: #line 875 \"ext/standard/var_unserializer.re\"",
          "589: #line 590 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "627:  goto yy3;",
          "628: yy14:",
          "629:  ++YYCURSOR;",
          "631:  {",
          "633:  php_error_docref(NULL, E_NOTICE, \"Unexpected end of serialized data\");",
          "635: }",
          "637: yy16:",
          "638:  yych = *++YYCURSOR;",
          "639:  goto yy3;",
          "",
          "[Removed Lines]",
          "630: #line 867 \"ext/standard/var_unserializer.re\"",
          "636: #line 637 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "632: #line 869 \"ext/standard/var_unserializer.re\"",
          "638: #line 639 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "659:  if (yybm[0+yych] & 128) {",
          "660:   goto yy20;",
          "661:  }",
          "663:  yych = *++YYCURSOR;",
          "664:  if (yych != '\"') goto yy18;",
          "665:  ++YYCURSOR;",
          "667:  {",
          "668:  size_t len, len2, len3, maxlen;",
          "669:  zend_long elements;",
          "",
          "[Removed Lines]",
          "662:  if (yych != ':') goto yy18;",
          "666: #line 722 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "664:  if (yych <= '/') goto yy18;",
          "665:  if (yych >= ';') goto yy18;",
          "669: #line 724 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "809:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "810: }",
          "812: yy25:",
          "813:  yych = *++YYCURSOR;",
          "814:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "811: #line 812 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "814: #line 815 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "833:  yych = *++YYCURSOR;",
          "834:  if (yych != '\"') goto yy18;",
          "835:  ++YYCURSOR;",
          "837:  {",
          "",
          "[Removed Lines]",
          "836: #line 714 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "839: #line 716 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "841:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "842:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "843: }",
          "845: yy32:",
          "846:  yych = *++YYCURSOR;",
          "847:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "844: #line 845 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "847: #line 848 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "862:  yych = *++YYCURSOR;",
          "863:  if (yych != '{') goto yy18;",
          "864:  ++YYCURSOR;",
          "866:  {",
          "867:  zend_long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "865: #line 693 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "868: #line 695 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "884:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "885: }",
          "887: yy39:",
          "888:  yych = *++YYCURSOR;",
          "889:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "886: #line 887 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "889: #line 890 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "904:  yych = *++YYCURSOR;",
          "905:  if (yych != '\"') goto yy18;",
          "906:  ++YYCURSOR;",
          "908:  {",
          "909:  size_t len, maxlen;",
          "910:  zend_string *str;",
          "",
          "[Removed Lines]",
          "907: #line 665 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "910: #line 667 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "932:  ZVAL_STR(rval, str);",
          "933:  return 1;",
          "934: }",
          "936: yy46:",
          "937:  yych = *++YYCURSOR;",
          "938:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "935: #line 936 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "938: #line 939 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "953:  yych = *++YYCURSOR;",
          "954:  if (yych != '\"') goto yy18;",
          "955:  ++YYCURSOR;",
          "957:  {",
          "958:  size_t len, maxlen;",
          "959:  char *str;",
          "",
          "[Removed Lines]",
          "956: #line 638 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "959: #line 640 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "980:  ZVAL_STRINGL(rval, str, len);",
          "981:  return 1;",
          "982: }",
          "984: yy53:",
          "985:  yych = *++YYCURSOR;",
          "986:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "983: #line 984 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "986: #line 987 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1068:  }",
          "1069: yy63:",
          "1070:  ++YYCURSOR;",
          "1072:  {",
          "1073: #if SIZEOF_ZEND_LONG == 4",
          "1074: use_double:",
          "",
          "[Removed Lines]",
          "1071: #line 629 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1074: #line 631 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1077:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1078:  return 1;",
          "1079: }",
          "1081: yy65:",
          "1082:  yych = *++YYCURSOR;",
          "1083:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1080: #line 1081 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1083: #line 1084 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1136:  yych = *++YYCURSOR;",
          "1137:  if (yych != ';') goto yy18;",
          "1138:  ++YYCURSOR;",
          "1140:  {",
          "",
          "[Removed Lines]",
          "1139: #line 613 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1142: #line 615 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "1153:  return 1;",
          "1154: }",
          "1156: yy76:",
          "1157:  yych = *++YYCURSOR;",
          "1158:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1155: #line 1156 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1158: #line 1159 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1179:  if (yych <= '9') goto yy79;",
          "1180:  if (yych != ';') goto yy18;",
          "1181:  ++YYCURSOR;",
          "1183:  {",
          "1184: #if SIZEOF_ZEND_LONG == 4",
          "1185:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1182: #line 587 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1185: #line 589 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1205:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1206:  return 1;",
          "1207: }",
          "1209: yy83:",
          "1210:  yych = *++YYCURSOR;",
          "1211:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1208: #line 1209 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1211: #line 1212 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "1213:  yych = *++YYCURSOR;",
          "1214:  if (yych != ';') goto yy18;",
          "1215:  ++YYCURSOR;",
          "1217:  {",
          "1219:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1220:  return 1;",
          "1221: }",
          "1223: yy87:",
          "1224:  ++YYCURSOR;",
          "1226:  {",
          "1228:  ZVAL_NULL(rval);",
          "1229:  return 1;",
          "1230: }",
          "1232: yy89:",
          "1233:  yych = *++YYCURSOR;",
          "1234:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1216: #line 581 \"ext/standard/var_unserializer.re\"",
          "1222: #line 1223 \"ext/standard/var_unserializer.c\"",
          "1225: #line 575 \"ext/standard/var_unserializer.re\"",
          "1231: #line 1232 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1219: #line 583 \"ext/standard/var_unserializer.re\"",
          "1225: #line 1226 \"ext/standard/var_unserializer.c\"",
          "1228: #line 577 \"ext/standard/var_unserializer.re\"",
          "1234: #line 1235 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "1251:  if (yych <= '9') goto yy91;",
          "1252:  if (yych != ';') goto yy18;",
          "1253:  ++YYCURSOR;",
          "1255:  {",
          "1256:  zend_long id;",
          "",
          "[Removed Lines]",
          "1254: #line 552 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1257: #line 554 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "1275:  return 1;",
          "1276: }",
          "1278: yy95:",
          "1279:  yych = *++YYCURSOR;",
          "1280:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1277: #line 1278 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1280: #line 1281 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "1297:  if (yych <= '9') goto yy97;",
          "1298:  if (yych != ';') goto yy18;",
          "1299:  ++YYCURSOR;",
          "1301:  {",
          "1302:  zend_long id;",
          "",
          "[Removed Lines]",
          "1300: #line 530 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1303: #line 532 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 25 ---",
          "[Context before]",
          "1320:  return 1;",
          "1321: }",
          "1323: }",
          "1327:  return 0;",
          "",
          "[Removed Lines]",
          "1322: #line 1323 \"ext/standard/var_unserializer.c\"",
          "1324: #line 875 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1325: #line 1326 \"ext/standard/var_unserializer.c\"",
          "1327: #line 877 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "2c567eae283308bbc1cb9836546b8dbf0146932c",
      "candidate_info": {
        "commit_hash": "2c567eae283308bbc1cb9836546b8dbf0146932c",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/2c567eae283308bbc1cb9836546b8dbf0146932c",
        "files": [
          "ext/standard/tests/serialize/bug74101.phpt",
          "ext/standard/tests/serialize/bug74614.phpt",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Merge branch 'PHP-7.0' into PHP-7.1\n\n* PHP-7.0:\n  Fixed bug #74101 and bug #74614",
        "before_after_code_files": [
          "ext/standard/tests/serialize/bug74101.phpt||ext/standard/tests/serialize/bug74101.phpt",
          "ext/standard/tests/serialize/bug74614.phpt||ext/standard/tests/serialize/bug74614.phpt",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/tests/serialize/bug74101.phpt||ext/standard/tests/serialize/bug74101.phpt": [
          "File: ext/standard/tests/serialize/bug74101.phpt -> ext/standard/tests/serialize/bug74101.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #74101: Unserialize Heap Use-After-Free (READ: 1) in zval_get_type",
          "3: --FILE--",
          "4: <?php",
          "5: $s = 'O:9:\"Exception\":799999999999999999999999999997:0i:0;a:0:{}i:2;i:0;i:0;R:2;';",
          "6: var_dump(unserialize($s));",
          "7: ?>",
          "8: --EXPECTF--",
          "9: Notice: unserialize(): Error at offset 48 of 74 bytes in %s on line %d",
          "10: bool(false)",
          "",
          "---------------"
        ],
        "ext/standard/tests/serialize/bug74614.phpt||ext/standard/tests/serialize/bug74614.phpt": [
          "File: ext/standard/tests/serialize/bug74614.phpt -> ext/standard/tests/serialize/bug74614.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #74614: Use-after-free in PHP7's unserialize()",
          "3: --FILE--",
          "4: <?php",
          "6: unserialize('a:3020000000000000000000000000000001:{i:0;a:0:{}i:1;i:2;i:2;i:3;i:3;i:4;i:4;i:5;i:5;i:6;i:6;i:7;i:7;i:8;i:8;R:2;}');",
          "8: ?>",
          "9: --EXPECTF--",
          "10: Notice: unserialize(): Error at offset 38 of 113 bytes in %s on line %d",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "548:   && zend_hash_str_exists(&Z_OBJCE_P(rval)->function_table, \"__wakeup\", sizeof(\"__wakeup\")-1);",
          "550:  ht = Z_OBJPROP_P(rval);",
          "551:  zend_hash_extend(ht, zend_hash_num_elements(ht) + elements, (ht->u.flags & HASH_FLAG_PACKED));",
          "552:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, ht, elements, 1)) {",
          "553:   if (has_wakeup) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "551:  if (elements >= HT_MAX_SIZE - zend_hash_num_elements(ht)) {",
          "552:   return 0;",
          "553:  }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "617:  start = cursor;",
          "621: {",
          "622:  YYCTYPE yych;",
          "623:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "620: #line 621 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "624: #line 625 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "675: yy2:",
          "676:  ++YYCURSOR;",
          "677: yy3:",
          "679:  { return 0; }",
          "681: yy4:",
          "682:  yych = *(YYMARKER = ++YYCURSOR);",
          "683:  if (yych == ':') goto yy17;",
          "",
          "[Removed Lines]",
          "678: #line 998 \"ext/standard/var_unserializer.re\"",
          "680: #line 681 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "682: #line 1002 \"ext/standard/var_unserializer.re\"",
          "684: #line 685 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "724:  goto yy3;",
          "725: yy15:",
          "726:  ++YYCURSOR;",
          "728:  {",
          "730:  php_error_docref(NULL, E_NOTICE, \"Unexpected end of serialized data\");",
          "732: }",
          "734: yy17:",
          "735:  yych = *++YYCURSOR;",
          "736:  if (yybm[0+yych] & 128) {",
          "",
          "[Removed Lines]",
          "727: #line 992 \"ext/standard/var_unserializer.re\"",
          "733: #line 734 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "731: #line 996 \"ext/standard/var_unserializer.re\"",
          "737: #line 738 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "742:  goto yy3;",
          "743: yy19:",
          "744:  ++YYCURSOR;",
          "746:  {",
          "748:  ZVAL_NULL(rval);",
          "749:  return 1;",
          "750: }",
          "752: yy21:",
          "753:  yych = *++YYCURSOR;",
          "754:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "745: #line 676 \"ext/standard/var_unserializer.re\"",
          "751: #line 752 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "749: #line 680 \"ext/standard/var_unserializer.re\"",
          "755: #line 756 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "998:  goto yy18;",
          "999: yy63:",
          "1000:  ++YYCURSOR;",
          "1002:  {",
          "1003:  zend_long id;",
          "",
          "[Removed Lines]",
          "1001: #line 625 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1005: #line 629 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "1025:  return 1;",
          "1026: }",
          "1028: yy65:",
          "1029:  yych = *++YYCURSOR;",
          "1030:  if (yych == '\"') goto yy84;",
          "",
          "[Removed Lines]",
          "1027: #line 1028 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1031: #line 1032 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "1035:  goto yy18;",
          "1036: yy67:",
          "1037:  ++YYCURSOR;",
          "1039:  {",
          "1041:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1042:  return 1;",
          "1043: }",
          "1045: yy69:",
          "1046:  ++YYCURSOR;",
          "1047:  if ((YYLIMIT - YYCURSOR) < 4) YYFILL(4);",
          "",
          "[Removed Lines]",
          "1038: #line 682 \"ext/standard/var_unserializer.re\"",
          "1044: #line 1045 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1042: #line 686 \"ext/standard/var_unserializer.re\"",
          "1048: #line 1049 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "1061:  }",
          "1062: yy71:",
          "1063:  ++YYCURSOR;",
          "1065:  {",
          "1066: #if SIZEOF_ZEND_LONG == 4",
          "1067: use_double:",
          "",
          "[Removed Lines]",
          "1064: #line 730 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1068: #line 734 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "1070:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1071:  return 1;",
          "1072: }",
          "1074: yy73:",
          "1075:  yych = *++YYCURSOR;",
          "1076:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1073: #line 1074 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1077: #line 1078 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "1092:  goto yy18;",
          "1093: yy76:",
          "1094:  ++YYCURSOR;",
          "1096:  {",
          "1097: #if SIZEOF_ZEND_LONG == 4",
          "1098:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1095: #line 688 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1099: #line 692 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "1118:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1119:  return 1;",
          "1120: }",
          "1122: yy78:",
          "1123:  yych = *++YYCURSOR;",
          "1124:  if (yych == '\"') goto yy92;",
          "1125:  goto yy18;",
          "1126: yy79:",
          "1127:  ++YYCURSOR;",
          "1129:  {",
          "1130:  zend_long id;",
          "",
          "[Removed Lines]",
          "1121: #line 1122 \"ext/standard/var_unserializer.c\"",
          "1128: #line 651 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1125: #line 1126 \"ext/standard/var_unserializer.c\"",
          "1132: #line 655 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "1151:  return 1;",
          "1152: }",
          "1154: yy81:",
          "1155:  yych = *++YYCURSOR;",
          "1156:  if (yych == '\"') goto yy94;",
          "1157:  goto yy18;",
          "1158: yy82:",
          "1159:  ++YYCURSOR;",
          "1161:  {",
          "1162:  size_t len, len2, len3, maxlen;",
          "1163:  zend_long elements;",
          "",
          "[Removed Lines]",
          "1153: #line 1154 \"ext/standard/var_unserializer.c\"",
          "1160: #line 840 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1157: #line 1158 \"ext/standard/var_unserializer.c\"",
          "1164: #line 844 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "1310:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "1311: }",
          "1313: yy84:",
          "1314:  ++YYCURSOR;",
          "1316:  {",
          "1317:  size_t len, maxlen;",
          "1318:  zend_string *str;",
          "",
          "[Removed Lines]",
          "1312: #line 1313 \"ext/standard/var_unserializer.c\"",
          "1315: #line 771 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1316: #line 1317 \"ext/standard/var_unserializer.c\"",
          "1319: #line 775 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1346:  ZVAL_STR(rval, str);",
          "1347:  return 1;",
          "1348: }",
          "1350: yy86:",
          "1351:  ++YYCURSOR;",
          "1353:  {",
          "1354:  zend_long elements = parse_iv(start + 2);",
          "1357:     if (!var_hash) return 0;",
          "1360:   return 0;",
          "1361:  }",
          "",
          "[Removed Lines]",
          "1349: #line 1350 \"ext/standard/var_unserializer.c\"",
          "1352: #line 805 \"ext/standard/var_unserializer.re\"",
          "1359:  if (elements < 0) {",
          "",
          "[Added Lines]",
          "1353: #line 1354 \"ext/standard/var_unserializer.c\"",
          "1356: #line 809 \"ext/standard/var_unserializer.re\"",
          "1363:  if (elements < 0 || elements >= HT_MAX_SIZE) {",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1374:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "1375: }",
          "1377: yy88:",
          "1378:  yych = *++YYCURSOR;",
          "1379:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1376: #line 1377 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1380: #line 1381 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1398:  goto yy18;",
          "1399: yy92:",
          "1400:  ++YYCURSOR;",
          "1402:  {",
          "1403:  long elements;",
          "1404:     if (!var_hash) return 0;",
          "1406:  elements = object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR);",
          "1408:   return 0;",
          "1409:  }",
          "1410:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "1411: }",
          "1413: yy94:",
          "1414:  ++YYCURSOR;",
          "1416:  {",
          "1417:  size_t len, maxlen;",
          "1418:  char *str;",
          "",
          "[Removed Lines]",
          "1401: #line 829 \"ext/standard/var_unserializer.re\"",
          "1407:  if (elements < 0) {",
          "1412: #line 1413 \"ext/standard/var_unserializer.c\"",
          "1415: #line 739 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1405: #line 833 \"ext/standard/var_unserializer.re\"",
          "1411:  if (elements < 0 || elements >= HT_MAX_SIZE) {",
          "1416: #line 1417 \"ext/standard/var_unserializer.c\"",
          "1419: #line 743 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "1444:  ZVAL_STRINGL(rval, str, len);",
          "1445:  return 1;",
          "1446: }",
          "1448: yy96:",
          "1449:  yych = *++YYCURSOR;",
          "1450:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1447: #line 1448 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1451: #line 1452 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1452:  goto yy18;",
          "1453: yy97:",
          "1454:  ++YYCURSOR;",
          "1456:  {",
          "",
          "[Removed Lines]",
          "1455: #line 714 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1459: #line 718 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1469:  return 1;",
          "1470: }",
          "1472: }",
          "1476:  return 0;",
          "",
          "[Removed Lines]",
          "1471: #line 1472 \"ext/standard/var_unserializer.c\"",
          "1473: #line 1000 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1475: #line 1476 \"ext/standard/var_unserializer.c\"",
          "1477: #line 1004 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "552:   && zend_hash_str_exists(&Z_OBJCE_P(rval)->function_table, \"__wakeup\", sizeof(\"__wakeup\")-1);",
          "554:  ht = Z_OBJPROP_P(rval);",
          "555:  zend_hash_extend(ht, zend_hash_num_elements(ht) + elements, (ht->u.flags & HASH_FLAG_PACKED));",
          "556:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, ht, elements, 1)) {",
          "557:   if (has_wakeup) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "555:  if (elements >= HT_MAX_SIZE - zend_hash_num_elements(ht)) {",
          "556:   return 0;",
          "557:  }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "809:     if (!var_hash) return 0;",
          "812:   return 0;",
          "813:  }",
          "",
          "[Removed Lines]",
          "811:  if (elements < 0) {",
          "",
          "[Added Lines]",
          "815:  if (elements < 0 || elements >= HT_MAX_SIZE) {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "831:     if (!var_hash) return 0;",
          "833:  elements = object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR);",
          "835:   return 0;",
          "836:  }",
          "837:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "",
          "[Removed Lines]",
          "834:  if (elements < 0) {",
          "",
          "[Added Lines]",
          "838:  if (elements < 0 || elements >= HT_MAX_SIZE) {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "8fe171a3e046717ec0109297bcd765bdee3e939c",
      "candidate_info": {
        "commit_hash": "8fe171a3e046717ec0109297bcd765bdee3e939c",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/8fe171a3e046717ec0109297bcd765bdee3e939c",
        "files": [
          "ext/standard/array.c",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Don't allocate memory for empty HashTables.",
        "before_after_code_files": [
          "ext/standard/array.c||ext/standard/array.c",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/array.c||ext/standard/array.c": [
          "File: ext/standard/array.c -> ext/standard/array.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "3308:   }",
          "3309:  } else {",
          "3310:   array_init_size(return_value, zend_hash_num_elements(Z_ARRVAL_P(input)));",
          "3311:   zend_hash_real_init(Z_ARRVAL_P(return_value), 1);",
          "3312:   ZEND_HASH_FILL_PACKED(Z_ARRVAL_P(return_value)) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3311:   if (!zend_hash_num_elements(Z_ARRVAL_P(input))) {",
          "3312:    return;",
          "3313:   }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "3345:  array_init_size(return_value, zend_hash_num_elements(Z_ARRVAL_P(input)));",
          "3346:  zend_hash_real_init(Z_ARRVAL_P(return_value), 1);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3350:  if (!zend_hash_num_elements(Z_ARRVAL_P(input))) {",
          "3351:   return;",
          "3352:  }",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "599:  yych = *(YYMARKER = ++YYCURSOR);",
          "600:  if (yych == ':') goto yy95;",
          "601: yy3:",
          "603:  { return 0; }",
          "604: #line 605 \"ext/standard/var_unserializer.c\"",
          "605: yy4:",
          "",
          "[Removed Lines]",
          "602: #line 893 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "602: #line 895 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "644:  goto yy3;",
          "645: yy14:",
          "646:  ++YYCURSOR;",
          "648:  {",
          "650:  php_error_docref(NULL, E_NOTICE, \"Unexpected end of serialized data\");",
          "",
          "[Removed Lines]",
          "647: #line 887 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "647: #line 889 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "676:  if (yybm[0+yych] & 128) {",
          "677:   goto yy20;",
          "678:  }",
          "681:  yych = *++YYCURSOR;",
          "682:  if (yych != '\"') goto yy18;",
          "683:  ++YYCURSOR;",
          "685:  {",
          "686:  size_t len, len2, len3, maxlen;",
          "687:  zend_long elements;",
          "",
          "[Removed Lines]",
          "679:  if (yych <= '/') goto yy18;",
          "680:  if (yych >= ';') goto yy18;",
          "684: #line 741 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "679:  if (yych != ':') goto yy18;",
          "683: #line 743 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "828:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "829: }",
          "831: yy25:",
          "832:  yych = *++YYCURSOR;",
          "833:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "830: #line 831 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "829: #line 830 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "852:  yych = *++YYCURSOR;",
          "853:  if (yych != '\"') goto yy18;",
          "854:  ++YYCURSOR;",
          "856:  {",
          "857:     if (!var_hash) return 0;",
          "",
          "[Removed Lines]",
          "855: #line 732 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "854: #line 734 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "861:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "862:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "863: }",
          "865: yy32:",
          "866:  yych = *++YYCURSOR;",
          "867:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "864: #line 865 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "863: #line 864 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "896:  array_init_size(rval, elements);",
          "901:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_ARRVAL_P(rval), elements, 0)) {",
          "902:   return 0;",
          "",
          "[Removed Lines]",
          "899:  zend_hash_real_init(Z_ARRVAL_P(rval), 0);",
          "",
          "[Added Lines]",
          "898:  if (elements) {",
          "899:   zend_hash_real_init(Z_ARRVAL_P(rval), 0);",
          "900:  }",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "905:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "906: }",
          "908: yy39:",
          "909:  yych = *++YYCURSOR;",
          "910:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "907: #line 908 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "908: #line 909 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "953:  ZVAL_STR(rval, str);",
          "954:  return 1;",
          "955: }",
          "957: yy46:",
          "958:  yych = *++YYCURSOR;",
          "959:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "956: #line 957 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "957: #line 958 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "1001:  ZVAL_STRINGL(rval, str, len);",
          "1002:  return 1;",
          "1003: }",
          "1005: yy53:",
          "1006:  yych = *++YYCURSOR;",
          "1007:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "1004: #line 1005 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1005: #line 1006 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "1098:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1099:  return 1;",
          "1100: }",
          "1102: yy65:",
          "1103:  yych = *++YYCURSOR;",
          "1104:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1101: #line 1102 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1102: #line 1103 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "1174:  return 1;",
          "1175: }",
          "1177: yy76:",
          "1178:  yych = *++YYCURSOR;",
          "1179:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1176: #line 1177 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1177: #line 1178 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "1226:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1227:  return 1;",
          "1228: }",
          "1230: yy83:",
          "1231:  yych = *++YYCURSOR;",
          "1232:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1229: #line 1230 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1230: #line 1231 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "1240:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1241:  return 1;",
          "1242: }",
          "1244: yy87:",
          "1245:  ++YYCURSOR;",
          "1246: #line 592 \"ext/standard/var_unserializer.re\"",
          "",
          "[Removed Lines]",
          "1243: #line 1244 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1244: #line 1245 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1249:  ZVAL_NULL(rval);",
          "1250:  return 1;",
          "1251: }",
          "1253: yy89:",
          "1254:  yych = *++YYCURSOR;",
          "1255:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1252: #line 1253 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1253: #line 1254 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1296:  return 1;",
          "1297: }",
          "1299: yy95:",
          "1300:  yych = *++YYCURSOR;",
          "1301:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1298: #line 1299 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1299: #line 1300 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1341:  return 1;",
          "1342: }",
          "1344: }",
          "1348:  return 0;",
          "",
          "[Removed Lines]",
          "1343: #line 1344 \"ext/standard/var_unserializer.c\"",
          "1345: #line 895 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1344: #line 1345 \"ext/standard/var_unserializer.c\"",
          "1346: #line 897 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "720:  array_init_size(rval, elements);",
          "725:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_ARRVAL_P(rval), elements, 0)) {",
          "726:   return 0;",
          "",
          "[Removed Lines]",
          "723:  zend_hash_real_init(Z_ARRVAL_P(rval), 0);",
          "",
          "[Added Lines]",
          "723:  if (elements) {",
          "724:   zend_hash_real_init(Z_ARRVAL_P(rval), 0);",
          "725:  }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "747d21cfd2a7414b8d5ace203524f61eab2b8323",
      "candidate_info": {
        "commit_hash": "747d21cfd2a7414b8d5ace203524f61eab2b8323",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/747d21cfd2a7414b8d5ace203524f61eab2b8323",
        "files": [
          "ext/standard/php_var.h",
          "ext/standard/tests/serialize/bug72785.phpt",
          "ext/standard/tests/serialize/unserialize_error_001.phpt",
          "ext/standard/var.c",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Fix bug #72785 - allowed_classes only applies to outermost unserialize()",
        "before_after_code_files": [
          "ext/standard/php_var.h||ext/standard/php_var.h",
          "ext/standard/tests/serialize/bug72785.phpt||ext/standard/tests/serialize/bug72785.phpt",
          "ext/standard/tests/serialize/unserialize_error_001.phpt||ext/standard/tests/serialize/unserialize_error_001.phpt",
          "ext/standard/var.c||ext/standard/var.c",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/php_var.h||ext/standard/php_var.h": [
          "File: ext/standard/php_var.h -> ext/standard/php_var.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "45: PHPAPI int php_var_unserialize(zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash);",
          "46: PHPAPI int php_var_unserialize_ref(zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash);",
          "47: PHPAPI int php_var_unserialize_intern(zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash);",
          "50: PHPAPI php_serialize_data_t php_var_serialize_init(void);",
          "51: PHPAPI void php_var_serialize_destroy(php_serialize_data_t d);",
          "52: PHPAPI php_unserialize_data_t php_var_unserialize_init(void);",
          "53: PHPAPI void php_var_unserialize_destroy(php_unserialize_data_t d);",
          "55: #define PHP_VAR_SERIALIZE_INIT(d) \\",
          "56:  (d) = php_var_serialize_init()",
          "",
          "[Removed Lines]",
          "48: PHPAPI int php_var_unserialize_ex(zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash, HashTable *classes);",
          "",
          "[Added Lines]",
          "53: PHPAPI void php_var_unserialize_set_allowed_classes(php_unserialize_data_t d, HashTable *classes);",
          "",
          "---------------"
        ],
        "ext/standard/tests/serialize/bug72785.phpt||ext/standard/tests/serialize/bug72785.phpt": [
          "File: ext/standard/tests/serialize/bug72785.phpt -> ext/standard/tests/serialize/bug72785.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #72785: allowed_classes only applies to outermost unserialize()",
          "3: --FILE--",
          "4: <?php",
          "7: class A {}",
          "9: $p = 'x:i:0;a:1:{i:0;O:1:\"A\":0:{}};m:a:0:{}';",
          "10: $s = 'C:11:\"ArrayObject\":' . strlen($p) . ':{' . $p . '}';",
          "11: var_dump(unserialize($s, ['allowed_classes' => ['ArrayObject']]));",
          "13: ?>",
          "14: --EXPECT--",
          "15: object(ArrayObject)#1 (1) {",
          "16:   [\"storage\":\"ArrayObject\":private]=>",
          "17:   array(1) {",
          "18:     [0]=>",
          "19:     object(__PHP_Incomplete_Class)#2 (1) {",
          "20:       [\"__PHP_Incomplete_Class_Name\"]=>",
          "21:       string(1) \"A\"",
          "22:     }",
          "23:   }",
          "24: }",
          "",
          "---------------"
        ],
        "ext/standard/tests/serialize/unserialize_error_001.phpt||ext/standard/tests/serialize/unserialize_error_001.phpt": [
          "File: ext/standard/tests/serialize/unserialize_error_001.phpt -> ext/standard/tests/serialize/unserialize_error_001.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "13: var_dump(unserialize($s, [\"allowed_classes\" => 1]));",
          "15: --EXPECTF--",
          "",
          "[Removed Lines]",
          "16: array(3) {",
          "17:   [0]=>",
          "18:   object(__PHP_Incomplete_Class)#%d (2) {",
          "19:     [\"__PHP_Incomplete_Class_Name\"]=>",
          "20:     string(3) \"foo\"",
          "21:     [\"x\"]=>",
          "22:     string(3) \"bar\"",
          "23:   }",
          "24:   [1]=>",
          "25:   int(2)",
          "26:   [2]=>",
          "27:   string(1) \"3\"",
          "28: }",
          "29: array(3) {",
          "30:   [0]=>",
          "31:   object(__PHP_Incomplete_Class)#%d (2) {",
          "32:     [\"__PHP_Incomplete_Class_Name\"]=>",
          "33:     string(3) \"foo\"",
          "34:     [\"x\"]=>",
          "35:     string(3) \"bar\"",
          "36:   }",
          "37:   [1]=>",
          "38:   int(2)",
          "39:   [2]=>",
          "40:   string(1) \"3\"",
          "41: }",
          "42: array(3) {",
          "43:   [0]=>",
          "44:   object(foo)#%d (1) {",
          "45:     [\"x\"]=>",
          "46:     string(3) \"bar\"",
          "47:   }",
          "48:   [1]=>",
          "49:   int(2)",
          "50:   [2]=>",
          "51:   string(1) \"3\"",
          "52: }",
          "",
          "[Added Lines]",
          "16: Warning: unserialize(): allowed_classes option should be array or boolean in %s on line %d",
          "17: bool(false)",
          "19: Warning: unserialize(): allowed_classes option should be array or boolean in %s on line %d",
          "20: bool(false)",
          "22: Warning: unserialize(): allowed_classes option should be array or boolean in %s on line %d",
          "23: bool(false)",
          "",
          "---------------"
        ],
        "ext/standard/var.c||ext/standard/var.c": [
          "File: ext/standard/var.c -> ext/standard/var.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1079:  PHP_VAR_UNSERIALIZE_INIT(var_hash);",
          "1080:  if(options != NULL) {",
          "1081:   classes = zend_hash_str_find(Z_ARRVAL_P(options), \"allowed_classes\", sizeof(\"allowed_classes\")-1);",
          "1082:   if(classes && (Z_TYPE_P(classes) == IS_ARRAY || !zend_is_true(classes))) {",
          "1083:    ALLOC_HASHTABLE(class_hash);",
          "1084:    zend_hash_init(class_hash, (Z_TYPE_P(classes) == IS_ARRAY)?zend_hash_num_elements(Z_ARRVAL_P(classes)):0, NULL, NULL, 0);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1082:   if (classes && Z_TYPE_P(classes) != IS_ARRAY && Z_TYPE_P(classes) != IS_TRUE && Z_TYPE_P(classes) != IS_FALSE) {",
          "1083:    php_error_docref(NULL, E_WARNING, \"allowed_classes option should be array or boolean\");",
          "1084:    PHP_VAR_UNSERIALIZE_DESTROY(var_hash);",
          "1085:    RETURN_FALSE;",
          "1086:   }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1094:           zend_string_release(lcname);",
          "1095:    } ZEND_HASH_FOREACH_END();",
          "1096:   }",
          "1097:  }",
          "1100:   PHP_VAR_UNSERIALIZE_DESTROY(var_hash);",
          "1101:   if (class_hash) {",
          "1102:    zend_hash_destroy(class_hash);",
          "",
          "[Removed Lines]",
          "1099:  if (!php_var_unserialize_ex(return_value, &p, p + buf_len, &var_hash, class_hash)) {",
          "",
          "[Added Lines]",
          "1103:   php_var_unserialize_set_allowed_classes(var_hash, class_hash);",
          "1106:  if (!php_var_unserialize(return_value, &p, p + buf_len, &var_hash)) {",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "29:  void *last;",
          "30:  void *first_dtor;",
          "31:  void *last_dtor;",
          "32: };",
          "34: PHPAPI php_unserialize_data_t php_var_unserialize_init() {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "32:  HashTable *allowed_classes;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "58:  }",
          "59: }",
          "63: #define VAR_ENTRIES_MAX 1024",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "62: PHPAPI void php_var_unserialize_set_allowed_classes(php_unserialize_data_t d, HashTable *classes) {",
          "63:  d->allowed_classes = classes;",
          "64: }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "246:  return str;",
          "247: }",
          "250: {",
          "251:  zend_string *lcname;",
          "252:  int res;",
          "253:  ALLOCA_FLAG(use_heap)",
          "",
          "[Removed Lines]",
          "249: static inline int unserialize_allowed_class(zend_string *class_name, HashTable *classes)",
          "",
          "[Added Lines]",
          "254: static inline int unserialize_allowed_class(",
          "255:   zend_string *class_name, php_unserialize_data_t *var_hashx)",
          "257:  HashTable *classes = (*var_hashx)->allowed_classes;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "273: #define YYMARKER marker",
          "",
          "[Removed Lines]",
          "276: #line 281 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "283: #line 288 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "333:  return result;",
          "334: }",
          "339: static int php_var_unserialize_internal(UNSERIALIZE_PARAMETER);",
          "",
          "[Removed Lines]",
          "336: #define UNSERIALIZE_PARAMETER zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash, HashTable *classes",
          "337: #define UNSERIALIZE_PASSTHRU rval, p, max, var_hash, classes",
          "",
          "[Added Lines]",
          "343: #define UNSERIALIZE_PARAMETER zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash",
          "344: #define UNSERIALIZE_PASSTHRU rval, p, max, var_hash",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "347:   ZVAL_UNDEF(&key);",
          "350:    zval_dtor(&key);",
          "351:    return 0;",
          "352:   }",
          "",
          "[Removed Lines]",
          "349:   if (!php_var_unserialize_internal(&key, p, max, NULL, classes)) {",
          "",
          "[Added Lines]",
          "356:   if (!php_var_unserialize_internal(&key, p, max, NULL)) {",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "402:    }",
          "403:   }",
          "406:    zval_dtor(&key);",
          "407:    return 0;",
          "408:   }",
          "",
          "[Removed Lines]",
          "405:   if (!php_var_unserialize_internal(data, p, max, var_hash, classes)) {",
          "",
          "[Added Lines]",
          "412:   if (!php_var_unserialize_internal(data, p, max, var_hash)) {",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "533: # pragma optimize(\"\", on)",
          "534: #endif",
          "543: {",
          "544:  var_entries *orig_var_entries = (*var_hash)->last;",
          "545:  zend_long orig_used_slots = orig_var_entries ? orig_var_entries->used_slots : 0;",
          "",
          "[Removed Lines]",
          "536: PHPAPI int php_var_unserialize(zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash)",
          "537: {",
          "538:  HashTable *classes = NULL;",
          "539:  return php_var_unserialize_ex(UNSERIALIZE_PASSTHRU);",
          "540: }",
          "542: PHPAPI int php_var_unserialize_ex(UNSERIALIZE_PARAMETER)",
          "",
          "[Added Lines]",
          "543: PHPAPI int php_var_unserialize(UNSERIALIZE_PARAMETER)",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "585:  start = cursor;",
          "589: {",
          "590:  YYCTYPE yych;",
          "591:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "588: #line 589 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "589: #line 590 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "645:  yych = *(YYMARKER = ++YYCURSOR);",
          "646:  if (yych == ':') goto yy95;",
          "647: yy3:",
          "649:  { return 0; }",
          "651: yy4:",
          "652:  yych = *(YYMARKER = ++YYCURSOR);",
          "653:  if (yych == ':') goto yy89;",
          "",
          "[Removed Lines]",
          "648: #line 955 \"ext/standard/var_unserializer.re\"",
          "650: #line 651 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "649: #line 956 \"ext/standard/var_unserializer.re\"",
          "651: #line 652 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "690:  goto yy3;",
          "691: yy14:",
          "692:  ++YYCURSOR;",
          "694:  {",
          "696:  php_error_docref(NULL, E_NOTICE, \"Unexpected end of serialized data\");",
          "698: }",
          "700: yy16:",
          "701:  yych = *++YYCURSOR;",
          "702:  goto yy3;",
          "",
          "[Removed Lines]",
          "693: #line 949 \"ext/standard/var_unserializer.re\"",
          "699: #line 700 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "694: #line 950 \"ext/standard/var_unserializer.re\"",
          "700: #line 701 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "722:  if (yybm[0+yych] & 128) {",
          "723:   goto yy20;",
          "724:  }",
          "726:  yych = *++YYCURSOR;",
          "727:  if (yych != '\"') goto yy18;",
          "728:  ++YYCURSOR;",
          "730:  {",
          "731:  size_t len, len2, len3, maxlen;",
          "732:  zend_long elements;",
          "",
          "[Removed Lines]",
          "725:  if (yych != ':') goto yy18;",
          "729: #line 804 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "726:  if (yych <= '/') goto yy18;",
          "727:  if (yych >= ';') goto yy18;",
          "731: #line 805 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "776:  class_name = zend_string_init(str, len, 0);",
          "778:  do {",
          "780:    incomplete_class = 1;",
          "781:    ce = PHP_IC_ENTRY;",
          "782:    break;",
          "",
          "[Removed Lines]",
          "779:   if(!unserialize_allowed_class(class_name, classes)) {",
          "",
          "[Added Lines]",
          "781:   if(!unserialize_allowed_class(class_name, var_hash)) {",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "872:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "873: }",
          "875: yy25:",
          "876:  yych = *++YYCURSOR;",
          "877:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "874: #line 875 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "876: #line 877 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "896:  yych = *++YYCURSOR;",
          "897:  if (yych != '\"') goto yy18;",
          "898:  ++YYCURSOR;",
          "900:  {",
          "901:     if (!var_hash) return 0;",
          "903:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "904:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "905: }",
          "907: yy32:",
          "908:  yych = *++YYCURSOR;",
          "909:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "899: #line 797 \"ext/standard/var_unserializer.re\"",
          "906: #line 907 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "901: #line 798 \"ext/standard/var_unserializer.re\"",
          "908: #line 909 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "924:  yych = *++YYCURSOR;",
          "925:  if (yych != '{') goto yy18;",
          "926:  ++YYCURSOR;",
          "928:  {",
          "929:  zend_long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "927: #line 773 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "929: #line 774 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "949:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "950: }",
          "952: yy39:",
          "953:  yych = *++YYCURSOR;",
          "954:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "951: #line 952 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "953: #line 954 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "969:  yych = *++YYCURSOR;",
          "970:  if (yych != '\"') goto yy18;",
          "971:  ++YYCURSOR;",
          "973:  {",
          "974:  size_t len, maxlen;",
          "975:  zend_string *str;",
          "",
          "[Removed Lines]",
          "972: #line 739 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "974: #line 740 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1003:  ZVAL_STR(rval, str);",
          "1004:  return 1;",
          "1005: }",
          "1007: yy46:",
          "1008:  yych = *++YYCURSOR;",
          "1009:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "1006: #line 1007 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1008: #line 1009 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1024:  yych = *++YYCURSOR;",
          "1025:  if (yych != '\"') goto yy18;",
          "1026:  ++YYCURSOR;",
          "1028:  {",
          "1029:  size_t len, maxlen;",
          "1030:  char *str;",
          "",
          "[Removed Lines]",
          "1027: #line 707 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1029: #line 708 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "1056:  ZVAL_STRINGL(rval, str, len);",
          "1057:  return 1;",
          "1058: }",
          "1060: yy53:",
          "1061:  yych = *++YYCURSOR;",
          "1062:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "1059: #line 1060 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1061: #line 1062 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "1144:  }",
          "1145: yy63:",
          "1146:  ++YYCURSOR;",
          "1148:  {",
          "1149: #if SIZEOF_ZEND_LONG == 4",
          "1150: use_double:",
          "",
          "[Removed Lines]",
          "1147: #line 698 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1149: #line 699 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "1153:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1154:  return 1;",
          "1155: }",
          "1157: yy65:",
          "1158:  yych = *++YYCURSOR;",
          "1159:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1156: #line 1157 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1158: #line 1159 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "1212:  yych = *++YYCURSOR;",
          "1213:  if (yych != ';') goto yy18;",
          "1214:  ++YYCURSOR;",
          "1216:  {",
          "",
          "[Removed Lines]",
          "1215: #line 682 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1217: #line 683 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 25 ---",
          "[Context before]",
          "1229:  return 1;",
          "1230: }",
          "1232: yy76:",
          "1233:  yych = *++YYCURSOR;",
          "1234:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1231: #line 1232 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1233: #line 1234 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 26 ---",
          "[Context before]",
          "1255:  if (yych <= '9') goto yy79;",
          "1256:  if (yych != ';') goto yy18;",
          "1257:  ++YYCURSOR;",
          "1259:  {",
          "1260: #if SIZEOF_ZEND_LONG == 4",
          "1261:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1258: #line 656 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1260: #line 657 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 27 ---",
          "[Context before]",
          "1281:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1282:  return 1;",
          "1283: }",
          "1285: yy83:",
          "1286:  yych = *++YYCURSOR;",
          "1287:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1284: #line 1285 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1286: #line 1287 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 28 ---",
          "[Context before]",
          "1289:  yych = *++YYCURSOR;",
          "1290:  if (yych != ';') goto yy18;",
          "1291:  ++YYCURSOR;",
          "1293:  {",
          "1295:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1296:  return 1;",
          "1297: }",
          "1299: yy87:",
          "1300:  ++YYCURSOR;",
          "1302:  {",
          "1304:  ZVAL_NULL(rval);",
          "1305:  return 1;",
          "1306: }",
          "1308: yy89:",
          "1309:  yych = *++YYCURSOR;",
          "1310:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1292: #line 650 \"ext/standard/var_unserializer.re\"",
          "1298: #line 1299 \"ext/standard/var_unserializer.c\"",
          "1301: #line 644 \"ext/standard/var_unserializer.re\"",
          "1307: #line 1308 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1294: #line 651 \"ext/standard/var_unserializer.re\"",
          "1300: #line 1301 \"ext/standard/var_unserializer.c\"",
          "1303: #line 645 \"ext/standard/var_unserializer.re\"",
          "1309: #line 1310 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 29 ---",
          "[Context before]",
          "1327:  if (yych <= '9') goto yy91;",
          "1328:  if (yych != ';') goto yy18;",
          "1329:  ++YYCURSOR;",
          "1331:  {",
          "1332:  zend_long id;",
          "",
          "[Removed Lines]",
          "1330: #line 619 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1332: #line 620 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 30 ---",
          "[Context before]",
          "1353:  return 1;",
          "1354: }",
          "1356: yy95:",
          "1357:  yych = *++YYCURSOR;",
          "1358:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1355: #line 1356 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1357: #line 1358 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 31 ---",
          "[Context before]",
          "1375:  if (yych <= '9') goto yy97;",
          "1376:  if (yych != ';') goto yy18;",
          "1377:  ++YYCURSOR;",
          "1379:  {",
          "1380:  zend_long id;",
          "",
          "[Removed Lines]",
          "1378: #line 593 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1380: #line 594 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 32 ---",
          "[Context before]",
          "1402:  return 1;",
          "1403: }",
          "1405: }",
          "1409:  return 0;",
          "",
          "[Removed Lines]",
          "1404: #line 1405 \"ext/standard/var_unserializer.c\"",
          "1406: #line 957 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1406: #line 1407 \"ext/standard/var_unserializer.c\"",
          "1408: #line 958 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "27:  void *last;",
          "28:  void *first_dtor;",
          "29:  void *last_dtor;",
          "30: };",
          "32: PHPAPI php_unserialize_data_t php_var_unserialize_init() {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "30:  HashTable *allowed_classes;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "56:  }",
          "57: }",
          "61: #define VAR_ENTRIES_MAX 1024",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "60: PHPAPI void php_var_unserialize_set_allowed_classes(php_unserialize_data_t d, HashTable *classes) {",
          "61:  d->allowed_classes = classes;",
          "62: }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "244:  return str;",
          "245: }",
          "248: {",
          "249:  zend_string *lcname;",
          "250:  int res;",
          "251:  ALLOCA_FLAG(use_heap)",
          "",
          "[Removed Lines]",
          "247: static inline int unserialize_allowed_class(zend_string *class_name, HashTable *classes)",
          "",
          "[Added Lines]",
          "252: static inline int unserialize_allowed_class(",
          "253:   zend_string *class_name, php_unserialize_data_t *var_hashx)",
          "255:  HashTable *classes = (*var_hashx)->allowed_classes;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "337:  return result;",
          "338: }",
          "343: static int php_var_unserialize_internal(UNSERIALIZE_PARAMETER);",
          "",
          "[Removed Lines]",
          "340: #define UNSERIALIZE_PARAMETER zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash, HashTable *classes",
          "341: #define UNSERIALIZE_PASSTHRU rval, p, max, var_hash, classes",
          "",
          "[Added Lines]",
          "347: #define UNSERIALIZE_PARAMETER zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash",
          "348: #define UNSERIALIZE_PASSTHRU rval, p, max, var_hash",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "351:   ZVAL_UNDEF(&key);",
          "354:    zval_dtor(&key);",
          "355:    return 0;",
          "356:   }",
          "",
          "[Removed Lines]",
          "353:   if (!php_var_unserialize_internal(&key, p, max, NULL, classes)) {",
          "",
          "[Added Lines]",
          "360:   if (!php_var_unserialize_internal(&key, p, max, NULL)) {",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "406:    }",
          "407:   }",
          "410:    zval_dtor(&key);",
          "411:    return 0;",
          "412:   }",
          "",
          "[Removed Lines]",
          "409:   if (!php_var_unserialize_internal(data, p, max, var_hash, classes)) {",
          "",
          "[Added Lines]",
          "416:   if (!php_var_unserialize_internal(data, p, max, var_hash)) {",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "537: # pragma optimize(\"\", on)",
          "538: #endif",
          "547: {",
          "548:  var_entries *orig_var_entries = (*var_hash)->last;",
          "549:  zend_long orig_used_slots = orig_var_entries ? orig_var_entries->used_slots : 0;",
          "",
          "[Removed Lines]",
          "540: PHPAPI int php_var_unserialize(zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash)",
          "541: {",
          "542:  HashTable *classes = NULL;",
          "543:  return php_var_unserialize_ex(UNSERIALIZE_PASSTHRU);",
          "544: }",
          "546: PHPAPI int php_var_unserialize_ex(UNSERIALIZE_PARAMETER)",
          "",
          "[Added Lines]",
          "547: PHPAPI int php_var_unserialize(UNSERIALIZE_PARAMETER)",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "850:  class_name = zend_string_init(str, len, 0);",
          "852:  do {",
          "854:    incomplete_class = 1;",
          "855:    ce = PHP_IC_ENTRY;",
          "856:    break;",
          "",
          "[Removed Lines]",
          "853:   if(!unserialize_allowed_class(class_name, classes)) {",
          "",
          "[Added Lines]",
          "854:   if(!unserialize_allowed_class(class_name, var_hash)) {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "fe1a3fc08bf47b8d484922d698975f134c7e9e3b",
      "candidate_info": {
        "commit_hash": "fe1a3fc08bf47b8d484922d698975f134c7e9e3b",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/fe1a3fc08bf47b8d484922d698975f134c7e9e3b",
        "files": [
          "Zend/tests/bug71841.phpt",
          "Zend/zend_vm_def.h",
          "Zend/zend_vm_execute.h",
          "ext/standard/tests/serialize/bug71840.phpt",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Merge branch 'PHP-5.6' into PHP-7.0\n\n* PHP-5.6:\n  Fixed bug #71841 (EG(error_zval) is not handled well)\n  Fixed bug #71840 (Unserialize accepts wrongly data)\n\nConflicts:\n\tZend/zend_vm_def.h\n\tZend/zend_vm_execute.h\n\text/standard/var_unserializer.c",
        "before_after_code_files": [
          "Zend/tests/bug71841.phpt||Zend/tests/bug71841.phpt",
          "Zend/zend_vm_def.h||Zend/zend_vm_def.h",
          "ext/standard/tests/serialize/bug71840.phpt||ext/standard/tests/serialize/bug71840.phpt",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "Zend/tests/bug71841.phpt||Zend/tests/bug71841.phpt": [
          "File: Zend/tests/bug71841.phpt -> Zend/tests/bug71841.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #71841 (EG(error_zval) is not handled well)",
          "3: --INI--",
          "4: error_reporting=0",
          "5: --FILE--",
          "6: <?php",
          "7: $z = unserialize('O:1:\"A\":0:{}');",
          "8: var_dump($z->e.=0);",
          "9: var_dump(++$z->x);",
          "10: var_dump($z->y++);",
          "12: $y = array(PHP_INT_MAX => 0);",
          "13: var_dump($y[] .= 0);",
          "14: var_dump(++$y[]);",
          "15: var_dump($y[]++);",
          "16: ?>",
          "17: --EXPECT--",
          "18: NULL",
          "19: NULL",
          "20: NULL",
          "21: NULL",
          "22: NULL",
          "23: NULL",
          "",
          "---------------"
        ],
        "Zend/zend_vm_def.h||Zend/zend_vm_def.h": [
          "File: Zend/zend_vm_def.h -> Zend/zend_vm_def.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "745:   if (EXPECTED(Z_OBJ_HT_P(object)->get_property_ptr_ptr)",
          "746:    && EXPECTED((zptr = Z_OBJ_HT_P(object)->get_property_ptr_ptr(object, property, BP_VAR_RW, ((OP2_TYPE == IS_CONST) ? CACHE_ADDR(Z_CACHE_SLOT_P(property)) : NULL))) != NULL)) {",
          "754:    }",
          "755:   } else {",
          "756:    zend_assign_op_overloaded_property(object, property, ((OP2_TYPE == IS_CONST) ? CACHE_ADDR(Z_CACHE_SLOT_P(property)) : NULL), value, binary_op, (UNEXPECTED(RETURN_VALUE_USED(opline)) ? EX_VAR(opline->result.var) : NULL));",
          "",
          "[Removed Lines]",
          "748:    ZVAL_DEREF(zptr);",
          "749:    SEPARATE_ZVAL_NOREF(zptr);",
          "751:    binary_op(zptr, zptr, value);",
          "752:    if (UNEXPECTED(RETURN_VALUE_USED(opline))) {",
          "753:     ZVAL_COPY(EX_VAR(opline->result.var), zptr);",
          "",
          "[Added Lines]",
          "747:    if (UNEXPECTED(zptr == &EG(error_zval))) {",
          "748:     if (UNEXPECTED(RETURN_VALUE_USED(opline))) {",
          "749:      ZVAL_NULL(EX_VAR(opline->result.var));",
          "750:     }",
          "751:    } else {",
          "752:     ZVAL_DEREF(zptr);",
          "753:     SEPARATE_ZVAL_NOREF(zptr);",
          "755:     binary_op(zptr, zptr, value);",
          "756:     if (UNEXPECTED(RETURN_VALUE_USED(opline))) {",
          "757:      ZVAL_COPY(EX_VAR(opline->result.var), zptr);",
          "758:     }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1150:   }",
          "1154:   if (EXPECTED(Z_OBJ_HT_P(object)->get_property_ptr_ptr)",
          "1155:    && EXPECTED((zptr = Z_OBJ_HT_P(object)->get_property_ptr_ptr(object, property, BP_VAR_RW, ((OP2_TYPE == IS_CONST) ? CACHE_ADDR(Z_CACHE_SLOT_P(property)) : NULL))) != NULL)) {",
          "1162:     }",
          "1163:    } else {",
          "1169:     } else {",
          "1171:     }",
          "1175:    }",
          "1176:   } else {",
          "1177:    zend_pre_incdec_overloaded_property(object, property, ((OP2_TYPE == IS_CONST) ? CACHE_ADDR(Z_CACHE_SLOT_P(property)) : NULL), inc, (UNEXPECTED(RETURN_VALUE_USED(opline)) ? EX_VAR(opline->result.var) : NULL));",
          "",
          "[Removed Lines]",
          "1157:    if (EXPECTED(Z_TYPE_P(zptr) == IS_LONG)) {",
          "1158:     if (inc) {",
          "1159:      fast_long_increment_function(zptr);",
          "1160:     } else {",
          "1161:      fast_long_decrement_function(zptr);",
          "1164:     ZVAL_DEREF(zptr);",
          "1165:     SEPARATE_ZVAL_NOREF(zptr);",
          "1167:     if (inc) {",
          "1168:      increment_function(zptr);",
          "1170:      decrement_function(zptr);",
          "1172:    }",
          "1173:    if (UNEXPECTED(RETURN_VALUE_USED(opline))) {",
          "1174:     ZVAL_COPY(EX_VAR(opline->result.var), zptr);",
          "",
          "[Added Lines]",
          "1160:    if (UNEXPECTED(zptr == &EG(error_zval))) {",
          "1161:     if (UNEXPECTED(RETURN_VALUE_USED(opline))) {",
          "1162:      ZVAL_NULL(EX_VAR(opline->result.var));",
          "1165:     if (EXPECTED(Z_TYPE_P(zptr) == IS_LONG)) {",
          "1166:      if (inc) {",
          "1167:       fast_long_increment_function(zptr);",
          "1168:      } else {",
          "1169:       fast_long_decrement_function(zptr);",
          "1170:      }",
          "1172:      ZVAL_DEREF(zptr);",
          "1173:      SEPARATE_ZVAL_NOREF(zptr);",
          "1175:      if (inc) {",
          "1176:       increment_function(zptr);",
          "1177:      } else {",
          "1178:       decrement_function(zptr);",
          "1179:      }",
          "1180:     }",
          "1181:     if (UNEXPECTED(RETURN_VALUE_USED(opline))) {",
          "1182:      ZVAL_COPY(EX_VAR(opline->result.var), zptr);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1233:   if (EXPECTED(Z_OBJ_HT_P(object)->get_property_ptr_ptr)",
          "1234:    && EXPECTED((zptr = Z_OBJ_HT_P(object)->get_property_ptr_ptr(object, property, BP_VAR_RW, ((OP2_TYPE == IS_CONST) ? CACHE_ADDR(Z_CACHE_SLOT_P(property)) : NULL))) != NULL)) {",
          "1243:    } else {",
          "1249:     } else {",
          "1251:     }",
          "1252:    }",
          "1253:   } else {",
          "",
          "[Removed Lines]",
          "1236:    if (EXPECTED(Z_TYPE_P(zptr) == IS_LONG)) {",
          "1237:     ZVAL_COPY_VALUE(EX_VAR(opline->result.var), zptr);",
          "1238:     if (inc) {",
          "1239:      fast_long_increment_function(zptr);",
          "1240:     } else {",
          "1241:      fast_long_decrement_function(zptr);",
          "1242:     }",
          "1244:     ZVAL_DEREF(zptr);",
          "1245:     ZVAL_COPY_VALUE(EX_VAR(opline->result.var), zptr);",
          "1246:     zval_opt_copy_ctor(zptr);",
          "1247:     if (inc) {",
          "1248:      increment_function(zptr);",
          "1250:      decrement_function(zptr);",
          "",
          "[Added Lines]",
          "1244:    if (UNEXPECTED(zptr == &EG(error_zval))) {",
          "1245:     ZVAL_NULL(EX_VAR(opline->result.var));",
          "1247:     if (EXPECTED(Z_TYPE_P(zptr) == IS_LONG)) {",
          "1248:      ZVAL_COPY_VALUE(EX_VAR(opline->result.var), zptr);",
          "1249:      if (inc) {",
          "1250:       fast_long_increment_function(zptr);",
          "1251:      } else {",
          "1252:       fast_long_decrement_function(zptr);",
          "1253:      }",
          "1255:      ZVAL_DEREF(zptr);",
          "1256:      ZVAL_COPY_VALUE(EX_VAR(opline->result.var), zptr);",
          "1257:      zval_opt_copy_ctor(zptr);",
          "1258:      if (inc) {",
          "1259:       increment_function(zptr);",
          "1260:      } else {",
          "1261:       decrement_function(zptr);",
          "1262:      }",
          "",
          "---------------"
        ],
        "ext/standard/tests/serialize/bug71840.phpt||ext/standard/tests/serialize/bug71840.phpt": [
          "File: ext/standard/tests/serialize/bug71840.phpt -> ext/standard/tests/serialize/bug71840.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #71840 (Unserialize accepts wrongly data)",
          "3: --FILE--",
          "4: <?php",
          "5: var_dump(unserialize('a:1:{s:0:\"\"0a:0:{}}'));",
          "6: ?>",
          "7: --EXPECTF--",
          "8: Notice: unserialize(): Error at offset 11 of 19 bytes in %sbug71840.php on line %d",
          "9: bool(false)",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "574:  yych = *(YYMARKER = ++YYCURSOR);",
          "575:  if (yych == ':') goto yy95;",
          "576: yy3:",
          "578:  { return 0; }",
          "579: #line 580 \"ext/standard/var_unserializer.c\"",
          "580: yy4:",
          "",
          "[Removed Lines]",
          "577: #line 873 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "577: #line 884 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "619:  goto yy3;",
          "620: yy14:",
          "621:  ++YYCURSOR;",
          "623:  {",
          "625:  php_error_docref(NULL, E_NOTICE, \"Unexpected end of serialized data\");",
          "",
          "[Removed Lines]",
          "622: #line 867 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "622: #line 878 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "655:  yych = *++YYCURSOR;",
          "656:  if (yych != '\"') goto yy18;",
          "657:  ++YYCURSOR;",
          "659:  {",
          "660:  size_t len, len2, len3, maxlen;",
          "661:  zend_long elements;",
          "",
          "[Removed Lines]",
          "658: #line 722 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "658: #line 733 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "825:  yych = *++YYCURSOR;",
          "826:  if (yych != '\"') goto yy18;",
          "827:  ++YYCURSOR;",
          "829:  {",
          "830:     if (!var_hash) return 0;",
          "",
          "[Removed Lines]",
          "828: #line 715 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "828: #line 726 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "853:  yych = *++YYCURSOR;",
          "854:  if (yych != '{') goto yy18;",
          "855:  ++YYCURSOR;",
          "857:  {",
          "858:  zend_long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "856: #line 691 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "856: #line 702 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "898:  yych = *++YYCURSOR;",
          "899:  if (yych != '\"') goto yy18;",
          "900:  ++YYCURSOR;",
          "902:  {",
          "903:  size_t len, maxlen;",
          "904:  zend_string *str;",
          "",
          "[Removed Lines]",
          "901: #line 663 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "901: #line 668 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "920:   return 0;",
          "921:  }",
          "923:  YYCURSOR += 2;",
          "926:  ZVAL_STR(rval, str);",
          "927:  return 1;",
          "928: }",
          "930: yy46:",
          "931:  yych = *++YYCURSOR;",
          "932:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "929: #line 930 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "923:  if (*(YYCURSOR + 1) != ';') {",
          "924:   efree(str);",
          "926:   return 0;",
          "927:  }",
          "935: #line 936 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "968:   return 0;",
          "969:  }",
          "971:  YYCURSOR += 2;",
          "974:  ZVAL_STRINGL(rval, str, len);",
          "975:  return 1;",
          "976: }",
          "978: yy53:",
          "979:  yych = *++YYCURSOR;",
          "980:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "977: #line 978 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "977:  if (*(YYCURSOR + 1) != ';') {",
          "979:   return 0;",
          "980:  }",
          "988: #line 989 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "1071:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1072:  return 1;",
          "1073: }",
          "1075: yy65:",
          "1076:  yych = *++YYCURSOR;",
          "1077:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1074: #line 1075 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1085: #line 1086 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "1147:  return 1;",
          "1148: }",
          "1150: yy76:",
          "1151:  yych = *++YYCURSOR;",
          "1152:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1149: #line 1150 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1160: #line 1161 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "1199:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1200:  return 1;",
          "1201: }",
          "1203: yy83:",
          "1204:  yych = *++YYCURSOR;",
          "1205:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1202: #line 1203 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1213: #line 1214 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "1213:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1214:  return 1;",
          "1215: }",
          "1217: yy87:",
          "1218:  ++YYCURSOR;",
          "1219: #line 573 \"ext/standard/var_unserializer.re\"",
          "",
          "[Removed Lines]",
          "1216: #line 1217 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1227: #line 1228 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "1222:  ZVAL_NULL(rval);",
          "1223:  return 1;",
          "1224: }",
          "1226: yy89:",
          "1227:  yych = *++YYCURSOR;",
          "1228:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1225: #line 1226 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1236: #line 1237 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "1271:  return 1;",
          "1272: }",
          "1274: yy95:",
          "1275:  yych = *++YYCURSOR;",
          "1276:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1273: #line 1274 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1284: #line 1285 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1320:  return 1;",
          "1321: }",
          "1323: }",
          "1327:  return 0;",
          "",
          "[Removed Lines]",
          "1322: #line 1323 \"ext/standard/var_unserializer.c\"",
          "1324: #line 875 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1333: #line 1334 \"ext/standard/var_unserializer.c\"",
          "1335: #line 886 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "653:   return 0;",
          "654:  }",
          "656:  YYCURSOR += 2;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "656:  if (*(YYCURSOR + 1) != ';') {",
          "658:   return 0;",
          "659:  }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "681:   return 0;",
          "682:  }",
          "684:  YYCURSOR += 2;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "689:  if (*(YYCURSOR + 1) != ';') {",
          "690:   efree(str);",
          "692:   return 0;",
          "693:  }",
          "",
          "---------------"
        ]
      }
    }
  ]
}