{
  "cve_id": "CVE-2017-3735",
  "cve_desc": "While parsing an IPAddressFamily extension in an X.509 certificate, it is possible to do a one-byte overread. This would result in an incorrect text display of the certificate. This bug has been present since 2006 and is present in all versions of OpenSSL before 1.0.2m and 1.1.0g.",
  "repo": "openssl/openssl",
  "patch_hash": "068b963bb7afc57f5bdd723de0dd15e7795d5822",
  "patch_info": {
    "commit_hash": "068b963bb7afc57f5bdd723de0dd15e7795d5822",
    "repo": "openssl/openssl",
    "commit_url": "https://github.com/openssl/openssl/commit/068b963bb7afc57f5bdd723de0dd15e7795d5822",
    "files": [
      "crypto/x509v3/v3_addr.c"
    ],
    "message": "Avoid out-of-bounds read\n\nFixes CVE 2017-3735\n\nReviewed-by: Kurt Roeckx <kurt@roeckx.be>\n(Merged from https://github.com/openssl/openssl/pull/4276)\n\n(cherry picked from commit b23171744b01e473ebbfd6edad70c1c3825ffbcd)",
    "before_after_code_files": [
      "crypto/x509v3/v3_addr.c||crypto/x509v3/v3_addr.c"
    ]
  },
  "patch_diff": {
    "crypto/x509v3/v3_addr.c||crypto/x509v3/v3_addr.c": [
      "File: crypto/x509v3/v3_addr.c -> crypto/x509v3/v3_addr.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "85: unsigned int X509v3_addr_get_afi(const IPAddressFamily *f)",
      "86: {",
      "91: }",
      "",
      "[Removed Lines]",
      "87:     return ((f != NULL &&",
      "88:              f->addressFamily != NULL && f->addressFamily->data != NULL)",
      "89:             ? ((f->addressFamily->data[0] << 8) | (f->addressFamily->data[1]))",
      "90:             : 0);",
      "",
      "[Added Lines]",
      "87:     if (f == NULL",
      "88:             || f->addressFamily == NULL",
      "89:             || f->addressFamily->data == NULL",
      "90:             || f->addressFamily->length < 2)",
      "91:         return 0;",
      "92:     return (f->addressFamily->data[0] << 8) | f->addressFamily->data[1];",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "fb969d09b0a9a1ae4ad27fbc1372aa31ade30667",
      "candidate_info": {
        "commit_hash": "fb969d09b0a9a1ae4ad27fbc1372aa31ade30667",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/fb969d09b0a9a1ae4ad27fbc1372aa31ade30667",
        "files": [
          "crypto/ocsp/ocsp_lcl.h",
          "include/openssl/ocsp.h"
        ],
        "message": "Remove 4 broken macros from ocsp.h\n\nThere were 4 macros in ocsp.h that have not worked since 1.1.0 because\nthey attempt to access the internals of an opaque structure.\n\nFor OCSP_REQUEST_sign() applications should use OCSP_request_sign() instead.\nFor OCSP_BASICRESP_sign() applications should use OCSP_basic_sign() instead.\nFor OCSP_REQUEST_verify() applications should use OCSP_request_verify()\ninstead.\nFor OCSP_BASICRESP_verify() applications should use OCSP_basic_verify()\ninstead.\n\nReviewed-by: Ben Kaduk <kaduk@mit.edu>\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/4635)\n\n(cherry picked from commit 9f5671c7e9f30dfa53b1a2b553f234c2761ceb66)",
        "before_after_code_files": [
          "crypto/ocsp/ocsp_lcl.h||crypto/ocsp/ocsp_lcl.h",
          "include/openssl/ocsp.h||include/openssl/ocsp.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "crypto/ocsp/ocsp_lcl.h||crypto/ocsp/ocsp_lcl.h": [
          "File: crypto/ocsp/ocsp_lcl.h -> crypto/ocsp/ocsp_lcl.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "214:     X509_NAME *issuer;",
          "215:     STACK_OF(ACCESS_DESCRIPTION) *locator;",
          "216: };",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "218: #  define OCSP_REQUEST_sign(o,pkey,md) \\",
          "219:         ASN1_item_sign(ASN1_ITEM_rptr(OCSP_REQINFO),\\",
          "220:                 &(o)->optionalSignature->signatureAlgorithm,NULL,\\",
          "221:                 (o)->optionalSignature->signature,&(o)->tbsRequest,pkey,md)",
          "223: #  define OCSP_BASICRESP_sign(o,pkey,md,d) \\",
          "224:         ASN1_item_sign(ASN1_ITEM_rptr(OCSP_RESPDATA),&(o)->signatureAlgorithm,\\",
          "225:                 NULL,(o)->signature,&(o)->tbsResponseData,pkey,md)",
          "227: #  define OCSP_REQUEST_verify(a,r) ASN1_item_verify(ASN1_ITEM_rptr(OCSP_REQINFO),\\",
          "228:         &(a)->optionalSignature->signatureAlgorithm,\\",
          "229:         (a)->optionalSignature->signature,&(a)->tbsRequest,r)",
          "231: #  define OCSP_BASICRESP_verify(a,r,d) ASN1_item_verify(ASN1_ITEM_rptr(OCSP_RESPDATA),\\",
          "232:         &(a)->signatureAlgorithm,(a)->signature,&(a)->tbsResponseData,r)",
          "",
          "---------------"
        ],
        "include/openssl/ocsp.h||include/openssl/ocsp.h": [
          "File: include/openssl/ocsp.h -> include/openssl/ocsp.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "138: #  define i2d_OCSP_REQUEST_bio(bp,o) ASN1_i2d_bio_of(OCSP_REQUEST,i2d_OCSP_REQUEST,bp,o)",
          "156: #  define ASN1_BIT_STRING_digest(data,type,md,len) \\",
          "157:         ASN1_item_digest(ASN1_ITEM_rptr(ASN1_BIT_STRING),type,data,md,len)",
          "",
          "[Removed Lines]",
          "140: #  define OCSP_REQUEST_sign(o,pkey,md) \\",
          "141:         ASN1_item_sign(ASN1_ITEM_rptr(OCSP_REQINFO),\\",
          "142:                 &o->optionalSignature->signatureAlgorithm,NULL,\\",
          "143:                 o->optionalSignature->signature,&o->tbsRequest,pkey,md)",
          "145: #  define OCSP_BASICRESP_sign(o,pkey,md,d) \\",
          "146:         ASN1_item_sign(ASN1_ITEM_rptr(OCSP_RESPDATA),&o->signatureAlgorithm,NULL,\\",
          "147:                 o->signature,&o->tbsResponseData,pkey,md)",
          "149: #  define OCSP_REQUEST_verify(a,r) ASN1_item_verify(ASN1_ITEM_rptr(OCSP_REQINFO),\\",
          "150:         &a->optionalSignature->signatureAlgorithm,\\",
          "151:         a->optionalSignature->signature,&a->tbsRequest,r)",
          "153: #  define OCSP_BASICRESP_verify(a,r,d) ASN1_item_verify(ASN1_ITEM_rptr(OCSP_RESPDATA),\\",
          "154:         &a->signatureAlgorithm,a->signature,&a->tbsResponseData,r)",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "847997f98c28b3b8ceb2b95ef1751f7c7c1bfa61",
      "candidate_info": {
        "commit_hash": "847997f98c28b3b8ceb2b95ef1751f7c7c1bfa61",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/847997f98c28b3b8ceb2b95ef1751f7c7c1bfa61",
        "files": [
          "apps/enc.c",
          "apps/genrsa.c",
          "apps/openssl.c",
          "apps/prime.c",
          "apps/rand.c",
          "apps/srp.c",
          "apps/version.c"
        ],
        "message": "Check # of arguments for remaining commands.\n\nBackport of https://github.com/openssl/openssl/pull/4201\n\nReviewed-by: Bernd Edlinger <bernd.edlinger@hotmail.de>\n(Merged from https://github.com/openssl/openssl/pull/5162)",
        "before_after_code_files": [
          "apps/enc.c||apps/enc.c",
          "apps/genrsa.c||apps/genrsa.c",
          "apps/openssl.c||apps/openssl.c",
          "apps/prime.c||apps/prime.c",
          "apps/rand.c||apps/rand.c",
          "apps/srp.c||apps/srp.c",
          "apps/version.c||apps/version.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "apps/enc.c||apps/enc.c": [
          "File: apps/enc.c -> apps/enc.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "257:             break;",
          "258:         }",
          "259:     }",
          "261:     if (cipher && EVP_CIPHER_flags(cipher) & EVP_CIPH_FLAG_AEAD_CIPHER) {",
          "262:         BIO_printf(bio_err, \"%s: AEAD ciphers not supported\\n\", prog);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "260:     if (opt_num_rest() != 0) {",
          "261:         BIO_printf(bio_err, \"Extra arguments given.\\n\");",
          "262:         goto opthelp;",
          "263:     }",
          "",
          "---------------"
        ],
        "apps/genrsa.c||apps/genrsa.c": [
          "File: apps/genrsa.c -> apps/genrsa.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "78:         switch (o) {",
          "79:         case OPT_EOF:",
          "80:         case OPT_ERR:",
          "81:             BIO_printf(bio_err, \"%s: Use -help for summary.\\n\", prog);",
          "82:             goto end;",
          "83:         case OPT_HELP:",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "81: opthelp:",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "110:     }",
          "111:     argc = opt_num_rest();",
          "112:     argv = opt_rest();",
          "118:     if (!app_passwd(NULL, passoutarg, NULL, &passout)) {",
          "119:         BIO_printf(bio_err, \"Error getting password\\n\");",
          "120:         goto end;",
          "",
          "[Removed Lines]",
          "113:     private = 1;",
          "115:     if (argv[0] && (!opt_int(argv[0], &num) || num <= 0))",
          "116:         goto end;",
          "",
          "[Added Lines]",
          "115:     if (argc == 1) {",
          "116:         if (!opt_int(argv[0], &num) || num <= 0)",
          "117:             goto end;",
          "118:     } else if (argc > 0) {",
          "119:         BIO_printf(bio_err, \"Extra arguments given.\\n\");",
          "120:         goto opthelp;",
          "121:     }",
          "123:     private = 1;",
          "",
          "---------------"
        ],
        "apps/openssl.c||apps/openssl.c": [
          "File: apps/openssl.c -> apps/openssl.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "334:         switch (o) {",
          "336:         case OPT_ERR:",
          "337:             BIO_printf(bio_err, \"%s: Use -help for summary.\\n\", prog);",
          "338:             return 1;",
          "339:         case OPT_HELP:",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "337: opthelp:",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "363:         }",
          "364:         done = 1;",
          "365:     }",
          "370:     }",
          "372:     return 0;",
          "373: }",
          "",
          "[Removed Lines]",
          "367:     if (!done) {",
          "368:         BIO_printf(bio_err, \"%s: Use -help for summary.\\n\", prog);",
          "369:         return 1;",
          "",
          "[Added Lines]",
          "367:     if (opt_num_rest() != 0) {",
          "368:         BIO_printf(bio_err, \"Extra arguments given.\\n\");",
          "369:         goto opthelp;",
          "372:     if (!done)",
          "373:         goto opthelp;",
          "",
          "---------------"
        ],
        "apps/prime.c||apps/prime.c": [
          "File: apps/prime.c -> apps/prime.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "43:         switch (o) {",
          "44:         case OPT_EOF:",
          "45:         case OPT_ERR:",
          "46:             BIO_printf(bio_err, \"%s: Use -help for summary.\\n\", prog);",
          "47:             goto end;",
          "48:         case OPT_HELP:",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "46: opthelp:",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "69:     argc = opt_num_rest();",
          "70:     argv = opt_rest();",
          "73:         BIO_printf(bio_err, \"%s: No prime specified\\n\", prog);",
          "75:     }",
          "77:     if (generate) {",
          "",
          "[Removed Lines]",
          "72:     if (argc == 0 && !generate) {",
          "74:         goto end;",
          "",
          "[Added Lines]",
          "73:     if (generate) {",
          "74:         if (argc != 0) {",
          "75:             BIO_printf(bio_err, \"Extra arguments given.\\n\");",
          "76:             goto opthelp;",
          "77:         }",
          "78:     } else if (argc == 0) {",
          "80:         goto opthelp;",
          "",
          "---------------"
        ],
        "apps/rand.c||apps/rand.c": [
          "File: apps/rand.c -> apps/rand.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "76:     }",
          "77:     argc = opt_num_rest();",
          "78:     argv = opt_rest();",
          "81:         goto opthelp;",
          "83:     app_RAND_load_file(NULL, (inrand != NULL));",
          "84:     if (inrand != NULL)",
          "",
          "[Removed Lines]",
          "80:     if (argc != 1 || !opt_int(argv[0], &num) || num < 0)",
          "",
          "[Added Lines]",
          "79:     if (argc == 1) {",
          "80:         if (!opt_int(argv[0], &num) || num <= 0)",
          "81:             goto end;",
          "82:     } else if (argc > 0) {",
          "83:         BIO_printf(bio_err, \"Extra arguments given.\\n\");",
          "85:     }",
          "",
          "---------------"
        ],
        "apps/srp.c||apps/srp.c": [
          "File: apps/srp.c -> apps/srp.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "293:                    \"Exactly one of the options -add, -delete, -modify -list must be specified.\\n\");",
          "294:         goto opthelp;",
          "295:     }",
          "301:     }",
          "302:     if ((passinarg || passoutarg) && argc != 1) {",
          "303:         BIO_printf(bio_err,",
          "",
          "[Removed Lines]",
          "296:     if ((mode == OPT_DELETE || mode == OPT_MODIFY || mode == OPT_ADD)",
          "297:         && argc < 1) {",
          "298:         BIO_printf(bio_err,",
          "299:                    \"Need at least one user for options -add, -delete, -modify. \\n\");",
          "300:         goto opthelp;",
          "",
          "[Added Lines]",
          "296:     if (mode == OPT_DELETE || mode == OPT_MODIFY || mode == OPT_ADD) {",
          "297:         if (argc == 0) {",
          "298:             BIO_printf(bio_err, \"Need at least one user.\\n\");",
          "299:             goto opthelp;",
          "300:         }",
          "301:         user = *argv++;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "391:     if (verbose > 1)",
          "392:         BIO_printf(bio_err, \"Starting user processing\\n\");",
          "398:         int userindex = -1;",
          "400:         if (user != NULL && verbose > 1)",
          "",
          "[Removed Lines]",
          "394:     if (argc > 0)",
          "395:         user = *(argv++);",
          "397:     while (mode == OPT_LIST || user) {",
          "",
          "[Added Lines]",
          "395:     while (mode == OPT_LIST || user != NULL) {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "557:                 doupdatedb = 1;",
          "558:             }",
          "559:         }",
          "564:             break;",
          "565:         }",
          "",
          "[Removed Lines]",
          "560:         if (--argc > 0) {",
          "561:             user = *(argv++);",
          "562:         } else {",
          "",
          "[Added Lines]",
          "558:         user = *argv++;",
          "559:         if (user == NULL) {",
          "",
          "---------------"
        ],
        "apps/version.c||apps/version.c": [
          "File: apps/version.c -> apps/version.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "61:         switch (o) {",
          "62:         case OPT_EOF:",
          "63:         case OPT_ERR:",
          "64:             BIO_printf(bio_err, \"%s: Use -help for summary.\\n\", prog);",
          "65:             goto end;",
          "66:         case OPT_HELP:",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "64: opthelp:",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "93:             break;",
          "94:         }",
          "95:     }",
          "96:     if (!dirty)",
          "97:         version = 1;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "97:     if (opt_num_rest() != 0) {",
          "98:         BIO_printf(bio_err, \"Extra parameters given.\\n\");",
          "99:         goto opthelp;",
          "100:     }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "2df7971728ddd388a77de56acc01e4bab37796bb",
      "candidate_info": {
        "commit_hash": "2df7971728ddd388a77de56acc01e4bab37796bb",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/2df7971728ddd388a77de56acc01e4bab37796bb",
        "files": [
          "ssl/record/rec_layer_s3.c"
        ],
        "message": "Mark a zero length record as read\n\nIf SSL_read() is called with a zero length buffer, and we read a zero length\nrecord then we should mark that record as read.\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/4686)",
        "before_after_code_files": [
          "ssl/record/rec_layer_s3.c||ssl/record/rec_layer_s3.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "ssl/record/rec_layer_s3.c||ssl/record/rec_layer_s3.c": [
          "File: ssl/record/rec_layer_s3.c -> ssl/record/rec_layer_s3.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1133:         if (recvd_type != NULL)",
          "1139:         read_bytes = 0;",
          "1140:         do {",
          "",
          "[Removed Lines]",
          "1136:         if (len <= 0)",
          "1137:             return (len);",
          "",
          "[Added Lines]",
          "1136:         if (len <= 0) {",
          "1142:             if (SSL3_RECORD_get_length(rr) == 0)",
          "1143:                 SSL3_RECORD_set_read(rr);",
          "1144:             return len;",
          "1145:         }",
          "",
          "---------------"
        ]
      }
    }
  ]
}