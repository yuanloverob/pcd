{
  "cve_id": "CVE-2016-5733",
  "cve_desc": "Multiple cross-site scripting (XSS) vulnerabilities in phpMyAdmin 4.0.x before 4.0.10.16, 4.4.x before 4.4.15.7, and 4.6.x before 4.6.3 allow remote attackers to inject arbitrary web script or HTML via vectors involving (1) a crafted table name that is mishandled during privilege checking in table_row.phtml, (2) a crafted mysqld log_bin directive that is mishandled in log_selector.phtml, (3) the Transformation implementation, (4) AJAX error handling in js/ajax.js, (5) the Designer implementation, (6) the charts implementation in js/tbl_chart.js, or (7) the zoom-search implementation in rows_zoom.phtml.",
  "repo": "phpmyadmin/phpmyadmin",
  "patch_hash": "be3ecbb4cca3fbe20e3b3aa4e049902d18b60865",
  "patch_info": {
    "commit_hash": "be3ecbb4cca3fbe20e3b3aa4e049902d18b60865",
    "repo": "phpmyadmin/phpmyadmin",
    "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/be3ecbb4cca3fbe20e3b3aa4e049902d18b60865",
    "files": [
      "libraries/plugins/transformations/abs/DateFormatTransformationsPlugin.php",
      "libraries/plugins/transformations/abs/DownloadTransformationsPlugin.php",
      "libraries/plugins/transformations/abs/ImageLinkTransformationsPlugin.php",
      "libraries/plugins/transformations/abs/InlineTransformationsPlugin.php",
      "libraries/plugins/transformations/abs/LongToIPv4TransformationsPlugin.php",
      "libraries/plugins/transformations/abs/PreApPendTransformationsPlugin.php",
      "libraries/plugins/transformations/abs/SubstringTransformationsPlugin.php",
      "libraries/plugins/transformations/abs/TextImageLinkTransformationsPlugin.php",
      "libraries/plugins/transformations/abs/TextLinkTransformationsPlugin.php",
      "libraries/transformations.lib.php",
      "test/classes/plugin/transformations/TransformationPluginsTest.php",
      "test/libraries/PMA_transformation_test.php"
    ],
    "message": "Simplify and cleanup transformation plugins\n\nRemove PMA_transformation_global_html_replace which makes the code only\nmore confusing.\n\nAlso add escaping to browse transformations.\n\nSigned-off-by: Michal \u010ciha\u0159 <michal@cihar.com>",
    "before_after_code_files": [
      "libraries/plugins/transformations/abs/DateFormatTransformationsPlugin.php||libraries/plugins/transformations/abs/DateFormatTransformationsPlugin.php",
      "libraries/plugins/transformations/abs/DownloadTransformationsPlugin.php||libraries/plugins/transformations/abs/DownloadTransformationsPlugin.php",
      "libraries/plugins/transformations/abs/ImageLinkTransformationsPlugin.php||libraries/plugins/transformations/abs/ImageLinkTransformationsPlugin.php",
      "libraries/plugins/transformations/abs/InlineTransformationsPlugin.php||libraries/plugins/transformations/abs/InlineTransformationsPlugin.php",
      "libraries/plugins/transformations/abs/LongToIPv4TransformationsPlugin.php||libraries/plugins/transformations/abs/LongToIPv4TransformationsPlugin.php",
      "libraries/plugins/transformations/abs/PreApPendTransformationsPlugin.php||libraries/plugins/transformations/abs/PreApPendTransformationsPlugin.php",
      "libraries/plugins/transformations/abs/SubstringTransformationsPlugin.php||libraries/plugins/transformations/abs/SubstringTransformationsPlugin.php",
      "libraries/plugins/transformations/abs/TextImageLinkTransformationsPlugin.php||libraries/plugins/transformations/abs/TextImageLinkTransformationsPlugin.php",
      "libraries/plugins/transformations/abs/TextLinkTransformationsPlugin.php||libraries/plugins/transformations/abs/TextLinkTransformationsPlugin.php",
      "libraries/transformations.lib.php||libraries/transformations.lib.php",
      "test/classes/plugin/transformations/TransformationPluginsTest.php||test/classes/plugin/transformations/TransformationPluginsTest.php",
      "test/libraries/PMA_transformation_test.php||test/libraries/PMA_transformation_test.php"
    ]
  },
  "patch_diff": {
    "libraries/plugins/transformations/abs/DateFormatTransformationsPlugin.php||libraries/plugins/transformations/abs/DateFormatTransformationsPlugin.php": [
      "File: libraries/plugins/transformations/abs/DateFormatTransformationsPlugin.php -> libraries/plugins/transformations/abs/DateFormatTransformationsPlugin.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "11: use PMA;",
      "12: use PMA\\libraries\\plugins\\TransformationsPlugin;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "14: require_once 'libraries/js_escape.lib.php';",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "145:             } else {",
      "146:                 $text = 'INVALID DATE TYPE';",
      "147:             }",
      "150:         }",
      "153:     }",
      "",
      "[Removed Lines]",
      "148:             $buffer = '<dfn onclick=\"alert(\\'' . $source . '\\');\" title=\"'",
      "149:                 . $source . '\">' . $text . '</dfn>';",
      "152:         return $buffer;",
      "",
      "[Added Lines]",
      "150:             return '<dfn onclick=\"alert(\\'' . PMA_jsFormat($source, false) . '\\');\" title=\"'",
      "151:                 . htmlspecialchars($source) . '\">' . htmlspecialchars($text) . '</dfn>';",
      "152:         } else {",
      "153:             return htmlspecialchars($buffer);",
      "",
      "---------------"
    ],
    "libraries/plugins/transformations/abs/DownloadTransformationsPlugin.php||libraries/plugins/transformations/abs/DownloadTransformationsPlugin.php": [
      "File: libraries/plugins/transformations/abs/DownloadTransformationsPlugin.php -> libraries/plugins/transformations/abs/DownloadTransformationsPlugin.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "69:             '<a href=\"transformation_wrapper.php%s&amp;ct=application'",
      "70:             . '/octet-stream&amp;cn=%s\" title=\"%s\" class=\"disableAjax\">%s</a>',",
      "71:             $options['wrapper_link'],",
      "73:             htmlspecialchars($cn),",
      "74:             htmlspecialchars($cn)",
      "75:         );",
      "",
      "[Removed Lines]",
      "72:             urlencode($cn),",
      "",
      "[Added Lines]",
      "72:             htmlspecialchars(urlencode($cn)),",
      "",
      "---------------"
    ],
    "libraries/plugins/transformations/abs/ImageLinkTransformationsPlugin.php||libraries/plugins/transformations/abs/ImageLinkTransformationsPlugin.php": [
      "File: libraries/plugins/transformations/abs/ImageLinkTransformationsPlugin.php -> libraries/plugins/transformations/abs/ImageLinkTransformationsPlugin.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "49:     {",
      "62:     }",
      "",
      "[Removed Lines]",
      "52:         $transform_options = array(",
      "53:             'string' => '<a class=\"disableAjax\"'",
      "54:                 . ' target=\"_new\" href=\"transformation_wrapper.php'",
      "55:                 . $options['wrapper_link'] . '\" alt=\"[__BUFFER__]\">[BLOB]</a>',",
      "56:         );",
      "58:         return PMA_Transformation_globalHtmlReplace(",
      "59:             $buffer,",
      "60:             $transform_options",
      "61:         );",
      "",
      "[Added Lines]",
      "52:         return '<a class=\"disableAjax\" target=\"_new\" href=\"transformation_wrapper.php'",
      "53:             . $options['wrapper_link'] . '\" alt=\"[' . htmlspecialchars($buffer) . ']\">[BLOB]</a>';",
      "",
      "---------------"
    ],
    "libraries/plugins/transformations/abs/InlineTransformationsPlugin.php||libraries/plugins/transformations/abs/InlineTransformationsPlugin.php": [
      "File: libraries/plugins/transformations/abs/InlineTransformationsPlugin.php -> libraries/plugins/transformations/abs/InlineTransformationsPlugin.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "49:     public function applyTransformation($buffer, $options = array(), $meta = '')",
      "50:     {",
      "51:         if (PMA_IS_GD2) {",
      "61:         } else {",
      "67:         }",
      "73:     }",
      "",
      "[Removed Lines]",
      "52:             $transform_options = array(",
      "53:                 'string' => '<a href=\"transformation_wrapper.php'",
      "54:                     . $options['wrapper_link']",
      "55:                     . '\" target=\"_blank\"><img src=\"transformation_wrapper.php'",
      "56:                     . $options['wrapper_link'] . '&amp;resize=jpeg&amp;newWidth='",
      "57:                     . (isset($options[0]) ? $options[0] : '100') . '&amp;newHeight='",
      "58:                     . (isset($options[1]) ? $options[1] : 100)",
      "59:                     . '\" alt=\"[__BUFFER__]\" border=\"0\" /></a>',",
      "60:             );",
      "62:             $transform_options = array(",
      "63:                 'string' => '<img src=\"transformation_wrapper.php'",
      "64:                     . $options['wrapper_link']",
      "65:                     . '\" alt=\"[__BUFFER__]\" width=\"320\" height=\"240\" />',",
      "66:             );",
      "69:         return PMA_Transformation_globalHtmlReplace(",
      "70:             $buffer,",
      "71:             $transform_options",
      "72:         );",
      "",
      "[Added Lines]",
      "52:             return '<a href=\"transformation_wrapper.php'",
      "53:                 . $options['wrapper_link']",
      "54:                 . '\" target=\"_blank\"><img src=\"transformation_wrapper.php'",
      "55:                 . $options['wrapper_link'] . '&amp;resize=jpeg&amp;newWidth='",
      "56:                 . (isset($options[0]) ? $options[0] : '100') . '&amp;newHeight='",
      "57:                 . (isset($options[1]) ? $options[1] : 100)",
      "58:                 . '\" alt=\"[' . htmlspecialchars($buffer) . ']\" border=\"0\" /></a>';",
      "60:             return '<img src=\"transformation_wrapper.php'",
      "61:                 . $options['wrapper_link']",
      "62:                 . '\" alt=\"[' . htmlspecialchars($buffer) . ']\" width=\"320\" height=\"240\" />';",
      "",
      "---------------"
    ],
    "libraries/plugins/transformations/abs/LongToIPv4TransformationsPlugin.php||libraries/plugins/transformations/abs/LongToIPv4TransformationsPlugin.php": [
      "File: libraries/plugins/transformations/abs/LongToIPv4TransformationsPlugin.php -> libraries/plugins/transformations/abs/LongToIPv4TransformationsPlugin.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "42:     public function applyTransformation($buffer, $options = array(), $meta = '')",
      "43:     {",
      "44:         if ($buffer < 0 || $buffer > 4294967295) {",
      "46:         }",
      "48:         return long2ip($buffer);",
      "",
      "[Removed Lines]",
      "45:             return $buffer;",
      "",
      "[Added Lines]",
      "45:             return htmlspecialchars($buffer);",
      "",
      "---------------"
    ],
    "libraries/plugins/transformations/abs/PreApPendTransformationsPlugin.php||libraries/plugins/transformations/abs/PreApPendTransformationsPlugin.php": [
      "File: libraries/plugins/transformations/abs/PreApPendTransformationsPlugin.php -> libraries/plugins/transformations/abs/PreApPendTransformationsPlugin.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "46:         $options = $this->getOptions($options, array('', ''));",
      "50:             . htmlspecialchars($options[1]);",
      "53:     }",
      "",
      "[Removed Lines]",
      "49:         $newtext = htmlspecialchars($options[0]) . $buffer",
      "52:         return $newtext;",
      "",
      "[Added Lines]",
      "49:         return htmlspecialchars($options[0]) . htmlspecialchars($buffer)",
      "",
      "---------------"
    ],
    "libraries/plugins/transformations/abs/SubstringTransformationsPlugin.php||libraries/plugins/transformations/abs/SubstringTransformationsPlugin.php": [
      "File: libraries/plugins/transformations/abs/SubstringTransformationsPlugin.php -> libraries/plugins/transformations/abs/SubstringTransformationsPlugin.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "71:             }",
      "72:         }",
      "75:     }",
      "",
      "[Removed Lines]",
      "74:         return $newtext;",
      "",
      "[Added Lines]",
      "74:         return htmlspecialchars($newtext);",
      "",
      "---------------"
    ],
    "libraries/plugins/transformations/abs/TextImageLinkTransformationsPlugin.php||libraries/plugins/transformations/abs/TextImageLinkTransformationsPlugin.php": [
      "File: libraries/plugins/transformations/abs/TextImageLinkTransformationsPlugin.php -> libraries/plugins/transformations/abs/TextImageLinkTransformationsPlugin.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "14:     exit;",
      "15: }",
      "",
      "[Removed Lines]",
      "18: require_once 'libraries/transformations.lib.php';",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "50:     public function applyTransformation($buffer, $options = array(), $meta = '')",
      "51:     {",
      "67:     }",
      "",
      "[Removed Lines]",
      "52:         $transform_options = array(",
      "53:             'string' => '<a href=\"' . (isset($options[0]) ? $options[0] : '')",
      "54:                 . $buffer . '\" target=\"_blank\"><img src=\"'",
      "55:                 . (isset($options[0]) ? $options[0] : '') . $buffer",
      "56:                 . '\" border=\"0\" width=\"' . (isset($options[1]) ? $options[1] : 100)",
      "57:                 . '\" height=\"' . (isset($options[2]) ? $options[2] : 50) . '\" />'",
      "58:                 . $buffer . '</a>',",
      "59:         );",
      "61:         $buffer = PMA_Transformation_globalHtmlReplace(",
      "62:             $buffer,",
      "63:             $transform_options",
      "64:         );",
      "66:         return $buffer;",
      "",
      "[Added Lines]",
      "49:         return '<a href=\"' . htmlspecialchars(isset($options[0]) ? $options[0] : '')",
      "50:             . htmlspecialchars($buffer) . '\" target=\"_blank\"><img src=\"'",
      "51:             . htmlspecialchars(isset($options[0]) ? $options[0] : '') . htmlspecialchars($buffer)",
      "52:             . '\" border=\"0\" width=\"' . (isset($options[1]) ? $options[1] : 100)",
      "53:             . '\" height=\"' . (isset($options[2]) ? $options[2] : 50) . '\" />'",
      "54:             . htmlspecialchars($buffer) . '</a>';",
      "",
      "---------------"
    ],
    "libraries/plugins/transformations/abs/TextLinkTransformationsPlugin.php||libraries/plugins/transformations/abs/TextLinkTransformationsPlugin.php": [
      "File: libraries/plugins/transformations/abs/TextLinkTransformationsPlugin.php -> libraries/plugins/transformations/abs/TextLinkTransformationsPlugin.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "14:     exit;",
      "15: }",
      "",
      "[Removed Lines]",
      "18: require_once 'libraries/transformations.lib.php';",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "50:     public function applyTransformation($buffer, $options = array(), $meta = '')",
      "51:     {",
      "53:         $append_part = (isset($options[2]) && $options[2]) ? '' : $buffer;",
      "69:     }",
      "",
      "[Removed Lines]",
      "55:         $transform_options = array(",
      "56:             'string' => '<a href=\"'",
      "57:                 . (isset($options[0]) ? $options[0] : '') . $append_part",
      "58:                 . '\" title=\"'",
      "59:                 . htmlspecialchars(isset($options[1]) ? $options[1] : '')",
      "60:                 . '\" target=\"_new\">'",
      "61:                 . htmlspecialchars(isset($options[1]) ? $options[1] : $buffer)",
      "62:                 . '</a>',",
      "63:         );",
      "65:         return PMA_Transformation_globalHtmlReplace(",
      "66:             $buffer,",
      "67:             $transform_options",
      "68:         );",
      "",
      "[Added Lines]",
      "51:         return '<a href=\"'",
      "52:             . htmlspecialchars(isset($options[0]) ? $options[0] : '')",
      "53:             . htmlspecialchars($append_part)",
      "54:             . '\" title=\"'",
      "55:             . htmlspecialchars(isset($options[1]) ? $options[1] : '')",
      "56:             . '\" target=\"_new\">'",
      "57:             . htmlspecialchars(isset($options[1]) ? $options[1] : $buffer)",
      "58:             . '</a>';",
      "",
      "---------------"
    ],
    "libraries/transformations.lib.php||libraries/transformations.lib.php": [
      "File: libraries/transformations.lib.php -> libraries/transformations.lib.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "421: function PMA_Transformation_globalHtmlReplace($buffer, $options = array())",
      "422: {",
      "423:     if (! isset($options['string'])) {",
      "424:         $options['string'] = '';",
      "425:     }",
      "427:     if (isset($options['regex']) && isset($options['regex_replace'])) {",
      "428:         $buffer = preg_replace(",
      "429:             '@' . str_replace('@', '\\@', $options['regex']) . '@si',",
      "430:             $options['regex_replace'],",
      "431:             $buffer",
      "432:         );",
      "433:     }",
      "436:     $return = str_replace(\"[__BUFFER__]\", $buffer, $options['string']);",
      "437:     return $return;",
      "438: }",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ],
    "test/classes/plugin/transformations/TransformationPluginsTest.php||test/classes/plugin/transformations/TransformationPluginsTest.php": [
      "File: test/classes/plugin/transformations/TransformationPluginsTest.php -> test/classes/plugin/transformations/TransformationPluginsTest.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "780:                 '<a href=\"transformation_wrapper.phpPMA_wrapper_link\" '",
      "781:                 . 'target=\"_blank\"><img src=\"transformation_wrapper.php'",
      "782:                 . 'PMA_wrapper_link&amp;resize=jpeg&amp;newWidth=./image/&amp;'",
      "784:             ),",
      "785:             array(",
      "786:                 new Image_JPEG_Link(),",
      "",
      "[Removed Lines]",
      "783:                 . 'newHeight=200\" alt=\"PMA_JPEG_Inline\" border=\"0\" /></a>'",
      "",
      "[Added Lines]",
      "783:                 . 'newHeight=200\" alt=\"[PMA_JPEG_Inline]\" border=\"0\" /></a>'",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "790:                 ),",
      "791:                 '<a class=\"disableAjax\" target=\"_new\"'",
      "792:                 . ' href=\"transformation_wrapper.phpPMA_wrapper_link\"'",
      "794:             ),",
      "795:             array(",
      "796:                 new Image_PNG_Inline(),",
      "",
      "[Removed Lines]",
      "793:                 . ' alt=\"PMA_IMAGE_LINK\">[BLOB]</a>'",
      "",
      "[Added Lines]",
      "793:                 . ' alt=\"[PMA_IMAGE_LINK]\">[BLOB]</a>'",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "802:                 . ' target=\"_blank\"><img src=\"transformation_wrapper.php'",
      "803:                 . 'PMA_wrapper_link&amp;'",
      "804:                 . 'resize=jpeg&amp;newWidth=./image/&amp;newHeight=200\" '",
      "806:             ),",
      "807:             array(",
      "808:                 new Text_Plain_Dateformat(),",
      "",
      "[Removed Lines]",
      "805:                 . 'alt=\"PMA_PNG_Inline\" border=\"0\" /></a>'",
      "",
      "[Added Lines]",
      "805:                 . 'alt=\"[PMA_PNG_Inline]\" border=\"0\" /></a>'",
      "",
      "---------------"
    ],
    "test/libraries/PMA_transformation_test.php||test/libraries/PMA_transformation_test.php": [
      "File: test/libraries/PMA_transformation_test.php -> test/libraries/PMA_transformation_test.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "208:         );",
      "209:     }",
      "",
      "[Removed Lines]",
      "216:     public function testTransformationGlobalHtmlReplace()",
      "217:     {",
      "219:         $actual = PMA_Transformation_globalHtmlReplace('', array());",
      "220:         $this->assertEquals(",
      "221:             '',",
      "222:             $actual",
      "223:         );",
      "226:         $buffer = 'foobar';",
      "227:         $options = array(",
      "228:             'regex' => 'foo',",
      "229:             'regex_replace' => 'bar',",
      "230:             'string' => 'x[__BUFFER__]x'",
      "231:         );",
      "232:         $actual = PMA_Transformation_globalHtmlReplace($buffer, $options);",
      "233:         $this->assertEquals(",
      "234:             'xbarbarx',",
      "235:             $actual",
      "236:         );",
      "237:     }",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "288efea5b42b1514ada0f22c84049067281b3eca",
      "candidate_info": {
        "commit_hash": "288efea5b42b1514ada0f22c84049067281b3eca",
        "repo": "phpmyadmin/phpmyadmin",
        "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/288efea5b42b1514ada0f22c84049067281b3eca",
        "files": [
          "libraries/plugins/transformations/abstract/AppendTransformationsPlugin.class.php",
          "libraries/plugins/transformations/abstract/DateFormatTransformationsPlugin.class.php",
          "libraries/plugins/transformations/abstract/DownloadTransformationsPlugin.class.php",
          "libraries/plugins/transformations/abstract/ImageLinkTransformationsPlugin.class.php",
          "libraries/plugins/transformations/abstract/InlineTransformationsPlugin.class.php",
          "libraries/plugins/transformations/abstract/LongToIPv4TransformationsPlugin.class.php",
          "libraries/plugins/transformations/abstract/SubstringTransformationsPlugin.class.php",
          "libraries/plugins/transformations/abstract/TextImageLinkTransformationsPlugin.class.php",
          "libraries/plugins/transformations/abstract/TextLinkTransformationsPlugin.class.php",
          "libraries/transformations.lib.php"
        ],
        "message": "Simplify and cleanup transformation plugins\n\nRemove PMA_transformation_global_html_replace which makes the code only\nmore confusing.\n\nAlso add escaping to browse transformations.\n\nSigned-off-by: Michal \u010ciha\u0159 <michal@cihar.com>",
        "before_after_code_files": [
          "libraries/plugins/transformations/abstract/AppendTransformationsPlugin.class.php||libraries/plugins/transformations/abstract/AppendTransformationsPlugin.class.php",
          "libraries/plugins/transformations/abstract/DateFormatTransformationsPlugin.class.php||libraries/plugins/transformations/abstract/DateFormatTransformationsPlugin.class.php",
          "libraries/plugins/transformations/abstract/DownloadTransformationsPlugin.class.php||libraries/plugins/transformations/abstract/DownloadTransformationsPlugin.class.php",
          "libraries/plugins/transformations/abstract/ImageLinkTransformationsPlugin.class.php||libraries/plugins/transformations/abstract/ImageLinkTransformationsPlugin.class.php",
          "libraries/plugins/transformations/abstract/InlineTransformationsPlugin.class.php||libraries/plugins/transformations/abstract/InlineTransformationsPlugin.class.php",
          "libraries/plugins/transformations/abstract/LongToIPv4TransformationsPlugin.class.php||libraries/plugins/transformations/abstract/LongToIPv4TransformationsPlugin.class.php",
          "libraries/plugins/transformations/abstract/SubstringTransformationsPlugin.class.php||libraries/plugins/transformations/abstract/SubstringTransformationsPlugin.class.php",
          "libraries/plugins/transformations/abstract/TextImageLinkTransformationsPlugin.class.php||libraries/plugins/transformations/abstract/TextImageLinkTransformationsPlugin.class.php",
          "libraries/plugins/transformations/abstract/TextLinkTransformationsPlugin.class.php||libraries/plugins/transformations/abstract/TextLinkTransformationsPlugin.class.php",
          "libraries/transformations.lib.php||libraries/transformations.lib.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "diff_branch_message": 1,
        "olp_code_files": {
          "patch": [
            "libraries/transformations.lib.php||libraries/transformations.lib.php"
          ],
          "candidate": [
            "libraries/transformations.lib.php||libraries/transformations.lib.php"
          ]
        }
      },
      "candidate_diff": {
        "libraries/plugins/transformations/abstract/AppendTransformationsPlugin.class.php||libraries/plugins/transformations/abstract/AppendTransformationsPlugin.class.php": [
          "File: libraries/plugins/transformations/abstract/AppendTransformationsPlugin.class.php -> libraries/plugins/transformations/abstract/AppendTransformationsPlugin.class.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "49:             $options[0] = '';",
          "50:         }",
          "54:         return $newtext;",
          "55:     }",
          "",
          "[Removed Lines]",
          "52:         $newtext = $buffer . htmlspecialchars($options[0]);",
          "",
          "[Added Lines]",
          "52:         $newtext = htmlspecialchars($buffer) . htmlspecialchars($options[0]);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "83:         return \"Append\";",
          "84:     }",
          "85: }",
          "",
          "[Removed Lines]",
          "86: ?>",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "libraries/plugins/transformations/abstract/DateFormatTransformationsPlugin.class.php||libraries/plugins/transformations/abstract/DateFormatTransformationsPlugin.class.php": [
          "File: libraries/plugins/transformations/abstract/DateFormatTransformationsPlugin.class.php -> libraries/plugins/transformations/abstract/DateFormatTransformationsPlugin.class.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "14: require_once 'libraries/plugins/TransformationsPlugin.class.php';",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "15: require_once 'libraries/js_escape.lib.php';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "139:             } else {",
          "140:                 $text = 'INVALID DATE TYPE';",
          "141:             }",
          "144:         }",
          "147:     }",
          "",
          "[Removed Lines]",
          "142:             $buffer = '<dfn onclick=\"alert(\\'' . $source . '\\');\" title=\"'",
          "143:                 . $source . '\">' . $text . '</dfn>';",
          "146:         return $buffer;",
          "",
          "[Added Lines]",
          "143:             return '<dfn onclick=\"alert(\\'' . PMA_jsFormat($source, false) . '\\');\" title=\"'",
          "144:                 . htmlspecialchars($source) . '\">' . htmlspecialchars($text) . '</dfn>';",
          "145:         } else {",
          "146:             return htmlspecialchars($buffer);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "175:         return \"Date Format\";",
          "176:     }",
          "177: }",
          "",
          "[Removed Lines]",
          "178: ?>",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "libraries/plugins/transformations/abstract/DownloadTransformationsPlugin.class.php||libraries/plugins/transformations/abstract/DownloadTransformationsPlugin.class.php": [
          "File: libraries/plugins/transformations/abstract/DownloadTransformationsPlugin.class.php -> libraries/plugins/transformations/abstract/DownloadTransformationsPlugin.class.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "72:             '<a href=\"transformation_wrapper.php%s&amp;ct=application'",
          "73:             . '/octet-stream&amp;cn=%s\" title=\"%s\">%s</a>',",
          "74:             $options['wrapper_link'],",
          "76:             htmlspecialchars($cn),",
          "77:             htmlspecialchars($cn)",
          "78:         );",
          "",
          "[Removed Lines]",
          "75:             urlencode($cn),",
          "",
          "[Added Lines]",
          "75:             htmlspecialchars(urlencode($cn)),",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "107:         return \"Download\";",
          "108:     }",
          "109: }",
          "",
          "[Removed Lines]",
          "110: ?>",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "libraries/plugins/transformations/abstract/ImageLinkTransformationsPlugin.class.php||libraries/plugins/transformations/abstract/ImageLinkTransformationsPlugin.class.php": [
          "File: libraries/plugins/transformations/abstract/ImageLinkTransformationsPlugin.class.php -> libraries/plugins/transformations/abstract/ImageLinkTransformationsPlugin.class.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "46:     public function applyTransformation($buffer, $options = array(), $meta = '')",
          "47:     {",
          "58:     }",
          "",
          "[Removed Lines]",
          "48:         $transform_options = array (",
          "49:             'string' => '<a href=\"transformation_wrapper.php'",
          "50:                 . $options['wrapper_link'] . '\" alt=\"[__BUFFER__]\">[BLOB]</a>'",
          "51:         );",
          "52:         $buffer = PMA_transformation_global_html_replace(",
          "53:             $buffer,",
          "54:             $transform_options",
          "55:         );",
          "57:         return $buffer;",
          "",
          "[Added Lines]",
          "48:         return '<a href=\"transformation_wrapper.php'",
          "49:             . $options['wrapper_link'] . '\" alt=\"' . htmlspecialchars($buffer) . '\">[BLOB]</a>';",
          "",
          "---------------"
        ],
        "libraries/plugins/transformations/abstract/InlineTransformationsPlugin.class.php||libraries/plugins/transformations/abstract/InlineTransformationsPlugin.class.php": [
          "File: libraries/plugins/transformations/abstract/InlineTransformationsPlugin.class.php -> libraries/plugins/transformations/abstract/InlineTransformationsPlugin.class.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "47:     public function applyTransformation($buffer, $options = array(), $meta = '')",
          "48:     {",
          "49:         if (PMA_IS_GD2) {",
          "59:         } else {",
          "62:                 . $options['wrapper_link']",
          "65:         }",
          "72:     }",
          "",
          "[Removed Lines]",
          "50:             $transform_options = array (",
          "51:                 'string' => '<a href=\"transformation_wrapper.php'",
          "52:                     . $options['wrapper_link']",
          "53:                     . '\" target=\"_blank\"><img src=\"transformation_wrapper.php'",
          "54:                     . $options['wrapper_link'] . '&amp;resize=jpeg&amp;newWidth='",
          "55:                     . (isset($options[0]) ? $options[0] : '100') . '&amp;newHeight='",
          "56:                     . (isset($options[1]) ? $options[1] : 100)",
          "57:                     . '\" alt=\"[__BUFFER__]\" border=\"0\" /></a>'",
          "58:             );",
          "60:             $transform_options = array (",
          "61:                 'string' => '<img src=\"transformation_wrapper.php'",
          "63:                 . '\" alt=\"[__BUFFER__]\" width=\"320\" height=\"240\" />'",
          "64:             );",
          "66:         $buffer = PMA_transformation_global_html_replace(",
          "67:             $buffer,",
          "68:             $transform_options",
          "69:         );",
          "71:         return $buffer;",
          "",
          "[Added Lines]",
          "50:             return '<a href=\"transformation_wrapper.php'",
          "51:                 . $options['wrapper_link']",
          "52:                 . '\" target=\"_blank\"><img src=\"transformation_wrapper.php'",
          "53:                 . $options['wrapper_link'] . '&amp;resize=jpeg&amp;newWidth='",
          "54:                 . (isset($options[0]) ? $options[0] : '100') . '&amp;newHeight='",
          "55:                 . (isset($options[1]) ? $options[1] : 100)",
          "56:                 . '\" alt=\"' . htmlspecialchars($buffer) . '\" border=\"0\" /></a>';",
          "58:             return '<img src=\"transformation_wrapper.php'",
          "60:                 . '\" alt=\"' . htmlspecialchars($buffer) . '\" width=\"320\" height=\"240\" />';",
          "",
          "---------------"
        ],
        "libraries/plugins/transformations/abstract/LongToIPv4TransformationsPlugin.class.php||libraries/plugins/transformations/abstract/LongToIPv4TransformationsPlugin.class.php": [
          "File: libraries/plugins/transformations/abstract/LongToIPv4TransformationsPlugin.class.php -> libraries/plugins/transformations/abstract/LongToIPv4TransformationsPlugin.class.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "45:     public function applyTransformation($buffer, $options = array(), $meta = '')",
          "46:     {",
          "47:         if ($buffer < 0 || $buffer > 4294967295) {",
          "49:         }",
          "51:         return long2ip($buffer);",
          "",
          "[Removed Lines]",
          "48:             return $buffer;",
          "",
          "[Added Lines]",
          "48:             return htmlspecialchars($buffer);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "80:         return \"Long To IPv4\";",
          "81:     }",
          "82: }",
          "",
          "[Removed Lines]",
          "83: ?>",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "libraries/plugins/transformations/abstract/SubstringTransformationsPlugin.class.php||libraries/plugins/transformations/abstract/SubstringTransformationsPlugin.class.php": [
          "File: libraries/plugins/transformations/abstract/SubstringTransformationsPlugin.class.php -> libraries/plugins/transformations/abstract/SubstringTransformationsPlugin.class.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "81:             }",
          "82:         }",
          "85:     }",
          "",
          "[Removed Lines]",
          "84:         return $newtext;",
          "",
          "[Added Lines]",
          "84:         return htmlspecialchars($newtext);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "113:         return \"Substring\";",
          "114:     }",
          "115: }",
          "",
          "[Removed Lines]",
          "116: ?>",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "libraries/plugins/transformations/abstract/TextImageLinkTransformationsPlugin.class.php||libraries/plugins/transformations/abstract/TextImageLinkTransformationsPlugin.class.php": [
          "File: libraries/plugins/transformations/abstract/TextImageLinkTransformationsPlugin.class.php -> libraries/plugins/transformations/abstract/TextImageLinkTransformationsPlugin.class.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "14: require_once 'libraries/plugins/TransformationsPlugin.class.php';",
          "",
          "[Removed Lines]",
          "16: require_once 'libraries/transformations.lib.php';",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "48:     public function applyTransformation($buffer, $options = array(), $meta = '')",
          "49:     {",
          "65:     }",
          "",
          "[Removed Lines]",
          "50:         $transform_options = array (",
          "51:             'string' => '<a href=\"' . (isset($options[0]) ? $options[0] : '')",
          "52:                 . $buffer . '\" target=\"_blank\"><img src=\"'",
          "53:                 . (isset($options[0]) ? $options[0] : '') . $buffer",
          "54:                 . '\" border=\"0\" width=\"' . (isset($options[1]) ? $options[1] : 100)",
          "55:                 . '\" height=\"' . (isset($options[2]) ? $options[2] : 50) . '\" />'",
          "56:                 . $buffer . '</a>'",
          "57:         );",
          "59:         $buffer = PMA_transformation_global_html_replace(",
          "60:             $buffer,",
          "61:             $transform_options",
          "62:         );",
          "64:         return $buffer;",
          "",
          "[Added Lines]",
          "48:         return '<a href=\"' . htmlspecialchars(isset($options[0]) ? $options[0] : '')",
          "49:             . htmlspecialchars($buffer) . '\" target=\"_blank\"><img src=\"'",
          "50:             . htmlspecialchars(isset($options[0]) ? $options[0] : '') . htmlspecialchars($buffer)",
          "51:             . '\" border=\"0\" width=\"' . (isset($options[1]) ? $options[1] : 100)",
          "52:             . '\" height=\"' . (isset($options[2]) ? $options[2] : 50) . '\" />'",
          "53:             . htmlspecialchars($buffer) . '</a>';",
          "",
          "---------------"
        ],
        "libraries/plugins/transformations/abstract/TextLinkTransformationsPlugin.class.php||libraries/plugins/transformations/abstract/TextLinkTransformationsPlugin.class.php": [
          "File: libraries/plugins/transformations/abstract/TextLinkTransformationsPlugin.class.php -> libraries/plugins/transformations/abstract/TextLinkTransformationsPlugin.class.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "14: require_once 'libraries/plugins/TransformationsPlugin.class.php';",
          "",
          "[Removed Lines]",
          "16: require_once 'libraries/transformations.lib.php';",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "51:         $append_part = (isset($options[2]) && $options[2]) ? '' : $buffer;",
          "69:     }",
          "",
          "[Removed Lines]",
          "53:         $transform_options = array (",
          "54:             'string' => '<a href=\"'",
          "55:                 . PMA_linkURL((isset($options[0]) ? $options[0] : '') . $append_part)",
          "56:                 . '\" title=\"'",
          "57:                 . htmlspecialchars(isset($options[1]) ? $options[1] : '')",
          "58:                 . '\" target=\"_new\">'",
          "59:                 . htmlspecialchars(isset($options[1]) ? $options[1] : $buffer)",
          "60:                 . '</a>'",
          "61:         );",
          "63:         $buffer = PMA_transformation_global_html_replace(",
          "64:             $buffer,",
          "65:             $transform_options",
          "66:         );",
          "68:         return $buffer;",
          "",
          "[Added Lines]",
          "51:         return '<a href=\"'",
          "52:             . PMA_linkURL(htmlspecialchars(isset($options[0]) ? $options[0] : '')",
          "53:             . htmlspecialchars($append_part))",
          "54:             . '\" title=\"'",
          "55:             . htmlspecialchars(isset($options[1]) ? $options[1] : '')",
          "56:             . '\" target=\"_new\">'",
          "57:             . htmlspecialchars(isset($options[1]) ? $options[1] : $buffer)",
          "58:             . '</a>';",
          "",
          "---------------"
        ],
        "libraries/transformations.lib.php||libraries/transformations.lib.php": [
          "File: libraries/transformations.lib.php -> libraries/transformations.lib.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "350: function PMA_transformation_global_html_replace($buffer, $options = array())",
          "351: {",
          "352:     if ( ! isset($options['string']) ) {",
          "353:         $options['string'] = '';",
          "354:     }",
          "356:     if (isset($options['regex']) && isset($options['regex_replace'])) {",
          "357:         $buffer = preg_replace(",
          "358:             '@' . str_replace('@', '\\@', $options['regex']) . '@si',",
          "359:             $options['regex_replace'],",
          "360:             $buffer",
          "361:         );",
          "362:     }",
          "365:     $return = str_replace(\"[__BUFFER__]\", $buffer, $options['string']);",
          "366:     return $return;",
          "367: }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "feb911e90a26995b8ff7cfa5aeb3ed6a2bd70acf",
      "candidate_info": {
        "commit_hash": "feb911e90a26995b8ff7cfa5aeb3ed6a2bd70acf",
        "repo": "phpmyadmin/phpmyadmin",
        "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/feb911e90a26995b8ff7cfa5aeb3ed6a2bd70acf",
        "files": [
          "libraries/plugins/transformations/abstract/DateFormatTransformationsPlugin.class.php",
          "libraries/plugins/transformations/abstract/DownloadTransformationsPlugin.class.php",
          "libraries/plugins/transformations/abstract/ImageLinkTransformationsPlugin.class.php",
          "libraries/plugins/transformations/abstract/InlineTransformationsPlugin.class.php",
          "libraries/plugins/transformations/abstract/LongToIPv4TransformationsPlugin.class.php",
          "libraries/plugins/transformations/abstract/PreApPendTransformationsPlugin.class.php",
          "libraries/plugins/transformations/abstract/SubstringTransformationsPlugin.class.php",
          "libraries/plugins/transformations/abstract/TextImageLinkTransformationsPlugin.class.php",
          "libraries/plugins/transformations/abstract/TextLinkTransformationsPlugin.class.php",
          "libraries/transformations.lib.php",
          "test/libraries/PMA_transformation_test.php"
        ],
        "message": "Simplify and cleanup transformation plugins\n\nRemove PMA_transformation_global_html_replace which makes the code only\nmore confusing.\n\nAlso add escaping to browse transformations.\n\nSigned-off-by: Michal \u010ciha\u0159 <michal@cihar.com>",
        "before_after_code_files": [
          "libraries/plugins/transformations/abstract/DateFormatTransformationsPlugin.class.php||libraries/plugins/transformations/abstract/DateFormatTransformationsPlugin.class.php",
          "libraries/plugins/transformations/abstract/DownloadTransformationsPlugin.class.php||libraries/plugins/transformations/abstract/DownloadTransformationsPlugin.class.php",
          "libraries/plugins/transformations/abstract/ImageLinkTransformationsPlugin.class.php||libraries/plugins/transformations/abstract/ImageLinkTransformationsPlugin.class.php",
          "libraries/plugins/transformations/abstract/InlineTransformationsPlugin.class.php||libraries/plugins/transformations/abstract/InlineTransformationsPlugin.class.php",
          "libraries/plugins/transformations/abstract/LongToIPv4TransformationsPlugin.class.php||libraries/plugins/transformations/abstract/LongToIPv4TransformationsPlugin.class.php",
          "libraries/plugins/transformations/abstract/PreApPendTransformationsPlugin.class.php||libraries/plugins/transformations/abstract/PreApPendTransformationsPlugin.class.php",
          "libraries/plugins/transformations/abstract/SubstringTransformationsPlugin.class.php||libraries/plugins/transformations/abstract/SubstringTransformationsPlugin.class.php",
          "libraries/plugins/transformations/abstract/TextImageLinkTransformationsPlugin.class.php||libraries/plugins/transformations/abstract/TextImageLinkTransformationsPlugin.class.php",
          "libraries/plugins/transformations/abstract/TextLinkTransformationsPlugin.class.php||libraries/plugins/transformations/abstract/TextLinkTransformationsPlugin.class.php",
          "libraries/transformations.lib.php||libraries/transformations.lib.php",
          "test/libraries/PMA_transformation_test.php||test/libraries/PMA_transformation_test.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "diff_branch_message": 1,
        "olp_code_files": {
          "patch": [
            "libraries/transformations.lib.php||libraries/transformations.lib.php",
            "test/libraries/PMA_transformation_test.php||test/libraries/PMA_transformation_test.php"
          ],
          "candidate": [
            "libraries/transformations.lib.php||libraries/transformations.lib.php",
            "test/libraries/PMA_transformation_test.php||test/libraries/PMA_transformation_test.php"
          ]
        }
      },
      "candidate_diff": {
        "libraries/plugins/transformations/abstract/DateFormatTransformationsPlugin.class.php||libraries/plugins/transformations/abstract/DateFormatTransformationsPlugin.class.php": [
          "File: libraries/plugins/transformations/abstract/DateFormatTransformationsPlugin.class.php -> libraries/plugins/transformations/abstract/DateFormatTransformationsPlugin.class.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "14: require_once 'libraries/plugins/TransformationsPlugin.class.php';",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "15: require_once 'libraries/js_escape.lib.php';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "141:             } else {",
          "142:                 $text = 'INVALID DATE TYPE';",
          "143:             }",
          "146:         }",
          "149:     }",
          "",
          "[Removed Lines]",
          "144:             $buffer = '<dfn onclick=\"alert(\\'' . $source . '\\');\" title=\"'",
          "145:                 . $source . '\">' . $text . '</dfn>';",
          "148:         return $buffer;",
          "",
          "[Added Lines]",
          "145:             return '<dfn onclick=\"alert(\\'' . PMA_jsFormat($source, false) . '\\');\" title=\"'",
          "146:                 . htmlspecialchars($source) . '\">' . htmlspecialchars($text) . '</dfn>';",
          "147:         } else {",
          "148:             return htmlspecialchars($buffer);",
          "",
          "---------------"
        ],
        "libraries/plugins/transformations/abstract/DownloadTransformationsPlugin.class.php||libraries/plugins/transformations/abstract/DownloadTransformationsPlugin.class.php": [
          "File: libraries/plugins/transformations/abstract/DownloadTransformationsPlugin.class.php -> libraries/plugins/transformations/abstract/DownloadTransformationsPlugin.class.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "72:             '<a href=\"transformation_wrapper.php%s&amp;ct=application'",
          "73:             . '/octet-stream&amp;cn=%s\" title=\"%s\" class=\"disableAjax\">%s</a>',",
          "74:             $options['wrapper_link'],",
          "76:             htmlspecialchars($cn),",
          "77:             htmlspecialchars($cn)",
          "78:         );",
          "",
          "[Removed Lines]",
          "75:             urlencode($cn),",
          "",
          "[Added Lines]",
          "75:             htmlspecialchars(urlencode($cn)),",
          "",
          "---------------"
        ],
        "libraries/plugins/transformations/abstract/ImageLinkTransformationsPlugin.class.php||libraries/plugins/transformations/abstract/ImageLinkTransformationsPlugin.class.php": [
          "File: libraries/plugins/transformations/abstract/ImageLinkTransformationsPlugin.class.php -> libraries/plugins/transformations/abstract/ImageLinkTransformationsPlugin.class.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "47:     {",
          "59:     }",
          "",
          "[Removed Lines]",
          "50:         $transform_options = array (",
          "51:             'string' => '<a class=\"disableAjax\"'",
          "52:                 . ' target=\"_new\" href=\"transformation_wrapper.php'",
          "53:                 . $options['wrapper_link'] . '\" alt=\"[__BUFFER__]\">[BLOB]</a>'",
          "54:         );",
          "55:         return PMA_Transformation_globalHtmlReplace(",
          "56:             $buffer,",
          "57:             $transform_options",
          "58:         );",
          "",
          "[Added Lines]",
          "50:         return '<a class=\"disableAjax\" target=\"_new\" href=\"transformation_wrapper.php'",
          "51:             . $options['wrapper_link'] . '\" alt=\"' . htmlspecialchars($buffer) . '\">[BLOB]</a>';",
          "",
          "---------------"
        ],
        "libraries/plugins/transformations/abstract/InlineTransformationsPlugin.class.php||libraries/plugins/transformations/abstract/InlineTransformationsPlugin.class.php": [
          "File: libraries/plugins/transformations/abstract/InlineTransformationsPlugin.class.php -> libraries/plugins/transformations/abstract/InlineTransformationsPlugin.class.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "47:     public function applyTransformation($buffer, $options = array(), $meta = '')",
          "48:     {",
          "49:         if (PMA_IS_GD2) {",
          "59:         } else {",
          "62:                 . $options['wrapper_link']",
          "65:         }",
          "70:     }",
          "",
          "[Removed Lines]",
          "50:             $transform_options = array (",
          "51:                 'string' => '<a href=\"transformation_wrapper.php'",
          "52:                     . $options['wrapper_link']",
          "53:                     . '\" target=\"_blank\"><img src=\"transformation_wrapper.php'",
          "54:                     . $options['wrapper_link'] . '&amp;resize=jpeg&amp;newWidth='",
          "55:                     . (isset($options[0]) ? $options[0] : '100') . '&amp;newHeight='",
          "56:                     . (isset($options[1]) ? $options[1] : 100)",
          "57:                     . '\" alt=\"[__BUFFER__]\" border=\"0\" /></a>'",
          "58:             );",
          "60:             $transform_options = array (",
          "61:                 'string' => '<img src=\"transformation_wrapper.php'",
          "63:                 . '\" alt=\"[__BUFFER__]\" width=\"320\" height=\"240\" />'",
          "64:             );",
          "66:         return PMA_Transformation_globalHtmlReplace(",
          "67:             $buffer,",
          "68:             $transform_options",
          "69:         );",
          "",
          "[Added Lines]",
          "50:             return '<a href=\"transformation_wrapper.php'",
          "51:                 . $options['wrapper_link']",
          "52:                 . '\" target=\"_blank\"><img src=\"transformation_wrapper.php'",
          "53:                 . $options['wrapper_link'] . '&amp;resize=jpeg&amp;newWidth='",
          "54:                 . (isset($options[0]) ? $options[0] : '100') . '&amp;newHeight='",
          "55:                 . (isset($options[1]) ? $options[1] : 100)",
          "56:                 . '\" alt=\"' . htmlspecialchars($buffer) . '\" border=\"0\" /></a>';",
          "58:             return '<img src=\"transformation_wrapper.php'",
          "60:                 . '\" alt=\"' . htmlspecialchars($buffer) . '\" width=\"320\" height=\"240\" />';",
          "",
          "---------------"
        ],
        "libraries/plugins/transformations/abstract/LongToIPv4TransformationsPlugin.class.php||libraries/plugins/transformations/abstract/LongToIPv4TransformationsPlugin.class.php": [
          "File: libraries/plugins/transformations/abstract/LongToIPv4TransformationsPlugin.class.php -> libraries/plugins/transformations/abstract/LongToIPv4TransformationsPlugin.class.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "45:     public function applyTransformation($buffer, $options = array(), $meta = '')",
          "46:     {",
          "47:         if ($buffer < 0 || $buffer > 4294967295) {",
          "49:         }",
          "51:         return long2ip($buffer);",
          "",
          "[Removed Lines]",
          "48:             return $buffer;",
          "",
          "[Added Lines]",
          "48:             return htmlspecialchars($buffer);",
          "",
          "---------------"
        ],
        "libraries/plugins/transformations/abstract/PreApPendTransformationsPlugin.class.php||libraries/plugins/transformations/abstract/PreApPendTransformationsPlugin.class.php": [
          "File: libraries/plugins/transformations/abstract/PreApPendTransformationsPlugin.class.php -> libraries/plugins/transformations/abstract/PreApPendTransformationsPlugin.class.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "49:         $options = $this->getOptions($options, array('', ''));",
          "53:             . htmlspecialchars($options[1]);",
          "56:     }",
          "",
          "[Removed Lines]",
          "52:         $newtext = htmlspecialchars($options[0]) . $buffer",
          "55:         return $newtext;",
          "",
          "[Added Lines]",
          "52:         return htmlspecialchars($options[0]) . htmlspecialchars($buffer)",
          "",
          "---------------"
        ],
        "libraries/plugins/transformations/abstract/SubstringTransformationsPlugin.class.php||libraries/plugins/transformations/abstract/SubstringTransformationsPlugin.class.php": [
          "File: libraries/plugins/transformations/abstract/SubstringTransformationsPlugin.class.php -> libraries/plugins/transformations/abstract/SubstringTransformationsPlugin.class.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "72:             }",
          "73:         }",
          "76:     }",
          "",
          "[Removed Lines]",
          "75:         return $newtext;",
          "",
          "[Added Lines]",
          "75:         return htmlspecialchars($newtext);",
          "",
          "---------------"
        ],
        "libraries/plugins/transformations/abstract/TextImageLinkTransformationsPlugin.class.php||libraries/plugins/transformations/abstract/TextImageLinkTransformationsPlugin.class.php": [
          "File: libraries/plugins/transformations/abstract/TextImageLinkTransformationsPlugin.class.php -> libraries/plugins/transformations/abstract/TextImageLinkTransformationsPlugin.class.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "14: require_once 'libraries/plugins/TransformationsPlugin.class.php';",
          "",
          "[Removed Lines]",
          "16: require_once 'libraries/transformations.lib.php';",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "48:     public function applyTransformation($buffer, $options = array(), $meta = '')",
          "49:     {",
          "65:     }",
          "",
          "[Removed Lines]",
          "50:         $transform_options = array (",
          "51:             'string' => '<a href=\"' . (isset($options[0]) ? $options[0] : '')",
          "52:                 . $buffer . '\" target=\"_blank\"><img src=\"'",
          "53:                 . (isset($options[0]) ? $options[0] : '') . $buffer",
          "54:                 . '\" border=\"0\" width=\"' . (isset($options[1]) ? $options[1] : 100)",
          "55:                 . '\" height=\"' . (isset($options[2]) ? $options[2] : 50) . '\" />'",
          "56:                 . $buffer . '</a>'",
          "57:         );",
          "59:         $buffer = PMA_Transformation_globalHtmlReplace(",
          "60:             $buffer,",
          "61:             $transform_options",
          "62:         );",
          "64:         return $buffer;",
          "",
          "[Added Lines]",
          "48:         return '<a href=\"' . htmlspecialchars(isset($options[0]) ? $options[0] : '')",
          "49:             . htmlspecialchars($buffer) . '\" target=\"_blank\"><img src=\"'",
          "50:             . htmlspecialchars(isset($options[0]) ? $options[0] : '') . htmlspecialchars($buffer)",
          "51:             . '\" border=\"0\" width=\"' . (isset($options[1]) ? $options[1] : 100)",
          "52:             . '\" height=\"' . (isset($options[2]) ? $options[2] : 50) . '\" />'",
          "53:             . htmlspecialchars($buffer) . '</a>';",
          "",
          "---------------"
        ],
        "libraries/plugins/transformations/abstract/TextLinkTransformationsPlugin.class.php||libraries/plugins/transformations/abstract/TextLinkTransformationsPlugin.class.php": [
          "File: libraries/plugins/transformations/abstract/TextLinkTransformationsPlugin.class.php -> libraries/plugins/transformations/abstract/TextLinkTransformationsPlugin.class.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "14: require_once 'libraries/plugins/TransformationsPlugin.class.php';",
          "",
          "[Removed Lines]",
          "16: require_once 'libraries/transformations.lib.php';",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "48:     public function applyTransformation($buffer, $options = array(), $meta = '')",
          "49:     {",
          "51:         $append_part = (isset($options[2]) && $options[2]) ? '' : $buffer;",
          "67:     }",
          "",
          "[Removed Lines]",
          "53:         $transform_options = array (",
          "54:             'string' => '<a href=\"'",
          "55:                 . (isset($options[0]) ? $options[0] : '') . $append_part",
          "56:                 . '\" title=\"'",
          "57:                 . htmlspecialchars(isset($options[1]) ? $options[1] : '')",
          "58:                 . '\" target=\"_new\">'",
          "59:                 . htmlspecialchars(isset($options[1]) ? $options[1] : $buffer)",
          "60:                 . '</a>'",
          "61:         );",
          "63:         return PMA_Transformation_globalHtmlReplace(",
          "64:             $buffer,",
          "65:             $transform_options",
          "66:         );",
          "",
          "[Added Lines]",
          "50:         return '<a href=\"'",
          "51:             . htmlspecialchars(isset($options[0]) ? $options[0] : '')",
          "52:             . htmlspecialchars($append_part)",
          "53:             . '\" title=\"'",
          "54:             . htmlspecialchars(isset($options[1]) ? $options[1] : '')",
          "55:             . '\" target=\"_new\">'",
          "56:             . htmlspecialchars(isset($options[1]) ? $options[1] : $buffer)",
          "57:             . '</a>';",
          "",
          "---------------"
        ],
        "libraries/transformations.lib.php||libraries/transformations.lib.php": [
          "File: libraries/transformations.lib.php -> libraries/transformations.lib.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "399: function PMA_Transformation_globalHtmlReplace($buffer, $options = array())",
          "400: {",
          "401:     if ( ! isset($options['string']) ) {",
          "402:         $options['string'] = '';",
          "403:     }",
          "405:     if (isset($options['regex']) && isset($options['regex_replace'])) {",
          "406:         $buffer = preg_replace(",
          "407:             '@' . str_replace('@', '\\@', $options['regex']) . '@si',",
          "408:             $options['regex_replace'],",
          "409:             $buffer",
          "410:         );",
          "411:     }",
          "414:     $return = str_replace(\"[__BUFFER__]\", $buffer, $options['string']);",
          "415:     return $return;",
          "416: }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "test/libraries/PMA_transformation_test.php||test/libraries/PMA_transformation_test.php": [
          "File: test/libraries/PMA_transformation_test.php -> test/libraries/PMA_transformation_test.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "204:         );",
          "205:     }",
          "",
          "[Removed Lines]",
          "212:     public function testTransformationGlobalHtmlReplace()",
          "213:     {",
          "215:         $actual = PMA_Transformation_globalHtmlReplace('', array());",
          "216:         $this->assertEquals(",
          "217:             '',",
          "218:             $actual",
          "219:         );",
          "222:         $buffer = 'foobar';",
          "223:         $options = array(",
          "224:             'regex' => 'foo',",
          "225:             'regex_replace' => 'bar',",
          "226:             'string' => 'x[__BUFFER__]x'",
          "227:         );",
          "228:         $actual = PMA_Transformation_globalHtmlReplace($buffer, $options);",
          "229:         $this->assertEquals(",
          "230:             'xbarbarx',",
          "231:             $actual",
          "232:         );",
          "233:     }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    }
  ]
}