{
  "cve_id": "CVE-2017-3730",
  "cve_desc": "In OpenSSL 1.1.0 before 1.1.0d, if a malicious server supplies bad parameters for a DHE or ECDHE key exchange then this can result in the client attempting to dereference a NULL pointer leading to a client crash. This could be exploited in a Denial of Service attack.",
  "repo": "openssl/openssl",
  "patch_hash": "efbe126e3ebb9123ac9d058aa2bb044261342aaa",
  "patch_info": {
    "commit_hash": "efbe126e3ebb9123ac9d058aa2bb044261342aaa",
    "repo": "openssl/openssl",
    "commit_url": "https://github.com/openssl/openssl/commit/efbe126e3ebb9123ac9d058aa2bb044261342aaa",
    "files": [
      "ssl/statem/statem_clnt.c"
    ],
    "message": "Fix missing NULL checks in CKE processing\n\nReviewed-by: Rich Salz <rsalz@openssl.org>",
    "before_after_code_files": [
      "ssl/statem/statem_clnt.c||ssl/statem/statem_clnt.c"
    ]
  },
  "patch_diff": {
    "ssl/statem/statem_clnt.c||ssl/statem/statem_clnt.c": [
      "File: ssl/statem/statem_clnt.c -> ssl/statem/statem_clnt.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "2258:         return 0;",
      "2259:     }",
      "2260:     ckey = ssl_generate_pkey(skey);",
      "2261:     dh_clnt = EVP_PKEY_get0_DH(ckey);",
      "2263:     if (dh_clnt == NULL || ssl_derive(s, ckey, skey) == 0) {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "2261:     if (ckey == NULL) {",
      "2262:         SSLerr(SSL_F_TLS_CONSTRUCT_CKE_DHE, ERR_R_INTERNAL_ERROR);",
      "2263:         return 0;",
      "2264:     }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "2296:     }",
      "2298:     ckey = ssl_generate_pkey(skey);",
      "2300:     if (ssl_derive(s, ckey, skey) == 0) {",
      "2301:         SSLerr(SSL_F_TLS_CONSTRUCT_CKE_ECDHE, ERR_R_EVP_LIB);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "2304:     if (ckey == NULL) {",
      "2305:         SSLerr(SSL_F_TLS_CONSTRUCT_CKE_ECDHE, ERR_R_INTERNAL_ERROR);",
      "2306:         goto err;",
      "2307:     }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "d6637ce17ec5b811ea06543f3b584d25bfdeaaa3",
      "candidate_info": {
        "commit_hash": "d6637ce17ec5b811ea06543f3b584d25bfdeaaa3",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/d6637ce17ec5b811ea06543f3b584d25bfdeaaa3",
        "files": [
          "apps/dgst.c"
        ],
        "message": "RT3669: dgst can only sign/verify one file.\n\nCheck arg count and print an error message.\n\nReviewed-by: Richard Levitte <levitte@openssl.org>\n(cherry picked from commit 13a461831ab85ec9f55806ebf2df5ffb7f3f357a)",
        "before_after_code_files": [
          "apps/dgst.c||apps/dgst.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "apps/dgst.c||apps/dgst.c": [
          "File: apps/dgst.c -> apps/dgst.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "185:     }",
          "186:     argc = opt_num_rest();",
          "187:     argv = opt_rest();",
          "189:     if (do_verify && !sigfile) {",
          "190:         BIO_printf(bio_err,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "188:     if (keyfile != NULL && argc > 1) {",
          "189:         BIO_printf(bio_err, \"%s: Can only sign or verify one file.\\n\", prog);",
          "190:         goto end;",
          "191:     }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "8f8e9f184bf51fa283c1af9c4fd63098fc7387dd",
      "candidate_info": {
        "commit_hash": "8f8e9f184bf51fa283c1af9c4fd63098fc7387dd",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/8f8e9f184bf51fa283c1af9c4fd63098fc7387dd",
        "files": [
          "test/recipes/90-test_shlibload.t",
          "test/shlibloadtest.c"
        ],
        "message": "Don't assume to know the shared library extension\n\ntest/shlibloadtest.c assumes all Unix style platforms use .so as\nshared library extension.  This is not the case for Mac OS X, which\nuses .dylib.  Instead of this, have the test recipe find out the\nextension from configuration data.\n\nReviewed-by: Matt Caswell <matt@openssl.org>\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/1844)\n(cherry picked from commit 62dd3351a16089aedb0f1e62e3b6df371c93389c)",
        "before_after_code_files": [
          "test/recipes/90-test_shlibload.t||test/recipes/90-test_shlibload.t",
          "test/shlibloadtest.c||test/shlibloadtest.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "test/recipes/90-test_shlibload.t||test/recipes/90-test_shlibload.t": [
          "File: test/recipes/90-test_shlibload.t -> test/recipes/90-test_shlibload.t",
          "--- Hunk 1 ---",
          "[Context before]",
          "23: plan tests => 3;",
          "28:    \"running shlibloadtest -crypto_first\");",
          "32:    \"running shlibloadtest -ssl_first\");",
          "36:    \"running shlibloadtest -just_crypto\");",
          "",
          "[Removed Lines]",
          "25: ok(run(test([\"shlibloadtest\", \"-crypto_first\",",
          "26:              $unified_info{sharednames}->{libcrypto},",
          "27:              $unified_info{sharednames}->{libssl}])),",
          "29: ok(run(test([\"shlibloadtest\", \"-ssl_first\",",
          "30:              $unified_info{sharednames}->{libcrypto},",
          "31:              $unified_info{sharednames}->{libssl}])),",
          "33: ok(run(test([\"shlibloadtest\", \"-just_crypto\",",
          "34:              $unified_info{sharednames}->{libcrypto},",
          "35:              $unified_info{sharednames}->{libssl}])),",
          "",
          "[Added Lines]",
          "25: my $libcrypto =",
          "26:     $unified_info{sharednames}->{libcrypto}.$target{shared_extension_simple};",
          "27: my $libssl =",
          "28:     $unified_info{sharednames}->{libssl}.$target{shared_extension_simple};",
          "30: ok(run(test([\"shlibloadtest\", \"-crypto_first\", $libcrypto, $libssl])),",
          "32: ok(run(test([\"shlibloadtest\", \"-ssl_first\", $libcrypto, $libssl])),",
          "34: ok(run(test([\"shlibloadtest\", \"-just_crypto\", $libcrypto, $libssl])),",
          "",
          "---------------"
        ],
        "test/shlibloadtest.c||test/shlibloadtest.c": [
          "File: test/shlibloadtest.c -> test/shlibloadtest.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "44: typedef void * SHLIB_SYM;",
          "45: # define SHLIB_INIT NULL",
          "50: {",
          "64:     if (*lib == NULL)",
          "65:         return 0;",
          "",
          "[Removed Lines]",
          "47: # define SHARED_LIBRARY_SUFFIX \".so\"",
          "49: static int shlib_load(char *filename, SHLIB *lib)",
          "51:     char *tmpfile;",
          "52:     size_t filenamelen = strlen(filename);",
          "55:     tmpfile = malloc(filenamelen + sizeof(SHARED_LIBRARY_SUFFIX) + 1);",
          "56:     if (tmpfile == NULL)",
          "57:         return 0;",
          "58:     strcpy(tmpfile, filename);",
          "59:     strcpy(tmpfile + filenamelen, SHARED_LIBRARY_SUFFIX);",
          "62:     free(tmpfile);",
          "",
          "[Added Lines]",
          "47: static int shlib_load(const char *filename, SHLIB *lib)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "90: typedef void * SHLIB_SYM;",
          "91: # define SHLIB_INIT 0",
          "94: {",
          "96:     if (*lib == NULL)",
          "",
          "[Removed Lines]",
          "93: static int shlib_load(char *filename, SHLIB *lib)",
          "",
          "[Added Lines]",
          "80: static int shlib_load(const char *filename, SHLIB *lib)",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "08c2da0d6a19b5b9a501ff93641cb2ece5b6b6f0",
      "candidate_info": {
        "commit_hash": "08c2da0d6a19b5b9a501ff93641cb2ece5b6b6f0",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/08c2da0d6a19b5b9a501ff93641cb2ece5b6b6f0",
        "files": [
          "crypto/x509/x_all.c"
        ],
        "message": "Fix no-ocsp\n\nThe use of EXFLAG_SET requires the inclusion of openssl/x509v3.h.\nopenssl/ocsp.h does that, except when OCSP is disabled.\n\nReviewed-by: Matt Caswell <matt@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/2227)\n(cherry picked from commit d62210af2e169d0818c65ff9f20ab5276693b2bf)",
        "before_after_code_files": [
          "crypto/x509/x_all.c||crypto/x509/x_all.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "crypto/x509/x_all.c||crypto/x509/x_all.c": [
          "File: crypto/x509/x_all.c -> crypto/x509/x_all.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "18: #include <openssl/ocsp.h>",
          "19: #include <openssl/rsa.h>",
          "20: #include <openssl/dsa.h>",
          "22: int X509_verify(X509 *a, EVP_PKEY *r)",
          "23: {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "21: #include <openssl/x509v3.h>",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "6f99d9c22faf528f174303f997ecbd853d88ffe0",
      "candidate_info": {
        "commit_hash": "6f99d9c22faf528f174303f997ecbd853d88ffe0",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/6f99d9c22faf528f174303f997ecbd853d88ffe0",
        "files": [
          "apps/s_client.c",
          "apps/s_server.c",
          "test/recipes/80-test_ssl_new.t"
        ],
        "message": "Fix no-ocsp\n\nSome compilers complain about unused variables, and some tests do\nnot run well without OCSP.\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(cherry picked from commit 057c676afb2a69b7d2bb9cf6e895e720a2a62b78)",
        "before_after_code_files": [
          "apps/s_client.c||apps/s_client.c",
          "apps/s_server.c||apps/s_server.c",
          "test/recipes/80-test_ssl_new.t||test/recipes/80-test_ssl_new.t"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "apps/s_client.c||apps/s_client.c": [
          "File: apps/s_client.c -> apps/s_client.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "856:     enum { use_inet, use_unix, use_unknown } connect_type = use_unknown;",
          "857:     int count4or6 = 0;",
          "858:     int c_nbio = 0, c_msg = 0, c_ign_eof = 0, c_brief = 0;",
          "860:     BIO *bio_c_msg = NULL;",
          "862:     FD_ZERO(&readfds);",
          "",
          "[Removed Lines]",
          "859:     int c_tlsextdebug = 0, c_status_req = 0;",
          "",
          "[Added Lines]",
          "859:     int c_tlsextdebug = 0;",
          "860: #ifndef OPENSSL_NO_OCSP",
          "861:     int c_status_req = 0;",
          "862: #endif",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1067:             c_tlsextdebug = 1;",
          "1068:             break;",
          "1069:         case OPT_STATUS:",
          "1070:             c_status_req = 1;",
          "1071:             break;",
          "1072:         case OPT_WDEBUG:",
          "1073: #ifdef WATT32",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1073: #ifndef OPENSSL_NO_OCSP",
          "1075: #endif",
          "",
          "---------------"
        ],
        "apps/s_server.c||apps/s_server.c": [
          "File: apps/s_server.c -> apps/s_server.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "932:     const char *s_cert_file = TEST_CERT, *s_key_file = NULL, *s_chain_file = NULL;",
          "933:     const char *s_cert_file2 = TEST_CERT2, *s_key_file2 = NULL;",
          "934:     char *s_dcert_file = NULL, *s_dkey_file = NULL, *s_dchain_file = NULL;",
          "936:     unsigned int split_send_fragment = 0, max_pipelines = 0;",
          "937:     const char *s_serverinfo_file = NULL;",
          "",
          "[Removed Lines]",
          "935:     int s_tlsextstatus = 0, no_resume_ephemeral = 0;",
          "",
          "[Added Lines]",
          "935: #ifndef OPENSSL_NO_OCSP",
          "936:     int s_tlsextstatus = 0;",
          "937: #endif",
          "938:     int no_resume_ephemeral = 0;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1206:             s_tlsextdebug = 1;",
          "1207:             break;",
          "1208:         case OPT_STATUS:",
          "1209:             s_tlsextstatus = 1;",
          "1210:             break;",
          "1211:         case OPT_STATUS_VERBOSE:",
          "1212:             s_tlsextstatus = tlscstatp.verbose = 1;",
          "1213:             break;",
          "1214:         case OPT_STATUS_TIMEOUT:",
          "1215:             s_tlsextstatus = 1;",
          "1216:             tlscstatp.timeout = atoi(opt_arg());",
          "1217:             break;",
          "1218:         case OPT_STATUS_URL:",
          "1219: #ifndef OPENSSL_NO_OCSP",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1212: #ifndef OPENSSL_NO_OCSP",
          "1214: #endif",
          "1217: #ifndef OPENSSL_NO_OCSP",
          "1219: #endif",
          "1222: #ifndef OPENSSL_NO_OCSP",
          "1225: #endif",
          "",
          "---------------"
        ],
        "test/recipes/80-test_ssl_new.t||test/recipes/80-test_ssl_new.t": [
          "File: test/recipes/80-test_ssl_new.t -> test/recipes/80-test_ssl_new.t",
          "--- Hunk 1 ---",
          "[Context before]",
          "44: my $no_ct = disabled(\"ct\");",
          "45: my $no_ec = disabled(\"ec\");",
          "46: my $no_ec2m = disabled(\"ec2m\");",
          "48: # Add your test here if the test conf.in generates test cases and/or",
          "49: # expectations dynamically based on the OpenSSL compile-time config.",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "47: my $no_ocsp = disabled(\"ocsp\");",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "70:   # We should review this once we have TLS 1.3.",
          "71:   \"13-fragmentation.conf\" => disabled(\"tls1_2\"),",
          "72:   \"14-curves.conf\" => disabled(\"tls1_2\") || $no_ec || $no_ec2m,",
          "74: );",
          "76: foreach my $conf (@conf_files) {",
          "",
          "[Removed Lines]",
          "73:   \"16-dtls-certstatus.conf\" => $no_dtls",
          "",
          "[Added Lines]",
          "74:   \"15-certstatus.conf\" => $no_ocsp,",
          "75:   \"16-dtls-certstatus.conf\" => $no_dtls || $no_ocsp,",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "73a5150689571fb8374320a298c4082778d238f3",
      "candidate_info": {
        "commit_hash": "73a5150689571fb8374320a298c4082778d238f3",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/73a5150689571fb8374320a298c4082778d238f3",
        "files": [
          "ssl/statem/statem_srvr.c"
        ],
        "message": "When no SRP identity is found, no error was reported server side\n\nReviewed-by: Richard Levitte <levitte@openssl.org>\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/1859)\n\n(cherry picked from commit 7bb37cb5938a0cf76c12c8421950e72634d5f61c)",
        "before_after_code_files": [
          "ssl/statem/statem_srvr.c||ssl/statem/statem_srvr.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "ssl/statem/statem_srvr.c||ssl/statem/statem_srvr.c": [
          "File: ssl/statem/statem_srvr.c -> ssl/statem/statem_srvr.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1483:             if (al != TLS1_AD_UNKNOWN_PSK_IDENTITY)",
          "1484:                 SSLerr(SSL_F_TLS_POST_PROCESS_CLIENT_HELLO,",
          "1485:                        SSL_R_CLIENTHELLO_TLSEXT);",
          "1486:             goto f_err;",
          "1487:         }",
          "1488:     }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1486:             else",
          "1487:                 SSLerr(SSL_F_TLS_POST_PROCESS_CLIENT_HELLO,",
          "1488:                        SSL_R_PSK_IDENTITY_NOT_FOUND);",
          "",
          "---------------"
        ]
      }
    }
  ]
}