{
  "cve_id": "CVE-2013-4533",
  "cve_desc": "Buffer overflow in the pxa2xx_ssp_load function in hw/arm/pxa2xx.c in QEMU before 1.7.2 allows remote attackers to cause a denial of service or possibly execute arbitrary code via a crafted s->rx_level value in a savevm image.",
  "repo": "qemu/qemu",
  "patch_hash": "caa881abe0e01f9931125a0977ec33c5343e4aa7",
  "patch_info": {
    "commit_hash": "caa881abe0e01f9931125a0977ec33c5343e4aa7",
    "repo": "qemu/qemu",
    "commit_url": "https://github.com/qemu/qemu/commit/caa881abe0e01f9931125a0977ec33c5343e4aa7",
    "files": [
      "hw/arm/pxa2xx.c"
    ],
    "message": "pxa2xx: avoid buffer overrun on incoming migration\n\nCVE-2013-4533\n\ns->rx_level is read from the wire and used to determine how many bytes\nto subsequently read into s->rx_fifo[]. If s->rx_level exceeds the\nlength of s->rx_fifo[] the buffer can be overrun with arbitrary data\nfrom the wire.\n\nFix this by validating rx_level against the size of s->rx_fifo.\n\nCc: Don Koch <dkoch@verizon.com>\nReported-by: Michael Roth <mdroth@linux.vnet.ibm.com>\nSigned-off-by: Michael S. Tsirkin <mst@redhat.com>\nReviewed-by: Peter Maydell <peter.maydell@linaro.org>\nReviewed-by: Don Koch <dkoch@verizon.com>\nSigned-off-by: Juan Quintela <quintela@redhat.com>",
    "before_after_code_files": [
      "hw/arm/pxa2xx.c||hw/arm/pxa2xx.c"
    ]
  },
  "patch_diff": {
    "hw/arm/pxa2xx.c||hw/arm/pxa2xx.c": [
      "File: hw/arm/pxa2xx.c -> hw/arm/pxa2xx.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "732: static int pxa2xx_ssp_load(QEMUFile *f, void *opaque, int version_id)",
      "733: {",
      "734:     PXA2xxSSPState *s = (PXA2xxSSPState *) opaque;",
      "737:     s->enable = qemu_get_be32(f);",
      "",
      "[Removed Lines]",
      "735:     int i;",
      "",
      "[Added Lines]",
      "735:     int i, v;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "746:     qemu_get_8s(f, &s->ssrsa);",
      "747:     qemu_get_8s(f, &s->ssacd);",
      "750:     s->rx_start = 0;",
      "751:     for (i = 0; i < s->rx_level; i ++)",
      "752:         s->rx_fifo[i] = qemu_get_byte(f);",
      "",
      "[Removed Lines]",
      "749:     s->rx_level = qemu_get_byte(f);",
      "",
      "[Added Lines]",
      "749:     v = qemu_get_byte(f);",
      "750:     if (v < 0 || v > ARRAY_SIZE(s->rx_fifo)) {",
      "751:         return -EINVAL;",
      "752:     }",
      "753:     s->rx_level = v;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "d92a7683e8cc4d3daab1ae9197f9311a72c9d1e6",
      "candidate_info": {
        "commit_hash": "d92a7683e8cc4d3daab1ae9197f9311a72c9d1e6",
        "repo": "qemu/qemu",
        "commit_url": "https://github.com/qemu/qemu/commit/d92a7683e8cc4d3daab1ae9197f9311a72c9d1e6",
        "files": [
          "hw/arm/pxa2xx.c"
        ],
        "message": "pxa2xx: avoid buffer overrun on incoming migration\n\nCVE-2013-4533\n\ns->rx_level is read from the wire and used to determine how many bytes\nto subsequently read into s->rx_fifo[]. If s->rx_level exceeds the\nlength of s->rx_fifo[] the buffer can be overrun with arbitrary data\nfrom the wire.\n\nFix this by validating rx_level against the size of s->rx_fifo.\n\nCc: Don Koch <dkoch@verizon.com>\nReported-by: Michael Roth <mdroth@linux.vnet.ibm.com>\nSigned-off-by: Michael S. Tsirkin <mst@redhat.com>\nReviewed-by: Peter Maydell <peter.maydell@linaro.org>\nReviewed-by: Don Koch <dkoch@verizon.com>\nSigned-off-by: Juan Quintela <quintela@redhat.com>\n(cherry picked from commit caa881abe0e01f9931125a0977ec33c5343e4aa7)\nSigned-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>",
        "before_after_code_files": [
          "hw/arm/pxa2xx.c||hw/arm/pxa2xx.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "hw/arm/pxa2xx.c||hw/arm/pxa2xx.c"
          ],
          "candidate": [
            "hw/arm/pxa2xx.c||hw/arm/pxa2xx.c"
          ]
        }
      },
      "candidate_diff": {
        "hw/arm/pxa2xx.c||hw/arm/pxa2xx.c": [
          "File: hw/arm/pxa2xx.c -> hw/arm/pxa2xx.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "742: static int pxa2xx_ssp_load(QEMUFile *f, void *opaque, int version_id)",
          "743: {",
          "744:     PXA2xxSSPState *s = (PXA2xxSSPState *) opaque;",
          "747:     s->enable = qemu_get_be32(f);",
          "",
          "[Removed Lines]",
          "745:     int i;",
          "",
          "[Added Lines]",
          "745:     int i, v;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "756:     qemu_get_8s(f, &s->ssrsa);",
          "757:     qemu_get_8s(f, &s->ssacd);",
          "760:     s->rx_start = 0;",
          "761:     for (i = 0; i < s->rx_level; i ++)",
          "762:         s->rx_fifo[i] = qemu_get_byte(f);",
          "",
          "[Removed Lines]",
          "759:     s->rx_level = qemu_get_byte(f);",
          "",
          "[Added Lines]",
          "759:     v = qemu_get_byte(f);",
          "760:     if (v < 0 || v > ARRAY_SIZE(s->rx_fifo)) {",
          "761:         return -EINVAL;",
          "762:     }",
          "763:     s->rx_level = v;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "eb55958e189aecc2c52b08e1aeb11715b668a5ab",
      "candidate_info": {
        "commit_hash": "eb55958e189aecc2c52b08e1aeb11715b668a5ab",
        "repo": "qemu/qemu",
        "commit_url": "https://github.com/qemu/qemu/commit/eb55958e189aecc2c52b08e1aeb11715b668a5ab",
        "files": [
          "hw/arm/pxa2xx.c"
        ],
        "message": "pxa2xx: avoid buffer overrun on incoming migration\n\nCVE-2013-4533\n\ns->rx_level is read from the wire and used to determine how many bytes\nto subsequently read into s->rx_fifo[]. If s->rx_level exceeds the\nlength of s->rx_fifo[] the buffer can be overrun with arbitrary data\nfrom the wire.\n\nFix this by validating rx_level against the size of s->rx_fifo.\n\nCc: Don Koch <dkoch@verizon.com>\nReported-by: Michael Roth <mdroth@linux.vnet.ibm.com>\nSigned-off-by: Michael S. Tsirkin <mst@redhat.com>\nReviewed-by: Peter Maydell <peter.maydell@linaro.org>\nReviewed-by: Don Koch <dkoch@verizon.com>\nSigned-off-by: Juan Quintela <quintela@redhat.com>\n(cherry picked from commit caa881abe0e01f9931125a0977ec33c5343e4aa7)\nSigned-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>",
        "before_after_code_files": [
          "hw/arm/pxa2xx.c||hw/arm/pxa2xx.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "hw/arm/pxa2xx.c||hw/arm/pxa2xx.c"
          ],
          "candidate": [
            "hw/arm/pxa2xx.c||hw/arm/pxa2xx.c"
          ]
        }
      },
      "candidate_diff": {
        "hw/arm/pxa2xx.c||hw/arm/pxa2xx.c": [
          "File: hw/arm/pxa2xx.c -> hw/arm/pxa2xx.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "732: static int pxa2xx_ssp_load(QEMUFile *f, void *opaque, int version_id)",
          "733: {",
          "734:     PXA2xxSSPState *s = (PXA2xxSSPState *) opaque;",
          "737:     s->enable = qemu_get_be32(f);",
          "",
          "[Removed Lines]",
          "735:     int i;",
          "",
          "[Added Lines]",
          "735:     int i, v;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "746:     qemu_get_8s(f, &s->ssrsa);",
          "747:     qemu_get_8s(f, &s->ssacd);",
          "750:     s->rx_start = 0;",
          "751:     for (i = 0; i < s->rx_level; i ++)",
          "752:         s->rx_fifo[i] = qemu_get_byte(f);",
          "",
          "[Removed Lines]",
          "749:     s->rx_level = qemu_get_byte(f);",
          "",
          "[Added Lines]",
          "749:     v = qemu_get_byte(f);",
          "750:     if (v < 0 || v > ARRAY_SIZE(s->rx_fifo)) {",
          "751:         return -EINVAL;",
          "752:     }",
          "753:     s->rx_level = v;",
          "",
          "---------------"
        ]
      }
    }
  ]
}