{
  "cve_id": "CVE-2019-20810",
  "cve_desc": "go7007_snd_init in drivers/media/usb/go7007/snd-go7007.c in the Linux kernel before 5.6 does not call snd_card_free for a failure path, which causes a memory leak, aka CID-9453264ef586.",
  "repo": "torvalds/linux",
  "patch_hash": "9453264ef58638ce8976121ac44c07a3ef375983",
  "patch_info": {
    "commit_hash": "9453264ef58638ce8976121ac44c07a3ef375983",
    "repo": "torvalds/linux",
    "commit_url": "https://github.com/torvalds/linux/commit/9453264ef58638ce8976121ac44c07a3ef375983",
    "files": [
      "drivers/media/usb/go7007/snd-go7007.c"
    ],
    "message": "media: go7007: fix a miss of snd_card_free\n\ngo7007_snd_init() misses a snd_card_free() in an error path.\nAdd the missed call to fix it.\n\nSigned-off-by: Chuhong Yuan <hslester96@gmail.com>\nSigned-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>\nSigned-off-by: Mauro Carvalho Chehab <mchehab+huawei@kernel.org>",
    "before_after_code_files": [
      "drivers/media/usb/go7007/snd-go7007.c||drivers/media/usb/go7007/snd-go7007.c"
    ]
  },
  "patch_diff": {
    "drivers/media/usb/go7007/snd-go7007.c||drivers/media/usb/go7007/snd-go7007.c": [
      "File: drivers/media/usb/go7007/snd-go7007.c -> drivers/media/usb/go7007/snd-go7007.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "236:  gosnd->capturing = 0;",
      "237:  ret = snd_card_new(go->dev, index[dev], id[dev], THIS_MODULE, 0,",
      "238:       &gosnd->card);",
      "243:  ret = snd_device_new(gosnd->card, SNDRV_DEV_LOWLEVEL, go,",
      "244:    &go7007_snd_device_ops);",
      "249:  ret = snd_pcm_new(gosnd->card, \"go7007\", 0, 0, 1, &gosnd->pcm);",
      "255:  strscpy(gosnd->card->driver, \"go7007\", sizeof(gosnd->card->driver));",
      "256:  strscpy(gosnd->card->shortname, go->name, sizeof(gosnd->card->shortname));",
      "257:  strscpy(gosnd->card->longname, gosnd->card->shortname,",
      "",
      "[Removed Lines]",
      "239:  if (ret < 0) {",
      "240:   kfree(gosnd);",
      "241:   return ret;",
      "242:  }",
      "245:  if (ret < 0) {",
      "246:   kfree(gosnd);",
      "247:   return ret;",
      "248:  }",
      "250:  if (ret < 0) {",
      "251:   snd_card_free(gosnd->card);",
      "252:   kfree(gosnd);",
      "253:   return ret;",
      "254:  }",
      "",
      "[Added Lines]",
      "239:  if (ret < 0)",
      "240:   goto free_snd;",
      "244:  if (ret < 0)",
      "245:   goto free_card;",
      "248:  if (ret < 0)",
      "249:   goto free_card;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "262:    &go7007_snd_capture_ops);",
      "264:  ret = snd_card_register(gosnd->card);",
      "271:  gosnd->substream = NULL;",
      "272:  go->snd_context = gosnd;",
      "",
      "[Removed Lines]",
      "265:  if (ret < 0) {",
      "266:   snd_card_free(gosnd->card);",
      "267:   kfree(gosnd);",
      "268:   return ret;",
      "269:  }",
      "",
      "[Added Lines]",
      "261:  if (ret < 0)",
      "262:   goto free_card;",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "274:  ++dev;",
      "276:  return 0;",
      "277: }",
      "278: EXPORT_SYMBOL(go7007_snd_init);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "271: free_card:",
      "272:  snd_card_free(gosnd->card);",
      "273: free_snd:",
      "274:  kfree(gosnd);",
      "275:  return ret;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "ba78170ef15371276c22255a88453c2f15529130",
      "candidate_info": {
        "commit_hash": "ba78170ef15371276c22255a88453c2f15529130",
        "repo": "torvalds/linux",
        "commit_url": "https://github.com/torvalds/linux/commit/ba78170ef15371276c22255a88453c2f15529130",
        "files": [
          "drivers/media/usb/go7007/snd-go7007.c"
        ],
        "message": "media: go7007: Fix misuse of strscpy\n\nProbable cut&paste typo - use the correct field size.\n\nSigned-off-by: Joe Perches <joe@perches.com>\nSigned-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>\nSigned-off-by: Mauro Carvalho Chehab <mchehab+samsung@kernel.org>",
        "before_after_code_files": [
          "drivers/media/usb/go7007/snd-go7007.c||drivers/media/usb/go7007/snd-go7007.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "drivers/media/usb/go7007/snd-go7007.c||drivers/media/usb/go7007/snd-go7007.c"
          ],
          "candidate": [
            "drivers/media/usb/go7007/snd-go7007.c||drivers/media/usb/go7007/snd-go7007.c"
          ]
        }
      },
      "candidate_diff": {
        "drivers/media/usb/go7007/snd-go7007.c||drivers/media/usb/go7007/snd-go7007.c": [
          "File: drivers/media/usb/go7007/snd-go7007.c -> drivers/media/usb/go7007/snd-go7007.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "253:   return ret;",
          "254:  }",
          "255:  strscpy(gosnd->card->driver, \"go7007\", sizeof(gosnd->card->driver));",
          "257:  strscpy(gosnd->card->longname, gosnd->card->shortname,",
          "258:   sizeof(gosnd->card->longname));",
          "",
          "[Removed Lines]",
          "256:  strscpy(gosnd->card->shortname, go->name, sizeof(gosnd->card->driver));",
          "",
          "[Added Lines]",
          "256:  strscpy(gosnd->card->shortname, go->name, sizeof(gosnd->card->shortname));",
          "",
          "---------------"
        ]
      }
    }
  ]
}