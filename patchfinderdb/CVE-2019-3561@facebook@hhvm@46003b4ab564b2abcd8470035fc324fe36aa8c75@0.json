{
  "cve_id": "CVE-2019-3561",
  "cve_desc": "Insufficient boundary checks for the strrpos and strripos functions allow access to out-of-bounds memory. This affects all supported versions of HHVM (4.0.3, 3.30.4, and 3.27.7 and below).",
  "repo": "facebook/hhvm",
  "patch_hash": "46003b4ab564b2abcd8470035fc324fe36aa8c75",
  "patch_info": {
    "commit_hash": "46003b4ab564b2abcd8470035fc324fe36aa8c75",
    "repo": "facebook/hhvm",
    "commit_url": "https://github.com/facebook/hhvm/commit/46003b4ab564b2abcd8470035fc324fe36aa8c75",
    "files": [
      "hphp/runtime/base/zend-string.cpp",
      "hphp/test/slow/ext_string/ext_string.php",
      "hphp/test/slow/ext_string/ext_string.php.expectf"
    ],
    "message": "Prevent strrpos and strripos from visiting out-of-bounds memory.\n\nReviewed By: alexeyt\n\nDifferential Revision: D14669668\n\nfbshipit-source-id: 16bb4674bccf83ffd737e60d1fd9fd4a0093f77c",
    "before_after_code_files": [
      "hphp/runtime/base/zend-string.cpp||hphp/runtime/base/zend-string.cpp",
      "hphp/test/slow/ext_string/ext_string.php||hphp/test/slow/ext_string/ext_string.php",
      "hphp/test/slow/ext_string/ext_string.php.expectf||hphp/test/slow/ext_string/ext_string.php.expectf"
    ]
  },
  "patch_diff": {
    "hphp/runtime/base/zend-string.cpp||hphp/runtime/base/zend-string.cpp": [
      "File: hphp/runtime/base/zend-string.cpp -> hphp/runtime/base/zend-string.cpp",
      "--- Hunk 1 ---",
      "[Context before]",
      "22: #include \"hphp/util/lock.h\"",
      "23: #include \"hphp/util/overflow.h\"",
      "24: #include <cmath>",
      "26: #ifndef _MSC_VER",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "24: #include <algorithm>",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "385:     if (pos >= 0) {",
      "386:       ptr = bstrrstr(input + pos, len - pos, s, s_len);",
      "387:     } else {",
      "389:     }",
      "390:   } else {",
      "391:     if (pos >= 0) {",
      "392:       ptr = bstrrcasestr(input + pos, len - pos, s, s_len);",
      "393:     } else {",
      "395:     }",
      "396:   }",
      "397:   if (ptr != nullptr) {",
      "",
      "[Removed Lines]",
      "388:       ptr = bstrrstr(input, len + pos + s_len, s, s_len);",
      "394:       ptr = bstrrcasestr(input, len + pos + s_len, s, s_len);",
      "",
      "[Added Lines]",
      "389:       ptr = bstrrstr(input, len + std::min(pos + s_len, 0), s, s_len);",
      "395:       ptr = bstrrcasestr(input, len + std::min(pos + s_len, 0), s, s_len);",
      "",
      "---------------"
    ],
    "hphp/test/slow/ext_string/ext_string.php||hphp/test/slow/ext_string/ext_string.php": [
      "File: hphp/test/slow/ext_string/ext_string.php -> hphp/test/slow/ext_string/ext_string.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "392: var_dump(strripos(\"abcdef abcdef\", \"A\"));",
      "394: $text = \"This is a test\";",
      "395: var_dump(substr_count($text, \"is\"));",
      "396: var_dump(substr_count($text, \"is\", 3));",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "394: var_dump(strrpos(\"abc\", \"c\\0\", -1));",
      "395: var_dump(strripos(\"abc\", \"c\\0\", -1));",
      "396: var_dump(strrpos(\"abc\", \"abc\", -3));",
      "397: var_dump(strripos(\"abc\", \"abc\", -3));",
      "398: var_dump(strrpos(\"aaaa\", \"aa\", -1));",
      "399: var_dump(strripos(\"aaaa\", \"aa\", -1));",
      "400: var_dump(strrpos(\"aaaa\", \"aa\", -2));",
      "401: var_dump(strripos(\"aaaa\", \"aa\", -2));",
      "",
      "---------------"
    ],
    "hphp/test/slow/ext_string/ext_string.php.expectf||hphp/test/slow/ext_string/ext_string.php.expectf": [
      "File: hphp/test/slow/ext_string/ext_string.php.expectf -> hphp/test/slow/ext_string/ext_string.php.expectf",
      "--- Hunk 1 ---",
      "[Context before]",
      "220: int(27)",
      "221: bool(false)",
      "222: int(7)",
      "223: int(2)",
      "224: int(1)",
      "225: int(0)",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "223: bool(false)",
      "224: bool(false)",
      "225: int(0)",
      "226: int(0)",
      "227: int(2)",
      "228: int(2)",
      "229: int(2)",
      "230: int(2)",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "ccd62135a923fe8a9f5cac121ebcb10a2ed33116",
      "candidate_info": {
        "commit_hash": "ccd62135a923fe8a9f5cac121ebcb10a2ed33116",
        "repo": "facebook/hhvm",
        "commit_url": "https://github.com/facebook/hhvm/commit/ccd62135a923fe8a9f5cac121ebcb10a2ed33116",
        "files": [
          "hphp/runtime/base/zend-string.cpp",
          "hphp/test/slow/ext_string/ext_string.php",
          "hphp/test/slow/ext_string/ext_string.php.expectf"
        ],
        "message": "Prevent strrpos and strripos from visiting out-of-bounds memory.\n\nReviewed By: alexeyt\n\nDifferential Revision: D14669668",
        "before_after_code_files": [
          "hphp/runtime/base/zend-string.cpp||hphp/runtime/base/zend-string.cpp",
          "hphp/test/slow/ext_string/ext_string.php||hphp/test/slow/ext_string/ext_string.php",
          "hphp/test/slow/ext_string/ext_string.php.expectf||hphp/test/slow/ext_string/ext_string.php.expectf"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_olp_changes": 1,
        "olp_code_files": {
          "patch": [
            "hphp/runtime/base/zend-string.cpp||hphp/runtime/base/zend-string.cpp",
            "hphp/test/slow/ext_string/ext_string.php||hphp/test/slow/ext_string/ext_string.php",
            "hphp/test/slow/ext_string/ext_string.php.expectf||hphp/test/slow/ext_string/ext_string.php.expectf"
          ],
          "candidate": [
            "hphp/runtime/base/zend-string.cpp||hphp/runtime/base/zend-string.cpp",
            "hphp/test/slow/ext_string/ext_string.php||hphp/test/slow/ext_string/ext_string.php",
            "hphp/test/slow/ext_string/ext_string.php.expectf||hphp/test/slow/ext_string/ext_string.php.expectf"
          ]
        }
      },
      "candidate_diff": {
        "hphp/runtime/base/zend-string.cpp||hphp/runtime/base/zend-string.cpp": [
          "File: hphp/runtime/base/zend-string.cpp -> hphp/runtime/base/zend-string.cpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "22: #include \"hphp/util/lock.h\"",
          "23: #include \"hphp/util/overflow.h\"",
          "24: #include <cmath>",
          "26: #ifndef _MSC_VER",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "24: #include <algorithm>",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "385:     if (pos >= 0) {",
          "386:       ptr = bstrrstr(input + pos, len - pos, s, s_len);",
          "387:     } else {",
          "389:     }",
          "390:   } else {",
          "391:     if (pos >= 0) {",
          "392:       ptr = bstrrcasestr(input + pos, len - pos, s, s_len);",
          "393:     } else {",
          "395:     }",
          "396:   }",
          "397:   if (ptr != nullptr) {",
          "",
          "[Removed Lines]",
          "388:       ptr = bstrrstr(input, len + pos + s_len, s, s_len);",
          "394:       ptr = bstrrcasestr(input, len + pos + s_len, s, s_len);",
          "",
          "[Added Lines]",
          "389:       ptr = bstrrstr(input, len + std::min(pos + s_len, 0), s, s_len);",
          "395:       ptr = bstrrcasestr(input, len + std::min(pos + s_len, 0), s, s_len);",
          "",
          "---------------"
        ],
        "hphp/test/slow/ext_string/ext_string.php||hphp/test/slow/ext_string/ext_string.php": [
          "File: hphp/test/slow/ext_string/ext_string.php -> hphp/test/slow/ext_string/ext_string.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "392: var_dump(strripos(\"abcdef abcdef\", \"A\"));",
          "394: $text = \"This is a test\";",
          "395: var_dump(substr_count($text, \"is\"));",
          "396: var_dump(substr_count($text, \"is\", 3));",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "394: var_dump(strrpos(\"abc\", \"c\\0\", -1));",
          "395: var_dump(strripos(\"abc\", \"c\\0\", -1));",
          "396: var_dump(strrpos(\"abc\", \"abc\", -3));",
          "397: var_dump(strripos(\"abc\", \"abc\", -3));",
          "398: var_dump(strrpos(\"aaaa\", \"aa\", -1));",
          "399: var_dump(strripos(\"aaaa\", \"aa\", -1));",
          "400: var_dump(strrpos(\"aaaa\", \"aa\", -2));",
          "401: var_dump(strripos(\"aaaa\", \"aa\", -2));",
          "",
          "---------------"
        ],
        "hphp/test/slow/ext_string/ext_string.php.expectf||hphp/test/slow/ext_string/ext_string.php.expectf": [
          "File: hphp/test/slow/ext_string/ext_string.php.expectf -> hphp/test/slow/ext_string/ext_string.php.expectf",
          "--- Hunk 1 ---",
          "[Context before]",
          "220: int(27)",
          "221: bool(false)",
          "222: int(7)",
          "223: int(2)",
          "224: int(1)",
          "225: int(0)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "223: bool(false)",
          "224: bool(false)",
          "225: int(0)",
          "226: int(0)",
          "227: int(2)",
          "228: int(2)",
          "229: int(2)",
          "230: int(2)",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "54b4305d6cbe77b8a2955fcb1e6c07d81b88fdd3",
      "candidate_info": {
        "commit_hash": "54b4305d6cbe77b8a2955fcb1e6c07d81b88fdd3",
        "repo": "facebook/hhvm",
        "commit_url": "https://github.com/facebook/hhvm/commit/54b4305d6cbe77b8a2955fcb1e6c07d81b88fdd3",
        "files": [
          "hphp/runtime/base/zend-string.cpp",
          "hphp/test/slow/ext_string/ext_string.php",
          "hphp/test/slow/ext_string/ext_string.php.expectf"
        ],
        "message": "Prevent strrpos and strripos from visiting out-of-bounds memory.\n\nReviewed By: alexeyt\n\nDifferential Revision: D14669668",
        "before_after_code_files": [
          "hphp/runtime/base/zend-string.cpp||hphp/runtime/base/zend-string.cpp",
          "hphp/test/slow/ext_string/ext_string.php||hphp/test/slow/ext_string/ext_string.php",
          "hphp/test/slow/ext_string/ext_string.php.expectf||hphp/test/slow/ext_string/ext_string.php.expectf"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_olp_changes": 1,
        "olp_code_files": {
          "patch": [
            "hphp/runtime/base/zend-string.cpp||hphp/runtime/base/zend-string.cpp",
            "hphp/test/slow/ext_string/ext_string.php||hphp/test/slow/ext_string/ext_string.php",
            "hphp/test/slow/ext_string/ext_string.php.expectf||hphp/test/slow/ext_string/ext_string.php.expectf"
          ],
          "candidate": [
            "hphp/runtime/base/zend-string.cpp||hphp/runtime/base/zend-string.cpp",
            "hphp/test/slow/ext_string/ext_string.php||hphp/test/slow/ext_string/ext_string.php",
            "hphp/test/slow/ext_string/ext_string.php.expectf||hphp/test/slow/ext_string/ext_string.php.expectf"
          ]
        }
      },
      "candidate_diff": {
        "hphp/runtime/base/zend-string.cpp||hphp/runtime/base/zend-string.cpp": [
          "File: hphp/runtime/base/zend-string.cpp -> hphp/runtime/base/zend-string.cpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "22: #include \"hphp/util/lock.h\"",
          "23: #include \"hphp/util/overflow.h\"",
          "24: #include <cmath>",
          "26: #ifndef _MSC_VER",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "24: #include <algorithm>",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "385:     if (pos >= 0) {",
          "386:       ptr = bstrrstr(input + pos, len - pos, s, s_len);",
          "387:     } else {",
          "389:     }",
          "390:   } else {",
          "391:     if (pos >= 0) {",
          "392:       ptr = bstrrcasestr(input + pos, len - pos, s, s_len);",
          "393:     } else {",
          "395:     }",
          "396:   }",
          "397:   if (ptr != nullptr) {",
          "",
          "[Removed Lines]",
          "388:       ptr = bstrrstr(input, len + pos + s_len, s, s_len);",
          "394:       ptr = bstrrcasestr(input, len + pos + s_len, s, s_len);",
          "",
          "[Added Lines]",
          "389:       ptr = bstrrstr(input, len + std::min(pos + s_len, 0), s, s_len);",
          "395:       ptr = bstrrcasestr(input, len + std::min(pos + s_len, 0), s, s_len);",
          "",
          "---------------"
        ],
        "hphp/test/slow/ext_string/ext_string.php||hphp/test/slow/ext_string/ext_string.php": [
          "File: hphp/test/slow/ext_string/ext_string.php -> hphp/test/slow/ext_string/ext_string.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "389: var_dump(strripos(\"abcdef abcdef\", \"A\"));",
          "391: $text = \"This is a test\";",
          "392: var_dump(substr_count($text, \"is\"));",
          "393: var_dump(substr_count($text, \"is\", 3));",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "391: var_dump(strrpos(\"abc\", \"c\\0\", -1));",
          "392: var_dump(strripos(\"abc\", \"c\\0\", -1));",
          "393: var_dump(strrpos(\"abc\", \"abc\", -3));",
          "394: var_dump(strripos(\"abc\", \"abc\", -3));",
          "395: var_dump(strrpos(\"aaaa\", \"aa\", -1));",
          "396: var_dump(strripos(\"aaaa\", \"aa\", -1));",
          "397: var_dump(strrpos(\"aaaa\", \"aa\", -2));",
          "398: var_dump(strripos(\"aaaa\", \"aa\", -2));",
          "",
          "---------------"
        ],
        "hphp/test/slow/ext_string/ext_string.php.expectf||hphp/test/slow/ext_string/ext_string.php.expectf": [
          "File: hphp/test/slow/ext_string/ext_string.php.expectf -> hphp/test/slow/ext_string/ext_string.php.expectf",
          "--- Hunk 1 ---",
          "[Context before]",
          "220: int(27)",
          "221: bool(false)",
          "222: int(7)",
          "223: int(2)",
          "224: int(1)",
          "225: int(0)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "223: bool(false)",
          "224: bool(false)",
          "225: int(0)",
          "226: int(0)",
          "227: int(2)",
          "228: int(2)",
          "229: int(2)",
          "230: int(2)",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "5db74e5a3fecbc2f9818d83649ff5c6698eb2c36",
      "candidate_info": {
        "commit_hash": "5db74e5a3fecbc2f9818d83649ff5c6698eb2c36",
        "repo": "facebook/hhvm",
        "commit_url": "https://github.com/facebook/hhvm/commit/5db74e5a3fecbc2f9818d83649ff5c6698eb2c36",
        "files": [
          "hphp/runtime/base/zend-string.cpp",
          "hphp/test/slow/ext_string/ext_string.php",
          "hphp/test/slow/ext_string/ext_string.php.expectf"
        ],
        "message": "Prevent strrpos and strripos from visiting out-of-bounds memory.\n\nReviewed By: alexeyt\n\nDifferential Revision: D14669668",
        "before_after_code_files": [
          "hphp/runtime/base/zend-string.cpp||hphp/runtime/base/zend-string.cpp",
          "hphp/test/slow/ext_string/ext_string.php||hphp/test/slow/ext_string/ext_string.php",
          "hphp/test/slow/ext_string/ext_string.php.expectf||hphp/test/slow/ext_string/ext_string.php.expectf"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_olp_changes": 1,
        "olp_code_files": {
          "patch": [
            "hphp/runtime/base/zend-string.cpp||hphp/runtime/base/zend-string.cpp",
            "hphp/test/slow/ext_string/ext_string.php||hphp/test/slow/ext_string/ext_string.php",
            "hphp/test/slow/ext_string/ext_string.php.expectf||hphp/test/slow/ext_string/ext_string.php.expectf"
          ],
          "candidate": [
            "hphp/runtime/base/zend-string.cpp||hphp/runtime/base/zend-string.cpp",
            "hphp/test/slow/ext_string/ext_string.php||hphp/test/slow/ext_string/ext_string.php",
            "hphp/test/slow/ext_string/ext_string.php.expectf||hphp/test/slow/ext_string/ext_string.php.expectf"
          ]
        }
      },
      "candidate_diff": {
        "hphp/runtime/base/zend-string.cpp||hphp/runtime/base/zend-string.cpp": [
          "File: hphp/runtime/base/zend-string.cpp -> hphp/runtime/base/zend-string.cpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "22: #include \"hphp/util/lock.h\"",
          "23: #include \"hphp/util/overflow.h\"",
          "24: #include <cmath>",
          "26: #ifndef _MSC_VER",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "24: #include <algorithm>",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "385:     if (pos >= 0) {",
          "386:       ptr = bstrrstr(input + pos, len - pos, s, s_len);",
          "387:     } else {",
          "389:     }",
          "390:   } else {",
          "391:     if (pos >= 0) {",
          "392:       ptr = bstrrcasestr(input + pos, len - pos, s, s_len);",
          "393:     } else {",
          "395:     }",
          "396:   }",
          "397:   if (ptr != nullptr) {",
          "",
          "[Removed Lines]",
          "388:       ptr = bstrrstr(input, len + pos + s_len, s, s_len);",
          "394:       ptr = bstrrcasestr(input, len + pos + s_len, s, s_len);",
          "",
          "[Added Lines]",
          "389:       ptr = bstrrstr(input, len + std::min(pos + s_len, 0), s, s_len);",
          "395:       ptr = bstrrcasestr(input, len + std::min(pos + s_len, 0), s, s_len);",
          "",
          "---------------"
        ],
        "hphp/test/slow/ext_string/ext_string.php||hphp/test/slow/ext_string/ext_string.php": [
          "File: hphp/test/slow/ext_string/ext_string.php -> hphp/test/slow/ext_string/ext_string.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "392: var_dump(strripos(\"abcdef abcdef\", \"A\"));",
          "394: $text = \"This is a test\";",
          "395: var_dump(substr_count($text, \"is\"));",
          "396: var_dump(substr_count($text, \"is\", 3));",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "394: var_dump(strrpos(\"abc\", \"c\\0\", -1));",
          "395: var_dump(strripos(\"abc\", \"c\\0\", -1));",
          "396: var_dump(strrpos(\"abc\", \"abc\", -3));",
          "397: var_dump(strripos(\"abc\", \"abc\", -3));",
          "398: var_dump(strrpos(\"aaaa\", \"aa\", -1));",
          "399: var_dump(strripos(\"aaaa\", \"aa\", -1));",
          "400: var_dump(strrpos(\"aaaa\", \"aa\", -2));",
          "401: var_dump(strripos(\"aaaa\", \"aa\", -2));",
          "",
          "---------------"
        ],
        "hphp/test/slow/ext_string/ext_string.php.expectf||hphp/test/slow/ext_string/ext_string.php.expectf": [
          "File: hphp/test/slow/ext_string/ext_string.php.expectf -> hphp/test/slow/ext_string/ext_string.php.expectf",
          "--- Hunk 1 ---",
          "[Context before]",
          "220: int(27)",
          "221: bool(false)",
          "222: int(7)",
          "223: int(2)",
          "224: int(1)",
          "225: int(0)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "223: bool(false)",
          "224: bool(false)",
          "225: int(0)",
          "226: int(0)",
          "227: int(2)",
          "228: int(2)",
          "229: int(2)",
          "230: int(2)",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "5deba7412225c049f9ab6d8d6c3e9dd2c98a9f90",
      "candidate_info": {
        "commit_hash": "5deba7412225c049f9ab6d8d6c3e9dd2c98a9f90",
        "repo": "facebook/hhvm",
        "commit_url": "https://github.com/facebook/hhvm/commit/5deba7412225c049f9ab6d8d6c3e9dd2c98a9f90",
        "files": [
          "hphp/runtime/base/zend-string.cpp",
          "hphp/test/slow/ext_string/ext_string.php",
          "hphp/test/slow/ext_string/ext_string.php.expectf"
        ],
        "message": "Prevent strrpos and strripos from visiting out-of-bounds memory.\n\nReviewed By: alexeyt\n\nDifferential Revision: D14669668",
        "before_after_code_files": [
          "hphp/runtime/base/zend-string.cpp||hphp/runtime/base/zend-string.cpp",
          "hphp/test/slow/ext_string/ext_string.php||hphp/test/slow/ext_string/ext_string.php",
          "hphp/test/slow/ext_string/ext_string.php.expectf||hphp/test/slow/ext_string/ext_string.php.expectf"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_olp_changes": 1,
        "olp_code_files": {
          "patch": [
            "hphp/runtime/base/zend-string.cpp||hphp/runtime/base/zend-string.cpp",
            "hphp/test/slow/ext_string/ext_string.php||hphp/test/slow/ext_string/ext_string.php",
            "hphp/test/slow/ext_string/ext_string.php.expectf||hphp/test/slow/ext_string/ext_string.php.expectf"
          ],
          "candidate": [
            "hphp/runtime/base/zend-string.cpp||hphp/runtime/base/zend-string.cpp",
            "hphp/test/slow/ext_string/ext_string.php||hphp/test/slow/ext_string/ext_string.php",
            "hphp/test/slow/ext_string/ext_string.php.expectf||hphp/test/slow/ext_string/ext_string.php.expectf"
          ]
        }
      },
      "candidate_diff": {
        "hphp/runtime/base/zend-string.cpp||hphp/runtime/base/zend-string.cpp": [
          "File: hphp/runtime/base/zend-string.cpp -> hphp/runtime/base/zend-string.cpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "22: #include \"hphp/util/lock.h\"",
          "23: #include \"hphp/util/overflow.h\"",
          "24: #include <cmath>",
          "26: #ifndef _MSC_VER",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "24: #include <algorithm>",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "385:     if (pos >= 0) {",
          "386:       ptr = bstrrstr(input + pos, len - pos, s, s_len);",
          "387:     } else {",
          "389:     }",
          "390:   } else {",
          "391:     if (pos >= 0) {",
          "392:       ptr = bstrrcasestr(input + pos, len - pos, s, s_len);",
          "393:     } else {",
          "395:     }",
          "396:   }",
          "397:   if (ptr != nullptr) {",
          "",
          "[Removed Lines]",
          "388:       ptr = bstrrstr(input, len + pos + s_len, s, s_len);",
          "394:       ptr = bstrrcasestr(input, len + pos + s_len, s, s_len);",
          "",
          "[Added Lines]",
          "389:       ptr = bstrrstr(input, len + std::min(pos + s_len, 0), s, s_len);",
          "395:       ptr = bstrrcasestr(input, len + std::min(pos + s_len, 0), s, s_len);",
          "",
          "---------------"
        ],
        "hphp/test/slow/ext_string/ext_string.php||hphp/test/slow/ext_string/ext_string.php": [
          "File: hphp/test/slow/ext_string/ext_string.php -> hphp/test/slow/ext_string/ext_string.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "392: var_dump(strripos(\"abcdef abcdef\", \"A\"));",
          "394: $text = \"This is a test\";",
          "395: var_dump(substr_count($text, \"is\"));",
          "396: var_dump(substr_count($text, \"is\", 3));",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "394: var_dump(strrpos(\"abc\", \"c\\0\", -1));",
          "395: var_dump(strripos(\"abc\", \"c\\0\", -1));",
          "396: var_dump(strrpos(\"abc\", \"abc\", -3));",
          "397: var_dump(strripos(\"abc\", \"abc\", -3));",
          "398: var_dump(strrpos(\"aaaa\", \"aa\", -1));",
          "399: var_dump(strripos(\"aaaa\", \"aa\", -1));",
          "400: var_dump(strrpos(\"aaaa\", \"aa\", -2));",
          "401: var_dump(strripos(\"aaaa\", \"aa\", -2));",
          "",
          "---------------"
        ],
        "hphp/test/slow/ext_string/ext_string.php.expectf||hphp/test/slow/ext_string/ext_string.php.expectf": [
          "File: hphp/test/slow/ext_string/ext_string.php.expectf -> hphp/test/slow/ext_string/ext_string.php.expectf",
          "--- Hunk 1 ---",
          "[Context before]",
          "220: int(27)",
          "221: bool(false)",
          "222: int(7)",
          "223: int(2)",
          "224: int(1)",
          "225: int(0)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "223: bool(false)",
          "224: bool(false)",
          "225: int(0)",
          "226: int(0)",
          "227: int(2)",
          "228: int(2)",
          "229: int(2)",
          "230: int(2)",
          "",
          "---------------"
        ]
      }
    }
  ]
}