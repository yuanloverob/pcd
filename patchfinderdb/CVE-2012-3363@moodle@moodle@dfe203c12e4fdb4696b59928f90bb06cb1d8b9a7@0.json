{
  "cve_id": "CVE-2012-3363",
  "cve_desc": "Zend_XmlRpc in Zend Framework 1.x before 1.11.12 and 1.12.x before 1.12.0 does not properly handle SimpleXMLElement classes, which allows remote attackers to read arbitrary files or create TCP connections via an external entity reference in a DOCTYPE element in an XML-RPC request, aka an XML external entity (XXE) injection attack.",
  "repo": "moodle/moodle",
  "patch_hash": "dfe203c12e4fdb4696b59928f90bb06cb1d8b9a7",
  "patch_info": {
    "commit_hash": "dfe203c12e4fdb4696b59928f90bb06cb1d8b9a7",
    "repo": "moodle/moodle",
    "commit_url": "https://github.com/moodle/moodle/commit/dfe203c12e4fdb4696b59928f90bb06cb1d8b9a7",
    "files": [
      "lib/zend/Zend/XmlRpc/Request.php",
      "lib/zend/readme_moodle.txt"
    ],
    "message": "MDL-34284 library: Import ZF2012-01 security patch for Zend",
    "before_after_code_files": [
      "lib/zend/Zend/XmlRpc/Request.php||lib/zend/Zend/XmlRpc/Request.php"
    ]
  },
  "patch_diff": {
    "lib/zend/Zend/XmlRpc/Request.php||lib/zend/Zend/XmlRpc/Request.php": [
      "File: lib/zend/Zend/XmlRpc/Request.php -> lib/zend/Zend/XmlRpc/Request.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "303:             return false;",
      "304:         }",
      "306:         try {",
      "307:             $xml = new SimpleXMLElement($request);",
      "308:         } catch (Exception $e) {",
      "310:             $this->_fault = new Zend_XmlRpc_Fault(631);",
      "311:             $this->_fault->setEncoding($this->getEncoding());",
      "312:             return false;",
      "313:         }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "307:         $loadEntities = libxml_disable_entity_loader(true);",
      "314:             libxml_disable_entity_loader($loadEntities);",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "318:             $this->_fault = new Zend_XmlRpc_Fault(632);",
      "319:             $this->_fault->setEncoding($this->getEncoding());",
      "320:             return false;",
      "321:         }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "323:             libxml_disable_entity_loader($loadEntities);",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "330:                 if (!isset($param->value)) {",
      "331:                     $this->_fault = new Zend_XmlRpc_Fault(633);",
      "332:                     $this->_fault->setEncoding($this->getEncoding());",
      "333:                     return false;",
      "334:                 }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "337:                     libxml_disable_entity_loader($loadEntities);",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "340:                 } catch (Exception $e) {",
      "341:                     $this->_fault = new Zend_XmlRpc_Fault(636);",
      "342:                     $this->_fault->setEncoding($this->getEncoding());",
      "343:                     return false;",
      "344:                 }",
      "345:             }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "348:                     libxml_disable_entity_loader($loadEntities);",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "348:             $this->_params = $argv;",
      "349:         }",
      "351:         $this->_xml = $request;",
      "353:         return true;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "357:         libxml_disable_entity_loader($loadEntities);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "33c2fe241472aa7c230725ca55f409cf9e76ccdd",
      "candidate_info": {
        "commit_hash": "33c2fe241472aa7c230725ca55f409cf9e76ccdd",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/33c2fe241472aa7c230725ca55f409cf9e76ccdd",
        "files": [
          "lib/zend/Zend/XmlRpc/Request.php",
          "lib/zend/readme_moodle.txt"
        ],
        "message": "MDL-34284 library: Import ZF2012-01 security patch for Zend",
        "before_after_code_files": [
          "lib/zend/Zend/XmlRpc/Request.php||lib/zend/Zend/XmlRpc/Request.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "lib/zend/Zend/XmlRpc/Request.php||lib/zend/Zend/XmlRpc/Request.php"
          ],
          "candidate": [
            "lib/zend/Zend/XmlRpc/Request.php||lib/zend/Zend/XmlRpc/Request.php"
          ]
        }
      },
      "candidate_diff": {
        "lib/zend/Zend/XmlRpc/Request.php||lib/zend/Zend/XmlRpc/Request.php": [
          "File: lib/zend/Zend/XmlRpc/Request.php -> lib/zend/Zend/XmlRpc/Request.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "303:             return false;",
          "304:         }",
          "306:         try {",
          "307:             $xml = new SimpleXMLElement($request);",
          "308:         } catch (Exception $e) {",
          "310:             $this->_fault = new Zend_XmlRpc_Fault(631);",
          "311:             $this->_fault->setEncoding($this->getEncoding());",
          "312:             return false;",
          "313:         }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "307:         $loadEntities = libxml_disable_entity_loader(true);",
          "314:             libxml_disable_entity_loader($loadEntities);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "318:             $this->_fault = new Zend_XmlRpc_Fault(632);",
          "319:             $this->_fault->setEncoding($this->getEncoding());",
          "320:             return false;",
          "321:         }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "323:             libxml_disable_entity_loader($loadEntities);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "330:                 if (!isset($param->value)) {",
          "331:                     $this->_fault = new Zend_XmlRpc_Fault(633);",
          "332:                     $this->_fault->setEncoding($this->getEncoding());",
          "333:                     return false;",
          "334:                 }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "337:                     libxml_disable_entity_loader($loadEntities);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "340:                 } catch (Exception $e) {",
          "341:                     $this->_fault = new Zend_XmlRpc_Fault(636);",
          "342:                     $this->_fault->setEncoding($this->getEncoding());",
          "343:                     return false;",
          "344:                 }",
          "345:             }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "348:                     libxml_disable_entity_loader($loadEntities);",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "348:             $this->_params = $argv;",
          "349:         }",
          "351:         $this->_xml = $request;",
          "353:         return true;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "357:         libxml_disable_entity_loader($loadEntities);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "eecdec4d5b523a21f51d66aba448ad6c43cc760c",
      "candidate_info": {
        "commit_hash": "eecdec4d5b523a21f51d66aba448ad6c43cc760c",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/eecdec4d5b523a21f51d66aba448ad6c43cc760c",
        "files": [
          "lib/zend/Zend/XmlRpc/Request.php",
          "lib/zend/readme_moodle.txt"
        ],
        "message": "MDL-34284 library: Import ZF2012-01 security patch for Zend",
        "before_after_code_files": [
          "lib/zend/Zend/XmlRpc/Request.php||lib/zend/Zend/XmlRpc/Request.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "lib/zend/Zend/XmlRpc/Request.php||lib/zend/Zend/XmlRpc/Request.php"
          ],
          "candidate": [
            "lib/zend/Zend/XmlRpc/Request.php||lib/zend/Zend/XmlRpc/Request.php"
          ]
        }
      },
      "candidate_diff": {
        "lib/zend/Zend/XmlRpc/Request.php||lib/zend/Zend/XmlRpc/Request.php": [
          "File: lib/zend/Zend/XmlRpc/Request.php -> lib/zend/Zend/XmlRpc/Request.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "303:             return false;",
          "304:         }",
          "306:         try {",
          "307:             $xml = new SimpleXMLElement($request);",
          "308:         } catch (Exception $e) {",
          "310:             $this->_fault = new Zend_XmlRpc_Fault(631);",
          "311:             $this->_fault->setEncoding($this->getEncoding());",
          "312:             return false;",
          "313:         }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "307:         $loadEntities = libxml_disable_entity_loader(true);",
          "314:             libxml_disable_entity_loader($loadEntities);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "318:             $this->_fault = new Zend_XmlRpc_Fault(632);",
          "319:             $this->_fault->setEncoding($this->getEncoding());",
          "320:             return false;",
          "321:         }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "323:             libxml_disable_entity_loader($loadEntities);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "330:                 if (!isset($param->value)) {",
          "331:                     $this->_fault = new Zend_XmlRpc_Fault(633);",
          "332:                     $this->_fault->setEncoding($this->getEncoding());",
          "333:                     return false;",
          "334:                 }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "337:                     libxml_disable_entity_loader($loadEntities);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "340:                 } catch (Exception $e) {",
          "341:                     $this->_fault = new Zend_XmlRpc_Fault(636);",
          "342:                     $this->_fault->setEncoding($this->getEncoding());",
          "343:                     return false;",
          "344:                 }",
          "345:             }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "348:                     libxml_disable_entity_loader($loadEntities);",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "348:             $this->_params = $argv;",
          "349:         }",
          "351:         $this->_xml = $request;",
          "353:         return true;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "357:         libxml_disable_entity_loader($loadEntities);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "55b330e6d80209e235e7cf567db9b190e9d5ea19",
      "candidate_info": {
        "commit_hash": "55b330e6d80209e235e7cf567db9b190e9d5ea19",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/55b330e6d80209e235e7cf567db9b190e9d5ea19",
        "files": [
          "lib/zend/Zend/XmlRpc/Request.php",
          "lib/zend/readme_moodle.txt"
        ],
        "message": "MDL-34284 library: Import ZF2012-01 security patch for Zend",
        "before_after_code_files": [
          "lib/zend/Zend/XmlRpc/Request.php||lib/zend/Zend/XmlRpc/Request.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "lib/zend/Zend/XmlRpc/Request.php||lib/zend/Zend/XmlRpc/Request.php"
          ],
          "candidate": [
            "lib/zend/Zend/XmlRpc/Request.php||lib/zend/Zend/XmlRpc/Request.php"
          ]
        }
      },
      "candidate_diff": {
        "lib/zend/Zend/XmlRpc/Request.php||lib/zend/Zend/XmlRpc/Request.php": [
          "File: lib/zend/Zend/XmlRpc/Request.php -> lib/zend/Zend/XmlRpc/Request.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "303:             return false;",
          "304:         }",
          "306:         try {",
          "307:             $xml = new SimpleXMLElement($request);",
          "308:         } catch (Exception $e) {",
          "310:             $this->_fault = new Zend_XmlRpc_Fault(631);",
          "311:             $this->_fault->setEncoding($this->getEncoding());",
          "312:             return false;",
          "313:         }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "307:         $loadEntities = libxml_disable_entity_loader(true);",
          "314:             libxml_disable_entity_loader($loadEntities);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "318:             $this->_fault = new Zend_XmlRpc_Fault(632);",
          "319:             $this->_fault->setEncoding($this->getEncoding());",
          "320:             return false;",
          "321:         }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "323:             libxml_disable_entity_loader($loadEntities);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "330:                 if (!isset($param->value)) {",
          "331:                     $this->_fault = new Zend_XmlRpc_Fault(633);",
          "332:                     $this->_fault->setEncoding($this->getEncoding());",
          "333:                     return false;",
          "334:                 }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "337:                     libxml_disable_entity_loader($loadEntities);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "340:                 } catch (Exception $e) {",
          "341:                     $this->_fault = new Zend_XmlRpc_Fault(636);",
          "342:                     $this->_fault->setEncoding($this->getEncoding());",
          "343:                     return false;",
          "344:                 }",
          "345:             }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "348:                     libxml_disable_entity_loader($loadEntities);",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "348:             $this->_params = $argv;",
          "349:         }",
          "351:         $this->_xml = $request;",
          "353:         return true;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "357:         libxml_disable_entity_loader($loadEntities);",
          "",
          "---------------"
        ]
      }
    }
  ]
}