{
  "cve_id": "CVE-2016-3727",
  "cve_desc": "The API URL computer/(master)/api/xml in Jenkins before 2.3 and LTS before 1.651.2 allows remote authenticated users with extended read permission for the master node to obtain sensitive information about the global configuration via unspecified vectors.",
  "repo": "jenkinsci/jenkins",
  "patch_hash": "d66ad6f3ee46a5c6bb865bb831e8cdfc74cd7eb3",
  "patch_info": {
    "commit_hash": "d66ad6f3ee46a5c6bb865bb831e8cdfc74cd7eb3",
    "repo": "jenkinsci/jenkins",
    "commit_url": "https://github.com/jenkinsci/jenkins/commit/d66ad6f3ee46a5c6bb865bb831e8cdfc74cd7eb3",
    "files": [
      "core/src/main/java/jenkins/model/Jenkins.java",
      "test/src/test/java/hudson/model/NodeTest.java"
    ],
    "message": "[FIXED SECURITY-281] MasterComputer.doConfigDotXml should be rejected.",
    "before_after_code_files": [
      "core/src/main/java/jenkins/model/Jenkins.java||core/src/main/java/jenkins/model/Jenkins.java",
      "test/src/test/java/hudson/model/NodeTest.java||test/src/test/java/hudson/model/NodeTest.java"
    ]
  },
  "patch_diff": {
    "core/src/main/java/jenkins/model/Jenkins.java||core/src/main/java/jenkins/model/Jenkins.java": [
      "File: core/src/main/java/jenkins/model/Jenkins.java -> core/src/main/java/jenkins/model/Jenkins.java",
      "--- Hunk 1 ---",
      "[Context before]",
      "298: import hudson.util.LogTaskListener;",
      "299: import static java.util.logging.Level.*;",
      "300: import static javax.servlet.http.HttpServletResponse.*;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "301: import org.kohsuke.stapler.WebMethod;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "3996:             Jenkins.getInstance().doConfigExecutorsSubmit(req, rsp);",
      "3997:         }",
      "3999:         @Override",
      "4000:         public boolean hasPermission(Permission permission) {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "4000:         @WebMethod(name=\"config.xml\")",
      "4001:         @Override",
      "4002:         public void doConfigDotXml(StaplerRequest req, StaplerResponse rsp) throws IOException, ServletException {",
      "4003:             throw HttpResponses.status(SC_BAD_REQUEST);",
      "4004:         }",
      "",
      "---------------"
    ],
    "test/src/test/java/hudson/model/NodeTest.java||test/src/test/java/hudson/model/NodeTest.java": [
      "File: test/src/test/java/hudson/model/NodeTest.java -> test/src/test/java/hudson/model/NodeTest.java",
      "--- Hunk 1 ---",
      "[Context before]",
      "24: package hudson.model;",
      "26: import hudson.EnvVars;",
      "27: import hudson.FilePath;",
      "28: import hudson.maven.MavenModuleSet;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "26: import com.gargoylesoftware.htmlunit.FailingHttpStatusCodeException;",
      "27: import com.gargoylesoftware.htmlunit.HttpMethod;",
      "28: import com.gargoylesoftware.htmlunit.Page;",
      "29: import com.gargoylesoftware.htmlunit.WebRequestSettings;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "41: import hudson.slaves.OfflineCause.ByCLI;",
      "42: import hudson.slaves.OfflineCause.UserCause;",
      "43: import hudson.util.TagCloud;",
      "45: import java.util.*;",
      "46: import java.util.concurrent.Callable;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "48: import java.net.HttpURLConnection;",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "400:         assertThatCloudLabelDoesNotContain(cloud, \"label1 label2\", 0);",
      "401:     }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "408:     @Issue(\"SECURITY-281\")",
      "409:     @Test",
      "410:     public void masterComputerConfigDotXml() throws Exception {",
      "411:         JenkinsRule.WebClient wc = j.createWebClient();",
      "412:         wc.assertFails(\"computer/(master)/config.xml\", HttpURLConnection.HTTP_BAD_REQUEST);",
      "413:         WebRequestSettings settings = new WebRequestSettings(wc.createCrumbedUrl(\"computer/(master)/config.xml\"));",
      "414:         settings.setHttpMethod(HttpMethod.POST);",
      "415:         settings.setRequestBody(\"<hudson/>\");",
      "416:         try {",
      "417:             Page page = wc.getPage(settings);",
      "418:             fail(page.getWebResponse().getContentAsString());",
      "419:         } catch (FailingHttpStatusCodeException x) {",
      "420:             assertEquals(HttpURLConnection.HTTP_BAD_REQUEST, x.getStatusCode());",
      "421:         }",
      "422:     }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "7aac5298406524506ffa73af62d8232cdad7d098",
      "candidate_info": {
        "commit_hash": "7aac5298406524506ffa73af62d8232cdad7d098",
        "repo": "jenkinsci/jenkins",
        "commit_url": "https://github.com/jenkinsci/jenkins/commit/7aac5298406524506ffa73af62d8232cdad7d098",
        "files": [
          "test/src/test/java/hudson/model/NodeTest.java"
        ],
        "message": "WebRequestSettings \u2192 WebRequest in new HtmlUnit.",
        "before_after_code_files": [
          "test/src/test/java/hudson/model/NodeTest.java||test/src/test/java/hudson/model/NodeTest.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "test/src/test/java/hudson/model/NodeTest.java||test/src/test/java/hudson/model/NodeTest.java"
          ],
          "candidate": [
            "test/src/test/java/hudson/model/NodeTest.java||test/src/test/java/hudson/model/NodeTest.java"
          ]
        }
      },
      "candidate_diff": {
        "test/src/test/java/hudson/model/NodeTest.java||test/src/test/java/hudson/model/NodeTest.java": [
          "File: test/src/test/java/hudson/model/NodeTest.java -> test/src/test/java/hudson/model/NodeTest.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "26: import com.gargoylesoftware.htmlunit.FailingHttpStatusCodeException;",
          "27: import com.gargoylesoftware.htmlunit.HttpMethod;",
          "28: import com.gargoylesoftware.htmlunit.Page;",
          "30: import hudson.EnvVars;",
          "31: import hudson.FilePath;",
          "32: import hudson.maven.MavenModuleSet;",
          "",
          "[Removed Lines]",
          "29: import com.gargoylesoftware.htmlunit.WebRequestSettings;",
          "",
          "[Added Lines]",
          "29: import com.gargoylesoftware.htmlunit.WebRequest;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "416:     public void masterComputerConfigDotXml() throws Exception {",
          "417:         JenkinsRule.WebClient wc = j.createWebClient();",
          "418:         wc.assertFails(\"computer/(master)/config.xml\", HttpURLConnection.HTTP_BAD_REQUEST);",
          "420:         settings.setHttpMethod(HttpMethod.POST);",
          "421:         settings.setRequestBody(\"<hudson/>\");",
          "422:         try {",
          "",
          "[Removed Lines]",
          "419:         WebRequestSettings settings = new WebRequestSettings(wc.createCrumbedUrl(\"computer/(master)/config.xml\"));",
          "",
          "[Added Lines]",
          "419:         WebRequest settings = new WebRequest(wc.createCrumbedUrl(\"computer/(master)/config.xml\"));",
          "",
          "---------------"
        ]
      }
    }
  ]
}