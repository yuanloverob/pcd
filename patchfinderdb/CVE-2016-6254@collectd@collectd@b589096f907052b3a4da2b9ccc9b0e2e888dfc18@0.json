{
  "cve_id": "CVE-2016-6254",
  "cve_desc": "Heap-based buffer overflow in the parse_packet function in network.c in collectd before 5.4.3 and 5.x before 5.5.2 allows remote attackers to cause a denial of service (daemon crash) or possibly execute arbitrary code via a crafted network packet.",
  "repo": "collectd/collectd",
  "patch_hash": "b589096f907052b3a4da2b9ccc9b0e2e888dfc18",
  "patch_info": {
    "commit_hash": "b589096f907052b3a4da2b9ccc9b0e2e888dfc18",
    "repo": "collectd/collectd",
    "commit_url": "https://github.com/collectd/collectd/commit/b589096f907052b3a4da2b9ccc9b0e2e888dfc18",
    "files": [
      "src/network.c"
    ],
    "message": "network plugin: Fix heap overflow in parse_packet().\n\nEmilien Gaspar has identified a heap overflow in parse_packet(), the\nfunction used by the network plugin to parse incoming network packets.\n\nThis is a vulnerability in collectd, though the scope is not clear at\nthis point. At the very least specially crafted network packets can be\nused to crash the daemon. We can't rule out a potential remote code\nexecution though.\n\nFixes: CVE-2016-6254",
    "before_after_code_files": [
      "src/network.c||src/network.c"
    ]
  },
  "patch_diff": {
    "src/network.c||src/network.c": [
      "File: src/network.c -> src/network.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1435:     printed_ignore_warning = 1;",
      "1436:    }",
      "1437:    buffer = ((char *) buffer) + pkg_length;",
      "1438:    continue;",
      "1439:   }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1438:    buffer_size -= (size_t) pkg_length;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "1462:     printed_ignore_warning = 1;",
      "1463:    }",
      "1464:    buffer = ((char *) buffer) + pkg_length;",
      "1465:    continue;",
      "1466:   }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1466:    buffer_size -= (size_t) pkg_length;",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "1603:    DEBUG (\"network plugin: parse_packet: Unknown part\"",
      "1604:      \" type: 0x%04hx\", pkg_type);",
      "1605:    buffer = ((char *) buffer) + pkg_length;",
      "1606:   }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1608:    buffer_size -= (size_t) pkg_length;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "4899e46dc1390e559f0274323d37652f9fc1ab87",
      "candidate_info": {
        "commit_hash": "4899e46dc1390e559f0274323d37652f9fc1ab87",
        "repo": "collectd/collectd",
        "commit_url": "https://github.com/collectd/collectd/commit/4899e46dc1390e559f0274323d37652f9fc1ab87",
        "files": [
          "src/network.c"
        ],
        "message": "network plugin: Fix heap overflow in parse_packet().\n\nEmilien Gaspar has identified a heap overflow in parse_packet(), the\nfunction used by the network plugin to parse incoming network packets.\n\nThis is a vulnerability in collectd, though the scope is not clear at\nthis point. At the very least specially crafted network packets can be\nused to crash the daemon. We can't rule out a potential remote code\nexecution though.\n\nFixes: CVE-2016-6254\n(cherry picked from commit b589096f907052b3a4da2b9ccc9b0e2e888dfc18)",
        "before_after_code_files": [
          "src/network.c||src/network.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "src/network.c||src/network.c"
          ],
          "candidate": [
            "src/network.c||src/network.c"
          ]
        }
      },
      "candidate_diff": {
        "src/network.c||src/network.c": [
          "File: src/network.c -> src/network.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1429:     printed_ignore_warning = 1;",
          "1430:    }",
          "1431:    buffer = ((char *) buffer) + pkg_length;",
          "1432:    continue;",
          "1433:   }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1432:    buffer_size -= (size_t) pkg_length;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1456:     printed_ignore_warning = 1;",
          "1457:    }",
          "1458:    buffer = ((char *) buffer) + pkg_length;",
          "1459:    continue;",
          "1460:   }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1460:    buffer_size -= (size_t) pkg_length;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1578:    DEBUG (\"network plugin: parse_packet: Unknown part\"",
          "1579:      \" type: 0x%04hx\", pkg_type);",
          "1580:    buffer = ((char *) buffer) + pkg_length;",
          "1581:   }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1583:    buffer_size -= (size_t) pkg_length;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "8391a4430d5dffea44898adb628a5bcdbcfe31ba",
      "candidate_info": {
        "commit_hash": "8391a4430d5dffea44898adb628a5bcdbcfe31ba",
        "repo": "collectd/collectd",
        "commit_url": "https://github.com/collectd/collectd/commit/8391a4430d5dffea44898adb628a5bcdbcfe31ba",
        "files": [
          "src/network.c"
        ],
        "message": "network plugin: unsigned variables can't be negative",
        "before_after_code_files": [
          "src/network.c||src/network.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/network.c||src/network.c"
          ],
          "candidate": [
            "src/network.c||src/network.c"
          ]
        }
      },
      "candidate_diff": {
        "src/network.c||src/network.c": [
          "File: src/network.c -> src/network.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "410: {",
          "411:   int status;",
          "417:     return (-EINVAL);",
          "419:   if (!check_receive_okay (vl))",
          "",
          "[Removed Lines]",
          "413:   if ((vl->time <= 0)",
          "414:       || (strlen (vl->host) <= 0)",
          "415:       || (strlen (vl->plugin) <= 0)",
          "416:       || (strlen (vl->type) <= 0))",
          "",
          "[Added Lines]",
          "413:   if ((vl->time == 0)",
          "414:       || (strlen (vl->host) == 0)",
          "415:       || (strlen (vl->plugin) == 0)",
          "416:       || (strlen (vl->type) == 0))",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1246:   BUFFER_READ (&username_len, sizeof (username_len));",
          "1247:   username_len = ntohs (username_len);",
          "1250:       || (username_len > (part_size - (PART_ENCRYPTION_AES256_SIZE + 1))))",
          "1251:   {",
          "1252:     NOTICE (\"network plugin: parse_part_encr_aes256: \"",
          "",
          "[Removed Lines]",
          "1249:   if ((username_len <= 0)",
          "",
          "[Added Lines]",
          "1249:   if ((username_len == 0)",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1579:       \"unknown severity %i.\",",
          "1580:       n.severity);",
          "1581:    }",
          "1583:    {",
          "1584:     INFO (\"network plugin: \"",
          "1585:       \"Ignoring notification with \"",
          "1586:       \"time == 0.\");",
          "1587:    }",
          "1589:    {",
          "1590:     INFO (\"network plugin: \"",
          "1591:       \"Ignoring notification with \"",
          "",
          "[Removed Lines]",
          "1582:    else if (n.time <= 0)",
          "1588:    else if (strlen (n.message) <= 0)",
          "",
          "[Added Lines]",
          "1582:    else if (n.time == 0)",
          "1588:    else if (strlen (n.message) == 0)",
          "",
          "---------------"
        ]
      }
    }
  ]
}