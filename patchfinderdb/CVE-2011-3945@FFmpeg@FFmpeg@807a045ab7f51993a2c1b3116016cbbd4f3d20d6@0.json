{
  "cve_id": "CVE-2011-3945",
  "cve_desc": "The decode_frame function in the KVG1 decoder (kgv1dec.c) in libavcodec in FFmpeg 0.7.x before 0.7.12 and 0.8.x before 0.8.11, and in Libav 0.5.x before 0.5.9, 0.6.x before 0.6.6, 0.7.x before 0.7.5, and 0.8.x before 0.8.1, allows remote attackers to cause a denial of service (crash) and possibly execute arbitrary code via a crafted media file.",
  "repo": "FFmpeg/FFmpeg",
  "patch_hash": "807a045ab7f51993a2c1b3116016cbbd4f3d20d6",
  "patch_info": {
    "commit_hash": "807a045ab7f51993a2c1b3116016cbbd4f3d20d6",
    "repo": "FFmpeg/FFmpeg",
    "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/807a045ab7f51993a2c1b3116016cbbd4f3d20d6",
    "files": [
      "libavcodec/kgv1dec.c"
    ],
    "message": "kgv1dec: Increase offsets array size so it is large enough.\n\nFixes CVE-2011-3945\n\nFound-by: Mateusz \"j00ru\" Jurczyk and Gynvael Coldwind\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>",
    "before_after_code_files": [
      "libavcodec/kgv1dec.c||libavcodec/kgv1dec.c"
    ]
  },
  "patch_diff": {
    "libavcodec/kgv1dec.c||libavcodec/kgv1dec.c": [
      "File: libavcodec/kgv1dec.c -> libavcodec/kgv1dec.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "39:     const uint8_t *buf = avpkt->data;",
      "40:     const uint8_t *buf_end = buf + avpkt->size;",
      "41:     KgvContext * const c = avctx->priv_data;",
      "43:     uint16_t *out, *prev;",
      "44:     int outcnt = 0, maxcnt;",
      "45:     int w, h, i;",
      "",
      "[Removed Lines]",
      "42:     int offsets[7];",
      "",
      "[Added Lines]",
      "42:     int offsets[8];",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "69:         return -1;",
      "70:     c->prev = prev;",
      "73:         offsets[i] = -1;",
      "75:     while (outcnt < maxcnt && buf_end - 2 > buf) {",
      "",
      "[Removed Lines]",
      "72:     for (i = 0; i < 7; i++)",
      "",
      "[Added Lines]",
      "72:     for (i = 0; i < 8; i++)",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "a02e8df973f5478ec82f4c507f5b5b191a5ecb6b",
      "candidate_info": {
        "commit_hash": "a02e8df973f5478ec82f4c507f5b5b191a5ecb6b",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/a02e8df973f5478ec82f4c507f5b5b191a5ecb6b",
        "files": [
          "libavcodec/kgv1dec.c"
        ],
        "message": "kgv1dec: Increase offsets array size so it is large enough.\n\nFixes CVE-2011-3945\n\nFound-by: Mateusz \"j00ru\" Jurczyk and Gynvael Coldwind\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>\n(cherry picked from commit 807a045ab7f51993a2c1b3116016cbbd4f3d20d6)\n\nSigned-off-by: Alex Converse <alex.converse@gmail.com>",
        "before_after_code_files": [
          "libavcodec/kgv1dec.c||libavcodec/kgv1dec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_message": 1,
        "olp_code_files": {
          "patch": [
            "libavcodec/kgv1dec.c||libavcodec/kgv1dec.c"
          ],
          "candidate": [
            "libavcodec/kgv1dec.c||libavcodec/kgv1dec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavcodec/kgv1dec.c||libavcodec/kgv1dec.c": [
          "File: libavcodec/kgv1dec.c -> libavcodec/kgv1dec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "39:     const uint8_t *buf = avpkt->data;",
          "40:     const uint8_t *buf_end = buf + avpkt->size;",
          "41:     KgvContext * const c = avctx->priv_data;",
          "43:     uint16_t *out, *prev;",
          "44:     int outcnt = 0, maxcnt;",
          "45:     int w, h, i;",
          "",
          "[Removed Lines]",
          "42:     int offsets[7];",
          "",
          "[Added Lines]",
          "42:     int offsets[8];",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "69:         return -1;",
          "70:     c->prev = prev;",
          "73:         offsets[i] = -1;",
          "75:     while (outcnt < maxcnt && buf_end - 2 > buf) {",
          "",
          "[Removed Lines]",
          "72:     for (i = 0; i < 7; i++)",
          "",
          "[Added Lines]",
          "72:     for (i = 0; i < 8; i++)",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "1156f07c6a82af5bd692847d2e66478a28ab1ee2",
      "candidate_info": {
        "commit_hash": "1156f07c6a82af5bd692847d2e66478a28ab1ee2",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/1156f07c6a82af5bd692847d2e66478a28ab1ee2",
        "files": [
          "libavcodec/kgv1dec.c"
        ],
        "message": "kgv1dec: Increase offsets array size so it is large enough.\n\nFixes CVE-2011-3945\n\nFound-by: Mateusz \"j00ru\" Jurczyk and Gynvael Coldwind\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>\n(cherry picked from commit 807a045ab7f51993a2c1b3116016cbbd4f3d20d6)\n\nSigned-off-by: Alex Converse <alex.converse@gmail.com>\n(cherry picked from commit a02e8df973f5478ec82f4c507f5b5b191a5ecb6b)\n(cherry picked from commit d5f2382d0389ed47a566ea536887af908bf9b14f)\n\nSigned-off-by: Reinhard Tartler <siretart@tauware.de>\n(cherry picked from commit a0b65938b7cf37680a4ce0667444a217a151c551)\n\nSigned-off-by: Reinhard Tartler <siretart@tauware.de>",
        "before_after_code_files": [
          "libavcodec/kgv1dec.c||libavcodec/kgv1dec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavcodec/kgv1dec.c||libavcodec/kgv1dec.c"
          ],
          "candidate": [
            "libavcodec/kgv1dec.c||libavcodec/kgv1dec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavcodec/kgv1dec.c||libavcodec/kgv1dec.c": [
          "File: libavcodec/kgv1dec.c -> libavcodec/kgv1dec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "38:     const uint8_t *buf = avpkt->data;",
          "39:     const uint8_t *buf_end = buf + avpkt->size;",
          "40:     KgvContext * const c = avctx->priv_data;",
          "42:     uint16_t *out, *prev;",
          "43:     int outcnt = 0, maxcnt;",
          "44:     int w, h, i;",
          "",
          "[Removed Lines]",
          "41:     int offsets[7];",
          "",
          "[Added Lines]",
          "41:     int offsets[8];",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "68:         return -1;",
          "69:     c->prev = prev;",
          "72:         offsets[i] = -1;",
          "74:     while (outcnt < maxcnt && buf_end - 2 > buf) {",
          "",
          "[Removed Lines]",
          "71:     for (i = 0; i < 7; i++)",
          "",
          "[Added Lines]",
          "71:     for (i = 0; i < 8; i++)",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "a0b65938b7cf37680a4ce0667444a217a151c551",
      "candidate_info": {
        "commit_hash": "a0b65938b7cf37680a4ce0667444a217a151c551",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/a0b65938b7cf37680a4ce0667444a217a151c551",
        "files": [
          "libavcodec/kgv1dec.c"
        ],
        "message": "kgv1dec: Increase offsets array size so it is large enough.\n\nFixes CVE-2011-3945\n\nFound-by: Mateusz \"j00ru\" Jurczyk and Gynvael Coldwind\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>\n(cherry picked from commit 807a045ab7f51993a2c1b3116016cbbd4f3d20d6)\n\nSigned-off-by: Alex Converse <alex.converse@gmail.com>\n(cherry picked from commit a02e8df973f5478ec82f4c507f5b5b191a5ecb6b)\n(cherry picked from commit d5f2382d0389ed47a566ea536887af908bf9b14f)\n\nSigned-off-by: Reinhard Tartler <siretart@tauware.de>",
        "before_after_code_files": [
          "libavcodec/kgv1dec.c||libavcodec/kgv1dec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavcodec/kgv1dec.c||libavcodec/kgv1dec.c"
          ],
          "candidate": [
            "libavcodec/kgv1dec.c||libavcodec/kgv1dec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavcodec/kgv1dec.c||libavcodec/kgv1dec.c": [
          "File: libavcodec/kgv1dec.c -> libavcodec/kgv1dec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "46:     const uint8_t *buf = avpkt->data;",
          "47:     const uint8_t *buf_end = buf + avpkt->size;",
          "48:     KgvContext * const c = avctx->priv_data;",
          "50:     uint16_t *out, *prev;",
          "51:     int outcnt = 0, maxcnt;",
          "52:     int w, h, i, res;",
          "",
          "[Removed Lines]",
          "49:     int offsets[7];",
          "",
          "[Added Lines]",
          "49:     int offsets[8];",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "79:         prev = NULL;",
          "80:     }",
          "83:         offsets[i] = -1;",
          "85:     while (outcnt < maxcnt && buf_end - 2 > buf) {",
          "",
          "[Removed Lines]",
          "82:     for (i = 0; i < 7; i++)",
          "",
          "[Added Lines]",
          "82:     for (i = 0; i < 8; i++)",
          "",
          "---------------"
        ]
      }
    }
  ]
}