{
  "cve_id": "CVE-2019-10678",
  "cve_desc": "Domoticz before 4.10579 neglects to categorize \\n and \\r as insecure argument options.",
  "repo": "domoticz/domoticz",
  "patch_hash": "2119afbe74ee0c914c1d5c4c859c594c08b0ad42",
  "patch_info": {
    "commit_hash": "2119afbe74ee0c914c1d5c4c859c594c08b0ad42",
    "repo": "domoticz/domoticz",
    "commit_url": "https://github.com/domoticz/domoticz/commit/2119afbe74ee0c914c1d5c4c859c594c08b0ad42",
    "files": [
      "main/Helper.cpp"
    ],
    "message": "Do not allow enters/returns in arguments (thanks to Fabio Carretto)",
    "before_after_code_files": [
      "main/Helper.cpp||main/Helper.cpp"
    ]
  },
  "patch_diff": {
    "main/Helper.cpp||main/Helper.cpp": [
      "File: main/Helper.cpp -> main/Helper.cpp",
      "--- Hunk 1 ---",
      "[Context before]",
      "1014:  \"$\",",
      "1015:  \"<\",",
      "1016:  \">\",",
      "1017:  NULL",
      "1018: };",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1017:  \"\\n\",",
      "1018:  \"\\r\",",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "d1666ce23fa497e8e8ced83597ab8a8435558fed",
      "candidate_info": {
        "commit_hash": "d1666ce23fa497e8e8ced83597ab8a8435558fed",
        "repo": "domoticz/domoticz",
        "commit_url": "https://github.com/domoticz/domoticz/commit/d1666ce23fa497e8e8ced83597ab8a8435558fed",
        "files": [
          "www/app/log/TemperatureLog.js",
          "www/js/domoticz.js"
        ],
        "message": "Better graph display for thermostat devices",
        "before_after_code_files": [
          "www/app/log/TemperatureLog.js||www/app/log/TemperatureLog.js",
          "www/js/domoticz.js||www/js/domoticz.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/domoticz/domoticz/pull/3180"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "www/app/log/TemperatureLog.js||www/app/log/TemperatureLog.js": [
          "File: www/app/log/TemperatureLog.js -> www/app/log/TemperatureLog.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "39:                     chart = $element",
          "40:                         .highcharts({",
          "41:                             chart: {",
          "43:                                 zoomType: 'x',",
          "44:                                 resetZoomButton: {",
          "45:                                     position: {",
          "",
          "[Removed Lines]",
          "42:                                 type: 'spline',",
          "",
          "[Added Lines]",
          "42:                                 type: getChartType(),",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "121:                                             }",
          "122:                                         }",
          "123:                                     }",
          "125:                             },",
          "126:                             title: {",
          "127:                                 text: getChartTitle()",
          "",
          "[Removed Lines]",
          "124:                                 }",
          "",
          "[Added Lines]",
          "124:                                 },",
          "125:         line: {",
          "126:          lineWidth: 3,",
          "127:          states: {",
          "128:           hover: {",
          "129:            lineWidth: 3",
          "130:           }",
          "131:          },",
          "132:          marker: {",
          "133:           enabled: false,",
          "134:           states: {",
          "135:            hover: {",
          "136:             enabled: true,",
          "137:             symbol: 'circle',",
          "138:             radius: 5,",
          "139:             lineWidth: 1",
          "140:            }",
          "141:           }",
          "142:          }",
          "143:         }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "159:                         })",
          "160:                         .then(function (data) {",
          "161:                             if (typeof data.result != 'undefined') {",
          "163:                                 chart.redraw();",
          "164:                             }",
          "166:                             chart.yAxis[1].visibility = vm.range !== 'day';",
          "167:                         });",
          "168:                 }",
          "170:                 function getChartTitle() {",
          "171:                     var titlePrefix = vm.deviceType === 'Humidity'",
          "",
          "[Removed Lines]",
          "162:                                 AddDataToTempChart(data, chart, vm.range === 'day' ? 1 : 0);",
          "",
          "[Added Lines]",
          "181:                                 AddDataToTempChart(data, chart, vm.range === 'day' ? 1 : 0, (vm.deviceType === 'Thermostat'));",
          "188:                 function getChartType() {",
          "189:      if (vm.deviceType === 'Thermostat') return 'line';",
          "190:      return 'spline';",
          "191:                 }",
          "",
          "---------------"
        ],
        "www/js/domoticz.js||www/js/domoticz.js": [
          "File: www/js/domoticz.js -> www/js/domoticz.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "1256:  }",
          "1257: }",
          "1260:  var datatablete = [];",
          "1261:  var datatabletm = [];",
          "1262:  var datatableta = [];",
          "",
          "[Removed Lines]",
          "1259: function AddDataToTempChart(data, chart, isday) {",
          "",
          "[Added Lines]",
          "1259: function AddDataToTempChart(data, chart, isday, isthermostat) {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1531:     name: $.t('Temperature'),",
          "1532:     color: 'yellow',",
          "1533:     yAxis: 0,",
          "1534:     tooltip: {",
          "1535:      valueSuffix: ' \\u00B0' + $.myglobals.tempsign,",
          "1536:      valueDecimals: 1",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1534:     step: (isthermostat) ? 'left' : null,",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "5524d792df2ee76b9c0486c1226a8443f8ea4426",
      "candidate_info": {
        "commit_hash": "5524d792df2ee76b9c0486c1226a8443f8ea4426",
        "repo": "domoticz/domoticz",
        "commit_url": "https://github.com/domoticz/domoticz/commit/5524d792df2ee76b9c0486c1226a8443f8ea4426",
        "files": [
          "hardware/MQTT.h"
        ],
        "message": "MQTT removed obsolete OnMQTTMessage declaration",
        "before_after_code_files": [
          "hardware/MQTT.h||hardware/MQTT.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/domoticz/domoticz/pull/3180"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "hardware/MQTT.h||hardware/MQTT.h": [
          "File: hardware/MQTT.h -> hardware/MQTT.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "23:  virtual void on_message(const struct mosquitto_message *message) override;",
          "24:  void on_subscribe(int mid, int qos_count, const int *granted_qos) override;",
          "27:  void SendMessage(const std::string &Topic, const std::string &Message);",
          "29:  bool m_bDoReconnect;",
          "",
          "[Removed Lines]",
          "26:  void OnMQTTMessage(char *topicName, int topicLen,  void *pMessage);",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "43cceab0289610acc966b991bce7a98695a011c1",
      "candidate_info": {
        "commit_hash": "43cceab0289610acc966b991bce7a98695a011c1",
        "repo": "domoticz/domoticz",
        "commit_url": "https://github.com/domoticz/domoticz/commit/43cceab0289610acc966b991bce7a98695a011c1",
        "files": [
          "main/SQLHelper.h"
        ],
        "message": "Correcting user variable enum",
        "before_after_code_files": [
          "main/SQLHelper.h||main/SQLHelper.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/domoticz/domoticz/pull/3180"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "main/SQLHelper.h||main/SQLHelper.h": [
          "File: main/SQLHelper.h -> main/SQLHelper.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "36: enum _eUsrVariableType",
          "37: {",
          "38:  USERVARTYPE_INTEGER = 0,",
          "43: };",
          "45: enum _eTaskItemType",
          "",
          "[Removed Lines]",
          "39:  USERVARTYPE_FLOAT,",
          "40:  USERVARTYPE_DATE,",
          "41:  USERVARTYPE_TIME,",
          "42:  USERVARTYPE_STRING",
          "",
          "[Added Lines]",
          "39:  USERVARTYPE_FLOAT, //1",
          "40:  USERVARTYPE_STRING, //2",
          "41:  USERVARTYPE_DATE, //3 Date in format DD/MM/YYYY",
          "42:  USERVARTYPE_TIME, //4 Time in 24 hr format HH:MM",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "d75673fe85b4b5cd4f11d4877b7732a9b5901585",
      "candidate_info": {
        "commit_hash": "d75673fe85b4b5cd4f11d4877b7732a9b5901585",
        "repo": "domoticz/domoticz",
        "commit_url": "https://github.com/domoticz/domoticz/commit/d75673fe85b4b5cd4f11d4877b7732a9b5901585",
        "files": [
          "www/app/events/factories.js"
        ],
        "message": "Fixes absolute path lookup",
        "before_after_code_files": [
          "www/app/events/factories.js||www/app/events/factories.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/domoticz/domoticz/pull/3180"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "www/app/events/factories.js||www/app/events/factories.js": [
          "File: www/app/events/factories.js -> www/app/events/factories.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "93:         function get() {",
          "94:             if (!toolbox) {",
          "96:                     return response.data;",
          "97:                 })",
          "98:             }",
          "",
          "[Removed Lines]",
          "95:                 toolbox = $http.get('/app/events/blockly_toolbox.xml').then(function (response) {",
          "",
          "[Added Lines]",
          "95:                 toolbox = $http.get('app/events/blockly_toolbox.xml').then(function (response) {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "75e68f293a44dc7fe4cfcce908164b8921a027e3",
      "candidate_info": {
        "commit_hash": "75e68f293a44dc7fe4cfcce908164b8921a027e3",
        "repo": "domoticz/domoticz",
        "commit_url": "https://github.com/domoticz/domoticz/commit/75e68f293a44dc7fe4cfcce908164b8921a027e3",
        "files": [
          "www/app/devices/deviceFactory.js",
          "www/app/report/DeviceReport.js"
        ],
        "message": "Fix for YouLess meter report",
        "before_after_code_files": [
          "www/app/devices/deviceFactory.js||www/app/devices/deviceFactory.js",
          "www/app/report/DeviceReport.js||www/app/report/DeviceReport.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/domoticz/domoticz/pull/3180"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "www/app/devices/deviceFactory.js||www/app/devices/deviceFactory.js": [
          "File: www/app/devices/deviceFactory.js -> www/app/devices/deviceFactory.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "55:         this.getUnit = function () {",
          "56:             if (this.SubType === 'Custom Sensor') {",
          "58:             } else if (this.Type === 'General' && this.SubType === 'Voltage') {",
          "59:                 return 'V';",
          "60:             } else if (this.Type === 'General' && this.SubType === 'Distance') {",
          "",
          "[Removed Lines]",
          "57:                 return this.SensorUnit",
          "",
          "[Added Lines]",
          "57:                 return this.SensorUnit;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "71:                 return '';",
          "72:             } else if (this.Type === 'P1 Smart Meter' && this.SubType === 'Energy') {",
          "73:                 return 'kWh';",
          "74:             } else if (this.Type === 'RFXMeter' && this.SwitchTypeVal === 2) {",
          "75:                 return 'm3';",
          "76:             } else if (this.Type === 'Usage' && this.SubType === 'Electric') {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "74:             } else if (this.Type === 'YouLess Meter') {",
          "75:                 return 'kWh';",
          "",
          "---------------"
        ],
        "www/app/report/DeviceReport.js||www/app/report/DeviceReport.js": [
          "File: www/app/report/DeviceReport.js -> www/app/report/DeviceReport.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "66:             }",
          "67:             return ['Power', 'Energy', 'RFXMeter'].includes(vm.device.Type)",
          "68:                 || ['kWh'].includes(vm.device.SubType)",
          "69:                 || ['Counter Incremental'].includes(vm.device.SubType)",
          "70:                 || (vm.device.Type === 'P1 Smart Meter' && vm.device.SubType !== 'Energy');",
          "71:         }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "69:                 || ['YouLess counter'].includes(vm.device.SubType)",
          "",
          "---------------"
        ]
      }
    }
  ]
}