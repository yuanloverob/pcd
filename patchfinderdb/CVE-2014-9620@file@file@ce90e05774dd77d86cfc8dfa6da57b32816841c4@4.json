{
  "cve_id": "CVE-2014-9620",
  "cve_desc": "The ELF parser in file 5.08 through 5.21 allows remote attackers to cause a denial of service via a large number of notes.",
  "repo": "file/file",
  "patch_hash": "ce90e05774dd77d86cfc8dfa6da57b32816841c4",
  "patch_info": {
    "commit_hash": "ce90e05774dd77d86cfc8dfa6da57b32816841c4",
    "repo": "file/file",
    "commit_url": "https://github.com/file/file/commit/ce90e05774dd77d86cfc8dfa6da57b32816841c4",
    "files": [
      "ChangeLog",
      "doc/file.man",
      "doc/libmagic.man",
      "src/apprentice.c",
      "src/elfclass.h",
      "src/file.c",
      "src/file.h",
      "src/file_opts.h",
      "src/magic.c",
      "src/magic.h.in",
      "src/readelf.c"
    ],
    "message": "- Add a limit to the number of ELF notes processed (Suggested by Alexander   Cherepanov) - Restructure ELF note printing so that we don't print the same message   multiple times on repeated notes of the same kind.",
    "before_after_code_files": [
      "src/apprentice.c||src/apprentice.c",
      "src/elfclass.h||src/elfclass.h",
      "src/file.c||src/file.c",
      "src/file.h||src/file.h",
      "src/file_opts.h||src/file_opts.h",
      "src/magic.c||src/magic.c",
      "src/magic.h.in||src/magic.h.in",
      "src/readelf.c||src/readelf.c"
    ]
  },
  "patch_diff": {
    "src/apprentice.c||src/apprentice.c": [
      "File: src/apprentice.c -> src/apprentice.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "32: #include \"file.h\"",
      "34: #ifndef lint",
      "38: #include \"magic.h\"",
      "",
      "[Removed Lines]",
      "35: FILE_RCSID(\"@(#)$File: apprentice.c,v 1.226 2014/11/28 02:35:05 christos Exp $\")",
      "",
      "[Added Lines]",
      "35: FILE_RCSID(\"@(#)$File: apprentice.c,v 1.227 2014/11/28 02:46:39 christos Exp $\")",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "528:  ms->name_max = FILE_NAME_MAX;",
      "529:  ms->elf_shnum_max = FILE_ELF_SHNUM_MAX;",
      "530:  ms->elf_phnum_max = FILE_ELF_PHNUM_MAX;",
      "531:  return ms;",
      "532: free:",
      "533:  free(ms);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "531:  ms->elf_notes_max = FILE_ELF_NOTES_MAX;",
      "",
      "---------------"
    ],
    "src/elfclass.h||src/elfclass.h": [
      "File: src/elfclass.h -> src/elfclass.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "32:  swap = (u.c[sizeof(int32_t) - 1] + 1) != elfhdr.e_ident[EI_DATA];",
      "34:  type = elf_getu16(swap, elfhdr.e_type);",
      "35:  switch (type) {",
      "36: #ifdef ELFCORE",
      "37:  case ET_CORE:",
      "38:   phnum = elf_getu16(swap, elfhdr.e_phnum);",
      "39:   if (phnum > ms->elf_phnum_max)",
      "41:   flags |= FLAGS_IS_CORE;",
      "42:   if (dophn_core(ms, clazz, swap, fd,",
      "43:       (off_t)elf_getu(swap, elfhdr.e_phoff), phnum,",
      "44:       (size_t)elf_getu16(swap, elfhdr.e_phentsize),",
      "46:    return -1;",
      "47:   break;",
      "48: #endif",
      "",
      "[Removed Lines]",
      "40:    return toomany(ms, \"program\", phnum);",
      "45:       fsize, &flags) == -1)",
      "",
      "[Added Lines]",
      "35:  notecount = ms->elf_notes_max;",
      "41:    return toomany(ms, \"program headers\", phnum);",
      "46:       fsize, &flags, &notecount) == -1)",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "57:   if (dophn_exec(ms, clazz, swap, fd,",
      "58:       (off_t)elf_getu(swap, elfhdr.e_phoff), phnum,",
      "59:       (size_t)elf_getu16(swap, elfhdr.e_phentsize),",
      "61:    return -1;",
      "63:  case ET_REL:",
      "64:   shnum = elf_getu16(swap, elfhdr.e_shnum);",
      "65:   if (shnum > ms->elf_shnum_max)",
      "67:   if (doshn(ms, clazz, swap, fd,",
      "68:       (off_t)elf_getu(swap, elfhdr.e_shoff), shnum,",
      "69:       (size_t)elf_getu16(swap, elfhdr.e_shentsize),",
      "72:    return -1;",
      "73:   break;",
      "75:  default:",
      "76:   break;",
      "77:  }",
      "78:  return 1;",
      "",
      "[Removed Lines]",
      "60:       fsize, &flags, shnum) == -1)",
      "66:    return toomany(ms, \"section\", shnum);",
      "70:       fsize, &flags, elf_getu16(swap, elfhdr.e_machine),",
      "71:       (int)elf_getu16(swap, elfhdr.e_shstrndx)) == -1)",
      "",
      "[Added Lines]",
      "61:       fsize, shnum, &flags, &notecount) == -1)",
      "67:    return toomany(ms, \"section headers\", shnum);",
      "71:       fsize, elf_getu16(swap, elfhdr.e_machine),",
      "72:       (int)elf_getu16(swap, elfhdr.e_shstrndx),",
      "73:       &flags, &notecount) == -1)",
      "80:  if (notecount == 0)",
      "81:   return toomany(ms, \"notes\", ms->elf_notes_max);",
      "",
      "---------------"
    ],
    "src/file.c||src/file.c": [
      "File: src/file.c -> src/file.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "32: #include \"file.h\"",
      "34: #ifndef lint",
      "38: #include \"magic.h\"",
      "",
      "[Removed Lines]",
      "35: FILE_RCSID(\"@(#)$File: file.c,v 1.158 2014/11/28 02:35:05 christos Exp $\")",
      "",
      "[Added Lines]",
      "35: FILE_RCSID(\"@(#)$File: file.c,v 1.159 2014/11/28 02:46:39 christos Exp $\")",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "125:  { \"name\", MAGIC_PARAM_NAME_MAX, 0 },",
      "126:  { \"elf_phnum\", MAGIC_PARAM_ELF_PHNUM_MAX, 0 },",
      "127:  { \"elf_shnum\", MAGIC_PARAM_ELF_SHNUM_MAX, 0 },",
      "128: };",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "128:  { \"elf_notes\", MAGIC_PARAM_ELF_NOTES_MAX, 0 },",
      "",
      "---------------"
    ],
    "src/file.h||src/file.h": [
      "File: src/file.h -> src/file.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "407:  uint16_t name_max;",
      "408:  uint16_t elf_shnum_max;",
      "409:  uint16_t elf_phnum_max;",
      "410: #define FILE_INDIR_MAX   15",
      "411: #define FILE_NAME_MAX   30",
      "412: #define FILE_ELF_SHNUM_MAX  32768",
      "413: #define FILE_ELF_PHNUM_MAX  128",
      "414: };",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "410:  uint16_t elf_notes_max;",
      "415: #define FILE_ELF_NOTES_MAX  256",
      "",
      "---------------"
    ],
    "src/file_opts.h||src/file_opts.h": [
      "File: src/file_opts.h -> src/file_opts.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "46: OPT('P', \"parameter\", 0, \"            set file engine parameter limits\\n\"",
      "47:     \"                               indir        15 recursion limit for indirection\\n\"",
      "48:     \"                               name         30 use limit for name/use magic\\n\"",
      "49:     \"                               elf_phnum   128 max ELF prog sections processed\\n\"",
      "50:     \"                               elf_shnum 32768 max ELF sections processed\\n\")",
      "51: OPT('r', \"raw\", 0, \"                  don't translate unprintable chars to \\\\ooo\\n\")",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "49:     \"                               elf_notes   256 max ELF notes processed\\n\"",
      "",
      "---------------"
    ],
    "src/magic.c||src/magic.c": [
      "File: src/magic.c -> src/magic.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "33: #include \"file.h\"",
      "35: #ifndef lint",
      "39: #include \"magic.h\"",
      "",
      "[Removed Lines]",
      "36: FILE_RCSID(\"@(#)$File: magic.c,v 1.89 2014/11/28 02:46:39 christos Exp $\")",
      "",
      "[Added Lines]",
      "36: FILE_RCSID(\"@(#)$File: magic.c,v 1.90 2014/12/04 15:56:46 christos Exp $\")",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "554:  case MAGIC_PARAM_ELF_SHNUM_MAX:",
      "555:   ms->elf_shnum_max = *(const size_t *)val;",
      "556:   return 0;",
      "557:  default:",
      "558:   errno = EINVAL;",
      "559:   return -1;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "557:  case MAGIC_PARAM_ELF_NOTES_MAX:",
      "558:   ms->elf_notes_max = *(const size_t *)val;",
      "559:   return 0;",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "576:  case MAGIC_PARAM_ELF_SHNUM_MAX:",
      "578:   return 0;",
      "579:  default:",
      "580:   errno = EINVAL;",
      "581:   return -1;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "582:  case MAGIC_PARAM_ELF_NOTES_MAX:",
      "584:   return 0;",
      "",
      "---------------"
    ],
    "src/magic.h.in||src/magic.h.in": [
      "File: src/magic.h.in -> src/magic.h.in",
      "--- Hunk 1 ---",
      "[Context before]",
      "107: #define MAGIC_PARAM_NAME_MAX  1",
      "108: #define MAGIC_PARAM_ELF_PHNUM_MAX 2",
      "109: #define MAGIC_PARAM_ELF_SHNUM_MAX 3",
      "111: int magic_setparam(magic_t, int, const void *);",
      "112: int magic_getparam(magic_t, int, void *);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "110: #define MAGIC_PARAM_ELF_NOTES_MAX 4",
      "",
      "---------------"
    ],
    "src/readelf.c||src/readelf.c": [
      "File: src/readelf.c -> src/readelf.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "27: #include \"file.h\"",
      "29: #ifndef lint",
      "31: #endif",
      "33: #ifdef BUILTIN_ELF",
      "",
      "[Removed Lines]",
      "30: FILE_RCSID(\"@(#)$File: readelf.c,v 1.114 2014/12/11 14:19:36 christos Exp $\")",
      "",
      "[Added Lines]",
      "30: FILE_RCSID(\"@(#)$File: readelf.c,v 1.115 2014/12/16 20:53:05 christos Exp $\")",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "44: #ifdef ELFCORE",
      "45: private int dophn_core(struct magic_set *, int, int, int, off_t, int, size_t,",
      "47: #endif",
      "48: private int dophn_exec(struct magic_set *, int, int, int, off_t, int, size_t,",
      "50: private int doshn(struct magic_set *, int, int, int, off_t, int, size_t,",
      "52: private size_t donote(struct magic_set *, void *, size_t, size_t, int,",
      "55: #define ELF_ALIGN(a) ((((a) + align - 1) / align) * align)",
      "",
      "[Removed Lines]",
      "46:     off_t, int *);",
      "49:     off_t, int *, int);",
      "51:     off_t, int *, int, int);",
      "53:     int, size_t, int *);",
      "",
      "[Added Lines]",
      "46:     off_t, int *, uint16_t *);",
      "49:     off_t, int, int *, uint16_t *);",
      "51:     off_t, int, int, int *, uint16_t *);",
      "53:     int, size_t, int *, uint16_t *);",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "67: private int",
      "68: toomany(struct magic_set *ms, const char *name, uint16_t num)",
      "69: {",
      "71:      ) == -1)",
      "72:   return -1;",
      "73:  return 0;",
      "",
      "[Removed Lines]",
      "70:  if (file_printf(ms, \", too many %s header sections (%u)\", name, num",
      "",
      "[Added Lines]",
      "70:  if (file_printf(ms, \", too many %s (%u)\", name, num",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "293:  \"NetBSD\",",
      "294: };",
      "302: private int",
      "303: dophn_core(struct magic_set *ms, int clazz, int swap, int fd, off_t off,",
      "305: {",
      "306:  Elf32_Phdr ph32;",
      "307:  Elf64_Phdr ph64;",
      "",
      "[Removed Lines]",
      "296: #define FLAGS_DID_CORE  0x01",
      "297: #define FLAGS_DID_NOTE  0x02",
      "298: #define FLAGS_DID_BUILD_ID 0x04",
      "299: #define FLAGS_DID_CORE_STYLE 0x08",
      "300: #define FLAGS_IS_CORE  0x10",
      "304:     int num, size_t size, off_t fsize, int *flags)",
      "",
      "[Added Lines]",
      "296: #define FLAGS_DID_CORE   0x001",
      "297: #define FLAGS_DID_OS_NOTE  0x002",
      "298: #define FLAGS_DID_BUILD_ID  0x004",
      "299: #define FLAGS_DID_CORE_STYLE  0x008",
      "300: #define FLAGS_DID_NETBSD_PAX  0x010",
      "301: #define FLAGS_DID_NETBSD_MARCH  0x020",
      "302: #define FLAGS_DID_NETBSD_CMODEL  0x040",
      "303: #define FLAGS_DID_NETBSD_UNKNOWN 0x080",
      "304: #define FLAGS_IS_CORE   0x100",
      "308:     int num, size_t size, off_t fsize, int *flags, uint16_t *notecount)",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "347:    if (offset >= (size_t)bufsize)",
      "348:     break;",
      "349:    offset = donote(ms, nbuf, offset, (size_t)bufsize,",
      "351:    if (offset == 0)",
      "352:     break;",
      "",
      "[Removed Lines]",
      "350:        clazz, swap, 4, flags);",
      "",
      "[Added Lines]",
      "354:        clazz, swap, 4, flags, notecount);",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "477:  }",
      "478: }",
      "483: {",
      "542:  }",
      "548:  if (namesz == 5 && strcmp((char *)&nbuf[noff], \"SuSE\") == 0 &&",
      "550:      file_printf(ms, \", for SuSE %d.%d\", nbuf[doff], nbuf[doff + 1]);",
      "551:  }",
      "552:  if (namesz == 4 && strcmp((char *)&nbuf[noff], \"GNU\") == 0 &&",
      "554:   uint32_t desc[4];",
      "555:   (void)memcpy(desc, &nbuf[doff], sizeof(desc));",
      "557:   if (file_printf(ms, \", for GNU/\") == -1)",
      "559:   switch (elf_getu32(swap, desc[0])) {",
      "560:   case GNU_OS_LINUX:",
      "561:    if (file_printf(ms, \"Linux\") == -1)",
      "563:    break;",
      "564:   case GNU_OS_HURD:",
      "565:    if (file_printf(ms, \"Hurd\") == -1)",
      "567:    break;",
      "568:   case GNU_OS_SOLARIS:",
      "569:    if (file_printf(ms, \"Solaris\") == -1)",
      "571:    break;",
      "572:   case GNU_OS_KFREEBSD:",
      "573:    if (file_printf(ms, \"kFreeBSD\") == -1)",
      "575:    break;",
      "576:   case GNU_OS_KNETBSD:",
      "577:    if (file_printf(ms, \"kNetBSD\") == -1)",
      "579:    break;",
      "580:   default:",
      "581:    if (file_printf(ms, \"<unknown>\") == -1)",
      "583:   }",
      "584:   if (file_printf(ms, \" %d.%d.%d\", elf_getu32(swap, desc[1]),",
      "585:       elf_getu32(swap, desc[2]), elf_getu32(swap, desc[3])) == -1)",
      "589:  }",
      "603:  }",
      "605:  if (namesz == 4 && strcmp((char *)&nbuf[noff], \"PaX\") == 0 &&",
      "607:   static const char *pax[] = {",
      "608:       \"+mprotect\",",
      "609:       \"-mprotect\",",
      "",
      "[Removed Lines]",
      "480: private size_t",
      "481: donote(struct magic_set *ms, void *vbuf, size_t offset, size_t size,",
      "482:     int clazz, int swap, size_t align, int *flags)",
      "484:  Elf32_Nhdr nh32;",
      "485:  Elf64_Nhdr nh64;",
      "486:  size_t noff, doff;",
      "487: #ifdef ELFCORE",
      "488:  int os_style = -1;",
      "489: #endif",
      "490:  uint32_t namesz, descsz;",
      "491:  unsigned char *nbuf = CAST(unsigned char *, vbuf);",
      "492:  char sbuf[512];",
      "494:  if (xnh_sizeof + offset > size) {",
      "498:   return xnh_sizeof + offset;",
      "499:  }",
      "501:  (void)memcpy(xnh_addr, &nbuf[offset], xnh_sizeof);",
      "502:  offset += xnh_sizeof;",
      "504:  namesz = xnh_namesz;",
      "505:  descsz = xnh_descsz;",
      "506:  if ((namesz == 0) && (descsz == 0)) {",
      "510:   return (offset >= size) ? offset : size;",
      "511:  }",
      "513:  if (namesz & 0x80000000) {",
      "514:      (void)file_printf(ms, \", bad note name size 0x%lx\",",
      "515:   (unsigned long)namesz);",
      "516:      return 0;",
      "517:  }",
      "519:  if (descsz & 0x80000000) {",
      "520:      (void)file_printf(ms, \", bad note description size 0x%lx\",",
      "521:   (unsigned long)descsz);",
      "522:      return 0;",
      "523:  }",
      "526:  noff = offset;",
      "527:  doff = ELF_ALIGN(offset + namesz);",
      "529:  if (offset + namesz > size) {",
      "533:   return doff;",
      "534:  }",
      "536:  offset = ELF_ALIGN(doff + descsz);",
      "537:  if (doff + descsz > size) {",
      "541:   return (offset >= size) ? offset : size;",
      "544:  if ((*flags & (FLAGS_DID_NOTE|FLAGS_DID_BUILD_ID)) ==",
      "545:      (FLAGS_DID_NOTE|FLAGS_DID_BUILD_ID))",
      "546:   goto core;",
      "549:      xnh_type == NT_GNU_VERSION && descsz == 2) {",
      "553:      xnh_type == NT_GNU_VERSION && descsz == 16) {",
      "558:    return size;",
      "562:     return size;",
      "566:     return size;",
      "570:     return size;",
      "574:     return size;",
      "578:     return size;",
      "582:     return size;",
      "586:    return size;",
      "588:   return size;",
      "591:  if (namesz == 4 && strcmp((char *)&nbuf[noff], \"GNU\") == 0 &&",
      "592:      xnh_type == NT_GNU_BUILD_ID && (descsz == 16 || descsz == 20)) {",
      "593:      uint8_t desc[20];",
      "594:      uint32_t i;",
      "595:      if (file_printf(ms, \", BuildID[%s]=\", descsz == 16 ? \"md5/uuid\" :",
      "596:   \"sha1\") == -1)",
      "597:       return size;",
      "598:      (void)memcpy(desc, &nbuf[doff], descsz);",
      "599:      for (i = 0; i < descsz; i++)",
      "600:   if (file_printf(ms, \"%02x\", desc[i]) == -1)",
      "601:       return size;",
      "606:      xnh_type == NT_NETBSD_PAX && descsz == 4) {",
      "",
      "[Added Lines]",
      "484: private int",
      "485: do_bid_note(struct magic_set *ms, unsigned char *nbuf, uint32_t type,",
      "486:     int swap __attribute__((__unused__)), uint32_t namesz, uint32_t descsz,",
      "487:     size_t noff, size_t doff, int *flags)",
      "489:  if (namesz == 4 && strcmp((char *)&nbuf[noff], \"GNU\") == 0 &&",
      "490:      type == NT_GNU_BUILD_ID && (descsz == 16 || descsz == 20)) {",
      "491:   uint8_t desc[20];",
      "492:   uint32_t i;",
      "494:   if (file_printf(ms, \", BuildID[%s]=\", descsz == 16 ? \"md5/uuid\" :",
      "495:       \"sha1\") == -1)",
      "496:    return 1;",
      "497:   (void)memcpy(desc, &nbuf[doff], descsz);",
      "498:   for (i = 0; i < descsz; i++)",
      "499:       if (file_printf(ms, \"%02x\", desc[i]) == -1)",
      "500:    return 1;",
      "501:   return 1;",
      "503:  return 0;",
      "504: }",
      "506: private int",
      "507: do_os_note(struct magic_set *ms, unsigned char *nbuf, uint32_t type,",
      "508:     int swap, uint32_t namesz, uint32_t descsz,",
      "509:     size_t noff, size_t doff, int *flags)",
      "510: {",
      "512:      type == NT_GNU_VERSION && descsz == 2) {",
      "515:      return 1;",
      "519:      type == NT_GNU_VERSION && descsz == 16) {",
      "525:    return 1;",
      "529:     return 1;",
      "533:     return 1;",
      "537:     return 1;",
      "541:     return 1;",
      "545:     return 1;",
      "549:     return 1;",
      "553:    return 1;",
      "554:   return 1;",
      "557:  if (namesz == 7 && strcmp((char *)&nbuf[noff], \"NetBSD\") == 0) {",
      "558:       if (type == NT_NETBSD_VERSION && descsz == 4) {",
      "560:    do_note_netbsd_version(ms, swap, &nbuf[doff]);",
      "561:    return 1;",
      "562:   }",
      "563:  }",
      "565:  if (namesz == 8 && strcmp((char *)&nbuf[noff], \"FreeBSD\") == 0) {",
      "566:       if (type == NT_FREEBSD_VERSION && descsz == 4) {",
      "568:    do_note_freebsd_version(ms, swap, &nbuf[doff]);",
      "569:    return 1;",
      "570:   }",
      "573:  if (namesz == 8 && strcmp((char *)&nbuf[noff], \"OpenBSD\") == 0 &&",
      "574:      type == NT_OPENBSD_VERSION && descsz == 4) {",
      "576:   if (file_printf(ms, \", for OpenBSD\") == -1)",
      "577:    return 1;",
      "579:   return 1;",
      "580:  }",
      "582:  if (namesz == 10 && strcmp((char *)&nbuf[noff], \"DragonFly\") == 0 &&",
      "583:      type == NT_DRAGONFLY_VERSION && descsz == 4) {",
      "584:   uint32_t desc;",
      "586:   if (file_printf(ms, \", for DragonFly\") == -1)",
      "587:    return 1;",
      "588:   (void)memcpy(&desc, &nbuf[doff], sizeof(desc));",
      "589:   desc = elf_getu32(swap, desc);",
      "590:   if (file_printf(ms, \" %d.%d.%d\", desc / 100000,",
      "591:       desc / 10000 % 10, desc % 10000) == -1)",
      "592:    return 1;",
      "593:   return 1;",
      "594:  }",
      "595:  return 0;",
      "596: }",
      "598: private int",
      "599: do_pax_note(struct magic_set *ms, unsigned char *nbuf, uint32_t type,",
      "600:     int swap, uint32_t namesz, uint32_t descsz,",
      "601:     size_t noff, size_t doff, int *flags)",
      "602: {",
      "604:      type == NT_NETBSD_PAX && descsz == 4) {",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "616:   size_t i;",
      "617:   int did = 0;",
      "619:   (void)memcpy(&desc, &nbuf[doff], sizeof(desc));",
      "620:   desc = elf_getu32(swap, desc);",
      "622:   if (desc && file_printf(ms, \", PaX: \") == -1)",
      "625:   for (i = 0; i < __arraycount(pax); i++) {",
      "626:    if (((1 << i) & desc) == 0)",
      "627:     continue;",
      "628:    if (file_printf(ms, \"%s%s\", did++ ? \",\" : \"\",",
      "629:        pax[i]) == -1)",
      "666:   }",
      "667:  }",
      "",
      "[Removed Lines]",
      "623:    return size;",
      "630:     return size;",
      "631:   }",
      "632:  }",
      "634:  if (namesz == 7 && strcmp((char *)&nbuf[noff], \"NetBSD\") == 0) {",
      "635:   switch (xnh_type) {",
      "636:   case NT_NETBSD_VERSION:",
      "637:    if (descsz == 4) {",
      "638:     do_note_netbsd_version(ms, swap, &nbuf[doff]);",
      "640:     return size;",
      "641:    }",
      "642:    break;",
      "643:   case NT_NETBSD_MARCH:",
      "644:    if (file_printf(ms, \", compiled for: %.*s\", (int)descsz,",
      "645:        (const char *)&nbuf[doff]) == -1)",
      "646:     return size;",
      "647:    break;",
      "648:   case NT_NETBSD_CMODEL:",
      "649:    if (file_printf(ms, \", compiler model: %.*s\",",
      "650:        (int)descsz, (const char *)&nbuf[doff]) == -1)",
      "651:     return size;",
      "652:    break;",
      "653:   default:",
      "654:    if (file_printf(ms, \", note=%u\", xnh_type) == -1)",
      "655:     return size;",
      "656:    break;",
      "657:   }",
      "658:   return size;",
      "659:  }",
      "661:  if (namesz == 8 && strcmp((char *)&nbuf[noff], \"FreeBSD\") == 0) {",
      "662:       if (xnh_type == NT_FREEBSD_VERSION && descsz == 4) {",
      "663:    do_note_freebsd_version(ms, swap, &nbuf[doff]);",
      "665:    return size;",
      "669:  if (namesz == 8 && strcmp((char *)&nbuf[noff], \"OpenBSD\") == 0 &&",
      "670:      xnh_type == NT_OPENBSD_VERSION && descsz == 4) {",
      "671:   if (file_printf(ms, \", for OpenBSD\") == -1)",
      "672:    return size;",
      "675:   return size;",
      "676:  }",
      "678:  if (namesz == 10 && strcmp((char *)&nbuf[noff], \"DragonFly\") == 0 &&",
      "679:      xnh_type == NT_DRAGONFLY_VERSION && descsz == 4) {",
      "680:   uint32_t desc;",
      "681:   if (file_printf(ms, \", for DragonFly\") == -1)",
      "682:    return size;",
      "683:   (void)memcpy(&desc, &nbuf[doff], sizeof(desc));",
      "684:   desc = elf_getu32(swap, desc);",
      "685:   if (file_printf(ms, \" %d.%d.%d\", desc / 100000,",
      "686:       desc / 10000 % 10, desc % 10000) == -1)",
      "687:    return size;",
      "689:   return size;",
      "690:  }",
      "692: core:",
      "",
      "[Added Lines]",
      "622:    return 1;",
      "629:     return 1;",
      "631:   return 1;",
      "633:  return 0;",
      "634: }",
      "636: private int",
      "637: do_core_note(struct magic_set *ms, unsigned char *nbuf, uint32_t type,",
      "638:     int swap, uint32_t namesz, uint32_t descsz,",
      "639:     size_t noff, size_t doff, int *flags, size_t size, int clazz)",
      "640: {",
      "641: #ifdef ELFCORE",
      "642:  int os_style = -1;",
      "",
      "---------------",
      "--- Hunk 8 ---",
      "[Context before]",
      "718:   os_style = OS_STYLE_NETBSD;",
      "719:  }",
      "725:  if (os_style != -1 && (*flags & FLAGS_DID_CORE_STYLE) == 0) {",
      "726:   if (file_printf(ms, \", %s-style\", os_style_names[os_style])",
      "727:       == -1)",
      "730:  }",
      "732:  switch (os_style) {",
      "733:  case OS_STYLE_NETBSD:",
      "735:    uint32_t signo;",
      "",
      "[Removed Lines]",
      "721: #ifdef ELFCORE",
      "722:  if ((*flags & FLAGS_DID_CORE) != 0)",
      "723:   return size;",
      "728:    return size;",
      "734:   if (xnh_type == NT_NETBSD_CORE_PROCINFO) {",
      "",
      "[Added Lines]",
      "674:    return 1;",
      "680:   if (type == NT_NETBSD_CORE_PROCINFO) {",
      "681:    char sbuf[512];",
      "",
      "---------------",
      "--- Hunk 9 ---",
      "[Context before]",
      "741:    if (file_printf(ms, \", from '%.31s'\",",
      "742:        file_printable(sbuf, sizeof(sbuf),",
      "743:        (const char *)&nbuf[doff + 0x7c])) == -1)",
      "",
      "[Removed Lines]",
      "744:     return size;",
      "",
      "[Added Lines]",
      "691:     return 1;",
      "",
      "---------------",
      "--- Hunk 10 ---",
      "[Context before]",
      "751:        sizeof(signo));",
      "752:    if (file_printf(ms, \" (signal %u)\",",
      "753:        elf_getu32(swap, signo)) == -1)",
      "757:   }",
      "758:   break;",
      "760:  default:",
      "762:    size_t i, j;",
      "763:    unsigned char c;",
      "",
      "[Removed Lines]",
      "754:     return size;",
      "756:    return size;",
      "761:   if (xnh_type == NT_PRPSINFO && *flags & FLAGS_IS_CORE) {",
      "",
      "[Added Lines]",
      "701:     return 1;",
      "703:    return 1;",
      "708:   if (type == NT_PRPSINFO && *flags & FLAGS_IS_CORE) {",
      "",
      "---------------",
      "--- Hunk 11 ---",
      "[Context before]",
      "830:      size_t no;",
      "831:      int adjust = 1;",
      "832:      if (prpsoffsets(k) >= prpsoffsets(i))",
      "",
      "[Removed Lines]",
      "829:     for (k = i + 1 ; k < NOFFSETS ; k++) {",
      "",
      "[Added Lines]",
      "776:     for (k = i + 1 ; k < NOFFSETS; k++) {",
      "",
      "---------------",
      "--- Hunk 12 ---",
      "[Context before]",
      "851:      cp--;",
      "852:     if (file_printf(ms, \", from '%.*s'\",",
      "853:         (int)(cp - cname), cname) == -1)",
      "858:    tryanother:",
      "859:     ;",
      "",
      "[Removed Lines]",
      "854:      return size;",
      "856:     return size;",
      "",
      "[Added Lines]",
      "801:      return 1;",
      "803:     return 1;",
      "",
      "---------------",
      "--- Hunk 13 ---",
      "[Context before]",
      "862:   break;",
      "863:  }",
      "864: #endif",
      "865:  return offset;",
      "866: }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "812:  return 0;",
      "813: }",
      "815: private size_t",
      "816: donote(struct magic_set *ms, void *vbuf, size_t offset, size_t size,",
      "817:     int clazz, int swap, size_t align, int *flags, uint16_t *notecount)",
      "818: {",
      "819:  Elf32_Nhdr nh32;",
      "820:  Elf64_Nhdr nh64;",
      "821:  size_t noff, doff;",
      "822:  uint32_t namesz, descsz;",
      "823:  unsigned char *nbuf = CAST(unsigned char *, vbuf);",
      "825:  if (*notecount == 0)",
      "826:   return 0;",
      "827:  --*notecount;",
      "829:  if (xnh_sizeof + offset > size) {",
      "833:   return xnh_sizeof + offset;",
      "834:  }",
      "836:  (void)memcpy(xnh_addr, &nbuf[offset], xnh_sizeof);",
      "837:  offset += xnh_sizeof;",
      "839:  namesz = xnh_namesz;",
      "840:  descsz = xnh_descsz;",
      "841:  if ((namesz == 0) && (descsz == 0)) {",
      "845:   return (offset >= size) ? offset : size;",
      "846:  }",
      "848:  if (namesz & 0x80000000) {",
      "849:      (void)file_printf(ms, \", bad note name size 0x%lx\",",
      "850:   (unsigned long)namesz);",
      "851:      return 0;",
      "852:  }",
      "854:  if (descsz & 0x80000000) {",
      "855:      (void)file_printf(ms, \", bad note description size 0x%lx\",",
      "856:   (unsigned long)descsz);",
      "857:      return 0;",
      "858:  }",
      "860:  noff = offset;",
      "861:  doff = ELF_ALIGN(offset + namesz);",
      "863:  if (offset + namesz > size) {",
      "867:   return doff;",
      "868:  }",
      "870:  offset = ELF_ALIGN(doff + descsz);",
      "871:  if (doff + descsz > size) {",
      "875:   return (offset >= size) ? offset : size;",
      "876:  }",
      "878:  if ((*flags & FLAGS_DID_OS_NOTE) == 0) {",
      "879:   if (do_os_note(ms, nbuf, xnh_type, swap,",
      "880:       namesz, descsz, noff, doff, flags))",
      "881:    return size;",
      "882:  }",
      "884:  if ((*flags & FLAGS_DID_BUILD_ID) == 0) {",
      "885:   if (do_bid_note(ms, nbuf, xnh_type, swap,",
      "886:       namesz, descsz, noff, doff, flags))",
      "887:    return size;",
      "888:  }",
      "890:  if ((*flags & FLAGS_DID_NETBSD_PAX) == 0) {",
      "891:   if (do_pax_note(ms, nbuf, xnh_type, swap,",
      "892:       namesz, descsz, noff, doff, flags))",
      "893:    return size;",
      "894:  }",
      "896:  if ((*flags & FLAGS_DID_CORE) == 0) {",
      "897:   if (do_core_note(ms, nbuf, xnh_type, swap,",
      "898:       namesz, descsz, noff, doff, flags, size, clazz))",
      "899:    return size;",
      "900:  }",
      "902:  if (namesz == 7 && strcmp((char *)&nbuf[noff], \"NetBSD\") == 0) {",
      "903:   switch (xnh_type) {",
      "904:       case NT_NETBSD_VERSION:",
      "905:    return size;",
      "906:   case NT_NETBSD_MARCH:",
      "907:    if (*flags & FLAGS_DID_NETBSD_MARCH)",
      "908:     return size;",
      "909:    if (file_printf(ms, \", compiled for: %.*s\", (int)descsz,",
      "910:        (const char *)&nbuf[doff]) == -1)",
      "911:     return size;",
      "912:    break;",
      "913:   case NT_NETBSD_CMODEL:",
      "914:    if (*flags & FLAGS_DID_NETBSD_CMODEL)",
      "915:     return size;",
      "916:    if (file_printf(ms, \", compiler model: %.*s\",",
      "917:        (int)descsz, (const char *)&nbuf[doff]) == -1)",
      "918:     return size;",
      "919:    break;",
      "920:   default:",
      "921:    if (*flags & FLAGS_DID_NETBSD_UNKNOWN)",
      "922:     return size;",
      "923:    if (file_printf(ms, \", note=%u\", xnh_type) == -1)",
      "924:     return size;",
      "925:    break;",
      "926:   }",
      "927:   return size;",
      "928:  }",
      "",
      "---------------",
      "--- Hunk 14 ---",
      "[Context before]",
      "918: private int",
      "919: doshn(struct magic_set *ms, int clazz, int swap, int fd, off_t off, int num,",
      "921: {",
      "922:  Elf32_Shdr sh32;",
      "923:  Elf64_Shdr sh64;",
      "",
      "[Removed Lines]",
      "920:     size_t size, off_t fsize, int *flags, int mach, int strtab)",
      "",
      "[Added Lines]",
      "985:     size_t size, off_t fsize, int mach, int strtab, int *flags,",
      "986:     uint16_t *notecount)",
      "",
      "---------------",
      "--- Hunk 15 ---",
      "[Context before]",
      "994:     if (noff >= (off_t)xsh_size)",
      "995:      break;",
      "996:     noff = donote(ms, nbuf, (size_t)noff,",
      "998:     if (noff == 0)",
      "999:      break;",
      "1000:    }",
      "",
      "[Removed Lines]",
      "997:         xsh_size, clazz, swap, 4, flags);",
      "",
      "[Added Lines]",
      "1063:         xsh_size, clazz, swap, 4, flags, notecount);",
      "",
      "---------------",
      "--- Hunk 16 ---",
      "[Context before]",
      "1162: private int",
      "1163: dophn_exec(struct magic_set *ms, int clazz, int swap, int fd, off_t off,",
      "1165: {",
      "1166:  Elf32_Phdr ph32;",
      "1167:  Elf64_Phdr ph64;",
      "",
      "[Removed Lines]",
      "1164:     int num, size_t size, off_t fsize, int *flags, int sh_num)",
      "",
      "[Added Lines]",
      "1230:     int num, size_t size, off_t fsize, int sh_num, int *flags,",
      "1231:     uint16_t *notecount)",
      "",
      "---------------",
      "--- Hunk 17 ---",
      "[Context before]",
      "1242:      break;",
      "1243:     offset = donote(ms, nbuf, offset,",
      "1244:         (size_t)bufsize, clazz, swap, align,",
      "1246:     if (offset == 0)",
      "1247:      break;",
      "1248:    }",
      "",
      "[Removed Lines]",
      "1245:         flags);",
      "",
      "[Added Lines]",
      "1312:         flags, notecount);",
      "",
      "---------------",
      "--- Hunk 18 ---",
      "[Context before]",
      "1277:  int flags = 0;",
      "1278:  Elf32_Ehdr elf32hdr;",
      "1279:  Elf64_Ehdr elf64hdr;",
      "1282:  if (ms->flags & (MAGIC_MIME|MAGIC_APPLE))",
      "1283:   return 0;",
      "",
      "[Removed Lines]",
      "1280:  uint16_t type, phnum, shnum;",
      "",
      "[Added Lines]",
      "1347:  uint16_t type, phnum, shnum, notecount;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "90018fe22ff8b74a22fcd142225b0a00f3f12677",
      "candidate_info": {
        "commit_hash": "90018fe22ff8b74a22fcd142225b0a00f3f12677",
        "repo": "file/file",
        "commit_url": "https://github.com/file/file/commit/90018fe22ff8b74a22fcd142225b0a00f3f12677",
        "files": [
          "src/apprentice.c",
          "src/file.c",
          "src/file.h",
          "src/file_opts.h",
          "src/magic.c",
          "src/magic.h.in",
          "src/softmagic.c"
        ],
        "message": "bump recursion to 15, and allow it to be set from the command line.",
        "before_after_code_files": [
          "src/apprentice.c||src/apprentice.c",
          "src/file.c||src/file.c",
          "src/file.h||src/file.h",
          "src/file_opts.h||src/file_opts.h",
          "src/magic.c||src/magic.c",
          "src/magic.h.in||src/magic.h.in",
          "src/softmagic.c||src/softmagic.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/apprentice.c||src/apprentice.c",
            "src/file.c||src/file.c",
            "src/file.h||src/file.h",
            "src/file_opts.h||src/file_opts.h",
            "src/magic.c||src/magic.c",
            "src/magic.h.in||src/magic.h.in"
          ],
          "candidate": [
            "src/apprentice.c||src/apprentice.c",
            "src/file.c||src/file.c",
            "src/file.h||src/file.h",
            "src/file_opts.h||src/file_opts.h",
            "src/magic.c||src/magic.c",
            "src/magic.h.in||src/magic.h.in"
          ]
        }
      },
      "candidate_diff": {
        "src/apprentice.c||src/apprentice.c": [
          "File: src/apprentice.c -> src/apprentice.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "32: #include \"file.h\"",
          "34: #ifndef lint",
          "38: #include \"magic.h\"",
          "",
          "[Removed Lines]",
          "35: FILE_RCSID(\"@(#)$File: apprentice.c,v 1.222 2014/11/11 17:46:05 christos Exp $\")",
          "",
          "[Added Lines]",
          "35: FILE_RCSID(\"@(#)$File: apprentice.c,v 1.223 2014/11/12 15:28:34 christos Exp $\")",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "524:   ms->mlist[i] = NULL;",
          "525:  ms->file = \"unknown\";",
          "526:  ms->line = 0;",
          "527:  return ms;",
          "528: free:",
          "529:  free(ms);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "527:  ms->max_recursion = FILE_MAX_RECURSION;",
          "",
          "---------------"
        ],
        "src/file.c||src/file.c": [
          "File: src/file.c -> src/file.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "32: #include \"file.h\"",
          "34: #ifndef lint",
          "38: #include \"magic.h\"",
          "",
          "[Removed Lines]",
          "35: FILE_RCSID(\"@(#)$File: file.c,v 1.154 2014/09/10 18:41:51 christos Exp $\")",
          "",
          "[Added Lines]",
          "35: FILE_RCSID(\"@(#)$File: file.c,v 1.155 2014/10/11 15:03:16 christos Exp $\")",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "98: #undef OPT_LONGONLY",
          "99:     {0, 0, NULL, 0}",
          "100: };",
          "103: private const struct {",
          "104:  const char *name;",
          "",
          "[Removed Lines]",
          "101: #define OPTSTRING \"bcCde:Ef:F:hiklLm:nNprsvz0\"",
          "",
          "[Added Lines]",
          "101: #define OPTSTRING \"bcCde:Ef:F:hiklLm:nNprR:svz0\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "137:  size_t i;",
          "138:  int action = 0, didsomefiles = 0, errflg = 0;",
          "139:  int flags = 0, e = 0;",
          "140:  struct magic_set *magic = NULL;",
          "141:  int longindex;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "140:  size_t max_recursion = 0;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "245:   case 'r':",
          "246:    flags |= MAGIC_RAW;",
          "247:    break;",
          "248:   case 's':",
          "249:    flags |= MAGIC_DEVICES;",
          "250:    break;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "249:   case 'R':",
          "250:    max_recursion = atoi(optarg);",
          "251:    break;",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "320:   if (magic == NULL)",
          "321:    if ((magic = load(magicfile, flags)) == NULL)",
          "322:     return 1;",
          "323:   break;",
          "324:  }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "329:   if (max_recursion) {",
          "330:    if (magic_setparam(magic, MAGIC_PARAM_MAX_RECURSION,",
          "331:        &max_recursion) == -1) {",
          "332:     (void)fprintf(stderr,",
          "333:         \"%s: Can't set recurision %s\\n\", progname,",
          "334:         strerror(errno));",
          "335:     return 1;",
          "336:    }",
          "337:   }",
          "",
          "---------------"
        ],
        "src/file.h||src/file.h": [
          "File: src/file.h -> src/file.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "404: };",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "404:  size_t max_recursion;",
          "405: #define FILE_MAX_RECURSION 15",
          "",
          "---------------"
        ],
        "src/file_opts.h||src/file_opts.h": [
          "File: src/file_opts.h -> src/file_opts.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "44: OPT('p', \"preserve-date\", 0, \"        preserve access times on files\\n\")",
          "45: #endif",
          "46: OPT('r', \"raw\", 0, \"                  don't translate unprintable chars to \\\\ooo\\n\")",
          "47: OPT('s', \"special-files\", 0, \"        treat special (block/char devices) files as\\n\"",
          "48:     \"                             ordinary ones\\n\")",
          "49: OPT('C', \"compile\", 0, \"              compile file specified by -m\\n\")",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "47: OPT('R', \"recursion\", 0, \"            set maximum recursion level\\n\")",
          "",
          "---------------"
        ],
        "src/magic.c||src/magic.c": [
          "File: src/magic.c -> src/magic.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "33: #include \"file.h\"",
          "35: #ifndef lint",
          "39: #include \"magic.h\"",
          "",
          "[Removed Lines]",
          "36: FILE_RCSID(\"@(#)$File: magic.c,v 1.84 2014/05/14 23:15:42 christos Exp $\")",
          "",
          "[Added Lines]",
          "36: FILE_RCSID(\"@(#)$File: magic.c,v 1.85 2014/08/04 06:19:44 christos Exp $\")",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "536: {",
          "537:  return MAGIC_VERSION;",
          "538: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "540: public int",
          "541: magic_setparam(struct magic_set *ms, int param, const void *val)",
          "542: {",
          "543:  switch (param) {",
          "544:  case MAGIC_PARAM_MAX_RECURSION:",
          "545:   ms->max_recursion = *(const size_t *)val;",
          "546:   return 0;",
          "547:  default:",
          "548:   errno = EINVAL;",
          "549:   return -1;",
          "550:  }",
          "551: }",
          "553: public int",
          "554: magic_getparam(struct magic_set *ms, int param, void *val)",
          "555: {",
          "556:  switch (param) {",
          "557:  case MAGIC_PARAM_MAX_RECURSION:",
          "559:   return 0;",
          "560:  default:",
          "561:   errno = EINVAL;",
          "562:   return -1;",
          "563:  }",
          "564: }",
          "",
          "---------------"
        ],
        "src/magic.h.in||src/magic.h.in": [
          "File: src/magic.h.in -> src/magic.h.in",
          "--- Hunk 1 ---",
          "[Context before]",
          "97: int magic_version(void);",
          "98: int magic_load(magic_t, const char *);",
          "101: int magic_compile(magic_t, const char *);",
          "102: int magic_check(magic_t, const char *);",
          "103: int magic_list(magic_t, const char *);",
          "104: int magic_errno(magic_t);",
          "106: #ifdef __cplusplus",
          "107: };",
          "108: #endif",
          "",
          "[Removed Lines]",
          "99: int magic_load_buffers(struct magic_set *, void **, size_t *, size_t);",
          "",
          "[Added Lines]",
          "99: int magic_load_buffers(magic_t, void **, size_t *, size_t);",
          "106: #define MAGIC_PARAM_MAX_RECURSION 0",
          "107: int magic_setparam(magic_t, int, const void *);",
          "108: int magic_getparam(magic_t, int, void *);",
          "",
          "---------------"
        ],
        "src/softmagic.c||src/softmagic.c": [
          "File: src/softmagic.c -> src/softmagic.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "32: #include \"file.h\"",
          "34: #ifndef lint",
          "38: #include \"magic.h\"",
          "",
          "[Removed Lines]",
          "35: FILE_RCSID(\"@(#)$File: softmagic.c,v 1.197 2014/11/11 17:48:23 christos Exp $\")",
          "",
          "[Added Lines]",
          "35: FILE_RCSID(\"@(#)$File: softmagic.c,v 1.198 2014/11/23 13:54:27 christos Exp $\")",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "43: #include <time.h>",
          "45: private int match(struct magic_set *, struct magic *, uint32_t,",
          "47:     int *);",
          "48: private int mget(struct magic_set *, const unsigned char *,",
          "50:     int *, int *);",
          "51: private int magiccheck(struct magic_set *, struct magic *);",
          "52: private int32_t mprint(struct magic_set *, struct magic *);",
          "",
          "[Removed Lines]",
          "46:     const unsigned char *, size_t, size_t, int, int, int, int, int *, int *,",
          "49:     struct magic *, size_t, size_t, unsigned int, int, int, int, int, int *,",
          "",
          "[Added Lines]",
          "46:     const unsigned char *, size_t, size_t, int, int, int, size_t, int *, int *,",
          "49:     struct magic *, size_t, size_t, unsigned int, int, int, int, size_t, int *,",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "65: #define OFFSET_OOB(n, o, i) ((n) < (o) || (i) > ((n) - (o)))",
          "",
          "[Removed Lines]",
          "67: #define MAX_RECURSION_LEVEL 10",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "136: private int",
          "137: match(struct magic_set *ms, struct magic *magic, uint32_t nmagic,",
          "138:     const unsigned char *s, size_t nbytes, size_t offset, int mode, int text,",
          "141: {",
          "142:  uint32_t magindex = 0;",
          "143:  unsigned int cont_level = 0;",
          "",
          "[Removed Lines]",
          "139:     int flip, int recursion_level, int *printed_something, int *need_separator,",
          "140:     int *returnval)",
          "",
          "[Added Lines]",
          "137:     int flip, size_t recursion_level, int *printed_something,",
          "138:     int *need_separator, int *returnval)",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1217: private int",
          "1218: mget(struct magic_set *ms, const unsigned char *s, struct magic *m,",
          "1219:     size_t nbytes, size_t o, unsigned int cont_level, int mode, int text,",
          "1221:     int *need_separator, int *returnval)",
          "1222: {",
          "1223:  uint32_t offset = ms->offset;",
          "",
          "[Removed Lines]",
          "1220:     int flip, int recursion_level, int *printed_something,",
          "",
          "[Added Lines]",
          "1218:     int flip, size_t recursion_level, int *printed_something,",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "1228:  union VALUETYPE *p = &ms->ms_value;",
          "1229:  struct mlist ml;",
          "1233:   return -1;",
          "1234:  }",
          "",
          "[Removed Lines]",
          "1231:  if (recursion_level >= MAX_RECURSION_LEVEL) {",
          "1232:   file_error(ms, 0, \"recursion nesting exceeded\");",
          "",
          "[Added Lines]",
          "1229:  if (recursion_level >= ms->max_recursion) {",
          "1230:   file_error(ms, 0, \"recursion nesting (%zu) exceeded\",",
          "1231:       recursion_level);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "528dc7309736c4551b7417a6560b9fde81f007d5",
      "candidate_info": {
        "commit_hash": "528dc7309736c4551b7417a6560b9fde81f007d5",
        "repo": "file/file",
        "commit_url": "https://github.com/file/file/commit/528dc7309736c4551b7417a6560b9fde81f007d5",
        "files": [
          "src/file.c",
          "src/file_opts.h"
        ],
        "message": "PR/480: print (default) in the right place depending on POSIXLY_CORRECT",
        "before_after_code_files": [
          "src/file.c||src/file.c",
          "src/file_opts.h||src/file_opts.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/file.c||src/file.c",
            "src/file_opts.h||src/file_opts.h"
          ],
          "candidate": [
            "src/file.c||src/file.c",
            "src/file_opts.h||src/file_opts.h"
          ]
        }
      },
      "candidate_diff": {
        "src/file.c||src/file.c": [
          "File: src/file.c -> src/file.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "32: #include \"file.h\"",
          "34: #ifndef lint",
          "38: #include \"magic.h\"",
          "",
          "[Removed Lines]",
          "35: FILE_RCSID(\"@(#)$File: file.c,v 1.166 2015/09/08 13:46:49 christos Exp $\")",
          "",
          "[Added Lines]",
          "35: FILE_RCSID(\"@(#)$File: file.c,v 1.167 2015/09/11 17:24:09 christos Exp $\")",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "94: #define OPT_EXTENSIONS  3",
          "95: #define OPT_MIME_TYPE  4",
          "96: #define OPT_MIME_ENCODING 5",
          "98:     {longname, opt, NULL, shortname},",
          "100:     {longname, opt, NULL, id},",
          "101: #include \"file_opts.h\"",
          "102: #undef OPT",
          "",
          "[Removed Lines]",
          "97: #define OPT(shortname, longname, opt, doc)      \\",
          "99: #define OPT_LONGONLY(longname, opt, doc, id)        \\",
          "",
          "[Added Lines]",
          "97: #define OPT(shortname, longname, opt, def, doc)      \\",
          "99: #define OPT_LONGONLY(longname, opt, def, doc, id)        \\",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "135: };",
          "139: #ifdef __dead",
          "140: __dead",
          "141: #endif",
          "142: private void usage(void);",
          "144: #ifdef __dead",
          "145: __dead",
          "146: #endif",
          "",
          "[Removed Lines]",
          "143: private void docprint(const char *);",
          "",
          "[Added Lines]",
          "138: private int posixly;",
          "144: private void docprint(const char *, int);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "183:   progname = argv[0];",
          "185: #ifdef S_IFLNK",
          "187: #endif",
          "188:  while ((c = getopt_long(argc, argv, OPTSTRING, long_options,",
          "189:      &longindex)) != -1)",
          "",
          "[Removed Lines]",
          "186:  flags |= getenv(\"POSIXLY_CORRECT\") ? MAGIC_SYMLINK : 0;",
          "",
          "[Added Lines]",
          "187:  posixly = getenv(\"POSIXLY_CORRECT\") != NULL;",
          "188:  flags |=  posixly ? MAGIC_SYMLINK : 0;",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "559: }",
          "561: private void",
          "563: {",
          "564:  size_t i;",
          "565:  int comma;",
          "",
          "[Removed Lines]",
          "562: docprint(const char *opts)",
          "",
          "[Added Lines]",
          "564: defprint(int def)",
          "565: {",
          "566:  if (!def)",
          "567:   return;",
          "568:  if (((def & 1) && posixly) || ((def & 2) && !posixly))",
          "569:   fprintf(stdout, \" (default)\");",
          "570:  fputc('\\n', stdout);",
          "571: }",
          "573: private void",
          "574: docprint(const char *opts, int def)",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "568:  p = strstr(opts, \"%o\");",
          "569:  if (p == NULL) {",
          "570:   fprintf(stdout, \"%s\", opts);",
          "571:   return;",
          "572:  }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "583:   defprint(def);",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "595: \"Usage: file [OPTION...] [FILE...]\\n\"",
          "596: \"Determine type of FILEs.\\n\"",
          "597: \"\\n\", stdout);",
          "599:  fprintf(stdout, \"  -%c, --\" longname, shortname), \\",
          "602:  fprintf(stdout, \"      --\" longname), \\",
          "604: #include \"file_opts.h\"",
          "605: #undef OPT",
          "606: #undef OPT_LONGONLY",
          "",
          "[Removed Lines]",
          "598: #define OPT(shortname, longname, opt, doc)      \\",
          "600:  docprint(doc);",
          "601: #define OPT_LONGONLY(longname, opt, doc, id)        \\",
          "603:  docprint(doc);",
          "",
          "[Added Lines]",
          "611: #define OPT(shortname, longname, opt, def, doc)      \\",
          "613:  docprint(doc, def);",
          "614: #define OPT_LONGONLY(longname, opt, def, doc, id)        \\",
          "616:  docprint(doc, def);",
          "",
          "---------------"
        ],
        "src/file_opts.h||src/file_opts.h": [
          "File: src/file_opts.h -> src/file_opts.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "18:     \"                               number files\\n\")",
          "23:     \"                               conjunction with -m to debug a new magic file\\n\"",
          "24:     \"                               before installing it\\n\")",
          "26:     \"                               performed for file. Valid tests are:\\n\"",
          "27:     \"                               %o\\n\")",
          "31:     \"                               --mime-encoding)\\n\")",
          "38: #ifdef S_IFLNK",
          "41: #endif",
          "45: #if defined(HAVE_UTIME) || defined(HAVE_UTIMES)",
          "47: #endif",
          "49:     \"                               indir        15 recursion limit for indirection\\n\"",
          "50:     \"                               name         30 use limit for name/use magic\\n\"",
          "51:     \"                               elf_notes   256 max ELF notes processed\\n\"",
          "52:     \"                               elf_phnum   128 max ELF prog sections processed\\n\"",
          "53:     \"                               elf_shnum 32768 max ELF sections processed\\n\")",
          "56:     \"                             ordinary ones\\n\")",
          "",
          "[Removed Lines]",
          "15: OPT_LONGONLY(\"help\", 0, \"                 display this help and exit\\n\", OPT_HELP)",
          "16: OPT('v', \"version\", 0, \"              output version information and exit\\n\")",
          "17: OPT('m', \"magic-file\", 1, \" LIST      use LIST as a colon-separated list of magic\\n\"",
          "19: OPT('z', \"uncompress\", 0, \"           try to look inside compressed files\\n\")",
          "20: OPT('Z', \"uncompress-noreport\", 0, \"  only print the contents of compressed files\\n\")",
          "21: OPT('b', \"brief\", 0, \"                do not prepend filenames to output lines\\n\")",
          "22: OPT('c', \"checking-printout\", 0, \"    print the parsed form of the magic file, use in\\n\"",
          "25: OPT('e', \"exclude\", 1, \" TEST         exclude TEST from the list of test to be\\n\"",
          "28: OPT('f', \"files-from\", 1, \" FILE      read the filenames to be examined from FILE\\n\")",
          "29: OPT('F', \"separator\", 1, \" STRING     use string as separator instead of `:'\\n\")",
          "30: OPT('i', \"mime\", 0, \"                 output MIME type strings (--mime-type and\\n\"",
          "32: OPT_LONGONLY(\"apple\", 0, \"                output the Apple CREATOR/TYPE\\n\", OPT_APPLE)",
          "33: OPT_LONGONLY(\"extension\", 0, \"            output a slash-separated list of extensions\\n\", OPT_EXTENSIONS)",
          "34: OPT_LONGONLY(\"mime-type\", 0, \"            output the MIME type\\n\", OPT_MIME_TYPE)",
          "35: OPT_LONGONLY(\"mime-encoding\", 0, \"        output the MIME encoding\\n\", OPT_MIME_ENCODING)",
          "36: OPT('k', \"keep-going\", 0, \"           don't stop at the first match\\n\")",
          "37: OPT('l', \"list\", 0, \"                 list magic strength\\n\")",
          "39: OPT('L', \"dereference\", 0, \"          follow symlinks (default)\\n\")",
          "40: OPT('h', \"no-dereference\", 0, \"       don't follow symlinks\\n\")",
          "42: OPT('n', \"no-buffer\", 0, \"            do not buffer output\\n\")",
          "43: OPT('N', \"no-pad\", 0, \"               do not pad output\\n\")",
          "44: OPT('0', \"print0\", 0, \"               terminate filenames with ASCII NUL\\n\")",
          "46: OPT('p', \"preserve-date\", 0, \"        preserve access times on files\\n\")",
          "48: OPT('P', \"parameter\", 1, \"            set file engine parameter limits\\n\"",
          "54: OPT('r', \"raw\", 0, \"                  don't translate unprintable chars to \\\\ooo\\n\")",
          "55: OPT('s', \"special-files\", 0, \"        treat special (block/char devices) files as\\n\"",
          "57: OPT('C', \"compile\", 0, \"              compile file specified by -m\\n\")",
          "58: OPT('d', \"debug\", 0, \"                print debugging messages\\n\")",
          "",
          "[Added Lines]",
          "15: OPT_LONGONLY(\"help\", 0, 0, \"                 display this help and exit\\n\", OPT_HELP)",
          "16: OPT('v', \"version\", 0, 0, \"              output version information and exit\\n\")",
          "17: OPT('m', \"magic-file\", 1, 0, \" LIST      use LIST as a colon-separated list of magic\\n\"",
          "19: OPT('z', \"uncompress\", 0, 0, \"           try to look inside compressed files\\n\")",
          "20: OPT('Z', \"uncompress-noreport\", 0, 0, \"  only print the contents of compressed files\\n\")",
          "21: OPT('b', \"brief\", 0, 0, \"                do not prepend filenames to output lines\\n\")",
          "22: OPT('c', \"checking-printout\", 0, 0, \"    print the parsed form of the magic file, use in\\n\"",
          "25: OPT('e', \"exclude\", 1, 0, \" TEST         exclude TEST from the list of test to be\\n\"",
          "28: OPT('f', \"files-from\", 1, 0, \" FILE      read the filenames to be examined from FILE\\n\")",
          "29: OPT('F', \"separator\", 1, 0, \" STRING     use string as separator instead of `:'\\n\")",
          "30: OPT('i', \"mime\", 0, 0, \"                 output MIME type strings (--mime-type and\\n\"",
          "32: OPT_LONGONLY(\"apple\", 0, 0, \"                output the Apple CREATOR/TYPE\\n\", OPT_APPLE)",
          "33: OPT_LONGONLY(\"extension\", 0, 0, \"            output a slash-separated list of extensions\\n\", OPT_EXTENSIONS)",
          "34: OPT_LONGONLY(\"mime-type\", 0, 0, \"            output the MIME type\\n\", OPT_MIME_TYPE)",
          "35: OPT_LONGONLY(\"mime-encoding\", 0, 0, \"        output the MIME encoding\\n\", OPT_MIME_ENCODING)",
          "36: OPT('k', \"keep-going\", 0, 0, \"           don't stop at the first match\\n\")",
          "37: OPT('l', \"list\", 0, 0, \"                 list magic strength\\n\")",
          "39: OPT('L', \"dereference\", 0, 1, \"          follow symlinks\")",
          "40: OPT('h', \"no-dereference\", 0, 2, \"       don't follow symlinks\")",
          "42: OPT('n', \"no-buffer\", 0, 0, \"            do not buffer output\\n\")",
          "43: OPT('N', \"no-pad\", 0, 0, \"               do not pad output\\n\")",
          "44: OPT('0', \"print0\", 0, 0, \"               terminate filenames with ASCII NUL\\n\")",
          "46: OPT('p', \"preserve-date\", 0, 0, \"        preserve access times on files\\n\")",
          "48: OPT('P', \"parameter\", 1, 0, \"            set file engine parameter limits\\n\"",
          "54: OPT('r', \"raw\", 0, 0, \"                  don't translate unprintable chars to \\\\ooo\\n\")",
          "55: OPT('s', \"special-files\", 0, 0, \"        treat special (block/char devices) files as\\n\"",
          "57: OPT('C', \"compile\", 0, 0, \"              compile file specified by -m\\n\")",
          "58: OPT('d', \"debug\", 0, 0, \"                print debugging messages\\n\")",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "6ce24f35cd4a43c4bdd249e8e0c4952c1f8eac67",
      "candidate_info": {
        "commit_hash": "6ce24f35cd4a43c4bdd249e8e0c4952c1f8eac67",
        "repo": "file/file",
        "commit_url": "https://github.com/file/file/commit/6ce24f35cd4a43c4bdd249e8e0c4952c1f8eac67",
        "files": [
          "ChangeLog",
          "doc/file.man",
          "doc/libmagic.man",
          "src/apprentice.c",
          "src/ascmagic.c",
          "src/elfclass.h",
          "src/file.c",
          "src/file.h",
          "src/funcs.c",
          "src/magic.c",
          "src/magic.h.in",
          "src/softmagic.c"
        ],
        "message": "Kill -R and replace with -P param=value. Allow setting of 4 parameters:     indir, name, shnum, phnum.",
        "before_after_code_files": [
          "src/apprentice.c||src/apprentice.c",
          "src/ascmagic.c||src/ascmagic.c",
          "src/elfclass.h||src/elfclass.h",
          "src/file.c||src/file.c",
          "src/file.h||src/file.h",
          "src/funcs.c||src/funcs.c",
          "src/magic.c||src/magic.c",
          "src/magic.h.in||src/magic.h.in",
          "src/softmagic.c||src/softmagic.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/apprentice.c||src/apprentice.c",
            "src/elfclass.h||src/elfclass.h",
            "src/file.c||src/file.c",
            "src/file.h||src/file.h",
            "src/magic.c||src/magic.c",
            "src/magic.h.in||src/magic.h.in"
          ],
          "candidate": [
            "src/apprentice.c||src/apprentice.c",
            "src/elfclass.h||src/elfclass.h",
            "src/file.c||src/file.c",
            "src/file.h||src/file.h",
            "src/magic.c||src/magic.c",
            "src/magic.h.in||src/magic.h.in"
          ]
        }
      },
      "candidate_diff": {
        "src/apprentice.c||src/apprentice.c": [
          "File: src/apprentice.c -> src/apprentice.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "32: #include \"file.h\"",
          "34: #ifndef lint",
          "38: #include \"magic.h\"",
          "",
          "[Removed Lines]",
          "35: FILE_RCSID(\"@(#)$File: apprentice.c,v 1.223 2014/11/12 15:28:34 christos Exp $\")",
          "",
          "[Added Lines]",
          "35: FILE_RCSID(\"@(#)$File: apprentice.c,v 1.224 2014/11/27 15:40:36 christos Exp $\")",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "524:   ms->mlist[i] = NULL;",
          "525:  ms->file = \"unknown\";",
          "526:  ms->line = 0;",
          "528:  return ms;",
          "529: free:",
          "530:  free(ms);",
          "",
          "[Removed Lines]",
          "527:  ms->max_recursion = FILE_MAX_RECURSION;",
          "",
          "[Added Lines]",
          "527:  ms->indir_recursion = FILE_INDIR_RECURSION;",
          "528:  ms->name_recursion = FILE_NAME_RECURSION;",
          "529:  ms->shnum_max = FILE_ELF_SHNUM;",
          "530:  ms->phnum_max = FILE_ELF_PHNUM;",
          "",
          "---------------"
        ],
        "src/ascmagic.c||src/ascmagic.c": [
          "File: src/ascmagic.c -> src/ascmagic.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "35: #include \"file.h\"",
          "37: #ifndef lint",
          "41: #include \"magic.h\"",
          "",
          "[Removed Lines]",
          "38: FILE_RCSID(\"@(#)$File: ascmagic.c,v 1.87 2013/09/17 15:51:22 christos Exp $\")",
          "",
          "[Added Lines]",
          "38: FILE_RCSID(\"@(#)$File: ascmagic.c,v 1.88 2014/02/12 23:20:53 christos Exp $\")",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "147:       == NULL)",
          "148:    goto done;",
          "149:   if ((rv = file_softmagic(ms, utf8_buf,",
          "151:    rv = -1;",
          "152:  }",
          "",
          "[Removed Lines]",
          "150:       (size_t)(utf8_end - utf8_buf), 0, TEXTTEST, text)) == 0)",
          "",
          "[Added Lines]",
          "150:       (size_t)(utf8_end - utf8_buf), 0, 0, TEXTTEST, text)) == 0)",
          "",
          "---------------"
        ],
        "src/elfclass.h||src/elfclass.h": [
          "File: src/elfclass.h -> src/elfclass.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "36: #ifdef ELFCORE",
          "37:  case ET_CORE:",
          "38:   phnum = elf_getu16(swap, elfhdr.e_phnum);",
          "40:    return toomany(ms, \"program\", phnum);",
          "41:   flags |= FLAGS_IS_CORE;",
          "42:   if (dophn_core(ms, clazz, swap, fd,",
          "",
          "[Removed Lines]",
          "39:   if (phnum > MAX_PHNUM)",
          "",
          "[Added Lines]",
          "39:   if (phnum > ms->phnum_max)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "49:  case ET_EXEC:",
          "50:  case ET_DYN:",
          "51:   phnum = elf_getu16(swap, elfhdr.e_phnum);",
          "53:    return toomany(ms, \"program\", phnum);",
          "54:   shnum = elf_getu16(swap, elfhdr.e_shnum);",
          "56:    return toomany(ms, \"section\", shnum);",
          "57:   if (dophn_exec(ms, clazz, swap, fd,",
          "58:       (off_t)elf_getu(swap, elfhdr.e_phoff), phnum,",
          "",
          "[Removed Lines]",
          "52:   if (phnum > MAX_PHNUM)",
          "55:   if (shnum > MAX_SHNUM)",
          "",
          "[Added Lines]",
          "52:   if (phnum > ms->phnum_max)",
          "55:   if (shnum > ms->shnum_max)",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "63:  case ET_REL:",
          "64:   shnum = elf_getu16(swap, elfhdr.e_shnum);",
          "66:    return toomany(ms, \"section\", shnum);",
          "67:   if (doshn(ms, clazz, swap, fd,",
          "68:       (off_t)elf_getu(swap, elfhdr.e_shoff), shnum,",
          "",
          "[Removed Lines]",
          "65:   if (shnum > MAX_SHNUM)",
          "",
          "[Added Lines]",
          "65:   if (shnum > ms->shnum_max)",
          "",
          "---------------"
        ],
        "src/file.c||src/file.c": [
          "File: src/file.c -> src/file.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "32: #include \"file.h\"",
          "34: #ifndef lint",
          "38: #include \"magic.h\"",
          "",
          "[Removed Lines]",
          "35: FILE_RCSID(\"@(#)$File: file.c,v 1.155 2014/10/11 15:03:16 christos Exp $\")",
          "",
          "[Added Lines]",
          "35: FILE_RCSID(\"@(#)$File: file.c,v 1.156 2014/11/27 15:40:36 christos Exp $\")",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "98: #undef OPT_LONGONLY",
          "99:     {0, 0, NULL, 0}",
          "100: };",
          "103: private const struct {",
          "104:  const char *name;",
          "",
          "[Removed Lines]",
          "101: #define OPTSTRING \"bcCde:Ef:F:hiklLm:nNprR:svz0\"",
          "",
          "[Added Lines]",
          "101: #define OPTSTRING \"bcCde:Ef:F:hiklLm:nNpP:rsvz0\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "117: };",
          "121: private void usage(void);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "119: private struct {",
          "120:  const char *name;",
          "121:  int tag;",
          "122:  size_t value;",
          "123: } pm[] = {",
          "124:  { \"indir\", MAGIC_PARAM_INDIR_RECURSION, 0 },",
          "125:  { \"name\", MAGIC_PARAM_NAME_RECURSION, 0 },",
          "126:  { \"phnum\", MAGIC_PARAM_PHNUM_MAX, 0 },",
          "127:  { \"shnum\", MAGIC_PARAM_SHNUM_MAX, 0 },",
          "128: };",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "125: private int unwrap(struct magic_set *, const char *);",
          "126: private int process(struct magic_set *ms, const char *, int);",
          "127: private struct magic_set *load(const char *, int);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "139: private void setparam(const char *);",
          "140: private void applyparam(magic_t);",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "137:  size_t i;",
          "138:  int action = 0, didsomefiles = 0, errflg = 0;",
          "139:  int flags = 0, e = 0;",
          "141:  struct magic_set *magic = NULL;",
          "142:  int longindex;",
          "",
          "[Removed Lines]",
          "140:  size_t max_recursion = 0;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "243:    flags |= MAGIC_PRESERVE_ATIME;",
          "244:    break;",
          "245: #endif",
          "246:   case 'r':",
          "247:    flags |= MAGIC_RAW;",
          "248:    break;",
          "251:    break;",
          "252:   case 's':",
          "253:    flags |= MAGIC_DEVICES;",
          "",
          "[Removed Lines]",
          "249:   case 'R':",
          "250:    max_recursion = atoi(optarg);",
          "",
          "[Added Lines]",
          "258:   case 'P':",
          "259:    setparam(optarg);",
          "260:    break;",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "326:   if (magic == NULL)",
          "327:    if ((magic = load(magicfile, flags)) == NULL)",
          "328:     return 1;",
          "339:  }",
          "341:  if (optind == argc) {",
          "",
          "[Removed Lines]",
          "329:   if (max_recursion) {",
          "330:    if (magic_setparam(magic, MAGIC_PARAM_MAX_RECURSION,",
          "331:        &max_recursion) == -1) {",
          "332:     (void)fprintf(stderr,",
          "333:         \"%s: Can't set recurision %s\\n\", progname,",
          "334:         strerror(errno));",
          "335:     return 1;",
          "336:    }",
          "337:   }",
          "338:   break;",
          "",
          "[Added Lines]",
          "342:   applyparam(magic);",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "365:  return e;",
          "366: }",
          "369: private struct magic_set *",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "372: private void",
          "373: applyparam(magic_t magic)",
          "374: {",
          "375:  size_t i;",
          "377:  for (i = 0; i < __arraycount(pm); i++) {",
          "378:   if (pm[i].value == 0)",
          "379:    continue;",
          "380:   if (magic_setparam(magic, pm[i].tag, &pm[i].value) == -1) {",
          "381:    (void)fprintf(stderr, \"%s: Can't set %s %s\\n\", progname,",
          "382:     pm[i].name, strerror(errno));",
          "383:    exit(1);",
          "384:   }",
          "385:  }",
          "386: }",
          "388: private void",
          "389: setparam(const char *p)",
          "390: {",
          "391:  size_t i;",
          "392:  char *s;",
          "394:  if ((s = strchr(p, '=')) == NULL)",
          "395:   goto badparm;",
          "397:  for (i = 0; i < __arraycount(pm); i++) {",
          "398:   if (strncmp(p, pm[i].name, s - p) != 0)",
          "399:    continue;",
          "400:   pm[i].value = atoi(s + 1);",
          "401:   return;",
          "402:  }",
          "403: badparm:",
          "404:  (void)fprintf(stderr, \"%s: Unknown param %s\\n\", progname, p);",
          "405:  exit(1);",
          "406: }",
          "",
          "---------------"
        ],
        "src/file.h||src/file.h": [
          "File: src/file.h -> src/file.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "406: };",
          "",
          "[Removed Lines]",
          "404:  size_t max_recursion;",
          "405: #define FILE_MAX_RECURSION 15",
          "",
          "[Added Lines]",
          "404:  uint16_t indir_recursion;",
          "405:  uint16_t name_recursion;",
          "406:  uint16_t shnum_max;",
          "407:  uint16_t phnum_max;",
          "408: #define FILE_INDIR_RECURSION 15",
          "409: #define FILE_NAME_RECURSION 40",
          "410: #define FILE_ELF_SHNUM  32768",
          "411: #define FILE_ELF_PHNUM  128",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "442:     unichar **, size_t *, const char **, const char **, const char **);",
          "443: protected int file_is_tar(struct magic_set *, const unsigned char *, size_t);",
          "444: protected int file_softmagic(struct magic_set *, const unsigned char *, size_t,",
          "446: protected int file_apprentice(struct magic_set *, const char *, int);",
          "447: protected int buffer_apprentice(struct magic_set *, struct magic **,",
          "448:     size_t *, size_t);",
          "",
          "[Removed Lines]",
          "445:     size_t, int, int);",
          "",
          "[Added Lines]",
          "451:     uint16_t, uint16_t, int, int);",
          "",
          "---------------"
        ],
        "src/funcs.c||src/funcs.c": [
          "File: src/funcs.c -> src/funcs.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "27: #include \"file.h\"",
          "29: #ifndef lint",
          "33: #include \"magic.h\"",
          "",
          "[Removed Lines]",
          "30: FILE_RCSID(\"@(#)$File: funcs.c,v 1.73 2014/09/10 18:41:51 christos Exp $\")",
          "",
          "[Added Lines]",
          "30: FILE_RCSID(\"@(#)$File: funcs.c,v 1.74 2014/11/23 13:54:27 christos Exp $\")",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "229:  if ((ms->flags & MAGIC_NO_CHECK_SOFT) == 0)",
          "231:       looks_text)) != 0) {",
          "232:    if ((ms->flags & MAGIC_DEBUG) != 0)",
          "233:     (void)fprintf(stderr, \"softmagic %d\\n\", m);",
          "",
          "[Removed Lines]",
          "230:   if ((m = file_softmagic(ms, ubuf, nb, 0, BINTEST,",
          "",
          "[Added Lines]",
          "230:   if ((m = file_softmagic(ms, ubuf, nb, 0, 0, BINTEST,",
          "",
          "---------------"
        ],
        "src/magic.c||src/magic.c": [
          "File: src/magic.c -> src/magic.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "33: #include \"file.h\"",
          "35: #ifndef lint",
          "39: #include \"magic.h\"",
          "",
          "[Removed Lines]",
          "36: FILE_RCSID(\"@(#)$File: magic.c,v 1.85 2014/08/04 06:19:44 christos Exp $\")",
          "",
          "[Added Lines]",
          "36: FILE_RCSID(\"@(#)$File: magic.c,v 1.86 2014/11/27 15:40:36 christos Exp $\")",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "541: magic_setparam(struct magic_set *ms, int param, const void *val)",
          "542: {",
          "543:  switch (param) {",
          "546:   return 0;",
          "547:  default:",
          "548:   errno = EINVAL;",
          "",
          "[Removed Lines]",
          "544:  case MAGIC_PARAM_MAX_RECURSION:",
          "545:   ms->max_recursion = *(const size_t *)val;",
          "",
          "[Added Lines]",
          "544:  case MAGIC_PARAM_INDIR_RECURSION:",
          "545:   ms->indir_recursion = *(const size_t *)val;",
          "546:   return 0;",
          "547:  case MAGIC_PARAM_NAME_RECURSION:",
          "548:   ms->name_recursion = *(const size_t *)val;",
          "549:   return 0;",
          "550:  case MAGIC_PARAM_PHNUM_MAX:",
          "551:   ms->phnum_max = *(const size_t *)val;",
          "552:   return 0;",
          "553:  case MAGIC_PARAM_SHNUM_MAX:",
          "554:   ms->shnum_max = *(const size_t *)val;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "554: magic_getparam(struct magic_set *ms, int param, void *val)",
          "555: {",
          "556:  switch (param) {",
          "559:   return 0;",
          "560:  default:",
          "561:   errno = EINVAL;",
          "",
          "[Removed Lines]",
          "557:  case MAGIC_PARAM_MAX_RECURSION:",
          "",
          "[Added Lines]",
          "566:  case MAGIC_PARAM_INDIR_RECURSION:",
          "568:   return 0;",
          "569:  case MAGIC_PARAM_NAME_RECURSION:",
          "571:   return 0;",
          "572:  case MAGIC_PARAM_PHNUM_MAX:",
          "574:   return 0;",
          "575:  case MAGIC_PARAM_SHNUM_MAX:",
          "",
          "---------------"
        ],
        "src/magic.h.in||src/magic.h.in": [
          "File: src/magic.h.in -> src/magic.h.in",
          "--- Hunk 1 ---",
          "[Context before]",
          "103: int magic_list(magic_t, const char *);",
          "104: int magic_errno(magic_t);",
          "107: int magic_setparam(magic_t, int, const void *);",
          "108: int magic_getparam(magic_t, int, void *);",
          "",
          "[Removed Lines]",
          "106: #define MAGIC_PARAM_MAX_RECURSION 0",
          "",
          "[Added Lines]",
          "106: #define MAGIC_PARAM_INDIR_RECURSION 0",
          "107: #define MAGIC_PARAM_NAME_RECURSION 1",
          "108: #define MAGIC_PARAM_PHNUM_MAX  2",
          "109: #define MAGIC_PARAM_SHNUM_MAX  3",
          "",
          "---------------"
        ],
        "src/softmagic.c||src/softmagic.c": [
          "File: src/softmagic.c -> src/softmagic.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "32: #include \"file.h\"",
          "34: #ifndef lint",
          "38: #include \"magic.h\"",
          "",
          "[Removed Lines]",
          "35: FILE_RCSID(\"@(#)$File: softmagic.c,v 1.198 2014/11/23 13:54:27 christos Exp $\")",
          "",
          "[Added Lines]",
          "35: FILE_RCSID(\"@(#)$File: softmagic.c,v 1.199 2014/11/27 15:40:36 christos Exp $\")",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "43: #include <time.h>",
          "45: private int match(struct magic_set *, struct magic *, uint32_t,",
          "48: private int mget(struct magic_set *, const unsigned char *,",
          "51: private int magiccheck(struct magic_set *, struct magic *);",
          "52: private int32_t mprint(struct magic_set *, struct magic *);",
          "53: private int32_t moffset(struct magic_set *, struct magic *);",
          "",
          "[Removed Lines]",
          "46:     const unsigned char *, size_t, size_t, int, int, int, size_t, int *, int *,",
          "47:     int *);",
          "49:     struct magic *, size_t, size_t, unsigned int, int, int, int, size_t, int *,",
          "50:     int *, int *);",
          "",
          "[Added Lines]",
          "46:     const unsigned char *, size_t, size_t, int, int, int, uint16_t, uint16_t,",
          "47:     int *, int *, int *);",
          "49:     struct magic *, size_t, size_t, unsigned int, int, int, int, uint16_t,",
          "50:     uint16_t, int *, int *, int *);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "72: protected int",
          "73: file_softmagic(struct magic_set *ms, const unsigned char *buf, size_t nbytes,",
          "75: {",
          "76:  struct mlist *ml;",
          "77:  int rv, printed_something = 0, need_separator = 0;",
          "79:  for (ml = ms->mlist[0]->next; ml != ms->mlist[0]; ml = ml->next)",
          "80:   if ((rv = match(ms, ml->magic, ml->nmagic, buf, nbytes, 0, mode,",
          "83:    return rv;",
          "85:  return 0;",
          "",
          "[Removed Lines]",
          "74:     size_t level, int mode, int text)",
          "81:       text, 0, level, &printed_something, &need_separator,",
          "82:       NULL)) != 0)",
          "",
          "[Added Lines]",
          "74:     uint16_t indir_level, uint16_t name_level, int mode, int text)",
          "81:       text, 0, indir_level, name_level, &printed_something,",
          "82:       &need_separator, NULL)) != 0)",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "134: private int",
          "135: match(struct magic_set *ms, struct magic *magic, uint32_t nmagic,",
          "136:     const unsigned char *s, size_t nbytes, size_t offset, int mode, int text,",
          "138:     int *need_separator, int *returnval)",
          "139: {",
          "140:  uint32_t magindex = 0;",
          "",
          "[Removed Lines]",
          "137:     int flip, size_t recursion_level, int *printed_something,",
          "",
          "[Added Lines]",
          "137:     int flip, uint16_t indir_level, uint16_t name_level, int *printed_something,",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "174:   switch (mget(ms, s, m, nbytes, offset, cont_level, mode, text,",
          "176:       need_separator, returnval)) {",
          "177:   case -1:",
          "178:    return -1;",
          "",
          "[Removed Lines]",
          "175:       flip, recursion_level + 1, printed_something,",
          "",
          "[Added Lines]",
          "175:       flip, indir_level, name_level, printed_something,",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "261:    }",
          "262: #endif",
          "263:    switch (mget(ms, s, m, nbytes, offset, cont_level, mode,",
          "266:    case -1:",
          "267:     return -1;",
          "268:    case 0:",
          "",
          "[Removed Lines]",
          "264:        text, flip, recursion_level + 1, printed_something,",
          "265:        need_separator, returnval)) {",
          "",
          "[Added Lines]",
          "264:        text, flip, indir_level, name_level,",
          "265:        printed_something, need_separator, returnval)) {",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "1215: private int",
          "1216: mget(struct magic_set *ms, const unsigned char *s, struct magic *m,",
          "1217:     size_t nbytes, size_t o, unsigned int cont_level, int mode, int text,",
          "1219:     int *need_separator, int *returnval)",
          "1220: {",
          "1221:  uint32_t offset = ms->offset;",
          "",
          "[Removed Lines]",
          "1218:     int flip, size_t recursion_level, int *printed_something,",
          "",
          "[Added Lines]",
          "1218:     int flip, uint16_t indir_level, uint16_t name_level, int *printed_something,",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "1226:  union VALUETYPE *p = &ms->ms_value;",
          "1227:  struct mlist ml;",
          "1232:   return -1;",
          "1233:  }",
          "",
          "[Removed Lines]",
          "1229:  if (recursion_level >= ms->max_recursion) {",
          "1230:   file_error(ms, 0, \"recursion nesting (%zu) exceeded\",",
          "1231:       recursion_level);",
          "",
          "[Added Lines]",
          "1229:  if (indir_level >= ms->indir_recursion) {",
          "1230:   file_error(ms, 0, \"indirect recursion nesting (%hu) exceeded\",",
          "1231:       indir_level);",
          "1232:   return -1;",
          "1233:  }",
          "1235:  if (name_level >= ms->name_recursion) {",
          "1236:   file_error(ms, 0, \"name recursion nesting (%hu) exceeded\",",
          "1237:       name_level);",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "1680:    return -1;",
          "1682:   rv = file_softmagic(ms, s + offset, nbytes - offset,",
          "1685:   if ((ms->flags & MAGIC_DEBUG) != 0)",
          "1686:    fprintf(stderr, \"indirect @offs=%u[%d]\\n\", offset, rv);",
          "",
          "[Removed Lines]",
          "1683:       recursion_level, BINTEST, text);",
          "",
          "[Added Lines]",
          "1689:       indir_level + 1, name_level, BINTEST, text);",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "1720:   if (m->flag & NOSPACE)",
          "1722:   rv = match(ms, ml.magic, ml.nmagic, s, nbytes, offset + o,",
          "1725:   if (rv != 1)",
          "1727:   return rv;",
          "",
          "[Removed Lines]",
          "1723:       mode, text, flip, recursion_level, printed_something,",
          "1724:       need_separator, returnval);",
          "",
          "[Added Lines]",
          "1729:       mode, text, flip, indir_level, name_level + 1,",
          "1730:       printed_something, need_separator, returnval);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "fc71117317bfe752a1adc2512530ec8e59c54a0c",
      "candidate_info": {
        "commit_hash": "fc71117317bfe752a1adc2512530ec8e59c54a0c",
        "repo": "file/file",
        "commit_url": "https://github.com/file/file/commit/fc71117317bfe752a1adc2512530ec8e59c54a0c",
        "files": [
          "ChangeLog",
          "configure.ac",
          "src/file.c",
          "src/file.h"
        ],
        "message": "locale autoconf fixes",
        "before_after_code_files": [
          "configure.ac||configure.ac",
          "src/file.c||src/file.c",
          "src/file.h||src/file.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/file.c||src/file.c",
            "src/file.h||src/file.h"
          ],
          "candidate": [
            "src/file.c||src/file.c",
            "src/file.h||src/file.h"
          ]
        }
      },
      "candidate_diff": {
        "configure.ac||configure.ac": [
          "File: configure.ac -> configure.ac",
          "--- Hunk 1 ---",
          "[Context before]",
          "82: AC_HEADER_SYS_WAIT",
          "83: AC_CHECK_HEADERS(stdint.h fcntl.h locale.h stdint.h inttypes.h unistd.h)",
          "84: AC_CHECK_HEADERS(stddef.h utime.h wchar.h wctype.h limits.h)",
          "86: AC_CHECK_HEADERS(sys/mman.h sys/stat.h sys/types.h sys/utime.h sys/time.h)",
          "87: AC_CHECK_HEADERS(zlib.h)",
          "",
          "[Removed Lines]",
          "85: AC_CHECK_HEADERS(getopt.h err.h)",
          "",
          "[Added Lines]",
          "85: AC_CHECK_HEADERS(getopt.h err.h xlocale.h)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "138: fi])",
          "140: dnl Checks for functions",
          "143: dnl Provide implementation of some required functions if necessary",
          "144: AC_REPLACE_FUNCS(getopt_long asprintf vasprintf strlcpy strlcat getline ctime_r asctime_r pread strcasestr fmtcheck)",
          "",
          "[Removed Lines]",
          "141: AC_CHECK_FUNCS(strerror strndup strtoul mkstemp mkostemp utimes utime wcwidth strtof newlocale uselocale freelocale)",
          "",
          "[Added Lines]",
          "141: AC_CHECK_FUNCS(strerror strndup strtoul mkstemp mkostemp utimes utime wcwidth strtof newlocale uselocale freelocale setlocale)",
          "",
          "---------------"
        ],
        "src/file.c||src/file.c": [
          "File: src/file.c -> src/file.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "32: #include \"file.h\"",
          "34: #ifndef lint",
          "38: #include \"magic.h\"",
          "",
          "[Removed Lines]",
          "35: FILE_RCSID(\"@(#)$File: file.c,v 1.153 2014/02/11 15:41:04 christos Exp $\")",
          "",
          "[Added Lines]",
          "35: FILE_RCSID(\"@(#)$File: file.c,v 1.154 2014/09/10 18:41:51 christos Exp $\")",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "145:  (void)setlocale(LC_CTYPE, \"\");",
          "147: #ifdef __EMX__",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "145: #ifdef HAVE_SETLOCALE",
          "147: #endif",
          "",
          "---------------"
        ],
        "src/file.h||src/file.h": [
          "File: src/file.h -> src/file.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "474: #if defined(HAVE_LOCALE_H)",
          "475: #include <locale.h>",
          "476: #endif",
          "478: typedef struct {",
          "479:  const char *pat;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "477: #if defined(HAVE_XLOCALE_H)",
          "478: #include <xlocale.h>",
          "479: #endif",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "68bd8433c7e11a8dbe100deefdfac69138ee7cd9",
      "candidate_info": {
        "commit_hash": "68bd8433c7e11a8dbe100deefdfac69138ee7cd9",
        "repo": "file/file",
        "commit_url": "https://github.com/file/file/commit/68bd8433c7e11a8dbe100deefdfac69138ee7cd9",
        "files": [
          "src/readelf.c"
        ],
        "message": "Only trust sizes of regular files.",
        "before_after_code_files": [
          "src/readelf.c||src/readelf.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/readelf.c||src/readelf.c"
          ],
          "candidate": [
            "src/readelf.c||src/readelf.c"
          ]
        }
      },
      "candidate_diff": {
        "src/readelf.c||src/readelf.c": [
          "File: src/readelf.c -> src/readelf.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "27: #include \"file.h\"",
          "29: #ifndef lint",
          "31: #endif",
          "33: #ifdef BUILTIN_ELF",
          "",
          "[Removed Lines]",
          "30: FILE_RCSID(\"@(#)$File: readelf.c,v 1.107 2014/11/26 15:33:10 christos Exp $\")",
          "",
          "[Added Lines]",
          "30: FILE_RCSID(\"@(#)$File: readelf.c,v 1.108 2014/11/27 15:16:00 christos Exp $\")",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "63: #define MAX_PHNUM 128",
          "64: #define MAX_SHNUM 32768",
          "66: private int",
          "67: toomany(struct magic_set *ms, const char *name, uint16_t num)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "65: #define SIZE_UNKNOWN ((off_t)-1)",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "324:   }",
          "325:   off += size;",
          "329:    continue;",
          "330:   }",
          "",
          "[Removed Lines]",
          "327:   if (xph_offset > fsize) {",
          "",
          "[Added Lines]",
          "328:   if (fsize != SIZE_UNKNOWN && xph_offset > fsize) {",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "964:    stripped = 0;",
          "965:    break;",
          "966:   default:",
          "969:     continue;",
          "970:    }",
          "",
          "[Removed Lines]",
          "967:    if (xsh_offset > fsize) {",
          "",
          "[Added Lines]",
          "968:    if (fsize != SIZE_UNKNOWN && xsh_offset > fsize) {",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1190:    shared_libraries = \" (uses shared libs)\";",
          "1191:    break;",
          "1192:   default:",
          "1195:     continue;",
          "1196:    }",
          "",
          "[Removed Lines]",
          "1193:    if (xph_offset > fsize) {",
          "",
          "[Added Lines]",
          "1194:    if (fsize != SIZE_UNKNOWN && xph_offset > fsize) {",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "1284:     file_badread(ms);",
          "1285:   return -1;",
          "1286:  }",
          "1289:  clazz = buf[EI_CLASS];",
          "",
          "[Removed Lines]",
          "1287:  fsize = st.st_size;",
          "",
          "[Added Lines]",
          "1288:  if (S_ISREG(st.st_mode))",
          "1289:   fsize = st.st_size;",
          "1290:  else",
          "1291:   fsize = SIZE_UNKNOWN;",
          "",
          "---------------"
        ]
      }
    }
  ]
}