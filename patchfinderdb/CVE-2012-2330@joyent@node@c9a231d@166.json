{
  "cve_id": "CVE-2012-2330",
  "cve_desc": "The Update method in src/node_http_parser.cc in Node.js before 0.6.17 and 0.7 before 0.7.8 does not properly check the length of a string, which allows remote attackers to obtain sensitive information (request header contents) and possibly spoof HTTP headers via a zero length string.",
  "repo": "joyent/node",
  "patch_hash": "c9a231db0e59658be419d926b1dfa17b939ba158",
  "patch_info": {
    "commit_hash": "c9a231db0e59658be419d926b1dfa17b939ba158",
    "repo": "joyent/node",
    "commit_url": "https://github.com/joyent/node/commit/c9a231d",
    "files": [
      "src/node_http_parser.cc"
    ],
    "message": "typo in node_http_parser",
    "before_after_code_files": [
      "src/node_http_parser.cc||src/node_http_parser.cc"
    ]
  },
  "patch_diff": {
    "src/node_http_parser.cc||src/node_http_parser.cc": [
      "File: src/node_http_parser.cc -> src/node_http_parser.cc",
      "--- Hunk 1 ---",
      "[Context before]",
      "191:   void Update(const char* str, size_t size) {",
      "192:     if (str_ == NULL)",
      "193:       str_ = str;",
      "197:       char* s = new char[size_ + size];",
      "",
      "[Removed Lines]",
      "194:     else if (on_heap_ || str_ + size != str) {",
      "",
      "[Added Lines]",
      "194:     else if (on_heap_ || str_ + size_ != str) {",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "1665b4a2a3bb35b24ca65b5797904aa47ce1a908",
      "candidate_info": {
        "commit_hash": "1665b4a2a3bb35b24ca65b5797904aa47ce1a908",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/1665b4a2a3bb35b24ca65b5797904aa47ce1a908",
        "files": [
          "lib/buffer.js"
        ],
        "message": "lint",
        "before_after_code_files": [
          "lib/buffer.js||libuffer.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "lib/buffer.js||libuffer.js": [
          "File: lib/buffer.js -> libuffer.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "310:     }",
          "311:   }",
          "314: };",
          "",
          "[Removed Lines]",
          "313:   return '<' + name  + ' ' + out.join(' ') + '>';",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "9badc002b4b109b237466c14de08278ef9be1e90",
      "candidate_info": {
        "commit_hash": "9badc002b4b109b237466c14de08278ef9be1e90",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/9badc002b4b109b237466c14de08278ef9be1e90",
        "files": [
          "deps/uv/src/win/error.c"
        ],
        "message": "uv: Upgrade to dfb6be0",
        "before_after_code_files": [
          "deps/uv/src/win/error.c||deps/uv/src/win/error.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "deps/uv/src/win/error.c||deps/uv/src/win/error.c": [
          "File: deps/uv/src/win/error.c -> deps/uv/src/win/error.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "86:     case ERROR_INVALID_REPARSE_DATA:        return UV_ENOENT;",
          "87:     case ERROR_MOD_NOT_FOUND:               return UV_ENOENT;",
          "88:     case ERROR_PATH_NOT_FOUND:              return UV_ENOENT;",
          "89:     case ERROR_ACCESS_DENIED:               return UV_EPERM;",
          "90:     case ERROR_PRIVILEGE_NOT_HELD:          return UV_EPERM;",
          "91:     case ERROR_NOACCESS:                    return UV_EACCES;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "89:     case WSANO_DATA:                        return UV_ENOENT;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "b7223abbdc9ff8dd38da2bda6b87b28437edea9c",
      "candidate_info": {
        "commit_hash": "b7223abbdc9ff8dd38da2bda6b87b28437edea9c",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/b7223abbdc9ff8dd38da2bda6b87b28437edea9c",
        "files": [
          "deps/v8/build/common.gypi",
          "deps/v8/tools/gyp/v8.gyp"
        ],
        "message": "v8: Reapply floating patches",
        "before_after_code_files": [
          "deps/v8/build/common.gypi||deps/v8/build/common.gypi",
          "deps/v8/tools/gyp/v8.gyp||deps/v8/tools/gyp/v8.gyp"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "deps/v8/build/common.gypi||deps/v8/build/common.gypi": [
          "File: deps/v8/build/common.gypi -> deps/v8/build/common.gypi",
          "--- Hunk 1 ---",
          "[Context before]",
          "239:           'WIN32',",
          "240:         ],",
          "241:         'msvs_configuration_attributes': {",
          "243:           'IntermediateDirectory': '$(OutDir)\\\\obj\\\\$(ProjectName)',",
          "244:           'CharacterSet': '1',",
          "245:         },",
          "",
          "[Removed Lines]",
          "242:           'OutputDirectory': '<(DEPTH)\\\\build\\\\$(ConfigurationName)',",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "271:         'target_conditions': [",
          "272:           ['_toolset==\"host\"', {",
          "273:             'variables': {",
          "275:             },",
          "276:             'cflags': [ '<(m32flag)' ],",
          "277:             'ldflags': [ '<(m32flag)' ],",
          "",
          "[Removed Lines]",
          "274:               'm32flag': '<!((echo | $(echo ${CXX_host:-$(which g++)}) -m32 -E - > /dev/null 2>&1) && echo -n \"-m32\" || true)',",
          "",
          "[Added Lines]",
          "273:               'm32flag': '<!((echo | $(echo ${CXX_host:-$(which g++)}) -m32 -E - > /dev/null 2>&1) && echo \"-m32\" || true)',",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "281:           }],",
          "282:           ['_toolset==\"target\"', {",
          "283:             'variables': {",
          "285:             },",
          "286:             'cflags': [ '<(m32flag)' ],",
          "287:             'ldflags': [ '<(m32flag)' ],",
          "",
          "[Removed Lines]",
          "284:               'm32flag': '<!((echo | $(echo ${CXX_target:-${CXX:-$(which g++)}}) -m32 -E - > /dev/null 2>&1) && echo -n \"-m32\" || true)',",
          "",
          "[Added Lines]",
          "283:               'm32flag': '<!((echo | $(echo ${CXX_target:-${CXX:-$(which g++)}}) -m32 -E - > /dev/null 2>&1) && echo \"-m32\" || true)',",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "324:         },",
          "325:         'conditions': [",
          "326:           ['OS==\"linux\" or OS==\"freebsd\" or OS==\"openbsd\" or OS==\"netbsd\"', {",
          "328:                         '-Wnon-virtual-dtor', '-Woverloaded-virtual' ],",
          "329:           }],",
          "330:         ],",
          "",
          "[Removed Lines]",
          "327:             'cflags': [ '-Wall', '<(werror)', '-W', '-Wno-unused-parameter',",
          "",
          "[Added Lines]",
          "326:             'cflags': [ '-Wno-unused-parameter',",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "333:         'conditions': [",
          "334:           ['OS==\"linux\" or OS==\"freebsd\" or OS==\"openbsd\" or OS==\"netbsd\" \\",
          "335:             or OS==\"android\"', {",
          "340:             'cflags': [",
          "341:               '-fdata-sections',",
          "342:               '-ffunction-sections',",
          "",
          "[Removed Lines]",
          "336:             'cflags!': [",
          "337:               '-O2',",
          "338:               '-Os',",
          "339:             ],",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "deps/v8/tools/gyp/v8.gyp||deps/v8/tools/gyp/v8.gyp": [
          "File: deps/v8/tools/gyp/v8.gyp -> deps/v8/tools/gyp/v8.gyp",
          "--- Hunk 1 ---",
          "[Context before]",
          "721:                 '../../src/win32-math.h',",
          "722:               ],",
          "723:               'msvs_disabled_warnings': [4351, 4355, 4800],",
          "724:               'link_settings':  {",
          "725:                 'libraries': [ '-lwinmm.lib', '-lws2_32.lib' ],",
          "726:               },",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "724:               'direct_dependent_settings': {",
          "725:                 'msvs_disabled_warnings': [4351, 4355, 4800],",
          "726:               },",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "35c0cd219d0810c9e5324cf7d48cd6724b4e767b",
      "candidate_info": {
        "commit_hash": "35c0cd219d0810c9e5324cf7d48cd6724b4e767b",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/35c0cd219d0810c9e5324cf7d48cd6724b4e767b",
        "files": [
          "src/node_crypto.cc"
        ],
        "message": "MakeCallback: Use in node_crypto",
        "before_after_code_files": [
          "src/node_crypto.cc||src/node_crypto.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/node_crypto.cc||src/node_crypto.cc": [
          "File: src/node_crypto.cc -> src/node_crypto.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "861:       Local<Value> argv[1] = {*p->servername_};",
          "862:       Local<Function> callback = *p->sniCallback_;",
          "876:       if (secure_context_constructor->HasInstance(ret)) {",
          "",
          "[Removed Lines]",
          "864:       TryCatch try_catch;",
          "867:       Local<Value> ret = callback->Call(Context::GetCurrent()->Global(),",
          "868:                                         1,",
          "869:                                         argv);",
          "871:       if (try_catch.HasCaught()) {",
          "872:         FatalException(try_catch);",
          "873:       }",
          "",
          "[Added Lines]",
          "865:       Local<Value> ret;",
          "866:       ret = Local<Value>::New(MakeCallback(Context::GetCurrent()->Global(),",
          "867:                                            callback, 1, argv));",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "4121:     argv[1] = Local<Value>::New(Undefined());",
          "4122:   }",
          "4131:   delete[] request->pass;",
          "4132:   delete[] request->salt;",
          "",
          "[Removed Lines]",
          "4124:   TryCatch try_catch;",
          "4126:   request->callback->Call(Context::GetCurrent()->Global(), 2, argv);",
          "4128:   if (try_catch.HasCaught())",
          "4129:     FatalException(try_catch);",
          "",
          "[Added Lines]",
          "4118:   MakeCallback(Context::GetCurrent()->Global(),",
          "4119:                request->callback,",
          "4120:                2, argv);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "4314:   Local<Value> argv[2];",
          "4315:   RandomBytesCheck(req, argv);",
          "4323:   delete req;",
          "4324: }",
          "",
          "[Removed Lines]",
          "4317:   TryCatch tc;",
          "4318:   req->callback_->Call(Context::GetCurrent()->Global(), 2, argv);",
          "4320:   if (tc.HasCaught())",
          "4321:     FatalException(tc);",
          "",
          "[Added Lines]",
          "4308:   MakeCallback(Context::GetCurrent()->Global(),",
          "4309:                req->callback_,",
          "4310:                2, argv);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "8966480c0e332ecea5c39d4e42e36fa400b0a629",
      "candidate_info": {
        "commit_hash": "8966480c0e332ecea5c39d4e42e36fa400b0a629",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/8966480c0e332ecea5c39d4e42e36fa400b0a629",
        "files": [
          "tools/installer.js"
        ],
        "message": "Revert \"build: fix `make install DESTDIR=/path`\"\n\nThis reverts commit f80513974ec525fe8e1a3aab7054af167d862d99.\n\nThe reverted commit made DESTDIR behave more like we want it to but it was\npointed out in #3489 that it makes life a lot harder for distro package\nmaintainers.\n\nThose guys and gals already have a hard enough time as it is, let's not make\ntheir jobs even more hellish.",
        "before_after_code_files": [
          "tools/installer.js||tools/installer.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "tools/installer.js||tools/installer.js": [
          "File: tools/installer.js -> tools/installer.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "13: var variables = process.config.variables,",
          "17: var queue = [],",
          "",
          "[Removed Lines]",
          "14:     node_prefix = dest_dir || variables.node_prefix || '/usr/local';",
          "",
          "[Added Lines]",
          "14:     node_prefix = variables.node_prefix || '/usr/local';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "27:     return;",
          "28:   }",
          "31:   var dir = dst.replace(/\\/[^\\/]*$/, '/');",
          "",
          "[Removed Lines]",
          "30:   dst = path.join(node_prefix, dst);",
          "",
          "[Added Lines]",
          "30:   dst = path.join(dest_dir, node_prefix, dst);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "44: function remove(files) {",
          "45:   files.forEach(function(file) {",
          "47:     queue.push('rm -rf ' + file);",
          "48:   });",
          "49: }",
          "",
          "[Removed Lines]",
          "46:     file = path.join(node_prefix, file);",
          "",
          "[Added Lines]",
          "46:     file = path.join(dest_dir, node_prefix, file);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "146:     if (!isSymlink) {",
          "147:       copy('deps/npm', 'lib/node_modules/npm');",
          "148:       queue.push('ln -sf ../lib/node_modules/npm/bin/npm-cli.js ' +",
          "150:       queue.push([shebang, '#!' + path.join(node_prefix, 'bin/node'),",
          "152:                            'lib/node_modules/npm/bin/npm-cli.js')]);",
          "153:     }",
          "154:   }",
          "",
          "[Removed Lines]",
          "149:                  path.join(node_prefix, 'bin/npm'));",
          "151:                  path.join(node_prefix,",
          "",
          "[Added Lines]",
          "149:                  path.join(dest_dir, node_prefix, 'bin/npm'));",
          "151:                  path.join(dest_dir, node_prefix,",
          "",
          "---------------"
        ]
      }
    }
  ]
}