{
  "cve_id": "CVE-2016-7151",
  "cve_desc": "Capstone 3.0.4 has an out-of-bounds vulnerability (SEGV caused by a read memory access) in X86_insn_reg_intel in arch/X86/X86Mapping.c.",
  "repo": "aquynh/capstone",
  "patch_hash": "87a25bb543c8e4c09b48d4b4a6c7db31ce58df06",
  "patch_info": {
    "commit_hash": "87a25bb543c8e4c09b48d4b4a6c7db31ce58df06",
    "repo": "aquynh/capstone",
    "commit_url": "https://github.com/aquynh/capstone/commit/87a25bb543c8e4c09b48d4b4a6c7db31ce58df06",
    "files": [
      "arch/X86/X86Mapping.c"
    ],
    "message": "x86: fast path checking for X86_insn_reg_intel()",
    "before_after_code_files": [
      "arch/X86/X86Mapping.c||arch/X86/X86Mapping.c"
    ]
  },
  "patch_diff": {
    "arch/X86/X86Mapping.c||arch/X86/X86Mapping.c": [
      "File: arch/X86/X86Mapping.c -> arch/X86/X86Mapping.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "2930:  return (l - r);",
      "2931: }",
      "2937: x86_reg X86_insn_reg_intel(unsigned int id, enum cs_ac_type *access)",
      "2938: {",
      "2939:  unsigned int first = 0;",
      "2940:  unsigned int last = ARR_SIZE(insn_regs_intel) - 1;",
      "2943:  if (!intel_regs_sorted) {",
      "2944:   memcpy(insn_regs_intel_sorted, insn_regs_intel,",
      "",
      "[Removed Lines]",
      "2933: static bool intel_regs_sorted = false;",
      "2941:  unsigned int mid = ARR_SIZE(insn_regs_intel) / 2;",
      "",
      "[Added Lines]",
      "2938:  static bool intel_regs_sorted = false;",
      "2941:  unsigned int mid;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "2949:   intel_regs_sorted = true;",
      "2950:  }",
      "2952:  while (first <= last) {",
      "2953:   if (insn_regs_intel_sorted[mid].insn < id) {",
      "2954:    first = mid + 1;",
      "2955:   } else if (insn_regs_intel_sorted[mid].insn == id) {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "2952:  if (insn_regs_intel_sorted[0].insn > id ||",
      "2953:    insn_regs_intel_sorted[last].insn < id) {",
      "2954:   return 0;",
      "2955:  }",
      "2958:   mid = (first + last) / 2;",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "2962:     break;",
      "2963:    last = mid - 1;",
      "2964:   }",
      "2966:  }",
      "",
      "[Removed Lines]",
      "2965:   mid = (first + last) / 2;",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "665d404b0df6491b29ed095dd8cf5f2e07665ac8",
      "candidate_info": {
        "commit_hash": "665d404b0df6491b29ed095dd8cf5f2e07665ac8",
        "repo": "aquynh/capstone",
        "commit_url": "https://github.com/aquynh/capstone/commit/665d404b0df6491b29ed095dd8cf5f2e07665ac8",
        "files": [
          "bindings/python/setup.py",
          "bindings/python/setup_cython.py"
        ],
        "message": "python: bump version to 3.0.5",
        "before_after_code_files": [
          "bindings/python/setup.py||bindings/python/setup.py",
          "bindings/python/setup_cython.py||bindings/python/setup_cython.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/NeatNerdPrime/capstone/pull/17"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "bindings/python/setup.py||bindings/python/setup.py": [
          "File: bindings/python/setup.py -> bindings/python/setup.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "14: from setuptools.command.bdist_egg import bdist_egg",
          "16: SYSTEM = sys.platform",
          "19: # adapted from commit e504b81 of Nguyen Tan Cong",
          "20: # Reference: https://docs.python.org/2/library/platform.html#cross-platform",
          "",
          "[Removed Lines]",
          "17: VERSION = '3.0.4'",
          "",
          "[Added Lines]",
          "17: VERSION = '3.0.5'",
          "",
          "---------------"
        ],
        "bindings/python/setup_cython.py||bindings/python/setup_cython.py": [
          "File: bindings/python/setup_cython.py -> bindings/python/setup_cython.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "11: SYSTEM = sys.platform",
          "14: # adapted from commit e504b81 of Nguyen Tan Cong",
          "15: # Reference: https://docs.python.org/2/library/platform.html#cross-platform",
          "",
          "[Removed Lines]",
          "12: VERSION = '3.0.4'",
          "",
          "[Added Lines]",
          "12: VERSION = '3.0.5'",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "e29ddbdbb332b3b08740eadee4424a3fc612311b",
      "candidate_info": {
        "commit_hash": "e29ddbdbb332b3b08740eadee4424a3fc612311b",
        "repo": "aquynh/capstone",
        "commit_url": "https://github.com/aquynh/capstone/commit/e29ddbdbb332b3b08740eadee4424a3fc612311b",
        "files": [
          "bindings/python/capstone/__init__.py"
        ],
        "message": "Python: Actually attempt to load .so.3 extension on linux",
        "before_after_code_files": [
          "bindings/python/capstone/__init__.py||bindings/python/capstone/__init__.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/NeatNerdPrime/capstone/pull/17"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "bindings/python/capstone/__init__.py||bindings/python/capstone/__init__.py": [
          "File: bindings/python/capstone/__init__.py -> bindings/python/capstone/__init__.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "211: else:",
          "212:     _lib = \"libcapstone.so\"",
          "215: _found = False",
          "217: def _load_lib(path):",
          "",
          "[Removed Lines]",
          "214: _all_libs = ['capstone.dll', 'libcapstone.so.3', 'libcapstone.so', 'libcapstone.dylib']",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "222:         # if we're on linux, try again with .so.3 extension",
          "223:         if lib_file.endswith('.so'):",
          "224:             try:",
          "226:             except OSError:",
          "227:                 return None",
          "228:         return None",
          "",
          "[Removed Lines]",
          "225:                 return ctypes.cdll.LoadLibrary(lib_file)",
          "",
          "[Added Lines]",
          "224:                 return ctypes.cdll.LoadLibrary(lib_file + '.3')",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "5664998f4ca2831e14bed47c7bffb46113cfadda",
      "candidate_info": {
        "commit_hash": "5664998f4ca2831e14bed47c7bffb46113cfadda",
        "repo": "aquynh/capstone",
        "commit_url": "https://github.com/aquynh/capstone/commit/5664998f4ca2831e14bed47c7bffb46113cfadda",
        "files": [
          "cstool/cstool.c"
        ],
        "message": "cstool: compile for next branch",
        "before_after_code_files": [
          "cstool/cstool.c||cstool/cstool.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/NeatNerdPrime/capstone/pull/17"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "cstool/cstool.c||cstool/cstool.c": [
          "File: cstool/cstool.c -> cstool/cstool.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: #include <ctype.h>",
          "6: #include <errno.h>",
          "10: #define VERSION \"1.0\"",
          "",
          "[Removed Lines]",
          "8: #include <capstone.h>",
          "",
          "[Added Lines]",
          "8: #include <capstone/capstone.h>",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "a2d62f92bfc214b4f8788239cb92f2ca8fc67da9",
      "candidate_info": {
        "commit_hash": "a2d62f92bfc214b4f8788239cb92f2ca8fc67da9",
        "repo": "aquynh/capstone",
        "commit_url": "https://github.com/aquynh/capstone/commit/a2d62f92bfc214b4f8788239cb92f2ca8fc67da9",
        "files": [
          "arch/X86/X86ATTInstPrinter.c"
        ],
        "message": "x86: fix sysexit in #806",
        "before_after_code_files": [
          "arch/X86/X86ATTInstPrinter.c||arch/X86/X86ATTInstPrinter.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/NeatNerdPrime/capstone/pull/17"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "arch/X86/X86ATTInstPrinter.c||arch/X86/X86ATTInstPrinter.c": [
          "File: arch/X86/X86ATTInstPrinter.c -> arch/X86/X86ATTInstPrinter.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "799:  else",
          "800:   printInstruction(MI, OS, info);",
          "802:  if (MI->has_imm) {",
          "804:   if (MI->flat_insn->detail->x86.op_count > 1) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "803:  switch(MI->flat_insn->id) {",
          "804:   default: break;",
          "805:   case X86_INS_SYSEXIT:",
          "806:      SStream_Init(OS);",
          "807:      SStream_concat0(OS, \"sysexit\");",
          "808:      break;",
          "809:  }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "eeceed2cbede6d37d1511e1d3b57676431b97364",
      "candidate_info": {
        "commit_hash": "eeceed2cbede6d37d1511e1d3b57676431b97364",
        "repo": "aquynh/capstone",
        "commit_url": "https://github.com/aquynh/capstone/commit/eeceed2cbede6d37d1511e1d3b57676431b97364",
        "files": [
          "arch/AArch64/AArch64GenAsmWriter.inc"
        ],
        "message": "Bug fix for incorrect operand type in certain load/store instructions on AArch64. (#952)",
        "before_after_code_files": [
          "arch/AArch64/AArch64GenAsmWriter.inc||arch/AArch64/AArch64GenAsmWriter.inc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/NeatNerdPrime/capstone/pull/17"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "arch/AArch64/AArch64GenAsmWriter.inc||arch/AArch64/AArch64GenAsmWriter.inc": [
          "File: arch/AArch64/AArch64GenAsmWriter.inc -> arch/AArch64/AArch64GenAsmWriter.inc",
          "--- Hunk 1 ---",
          "[Context before]",
          "12582:   if (*AsmOps) {",
          "12583:     SStream_concat0(OS, \"\\t\");",
          "12584:     for (c = AsmOps; *c; c++) {",
          "12586:         c += 1;",
          "12587:         if (*c == (char)0xff) {",
          "12588:           c += 1;",
          "",
          "[Removed Lines]",
          "12585:       if (*c == '$') {",
          "",
          "[Added Lines]",
          "12585:       if (*c == '[') {",
          "12586:         SStream_concat0(OS, \"[\");",
          "12587:         set_mem_access(MI, true);",
          "12588:       }",
          "12589:       else if (*c == ']') {",
          "12590:         SStream_concat0(OS, \"]\");",
          "12591:         set_mem_access(MI, false);",
          "12592:       }",
          "12593:       else if (*c == '$') {",
          "",
          "---------------"
        ]
      }
    }
  ]
}