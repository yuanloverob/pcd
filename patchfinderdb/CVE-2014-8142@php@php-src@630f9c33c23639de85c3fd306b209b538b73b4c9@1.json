{
  "cve_id": "CVE-2014-8142",
  "cve_desc": "Use-after-free vulnerability in the process_nested_data function in ext/standard/var_unserializer.re in PHP before 5.4.36, 5.5.x before 5.5.20, and 5.6.x before 5.6.4 allows remote attackers to execute arbitrary code via a crafted unserialize call that leverages improper handling of duplicate keys within the serialized properties of an object, a different vulnerability than CVE-2004-1019.",
  "repo": "php/php-src",
  "patch_hash": "630f9c33c23639de85c3fd306b209b538b73b4c9",
  "patch_info": {
    "commit_hash": "630f9c33c23639de85c3fd306b209b538b73b4c9",
    "repo": "php/php-src",
    "commit_url": "https://github.com/php/php-src/commit/630f9c33c23639de85c3fd306b209b538b73b4c9",
    "files": [
      "NEWS",
      "ext/standard/tests/serialize/bug68594.phpt",
      "ext/standard/var_unserializer.c",
      "ext/standard/var_unserializer.re"
    ],
    "message": "Fix bug #68594 - Use after free vulnerability in unserialize()",
    "before_after_code_files": [
      "ext/standard/tests/serialize/bug68594.phpt||ext/standard/tests/serialize/bug68594.phpt",
      "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
      "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
    ]
  },
  "patch_diff": {
    "ext/standard/tests/serialize/bug68594.phpt||ext/standard/tests/serialize/bug68594.phpt": [
      "File: ext/standard/tests/serialize/bug68594.phpt -> ext/standard/tests/serialize/bug68594.phpt",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: --TEST--",
      "2: Bug #68545 Use after free vulnerability in unserialize()",
      "3: --FILE--",
      "4: <?php",
      "5: for ($i=4; $i<100; $i++) {",
      "6:  $m = new StdClass();",
      "8:  $u = array(1);",
      "10:  $m->aaa = array(1,2,&$u,4,5);",
      "11:  $m->bbb = 1;",
      "12:  $m->ccc = &$u;",
      "13:  $m->ddd = str_repeat(\"A\", $i);",
      "15:  $z = serialize($m);",
      "16:  $z = str_replace(\"bbb\", \"aaa\", $z);",
      "17:  $y = unserialize($z);",
      "18:  $z = serialize($y);",
      "19: }",
      "20: ?>",
      "21: ===DONE===",
      "22: --EXPECTF--",
      "23: ===DONE===",
      "",
      "---------------"
    ],
    "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
      "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "343:   } else {",
      "345:    convert_to_string(key);",
      "346:    zend_hash_update(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, &data,",
      "347:      sizeof data, NULL);",
      "348:   }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "346:    if (zend_symtable_find(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, (void **)&old_data)==SUCCESS) {",
      "347:     var_push_dtor(var_hash, old_data);",
      "348:    }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "484: {",
      "485:  YYCTYPE yych;",
      "486:  static const unsigned char yybm[] = {",
      "",
      "[Removed Lines]",
      "483: #line 484 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "486: #line 487 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "540:  yych = *(YYMARKER = ++YYCURSOR);",
      "541:  if (yych == ':') goto yy95;",
      "542: yy3:",
      "544:  { return 0; }",
      "546: yy4:",
      "547:  yych = *(YYMARKER = ++YYCURSOR);",
      "548:  if (yych == ':') goto yy89;",
      "",
      "[Removed Lines]",
      "543: #line 835 \"ext/standard/var_unserializer.re\"",
      "545: #line 546 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "546: #line 838 \"ext/standard/var_unserializer.re\"",
      "548: #line 549 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "585:  goto yy3;",
      "586: yy14:",
      "587:  ++YYCURSOR;",
      "589:  {",
      "591:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
      "593: }",
      "595: yy16:",
      "596:  yych = *++YYCURSOR;",
      "597:  goto yy3;",
      "",
      "[Removed Lines]",
      "588: #line 829 \"ext/standard/var_unserializer.re\"",
      "594: #line 595 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "591: #line 832 \"ext/standard/var_unserializer.re\"",
      "597: #line 598 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "617:  if (yybm[0+yych] & 128) {",
      "618:   goto yy20;",
      "619:  }",
      "621:  yych = *++YYCURSOR;",
      "622:  if (yych != '\"') goto yy18;",
      "623:  ++YYCURSOR;",
      "625:  {",
      "626:  size_t len, len2, len3, maxlen;",
      "627:  long elements;",
      "",
      "[Removed Lines]",
      "620:  if (yych != ':') goto yy18;",
      "624: #line 683 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "623:  if (yych <= '/') goto yy18;",
      "624:  if (yych >= ';') goto yy18;",
      "628: #line 686 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "768:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
      "769: }",
      "771: yy25:",
      "772:  yych = *++YYCURSOR;",
      "773:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "770: #line 771 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "774: #line 775 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "792:  yych = *++YYCURSOR;",
      "793:  if (yych != '\"') goto yy18;",
      "794:  ++YYCURSOR;",
      "796:  {",
      "798:  INIT_PZVAL(*rval);",
      "",
      "[Removed Lines]",
      "795: #line 675 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "799: #line 678 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 8 ---",
      "[Context before]",
      "800:  return object_common2(UNSERIALIZE_PASSTHRU,",
      "801:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
      "802: }",
      "804: yy32:",
      "805:  yych = *++YYCURSOR;",
      "806:  if (yych == '+') goto yy33;",
      "",
      "[Removed Lines]",
      "803: #line 804 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "807: #line 808 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 9 ---",
      "[Context before]",
      "821:  yych = *++YYCURSOR;",
      "822:  if (yych != '{') goto yy18;",
      "823:  ++YYCURSOR;",
      "825:  {",
      "826:  long elements = parse_iv(start + 2);",
      "",
      "[Removed Lines]",
      "824: #line 655 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "828: #line 658 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 10 ---",
      "[Context before]",
      "842:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
      "843: }",
      "845: yy39:",
      "846:  yych = *++YYCURSOR;",
      "847:  if (yych == '+') goto yy40;",
      "",
      "[Removed Lines]",
      "844: #line 845 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "848: #line 849 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 11 ---",
      "[Context before]",
      "862:  yych = *++YYCURSOR;",
      "863:  if (yych != '\"') goto yy18;",
      "864:  ++YYCURSOR;",
      "866:  {",
      "867:  size_t len, maxlen;",
      "868:  char *str;",
      "",
      "[Removed Lines]",
      "865: #line 626 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "869: #line 629 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 12 ---",
      "[Context before]",
      "891:  ZVAL_STRINGL(*rval, str, len, 0);",
      "892:  return 1;",
      "893: }",
      "895: yy46:",
      "896:  yych = *++YYCURSOR;",
      "897:  if (yych == '+') goto yy47;",
      "",
      "[Removed Lines]",
      "894: #line 895 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "898: #line 899 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 13 ---",
      "[Context before]",
      "912:  yych = *++YYCURSOR;",
      "913:  if (yych != '\"') goto yy18;",
      "914:  ++YYCURSOR;",
      "916:  {",
      "917:  size_t len, maxlen;",
      "918:  char *str;",
      "",
      "[Removed Lines]",
      "915: #line 598 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "919: #line 601 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 14 ---",
      "[Context before]",
      "940:  ZVAL_STRINGL(*rval, str, len, 1);",
      "941:  return 1;",
      "942: }",
      "944: yy53:",
      "945:  yych = *++YYCURSOR;",
      "946:  if (yych <= '/') {",
      "",
      "[Removed Lines]",
      "943: #line 944 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "947: #line 948 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 15 ---",
      "[Context before]",
      "1028:  }",
      "1029: yy63:",
      "1030:  ++YYCURSOR;",
      "1032:  {",
      "1033: #if SIZEOF_LONG == 4",
      "1034: use_double:",
      "",
      "[Removed Lines]",
      "1031: #line 588 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1035: #line 591 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 16 ---",
      "[Context before]",
      "1038:  ZVAL_DOUBLE(*rval, zend_strtod((const char *)start + 2, NULL));",
      "1039:  return 1;",
      "1040: }",
      "1042: yy65:",
      "1043:  yych = *++YYCURSOR;",
      "1044:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1041: #line 1042 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1045: #line 1046 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 17 ---",
      "[Context before]",
      "1097:  yych = *++YYCURSOR;",
      "1098:  if (yych != ';') goto yy18;",
      "1099:  ++YYCURSOR;",
      "1101:  {",
      "1103:  INIT_PZVAL(*rval);",
      "",
      "[Removed Lines]",
      "1100: #line 573 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1104: #line 576 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 18 ---",
      "[Context before]",
      "1113:  return 1;",
      "1114: }",
      "1116: yy76:",
      "1117:  yych = *++YYCURSOR;",
      "1118:  if (yych == 'N') goto yy73;",
      "",
      "[Removed Lines]",
      "1115: #line 1116 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1119: #line 1120 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 19 ---",
      "[Context before]",
      "1139:  if (yych <= '9') goto yy79;",
      "1140:  if (yych != ';') goto yy18;",
      "1141:  ++YYCURSOR;",
      "1143:  {",
      "1144: #if SIZEOF_LONG == 4",
      "1145:  int digits = YYCURSOR - start - 3;",
      "",
      "[Removed Lines]",
      "1142: #line 546 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1146: #line 549 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 20 ---",
      "[Context before]",
      "1166:  ZVAL_LONG(*rval, parse_iv(start + 2));",
      "1167:  return 1;",
      "1168: }",
      "1170: yy83:",
      "1171:  yych = *++YYCURSOR;",
      "1172:  if (yych <= '/') goto yy18;",
      "",
      "[Removed Lines]",
      "1169: #line 1170 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1173: #line 1174 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 21 ---",
      "[Context before]",
      "1174:  yych = *++YYCURSOR;",
      "1175:  if (yych != ';') goto yy18;",
      "1176:  ++YYCURSOR;",
      "1178:  {",
      "1180:  INIT_PZVAL(*rval);",
      "1181:  ZVAL_BOOL(*rval, parse_iv(start + 2));",
      "1182:  return 1;",
      "1183: }",
      "1185: yy87:",
      "1186:  ++YYCURSOR;",
      "1188:  {",
      "1190:  INIT_PZVAL(*rval);",
      "1191:  ZVAL_NULL(*rval);",
      "1192:  return 1;",
      "1193: }",
      "1195: yy89:",
      "1196:  yych = *++YYCURSOR;",
      "1197:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1177: #line 539 \"ext/standard/var_unserializer.re\"",
      "1184: #line 1185 \"ext/standard/var_unserializer.c\"",
      "1187: #line 532 \"ext/standard/var_unserializer.re\"",
      "1194: #line 1195 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1181: #line 542 \"ext/standard/var_unserializer.re\"",
      "1188: #line 1189 \"ext/standard/var_unserializer.c\"",
      "1191: #line 535 \"ext/standard/var_unserializer.re\"",
      "1198: #line 1199 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 22 ---",
      "[Context before]",
      "1214:  if (yych <= '9') goto yy91;",
      "1215:  if (yych != ';') goto yy18;",
      "1216:  ++YYCURSOR;",
      "1218:  {",
      "1219:  long id;",
      "",
      "[Removed Lines]",
      "1217: #line 509 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1221: #line 512 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 23 ---",
      "[Context before]",
      "1238:  return 1;",
      "1239: }",
      "1241: yy95:",
      "1242:  yych = *++YYCURSOR;",
      "1243:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1240: #line 1241 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1244: #line 1245 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 24 ---",
      "[Context before]",
      "1260:  if (yych <= '9') goto yy97;",
      "1261:  if (yych != ';') goto yy18;",
      "1262:  ++YYCURSOR;",
      "1264:  {",
      "1265:  long id;",
      "",
      "[Removed Lines]",
      "1263: #line 488 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1267: #line 491 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 25 ---",
      "[Context before]",
      "1282:  return 1;",
      "1283: }",
      "1285: }",
      "1289:  return 0;",
      "",
      "[Removed Lines]",
      "1284: #line 1285 \"ext/standard/var_unserializer.c\"",
      "1286: #line 837 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1288: #line 1289 \"ext/standard/var_unserializer.c\"",
      "1290: #line 840 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------"
    ],
    "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
      "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
      "--- Hunk 1 ---",
      "[Context before]",
      "347:   } else {",
      "349:    convert_to_string(key);",
      "350:    zend_hash_update(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, &data,",
      "351:      sizeof data, NULL);",
      "352:   }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "350:    if (zend_symtable_find(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, (void **)&old_data)==SUCCESS) {",
      "351:     var_push_dtor(var_hash, old_data);",
      "352:    }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "8fe171a3e046717ec0109297bcd765bdee3e939c",
      "candidate_info": {
        "commit_hash": "8fe171a3e046717ec0109297bcd765bdee3e939c",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/8fe171a3e046717ec0109297bcd765bdee3e939c",
        "files": [
          "ext/standard/array.c",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Don't allocate memory for empty HashTables.",
        "before_after_code_files": [
          "ext/standard/array.c||ext/standard/array.c",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/array.c||ext/standard/array.c": [
          "File: ext/standard/array.c -> ext/standard/array.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "3308:   }",
          "3309:  } else {",
          "3310:   array_init_size(return_value, zend_hash_num_elements(Z_ARRVAL_P(input)));",
          "3311:   zend_hash_real_init(Z_ARRVAL_P(return_value), 1);",
          "3312:   ZEND_HASH_FILL_PACKED(Z_ARRVAL_P(return_value)) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3311:   if (!zend_hash_num_elements(Z_ARRVAL_P(input))) {",
          "3312:    return;",
          "3313:   }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "3345:  array_init_size(return_value, zend_hash_num_elements(Z_ARRVAL_P(input)));",
          "3346:  zend_hash_real_init(Z_ARRVAL_P(return_value), 1);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3350:  if (!zend_hash_num_elements(Z_ARRVAL_P(input))) {",
          "3351:   return;",
          "3352:  }",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "599:  yych = *(YYMARKER = ++YYCURSOR);",
          "600:  if (yych == ':') goto yy95;",
          "601: yy3:",
          "603:  { return 0; }",
          "604: #line 605 \"ext/standard/var_unserializer.c\"",
          "605: yy4:",
          "",
          "[Removed Lines]",
          "602: #line 893 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "602: #line 895 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "644:  goto yy3;",
          "645: yy14:",
          "646:  ++YYCURSOR;",
          "648:  {",
          "650:  php_error_docref(NULL, E_NOTICE, \"Unexpected end of serialized data\");",
          "",
          "[Removed Lines]",
          "647: #line 887 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "647: #line 889 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "676:  if (yybm[0+yych] & 128) {",
          "677:   goto yy20;",
          "678:  }",
          "681:  yych = *++YYCURSOR;",
          "682:  if (yych != '\"') goto yy18;",
          "683:  ++YYCURSOR;",
          "685:  {",
          "686:  size_t len, len2, len3, maxlen;",
          "687:  zend_long elements;",
          "",
          "[Removed Lines]",
          "679:  if (yych <= '/') goto yy18;",
          "680:  if (yych >= ';') goto yy18;",
          "684: #line 741 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "679:  if (yych != ':') goto yy18;",
          "683: #line 743 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "828:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "829: }",
          "831: yy25:",
          "832:  yych = *++YYCURSOR;",
          "833:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "830: #line 831 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "829: #line 830 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "852:  yych = *++YYCURSOR;",
          "853:  if (yych != '\"') goto yy18;",
          "854:  ++YYCURSOR;",
          "856:  {",
          "857:     if (!var_hash) return 0;",
          "",
          "[Removed Lines]",
          "855: #line 732 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "854: #line 734 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "861:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "862:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "863: }",
          "865: yy32:",
          "866:  yych = *++YYCURSOR;",
          "867:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "864: #line 865 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "863: #line 864 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "896:  array_init_size(rval, elements);",
          "901:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_ARRVAL_P(rval), elements, 0)) {",
          "902:   return 0;",
          "",
          "[Removed Lines]",
          "899:  zend_hash_real_init(Z_ARRVAL_P(rval), 0);",
          "",
          "[Added Lines]",
          "898:  if (elements) {",
          "899:   zend_hash_real_init(Z_ARRVAL_P(rval), 0);",
          "900:  }",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "905:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "906: }",
          "908: yy39:",
          "909:  yych = *++YYCURSOR;",
          "910:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "907: #line 908 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "908: #line 909 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "953:  ZVAL_STR(rval, str);",
          "954:  return 1;",
          "955: }",
          "957: yy46:",
          "958:  yych = *++YYCURSOR;",
          "959:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "956: #line 957 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "957: #line 958 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "1001:  ZVAL_STRINGL(rval, str, len);",
          "1002:  return 1;",
          "1003: }",
          "1005: yy53:",
          "1006:  yych = *++YYCURSOR;",
          "1007:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "1004: #line 1005 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1005: #line 1006 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "1098:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1099:  return 1;",
          "1100: }",
          "1102: yy65:",
          "1103:  yych = *++YYCURSOR;",
          "1104:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1101: #line 1102 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1102: #line 1103 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "1174:  return 1;",
          "1175: }",
          "1177: yy76:",
          "1178:  yych = *++YYCURSOR;",
          "1179:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1176: #line 1177 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1177: #line 1178 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "1226:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1227:  return 1;",
          "1228: }",
          "1230: yy83:",
          "1231:  yych = *++YYCURSOR;",
          "1232:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1229: #line 1230 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1230: #line 1231 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "1240:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1241:  return 1;",
          "1242: }",
          "1244: yy87:",
          "1245:  ++YYCURSOR;",
          "1246: #line 592 \"ext/standard/var_unserializer.re\"",
          "",
          "[Removed Lines]",
          "1243: #line 1244 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1244: #line 1245 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1249:  ZVAL_NULL(rval);",
          "1250:  return 1;",
          "1251: }",
          "1253: yy89:",
          "1254:  yych = *++YYCURSOR;",
          "1255:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1252: #line 1253 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1253: #line 1254 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1296:  return 1;",
          "1297: }",
          "1299: yy95:",
          "1300:  yych = *++YYCURSOR;",
          "1301:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1298: #line 1299 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1299: #line 1300 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1341:  return 1;",
          "1342: }",
          "1344: }",
          "1348:  return 0;",
          "",
          "[Removed Lines]",
          "1343: #line 1344 \"ext/standard/var_unserializer.c\"",
          "1345: #line 895 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1344: #line 1345 \"ext/standard/var_unserializer.c\"",
          "1346: #line 897 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "720:  array_init_size(rval, elements);",
          "725:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_ARRVAL_P(rval), elements, 0)) {",
          "726:   return 0;",
          "",
          "[Removed Lines]",
          "723:  zend_hash_real_init(Z_ARRVAL_P(rval), 0);",
          "",
          "[Added Lines]",
          "723:  if (elements) {",
          "724:   zend_hash_real_init(Z_ARRVAL_P(rval), 0);",
          "725:  }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "6fc358241b84866e8f688055d577ba2fcaf2bbd3",
      "candidate_info": {
        "commit_hash": "6fc358241b84866e8f688055d577ba2fcaf2bbd3",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/6fc358241b84866e8f688055d577ba2fcaf2bbd3",
        "files": [
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Use specialized efree_size()",
        "before_after_code_files": [
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "178:  while (var_hash) {",
          "179:   next = var_hash->next;",
          "181:   var_hash = next;",
          "182:  }",
          "",
          "[Removed Lines]",
          "180:   efree(var_hash);",
          "",
          "[Added Lines]",
          "180:   efree_size(var_hash, sizeof(var_entries));",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "186:    zval_ptr_dtor(&var_dtor_hash->data[i]);",
          "187:   }",
          "188:   next = var_dtor_hash->next;",
          "190:   var_dtor_hash = next;",
          "191:  }",
          "192: }",
          "",
          "[Removed Lines]",
          "189:   efree(var_dtor_hash);",
          "",
          "[Added Lines]",
          "189:   efree_size(var_dtor_hash, sizeof(var_dtor_entries));",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "665:  if (yybm[0+yych] & 128) {",
          "666:   goto yy20;",
          "667:  }",
          "670:  yych = *++YYCURSOR;",
          "671:  if (yych != '\"') goto yy18;",
          "672:  ++YYCURSOR;",
          "",
          "[Removed Lines]",
          "668:  if (yych <= '/') goto yy18;",
          "669:  if (yych >= ';') goto yy18;",
          "",
          "[Added Lines]",
          "668:  if (yych != ':') goto yy18;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "816:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "817: }",
          "819: yy25:",
          "820:  yych = *++YYCURSOR;",
          "821:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "818: #line 819 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "817: #line 818 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "848:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "849:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "850: }",
          "852: yy32:",
          "853:  yych = *++YYCURSOR;",
          "854:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "851: #line 852 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "850: #line 851 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "891:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "892: }",
          "894: yy39:",
          "895:  yych = *++YYCURSOR;",
          "896:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "893: #line 894 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "892: #line 893 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "939:  ZVAL_STR(rval, str);",
          "940:  return 1;",
          "941: }",
          "943: yy46:",
          "944:  yych = *++YYCURSOR;",
          "945:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "942: #line 943 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "941: #line 942 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "987:  ZVAL_STRINGL(rval, str, len);",
          "988:  return 1;",
          "989: }",
          "991: yy53:",
          "992:  yych = *++YYCURSOR;",
          "993:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "990: #line 991 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "989: #line 990 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "1084:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1085:  return 1;",
          "1086: }",
          "1088: yy65:",
          "1089:  yych = *++YYCURSOR;",
          "1090:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1087: #line 1088 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1086: #line 1087 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "1160:  return 1;",
          "1161: }",
          "1163: yy76:",
          "1164:  yych = *++YYCURSOR;",
          "1165:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1162: #line 1163 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1161: #line 1162 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "1212:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1213:  return 1;",
          "1214: }",
          "1216: yy83:",
          "1217:  yych = *++YYCURSOR;",
          "1218:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1215: #line 1216 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1214: #line 1215 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "1226:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1227:  return 1;",
          "1228: }",
          "1230: yy87:",
          "1231:  ++YYCURSOR;",
          "1232: #line 581 \"ext/standard/var_unserializer.re\"",
          "",
          "[Removed Lines]",
          "1229: #line 1230 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1228: #line 1229 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "1235:  ZVAL_NULL(rval);",
          "1236:  return 1;",
          "1237: }",
          "1239: yy89:",
          "1240:  yych = *++YYCURSOR;",
          "1241:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1238: #line 1239 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1237: #line 1238 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "1282:  return 1;",
          "1283: }",
          "1285: yy95:",
          "1286:  yych = *++YYCURSOR;",
          "1287:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1284: #line 1285 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1283: #line 1284 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1327:  return 1;",
          "1328: }",
          "1330: }",
          "1331: #line 881 \"ext/standard/var_unserializer.re\"",
          "",
          "[Removed Lines]",
          "1329: #line 1330 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1328: #line 1329 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "176:  while (var_hash) {",
          "177:   next = var_hash->next;",
          "179:   var_hash = next;",
          "180:  }",
          "",
          "[Removed Lines]",
          "178:   efree(var_hash);",
          "",
          "[Added Lines]",
          "178:   efree_size(var_hash, sizeof(var_entries));",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "184:    zval_ptr_dtor(&var_dtor_hash->data[i]);",
          "185:   }",
          "186:   next = var_dtor_hash->next;",
          "188:   var_dtor_hash = next;",
          "189:  }",
          "190: }",
          "",
          "[Removed Lines]",
          "187:   efree(var_dtor_hash);",
          "",
          "[Added Lines]",
          "187:   efree_size(var_dtor_hash, sizeof(var_dtor_entries));",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "b690be4d22c9651dd99ead087d3b808f12fa68fb",
      "candidate_info": {
        "commit_hash": "b690be4d22c9651dd99ead087d3b808f12fa68fb",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/b690be4d22c9651dd99ead087d3b808f12fa68fb",
        "files": [
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Fixed bug #68976 - Use After Free Vulnerability in unserialize()\n\nConflicts:\n\text/standard/var_unserializer.c",
        "before_after_code_files": [
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "348:    zend_hash_update(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, &data,",
          "349:      sizeof data, NULL);",
          "350:   }",
          "352:   zval_dtor(key);",
          "353:   FREE_ZVAL(key);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "351:   var_push_dtor(var_hash, &data);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "486: {",
          "487:  YYCTYPE yych;",
          "488:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "485: #line 486 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "486: #line 487 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "542:  yych = *(YYMARKER = ++YYCURSOR);",
          "543:  if (yych == ':') goto yy95;",
          "544: yy3:",
          "546:  { return 0; }",
          "548: yy4:",
          "549:  yych = *(YYMARKER = ++YYCURSOR);",
          "550:  if (yych == ':') goto yy89;",
          "",
          "[Removed Lines]",
          "545: #line 837 \"ext/standard/var_unserializer.re\"",
          "547: #line 548 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "546: #line 838 \"ext/standard/var_unserializer.re\"",
          "548: #line 549 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "587:  goto yy3;",
          "588: yy14:",
          "589:  ++YYCURSOR;",
          "591:  {",
          "593:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
          "595: }",
          "597: yy16:",
          "598:  yych = *++YYCURSOR;",
          "599:  goto yy3;",
          "",
          "[Removed Lines]",
          "590: #line 831 \"ext/standard/var_unserializer.re\"",
          "596: #line 597 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "591: #line 832 \"ext/standard/var_unserializer.re\"",
          "597: #line 598 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "623:  yych = *++YYCURSOR;",
          "624:  if (yych != '\"') goto yy18;",
          "625:  ++YYCURSOR;",
          "627:  {",
          "628:  size_t len, len2, len3, maxlen;",
          "629:  long elements;",
          "",
          "[Removed Lines]",
          "626: #line 685 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "627: #line 686 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "770:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "771: }",
          "773: yy25:",
          "774:  yych = *++YYCURSOR;",
          "775:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "772: #line 773 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "773: #line 774 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "794:  yych = *++YYCURSOR;",
          "795:  if (yych != '\"') goto yy18;",
          "796:  ++YYCURSOR;",
          "798:  {",
          "800:  INIT_PZVAL(*rval);",
          "",
          "[Removed Lines]",
          "797: #line 677 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "798: #line 678 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "802:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "803:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "804: }",
          "806: yy32:",
          "807:  yych = *++YYCURSOR;",
          "808:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "805: #line 806 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "806: #line 807 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "823:  yych = *++YYCURSOR;",
          "824:  if (yych != '{') goto yy18;",
          "825:  ++YYCURSOR;",
          "827:  {",
          "828:  long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "826: #line 657 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "827: #line 658 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "844:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "845: }",
          "847: yy39:",
          "848:  yych = *++YYCURSOR;",
          "849:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "846: #line 847 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "847: #line 848 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "864:  yych = *++YYCURSOR;",
          "865:  if (yych != '\"') goto yy18;",
          "866:  ++YYCURSOR;",
          "868:  {",
          "869:  size_t len, maxlen;",
          "870:  char *str;",
          "",
          "[Removed Lines]",
          "867: #line 628 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "868: #line 629 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "893:  ZVAL_STRINGL(*rval, str, len, 0);",
          "894:  return 1;",
          "895: }",
          "897: yy46:",
          "898:  yych = *++YYCURSOR;",
          "899:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "896: #line 897 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "897: #line 898 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "914:  yych = *++YYCURSOR;",
          "915:  if (yych != '\"') goto yy18;",
          "916:  ++YYCURSOR;",
          "918:  {",
          "919:  size_t len, maxlen;",
          "920:  char *str;",
          "",
          "[Removed Lines]",
          "917: #line 600 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "918: #line 601 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "942:  ZVAL_STRINGL(*rval, str, len, 1);",
          "943:  return 1;",
          "944: }",
          "946: yy53:",
          "947:  yych = *++YYCURSOR;",
          "948:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "945: #line 946 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "946: #line 947 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1030:  }",
          "1031: yy63:",
          "1032:  ++YYCURSOR;",
          "1034:  {",
          "1035: #if SIZEOF_LONG == 4",
          "1036: use_double:",
          "",
          "[Removed Lines]",
          "1033: #line 590 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1034: #line 591 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1040:  ZVAL_DOUBLE(*rval, zend_strtod((const char *)start + 2, NULL));",
          "1041:  return 1;",
          "1042: }",
          "1044: yy65:",
          "1045:  yych = *++YYCURSOR;",
          "1046:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1043: #line 1044 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1044: #line 1045 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1099:  yych = *++YYCURSOR;",
          "1100:  if (yych != ';') goto yy18;",
          "1101:  ++YYCURSOR;",
          "1103:  {",
          "1105:  INIT_PZVAL(*rval);",
          "",
          "[Removed Lines]",
          "1102: #line 575 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1103: #line 576 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "1115:  return 1;",
          "1116: }",
          "1118: yy76:",
          "1119:  yych = *++YYCURSOR;",
          "1120:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1117: #line 1118 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1118: #line 1119 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1141:  if (yych <= '9') goto yy79;",
          "1142:  if (yych != ';') goto yy18;",
          "1143:  ++YYCURSOR;",
          "1145:  {",
          "1146: #if SIZEOF_LONG == 4",
          "1147:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1144: #line 548 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1145: #line 549 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1168:  ZVAL_LONG(*rval, parse_iv(start + 2));",
          "1169:  return 1;",
          "1170: }",
          "1172: yy83:",
          "1173:  yych = *++YYCURSOR;",
          "1174:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1171: #line 1172 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1172: #line 1173 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "1176:  yych = *++YYCURSOR;",
          "1177:  if (yych != ';') goto yy18;",
          "1178:  ++YYCURSOR;",
          "1180:  {",
          "1182:  INIT_PZVAL(*rval);",
          "1183:  ZVAL_BOOL(*rval, parse_iv(start + 2));",
          "1184:  return 1;",
          "1185: }",
          "1187: yy87:",
          "1188:  ++YYCURSOR;",
          "1190:  {",
          "1192:  INIT_PZVAL(*rval);",
          "1193:  ZVAL_NULL(*rval);",
          "1194:  return 1;",
          "1195: }",
          "1197: yy89:",
          "1198:  yych = *++YYCURSOR;",
          "1199:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1179: #line 541 \"ext/standard/var_unserializer.re\"",
          "1186: #line 1187 \"ext/standard/var_unserializer.c\"",
          "1189: #line 534 \"ext/standard/var_unserializer.re\"",
          "1196: #line 1197 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1180: #line 542 \"ext/standard/var_unserializer.re\"",
          "1187: #line 1188 \"ext/standard/var_unserializer.c\"",
          "1190: #line 535 \"ext/standard/var_unserializer.re\"",
          "1197: #line 1198 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "1216:  if (yych <= '9') goto yy91;",
          "1217:  if (yych != ';') goto yy18;",
          "1218:  ++YYCURSOR;",
          "1220:  {",
          "1221:  long id;",
          "",
          "[Removed Lines]",
          "1219: #line 511 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1220: #line 512 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "1240:  return 1;",
          "1241: }",
          "1243: yy95:",
          "1244:  yych = *++YYCURSOR;",
          "1245:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1242: #line 1243 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1243: #line 1244 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "1262:  if (yych <= '9') goto yy97;",
          "1263:  if (yych != ';') goto yy18;",
          "1264:  ++YYCURSOR;",
          "1266:  {",
          "1267:  long id;",
          "",
          "[Removed Lines]",
          "1265: #line 490 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1266: #line 491 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 25 ---",
          "[Context before]",
          "1284:  return 1;",
          "1285: }",
          "1287: }",
          "1291:  return 0;",
          "",
          "[Removed Lines]",
          "1286: #line 1287 \"ext/standard/var_unserializer.c\"",
          "1288: #line 839 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1287: #line 1288 \"ext/standard/var_unserializer.c\"",
          "1289: #line 840 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "352:    zend_hash_update(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, &data,",
          "353:      sizeof data, NULL);",
          "354:   }",
          "356:   zval_dtor(key);",
          "357:   FREE_ZVAL(key);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "355:   var_push_dtor(var_hash, &data);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "be54eb7db10c6aa838cef969822a5ae0f4e605e3",
      "candidate_info": {
        "commit_hash": "be54eb7db10c6aa838cef969822a5ae0f4e605e3",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/be54eb7db10c6aa838cef969822a5ae0f4e605e3",
        "files": [
          "NEWS",
          "Zend/zend_hash.c",
          "Zend/zend_hash.h",
          "ext/soap/tests/bug70211.phpt",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Fixed bug #70211 (php 7 ZEND_HASH_IF_FULL_DO_RESIZE use after free)",
        "before_after_code_files": [
          "Zend/zend_hash.c||Zend/zend_hash.c",
          "Zend/zend_hash.h||Zend/zend_hash.h",
          "ext/soap/tests/bug70211.phpt||ext/soap/tests/bug70211.phpt",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "Zend/zend_hash.c||Zend/zend_hash.c": [
          "File: Zend/zend_hash.c -> Zend/zend_hash.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "807:  }",
          "808: }",
          "810: ZEND_API int ZEND_FASTCALL zend_hash_rehash(HashTable *ht)",
          "811: {",
          "812:  Bucket *p;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "810: ZEND_API int ZEND_FASTCALL zend_hash_resize(HashTable *ht, uint32_t size) {",
          "811:  void *old_data = HT_GET_DATA_ADDR(ht);",
          "812:  Bucket *old_buckets = ht->arData;",
          "814:  HANDLE_BLOCK_INTERRUPTIONS();",
          "815:  ht->nTableSize = zend_hash_check_size(size);",
          "816:  ht->nTableMask = -ht->nTableSize;",
          "817:  HT_SET_DATA_ADDR(ht, pemalloc(HT_SIZE(ht), ht->u.flags & HASH_FLAG_PERSISTENT));",
          "818:  memcpy(ht->arData, old_buckets, sizeof(Bucket) * ht->nNumUsed);",
          "819:  pefree(old_data, ht->u.flags & HASH_FLAG_PERSISTENT);",
          "820:  zend_hash_rehash(ht);",
          "821:  HANDLE_UNBLOCK_INTERRUPTIONS();",
          "822: }",
          "",
          "---------------"
        ],
        "Zend/zend_hash.h||Zend/zend_hash.h": [
          "File: Zend/zend_hash.h -> Zend/zend_hash.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "212: #define zend_hash_next_free_element(ht) \\",
          "213:  (ht)->nNextFreeElement",
          "215: ZEND_API int ZEND_FASTCALL zend_hash_rehash(HashTable *ht);",
          "217: ZEND_API HashTable* ZEND_FASTCALL zend_array_dup(HashTable *source);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "215: ZEND_API int ZEND_FASTCALL zend_hash_resize(HashTable *ht, uint32_t size);",
          "",
          "---------------"
        ],
        "ext/soap/tests/bug70211.phpt||ext/soap/tests/bug70211.phpt": [
          "File: ext/soap/tests/bug70211.phpt -> ext/soap/tests/bug70211.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #70211 (php 7 ZEND_HASH_IF_FULL_DO_RESIZE use after free)",
          "3: --FILE--",
          "4: <?php",
          "6: $addr = 0x4141414141414141;",
          "8: function ptr2str($ptr)",
          "9: {",
          "10:     $out = \"\";",
          "11:     for ($i=0; $i<8; $i++) {",
          "12:         $out .= chr($ptr & 0xff);",
          "13:         $ptr >>= 8;",
          "14:     }",
          "15:     return $out;",
          "16: }",
          "18: $sf = new SoapFault('1', 'string', 'detail', 'header','line', str_repeat(\"A\",232).ptr2str($addr));",
          "19: $ob = unserialize(\"a:3:{i:0;\".serialize($sf).'i:1;r:12;i:2;r:10;}');",
          "21: var_dump($ob[1]);",
          "22: ?>",
          "23: --EXPECT--",
          "24: string(6) \"detail\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "470: {",
          "471:  zval retval;",
          "472:  zval fname;",
          "474:  if (Z_TYPE_P(rval) != IS_OBJECT) {",
          "475:   return 0;",
          "476:  }",
          "480:   return 0;",
          "481:  }",
          "",
          "[Removed Lines]",
          "479:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_OBJPROP_P(rval), elements, 1)) {",
          "",
          "[Added Lines]",
          "473:  HashTable *ht = Z_OBJPROP_P(rval);",
          "479:  zend_hash_resize(ht, zend_hash_num_elements(ht) + elements);",
          "480:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, ht, elements, 1)) {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "528:  start = cursor;",
          "532: {",
          "533:  YYCTYPE yych;",
          "534:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "531: #line 532 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "532: #line 533 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "588:  yych = *(YYMARKER = ++YYCURSOR);",
          "589:  if (yych == ':') goto yy95;",
          "590: yy3:",
          "592:  { return 0; }",
          "594: yy4:",
          "595:  yych = *(YYMARKER = ++YYCURSOR);",
          "596:  if (yych == ':') goto yy89;",
          "",
          "[Removed Lines]",
          "591: #line 879 \"ext/standard/var_unserializer.re\"",
          "593: #line 594 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "592: #line 880 \"ext/standard/var_unserializer.re\"",
          "594: #line 595 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "633:  goto yy3;",
          "634: yy14:",
          "635:  ++YYCURSOR;",
          "637:  {",
          "639:  php_error_docref(NULL, E_NOTICE, \"Unexpected end of serialized data\");",
          "641: }",
          "643: yy16:",
          "644:  yych = *++YYCURSOR;",
          "645:  goto yy3;",
          "",
          "[Removed Lines]",
          "636: #line 873 \"ext/standard/var_unserializer.re\"",
          "642: #line 643 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "637: #line 874 \"ext/standard/var_unserializer.re\"",
          "643: #line 644 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "669:  yych = *++YYCURSOR;",
          "670:  if (yych != '\"') goto yy18;",
          "671:  ++YYCURSOR;",
          "673:  {",
          "674:  size_t len, len2, len3, maxlen;",
          "675:  zend_long elements;",
          "",
          "[Removed Lines]",
          "672: #line 728 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "673: #line 729 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "815:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "816: }",
          "818: yy25:",
          "819:  yych = *++YYCURSOR;",
          "820:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "817: #line 818 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "818: #line 819 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "839:  yych = *++YYCURSOR;",
          "840:  if (yych != '\"') goto yy18;",
          "841:  ++YYCURSOR;",
          "843:  {",
          "",
          "[Removed Lines]",
          "842: #line 720 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "843: #line 721 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "847:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "848:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "849: }",
          "851: yy32:",
          "852:  yych = *++YYCURSOR;",
          "853:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "850: #line 851 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "851: #line 852 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "868:  yych = *++YYCURSOR;",
          "869:  if (yych != '{') goto yy18;",
          "870:  ++YYCURSOR;",
          "872:  {",
          "873:  zend_long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "871: #line 699 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "872: #line 700 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "890:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "891: }",
          "893: yy39:",
          "894:  yych = *++YYCURSOR;",
          "895:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "892: #line 893 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "893: #line 894 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "910:  yych = *++YYCURSOR;",
          "911:  if (yych != '\"') goto yy18;",
          "912:  ++YYCURSOR;",
          "914:  {",
          "915:  size_t len, maxlen;",
          "916:  zend_string *str;",
          "",
          "[Removed Lines]",
          "913: #line 671 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "914: #line 672 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "938:  ZVAL_STR(rval, str);",
          "939:  return 1;",
          "940: }",
          "942: yy46:",
          "943:  yych = *++YYCURSOR;",
          "944:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "941: #line 942 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "942: #line 943 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "959:  yych = *++YYCURSOR;",
          "960:  if (yych != '\"') goto yy18;",
          "961:  ++YYCURSOR;",
          "963:  {",
          "964:  size_t len, maxlen;",
          "965:  char *str;",
          "",
          "[Removed Lines]",
          "962: #line 644 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "963: #line 645 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "986:  ZVAL_STRINGL(rval, str, len);",
          "987:  return 1;",
          "988: }",
          "990: yy53:",
          "991:  yych = *++YYCURSOR;",
          "992:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "989: #line 990 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "990: #line 991 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1074:  }",
          "1075: yy63:",
          "1076:  ++YYCURSOR;",
          "1078:  {",
          "1079: #if SIZEOF_ZEND_LONG == 4",
          "1080: use_double:",
          "",
          "[Removed Lines]",
          "1077: #line 635 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1078: #line 636 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1083:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1084:  return 1;",
          "1085: }",
          "1087: yy65:",
          "1088:  yych = *++YYCURSOR;",
          "1089:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1086: #line 1087 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1087: #line 1088 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1142:  yych = *++YYCURSOR;",
          "1143:  if (yych != ';') goto yy18;",
          "1144:  ++YYCURSOR;",
          "1146:  {",
          "",
          "[Removed Lines]",
          "1145: #line 619 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1146: #line 620 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "1159:  return 1;",
          "1160: }",
          "1162: yy76:",
          "1163:  yych = *++YYCURSOR;",
          "1164:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1161: #line 1162 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1162: #line 1163 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1185:  if (yych <= '9') goto yy79;",
          "1186:  if (yych != ';') goto yy18;",
          "1187:  ++YYCURSOR;",
          "1189:  {",
          "1190: #if SIZEOF_ZEND_LONG == 4",
          "1191:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1188: #line 593 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1189: #line 594 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1211:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1212:  return 1;",
          "1213: }",
          "1215: yy83:",
          "1216:  yych = *++YYCURSOR;",
          "1217:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1214: #line 1215 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1215: #line 1216 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "1219:  yych = *++YYCURSOR;",
          "1220:  if (yych != ';') goto yy18;",
          "1221:  ++YYCURSOR;",
          "1223:  {",
          "1225:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1226:  return 1;",
          "1227: }",
          "1229: yy87:",
          "1230:  ++YYCURSOR;",
          "1232:  {",
          "1234:  ZVAL_NULL(rval);",
          "1235:  return 1;",
          "1236: }",
          "1238: yy89:",
          "1239:  yych = *++YYCURSOR;",
          "1240:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1222: #line 587 \"ext/standard/var_unserializer.re\"",
          "1228: #line 1229 \"ext/standard/var_unserializer.c\"",
          "1231: #line 581 \"ext/standard/var_unserializer.re\"",
          "1237: #line 1238 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1223: #line 588 \"ext/standard/var_unserializer.re\"",
          "1229: #line 1230 \"ext/standard/var_unserializer.c\"",
          "1232: #line 582 \"ext/standard/var_unserializer.re\"",
          "1238: #line 1239 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "1257:  if (yych <= '9') goto yy91;",
          "1258:  if (yych != ';') goto yy18;",
          "1259:  ++YYCURSOR;",
          "1261:  {",
          "1262:  zend_long id;",
          "",
          "[Removed Lines]",
          "1260: #line 558 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1261: #line 559 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "1281:  return 1;",
          "1282: }",
          "1284: yy95:",
          "1285:  yych = *++YYCURSOR;",
          "1286:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1283: #line 1284 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1284: #line 1285 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "1303:  if (yych <= '9') goto yy97;",
          "1304:  if (yych != ';') goto yy18;",
          "1305:  ++YYCURSOR;",
          "1307:  {",
          "1308:  zend_long id;",
          "",
          "[Removed Lines]",
          "1306: #line 536 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1307: #line 537 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 25 ---",
          "[Context before]",
          "1326:  return 1;",
          "1327: }",
          "1329: }",
          "1333:  return 0;",
          "",
          "[Removed Lines]",
          "1328: #line 1329 \"ext/standard/var_unserializer.c\"",
          "1330: #line 881 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1329: #line 1330 \"ext/standard/var_unserializer.c\"",
          "1331: #line 882 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "474: {",
          "475:  zval retval;",
          "476:  zval fname;",
          "478:  if (Z_TYPE_P(rval) != IS_OBJECT) {",
          "479:   return 0;",
          "480:  }",
          "484:   return 0;",
          "485:  }",
          "",
          "[Removed Lines]",
          "483:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_OBJPROP_P(rval), elements, 1)) {",
          "",
          "[Added Lines]",
          "477:  HashTable *ht = Z_OBJPROP_P(rval);",
          "483:  zend_hash_resize(ht, zend_hash_num_elements(ht) + elements);",
          "484:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, ht, elements, 1)) {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "b585a3aed7880a5fa5c18e2b838fc96f40e075bd",
      "candidate_info": {
        "commit_hash": "b585a3aed7880a5fa5c18e2b838fc96f40e075bd",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/b585a3aed7880a5fa5c18e2b838fc96f40e075bd",
        "files": [
          "NEWS",
          "ext/standard/tests/strings/bug68710.phpt",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Fix for bug #68710 (Use After Free Vulnerability in PHP's unserialize())",
        "before_after_code_files": [
          "ext/standard/tests/strings/bug68710.phpt||ext/standard/tests/strings/bug68710.phpt",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/tests/strings/bug68710.phpt||ext/standard/tests/strings/bug68710.phpt": [
          "File: ext/standard/tests/strings/bug68710.phpt -> ext/standard/tests/strings/bug68710.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #68710 Use after free vulnerability in unserialize() (bypassing the",
          "3: CVE-2014-8142 fix)",
          "4: --FILE--",
          "5: <?php",
          "6: for ($i=4; $i<100; $i++) {",
          "7:     $m = new StdClass();",
          "9:     $u = array(1);",
          "11:     $m->aaa = array(1,2,&$u,4,5);",
          "12:     $m->bbb = 1;",
          "13:     $m->ccc = &$u;",
          "14:     $m->ddd = str_repeat(\"A\", $i);",
          "16:     $z = serialize($m);",
          "17:     $z = str_replace(\"aaa\", \"123\", $z);",
          "18:     $z = str_replace(\"bbb\", \"123\", $z);",
          "19:     $y = unserialize($z);",
          "20:     $z = serialize($y);",
          "21: }",
          "22: ?>",
          "23: ===DONE===",
          "24: --EXPECTF--",
          "25: ===DONE===",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "343:   } else {",
          "345:    convert_to_string(key);",
          "347:     var_push_dtor(var_hash, old_data);",
          "348:    }",
          "349:    zend_hash_update(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, &data,",
          "",
          "[Removed Lines]",
          "346:    if (zend_symtable_find(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, (void **)&old_data)==SUCCESS) {",
          "",
          "[Added Lines]",
          "346:    if (zend_hash_find(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, (void **)&old_data)==SUCCESS) {",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "347:   } else {",
          "349:    convert_to_string(key);",
          "351:     var_push_dtor(var_hash, old_data);",
          "352:    }",
          "353:    zend_hash_update(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, &data,",
          "",
          "[Removed Lines]",
          "350:    if (zend_symtable_find(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, (void **)&old_data)==SUCCESS) {",
          "",
          "[Added Lines]",
          "350:    if (zend_hash_find(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, (void **)&old_data)==SUCCESS) {",
          "",
          "---------------"
        ]
      }
    }
  ]
}