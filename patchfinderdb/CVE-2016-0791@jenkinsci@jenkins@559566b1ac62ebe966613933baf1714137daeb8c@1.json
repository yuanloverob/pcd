{
  "cve_id": "CVE-2016-0791",
  "cve_desc": "Jenkins before 1.650 and LTS before 1.642.2 do not use a constant-time algorithm to verify CSRF tokens, which makes it easier for remote attackers to bypass a CSRF protection mechanism via a brute-force approach.",
  "repo": "jenkinsci/jenkins",
  "patch_hash": "559566b1ac62ebe966613933baf1714137daeb8c",
  "patch_info": {
    "commit_hash": "559566b1ac62ebe966613933baf1714137daeb8c",
    "repo": "jenkinsci/jenkins",
    "commit_url": "https://github.com/jenkinsci/jenkins/commit/559566b1ac62ebe966613933baf1714137daeb8c",
    "files": [
      "core/src/main/java/hudson/security/csrf/DefaultCrumbIssuer.java"
    ],
    "message": "[FIX SECURITY-245] Compare crumbs in constant time",
    "before_after_code_files": [
      "core/src/main/java/hudson/security/csrf/DefaultCrumbIssuer.java||core/src/main/java/hudson/security/csrf/DefaultCrumbIssuer.java"
    ]
  },
  "patch_diff": {
    "core/src/main/java/hudson/security/csrf/DefaultCrumbIssuer.java||core/src/main/java/hudson/security/csrf/DefaultCrumbIssuer.java": [
      "File: core/src/main/java/hudson/security/csrf/DefaultCrumbIssuer.java -> core/src/main/java/hudson/security/csrf/DefaultCrumbIssuer.java",
      "--- Hunk 1 ---",
      "[Context before]",
      "95:         if (request instanceof HttpServletRequest) {",
      "96:             String newCrumb = issueCrumb(request, salt);",
      "97:             if ((newCrumb != null) && (crumb != null)) {",
      "99:             }",
      "100:         }",
      "101:         return false;",
      "",
      "[Removed Lines]",
      "98:                 return newCrumb.equals(crumb);",
      "",
      "[Added Lines]",
      "98:                 return MessageDigest.isEqual(newCrumb.getBytes(), crumb.getBytes());",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "8713646a47b964f9b25d6eb1f7ee610cc5686404",
      "candidate_info": {
        "commit_hash": "8713646a47b964f9b25d6eb1f7ee610cc5686404",
        "repo": "jenkinsci/jenkins",
        "commit_url": "https://github.com/jenkinsci/jenkins/commit/8713646a47b964f9b25d6eb1f7ee610cc5686404",
        "files": [
          "core/pom.xml",
          "core/src/main/java/hudson/WebAppMain.java",
          "war/src/main/webapp/WEB-INF/web.xml"
        ],
        "message": "[JENKINS-23378] Servlet 3.1\n\nStart declaring servlet 3.1 dependency",
        "before_after_code_files": [
          "core/src/main/java/hudson/WebAppMain.java||core/src/main/java/hudson/WebAppMain.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/jenkinsci/jenkins/pull/2063"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "core/src/main/java/hudson/WebAppMain.java||core/src/main/java/hudson/WebAppMain.java": [
          "File: core/src/main/java/hudson/WebAppMain.java -> core/src/main/java/hudson/WebAppMain.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "118:             installLogger();",
          "122:             final FileAndDescription describedHomeDir = getHomeDir(event);",
          "123:             home = describedHomeDir.file.getAbsoluteFile();",
          "",
          "[Removed Lines]",
          "120:             markCookieAsHttpOnly(context);",
          "",
          "[Added Lines]",
          "122:             context.getSessionCookieConfig().setHttpOnly(true);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "254:         }",
          "255:     }",
          "282:     public void joinInit() throws InterruptedException {",
          "283:         initThread.join();",
          "284:     }",
          "",
          "[Removed Lines]",
          "262:     private void markCookieAsHttpOnly(ServletContext context) {",
          "263:         try {",
          "264:             Method m;",
          "265:             try {",
          "266:                 m = context.getClass().getMethod(\"getSessionCookieConfig\");",
          "267:             } catch (NoSuchMethodException x) { // 3.0+",
          "268:                 LOGGER.log(Level.FINE, \"Failed to set secure cookie flag\", x);",
          "269:                 return;",
          "270:             }",
          "271:             Object sessionCookieConfig = m.invoke(context);",
          "274:             Class scc = Class.forName(\"javax.servlet.SessionCookieConfig\");",
          "275:             Method setHttpOnly = scc.getMethod(\"setHttpOnly\",boolean.class);",
          "276:             setHttpOnly.invoke(sessionCookieConfig,true);",
          "277:         } catch (Exception e) {",
          "278:             LOGGER.log(Level.WARNING, \"Failed to set HTTP-only cookie flag\", e);",
          "279:         }",
          "280:     }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "d0bad0f037cfad293faa2b101e0d5b2e41c01f57",
      "candidate_info": {
        "commit_hash": "d0bad0f037cfad293faa2b101e0d5b2e41c01f57",
        "repo": "jenkinsci/jenkins",
        "commit_url": "https://github.com/jenkinsci/jenkins/commit/d0bad0f037cfad293faa2b101e0d5b2e41c01f57",
        "files": [
          "changelog.html"
        ],
        "message": "typo",
        "before_after_code_files": [
          "changelog.html||changelog.html"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/jenkinsci/jenkins/pull/2063"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "changelog.html||changelog.html": [
          "File: changelog.html -> changelog.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "56: <div id=\"trunk\" style=\"display:none\"><!--=TRUNK-BEGIN=-->",
          "57: <ul class=image>",
          "58:   <li class=\"rfe\">",
          "60:     (<a href-\"https://issues.jenkins-ci.org/browse/JENKINS-33068\">issue 33068</a>)",
          "61: </ul>",
          "62: </div><!--=TRUNK-END=-->",
          "",
          "[Removed Lines]",
          "59:     Move periodic task logfiles from <code>JENKINS_HOME/*.log</code> to <code>JENKINS_HOME/logs/tasks/*.log</code> and rotate them periodically rather than overwrite every execution",
          "",
          "[Added Lines]",
          "59:     Move periodic task log files from <code>JENKINS_HOME/*.log</code> to <code>JENKINS_HOME/logs/tasks/*.log</code> and rotate them periodically rather than overwrite every execution",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "f286bc27bd09e7bd5e76783658888bd63fc38a49",
      "candidate_info": {
        "commit_hash": "f286bc27bd09e7bd5e76783658888bd63fc38a49",
        "repo": "jenkinsci/jenkins",
        "commit_url": "https://github.com/jenkinsci/jenkins/commit/f286bc27bd09e7bd5e76783658888bd63fc38a49",
        "files": [
          "core/src/main/java/hudson/WebAppMain.java",
          "war/src/main/webapp/WEB-INF/web.xml"
        ],
        "message": "With servlet 3.0 this is a better place to set this config",
        "before_after_code_files": [
          "core/src/main/java/hudson/WebAppMain.java||core/src/main/java/hudson/WebAppMain.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/jenkinsci/jenkins/pull/2063"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "core/src/main/java/hudson/WebAppMain.java||core/src/main/java/hudson/WebAppMain.java": [
          "File: core/src/main/java/hudson/WebAppMain.java -> core/src/main/java/hudson/WebAppMain.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "118:             installLogger();",
          "124:             final FileAndDescription describedHomeDir = getHomeDir(event);",
          "125:             home = describedHomeDir.file.getAbsoluteFile();",
          "126:             home.mkdirs();",
          "",
          "[Removed Lines]",
          "122:             context.getSessionCookieConfig().setHttpOnly(true);",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "669e1b5b89cf057d44d85120ac24d7d7e3ce3730",
      "candidate_info": {
        "commit_hash": "669e1b5b89cf057d44d85120ac24d7d7e3ce3730",
        "repo": "jenkinsci/jenkins",
        "commit_url": "https://github.com/jenkinsci/jenkins/commit/669e1b5b89cf057d44d85120ac24d7d7e3ce3730",
        "files": [
          "changelog.html"
        ],
        "message": "updated changelog for release",
        "before_after_code_files": [
          "changelog.html||changelog.html"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/jenkinsci/jenkins/pull/2063"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "changelog.html||changelog.html": [
          "File: changelog.html -> changelog.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "58:   <li class=>",
          "59: </ul>",
          "60: </div><!--=TRUNK-END=-->",
          "61: <h3><a name=v1.649>What's new in 1.649</a> (2016/02/21)</h3>",
          "62: <ul class=image>",
          "63:   <li class=\"rfe\">",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "61: <h3><a name=v1.650>What's new in 1.650</a> (2016/02/24)</h3>",
          "62: <ul class=image>",
          "63:   <li class=>",
          "64: </ul>",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "d6bcfdac70bf8b1a8004420f8ce9b7b30ced7159",
      "candidate_info": {
        "commit_hash": "d6bcfdac70bf8b1a8004420f8ce9b7b30ced7159",
        "repo": "jenkinsci/jenkins",
        "commit_url": "https://github.com/jenkinsci/jenkins/commit/d6bcfdac70bf8b1a8004420f8ce9b7b30ced7159",
        "files": [
          "core/src/main/java/hudson/util/XStream2.java",
          "pom.xml"
        ],
        "message": "Integrating newer remoting snapshot, and adding better diagnostics to BlacklistedTypesConverter.",
        "before_after_code_files": [
          "core/src/main/java/hudson/util/XStream2.java||core/src/main/java/hudson/util/XStream2.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/jenkinsci/jenkins/pull/2063"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "core/src/main/java/hudson/util/XStream2.java||core/src/main/java/hudson/util/XStream2.java": [
          "File: core/src/main/java/hudson/util/XStream2.java -> core/src/main/java/hudson/util/XStream2.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "440:     private static class BlacklistedTypesConverter implements Converter {",
          "441:         @Override",
          "442:         public void marshal(Object source, HierarchicalStreamWriter writer, MarshallingContext context) {",
          "444:         }",
          "446:         @Override",
          "447:         public Object unmarshal(HierarchicalStreamReader reader, UnmarshallingContext context) {",
          "449:         }",
          "451:         @Override",
          "",
          "[Removed Lines]",
          "443:             throw new UnsupportedOperationException(\"Refusing to marshal for security reasons\");",
          "448:             throw new ConversionException(\"Refusing to unmarshal for security reasons\");",
          "",
          "[Added Lines]",
          "443:             throw new UnsupportedOperationException(\"Refusing to marshal \" + source.getClass().getName() + \" for security reasons\");",
          "448:             throw new ConversionException(\"Refusing to unmarshal \" + reader.getNodeName() + \" for security reasons\");",
          "",
          "---------------"
        ]
      }
    }
  ]
}