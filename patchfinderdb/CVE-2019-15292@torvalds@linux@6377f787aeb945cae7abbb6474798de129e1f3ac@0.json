{
  "cve_id": "CVE-2019-15292",
  "cve_desc": "An issue was discovered in the Linux kernel before 5.0.9. There is a use-after-free in atalk_proc_exit, related to net/appletalk/atalk_proc.c, net/appletalk/ddp.c, and net/appletalk/sysctl_net_atalk.c.",
  "repo": "torvalds/linux",
  "patch_hash": "6377f787aeb945cae7abbb6474798de129e1f3ac",
  "patch_info": {
    "commit_hash": "6377f787aeb945cae7abbb6474798de129e1f3ac",
    "repo": "torvalds/linux",
    "commit_url": "https://github.com/torvalds/linux/commit/6377f787aeb945cae7abbb6474798de129e1f3ac",
    "files": [
      "include/linux/atalk.h",
      "net/appletalk/atalk_proc.c",
      "net/appletalk/ddp.c",
      "net/appletalk/sysctl_net_atalk.c"
    ],
    "message": "appletalk: Fix use-after-free in atalk_proc_exit\n\nKASAN report this:\n\nBUG: KASAN: use-after-free in pde_subdir_find+0x12d/0x150 fs/proc/generic.c:71\nRead of size 8 at addr ffff8881f41fe5b0 by task syz-executor.0/2806\n\nCPU: 0 PID: 2806 Comm: syz-executor.0 Not tainted 5.0.0-rc7+ #45\nHardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.10.2-1ubuntu1 04/01/2014\nCall Trace:\n __dump_stack lib/dump_stack.c:77 [inline]\n dump_stack+0xfa/0x1ce lib/dump_stack.c:113\n print_address_description+0x65/0x270 mm/kasan/report.c:187\n kasan_report+0x149/0x18d mm/kasan/report.c:317\n pde_subdir_find+0x12d/0x150 fs/proc/generic.c:71\n remove_proc_entry+0xe8/0x420 fs/proc/generic.c:667\n atalk_proc_exit+0x18/0x820 [appletalk]\n atalk_exit+0xf/0x5a [appletalk]\n __do_sys_delete_module kernel/module.c:1018 [inline]\n __se_sys_delete_module kernel/module.c:961 [inline]\n __x64_sys_delete_module+0x3dc/0x5e0 kernel/module.c:961\n do_syscall_64+0x147/0x600 arch/x86/entry/common.c:290\n entry_SYSCALL_64_after_hwframe+0x49/0xbe\nRIP: 0033:0x462e99\nCode: f7 d8 64 89 02 b8 ff ff ff ff c3 66 0f 1f 44 00 00 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 c7 c1 bc ff ff ff f7 d8 64 89 01 48\nRSP: 002b:00007fb2de6b9c58 EFLAGS: 00000246 ORIG_RAX: 00000000000000b0\nRAX: ffffffffffffffda RBX: 000000000073bf00 RCX: 0000000000462e99\nRDX: 0000000000000000 RSI: 0000000000000000 RDI: 00000000200001c0\nRBP: 0000000000000002 R08: 0000000000000000 R09: 0000000000000000\nR10: 0000000000000000 R11: 0000000000000246 R12: 00007fb2de6ba6bc\nR13: 00000000004bccaa R14: 00000000006f6bc8 R15: 00000000ffffffff\n\nAllocated by task 2806:\n set_track mm/kasan/common.c:85 [inline]\n __kasan_kmalloc.constprop.3+0xa0/0xd0 mm/kasan/common.c:496\n slab_post_alloc_hook mm/slab.h:444 [inline]\n slab_alloc_node mm/slub.c:2739 [inline]\n slab_alloc mm/slub.c:2747 [inline]\n kmem_cache_alloc+0xcf/0x250 mm/slub.c:2752\n kmem_cache_zalloc include/linux/slab.h:730 [inline]\n __proc_create+0x30f/0xa20 fs/proc/generic.c:408\n proc_mkdir_data+0x47/0x190 fs/proc/generic.c:469\n 0xffffffffc10c01bb\n 0xffffffffc10c0166\n do_one_initcall+0xfa/0x5ca init/main.c:887\n do_init_module+0x204/0x5f6 kernel/module.c:3460\n load_module+0x66b2/0x8570 kernel/module.c:3808\n __do_sys_finit_module+0x238/0x2a0 kernel/module.c:3902\n do_syscall_64+0x147/0x600 arch/x86/entry/common.c:290\n entry_SYSCALL_64_after_hwframe+0x49/0xbe\n\nFreed by task 2806:\n set_track mm/kasan/common.c:85 [inline]\n __kasan_slab_free+0x130/0x180 mm/kasan/common.c:458\n slab_free_hook mm/slub.c:1409 [inline]\n slab_free_freelist_hook mm/slub.c:1436 [inline]\n slab_free mm/slub.c:2986 [inline]\n kmem_cache_free+0xa6/0x2a0 mm/slub.c:3002\n pde_put+0x6e/0x80 fs/proc/generic.c:647\n remove_proc_entry+0x1d3/0x420 fs/proc/generic.c:684\n 0xffffffffc10c031c\n 0xffffffffc10c0166\n do_one_initcall+0xfa/0x5ca init/main.c:887\n do_init_module+0x204/0x5f6 kernel/module.c:3460\n load_module+0x66b2/0x8570 kernel/module.c:3808\n __do_sys_finit_module+0x238/0x2a0 kernel/module.c:3902\n do_syscall_64+0x147/0x600 arch/x86/entry/common.c:290\n entry_SYSCALL_64_after_hwframe+0x49/0xbe\n\nThe buggy address belongs to the object at ffff8881f41fe500\n which belongs to the cache proc_dir_entry of size 256\nThe buggy address is located 176 bytes inside of\n 256-byte region [ffff8881f41fe500, ffff8881f41fe600)\nThe buggy address belongs to the page:\npage:ffffea0007d07f80 count:1 mapcount:0 mapping:ffff8881f6e69a00 index:0x0\nflags: 0x2fffc0000000200(slab)\nraw: 02fffc0000000200 dead000000000100 dead000000000200 ffff8881f6e69a00\nraw: 0000000000000000 00000000800c000c 00000001ffffffff 0000000000000000\npage dumped because: kasan: bad access detected\n\nMemory state around the buggy address:\n ffff8881f41fe480: fb fb fb fb fb fb fb fb fc fc fc fc fc fc fc fc\n ffff8881f41fe500: fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb\n>ffff8881f41fe580: fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb\n                                     ^\n ffff8881f41fe600: fc fc fc fc fc fc fc fc fb fb fb fb fb fb fb fb\n ffff8881f41fe680: fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb\n\nIt should check the return value of atalk_proc_init fails,\notherwise atalk_exit will trgger use-after-free in pde_subdir_find\nwhile unload the module.This patch fix error cleanup path of atalk_init\n\nReported-by: Hulk Robot <hulkci@huawei.com>\nSigned-off-by: YueHaibing <yuehaibing@huawei.com>\nSigned-off-by: David S. Miller <davem@davemloft.net>",
    "before_after_code_files": [
      "include/linux/atalk.h||include/linux/atalk.h",
      "net/appletalk/atalk_proc.c||net/appletalk/atalk_proc.c",
      "net/appletalk/ddp.c||net/appletalk/ddp.c",
      "net/appletalk/sysctl_net_atalk.c||net/appletalk/sysctl_net_atalk.c"
    ]
  },
  "patch_diff": {
    "include/linux/atalk.h||include/linux/atalk.h": [
      "File: include/linux/atalk.h -> include/linux/atalk.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "158: extern int sysctl_aarp_resolve_time;",
      "160: #ifdef CONFIG_SYSCTL",
      "162: extern void atalk_unregister_sysctl(void);",
      "163: #else",
      "164: #define atalk_register_sysctl()  do { } while(0)",
      "",
      "[Removed Lines]",
      "161: extern void atalk_register_sysctl(void);",
      "",
      "[Added Lines]",
      "161: extern int atalk_register_sysctl(void);",
      "",
      "---------------"
    ],
    "net/appletalk/atalk_proc.c||net/appletalk/atalk_proc.c": [
      "File: net/appletalk/atalk_proc.c -> net/appletalk/atalk_proc.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "237:  return -ENOMEM;",
      "238: }",
      "241: {",
      "242:  remove_proc_subtree(\"atalk\", init_net.proc_net);",
      "243: }",
      "",
      "[Removed Lines]",
      "240: void __exit atalk_proc_exit(void)",
      "",
      "[Added Lines]",
      "240: void atalk_proc_exit(void)",
      "",
      "---------------"
    ],
    "net/appletalk/ddp.c||net/appletalk/ddp.c": [
      "File: net/appletalk/ddp.c -> net/appletalk/ddp.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1911: static int __init atalk_init(void)",
      "1912: {",
      "1916:   goto out;",
      "1919:  ddp_dl = register_snap_client(ddp_snap_id, atalk_rcv);",
      "1920:  if (!ddp_dl)",
      "1921:   printk(atalk_err_snap);",
      "",
      "[Removed Lines]",
      "1913:  int rc = proto_register(&ddp_proto, 0);",
      "1915:  if (rc != 0)",
      "1918:  (void)sock_register(&atalk_family_ops);",
      "",
      "[Added Lines]",
      "1913:  int rc;",
      "1915:  rc = proto_register(&ddp_proto, 0);",
      "1916:  if (rc)",
      "1919:  rc = sock_register(&atalk_family_ops);",
      "1920:  if (rc)",
      "1921:   goto out_proto;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "1923:  dev_add_pack(&ltalk_packet_type);",
      "1924:  dev_add_pack(&ppptalk_packet_type);",
      "1927:  aarp_proto_init();",
      "1930: out:",
      "1931:  return rc;",
      "1932: }",
      "1933: module_init(atalk_init);",
      "",
      "[Removed Lines]",
      "1926:  register_netdevice_notifier(&ddp_notifier);",
      "1928:  atalk_proc_init();",
      "1929:  atalk_register_sysctl();",
      "",
      "[Added Lines]",
      "1930:  rc = register_netdevice_notifier(&ddp_notifier);",
      "1931:  if (rc)",
      "1932:   goto out_sock;",
      "1935:  rc = atalk_proc_init();",
      "1936:  if (rc)",
      "1937:   goto out_aarp;",
      "1939:  rc = atalk_register_sysctl();",
      "1940:  if (rc)",
      "1941:   goto out_proc;",
      "1944: out_proc:",
      "1945:  atalk_proc_exit();",
      "1946: out_aarp:",
      "1947:  aarp_cleanup_module();",
      "1948:  unregister_netdevice_notifier(&ddp_notifier);",
      "1949: out_sock:",
      "1950:  dev_remove_pack(&ppptalk_packet_type);",
      "1951:  dev_remove_pack(&ltalk_packet_type);",
      "1952:  unregister_snap_client(ddp_dl);",
      "1953:  sock_unregister(PF_APPLETALK);",
      "1954: out_proto:",
      "1955:  proto_unregister(&ddp_proto);",
      "1956:  goto out;",
      "",
      "---------------"
    ],
    "net/appletalk/sysctl_net_atalk.c||net/appletalk/sysctl_net_atalk.c": [
      "File: net/appletalk/sysctl_net_atalk.c -> net/appletalk/sysctl_net_atalk.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "46: static struct ctl_table_header *atalk_table_header;",
      "49: {",
      "50:  atalk_table_header = register_net_sysctl(&init_net, \"net/appletalk\", atalk_table);",
      "51: }",
      "53: void atalk_unregister_sysctl(void)",
      "",
      "[Removed Lines]",
      "48: void atalk_register_sysctl(void)",
      "",
      "[Added Lines]",
      "48: int __init atalk_register_sysctl(void)",
      "51:  if (!atalk_table_header)",
      "52:   return -ENOMEM;",
      "53:  return 0;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "58bdd544e2933a21a51eecf17c3f5f94038261b5",
      "candidate_info": {
        "commit_hash": "58bdd544e2933a21a51eecf17c3f5f94038261b5",
        "repo": "torvalds/linux",
        "commit_url": "https://github.com/torvalds/linux/commit/58bdd544e2933a21a51eecf17c3f5f94038261b5",
        "files": [
          "net/nfc/llcp_commands.c",
          "net/nfc/llcp_core.c"
        ],
        "message": "net: nfc: Fix NULL dereference on nfc_llcp_build_tlv fails\n\nKASAN report this:\n\nBUG: KASAN: null-ptr-deref in nfc_llcp_build_gb+0x37f/0x540 [nfc]\nRead of size 3 at addr 0000000000000000 by task syz-executor.0/5401\n\nCPU: 0 PID: 5401 Comm: syz-executor.0 Not tainted 5.0.0-rc7+ #45\nHardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.10.2-1ubuntu1 04/01/2014\nCall Trace:\n __dump_stack lib/dump_stack.c:77 [inline]\n dump_stack+0xfa/0x1ce lib/dump_stack.c:113\n kasan_report+0x171/0x18d mm/kasan/report.c:321\n memcpy+0x1f/0x50 mm/kasan/common.c:130\n nfc_llcp_build_gb+0x37f/0x540 [nfc]\n nfc_llcp_register_device+0x6eb/0xb50 [nfc]\n nfc_register_device+0x50/0x1d0 [nfc]\n nfcsim_device_new+0x394/0x67d [nfcsim]\n ? 0xffffffffc1080000\n nfcsim_init+0x6b/0x1000 [nfcsim]\n do_one_initcall+0xfa/0x5ca init/main.c:887\n do_init_module+0x204/0x5f6 kernel/module.c:3460\n load_module+0x66b2/0x8570 kernel/module.c:3808\n __do_sys_finit_module+0x238/0x2a0 kernel/module.c:3902\n do_syscall_64+0x147/0x600 arch/x86/entry/common.c:290\n entry_SYSCALL_64_after_hwframe+0x49/0xbe\nRIP: 0033:0x462e99\nCode: f7 d8 64 89 02 b8 ff ff ff ff c3 66 0f 1f 44 00 00 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 c7 c1 bc ff ff ff f7 d8 64 89 01 48\nRSP: 002b:00007f9cb79dcc58 EFLAGS: 00000246 ORIG_RAX: 0000000000000139\nRAX: ffffffffffffffda RBX: 000000000073bf00 RCX: 0000000000462e99\nRDX: 0000000000000000 RSI: 0000000020000280 RDI: 0000000000000003\nRBP: 00007f9cb79dcc70 R08: 0000000000000000 R09: 0000000000000000\nR10: 0000000000000000 R11: 0000000000000246 R12: 00007f9cb79dd6bc\nR13: 00000000004bcefb R14: 00000000006f7030 R15: 0000000000000004\n\nnfc_llcp_build_tlv will return NULL on fails, caller should check it,\notherwise will trigger a NULL dereference.\n\nReported-by: Hulk Robot <hulkci@huawei.com>\nFixes: eda21f16a5ed (\"NFC: Set MIU and RW values from CONNECT and CC LLCP frames\")\nFixes: d646960f7986 (\"NFC: Initial LLCP support\")\nSigned-off-by: YueHaibing <yuehaibing@huawei.com>\nSigned-off-by: David S. Miller <davem@davemloft.net>",
        "before_after_code_files": [
          "net/nfc/llcp_commands.c||net/nfc/llcp_commands.c",
          "net/nfc/llcp_core.c||net/nfc/llcp_core.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_issue": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "net/nfc/llcp_commands.c||net/nfc/llcp_commands.c": [
          "File: net/nfc/llcp_commands.c -> net/nfc/llcp_commands.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "419:             sock->service_name,",
          "420:             sock->service_name_len,",
          "421:             &service_name_tlv_length);",
          "422:   size += service_name_tlv_length;",
          "423:  }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "422:   if (!service_name_tlv) {",
          "423:    err = -ENOMEM;",
          "424:    goto error_tlv;",
          "425:   }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "430:  miux_tlv = nfc_llcp_build_tlv(LLCP_TLV_MIUX, (u8 *)&miux, 0,",
          "431:           &miux_tlv_length);",
          "432:  size += miux_tlv_length;",
          "434:  rw_tlv = nfc_llcp_build_tlv(LLCP_TLV_RW, &rw, 0, &rw_tlv_length);",
          "435:  size += rw_tlv_length;",
          "437:  pr_debug(\"SKB size %d SN length %zu\\n\", size, sock->service_name_len);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "436:  if (!miux_tlv) {",
          "437:   err = -ENOMEM;",
          "438:   goto error_tlv;",
          "439:  }",
          "443:  if (!rw_tlv) {",
          "444:   err = -ENOMEM;",
          "445:   goto error_tlv;",
          "446:  }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "485:  miux_tlv = nfc_llcp_build_tlv(LLCP_TLV_MIUX, (u8 *)&miux, 0,",
          "486:           &miux_tlv_length);",
          "487:  size += miux_tlv_length;",
          "489:  rw_tlv = nfc_llcp_build_tlv(LLCP_TLV_RW, &rw, 0, &rw_tlv_length);",
          "490:  size += rw_tlv_length;",
          "492:  skb = llcp_allocate_pdu(sock, LLCP_PDU_CC, size);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "499:  if (!miux_tlv) {",
          "500:   err = -ENOMEM;",
          "501:   goto error_tlv;",
          "502:  }",
          "506:  if (!rw_tlv) {",
          "507:   err = -ENOMEM;",
          "508:   goto error_tlv;",
          "509:  }",
          "",
          "---------------"
        ],
        "net/nfc/llcp_core.c||net/nfc/llcp_core.c": [
          "File: net/nfc/llcp_core.c -> net/nfc/llcp_core.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "533: static int nfc_llcp_build_gb(struct nfc_llcp_local *local)",
          "534: {",
          "539:  __be16 wks = cpu_to_be16(local->local_wks);",
          "540:  u8 gb_len = 0;",
          "541:  int ret = 0;",
          "",
          "[Removed Lines]",
          "535:  u8 *gb_cur, *version_tlv, version, version_length;",
          "536:  u8 *lto_tlv, lto_length;",
          "537:  u8 *wks_tlv, wks_length;",
          "538:  u8 *miux_tlv, miux_length;",
          "",
          "[Added Lines]",
          "535:  u8 *gb_cur, version, version_length;",
          "536:  u8 lto_length, wks_length, miux_length;",
          "537:  u8 *version_tlv = NULL, *lto_tlv = NULL,",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "543:  version = LLCP_VERSION_11;",
          "544:  version_tlv = nfc_llcp_build_tlv(LLCP_TLV_VERSION, &version,",
          "545:       1, &version_length);",
          "546:  gb_len += version_length;",
          "548:  lto_tlv = nfc_llcp_build_tlv(LLCP_TLV_LTO, &local->lto, 1, &lto_length);",
          "549:  gb_len += lto_length;",
          "551:  pr_debug(\"Local wks 0x%lx\\n\", local->local_wks);",
          "552:  wks_tlv = nfc_llcp_build_tlv(LLCP_TLV_WKS, (u8 *)&wks, 2, &wks_length);",
          "553:  gb_len += wks_length;",
          "555:  miux_tlv = nfc_llcp_build_tlv(LLCP_TLV_MIUX, (u8 *)&local->miux, 0,",
          "556:           &miux_length);",
          "557:  gb_len += miux_length;",
          "559:  gb_len += ARRAY_SIZE(llcp_magic);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "546:  if (!version_tlv) {",
          "547:   ret = -ENOMEM;",
          "548:   goto out;",
          "549:  }",
          "553:  if (!lto_tlv) {",
          "554:   ret = -ENOMEM;",
          "555:   goto out;",
          "556:  }",
          "561:  if (!wks_tlv) {",
          "562:   ret = -ENOMEM;",
          "563:   goto out;",
          "564:  }",
          "569:  if (!miux_tlv) {",
          "570:   ret = -ENOMEM;",
          "571:   goto out;",
          "572:  }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "9804501fa1228048857910a6bf23e085aade37cc",
      "candidate_info": {
        "commit_hash": "9804501fa1228048857910a6bf23e085aade37cc",
        "repo": "torvalds/linux",
        "commit_url": "https://github.com/torvalds/linux/commit/9804501fa1228048857910a6bf23e085aade37cc",
        "files": [
          "include/linux/atalk.h",
          "net/appletalk/aarp.c",
          "net/appletalk/ddp.c"
        ],
        "message": "appletalk: Fix potential NULL pointer dereference in unregister_snap_client\n\nregister_snap_client may return NULL, all the callers\ncheck it, but only print a warning. This will result in\nNULL pointer dereference in unregister_snap_client and other\nplaces.\n\nIt has always been used like this since v2.6\n\nReported-by: Dan Carpenter <dan.carpenter@oracle.com>\nSigned-off-by: YueHaibing <yuehaibing@huawei.com>\nSigned-off-by: David S. Miller <davem@davemloft.net>",
        "before_after_code_files": [
          "include/linux/atalk.h||include/linux/atalk.h",
          "net/appletalk/aarp.c||net/appletalk/aarp.c",
          "net/appletalk/ddp.c||net/appletalk/ddp.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "include/linux/atalk.h||include/linux/atalk.h",
            "net/appletalk/ddp.c||net/appletalk/ddp.c"
          ],
          "candidate": [
            "include/linux/atalk.h||include/linux/atalk.h",
            "net/appletalk/ddp.c||net/appletalk/ddp.c"
          ]
        }
      },
      "candidate_diff": {
        "include/linux/atalk.h||include/linux/atalk.h": [
          "File: include/linux/atalk.h -> include/linux/atalk.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "108: #define AARP_RESOLVE_TIME (10 * HZ)",
          "110: extern struct datalink_proto *ddp_dl, *aarp_dl;",
          "",
          "[Removed Lines]",
          "111: extern void aarp_proto_init(void);",
          "",
          "[Added Lines]",
          "111: extern int aarp_proto_init(void);",
          "",
          "---------------"
        ],
        "net/appletalk/aarp.c||net/appletalk/aarp.c": [
          "File: net/appletalk/aarp.c -> net/appletalk/aarp.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "880: static unsigned char aarp_snap_id[] = { 0x00, 0x00, 0x00, 0x80, 0xF3 };",
          "883: {",
          "884:  aarp_dl = register_snap_client(aarp_snap_id, aarp_rcv);",
          "886:   printk(KERN_CRIT \"Unable to register AARP with SNAP.\\n\");",
          "887:  timer_setup(&aarp_timer, aarp_expire_timeout, 0);",
          "888:  aarp_timer.expires  = jiffies + sysctl_aarp_expiry_time;",
          "889:  add_timer(&aarp_timer);",
          "891: }",
          "",
          "[Removed Lines]",
          "882: void __init aarp_proto_init(void)",
          "885:  if (!aarp_dl)",
          "890:  register_netdevice_notifier(&aarp_notifier);",
          "",
          "[Added Lines]",
          "882: int __init aarp_proto_init(void)",
          "884:  int rc;",
          "887:  if (!aarp_dl) {",
          "889:   return -ENOMEM;",
          "890:  }",
          "894:  rc = register_netdevice_notifier(&aarp_notifier);",
          "895:  if (rc) {",
          "896:   del_timer_sync(&aarp_timer);",
          "897:   unregister_snap_client(aarp_dl);",
          "898:  }",
          "899:  return rc;",
          "",
          "---------------"
        ],
        "net/appletalk/ddp.c||net/appletalk/ddp.c": [
          "File: net/appletalk/ddp.c -> net/appletalk/ddp.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1904: EXPORT_SYMBOL(atrtr_get_dev);",
          "1905: EXPORT_SYMBOL(atalk_find_dev_addr);",
          "1911: static int __init atalk_init(void)",
          "1912: {",
          "",
          "[Removed Lines]",
          "1907: static const char atalk_err_snap[] __initconst =",
          "1908:  KERN_CRIT \"Unable to register DDP with SNAP.\\n\";",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1921:   goto out_proto;",
          "1923:  ddp_dl = register_snap_client(ddp_snap_id, atalk_rcv);",
          "1927:  dev_add_pack(&ltalk_packet_type);",
          "1928:  dev_add_pack(&ppptalk_packet_type);",
          "1930:  rc = register_netdevice_notifier(&ddp_notifier);",
          "1931:  if (rc)",
          "1935:  rc = atalk_proc_init();",
          "1936:  if (rc)",
          "1937:   goto out_aarp;",
          "",
          "[Removed Lines]",
          "1924:  if (!ddp_dl)",
          "1925:   printk(atalk_err_snap);",
          "1932:   goto out_sock;",
          "1934:  aarp_proto_init();",
          "",
          "[Added Lines]",
          "1921:  if (!ddp_dl) {",
          "1922:   pr_crit(\"Unable to register DDP with SNAP.\\n\");",
          "1923:   goto out_sock;",
          "1924:  }",
          "1931:   goto out_snap;",
          "1933:  rc = aarp_proto_init();",
          "1934:  if (rc)",
          "1935:   goto out_dev;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1945:  atalk_proc_exit();",
          "1946: out_aarp:",
          "1947:  aarp_cleanup_module();",
          "1948:  unregister_netdevice_notifier(&ddp_notifier);",
          "1950:  dev_remove_pack(&ppptalk_packet_type);",
          "1951:  dev_remove_pack(&ltalk_packet_type);",
          "1952:  unregister_snap_client(ddp_dl);",
          "1953:  sock_unregister(PF_APPLETALK);",
          "1954: out_proto:",
          "1955:  proto_unregister(&ddp_proto);",
          "",
          "[Removed Lines]",
          "1949: out_sock:",
          "",
          "[Added Lines]",
          "1950: out_dev:",
          "1952: out_snap:",
          "1956: out_sock:",
          "",
          "---------------"
        ]
      }
    }
  ]
}