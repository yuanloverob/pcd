{
  "cve_id": "CVE-2011-3940",
  "cve_desc": "nsvdec.c in libavcodec in FFmpeg 0.7.x before 0.7.12 and 0.8.x before 0.8.11, and in Libav 0.5.x before 0.5.9, 0.6.x before 0.6.6, 0.7.x before 0.7.5, and 0.8.x before 0.8.1, allows remote attackers to cause a denial of service (out-of-bounds read and write) via a crafted NSV file that triggers \"use of uninitialized streams.\"",
  "repo": "FFmpeg/FFmpeg",
  "patch_hash": "5c011706bc752d34bc6ada31d7df2ca0c9af7c6b",
  "patch_info": {
    "commit_hash": "5c011706bc752d34bc6ada31d7df2ca0c9af7c6b",
    "repo": "FFmpeg/FFmpeg",
    "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/5c011706bc752d34bc6ada31d7df2ca0c9af7c6b",
    "files": [
      "libavformat/nsvdec.c"
    ],
    "message": "nsvdec: Fix use of uninitialized streams.\n\nFixes CVE-2011-3940 (Out of bounds read resulting in out of bounds write)\n\nFound-by: Mateusz \"j00ru\" Jurczyk and Gynvael Coldwind\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>",
    "before_after_code_files": [
      "libavformat/nsvdec.c||libavformat/nsvdec.c"
    ]
  },
  "patch_diff": {
    "libavformat/nsvdec.c||libavformat/nsvdec.c": [
      "File: libavformat/nsvdec.c -> libavformat/nsvdec.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "606:     }",
      "610:         st[s->streams[0]->id] = s->streams[0];",
      "612:         st[s->streams[1]->id] = s->streams[1];",
      "615:         nst = st[NSV_ST_VIDEO]->priv_data;",
      "616:         pkt = &nsv->ahead[NSV_ST_VIDEO];",
      "617:         av_get_packet(pb, pkt, vsize);",
      "",
      "[Removed Lines]",
      "609:     if (s->streams[0])",
      "611:     if (s->streams[1])",
      "614:     if (vsize/* && st[NSV_ST_VIDEO]*/) {",
      "",
      "[Added Lines]",
      "609:     if (s->nb_streams > 0)",
      "611:     if (s->nb_streams > 1)",
      "614:     if (vsize && st[NSV_ST_VIDEO]) {",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "624:     if(st[NSV_ST_VIDEO])",
      "625:         ((NSVStream*)st[NSV_ST_VIDEO]->priv_data)->frame_offset++;",
      "628:         nst = st[NSV_ST_AUDIO]->priv_data;",
      "629:         pkt = &nsv->ahead[NSV_ST_AUDIO];",
      "",
      "[Removed Lines]",
      "627:     if (asize/*st[NSV_ST_AUDIO]*/) {",
      "",
      "[Added Lines]",
      "627:     if (asize && st[NSV_ST_AUDIO]) {",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "6a89b41d9780325ba6d89a37f2aeb925aa68e6a3",
      "candidate_info": {
        "commit_hash": "6a89b41d9780325ba6d89a37f2aeb925aa68e6a3",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/6a89b41d9780325ba6d89a37f2aeb925aa68e6a3",
        "files": [
          "libavformat/nsvdec.c"
        ],
        "message": "nsvdec: Fix use of uninitialized streams.\n\nFixes CVE-2011-3940 (Out of bounds read resulting in out of bounds write)\n\nFound-by: Mateusz \"j00ru\" Jurczyk and Gynvael Coldwind\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>\n(cherry picked from commit 5c011706bc752d34bc6ada31d7df2ca0c9af7c6b)\n\nSigned-off-by: Alex Converse <alex.converse@gmail.com>",
        "before_after_code_files": [
          "libavformat/nsvdec.c||libavformat/nsvdec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_message": 1,
        "olp_code_files": {
          "patch": [
            "libavformat/nsvdec.c||libavformat/nsvdec.c"
          ],
          "candidate": [
            "libavformat/nsvdec.c||libavformat/nsvdec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavformat/nsvdec.c||libavformat/nsvdec.c": [
          "File: libavformat/nsvdec.c -> libavformat/nsvdec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "605:     }",
          "609:         st[s->streams[0]->id] = s->streams[0];",
          "611:         st[s->streams[1]->id] = s->streams[1];",
          "614:         nst = st[NSV_ST_VIDEO]->priv_data;",
          "615:         pkt = &nsv->ahead[NSV_ST_VIDEO];",
          "616:         av_get_packet(pb, pkt, vsize);",
          "",
          "[Removed Lines]",
          "608:     if (s->streams[0])",
          "610:     if (s->streams[1])",
          "613:     if (vsize/* && st[NSV_ST_VIDEO]*/) {",
          "",
          "[Added Lines]",
          "608:     if (s->nb_streams > 0)",
          "610:     if (s->nb_streams > 1)",
          "613:     if (vsize && st[NSV_ST_VIDEO]) {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "623:     if(st[NSV_ST_VIDEO])",
          "624:         ((NSVStream*)st[NSV_ST_VIDEO]->priv_data)->frame_offset++;",
          "627:         nst = st[NSV_ST_AUDIO]->priv_data;",
          "628:         pkt = &nsv->ahead[NSV_ST_AUDIO];",
          "",
          "[Removed Lines]",
          "626:     if (asize/*st[NSV_ST_AUDIO]*/) {",
          "",
          "[Added Lines]",
          "626:     if (asize && st[NSV_ST_AUDIO]) {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "bde4b660637c9f08eef51697c54417037a9eeb2f",
      "candidate_info": {
        "commit_hash": "bde4b660637c9f08eef51697c54417037a9eeb2f",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/bde4b660637c9f08eef51697c54417037a9eeb2f",
        "files": [
          "libavformat/nsvdec.c"
        ],
        "message": "nsvdec: Fix use of uninitialized streams.\n\nFixes CVE-2011-3940 (Out of bounds read resulting in out of bounds write)\n\nFound-by: Mateusz \"j00ru\" Jurczyk and Gynvael Coldwind\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>\n(cherry picked from commit 5c011706bc752d34bc6ada31d7df2ca0c9af7c6b)\n\nSigned-off-by: Alex Converse <alex.converse@gmail.com>\n(cherry picked from commit 6a89b41d9780325ba6d89a37f2aeb925aa68e6a3)\nSigned-off-by: Reinhard Tartler <siretart@tauware.de>\n(cherry picked from commit 65beb8c1173906b0541442713cb29e8ba44c47ef)\n\nSigned-off-by: Reinhard Tartler <siretart@tauware.de>\n(cherry picked from commit 1edf848a81464afd514afbbbcb97b471d334e14a)\n\nSigned-off-by: Reinhard Tartler <siretart@tauware.de>",
        "before_after_code_files": [
          "libavformat/nsvdec.c||libavformat/nsvdec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavformat/nsvdec.c||libavformat/nsvdec.c"
          ],
          "candidate": [
            "libavformat/nsvdec.c||libavformat/nsvdec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavformat/nsvdec.c||libavformat/nsvdec.c": [
          "File: libavformat/nsvdec.c -> libavformat/nsvdec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "586:     }",
          "590:         st[s->streams[0]->id] = s->streams[0];",
          "592:         st[s->streams[1]->id] = s->streams[1];",
          "595:         nst = st[NSV_ST_VIDEO]->priv_data;",
          "596:         pkt = &nsv->ahead[NSV_ST_VIDEO];",
          "597:         av_get_packet(pb, pkt, vsize);",
          "",
          "[Removed Lines]",
          "589:     if (s->streams[0])",
          "591:     if (s->streams[1])",
          "594:     if (vsize/* && st[NSV_ST_VIDEO]*/) {",
          "",
          "[Added Lines]",
          "589:     if (s->nb_streams > 0)",
          "591:     if (s->nb_streams > 1)",
          "594:     if (vsize && st[NSV_ST_VIDEO]) {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "606:     if(st[NSV_ST_VIDEO])",
          "607:         ((NSVStream*)st[NSV_ST_VIDEO]->priv_data)->frame_offset++;",
          "610:         nst = st[NSV_ST_AUDIO]->priv_data;",
          "611:         pkt = &nsv->ahead[NSV_ST_AUDIO];",
          "",
          "[Removed Lines]",
          "609:     if (asize/*st[NSV_ST_AUDIO]*/) {",
          "",
          "[Added Lines]",
          "609:     if (asize && st[NSV_ST_AUDIO]) {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "1edf848a81464afd514afbbbcb97b471d334e14a",
      "candidate_info": {
        "commit_hash": "1edf848a81464afd514afbbbcb97b471d334e14a",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/1edf848a81464afd514afbbbcb97b471d334e14a",
        "files": [
          "libavformat/nsvdec.c"
        ],
        "message": "nsvdec: Fix use of uninitialized streams.\n\nFixes CVE-2011-3940 (Out of bounds read resulting in out of bounds write)\n\nFound-by: Mateusz \"j00ru\" Jurczyk and Gynvael Coldwind\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>\n(cherry picked from commit 5c011706bc752d34bc6ada31d7df2ca0c9af7c6b)\n\nSigned-off-by: Alex Converse <alex.converse@gmail.com>\n(cherry picked from commit 6a89b41d9780325ba6d89a37f2aeb925aa68e6a3)\nSigned-off-by: Reinhard Tartler <siretart@tauware.de>\n(cherry picked from commit 65beb8c1173906b0541442713cb29e8ba44c47ef)\n\nSigned-off-by: Reinhard Tartler <siretart@tauware.de>",
        "before_after_code_files": [
          "libavformat/nsvdec.c||libavformat/nsvdec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavformat/nsvdec.c||libavformat/nsvdec.c"
          ],
          "candidate": [
            "libavformat/nsvdec.c||libavformat/nsvdec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavformat/nsvdec.c||libavformat/nsvdec.c": [
          "File: libavformat/nsvdec.c -> libavformat/nsvdec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "609:     }",
          "613:         st[s->streams[0]->id] = s->streams[0];",
          "615:         st[s->streams[1]->id] = s->streams[1];",
          "618:         nst = st[NSV_ST_VIDEO]->priv_data;",
          "619:         pkt = &nsv->ahead[NSV_ST_VIDEO];",
          "620:         av_get_packet(pb, pkt, vsize);",
          "",
          "[Removed Lines]",
          "612:     if (s->streams[0])",
          "614:     if (s->streams[1])",
          "617:     if (vsize/* && st[NSV_ST_VIDEO]*/) {",
          "",
          "[Added Lines]",
          "612:     if (s->nb_streams > 0)",
          "614:     if (s->nb_streams > 1)",
          "617:     if (vsize && st[NSV_ST_VIDEO]) {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "629:     if(st[NSV_ST_VIDEO])",
          "630:         ((NSVStream*)st[NSV_ST_VIDEO]->priv_data)->frame_offset++;",
          "633:         nst = st[NSV_ST_AUDIO]->priv_data;",
          "634:         pkt = &nsv->ahead[NSV_ST_AUDIO];",
          "",
          "[Removed Lines]",
          "632:     if (asize/*st[NSV_ST_AUDIO]*/) {",
          "",
          "[Added Lines]",
          "632:     if (asize && st[NSV_ST_AUDIO]) {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "65beb8c1173906b0541442713cb29e8ba44c47ef",
      "candidate_info": {
        "commit_hash": "65beb8c1173906b0541442713cb29e8ba44c47ef",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/65beb8c1173906b0541442713cb29e8ba44c47ef",
        "files": [
          "libavformat/nsvdec.c"
        ],
        "message": "nsvdec: Fix use of uninitialized streams.\n\nFixes CVE-2011-3940 (Out of bounds read resulting in out of bounds write)\n\nFound-by: Mateusz \"j00ru\" Jurczyk and Gynvael Coldwind\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>\n(cherry picked from commit 5c011706bc752d34bc6ada31d7df2ca0c9af7c6b)\n\nSigned-off-by: Alex Converse <alex.converse@gmail.com>\n(cherry picked from commit 6a89b41d9780325ba6d89a37f2aeb925aa68e6a3)\nSigned-off-by: Reinhard Tartler <siretart@tauware.de>",
        "before_after_code_files": [
          "libavformat/nsvdec.c||libavformat/nsvdec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavformat/nsvdec.c||libavformat/nsvdec.c"
          ],
          "candidate": [
            "libavformat/nsvdec.c||libavformat/nsvdec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavformat/nsvdec.c||libavformat/nsvdec.c": [
          "File: libavformat/nsvdec.c -> libavformat/nsvdec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "596:     }",
          "600:         st[s->streams[0]->id] = s->streams[0];",
          "602:         st[s->streams[1]->id] = s->streams[1];",
          "605:         nst = st[NSV_ST_VIDEO]->priv_data;",
          "606:         pkt = &nsv->ahead[NSV_ST_VIDEO];",
          "607:         av_get_packet(pb, pkt, vsize);",
          "",
          "[Removed Lines]",
          "599:     if (s->streams[0])",
          "601:     if (s->streams[1])",
          "604:     if (vsize/* && st[NSV_ST_VIDEO]*/) {",
          "",
          "[Added Lines]",
          "599:     if (s->nb_streams > 0)",
          "601:     if (s->nb_streams > 1)",
          "604:     if (vsize && st[NSV_ST_VIDEO]) {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "614:     if(st[NSV_ST_VIDEO])",
          "615:         ((NSVStream*)st[NSV_ST_VIDEO]->priv_data)->frame_offset++;",
          "618:         nst = st[NSV_ST_AUDIO]->priv_data;",
          "619:         pkt = &nsv->ahead[NSV_ST_AUDIO];",
          "",
          "[Removed Lines]",
          "617:     if (asize/*st[NSV_ST_AUDIO]*/) {",
          "",
          "[Added Lines]",
          "617:     if (asize && st[NSV_ST_AUDIO]) {",
          "",
          "---------------"
        ]
      }
    }
  ]
}