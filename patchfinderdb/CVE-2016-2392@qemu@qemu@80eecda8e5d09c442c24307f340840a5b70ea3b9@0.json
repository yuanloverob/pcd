{
  "cve_id": "CVE-2016-2392",
  "cve_desc": "The is_rndis function in the USB Net device emulator (hw/usb/dev-network.c) in QEMU before 2.5.1 does not properly validate USB configuration descriptor objects, which allows local guest OS administrators to cause a denial of service (NULL pointer dereference and QEMU process crash) via vectors involving a remote NDIS control message packet.",
  "repo": "qemu/qemu",
  "patch_hash": "80eecda8e5d09c442c24307f340840a5b70ea3b9",
  "patch_info": {
    "commit_hash": "80eecda8e5d09c442c24307f340840a5b70ea3b9",
    "repo": "qemu/qemu",
    "commit_url": "https://github.com/qemu/qemu/commit/80eecda8e5d09c442c24307f340840a5b70ea3b9",
    "files": [
      "hw/usb/dev-network.c"
    ],
    "message": "usb: check USB configuration descriptor object\n\nWhen processing remote NDIS control message packets, the USB Net\ndevice emulator checks to see if the USB configuration descriptor\nobject is of RNDIS type(2). But it does not check if it is null,\nwhich leads to a null dereference error. Add check to avoid it.\n\nReported-by: Qinghao Tang <luodalongde@gmail.com>\nSigned-off-by: Prasad J Pandit <pjp@fedoraproject.org>\nMessage-id: 1455188480-14688-1-git-send-email-ppandit@redhat.com\nSigned-off-by: Gerd Hoffmann <kraxel@redhat.com>",
    "before_after_code_files": [
      "hw/usb/dev-network.c||hw/usb/dev-network.c"
    ]
  },
  "patch_diff": {
    "hw/usb/dev-network.c||hw/usb/dev-network.c": [
      "File: hw/usb/dev-network.c -> hw/usb/dev-network.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "655: static int is_rndis(USBNetState *s)",
      "656: {",
      "658: }",
      "660: static int ndis_query(USBNetState *s, uint32_t oid,",
      "",
      "[Removed Lines]",
      "657:     return s->dev.config->bConfigurationValue == DEV_RNDIS_CONFIG_VALUE;",
      "",
      "[Added Lines]",
      "657:     return s->dev.config ?",
      "658:             s->dev.config->bConfigurationValue == DEV_RNDIS_CONFIG_VALUE : 0;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "80b6e5723fac428ea6c08c821078286f43975df8",
      "candidate_info": {
        "commit_hash": "80b6e5723fac428ea6c08c821078286f43975df8",
        "repo": "qemu/qemu",
        "commit_url": "https://github.com/qemu/qemu/commit/80b6e5723fac428ea6c08c821078286f43975df8",
        "files": [
          "hw/usb/dev-network.c"
        ],
        "message": "usb: check USB configuration descriptor object\n\nWhen processing remote NDIS control message packets, the USB Net\ndevice emulator checks to see if the USB configuration descriptor\nobject is of RNDIS type(2). But it does not check if it is null,\nwhich leads to a null dereference error. Add check to avoid it.\n\nReported-by: Qinghao Tang <luodalongde@gmail.com>\nSigned-off-by: Prasad J Pandit <pjp@fedoraproject.org>\nMessage-id: 1455188480-14688-1-git-send-email-ppandit@redhat.com\nSigned-off-by: Gerd Hoffmann <kraxel@redhat.com>\n(cherry picked from commit 80eecda8e5d09c442c24307f340840a5b70ea3b9)\nSigned-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>",
        "before_after_code_files": [
          "hw/usb/dev-network.c||hw/usb/dev-network.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "hw/usb/dev-network.c||hw/usb/dev-network.c"
          ],
          "candidate": [
            "hw/usb/dev-network.c||hw/usb/dev-network.c"
          ]
        }
      },
      "candidate_diff": {
        "hw/usb/dev-network.c||hw/usb/dev-network.c": [
          "File: hw/usb/dev-network.c -> hw/usb/dev-network.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "654: static int is_rndis(USBNetState *s)",
          "655: {",
          "657: }",
          "659: static int ndis_query(USBNetState *s, uint32_t oid,",
          "",
          "[Removed Lines]",
          "656:     return s->dev.config->bConfigurationValue == DEV_RNDIS_CONFIG_VALUE;",
          "",
          "[Added Lines]",
          "656:     return s->dev.config ?",
          "657:             s->dev.config->bConfigurationValue == DEV_RNDIS_CONFIG_VALUE : 0;",
          "",
          "---------------"
        ]
      }
    }
  ]
}