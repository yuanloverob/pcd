{
  "cve_id": "CVE-2016-8610",
  "cve_desc": "A denial of service flaw was found in OpenSSL 0.9.8, 1.0.1, 1.0.2 through 1.0.2h, and 1.1.0 in the way the TLS/SSL protocol defined processing of ALERT packets during a connection handshake. A remote attacker could use this flaw to make a TLS/SSL server consume an excessive amount of CPU and fail to accept connections from other clients.",
  "repo": "openssl/openssl",
  "patch_hash": "af58be768ebb690f78530f796e92b8ae5c9a4401",
  "patch_info": {
    "commit_hash": "af58be768ebb690f78530f796e92b8ae5c9a4401",
    "repo": "openssl/openssl",
    "commit_url": "https://github.com/openssl/openssl/commit/af58be768ebb690f78530f796e92b8ae5c9a4401",
    "files": [
      "include/openssl/ssl.h",
      "ssl/record/rec_layer_d1.c",
      "ssl/record/rec_layer_s3.c",
      "ssl/record/record.h",
      "ssl/record/record_locl.h",
      "ssl/ssl_err.c"
    ],
    "message": "Don't allow too many consecutive warning alerts\n\nCertain warning alerts are ignored if they are received. This can mean that\nno progress will be made if one peer continually sends those warning alerts.\nImplement a count so that we abort the connection if we receive too many.\n\nIssue reported by Shi Lei.\n\nReviewed-by: Rich Salz <rsalz@openssl.org>",
    "before_after_code_files": [
      "include/openssl/ssl.h||include/openssl/ssl.h",
      "ssl/record/rec_layer_d1.c||ssl/record/rec_layer_d1.c",
      "ssl/record/rec_layer_s3.c||ssl/record/rec_layer_s3.c",
      "ssl/record/record.h||ssl/record/record.h",
      "ssl/record/record_locl.h||ssl/record/record_locl.h",
      "ssl/ssl_err.c||ssl/ssl_err.c"
    ]
  },
  "patch_diff": {
    "include/openssl/ssl.h||include/openssl/ssl.h": [
      "File: include/openssl/ssl.h -> include/openssl/ssl.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "2485: # define SSL_R_TLS_HEARTBEAT_PENDING                      366",
      "2486: # define SSL_R_TLS_ILLEGAL_EXPORTER_LABEL                 367",
      "2487: # define SSL_R_TLS_INVALID_ECPOINTFORMAT_LIST             157",
      "2488: # define SSL_R_UNABLE_TO_FIND_ECDH_PARAMETERS             314",
      "2489: # define SSL_R_UNABLE_TO_FIND_PUBLIC_KEY_PARAMETERS       239",
      "2490: # define SSL_R_UNABLE_TO_LOAD_SSL3_MD5_ROUTINES           242",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "2488: # define SSL_R_TOO_MANY_WARN_ALERTS                       409",
      "",
      "---------------"
    ],
    "ssl/record/rec_layer_d1.c||ssl/record/rec_layer_d1.c": [
      "File: ssl/record/rec_layer_d1.c -> ssl/record/rec_layer_d1.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "443:         }",
      "444:     }",
      "448:     if (s->s3->change_cipher_spec /* set when we receive ChangeCipherSpec,",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "450:     if (SSL3_RECORD_get_type(rr) != SSL3_RT_ALERT",
      "451:             && SSL3_RECORD_get_length(rr) != 0)",
      "452:         s->rlayer.alert_count = 0;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "723:         if (alert_level == SSL3_AL_WARNING) {",
      "724:             s->s3->warn_alert = alert_descr;",
      "725:             if (alert_descr == SSL_AD_CLOSE_NOTIFY) {",
      "726: #ifndef OPENSSL_NO_SCTP",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "734:             s->rlayer.alert_count++;",
      "735:             if (s->rlayer.alert_count == MAX_WARN_ALERT_COUNT) {",
      "736:                 al = SSL_AD_UNEXPECTED_MESSAGE;",
      "737:                 SSLerr(SSL_F_DTLS1_READ_BYTES, SSL_R_TOO_MANY_WARN_ALERTS);",
      "738:                 goto f_err;",
      "739:             }",
      "",
      "---------------"
    ],
    "ssl/record/rec_layer_s3.c||ssl/record/rec_layer_s3.c": [
      "File: ssl/record/rec_layer_s3.c -> ssl/record/rec_layer_s3.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1063:     } while (num_recs == 0);",
      "1064:     rr = &rr[curr_rec];",
      "1068:     if (s->s3->change_cipher_spec /* set when we receive ChangeCipherSpec,",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1070:     if (SSL3_RECORD_get_type(rr) != SSL3_RT_ALERT",
      "1071:             && SSL3_RECORD_get_length(rr) != 0)",
      "1072:         s->rlayer.alert_count = 0;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "1333:         if (alert_level == SSL3_AL_WARNING) {",
      "1334:             s->s3->warn_alert = alert_descr;",
      "1335:             SSL3_RECORD_set_read(rr);",
      "1336:             if (alert_descr == SSL_AD_CLOSE_NOTIFY) {",
      "1337:                 s->shutdown |= SSL_RECEIVED_SHUTDOWN;",
      "1338:                 return (0);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1345:             s->rlayer.alert_count++;",
      "1346:             if (s->rlayer.alert_count == MAX_WARN_ALERT_COUNT) {",
      "1347:                 al = SSL_AD_UNEXPECTED_MESSAGE;",
      "1348:                 SSLerr(SSL_F_SSL3_READ_BYTES, SSL_R_TOO_MANY_WARN_ALERTS);",
      "1349:                 goto f_err;",
      "1350:             }",
      "",
      "---------------"
    ],
    "ssl/record/record.h||ssl/record/record.h": [
      "File: ssl/record/record.h -> ssl/record/record.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "178:     unsigned char write_sequence[SEQ_NUM_SIZE];",
      "180:     unsigned int is_first_record;",
      "181:     DTLS_RECORD_LAYER *d;",
      "182: } RECORD_LAYER;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "182:     unsigned int alert_count;",
      "",
      "---------------"
    ],
    "ssl/record/record_locl.h||ssl/record/record_locl.h": [
      "File: ssl/record/record_locl.h -> ssl/record/record_locl.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "19: #define RECORD_LAYER_get_rbuf(rl)               (&(rl)->rbuf)",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "17: #define MAX_WARN_ALERT_COUNT    5",
      "",
      "---------------"
    ],
    "ssl/ssl_err.c||ssl/ssl_err.c": [
      "File: ssl/ssl_err.c -> ssl/ssl_err.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "617:      \"tls illegal exporter label\"},",
      "618:     {ERR_REASON(SSL_R_TLS_INVALID_ECPOINTFORMAT_LIST),",
      "619:      \"tls invalid ecpointformat list\"},",
      "620:     {ERR_REASON(SSL_R_UNABLE_TO_FIND_ECDH_PARAMETERS),",
      "621:      \"unable to find ecdh parameters\"},",
      "622:     {ERR_REASON(SSL_R_UNABLE_TO_FIND_PUBLIC_KEY_PARAMETERS),",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "620:     {ERR_REASON(SSL_R_TOO_MANY_WARN_ALERTS), \"too many warn alerts\"},",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "0b367d79552401c221affa406b978a5b33d79032",
      "candidate_info": {
        "commit_hash": "0b367d79552401c221affa406b978a5b33d79032",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/0b367d79552401c221affa406b978a5b33d79032",
        "files": [
          "include/openssl/ssl.h",
          "ssl/record/rec_layer_s3.c",
          "ssl/ssl_err.c"
        ],
        "message": "TLSv1.3 alerts cannot be fragmented and only one per record\n\nWe should be validating that.\n\nReviewed-by: Tim Hudson <tjh@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/3436)",
        "before_after_code_files": [
          "include/openssl/ssl.h||include/openssl/ssl.h",
          "ssl/record/rec_layer_s3.c||ssl/record/rec_layer_s3.c",
          "ssl/ssl_err.c||ssl/ssl_err.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "include/openssl/ssl.h||include/openssl/ssl.h",
            "ssl/record/rec_layer_s3.c||ssl/record/rec_layer_s3.c",
            "ssl/ssl_err.c||ssl/ssl_err.c"
          ],
          "candidate": [
            "include/openssl/ssl.h||include/openssl/ssl.h",
            "ssl/record/rec_layer_s3.c||ssl/record/rec_layer_s3.c",
            "ssl/ssl_err.c||ssl/ssl_err.c"
          ]
        }
      },
      "candidate_diff": {
        "include/openssl/ssl.h||include/openssl/ssl.h": [
          "File: include/openssl/ssl.h -> include/openssl/ssl.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "2650: # define SSL_R_INAPPROPRIATE_FALLBACK                     373",
          "2651: # define SSL_R_INCONSISTENT_COMPRESSION                   340",
          "2652: # define SSL_R_INCONSISTENT_EXTMS                         104",
          "2653: # define SSL_R_INVALID_COMMAND                            280",
          "2654: # define SSL_R_INVALID_COMPRESSION_ALGORITHM              341",
          "2655: # define SSL_R_INVALID_CONFIGURATION_NAME                 113",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2653: # define SSL_R_INVALID_ALERT                              205",
          "",
          "---------------"
        ],
        "ssl/record/rec_layer_s3.c||ssl/record/rec_layer_s3.c": [
          "File: ssl/record/rec_layer_s3.c -> ssl/record/rec_layer_s3.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1422:             if (SSL3_RECORD_get_length(rr) == 0)",
          "1423:                 SSL3_RECORD_set_read(rr);",
          "1425:             if (*dest_len < dest_maxlen)",
          "1427:         }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1425:             if (SSL_IS_TLS13(s)",
          "1426:                     && SSL3_RECORD_get_type(rr) == SSL3_RT_ALERT) {",
          "1427:                 if (*dest_len < dest_maxlen",
          "1428:                         || SSL3_RECORD_get_length(rr) != 0) {",
          "1433:                     al = SSL_AD_UNEXPECTED_MESSAGE;",
          "1434:                     SSLerr(SSL_F_SSL3_READ_BYTES, SSL_R_INVALID_ALERT);",
          "1435:                     goto f_err;",
          "1436:                 }",
          "1437:             }",
          "",
          "---------------"
        ],
        "ssl/ssl_err.c||ssl/ssl_err.c": [
          "File: ssl/ssl_err.c -> ssl/ssl_err.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "609:     {ERR_REASON(SSL_R_INAPPROPRIATE_FALLBACK), \"inappropriate fallback\"},",
          "610:     {ERR_REASON(SSL_R_INCONSISTENT_COMPRESSION), \"inconsistent compression\"},",
          "611:     {ERR_REASON(SSL_R_INCONSISTENT_EXTMS), \"inconsistent extms\"},",
          "612:     {ERR_REASON(SSL_R_INVALID_COMMAND), \"invalid command\"},",
          "613:     {ERR_REASON(SSL_R_INVALID_COMPRESSION_ALGORITHM),",
          "614:      \"invalid compression algorithm\"},",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "612:     {ERR_REASON(SSL_R_INVALID_ALERT), \"invalid alert\"},",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "70ef40a05e06d055a89c6c8f9309f047e7e834f1",
      "candidate_info": {
        "commit_hash": "70ef40a05e06d055a89c6c8f9309f047e7e834f1",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/70ef40a05e06d055a89c6c8f9309f047e7e834f1",
        "files": [
          "include/openssl/ssl.h",
          "ssl/record/ssl3_record.c",
          "ssl/ssl_err.c",
          "ssl/ssl_locl.h"
        ],
        "message": "Check max_early_data against the amount of early data we actually receive\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/2737)",
        "before_after_code_files": [
          "include/openssl/ssl.h||include/openssl/ssl.h",
          "ssl/record/ssl3_record.c||ssl/record/ssl3_record.c",
          "ssl/ssl_err.c||ssl/ssl_err.c",
          "ssl/ssl_locl.h||ssl/ssl_locl.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "include/openssl/ssl.h||include/openssl/ssl.h",
            "ssl/ssl_err.c||ssl/ssl_err.c"
          ],
          "candidate": [
            "include/openssl/ssl.h||include/openssl/ssl.h",
            "ssl/ssl_err.c||ssl/ssl_err.c"
          ]
        }
      },
      "candidate_diff": {
        "include/openssl/ssl.h||include/openssl/ssl.h": [
          "File: include/openssl/ssl.h -> include/openssl/ssl.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "2154: # define SSL_F_DTLS_CONSTRUCT_HELLO_VERIFY_REQUEST        385",
          "2155: # define SSL_F_DTLS_GET_REASSEMBLED_MESSAGE               370",
          "2156: # define SSL_F_DTLS_PROCESS_HELLO_VERIFY                  386",
          "2157: # define SSL_F_FINAL_EC_PT_FORMATS                        485",
          "2158: # define SSL_F_FINAL_EMS                                  486",
          "2159: # define SSL_F_FINAL_KEY_SHARE                            503",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2157: # define SSL_F_EARLY_DATA_COUNT_OK                        532",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2679: # define SSL_R_TLS_INVALID_ECPOINTFORMAT_LIST             157",
          "2680: # define SSL_R_TOO_MANY_KEY_UPDATES                       132",
          "2681: # define SSL_R_TOO_MANY_WARN_ALERTS                       409",
          "2682: # define SSL_R_UNABLE_TO_FIND_ECDH_PARAMETERS             314",
          "2683: # define SSL_R_UNABLE_TO_FIND_PUBLIC_KEY_PARAMETERS       239",
          "2684: # define SSL_R_UNABLE_TO_LOAD_SSL3_MD5_ROUTINES           242",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2683: # define SSL_R_TOO_MUCH_EARLY_DATA                        164",
          "",
          "---------------"
        ],
        "ssl/record/ssl3_record.c||ssl/record/ssl3_record.c": [
          "File: ssl/record/ssl3_record.c -> ssl/record/ssl3_record.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "101:     return 1;",
          "102: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "104: static int early_data_count_ok(SSL *s, size_t length, size_t overhead, int *al)",
          "105: {",
          "106:     uint32_t max_early_data = s->max_early_data;",
          "112:     if (s->session->ext.max_early_data < s->max_early_data)",
          "113:         max_early_data = s->max_early_data;",
          "115:     if (max_early_data == 0) {",
          "117:         SSLerr(SSL_F_EARLY_DATA_COUNT_OK, SSL_R_TOO_MUCH_EARLY_DATA);",
          "118:         return 0;",
          "119:     }",
          "122:     max_early_data += overhead;",
          "124:     s->early_data_count += length;",
          "125:     if (s->early_data_count > max_early_data) {",
          "127:         SSLerr(SSL_F_EARLY_DATA_COUNT_OK, SSL_R_TOO_MUCH_EARLY_DATA);",
          "128:         return 0;",
          "129:     }",
          "131:     return 1;",
          "132: }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "139:     int imac_size;",
          "140:     size_t num_recs = 0, max_recs, j;",
          "141:     PACKET pkt, sslv2pkt;",
          "143:     rr = RECORD_LAYER_get_rrec(&s->rlayer);",
          "144:     rbuf = RECORD_LAYER_get_rbuf(&s->rlayer);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "172:     size_t first_rec_len;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "415:         }",
          "416:     }",
          "418:     enc_err = s->method->ssl3_enc->enc(s, rr, num_recs, 0);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "449:     first_rec_len = rr[0].length;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "432:             thisrr = &rr[0];",
          "433:             thisrr->length = 0;",
          "434:             thisrr->read = 1;",
          "435:             RECORD_LAYER_set_numrpipes(&s->rlayer, 1);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "468:             if (!early_data_count_ok(s, thisrr->length,",
          "469:                                      EARLY_DATA_CIPHERTEXT_OVERHEAD, &al))",
          "470:                 goto f_err;",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "516:             thisrr = &rr[0];",
          "517:             thisrr->length = 0;",
          "518:             thisrr->read = 1;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "560:             if (!early_data_count_ok(s, first_rec_len,",
          "561:                                      EARLY_DATA_CIPHERTEXT_OVERHEAD, &al))",
          "562:                 goto f_err;",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "604:         }",
          "605:     }",
          "607:     RECORD_LAYER_set_numrpipes(&s->rlayer, num_recs);",
          "608:     return 1;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "655:     if (s->early_data_state == SSL_EARLY_DATA_READING) {",
          "656:         thisrr = &rr[0];",
          "657:         if (thisrr->type == SSL3_RT_APPLICATION_DATA",
          "658:                 && !early_data_count_ok(s, thisrr->length, 0, &al))",
          "659:             goto f_err;",
          "660:     }",
          "",
          "---------------"
        ],
        "ssl/ssl_err.c||ssl/ssl_err.c": [
          "File: ssl/ssl_err.c -> ssl/ssl_err.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "52:     {ERR_FUNC(SSL_F_DTLS_GET_REASSEMBLED_MESSAGE),",
          "53:      \"dtls_get_reassembled_message\"},",
          "54:     {ERR_FUNC(SSL_F_DTLS_PROCESS_HELLO_VERIFY), \"dtls_process_hello_verify\"},",
          "55:     {ERR_FUNC(SSL_F_FINAL_EC_PT_FORMATS), \"final_ec_pt_formats\"},",
          "56:     {ERR_FUNC(SSL_F_FINAL_EMS), \"final_ems\"},",
          "57:     {ERR_FUNC(SSL_F_FINAL_KEY_SHARE), \"final_key_share\"},",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "55:     {ERR_FUNC(SSL_F_EARLY_DATA_COUNT_OK), \"early_data_count_ok\"},",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "788:      \"tls invalid ecpointformat list\"},",
          "789:     {ERR_REASON(SSL_R_TOO_MANY_KEY_UPDATES), \"too many key updates\"},",
          "790:     {ERR_REASON(SSL_R_TOO_MANY_WARN_ALERTS), \"too many warn alerts\"},",
          "791:     {ERR_REASON(SSL_R_UNABLE_TO_FIND_ECDH_PARAMETERS),",
          "792:      \"unable to find ecdh parameters\"},",
          "793:     {ERR_REASON(SSL_R_UNABLE_TO_FIND_PUBLIC_KEY_PARAMETERS),",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "792:     {ERR_REASON(SSL_R_TOO_MUCH_EARLY_DATA), \"too much early data\"},",
          "",
          "---------------"
        ],
        "ssl/ssl_locl.h||ssl/ssl_locl.h": [
          "File: ssl/ssl_locl.h -> ssl/ssl_locl.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "626:     SSL_EARLY_DATA_FINISHED_READING",
          "627: } SSL_EARLY_DATA_STATE;",
          "629: #define MAX_COMPRESSIONS_SIZE   255",
          "631: struct ssl_comp_st {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "639: # define EARLY_DATA_CIPHERTEXT_OVERHEAD ((6 * (EVP_GCM_TLS_TAG_LEN + 1)) + 2)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1245:     ASYNC_WAIT_CTX *waitctx;",
          "1246:     size_t asyncrw;",
          "1249:     uint32_t max_early_data;",
          "1251:     CRYPTO_RWLOCK *lock;",
          "1252: };",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1267:     uint32_t early_data_count;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "e1c3de4450ccac6c981d0cab3c78f87220ac79fa",
      "candidate_info": {
        "commit_hash": "e1c3de4450ccac6c981d0cab3c78f87220ac79fa",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/e1c3de4450ccac6c981d0cab3c78f87220ac79fa",
        "files": [
          "include/openssl/ssl.h",
          "ssl/ssl_err.c",
          "ssl/statem/statem_clnt.c",
          "ssl/statem/statem_lib.c",
          "ssl/statem/statem_locl.h"
        ],
        "message": "Add the ability for a client to receive a KeyUpdate message\n\nThis just receives the message. It doesn't actually update any keys yet.\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/2609)",
        "before_after_code_files": [
          "include/openssl/ssl.h||include/openssl/ssl.h",
          "ssl/ssl_err.c||ssl/ssl_err.c",
          "ssl/statem/statem_clnt.c||ssl/statem/statem_clnt.c",
          "ssl/statem/statem_lib.c||ssl/statem/statem_lib.c",
          "ssl/statem/statem_locl.h||ssl/statem/statem_locl.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "include/openssl/ssl.h||include/openssl/ssl.h",
            "ssl/ssl_err.c||ssl/ssl_err.c"
          ],
          "candidate": [
            "include/openssl/ssl.h||include/openssl/ssl.h",
            "ssl/ssl_err.c||ssl/ssl_err.c"
          ]
        }
      },
      "candidate_diff": {
        "include/openssl/ssl.h||include/openssl/ssl.h": [
          "File: include/openssl/ssl.h -> include/openssl/ssl.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "892:     TLS_ST_SW_HELLO_RETRY_REQUEST,",
          "893:     TLS_ST_CR_HELLO_RETRY_REQUEST,",
          "894:     TLS_ST_SW_KEY_UPDATE,",
          "896: } OSSL_HANDSHAKE_STATE;",
          "",
          "[Removed Lines]",
          "895:     TLS_ST_CW_KEY_UPDATE",
          "",
          "[Added Lines]",
          "895:     TLS_ST_CW_KEY_UPDATE,",
          "896:     TLS_ST_SR_KEY_UPDATE,",
          "897:     TLS_ST_CR_KEY_UPDATE",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2375: # define SSL_F_TLS_PROCESS_HELLO_RETRY_REQUEST            511",
          "2376: # define SSL_F_TLS_PROCESS_INITIAL_SERVER_FLIGHT          442",
          "2377: # define SSL_F_TLS_PROCESS_KEY_EXCHANGE                   365",
          "2378: # define SSL_F_TLS_PROCESS_NEW_SESSION_TICKET             366",
          "2379: # define SSL_F_TLS_PROCESS_NEXT_PROTO                     383",
          "2380: # define SSL_F_TLS_PROCESS_SERVER_CERTIFICATE             367",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2380: # define SSL_F_TLS_PROCESS_KEY_UPDATE                     513",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "2406: # define SSL_R_BAD_HANDSHAKE_LENGTH                       332",
          "2407: # define SSL_R_BAD_HELLO_REQUEST                          105",
          "2408: # define SSL_R_BAD_KEY_SHARE                              108",
          "2409: # define SSL_R_BAD_LENGTH                                 271",
          "2410: # define SSL_R_BAD_PACKET_LENGTH                          115",
          "2411: # define SSL_R_BAD_PROTOCOL_VERSION_NUMBER                116",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2412: # define SSL_R_BAD_KEY_UPDATE                             122",
          "",
          "---------------"
        ],
        "ssl/ssl_err.c||ssl/ssl_err.c": [
          "File: ssl/ssl_err.c -> ssl/ssl_err.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "422:     {ERR_FUNC(SSL_F_TLS_PROCESS_INITIAL_SERVER_FLIGHT),",
          "423:      \"tls_process_initial_server_flight\"},",
          "424:     {ERR_FUNC(SSL_F_TLS_PROCESS_KEY_EXCHANGE), \"tls_process_key_exchange\"},",
          "425:     {ERR_FUNC(SSL_F_TLS_PROCESS_NEW_SESSION_TICKET),",
          "426:      \"tls_process_new_session_ticket\"},",
          "427:     {ERR_FUNC(SSL_F_TLS_PROCESS_NEXT_PROTO), \"tls_process_next_proto\"},",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "425:     {ERR_FUNC(SSL_F_TLS_PROCESS_KEY_UPDATE), \"tls_process_key_update\"},",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "464:     {ERR_REASON(SSL_R_BAD_HANDSHAKE_LENGTH), \"bad handshake length\"},",
          "465:     {ERR_REASON(SSL_R_BAD_HELLO_REQUEST), \"bad hello request\"},",
          "466:     {ERR_REASON(SSL_R_BAD_KEY_SHARE), \"bad key share\"},",
          "467:     {ERR_REASON(SSL_R_BAD_LENGTH), \"bad length\"},",
          "468:     {ERR_REASON(SSL_R_BAD_PACKET_LENGTH), \"bad packet length\"},",
          "469:     {ERR_REASON(SSL_R_BAD_PROTOCOL_VERSION_NUMBER),",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "468:     {ERR_REASON(SSL_R_BAD_KEY_UPDATE), \"bad key update\"},",
          "",
          "---------------"
        ],
        "ssl/statem/statem_clnt.c||ssl/statem/statem_clnt.c": [
          "File: ssl/statem/statem_clnt.c -> ssl/statem/statem_clnt.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "200:             st->hand_state = TLS_ST_CR_SESSION_TICKET;",
          "201:             return 1;",
          "202:         }",
          "203:         break;",
          "204:     }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "203:         if (mt == SSL3_MT_KEY_UPDATE) {",
          "204:             st->hand_state = TLS_ST_CR_KEY_UPDATE;",
          "205:             return 1;",
          "206:         }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "439:         st->hand_state = TLS_ST_CW_FINISHED;",
          "440:         return WRITE_TRAN_CONTINUE;",
          "442:     case TLS_ST_CR_SESSION_TICKET:",
          "443:     case TLS_ST_CW_FINISHED:",
          "444:         st->hand_state = TLS_ST_OK;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "446:     case TLS_ST_CR_KEY_UPDATE:",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "844:     case TLS_ST_CR_ENCRYPTED_EXTENSIONS:",
          "845:         return ENCRYPTED_EXTENSIONS_MAX_LENGTH;",
          "846:     }",
          "847: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "852:     case TLS_ST_CR_KEY_UPDATE:",
          "853:         return KEY_UPDATE_MAX_LENGTH;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "900:     case TLS_ST_CR_ENCRYPTED_EXTENSIONS:",
          "901:         return tls_process_encrypted_extensions(s, pkt);",
          "902:     }",
          "903: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "911:     case TLS_ST_CR_KEY_UPDATE:",
          "912:         return tls_process_key_update(s, pkt);",
          "",
          "---------------"
        ],
        "ssl/statem/statem_lib.c||ssl/statem/statem_lib.c": [
          "File: ssl/statem/statem_lib.c -> ssl/statem/statem_lib.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "508:     return 0;",
          "509: }",
          "511: #ifndef OPENSSL_NO_NEXTPROTONEG",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "512: MSG_PROCESS_RETURN tls_process_key_update(SSL *s, PACKET *pkt)",
          "513: {",
          "514:     unsigned int updatetype;",
          "516:     if (!PACKET_get_1(pkt, &updatetype)",
          "517:             || PACKET_remaining(pkt) != 0",
          "518:             || (updatetype != SSL_KEY_UPDATE_NOT_REQUESTED",
          "519:                 && updatetype != SSL_KEY_UPDATE_REQUESTED)) {",
          "520:         ssl3_send_alert(s, SSL3_AL_FATAL, SSL_AD_DECODE_ERROR);",
          "521:         SSLerr(SSL_F_TLS_PROCESS_KEY_UPDATE, SSL_R_BAD_KEY_UPDATE);",
          "522:         ossl_statem_set_error(s);",
          "523:         return MSG_PROCESS_ERROR;",
          "524:     }",
          "526:     return MSG_PROCESS_FINISHED_READING;",
          "527: }",
          "",
          "---------------"
        ],
        "ssl/statem/statem_locl.h||ssl/statem/statem_locl.h": [
          "File: ssl/statem/statem_locl.h -> ssl/statem/statem_locl.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "23: #define ENCRYPTED_EXTENSIONS_MAX_LENGTH 20000",
          "24: #define SERVER_KEY_EXCH_MAX_LENGTH      102400",
          "25: #define SERVER_HELLO_DONE_MAX_LENGTH    0",
          "26: #define CCS_MAX_LENGTH                  1",
          "28: #define FINISHED_MAX_LENGTH             64",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "26: #define KEY_UPDATE_MAX_LENGTH           1",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "113: __owur int tls_construct_finished(SSL *s, WPACKET *pkt);",
          "114: __owur int tls_construct_key_update(SSL *s, WPACKET *pkt);",
          "115: __owur WORK_STATE tls_finish_handshake(SSL *s, WORK_STATE wst, int clearbufs);",
          "116: __owur WORK_STATE dtls_wait_for_dry(SSL *s);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "116: __owur MSG_PROCESS_RETURN tls_process_key_update(SSL *s, PACKET *pkt);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "049043127209a4a1846a1c0fcc56eff601c41be2",
      "candidate_info": {
        "commit_hash": "049043127209a4a1846a1c0fcc56eff601c41be2",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/049043127209a4a1846a1c0fcc56eff601c41be2",
        "files": [
          "include/openssl/ssl.h",
          "include/openssl/tls1.h",
          "ssl/ssl_err.c",
          "ssl/ssl_locl.h",
          "ssl/statem/extensions.c",
          "ssl/t1_lib.c",
          "ssl/tls13_enc.c",
          "test/tls13secretstest.c"
        ],
        "message": "Verify that the sig algs extension has been sent for TLSv1.3\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/2157)",
        "before_after_code_files": [
          "include/openssl/ssl.h||include/openssl/ssl.h",
          "include/openssl/tls1.h||include/openssl/tls1.h",
          "ssl/ssl_err.c||ssl/ssl_err.c",
          "ssl/ssl_locl.h||ssl/ssl_locl.h",
          "ssl/statem/extensions.c||ssl/statem/extensions.c",
          "ssl/t1_lib.c||ssl/t1_lib.c",
          "ssl/tls13_enc.c||ssl/tls13_enc.c",
          "test/tls13secretstest.c||test/tls13secretstest.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "include/openssl/ssl.h||include/openssl/ssl.h",
            "ssl/ssl_err.c||ssl/ssl_err.c"
          ],
          "candidate": [
            "include/openssl/ssl.h||include/openssl/ssl.h",
            "ssl/ssl_err.c||ssl/ssl_err.c"
          ]
        }
      },
      "candidate_diff": {
        "include/openssl/ssl.h||include/openssl/ssl.h": [
          "File: include/openssl/ssl.h -> include/openssl/ssl.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "985: # define SSL_AD_INTERNAL_ERROR           TLS1_AD_INTERNAL_ERROR",
          "986: # define SSL_AD_USER_CANCELLED           TLS1_AD_USER_CANCELLED",
          "987: # define SSL_AD_NO_RENEGOTIATION         TLS1_AD_NO_RENEGOTIATION",
          "988: # define SSL_AD_UNSUPPORTED_EXTENSION    TLS1_AD_UNSUPPORTED_EXTENSION",
          "989: # define SSL_AD_CERTIFICATE_UNOBTAINABLE TLS1_AD_CERTIFICATE_UNOBTAINABLE",
          "990: # define SSL_AD_UNRECOGNIZED_NAME        TLS1_AD_UNRECOGNIZED_NAME",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "988: # define SSL_AD_MISSING_EXTENSION        TLS13_AD_MISSING_EXTENSION",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2077: # define SSL_F_FINAL_EC_PT_FORMATS                        485",
          "2078: # define SSL_F_FINAL_EMS                                  486",
          "2079: # define SSL_F_FINAL_RENEGOTIATE                          483",
          "2080: # define SSL_F_OPENSSL_INIT_SSL                           342",
          "2081: # define SSL_F_OSSL_STATEM_CLIENT13_READ_TRANSITION       436",
          "2082: # define SSL_F_OSSL_STATEM_CLIENT_CONSTRUCT_MESSAGE       430",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2081: # define SSL_F_FINAL_SIG_ALGS                             497",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "2446: # define SSL_R_MISSING_RSA_CERTIFICATE                    168",
          "2447: # define SSL_R_MISSING_RSA_ENCRYPTING_CERT                169",
          "2448: # define SSL_R_MISSING_RSA_SIGNING_CERT                   170",
          "2449: # define SSL_R_MISSING_SRP_PARAM                          358",
          "2450: # define SSL_R_MISSING_TMP_DH_KEY                         171",
          "2451: # define SSL_R_MISSING_TMP_ECDH_KEY                       311",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2451: # define SSL_R_MISSING_SIGALGS_EXTENSION                  112",
          "",
          "---------------"
        ],
        "include/openssl/tls1.h||include/openssl/tls1.h": [
          "File: include/openssl/tls1.h -> include/openssl/tls1.h"
        ],
        "ssl/ssl_err.c||ssl/ssl_err.c": [
          "File: ssl/ssl_err.c -> ssl/ssl_err.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "52:     {ERR_FUNC(SSL_F_FINAL_EC_PT_FORMATS), \"final_ec_pt_formats\"},",
          "53:     {ERR_FUNC(SSL_F_FINAL_EMS), \"final_ems\"},",
          "54:     {ERR_FUNC(SSL_F_FINAL_RENEGOTIATE), \"final_renegotiate\"},",
          "55:     {ERR_FUNC(SSL_F_OPENSSL_INIT_SSL), \"OPENSSL_init_ssl\"},",
          "56:     {ERR_FUNC(SSL_F_OSSL_STATEM_CLIENT13_READ_TRANSITION),",
          "57:      \"ossl_statem_client13_read_transition\"},",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "55:     {ERR_FUNC(SSL_F_FINAL_SIG_ALGS), \"final_sig_algs\"},",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "565:     {ERR_REASON(SSL_R_MISSING_RSA_ENCRYPTING_CERT),",
          "566:      \"missing rsa encrypting cert\"},",
          "567:     {ERR_REASON(SSL_R_MISSING_RSA_SIGNING_CERT), \"missing rsa signing cert\"},",
          "568:     {ERR_REASON(SSL_R_MISSING_SRP_PARAM), \"can't find SRP server param\"},",
          "569:     {ERR_REASON(SSL_R_MISSING_TMP_DH_KEY), \"missing tmp dh key\"},",
          "570:     {ERR_REASON(SSL_R_MISSING_TMP_ECDH_KEY), \"missing tmp ecdh key\"},",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "569:     {ERR_REASON(SSL_R_MISSING_SIGALGS_EXTENSION),",
          "570:      \"missing sigalgs extension\"},",
          "",
          "---------------"
        ],
        "ssl/ssl_locl.h||ssl/ssl_locl.h": [
          "File: ssl/ssl_locl.h -> ssl/ssl_locl.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "2102:                                        const unsigned char *p, size_t plen,",
          "2103:                                        int use_context);",
          "2104: __owur int tls1_alert_code(int code);",
          "2105: __owur int ssl3_alert_code(int code);",
          "2106: __owur int ssl_ok(SSL *s);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2105: __owur int tls13_alert_code(int code);",
          "",
          "---------------"
        ],
        "ssl/statem/extensions.c||ssl/statem/extensions.c": [
          "File: ssl/statem/extensions.c -> ssl/statem/extensions.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "38: #ifndef OPENSSL_NO_SRTP",
          "39: static int init_srtp(SSL *s, unsigned int context);",
          "40: #endif",
          "43: typedef struct extensions_definition_st {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "41: static int final_sig_algs(SSL *s, unsigned int context, int sent, int *al);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "152:         TLSEXT_TYPE_signature_algorithms,",
          "153:         EXT_CLIENT_HELLO,",
          "154:         init_sig_algs, tls_parse_ctos_sig_algs, NULL, NULL,",
          "156:     },",
          "157: #ifndef OPENSSL_NO_OCSP",
          "158:     {",
          "",
          "[Removed Lines]",
          "155:         tls_construct_ctos_sig_algs, NULL",
          "",
          "[Added Lines]",
          "156:         tls_construct_ctos_sig_algs, final_sig_algs",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "926:     return 1;",
          "927: }",
          "928: #endif",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "931: static int final_sig_algs(SSL *s, unsigned int context, int sent, int *al)",
          "932: {",
          "933:     if (!sent && SSL_IS_TLS13(s)) {",
          "935:         SSLerr(SSL_F_FINAL_SIG_ALGS, SSL_R_MISSING_SIGALGS_EXTENSION);",
          "936:         return 0;",
          "937:     }",
          "939:     return 1;",
          "940: }",
          "",
          "---------------"
        ],
        "ssl/t1_lib.c||ssl/t1_lib.c": [
          "File: ssl/t1_lib.c -> ssl/t1_lib.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "85:     tls13_final_finish_mac,",
          "86:     TLS_MD_CLIENT_FINISH_CONST, TLS_MD_CLIENT_FINISH_CONST_SIZE,",
          "87:     TLS_MD_SERVER_FINISH_CONST, TLS_MD_SERVER_FINISH_CONST_SIZE,",
          "89:     tls1_export_keying_material,",
          "90:     SSL_ENC_FLAG_SIGALGS | SSL_ENC_FLAG_SHA256_PRF,",
          "91:     ssl3_set_handshake_header,",
          "",
          "[Removed Lines]",
          "88:     tls1_alert_code,",
          "",
          "[Added Lines]",
          "88:     tls13_alert_code,",
          "",
          "---------------"
        ],
        "ssl/tls13_enc.c||ssl/tls13_enc.c": [
          "File: ssl/tls13_enc.c -> ssl/tls13_enc.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "406:     OPENSSL_cleanse(key, sizeof(key));",
          "407:     return ret;",
          "408: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "410: int tls13_alert_code(int code)",
          "411: {",
          "412:     if (code == SSL_AD_MISSING_EXTENSION)",
          "413:         return code;",
          "415:     return tls1_alert_code(code);",
          "416: }",
          "",
          "---------------"
        ],
        "test/tls13secretstest.c||test/tls13secretstest.c": [
          "File: test/tls13secretstest.c -> test/tls13secretstest.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "179:     return 0;",
          "180: }",
          "184: static int test_secret(SSL *s, unsigned char *prk,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "182: int tls1_alert_code(int code)",
          "183: {",
          "184:     return code;",
          "185: }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "03f44b974b1c85804b54af7c3ffb5241d5ffd952",
      "candidate_info": {
        "commit_hash": "03f44b974b1c85804b54af7c3ffb5241d5ffd952",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/03f44b974b1c85804b54af7c3ffb5241d5ffd952",
        "files": [
          "include/openssl/ssl.h",
          "ssl/ssl_err.c",
          "ssl/statem/statem_clnt.c",
          "ssl/statem/statem_srvr.c"
        ],
        "message": "Initial incomplete TLS 1.3 certificate request support.\n\nThis adds partial support for TLS 1.3 certificate request message.\n\nThe request context and extensions are currently ignored on receive\nand set to zero length on send.\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/2728)",
        "before_after_code_files": [
          "include/openssl/ssl.h||include/openssl/ssl.h",
          "ssl/ssl_err.c||ssl/ssl_err.c",
          "ssl/statem/statem_clnt.c||ssl/statem/statem_clnt.c",
          "ssl/statem/statem_srvr.c||ssl/statem/statem_srvr.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "include/openssl/ssl.h||include/openssl/ssl.h",
            "ssl/ssl_err.c||ssl/ssl_err.c"
          ],
          "candidate": [
            "include/openssl/ssl.h||include/openssl/ssl.h",
            "ssl/ssl_err.c||ssl/ssl_err.c"
          ]
        }
      },
      "candidate_diff": {
        "include/openssl/ssl.h||include/openssl/ssl.h": [
          "File: include/openssl/ssl.h -> include/openssl/ssl.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "2503: # define SSL_R_ERROR_SETTING_TLSA_BASE_DOMAIN             204",
          "2504: # define SSL_R_EXCESSIVE_MESSAGE_SIZE                     152",
          "2505: # define SSL_R_EXTRA_DATA_IN_MESSAGE                      153",
          "2506: # define SSL_R_FAILED_TO_INIT_ASYNC                       405",
          "2507: # define SSL_R_FRAGMENTED_CLIENT_HELLO                    401",
          "2508: # define SSL_R_GOT_A_FIN_BEFORE_A_CCS                     154",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2506: # define SSL_R_EXT_LENGTH_MISMATCH                        162",
          "",
          "---------------"
        ],
        "ssl/ssl_err.c||ssl/ssl_err.c": [
          "File: ssl/ssl_err.c -> ssl/ssl_err.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "565:      \"error setting tlsa base domain\"},",
          "566:     {ERR_REASON(SSL_R_EXCESSIVE_MESSAGE_SIZE), \"excessive message size\"},",
          "567:     {ERR_REASON(SSL_R_EXTRA_DATA_IN_MESSAGE), \"extra data in message\"},",
          "568:     {ERR_REASON(SSL_R_FAILED_TO_INIT_ASYNC), \"failed to init async\"},",
          "569:     {ERR_REASON(SSL_R_FRAGMENTED_CLIENT_HELLO), \"fragmented client hello\"},",
          "570:     {ERR_REASON(SSL_R_GOT_A_FIN_BEFORE_A_CCS), \"got a fin before a ccs\"},",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "568:     {ERR_REASON(SSL_R_EXT_LENGTH_MISMATCH), \"ext length mismatch\"},",
          "",
          "---------------"
        ],
        "ssl/statem/statem_clnt.c||ssl/statem/statem_clnt.c": [
          "File: ssl/statem/statem_clnt.c -> ssl/statem/statem_clnt.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2196: MSG_PROCESS_RETURN tls_process_certificate_request(SSL *s, PACKET *pkt)",
          "2197: {",
          "2198:     int ret = MSG_PROCESS_ERROR;",
          "2200:     X509_NAME *xn = NULL;",
          "2201:     const unsigned char *namestart, *namebytes;",
          "2202:     STACK_OF(X509_NAME) *ca_sk = NULL;",
          "2205:     if ((ca_sk = sk_X509_NAME_new(ca_dn_cmp)) == NULL) {",
          "2206:         SSLerr(SSL_F_TLS_PROCESS_CERTIFICATE_REQUEST, ERR_R_MALLOC_FAILURE);",
          "2207:         goto err;",
          "2208:     }",
          "2219:             goto err;",
          "2220:     }",
          "2222:     if (SSL_USE_SIGALGS(s)) {",
          "",
          "[Removed Lines]",
          "2199:     unsigned int list_len, i, name_len;",
          "2203:     PACKET ctypes;",
          "2211:     if (!PACKET_get_length_prefixed_1(pkt, &ctypes)) {",
          "2212:         ssl3_send_alert(s, SSL3_AL_FATAL, SSL_AD_DECODE_ERROR);",
          "2213:         SSLerr(SSL_F_TLS_PROCESS_CERTIFICATE_REQUEST, SSL_R_LENGTH_MISMATCH);",
          "2214:         goto err;",
          "2215:     }",
          "2217:     if (!PACKET_memdup(&ctypes, &s->s3->tmp.ctype, &s->s3->tmp.ctype_len)) {",
          "2218:         SSLerr(SSL_F_TLS_PROCESS_CERTIFICATE_REQUEST, ERR_R_INTERNAL_ERROR);",
          "",
          "[Added Lines]",
          "2199:     unsigned int i, name_len;",
          "2203:     PACKET cadns;",
          "2210:     if (SSL_IS_TLS13(s)) {",
          "2211:         PACKET reqctx;",
          "2214:         OPENSSL_free(s->s3->tmp.ctype);",
          "2215:         s->s3->tmp.ctype = NULL;",
          "2216:         s->s3->tmp.ctype_len = 0;",
          "2218:         if (!PACKET_get_length_prefixed_1(pkt, &reqctx)) {",
          "2219:             SSLerr(SSL_F_TLS_PROCESS_CERTIFICATE_REQUEST,",
          "2220:                    SSL_R_LENGTH_MISMATCH);",
          "2221:             goto err;",
          "2222:         }",
          "2223:     } else {",
          "2224:         PACKET ctypes;",
          "2227:         if (!PACKET_get_length_prefixed_1(pkt, &ctypes)) {",
          "2228:             ssl3_send_alert(s, SSL3_AL_FATAL, SSL_AD_DECODE_ERROR);",
          "2229:             SSLerr(SSL_F_TLS_PROCESS_CERTIFICATE_REQUEST,",
          "2230:                    SSL_R_LENGTH_MISMATCH);",
          "2232:         }",
          "2234:         if (!PACKET_memdup(&ctypes, &s->s3->tmp.ctype, &s->s3->tmp.ctype_len)) {",
          "2235:             SSLerr(SSL_F_TLS_PROCESS_CERTIFICATE_REQUEST, ERR_R_INTERNAL_ERROR);",
          "2236:             goto err;",
          "2237:         }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2246:     }",
          "2251:         ssl3_send_alert(s, SSL3_AL_FATAL, SSL_AD_DECODE_ERROR);",
          "2252:         SSLerr(SSL_F_TLS_PROCESS_CERTIFICATE_REQUEST, SSL_R_LENGTH_MISMATCH);",
          "2253:         goto err;",
          "2254:     }",
          "2259:             ssl3_send_alert(s, SSL3_AL_FATAL, SSL_AD_DECODE_ERROR);",
          "2260:             SSLerr(SSL_F_TLS_PROCESS_CERTIFICATE_REQUEST,",
          "2261:                    SSL_R_LENGTH_MISMATCH);",
          "",
          "[Removed Lines]",
          "2249:     if (!PACKET_get_net_2(pkt, &list_len)",
          "2250:         || PACKET_remaining(pkt) != list_len) {",
          "2256:     while (PACKET_remaining(pkt)) {",
          "2257:         if (!PACKET_get_net_2(pkt, &name_len)",
          "2258:             || !PACKET_get_bytes(pkt, &namebytes, name_len)) {",
          "",
          "[Added Lines]",
          "2267:     if (!PACKET_get_length_prefixed_2(pkt, &cadns)) {",
          "2273:     while (PACKET_remaining(&cadns)) {",
          "2274:         if (!PACKET_get_net_2(&cadns, &name_len)",
          "2275:             || !PACKET_get_bytes(&cadns, &namebytes, name_len)) {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "2283:         }",
          "2284:         xn = NULL;",
          "2285:     }",
          "2288:     s->s3->tmp.cert_req = 1;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2304:     if (SSL_IS_TLS13(s)) {",
          "2305:         PACKET reqexts;",
          "2307:         if (!PACKET_get_length_prefixed_2(pkt, &reqexts)) {",
          "2308:             ssl3_send_alert(s, SSL3_AL_FATAL, SSL_AD_DECODE_ERROR);",
          "2309:             SSLerr(SSL_F_TLS_PROCESS_CERTIFICATE_REQUEST,",
          "2310:                    SSL_R_EXT_LENGTH_MISMATCH);",
          "2311:             goto err;",
          "2312:         }",
          "2313:     }",
          "2315:     if (PACKET_remaining(pkt) != 0) {",
          "2316:         ssl3_send_alert(s, SSL3_AL_FATAL, SSL_AD_DECODE_ERROR);",
          "2317:         SSLerr(SSL_F_TLS_PROCESS_CERTIFICATE_REQUEST, SSL_R_LENGTH_MISMATCH);",
          "2318:         goto err;",
          "2319:     }",
          "",
          "---------------"
        ],
        "ssl/statem/statem_srvr.c||ssl/statem/statem_srvr.c": [
          "File: ssl/statem/statem_srvr.c -> ssl/statem/statem_srvr.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2448:     int i;",
          "2449:     STACK_OF(X509_NAME) *sk = NULL;",
          "2457:     }",
          "2459:     if (SSL_USE_SIGALGS(s)) {",
          "",
          "[Removed Lines]",
          "2452:     if (!WPACKET_start_sub_packet_u8(pkt)",
          "2453:             || !ssl3_get_req_cert_type(s, pkt)",
          "2454:             || !WPACKET_close(pkt)) {",
          "2455:         SSLerr(SSL_F_TLS_CONSTRUCT_CERTIFICATE_REQUEST, ERR_R_INTERNAL_ERROR);",
          "2456:         goto err;",
          "",
          "[Added Lines]",
          "2451:     if (SSL_IS_TLS13(s)) {",
          "2453:         if (!WPACKET_put_bytes_u8(pkt, 0)) {",
          "2454:             SSLerr(SSL_F_TLS_CONSTRUCT_CERTIFICATE_REQUEST,",
          "2455:                    ERR_R_INTERNAL_ERROR);",
          "2456:             goto err;",
          "2457:         }",
          "2458:     } else {",
          "2460:         if (!WPACKET_start_sub_packet_u8(pkt)",
          "2461:             || !ssl3_get_req_cert_type(s, pkt) || !WPACKET_close(pkt)) {",
          "2462:             SSLerr(SSL_F_TLS_CONSTRUCT_CERTIFICATE_REQUEST,",
          "2463:                    ERR_R_INTERNAL_ERROR);",
          "2464:             goto err;",
          "2465:         }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2494:         }",
          "2495:     }",
          "2498:     if (!WPACKET_close(pkt)) {",
          "2499:         SSLerr(SSL_F_TLS_CONSTRUCT_CERTIFICATE_REQUEST, ERR_R_INTERNAL_ERROR);",
          "2500:         goto err;",
          "2501:     }",
          "2503:     s->s3->tmp.cert_request = 1;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2514:     if (SSL_IS_TLS13(s) && !WPACKET_put_bytes_u16(pkt, 0)) {",
          "2515:         SSLerr(SSL_F_TLS_CONSTRUCT_CERTIFICATE_REQUEST, ERR_R_INTERNAL_ERROR);",
          "2516:         goto err;",
          "2517:     }",
          "",
          "---------------"
        ]
      }
    }
  ]
}