{
  "cve_id": "CVE-2015-7551",
  "cve_desc": "The Fiddle::Handle implementation in ext/fiddle/handle.c in Ruby before 2.0.0-p648, 2.1 before 2.1.8, and 2.2 before 2.2.4, as distributed in Apple OS X before 10.11.4 and other products, mishandles tainting, which allows context-dependent attackers to execute arbitrary code or cause a denial of service (application crash) via a crafted string, related to the DL module and the libffi library.  NOTE: this vulnerability exists because of a CVE-2009-5147 regression.",
  "repo": "ruby/ruby",
  "patch_hash": "339e11a7f178312d937b7c95dd3115ce7236597a",
  "patch_info": {
    "commit_hash": "339e11a7f178312d937b7c95dd3115ce7236597a",
    "repo": "ruby/ruby",
    "commit_url": "https://github.com/ruby/ruby/commit/339e11a7f178312d937b7c95dd3115ce7236597a",
    "files": [
      "ChangeLog",
      "ext/fiddle/handle.c",
      "test/fiddle/test_handle.rb",
      "version.h"
    ],
    "message": "merge revision(s): 53153 and 23405@ruby_1_9_1\n\n\t* ext/fiddle/handle.c: check tainted string arguments.\n\t  Patch provided by tenderlove and nobu.\n\n\t* test/fiddle/test_handle.rb (class TestHandle): add test for above.\n\n\t* ext/dl/handle.c (rb_dlhandle_initialize): prohibits DL::dlopen\n\t  with a tainted name of library.\n\t  Patch by sheepman <sheepman AT sheepman.sakura.ne.jp>.\n\n\t* ext/dl/handle.c (rb_dlhandle_sym): ditto\n\n\n\ngit-svn-id: svn+ssh://ci.ruby-lang.org/ruby/branches/ruby_2_1@53156 b2dd03c8-39d4-4d8f-98ff-823fe69b080e",
    "before_after_code_files": [
      "ext/fiddle/handle.c||ext/fiddle/handle.c",
      "test/fiddle/test_handle.rb||test/fiddle/test_handle.rb",
      "version.h||version.h"
    ]
  },
  "patch_diff": {
    "ext/fiddle/handle.c||ext/fiddle/handle.c": [
      "File: ext/fiddle/handle.c -> ext/fiddle/handle.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1: #include <ruby.h>",
      "2: #include <fiddle.h>",
      "4: VALUE rb_cHandle;",
      "6: struct dl_handle {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "4: #define SafeStringValueCStr(v) (rb_check_safe_obj(rb_string_value(&v)), StringValueCStr(v))",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "143:  cflag = RTLD_LAZY | RTLD_GLOBAL;",
      "144:  break;",
      "145:       case 1:",
      "147:  cflag = RTLD_LAZY | RTLD_GLOBAL;",
      "148:  break;",
      "149:       case 2:",
      "151:  cflag = NUM2INT(flag);",
      "152:  break;",
      "153:       default:",
      "",
      "[Removed Lines]",
      "146:  clib = NIL_P(lib) ? NULL : StringValuePtr(lib);",
      "150:  clib = NIL_P(lib) ? NULL : StringValuePtr(lib);",
      "",
      "[Added Lines]",
      "148:  clib = NIL_P(lib) ? NULL : SafeStringValueCStr(lib);",
      "152:  clib = NIL_P(lib) ? NULL : SafeStringValueCStr(lib);",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "263:     return PTR2NUM(fiddle_handle);",
      "264: }",
      "",
      "[Removed Lines]",
      "266: static VALUE fiddle_handle_sym(void *handle, const char *symbol);",
      "",
      "[Added Lines]",
      "268: static VALUE fiddle_handle_sym(void *handle, VALUE symbol);",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "282:  rb_raise(rb_eFiddleError, \"closed handle\");",
      "283:     }",
      "286: }",
      "288: #ifndef RTLD_NEXT",
      "",
      "[Removed Lines]",
      "285:     return fiddle_handle_sym(fiddle_handle->ptr, StringValueCStr(sym));",
      "",
      "[Added Lines]",
      "287:     return fiddle_handle_sym(fiddle_handle->ptr, sym);",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "305: static VALUE",
      "306: rb_fiddle_handle_s_sym(VALUE self, VALUE sym)",
      "307: {",
      "309: }",
      "311: static VALUE",
      "313: {",
      "314: #if defined(HAVE_DLERROR)",
      "315:     const char *err;",
      "",
      "[Removed Lines]",
      "308:     return fiddle_handle_sym(RTLD_NEXT, StringValueCStr(sym));",
      "312: fiddle_handle_sym(void *handle, const char *name)",
      "",
      "[Added Lines]",
      "310:     return fiddle_handle_sym(RTLD_NEXT, sym);",
      "314: fiddle_handle_sym(void *handle, VALUE symbol)",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "318: # define CHECK_DLERROR",
      "319: #endif",
      "320:     void (*func)();",
      "322:     rb_secure(2);",
      "323: #ifdef HAVE_DLERROR",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "323:     const char *name = SafeStringValueCStr(symbol);",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "367:     }",
      "368: #endif",
      "369:     if( !func ){",
      "371:     }",
      "373:     return PTR2NUM(func);",
      "",
      "[Removed Lines]",
      "370:  rb_raise(rb_eFiddleError, \"unknown symbol \\\"%s\\\"\", name);",
      "",
      "[Added Lines]",
      "373:  rb_raise(rb_eFiddleError, \"unknown symbol \\\"%\"PRIsVALUE\"\\\"\", symbol);",
      "",
      "---------------"
    ],
    "test/fiddle/test_handle.rb||test/fiddle/test_handle.rb": [
      "File: test/fiddle/test_handle.rb -> test/fiddle/test_handle.rb",
      "--- Hunk 1 ---",
      "[Context before]",
      "11:     include Test::Unit::Assertions",
      "13:     def test_to_i",
      "14:       handle = Fiddle::Handle.new(LIBC_SO)",
      "15:       assert_kind_of Integer, handle.to_i",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "13:     def test_safe_handle_open",
      "14:       t = Thread.new do",
      "15:         $SAFE = 1",
      "16:         Fiddle::Handle.new(LIBC_SO.taint)",
      "17:       end",
      "18:       assert_raise(SecurityError) { t.value }",
      "19:     end",
      "21:     def test_safe_function_lookup",
      "22:       t = Thread.new do",
      "23:         h = Fiddle::Handle.new(LIBC_SO)",
      "24:         $SAFE = 1",
      "25:         h[\"qsort\".taint]",
      "26:       end",
      "27:       assert_raise(SecurityError) { t.value }",
      "28:     end",
      "",
      "---------------"
    ],
    "version.h||version.h": [
      "File: version.h -> version.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "1: #define RUBY_VERSION \"2.1.8\"",
      "2: #define RUBY_RELEASE_DATE \"2015-12-16\"",
      "5: #define RUBY_RELEASE_YEAR 2015",
      "6: #define RUBY_RELEASE_MONTH 12",
      "",
      "[Removed Lines]",
      "3: #define RUBY_PATCHLEVEL 438",
      "",
      "[Added Lines]",
      "3: #define RUBY_PATCHLEVEL 439",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "ccef579aee4ab784e1a46ea755d2717224f628c2",
      "candidate_info": {
        "commit_hash": "ccef579aee4ab784e1a46ea755d2717224f628c2",
        "repo": "ruby/ruby",
        "commit_url": "https://github.com/ruby/ruby/commit/ccef579aee4ab784e1a46ea755d2717224f628c2",
        "files": [
          "ChangeLog",
          "lib/timeout.rb",
          "test/test_timeout.rb",
          "version.h"
        ],
        "message": "merge revision(s) 51213: [Backport #11344]\n\n\t* lib/timeout.rb (ExitException): removed internal exception class\n\t  and use Timeout::Error instead, as using throw/catch to isolate\n\t  each timeouts now.  [ruby-dev:49179] [Bug #11344]\n\n\ngit-svn-id: svn+ssh://ci.ruby-lang.org/ruby/branches/ruby_2_1@51603 b2dd03c8-39d4-4d8f-98ff-823fe69b080e",
        "before_after_code_files": [
          "lib/timeout.rb||lib/timeout.rb",
          "test/test_timeout.rb||test/test_timeout.rb",
          "version.h||version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.h||version.h"
          ],
          "candidate": [
            "version.h||version.h"
          ]
        }
      },
      "candidate_diff": {
        "lib/timeout.rb||lib/timeout.rb": [
          "File: lib/timeout.rb -> lib/timeout.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "24: module Timeout",
          "25:   # Raised by Timeout#timeout when the block times out.",
          "26:   class Error < RuntimeError",
          "29:     attr_reader :thread",
          "31:     def self.catch(*args)",
          "",
          "[Removed Lines]",
          "27:   end",
          "28:   class ExitException < ::Exception # :nodoc:",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "48:       self",
          "49:     end",
          "50:   end",
          "52:   # :stopdoc:",
          "53:   THIS_FILE = /\\A#{Regexp.quote(__FILE__)}:/o",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "49:   ExitException = Error",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "103:         bt = e.backtrace",
          "104:       end",
          "105:     else",
          "107:     end",
          "108:     rej = /\\A#{Regexp.quote(__FILE__)}:#{__LINE__-4}\\z/o",
          "109:     bt.reject! {|m| rej =~ m}",
          "",
          "[Removed Lines]",
          "106:       bt = ExitException.catch(message, &bl)",
          "",
          "[Added Lines]",
          "105:       bt = Error.catch(message, &bl)",
          "",
          "---------------"
        ],
        "test/test_timeout.rb||test/test_timeout.rb": [
          "File: test/test_timeout.rb -> test/test_timeout.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "63:   end",
          "65:   def test_exit_exception",
          "69:       end",
          "70:     end",
          "71:   end",
          "",
          "[Removed Lines]",
          "66:     assert_raise_with_message(Timeout::ExitException, \"boon\") do",
          "67:       Timeout.timeout(10, Timeout::ExitException) do",
          "68:         raise Timeout::ExitException, \"boon\"",
          "",
          "[Added Lines]",
          "66:     assert_raise_with_message(Timeout::Error, \"boon\") do",
          "67:       Timeout.timeout(10, Timeout::Error) do",
          "68:         raise Timeout::Error, \"boon\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "80:       Timeout.timeout(0.01) {e.next}",
          "81:     end",
          "82:   end",
          "83: end",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "84:   def test_handle_interrupt",
          "85:     bug11344 = '[ruby-dev:49179] [Bug #11344]'",
          "86:     ok = false",
          "87:     assert_raise(Timeout::Error) {",
          "88:       Thread.handle_interrupt(Timeout::Error => :never) {",
          "89:         Timeout.timeout(0.01) {",
          "90:           sleep 0.2",
          "91:           ok = true",
          "92:           Thread.handle_interrupt(Timeout::Error => :on_blocking) {",
          "93:             sleep 0.2",
          "94:           }",
          "95:         }",
          "96:       }",
          "97:     }",
          "98:     assert(ok, bug11344)",
          "99:   end",
          "",
          "---------------"
        ],
        "version.h||version.h": [
          "File: version.h -> version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: #define RUBY_VERSION \"2.1.7\"",
          "2: #define RUBY_RELEASE_DATE \"2015-08-17\"",
          "5: #define RUBY_RELEASE_YEAR 2015",
          "6: #define RUBY_RELEASE_MONTH 8",
          "",
          "[Removed Lines]",
          "3: #define RUBY_PATCHLEVEL 386",
          "",
          "[Added Lines]",
          "3: #define RUBY_PATCHLEVEL 387",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "289889a654c25174faa7093ff8d3162e92f41806",
      "candidate_info": {
        "commit_hash": "289889a654c25174faa7093ff8d3162e92f41806",
        "repo": "ruby/ruby",
        "commit_url": "https://github.com/ruby/ruby/commit/289889a654c25174faa7093ff8d3162e92f41806",
        "files": [
          "ChangeLog",
          "ext/openssl/extconf.rb",
          "ext/openssl/ossl_ssl.c",
          "test/openssl/test_ssl.rb",
          "version.h"
        ],
        "message": "merge revision(s) 54258: [Backport #12182]\n\n\t* ext/openssl/extconf.rb: check SSL_CTX_set_next_proto_select_cb\n\t  function rather than OPENSSL_NPN_NEGOTIATED macro. it exists\n\t  even if it is disabled by OpenSSL configuration.\n\t  [ruby-core:74384] [Bug #12182]\n\n\t* ext/openssl/ossl_ssl.c: update #ifdef(s) as above.\n\n\t* test/openssl/test_ssl.rb: skip NPN tests if NPN is disabled.\n\n\ngit-svn-id: svn+ssh://ci.ruby-lang.org/ruby/branches/ruby_2_1@54397 b2dd03c8-39d4-4d8f-98ff-823fe69b080e",
        "before_after_code_files": [
          "ext/openssl/extconf.rb||ext/openssl/extconf.rb",
          "ext/openssl/ossl_ssl.c||ext/openssl/ossl_ssl.c",
          "test/openssl/test_ssl.rb||test/openssl/test_ssl.rb",
          "version.h||version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.h||version.h"
          ],
          "candidate": [
            "version.h||version.h"
          ]
        }
      },
      "candidate_diff": {
        "ext/openssl/extconf.rb||ext/openssl/extconf.rb": [
          "File: ext/openssl/extconf.rb -> ext/openssl/extconf.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "112: have_func(\"TLSv1_2_method\")",
          "113: have_func(\"TLSv1_2_server_method\")",
          "114: have_func(\"TLSv1_2_client_method\")",
          "116: unless have_func(\"SSL_set_tlsext_host_name\", ['openssl/ssl.h'])",
          "117:   have_macro(\"SSL_set_tlsext_host_name\", ['openssl/ssl.h']) && $defs.push(\"-DHAVE_SSL_SET_TLSEXT_HOST_NAME\")",
          "118: end",
          "",
          "[Removed Lines]",
          "115: have_macro(\"OPENSSL_NPN_NEGOTIATED\", ['openssl/ssl.h']) && $defs.push(\"-DHAVE_OPENSSL_NPN_NEGOTIATED\")",
          "",
          "[Added Lines]",
          "115: have_func(\"SSL_CTX_set_next_proto_select_cb\")",
          "",
          "---------------"
        ],
        "ext/openssl/ossl_ssl.c||ext/openssl/ossl_ssl.c": [
          "File: ext/openssl/ossl_ssl.c -> ext/openssl/ossl_ssl.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "572:     (void) rb_funcall(cb, rb_intern(\"call\"), 1, ssl_obj);",
          "573: }",
          "576: static VALUE",
          "577: ssl_npn_encode_protocol_i(VALUE cur, VALUE encoded)",
          "578: {",
          "",
          "[Removed Lines]",
          "575: #ifdef HAVE_OPENSSL_NPN_NEGOTIATED",
          "",
          "[Added Lines]",
          "575: #if defined(HAVE_SSL_CTX_SET_NEXT_PROTO_SELECT_CB) || defined(HAVE_SSL_CTX_SET_ALPN_SELECT_CB)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "596:     rb_iv_set(sslctx, \"@_protocols\", encoded);",
          "597: }",
          "611: static int",
          "612: ssl_npn_select_cb_common(VALUE cb, const unsigned char **out, unsigned char *outlen, const unsigned char *in, unsigned int inlen)",
          "613: {",
          "",
          "[Removed Lines]",
          "599: static int",
          "600: ssl_npn_advertise_cb(SSL *ssl, const unsigned char **out, unsigned int *outlen, void *arg)",
          "601: {",
          "602:     VALUE sslctx_obj = (VALUE) arg;",
          "603:     VALUE protocols = rb_iv_get(sslctx_obj, \"@_protocols\");",
          "608:     return SSL_TLSEXT_ERR_OK;",
          "609: }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "640:     return SSL_TLSEXT_ERR_OK;",
          "641: }",
          "643: static int",
          "644: ssl_npn_select_cb(SSL *s, unsigned char **out, unsigned char *outlen, const unsigned char *in, unsigned int inlen, void *arg)",
          "645: {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "631: #ifdef HAVE_SSL_CTX_SET_NEXT_PROTO_SELECT_CB",
          "632: static int",
          "633: ssl_npn_advertise_cb(SSL *ssl, const unsigned char **out, unsigned int *outlen, void *arg)",
          "634: {",
          "635:     VALUE sslctx_obj = (VALUE) arg;",
          "636:     VALUE protocols = rb_iv_get(sslctx_obj, \"@_protocols\");",
          "641:     return SSL_TLSEXT_ERR_OK;",
          "642: }",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "783:  SSL_CTX_set_options(ctx, SSL_OP_ALL);",
          "784:     }",
          "787:     val = rb_iv_get(self, \"@npn_protocols\");",
          "788:     if (!NIL_P(val)) {",
          "789:  ssl_npn_encode_protocols(self, val);",
          "",
          "[Removed Lines]",
          "786: #ifdef HAVE_OPENSSL_NPN_NEGOTIATED",
          "",
          "[Added Lines]",
          "788: #ifdef HAVE_SSL_CTX_SET_NEXT_PROTO_SELECT_CB",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1848:     return ossl_x509name_sk2ary(ca);",
          "1849: }",
          "",
          "[Removed Lines]",
          "1851: # ifdef HAVE_OPENSSL_NPN_NEGOTIATED",
          "",
          "[Added Lines]",
          "1853: # ifdef HAVE_SSL_CTX_SET_NEXT_PROTO_SELECT_CB",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "2092:     rb_attr(cSSLContext, rb_intern(\"renegotiation_cb\"), 1, 1, Qfalse);",
          "",
          "[Removed Lines]",
          "2093: #ifdef HAVE_OPENSSL_NPN_NEGOTIATED",
          "",
          "[Added Lines]",
          "2095: #ifdef HAVE_SSL_CTX_SET_NEXT_PROTO_SELECT_CB",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "2234:     rb_define_method(cSSLSocket, \"session=\",    ossl_ssl_set_session, 1);",
          "2235:     rb_define_method(cSSLSocket, \"verify_result\", ossl_ssl_get_verify_result, 0);",
          "2236:     rb_define_method(cSSLSocket, \"client_ca\", ossl_ssl_get_client_ca_list, 0);",
          "2238:     rb_define_method(cSSLSocket, \"npn_protocol\", ossl_ssl_npn_protocol, 0);",
          "2239: # endif",
          "2240: #endif",
          "",
          "[Removed Lines]",
          "2237: # ifdef HAVE_OPENSSL_NPN_NEGOTIATED",
          "",
          "[Added Lines]",
          "2239: # ifdef HAVE_SSL_CTX_SET_NEXT_PROTO_SELECT_CB",
          "",
          "---------------"
        ],
        "test/openssl/test_ssl.rb||test/openssl/test_ssl.rb": [
          "File: test/openssl/test_ssl.rb -> test/openssl/test_ssl.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "761:     }",
          "762:   end",
          "766:   def test_npn_protocol_selection_ary",
          "767:     advertised = [\"http/1.1\", \"spdy/2\"]",
          "",
          "[Removed Lines]",
          "764: if OpenSSL::OPENSSL_VERSION_NUMBER > 0x10001000",
          "",
          "[Added Lines]",
          "764: if OpenSSL::OPENSSL_VERSION_NUMBER > 0x10001000 &&",
          "765:  OpenSSL::SSL::SSLContext.method_defined?(:npn_select_cb)",
          "766:   # NPN may be disabled by OpenSSL configure option",
          "",
          "---------------"
        ],
        "version.h||version.h": [
          "File: version.h -> version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: #define RUBY_VERSION \"2.1.9\"",
          "2: #define RUBY_RELEASE_DATE \"2016-03-29\"",
          "5: #define RUBY_RELEASE_YEAR 2016",
          "6: #define RUBY_RELEASE_MONTH 3",
          "",
          "[Removed Lines]",
          "3: #define RUBY_PATCHLEVEL 488",
          "",
          "[Added Lines]",
          "3: #define RUBY_PATCHLEVEL 489",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "b58ee6672d602241a8673c91ca87959cb7222fd4",
      "candidate_info": {
        "commit_hash": "b58ee6672d602241a8673c91ca87959cb7222fd4",
        "repo": "ruby/ruby",
        "commit_url": "https://github.com/ruby/ruby/commit/b58ee6672d602241a8673c91ca87959cb7222fd4",
        "files": [
          "ChangeLog",
          "re.c",
          "version.h"
        ],
        "message": "merge revision(s) 53784: [Backport #11495]\n\n\t* re.c: Remove deprecated kcode argument from Regexp.new and compile\n\t  patch provided by Dylan Pulliam [Bug #11495]\n\n\ngit-svn-id: svn+ssh://ci.ruby-lang.org/ruby/branches/ruby_2_1@53937 b2dd03c8-39d4-4d8f-98ff-823fe69b080e",
        "before_after_code_files": [
          "re.c||re.c",
          "version.h||version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.h||version.h"
          ],
          "candidate": [
            "version.h||version.h"
          ]
        }
      },
      "candidate_diff": {
        "re.c||re.c": [
          "File: re.c -> re.c"
        ],
        "version.h||version.h": [
          "File: version.h -> version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: #define RUBY_VERSION \"2.1.9\"",
          "2: #define RUBY_RELEASE_DATE \"2016-02-25\"",
          "5: #define RUBY_RELEASE_YEAR 2016",
          "6: #define RUBY_RELEASE_MONTH 2",
          "",
          "[Removed Lines]",
          "3: #define RUBY_PATCHLEVEL 455",
          "",
          "[Added Lines]",
          "3: #define RUBY_PATCHLEVEL 456",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "16b551feb5b9b110eb3a4c6528e8fea1e0a174b5",
      "candidate_info": {
        "commit_hash": "16b551feb5b9b110eb3a4c6528e8fea1e0a174b5",
        "repo": "ruby/ruby",
        "commit_url": "https://github.com/ruby/ruby/commit/16b551feb5b9b110eb3a4c6528e8fea1e0a174b5",
        "files": [
          "ChangeLog",
          "version.h",
          "win32/win32.c"
        ],
        "message": "merge revision(s) 50637: [Backport #11172]\n\n\t* win32/win32.c (setup_overlapped): seek to the file end only when\n\t  writing (mode:a), not reading (mode:a+, read).\n\n\ngit-svn-id: svn+ssh://ci.ruby-lang.org/ruby/branches/ruby_2_1@50806 b2dd03c8-39d4-4d8f-98ff-823fe69b080e",
        "before_after_code_files": [
          "version.h||version.h",
          "win32/win32.c||win32/win32.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.h||version.h"
          ],
          "candidate": [
            "version.h||version.h"
          ]
        }
      },
      "candidate_diff": {
        "version.h||version.h": [
          "File: version.h -> version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: #define RUBY_VERSION \"2.1.7\"",
          "2: #define RUBY_RELEASE_DATE \"2015-06-09\"",
          "5: #define RUBY_RELEASE_YEAR 2015",
          "6: #define RUBY_RELEASE_MONTH 6",
          "",
          "[Removed Lines]",
          "3: #define RUBY_PATCHLEVEL 363",
          "",
          "[Added Lines]",
          "3: #define RUBY_PATCHLEVEL 364",
          "",
          "---------------"
        ],
        "win32/win32.c||win32/win32.c": [
          "File: win32/win32.c -> win32/win32.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "6274: }",
          "6276: static int",
          "6278: {",
          "6279:     memset(ol, 0, sizeof(*ol));",
          "6280:     if (!(_osfile(fd) & (FDEV | FPIPE))) {",
          "6281:  LONG high = 0;",
          "6283:  DWORD low = SetFilePointer((HANDLE)_osfhnd(fd), 0, &high, method);",
          "6284: #ifndef INVALID_SET_FILE_POINTER",
          "6285: #define INVALID_SET_FILE_POINTER ((DWORD)-1)",
          "",
          "[Removed Lines]",
          "6277: setup_overlapped(OVERLAPPED *ol, int fd)",
          "6282:  DWORD method = _osfile(fd) & FAPPEND ? FILE_END : FILE_CURRENT;",
          "",
          "[Added Lines]",
          "6277: setup_overlapped(OVERLAPPED *ol, int fd, int iswrite)",
          "6286:  DWORD method = ((_osfile(fd) & FAPPEND) && iswrite) ? FILE_END : FILE_CURRENT;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "6378:     if (cancel_io) {",
          "6380:      MTHREAD_ONLY(LeaveCriticalSection(&_pioinfo(fd)->lock));",
          "6381:      return -1;",
          "6382:  }",
          "",
          "[Removed Lines]",
          "6379:  if (setup_overlapped(&ol, fd)) {",
          "",
          "[Added Lines]",
          "6383:  if (setup_overlapped(&ol, fd, FALSE)) {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "6496:     if (cancel_io) {",
          "6498:      MTHREAD_ONLY(LeaveCriticalSection(&_pioinfo(fd)->lock));",
          "6499:      return -1;",
          "6500:  }",
          "",
          "[Removed Lines]",
          "6497:  if (setup_overlapped(&ol, fd)) {",
          "",
          "[Added Lines]",
          "6501:  if (setup_overlapped(&ol, fd, TRUE)) {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "1b18735b4bda48b7705ae3fe5a63511ed75c9d58",
      "candidate_info": {
        "commit_hash": "1b18735b4bda48b7705ae3fe5a63511ed75c9d58",
        "repo": "ruby/ruby",
        "commit_url": "https://github.com/ruby/ruby/commit/1b18735b4bda48b7705ae3fe5a63511ed75c9d58",
        "files": [
          "ChangeLog",
          "configure.in",
          "version.h"
        ],
        "message": "merge revision(s) r49192: [Backport #10716]\n\n\t* configure.in (RUBY_SETJMP_TYPE): Remove superfluous semicolon\n\t  which causes a syntax error with autoconf 2.63.\n\t  [ruby-core:67429] [Bug #10716]\n\n\ngit-svn-id: svn+ssh://ci.ruby-lang.org/ruby/branches/ruby_2_1@50130 b2dd03c8-39d4-4d8f-98ff-823fe69b080e",
        "before_after_code_files": [
          "configure.in||configure.in",
          "version.h||version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.h||version.h"
          ],
          "candidate": [
            "version.h||version.h"
          ]
        }
      },
      "candidate_diff": {
        "configure.in||configure.in": [
          "File: configure.in -> configure.in",
          "--- Hunk 1 ---",
          "[Context before]",
          "2062:     if test \"${setjmp_prefix}\" && eval test '$ac_cv_func_'${setjmp_prefix}setjmp${setjmp_suffix} = no; then",
          "2063:  AC_MSG_ERROR(${setjmp_prefix}setjmp${setjmp_suffix} is not available)",
          "2064:     fi",
          "2066:     setjmp_cast=`expr \"$ac_cv_func___builtin_setjmp\" : \"yes with cast (\\(.*\\))\"`",
          "2067:     setjmp_prefix=__builtin_",
          "2068:     setjmp_suffix=",
          "",
          "[Removed Lines]",
          "2065: elif { AS_CASE(\"$ac_cv_func___builtin_setjmp\", [yes*], [true], [false]); }; then",
          "",
          "[Added Lines]",
          "2065: elif { AS_CASE(\"$ac_cv_func___builtin_setjmp\", [yes*], [true], [false]) }; then",
          "",
          "---------------"
        ],
        "version.h||version.h": [
          "File: version.h -> version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: #define RUBY_VERSION \"2.1.5\"",
          "2: #define RUBY_RELEASE_DATE \"2015-03-31\"",
          "5: #define RUBY_RELEASE_YEAR 2015",
          "6: #define RUBY_RELEASE_MONTH 3",
          "",
          "[Removed Lines]",
          "3: #define RUBY_PATCHLEVEL 325",
          "",
          "[Added Lines]",
          "3: #define RUBY_PATCHLEVEL 326",
          "",
          "---------------"
        ]
      }
    }
  ]
}