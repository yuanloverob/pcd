{
  "cve_id": "CVE-2012-2330",
  "cve_desc": "The Update method in src/node_http_parser.cc in Node.js before 0.6.17 and 0.7 before 0.7.8 does not properly check the length of a string, which allows remote attackers to obtain sensitive information (request header contents) and possibly spoof HTTP headers via a zero length string.",
  "repo": "joyent/node",
  "patch_hash": "c9a231db0e59658be419d926b1dfa17b939ba158",
  "patch_info": {
    "commit_hash": "c9a231db0e59658be419d926b1dfa17b939ba158",
    "repo": "joyent/node",
    "commit_url": "https://github.com/joyent/node/commit/c9a231d",
    "files": [
      "src/node_http_parser.cc"
    ],
    "message": "typo in node_http_parser",
    "before_after_code_files": [
      "src/node_http_parser.cc||src/node_http_parser.cc"
    ]
  },
  "patch_diff": {
    "src/node_http_parser.cc||src/node_http_parser.cc": [
      "File: src/node_http_parser.cc -> src/node_http_parser.cc",
      "--- Hunk 1 ---",
      "[Context before]",
      "191:   void Update(const char* str, size_t size) {",
      "192:     if (str_ == NULL)",
      "193:       str_ = str;",
      "197:       char* s = new char[size_ + size];",
      "",
      "[Removed Lines]",
      "194:     else if (on_heap_ || str_ + size != str) {",
      "",
      "[Added Lines]",
      "194:     else if (on_heap_ || str_ + size_ != str) {",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "3415427dbfbd590bbee3d777ffc73dde3c67790d",
      "candidate_info": {
        "commit_hash": "3415427dbfbd590bbee3d777ffc73dde3c67790d",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/3415427dbfbd590bbee3d777ffc73dde3c67790d",
        "files": [
          "doc/api/tls.markdown",
          "lib/tls.js",
          "src/node_crypto.cc",
          "src/node_crypto.h",
          "test/pummel/test-tls-ci-reneg-attack.js"
        ],
        "message": "tls: mitigate session renegotiation attacks\n\nThe TLS protocol allows (and sometimes requires) clients to renegotiate the\nsession. However, renegotiation requires a disproportional amount of server-side\nresources, particularly CPU time, which makes it a potential vector for\ndenial-of-service attacks.\n\nTo mitigate this issue, we keep track of and limit the number of renegotiation\nrequests over time, emitting an error if the threshold is exceeded.",
        "before_after_code_files": [
          "lib/tls.js||litls.js",
          "src/node_crypto.cc||src/node_crypto.cc",
          "src/node_crypto.h||src/node_crypto.h",
          "test/pummel/test-tls-ci-reneg-attack.js||test/pummel/test-tls-ci-reneg-attack.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "lib/tls.js||litls.js": [
          "File: lib/tls.js -> litls.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "27: var END_OF_FILE = 42;",
          "28: var assert = require('assert').ok;",
          "30: var debug;",
          "31: if (process.env.NODE_DEBUG && /tls/.test(process.env.NODE_DEBUG)) {",
          "32:   debug = function(a) { console.error('TLS:', a); };",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "542: };",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "588:       this._isServer ? this._requestCert : options.servername,",
          "589:       this._rejectUnauthorized);",
          "591:   if (process.features.tls_sni) {",
          "592:     if (this._isServer && options.SNICallback) {",
          "593:       this.ssl.setSNICallback(options.SNICallback);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "728:   if (!this._doneFlag) {",
          "729:     this._doneFlag = true;",
          "730:     this.ssl.error = null;",
          "731:     this.ssl.close();",
          "732:     this.ssl = null;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/node_crypto.cc||src/node_crypto.cc": [
          "File: src/node_crypto.cc -> src/node_crypto.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "930:   SSL_set_app_data(p->ssl_, p);",
          "932: #ifdef OPENSSL_NPN_NEGOTIATED",
          "933:   if (is_server) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "932:   if (is_server) SSL_set_info_callback(p->ssl_, SSLInfoCallback);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "991: }",
          "994: Handle<Value> Connection::EncIn(const Arguments& args) {",
          "995:   HandleScope scope;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "996: void Connection::SSLInfoCallback(const SSL *ssl, int where, int ret) {",
          "997:   if (where & SSL_CB_HANDSHAKE_START) {",
          "998:     HandleScope scope;",
          "999:     Connection* c = static_cast<Connection*>(SSL_get_app_data(ssl));",
          "1000:     MakeCallback(c->handle_, \"onhandshakestart\", 0, NULL);",
          "1001:   }",
          "1002:   if (where & SSL_CB_HANDSHAKE_DONE) {",
          "1003:     HandleScope scope;",
          "1004:     Connection* c = static_cast<Connection*>(SSL_get_app_data(ssl));",
          "1005:     MakeCallback(c->handle_, \"onhandshakedone\", 0, NULL);",
          "1006:   }",
          "1007: }",
          "",
          "---------------"
        ],
        "src/node_crypto.h||src/node_crypto.h": [
          "File: src/node_crypto.h -> src/node_crypto.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "190:   }",
          "192:  private:",
          "193:   BIO *bio_read_;",
          "194:   BIO *bio_write_;",
          "195:   SSL *ssl_;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "193:   static void SSLInfoCallback(const SSL *ssl, int where, int ret);",
          "",
          "---------------"
        ],
        "test/pummel/test-tls-ci-reneg-attack.js||test/pummel/test-tls-ci-reneg-attack.js": [
          "File: test/pummel/test-tls-ci-reneg-attack.js -> test/pummel/test-tls-ci-reneg-attack.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "22: var common = require('../common');",
          "23: var assert = require('assert');",
          "24: var spawn = require('child_process').spawn;",
          "25: var tls = require('tls');",
          "26: var fs = require('fs');",
          "29: var LIMITS = [0, 1, 2, 3, 5, 10, 16];",
          "31: if (process.platform === 'win32') {",
          "32:   console.log(\"Skipping test, you probably don't have openssl installed.\");",
          "33:   process.exit();",
          "34: }",
          "36: (function() {",
          "37:   var n = 0;",
          "38:   function next() {",
          "39:     if (n >= LIMITS.length) return;",
          "40:     tls.CLIENT_RENEG_LIMIT = LIMITS[n++];",
          "41:     test(next);",
          "42:   }",
          "43:   next();",
          "44: })();",
          "46: function test(next) {",
          "47:   var options = {",
          "48:     cert: fs.readFileSync(common.fixturesDir + '/test_cert.pem'),",
          "49:     key: fs.readFileSync(common.fixturesDir + '/test_key.pem')",
          "50:   };",
          "52:   var server = tls.createServer(options, function(conn) {",
          "53:     conn.on('error', function(err) {",
          "54:       console.error('Caught exception: ' + err);",
          "55:       assert(/TLS session renegotiation attack/.test(err));",
          "56:       conn.destroy();",
          "57:     });",
          "58:     conn.pipe(conn);",
          "59:   });",
          "61:   server.listen(common.PORT, function() {",
          "62:     var args = ('s_client -connect 127.0.0.1:' + common.PORT).split(' ');",
          "63:     var child = spawn('openssl', args);",
          "65:     child.stdout.pipe(process.stdout);",
          "66:     child.stderr.pipe(process.stderr);",
          "69:     var handshakes = 0;",
          "70:     child.stderr.on('data', function(data) {",
          "71:       handshakes += (('' + data).match(/verify return:1/g) || []).length;",
          "72:       if (handshakes === 2) spam();",
          "73:     });",
          "75:     child.on('exit', function() {",
          "79:       assert.equal(handshakes, 2 * Math.max(2, tls.CLIENT_RENEG_LIMIT));",
          "80:       server.close();",
          "81:       process.nextTick(next);",
          "82:     });",
          "84:     var closed = false;",
          "85:     child.stdin.on('error', function(err) {",
          "86:       assert.equal(err.code, 'EPIPE');",
          "87:       closed = true;",
          "88:     });",
          "89:     child.stdin.on('close', function() {",
          "90:       closed = true;",
          "91:     });",
          "94:     function spam() {",
          "95:       if (closed) return;",
          "96:       child.stdin.write(\"R\\n\");",
          "97:       setTimeout(spam, 250);",
          "98:     }",
          "99:   });",
          "100: }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "988a164cd8820974753ba6a9fc1827d2832c59d4",
      "candidate_info": {
        "commit_hash": "988a164cd8820974753ba6a9fc1827d2832c59d4",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/988a164cd8820974753ba6a9fc1827d2832c59d4",
        "files": [
          "deps/openssl/openssl/crypto/asn1/a_strex.c"
        ],
        "message": "openssl: fix uninitialized memory access\n\nASN1_STRING_to_UTF8() passes an ASN1_STRING to ASN1_STRING_set() but\nforgot to initialize the `length` field.\n\nFixes the following valgrind error:\n\n  $ valgrind -q --track-origins=yes --num-callers=19 \\\n      out/Debug/node test/simple/test-tls-client-abort.js\n  ==2690== Conditional jump or move depends on uninitialised value(s)\n  ==2690==    at 0x784B69: ASN1_STRING_set (asn1_lib.c:382)\n  ==2690==    by 0x809564: ASN1_mbstring_ncopy (a_mbstr.c:204)\n  ==2690==    by 0x8090F0: ASN1_mbstring_copy (a_mbstr.c:86)\n  ==2690==    by 0x782F1F: ASN1_STRING_to_UTF8 (a_strex.c:570)\n  ==2690==    by 0x78F090: asn1_string_canon (x_name.c:409)\n  ==2690==    by 0x78EF17: x509_name_canon (x_name.c:354)\n  ==2690==    by 0x78EA7D: x509_name_ex_d2i (x_name.c:210)\n  ==2690==    by 0x788058: ASN1_item_ex_d2i (tasn_dec.c:239)\n  ==2690==    by 0x7890D4: asn1_template_noexp_d2i (tasn_dec.c:746)\n  ==2690==    by 0x788CB6: asn1_template_ex_d2i (tasn_dec.c:607)\n  ==2690==    by 0x78877A: ASN1_item_ex_d2i (tasn_dec.c:448)\n  ==2690==    by 0x7890D4: asn1_template_noexp_d2i (tasn_dec.c:746)\n  ==2690==    by 0x788CB6: asn1_template_ex_d2i (tasn_dec.c:607)\n  ==2690==    by 0x78877A: ASN1_item_ex_d2i (tasn_dec.c:448)\n  ==2690==    by 0x787C93: ASN1_item_d2i (tasn_dec.c:136)\n  ==2690==    by 0x78F5E4: d2i_X509 (x_x509.c:141)\n  ==2690==    by 0x7C9B91: PEM_ASN1_read_bio (pem_oth.c:81)\n  ==2690==    by 0x7CA506: PEM_read_bio_X509 (pem_x509.c:67)\n  ==2690==    by 0x703C9A: node::crypto::SecureContext::AddRootCerts(v8::Arguments const&) (node_crypto.cc:497)\n  ==2690==  Uninitialised value was created by a stack allocation\n  ==2690==    at 0x782E89: ASN1_STRING_to_UTF8 (a_strex.c:560)",
        "before_after_code_files": [
          "deps/openssl/openssl/crypto/asn1/a_strex.c||deps/openssl/openssl/crypto/asn1/a_strex.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "deps/openssl/openssl/crypto/asn1/a_strex.c||deps/openssl/openssl/crypto/asn1/a_strex.c": [
          "File: deps/openssl/openssl/crypto/asn1/a_strex.c -> deps/openssl/openssl/crypto/asn1/a_strex.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "566:  mbflag = tag2nbyte[type];",
          "567:  if(mbflag == -1) return -1;",
          "568:  mbflag |= MBSTRING_FLAG;",
          "569:  stmp.data = NULL;",
          "570:  ret = ASN1_mbstring_copy(&str, in->data, in->length, mbflag, B_ASN1_UTF8STRING);",
          "571:  if(ret < 0) return ret;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "569:  memset(&stmp, 0, sizeof(stmp));",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "220288725fc05f9838ec0a77876d9d9f1491da5a",
      "candidate_info": {
        "commit_hash": "220288725fc05f9838ec0a77876d9d9f1491da5a",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/220288725fc05f9838ec0a77876d9d9f1491da5a",
        "files": [
          "test/simple/test-eio-limit.js"
        ],
        "message": "test-eio-limit: add missing copyright headers",
        "before_after_code_files": [
          "test/simple/test-eio-limit.js||test/simple/test-eio-limit.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "test/simple/test-eio-limit.js||test/simple/test-eio-limit.js": [
          "File: test/simple/test-eio-limit.js -> test/simple/test-eio-limit.js"
        ]
      }
    },
    {
      "candidate_hash": "8d082d0f884831e5eb02085c8b63643dd7bde4e5",
      "candidate_info": {
        "commit_hash": "8d082d0f884831e5eb02085c8b63643dd7bde4e5",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/8d082d0f884831e5eb02085c8b63643dd7bde4e5",
        "files": [
          "deps/openssl/openssl.gyp",
          "deps/openssl/openssl/crypto/opensslconf.h",
          "deps/openssl/openssl/include/openssl/md2.h",
          "deps/openssl/openssl/include/openssl/opensslconf.h",
          "deps/openssl/openssl/include/openssl/store.h"
        ],
        "message": "openssl: update the GYP build to work with openssl 1.0.1c",
        "before_after_code_files": [
          "deps/openssl/openssl.gyp||deps/openssl/openssl.gyp",
          "deps/openssl/openssl/crypto/opensslconf.h||deps/openssl/openssl/crypto/opensslconf.h",
          "deps/openssl/openssl/include/openssl/md2.h||deps/openssl/openssl/include/openssl/md2.h",
          "deps/openssl/openssl/include/openssl/opensslconf.h||deps/openssl/openssl/include/openssl/opensslconf.h",
          "deps/openssl/openssl/include/openssl/store.h||deps/openssl/openssl/include/openssl/store.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "deps/openssl/openssl.gyp||deps/openssl/openssl.gyp": [
          "File: deps/openssl/openssl.gyp -> deps/openssl/openssl.gyp",
          "--- Hunk 1 ---",
          "[Context before]",
          "13:         'PURIFY',",
          "14:         '_REENTRANT',",
          "15:         # We do not use TLS over UDP on Chromium so far.",
          "16:         'OPENSSL_NO_DTLS1',",
          "17:         'OPENSSL_NO_SOCK',",
          "19:         # Work around brain dead SunOS linker.",
          "20:         'OPENSSL_NO_GOST',",
          "21:         'OPENSSL_NO_HW_PADLOCK',",
          "",
          "[Removed Lines]",
          "18:         'OPENSSL_NO_DGRAM',",
          "",
          "[Added Lines]",
          "16:         'OPENSSL_NO_DGRAM',",
          "18:         'OPENSSL_NO_SCTP',",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "29:         'openssl/ssl/d1_lib.c',",
          "30:         'openssl/ssl/d1_meth.c',",
          "31:         'openssl/ssl/d1_pkt.c',",
          "32:         'openssl/ssl/d1_srvr.c',",
          "33:         'openssl/ssl/kssl.c',",
          "34:         'openssl/ssl/s23_clnt.c',",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "33:         'openssl/ssl/d1_srtp.c',",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "66:         'openssl/ssl/t1_meth.c',",
          "67:         'openssl/ssl/t1_reneg.c',",
          "68:         'openssl/ssl/t1_srvr.c',",
          "70:         'openssl/crypto/aes/aes_cbc.c',",
          "71:         'openssl/crypto/aes/aes_cfb.c',",
          "72:         'openssl/crypto/aes/aes_core.c',",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "71:         'openssl/ssl/tls_srp.c',",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "204:         'openssl/crypto/bn/bn_sqr.c',",
          "205:         'openssl/crypto/bn/bn_sqrt.c',",
          "206:         'openssl/crypto/bn/bn_word.c',",
          "207:         'openssl/crypto/buffer/buf_err.c',",
          "208:         'openssl/crypto/buffer/buffer.c',",
          "209:         'openssl/crypto/camellia/camellia.c',",
          "210:         'openssl/crypto/camellia/cmll_cbc.c',",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "209:         'openssl/crypto/bn/bn_x931p.c',",
          "211:         'openssl/crypto/buffer/buf_str.c',",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "213:         'openssl/crypto/camellia/cmll_ecb.c',",
          "214:         'openssl/crypto/camellia/cmll_misc.c',",
          "215:         'openssl/crypto/camellia/cmll_ofb.c',",
          "216:         'openssl/crypto/cast/c_cfb64.c',",
          "217:         'openssl/crypto/cast/c_ecb.c',",
          "218:         'openssl/crypto/cast/c_enc.c',",
          "219:         'openssl/crypto/cast/c_ofb64.c',",
          "220:         'openssl/crypto/cast/c_skey.c',",
          "221:         'openssl/crypto/cms/cms_asn1.c',",
          "222:         'openssl/crypto/cms/cms_att.c',",
          "223:         'openssl/crypto/cms/cms_cd.c',",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "220:         'openssl/crypto/camellia/cmll_utl.c',",
          "226:         'openssl/crypto/cmac/cm_ameth.c',",
          "227:         'openssl/crypto/cmac/cm_pmeth.c',",
          "228:         'openssl/crypto/cmac/cmac.c',",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "228:         'openssl/crypto/cms/cms_ess.c',",
          "229:         'openssl/crypto/cms/cms_io.c',",
          "230:         'openssl/crypto/cms/cms_lib.c',",
          "231:         'openssl/crypto/cms/cms_sd.c',",
          "232:         'openssl/crypto/cms/cms_smime.c',",
          "233:         'openssl/crypto/comp/c_rle.c',",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "239:         'openssl/crypto/cms/cms_pwri.c',",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "299:         'openssl/crypto/dso/dso_openssl.c',",
          "300:         'openssl/crypto/ebcdic.c',",
          "301:         'openssl/crypto/ec/ec2_mult.c',",
          "302:         'openssl/crypto/ec/ec2_smpl.c',",
          "304:         'openssl/crypto/ec/ec_ameth.c',",
          "305:         'openssl/crypto/ec/ec_check.c',",
          "306:         'openssl/crypto/ec/ec_curve.c',",
          "307:         'openssl/crypto/ec/ec_cvt.c',",
          "",
          "[Removed Lines]",
          "303:         'openssl/crypto/ec/ec_asn1.c',",
          "",
          "[Added Lines]",
          "311:         'openssl/crypto/ec/ec2_oct.c',",
          "314:         'openssl/crypto/ec/ec_asn1.c',",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "309:         'openssl/crypto/ec/ec_key.c',",
          "310:         'openssl/crypto/ec/ec_lib.c',",
          "311:         'openssl/crypto/ec/ec_mult.c',",
          "312:         'openssl/crypto/ec/ec_pmeth.c',",
          "313:         'openssl/crypto/ec/ec_print.c',",
          "314:         'openssl/crypto/ec/eck_prn.c',",
          "315:         'openssl/crypto/ec/ecp_mont.c',",
          "316:         'openssl/crypto/ec/ecp_nist.c',",
          "317:         'openssl/crypto/ec/ecp_smpl.c',",
          "318:         'openssl/crypto/ecdh/ech_err.c',",
          "319:         'openssl/crypto/ecdh/ech_key.c',",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "322:         'openssl/crypto/ec/ec_oct.c',",
          "328:         'openssl/crypto/ec/ecp_nistp224.c',",
          "329:         'openssl/crypto/ec/ecp_nistp256.c',",
          "330:         'openssl/crypto/ec/ecp_nistp521.c',",
          "331:         'openssl/crypto/ec/ecp_nistputil.c',",
          "332:         'openssl/crypto/ec/ecp_oct.c',",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "337:         'openssl/crypto/engine/eng_list.c',",
          "338:         'openssl/crypto/engine/eng_openssl.c',",
          "339:         'openssl/crypto/engine/eng_pkey.c',",
          "340:         'openssl/crypto/engine/eng_table.c',",
          "341:         'openssl/crypto/engine/tb_asnmth.c',",
          "342:         'openssl/crypto/engine/tb_cipher.c',",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "356:         'openssl/crypto/engine/eng_rdrand.c',",
          "357:         'openssl/crypto/engine/eng_rsax.c',",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "361:         'openssl/crypto/evp/c_alld.c',",
          "362:         'openssl/crypto/evp/digest.c',",
          "363:         'openssl/crypto/evp/e_aes.c',",
          "364:         'openssl/crypto/evp/e_bf.c',",
          "365:         'openssl/crypto/evp/e_camellia.c',",
          "366:         'openssl/crypto/evp/e_cast.c',",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "382:         'openssl/crypto/evp/e_aes_cbc_hmac_sha1.c',",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "370:         'openssl/crypto/evp/e_old.c',",
          "371:         'openssl/crypto/evp/e_rc2.c',",
          "372:         'openssl/crypto/evp/e_rc4.c',",
          "373:         'openssl/crypto/evp/e_rc5.c',",
          "374:         'openssl/crypto/evp/e_seed.c',",
          "375:         'openssl/crypto/evp/e_xcbc_d.c',",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "392:         'openssl/crypto/evp/e_rc4_hmac_md5.c',",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "377:         'openssl/crypto/evp/evp_acnf.c',",
          "378:         'openssl/crypto/evp/evp_enc.c',",
          "379:         'openssl/crypto/evp/evp_err.c',",
          "380:         'openssl/crypto/evp/evp_key.c',",
          "381:         'openssl/crypto/evp/evp_lib.c',",
          "382:         'openssl/crypto/evp/evp_pbe.c',",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "400:         'openssl/crypto/evp/evp_fips.c',",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "408:         'openssl/crypto/evp/pmeth_gn.c',",
          "409:         'openssl/crypto/evp/pmeth_lib.c',",
          "410:         'openssl/crypto/ex_data.c',",
          "411:         'openssl/crypto/hmac/hm_ameth.c',",
          "412:         'openssl/crypto/hmac/hm_pmeth.c',",
          "413:         'openssl/crypto/hmac/hmac.c',",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "432:         'openssl/crypto/fips_ers.c',",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "420:         'openssl/crypto/md4/md4_one.c',",
          "421:         'openssl/crypto/md5/md5_dgst.c',",
          "422:         'openssl/crypto/md5/md5_one.c',",
          "424:         'openssl/crypto/mdc2/mdc2_one.c',",
          "425:         'openssl/crypto/mem.c',",
          "426:         'openssl/crypto/mem_clr.c',",
          "427:         'openssl/crypto/mem_dbg.c',",
          "428:         'openssl/crypto/modes/cbc128.c',",
          "429:         'openssl/crypto/modes/cfb128.c',",
          "430:         'openssl/crypto/modes/ctr128.c',",
          "431:         'openssl/crypto/modes/cts128.c',",
          "432:         'openssl/crypto/modes/ofb128.c',",
          "433:         'openssl/crypto/o_dir.c',",
          "434:         'openssl/crypto/o_str.c',",
          "435:         'openssl/crypto/o_time.c',",
          "436:         'openssl/crypto/objects/o_names.c',",
          "",
          "[Removed Lines]",
          "423:         'openssl/crypto/mdc2/mdc2dgst.c',",
          "",
          "[Added Lines]",
          "446:         'openssl/crypto/mdc2/mdc2dgst.c',",
          "451:         'openssl/crypto/modes/ccm128.c',",
          "455:         'openssl/crypto/modes/gcm128.c',",
          "457:         'openssl/crypto/modes/xts128.c',",
          "459:         'openssl/crypto/o_fips.c',",
          "460:         'openssl/crypto/o_init.c',",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "499:         'openssl/crypto/rc2/rc2ofb64.c',",
          "500:         'openssl/crypto/rc4/rc4_enc.c',",
          "501:         'openssl/crypto/rc4/rc4_skey.c',",
          "502:         'openssl/crypto/ripemd/rmd_dgst.c',",
          "503:         'openssl/crypto/ripemd/rmd_one.c',",
          "504:         'openssl/crypto/rsa/rsa_ameth.c',",
          "505:         'openssl/crypto/rsa/rsa_asn1.c',",
          "506:         'openssl/crypto/rsa/rsa_chk.c',",
          "507:         'openssl/crypto/rsa/rsa_depr.c',",
          "508:         'openssl/crypto/rsa/rsa_eay.c',",
          "509:         'openssl/crypto/rsa/rsa_err.c',",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "529:         'openssl/crypto/rc4/rc4_utl.c',",
          "535:         'openssl/crypto/rsa/rsa_crpt.c',",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "526:         'openssl/crypto/sha/sha512.c',",
          "527:         'openssl/crypto/sha/sha_dgst.c',",
          "528:         'openssl/crypto/sha/sha_one.c',",
          "529:         'openssl/crypto/stack/stack.c',",
          "530:         'openssl/crypto/store/str_err.c',",
          "531:         'openssl/crypto/store/str_lib.c',",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "558:         'openssl/crypto/srp/srp_lib.c',",
          "559:         'openssl/crypto/srp/srp_vfy.c',",
          "560:         'openssl/crypto/srp/srptest.c',",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "544:         'openssl/crypto/ts/ts_verify_ctx.c',",
          "545:         'openssl/crypto/txt_db/txt_db.c',",
          "546:         'openssl/crypto/ui/ui_compat.c',",
          "547:         'openssl/crypto/ui/ui_err.c',",
          "548:         'openssl/crypto/ui/ui_lib.c',",
          "550:         'openssl/crypto/ui/ui_openssl.c',",
          "551:         'openssl/crypto/ui/ui_util.c',",
          "552:         'openssl/crypto/uid.c',",
          "",
          "[Removed Lines]",
          "549:         'openssl/crypto/ui/ui_dummy.c',",
          "",
          "[Added Lines]",
          "579:         'openssl/crypto/ui/ui_dummy.c',",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "633:           'defines': [",
          "634:             'MK1MF_BUILD',",
          "635:             'WIN32_LEAN_AND_MEAN',",
          "636:           ]",
          "637:         }, {",
          "638:           'defines': [",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "668:             'OPENSSL_NO_EC_NISTP_64_GCC_128'",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "661:         }],",
          "662:         ['target_arch==\"arm\"', {",
          "663:           'variables': {'openssl_config_path': 'config/android'},",
          "664:           'sources': [",
          "665:             'openssl/crypto/bn/bn_asm.c',",
          "666:           ]",
          "667:         }]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "697:           'defines': [",
          "698:             'OPENSSL_NO_EC_NISTP_64_GCC_128'",
          "699:           ],",
          "701:             'openssl/crypto/armcap.c',",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "672:         'openssl/crypto',",
          "673:         'openssl/crypto/asn1',",
          "674:         'openssl/crypto/evp',",
          "675:         'openssl/crypto/store',",
          "676:         'openssl/include',",
          "677:         '<@(openssl_config_path)',",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "712:         'openssl/crypto/md2',",
          "713:         'openssl/crypto/modes',",
          "",
          "---------------"
        ],
        "deps/openssl/openssl/crypto/opensslconf.h||deps/openssl/openssl/crypto/opensslconf.h": [
          "File: deps/openssl/openssl/crypto/opensslconf.h -> deps/openssl/openssl/crypto/opensslconf.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "deps/openssl/openssl/include/openssl/md2.h||deps/openssl/openssl/include/openssl/md2.h": [
          "File: deps/openssl/openssl/include/openssl/md2.h -> deps/openssl/openssl/include/openssl/md2.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: #include \"../../crypto/md2/md2.h\"",
          "",
          "---------------"
        ],
        "deps/openssl/openssl/include/openssl/opensslconf.h||deps/openssl/openssl/include/openssl/opensslconf.h": [
          "File: deps/openssl/openssl/include/openssl/opensslconf.h -> deps/openssl/openssl/include/openssl/opensslconf.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "deps/openssl/openssl/include/openssl/store.h||deps/openssl/openssl/include/openssl/store.h": [
          "File: deps/openssl/openssl/include/openssl/store.h -> deps/openssl/openssl/include/openssl/store.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: #include \"../../crypto/store/store.h\"",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "aa67b1f3750646a0f30e12a3b4e4fcb84dc8cafa",
      "candidate_info": {
        "commit_hash": "aa67b1f3750646a0f30e12a3b4e4fcb84dc8cafa",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/aa67b1f3750646a0f30e12a3b4e4fcb84dc8cafa",
        "files": [
          "doc/api/fs.markdown",
          "lib/fs.js",
          "test/simple/test-fs-append-file-sync.js",
          "test/simple/test-fs-append-file.js"
        ],
        "message": "fs: add appendFile() and appendFileSync() functions",
        "before_after_code_files": [
          "lib/fs.js||lifs.js",
          "test/simple/test-fs-append-file-sync.js||test/simple/test-fs-append-file-sync.js",
          "test/simple/test-fs-append-file.js||test/simple/test-fs-append-file.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "lib/fs.js||lifs.js": [
          "File: lib/fs.js -> lifs.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "582:   binding.futimes(fd, atime, mtime);",
          "583: };",
          "588:     if (writeErr) {",
          "589:       fs.close(fd, function() {",
          "590:         if (callback) callback(writeErr);",
          "",
          "[Removed Lines]",
          "585: function writeAll(fd, buffer, offset, length, callback) {",
          "587:   fs.write(fd, buffer, offset, length, offset, function(writeErr, written) {",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "593:       if (written === length) {",
          "594:         fs.close(fd, callback);",
          "595:       } else {",
          "597:       }",
          "598:     }",
          "599:   });",
          "",
          "[Removed Lines]",
          "596:         writeAll(fd, buffer, offset + written, length - written, callback);",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "609:     } else {",
          "610:       var buffer = Buffer.isBuffer(data) ? data : new Buffer('' + data,",
          "611:           encoding);",
          "613:     }",
          "614:   });",
          "615: };",
          "",
          "[Removed Lines]",
          "612:       writeAll(fd, buffer, 0, buffer.length, callback);",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "628:   fs.closeSync(fd);",
          "629: };",
          "632: function errnoException(errorno, syscall) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "test/simple/test-fs-append-file-sync.js||test/simple/test-fs-append-file-sync.js": [
          "File: test/simple/test-fs-append-file-sync.js -> test/simple/test-fs-append-file-sync.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "22: var common = require('../common');",
          "23: var assert = require('assert');",
          "24: var join = require('path').join;",
          "25: var fs = require('fs');",
          "27: var currentFileData = 'ABCD';",
          "29: var num = 220;",
          "30: var data = '\u5357\u8d8a\u56fd\u662f\u524d203\u5e74\u81f3\u524d111\u5e74\u5b58\u5728\u4e8e\u5cad\u5357\u5730\u533a\u7684\u4e00\u4e2a\u56fd\u5bb6\uff0c\u56fd\u90fd\u4f4d\u4e8e\u756a\u79ba\uff0c\u7586\u57df\u5305\u62ec\u4eca\u5929\u4e2d\u56fd\u7684\u5e7f\u4e1c\u3001' +",
          "31:         '\u5e7f\u897f\u4e24\u7701\u533a\u7684\u5927\u90e8\u4efd\u5730\u533a\uff0c\u798f\u5efa\u7701\u3001\u6e56\u5357\u3001\u8d35\u5dde\u3001\u4e91\u5357\u7684\u4e00\u5c0f\u90e8\u4efd\u5730\u533a\u548c\u8d8a\u5357\u7684\u5317\u90e8\u3002' +",
          "32:         '\u5357\u8d8a\u56fd\u662f\u79e6\u671d\u706d\u4ea1\u540e\uff0c\u7531\u5357\u6d77\u90e1\u5c09\u8d75\u4f57\u4e8e\u524d203\u5e74\u8d77\u5175\u517c\u5e76\u6842\u6797\u90e1\u548c\u8c61\u90e1\u540e\u5efa\u7acb\u3002' +",
          "33:         '\u524d196\u5e74\u548c\u524d179\u5e74\uff0c\u5357\u8d8a\u56fd\u66fe\u5148\u540e\u4e24\u6b21\u540d\u4e49\u4e0a\u81e3\u5c5e\u4e8e\u897f\u6c49\uff0c\u6210\u4e3a\u897f\u6c49\u7684\u201c\u5916\u81e3\u201d\u3002\u524d112\u5e74\uff0c' +",
          "34:         '\u5357\u8d8a\u56fd\u672b\u4ee3\u541b\u4e3b\u8d75\u5efa\u5fb7\u4e0e\u897f\u6c49\u53d1\u751f\u6218\u4e89\uff0c\u88ab\u6c49\u6b66\u5e1d\u4e8e\u524d111\u5e74\u6240\u706d\u3002\u5357\u8d8a\u56fd\u5171\u5b58\u572893\u5e74\uff0c' +",
          "35:         '\u5386\u7ecf\u4e94\u4ee3\u541b\u4e3b\u3002\u5357\u8d8a\u56fd\u662f\u5cad\u5357\u5730\u533a\u7684\u7b2c\u4e00\u4e2a\u6709\u8bb0\u8f7d\u7684\u653f\u6743\u56fd\u5bb6\uff0c\u91c7\u7528\u5c01\u5efa\u5236\u548c\u90e1\u53bf\u5236\u5e76\u5b58\u7684\u5236\u5ea6\uff0c' +",
          "36:         '\u5b83\u7684\u5efa\u7acb\u4fdd\u8bc1\u4e86\u79e6\u672b\u4e71\u4e16\u5cad\u5357\u5730\u533a\u793e\u4f1a\u79e9\u5e8f\u7684\u7a33\u5b9a\uff0c\u6709\u6548\u7684\u6539\u5584\u4e86\u5cad\u5357\u5730\u533a\u843d\u540e\u7684\u653f\u6cbb\u3001##\u6d4e\u73b0\u72b6\u3002\\n';",
          "39: var filename = join(common.fixturesDir, 'append-sync.txt');",
          "41: common.error('appending to ' + filename);",
          "42: fs.appendFileSync(filename, data);",
          "44: var fileData = fs.readFileSync(filename);",
          "46: assert.equal(Buffer.byteLength(data), fileData.length);",
          "49: var filename2 = join(common.fixturesDir, 'append-sync2.txt');",
          "50: fs.writeFileSync(filename2, currentFileData);",
          "52: common.error('appending to ' + filename2);",
          "53: fs.appendFileSync(filename2, data);",
          "55: var fileData2 = fs.readFileSync(filename2);",
          "57: assert.equal(Buffer.byteLength(data) + currentFileData.length, fileData2.length);",
          "60: var filename3 = join(common.fixturesDir, 'append-sync3.txt');",
          "61: fs.writeFileSync(filename3, currentFileData);",
          "63: common.error('appending to ' + filename3);",
          "65: var buf = new Buffer(data, 'utf8');",
          "66: fs.appendFileSync(filename3, buf);",
          "68: var fileData3 = fs.readFileSync(filename3);",
          "70: assert.equal(buf.length + currentFileData.length, fileData3.length);",
          "73: var filename4 = join(common.fixturesDir, 'append-sync4.txt');",
          "74: fs.writeFileSync(filename4, currentFileData);",
          "76: common.error('appending to ' + filename4);",
          "77: fs.appendFileSync(filename4, num);",
          "79: var fileData4 = fs.readFileSync(filename4);",
          "81: assert.equal(Buffer.byteLength('' + num) + currentFileData.length, fileData4.length);",
          "85: process.on('exit', function() {",
          "86:   common.error('done');",
          "88:   fs.unlinkSync(filename);",
          "89:   fs.unlinkSync(filename2);",
          "90:   fs.unlinkSync(filename3);",
          "91:   fs.unlinkSync(filename4);",
          "92: });",
          "",
          "---------------"
        ],
        "test/simple/test-fs-append-file.js||test/simple/test-fs-append-file.js": [
          "File: test/simple/test-fs-append-file.js -> test/simple/test-fs-append-file.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "22: var common = require('../common');",
          "23: var assert = require('assert');",
          "24: var fs = require('fs');",
          "25: var join = require('path').join;",
          "27: var filename = join(common.fixturesDir, 'append.txt');",
          "29: common.error('appending to ' + filename);",
          "31: var currentFileData = 'ABCD';",
          "33: var n = 220;",
          "34: var s = '\u5357\u8d8a\u56fd\u662f\u524d203\u5e74\u81f3\u524d111\u5e74\u5b58\u5728\u4e8e\u5cad\u5357\u5730\u533a\u7684\u4e00\u4e2a\u56fd\u5bb6\uff0c\u56fd\u90fd\u4f4d\u4e8e\u756a\u79ba\uff0c\u7586\u57df\u5305\u62ec\u4eca\u5929\u4e2d\u56fd\u7684\u5e7f\u4e1c\u3001' +",
          "35:         '\u5e7f\u897f\u4e24\u7701\u533a\u7684\u5927\u90e8\u4efd\u5730\u533a\uff0c\u798f\u5efa\u7701\u3001\u6e56\u5357\u3001\u8d35\u5dde\u3001\u4e91\u5357\u7684\u4e00\u5c0f\u90e8\u4efd\u5730\u533a\u548c\u8d8a\u5357\u7684\u5317\u90e8\u3002' +",
          "36:         '\u5357\u8d8a\u56fd\u662f\u79e6\u671d\u706d\u4ea1\u540e\uff0c\u7531\u5357\u6d77\u90e1\u5c09\u8d75\u4f57\u4e8e\u524d203\u5e74\u8d77\u5175\u517c\u5e76\u6842\u6797\u90e1\u548c\u8c61\u90e1\u540e\u5efa\u7acb\u3002' +",
          "37:         '\u524d196\u5e74\u548c\u524d179\u5e74\uff0c\u5357\u8d8a\u56fd\u66fe\u5148\u540e\u4e24\u6b21\u540d\u4e49\u4e0a\u81e3\u5c5e\u4e8e\u897f\u6c49\uff0c\u6210\u4e3a\u897f\u6c49\u7684\u201c\u5916\u81e3\u201d\u3002\u524d112\u5e74\uff0c' +",
          "38:         '\u5357\u8d8a\u56fd\u672b\u4ee3\u541b\u4e3b\u8d75\u5efa\u5fb7\u4e0e\u897f\u6c49\u53d1\u751f\u6218\u4e89\uff0c\u88ab\u6c49\u6b66\u5e1d\u4e8e\u524d111\u5e74\u6240\u706d\u3002\u5357\u8d8a\u56fd\u5171\u5b58\u572893\u5e74\uff0c' +",
          "39:         '\u5386\u7ecf\u4e94\u4ee3\u541b\u4e3b\u3002\u5357\u8d8a\u56fd\u662f\u5cad\u5357\u5730\u533a\u7684\u7b2c\u4e00\u4e2a\u6709\u8bb0\u8f7d\u7684\u653f\u6743\u56fd\u5bb6\uff0c\u91c7\u7528\u5c01\u5efa\u5236\u548c\u90e1\u53bf\u5236\u5e76\u5b58\u7684\u5236\u5ea6\uff0c' +",
          "40:         '\u5b83\u7684\u5efa\u7acb\u4fdd\u8bc1\u4e86\u79e6\u672b\u4e71\u4e16\u5cad\u5357\u5730\u533a\u793e\u4f1a\u79e9\u5e8f\u7684\u7a33\u5b9a\uff0c\u6709\u6548\u7684\u6539\u5584\u4e86\u5cad\u5357\u5730\u533a\u843d\u540e\u7684\u653f\u6cbb\u3001##\u6d4e\u73b0\u72b6\u3002\\n';",
          "42: var ncallbacks = 0;",
          "45: fs.appendFile(filename, s, function(e) {",
          "46:   if (e) throw e;",
          "48:   ncallbacks++;",
          "49:   common.error('appended to file');",
          "51:   fs.readFile(filename, function(e, buffer) {",
          "52:     if (e) throw e;",
          "53:     common.error('file read');",
          "54:     ncallbacks++;",
          "55:     assert.equal(Buffer.byteLength(s), buffer.length);",
          "56:   });",
          "57: });",
          "60: var filename2 = join(common.fixturesDir, 'append2.txt');",
          "61: fs.writeFileSync(filename2, currentFileData);",
          "63: fs.appendFile(filename2, s, function(e) {",
          "64:   if (e) throw e;",
          "66:   ncallbacks++;",
          "67:   common.error('appended to file2');",
          "69:   fs.readFile(filename2, function(e, buffer) {",
          "70:     if (e) throw e;",
          "71:     common.error('file2 read');",
          "72:     ncallbacks++;",
          "73:     assert.equal(Buffer.byteLength(s) + currentFileData.length, buffer.length);",
          "74:   });",
          "75: });",
          "78: var filename3 = join(common.fixturesDir, 'append3.txt');",
          "79: fs.writeFileSync(filename3, currentFileData);",
          "81: var buf = new Buffer(s, 'utf8');",
          "82: common.error('appending to ' + filename3);",
          "84: fs.appendFile(filename3, buf, function(e) {",
          "85:    if (e) throw e;",
          "87:    ncallbacks++;",
          "88:    common.error('appended to file3');",
          "90:   fs.readFile(filename3, function(e, buffer) {",
          "91:     if (e) throw e;",
          "92:     common.error('file3 read');",
          "93:     ncallbacks++;",
          "94:     assert.equal(buf.length + currentFileData.length, buffer.length);",
          "95:   });",
          "96: });",
          "99: var filename4 = join(common.fixturesDir, 'append4.txt');",
          "100: fs.writeFileSync(filename4, currentFileData);",
          "102: common.error('appending to ' + filename4);",
          "104: fs.appendFile(filename4, n, function(e) {",
          "105:   if (e) throw e;",
          "107:   ncallbacks++;",
          "108:   common.error('appended to file4');",
          "110:   fs.readFile(filename4, function(e, buffer) {",
          "111:     if (e) throw e;",
          "112:     common.error('file4 read');",
          "113:     ncallbacks++;",
          "114:     assert.equal(Buffer.byteLength('' + n) + currentFileData.length, buffer.length);",
          "115:   });",
          "116: });",
          "118: process.on('exit', function() {",
          "119:   common.error('done');",
          "120:   assert.equal(8, ncallbacks);",
          "122:   fs.unlinkSync(filename);",
          "123:   fs.unlinkSync(filename2);",
          "124:   fs.unlinkSync(filename3);",
          "125:   fs.unlinkSync(filename4);",
          "126: });",
          "",
          "---------------"
        ]
      }
    }
  ]
}