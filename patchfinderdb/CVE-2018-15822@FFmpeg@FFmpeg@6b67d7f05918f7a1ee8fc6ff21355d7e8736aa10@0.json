{
  "cve_id": "CVE-2018-15822",
  "cve_desc": "The flv_write_packet function in libavformat/flvenc.c in FFmpeg through 2.8 does not check for an empty audio packet, leading to an assertion failure.",
  "repo": "FFmpeg/FFmpeg",
  "patch_hash": "6b67d7f05918f7a1ee8fc6ff21355d7e8736aa10",
  "patch_info": {
    "commit_hash": "6b67d7f05918f7a1ee8fc6ff21355d7e8736aa10",
    "repo": "FFmpeg/FFmpeg",
    "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/6b67d7f05918f7a1ee8fc6ff21355d7e8736aa10",
    "files": [
      "libavformat/flvenc.c"
    ],
    "message": "avformat/flvenc: Check audio packet size\n\nFixes: Assertion failure\nFixes: assert_flvenc.c:941_1.swf\n\nFound-by: #CHEN HONGXU# <HCHEN017@e.ntu.edu.sg>\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
    "before_after_code_files": [
      "libavformat/flvenc.c||libavformat/flvenc.c"
    ]
  },
  "patch_diff": {
    "libavformat/flvenc.c||libavformat/flvenc.c": [
      "File: libavformat/flvenc.c -> libavformat/flvenc.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "883:     int flags = -1, flags_size, ret;",
      "884:     int64_t cur_offset = avio_tell(pb);",
      "886:     if (par->codec_id == AV_CODEC_ID_VP6F || par->codec_id == AV_CODEC_ID_VP6A ||",
      "887:         par->codec_id == AV_CODEC_ID_VP6  || par->codec_id == AV_CODEC_ID_AAC)",
      "888:         flags_size = 2;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "886:     if (par->codec_type == AVMEDIA_TYPE_AUDIO && !pkt->size) {",
      "887:         av_log(s, AV_LOG_WARNING, \"Empty audio Packet\\n\");",
      "888:         return AVERROR(EINVAL);",
      "889:     }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "44e878d08674a15906badfb921443a44ebf6257d",
      "candidate_info": {
        "commit_hash": "44e878d08674a15906badfb921443a44ebf6257d",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/44e878d08674a15906badfb921443a44ebf6257d",
        "files": [
          "libavformat/flvenc.c"
        ],
        "message": "avformat/flvenc: Check audio packet size\n\nFixes: Assertion failure\nFixes: assert_flvenc.c:941_1.swf\n\nFound-by: #CHEN HONGXU# <HCHEN017@e.ntu.edu.sg>\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>\n(cherry picked from commit 6b67d7f05918f7a1ee8fc6ff21355d7e8736aa10)\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
        "before_after_code_files": [
          "libavformat/flvenc.c||libavformat/flvenc.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavformat/flvenc.c||libavformat/flvenc.c"
          ],
          "candidate": [
            "libavformat/flvenc.c||libavformat/flvenc.c"
          ]
        }
      },
      "candidate_diff": {
        "libavformat/flvenc.c||libavformat/flvenc.c": [
          "File: libavformat/flvenc.c -> libavformat/flvenc.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "879:     int flags = -1, flags_size, ret;",
          "880:     int64_t cur_offset = avio_tell(pb);",
          "882:     if (par->codec_id == AV_CODEC_ID_VP6F || par->codec_id == AV_CODEC_ID_VP6A ||",
          "883:         par->codec_id == AV_CODEC_ID_VP6  || par->codec_id == AV_CODEC_ID_AAC)",
          "884:         flags_size = 2;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "882:     if (par->codec_type == AVMEDIA_TYPE_AUDIO && !pkt->size) {",
          "883:         av_log(s, AV_LOG_WARNING, \"Empty audio Packet\\n\");",
          "884:         return AVERROR(EINVAL);",
          "885:     }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "0026d007428a1ef5cd4e8f54bafc54c0306beab9",
      "candidate_info": {
        "commit_hash": "0026d007428a1ef5cd4e8f54bafc54c0306beab9",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/0026d007428a1ef5cd4e8f54bafc54c0306beab9",
        "files": [
          "libavformat/flvenc.c"
        ],
        "message": "avformat/flvenc: Check audio packet size\n\nFixes: Assertion failure\nFixes: assert_flvenc.c:941_1.swf\n\nFound-by: #CHEN HONGXU# <HCHEN017@e.ntu.edu.sg>\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>\n(cherry picked from commit 6b67d7f05918f7a1ee8fc6ff21355d7e8736aa10)\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
        "before_after_code_files": [
          "libavformat/flvenc.c||libavformat/flvenc.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavformat/flvenc.c||libavformat/flvenc.c"
          ],
          "candidate": [
            "libavformat/flvenc.c||libavformat/flvenc.c"
          ]
        }
      },
      "candidate_diff": {
        "libavformat/flvenc.c||libavformat/flvenc.c": [
          "File: libavformat/flvenc.c -> libavformat/flvenc.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "879:     int flags = -1, flags_size, ret;",
          "880:     int64_t cur_offset = avio_tell(pb);",
          "882:     if (par->codec_id == AV_CODEC_ID_VP6F || par->codec_id == AV_CODEC_ID_VP6A ||",
          "883:         par->codec_id == AV_CODEC_ID_VP6  || par->codec_id == AV_CODEC_ID_AAC)",
          "884:         flags_size = 2;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "882:     if (par->codec_type == AVMEDIA_TYPE_AUDIO && !pkt->size) {",
          "883:         av_log(s, AV_LOG_WARNING, \"Empty audio Packet\\n\");",
          "884:         return AVERROR(EINVAL);",
          "885:     }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "386975d7a4aa4f41451f5895a689aedbf83c4ecd",
      "candidate_info": {
        "commit_hash": "386975d7a4aa4f41451f5895a689aedbf83c4ecd",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/386975d7a4aa4f41451f5895a689aedbf83c4ecd",
        "files": [
          "libavformat/flvenc.c"
        ],
        "message": "avformat/flvenc: Check audio packet size\n\nFixes: Assertion failure\nFixes: assert_flvenc.c:941_1.swf\n\nFound-by: #CHEN HONGXU# <HCHEN017@e.ntu.edu.sg>\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>\n(cherry picked from commit 6b67d7f05918f7a1ee8fc6ff21355d7e8736aa10)\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
        "before_after_code_files": [
          "libavformat/flvenc.c||libavformat/flvenc.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavformat/flvenc.c||libavformat/flvenc.c"
          ],
          "candidate": [
            "libavformat/flvenc.c||libavformat/flvenc.c"
          ]
        }
      },
      "candidate_diff": {
        "libavformat/flvenc.c||libavformat/flvenc.c": [
          "File: libavformat/flvenc.c -> libavformat/flvenc.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "879:     int flags = -1, flags_size, ret;",
          "880:     int64_t cur_offset = avio_tell(pb);",
          "882:     if (par->codec_id == AV_CODEC_ID_VP6F || par->codec_id == AV_CODEC_ID_VP6A ||",
          "883:         par->codec_id == AV_CODEC_ID_VP6  || par->codec_id == AV_CODEC_ID_AAC)",
          "884:         flags_size = 2;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "882:     if (par->codec_type == AVMEDIA_TYPE_AUDIO && !pkt->size) {",
          "883:         av_log(s, AV_LOG_WARNING, \"Empty audio Packet\\n\");",
          "884:         return AVERROR(EINVAL);",
          "885:     }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "1b283238226bf2ff1f328ab4811375240224b346",
      "candidate_info": {
        "commit_hash": "1b283238226bf2ff1f328ab4811375240224b346",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/1b283238226bf2ff1f328ab4811375240224b346",
        "files": [
          "libavformat/flvenc.c"
        ],
        "message": "avformat/flvenc: Check audio packet size\n\nFixes: Assertion failure\nFixes: assert_flvenc.c:941_1.swf\n\nFound-by: #CHEN HONGXU# <HCHEN017@e.ntu.edu.sg>\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>\n(cherry picked from commit 6b67d7f05918f7a1ee8fc6ff21355d7e8736aa10)\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
        "before_after_code_files": [
          "libavformat/flvenc.c||libavformat/flvenc.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavformat/flvenc.c||libavformat/flvenc.c"
          ],
          "candidate": [
            "libavformat/flvenc.c||libavformat/flvenc.c"
          ]
        }
      },
      "candidate_diff": {
        "libavformat/flvenc.c||libavformat/flvenc.c": [
          "File: libavformat/flvenc.c -> libavformat/flvenc.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "575:     uint8_t *data = NULL;",
          "576:     int flags = -1, flags_size, ret;",
          "578:     if (par->codec_id == AV_CODEC_ID_VP6F || par->codec_id == AV_CODEC_ID_VP6A ||",
          "579:         par->codec_id == AV_CODEC_ID_VP6  || par->codec_id == AV_CODEC_ID_AAC)",
          "580:         flags_size = 2;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "578:     if (par->codec_type == AVMEDIA_TYPE_AUDIO && !pkt->size) {",
          "579:         av_log(s, AV_LOG_WARNING, \"Empty audio Packet\\n\");",
          "580:         return AVERROR(EINVAL);",
          "581:     }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "d8ecb335fe4852bbc172c7b79e66944d158b4d92",
      "candidate_info": {
        "commit_hash": "d8ecb335fe4852bbc172c7b79e66944d158b4d92",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/d8ecb335fe4852bbc172c7b79e66944d158b4d92",
        "files": [
          "libavformat/flvenc.c"
        ],
        "message": "avformat/flvenc: Check audio packet size\n\nFixes: Assertion failure\nFixes: assert_flvenc.c:941_1.swf\n\nFound-by: #CHEN HONGXU# <HCHEN017@e.ntu.edu.sg>\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>\n(cherry picked from commit 6b67d7f05918f7a1ee8fc6ff21355d7e8736aa10)\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
        "before_after_code_files": [
          "libavformat/flvenc.c||libavformat/flvenc.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavformat/flvenc.c||libavformat/flvenc.c"
          ],
          "candidate": [
            "libavformat/flvenc.c||libavformat/flvenc.c"
          ]
        }
      },
      "candidate_diff": {
        "libavformat/flvenc.c||libavformat/flvenc.c": [
          "File: libavformat/flvenc.c -> libavformat/flvenc.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "514:     uint8_t *data = NULL;",
          "515:     int flags = -1, flags_size, ret;",
          "517:     if (enc->codec_id == AV_CODEC_ID_VP6F || enc->codec_id == AV_CODEC_ID_VP6A ||",
          "518:         enc->codec_id == AV_CODEC_ID_VP6  || enc->codec_id == AV_CODEC_ID_AAC)",
          "519:         flags_size = 2;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "517:     if (enc->codec_type == AVMEDIA_TYPE_AUDIO && !pkt->size) {",
          "518:         av_log(s, AV_LOG_WARNING, \"Empty audio Packet\\n\");",
          "519:         return AVERROR(EINVAL);",
          "520:     }",
          "",
          "---------------"
        ]
      }
    }
  ]
}