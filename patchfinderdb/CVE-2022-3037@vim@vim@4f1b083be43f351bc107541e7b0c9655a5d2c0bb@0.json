{
  "cve_id": "CVE-2022-3037",
  "cve_desc": "Use After Free in GitHub repository vim/vim prior to 9.0.0322.",
  "repo": "vim/vim",
  "patch_hash": "4f1b083be43f351bc107541e7b0c9655a5d2c0bb",
  "patch_info": {
    "commit_hash": "4f1b083be43f351bc107541e7b0c9655a5d2c0bb",
    "repo": "vim/vim",
    "commit_url": "https://github.com/vim/vim/commit/4f1b083be43f351bc107541e7b0c9655a5d2c0bb",
    "files": [
      "src/quickfix.c",
      "src/testdir/test_quickfix.vim",
      "src/version.c"
    ],
    "message": "patch 9.0.0322: crash when no errors and 'quickfixtextfunc' is set\n\nProblem:    Crash when no errors and 'quickfixtextfunc' is set.\nSolution:   Do not handle errors if there aren't any.",
    "before_after_code_files": [
      "src/quickfix.c||src/quickfix.c",
      "src/testdir/test_quickfix.vim||src/testdir/test_quickfix.vim",
      "src/version.c||src/version.c"
    ]
  },
  "patch_diff": {
    "src/quickfix.c||src/quickfix.c": [
      "File: src/quickfix.c -> src/quickfix.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "4761:     }",
      "4765:     {",
      "4766:  char_u  dirname[MAXPATHL];",
      "4767:  int  invalid_val = FALSE;",
      "",
      "[Removed Lines]",
      "4764:     if (qfl != NULL)",
      "",
      "[Added Lines]",
      "4764:     if (qfl != NULL && qfl->qf_start != NULL)",
      "",
      "---------------"
    ],
    "src/testdir/test_quickfix.vim||src/testdir/test_quickfix.vim": [
      "File: src/testdir/test_quickfix.vim -> src/testdir/test_quickfix.vim",
      "--- Hunk 1 ---",
      "[Context before]",
      "4107:   endif",
      "4108: endfunc",
      "4110: func Test_getqflist()",
      "4111:   call Xgetlist_empty_tests('c')",
      "4112:   call Xgetlist_empty_tests('l')",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "4110: func Test_empty_list_quickfixtextfunc()",
      "4111:   \" This was crashing.  Can only reproduce by running it in a separate Vim",
      "4112:   \" instance.",
      "4113:   let lines =<< trim END",
      "4114:       func s:Func(o)",
      "4115:               cgetexpr '0'",
      "4116:       endfunc",
      "4117:       cope",
      "4118:       let &quickfixtextfunc = 's:Func'",
      "4119:       cgetfile [ex",
      "4120:   END",
      "4121:   call writefile(lines, 'Xquickfixtextfunc')",
      "4122:   call RunVim([], [], '-e -s -S Xquickfixtextfunc -c qa')",
      "4123:   call delete('Xquickfixtextfunc')",
      "4124: endfunc",
      "",
      "---------------"
    ],
    "src/version.c||src/version.c": [
      "File: src/version.c -> src/version.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "708: static int included_patches[] =",
      "711:     321,",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "711:     322,",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "db77cb3c08784e6038dd029271b2080c1b2d9acb",
      "candidate_info": {
        "commit_hash": "db77cb3c08784e6038dd029271b2080c1b2d9acb",
        "repo": "vim/vim",
        "commit_url": "https://github.com/vim/vim/commit/db77cb3c08784e6038dd029271b2080c1b2d9acb",
        "files": [
          "src/testdir/test_quickfix.vim",
          "src/testdir/test_recover.vim",
          "src/testdir/test_regexp_utf8.vim",
          "src/testdir/test_rename.vim",
          "src/testdir/test_restricted.vim",
          "src/version.c"
        ],
        "message": "patch 9.0.0669: too many delete() calls in tests\n\nProblem:    Too many delete() calls in tests.\nSolution:   Use deferred delete where possible.",
        "before_after_code_files": [
          "src/testdir/test_quickfix.vim||src/testdir/test_quickfix.vim",
          "src/testdir/test_recover.vim||src/testdir/test_recover.vim",
          "src/testdir/test_regexp_utf8.vim||src/testdir/test_regexp_utf8.vim",
          "src/testdir/test_rename.vim||src/testdir/test_rename.vim",
          "src/testdir/test_restricted.vim||src/testdir/test_restricted.vim",
          "src/version.c||src/version.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/testdir/test_quickfix.vim||src/testdir/test_quickfix.vim",
            "src/version.c||src/version.c"
          ],
          "candidate": [
            "src/testdir/test_quickfix.vim||src/testdir/test_quickfix.vim",
            "src/version.c||src/version.c"
          ]
        }
      },
      "candidate_diff": {
        "src/testdir/test_quickfix.vim||src/testdir/test_quickfix.vim": [
          "File: src/testdir/test_quickfix.vim -> src/testdir/test_quickfix.vim",
          "--- Hunk 1 ---",
          "[Context before]",
          "396:     Xtestfile1:700:10:Line 700",
          "397:     Xtestfile2:800:15:Line 800",
          "398:   END",
          "401:   enew!",
          "402:   Xfile Xqftestfile1",
          "",
          "[Removed Lines]",
          "399:   call writefile(lines, 'Xqftestfile1')",
          "",
          "[Added Lines]",
          "399:   call writefile(lines, 'Xqftestfile1', 'D')",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "439:   call writefile([t], 'Xqftestfile1', 'b')",
          "440:   silent! Xfile Xqftestfile1",
          "441:   call assert_equal(text, g:Xgetlist()[0].text)",
          "444: endfunc",
          "446: func Test_cfile()",
          "",
          "[Removed Lines]",
          "443:   call delete('Xqftestfile1')",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "795:   call assert_fails('Xbuffer', 'E342:')",
          "796:   %bw!",
          "799:   call test_alloc_fail(GetAllocId('qf_linebuf'), 0, 0)",
          "800:   call assert_fails('Xfile Xtest', 'E342:')",
          "802: endfunc",
          "804: func Test_nomem()",
          "",
          "[Removed Lines]",
          "798:   call writefile([repeat('a', 8192)], 'Xtest')",
          "801:   call delete('Xtest')",
          "",
          "[Added Lines]",
          "796:   call writefile([repeat('a', 8192)], 'Xtest', 'D')",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "899:   var rtp_save = &rtp",
          "900:   var dir = 'Xruntime/after'",
          "901:   &rtp ..= ',' .. dir",
          "903:   writefile(['vim9script'], dir .. '/ftplugin/qf.vim')",
          "904:   filetype plugin on",
          "905:   silent helpgrep grail",
          "",
          "[Removed Lines]",
          "902:   mkdir(dir .. '/ftplugin', 'p')",
          "",
          "[Added Lines]",
          "899:   mkdir(dir .. '/ftplugin', 'pR')",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "907:   silent helpgrep grail",
          "909:   assert_equal('aABceFs', &cpo)",
          "911:   &rtp = rtp_save",
          "912:   cclose",
          "913:   helpclose",
          "",
          "[Removed Lines]",
          "910:   delete('Xruntime', 'rf')",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "1180: endfunc",
          "1182: func Test_locationlist_cross_tab_jump()",
          "1185:   set switchbuf=usetab",
          "1187:   edit loclistfoo",
          "",
          "[Removed Lines]",
          "1183:   call writefile(['loclistfoo'], 'loclistfoo')",
          "1184:   call writefile(['loclistbar'], 'loclistbar')",
          "",
          "[Added Lines]",
          "1179:   call writefile(['loclistfoo'], 'loclistfoo', 'D')",
          "1180:   call writefile(['loclistbar'], 'loclistbar', 'D')",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "1192:   enew | only | tabonly",
          "1193:   set switchbuf&vim",
          "1196: endfunc",
          "1198: \" More tests for 'errorformat'",
          "",
          "[Removed Lines]",
          "1194:   call delete('loclistfoo')",
          "1195:   call delete('loclistbar')",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "1237:     \"Xtestfile\", line 22 col 9: What is the title of the quickfix window?",
          "1238:   [DATA]",
          "1243:   let m =<< [DATA]",
          "1244:  xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx    line  2",
          "",
          "[Removed Lines]",
          "1240:   call writefile(l, 'Xerrorfile1')",
          "1241:   call writefile(l[:-2], 'Xerrorfile2')",
          "",
          "[Added Lines]",
          "1234:   call writefile(l, 'Xerrorfile1', 'D')",
          "1235:   call delete('loclistbar')",
          "1236:   call writefile(l[:-2], 'Xerrorfile2', 'D')",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "1263:  xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx    line 21",
          "1264:  xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx    line 22",
          "1265: [DATA]",
          "1268:   let save_efm = &efm",
          "1269:   set efm+==%f=\\\\,\\ line\\ %l%*\\\\D%v%*[^\\ ]\\ %m",
          "",
          "[Removed Lines]",
          "1266:   call writefile(m, 'Xtestfile')",
          "",
          "[Added Lines]",
          "1261:   call writefile(m, 'Xtestfile', 'D')",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "1309:   wincmd p",
          "1311:   let &efm = save_efm",
          "1315: endfunc",
          "1317: \" Test for quickfix directory stack support",
          "",
          "[Removed Lines]",
          "1312:   call delete('Xerrorfile1')",
          "1313:   call delete('Xerrorfile2')",
          "1314:   call delete('Xtestfile')",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "1363: \" Tests for %D and %X errorformat options",
          "1364: func Test_efm_dirstack()",
          "1365:   \" Create the directory stack and files",
          "1367:   call mkdir('dir1/a')",
          "1368:   call mkdir('dir1/a/b')",
          "1369:   call mkdir('dir1/c')",
          "1372:   let lines =<< trim END",
          "1373:     Nine Healthy Habits",
          "",
          "[Removed Lines]",
          "1366:   call mkdir('dir1')",
          "1370:   call mkdir('dir2')",
          "",
          "[Added Lines]",
          "1358:   call mkdir('dir1', 'R')",
          "1362:   call mkdir('dir2', 'R')",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "1382:     8 Hours of sleep (at least)",
          "1383:     9 PM end of the day and off to bed",
          "1384:   END",
          "1386:   call writefile(lines, 'dir1/a/habits2.txt')",
          "1387:   call writefile(lines, 'dir1/a/b/habits3.txt')",
          "1388:   call writefile(lines, 'dir1/c/habits4.txt')",
          "",
          "[Removed Lines]",
          "1385:   call writefile(lines, 'habits1.txt')",
          "",
          "[Added Lines]",
          "1377:   call writefile(lines, 'habits1.txt', 'D')",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "1391:   call s:dir_stack_tests('c')",
          "1392:   call s:dir_stack_tests('l')",
          "1397: endfunc",
          "1399: \" Test for resync after continuing an ignored message",
          "",
          "[Removed Lines]",
          "1394:   call delete('dir1', 'rf')",
          "1395:   call delete('dir2', 'rf')",
          "1396:   call delete('habits1.txt')",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "1518:   set efm=%+P[%f]%r,(%l\\\\,%c)%*[\\ ]%t%*[^:]:\\ %m,%+Q--%r",
          "1519:   \" To exercise the push/pop file functionality in quickfix, the test files",
          "1520:   \" need to be created.",
          "1524:   cexpr \"\"",
          "1525:   for l in lines",
          "1526:       caddexpr l",
          "",
          "[Removed Lines]",
          "1521:   call writefile(['Line1'], 'Xtestfile1')",
          "1522:   call writefile(['Line2'], 'Xtestfile2')",
          "1523:   call writefile(['Line3'], 'Xtestfile3')",
          "",
          "[Added Lines]",
          "1509:   call writefile(['Line1'], 'Xtestfile1', 'D')",
          "1510:   call writefile(['Line2'], 'Xtestfile2', 'D')",
          "1511:   call writefile(['Line3'], 'Xtestfile3', 'D')",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1531:   call assert_equal(2, l[2].col)",
          "1532:   call assert_equal('w', l[2].type)",
          "1533:   call assert_equal('e', l[3].type)",
          "1538:   \" Test for %P, %Q with non-existing files",
          "1539:   cexpr lines",
          "",
          "[Removed Lines]",
          "1534:   call delete('Xtestfile1')",
          "1535:   call delete('Xtestfile2')",
          "1536:   call delete('Xtestfile3')",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1602:   \" Test for %o",
          "1603:   set efm=%f(%o):%l\\ %m",
          "1604:   cgetexpr ['Xotestfile(Language.PureScript.Types):20 Error']",
          "1606:   let l = getqflist()",
          "1607:   call assert_equal(1, len(l), string(l))",
          "1608:   call assert_equal('Language.PureScript.Types', l[0].module)",
          "",
          "[Removed Lines]",
          "1605:   call writefile(['Line1'], 'Xotestfile')",
          "",
          "[Added Lines]",
          "1590:   call writefile(['Line1'], 'Xotestfile', 'D')",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1612:   call assert_equal('Xotestfile', expand('%:t'))",
          "1613:   cclose",
          "1614:   bd",
          "1617:   \" Test for a long module name",
          "1618:   cexpr 'Xtest(' . repeat('m', 1026) . '):15 message'",
          "",
          "[Removed Lines]",
          "1615:   call delete(\"Xotestfile\")",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "1776: endfunc",
          "1778: func Test_setloclist_in_autocommand()",
          "1780:   edit Xfile",
          "1781:   let s:bufnr = bufnr()",
          "1782:   call setloclist(1,",
          "",
          "[Removed Lines]",
          "1779:   call writefile(['test1', 'test2'], 'Xfile')",
          "",
          "[Added Lines]",
          "1763:   call writefile(['test1', 'test2'], 'Xfile', 'D')",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1796:   augroup Test_LocList",
          "1797:     au!",
          "1798:   augroup END",
          "1800: endfunc",
          "1802: func Test_caddbuffer_to_empty()",
          "",
          "[Removed Lines]",
          "1799:   call delete('Xfile')",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "2129:       /tmp/file4:1:1:ccc",
          "2130:     END",
          "2131:     let lines[1] = substitute(lines[1], '%s', repeat('x', len), '')",
          "2133:     cgetfile Xcqetfile.txt",
          "2134:     call assert_equal(4, getqflist(#{size: v:true}).size, 'with length ' .. len)",
          "2135:   endfor",
          "2137: endfunc",
          "2139: func s:create_test_file(filename)",
          "",
          "[Removed Lines]",
          "2132:     call writefile(lines, 'Xcqetfile.txt')",
          "2136:   call delete('Xcqetfile.txt')",
          "",
          "[Added Lines]",
          "2115:     call writefile(lines, 'Xcqetfile.txt', 'D')",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "2274:   \" If opening a file changes 'switchbuf', then the new value should be",
          "2275:   \" retained.",
          "2276:   set modeline&vim",
          "2278:   enew | only",
          "2279:   set switchbuf&vim",
          "2280:   cexpr \"Xqftestfile1:1:10\"",
          "",
          "[Removed Lines]",
          "2277:   call writefile([\"vim: switchbuf=split\"], 'Xqftestfile1')",
          "",
          "[Added Lines]",
          "2259:   call writefile([\"vim: switchbuf=split\"], 'Xqftestfile1', 'D')",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "2290:   cexpr \"Xqftestfile1:1:10\"",
          "2291:   call assert_equal('', &switchbuf)",
          "2294:   call delete('Xqftestfile2')",
          "2295:   call delete('Xqftestfile3')",
          "2296:   set switchbuf&vim",
          "",
          "[Removed Lines]",
          "2293:   call delete('Xqftestfile1')",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "2385:   \" Use one 'errorformat' for two windows.  Add an expression to each of them,",
          "2386:   \" make sure they each keep their own state.",
          "2387:   set efm=%DEntering\\ dir\\ '%f',%f:%l:%m,%XLeaving\\ dir\\ '%f'",
          "2390:   let lines = ['1', '2', 'one one one', '4', 'two two two', '6', '7']",
          "2391:   call writefile(lines, 'Xone/a/one.txt')",
          "2392:   call writefile(lines, 'Xtwo/a/two.txt')",
          "",
          "[Removed Lines]",
          "2388:   call mkdir('Xone/a', 'p')",
          "2389:   call mkdir('Xtwo/a', 'p')",
          "",
          "[Added Lines]",
          "2369:   call mkdir('Xone/a', 'pR')",
          "2370:   call mkdir('Xtwo/a', 'pR')",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "2418:   bwipe!",
          "2419:   call win_gotoid(two_id)",
          "2420:   bwipe!",
          "2423: endfunc",
          "2425: func XbottomTests(cchar)",
          "",
          "[Removed Lines]",
          "2421:   call delete('Xone', 'rf')",
          "2422:   call delete('Xtwo', 'rf')",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 25 ---",
          "[Context before]",
          "2503:   let last_buffer = bufnr(\"$\")",
          "2505:   \" make sure only one buffer is created",
          "2507:   vimgrep one Xgrepthis",
          "2508:   vimgrep one Xgrepthis",
          "2509:   call assert_equal(last_buffer + 1, bufnr(\"$\"))",
          "2512: endfunc",
          "2514: \" Quickfix/Location list set/get properties tests",
          "",
          "[Removed Lines]",
          "2506:   call writefile(['this one', 'that one'], 'Xgrepthis')",
          "2511:   call delete('Xgrepthis')",
          "",
          "[Added Lines]",
          "2485:   call writefile(['this one', 'that one'], 'Xgrepthis', 'D')",
          "",
          "---------------",
          "--- Hunk 26 ---",
          "[Context before]",
          "2876:   END",
          "2877:   call assert_equal(l, g:acmds)",
          "2881:   let g:acmds = []",
          "2882:   cfile Xtest",
          "2883:   caddfile Xtest",
          "",
          "[Removed Lines]",
          "2879:   call writefile(['Xtest:1:Line1'], 'Xtest')",
          "2880:   call writefile([], 'Xempty')",
          "",
          "[Added Lines]",
          "2856:   call writefile(['Xtest:1:Line1'], 'Xtest', 'D')",
          "2857:   call writefile([], 'Xempty', 'D')",
          "",
          "---------------",
          "--- Hunk 27 ---",
          "[Context before]",
          "2976:     call assert_equal(l, g:acmds)",
          "2977:   endif",
          "2981:   au! QuickFixCmdPre",
          "2982:   au! QuickFixCmdPost",
          "2983: endfunc",
          "",
          "[Removed Lines]",
          "2979:   call delete('Xtest')",
          "2980:   call delete('Xempty')",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 28 ---",
          "[Context before]",
          "3137:     redraw",
          "3138:     cwindow 4",
          "3139:   END",
          "3141:   let buf = RunVimInTerminal('-S XtestCwindow', #{rows: 12})",
          "3142:   call VerifyScreenDump(buf, 'Test_quickfix_cwindow_1', {})",
          "",
          "[Removed Lines]",
          "3140:   call writefile(lines, 'XtestCwindow')",
          "",
          "[Added Lines]",
          "3115:   call writefile(lines, 'XtestCwindow', 'D')",
          "",
          "---------------",
          "--- Hunk 29 ---",
          "[Context before]",
          "3153:   \" clean up",
          "3154:   call StopVimInTerminal(buf)",
          "3156:   call delete('XCwindow')",
          "3157: endfunc",
          "",
          "[Removed Lines]",
          "3155:   call delete('XtestCwindow')",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 30 ---",
          "[Context before]",
          "3164:     Editor:Emacs EmAcS",
          "3165:     Editor:Notepad NOTEPAD",
          "3166:   END",
          "3170:   \" Error cases",
          "3171:   call assert_fails('Xvimgrep /abc *', 'E682:')",
          "",
          "[Removed Lines]",
          "3167:   call writefile(lines, 'Xtestfile1')",
          "3168:   call writefile(['Linux', 'macOS', 'MS-Windows'], 'Xtestfile2')",
          "",
          "[Added Lines]",
          "3141:   call writefile(lines, 'Xtestfile1', 'D')",
          "3142:   call writefile(['Linux', 'macOS', 'MS-Windows'], 'Xtestfile2', 'D')",
          "",
          "---------------",
          "--- Hunk 31 ---",
          "[Context before]",
          "3221:   augroup QF_Test",
          "3222:     au!",
          "3223:   augroup END",
          "3227: endfunc",
          "3229: \" Tests for the :vimgrep command",
          "",
          "[Removed Lines]",
          "3225:   call delete('Xtestfile1')",
          "3226:   call delete('Xtestfile2')",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 32 ---",
          "[Context before]",
          "3261:     call writefile(v:errors, 'Xresult')",
          "3262:     qall!",
          "3263:   [SCRIPT]",
          "3265:   if RunVim([], [], '--clean -S Xscript')",
          "3266:     call assert_equal([], readfile('Xresult'))",
          "3267:   endif",
          "3269:   call delete('Xresult')",
          "3270: endfunc",
          "",
          "[Removed Lines]",
          "3264:   call writefile(lines, 'Xscript')",
          "3268:   call delete('Xscript')",
          "",
          "[Added Lines]",
          "3235:   call writefile(lines, 'Xscript', 'D')",
          "",
          "---------------",
          "--- Hunk 33 ---",
          "[Context before]",
          "3276:     call writefile(['done'], 'Xresult')",
          "3277:     qall!",
          "3278:   [SCRIPT]",
          "3280:   if RunVim([], [], '--clean -n -S Xscript Xscript')",
          "3281:     call assert_equal(['done'], readfile('Xresult'))",
          "3282:   endif",
          "3284:   call delete('Xresult')",
          "3285: endfunc",
          "3287: func Test_vimgrep_existing_swapfile()",
          "3290:   let g:foundSwap = 0",
          "3291:   let g:ignoreSwapExists = 1",
          "3292:   augroup grep",
          "",
          "[Removed Lines]",
          "3279:   call writefile(lines, 'Xscript')",
          "3283:   call delete('Xscript')",
          "3288:   call writefile(['match apple with apple'], 'Xapple')",
          "3289:   call writefile(['swapfile'], '.Xapple.swp')",
          "",
          "[Added Lines]",
          "3249:   call writefile(lines, 'Xscript', 'D')",
          "3257:   call writefile(['match apple with apple'], 'Xapple', 'D')",
          "3258:   call writefile(['swapfile'], '.Xapple.swp', 'D')",
          "",
          "---------------",
          "--- Hunk 34 ---",
          "[Context before]",
          "3296:   call assert_equal(1, g:foundSwap)",
          "3297:   call assert_match('.Xapple.swo', swapname(''))",
          "3301:   augroup grep",
          "3302:     au! SwapExists",
          "3303:   augroup END",
          "",
          "[Removed Lines]",
          "3299:   call delete('Xapple')",
          "3300:   call delete('.Xapple.swp')",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 35 ---",
          "[Context before]",
          "3638: endfunc",
          "3640: func Test_multidirstack()",
          "3643:   let lines = ['1', '2', 'one one one', '4', 'two two two', '6', '7']",
          "3644:   call writefile(lines, 'Xone/a/one.txt')",
          "3645:   call writefile(lines, 'Xtwo/a/two.txt')",
          "",
          "[Removed Lines]",
          "3641:   call mkdir('Xone/a', 'p')",
          "3642:   call mkdir('Xtwo/a', 'p')",
          "",
          "[Added Lines]",
          "3608:   call mkdir('Xone/a', 'pR')",
          "3609:   call mkdir('Xtwo/a', 'pR')",
          "",
          "---------------",
          "--- Hunk 36 ---",
          "[Context before]",
          "3650:   call Xmultidirstack_tests('l')",
          "3652:   let &efm = save_efm",
          "3655: endfunc",
          "3657: \" Tests for per quickfix/location list file stack",
          "",
          "[Removed Lines]",
          "3653:   call delete('Xone', 'rf')",
          "3654:   call delete('Xtwo', 'rf')",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 37 ---",
          "[Context before]",
          "3701: func Test_multifilestack()",
          "3702:   let lines = ['1', '2', 'one one one', '4', 'two two two', '6', '7']",
          "3705:   let save_efm = &efm",
          "3706:   set efm=%+P[%f],(%l\\\\,%c)\\ %m,%-Q",
          "",
          "[Removed Lines]",
          "3703:   call writefile(lines, 'one.txt')",
          "3704:   call writefile(lines, 'two.txt')",
          "",
          "[Added Lines]",
          "3668:   call writefile(lines, 'one.txt', 'D')",
          "3669:   call writefile(lines, 'two.txt', 'D')",
          "",
          "---------------",
          "--- Hunk 38 ---",
          "[Context before]",
          "3709:   call Xmultifilestack_tests('l')",
          "3711:   let &efm = save_efm",
          "3714: endfunc",
          "3716: \" Tests for per buffer 'efm' setting",
          "3717: func Test_perbuf_efm()",
          "3720:   set efm=%f#%l#%m",
          "3721:   new | only",
          "3722:   new",
          "",
          "[Removed Lines]",
          "3712:   call delete('one.txt')",
          "3713:   call delete('two.txt')",
          "3718:   call writefile([\"File1-10-Line10\"], 'one.txt')",
          "3719:   call writefile([\"File2#20#Line20\"], 'two.txt')",
          "",
          "[Added Lines]",
          "3681:   call writefile([\"File1-10-Line10\"], 'one.txt', 'D')",
          "3682:   call writefile([\"File2#20#Line20\"], 'two.txt', 'D')",
          "",
          "---------------",
          "--- Hunk 39 ---",
          "[Context before]",
          "3732:   set efm&",
          "3733:   new | only",
          "3736: endfunc",
          "3738: \" Open multiple help windows using \":lhelpgrep",
          "",
          "[Removed Lines]",
          "3734:   call delete('one.txt')",
          "3735:   call delete('two.txt')",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 40 ---",
          "[Context before]",
          "3908: func Xqfjump_tests(cchar)",
          "3909:   call s:setup_commands(a:cchar)",
          "3915:   call g:Xsetlist([], 'f')",
          "",
          "[Removed Lines]",
          "3911:   call writefile([\"Line1\\tFoo\", \"Line2\"], 'F1')",
          "3912:   call writefile([\"Line1\\tBar\", \"Line2\"], 'F2')",
          "3913:   call writefile([\"Line1\\tBaz\", \"Line2\"], 'F3')",
          "",
          "[Added Lines]",
          "3872:   call writefile([\"Line1\\tFoo\", \"Line2\"], 'F1', 'D')",
          "3873:   call writefile([\"Line1\\tBar\", \"Line2\"], 'F2', 'D')",
          "3874:   call writefile([\"Line1\\tBaz\", \"Line2\"], 'F3', 'D')",
          "",
          "---------------",
          "--- Hunk 41 ---",
          "[Context before]",
          "3999:   \" Cleanup",
          "4000:   enew!",
          "4001:   new | only",
          "4006: endfunc",
          "4008: func Test_qfjump()",
          "",
          "[Removed Lines]",
          "4003:   call delete('F1')",
          "4004:   call delete('F2')",
          "4005:   call delete('F3')",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 42 ---",
          "[Context before]",
          "4118:       let &quickfixtextfunc = 's:Func'",
          "4119:       cgetfile [ex",
          "4120:   END",
          "4122:   call RunVim([], [], '-e -s -S Xquickfixtextfunc -c qa')",
          "4124: endfunc",
          "4126: func Test_getqflist()",
          "",
          "[Removed Lines]",
          "4121:   call writefile(lines, 'Xquickfixtextfunc')",
          "4123:   call delete('Xquickfixtextfunc')",
          "",
          "[Added Lines]",
          "4078:   call writefile(lines, 'Xquickfixtextfunc', 'D')",
          "",
          "---------------",
          "--- Hunk 43 ---",
          "[Context before]",
          "4173:        \\ {'filename' : 'F7', 'lnum' : 11, 'text' : 'L11'}], 'r')",
          "4174:   call assert_equal(2, g:Xgetlist({'changedtick' : 0}).changedtick)",
          "4177:   Xfile Xone",
          "4178:   call assert_equal(1, g:Xgetlist({'changedtick' : 0}).changedtick)",
          "4179:   Xaddfile Xone",
          "",
          "[Removed Lines]",
          "4176:   call writefile([\"F8:80:L80\", \"F8:81:L81\"], \"Xone\")",
          "",
          "[Added Lines]",
          "4132:   call writefile([\"F8:80:L80\", \"F8:81:L81\"], \"Xone\", 'D')",
          "",
          "---------------",
          "--- Hunk 44 ---",
          "[Context before]",
          "4186:   call g:Xsetlist([], 'a', {'nr' : 1, \"lines\" : [\"F10:10:L10\"]})",
          "4187:   call assert_equal(1, g:Xgetlist({'changedtick' : 0}).changedtick)",
          "4188:   call assert_equal(2, g:Xgetlist({'nr' : 1, 'changedtick' : 0}).changedtick)",
          "4191: endfunc",
          "4193: func Test_qf_tick()",
          "",
          "[Removed Lines]",
          "4190:   call delete(\"Xone\")",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 45 ---",
          "[Context before]",
          "4341: \" :vimgrep/:lvimgrep commands are running.",
          "4342: func Test_vimgrep_autocmd()",
          "4343:   call setqflist([], 'f')",
          "4347:   \" Test 1:",
          "4348:   \" When searching for a pattern using :vimgrep, if the quickfix list is",
          "",
          "[Removed Lines]",
          "4344:   call writefile(['stars'], 'Xtest1.txt')",
          "4345:   call writefile(['stars'], 'Xtest2.txt')",
          "",
          "[Added Lines]",
          "4298:   call writefile(['stars'], 'Xtest1.txt', 'D')",
          "4299:   call writefile(['stars'], 'Xtest2.txt', 'D')",
          "",
          "---------------",
          "--- Hunk 46 ---",
          "[Context before]",
          "4373:   call assert_fails('lvimgrep stars Xtest*.txt', 'E926:')",
          "4374:   au! BufRead Xtest2.txt",
          "4378:   call setqflist([], 'f')",
          "4379: endfunc",
          "",
          "[Removed Lines]",
          "4376:   call delete('Xtest1.txt')",
          "4377:   call delete('Xtest2.txt')",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 47 ---",
          "[Context before]",
          "4403: endfunc",
          "4405: func Test_vimgrep_autocmd_cd()",
          "4408:   call writefile(['a_L1_vim', 'a_L2_vim'], 'Xgrepdir/a/f1.txt')",
          "4409:   call writefile(['b_L1_vim', 'b_L2_vim'], 'Xgrepdir/b/f2.txt')",
          "4410:   call Xvimgrep_autocmd_cd('c')",
          "4411:   call Xvimgrep_autocmd_cd('l')",
          "4412:   %bwipe",
          "4414: endfunc",
          "4416: \" The following test used to crash Vim",
          "",
          "[Removed Lines]",
          "4406:   call mkdir('Xgrepdir/a', 'p')",
          "4407:   call mkdir('Xgrepdir/b', 'p')",
          "4413:   call delete('Xgrepdir', 'rf')",
          "",
          "[Added Lines]",
          "4358:   call mkdir('Xgrepdir/a', 'pR')",
          "4359:   call mkdir('Xgrepdir/b', 'pR')",
          "",
          "---------------",
          "--- Hunk 48 ---",
          "[Context before]",
          "4539: \" Otherwise due to indentation, the title is set with spaces at the beginning",
          "4540: \" of the command.",
          "4541: func Test_qftitle()",
          "4544:   \" :cexpr",
          "4545:   exe \"cexpr readfile('Xerr')\"",
          "",
          "[Removed Lines]",
          "4542:   call writefile([\"F1:1:Line1\"], 'Xerr')",
          "",
          "[Added Lines]",
          "4493:   call writefile([\"F1:1:Line1\"], 'Xerr', 'D')",
          "",
          "---------------",
          "--- Hunk 49 ---",
          "[Context before]",
          "4617:   call assert_equal(':setqflist()', getqflist({'title' : 1}).title)",
          "4619:   close",
          "4622:   call setqflist([], ' ', {'title' : 'Errors'})",
          "4623:   copen",
          "",
          "[Removed Lines]",
          "4620:   call delete('Xerr')",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 50 ---",
          "[Context before]",
          "4701:   \" Test for cfile/lfile",
          "4702:   enew",
          "4704:   Xfile Xerr",
          "4705:   call assert_equal('Xtestfile1', @%)",
          "4706:   call assert_equal(2, line('.'))",
          "",
          "[Removed Lines]",
          "4703:   call writefile(l, 'Xerr')",
          "",
          "[Added Lines]",
          "4653:   call writefile(l, 'Xerr', 'D')",
          "",
          "---------------",
          "--- Hunk 51 ---",
          "[Context before]",
          "4711:   call assert_equal('Xtestfile1', @%)",
          "4712:   call assert_equal(2, line('.'))",
          "4715:   call delete('Xtestfile1')",
          "4716:   call delete('Xtestfile2')",
          "4717: endfunc",
          "",
          "[Removed Lines]",
          "4714:   call delete('Xerr')",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 52 ---",
          "[Context before]",
          "4731:   call s:create_test_file('Xtestfile2')",
          "4732:   Xexpr 'Xtestfile1:2:Line2'",
          "4733:   autocmd QuickFixCmdPost * Xolder",
          "4735:   Xfile Xerr",
          "4736:   call assert_equal('Xtestfile2', @%)",
          "4737:   call assert_equal(4, line('.'))",
          "",
          "[Removed Lines]",
          "4734:   call writefile(['Xtestfile2:4:Line4'], 'Xerr')",
          "",
          "[Added Lines]",
          "4683:   call writefile(['Xtestfile2:4:Line4'], 'Xerr', 'D')",
          "",
          "---------------",
          "--- Hunk 53 ---",
          "[Context before]",
          "4802:   call assert_fails('silent Xvimgrep Line5 Xtestfile2', 'E480:')",
          "4803:   autocmd! QuickFixCmdPost",
          "4806:   call delete('Xtestfile1')",
          "4807:   call delete('Xtestfile2')",
          "4808: endfunc",
          "",
          "[Removed Lines]",
          "4805:   call delete('Xerr')",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 54 ---",
          "[Context before]",
          "4919: \" Test for parsing entries using visual screen column",
          "4920: func Test_viscol()",
          "4921:   enew",
          "4923:   edit Xfile1",
          "4925:   \" Use byte offset for column number",
          "",
          "[Removed Lines]",
          "4922:   call writefile([\"Col1\\tCol2\\tCol3\"], 'Xfile1')",
          "",
          "[Added Lines]",
          "4870:   call writefile([\"Col1\\tCol2\\tCol3\"], 'Xfile1', 'D')",
          "",
          "---------------",
          "--- Hunk 55 ---",
          "[Context before]",
          "4985:   enew | only",
          "4986:   set efm&",
          "4988: endfunc",
          "4990: \" Test for the quickfix window buffer",
          "",
          "[Removed Lines]",
          "4987:   call delete('Xfile1')",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 56 ---",
          "[Context before]",
          "5101: \" a normal buffer.",
          "5102: func Test_empty_qfbuf()",
          "5103:   enew | only",
          "5105:   call setqflist([], 'f')",
          "5106:   copen | only",
          "5107:   let qfbuf = bufnr('')",
          "5108:   edit Xfile1",
          "5109:   call assert_notequal(qfbuf, bufnr(''))",
          "5110:   enew",
          "5112: endfunc",
          "5114: \" Test for the :cbelow, :cabove, :lbelow and :labove commands.",
          "",
          "[Removed Lines]",
          "5104:   call writefile([\"Test\"], 'Xfile1')",
          "5111:   call delete('Xfile1')",
          "",
          "[Added Lines]",
          "5051:   call writefile([\"Test\"], 'Xfile1', 'D')",
          "",
          "---------------",
          "--- Hunk 57 ---",
          "[Context before]",
          "5341:   call assert_equal(0, g:Xgetlist({'nr' : '$'}).nr)",
          "5343:   \" cfile/lfile",
          "5345:   let e = ''",
          "5346:   try",
          "5347:     Xfile Xfile1",
          "",
          "[Removed Lines]",
          "5344:   call writefile([\"F1:10:Line10\", \"F2:20:Line20\"], 'Xfile1')",
          "",
          "[Added Lines]",
          "5290:   call writefile([\"F1:10:Line10\", \"F2:20:Line20\"], 'Xfile1', 'D')",
          "",
          "---------------",
          "--- Hunk 58 ---",
          "[Context before]",
          "5350:   endtry",
          "5351:   call assert_equal('AbortCmd', e)",
          "5352:   call assert_equal(0, g:Xgetlist({'nr' : '$'}).nr)",
          "5355:   \" cgetbuffer/lgetbuffer",
          "5356:   enew!",
          "",
          "[Removed Lines]",
          "5353:   call delete('Xfile1')",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 59 ---",
          "[Context before]",
          "5415: \" Test for using a file in one of the parent directories.",
          "5416: func Test_search_in_dirstack()",
          "5418:   let save_cwd = getcwd()",
          "5419:   call writefile([\"X1_L1\", \"X1_L2\"], 'Xtestdir/Xfile1')",
          "5420:   call writefile([\"X2_L1\", \"X2_L2\"], 'Xtestdir/a/Xfile2')",
          "",
          "[Removed Lines]",
          "5417:   call mkdir('Xtestdir/a/b/c', 'p')",
          "",
          "[Added Lines]",
          "5362:   call mkdir('Xtestdir/a/b/c', 'pR')",
          "",
          "---------------",
          "--- Hunk 60 ---",
          "[Context before]",
          "5452:   set efm&",
          "5453:   exe 'cd ' . save_cwd",
          "5455: endfunc",
          "5457: \" Test for :cquit",
          "",
          "[Removed Lines]",
          "5454:   call delete('Xtestdir', 'rf')",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 61 ---",
          "[Context before]",
          "5895: \" Running :lhelpgrep command more than once in a help window, doesn't jump to",
          "5896: \" the help topic",
          "5897: func Test_lhelpgrep_from_help_window()",
          "5899:   call writefile(['window'], 'Xtestdir/doc/a.txt')",
          "5900:   call writefile(['buffer'], 'Xtestdir/doc/b.txt')",
          "5901:   let save_rtp = &rtp",
          "",
          "[Removed Lines]",
          "5898:   call mkdir('Xtestdir/doc', 'p')",
          "",
          "[Added Lines]",
          "5842:   call mkdir('Xtestdir/doc', 'pR')",
          "",
          "---------------",
          "--- Hunk 62 ---",
          "[Context before]",
          "5906:   lhelpgrep window",
          "5907:   call assert_equal('a.txt', fnamemodify(@%, \":p:t\"))",
          "5908:   let &rtp = save_rtp",
          "5910:   new | only!",
          "5911: endfunc",
          "",
          "[Removed Lines]",
          "5909:   call delete('Xtestdir', 'rf')",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 63 ---",
          "[Context before]",
          "5993:         anything",
          "5994:       endtry",
          "5995:   END",
          "5998:   let lines =<< trim END",
          "5999:       split XquickfixFails",
          "",
          "[Removed Lines]",
          "5996:   call writefile(lines, 'XquickfixFails')",
          "",
          "[Added Lines]",
          "5939:   call writefile(lines, 'XquickfixFails', 'D')",
          "",
          "---------------",
          "--- Hunk 64 ---",
          "[Context before]",
          "6004:       \" is aborted but the window was already split.",
          "6005:       silent! cwindow",
          "6006:   END",
          "6008:   let buf = RunVimInTerminal('-S XtestWinFails', #{rows: 13})",
          "6009:   call VerifyScreenDump(buf, 'Test_quickfix_window_fails', {})",
          "",
          "[Removed Lines]",
          "6007:   call writefile(lines, 'XtestWinFails')",
          "",
          "[Added Lines]",
          "5950:   call writefile(lines, 'XtestWinFails', 'D')",
          "",
          "---------------",
          "--- Hunk 65 ---",
          "[Context before]",
          "6012:   call term_sendkeys(buf, \":bwipe!\\<CR>\")",
          "6013:   call term_wait(buf)",
          "6014:   call StopVimInTerminal(buf)",
          "6017: endfunc",
          "6019: \" Test for updating the quickfix buffer whenever the associated quickfix list",
          "",
          "[Removed Lines]",
          "6015:   call delete('XtestWinFails')",
          "6016:   call delete('XquickfixFails')",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 66 ---",
          "[Context before]",
          "6077: func Test_vimgrep_noswapfile()",
          "6078:   set noswapfile",
          "6080:   vimgrep two Xgreppie",
          "6081:   call assert_equal('two', getline('.'))",
          "6084:   set swapfile",
          "6085: endfunc",
          "",
          "[Removed Lines]",
          "6079:   call writefile(['one', 'two', 'three'], 'Xgreppie')",
          "6083:   call delete('Xgreppie')",
          "",
          "[Added Lines]",
          "6020:   call writefile(['one', 'two', 'three'], 'Xgreppie', 'D')",
          "",
          "---------------",
          "--- Hunk 67 ---",
          "[Context before]",
          "6122: endfunc",
          "6124: func Test_vimgrep_fuzzy_match()",
          "6127:   call Xvimgrep_fuzzy_match('c')",
          "6128:   call Xvimgrep_fuzzy_match('l')",
          "6131: endfunc",
          "6133: func Test_locationlist_open_in_newtab()",
          "",
          "[Removed Lines]",
          "6125:   call writefile(['one two three', 'aaaaaa'], 'Xfile1')",
          "6126:   call writefile(['one', 'three one two', 'two', 'aaathreeaaa'], 'Xfile2')",
          "6129:   call delete('Xfile1')",
          "6130:   call delete('Xfile2')",
          "",
          "[Added Lines]",
          "6065:   call writefile(['one two three', 'aaaaaa'], 'Xfile1', 'D')",
          "6066:   call writefile(['one', 'three one two', 'two', 'aaathreeaaa'], 'Xfile2', 'D')",
          "",
          "---------------",
          "--- Hunk 68 ---",
          "[Context before]",
          "6265:     call writefile(['done'], 'Xresult')",
          "6266:     qall!",
          "6267:   END",
          "6269:   if RunVim([], [], '-u NONE -n -X -Z -e -m -s -S Xscript')",
          "6270:     call assert_equal(['done'], readfile('Xresult'))",
          "6271:   endif",
          "6274:   call delete('Xresult')",
          "6275: endfunc",
          "",
          "[Removed Lines]",
          "6268:   call writefile(lines, 'Xscript')",
          "6273:   call delete('Xscript')",
          "",
          "[Added Lines]",
          "6206:   call writefile(lines, 'Xscript', 'D')",
          "",
          "---------------"
        ],
        "src/testdir/test_recover.vim||src/testdir/test_recover.vim": [
          "File: src/testdir/test_recover.vim -> src/testdir/test_recover.vim",
          "--- Hunk 1 ---",
          "[Context before]",
          "140:   call setline(1, ['a', 'b', 'c'])",
          "141:   preserve",
          "142:   let b = readblob(swapname(''))",
          "146:   %bw!",
          "147:   call feedkeys(\":recover Xfile1\\<CR>3\\<CR>q\", 'xt')",
          "148:   call assert_equal(['a', 'b', 'c'], getline(1, '$'))",
          "",
          "[Removed Lines]",
          "143:   call writefile(b, '.Xfile1.swm')",
          "144:   call writefile(b, '.Xfile1.swn')",
          "145:   call writefile(b, '.Xfile1.swo')",
          "",
          "[Added Lines]",
          "143:   call writefile(b, '.Xfile1.swm', 'D')",
          "144:   call writefile(b, '.Xfile1.swn', 'D')",
          "145:   call writefile(b, '.Xfile1.swo', 'D')",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "156:   call assert_equal('Xfile1', @%)",
          "157:   call assert_equal([''], getline(1, '$'))",
          "158:   bw!",
          "163: endfunc",
          "165: \" Test for :recover using an empty swap file",
          "166: func Test_recover_empty_swap_file()",
          "167:   CheckUnix",
          "169:   let msg = execute('recover Xfile1')",
          "170:   call assert_match('Unable to read block 0 from .Xfile1.swp', msg)",
          "171:   call assert_equal('Xfile1', @%)",
          "",
          "[Removed Lines]",
          "160:   call delete('.Xfile1.swm')",
          "161:   call delete('.Xfile1.swn')",
          "162:   call delete('.Xfile1.swo')",
          "168:   call writefile([], '.Xfile1.swp')",
          "",
          "[Added Lines]",
          "164:   call writefile([], '.Xfile1.swp', 'D')",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "179:   \" :recover from an empty buffer",
          "180:   call assert_fails('recover', 'E305:')",
          "182: endfunc",
          "184: \" Test for :recover using a corrupted swap file",
          "",
          "[Removed Lines]",
          "181:   call delete('.Xfile1.swp')",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "366:   CheckNotRoot",
          "367:   new Xfile1",
          "368:   let b = readblob('.Xfile1.swp')",
          "370:   bw!",
          "371:   call setfperm('.Xfile1.swm', '-w-------')",
          "372:   call assert_fails('recover Xfile1', 'E306:')",
          "374: endfunc",
          "376: \" Test for using :recover when the original file and the swap file have the",
          "",
          "[Removed Lines]",
          "369:   call writefile(b, '.Xfile1.swm')",
          "373:   call delete('.Xfile1.swm')",
          "",
          "[Added Lines]",
          "364:   call writefile(b, '.Xfile1.swm', 'D')",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "382:   preserve",
          "383:   let b = readblob('.Xfile1.swp')",
          "384:   %bw!",
          "386:   let msg = execute('recover Xfile1')",
          "387:   call assert_equal(['aaa', 'bbb', 'ccc'], getline(1, '$'))",
          "388:   call assert_false(&modified)",
          "389:   call assert_match('Buffer contents equals file contents', msg)",
          "390:   bw!",
          "391:   call delete('Xfile1')",
          "393: endfunc",
          "395: \" Test for recovering a file when editing a symbolically linked file",
          "396: func Test_recover_symbolic_link()",
          "397:   CheckUnix",
          "399:   silent !ln -s Xfile1 Xfile2",
          "400:   edit Xfile2",
          "401:   call assert_equal('.Xfile1.swp', fnamemodify(swapname(''), ':t'))",
          "",
          "[Removed Lines]",
          "385:   call writefile(b, '.Xfile1.swz')",
          "392:   call delete('.Xfile1.swz')",
          "398:   call writefile(['aaa', 'bbb', 'ccc'], 'Xfile1')",
          "",
          "[Added Lines]",
          "379:   call writefile(b, '.Xfile1.swz', 'D')",
          "391:   call writefile(['aaa', 'bbb', 'ccc'], 'Xfile1', 'D')",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "410:   update",
          "411:   %bw!",
          "412:   call assert_equal(['aaa', 'bbb', 'ccc'], readfile('Xfile1'))",
          "414:   call delete('Xfile2')",
          "415:   call delete('.Xfile1.swp')",
          "416: endfunc",
          "",
          "[Removed Lines]",
          "413:   call delete('Xfile1')",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "419: \" line. This used to result in an internal error (E315) which is fixed",
          "420: \" by 8.2.2966.",
          "421: func Test_recover_invalid_cursor_pos()",
          "423:   edit Xfile1",
          "424:   preserve",
          "425:   let b = readblob('.Xfile1.swp')",
          "",
          "[Removed Lines]",
          "422:   call writefile([], 'Xfile1')",
          "",
          "[Added Lines]",
          "414:   call writefile([], 'Xfile1', 'D')",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "429:     au BufReadPost Xfile1 normal! 3G",
          "430:   augroup END",
          "431:   call writefile(range(1, 3), 'Xfile1')",
          "433:   try",
          "434:     recover Xfile1",
          "435:   catch /E308:/",
          "",
          "[Removed Lines]",
          "432:   call writefile(b, '.Xfile1.swp')",
          "",
          "[Added Lines]",
          "424:   call writefile(b, '.Xfile1.swp', 'D')",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "441:     au!",
          "442:   augroup END",
          "443:   augroup! Test",
          "446: endfunc",
          "448: \" Test for recovering a buffer without a name",
          "",
          "[Removed Lines]",
          "444:   call delete('Xfile1')",
          "445:   call delete('.Xfile1.swp')",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "453:   let sn = swapname('')",
          "454:   let b = readblob(sn)",
          "455:   bw!",
          "457:   exe \"recover \" .. sn",
          "458:   call assert_equal(['one', 'two'], getline(1, '$'))",
          "460: endfunc",
          "462: \" vim: shiftwidth=2 sts=2 expandtab",
          "",
          "[Removed Lines]",
          "456:   call writefile(b, sn)",
          "459:   call delete(sn)",
          "",
          "[Added Lines]",
          "446:   call writefile(b, sn, 'D')",
          "",
          "---------------"
        ],
        "src/testdir/test_regexp_utf8.vim||src/testdir/test_regexp_utf8.vim": [
          "File: src/testdir/test_regexp_utf8.vim -> src/testdir/test_regexp_utf8.vim",
          "--- Hunk 1 ---",
          "[Context before]",
          "555:   bwipe!",
          "556: endfunc",
          "559:   call writefile(0z630a.765d30aa0a.2e0a.790a.4030, 'Xinvalid')",
          "560:   new",
          "561:   source Xinvalid",
          "563:   call delete('Xinvalid')",
          "564: endfunc",
          "566: func Test_match_illegal_byte()",
          "567:   \" Text has illegal bytes which need to be set explicitly",
          "569:   call writefile(lines, 'Xregexp')",
          "570:   call system(GetVimCommand() .. ' -X -Z -e -s -S Xregexp -c qa!')",
          "572:   call delete('Xregexp')",
          "573: endfunc",
          "",
          "[Removed Lines]",
          "558: func Test_match_invalid_byte()",
          "562:   bwipe!",
          "568:   let lines = [\"norm :set no\\x01\\<CR>\", \"silent n\\xff\", \"silent norm :b\\xff\\<CR>\"]",
          "",
          "[Added Lines]",
          "558: func Test_match_invalid_byte()",
          "567:   let lines = [\"norm :set no\\x01\\<CR>\", \"silent n\\xff\", \"silent norm :b\\xff\\<CR>\"]",
          "",
          "---------------"
        ],
        "src/testdir/test_rename.vim||src/testdir/test_rename.vim": [
          "File: src/testdir/test_rename.vim -> src/testdir/test_rename.vim",
          "--- Hunk 1 ---",
          "[Context before]",
          "13:   \" When the destination file already exists, it should be overwritten.",
          "14:   call writefile(['foo'], 'Xrename1')",
          "17:   call assert_equal(0, rename('Xrename1', 'Xrename2'))",
          "18:   call assert_equal('', glob('Xrename1'))",
          "",
          "[Removed Lines]",
          "15:   call writefile(['bar'], 'Xrename2')",
          "",
          "[Added Lines]",
          "15:   call writefile(['bar'], 'Xrename2', 'D')",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "36: endfunc",
          "38: func Test_rename_same_file()",
          "41:   \" When the source and destination are the same file, nothing",
          "42:   \" should be done. The source file should not be deleted.",
          "",
          "[Removed Lines]",
          "39:   call writefile(['foo'], 'Xrename')",
          "",
          "[Added Lines]",
          "39:   call writefile(['foo'], 'Xrename', 'D')",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "46:   call assert_equal(0, rename('./Xrename', 'Xrename'))",
          "47:   call assert_equal(['foo'], readfile('Xrename'))",
          "50: endfunc",
          "52: func Test_rename_dir_to_dir()",
          "",
          "[Removed Lines]",
          "49:   call delete('Xrename')",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "63: endfunc",
          "65: func Test_rename_same_dir()",
          "67:   call writefile(['foo'], 'Xrenamedir/Xrenamefile')",
          "69:   call assert_equal(0, rename('Xrenamedir', 'Xrenamedir'))",
          "71:   call assert_equal(['foo'], readfile('Xrenamedir/Xrenamefile'))",
          "75: endfunc",
          "77: func Test_rename_copy()",
          "78:   \" Check that when original file can't be deleted, rename()",
          "79:   \" still succeeds but copies the file.",
          "81:   call writefile(['foo'], 'Xrenamedir/Xrenamefile')",
          "82:   call setfperm('Xrenamedir', 'r-xr-xr-x')",
          "",
          "[Removed Lines]",
          "66:   call mkdir('Xrenamedir')",
          "73:   call delete('Xrenamedir/Xrenamefile')",
          "74:   call delete('Xrenamedir', 'd')",
          "80:   call mkdir('Xrenamedir')",
          "",
          "[Added Lines]",
          "64:   call mkdir('Xrenamedir', 'R')",
          "75:   call mkdir('Xrenamedir', 'R')",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "91:   call assert_equal(['foo'], readfile('Xrenamefile'))",
          "93:   call setfperm('Xrenamedir', 'rwxrwxrwx')",
          "96:   call delete('Xrenamefile')",
          "97: endfunc",
          "99: func Test_rename_fails()",
          "102:   \" Can't rename into a non-existing directory.",
          "103:   call assert_notequal(0, rename('Xrenamefile', 'Xdoesnotexist/Xrenamefile'))",
          "",
          "[Removed Lines]",
          "94:   call delete('Xrenamedir/Xrenamefile')",
          "95:   call delete('Xrenamedir', 'd')",
          "100:   call writefile(['foo'], 'Xrenamefile')",
          "",
          "[Added Lines]",
          "93:   call writefile(['foo'], 'Xrenamefile', 'D')",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "116:   call assert_fails('call rename(\"Xrenamefile\", [])', 'E730:')",
          "117:   call assert_fails('call rename(0z, \"Xrenamefile\")', 'E976:')",
          "120: endfunc",
          "122: \" vim: shiftwidth=2 sts=2 expandtab",
          "",
          "[Removed Lines]",
          "119:   call delete('Xrenamefile')",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/testdir/test_restricted.vim||src/testdir/test_restricted.vim": [
          "File: src/testdir/test_restricted.vim -> src/testdir/test_restricted.vim",
          "--- Hunk 1 ---",
          "[Context before]",
          "101:     call writefile(v:errors, 'Xresult')",
          "102:     qa!",
          "103:   END",
          "105:   if RunVim([], [], '-Z --clean -S Xrestricted')",
          "106:     call assert_equal([], readfile('Xresult'))",
          "107:   endif",
          "",
          "[Removed Lines]",
          "104:   call writefile(lines, 'Xrestricted')",
          "",
          "[Added Lines]",
          "104:   call writefile(lines, 'Xrestricted', 'D')",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "114:     call assert_equal([], readfile('Xresult'))",
          "115:   endif",
          "118:   call delete('Xresult')",
          "119: endfunc",
          "",
          "[Removed Lines]",
          "117:   call delete('Xrestricted')",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/version.c||src/version.c": [
          "File: src/version.c -> src/version.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "700: static int included_patches[] =",
          "703:     668,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "703:     669,",
          "",
          "---------------"
        ]
      }
    }
  ]
}