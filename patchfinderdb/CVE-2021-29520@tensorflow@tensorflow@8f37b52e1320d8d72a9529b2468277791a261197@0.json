{
  "cve_id": "CVE-2021-29520",
  "cve_desc": "TensorFlow is an end-to-end open source platform for machine learning. Missing validation between arguments to `tf.raw_ops.Conv3DBackprop*` operations can result in heap buffer overflows. This is because the implementation(https://github.com/tensorflow/tensorflow/blob/4814fafb0ca6b5ab58a09411523b2193fed23fed/tensorflow/core/kernels/conv_grad_shape_utils.cc#L94-L153) assumes that the `input`, `filter_sizes` and `out_backprop` tensors have the same shape, as they are accessed in parallel. The fix will be included in TensorFlow 2.5.0. We will also cherrypick this commit on TensorFlow 2.4.2, TensorFlow 2.3.3, TensorFlow 2.2.3 and TensorFlow 2.1.4, as these are also affected and still in supported range.",
  "repo": "tensorflow/tensorflow",
  "patch_hash": "8f37b52e1320d8d72a9529b2468277791a261197",
  "patch_info": {
    "commit_hash": "8f37b52e1320d8d72a9529b2468277791a261197",
    "repo": "tensorflow/tensorflow",
    "commit_url": "https://github.com/tensorflow/tensorflow/commit/8f37b52e1320d8d72a9529b2468277791a261197",
    "files": [
      "tensorflow/core/kernels/conv_grad_ops_3d.cc"
    ],
    "message": "Validate some shape requirements for `Conv3DBackpropFilter*` and `Conv3DBackpropInput*` ops.\n\nOlder versions of Eigen might otherwise crash / produce OOB read on specially crafted inputs.\n\nPiperOrigin-RevId: 369293977\nChange-Id: I58f51445a93936d7cf8e616f75de17677df36718",
    "before_after_code_files": [
      "tensorflow/core/kernels/conv_grad_ops_3d.cc||tensorflow/core/kernels/conv_grad_ops_3d.cc"
    ]
  },
  "patch_diff": {
    "tensorflow/core/kernels/conv_grad_ops_3d.cc||tensorflow/core/kernels/conv_grad_ops_3d.cc": [
      "File: tensorflow/core/kernels/conv_grad_ops_3d.cc -> tensorflow/core/kernels/conv_grad_ops_3d.cc",
      "--- Hunk 1 ---",
      "[Context before]",
      "239:       input_shape = context->input(0).shape();",
      "240:     }",
      "242:     ConvBackpropDimensions dims;",
      "243:     OP_REQUIRES_OK(context, ConvBackpropComputeDimensions(",
      "244:                                 \"Conv3DBackpropInputOp\", /*num_spatial_dims=*/3,",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "242:     OP_REQUIRES(",
      "243:         context, input_shape.dim_size(4) == filter_shape.dim_size(3),",
      "244:         errors::InvalidArgument(\"input and filter_sizes must have the same \"",
      "245:                                 \"number of channels. Got \",",
      "246:                                 input_shape.dim_size(4), \" for input and \",",
      "247:                                 filter_shape.dim_size(3), \" for filter_sizes\"));",
      "248:     OP_REQUIRES(",
      "249:         context, out_backprop_shape.dim_size(4) == filter_shape.dim_size(4),",
      "250:         errors::InvalidArgument(\"out_backprop and filter_sizes must have the \"",
      "251:                                 \"same number of channels. Got \",",
      "252:                                 out_backprop_shape.dim_size(4),",
      "253:                                 \" for out_backprop and \",",
      "254:                                 filter_shape.dim_size(4), \" for filter_sizes\"));",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "346:       input_shape = context->input(0).shape();",
      "347:     }",
      "349:     ConvBackpropDimensions dims;",
      "350:     OP_REQUIRES_OK(context, ConvBackpropComputeDimensions(",
      "351:                                 \"Conv3DBackpropInputOp\", /*num_spatial_dims=*/3,",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "363:     OP_REQUIRES(",
      "364:         context, input_shape.dim_size(4) == filter_shape.dim_size(3),",
      "365:         errors::InvalidArgument(\"input and filter_sizes must have the same \"",
      "366:                                 \"number of channels. Got \",",
      "367:                                 input_shape.dim_size(4), \" for input and \",",
      "368:                                 filter_shape.dim_size(3), \" for filter_sizes\"));",
      "369:     OP_REQUIRES(",
      "370:         context, out_backprop_shape.dim_size(4) == filter_shape.dim_size(4),",
      "371:         errors::InvalidArgument(\"out_backprop and filter_sizes must have the \"",
      "372:                                 \"same number of channels. Got \",",
      "373:                                 out_backprop_shape.dim_size(4),",
      "374:                                 \" for out_backprop and \",",
      "375:                                 filter_shape.dim_size(4), \" for filter_sizes\"));",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "696:       filter_shape = context->input(1).shape();",
      "697:     }",
      "699:     ConvBackpropDimensions dims;",
      "700:     OP_REQUIRES_OK(context,",
      "701:                    ConvBackpropComputeDimensions(",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "727:     OP_REQUIRES(",
      "728:         context, input_shape.dim_size(4) == filter_shape.dim_size(3),",
      "729:         errors::InvalidArgument(\"input and filter_sizes must have the same \"",
      "730:                                 \"number of channels. Got \",",
      "731:                                 input_shape.dim_size(4), \" for input and \",",
      "732:                                 filter_shape.dim_size(3), \" for filter_sizes\"));",
      "733:     OP_REQUIRES(",
      "734:         context, out_backprop_shape.dim_size(4) == filter_shape.dim_size(4),",
      "735:         errors::InvalidArgument(\"out_backprop and filter_sizes must have the \"",
      "736:                                 \"same number of channels. Got \",",
      "737:                                 out_backprop_shape.dim_size(4),",
      "738:                                 \" for out_backprop and \",",
      "739:                                 filter_shape.dim_size(4), \" for filter_sizes\"));",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "808:       filter_shape = context->input(1).shape();",
      "809:     }",
      "811:     ConvBackpropDimensions dims;",
      "812:     OP_REQUIRES_OK(context,",
      "813:                    ConvBackpropComputeDimensions(",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "853:     OP_REQUIRES(",
      "854:         context, input_shape.dim_size(4) == filter_shape.dim_size(3),",
      "855:         errors::InvalidArgument(\"input and filter_sizes must have the same \"",
      "856:                                 \"number of channels. Got \",",
      "857:                                 input_shape.dim_size(4), \" for input and \",",
      "858:                                 filter_shape.dim_size(3), \" for filter_sizes\"));",
      "859:     OP_REQUIRES(",
      "860:         context, out_backprop_shape.dim_size(4) == filter_shape.dim_size(4),",
      "861:         errors::InvalidArgument(\"out_backprop and filter_sizes must have the \"",
      "862:                                 \"same number of channels. Got \",",
      "863:                                 out_backprop_shape.dim_size(4),",
      "864:                                 \" for out_backprop and \",",
      "865:                                 filter_shape.dim_size(4), \" for filter_sizes\"));",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "ed53e273b83aaece49e384aa37c9307b2464588f",
      "candidate_info": {
        "commit_hash": "ed53e273b83aaece49e384aa37c9307b2464588f",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/ed53e273b83aaece49e384aa37c9307b2464588f",
        "files": [
          "tensorflow/core/kernels/conv_grad_ops_3d.cc"
        ],
        "message": "Validate some shape requirements for `Conv3DBackpropFilter*` and `Conv3DBackpropInput*` ops.\n\nOlder versions of Eigen might otherwise crash / produce OOB read on specially crafted inputs.\n\nPiperOrigin-RevId: 369293977\nChange-Id: I58f51445a93936d7cf8e616f75de17677df36718",
        "before_after_code_files": [
          "tensorflow/core/kernels/conv_grad_ops_3d.cc||tensorflow/core/kernels/conv_grad_ops_3d.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/core/kernels/conv_grad_ops_3d.cc||tensorflow/core/kernels/conv_grad_ops_3d.cc"
          ],
          "candidate": [
            "tensorflow/core/kernels/conv_grad_ops_3d.cc||tensorflow/core/kernels/conv_grad_ops_3d.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/core/kernels/conv_grad_ops_3d.cc||tensorflow/core/kernels/conv_grad_ops_3d.cc": [
          "File: tensorflow/core/kernels/conv_grad_ops_3d.cc -> tensorflow/core/kernels/conv_grad_ops_3d.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "236:       input_shape = context->input(0).shape();",
          "237:     }",
          "239:     ConvBackpropDimensions dims;",
          "240:     OP_REQUIRES_OK(context, ConvBackpropComputeDimensions(",
          "241:                                 \"Conv3DBackpropInputOp\", /*num_spatial_dims=*/3,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "239:     OP_REQUIRES(",
          "240:         context, input_shape.dim_size(4) == filter_shape.dim_size(3),",
          "241:         errors::InvalidArgument(\"input and filter_sizes must have the same \"",
          "242:                                 \"number of channels. Got \",",
          "243:                                 input_shape.dim_size(4), \" for input and \",",
          "244:                                 filter_shape.dim_size(3), \" for filter_sizes\"));",
          "245:     OP_REQUIRES(",
          "246:         context, out_backprop_shape.dim_size(4) == filter_shape.dim_size(4),",
          "247:         errors::InvalidArgument(\"out_backprop and filter_sizes must have the \"",
          "248:                                 \"same number of channels. Got \",",
          "249:                                 out_backprop_shape.dim_size(4),",
          "250:                                 \" for out_backprop and \",",
          "251:                                 filter_shape.dim_size(4), \" for filter_sizes\"));",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "342:       input_shape = context->input(0).shape();",
          "343:     }",
          "345:     ConvBackpropDimensions dims;",
          "346:     OP_REQUIRES_OK(context, ConvBackpropComputeDimensions(",
          "347:                                 \"Conv3DBackpropInputOp\", /*num_spatial_dims=*/3,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "359:     OP_REQUIRES(",
          "360:         context, input_shape.dim_size(4) == filter_shape.dim_size(3),",
          "361:         errors::InvalidArgument(\"input and filter_sizes must have the same \"",
          "362:                                 \"number of channels. Got \",",
          "363:                                 input_shape.dim_size(4), \" for input and \",",
          "364:                                 filter_shape.dim_size(3), \" for filter_sizes\"));",
          "365:     OP_REQUIRES(",
          "366:         context, out_backprop_shape.dim_size(4) == filter_shape.dim_size(4),",
          "367:         errors::InvalidArgument(\"out_backprop and filter_sizes must have the \"",
          "368:                                 \"same number of channels. Got \",",
          "369:                                 out_backprop_shape.dim_size(4),",
          "370:                                 \" for out_backprop and \",",
          "371:                                 filter_shape.dim_size(4), \" for filter_sizes\"));",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "692:       filter_shape = context->input(1).shape();",
          "693:     }",
          "695:     ConvBackpropDimensions dims;",
          "696:     OP_REQUIRES_OK(context,",
          "697:                    ConvBackpropComputeDimensions(",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "723:     OP_REQUIRES(",
          "724:         context, input_shape.dim_size(4) == filter_shape.dim_size(3),",
          "725:         errors::InvalidArgument(\"input and filter_sizes must have the same \"",
          "726:                                 \"number of channels. Got \",",
          "727:                                 input_shape.dim_size(4), \" for input and \",",
          "728:                                 filter_shape.dim_size(3), \" for filter_sizes\"));",
          "729:     OP_REQUIRES(",
          "730:         context, out_backprop_shape.dim_size(4) == filter_shape.dim_size(4),",
          "731:         errors::InvalidArgument(\"out_backprop and filter_sizes must have the \"",
          "732:                                 \"same number of channels. Got \",",
          "733:                                 out_backprop_shape.dim_size(4),",
          "734:                                 \" for out_backprop and \",",
          "735:                                 filter_shape.dim_size(4), \" for filter_sizes\"));",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "804:       filter_shape = context->input(1).shape();",
          "805:     }",
          "807:     ConvBackpropDimensions dims;",
          "808:     OP_REQUIRES_OK(context,",
          "809:                    ConvBackpropComputeDimensions(",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "849:     OP_REQUIRES(",
          "850:         context, input_shape.dim_size(4) == filter_shape.dim_size(3),",
          "851:         errors::InvalidArgument(\"input and filter_sizes must have the same \"",
          "852:                                 \"number of channels. Got \",",
          "853:                                 input_shape.dim_size(4), \" for input and \",",
          "854:                                 filter_shape.dim_size(3), \" for filter_sizes\"));",
          "855:     OP_REQUIRES(",
          "856:         context, out_backprop_shape.dim_size(4) == filter_shape.dim_size(4),",
          "857:         errors::InvalidArgument(\"out_backprop and filter_sizes must have the \"",
          "858:                                 \"same number of channels. Got \",",
          "859:                                 out_backprop_shape.dim_size(4),",
          "860:                                 \" for out_backprop and \",",
          "861:                                 filter_shape.dim_size(4), \" for filter_sizes\"));",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "5e5d7dda0128fe49eaf31ad97bbf477e975a6a9a",
      "candidate_info": {
        "commit_hash": "5e5d7dda0128fe49eaf31ad97bbf477e975a6a9a",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/5e5d7dda0128fe49eaf31ad97bbf477e975a6a9a",
        "files": [
          "tensorflow/core/kernels/conv_grad_ops_3d.cc"
        ],
        "message": "Validate some shape requirements for `Conv3DBackpropFilter*` and `Conv3DBackpropInput*` ops.\n\nOlder versions of Eigen might otherwise crash / produce OOB read on specially crafted inputs.\n\nPiperOrigin-RevId: 369293977\nChange-Id: I58f51445a93936d7cf8e616f75de17677df36718",
        "before_after_code_files": [
          "tensorflow/core/kernels/conv_grad_ops_3d.cc||tensorflow/core/kernels/conv_grad_ops_3d.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/core/kernels/conv_grad_ops_3d.cc||tensorflow/core/kernels/conv_grad_ops_3d.cc"
          ],
          "candidate": [
            "tensorflow/core/kernels/conv_grad_ops_3d.cc||tensorflow/core/kernels/conv_grad_ops_3d.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/core/kernels/conv_grad_ops_3d.cc||tensorflow/core/kernels/conv_grad_ops_3d.cc": [
          "File: tensorflow/core/kernels/conv_grad_ops_3d.cc -> tensorflow/core/kernels/conv_grad_ops_3d.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "238:       input_shape = context->input(0).shape();",
          "239:     }",
          "241:     ConvBackpropDimensions dims;",
          "242:     OP_REQUIRES_OK(context, ConvBackpropComputeDimensions(",
          "243:                                 \"Conv3DBackpropInputOp\", /*num_spatial_dims=*/3,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "241:     OP_REQUIRES(",
          "242:         context, input_shape.dim_size(4) == filter_shape.dim_size(3),",
          "243:         errors::InvalidArgument(\"input and filter_sizes must have the same \"",
          "244:                                 \"number of channels. Got \",",
          "245:                                 input_shape.dim_size(4), \" for input and \",",
          "246:                                 filter_shape.dim_size(3), \" for filter_sizes\"));",
          "247:     OP_REQUIRES(",
          "248:         context, out_backprop_shape.dim_size(4) == filter_shape.dim_size(4),",
          "249:         errors::InvalidArgument(\"out_backprop and filter_sizes must have the \"",
          "250:                                 \"same number of channels. Got \",",
          "251:                                 out_backprop_shape.dim_size(4),",
          "252:                                 \" for out_backprop and \",",
          "253:                                 filter_shape.dim_size(4), \" for filter_sizes\"));",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "345:       input_shape = context->input(0).shape();",
          "346:     }",
          "348:     ConvBackpropDimensions dims;",
          "349:     OP_REQUIRES_OK(context, ConvBackpropComputeDimensions(",
          "350:                                 \"Conv3DBackpropInputOp\", /*num_spatial_dims=*/3,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "362:     OP_REQUIRES(",
          "363:         context, input_shape.dim_size(4) == filter_shape.dim_size(3),",
          "364:         errors::InvalidArgument(\"input and filter_sizes must have the same \"",
          "365:                                 \"number of channels. Got \",",
          "366:                                 input_shape.dim_size(4), \" for input and \",",
          "367:                                 filter_shape.dim_size(3), \" for filter_sizes\"));",
          "368:     OP_REQUIRES(",
          "369:         context, out_backprop_shape.dim_size(4) == filter_shape.dim_size(4),",
          "370:         errors::InvalidArgument(\"out_backprop and filter_sizes must have the \"",
          "371:                                 \"same number of channels. Got \",",
          "372:                                 out_backprop_shape.dim_size(4),",
          "373:                                 \" for out_backprop and \",",
          "374:                                 filter_shape.dim_size(4), \" for filter_sizes\"));",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "695:       filter_shape = context->input(1).shape();",
          "696:     }",
          "698:     ConvBackpropDimensions dims;",
          "699:     OP_REQUIRES_OK(context,",
          "700:                    ConvBackpropComputeDimensions(",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "726:     OP_REQUIRES(",
          "727:         context, input_shape.dim_size(4) == filter_shape.dim_size(3),",
          "728:         errors::InvalidArgument(\"input and filter_sizes must have the same \"",
          "729:                                 \"number of channels. Got \",",
          "730:                                 input_shape.dim_size(4), \" for input and \",",
          "731:                                 filter_shape.dim_size(3), \" for filter_sizes\"));",
          "732:     OP_REQUIRES(",
          "733:         context, out_backprop_shape.dim_size(4) == filter_shape.dim_size(4),",
          "734:         errors::InvalidArgument(\"out_backprop and filter_sizes must have the \"",
          "735:                                 \"same number of channels. Got \",",
          "736:                                 out_backprop_shape.dim_size(4),",
          "737:                                 \" for out_backprop and \",",
          "738:                                 filter_shape.dim_size(4), \" for filter_sizes\"));",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "807:       filter_shape = context->input(1).shape();",
          "808:     }",
          "810:     ConvBackpropDimensions dims;",
          "811:     OP_REQUIRES_OK(context,",
          "812:                    ConvBackpropComputeDimensions(",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "852:     OP_REQUIRES(",
          "853:         context, input_shape.dim_size(4) == filter_shape.dim_size(3),",
          "854:         errors::InvalidArgument(\"input and filter_sizes must have the same \"",
          "855:                                 \"number of channels. Got \",",
          "856:                                 input_shape.dim_size(4), \" for input and \",",
          "857:                                 filter_shape.dim_size(3), \" for filter_sizes\"));",
          "858:     OP_REQUIRES(",
          "859:         context, out_backprop_shape.dim_size(4) == filter_shape.dim_size(4),",
          "860:         errors::InvalidArgument(\"out_backprop and filter_sizes must have the \"",
          "861:                                 \"same number of channels. Got \",",
          "862:                                 out_backprop_shape.dim_size(4),",
          "863:                                 \" for out_backprop and \",",
          "864:                                 filter_shape.dim_size(4), \" for filter_sizes\"));",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "c51c97d5fc484d1edb06aaa5d1c7d7304c08dca3",
      "candidate_info": {
        "commit_hash": "c51c97d5fc484d1edb06aaa5d1c7d7304c08dca3",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/c51c97d5fc484d1edb06aaa5d1c7d7304c08dca3",
        "files": [
          "tensorflow/core/kernels/conv_grad_ops_3d.cc"
        ],
        "message": "Validate some shape requirements for `Conv3DBackpropFilter*` and `Conv3DBackpropInput*` ops.\n\nOlder versions of Eigen might otherwise crash / produce OOB read on specially crafted inputs.\n\nPiperOrigin-RevId: 369293977\nChange-Id: I58f51445a93936d7cf8e616f75de17677df36718",
        "before_after_code_files": [
          "tensorflow/core/kernels/conv_grad_ops_3d.cc||tensorflow/core/kernels/conv_grad_ops_3d.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/core/kernels/conv_grad_ops_3d.cc||tensorflow/core/kernels/conv_grad_ops_3d.cc"
          ],
          "candidate": [
            "tensorflow/core/kernels/conv_grad_ops_3d.cc||tensorflow/core/kernels/conv_grad_ops_3d.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/core/kernels/conv_grad_ops_3d.cc||tensorflow/core/kernels/conv_grad_ops_3d.cc": [
          "File: tensorflow/core/kernels/conv_grad_ops_3d.cc -> tensorflow/core/kernels/conv_grad_ops_3d.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "239:       input_shape = context->input(0).shape();",
          "240:     }",
          "242:     ConvBackpropDimensions dims;",
          "243:     OP_REQUIRES_OK(context, ConvBackpropComputeDimensions(",
          "244:                                 \"Conv3DBackpropInputOp\", /*num_spatial_dims=*/3,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "242:     OP_REQUIRES(",
          "243:         context, input_shape.dim_size(4) == filter_shape.dim_size(3),",
          "244:         errors::InvalidArgument(\"input and filter_sizes must have the same \"",
          "245:                                 \"number of channels. Got \",",
          "246:                                 input_shape.dim_size(4), \" for input and \",",
          "247:                                 filter_shape.dim_size(3), \" for filter_sizes\"));",
          "248:     OP_REQUIRES(",
          "249:         context, out_backprop_shape.dim_size(4) == filter_shape.dim_size(4),",
          "250:         errors::InvalidArgument(\"out_backprop and filter_sizes must have the \"",
          "251:                                 \"same number of channels. Got \",",
          "252:                                 out_backprop_shape.dim_size(4),",
          "253:                                 \" for out_backprop and \",",
          "254:                                 filter_shape.dim_size(4), \" for filter_sizes\"));",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "346:       input_shape = context->input(0).shape();",
          "347:     }",
          "349:     ConvBackpropDimensions dims;",
          "350:     OP_REQUIRES_OK(context, ConvBackpropComputeDimensions(",
          "351:                                 \"Conv3DBackpropInputOp\", /*num_spatial_dims=*/3,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "363:     OP_REQUIRES(",
          "364:         context, input_shape.dim_size(4) == filter_shape.dim_size(3),",
          "365:         errors::InvalidArgument(\"input and filter_sizes must have the same \"",
          "366:                                 \"number of channels. Got \",",
          "367:                                 input_shape.dim_size(4), \" for input and \",",
          "368:                                 filter_shape.dim_size(3), \" for filter_sizes\"));",
          "369:     OP_REQUIRES(",
          "370:         context, out_backprop_shape.dim_size(4) == filter_shape.dim_size(4),",
          "371:         errors::InvalidArgument(\"out_backprop and filter_sizes must have the \"",
          "372:                                 \"same number of channels. Got \",",
          "373:                                 out_backprop_shape.dim_size(4),",
          "374:                                 \" for out_backprop and \",",
          "375:                                 filter_shape.dim_size(4), \" for filter_sizes\"));",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "696:       filter_shape = context->input(1).shape();",
          "697:     }",
          "699:     ConvBackpropDimensions dims;",
          "700:     OP_REQUIRES_OK(context,",
          "701:                    ConvBackpropComputeDimensions(",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "727:     OP_REQUIRES(",
          "728:         context, input_shape.dim_size(4) == filter_shape.dim_size(3),",
          "729:         errors::InvalidArgument(\"input and filter_sizes must have the same \"",
          "730:                                 \"number of channels. Got \",",
          "731:                                 input_shape.dim_size(4), \" for input and \",",
          "732:                                 filter_shape.dim_size(3), \" for filter_sizes\"));",
          "733:     OP_REQUIRES(",
          "734:         context, out_backprop_shape.dim_size(4) == filter_shape.dim_size(4),",
          "735:         errors::InvalidArgument(\"out_backprop and filter_sizes must have the \"",
          "736:                                 \"same number of channels. Got \",",
          "737:                                 out_backprop_shape.dim_size(4),",
          "738:                                 \" for out_backprop and \",",
          "739:                                 filter_shape.dim_size(4), \" for filter_sizes\"));",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "808:       filter_shape = context->input(1).shape();",
          "809:     }",
          "811:     ConvBackpropDimensions dims;",
          "812:     OP_REQUIRES_OK(context,",
          "813:                    ConvBackpropComputeDimensions(",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "853:     OP_REQUIRES(",
          "854:         context, input_shape.dim_size(4) == filter_shape.dim_size(3),",
          "855:         errors::InvalidArgument(\"input and filter_sizes must have the same \"",
          "856:                                 \"number of channels. Got \",",
          "857:                                 input_shape.dim_size(4), \" for input and \",",
          "858:                                 filter_shape.dim_size(3), \" for filter_sizes\"));",
          "859:     OP_REQUIRES(",
          "860:         context, out_backprop_shape.dim_size(4) == filter_shape.dim_size(4),",
          "861:         errors::InvalidArgument(\"out_backprop and filter_sizes must have the \"",
          "862:                                 \"same number of channels. Got \",",
          "863:                                 out_backprop_shape.dim_size(4),",
          "864:                                 \" for out_backprop and \",",
          "865:                                 filter_shape.dim_size(4), \" for filter_sizes\"));",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "17917cf2ebd36a30cd38f5057027c9c8601ba0d6",
      "candidate_info": {
        "commit_hash": "17917cf2ebd36a30cd38f5057027c9c8601ba0d6",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/17917cf2ebd36a30cd38f5057027c9c8601ba0d6",
        "files": [
          "tensorflow/core/kernels/conv_grad_ops_3d.cc"
        ],
        "message": "Validate some shape requirements for `Conv3DBackpropFilter*` and `Conv3DBackpropInput*` ops.\n\nOlder versions of Eigen might otherwise crash / produce OOB read on specially crafted inputs.\n\nPiperOrigin-RevId: 369293977\nChange-Id: I58f51445a93936d7cf8e616f75de17677df36718",
        "before_after_code_files": [
          "tensorflow/core/kernels/conv_grad_ops_3d.cc||tensorflow/core/kernels/conv_grad_ops_3d.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/core/kernels/conv_grad_ops_3d.cc||tensorflow/core/kernels/conv_grad_ops_3d.cc"
          ],
          "candidate": [
            "tensorflow/core/kernels/conv_grad_ops_3d.cc||tensorflow/core/kernels/conv_grad_ops_3d.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/core/kernels/conv_grad_ops_3d.cc||tensorflow/core/kernels/conv_grad_ops_3d.cc": [
          "File: tensorflow/core/kernels/conv_grad_ops_3d.cc -> tensorflow/core/kernels/conv_grad_ops_3d.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "239:       input_shape = context->input(0).shape();",
          "240:     }",
          "242:     ConvBackpropDimensions dims;",
          "243:     OP_REQUIRES_OK(context, ConvBackpropComputeDimensions(",
          "244:                                 \"Conv3DBackpropInputOp\", /*num_spatial_dims=*/3,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "242:     OP_REQUIRES(",
          "243:         context, input_shape.dim_size(4) == filter_shape.dim_size(3),",
          "244:         errors::InvalidArgument(\"input and filter_sizes must have the same \"",
          "245:                                 \"number of channels. Got \",",
          "246:                                 input_shape.dim_size(4), \" for input and \",",
          "247:                                 filter_shape.dim_size(3), \" for filter_sizes\"));",
          "248:     OP_REQUIRES(",
          "249:         context, out_backprop_shape.dim_size(4) == filter_shape.dim_size(4),",
          "250:         errors::InvalidArgument(\"out_backprop and filter_sizes must have the \"",
          "251:                                 \"same number of channels. Got \",",
          "252:                                 out_backprop_shape.dim_size(4),",
          "253:                                 \" for out_backprop and \",",
          "254:                                 filter_shape.dim_size(4), \" for filter_sizes\"));",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "346:       input_shape = context->input(0).shape();",
          "347:     }",
          "349:     ConvBackpropDimensions dims;",
          "350:     OP_REQUIRES_OK(context, ConvBackpropComputeDimensions(",
          "351:                                 \"Conv3DBackpropInputOp\", /*num_spatial_dims=*/3,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "363:     OP_REQUIRES(",
          "364:         context, input_shape.dim_size(4) == filter_shape.dim_size(3),",
          "365:         errors::InvalidArgument(\"input and filter_sizes must have the same \"",
          "366:                                 \"number of channels. Got \",",
          "367:                                 input_shape.dim_size(4), \" for input and \",",
          "368:                                 filter_shape.dim_size(3), \" for filter_sizes\"));",
          "369:     OP_REQUIRES(",
          "370:         context, out_backprop_shape.dim_size(4) == filter_shape.dim_size(4),",
          "371:         errors::InvalidArgument(\"out_backprop and filter_sizes must have the \"",
          "372:                                 \"same number of channels. Got \",",
          "373:                                 out_backprop_shape.dim_size(4),",
          "374:                                 \" for out_backprop and \",",
          "375:                                 filter_shape.dim_size(4), \" for filter_sizes\"));",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "696:       filter_shape = context->input(1).shape();",
          "697:     }",
          "699:     ConvBackpropDimensions dims;",
          "700:     OP_REQUIRES_OK(context,",
          "701:                    ConvBackpropComputeDimensions(",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "727:     OP_REQUIRES(",
          "728:         context, input_shape.dim_size(4) == filter_shape.dim_size(3),",
          "729:         errors::InvalidArgument(\"input and filter_sizes must have the same \"",
          "730:                                 \"number of channels. Got \",",
          "731:                                 input_shape.dim_size(4), \" for input and \",",
          "732:                                 filter_shape.dim_size(3), \" for filter_sizes\"));",
          "733:     OP_REQUIRES(",
          "734:         context, out_backprop_shape.dim_size(4) == filter_shape.dim_size(4),",
          "735:         errors::InvalidArgument(\"out_backprop and filter_sizes must have the \"",
          "736:                                 \"same number of channels. Got \",",
          "737:                                 out_backprop_shape.dim_size(4),",
          "738:                                 \" for out_backprop and \",",
          "739:                                 filter_shape.dim_size(4), \" for filter_sizes\"));",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "808:       filter_shape = context->input(1).shape();",
          "809:     }",
          "811:     ConvBackpropDimensions dims;",
          "812:     OP_REQUIRES_OK(context,",
          "813:                    ConvBackpropComputeDimensions(",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "853:     OP_REQUIRES(",
          "854:         context, input_shape.dim_size(4) == filter_shape.dim_size(3),",
          "855:         errors::InvalidArgument(\"input and filter_sizes must have the same \"",
          "856:                                 \"number of channels. Got \",",
          "857:                                 input_shape.dim_size(4), \" for input and \",",
          "858:                                 filter_shape.dim_size(3), \" for filter_sizes\"));",
          "859:     OP_REQUIRES(",
          "860:         context, out_backprop_shape.dim_size(4) == filter_shape.dim_size(4),",
          "861:         errors::InvalidArgument(\"out_backprop and filter_sizes must have the \"",
          "862:                                 \"same number of channels. Got \",",
          "863:                                 out_backprop_shape.dim_size(4),",
          "864:                                 \" for out_backprop and \",",
          "865:                                 filter_shape.dim_size(4), \" for filter_sizes\"));",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "fc2271991b5ecd7d310e41edf8f330ff9a192cfb",
      "candidate_info": {
        "commit_hash": "fc2271991b5ecd7d310e41edf8f330ff9a192cfb",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/fc2271991b5ecd7d310e41edf8f330ff9a192cfb",
        "files": [
          "tensorflow/core/kernels/conv_grad_ops_3d.cc"
        ],
        "message": "Validate some shape requirements for `Conv3DBackpropFilter*` and `Conv3DBackpropInput*` ops.\n\nOlder versions of Eigen might otherwise crash / produce OOB read on specially crafted inputs.\n\nPiperOrigin-RevId: 369293977\nChange-Id: I58f51445a93936d7cf8e616f75de17677df36718",
        "before_after_code_files": [
          "tensorflow/core/kernels/conv_grad_ops_3d.cc||tensorflow/core/kernels/conv_grad_ops_3d.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/core/kernels/conv_grad_ops_3d.cc||tensorflow/core/kernels/conv_grad_ops_3d.cc"
          ],
          "candidate": [
            "tensorflow/core/kernels/conv_grad_ops_3d.cc||tensorflow/core/kernels/conv_grad_ops_3d.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/core/kernels/conv_grad_ops_3d.cc||tensorflow/core/kernels/conv_grad_ops_3d.cc": [
          "File: tensorflow/core/kernels/conv_grad_ops_3d.cc -> tensorflow/core/kernels/conv_grad_ops_3d.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "239:       input_shape = context->input(0).shape();",
          "240:     }",
          "242:     ConvBackpropDimensions dims;",
          "243:     OP_REQUIRES_OK(context, ConvBackpropComputeDimensions(",
          "244:                                 \"Conv3DBackpropInputOp\", /*num_spatial_dims=*/3,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "242:     OP_REQUIRES(",
          "243:         context, input_shape.dim_size(4) == filter_shape.dim_size(3),",
          "244:         errors::InvalidArgument(\"input and filter_sizes must have the same \"",
          "245:                                 \"number of channels. Got \",",
          "246:                                 input_shape.dim_size(4), \" for input and \",",
          "247:                                 filter_shape.dim_size(3), \" for filter_sizes\"));",
          "248:     OP_REQUIRES(",
          "249:         context, out_backprop_shape.dim_size(4) == filter_shape.dim_size(4),",
          "250:         errors::InvalidArgument(\"out_backprop and filter_sizes must have the \"",
          "251:                                 \"same number of channels. Got \",",
          "252:                                 out_backprop_shape.dim_size(4),",
          "253:                                 \" for out_backprop and \",",
          "254:                                 filter_shape.dim_size(4), \" for filter_sizes\"));",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "346:       input_shape = context->input(0).shape();",
          "347:     }",
          "349:     ConvBackpropDimensions dims;",
          "350:     OP_REQUIRES_OK(context, ConvBackpropComputeDimensions(",
          "351:                                 \"Conv3DBackpropInputOp\", /*num_spatial_dims=*/3,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "363:     OP_REQUIRES(",
          "364:         context, input_shape.dim_size(4) == filter_shape.dim_size(3),",
          "365:         errors::InvalidArgument(\"input and filter_sizes must have the same \"",
          "366:                                 \"number of channels. Got \",",
          "367:                                 input_shape.dim_size(4), \" for input and \",",
          "368:                                 filter_shape.dim_size(3), \" for filter_sizes\"));",
          "369:     OP_REQUIRES(",
          "370:         context, out_backprop_shape.dim_size(4) == filter_shape.dim_size(4),",
          "371:         errors::InvalidArgument(\"out_backprop and filter_sizes must have the \"",
          "372:                                 \"same number of channels. Got \",",
          "373:                                 out_backprop_shape.dim_size(4),",
          "374:                                 \" for out_backprop and \",",
          "375:                                 filter_shape.dim_size(4), \" for filter_sizes\"));",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "696:       filter_shape = context->input(1).shape();",
          "697:     }",
          "699:     ConvBackpropDimensions dims;",
          "700:     OP_REQUIRES_OK(context,",
          "701:                    ConvBackpropComputeDimensions(",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "727:     OP_REQUIRES(",
          "728:         context, input_shape.dim_size(4) == filter_shape.dim_size(3),",
          "729:         errors::InvalidArgument(\"input and filter_sizes must have the same \"",
          "730:                                 \"number of channels. Got \",",
          "731:                                 input_shape.dim_size(4), \" for input and \",",
          "732:                                 filter_shape.dim_size(3), \" for filter_sizes\"));",
          "733:     OP_REQUIRES(",
          "734:         context, out_backprop_shape.dim_size(4) == filter_shape.dim_size(4),",
          "735:         errors::InvalidArgument(\"out_backprop and filter_sizes must have the \"",
          "736:                                 \"same number of channels. Got \",",
          "737:                                 out_backprop_shape.dim_size(4),",
          "738:                                 \" for out_backprop and \",",
          "739:                                 filter_shape.dim_size(4), \" for filter_sizes\"));",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "808:       filter_shape = context->input(1).shape();",
          "809:     }",
          "811:     ConvBackpropDimensions dims;",
          "812:     OP_REQUIRES_OK(context,",
          "813:                    ConvBackpropComputeDimensions(",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "853:     OP_REQUIRES(",
          "854:         context, input_shape.dim_size(4) == filter_shape.dim_size(3),",
          "855:         errors::InvalidArgument(\"input and filter_sizes must have the same \"",
          "856:                                 \"number of channels. Got \",",
          "857:                                 input_shape.dim_size(4), \" for input and \",",
          "858:                                 filter_shape.dim_size(3), \" for filter_sizes\"));",
          "859:     OP_REQUIRES(",
          "860:         context, out_backprop_shape.dim_size(4) == filter_shape.dim_size(4),",
          "861:         errors::InvalidArgument(\"out_backprop and filter_sizes must have the \"",
          "862:                                 \"same number of channels. Got \",",
          "863:                                 out_backprop_shape.dim_size(4),",
          "864:                                 \" for out_backprop and \",",
          "865:                                 filter_shape.dim_size(4), \" for filter_sizes\"));",
          "",
          "---------------"
        ]
      }
    }
  ]
}