{
  "cve_id": "CVE-2017-3735",
  "cve_desc": "While parsing an IPAddressFamily extension in an X.509 certificate, it is possible to do a one-byte overread. This would result in an incorrect text display of the certificate. This bug has been present since 2006 and is present in all versions of OpenSSL before 1.0.2m and 1.1.0g.",
  "repo": "openssl/openssl",
  "patch_hash": "068b963bb7afc57f5bdd723de0dd15e7795d5822",
  "patch_info": {
    "commit_hash": "068b963bb7afc57f5bdd723de0dd15e7795d5822",
    "repo": "openssl/openssl",
    "commit_url": "https://github.com/openssl/openssl/commit/068b963bb7afc57f5bdd723de0dd15e7795d5822",
    "files": [
      "crypto/x509v3/v3_addr.c"
    ],
    "message": "Avoid out-of-bounds read\n\nFixes CVE 2017-3735\n\nReviewed-by: Kurt Roeckx <kurt@roeckx.be>\n(Merged from https://github.com/openssl/openssl/pull/4276)\n\n(cherry picked from commit b23171744b01e473ebbfd6edad70c1c3825ffbcd)",
    "before_after_code_files": [
      "crypto/x509v3/v3_addr.c||crypto/x509v3/v3_addr.c"
    ]
  },
  "patch_diff": {
    "crypto/x509v3/v3_addr.c||crypto/x509v3/v3_addr.c": [
      "File: crypto/x509v3/v3_addr.c -> crypto/x509v3/v3_addr.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "85: unsigned int X509v3_addr_get_afi(const IPAddressFamily *f)",
      "86: {",
      "91: }",
      "",
      "[Removed Lines]",
      "87:     return ((f != NULL &&",
      "88:              f->addressFamily != NULL && f->addressFamily->data != NULL)",
      "89:             ? ((f->addressFamily->data[0] << 8) | (f->addressFamily->data[1]))",
      "90:             : 0);",
      "",
      "[Added Lines]",
      "87:     if (f == NULL",
      "88:             || f->addressFamily == NULL",
      "89:             || f->addressFamily->data == NULL",
      "90:             || f->addressFamily->length < 2)",
      "91:         return 0;",
      "92:     return (f->addressFamily->data[0] << 8) | f->addressFamily->data[1];",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "2984afdad9696e4de4762ebc0039f9353773f66c",
      "candidate_info": {
        "commit_hash": "2984afdad9696e4de4762ebc0039f9353773f66c",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/2984afdad9696e4de4762ebc0039f9353773f66c",
        "files": [
          "crypto/whrlpool/wp_dgst.c"
        ],
        "message": "Fix a read off the end of the input buffer\n\nwhen building with OPENSSL_SMALL_FOOTPRINT defined.\n\nReviewed-by: Tim Hudson <tjh@openssl.org>\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/3533)\n\n(cherry picked from commit 0b20ad127ce86b05a854f31d51d91312c86ccc74)",
        "before_after_code_files": [
          "crypto/whrlpool/wp_dgst.c||crypto/whrlpool/wp_dgst.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "crypto/whrlpool/wp_dgst.c||crypto/whrlpool/wp_dgst.c": [
          "File: crypto/whrlpool/wp_dgst.c -> crypto/whrlpool/wp_dgst.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "174:                 goto reconsider;",
          "175:             } else",
          "176: #endif",
          "178:                 b = ((inp[0] << inpgap) | (inp[1] >> (8 - inpgap)));",
          "179:                 b &= 0xff;",
          "180:                 if (bitrem)",
          "",
          "[Removed Lines]",
          "177:             if (bits >= 8) {",
          "",
          "[Added Lines]",
          "177:             if (bits > 8) {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "f444552d7df09e40f5cdef144c8758f17e1cb48e",
      "candidate_info": {
        "commit_hash": "f444552d7df09e40f5cdef144c8758f17e1cb48e",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/f444552d7df09e40f5cdef144c8758f17e1cb48e",
        "files": [
          "crypto/ec/curve25519.c"
        ],
        "message": "Clear secret stack values after use in curve25519.c\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/4242)\n\n(cherry picked from commit 78f1e4d0b063e17c9700f2aceecaca03bfa434f3)",
        "before_after_code_files": [
          "crypto/ec/curve25519.c||crypto/ec/curve25519.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "crypto/ec/curve25519.c||crypto/ec/curve25519.c": [
          "File: crypto/ec/curve25519.c -> crypto/ec/curve25519.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "3226:     ge_madd(&r, h, &t);",
          "3227:     ge_p1p1_to_p3(h, &r);",
          "3228:   }",
          "3229: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3230:   OPENSSL_cleanse(e, sizeof(e));",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "3356:   fe_invert(z2, z2);",
          "3357:   fe_mul(x2, x2, z2);",
          "3358:   fe_tobytes(out, x2);",
          "3359: }",
          "3361: static void x25519_scalar_mult(uint8_t out[32], const uint8_t scalar[32],",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3362:   OPENSSL_cleanse(e, sizeof(e));",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "3391:   fe_invert(zminusy_inv, zminusy);",
          "3392:   fe_mul(zplusy, zplusy, zminusy_inv);",
          "3393:   fe_tobytes(out_public_value, zplusy);",
          "3394: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3399:   OPENSSL_cleanse(e, sizeof(e));",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "5c6317e86d5f44291bb2b028607b8bad858b4f74",
      "candidate_info": {
        "commit_hash": "5c6317e86d5f44291bb2b028607b8bad858b4f74",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/5c6317e86d5f44291bb2b028607b8bad858b4f74",
        "files": [
          "crypto/evp/e_aes_cbc_hmac_sha256.c"
        ],
        "message": "evp/e_aes_cbc_hmac_sha256.c: give SHAEXT right priority.\n\nReviewed-by: Kurt Roeckx <kurt@roeckx.be>\n(Merged from https://github.com/openssl/openssl/pull/3898)\n\n(cherry picked from commit d0f6eb1d8c84165c383a677266cfae9c0b162781)",
        "before_after_code_files": [
          "crypto/evp/e_aes_cbc_hmac_sha256.c||crypto/evp/e_aes_cbc_hmac_sha256.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "crypto/evp/e_aes_cbc_hmac_sha256.c||crypto/evp/e_aes_cbc_hmac_sha256.c": [
          "File: crypto/evp/e_aes_cbc_hmac_sha256.c -> crypto/evp/e_aes_cbc_hmac_sha256.c"
        ]
      }
    },
    {
      "candidate_hash": "568a5210e0fde8b5cb6a70296276d4b4c3c7dd9b",
      "candidate_info": {
        "commit_hash": "568a5210e0fde8b5cb6a70296276d4b4c3c7dd9b",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/568a5210e0fde8b5cb6a70296276d4b4c3c7dd9b",
        "files": [
          "apps/apps.c",
          "crypto/asn1/a_digest.c",
          "crypto/asn1/a_sign.c",
          "crypto/asn1/a_verify.c",
          "crypto/rand/randfile.c",
          "crypto/x509/by_dir.c",
          "e_os.h",
          "include/openssl/buffer.h",
          "include/openssl/seed.h",
          "ssl/ssl_cert.c"
        ],
        "message": "NO_SYS_TYPES_H isn't defined anywhere, stop using it as a guard\n\nThis is a vestige from pre-1.1.0 OpenSSL\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/4256)\n\n(cherry picked from commit b379fe6cd046b9dd8a62309dcbaded763e2d4187)",
        "before_after_code_files": [
          "apps/apps.c||apps/apps.c",
          "crypto/asn1/a_digest.c||crypto/asn1/a_digest.c",
          "crypto/asn1/a_sign.c||crypto/asn1/a_sign.c",
          "crypto/asn1/a_verify.c||crypto/asn1/a_verify.c",
          "crypto/rand/randfile.c||crypto/rand/randfile.c",
          "crypto/x509/by_dir.c||crypto/x509/by_dir.c",
          "e_os.h||e_os.h",
          "include/openssl/buffer.h||include/openssl/buffer.h",
          "include/openssl/seed.h||include/openssl/seed.h",
          "ssl/ssl_cert.c||ssl/ssl_cert.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "apps/apps.c||apps/apps.c": [
          "File: apps/apps.c -> apps/apps.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "18: #include <stdio.h>",
          "19: #include <stdlib.h>",
          "20: #include <string.h>",
          "24: #ifndef OPENSSL_NO_POSIX_IO",
          "25: # include <sys/stat.h>",
          "26: # include <fcntl.h>",
          "",
          "[Removed Lines]",
          "21: #ifndef NO_SYS_TYPES_H",
          "22: # include <sys/types.h>",
          "23: #endif",
          "",
          "[Added Lines]",
          "21: #include <sys/types.h>",
          "",
          "---------------"
        ],
        "crypto/asn1/a_digest.c||crypto/asn1/a_digest.c": [
          "File: crypto/asn1/a_digest.c -> crypto/asn1/a_digest.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "10: #include <stdio.h>",
          "11: #include <time.h>",
          "13: #include \"internal/cryptlib.h\"",
          "19: #include <openssl/err.h>",
          "20: #include <openssl/evp.h>",
          "21: #include <openssl/buffer.h>",
          "",
          "[Removed Lines]",
          "15: #ifndef NO_SYS_TYPES_H",
          "16: # include <sys/types.h>",
          "17: #endif",
          "",
          "[Added Lines]",
          "12: #include <sys/types.h>",
          "",
          "---------------"
        ],
        "crypto/asn1/a_sign.c||crypto/asn1/a_sign.c": [
          "File: crypto/asn1/a_sign.c -> crypto/asn1/a_sign.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "10: #include <stdio.h>",
          "11: #include <time.h>",
          "13: #include \"internal/cryptlib.h\"",
          "19: #include <openssl/bn.h>",
          "20: #include <openssl/evp.h>",
          "21: #include <openssl/x509.h>",
          "",
          "[Removed Lines]",
          "15: #ifndef NO_SYS_TYPES_H",
          "16: # include <sys/types.h>",
          "17: #endif",
          "",
          "[Added Lines]",
          "12: #include <sys/types.h>",
          "",
          "---------------"
        ],
        "crypto/asn1/a_verify.c||crypto/asn1/a_verify.c": [
          "File: crypto/asn1/a_verify.c -> crypto/asn1/a_verify.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "10: #include <stdio.h>",
          "11: #include <time.h>",
          "13: #include \"internal/cryptlib.h\"",
          "19: #include <openssl/bn.h>",
          "20: #include <openssl/x509.h>",
          "21: #include <openssl/objects.h>",
          "",
          "[Removed Lines]",
          "15: #ifndef NO_SYS_TYPES_H",
          "16: # include <sys/types.h>",
          "17: #endif",
          "",
          "[Added Lines]",
          "12: #include <sys/types.h>",
          "",
          "---------------"
        ],
        "crypto/rand/randfile.c||crypto/rand/randfile.c": [
          "File: crypto/rand/randfile.c -> crypto/rand/randfile.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "21: #ifdef OPENSSL_SYS_VMS",
          "22: # include <unixio.h>",
          "23: #endif",
          "27: #ifndef OPENSSL_NO_POSIX_IO",
          "28: # include <sys/stat.h>",
          "29: # include <fcntl.h>",
          "",
          "[Removed Lines]",
          "24: #ifndef NO_SYS_TYPES_H",
          "25: # include <sys/types.h>",
          "26: #endif",
          "",
          "[Added Lines]",
          "24: #include <sys/types.h>",
          "",
          "---------------"
        ],
        "crypto/x509/by_dir.c||crypto/x509/by_dir.c": [
          "File: crypto/x509/by_dir.c -> crypto/x509/by_dir.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "10: #include <stdio.h>",
          "11: #include <time.h>",
          "12: #include <errno.h>",
          "14: #include \"internal/cryptlib.h\"",
          "19: #ifndef OPENSSL_NO_POSIX_IO",
          "20: # include <sys/stat.h>",
          "21: #endif",
          "",
          "[Removed Lines]",
          "16: #ifndef NO_SYS_TYPES_H",
          "17: # include <sys/types.h>",
          "18: #endif",
          "",
          "[Added Lines]",
          "13: #include <sys/types.h>",
          "",
          "---------------"
        ],
        "e_os.h||e_os.h": [
          "File: e_os.h -> e_os.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "344: #   else",
          "345: #    include <unistd.h>",
          "346: #   endif",
          "350: #   ifdef OPENSSL_SYS_WIN32_CYGWIN",
          "351: #    include <io.h>",
          "352: #    include <fcntl.h>",
          "",
          "[Removed Lines]",
          "347: #   ifndef NO_SYS_TYPES_H",
          "348: #    include <sys/types.h>",
          "349: #   endif",
          "",
          "[Added Lines]",
          "347: #   include <sys/types.h>",
          "",
          "---------------"
        ],
        "include/openssl/buffer.h||include/openssl/buffer.h": [
          "File: include/openssl/buffer.h -> include/openssl/buffer.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "21: #endif",
          "23: # include <stddef.h>",
          "",
          "[Removed Lines]",
          "25: # if !defined(NO_SYS_TYPES_H)",
          "26: #  include <sys/types.h>",
          "27: # endif",
          "",
          "[Added Lines]",
          "24: # include <sys/types.h>",
          "",
          "---------------"
        ],
        "include/openssl/seed.h||include/openssl/seed.h": [
          "File: include/openssl/seed.h -> include/openssl/seed.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "52: #  endif",
          "53: # endif",
          "59: # define SEED_BLOCK_SIZE 16",
          "60: # define SEED_KEY_LENGTH 16",
          "",
          "[Removed Lines]",
          "55: # if !defined(NO_SYS_TYPES_H)",
          "56: #  include <sys/types.h>",
          "57: # endif",
          "",
          "[Added Lines]",
          "55: # include <sys/types.h>",
          "",
          "---------------"
        ],
        "ssl/ssl_cert.c||ssl/ssl_cert.c": [
          "File: ssl/ssl_cert.c -> ssl/ssl_cert.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "16: #include <stdio.h>",
          "18: #include \"e_os.h\"",
          "23: #include \"internal/o_dir.h\"",
          "24: #include <openssl/lhash.h>",
          "25: #include <openssl/bio.h>",
          "",
          "[Removed Lines]",
          "19: #ifndef NO_SYS_TYPES_H",
          "20: # include <sys/types.h>",
          "21: #endif",
          "",
          "[Added Lines]",
          "17: #include <sys/types.h>",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "fac8e70de383861315b1fd1ee64193c794f1d9ca",
      "candidate_info": {
        "commit_hash": "fac8e70de383861315b1fd1ee64193c794f1d9ca",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/fac8e70de383861315b1fd1ee64193c794f1d9ca",
        "files": [
          "crypto/evp/evp_key.c",
          "crypto/ui/ui_lib.c"
        ],
        "message": "Fix small UI issues\n\n- in EVP_read_pw_string_min(), the return value from UI_add_* wasn't\n  properly checked\n- in UI_process(), |state| was never made NULL, which means an error\n  when closing the session wouldn't be accurately reported.\n\nReviewed-by: Paul Dale <paul.dale@oracle.com>\n(Merged from https://github.com/openssl/openssl/pull/3849)\n\n(cherry picked from commit b96dba9e5ec7afc355be1eab915f69c8c0d51741)",
        "before_after_code_files": [
          "crypto/evp/evp_key.c||crypto/evp/evp_key.c",
          "crypto/ui/ui_lib.c||crypto/ui/ui_lib.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "crypto/evp/evp_key.c||crypto/evp/evp_key.c": [
          "File: crypto/evp/evp_key.c -> crypto/evp/evp_key.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "49: int EVP_read_pw_string_min(char *buf, int min, int len, const char *prompt,",
          "50:                            int verify)",
          "51: {",
          "53:     char buff[BUFSIZ];",
          "54:     UI *ui;",
          "",
          "[Removed Lines]",
          "52:     int ret;",
          "",
          "[Added Lines]",
          "52:     int ret = -1;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "57:         prompt = prompt_string;",
          "58:     ui = UI_new();",
          "59:     if (ui == NULL)",
          "67:     ret = UI_process(ui);",
          "69:     OPENSSL_cleanse(buff, BUFSIZ);",
          "70:     return ret;",
          "71: }",
          "",
          "[Removed Lines]",
          "60:         return -1;",
          "61:     UI_add_input_string(ui, prompt, 0, buf, min,",
          "62:                         (len >= BUFSIZ) ? BUFSIZ - 1 : len);",
          "63:     if (verify)",
          "64:         UI_add_verify_string(ui, prompt, 0,",
          "65:                              buff, min, (len >= BUFSIZ) ? BUFSIZ - 1 : len,",
          "66:                              buf);",
          "68:     UI_free(ui);",
          "",
          "[Added Lines]",
          "60:         return ret;",
          "61:     if (UI_add_input_string(ui, prompt, 0, buf, min,",
          "62:                             (len >= BUFSIZ) ? BUFSIZ - 1 : len) < 0",
          "63:         || (verify",
          "64:             && UI_add_verify_string(ui, prompt, 0, buff, min,",
          "65:                                     (len >= BUFSIZ) ? BUFSIZ - 1 : len,",
          "66:                                     buf) < 0))",
          "67:         goto end;",
          "70:  end:",
          "71:     UI_free(ui);",
          "",
          "---------------"
        ],
        "crypto/ui/ui_lib.c||crypto/ui/ui_lib.c": [
          "File: crypto/ui/ui_lib.c -> crypto/ui/ui_lib.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "479:             }",
          "480:         }",
          "481:     }",
          "482:  err:",
          "483:     if (ui->meth->ui_close_session != NULL",
          "484:         && ui->meth->ui_close_session(ui) <= 0) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "483:     state = NULL;",
          "",
          "---------------"
        ]
      }
    }
  ]
}