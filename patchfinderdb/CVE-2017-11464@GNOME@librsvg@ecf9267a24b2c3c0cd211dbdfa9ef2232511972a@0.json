{
  "cve_id": "CVE-2017-11464",
  "cve_desc": "A SIGFPE is raised in the function box_blur_line of rsvg-filter.c in GNOME librsvg 2.40.17 during an attempted parse of a crafted SVG file, because of incorrect protection against division by zero.",
  "repo": "GNOME/librsvg",
  "patch_hash": "ecf9267a24b2c3c0cd211dbdfa9ef2232511972a",
  "patch_info": {
    "commit_hash": "ecf9267a24b2c3c0cd211dbdfa9ef2232511972a",
    "repo": "GNOME/librsvg",
    "commit_url": "https://github.com/GNOME/librsvg/commit/ecf9267a24b2c3c0cd211dbdfa9ef2232511972a",
    "files": [
      "rsvg-filter.c"
    ],
    "message": "bgo#783835 - Don't divide by zero in box_blur_line() for gaussian blurs\n\nWe were making the decision to use box blurs, instead of a true\nGaussian kernel, based on the size of *both* x and y dimensions.  Do\nthem individually instead.",
    "before_after_code_files": [
      "rsvg-filter.c||rsvg-filter.c"
    ]
  },
  "patch_diff": {
    "rsvg-filter.c||rsvg-filter.c": [
      "File: rsvg-filter.c -> rsvg-filter.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1420:     ac = g_new0 (gint, bpp);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1420:     g_assert (box_width > 0);",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "1774:                        gdouble sx,",
      "1775:                        gdouble sy)",
      "1776: {",
      "1778:     gint width, height;",
      "1779:     cairo_format_t in_format, out_format;",
      "1780:     gint in_stride;",
      "",
      "[Removed Lines]",
      "1777:     gboolean use_box_blur;",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "1818:     if (sy < 0.0)",
      "1819:         sy = 0.0;",
      "1830:     if ((sx == 0.0 && sy == 0.0)",
      "1831:         || sx > 1000 || sy > 1000) {",
      "",
      "[Removed Lines]",
      "1824:     if (sx < 10.0 && sy < 10.0)",
      "1825:         use_box_blur = FALSE;",
      "1826:     else",
      "1827:         use_box_blur = TRUE;",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "1845:         int y;",
      "1846:         guchar *row_buffer = NULL;",
      "1847:         guchar *row1, *row2;",
      "1849:         if (use_box_blur) {",
      "1850:             box_width = compute_box_blur_width (sx);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1841:         gboolean use_box_blur;",
      "1846:         if (sx < 10.0)",
      "1847:             use_box_blur = FALSE;",
      "1848:         else",
      "1849:             use_box_blur = TRUE;",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "1900:         guchar *col_buffer;",
      "1901:         guchar *col1, *col2;",
      "1902:         int x;",
      "1905:         col_buffer = g_new0 (guchar, height * bpp * 2);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1905:         gboolean use_box_blur;",
      "1910:         if (sy < 10.0)",
      "1911:             use_box_blur = FALSE;",
      "1912:         else",
      "1913:             use_box_blur = TRUE;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "735bd813d7657f24dba222fa6e5be8f66491ef77",
      "candidate_info": {
        "commit_hash": "735bd813d7657f24dba222fa6e5be8f66491ef77",
        "repo": "GNOME/librsvg",
        "commit_url": "https://github.com/GNOME/librsvg/commit/735bd813d7657f24dba222fa6e5be8f66491ef77",
        "files": [
          "rsvg-filter.c"
        ],
        "message": "bgo#783835 - Don't divide by zero in box_blur_line() for gaussian blurs\n\nWe were making the decision to use box blurs, instead of a true\nGaussian kernel, based on the size of *both* x and y dimensions.  Do\nthem individually instead.",
        "before_after_code_files": [
          "rsvg-filter.c||rsvg-filter.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "rsvg-filter.c||rsvg-filter.c"
          ],
          "candidate": [
            "rsvg-filter.c||rsvg-filter.c"
          ]
        }
      },
      "candidate_diff": {
        "rsvg-filter.c||rsvg-filter.c": [
          "File: rsvg-filter.c -> rsvg-filter.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1334:     ac = g_new (gint, bpp);",
          "",
          "[Added Lines]",
          "1334:     g_assert (box_width > 0);",
          "1336:     ac = g_new0 (gint, bpp);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1688:                        gdouble sx,",
          "1689:                        gdouble sy)",
          "1690: {",
          "1692:     gint width, height;",
          "1693:     cairo_format_t in_format, out_format;",
          "1694:     gint in_stride;",
          "",
          "[Removed Lines]",
          "1691:     gboolean use_box_blur;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1732:     if (sy < 0.0)",
          "1733:         sy = 0.0;",
          "1744:     if ((sx == 0.0 && sy == 0.0)",
          "1745:         || sx > 1000 || sy > 1000) {",
          "",
          "[Removed Lines]",
          "1738:     if (sx < 10.0 && sy < 10.0)",
          "1739:         use_box_blur = FALSE;",
          "1740:     else",
          "1741:         use_box_blur = TRUE;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1759:         int y;",
          "1760:         guchar *row_buffer = NULL;",
          "1761:         guchar *row1, *row2;",
          "1763:         if (use_box_blur) {",
          "1764:             box_width = compute_box_blur_width (sx);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1755:         gboolean use_box_blur;",
          "1760:         if (sx < 10.0)",
          "1761:             use_box_blur = FALSE;",
          "1762:         else",
          "1763:             use_box_blur = TRUE;",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1814:         guchar *col_buffer;",
          "1815:         guchar *col1, *col2;",
          "1816:         int x;",
          "1819:         col_buffer = g_new (guchar, height * bpp * 2);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1819:         gboolean use_box_blur;",
          "1824:         if (sy < 10.0)",
          "1825:             use_box_blur = FALSE;",
          "1826:         else",
          "1827:             use_box_blur = TRUE;",
          "",
          "---------------"
        ]
      }
    }
  ]
}