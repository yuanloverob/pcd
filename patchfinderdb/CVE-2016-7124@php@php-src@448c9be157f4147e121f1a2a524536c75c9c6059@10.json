{
  "cve_id": "CVE-2016-7124",
  "cve_desc": "ext/standard/var_unserializer.c in PHP before 5.6.25 and 7.x before 7.0.10 mishandles certain invalid objects, which allows remote attackers to cause a denial of service or possibly have unspecified other impact via crafted serialized data that leads to a (1) __destruct call or (2) magic method call.",
  "repo": "php/php-src",
  "patch_hash": "448c9be157f4147e121f1a2a524536c75c9c6059",
  "patch_info": {
    "commit_hash": "448c9be157f4147e121f1a2a524536c75c9c6059",
    "repo": "php/php-src",
    "commit_url": "https://github.com/php/php-src/commit/448c9be157f4147e121f1a2a524536c75c9c6059",
    "files": [
      "ext/standard/tests/strings/bug72663.phpt",
      "ext/standard/tests/strings/bug72663_2.phpt",
      "ext/standard/var_unserializer.c",
      "ext/standard/var_unserializer.re"
    ],
    "message": "Fix bug #72663 - destroy broken object when unserializing",
    "before_after_code_files": [
      "ext/standard/tests/strings/bug72663.phpt||ext/standard/tests/strings/bug72663.phpt",
      "ext/standard/tests/strings/bug72663_2.phpt||ext/standard/tests/strings/bug72663_2.phpt",
      "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
      "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
    ]
  },
  "patch_diff": {
    "ext/standard/tests/strings/bug72663.phpt||ext/standard/tests/strings/bug72663.phpt": [
      "File: ext/standard/tests/strings/bug72663.phpt -> ext/standard/tests/strings/bug72663.phpt",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: --TEST--",
      "2: Bug #72663: Create an Unexpected Object and Don't Invoke __wakeup() in Deserialization",
      "3: --FILE--",
      "4: <?php",
      "5: class obj implements Serializable {",
      "6:     var $data;",
      "7:     function serialize() {",
      "8:         return serialize($this->data);",
      "9:     }",
      "10:     function unserialize($data) {",
      "11:         $this->data = unserialize($data);",
      "12:     }",
      "13: }",
      "15: $inner = 'a:1:{i:0;O:9:\"Exception\":2:{s:7:\"'.\"\\0\".'*'.\"\\0\".'file\";R:4;}';",
      "16: $exploit = 'a:2:{i:0;C:3:\"obj\":'.strlen($inner).':{'.$inner.'}i:1;R:4;}';",
      "18: $data = unserialize($exploit);",
      "19: echo $data[1];",
      "20: ?>",
      "21: DONE",
      "22: --EXPECTF--",
      "23: Notice: unserialize(): Unexpected end of serialized data in %sbug72663.php on line %d",
      "25: Notice: unserialize(): Error at offset 46 of 47 bytes in %sbug72663.php on line %d",
      "26: DONE",
      "",
      "---------------"
    ],
    "ext/standard/tests/strings/bug72663_2.phpt||ext/standard/tests/strings/bug72663_2.phpt": [
      "File: ext/standard/tests/strings/bug72663_2.phpt -> ext/standard/tests/strings/bug72663_2.phpt",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: --TEST--",
      "2: Bug #72663: Create an Unexpected Object and Don't Invoke __wakeup() in Deserialization",
      "3: --FILE--",
      "4: <?php",
      "6: ini_set('session.serialize_handler', 'php_serialize');",
      "7: session_start();",
      "8: $sess = 'O:9:\"Exception\":2:{s:7:\"'.\"\\0\".'*'.\"\\0\".'file\";R:1;}';",
      "9: session_decode($sess);",
      "10: var_dump($_SESSION);",
      "11: ?>",
      "12: DONE",
      "13: --EXPECTF--",
      "14: Notice: session_decode(): Unexpected end of serialized data in %sbug72663_2.php on line %d",
      "15: array(0) {",
      "16: }",
      "17: DONE",
      "",
      "---------------"
    ],
    "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
      "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "434:  }",
      "436:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_OBJPROP_PP(rval), elements, 1)) {",
      "437:   return 0;",
      "438:  }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "438:      zend_hash_clean(Z_OBJPROP_PP(rval));",
      "439:      ZVAL_NULL(*rval);",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "486: {",
      "487:  YYCTYPE yych;",
      "488:  static const unsigned char yybm[] = {",
      "",
      "[Removed Lines]",
      "485: #line 486 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "488: #line 489 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "542:  yych = *(YYMARKER = ++YYCURSOR);",
      "543:  if (yych == ':') goto yy95;",
      "544: yy3:",
      "546:  { return 0; }",
      "548: yy4:",
      "549:  yych = *(YYMARKER = ++YYCURSOR);",
      "550:  if (yych == ':') goto yy89;",
      "",
      "[Removed Lines]",
      "545: #line 851 \"ext/standard/var_unserializer.re\"",
      "547: #line 548 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "548: #line 854 \"ext/standard/var_unserializer.re\"",
      "550: #line 551 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "587:  goto yy3;",
      "588: yy14:",
      "589:  ++YYCURSOR;",
      "591:  {",
      "593:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
      "595: }",
      "597: yy16:",
      "598:  yych = *++YYCURSOR;",
      "599:  goto yy3;",
      "",
      "[Removed Lines]",
      "590: #line 845 \"ext/standard/var_unserializer.re\"",
      "596: #line 597 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "593: #line 848 \"ext/standard/var_unserializer.re\"",
      "599: #line 600 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "619:  if (yybm[0+yych] & 128) {",
      "620:   goto yy20;",
      "621:  }",
      "623:  yych = *++YYCURSOR;",
      "624:  if (yych != '\"') goto yy18;",
      "625:  ++YYCURSOR;",
      "627:  {",
      "628:  size_t len, len2, len3, maxlen;",
      "629:  long elements;",
      "",
      "[Removed Lines]",
      "622:  if (yych != ':') goto yy18;",
      "626: #line 698 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "625:  if (yych <= '/') goto yy18;",
      "626:  if (yych >= ';') goto yy18;",
      "630: #line 701 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "771:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
      "772: }",
      "774: yy25:",
      "775:  yych = *++YYCURSOR;",
      "776:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "773: #line 774 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "777: #line 778 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "795:  yych = *++YYCURSOR;",
      "796:  if (yych != '\"') goto yy18;",
      "797:  ++YYCURSOR;",
      "799:  {",
      "800:     if (!var_hash) return 0;",
      "",
      "[Removed Lines]",
      "798: #line 689 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "802: #line 692 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 8 ---",
      "[Context before]",
      "804:  return object_common2(UNSERIALIZE_PASSTHRU,",
      "805:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
      "806: }",
      "808: yy32:",
      "809:  yych = *++YYCURSOR;",
      "810:  if (yych == '+') goto yy33;",
      "",
      "[Removed Lines]",
      "807: #line 808 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "811: #line 812 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 9 ---",
      "[Context before]",
      "825:  yych = *++YYCURSOR;",
      "826:  if (yych != '{') goto yy18;",
      "827:  ++YYCURSOR;",
      "829:  {",
      "830:  long elements = parse_iv(start + 2);",
      "",
      "[Removed Lines]",
      "828: #line 668 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "832: #line 671 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 10 ---",
      "[Context before]",
      "847:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
      "848: }",
      "850: yy39:",
      "851:  yych = *++YYCURSOR;",
      "852:  if (yych == '+') goto yy40;",
      "",
      "[Removed Lines]",
      "849: #line 850 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "853: #line 854 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 11 ---",
      "[Context before]",
      "867:  yych = *++YYCURSOR;",
      "868:  if (yych != '\"') goto yy18;",
      "869:  ++YYCURSOR;",
      "871:  {",
      "872:  size_t len, maxlen;",
      "873:  char *str;",
      "",
      "[Removed Lines]",
      "870: #line 633 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "874: #line 636 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 12 ---",
      "[Context before]",
      "902:  ZVAL_STRINGL(*rval, str, len, 0);",
      "903:  return 1;",
      "904: }",
      "906: yy46:",
      "907:  yych = *++YYCURSOR;",
      "908:  if (yych == '+') goto yy47;",
      "",
      "[Removed Lines]",
      "905: #line 906 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "909: #line 910 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 13 ---",
      "[Context before]",
      "923:  yych = *++YYCURSOR;",
      "924:  if (yych != '\"') goto yy18;",
      "925:  ++YYCURSOR;",
      "927:  {",
      "928:  size_t len, maxlen;",
      "929:  char *str;",
      "",
      "[Removed Lines]",
      "926: #line 600 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "930: #line 603 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 14 ---",
      "[Context before]",
      "956:  ZVAL_STRINGL(*rval, str, len, 1);",
      "957:  return 1;",
      "958: }",
      "960: yy53:",
      "961:  yych = *++YYCURSOR;",
      "962:  if (yych <= '/') {",
      "",
      "[Removed Lines]",
      "959: #line 960 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "963: #line 964 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 15 ---",
      "[Context before]",
      "1044:  }",
      "1045: yy63:",
      "1046:  ++YYCURSOR;",
      "1048:  {",
      "1049: #if SIZEOF_LONG == 4",
      "1050: use_double:",
      "",
      "[Removed Lines]",
      "1047: #line 590 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1051: #line 593 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 16 ---",
      "[Context before]",
      "1054:  ZVAL_DOUBLE(*rval, zend_strtod((const char *)start + 2, NULL));",
      "1055:  return 1;",
      "1056: }",
      "1058: yy65:",
      "1059:  yych = *++YYCURSOR;",
      "1060:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1057: #line 1058 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1061: #line 1062 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 17 ---",
      "[Context before]",
      "1113:  yych = *++YYCURSOR;",
      "1114:  if (yych != ';') goto yy18;",
      "1115:  ++YYCURSOR;",
      "1117:  {",
      "1119:  INIT_PZVAL(*rval);",
      "",
      "[Removed Lines]",
      "1116: #line 575 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1120: #line 578 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 18 ---",
      "[Context before]",
      "1129:  return 1;",
      "1130: }",
      "1132: yy76:",
      "1133:  yych = *++YYCURSOR;",
      "1134:  if (yych == 'N') goto yy73;",
      "",
      "[Removed Lines]",
      "1131: #line 1132 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1135: #line 1136 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 19 ---",
      "[Context before]",
      "1155:  if (yych <= '9') goto yy79;",
      "1156:  if (yych != ';') goto yy18;",
      "1157:  ++YYCURSOR;",
      "1159:  {",
      "1160: #if SIZEOF_LONG == 4",
      "1161:  int digits = YYCURSOR - start - 3;",
      "",
      "[Removed Lines]",
      "1158: #line 548 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1162: #line 551 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 20 ---",
      "[Context before]",
      "1182:  ZVAL_LONG(*rval, parse_iv(start + 2));",
      "1183:  return 1;",
      "1184: }",
      "1186: yy83:",
      "1187:  yych = *++YYCURSOR;",
      "1188:  if (yych <= '/') goto yy18;",
      "",
      "[Removed Lines]",
      "1185: #line 1186 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1189: #line 1190 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 21 ---",
      "[Context before]",
      "1190:  yych = *++YYCURSOR;",
      "1191:  if (yych != ';') goto yy18;",
      "1192:  ++YYCURSOR;",
      "1194:  {",
      "1196:  INIT_PZVAL(*rval);",
      "1197:  ZVAL_BOOL(*rval, parse_iv(start + 2));",
      "1198:  return 1;",
      "1199: }",
      "1201: yy87:",
      "1202:  ++YYCURSOR;",
      "1204:  {",
      "1206:  INIT_PZVAL(*rval);",
      "1207:  ZVAL_NULL(*rval);",
      "1208:  return 1;",
      "1209: }",
      "1211: yy89:",
      "1212:  yych = *++YYCURSOR;",
      "1213:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1193: #line 541 \"ext/standard/var_unserializer.re\"",
      "1200: #line 1201 \"ext/standard/var_unserializer.c\"",
      "1203: #line 534 \"ext/standard/var_unserializer.re\"",
      "1210: #line 1211 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1197: #line 544 \"ext/standard/var_unserializer.re\"",
      "1204: #line 1205 \"ext/standard/var_unserializer.c\"",
      "1207: #line 537 \"ext/standard/var_unserializer.re\"",
      "1214: #line 1215 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 22 ---",
      "[Context before]",
      "1230:  if (yych <= '9') goto yy91;",
      "1231:  if (yych != ';') goto yy18;",
      "1232:  ++YYCURSOR;",
      "1234:  {",
      "1235:  long id;",
      "",
      "[Removed Lines]",
      "1233: #line 511 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1237: #line 514 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 23 ---",
      "[Context before]",
      "1254:  return 1;",
      "1255: }",
      "1257: yy95:",
      "1258:  yych = *++YYCURSOR;",
      "1259:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1256: #line 1257 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1260: #line 1261 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 24 ---",
      "[Context before]",
      "1276:  if (yych <= '9') goto yy97;",
      "1277:  if (yych != ';') goto yy18;",
      "1278:  ++YYCURSOR;",
      "1280:  {",
      "1281:  long id;",
      "",
      "[Removed Lines]",
      "1279: #line 490 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1283: #line 493 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 25 ---",
      "[Context before]",
      "1298:  return 1;",
      "1299: }",
      "1301: }",
      "1305:  return 0;",
      "",
      "[Removed Lines]",
      "1300: #line 1301 \"ext/standard/var_unserializer.c\"",
      "1302: #line 853 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1304: #line 1305 \"ext/standard/var_unserializer.c\"",
      "1306: #line 856 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------"
    ],
    "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
      "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
      "--- Hunk 1 ---",
      "[Context before]",
      "438:  }",
      "440:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_OBJPROP_PP(rval), elements, 1)) {",
      "441:   return 0;",
      "442:  }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "442:      zend_hash_clean(Z_OBJPROP_PP(rval));",
      "443:      ZVAL_NULL(*rval);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "ba8f3ba05f8545a243881547dcd5a1dcfe4d4fb2",
      "candidate_info": {
        "commit_hash": "ba8f3ba05f8545a243881547dcd5a1dcfe4d4fb2",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/ba8f3ba05f8545a243881547dcd5a1dcfe4d4fb2",
        "files": [
          "Zend/zend_objects_API.c",
          "ext/standard/tests/serialize/bug73052.phpt",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Fix bug #73052 - Memory Corruption in During Deserialized-object Destruction",
        "before_after_code_files": [
          "Zend/zend_objects_API.c||Zend/zend_objects_API.c",
          "ext/standard/tests/serialize/bug73052.phpt||ext/standard/tests/serialize/bug73052.phpt",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "Zend/zend_objects_API.c||Zend/zend_objects_API.c": [
          "File: Zend/zend_objects_API.c -> Zend/zend_objects_API.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "306: {",
          "307:  zend_object_handle handle = Z_OBJ_HANDLE_P(zobject);",
          "308:  zend_object_store_bucket *obj_bucket = &EG(objects_store).object_buckets[handle];",
          "311:  obj_bucket->destructor_called = 1;",
          "312: }",
          "",
          "[Removed Lines]",
          "310:  obj_bucket->bucket.obj.handlers = Z_OBJ_HT_P(zobject);;",
          "",
          "[Added Lines]",
          "310:  obj_bucket->bucket.obj.handlers = Z_OBJ_HT_P(zobject);",
          "",
          "---------------"
        ],
        "ext/standard/tests/serialize/bug73052.phpt||ext/standard/tests/serialize/bug73052.phpt": [
          "File: ext/standard/tests/serialize/bug73052.phpt -> ext/standard/tests/serialize/bug73052.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #73052: Memory Corruption in During Deserialized-object Destruction",
          "3: --FILE--",
          "4: <?php",
          "6: class obj {",
          "7:     var $ryat;",
          "8:     public function __destruct() {",
          "9:         $this->ryat = null;",
          "10:     }",
          "11: }",
          "13: $poc = 'O:3:\"obj\":1:{';",
          "14: var_dump(unserialize($poc));",
          "15: ?>",
          "16: --EXPECTF--",
          "17: Notice: unserialize(): Error at offset 13 of 13 bytes in %sbug73052.php on line %d",
          "18: bool(false)",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "438:      if(Z_TYPE_PP(rval) == IS_OBJECT) {",
          "439:         zend_hash_clean(Z_OBJPROP_PP(rval));",
          "440:      }",
          "441:      ZVAL_NULL(*rval);",
          "442:   return 0;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "440:         zend_object_store_ctor_failed(*rval TSRMLS_CC);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "495: {",
          "496:  YYCTYPE yych;",
          "497:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "494: #line 495 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "495: #line 496 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "551:  yych = *(YYMARKER = ++YYCURSOR);",
          "552:  if (yych == ':') goto yy95;",
          "553: yy3:",
          "555:  { return 0; }",
          "557: yy4:",
          "558:  yych = *(YYMARKER = ++YYCURSOR);",
          "559:  if (yych == ':') goto yy89;",
          "",
          "[Removed Lines]",
          "554: #line 860 \"ext/standard/var_unserializer.re\"",
          "556: #line 557 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "555: #line 861 \"ext/standard/var_unserializer.re\"",
          "557: #line 558 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "596:  goto yy3;",
          "597: yy14:",
          "598:  ++YYCURSOR;",
          "600:  {",
          "602:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
          "604: }",
          "606: yy16:",
          "607:  yych = *++YYCURSOR;",
          "608:  goto yy3;",
          "",
          "[Removed Lines]",
          "599: #line 854 \"ext/standard/var_unserializer.re\"",
          "605: #line 606 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "600: #line 855 \"ext/standard/var_unserializer.re\"",
          "606: #line 607 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "633:  yych = *++YYCURSOR;",
          "634:  if (yych != '\"') goto yy18;",
          "635:  ++YYCURSOR;",
          "637:  {",
          "638:  size_t len, len2, len3, maxlen;",
          "639:  long elements;",
          "",
          "[Removed Lines]",
          "636: #line 707 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "637: #line 708 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "781:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "782: }",
          "784: yy25:",
          "785:  yych = *++YYCURSOR;",
          "786:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "783: #line 784 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "784: #line 785 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "805:  yych = *++YYCURSOR;",
          "806:  if (yych != '\"') goto yy18;",
          "807:  ++YYCURSOR;",
          "809:  {",
          "810:     if (!var_hash) return 0;",
          "",
          "[Removed Lines]",
          "808: #line 698 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "809: #line 699 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "814:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "815:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "816: }",
          "818: yy32:",
          "819:  yych = *++YYCURSOR;",
          "820:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "817: #line 818 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "818: #line 819 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "835:  yych = *++YYCURSOR;",
          "836:  if (yych != '{') goto yy18;",
          "837:  ++YYCURSOR;",
          "839:  {",
          "840:  long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "838: #line 677 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "839: #line 678 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "857:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "858: }",
          "860: yy39:",
          "861:  yych = *++YYCURSOR;",
          "862:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "859: #line 860 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "860: #line 861 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "877:  yych = *++YYCURSOR;",
          "878:  if (yych != '\"') goto yy18;",
          "879:  ++YYCURSOR;",
          "881:  {",
          "882:  size_t len, maxlen;",
          "883:  char *str;",
          "",
          "[Removed Lines]",
          "880: #line 642 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "881: #line 643 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "912:  ZVAL_STRINGL(*rval, str, len, 0);",
          "913:  return 1;",
          "914: }",
          "916: yy46:",
          "917:  yych = *++YYCURSOR;",
          "918:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "915: #line 916 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "916: #line 917 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "933:  yych = *++YYCURSOR;",
          "934:  if (yych != '\"') goto yy18;",
          "935:  ++YYCURSOR;",
          "937:  {",
          "938:  size_t len, maxlen;",
          "939:  char *str;",
          "",
          "[Removed Lines]",
          "936: #line 609 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "937: #line 610 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "966:  ZVAL_STRINGL(*rval, str, len, 1);",
          "967:  return 1;",
          "968: }",
          "970: yy53:",
          "971:  yych = *++YYCURSOR;",
          "972:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "969: #line 970 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "970: #line 971 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1054:  }",
          "1055: yy63:",
          "1056:  ++YYCURSOR;",
          "1058:  {",
          "1059: #if SIZEOF_LONG == 4",
          "1060: use_double:",
          "",
          "[Removed Lines]",
          "1057: #line 599 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1058: #line 600 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1064:  ZVAL_DOUBLE(*rval, zend_strtod((const char *)start + 2, NULL));",
          "1065:  return 1;",
          "1066: }",
          "1068: yy65:",
          "1069:  yych = *++YYCURSOR;",
          "1070:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1067: #line 1068 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1068: #line 1069 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1123:  yych = *++YYCURSOR;",
          "1124:  if (yych != ';') goto yy18;",
          "1125:  ++YYCURSOR;",
          "1127:  {",
          "1129:  INIT_PZVAL(*rval);",
          "",
          "[Removed Lines]",
          "1126: #line 584 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1127: #line 585 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "1139:  return 1;",
          "1140: }",
          "1142: yy76:",
          "1143:  yych = *++YYCURSOR;",
          "1144:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1141: #line 1142 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1142: #line 1143 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1165:  if (yych <= '9') goto yy79;",
          "1166:  if (yych != ';') goto yy18;",
          "1167:  ++YYCURSOR;",
          "1169:  {",
          "1170: #if SIZEOF_LONG == 4",
          "1171:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1168: #line 557 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1169: #line 558 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1192:  ZVAL_LONG(*rval, parse_iv(start + 2));",
          "1193:  return 1;",
          "1194: }",
          "1196: yy83:",
          "1197:  yych = *++YYCURSOR;",
          "1198:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1195: #line 1196 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1196: #line 1197 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "1200:  yych = *++YYCURSOR;",
          "1201:  if (yych != ';') goto yy18;",
          "1202:  ++YYCURSOR;",
          "1204:  {",
          "1206:  INIT_PZVAL(*rval);",
          "1207:  ZVAL_BOOL(*rval, parse_iv(start + 2));",
          "1208:  return 1;",
          "1209: }",
          "1211: yy87:",
          "1212:  ++YYCURSOR;",
          "1214:  {",
          "1216:  INIT_PZVAL(*rval);",
          "1217:  ZVAL_NULL(*rval);",
          "1218:  return 1;",
          "1219: }",
          "1221: yy89:",
          "1222:  yych = *++YYCURSOR;",
          "1223:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1203: #line 550 \"ext/standard/var_unserializer.re\"",
          "1210: #line 1211 \"ext/standard/var_unserializer.c\"",
          "1213: #line 543 \"ext/standard/var_unserializer.re\"",
          "1220: #line 1221 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1204: #line 551 \"ext/standard/var_unserializer.re\"",
          "1211: #line 1212 \"ext/standard/var_unserializer.c\"",
          "1214: #line 544 \"ext/standard/var_unserializer.re\"",
          "1221: #line 1222 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "1240:  if (yych <= '9') goto yy91;",
          "1241:  if (yych != ';') goto yy18;",
          "1242:  ++YYCURSOR;",
          "1244:  {",
          "1245:  long id;",
          "",
          "[Removed Lines]",
          "1243: #line 520 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1244: #line 521 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "1264:  return 1;",
          "1265: }",
          "1267: yy95:",
          "1268:  yych = *++YYCURSOR;",
          "1269:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1266: #line 1267 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1267: #line 1268 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "1286:  if (yych <= '9') goto yy97;",
          "1287:  if (yych != ';') goto yy18;",
          "1288:  ++YYCURSOR;",
          "1290:  {",
          "1291:  long id;",
          "",
          "[Removed Lines]",
          "1289: #line 499 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1290: #line 500 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 25 ---",
          "[Context before]",
          "1308:  return 1;",
          "1309: }",
          "1311: }",
          "1315:  return 0;",
          "",
          "[Removed Lines]",
          "1310: #line 1311 \"ext/standard/var_unserializer.c\"",
          "1312: #line 862 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1311: #line 1312 \"ext/standard/var_unserializer.c\"",
          "1313: #line 863 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "442:      if(Z_TYPE_PP(rval) == IS_OBJECT) {",
          "443:         zend_hash_clean(Z_OBJPROP_PP(rval));",
          "444:      }",
          "445:      ZVAL_NULL(*rval);",
          "446:   return 0;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "444:         zend_object_store_ctor_failed(*rval TSRMLS_CC);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "9d7c5dbed941c4d4c18d7d5ed308a07897b7596d",
      "candidate_info": {
        "commit_hash": "9d7c5dbed941c4d4c18d7d5ed308a07897b7596d",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/9d7c5dbed941c4d4c18d7d5ed308a07897b7596d",
        "files": [
          "ext/standard/php_var.h",
          "ext/standard/tests/serialize/serialization_error_001.phpt",
          "ext/standard/tests/serialize/unserialize_classes.phpt",
          "ext/standard/var.c",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "secured unserialize\n\n- update for BC-compatible unserialize\n- add tests",
        "before_after_code_files": [
          "ext/standard/php_var.h||ext/standard/php_var.h",
          "ext/standard/tests/serialize/serialization_error_001.phpt||ext/standard/tests/serialize/serialization_error_001.phpt",
          "ext/standard/tests/serialize/unserialize_classes.phpt||ext/standard/tests/serialize/unserialize_classes.phpt",
          "ext/standard/var.c||ext/standard/var.c",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/php_var.h||ext/standard/php_var.h": [
          "File: ext/standard/php_var.h -> ext/standard/php_var.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "57: PHPAPI int php_var_unserialize(zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash TSRMLS_DC);",
          "58: PHPAPI int php_var_unserialize_ref(zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash TSRMLS_DC);",
          "59: PHPAPI int php_var_unserialize_intern(zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash TSRMLS_DC);",
          "61: #define PHP_VAR_SERIALIZE_INIT(d) \\",
          "62: do  { \\",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "60: PHPAPI int php_var_unserialize_ex(zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash, HashTable *classes TSRMLS_DC);",
          "",
          "---------------"
        ],
        "ext/standard/tests/serialize/serialization_error_001.phpt||ext/standard/tests/serialize/serialization_error_001.phpt": [
          "File: ext/standard/tests/serialize/serialization_error_001.phpt -> ext/standard/tests/serialize/serialization_error_001.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "23: var_dump( serialize(1,2) );",
          "26: echo \"Done\";",
          "27: ?>",
          "",
          "[Removed Lines]",
          "24: var_dump( unserialize(1,2) );",
          "",
          "[Added Lines]",
          "24: var_dump( unserialize(1,2,3) );",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "31: Warning: serialize() expects exactly 1 parameter, 0 given in %s on line 16",
          "32: NULL",
          "35: bool(false)",
          "37: Warning: serialize() expects exactly 1 parameter, 2 given in %s on line 20",
          "38: NULL",
          "41: bool(false)",
          "42: Done",
          "",
          "[Removed Lines]",
          "34: Warning: unserialize() expects exactly 1 parameter, 0 given in %s on line 17",
          "40: Warning: unserialize() expects exactly 1 parameter, 2 given in %s on line 21",
          "",
          "[Added Lines]",
          "34: Warning: unserialize() expects at least 1 parameter, 0 given in %s on line 17",
          "40: Warning: unserialize() expects at most 2 parameters, 3 given in %s on line 21",
          "",
          "---------------"
        ],
        "ext/standard/tests/serialize/unserialize_classes.phpt||ext/standard/tests/serialize/unserialize_classes.phpt": [
          "File: ext/standard/tests/serialize/unserialize_classes.phpt -> ext/standard/tests/serialize/unserialize_classes.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Test unserialize() with second parameter",
          "3: --FILE--",
          "4: <?php",
          "5: class foo {",
          "6:         public $x = \"bar\";",
          "7: }",
          "8: $z = array(new foo(), 2, \"3\");",
          "9: $s = serialize($z);",
          "11: var_dump(unserialize($s));",
          "12: var_dump(unserialize($s, [\"allowed_classes\" => false]));",
          "13: var_dump(unserialize($s, [\"allowed_classes\" => true]));",
          "14: var_dump(unserialize($s, [\"allowed_classes\" => [\"bar\"]]));",
          "15: var_dump(unserialize($s, [\"allowed_classes\" => [\"FOO\"]]));",
          "16: var_dump(unserialize($s, [\"allowed_classes\" => [\"bar\", \"foO\"]]));",
          "18: --EXPECTF--",
          "19: array(3) {",
          "20:   [0]=>",
          "21:   object(foo)#%d (1) {",
          "22:     [\"x\"]=>",
          "23:     string(3) \"bar\"",
          "24:   }",
          "25:   [1]=>",
          "26:   int(2)",
          "27:   [2]=>",
          "28:   string(1) \"3\"",
          "29: }",
          "30: array(3) {",
          "31:   [0]=>",
          "32:   object(__PHP_Incomplete_Class)#%d (2) {",
          "33:     [\"__PHP_Incomplete_Class_Name\"]=>",
          "34:     string(3) \"foo\"",
          "35:     [\"x\"]=>",
          "36:     string(3) \"bar\"",
          "37:   }",
          "38:   [1]=>",
          "39:   int(2)",
          "40:   [2]=>",
          "41:   string(1) \"3\"",
          "42: }",
          "43: array(3) {",
          "44:   [0]=>",
          "45:   object(foo)#%d (1) {",
          "46:     [\"x\"]=>",
          "47:     string(3) \"bar\"",
          "48:   }",
          "49:   [1]=>",
          "50:   int(2)",
          "51:   [2]=>",
          "52:   string(1) \"3\"",
          "53: }",
          "54: array(3) {",
          "55:   [0]=>",
          "56:   object(__PHP_Incomplete_Class)#%d (2) {",
          "57:     [\"__PHP_Incomplete_Class_Name\"]=>",
          "58:     string(3) \"foo\"",
          "59:     [\"x\"]=>",
          "60:     string(3) \"bar\"",
          "61:   }",
          "62:   [1]=>",
          "63:   int(2)",
          "64:   [2]=>",
          "65:   string(1) \"3\"",
          "66: }",
          "67: array(3) {",
          "68:   [0]=>",
          "69:   object(foo)#%d (1) {",
          "70:     [\"x\"]=>",
          "71:     string(3) \"bar\"",
          "72:   }",
          "73:   [1]=>",
          "74:   int(2)",
          "75:   [2]=>",
          "76:   string(1) \"3\"",
          "77: }",
          "78: array(3) {",
          "79:   [0]=>",
          "80:   object(foo)#%d (1) {",
          "81:     [\"x\"]=>",
          "82:     string(3) \"bar\"",
          "83:   }",
          "84:   [1]=>",
          "85:   int(2)",
          "86:   [2]=>",
          "87:   string(1) \"3\"",
          "88: }",
          "",
          "---------------"
        ],
        "ext/standard/var.c||ext/standard/var.c": [
          "File: ext/standard/var.c -> ext/standard/var.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "998:  size_t buf_len;",
          "999:  const unsigned char *p;",
          "1000:  php_unserialize_data_t var_hash;",
          "1003:   RETURN_FALSE;",
          "1004:  }",
          "",
          "[Removed Lines]",
          "1002:  if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, \"s\", &buf, &buf_len) == FAILURE) {",
          "",
          "[Added Lines]",
          "1001:  zval *options = NULL, *classes = NULL;",
          "1002:  HashTable *class_hash = NULL;",
          "1004:  if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, \"s|a\", &buf, &buf_len, &options) == FAILURE) {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1010:  p = (const unsigned char*) buf;",
          "1011:  PHP_VAR_UNSERIALIZE_INIT(var_hash);",
          "1013:   PHP_VAR_UNSERIALIZE_DESTROY(var_hash);",
          "1014:   zval_dtor(return_value);",
          "1015:   if (!EG(exception)) {",
          "1016:    php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Error at offset \" ZEND_LONG_FMT \" of %d bytes\", (zend_long)((char*)p - buf), buf_len);",
          "",
          "[Removed Lines]",
          "1012:  if (!php_var_unserialize(return_value, &p, p + buf_len, &var_hash TSRMLS_CC)) {",
          "",
          "[Added Lines]",
          "1014:  if(options != NULL) {",
          "1015:   classes = zend_hash_str_find(Z_ARRVAL_P(options), \"allowed_classes\", sizeof(\"allowed_classes\")-1);",
          "1016:   if(classes && (Z_TYPE_P(classes) == IS_ARRAY || !zend_is_true(classes TSRMLS_CC))) {",
          "1017:    ALLOC_HASHTABLE(class_hash);",
          "1018:    zend_hash_init(class_hash, (Z_TYPE_P(classes) == IS_ARRAY)?zend_hash_num_elements(Z_ARRVAL_P(classes)):0, NULL, NULL, 0);",
          "1019:   }",
          "1020:   if(class_hash && Z_TYPE_P(classes) == IS_ARRAY) {",
          "1021:    zval *entry;",
          "1022:    zend_string *lcname;",
          "1024:    ZEND_HASH_FOREACH_VAL(Z_ARRVAL_P(classes), entry) {",
          "1025:     convert_to_string_ex(entry);",
          "1026:     lcname = zend_string_alloc(Z_STRLEN_P(entry), 0);",
          "1027:     zend_str_tolower_copy(lcname->val, Z_STRVAL_P(entry), Z_STRLEN_P(entry));",
          "1028:     zend_hash_add_empty_element(class_hash, lcname);",
          "1029:           zend_string_release(lcname);",
          "1030:    } ZEND_HASH_FOREACH_END();",
          "1031:   }",
          "1032:  }",
          "1034:  if (!php_var_unserialize_ex(return_value, &p, p + buf_len, &var_hash, class_hash TSRMLS_CC)) {",
          "1036:   if(class_hash) {",
          "1037:    zend_hash_destroy(class_hash);",
          "1038:    FREE_HASHTABLE(class_hash);",
          "1039:   }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1018:   RETURN_FALSE;",
          "1019:  }",
          "1020:  PHP_VAR_UNSERIALIZE_DESTROY(var_hash);",
          "1021: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1047:  if(class_hash) {",
          "1048:   zend_hash_destroy(class_hash);",
          "1049:   FREE_HASHTABLE(class_hash);",
          "1050:  }",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "226:  return str;",
          "227: }",
          "229: #define YYFILL(n) do { } while (0)",
          "230: #define YYCTYPE unsigned char",
          "231: #define YYCURSOR cursor",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "229: static inline int unserialize_allowed_class(zend_string *class_name, HashTable *classes)",
          "230: {",
          "231:  zend_string *lcname;",
          "232:  int res;",
          "233:  ALLOCA_FLAG(use_heap)",
          "235:  if(classes == NULL) {",
          "236:   return 1;",
          "237:  }",
          "238:  if(!zend_hash_num_elements(classes)) {",
          "239:   return 0;",
          "240:  }",
          "242:  STR_ALLOCA_ALLOC(lcname, class_name->len, use_heap);",
          "243:  zend_str_tolower_copy(lcname->val, class_name->val, class_name->len);",
          "244:  res = zend_hash_exists(classes, lcname);",
          "245:  STR_ALLOCA_FREE(lcname, use_heap);",
          "246:  return res;",
          "247: }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "233: #define YYMARKER marker",
          "",
          "[Removed Lines]",
          "236: #line 241 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "256: #line 261 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "293:  return result;",
          "294: }",
          "299: static inline int process_nested_data(UNSERIALIZE_PARAMETER, HashTable *ht, zend_long elements, int objprops)",
          "300: {",
          "",
          "[Removed Lines]",
          "296: #define UNSERIALIZE_PARAMETER zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash TSRMLS_DC",
          "297: #define UNSERIALIZE_PASSTHRU rval, p, max, var_hash TSRMLS_CC",
          "",
          "[Added Lines]",
          "316: #define UNSERIALIZE_PARAMETER zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash, HashTable *classes TSRMLS_DC",
          "317: #define UNSERIALIZE_PASSTHRU rval, p, max, var_hash, classes TSRMLS_CC",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "302:   zval key, *data, d, *old_data;",
          "304:   ZVAL_UNDEF(&key);",
          "306:    zval_dtor(&key);",
          "307:    return 0;",
          "308:   }",
          "",
          "[Removed Lines]",
          "305:   if (!php_var_unserialize(&key, p, max, NULL TSRMLS_CC)) {",
          "",
          "[Added Lines]",
          "326:   if (!php_var_unserialize_ex(&key, p, max, NULL, classes TSRMLS_CC)) {",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "355:   zval_dtor(&key);",
          "358:    return 0;",
          "359:   }",
          "",
          "[Removed Lines]",
          "357:   if (!php_var_unserialize(data, p, max, var_hash TSRMLS_CC)) {",
          "",
          "[Added Lines]",
          "378:   if (!php_var_unserialize_ex(data, p, max, var_hash, classes TSRMLS_CC)) {",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "462: # pragma optimize(\"\", on)",
          "463: #endif",
          "466: {",
          "467:  const unsigned char *cursor, *limit, *marker, *start;",
          "468:  zval *rval_ref;",
          "",
          "[Removed Lines]",
          "465: PHPAPI int php_var_unserialize(UNSERIALIZE_PARAMETER)",
          "",
          "[Added Lines]",
          "486: PHPAPI int php_var_unserialize(zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash TSRMLS_DC)",
          "487: {",
          "488:  HashTable *classes = NULL;",
          "489:  return php_var_unserialize_ex(UNSERIALIZE_PASSTHRU);",
          "490: }",
          "493: PHPAPI int php_var_unserialize_ex(UNSERIALIZE_PARAMETER)",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "481:  start = cursor;",
          "485: {",
          "486:  YYCTYPE yych;",
          "487:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "484: #line 485 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "512: #line 513 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "541:  yych = *(YYMARKER = ++YYCURSOR);",
          "542:  if (yych == ':') goto yy95;",
          "543: yy3:",
          "545:  { return 0; }",
          "547: yy4:",
          "548:  yych = *(YYMARKER = ++YYCURSOR);",
          "549:  if (yych == ':') goto yy89;",
          "",
          "[Removed Lines]",
          "544: #line 826 \"ext/standard/var_unserializer.re\"",
          "546: #line 547 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "572: #line 860 \"ext/standard/var_unserializer.re\"",
          "574: #line 575 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "586:  goto yy3;",
          "587: yy14:",
          "588:  ++YYCURSOR;",
          "590:  {",
          "592:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
          "594: }",
          "596: yy16:",
          "597:  yych = *++YYCURSOR;",
          "598:  goto yy3;",
          "",
          "[Removed Lines]",
          "589: #line 820 \"ext/standard/var_unserializer.re\"",
          "595: #line 596 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "617: #line 854 \"ext/standard/var_unserializer.re\"",
          "623: #line 624 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "618:  if (yybm[0+yych] & 128) {",
          "619:   goto yy20;",
          "620:  }",
          "622:  yych = *++YYCURSOR;",
          "623:  if (yych != '\"') goto yy18;",
          "624:  ++YYCURSOR;",
          "626:  {",
          "627:  size_t len, len2, len3, maxlen;",
          "628:  zend_long elements;",
          "",
          "[Removed Lines]",
          "621:  if (yych != ':') goto yy18;",
          "625: #line 681 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "649:  if (yych <= '/') goto yy18;",
          "650:  if (yych >= ';') goto yy18;",
          "654: #line 709 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "672:  class_name = zend_string_init(str, len, 0);",
          "674:  do {",
          "676:   BG(serialize_lock)++;",
          "677:   ce = zend_lookup_class(class_name TSRMLS_CC);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "704:   if(!unserialize_allowed_class(class_name, classes)) {",
          "705:    incomplete_class = 1;",
          "706:    ce = PHP_IC_ENTRY;",
          "707:    break;",
          "708:   }",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "762:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "763: }",
          "765: yy25:",
          "766:  yych = *++YYCURSOR;",
          "767:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "764: #line 765 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "799: #line 800 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "786:  yych = *++YYCURSOR;",
          "787:  if (yych != '\"') goto yy18;",
          "788:  ++YYCURSOR;",
          "790:  {",
          "",
          "[Removed Lines]",
          "789: #line 673 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "824: #line 701 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "794:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "795:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "796: }",
          "798: yy32:",
          "799:  yych = *++YYCURSOR;",
          "800:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "797: #line 798 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "832: #line 833 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "815:  yych = *++YYCURSOR;",
          "816:  if (yych != '{') goto yy18;",
          "817:  ++YYCURSOR;",
          "819:  {",
          "820:  zend_long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "818: #line 652 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "853: #line 680 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "837:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "838: }",
          "840: yy39:",
          "841:  yych = *++YYCURSOR;",
          "842:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "839: #line 840 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "874: #line 875 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "857:  yych = *++YYCURSOR;",
          "858:  if (yych != '\"') goto yy18;",
          "859:  ++YYCURSOR;",
          "861:  {",
          "862:  size_t len, maxlen;",
          "863:  zend_string *str;",
          "",
          "[Removed Lines]",
          "860: #line 624 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "895: #line 652 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "885:  ZVAL_STR(rval, str);",
          "886:  return 1;",
          "887: }",
          "889: yy46:",
          "890:  yych = *++YYCURSOR;",
          "891:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "888: #line 889 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "923: #line 924 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "906:  yych = *++YYCURSOR;",
          "907:  if (yych != '\"') goto yy18;",
          "908:  ++YYCURSOR;",
          "910:  {",
          "911:  size_t len, maxlen;",
          "912:  char *str;",
          "",
          "[Removed Lines]",
          "909: #line 597 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "944: #line 625 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "933:  ZVAL_STRINGL(rval, str, len);",
          "934:  return 1;",
          "935: }",
          "937: yy53:",
          "938:  yych = *++YYCURSOR;",
          "939:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "936: #line 937 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "971: #line 972 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "1021:  }",
          "1022: yy63:",
          "1023:  ++YYCURSOR;",
          "1025:  {",
          "1026: #if SIZEOF_ZEND_LONG == 4",
          "1027: use_double:",
          "",
          "[Removed Lines]",
          "1024: #line 588 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1059: #line 616 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "1030:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1031:  return 1;",
          "1032: }",
          "1034: yy65:",
          "1035:  yych = *++YYCURSOR;",
          "1036:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1033: #line 1034 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1068: #line 1069 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "1089:  yych = *++YYCURSOR;",
          "1090:  if (yych != ';') goto yy18;",
          "1091:  ++YYCURSOR;",
          "1093:  {",
          "",
          "[Removed Lines]",
          "1092: #line 572 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1127: #line 600 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "1106:  return 1;",
          "1107: }",
          "1109: yy76:",
          "1110:  yych = *++YYCURSOR;",
          "1111:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1108: #line 1109 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1143: #line 1144 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 25 ---",
          "[Context before]",
          "1132:  if (yych <= '9') goto yy79;",
          "1133:  if (yych != ';') goto yy18;",
          "1134:  ++YYCURSOR;",
          "1136:  {",
          "1137: #if SIZEOF_ZEND_LONG == 4",
          "1138:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1135: #line 546 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1170: #line 574 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 26 ---",
          "[Context before]",
          "1158:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1159:  return 1;",
          "1160: }",
          "1162: yy83:",
          "1163:  yych = *++YYCURSOR;",
          "1164:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1161: #line 1162 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1196: #line 1197 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 27 ---",
          "[Context before]",
          "1166:  yych = *++YYCURSOR;",
          "1167:  if (yych != ';') goto yy18;",
          "1168:  ++YYCURSOR;",
          "1170:  {",
          "1172:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1173:  return 1;",
          "1174: }",
          "1176: yy87:",
          "1177:  ++YYCURSOR;",
          "1179:  {",
          "1181:  ZVAL_NULL(rval);",
          "1182:  return 1;",
          "1183: }",
          "1185: yy89:",
          "1186:  yych = *++YYCURSOR;",
          "1187:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1169: #line 540 \"ext/standard/var_unserializer.re\"",
          "1175: #line 1176 \"ext/standard/var_unserializer.c\"",
          "1178: #line 534 \"ext/standard/var_unserializer.re\"",
          "1184: #line 1185 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1204: #line 568 \"ext/standard/var_unserializer.re\"",
          "1210: #line 1211 \"ext/standard/var_unserializer.c\"",
          "1213: #line 562 \"ext/standard/var_unserializer.re\"",
          "1219: #line 1220 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 28 ---",
          "[Context before]",
          "1204:  if (yych <= '9') goto yy91;",
          "1205:  if (yych != ';') goto yy18;",
          "1206:  ++YYCURSOR;",
          "1208:  {",
          "1209:  zend_long id;",
          "",
          "[Removed Lines]",
          "1207: #line 511 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1242: #line 539 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 29 ---",
          "[Context before]",
          "1228:  return 1;",
          "1229: }",
          "1231: yy95:",
          "1232:  yych = *++YYCURSOR;",
          "1233:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1230: #line 1231 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1265: #line 1266 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 30 ---",
          "[Context before]",
          "1250:  if (yych <= '9') goto yy97;",
          "1251:  if (yych != ';') goto yy18;",
          "1252:  ++YYCURSOR;",
          "1254:  {",
          "1255:  zend_long id;",
          "",
          "[Removed Lines]",
          "1253: #line 489 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1288: #line 517 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 31 ---",
          "[Context before]",
          "1273:  return 1;",
          "1274: }",
          "1276: }",
          "1280:  return 0;",
          "",
          "[Removed Lines]",
          "1275: #line 1276 \"ext/standard/var_unserializer.c\"",
          "1277: #line 828 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1310: #line 1311 \"ext/standard/var_unserializer.c\"",
          "1312: #line 862 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "224:  return str;",
          "225: }",
          "227: #define YYFILL(n) do { } while (0)",
          "228: #define YYCTYPE unsigned char",
          "229: #define YYCURSOR cursor",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "227: static inline int unserialize_allowed_class(zend_string *class_name, HashTable *classes)",
          "228: {",
          "229:  zend_string *lcname;",
          "230:  int res;",
          "231:  ALLOCA_FLAG(use_heap)",
          "233:  if(classes == NULL) {",
          "234:   return 1;",
          "235:  }",
          "236:  if(!zend_hash_num_elements(classes)) {",
          "237:   return 0;",
          "238:  }",
          "240:  STR_ALLOCA_ALLOC(lcname, class_name->len, use_heap);",
          "241:  zend_str_tolower_copy(lcname->val, class_name->val, class_name->len);",
          "242:  res = zend_hash_exists(classes, lcname);",
          "243:  STR_ALLOCA_FREE(lcname, use_heap);",
          "244:  return res;",
          "245: }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "297:  return result;",
          "298: }",
          "303: static inline int process_nested_data(UNSERIALIZE_PARAMETER, HashTable *ht, zend_long elements, int objprops)",
          "304: {",
          "",
          "[Removed Lines]",
          "300: #define UNSERIALIZE_PARAMETER zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash TSRMLS_DC",
          "301: #define UNSERIALIZE_PASSTHRU rval, p, max, var_hash TSRMLS_CC",
          "",
          "[Added Lines]",
          "320: #define UNSERIALIZE_PARAMETER zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash, HashTable *classes TSRMLS_DC",
          "321: #define UNSERIALIZE_PASSTHRU rval, p, max, var_hash, classes TSRMLS_CC",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "306:   zval key, *data, d, *old_data;",
          "308:   ZVAL_UNDEF(&key);",
          "310:    zval_dtor(&key);",
          "311:    return 0;",
          "312:   }",
          "",
          "[Removed Lines]",
          "309:   if (!php_var_unserialize(&key, p, max, NULL TSRMLS_CC)) {",
          "",
          "[Added Lines]",
          "330:   if (!php_var_unserialize_ex(&key, p, max, NULL, classes TSRMLS_CC)) {",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "359:   zval_dtor(&key);",
          "362:    return 0;",
          "363:   }",
          "",
          "[Removed Lines]",
          "361:   if (!php_var_unserialize(data, p, max, var_hash TSRMLS_CC)) {",
          "",
          "[Added Lines]",
          "382:   if (!php_var_unserialize_ex(data, p, max, var_hash, classes TSRMLS_CC)) {",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "466: # pragma optimize(\"\", on)",
          "467: #endif",
          "470: {",
          "471:  const unsigned char *cursor, *limit, *marker, *start;",
          "472:  zval *rval_ref;",
          "",
          "[Removed Lines]",
          "469: PHPAPI int php_var_unserialize(UNSERIALIZE_PARAMETER)",
          "",
          "[Added Lines]",
          "490: PHPAPI int php_var_unserialize(zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash TSRMLS_DC)",
          "491: {",
          "492:  HashTable *classes = NULL;",
          "493:  return php_var_unserialize_ex(UNSERIALIZE_PASSTHRU);",
          "494: }",
          "497: PHPAPI int php_var_unserialize_ex(UNSERIALIZE_PARAMETER)",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "727:  class_name = zend_string_init(str, len, 0);",
          "729:  do {",
          "731:   BG(serialize_lock)++;",
          "732:   ce = zend_lookup_class(class_name TSRMLS_CC);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "758:   if(!unserialize_allowed_class(class_name, classes)) {",
          "759:    incomplete_class = 1;",
          "760:    ce = PHP_IC_ENTRY;",
          "761:    break;",
          "762:   }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "f8c514ba6b7962a219296a837b2dbc22f749e736",
      "candidate_info": {
        "commit_hash": "f8c514ba6b7962a219296a837b2dbc22f749e736",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/f8c514ba6b7962a219296a837b2dbc22f749e736",
        "files": [
          "ext/standard/tests/serialize/bug25378.phpt",
          "ext/standard/tests/serialize/bug74111.phpt",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Fixed bug #74111",
        "before_after_code_files": [
          "ext/standard/tests/serialize/bug25378.phpt||ext/standard/tests/serialize/bug25378.phpt",
          "ext/standard/tests/serialize/bug74111.phpt||ext/standard/tests/serialize/bug74111.phpt",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/tests/serialize/bug25378.phpt||ext/standard/tests/serialize/bug25378.phpt": [
          "File: ext/standard/tests/serialize/bug25378.phpt -> ext/standard/tests/serialize/bug25378.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "42: Notice: unserialize(): Error at offset 17 of 33 bytes in %sbug25378.php on line %d",
          "43: bool(false)",
          "46: bool(false)",
          "48: Notice: unserialize(): Error at offset 2 of 13 bytes in %sbug25378.php on line %d",
          "",
          "[Removed Lines]",
          "45: Notice: unserialize(): Error at offset 33 of 32 bytes in %sbug25378.php on line %d",
          "",
          "[Added Lines]",
          "45: Notice: unserialize(): Error at offset 32 of 32 bytes in %sbug25378.php on line %d",
          "",
          "---------------"
        ],
        "ext/standard/tests/serialize/bug74111.phpt||ext/standard/tests/serialize/bug74111.phpt": [
          "File: ext/standard/tests/serialize/bug74111.phpt -> ext/standard/tests/serialize/bug74111.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #74111: Heap buffer overread (READ: 1) finish_nested_data from unserialize",
          "3: --FILE--",
          "4: <?php",
          "5: $s = 'O:8:\"stdClass\":00000000';",
          "6: var_dump(unserialize($s));",
          "7: ?>",
          "8: --EXPECTF--",
          "9: Notice: unserialize(): Error at offset 25 of 23 bytes in %s on line %d",
          "10: bool(false)",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "407: static inline int finish_nested_data(UNSERIALIZE_PARAMETER)",
          "408: {",
          "416: }",
          "418: static inline int object_custom(UNSERIALIZE_PARAMETER, zend_class_entry *ce)",
          "",
          "[Removed Lines]",
          "409:  if (*((*p)++) == '}')",
          "410:   return 1;",
          "412: #if SOMETHING_NEW_MIGHT_LEAD_TO_CRASH_ENABLE_IF_YOU_ARE_BRAVE",
          "413:  zval_ptr_dtor(rval);",
          "414: #endif",
          "415:  return 0;",
          "",
          "[Added Lines]",
          "409:  if (*p >= max || **p != '}') {",
          "410:   return 0;",
          "411:  }",
          "413:  (*p)++;",
          "414:  return 1;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "533: {",
          "534:  YYCTYPE yych;",
          "535:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "532: #line 533 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "531: #line 532 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "570:  yych = *YYCURSOR;",
          "571:  switch (yych) {",
          "572:  case 'C':",
          "574:  case 'N': goto yy5;",
          "581:  case 'o': goto yy12;",
          "586:  }",
          "587: yy2:",
          "589: yy3:",
          "591:  { return 0; }",
          "592: #line 593 \"ext/standard/var_unserializer.c\"",
          "593: yy4:",
          "594:  yych = *(YYMARKER = ++YYCURSOR);",
          "596:  goto yy3;",
          "597: yy5:",
          "598:  yych = *++YYCURSOR;",
          "600:  goto yy3;",
          "601: yy6:",
          "602:  yych = *(YYMARKER = ++YYCURSOR);",
          "604:  goto yy3;",
          "605: yy7:",
          "606:  yych = *(YYMARKER = ++YYCURSOR);",
          "608:  goto yy3;",
          "609: yy8:",
          "610:  yych = *(YYMARKER = ++YYCURSOR);",
          "612:  goto yy3;",
          "613: yy9:",
          "614:  yych = *(YYMARKER = ++YYCURSOR);",
          "616:  goto yy3;",
          "617: yy10:",
          "618:  yych = *(YYMARKER = ++YYCURSOR);",
          "620:  goto yy3;",
          "621: yy11:",
          "622:  yych = *(YYMARKER = ++YYCURSOR);",
          "624:  goto yy3;",
          "625: yy12:",
          "626:  yych = *(YYMARKER = ++YYCURSOR);",
          "628:  goto yy3;",
          "629: yy13:",
          "630:  yych = *(YYMARKER = ++YYCURSOR);",
          "632:  goto yy3;",
          "633: yy14:",
          "638:  ++YYCURSOR;",
          "640:  {",
          "642:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
          "644: }",
          "646: yy17:",
          "647:  yych = *++YYCURSOR;",
          "648:  if (yybm[0+yych] & 128) {",
          "650:  }",
          "652: yy18:",
          "653:  YYCURSOR = YYMARKER;",
          "654:  goto yy3;",
          "655: yy19:",
          "666:  yych = *++YYCURSOR;",
          "675:  }",
          "687:  goto yy18;",
          "690:  if (yych <= '/') goto yy18;",
          "694:  yych = *++YYCURSOR;",
          "703:   }",
          "709:   } else {",
          "712:   }",
          "713:  }",
          "724:  }",
          "735:  }",
          "737:  yych = *++YYCURSOR;",
          "738:  if (yych <= ',') {",
          "741:  } else {",
          "743:   if (yych <= '/') goto yy18;",
          "745:   goto yy18;",
          "746:  }",
          "748:  yych = *++YYCURSOR;",
          "750:  if (yych <= '/') goto yy18;",
          "760:  ++YYCURSOR;",
          "761:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "762:  yych = *YYCURSOR;",
          "766:  if (yych <= '/') goto yy18;",
          "770:  yych = *++YYCURSOR;",
          "774:  ++YYCURSOR;",
          "777:  if (yych <= '/') goto yy18;",
          "778:  if (yych <= '9') goto yy34;",
          "780:  goto yy18;",
          "782:  yych = *++YYCURSOR;",
          "783:  if (yych <= '/') goto yy18;",
          "784:  if (yych >= ':') goto yy18;",
          "786:  ++YYCURSOR;",
          "787:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "788:  yych = *YYCURSOR;",
          "789:  if (yych <= '/') goto yy18;",
          "794:  yych = *++YYCURSOR;",
          "798:  ++YYCURSOR;",
          "823:  }",
          "851:  }",
          "861:  yych = *++YYCURSOR;",
          "862:  if (yych <= '/') goto yy18;",
          "871:  goto yy18;",
          "873:  yych = *++YYCURSOR;",
          "874:  if (yych <= '/') goto yy18;",
          "875:  if (yych >= ':') goto yy18;",
          "877:  ++YYCURSOR;",
          "878:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "879:  yych = *YYCURSOR;",
          "880:  if (yych <= '/') goto yy18;",
          "885:  yych = *++YYCURSOR;",
          "889:  ++YYCURSOR;",
          "892:  if (yych <= '/') goto yy18;",
          "895:  goto yy18;",
          "897:  yych = *++YYCURSOR;",
          "898:  if (yych <= '/') goto yy18;",
          "899:  if (yych >= ':') goto yy18;",
          "901:  ++YYCURSOR;",
          "902:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "903:  yych = *YYCURSOR;",
          "904:  if (yych <= '/') goto yy18;",
          "909:  yych = *++YYCURSOR;",
          "913:  ++YYCURSOR;",
          "915:  {",
          "923:   return 0;",
          "924:  }",
          "928:  }",
          "933:  return 1;",
          "934: }",
          "937:  yych = *++YYCURSOR;",
          "939:  goto yy18;",
          "941:  yych = *++YYCURSOR;",
          "943:  goto yy18;",
          "945:  ++YYCURSOR;",
          "955:  ++YYCURSOR;",
          "956:  if ((YYLIMIT - YYCURSOR) < 4) YYFILL(4);",
          "957:  yych = *YYCURSOR;",
          "958:  if (yych <= ';') {",
          "959:   if (yych <= '/') goto yy18;",
          "961:   if (yych <= ':') goto yy18;",
          "962:  } else {",
          "963:   if (yych <= 'E') {",
          "964:    if (yych <= 'D') goto yy18;",
          "966:   } else {",
          "968:    goto yy18;",
          "969:   }",
          "970:  }",
          "972:  ++YYCURSOR;",
          "974:  {",
          "975: #if SIZEOF_LONG == 4",
          "976: use_double:",
          "",
          "[Removed Lines]",
          "573:  case 'O': goto yy4;",
          "575:  case 'R': goto yy6;",
          "576:  case 'S': goto yy7;",
          "577:  case 'a': goto yy8;",
          "578:  case 'b': goto yy9;",
          "579:  case 'd': goto yy10;",
          "580:  case 'i': goto yy11;",
          "582:  case 'r': goto yy13;",
          "583:  case 's': goto yy14;",
          "584:  case '}': goto yy15;",
          "585:  default: goto yy2;",
          "588:  ++YYCURSOR;",
          "590: #line 909 \"ext/standard/var_unserializer.re\"",
          "595:  if (yych == ':') goto yy17;",
          "599:  if (yych == ';') goto yy19;",
          "603:  if (yych == ':') goto yy21;",
          "607:  if (yych == ':') goto yy22;",
          "611:  if (yych == ':') goto yy23;",
          "615:  if (yych == ':') goto yy24;",
          "619:  if (yych == ':') goto yy25;",
          "623:  if (yych == ':') goto yy26;",
          "627:  if (yych == ':') goto yy27;",
          "631:  if (yych == ':') goto yy28;",
          "634:  yych = *(YYMARKER = ++YYCURSOR);",
          "635:  if (yych == ':') goto yy29;",
          "636:  goto yy3;",
          "637: yy15:",
          "639: #line 903 \"ext/standard/var_unserializer.re\"",
          "645: #line 646 \"ext/standard/var_unserializer.c\"",
          "649:   goto yy31;",
          "651:  if (yych == '+') goto yy30;",
          "656:  ++YYCURSOR;",
          "657: #line 581 \"ext/standard/var_unserializer.re\"",
          "658:  {",
          "660:  INIT_PZVAL(*rval);",
          "661:  ZVAL_NULL(*rval);",
          "662:  return 1;",
          "663: }",
          "664: #line 665 \"ext/standard/var_unserializer.c\"",
          "665: yy21:",
          "667:  if (yych <= ',') {",
          "668:   if (yych == '+') goto yy33;",
          "669:   goto yy18;",
          "670:  } else {",
          "671:   if (yych <= '-') goto yy33;",
          "672:   if (yych <= '/') goto yy18;",
          "673:   if (yych <= '9') goto yy34;",
          "674:   goto yy18;",
          "676: yy22:",
          "677:  yych = *++YYCURSOR;",
          "678:  if (yych == '+') goto yy36;",
          "679:  if (yych <= '/') goto yy18;",
          "680:  if (yych <= '9') goto yy37;",
          "681:  goto yy18;",
          "682: yy23:",
          "683:  yych = *++YYCURSOR;",
          "684:  if (yych == '+') goto yy39;",
          "685:  if (yych <= '/') goto yy18;",
          "686:  if (yych <= '9') goto yy40;",
          "688: yy24:",
          "689:  yych = *++YYCURSOR;",
          "691:  if (yych <= '1') goto yy42;",
          "692:  goto yy18;",
          "693: yy25:",
          "695:  if (yych <= '/') {",
          "696:   if (yych <= ',') {",
          "697:    if (yych == '+') goto yy43;",
          "698:    goto yy18;",
          "699:   } else {",
          "700:    if (yych <= '-') goto yy44;",
          "701:    if (yych <= '.') goto yy45;",
          "702:    goto yy18;",
          "704:  } else {",
          "705:   if (yych <= 'I') {",
          "706:    if (yych <= '9') goto yy46;",
          "707:    if (yych <= 'H') goto yy18;",
          "708:    goto yy48;",
          "710:    if (yych == 'N') goto yy49;",
          "711:    goto yy18;",
          "714: yy26:",
          "715:  yych = *++YYCURSOR;",
          "716:  if (yych <= ',') {",
          "717:   if (yych == '+') goto yy50;",
          "718:   goto yy18;",
          "719:  } else {",
          "720:   if (yych <= '-') goto yy50;",
          "721:   if (yych <= '/') goto yy18;",
          "722:   if (yych <= '9') goto yy51;",
          "723:   goto yy18;",
          "725: yy27:",
          "726:  yych = *++YYCURSOR;",
          "727:  if (yych <= ',') {",
          "728:   if (yych == '+') goto yy53;",
          "729:   goto yy18;",
          "730:  } else {",
          "731:   if (yych <= '-') goto yy53;",
          "732:   if (yych <= '/') goto yy18;",
          "733:   if (yych <= '9') goto yy54;",
          "734:   goto yy18;",
          "736: yy28:",
          "739:   if (yych == '+') goto yy56;",
          "740:   goto yy18;",
          "742:   if (yych <= '-') goto yy56;",
          "744:   if (yych <= '9') goto yy57;",
          "747: yy29:",
          "749:  if (yych == '+') goto yy59;",
          "751:  if (yych <= '9') goto yy60;",
          "752:  goto yy18;",
          "753: yy30:",
          "754:  yych = *++YYCURSOR;",
          "755:  if (yybm[0+yych] & 128) {",
          "756:   goto yy31;",
          "757:  }",
          "758:  goto yy18;",
          "759: yy31:",
          "763:  if (yybm[0+yych] & 128) {",
          "764:   goto yy31;",
          "765:  }",
          "767:  if (yych <= ':') goto yy62;",
          "768:  goto yy18;",
          "769: yy33:",
          "771:  if (yych <= '/') goto yy18;",
          "772:  if (yych >= ':') goto yy18;",
          "773: yy34:",
          "775:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "776:  yych = *YYCURSOR;",
          "779:  if (yych == ';') goto yy63;",
          "781: yy36:",
          "785: yy37:",
          "790:  if (yych <= '9') goto yy37;",
          "791:  if (yych <= ':') goto yy65;",
          "792:  goto yy18;",
          "793: yy39:",
          "795:  if (yych <= '/') goto yy18;",
          "796:  if (yych >= ':') goto yy18;",
          "797: yy40:",
          "799:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "800:  yych = *YYCURSOR;",
          "801:  if (yych <= '/') goto yy18;",
          "802:  if (yych <= '9') goto yy40;",
          "803:  if (yych <= ':') goto yy66;",
          "804:  goto yy18;",
          "805: yy42:",
          "806:  yych = *++YYCURSOR;",
          "807:  if (yych == ';') goto yy67;",
          "808:  goto yy18;",
          "809: yy43:",
          "810:  yych = *++YYCURSOR;",
          "811:  if (yych == '.') goto yy45;",
          "812:  if (yych <= '/') goto yy18;",
          "813:  if (yych <= '9') goto yy46;",
          "814:  goto yy18;",
          "815: yy44:",
          "816:  yych = *++YYCURSOR;",
          "817:  if (yych <= '/') {",
          "818:   if (yych != '.') goto yy18;",
          "819:  } else {",
          "820:   if (yych <= '9') goto yy46;",
          "821:   if (yych == 'I') goto yy48;",
          "822:   goto yy18;",
          "824: yy45:",
          "825:  yych = *++YYCURSOR;",
          "826:  if (yych <= '/') goto yy18;",
          "827:  if (yych <= '9') goto yy69;",
          "828:  goto yy18;",
          "829: yy46:",
          "830:  ++YYCURSOR;",
          "831:  if ((YYLIMIT - YYCURSOR) < 4) YYFILL(4);",
          "832:  yych = *YYCURSOR;",
          "833:  if (yych <= ':') {",
          "834:   if (yych <= '.') {",
          "835:    if (yych <= '-') goto yy18;",
          "836:    goto yy69;",
          "837:   } else {",
          "838:    if (yych <= '/') goto yy18;",
          "839:    if (yych <= '9') goto yy46;",
          "840:    goto yy18;",
          "841:   }",
          "842:  } else {",
          "843:   if (yych <= 'E') {",
          "844:    if (yych <= ';') goto yy71;",
          "845:    if (yych <= 'D') goto yy18;",
          "846:    goto yy73;",
          "847:   } else {",
          "848:    if (yych == 'e') goto yy73;",
          "849:    goto yy18;",
          "850:   }",
          "852: yy48:",
          "853:  yych = *++YYCURSOR;",
          "854:  if (yych == 'N') goto yy74;",
          "855:  goto yy18;",
          "856: yy49:",
          "857:  yych = *++YYCURSOR;",
          "858:  if (yych == 'A') goto yy75;",
          "859:  goto yy18;",
          "860: yy50:",
          "863:  if (yych >= ':') goto yy18;",
          "864: yy51:",
          "865:  ++YYCURSOR;",
          "866:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "867:  yych = *YYCURSOR;",
          "868:  if (yych <= '/') goto yy18;",
          "869:  if (yych <= '9') goto yy51;",
          "870:  if (yych == ';') goto yy76;",
          "872: yy53:",
          "876: yy54:",
          "881:  if (yych <= '9') goto yy54;",
          "882:  if (yych <= ':') goto yy78;",
          "883:  goto yy18;",
          "884: yy56:",
          "886:  if (yych <= '/') goto yy18;",
          "887:  if (yych >= ':') goto yy18;",
          "888: yy57:",
          "890:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "891:  yych = *YYCURSOR;",
          "893:  if (yych <= '9') goto yy57;",
          "894:  if (yych == ';') goto yy79;",
          "896: yy59:",
          "900: yy60:",
          "905:  if (yych <= '9') goto yy60;",
          "906:  if (yych <= ':') goto yy81;",
          "907:  goto yy18;",
          "908: yy62:",
          "910:  if (yych == '\"') goto yy82;",
          "911:  goto yy18;",
          "912: yy63:",
          "914: #line 537 \"ext/standard/var_unserializer.re\"",
          "916:  long id;",
          "919:  if (!var_hash) return 0;",
          "921:  id = parse_iv(start + 2) - 1;",
          "922:  if (id == -1 || var_access(var_hash, id, &rval_ref) != SUCCESS) {",
          "926:  if (*rval != NULL) {",
          "927:   var_push_dtor_no_addref(var_hash, rval);",
          "930:  Z_ADDREF_PP(rval);",
          "931:  Z_SET_ISREF_PP(rval);",
          "935: #line 936 \"ext/standard/var_unserializer.c\"",
          "936: yy65:",
          "938:  if (yych == '\"') goto yy84;",
          "940: yy66:",
          "942:  if (yych == '{') goto yy86;",
          "944: yy67:",
          "946: #line 588 \"ext/standard/var_unserializer.re\"",
          "947:  {",
          "949:  INIT_PZVAL(*rval);",
          "950:  ZVAL_BOOL(*rval, parse_iv(start + 2));",
          "951:  return 1;",
          "952: }",
          "953: #line 954 \"ext/standard/var_unserializer.c\"",
          "954: yy69:",
          "960:   if (yych <= '9') goto yy69;",
          "965:    goto yy73;",
          "967:    if (yych == 'e') goto yy73;",
          "971: yy71:",
          "973: #line 637 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "572:  case 'O': goto yy13;",
          "574:  case 'R': goto yy2;",
          "575:  case 'S': goto yy10;",
          "576:  case 'a': goto yy11;",
          "577:  case 'b': goto yy6;",
          "578:  case 'd': goto yy8;",
          "579:  case 'i': goto yy7;",
          "581:  case 'r': goto yy4;",
          "582:  case 's': goto yy9;",
          "583:  case '}': goto yy14;",
          "584:  default: goto yy16;",
          "587:  yych = *(YYMARKER = ++YYCURSOR);",
          "588:  if (yych == ':') goto yy95;",
          "590: #line 908 \"ext/standard/var_unserializer.re\"",
          "595:  if (yych == ':') goto yy89;",
          "599:  if (yych == ';') goto yy87;",
          "603:  if (yych == ':') goto yy83;",
          "607:  if (yych == ':') goto yy77;",
          "611:  if (yych == ':') goto yy53;",
          "615:  if (yych == ':') goto yy46;",
          "619:  if (yych == ':') goto yy39;",
          "623:  if (yych == ':') goto yy32;",
          "627:  if (yych == ':') goto yy25;",
          "631:  if (yych == ':') goto yy17;",
          "635: #line 902 \"ext/standard/var_unserializer.re\"",
          "641: #line 642 \"ext/standard/var_unserializer.c\"",
          "642: yy16:",
          "643:  yych = *++YYCURSOR;",
          "644:  goto yy3;",
          "648:   goto yy20;",
          "650:  if (yych == '+') goto yy19;",
          "656:  if (yybm[0+yych] & 128) {",
          "657:   goto yy20;",
          "660: yy20:",
          "661:  ++YYCURSOR;",
          "662:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "663:  yych = *YYCURSOR;",
          "664:  if (yybm[0+yych] & 128) {",
          "665:   goto yy20;",
          "666:  }",
          "668:  if (yych >= ';') goto yy18;",
          "670:  if (yych != '\"') goto yy18;",
          "671:  ++YYCURSOR;",
          "672: #line 748 \"ext/standard/var_unserializer.re\"",
          "673:  {",
          "674:  size_t len, len2, len3, maxlen;",
          "675:  long elements;",
          "676:  char *class_name;",
          "677:  zend_class_entry *ce;",
          "678:  zend_class_entry **pce;",
          "679:  int incomplete_class = 0;",
          "681:  int custom_object = 0;",
          "683:  zval *user_func;",
          "684:  zval *retval_ptr;",
          "685:  zval **args[1];",
          "686:  zval *arg_func_name;",
          "688:     if (!var_hash) return 0;",
          "689:  if (*start == 'C') {",
          "690:   custom_object = 1;",
          "691:  }",
          "693:  INIT_PZVAL(*rval);",
          "694:  len2 = len = parse_uiv(start + 2);",
          "695:  maxlen = max - YYCURSOR;",
          "696:  if (maxlen < len || len == 0) {",
          "698:   return 0;",
          "699:  }",
          "701:  class_name = (char*)YYCURSOR;",
          "703:  YYCURSOR += len;",
          "705:  if (*(YYCURSOR) != '\"') {",
          "707:   return 0;",
          "708:  }",
          "709:  if (*(YYCURSOR+1) != ':') {",
          "711:   return 0;",
          "712:  }",
          "714:  len3 = strspn(class_name, \"0123456789_abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\\177\\200\\201\\202\\203\\204\\205\\206\\207\\210\\211\\212\\213\\214\\215\\216\\217\\220\\221\\222\\223\\224\\225\\226\\227\\230\\231\\232\\233\\234\\235\\236\\237\\240\\241\\242\\243\\244\\245\\246\\247\\250\\251\\252\\253\\254\\255\\256\\257\\260\\261\\262\\263\\264\\265\\266\\267\\270\\271\\272\\273\\274\\275\\276\\277\\300\\301\\302\\303\\304\\305\\306\\307\\310\\311\\312\\313\\314\\315\\316\\317\\320\\321\\322\\323\\324\\325\\326\\327\\330\\331\\332\\333\\334\\335\\336\\337\\340\\341\\342\\343\\344\\345\\346\\347\\350\\351\\352\\353\\354\\355\\356\\357\\360\\361\\362\\363\\364\\365\\366\\367\\370\\371\\372\\373\\374\\375\\376\\377\\\\\");",
          "715:  if (len3 != len)",
          "716:  {",
          "718:   return 0;",
          "719:  }",
          "721:  class_name = estrndup(class_name, len);",
          "723:  do {",
          "725:   BG(serialize_lock)++;",
          "726:   if (zend_lookup_class(class_name, len2, &pce TSRMLS_CC) == SUCCESS) {",
          "727:    BG(serialize_lock)--;",
          "728:    if (EG(exception)) {",
          "729:     efree(class_name);",
          "730:     return 0;",
          "731:    }",
          "732:    ce = *pce;",
          "733:    break;",
          "735:   BG(serialize_lock)--;",
          "737:   if (EG(exception)) {",
          "738:    efree(class_name);",
          "739:    return 0;",
          "740:   }",
          "743:   if ((PG(unserialize_callback_func) == NULL) || (PG(unserialize_callback_func)[0] == '\\0')) {",
          "744:    incomplete_class = 1;",
          "745:    ce = PHP_IC_ENTRY;",
          "746:    break;",
          "747:   }",
          "750:   MAKE_STD_ZVAL(user_func);",
          "751:   ZVAL_STRING(user_func, PG(unserialize_callback_func), 1);",
          "752:   args[0] = &arg_func_name;",
          "753:   MAKE_STD_ZVAL(arg_func_name);",
          "754:   ZVAL_STRING(arg_func_name, class_name, 1);",
          "755:   BG(serialize_lock)++;",
          "756:   if (call_user_function_ex(CG(function_table), NULL, user_func, &retval_ptr, 1, args, 0, NULL TSRMLS_CC) != SUCCESS) {",
          "757:    BG(serialize_lock)--;",
          "758:    if (EG(exception)) {",
          "759:     efree(class_name);",
          "760:     zval_ptr_dtor(&user_func);",
          "761:     zval_ptr_dtor(&arg_func_name);",
          "762:     return 0;",
          "763:    }",
          "764:    php_error_docref(NULL TSRMLS_CC, E_WARNING, \"defined (%s) but not found\", user_func->value.str.val);",
          "765:    incomplete_class = 1;",
          "766:    ce = PHP_IC_ENTRY;",
          "767:    zval_ptr_dtor(&user_func);",
          "768:    zval_ptr_dtor(&arg_func_name);",
          "769:    break;",
          "770:   }",
          "771:   BG(serialize_lock)--;",
          "772:   if (retval_ptr) {",
          "773:    zval_ptr_dtor(&retval_ptr);",
          "774:   }",
          "775:   if (EG(exception)) {",
          "776:    efree(class_name);",
          "777:    zval_ptr_dtor(&user_func);",
          "778:    zval_ptr_dtor(&arg_func_name);",
          "779:    return 0;",
          "780:   }",
          "783:   BG(serialize_lock)++;",
          "784:   if (zend_lookup_class(class_name, len2, &pce TSRMLS_CC) == SUCCESS) {",
          "785:    ce = *pce;",
          "787:    php_error_docref(NULL TSRMLS_CC, E_WARNING, \"Function %s() hasn't defined the class it was called for\", user_func->value.str.val);",
          "788:    incomplete_class = 1;",
          "789:    ce = PHP_IC_ENTRY;",
          "790:   }",
          "791:   BG(serialize_lock)--;",
          "793:   zval_ptr_dtor(&user_func);",
          "794:   zval_ptr_dtor(&arg_func_name);",
          "795:   break;",
          "796:  } while (1);",
          "800:  if (custom_object) {",
          "801:   int ret;",
          "803:   ret = object_custom(UNSERIALIZE_PASSTHRU, ce);",
          "805:   if (ret && incomplete_class) {",
          "806:    php_store_class_name(*rval, class_name, len2);",
          "808:   efree(class_name);",
          "809:   return ret;",
          "812:  elements = object_common1(UNSERIALIZE_PASSTHRU, ce);",
          "814:  if (elements < 0) {",
          "815:     efree(class_name);",
          "816:     return 0;",
          "819:  if (incomplete_class) {",
          "820:   php_store_class_name(*rval, class_name, len2);",
          "822:  efree(class_name);",
          "824:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "825: }",
          "826: #line 827 \"ext/standard/var_unserializer.c\"",
          "827: yy25:",
          "830:   if (yych != '+') goto yy18;",
          "832:   if (yych <= '-') goto yy26;",
          "834:   if (yych <= '9') goto yy27;",
          "837: yy26:",
          "840:  if (yych >= ':') goto yy18;",
          "841: yy27:",
          "846:  if (yych <= '9') goto yy27;",
          "847:  if (yych >= ';') goto yy18;",
          "849:  if (yych != '\"') goto yy18;",
          "851: #line 735 \"ext/standard/var_unserializer.re\"",
          "852:  {",
          "853:  long elements;",
          "854:     if (!var_hash) return 0;",
          "856:  INIT_PZVAL(*rval);",
          "858:  elements = object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR);",
          "859:  if (elements < 0) {",
          "860:   return 0;",
          "861:  }",
          "862:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "863: }",
          "864: #line 865 \"ext/standard/var_unserializer.c\"",
          "865: yy32:",
          "866:  yych = *++YYCURSOR;",
          "867:  if (yych == '+') goto yy33;",
          "871: yy33:",
          "875: yy34:",
          "880:  if (yych <= '9') goto yy34;",
          "881:  if (yych >= ';') goto yy18;",
          "883:  if (yych != '{') goto yy18;",
          "885: #line 714 \"ext/standard/var_unserializer.re\"",
          "886:  {",
          "887:  long elements = parse_iv(start + 2);",
          "890:     if (!var_hash) return 0;",
          "892:  if (elements < 0) {",
          "893:   return 0;",
          "896:  INIT_PZVAL(*rval);",
          "898:  array_init_size(*rval, elements);",
          "900:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_ARRVAL_PP(rval), elements, 0)) {",
          "901:   return 0;",
          "904:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "905: }",
          "906: #line 907 \"ext/standard/var_unserializer.c\"",
          "907: yy39:",
          "909:  if (yych == '+') goto yy40;",
          "911:  if (yych <= '9') goto yy41;",
          "913: yy40:",
          "917: yy41:",
          "922:  if (yych <= '9') goto yy41;",
          "923:  if (yych >= ';') goto yy18;",
          "925:  if (yych != '\"') goto yy18;",
          "927: #line 679 \"ext/standard/var_unserializer.re\"",
          "928:  {",
          "929:  size_t len, maxlen;",
          "930:  char *str;",
          "932:  len = parse_uiv(start + 2);",
          "933:  maxlen = max - YYCURSOR;",
          "934:  if (maxlen < len) {",
          "936:   return 0;",
          "937:  }",
          "939:  if ((str = unserialize_str(&YYCURSOR, &len, maxlen)) == NULL) {",
          "940:   return 0;",
          "941:  }",
          "943:  if (*(YYCURSOR) != '\"') {",
          "944:   efree(str);",
          "946:   return 0;",
          "947:  }",
          "949:  if (*(YYCURSOR + 1) != ';') {",
          "950:   efree(str);",
          "952:   return 0;",
          "953:  }",
          "955:  YYCURSOR += 2;",
          "958:  INIT_PZVAL(*rval);",
          "959:  ZVAL_STRINGL(*rval, str, len, 0);",
          "960:  return 1;",
          "961: }",
          "962: #line 963 \"ext/standard/var_unserializer.c\"",
          "963: yy46:",
          "964:  yych = *++YYCURSOR;",
          "965:  if (yych == '+') goto yy47;",
          "967:  if (yych <= '9') goto yy48;",
          "969: yy47:",
          "973: yy48:",
          "978:  if (yych <= '9') goto yy48;",
          "979:  if (yych >= ';') goto yy18;",
          "981:  if (yych != '\"') goto yy18;",
          "983: #line 646 \"ext/standard/var_unserializer.re\"",
          "985:  size_t len, maxlen;",
          "986:  char *str;",
          "988:  len = parse_uiv(start + 2);",
          "989:  maxlen = max - YYCURSOR;",
          "990:  if (maxlen < len) {",
          "992:   return 0;",
          "993:  }",
          "995:  str = (char*)YYCURSOR;",
          "997:  YYCURSOR += len;",
          "999:  if (*(YYCURSOR) != '\"') {",
          "1004:  if (*(YYCURSOR + 1) != ';') {",
          "1006:   return 0;",
          "1009:  YYCURSOR += 2;",
          "1012:  INIT_PZVAL(*rval);",
          "1013:  ZVAL_STRINGL(*rval, str, len, 1);",
          "1016: #line 1017 \"ext/standard/var_unserializer.c\"",
          "1017: yy53:",
          "1018:  yych = *++YYCURSOR;",
          "1019:  if (yych <= '/') {",
          "1020:   if (yych <= ',') {",
          "1021:    if (yych == '+') goto yy57;",
          "1022:    goto yy18;",
          "1023:   } else {",
          "1024:    if (yych <= '-') goto yy55;",
          "1025:    if (yych <= '.') goto yy60;",
          "1026:    goto yy18;",
          "1027:   }",
          "1028:  } else {",
          "1029:   if (yych <= 'I') {",
          "1030:    if (yych <= '9') goto yy58;",
          "1031:    if (yych <= 'H') goto yy18;",
          "1032:    goto yy56;",
          "1033:   } else {",
          "1034:    if (yych != 'N') goto yy18;",
          "1035:   }",
          "1036:  }",
          "1038:  if (yych == 'A') goto yy76;",
          "1040: yy55:",
          "1041:  yych = *++YYCURSOR;",
          "1042:  if (yych <= '/') {",
          "1043:   if (yych == '.') goto yy60;",
          "1044:   goto yy18;",
          "1045:  } else {",
          "1046:   if (yych <= '9') goto yy58;",
          "1047:   if (yych != 'I') goto yy18;",
          "1048:  }",
          "1049: yy56:",
          "1051:  if (yych == 'N') goto yy72;",
          "1053: yy57:",
          "1054:  yych = *++YYCURSOR;",
          "1055:  if (yych == '.') goto yy60;",
          "1056:  if (yych <= '/') goto yy18;",
          "1057:  if (yych >= ':') goto yy18;",
          "1058: yy58:",
          "1060:  if ((YYLIMIT - YYCURSOR) < 4) YYFILL(4);",
          "1061:  yych = *YYCURSOR;",
          "1062:  if (yych <= ':') {",
          "1063:   if (yych <= '.') {",
          "1064:    if (yych <= '-') goto yy18;",
          "1065:    goto yy70;",
          "1066:   } else {",
          "1067:    if (yych <= '/') goto yy18;",
          "1068:    if (yych <= '9') goto yy58;",
          "1069:    goto yy18;",
          "1070:   }",
          "1071:  } else {",
          "1072:   if (yych <= 'E') {",
          "1073:    if (yych <= ';') goto yy63;",
          "1074:    if (yych <= 'D') goto yy18;",
          "1075:    goto yy65;",
          "1076:   } else {",
          "1077:    if (yych == 'e') goto yy65;",
          "1078:    goto yy18;",
          "1079:   }",
          "1080:  }",
          "1081: yy60:",
          "1082:  yych = *++YYCURSOR;",
          "1083:  if (yych <= '/') goto yy18;",
          "1084:  if (yych >= ':') goto yy18;",
          "1085: yy61:",
          "1091:   if (yych <= '9') goto yy61;",
          "1096:    goto yy65;",
          "1098:    if (yych == 'e') goto yy65;",
          "1102: yy63:",
          "1104: #line 636 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "980:  ZVAL_DOUBLE(*rval, zend_strtod((const char *)start + 2, NULL));",
          "981:  return 1;",
          "982: }",
          "985:  yych = *++YYCURSOR;",
          "986:  if (yych <= ',') {",
          "989:  } else {",
          "991:   if (yych <= '/') goto yy18;",
          "993:   goto yy18;",
          "994:  }",
          "996:  yych = *++YYCURSOR;",
          "998:  goto yy18;",
          "1000:  yych = *++YYCURSOR;",
          "1002:  goto yy18;",
          "1004:  ++YYCURSOR;",
          "1022:   } else {",
          "1024:   }",
          "1025:  }",
          "1034:  yych = *++YYCURSOR;",
          "1038:  ++YYCURSOR;",
          "1040:  {",
          "1055:  }",
          "1060:  return 1;",
          "1061: }",
          "1064:  yych = *++YYCURSOR;",
          "1066:  goto yy18;",
          "1068:  ++YYCURSOR;",
          "1070:  {",
          "1116:  }",
          "1160:    }",
          "1183:   } else {",
          "1204:   }",
          "1218:  }",
          "1222: }",
          "1225:  ++YYCURSOR;",
          "1227:  {",
          "1257:  INIT_PZVAL(*rval);",
          "1259:  return 1;",
          "1260: }",
          "1263:  ++YYCURSOR;",
          "1265:  {",
          "1275:  INIT_PZVAL(*rval);",
          "1284: }",
          "1287:  yych = *++YYCURSOR;",
          "1288:  if (yych <= ',') {",
          "1291:  } else {",
          "1293:   if (yych <= '/') goto yy18;",
          "1295:  }",
          "1297:  ++YYCURSOR;",
          "1298:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "1299:  yych = *YYCURSOR;",
          "1300:  if (yych <= '/') goto yy18;",
          "1309:  ++YYCURSOR;",
          "1311:  {",
          "1335:   return 0;",
          "1336:  }",
          "1350:  }",
          "1357:  return 1;",
          "1358: }",
          "1360: yy96:",
          "1361:  yych = *++YYCURSOR;",
          "1362:  if (yych <= '/') goto yy18;",
          "1365: yy97:",
          "1366:  ++YYCURSOR;",
          "1368:  {",
          "1378:  }",
          "1380:  return 1;",
          "1381: }",
          "1383: }",
          "1387:  return 0;",
          "",
          "[Removed Lines]",
          "983: #line 984 \"ext/standard/var_unserializer.c\"",
          "984: yy73:",
          "987:   if (yych == '+') goto yy88;",
          "988:   goto yy18;",
          "990:   if (yych <= '-') goto yy88;",
          "992:   if (yych <= '9') goto yy89;",
          "995: yy74:",
          "997:  if (yych == 'F') goto yy91;",
          "999: yy75:",
          "1001:  if (yych == 'N') goto yy91;",
          "1003: yy76:",
          "1005: #line 595 \"ext/standard/var_unserializer.re\"",
          "1006:  {",
          "1007: #if SIZEOF_LONG == 4",
          "1008:  int digits = YYCURSOR - start - 3;",
          "1010:  if (start[2] == '-' || start[2] == '+') {",
          "1011:   digits--;",
          "1012:  }",
          "1015:  if (digits >= MAX_LENGTH_OF_LONG - 1) {",
          "1016:   if (digits == MAX_LENGTH_OF_LONG - 1) {",
          "1017:    int cmp = strncmp(YYCURSOR - MAX_LENGTH_OF_LONG, long_min_digits, MAX_LENGTH_OF_LONG - 1);",
          "1019:    if (!(cmp < 0 || (cmp == 0 && start[2] == '-'))) {",
          "1020:     goto use_double;",
          "1021:    }",
          "1023:    goto use_double;",
          "1026: #endif",
          "1028:  INIT_PZVAL(*rval);",
          "1029:  ZVAL_LONG(*rval, parse_iv(start + 2));",
          "1030:  return 1;",
          "1031: }",
          "1032: #line 1033 \"ext/standard/var_unserializer.c\"",
          "1033: yy78:",
          "1035:  if (yych == '\"') goto yy92;",
          "1036:  goto yy18;",
          "1037: yy79:",
          "1039: #line 558 \"ext/standard/var_unserializer.re\"",
          "1041:  long id;",
          "1044:  if (!var_hash) return 0;",
          "1046:  id = parse_iv(start + 2) - 1;",
          "1047:  if (id == -1 || var_access(var_hash, id, &rval_ref) != SUCCESS) {",
          "1048:   return 0;",
          "1049:  }",
          "1051:  if (*rval == *rval_ref) return 0;",
          "1053:  if (*rval != NULL) {",
          "1054:   var_push_dtor_no_addref(var_hash, rval);",
          "1057:  Z_ADDREF_PP(rval);",
          "1058:  Z_UNSET_ISREF_PP(rval);",
          "1062: #line 1063 \"ext/standard/var_unserializer.c\"",
          "1063: yy81:",
          "1065:  if (yych == '\"') goto yy94;",
          "1067: yy82:",
          "1069: #line 749 \"ext/standard/var_unserializer.re\"",
          "1071:  size_t len, len2, len3, maxlen;",
          "1072:  long elements;",
          "1073:  char *class_name;",
          "1074:  zend_class_entry *ce;",
          "1075:  zend_class_entry **pce;",
          "1076:  int incomplete_class = 0;",
          "1078:  int custom_object = 0;",
          "1080:  zval *user_func;",
          "1081:  zval *retval_ptr;",
          "1082:  zval **args[1];",
          "1083:  zval *arg_func_name;",
          "1085:     if (!var_hash) return 0;",
          "1086:  if (*start == 'C') {",
          "1087:   custom_object = 1;",
          "1088:  }",
          "1090:  INIT_PZVAL(*rval);",
          "1091:  len2 = len = parse_uiv(start + 2);",
          "1092:  maxlen = max - YYCURSOR;",
          "1093:  if (maxlen < len || len == 0) {",
          "1095:   return 0;",
          "1096:  }",
          "1098:  class_name = (char*)YYCURSOR;",
          "1100:  YYCURSOR += len;",
          "1102:  if (*(YYCURSOR) != '\"') {",
          "1104:   return 0;",
          "1105:  }",
          "1106:  if (*(YYCURSOR+1) != ':') {",
          "1108:   return 0;",
          "1109:  }",
          "1111:  len3 = strspn(class_name, \"0123456789_abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\\177\\200\\201\\202\\203\\204\\205\\206\\207\\210\\211\\212\\213\\214\\215\\216\\217\\220\\221\\222\\223\\224\\225\\226\\227\\230\\231\\232\\233\\234\\235\\236\\237\\240\\241\\242\\243\\244\\245\\246\\247\\250\\251\\252\\253\\254\\255\\256\\257\\260\\261\\262\\263\\264\\265\\266\\267\\270\\271\\272\\273\\274\\275\\276\\277\\300\\301\\302\\303\\304\\305\\306\\307\\310\\311\\312\\313\\314\\315\\316\\317\\320\\321\\322\\323\\324\\325\\326\\327\\330\\331\\332\\333\\334\\335\\336\\337\\340\\341\\342\\343\\344\\345\\346\\347\\350\\351\\352\\353\\354\\355\\356\\357\\360\\361\\362\\363\\364\\365\\366\\367\\370\\371\\372\\373\\374\\375\\376\\377\\\\\");",
          "1112:  if (len3 != len)",
          "1113:  {",
          "1115:   return 0;",
          "1118:  class_name = estrndup(class_name, len);",
          "1120:  do {",
          "1122:   BG(serialize_lock)++;",
          "1123:   if (zend_lookup_class(class_name, len2, &pce TSRMLS_CC) == SUCCESS) {",
          "1124:    BG(serialize_lock)--;",
          "1125:    if (EG(exception)) {",
          "1126:     efree(class_name);",
          "1127:     return 0;",
          "1128:    }",
          "1129:    ce = *pce;",
          "1130:    break;",
          "1131:   }",
          "1132:   BG(serialize_lock)--;",
          "1134:   if (EG(exception)) {",
          "1135:    efree(class_name);",
          "1136:    return 0;",
          "1137:   }",
          "1140:   if ((PG(unserialize_callback_func) == NULL) || (PG(unserialize_callback_func)[0] == '\\0')) {",
          "1141:    incomplete_class = 1;",
          "1142:    ce = PHP_IC_ENTRY;",
          "1143:    break;",
          "1144:   }",
          "1147:   MAKE_STD_ZVAL(user_func);",
          "1148:   ZVAL_STRING(user_func, PG(unserialize_callback_func), 1);",
          "1149:   args[0] = &arg_func_name;",
          "1150:   MAKE_STD_ZVAL(arg_func_name);",
          "1151:   ZVAL_STRING(arg_func_name, class_name, 1);",
          "1152:   BG(serialize_lock)++;",
          "1153:   if (call_user_function_ex(CG(function_table), NULL, user_func, &retval_ptr, 1, args, 0, NULL TSRMLS_CC) != SUCCESS) {",
          "1154:    BG(serialize_lock)--;",
          "1155:    if (EG(exception)) {",
          "1156:     efree(class_name);",
          "1157:     zval_ptr_dtor(&user_func);",
          "1158:     zval_ptr_dtor(&arg_func_name);",
          "1159:     return 0;",
          "1161:    php_error_docref(NULL TSRMLS_CC, E_WARNING, \"defined (%s) but not found\", user_func->value.str.val);",
          "1162:    incomplete_class = 1;",
          "1163:    ce = PHP_IC_ENTRY;",
          "1164:    zval_ptr_dtor(&user_func);",
          "1165:    zval_ptr_dtor(&arg_func_name);",
          "1166:    break;",
          "1167:   }",
          "1168:   BG(serialize_lock)--;",
          "1169:   if (retval_ptr) {",
          "1170:    zval_ptr_dtor(&retval_ptr);",
          "1171:   }",
          "1172:   if (EG(exception)) {",
          "1173:    efree(class_name);",
          "1174:    zval_ptr_dtor(&user_func);",
          "1175:    zval_ptr_dtor(&arg_func_name);",
          "1176:    return 0;",
          "1177:   }",
          "1180:   BG(serialize_lock)++;",
          "1181:   if (zend_lookup_class(class_name, len2, &pce TSRMLS_CC) == SUCCESS) {",
          "1182:    ce = *pce;",
          "1184:    php_error_docref(NULL TSRMLS_CC, E_WARNING, \"Function %s() hasn't defined the class it was called for\", user_func->value.str.val);",
          "1185:    incomplete_class = 1;",
          "1186:    ce = PHP_IC_ENTRY;",
          "1187:   }",
          "1188:   BG(serialize_lock)--;",
          "1190:   zval_ptr_dtor(&user_func);",
          "1191:   zval_ptr_dtor(&arg_func_name);",
          "1192:   break;",
          "1193:  } while (1);",
          "1197:  if (custom_object) {",
          "1198:   int ret;",
          "1200:   ret = object_custom(UNSERIALIZE_PASSTHRU, ce);",
          "1202:   if (ret && incomplete_class) {",
          "1203:    php_store_class_name(*rval, class_name, len2);",
          "1205:   efree(class_name);",
          "1206:   return ret;",
          "1207:  }",
          "1209:  elements = object_common1(UNSERIALIZE_PASSTHRU, ce);",
          "1211:  if (elements < 0) {",
          "1212:     efree(class_name);",
          "1213:     return 0;",
          "1214:  }",
          "1216:  if (incomplete_class) {",
          "1217:   php_store_class_name(*rval, class_name, len2);",
          "1219:  efree(class_name);",
          "1221:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "1223: #line 1224 \"ext/standard/var_unserializer.c\"",
          "1224: yy84:",
          "1226: #line 680 \"ext/standard/var_unserializer.re\"",
          "1228:  size_t len, maxlen;",
          "1229:  char *str;",
          "1231:  len = parse_uiv(start + 2);",
          "1232:  maxlen = max - YYCURSOR;",
          "1233:  if (maxlen < len) {",
          "1235:   return 0;",
          "1236:  }",
          "1238:  if ((str = unserialize_str(&YYCURSOR, &len, maxlen)) == NULL) {",
          "1239:   return 0;",
          "1240:  }",
          "1242:  if (*(YYCURSOR) != '\"') {",
          "1243:   efree(str);",
          "1245:   return 0;",
          "1246:  }",
          "1248:  if (*(YYCURSOR + 1) != ';') {",
          "1249:   efree(str);",
          "1251:   return 0;",
          "1252:  }",
          "1254:  YYCURSOR += 2;",
          "1258:  ZVAL_STRINGL(*rval, str, len, 0);",
          "1261: #line 1262 \"ext/standard/var_unserializer.c\"",
          "1262: yy86:",
          "1264: #line 715 \"ext/standard/var_unserializer.re\"",
          "1266:  long elements = parse_iv(start + 2);",
          "1269:     if (!var_hash) return 0;",
          "1271:  if (elements < 0) {",
          "1272:   return 0;",
          "1273:  }",
          "1277:  array_init_size(*rval, elements);",
          "1279:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_ARRVAL_PP(rval), elements, 0)) {",
          "1280:   return 0;",
          "1281:  }",
          "1283:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "1285: #line 1286 \"ext/standard/var_unserializer.c\"",
          "1286: yy88:",
          "1289:   if (yych == '+') goto yy96;",
          "1290:   goto yy18;",
          "1292:   if (yych <= '-') goto yy96;",
          "1294:   if (yych >= ':') goto yy18;",
          "1296: yy89:",
          "1301:  if (yych <= '9') goto yy89;",
          "1302:  if (yych == ';') goto yy71;",
          "1303:  goto yy18;",
          "1304: yy91:",
          "1305:  yych = *++YYCURSOR;",
          "1306:  if (yych == ';') goto yy97;",
          "1307:  goto yy18;",
          "1308: yy92:",
          "1310: #line 736 \"ext/standard/var_unserializer.re\"",
          "1312:  long elements;",
          "1313:     if (!var_hash) return 0;",
          "1315:  INIT_PZVAL(*rval);",
          "1317:  elements = object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR);",
          "1318:  if (elements < 0) {",
          "1319:   return 0;",
          "1320:  }",
          "1321:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "1322: }",
          "1323: #line 1324 \"ext/standard/var_unserializer.c\"",
          "1324: yy94:",
          "1325:  ++YYCURSOR;",
          "1326: #line 647 \"ext/standard/var_unserializer.re\"",
          "1327:  {",
          "1328:  size_t len, maxlen;",
          "1329:  char *str;",
          "1331:  len = parse_uiv(start + 2);",
          "1332:  maxlen = max - YYCURSOR;",
          "1333:  if (maxlen < len) {",
          "1338:  str = (char*)YYCURSOR;",
          "1340:  YYCURSOR += len;",
          "1342:  if (*(YYCURSOR) != '\"') {",
          "1344:   return 0;",
          "1345:  }",
          "1347:  if (*(YYCURSOR + 1) != ';') {",
          "1349:   return 0;",
          "1352:  YYCURSOR += 2;",
          "1355:  INIT_PZVAL(*rval);",
          "1356:  ZVAL_STRINGL(*rval, str, len, 1);",
          "1359: #line 1360 \"ext/standard/var_unserializer.c\"",
          "1363:  if (yych <= '9') goto yy89;",
          "1364:  goto yy18;",
          "1367: #line 622 \"ext/standard/var_unserializer.re\"",
          "1370:  INIT_PZVAL(*rval);",
          "1372:  if (!strncmp(start + 2, \"NAN\", 3)) {",
          "1373:   ZVAL_DOUBLE(*rval, php_get_nan());",
          "1374:  } else if (!strncmp(start + 2, \"INF\", 3)) {",
          "1375:   ZVAL_DOUBLE(*rval, php_get_inf());",
          "1376:  } else if (!strncmp(start + 2, \"-INF\", 4)) {",
          "1377:   ZVAL_DOUBLE(*rval, -php_get_inf());",
          "1382: #line 1383 \"ext/standard/var_unserializer.c\"",
          "1384: #line 911 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1114: #line 1115 \"ext/standard/var_unserializer.c\"",
          "1115: yy65:",
          "1118:   if (yych != '+') goto yy18;",
          "1120:   if (yych <= '-') goto yy66;",
          "1122:   if (yych <= '9') goto yy67;",
          "1125: yy66:",
          "1127:  if (yych <= ',') {",
          "1128:   if (yych == '+') goto yy69;",
          "1129:   goto yy18;",
          "1130:  } else {",
          "1131:   if (yych <= '-') goto yy69;",
          "1132:   if (yych <= '/') goto yy18;",
          "1133:   if (yych >= ':') goto yy18;",
          "1134:  }",
          "1135: yy67:",
          "1136:  ++YYCURSOR;",
          "1137:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "1138:  yych = *YYCURSOR;",
          "1139:  if (yych <= '/') goto yy18;",
          "1140:  if (yych <= '9') goto yy67;",
          "1141:  if (yych == ';') goto yy63;",
          "1143: yy69:",
          "1145:  if (yych <= '/') goto yy18;",
          "1146:  if (yych <= '9') goto yy67;",
          "1148: yy70:",
          "1150:  if ((YYLIMIT - YYCURSOR) < 4) YYFILL(4);",
          "1151:  yych = *YYCURSOR;",
          "1152:  if (yych <= ';') {",
          "1153:   if (yych <= '/') goto yy18;",
          "1154:   if (yych <= '9') goto yy70;",
          "1155:   if (yych <= ':') goto yy18;",
          "1156:   goto yy63;",
          "1157:  } else {",
          "1158:   if (yych <= 'E') {",
          "1159:    if (yych <= 'D') goto yy18;",
          "1160:    goto yy65;",
          "1162:    if (yych == 'e') goto yy65;",
          "1163:    goto yy18;",
          "1166: yy72:",
          "1168:  if (yych != 'F') goto yy18;",
          "1169: yy73:",
          "1170:  yych = *++YYCURSOR;",
          "1171:  if (yych != ';') goto yy18;",
          "1173: #line 621 \"ext/standard/var_unserializer.re\"",
          "1176:  INIT_PZVAL(*rval);",
          "1178:  if (!strncmp(start + 2, \"NAN\", 3)) {",
          "1179:   ZVAL_DOUBLE(*rval, php_get_nan());",
          "1180:  } else if (!strncmp(start + 2, \"INF\", 3)) {",
          "1181:   ZVAL_DOUBLE(*rval, php_get_inf());",
          "1182:  } else if (!strncmp(start + 2, \"-INF\", 4)) {",
          "1183:   ZVAL_DOUBLE(*rval, -php_get_inf());",
          "1188: #line 1189 \"ext/standard/var_unserializer.c\"",
          "1189: yy76:",
          "1191:  if (yych == 'N') goto yy73;",
          "1193: yy77:",
          "1194:  yych = *++YYCURSOR;",
          "1195:  if (yych <= ',') {",
          "1196:   if (yych != '+') goto yy18;",
          "1197:  } else {",
          "1198:   if (yych <= '-') goto yy78;",
          "1199:   if (yych <= '/') goto yy18;",
          "1200:   if (yych <= '9') goto yy79;",
          "1201:   goto yy18;",
          "1202:  }",
          "1203: yy78:",
          "1204:  yych = *++YYCURSOR;",
          "1205:  if (yych <= '/') goto yy18;",
          "1206:  if (yych >= ':') goto yy18;",
          "1207: yy79:",
          "1209:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "1210:  yych = *YYCURSOR;",
          "1211:  if (yych <= '/') goto yy18;",
          "1212:  if (yych <= '9') goto yy79;",
          "1213:  if (yych != ';') goto yy18;",
          "1214:  ++YYCURSOR;",
          "1215: #line 594 \"ext/standard/var_unserializer.re\"",
          "1217: #if SIZEOF_LONG == 4",
          "1218:  int digits = YYCURSOR - start - 3;",
          "1220:  if (start[2] == '-' || start[2] == '+') {",
          "1221:   digits--;",
          "1225:  if (digits >= MAX_LENGTH_OF_LONG - 1) {",
          "1226:   if (digits == MAX_LENGTH_OF_LONG - 1) {",
          "1227:    int cmp = strncmp(YYCURSOR - MAX_LENGTH_OF_LONG, long_min_digits, MAX_LENGTH_OF_LONG - 1);",
          "1229:    if (!(cmp < 0 || (cmp == 0 && start[2] == '-'))) {",
          "1230:     goto use_double;",
          "1233:    goto use_double;",
          "1236: #endif",
          "1238:  INIT_PZVAL(*rval);",
          "1239:  ZVAL_LONG(*rval, parse_iv(start + 2));",
          "1240:  return 1;",
          "1242: #line 1243 \"ext/standard/var_unserializer.c\"",
          "1243: yy83:",
          "1244:  yych = *++YYCURSOR;",
          "1245:  if (yych <= '/') goto yy18;",
          "1246:  if (yych >= '2') goto yy18;",
          "1247:  yych = *++YYCURSOR;",
          "1248:  if (yych != ';') goto yy18;",
          "1250: #line 587 \"ext/standard/var_unserializer.re\"",
          "1254:  ZVAL_BOOL(*rval, parse_iv(start + 2));",
          "1257: #line 1258 \"ext/standard/var_unserializer.c\"",
          "1258: yy87:",
          "1260: #line 580 \"ext/standard/var_unserializer.re\"",
          "1264:  ZVAL_NULL(*rval);",
          "1265:  return 1;",
          "1267: #line 1268 \"ext/standard/var_unserializer.c\"",
          "1268: yy89:",
          "1271:   if (yych != '+') goto yy18;",
          "1273:   if (yych <= '-') goto yy90;",
          "1275:   if (yych <= '9') goto yy91;",
          "1276:   goto yy18;",
          "1278: yy90:",
          "1279:  yych = *++YYCURSOR;",
          "1280:  if (yych <= '/') goto yy18;",
          "1281:  if (yych >= ':') goto yy18;",
          "1282: yy91:",
          "1287:  if (yych <= '9') goto yy91;",
          "1288:  if (yych != ';') goto yy18;",
          "1290: #line 557 \"ext/standard/var_unserializer.re\"",
          "1292:  long id;",
          "1295:  if (!var_hash) return 0;",
          "1297:  id = parse_iv(start + 2) - 1;",
          "1298:  if (id == -1 || var_access(var_hash, id, &rval_ref) != SUCCESS) {",
          "1302:  if (*rval == *rval_ref) return 0;",
          "1304:  if (*rval != NULL) {",
          "1305:   var_push_dtor_no_addref(var_hash, rval);",
          "1308:  Z_ADDREF_PP(rval);",
          "1309:  Z_UNSET_ISREF_PP(rval);",
          "1313: #line 1314 \"ext/standard/var_unserializer.c\"",
          "1314: yy95:",
          "1315:  yych = *++YYCURSOR;",
          "1316:  if (yych <= ',') {",
          "1317:   if (yych != '+') goto yy18;",
          "1318:  } else {",
          "1319:   if (yych <= '-') goto yy96;",
          "1320:   if (yych <= '/') goto yy18;",
          "1321:   if (yych <= '9') goto yy97;",
          "1322:   goto yy18;",
          "1323:  }",
          "1327:  if (yych >= ':') goto yy18;",
          "1330:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "1331:  yych = *YYCURSOR;",
          "1332:  if (yych <= '/') goto yy18;",
          "1333:  if (yych <= '9') goto yy97;",
          "1334:  if (yych != ';') goto yy18;",
          "1335:  ++YYCURSOR;",
          "1336: #line 536 \"ext/standard/var_unserializer.re\"",
          "1338:  long id;",
          "1341:  if (!var_hash) return 0;",
          "1343:  id = parse_iv(start + 2) - 1;",
          "1344:  if (id == -1 || var_access(var_hash, id, &rval_ref) != SUCCESS) {",
          "1345:   return 0;",
          "1346:  }",
          "1348:  if (*rval != NULL) {",
          "1349:   var_push_dtor_no_addref(var_hash, rval);",
          "1352:  Z_ADDREF_PP(rval);",
          "1353:  Z_SET_ISREF_PP(rval);",
          "1357: #line 1358 \"ext/standard/var_unserializer.c\"",
          "1359: #line 910 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "411: static inline int finish_nested_data(UNSERIALIZE_PARAMETER)",
          "412: {",
          "420: }",
          "422: static inline int object_custom(UNSERIALIZE_PARAMETER, zend_class_entry *ce)",
          "",
          "[Removed Lines]",
          "413:  if (*((*p)++) == '}')",
          "414:   return 1;",
          "416: #if SOMETHING_NEW_MIGHT_LEAD_TO_CRASH_ENABLE_IF_YOU_ARE_BRAVE",
          "417:  zval_ptr_dtor(rval);",
          "418: #endif",
          "419:  return 0;",
          "",
          "[Added Lines]",
          "413:  if (*p >= max || **p != '}') {",
          "414:   return 0;",
          "415:  }",
          "417:  (*p)++;",
          "418:  return 1;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "6a6cdecbdbe0846451eaee38f7bc55a81c651d80",
      "candidate_info": {
        "commit_hash": "6a6cdecbdbe0846451eaee38f7bc55a81c651d80",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/6a6cdecbdbe0846451eaee38f7bc55a81c651d80",
        "files": [
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Improved unserialize()",
        "before_after_code_files": [
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "322: #define UNSERIALIZE_PARAMETER zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash, HashTable *classes",
          "323: #define UNSERIALIZE_PASSTHRU rval, p, max, var_hash, classes",
          "326: {",
          "327:  while (elements-- > 0) {",
          "328:   zval key, *data, d, *old_data;",
          "330:   ZVAL_UNDEF(&key);",
          "",
          "[Removed Lines]",
          "325: static inline int process_nested_data(UNSERIALIZE_PARAMETER, HashTable *ht, zend_long elements, int objprops)",
          "",
          "[Added Lines]",
          "325: static zend_always_inline int process_nested_data(UNSERIALIZE_PARAMETER, HashTable *ht, zend_long elements, int objprops)",
          "329:   zend_ulong idx;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "334:    return 0;",
          "335:   }",
          "342:   data = NULL;",
          "343:   ZVAL_UNDEF(&d);",
          "345:   if (!objprops) {",
          "350:      var_push_dtor(var_hash, old_data);",
          "351:     }",
          "357:      var_push_dtor(var_hash, old_data);",
          "358:     }",
          "361:    }",
          "362:   } else {",
          "368:     }",
          "372:   }",
          "374:   zval_dtor(&key);",
          "",
          "[Removed Lines]",
          "337:   if (Z_TYPE(key) != IS_LONG && Z_TYPE(key) != IS_STRING) {",
          "338:    zval_dtor(&key);",
          "339:    return 0;",
          "340:   }",
          "346:    switch (Z_TYPE(key)) {",
          "347:    case IS_LONG:",
          "348:     if ((old_data = zend_hash_index_find(ht, Z_LVAL(key))) != NULL) {",
          "352:     data = zend_hash_index_update(ht, Z_LVAL(key), &d);",
          "353:     break;",
          "354:    case IS_STRING:",
          "355:     if ((old_data = zend_symtable_find(ht, Z_STR(key))) != NULL) {",
          "359:     data = zend_symtable_update(ht, Z_STR(key), &d);",
          "360:     break;",
          "364:    convert_to_string(&key);",
          "365:    if ((old_data = zend_hash_find(ht, Z_STR(key))) != NULL) {",
          "366:     if (Z_TYPE_P(old_data) == IS_INDIRECT) {",
          "367:      old_data = Z_INDIRECT_P(old_data);",
          "369:     var_push_dtor(var_hash, old_data);",
          "370:    }",
          "371:    data = zend_hash_update_ind(ht, Z_STR(key), &d);",
          "",
          "[Added Lines]",
          "342:    if (Z_TYPE(key) == IS_LONG) {",
          "343:     idx = Z_LVAL(key);",
          "344: numeric_key:",
          "345:     if (UNEXPECTED((old_data = zend_hash_index_find(ht, idx)) != NULL)) {",
          "348:      data = zend_hash_index_update(ht, idx, &d);",
          "349:     } else {",
          "350:      data = zend_hash_index_add_new(ht, idx, &d);",
          "351:     }",
          "352:    } else if (Z_TYPE(key) == IS_STRING) {",
          "353:     if (UNEXPECTED(ZEND_HANDLE_NUMERIC(Z_STR(key), idx))) {",
          "354:      goto numeric_key;",
          "356:     if (UNEXPECTED((old_data = zend_hash_find(ht, Z_STR(key))) != NULL)) {",
          "359:      data = zend_hash_update(ht, Z_STR(key), &d);",
          "360:     } else {",
          "361:      data = zend_hash_add_new(ht, Z_STR(key), &d);",
          "363:    } else {",
          "364:     zval_dtor(&key);",
          "365:     return 0;",
          "368:    if (EXPECTED(Z_TYPE(key) == IS_STRING)) {",
          "369: string_key:",
          "370:     if ((old_data = zend_hash_find(ht, Z_STR(key))) != NULL) {",
          "371:      if (Z_TYPE_P(old_data) == IS_INDIRECT) {",
          "372:       old_data = Z_INDIRECT_P(old_data);",
          "373:      }",
          "374:      var_push_dtor(var_hash, old_data);",
          "375:      data = zend_hash_update_ind(ht, Z_STR(key), &d);",
          "376:     } else {",
          "377:      data = zend_hash_add_new(ht, Z_STR(key), &d);",
          "379:    } else if (Z_TYPE(key) == IS_LONG) {",
          "381:     convert_to_string(&key);",
          "382:     goto string_key;",
          "383:    } else {",
          "384:     zval_dtor(&key);",
          "385:     return 0;",
          "386:    }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "507:  start = cursor;",
          "511: {",
          "512:  YYCTYPE yych;",
          "513:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "510: #line 511 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "525: #line 526 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "567:  yych = *(YYMARKER = ++YYCURSOR);",
          "568:  if (yych == ':') goto yy95;",
          "569: yy3:",
          "571:  { return 0; }",
          "573: yy4:",
          "574:  yych = *(YYMARKER = ++YYCURSOR);",
          "575:  if (yych == ':') goto yy89;",
          "",
          "[Removed Lines]",
          "570: #line 858 \"ext/standard/var_unserializer.re\"",
          "572: #line 573 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "585: #line 873 \"ext/standard/var_unserializer.re\"",
          "587: #line 588 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "612:  goto yy3;",
          "613: yy14:",
          "614:  ++YYCURSOR;",
          "616:  {",
          "618:  php_error_docref(NULL, E_NOTICE, \"Unexpected end of serialized data\");",
          "620: }",
          "622: yy16:",
          "623:  yych = *++YYCURSOR;",
          "624:  goto yy3;",
          "",
          "[Removed Lines]",
          "615: #line 852 \"ext/standard/var_unserializer.re\"",
          "621: #line 622 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "630: #line 867 \"ext/standard/var_unserializer.re\"",
          "636: #line 637 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "644:  if (yybm[0+yych] & 128) {",
          "645:   goto yy20;",
          "646:  }",
          "649:  yych = *++YYCURSOR;",
          "650:  if (yych != '\"') goto yy18;",
          "651:  ++YYCURSOR;",
          "653:  {",
          "654:  size_t len, len2, len3, maxlen;",
          "655:  zend_long elements;",
          "",
          "[Removed Lines]",
          "647:  if (yych <= '/') goto yy18;",
          "648:  if (yych >= ';') goto yy18;",
          "652: #line 707 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "662:  if (yych != ':') goto yy18;",
          "666: #line 722 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "795:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "796: }",
          "798: yy25:",
          "799:  yych = *++YYCURSOR;",
          "800:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "797: #line 798 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "811: #line 812 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "819:  yych = *++YYCURSOR;",
          "820:  if (yych != '\"') goto yy18;",
          "821:  ++YYCURSOR;",
          "823:  {",
          "",
          "[Removed Lines]",
          "822: #line 699 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "836: #line 714 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "827:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "828:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "829: }",
          "831: yy32:",
          "832:  yych = *++YYCURSOR;",
          "833:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "830: #line 831 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "844: #line 845 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "848:  yych = *++YYCURSOR;",
          "849:  if (yych != '{') goto yy18;",
          "850:  ++YYCURSOR;",
          "852:  {",
          "853:  zend_long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "851: #line 678 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "865: #line 693 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "870:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "871: }",
          "873: yy39:",
          "874:  yych = *++YYCURSOR;",
          "875:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "872: #line 873 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "886: #line 887 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "890:  yych = *++YYCURSOR;",
          "891:  if (yych != '\"') goto yy18;",
          "892:  ++YYCURSOR;",
          "894:  {",
          "895:  size_t len, maxlen;",
          "896:  zend_string *str;",
          "",
          "[Removed Lines]",
          "893: #line 650 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "907: #line 665 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "918:  ZVAL_STR(rval, str);",
          "919:  return 1;",
          "920: }",
          "922: yy46:",
          "923:  yych = *++YYCURSOR;",
          "924:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "921: #line 922 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "935: #line 936 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "939:  yych = *++YYCURSOR;",
          "940:  if (yych != '\"') goto yy18;",
          "941:  ++YYCURSOR;",
          "943:  {",
          "944:  size_t len, maxlen;",
          "945:  char *str;",
          "",
          "[Removed Lines]",
          "942: #line 623 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "956: #line 638 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "966:  ZVAL_STRINGL(rval, str, len);",
          "967:  return 1;",
          "968: }",
          "970: yy53:",
          "971:  yych = *++YYCURSOR;",
          "972:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "969: #line 970 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "983: #line 984 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1054:  }",
          "1055: yy63:",
          "1056:  ++YYCURSOR;",
          "1058:  {",
          "1059: #if SIZEOF_ZEND_LONG == 4",
          "1060: use_double:",
          "",
          "[Removed Lines]",
          "1057: #line 614 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1071: #line 629 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1063:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1064:  return 1;",
          "1065: }",
          "1067: yy65:",
          "1068:  yych = *++YYCURSOR;",
          "1069:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1066: #line 1067 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1080: #line 1081 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "1122:  yych = *++YYCURSOR;",
          "1123:  if (yych != ';') goto yy18;",
          "1124:  ++YYCURSOR;",
          "1126:  {",
          "",
          "[Removed Lines]",
          "1125: #line 598 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1139: #line 613 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1139:  return 1;",
          "1140: }",
          "1142: yy76:",
          "1143:  yych = *++YYCURSOR;",
          "1144:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1141: #line 1142 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1155: #line 1156 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1165:  if (yych <= '9') goto yy79;",
          "1166:  if (yych != ';') goto yy18;",
          "1167:  ++YYCURSOR;",
          "1169:  {",
          "1170: #if SIZEOF_ZEND_LONG == 4",
          "1171:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1168: #line 572 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1182: #line 587 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "1191:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1192:  return 1;",
          "1193: }",
          "1195: yy83:",
          "1196:  yych = *++YYCURSOR;",
          "1197:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1194: #line 1195 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1208: #line 1209 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "1199:  yych = *++YYCURSOR;",
          "1200:  if (yych != ';') goto yy18;",
          "1201:  ++YYCURSOR;",
          "1203:  {",
          "1205:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1206:  return 1;",
          "1207: }",
          "1209: yy87:",
          "1210:  ++YYCURSOR;",
          "1212:  {",
          "1214:  ZVAL_NULL(rval);",
          "1215:  return 1;",
          "1216: }",
          "1218: yy89:",
          "1219:  yych = *++YYCURSOR;",
          "1220:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1202: #line 566 \"ext/standard/var_unserializer.re\"",
          "1208: #line 1209 \"ext/standard/var_unserializer.c\"",
          "1211: #line 560 \"ext/standard/var_unserializer.re\"",
          "1217: #line 1218 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1216: #line 581 \"ext/standard/var_unserializer.re\"",
          "1222: #line 1223 \"ext/standard/var_unserializer.c\"",
          "1225: #line 575 \"ext/standard/var_unserializer.re\"",
          "1231: #line 1232 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "1237:  if (yych <= '9') goto yy91;",
          "1238:  if (yych != ';') goto yy18;",
          "1239:  ++YYCURSOR;",
          "1241:  {",
          "1242:  zend_long id;",
          "",
          "[Removed Lines]",
          "1240: #line 537 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1254: #line 552 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "1261:  return 1;",
          "1262: }",
          "1264: yy95:",
          "1265:  yych = *++YYCURSOR;",
          "1266:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1263: #line 1264 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1277: #line 1278 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 25 ---",
          "[Context before]",
          "1283:  if (yych <= '9') goto yy97;",
          "1284:  if (yych != ';') goto yy18;",
          "1285:  ++YYCURSOR;",
          "1287:  {",
          "1288:  zend_long id;",
          "",
          "[Removed Lines]",
          "1286: #line 515 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1300: #line 530 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 26 ---",
          "[Context before]",
          "1306:  return 1;",
          "1307: }",
          "1309: }",
          "1313:  return 0;",
          "",
          "[Removed Lines]",
          "1308: #line 1309 \"ext/standard/var_unserializer.c\"",
          "1310: #line 860 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1322: #line 1323 \"ext/standard/var_unserializer.c\"",
          "1324: #line 875 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "326: #define UNSERIALIZE_PARAMETER zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash, HashTable *classes",
          "327: #define UNSERIALIZE_PASSTHRU rval, p, max, var_hash, classes",
          "330: {",
          "331:  while (elements-- > 0) {",
          "332:   zval key, *data, d, *old_data;",
          "334:   ZVAL_UNDEF(&key);",
          "",
          "[Removed Lines]",
          "329: static inline int process_nested_data(UNSERIALIZE_PARAMETER, HashTable *ht, zend_long elements, int objprops)",
          "",
          "[Added Lines]",
          "329: static zend_always_inline int process_nested_data(UNSERIALIZE_PARAMETER, HashTable *ht, zend_long elements, int objprops)",
          "333:   zend_ulong idx;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "338:    return 0;",
          "339:   }",
          "346:   data = NULL;",
          "347:   ZVAL_UNDEF(&d);",
          "349:   if (!objprops) {",
          "354:      var_push_dtor(var_hash, old_data);",
          "355:     }",
          "361:      var_push_dtor(var_hash, old_data);",
          "362:     }",
          "365:    }",
          "366:   } else {",
          "372:     }",
          "376:   }",
          "378:   zval_dtor(&key);",
          "",
          "[Removed Lines]",
          "341:   if (Z_TYPE(key) != IS_LONG && Z_TYPE(key) != IS_STRING) {",
          "342:    zval_dtor(&key);",
          "343:    return 0;",
          "344:   }",
          "350:    switch (Z_TYPE(key)) {",
          "351:    case IS_LONG:",
          "352:     if ((old_data = zend_hash_index_find(ht, Z_LVAL(key))) != NULL) {",
          "356:     data = zend_hash_index_update(ht, Z_LVAL(key), &d);",
          "357:     break;",
          "358:    case IS_STRING:",
          "359:     if ((old_data = zend_symtable_find(ht, Z_STR(key))) != NULL) {",
          "363:     data = zend_symtable_update(ht, Z_STR(key), &d);",
          "364:     break;",
          "368:    convert_to_string(&key);",
          "369:    if ((old_data = zend_hash_find(ht, Z_STR(key))) != NULL) {",
          "370:     if (Z_TYPE_P(old_data) == IS_INDIRECT) {",
          "371:      old_data = Z_INDIRECT_P(old_data);",
          "373:     var_push_dtor(var_hash, old_data);",
          "374:    }",
          "375:    data = zend_hash_update_ind(ht, Z_STR(key), &d);",
          "",
          "[Added Lines]",
          "346:    if (Z_TYPE(key) == IS_LONG) {",
          "347:     idx = Z_LVAL(key);",
          "348: numeric_key:",
          "349:     if (UNEXPECTED((old_data = zend_hash_index_find(ht, idx)) != NULL)) {",
          "352:      data = zend_hash_index_update(ht, idx, &d);",
          "353:     } else {",
          "354:      data = zend_hash_index_add_new(ht, idx, &d);",
          "356:    } else if (Z_TYPE(key) == IS_STRING) {",
          "357:     if (UNEXPECTED(ZEND_HANDLE_NUMERIC(Z_STR(key), idx))) {",
          "358:      goto numeric_key;",
          "359:     }",
          "360:     if (UNEXPECTED((old_data = zend_hash_find(ht, Z_STR(key))) != NULL)) {",
          "363:      data = zend_hash_update(ht, Z_STR(key), &d);",
          "364:     } else {",
          "365:      data = zend_hash_add_new(ht, Z_STR(key), &d);",
          "367:    } else {",
          "368:     zval_dtor(&key);",
          "369:     return 0;",
          "372:    if (EXPECTED(Z_TYPE(key) == IS_STRING)) {",
          "373: string_key:",
          "374:     if ((old_data = zend_hash_find(ht, Z_STR(key))) != NULL) {",
          "375:      if (Z_TYPE_P(old_data) == IS_INDIRECT) {",
          "376:       old_data = Z_INDIRECT_P(old_data);",
          "377:      }",
          "378:      var_push_dtor(var_hash, old_data);",
          "379:      data = zend_hash_update_ind(ht, Z_STR(key), &d);",
          "380:     } else {",
          "381:      data = zend_hash_add_new(ht, Z_STR(key), &d);",
          "383:    } else if (Z_TYPE(key) == IS_LONG) {",
          "385:     convert_to_string(&key);",
          "386:     goto string_key;",
          "387:    } else {",
          "388:     zval_dtor(&key);",
          "389:     return 0;",
          "390:    }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "a08723d3d313445191470c19e12235a56165600a",
      "candidate_info": {
        "commit_hash": "a08723d3d313445191470c19e12235a56165600a",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/a08723d3d313445191470c19e12235a56165600a",
        "files": [
          "Zend/zend_operators.c",
          "ext/mysqlnd/mysqlnd_wireprotocol.c",
          "ext/standard/array.c",
          "ext/standard/basic_functions.c",
          "ext/standard/string.c",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re",
          "main/php_variables.c"
        ],
        "message": "Use interned empty and \"one char\" strings.",
        "before_after_code_files": [
          "Zend/zend_operators.c||Zend/zend_operators.c",
          "ext/mysqlnd/mysqlnd_wireprotocol.c||ext/mysqlnd/mysqlnd_wireprotocol.c",
          "ext/standard/array.c||ext/standard/array.c",
          "ext/standard/basic_functions.c||ext/standard/basic_functions.c",
          "ext/standard/string.c||ext/standard/string.c",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re",
          "main/php_variables.c||main/php_variables.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "Zend/zend_operators.c||Zend/zend_operators.c": [
          "File: Zend/zend_operators.c -> Zend/zend_operators.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "537:    break;",
          "538:   }",
          "539:   case IS_LONG: {",
          "541:    break;",
          "542:   }",
          "543:   case IS_DOUBLE: {",
          "",
          "[Removed Lines]",
          "540:    ZVAL_NEW_STR(op, zend_long_to_str(Z_LVAL_P(op)));",
          "",
          "[Added Lines]",
          "540:    ZVAL_STR(op, zend_long_to_str(Z_LVAL_P(op)));",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2858: {",
          "2862: }",
          "",
          "[Removed Lines]",
          "2859:  char buf[MAX_LENGTH_OF_LONG + 1];",
          "2860:  char *res = zend_print_long_to_buf(buf + sizeof(buf) - 1, num);",
          "2861:  return zend_string_init(res, buf + sizeof(buf) - 1 - res, 0);",
          "",
          "[Added Lines]",
          "2859:  if ((zend_ulong)num <= 9) {",
          "2860:   return ZSTR_CHAR((zend_uchar)'0' + (zend_uchar)num);",
          "2861:  } else {",
          "2862:   char buf[MAX_LENGTH_OF_LONG + 1];",
          "2863:   char *res = zend_print_long_to_buf(buf + sizeof(buf) - 1, num);",
          "2864:   return zend_string_init(res, buf + sizeof(buf) - 1 - res, 0);",
          "2865:  }",
          "",
          "---------------"
        ],
        "ext/mysqlnd/mysqlnd_wireprotocol.c||ext/mysqlnd/mysqlnd_wireprotocol.c": [
          "File: ext/mysqlnd/mysqlnd_wireprotocol.c -> ext/mysqlnd/mysqlnd_wireprotocol.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1766:     } else if (Z_TYPE_P(current_field) == IS_STRING) {",
          "1768:     }",
          "1769:    } else {",
          "1770:     ZVAL_STRINGL(current_field, (char *)p, len);",
          "1771:    }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1769:    } else if (len == 0) {",
          "1770:     ZVAL_EMPTY_STRING(current_field);",
          "1771:    } else if (len == 1) {",
          "1772:     ZVAL_INTERNED_STR(current_field, ZSTR_CHAR((zend_uchar)*(char *)p));",
          "",
          "---------------"
        ],
        "ext/standard/array.c||ext/standard/array.c": [
          "File: ext/standard/array.c -> ext/standard/array.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "3807:   Z_PARAM_VARIADIC('+', args, argc)",
          "3808:  ZEND_PARSE_PARAMETERS_END();",
          "3820:  if (replace) {",
          "3821:   HashTable *dest;",
          "3824:   arg = args;",
          "3825:   dest = zend_array_dup(Z_ARRVAL_P(arg));",
          "",
          "[Removed Lines]",
          "3810:  for (i = 0; i < argc; i++) {",
          "3811:   zval *arg = args + i;",
          "3813:   if (Z_TYPE_P(arg) != IS_ARRAY) {",
          "3814:    php_error_docref(NULL, E_WARNING, \"Argument #%d is not an array\", i + 1);",
          "3815:    RETURN_NULL();",
          "3816:   }",
          "3817:  }",
          "",
          "[Added Lines]",
          "3814:   for (i = 0; i < argc; i++) {",
          "3815:    zval *arg = args + i;",
          "3817:    if (Z_TYPE_P(arg) != IS_ARRAY) {",
          "3818:     php_error_docref(NULL, E_WARNING, \"Argument #%d is not an array\", i + 1);",
          "3819:     RETURN_NULL();",
          "3820:    }",
          "3821:   }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "3838:  } else {",
          "3839:   zval *src_entry;",
          "3840:   HashTable *src, *dest;",
          "3842:   arg = args;",
          "3843:   src  = Z_ARRVAL_P(arg);",
          "3846:   dest = Z_ARRVAL_P(return_value);",
          "3847:   if (src->u.flags & HASH_FLAG_PACKED) {",
          "3848:    zend_hash_real_init(dest, 1);",
          "",
          "[Removed Lines]",
          "3845:   array_init_size(return_value, zend_hash_num_elements(src));",
          "",
          "[Added Lines]",
          "3841:   uint32_t count = 0;",
          "3843:   for (i = 0; i < argc; i++) {",
          "3844:    zval *arg = args + i;",
          "3846:    if (Z_TYPE_P(arg) != IS_ARRAY) {",
          "3847:     php_error_docref(NULL, E_WARNING, \"Argument #%d is not an array\", i + 1);",
          "3848:     RETURN_NULL();",
          "3849:    }",
          "3850:    count += zend_hash_num_elements(Z_ARRVAL_P(arg));",
          "3851:   }",
          "3856:   array_init_size(return_value, count);",
          "",
          "---------------"
        ],
        "ext/standard/basic_functions.c||ext/standard/basic_functions.c": [
          "File: ext/standard/basic_functions.c -> ext/standard/basic_functions.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "5320: PHP_FUNCTION(ini_get)",
          "5321: {",
          "5322:  char *varname, *str;",
          "5325:  ZEND_PARSE_PARAMETERS_START(1, 1)",
          "5326:   Z_PARAM_STRING(varname, varname_len)",
          "",
          "[Removed Lines]",
          "5323:  size_t varname_len;",
          "",
          "[Added Lines]",
          "5323:  size_t varname_len, len;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "5332:   RETURN_FALSE;",
          "5333:  }",
          "5336: }",
          "",
          "[Removed Lines]",
          "5335:  RETURN_STRING(str);",
          "",
          "[Added Lines]",
          "5335:  len = strlen(str);",
          "5336:  if (len == 0) {",
          "5337:   RETURN_EMPTY_STRING();",
          "5338:  } else if (len == 1) {",
          "5339:   RETURN_INTERNED_STR(ZSTR_CHAR((zend_uchar)str[0]));",
          "5340:  }",
          "5341:  RETURN_STRINGL(str, len);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "5445:  if (old_value) {",
          "5447:  } else {",
          "5448:   RETVAL_FALSE;",
          "5449:  }",
          "",
          "[Removed Lines]",
          "5446:   RETVAL_STRING(old_value);",
          "",
          "[Added Lines]",
          "5452:   size_t len = strlen(old_value);",
          "5454:   if (len == 0) {",
          "5455:    RETVAL_EMPTY_STRING();",
          "5456:   } else if (len == 1) {",
          "5457:    RETVAL_INTERNED_STR(ZSTR_CHAR((zend_uchar)old_value[0]));",
          "5458:   } else {",
          "5459:    RETVAL_STRINGL(old_value, len);",
          "5460:   }",
          "",
          "---------------"
        ],
        "ext/standard/string.c||ext/standard/string.c": [
          "File: ext/standard/string.c -> ext/standard/string.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1094:   zend_hash_next_index_insert_new(Z_ARRVAL_P(return_value), &tmp);",
          "1095:  } else {",
          "1096:   do {",
          "1098:    zend_hash_next_index_insert_new(Z_ARRVAL_P(return_value), &tmp);",
          "1099:    p1 = p2 + ZSTR_LEN(delim);",
          "1100:    p2 = (char *) php_memnstr(p1, ZSTR_VAL(delim), ZSTR_LEN(delim), endp);",
          "",
          "[Removed Lines]",
          "1097:    ZVAL_STRINGL(&tmp, p1, p2 - p1);",
          "",
          "[Added Lines]",
          "1097:    size_t l = p2 - p1;",
          "1099:    if (l == 0) {",
          "1100:     ZVAL_EMPTY_STRING(&tmp);",
          "1101:    } else if (l == 1) {",
          "1102:     ZVAL_INTERNED_STR(&tmp, ZSTR_CHAR((zend_uchar)(*p1)));",
          "1103:    } else {",
          "1104:     ZVAL_STRINGL(&tmp, p1, p2 - p1);",
          "1105:    }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2420:   l = ZSTR_LEN(str) - f;",
          "2421:  }",
          "2423:  RETURN_STRINGL(ZSTR_VAL(str) + f, l);",
          "2424: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2431:  if (l == 0) {",
          "2432:   RETURN_EMPTY_STRING();",
          "2433:  } else if (l == 1) {",
          "2434:   RETURN_INTERNED_STR(ZSTR_CHAR((zend_uchar)(ZSTR_VAL(str)[f])));",
          "2435:  } else if (l == ZSTR_LEN(str)) {",
          "2436:   RETURN_STR_COPY(str);",
          "2437:  }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "3227: nothing_todo:",
          "3228:   return zend_string_copy(haystack);",
          "3229:  } else {",
          "3231:   (*replace_count)++;",
          "3232:   return new_str;",
          "3233:  }",
          "",
          "[Removed Lines]",
          "3230:   new_str = zend_string_init(str, str_len, 0);",
          "",
          "[Added Lines]",
          "3246:   if (str_len == 0) {",
          "3247:    new_str = ZSTR_EMPTY_ALLOC();",
          "3248:   } else if (str_len == 1) {",
          "3249:    new_str = ZSTR_CHAR((zend_uchar)(*str));",
          "3250:   } else {",
          "3251:    new_str = zend_string_init(str, str_len, 0);",
          "3252:   }",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "651:     0,   0,   0,   0,   0,   0,   0,   0,",
          "652:     0,   0,   0,   0,   0,   0,   0,   0,",
          "653:  };",
          "654:  if ((YYLIMIT - YYCURSOR) < 7) YYFILL(7);",
          "655:  yych = *YYCURSOR;",
          "656:  switch (yych) {",
          "657:  case 'C':",
          "659:  case 'N': goto yy5;",
          "666:  case 'o': goto yy12;",
          "671:  }",
          "672: yy2:",
          "674: yy3:",
          "676:  { return 0; }",
          "678: yy4:",
          "679:  yych = *(YYMARKER = ++YYCURSOR);",
          "681:  goto yy3;",
          "682: yy5:",
          "683:  yych = *++YYCURSOR;",
          "685:  goto yy3;",
          "686: yy6:",
          "687:  yych = *(YYMARKER = ++YYCURSOR);",
          "689:  goto yy3;",
          "690: yy7:",
          "691:  yych = *(YYMARKER = ++YYCURSOR);",
          "693:  goto yy3;",
          "694: yy8:",
          "695:  yych = *(YYMARKER = ++YYCURSOR);",
          "697:  goto yy3;",
          "698: yy9:",
          "699:  yych = *(YYMARKER = ++YYCURSOR);",
          "701:  goto yy3;",
          "702: yy10:",
          "703:  yych = *(YYMARKER = ++YYCURSOR);",
          "705:  goto yy3;",
          "706: yy11:",
          "707:  yych = *(YYMARKER = ++YYCURSOR);",
          "709:  goto yy3;",
          "710: yy12:",
          "711:  yych = *(YYMARKER = ++YYCURSOR);",
          "713:  goto yy3;",
          "714: yy13:",
          "715:  yych = *(YYMARKER = ++YYCURSOR);",
          "717:  goto yy3;",
          "718: yy14:",
          "723:  ++YYCURSOR;",
          "725:  {",
          "727:  php_error_docref(NULL, E_NOTICE, \"Unexpected end of serialized data\");",
          "729: }",
          "731: yy17:",
          "732:  yych = *++YYCURSOR;",
          "733:  if (yybm[0+yych] & 128) {",
          "735:  }",
          "736: yy18:",
          "737:  YYCURSOR = YYMARKER;",
          "738:  goto yy3;",
          "739: yy19:",
          "740:  ++YYCURSOR;",
          "765:  if (yych <= '/') goto yy18;",
          "769:  yych = *++YYCURSOR;",
          "778:   }",
          "787:   }",
          "788:  }",
          "799:  }",
          "811:  yych = *++YYCURSOR;",
          "812:  if (yych <= '/') goto yy18;",
          "816:  ++YYCURSOR;",
          "817:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "818:  yych = *YYCURSOR;",
          "829:  if (yych <= '/') goto yy18;",
          "834:  ++YYCURSOR;",
          "837:  if (yych <= '/') goto yy18;",
          "842:  ++YYCURSOR;",
          "843:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "844:  yych = *YYCURSOR;",
          "845:  if (yych <= '/') goto yy18;",
          "869:  yych = *++YYCURSOR;",
          "874:  ++YYCURSOR;",
          "895:  }",
          "905:  yych = *++YYCURSOR;",
          "906:  if (yych <= '/') goto yy18;",
          "907:  if (yych >= ':') goto yy18;",
          "917:  ++YYCURSOR;",
          "918:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "919:  yych = *YYCURSOR;",
          "920:  if (yych <= '/') goto yy18;",
          "925:  ++YYCURSOR;",
          "928:  if (yych <= '/') goto yy18;",
          "933:  ++YYCURSOR;",
          "934:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "935:  yych = *YYCURSOR;",
          "936:  if (yych <= '/') goto yy18;",
          "941:  yych = *++YYCURSOR;",
          "945:  ++YYCURSOR;",
          "947:  {",
          "955:   return 0;",
          "956:  }",
          "962:  }",
          "965:  } else {",
          "968:  }",
          "970:  return 1;",
          "971: }",
          "974:  yych = *++YYCURSOR;",
          "976:  goto yy18;",
          "978:  yych = *++YYCURSOR;",
          "980:  goto yy18;",
          "982:  ++YYCURSOR;",
          "991:  ++YYCURSOR;",
          "992:  if ((YYLIMIT - YYCURSOR) < 3) YYFILL(3);",
          "993:  yych = *YYCURSOR;",
          "994:  if (yych <= ';') {",
          "995:   if (yych <= '/') goto yy18;",
          "997:   if (yych <= ':') goto yy18;",
          "998:  } else {",
          "999:   if (yych <= 'E') {",
          "1000:    if (yych <= 'D') goto yy18;",
          "1002:   } else {",
          "1004:    goto yy18;",
          "1005:   }",
          "1006:  }",
          "1008:  ++YYCURSOR;",
          "1009: #line 727 \"ext/standard/var_unserializer.re\"",
          "1010:  {",
          "",
          "[Removed Lines]",
          "658:  case 'O': goto yy4;",
          "660:  case 'R': goto yy6;",
          "661:  case 'S': goto yy7;",
          "662:  case 'a': goto yy8;",
          "663:  case 'b': goto yy9;",
          "664:  case 'd': goto yy10;",
          "665:  case 'i': goto yy11;",
          "667:  case 'r': goto yy13;",
          "668:  case 's': goto yy14;",
          "669:  case '}': goto yy15;",
          "670:  default: goto yy2;",
          "673:  ++YYCURSOR;",
          "675: #line 1001 \"ext/standard/var_unserializer.re\"",
          "677: #line 678 \"ext/standard/var_unserializer.c\"",
          "680:  if (yych == ':') goto yy17;",
          "684:  if (yych == ';') goto yy19;",
          "688:  if (yych == ':') goto yy21;",
          "692:  if (yych == ':') goto yy22;",
          "696:  if (yych == ':') goto yy23;",
          "700:  if (yych == ':') goto yy24;",
          "704:  if (yych == ':') goto yy25;",
          "708:  if (yych == ':') goto yy26;",
          "712:  if (yych == ':') goto yy27;",
          "716:  if (yych == ':') goto yy28;",
          "719:  yych = *(YYMARKER = ++YYCURSOR);",
          "720:  if (yych == ':') goto yy29;",
          "721:  goto yy3;",
          "722: yy15:",
          "724: #line 995 \"ext/standard/var_unserializer.re\"",
          "730: #line 731 \"ext/standard/var_unserializer.c\"",
          "734:   goto yy30;",
          "741: #line 673 \"ext/standard/var_unserializer.re\"",
          "742:  {",
          "744:  ZVAL_NULL(rval);",
          "745:  return 1;",
          "746: }",
          "747: #line 748 \"ext/standard/var_unserializer.c\"",
          "748: yy21:",
          "749:  yych = *++YYCURSOR;",
          "750:  if (yych <= '/') goto yy18;",
          "751:  if (yych <= '9') goto yy32;",
          "752:  goto yy18;",
          "753: yy22:",
          "754:  yych = *++YYCURSOR;",
          "755:  if (yych <= '/') goto yy18;",
          "756:  if (yych <= '9') goto yy34;",
          "757:  goto yy18;",
          "758: yy23:",
          "759:  yych = *++YYCURSOR;",
          "760:  if (yych <= '/') goto yy18;",
          "761:  if (yych <= '9') goto yy36;",
          "762:  goto yy18;",
          "763: yy24:",
          "764:  yych = *++YYCURSOR;",
          "766:  if (yych <= '1') goto yy38;",
          "767:  goto yy18;",
          "768: yy25:",
          "770:  if (yych <= '/') {",
          "771:   if (yych <= ',') {",
          "772:    if (yych == '+') goto yy39;",
          "773:    goto yy18;",
          "774:   } else {",
          "775:    if (yych <= '-') goto yy40;",
          "776:    if (yych <= '.') goto yy41;",
          "777:    goto yy18;",
          "779:  } else {",
          "780:   if (yych <= 'I') {",
          "781:    if (yych <= '9') goto yy42;",
          "782:    if (yych <= 'H') goto yy18;",
          "783:    goto yy44;",
          "784:   } else {",
          "785:    if (yych == 'N') goto yy45;",
          "786:    goto yy18;",
          "789: yy26:",
          "790:  yych = *++YYCURSOR;",
          "791:  if (yych <= ',') {",
          "792:   if (yych == '+') goto yy46;",
          "793:   goto yy18;",
          "794:  } else {",
          "795:   if (yych <= '-') goto yy46;",
          "796:   if (yych <= '/') goto yy18;",
          "797:   if (yych <= '9') goto yy47;",
          "798:   goto yy18;",
          "800: yy27:",
          "801:  yych = *++YYCURSOR;",
          "802:  if (yych <= '/') goto yy18;",
          "803:  if (yych <= '9') goto yy49;",
          "804:  goto yy18;",
          "805: yy28:",
          "806:  yych = *++YYCURSOR;",
          "807:  if (yych <= '/') goto yy18;",
          "808:  if (yych <= '9') goto yy51;",
          "809:  goto yy18;",
          "810: yy29:",
          "813:  if (yych <= '9') goto yy53;",
          "814:  goto yy18;",
          "815: yy30:",
          "819:  if (yybm[0+yych] & 128) {",
          "820:   goto yy30;",
          "821:  }",
          "822:  if (yych <= '/') goto yy18;",
          "823:  if (yych <= ':') goto yy55;",
          "824:  goto yy18;",
          "825: yy32:",
          "826:  ++YYCURSOR;",
          "827:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "828:  yych = *YYCURSOR;",
          "830:  if (yych <= '9') goto yy32;",
          "831:  if (yych == ';') goto yy56;",
          "832:  goto yy18;",
          "833: yy34:",
          "835:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "836:  yych = *YYCURSOR;",
          "838:  if (yych <= '9') goto yy34;",
          "839:  if (yych <= ':') goto yy58;",
          "840:  goto yy18;",
          "841: yy36:",
          "846:  if (yych <= '9') goto yy36;",
          "847:  if (yych <= ':') goto yy59;",
          "848:  goto yy18;",
          "849: yy38:",
          "850:  yych = *++YYCURSOR;",
          "851:  if (yych == ';') goto yy60;",
          "852:  goto yy18;",
          "853: yy39:",
          "854:  yych = *++YYCURSOR;",
          "855:  if (yych == '.') goto yy41;",
          "856:  if (yych <= '/') goto yy18;",
          "857:  if (yych <= '9') goto yy42;",
          "858:  goto yy18;",
          "859: yy40:",
          "860:  yych = *++YYCURSOR;",
          "861:  if (yych <= '/') {",
          "862:   if (yych != '.') goto yy18;",
          "863:  } else {",
          "864:   if (yych <= '9') goto yy42;",
          "865:   if (yych == 'I') goto yy44;",
          "866:   goto yy18;",
          "867:  }",
          "868: yy41:",
          "870:  if (yych <= '/') goto yy18;",
          "871:  if (yych <= '9') goto yy62;",
          "872:  goto yy18;",
          "873: yy42:",
          "875:  if ((YYLIMIT - YYCURSOR) < 3) YYFILL(3);",
          "876:  yych = *YYCURSOR;",
          "877:  if (yych <= ':') {",
          "878:   if (yych <= '.') {",
          "879:    if (yych <= '-') goto yy18;",
          "880:    goto yy62;",
          "881:   } else {",
          "882:    if (yych <= '/') goto yy18;",
          "883:    if (yych <= '9') goto yy42;",
          "884:    goto yy18;",
          "885:   }",
          "886:  } else {",
          "887:   if (yych <= 'E') {",
          "888:    if (yych <= ';') goto yy64;",
          "889:    if (yych <= 'D') goto yy18;",
          "890:    goto yy66;",
          "891:   } else {",
          "892:    if (yych == 'e') goto yy66;",
          "893:    goto yy18;",
          "894:   }",
          "896: yy44:",
          "897:  yych = *++YYCURSOR;",
          "898:  if (yych == 'N') goto yy67;",
          "899:  goto yy18;",
          "900: yy45:",
          "901:  yych = *++YYCURSOR;",
          "902:  if (yych == 'A') goto yy68;",
          "903:  goto yy18;",
          "904: yy46:",
          "908: yy47:",
          "909:  ++YYCURSOR;",
          "910:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "911:  yych = *YYCURSOR;",
          "912:  if (yych <= '/') goto yy18;",
          "913:  if (yych <= '9') goto yy47;",
          "914:  if (yych == ';') goto yy69;",
          "915:  goto yy18;",
          "916: yy49:",
          "921:  if (yych <= '9') goto yy49;",
          "922:  if (yych <= ':') goto yy71;",
          "923:  goto yy18;",
          "924: yy51:",
          "926:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "927:  yych = *YYCURSOR;",
          "929:  if (yych <= '9') goto yy51;",
          "930:  if (yych == ';') goto yy72;",
          "931:  goto yy18;",
          "932: yy53:",
          "937:  if (yych <= '9') goto yy53;",
          "938:  if (yych <= ':') goto yy74;",
          "939:  goto yy18;",
          "940: yy55:",
          "942:  if (yych == '\"') goto yy75;",
          "943:  goto yy18;",
          "944: yy56:",
          "946: #line 622 \"ext/standard/var_unserializer.re\"",
          "948:  zend_long id;",
          "951:  if (!var_hash) return 0;",
          "953:  id = parse_uiv(start + 2) - 1;",
          "954:  if (id == -1 || (rval_ref = var_access(var_hash, id)) == NULL) {",
          "958:  zval_ptr_dtor(rval);",
          "959:  if (Z_ISUNDEF_P(rval_ref) || (Z_ISREF_P(rval_ref) && Z_ISUNDEF_P(Z_REFVAL_P(rval_ref)))) {",
          "960:   ZVAL_UNDEF(rval);",
          "961:   return 1;",
          "963:  if (Z_ISREF_P(rval_ref)) {",
          "964:   ZVAL_COPY(rval, rval_ref);",
          "966:   ZVAL_NEW_REF(rval_ref, rval_ref);",
          "967:   ZVAL_COPY(rval, rval_ref);",
          "972: #line 973 \"ext/standard/var_unserializer.c\"",
          "973: yy58:",
          "975:  if (yych == '\"') goto yy77;",
          "977: yy59:",
          "979:  if (yych == '{') goto yy79;",
          "981: yy60:",
          "983: #line 679 \"ext/standard/var_unserializer.re\"",
          "984:  {",
          "986:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "987:  return 1;",
          "988: }",
          "989: #line 990 \"ext/standard/var_unserializer.c\"",
          "990: yy62:",
          "996:   if (yych <= '9') goto yy62;",
          "1001:    goto yy66;",
          "1003:    if (yych == 'e') goto yy66;",
          "1007: yy64:",
          "",
          "[Added Lines]",
          "659:  case 'O': goto yy13;",
          "661:  case 'R': goto yy2;",
          "662:  case 'S': goto yy10;",
          "663:  case 'a': goto yy11;",
          "664:  case 'b': goto yy6;",
          "665:  case 'd': goto yy8;",
          "666:  case 'i': goto yy7;",
          "668:  case 'r': goto yy4;",
          "669:  case 's': goto yy9;",
          "670:  case '}': goto yy14;",
          "671:  default: goto yy16;",
          "674:  yych = *(YYMARKER = ++YYCURSOR);",
          "675:  if (yych == ':') goto yy88;",
          "677: #line 1007 \"ext/standard/var_unserializer.re\"",
          "679: #line 680 \"ext/standard/var_unserializer.c\"",
          "682:  if (yych == ':') goto yy83;",
          "686:  if (yych == ';') goto yy81;",
          "690:  if (yych == ':') goto yy77;",
          "694:  if (yych == ':') goto yy71;",
          "698:  if (yych == ':') goto yy48;",
          "702:  if (yych == ':') goto yy42;",
          "706:  if (yych == ':') goto yy36;",
          "710:  if (yych == ':') goto yy30;",
          "714:  if (yych == ':') goto yy24;",
          "718:  if (yych == ':') goto yy17;",
          "722: #line 1001 \"ext/standard/var_unserializer.re\"",
          "728: #line 729 \"ext/standard/var_unserializer.c\"",
          "729: yy16:",
          "730:  yych = *++YYCURSOR;",
          "731:  goto yy3;",
          "735:   goto yy19;",
          "742:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "743:  yych = *YYCURSOR;",
          "744:  if (yybm[0+yych] & 128) {",
          "745:   goto yy19;",
          "746:  }",
          "748:  if (yych >= ';') goto yy18;",
          "750:  if (yych != '\"') goto yy18;",
          "751:  ++YYCURSOR;",
          "752: #line 849 \"ext/standard/var_unserializer.re\"",
          "753:  {",
          "754:  size_t len, len2, len3, maxlen;",
          "755:  zend_long elements;",
          "756:  char *str;",
          "757:  zend_string *class_name;",
          "758:  zend_class_entry *ce;",
          "759:  int incomplete_class = 0;",
          "761:  int custom_object = 0;",
          "763:  zval user_func;",
          "764:  zval retval;",
          "765:  zval args[1];",
          "767:     if (!var_hash) return 0;",
          "768:  if (*start == 'C') {",
          "769:   custom_object = 1;",
          "770:  }",
          "772:  len2 = len = parse_uiv(start + 2);",
          "773:  maxlen = max - YYCURSOR;",
          "774:  if (maxlen < len || len == 0) {",
          "776:   return 0;",
          "777:  }",
          "779:  str = (char*)YYCURSOR;",
          "781:  YYCURSOR += len;",
          "783:  if (*(YYCURSOR) != '\"') {",
          "785:   return 0;",
          "786:  }",
          "787:  if (*(YYCURSOR+1) != ':') {",
          "789:   return 0;",
          "790:  }",
          "792:  len3 = strspn(str, \"0123456789_abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\\177\\200\\201\\202\\203\\204\\205\\206\\207\\210\\211\\212\\213\\214\\215\\216\\217\\220\\221\\222\\223\\224\\225\\226\\227\\230\\231\\232\\233\\234\\235\\236\\237\\240\\241\\242\\243\\244\\245\\246\\247\\250\\251\\252\\253\\254\\255\\256\\257\\260\\261\\262\\263\\264\\265\\266\\267\\270\\271\\272\\273\\274\\275\\276\\277\\300\\301\\302\\303\\304\\305\\306\\307\\310\\311\\312\\313\\314\\315\\316\\317\\320\\321\\322\\323\\324\\325\\326\\327\\330\\331\\332\\333\\334\\335\\336\\337\\340\\341\\342\\343\\344\\345\\346\\347\\350\\351\\352\\353\\354\\355\\356\\357\\360\\361\\362\\363\\364\\365\\366\\367\\370\\371\\372\\373\\374\\375\\376\\377\\\\\");",
          "793:  if (len3 != len)",
          "794:  {",
          "796:   return 0;",
          "797:  }",
          "799:  class_name = zend_string_init(str, len, 0);",
          "801:  do {",
          "802:   if(!unserialize_allowed_class(class_name, var_hash)) {",
          "803:    incomplete_class = 1;",
          "804:    ce = PHP_IC_ENTRY;",
          "805:    break;",
          "809:   BG(serialize_lock)++;",
          "810:   ce = zend_lookup_class(class_name);",
          "811:   if (ce) {",
          "812:    BG(serialize_lock)--;",
          "813:    if (EG(exception)) {",
          "814:     zend_string_release(class_name);",
          "815:     return 0;",
          "816:    }",
          "817:    break;",
          "818:   }",
          "819:   BG(serialize_lock)--;",
          "821:   if (EG(exception)) {",
          "822:    zend_string_release(class_name);",
          "823:    return 0;",
          "824:   }",
          "827:   if ((PG(unserialize_callback_func) == NULL) || (PG(unserialize_callback_func)[0] == '\\0')) {",
          "828:    incomplete_class = 1;",
          "829:    ce = PHP_IC_ENTRY;",
          "830:    break;",
          "831:   }",
          "834:   ZVAL_STRING(&user_func, PG(unserialize_callback_func));",
          "836:   ZVAL_STR_COPY(&args[0], class_name);",
          "837:   BG(serialize_lock)++;",
          "838:   if (call_user_function_ex(CG(function_table), NULL, &user_func, &retval, 1, args, 0, NULL) != SUCCESS) {",
          "839:    BG(serialize_lock)--;",
          "840:    if (EG(exception)) {",
          "841:     zend_string_release(class_name);",
          "842:     zval_ptr_dtor(&user_func);",
          "843:     zval_ptr_dtor(&args[0]);",
          "844:     return 0;",
          "845:    }",
          "846:    php_error_docref(NULL, E_WARNING, \"defined (%s) but not found\", Z_STRVAL(user_func));",
          "847:    incomplete_class = 1;",
          "848:    ce = PHP_IC_ENTRY;",
          "849:    zval_ptr_dtor(&user_func);",
          "850:    zval_ptr_dtor(&args[0]);",
          "851:    break;",
          "852:   }",
          "853:   BG(serialize_lock)--;",
          "854:   zval_ptr_dtor(&retval);",
          "855:   if (EG(exception)) {",
          "856:    zend_string_release(class_name);",
          "857:    zval_ptr_dtor(&user_func);",
          "858:    zval_ptr_dtor(&args[0]);",
          "859:    return 0;",
          "860:   }",
          "863:   BG(serialize_lock)++;",
          "864:   if ((ce = zend_lookup_class(class_name)) == NULL) {",
          "865:    php_error_docref(NULL, E_WARNING, \"Function %s() hasn't defined the class it was called for\", Z_STRVAL(user_func));",
          "866:    incomplete_class = 1;",
          "867:    ce = PHP_IC_ENTRY;",
          "868:   }",
          "869:   BG(serialize_lock)--;",
          "871:   zval_ptr_dtor(&user_func);",
          "872:   zval_ptr_dtor(&args[0]);",
          "873:   break;",
          "874:  } while (1);",
          "878:  if (custom_object) {",
          "879:   int ret;",
          "881:   ret = object_custom(UNSERIALIZE_PASSTHRU, ce);",
          "883:   if (ret && incomplete_class) {",
          "884:    php_store_class_name(rval, ZSTR_VAL(class_name), len2);",
          "886:   zend_string_release(class_name);",
          "887:   return ret;",
          "890:  elements = object_common1(UNSERIALIZE_PASSTHRU, ce);",
          "892:  if (elements < 0) {",
          "893:     zend_string_release(class_name);",
          "894:     return 0;",
          "897:  if (incomplete_class) {",
          "898:   php_store_class_name(rval, ZSTR_VAL(class_name), len2);",
          "899:  }",
          "900:  zend_string_release(class_name);",
          "902:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "903: }",
          "904: #line 905 \"ext/standard/var_unserializer.c\"",
          "905: yy24:",
          "908:  if (yych >= ':') goto yy18;",
          "909: yy25:",
          "914:  if (yych <= '9') goto yy25;",
          "915:  if (yych >= ';') goto yy18;",
          "916:  yych = *++YYCURSOR;",
          "917:  if (yych != '\"') goto yy18;",
          "919: #line 838 \"ext/standard/var_unserializer.re\"",
          "920:  {",
          "921:  long elements;",
          "922:     if (!var_hash) return 0;",
          "924:  elements = object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR);",
          "925:  if (elements < 0) {",
          "926:   return 0;",
          "927:  }",
          "928:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "929: }",
          "930: #line 931 \"ext/standard/var_unserializer.c\"",
          "931: yy30:",
          "932:  yych = *++YYCURSOR;",
          "934:  if (yych >= ':') goto yy18;",
          "935: yy31:",
          "940:  if (yych <= '9') goto yy31;",
          "941:  if (yych >= ';') goto yy18;",
          "943:  if (yych != '{') goto yy18;",
          "945: #line 808 \"ext/standard/var_unserializer.re\"",
          "946:  {",
          "947:  zend_long elements = parse_iv(start + 2);",
          "950:     if (!var_hash) return 0;",
          "952:  if (elements < 0) {",
          "953:   return 0;",
          "956:  array_init_size(rval, elements);",
          "957:  if (elements) {",
          "960:   zend_hash_real_init(Z_ARRVAL_P(rval), 0);",
          "961:  }",
          "967:  HT_ALLOW_COW_VIOLATION(Z_ARRVAL_P(rval));",
          "969:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_ARRVAL_P(rval), elements, 0)) {",
          "970:   return 0;",
          "971:  }",
          "973:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "974: }",
          "975: #line 976 \"ext/standard/var_unserializer.c\"",
          "976: yy36:",
          "980: yy37:",
          "985:  if (yych <= '9') goto yy37;",
          "986:  if (yych >= ';') goto yy18;",
          "987:  yych = *++YYCURSOR;",
          "988:  if (yych != '\"') goto yy18;",
          "990: #line 774 \"ext/standard/var_unserializer.re\"",
          "991:  {",
          "992:  size_t len, maxlen;",
          "993:  zend_string *str;",
          "995:  len = parse_uiv(start + 2);",
          "996:  maxlen = max - YYCURSOR;",
          "997:  if (maxlen < len) {",
          "999:   return 0;",
          "1000:  }",
          "1002:  if ((str = unserialize_str(&YYCURSOR, len, maxlen)) == NULL) {",
          "1003:   return 0;",
          "1004:  }",
          "1006:  if (*(YYCURSOR) != '\"') {",
          "1007:   zend_string_free(str);",
          "1009:   return 0;",
          "1010:  }",
          "1012:  if (*(YYCURSOR + 1) != ';') {",
          "1013:   efree(str);",
          "1015:   return 0;",
          "1016:  }",
          "1018:  YYCURSOR += 2;",
          "1021:  ZVAL_STR(rval, str);",
          "1022:  return 1;",
          "1023: }",
          "1024: #line 1025 \"ext/standard/var_unserializer.c\"",
          "1025: yy42:",
          "1026:  yych = *++YYCURSOR;",
          "1028:  if (yych >= ':') goto yy18;",
          "1029: yy43:",
          "1034:  if (yych <= '9') goto yy43;",
          "1035:  if (yych >= ';') goto yy18;",
          "1037:  if (yych != '\"') goto yy18;",
          "1039: #line 736 \"ext/standard/var_unserializer.re\"",
          "1041:  size_t len, maxlen;",
          "1042:  char *str;",
          "1044:  len = parse_uiv(start + 2);",
          "1045:  maxlen = max - YYCURSOR;",
          "1046:  if (maxlen < len) {",
          "1048:   return 0;",
          "1049:  }",
          "1051:  str = (char*)YYCURSOR;",
          "1053:  YYCURSOR += len;",
          "1055:  if (*(YYCURSOR) != '\"') {",
          "1060:  if (*(YYCURSOR + 1) != ';') {",
          "1062:   return 0;",
          "1065:  YYCURSOR += 2;",
          "1068:  if (len == 0) {",
          "1069:   ZVAL_EMPTY_STRING(rval);",
          "1070:  } else if (len == 1) {",
          "1071:   ZVAL_INTERNED_STR(rval, ZSTR_CHAR((zend_uchar)*str));",
          "1073:   ZVAL_STRINGL(rval, str, len);",
          "1077: #line 1078 \"ext/standard/var_unserializer.c\"",
          "1078: yy48:",
          "1079:  yych = *++YYCURSOR;",
          "1080:  if (yych <= '/') {",
          "1081:   if (yych <= ',') {",
          "1082:    if (yych == '+') goto yy52;",
          "1083:    goto yy18;",
          "1084:   } else {",
          "1085:    if (yych <= '-') goto yy50;",
          "1086:    if (yych <= '.') goto yy55;",
          "1087:    goto yy18;",
          "1088:   }",
          "1089:  } else {",
          "1090:   if (yych <= 'I') {",
          "1091:    if (yych <= '9') goto yy53;",
          "1092:    if (yych <= 'H') goto yy18;",
          "1093:    goto yy51;",
          "1094:   } else {",
          "1095:    if (yych != 'N') goto yy18;",
          "1096:   }",
          "1097:  }",
          "1099:  if (yych == 'A') goto yy70;",
          "1101: yy50:",
          "1102:  yych = *++YYCURSOR;",
          "1103:  if (yych <= '/') {",
          "1104:   if (yych == '.') goto yy55;",
          "1105:   goto yy18;",
          "1106:  } else {",
          "1107:   if (yych <= '9') goto yy53;",
          "1108:   if (yych != 'I') goto yy18;",
          "1109:  }",
          "1110: yy51:",
          "1112:  if (yych == 'N') goto yy66;",
          "1114: yy52:",
          "1115:  yych = *++YYCURSOR;",
          "1116:  if (yych == '.') goto yy55;",
          "1117:  if (yych <= '/') goto yy18;",
          "1118:  if (yych >= ':') goto yy18;",
          "1119: yy53:",
          "1121:  if ((YYLIMIT - YYCURSOR) < 3) YYFILL(3);",
          "1122:  yych = *YYCURSOR;",
          "1123:  if (yych <= ':') {",
          "1124:   if (yych <= '.') {",
          "1125:    if (yych <= '-') goto yy18;",
          "1126:    goto yy64;",
          "1127:   } else {",
          "1128:    if (yych <= '/') goto yy18;",
          "1129:    if (yych <= '9') goto yy53;",
          "1130:    goto yy18;",
          "1131:   }",
          "1132:  } else {",
          "1133:   if (yych <= 'E') {",
          "1134:    if (yych <= ';') goto yy58;",
          "1135:    if (yych <= 'D') goto yy18;",
          "1136:    goto yy60;",
          "1137:   } else {",
          "1138:    if (yych == 'e') goto yy60;",
          "1139:    goto yy18;",
          "1140:   }",
          "1141:  }",
          "1142: yy55:",
          "1143:  yych = *++YYCURSOR;",
          "1144:  if (yych <= '/') goto yy18;",
          "1145:  if (yych >= ':') goto yy18;",
          "1146: yy56:",
          "1152:   if (yych <= '9') goto yy56;",
          "1157:    goto yy60;",
          "1159:    if (yych == 'e') goto yy60;",
          "1163: yy58:",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1015:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1016:  return 1;",
          "1017: }",
          "1020:  yych = *++YYCURSOR;",
          "1021:  if (yych <= ',') {",
          "1024:  } else {",
          "1026:   if (yych <= '/') goto yy18;",
          "1028:   goto yy18;",
          "1029:  }",
          "1031:  yych = *++YYCURSOR;",
          "1033:  goto yy18;",
          "1035:  yych = *++YYCURSOR;",
          "1037:  goto yy18;",
          "1039:  ++YYCURSOR;",
          "1040: #line 685 \"ext/standard/var_unserializer.re\"",
          "1041:  {",
          "",
          "[Removed Lines]",
          "1018: #line 1019 \"ext/standard/var_unserializer.c\"",
          "1019: yy66:",
          "1022:   if (yych == '+') goto yy81;",
          "1023:   goto yy18;",
          "1025:   if (yych <= '-') goto yy81;",
          "1027:   if (yych <= '9') goto yy82;",
          "1030: yy67:",
          "1032:  if (yych == 'F') goto yy84;",
          "1034: yy68:",
          "1036:  if (yych == 'N') goto yy84;",
          "1038: yy69:",
          "",
          "[Added Lines]",
          "1174: #line 1175 \"ext/standard/var_unserializer.c\"",
          "1175: yy60:",
          "1178:   if (yych != '+') goto yy18;",
          "1180:   if (yych <= '-') goto yy61;",
          "1182:   if (yych <= '9') goto yy62;",
          "1185: yy61:",
          "1187:  if (yych <= '/') goto yy18;",
          "1188:  if (yych >= ':') goto yy18;",
          "1189: yy62:",
          "1190:  ++YYCURSOR;",
          "1191:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "1192:  yych = *YYCURSOR;",
          "1193:  if (yych <= '/') goto yy18;",
          "1194:  if (yych <= '9') goto yy62;",
          "1195:  if (yych == ';') goto yy58;",
          "1197: yy64:",
          "1198:  ++YYCURSOR;",
          "1199:  if ((YYLIMIT - YYCURSOR) < 3) YYFILL(3);",
          "1200:  yych = *YYCURSOR;",
          "1201:  if (yych <= ';') {",
          "1202:   if (yych <= '/') goto yy18;",
          "1203:   if (yych <= '9') goto yy64;",
          "1204:   if (yych <= ':') goto yy18;",
          "1205:   goto yy58;",
          "1206:  } else {",
          "1207:   if (yych <= 'E') {",
          "1208:    if (yych <= 'D') goto yy18;",
          "1209:    goto yy60;",
          "1210:   } else {",
          "1211:    if (yych == 'e') goto yy60;",
          "1212:    goto yy18;",
          "1213:   }",
          "1214:  }",
          "1215: yy66:",
          "1216:  yych = *++YYCURSOR;",
          "1217:  if (yych != 'F') goto yy18;",
          "1218: yy67:",
          "1219:  yych = *++YYCURSOR;",
          "1220:  if (yych != ';') goto yy18;",
          "1221:  ++YYCURSOR;",
          "1222: #line 711 \"ext/standard/var_unserializer.re\"",
          "1223:  {",
          "1226:  if (!strncmp((char*)start + 2, \"NAN\", 3)) {",
          "1227:   ZVAL_DOUBLE(rval, ZEND_NAN);",
          "1228:  } else if (!strncmp((char*)start + 2, \"INF\", 3)) {",
          "1229:   ZVAL_DOUBLE(rval, ZEND_INFINITY);",
          "1230:  } else if (!strncmp((char*)start + 2, \"-INF\", 4)) {",
          "1231:   ZVAL_DOUBLE(rval, -ZEND_INFINITY);",
          "1232:  } else {",
          "1233:   ZVAL_NULL(rval);",
          "1234:  }",
          "1236:  return 1;",
          "1237: }",
          "1238: #line 1239 \"ext/standard/var_unserializer.c\"",
          "1239: yy70:",
          "1241:  if (yych == 'N') goto yy67;",
          "1243: yy71:",
          "1244:  yych = *++YYCURSOR;",
          "1245:  if (yych <= ',') {",
          "1246:   if (yych != '+') goto yy18;",
          "1247:  } else {",
          "1248:   if (yych <= '-') goto yy72;",
          "1249:   if (yych <= '/') goto yy18;",
          "1250:   if (yych <= '9') goto yy73;",
          "1251:   goto yy18;",
          "1252:  }",
          "1253: yy72:",
          "1254:  yych = *++YYCURSOR;",
          "1255:  if (yych <= '/') goto yy18;",
          "1256:  if (yych >= ':') goto yy18;",
          "1257: yy73:",
          "1258:  ++YYCURSOR;",
          "1259:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "1260:  yych = *YYCURSOR;",
          "1261:  if (yych <= '/') goto yy18;",
          "1262:  if (yych <= '9') goto yy73;",
          "1263:  if (yych != ';') goto yy18;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1063:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1064:  return 1;",
          "1065: }",
          "1068:  yych = *++YYCURSOR;",
          "1072:  ++YYCURSOR;",
          "1073: #line 648 \"ext/standard/var_unserializer.re\"",
          "1074:  {",
          "",
          "[Removed Lines]",
          "1066: #line 1067 \"ext/standard/var_unserializer.c\"",
          "1067: yy71:",
          "1069:  if (yych == '\"') goto yy85;",
          "1070:  goto yy18;",
          "1071: yy72:",
          "",
          "[Added Lines]",
          "1291: #line 1292 \"ext/standard/var_unserializer.c\"",
          "1292: yy77:",
          "1294:  if (yych <= '/') goto yy18;",
          "1295:  if (yych >= '2') goto yy18;",
          "1296:  yych = *++YYCURSOR;",
          "1297:  if (yych != ';') goto yy18;",
          "1298:  ++YYCURSOR;",
          "1299: #line 679 \"ext/standard/var_unserializer.re\"",
          "1300:  {",
          "1302:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1303:  return 1;",
          "1304: }",
          "1305: #line 1306 \"ext/standard/var_unserializer.c\"",
          "1306: yy81:",
          "1307:  ++YYCURSOR;",
          "1308: #line 673 \"ext/standard/var_unserializer.re\"",
          "1309:  {",
          "1311:  ZVAL_NULL(rval);",
          "1312:  return 1;",
          "1313: }",
          "1314: #line 1315 \"ext/standard/var_unserializer.c\"",
          "1315: yy83:",
          "1316:  yych = *++YYCURSOR;",
          "1317:  if (yych <= '/') goto yy18;",
          "1318:  if (yych >= ':') goto yy18;",
          "1319: yy84:",
          "1320:  ++YYCURSOR;",
          "1321:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "1322:  yych = *YYCURSOR;",
          "1323:  if (yych <= '/') goto yy18;",
          "1324:  if (yych <= '9') goto yy84;",
          "1325:  if (yych != ';') goto yy18;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1096:  return 1;",
          "1097: }",
          "1329:  yych = *++YYCURSOR;",
          "1330:  if (yych <= '/') goto yy18;",
          "1331:  if (yych >= ':') goto yy18;",
          "1333:  ++YYCURSOR;",
          "1334:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "1335:  yych = *YYCURSOR;",
          "1336:  if (yych <= '/') goto yy18;",
          "1345:  ++YYCURSOR;",
          "1361:  {",
          "1378:   return 0;",
          "1379:  }",
          "1384:  }",
          "1405:  } else {",
          "1407:  }",
          "1409:  return 1;",
          "1410: }",
          "1412: }",
          "1416:  return 0;",
          "",
          "[Removed Lines]",
          "1098: #line 1099 \"ext/standard/var_unserializer.c\"",
          "1099: yy74:",
          "1100:  yych = *++YYCURSOR;",
          "1101:  if (yych == '\"') goto yy87;",
          "1102:  goto yy18;",
          "1103: yy75:",
          "1104:  ++YYCURSOR;",
          "1105: #line 843 \"ext/standard/var_unserializer.re\"",
          "1106:  {",
          "1107:  size_t len, len2, len3, maxlen;",
          "1108:  zend_long elements;",
          "1109:  char *str;",
          "1110:  zend_string *class_name;",
          "1111:  zend_class_entry *ce;",
          "1112:  int incomplete_class = 0;",
          "1114:  int custom_object = 0;",
          "1116:  zval user_func;",
          "1117:  zval retval;",
          "1118:  zval args[1];",
          "1120:     if (!var_hash) return 0;",
          "1121:  if (*start == 'C') {",
          "1122:   custom_object = 1;",
          "1123:  }",
          "1125:  len2 = len = parse_uiv(start + 2);",
          "1126:  maxlen = max - YYCURSOR;",
          "1127:  if (maxlen < len || len == 0) {",
          "1129:   return 0;",
          "1130:  }",
          "1132:  str = (char*)YYCURSOR;",
          "1134:  YYCURSOR += len;",
          "1136:  if (*(YYCURSOR) != '\"') {",
          "1138:   return 0;",
          "1139:  }",
          "1140:  if (*(YYCURSOR+1) != ':') {",
          "1142:   return 0;",
          "1143:  }",
          "1145:  len3 = strspn(str, \"0123456789_abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\\177\\200\\201\\202\\203\\204\\205\\206\\207\\210\\211\\212\\213\\214\\215\\216\\217\\220\\221\\222\\223\\224\\225\\226\\227\\230\\231\\232\\233\\234\\235\\236\\237\\240\\241\\242\\243\\244\\245\\246\\247\\250\\251\\252\\253\\254\\255\\256\\257\\260\\261\\262\\263\\264\\265\\266\\267\\270\\271\\272\\273\\274\\275\\276\\277\\300\\301\\302\\303\\304\\305\\306\\307\\310\\311\\312\\313\\314\\315\\316\\317\\320\\321\\322\\323\\324\\325\\326\\327\\330\\331\\332\\333\\334\\335\\336\\337\\340\\341\\342\\343\\344\\345\\346\\347\\350\\351\\352\\353\\354\\355\\356\\357\\360\\361\\362\\363\\364\\365\\366\\367\\370\\371\\372\\373\\374\\375\\376\\377\\\\\");",
          "1146:  if (len3 != len)",
          "1147:  {",
          "1149:   return 0;",
          "1150:  }",
          "1152:  class_name = zend_string_init(str, len, 0);",
          "1154:  do {",
          "1155:   if(!unserialize_allowed_class(class_name, var_hash)) {",
          "1156:    incomplete_class = 1;",
          "1157:    ce = PHP_IC_ENTRY;",
          "1158:    break;",
          "1159:   }",
          "1162:   BG(serialize_lock)++;",
          "1163:   ce = zend_lookup_class(class_name);",
          "1164:   if (ce) {",
          "1165:    BG(serialize_lock)--;",
          "1166:    if (EG(exception)) {",
          "1167:     zend_string_release(class_name);",
          "1168:     return 0;",
          "1169:    }",
          "1170:    break;",
          "1171:   }",
          "1172:   BG(serialize_lock)--;",
          "1174:   if (EG(exception)) {",
          "1175:    zend_string_release(class_name);",
          "1176:    return 0;",
          "1177:   }",
          "1180:   if ((PG(unserialize_callback_func) == NULL) || (PG(unserialize_callback_func)[0] == '\\0')) {",
          "1181:    incomplete_class = 1;",
          "1182:    ce = PHP_IC_ENTRY;",
          "1183:    break;",
          "1184:   }",
          "1187:   ZVAL_STRING(&user_func, PG(unserialize_callback_func));",
          "1189:   ZVAL_STR_COPY(&args[0], class_name);",
          "1190:   BG(serialize_lock)++;",
          "1191:   if (call_user_function_ex(CG(function_table), NULL, &user_func, &retval, 1, args, 0, NULL) != SUCCESS) {",
          "1192:    BG(serialize_lock)--;",
          "1193:    if (EG(exception)) {",
          "1194:     zend_string_release(class_name);",
          "1195:     zval_ptr_dtor(&user_func);",
          "1196:     zval_ptr_dtor(&args[0]);",
          "1197:     return 0;",
          "1198:    }",
          "1199:    php_error_docref(NULL, E_WARNING, \"defined (%s) but not found\", Z_STRVAL(user_func));",
          "1200:    incomplete_class = 1;",
          "1201:    ce = PHP_IC_ENTRY;",
          "1202:    zval_ptr_dtor(&user_func);",
          "1203:    zval_ptr_dtor(&args[0]);",
          "1204:    break;",
          "1205:   }",
          "1206:   BG(serialize_lock)--;",
          "1207:   zval_ptr_dtor(&retval);",
          "1208:   if (EG(exception)) {",
          "1209:    zend_string_release(class_name);",
          "1210:    zval_ptr_dtor(&user_func);",
          "1211:    zval_ptr_dtor(&args[0]);",
          "1212:    return 0;",
          "1213:   }",
          "1216:   BG(serialize_lock)++;",
          "1217:   if ((ce = zend_lookup_class(class_name)) == NULL) {",
          "1218:    php_error_docref(NULL, E_WARNING, \"Function %s() hasn't defined the class it was called for\", Z_STRVAL(user_func));",
          "1219:    incomplete_class = 1;",
          "1220:    ce = PHP_IC_ENTRY;",
          "1221:   }",
          "1222:   BG(serialize_lock)--;",
          "1224:   zval_ptr_dtor(&user_func);",
          "1225:   zval_ptr_dtor(&args[0]);",
          "1226:   break;",
          "1227:  } while (1);",
          "1231:  if (custom_object) {",
          "1232:   int ret;",
          "1234:   ret = object_custom(UNSERIALIZE_PASSTHRU, ce);",
          "1236:   if (ret && incomplete_class) {",
          "1237:    php_store_class_name(rval, ZSTR_VAL(class_name), len2);",
          "1238:   }",
          "1239:   zend_string_release(class_name);",
          "1240:   return ret;",
          "1241:  }",
          "1243:  elements = object_common1(UNSERIALIZE_PASSTHRU, ce);",
          "1245:  if (elements < 0) {",
          "1246:     zend_string_release(class_name);",
          "1247:     return 0;",
          "1248:  }",
          "1250:  if (incomplete_class) {",
          "1251:   php_store_class_name(rval, ZSTR_VAL(class_name), len2);",
          "1252:  }",
          "1253:  zend_string_release(class_name);",
          "1255:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "1256: }",
          "1257: #line 1258 \"ext/standard/var_unserializer.c\"",
          "1258: yy77:",
          "1259:  ++YYCURSOR;",
          "1260: #line 768 \"ext/standard/var_unserializer.re\"",
          "1261:  {",
          "1262:  size_t len, maxlen;",
          "1263:  zend_string *str;",
          "1265:  len = parse_uiv(start + 2);",
          "1266:  maxlen = max - YYCURSOR;",
          "1267:  if (maxlen < len) {",
          "1269:   return 0;",
          "1270:  }",
          "1272:  if ((str = unserialize_str(&YYCURSOR, len, maxlen)) == NULL) {",
          "1273:   return 0;",
          "1274:  }",
          "1276:  if (*(YYCURSOR) != '\"') {",
          "1277:   zend_string_free(str);",
          "1279:   return 0;",
          "1280:  }",
          "1282:  if (*(YYCURSOR + 1) != ';') {",
          "1283:   efree(str);",
          "1285:   return 0;",
          "1286:  }",
          "1288:  YYCURSOR += 2;",
          "1291:  ZVAL_STR(rval, str);",
          "1292:  return 1;",
          "1293: }",
          "1294: #line 1295 \"ext/standard/var_unserializer.c\"",
          "1295: yy79:",
          "1296:  ++YYCURSOR;",
          "1297: #line 802 \"ext/standard/var_unserializer.re\"",
          "1298:  {",
          "1299:  zend_long elements = parse_iv(start + 2);",
          "1302:     if (!var_hash) return 0;",
          "1304:  if (elements < 0) {",
          "1305:   return 0;",
          "1306:  }",
          "1308:  array_init_size(rval, elements);",
          "1309:  if (elements) {",
          "1312:   zend_hash_real_init(Z_ARRVAL_P(rval), 0);",
          "1313:  }",
          "1319:  HT_ALLOW_COW_VIOLATION(Z_ARRVAL_P(rval));",
          "1321:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_ARRVAL_P(rval), elements, 0)) {",
          "1322:   return 0;",
          "1323:  }",
          "1325:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "1326: }",
          "1327: #line 1328 \"ext/standard/var_unserializer.c\"",
          "1328: yy81:",
          "1332: yy82:",
          "1337:  if (yych <= '9') goto yy82;",
          "1338:  if (yych == ';') goto yy64;",
          "1339:  goto yy18;",
          "1340: yy84:",
          "1341:  yych = *++YYCURSOR;",
          "1342:  if (yych == ';') goto yy89;",
          "1343:  goto yy18;",
          "1344: yy85:",
          "1346: #line 832 \"ext/standard/var_unserializer.re\"",
          "1347:  {",
          "1348:  long elements;",
          "1349:     if (!var_hash) return 0;",
          "1351:  elements = object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR);",
          "1352:  if (elements < 0) {",
          "1353:   return 0;",
          "1354:  }",
          "1355:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "1356: }",
          "1357: #line 1358 \"ext/standard/var_unserializer.c\"",
          "1358: yy87:",
          "1359:  ++YYCURSOR;",
          "1360: #line 736 \"ext/standard/var_unserializer.re\"",
          "1362:  size_t len, maxlen;",
          "1363:  char *str;",
          "1365:  len = parse_uiv(start + 2);",
          "1366:  maxlen = max - YYCURSOR;",
          "1367:  if (maxlen < len) {",
          "1369:   return 0;",
          "1370:  }",
          "1372:  str = (char*)YYCURSOR;",
          "1374:  YYCURSOR += len;",
          "1376:  if (*(YYCURSOR) != '\"') {",
          "1381:  if (*(YYCURSOR + 1) != ';') {",
          "1383:   return 0;",
          "1386:  YYCURSOR += 2;",
          "1389:  ZVAL_STRINGL(rval, str, len);",
          "1390:  return 1;",
          "1391: }",
          "1392: #line 1393 \"ext/standard/var_unserializer.c\"",
          "1393: yy89:",
          "1394:  ++YYCURSOR;",
          "1395: #line 711 \"ext/standard/var_unserializer.re\"",
          "1396:  {",
          "1399:  if (!strncmp((char*)start + 2, \"NAN\", 3)) {",
          "1400:   ZVAL_DOUBLE(rval, ZEND_NAN);",
          "1401:  } else if (!strncmp((char*)start + 2, \"INF\", 3)) {",
          "1402:   ZVAL_DOUBLE(rval, ZEND_INFINITY);",
          "1403:  } else if (!strncmp((char*)start + 2, \"-INF\", 4)) {",
          "1404:   ZVAL_DOUBLE(rval, -ZEND_INFINITY);",
          "1406:   ZVAL_NULL(rval);",
          "1411: #line 1412 \"ext/standard/var_unserializer.c\"",
          "1413: #line 1003 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1352: #line 1353 \"ext/standard/var_unserializer.c\"",
          "1353: yy88:",
          "1357: yy89:",
          "1362:  if (yych <= '9') goto yy89;",
          "1363:  if (yych != ';') goto yy18;",
          "1365: #line 622 \"ext/standard/var_unserializer.re\"",
          "1367:  zend_long id;",
          "1370:  if (!var_hash) return 0;",
          "1372:  id = parse_uiv(start + 2) - 1;",
          "1373:  if (id == -1 || (rval_ref = var_access(var_hash, id)) == NULL) {",
          "1377:  zval_ptr_dtor(rval);",
          "1378:  if (Z_ISUNDEF_P(rval_ref) || (Z_ISREF_P(rval_ref) && Z_ISUNDEF_P(Z_REFVAL_P(rval_ref)))) {",
          "1379:   ZVAL_UNDEF(rval);",
          "1380:   return 1;",
          "1382:  if (Z_ISREF_P(rval_ref)) {",
          "1383:   ZVAL_COPY(rval, rval_ref);",
          "1385:   ZVAL_NEW_REF(rval_ref, rval_ref);",
          "1386:   ZVAL_COPY(rval, rval_ref);",
          "1391: #line 1392 \"ext/standard/var_unserializer.c\"",
          "1393: #line 1009 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "761:  YYCURSOR += 2;",
          "765:  return 1;",
          "766: }",
          "",
          "[Removed Lines]",
          "764:  ZVAL_STRINGL(rval, str, len);",
          "",
          "[Added Lines]",
          "764:  if (len == 0) {",
          "765:   ZVAL_EMPTY_STRING(rval);",
          "766:  } else if (len == 1) {",
          "767:   ZVAL_INTERNED_STR(rval, ZSTR_CHAR((zend_uchar)*str));",
          "768:  } else {",
          "769:   ZVAL_STRINGL(rval, str, len);",
          "770:  }",
          "",
          "---------------"
        ],
        "main/php_variables.c||main/php_variables.c": [
          "File: main/php_variables.c -> main/php_variables.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "49:  assert(strval != NULL);",
          "53:  php_register_variable_ex(var, &new_entry, track_vars_array);",
          "54: }",
          "",
          "[Removed Lines]",
          "52:  ZVAL_NEW_STR(&new_entry, zend_string_init(strval, str_len, 0));",
          "",
          "[Added Lines]",
          "52:  if (str_len == 0) {",
          "53:   ZVAL_EMPTY_STRING(&new_entry);",
          "54:  } else if (str_len == 1) {",
          "55:   ZVAL_INTERNED_STR(&new_entry, ZSTR_CHAR((zend_uchar)*strval));",
          "56:  } else {",
          "57:   ZVAL_NEW_STR(&new_entry, zend_string_init(strval, str_len, 0));",
          "58:  }",
          "",
          "---------------"
        ]
      }
    }
  ]
}