{
  "cve_id": "CVE-2022-2042",
  "cve_desc": "Use After Free in GitHub repository vim/vim prior to 8.2.",
  "repo": "vim/vim",
  "patch_hash": "2813f38e021c6e6581c0c88fcf107e41788bc835",
  "patch_info": {
    "commit_hash": "2813f38e021c6e6581c0c88fcf107e41788bc835",
    "repo": "vim/vim",
    "commit_url": "https://github.com/vim/vim/commit/2813f38e021c6e6581c0c88fcf107e41788bc835",
    "files": [
      "src/spell.c",
      "src/testdir/test_spell_utf8.vim",
      "src/version.c"
    ],
    "message": "patch 8.2.5072: using uninitialized value and freed memory in spell command\n\nProblem:    Using uninitialized value and freed memory in spell command.\nSolution:   Initialize \"attr\".  Check for empty line early.",
    "before_after_code_files": [
      "src/spell.c||src/spell.c",
      "src/testdir/test_spell_utf8.vim||src/testdir/test_spell_utf8.vim",
      "src/version.c||src/version.c"
    ]
  },
  "patch_diff": {
    "src/spell.c||src/spell.c": [
      "File: src/spell.c -> src/spell.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1275:     char_u *line;",
      "1276:     char_u *p;",
      "1277:     char_u *endp;",
      "1279:     int  len;",
      "1280: #ifdef FEAT_SYN_HL",
      "1281:     int  has_syntax = syntax_present(wp);",
      "",
      "[Removed Lines]",
      "1278:     hlf_T attr;",
      "",
      "[Added Lines]",
      "1278:     hlf_T attr = 0;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "1309:     while (!got_int)",
      "1310:     {",
      "1311:  line = ml_get_buf(wp->w_buffer, lnum, FALSE);",
      "1313:  len = (int)STRLEN(line);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1311:  int empty_line;",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "1340:  }",
      "1344:  STRCPY(buf, line);",
      "1345:  if (lnum < wp->w_buffer->b_ml.ml_line_count)",
      "1346:      spell_cat_line(buf + STRLEN(buf),",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1347:  empty_line = *skipwhite(line) == NUL;",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "1487:      --capcol;",
      "1491:   capcol = 0;",
      "1492:  }",
      "",
      "[Removed Lines]",
      "1490:      if (*skipwhite(line) == NUL)",
      "",
      "[Added Lines]",
      "1494:      if (empty_line)",
      "",
      "---------------"
    ],
    "src/testdir/test_spell_utf8.vim||src/testdir/test_spell_utf8.vim": [
      "File: src/testdir/test_spell_utf8.vim -> src/testdir/test_spell_utf8.vim",
      "--- Hunk 1 ---",
      "[Context before]",
      "802:   call delete('Xtmpfile')",
      "803: endfunc",
      "806: \" vim: shiftwidth=2 sts=2 expandtab",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "805: func Test_check_empty_line()",
      "806:   \" This was using freed memory",
      "807:   enew",
      "808:   spellgood! \ufb02",
      "809:   norm z=",
      "810:   norm yy",
      "811:   sil! norm P]svc",
      "812:   norm P]s",
      "814:   \" set 'encoding' to clear the wordt list",
      "815:   set enc=latin1",
      "816:   set enc=utf-8",
      "817:   bwipe!",
      "818: endfunc",
      "",
      "---------------"
    ],
    "src/version.c||src/version.c": [
      "File: src/version.c -> src/version.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "735: static int included_patches[] =",
      "738:     5071,",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "738:     5072,",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "ad73cc2ff2a8b5397ed20598757b702a4e686256",
      "candidate_info": {
        "commit_hash": "ad73cc2ff2a8b5397ed20598757b702a4e686256",
        "repo": "vim/vim",
        "commit_url": "https://github.com/vim/vim/commit/ad73cc2ff2a8b5397ed20598757b702a4e686256",
        "files": [
          "src/testdir/test_spell_utf8.vim",
          "src/version.c"
        ],
        "message": "patch 8.2.5074: spell test fails on MS-Windows\n\nProblem:    Spell test fails on MS-Windows.\nSolution:   Do not change 'encoding'",
        "before_after_code_files": [
          "src/testdir/test_spell_utf8.vim||src/testdir/test_spell_utf8.vim",
          "src/version.c||src/version.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/testdir/test_spell_utf8.vim||src/testdir/test_spell_utf8.vim",
            "src/version.c||src/version.c"
          ],
          "candidate": [
            "src/testdir/test_spell_utf8.vim||src/testdir/test_spell_utf8.vim",
            "src/version.c||src/version.c"
          ]
        }
      },
      "candidate_diff": {
        "src/testdir/test_spell_utf8.vim||src/testdir/test_spell_utf8.vim": [
          "File: src/testdir/test_spell_utf8.vim -> src/testdir/test_spell_utf8.vim",
          "--- Hunk 1 ---",
          "[Context before]",
          "811:   sil! norm P]svc",
          "812:   norm P]s",
          "817:   bwipe!",
          "818: endfunc",
          "",
          "[Removed Lines]",
          "814:   \" set 'encoding' to clear the wordt list",
          "815:   set enc=latin1",
          "816:   set enc=utf-8",
          "",
          "[Added Lines]",
          "814:   \" TODO: should we clear the word list?",
          "",
          "---------------"
        ],
        "src/version.c||src/version.c": [
          "File: src/version.c -> src/version.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "735: static int included_patches[] =",
          "738:     5073,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "738:     5074,",
          "",
          "---------------"
        ]
      }
    }
  ]
}