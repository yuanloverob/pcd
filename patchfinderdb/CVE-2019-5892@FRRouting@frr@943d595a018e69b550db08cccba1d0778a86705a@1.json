{
  "cve_id": "CVE-2019-5892",
  "cve_desc": "bgpd in FRRouting FRR (aka Free Range Routing) 2.x and 3.x before 3.0.4, 4.x before 4.0.1, 5.x before 5.0.2, and 6.x before 6.0.2 (not affecting Cumulus Linux or VyOS), when ENABLE_BGP_VNC is used for Virtual Network Control, allows remote attackers to cause a denial of service (peering session flap) via attribute 255 in a BGP UPDATE packet. This occurred during Disco in January 2019 because FRR does not implement RFC 7606, and therefore the packets with 255 were considered invalid VNC data and the BGP session was closed.",
  "repo": "FRRouting/frr",
  "patch_hash": "943d595a018e69b550db08cccba1d0778a86705a",
  "patch_info": {
    "commit_hash": "943d595a018e69b550db08cccba1d0778a86705a",
    "repo": "FRRouting/frr",
    "commit_url": "https://github.com/FRRouting/frr/commit/943d595a018e69b550db08cccba1d0778a86705a",
    "files": [
      "bgpd/bgp_attr.c",
      "bgpd/bgpd.h"
    ],
    "message": "bgpd: don't use BGP_ATTR_VNC(255) unless ENABLE_BGP_VNC_ATTR is defined\n\nSigned-off-by: Lou Berger <lberger@labn.net>",
    "before_after_code_files": [
      "bgpd/bgp_attr.c||bgpd/bgp_attr.c",
      "bgpd/bgpd.h||bgpd/bgpd.h"
    ]
  },
  "patch_diff": {
    "bgpd/bgp_attr.c||bgpd/bgp_attr.c": [
      "File: bgpd/bgp_attr.c -> bgpd/bgp_attr.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "78:  {BGP_ATTR_AS_PATHLIMIT, \"AS_PATHLIMIT\"},",
      "79:  {BGP_ATTR_PMSI_TUNNEL, \"PMSI_TUNNEL_ATTRIBUTE\"},",
      "80:  {BGP_ATTR_ENCAP, \"ENCAP\"},",
      "82:  {BGP_ATTR_VNC, \"VNC\"},",
      "83: #endif",
      "84:  {BGP_ATTR_LARGE_COMMUNITIES, \"LARGE_COMMUNITY\"},",
      "",
      "[Removed Lines]",
      "81: #if ENABLE_BGP_VNC",
      "",
      "[Added Lines]",
      "81: #if ENABLE_BGP_VNC_ATTR",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "2593:   case BGP_ATTR_EXT_COMMUNITIES:",
      "2594:    ret = bgp_attr_ext_communities(&attr_args);",
      "2595:    break;",
      "2597:   case BGP_ATTR_VNC:",
      "2598: #endif",
      "2599:   case BGP_ATTR_ENCAP:",
      "",
      "[Removed Lines]",
      "2596: #if ENABLE_BGP_VNC",
      "",
      "[Added Lines]",
      "2596: #if ENABLE_BGP_VNC_ATTR",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "2947:   break;",
      "2950:  case BGP_ATTR_VNC:",
      "2951:   attrname = \"VNC\";",
      "2952:   subtlvs = attr->vnc_subtlvs;",
      "",
      "[Removed Lines]",
      "2949: #if ENABLE_BGP_VNC",
      "",
      "[Added Lines]",
      "2949: #if ENABLE_BGP_VNC_ATTR",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "3434:   bgp_packet_mpattr_tea(bgp, peer, s, attr, BGP_ATTR_ENCAP);",
      "3438:   bgp_packet_mpattr_tea(bgp, peer, s, attr, BGP_ATTR_VNC);",
      "3439: #endif",
      "",
      "[Removed Lines]",
      "3436: #if ENABLE_BGP_VNC",
      "",
      "[Added Lines]",
      "3436: #if ENABLE_BGP_VNC_ATTR",
      "",
      "---------------"
    ],
    "bgpd/bgpd.h||bgpd/bgpd.h": [
      "File: bgpd/bgpd.h -> bgpd/bgpd.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "1280: #define BGP_ATTR_ENCAP                          23",
      "1281: #define BGP_ATTR_LARGE_COMMUNITIES              32",
      "1282: #define BGP_ATTR_PREFIX_SID                     40",
      "1284: #define BGP_ATTR_VNC                           255",
      "1285: #endif",
      "",
      "[Removed Lines]",
      "1283: #if ENABLE_BGP_VNC",
      "",
      "[Added Lines]",
      "1283: #if ENABLE_BGP_VNC_ATTR",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "667668d71d8a49b08cfd9cc35dffdd51fb0dcec4",
      "candidate_info": {
        "commit_hash": "667668d71d8a49b08cfd9cc35dffdd51fb0dcec4",
        "repo": "FRRouting/frr",
        "commit_url": "https://github.com/FRRouting/frr/commit/667668d71d8a49b08cfd9cc35dffdd51fb0dcec4",
        "files": [
          "bgpd/bgp_attr.c",
          "bgpd/bgpd.h"
        ],
        "message": "bgpd: don't use BGP_ATTR_VNC(255) unless ENABLE_BGP_VNC_ATTR is defined\n\nSigned-off-by: Lou Berger <lberger@labn.net>",
        "before_after_code_files": [
          "bgpd/bgp_attr.c||bgpd/bgp_attr.c",
          "bgpd/bgpd.h||bgpd/bgpd.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "bgpd/bgp_attr.c||bgpd/bgp_attr.c",
            "bgpd/bgpd.h||bgpd/bgpd.h"
          ],
          "candidate": [
            "bgpd/bgp_attr.c||bgpd/bgp_attr.c",
            "bgpd/bgpd.h||bgpd/bgpd.h"
          ]
        }
      },
      "candidate_diff": {
        "bgpd/bgp_attr.c||bgpd/bgp_attr.c": [
          "File: bgpd/bgp_attr.c -> bgpd/bgp_attr.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "74:  {BGP_ATTR_AS4_AGGREGATOR, \"AS4_AGGREGATOR\"},",
          "75:  {BGP_ATTR_AS_PATHLIMIT, \"AS_PATHLIMIT\"},",
          "76:  {BGP_ATTR_ENCAP, \"ENCAP\"},",
          "78:  {BGP_ATTR_VNC, \"VNC\"},",
          "79: #endif",
          "80:  {BGP_ATTR_LARGE_COMMUNITIES, \"LARGE_COMMUNITY\"},",
          "",
          "[Removed Lines]",
          "77: #if ENABLE_BGP_VNC",
          "",
          "[Added Lines]",
          "77: #if ENABLE_BGP_VNC_ATTR",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2455:   case BGP_ATTR_EXT_COMMUNITIES:",
          "2456:    ret = bgp_attr_ext_communities(&attr_args);",
          "2457:    break;",
          "2459:   case BGP_ATTR_VNC:",
          "2460: #endif",
          "2461:   case BGP_ATTR_ENCAP:",
          "",
          "[Removed Lines]",
          "2458: #if ENABLE_BGP_VNC",
          "",
          "[Added Lines]",
          "2458: #if ENABLE_BGP_VNC_ATTR",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "2804:   break;",
          "2807:  case BGP_ATTR_VNC:",
          "2808:   attrname = \"VNC\";",
          "2809:   subtlvs = attr->extra->vnc_subtlvs;",
          "",
          "[Removed Lines]",
          "2806: #if ENABLE_BGP_VNC",
          "",
          "[Added Lines]",
          "2806: #if ENABLE_BGP_VNC_ATTR",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "3279:   bgp_packet_mpattr_tea(bgp, peer, s, attr, BGP_ATTR_ENCAP);",
          "3283:   bgp_packet_mpattr_tea(bgp, peer, s, attr, BGP_ATTR_VNC);",
          "3284: #endif",
          "",
          "[Removed Lines]",
          "3281: #if ENABLE_BGP_VNC",
          "",
          "[Added Lines]",
          "3281: #if ENABLE_BGP_VNC_ATTR",
          "",
          "---------------"
        ],
        "bgpd/bgpd.h||bgpd/bgpd.h": [
          "File: bgpd/bgpd.h -> bgpd/bgpd.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "963: #define BGP_ATTR_AS_PATHLIMIT                   21",
          "964: #define BGP_ATTR_ENCAP                          23",
          "965: #define BGP_ATTR_LARGE_COMMUNITIES              32",
          "967: #define BGP_ATTR_VNC                           255",
          "968: #endif",
          "",
          "[Removed Lines]",
          "966: #if ENABLE_BGP_VNC",
          "",
          "[Added Lines]",
          "966: #if ENABLE_BGP_VNC_ATTR",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "d27eedb3ef376a14da9f031bf28832e672a05a31",
      "candidate_info": {
        "commit_hash": "d27eedb3ef376a14da9f031bf28832e672a05a31",
        "repo": "FRRouting/frr",
        "commit_url": "https://github.com/FRRouting/frr/commit/d27eedb3ef376a14da9f031bf28832e672a05a31",
        "files": [
          "bgpd/bgp_attr.c",
          "bgpd/bgpd.h"
        ],
        "message": "bgpd: don't use BGP_ATTR_VNC(255) unless ENABLE_BGP_VNC_ATTR is defined\n\nSigned-off-by: Lou Berger <lberger@labn.net>",
        "before_after_code_files": [
          "bgpd/bgp_attr.c||bgpd/bgp_attr.c",
          "bgpd/bgpd.h||bgpd/bgpd.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "bgpd/bgp_attr.c||bgpd/bgp_attr.c",
            "bgpd/bgpd.h||bgpd/bgpd.h"
          ],
          "candidate": [
            "bgpd/bgp_attr.c||bgpd/bgp_attr.c",
            "bgpd/bgpd.h||bgpd/bgpd.h"
          ]
        }
      },
      "candidate_diff": {
        "bgpd/bgp_attr.c||bgpd/bgp_attr.c": [
          "File: bgpd/bgp_attr.c -> bgpd/bgp_attr.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "77:  {BGP_ATTR_AS_PATHLIMIT, \"AS_PATHLIMIT\"},",
          "78:  {BGP_ATTR_PMSI_TUNNEL, \"PMSI_TUNNEL_ATTRIBUTE\"},",
          "79:  {BGP_ATTR_ENCAP, \"ENCAP\"},",
          "81:  {BGP_ATTR_VNC, \"VNC\"},",
          "82: #endif",
          "83:  {BGP_ATTR_LARGE_COMMUNITIES, \"LARGE_COMMUNITY\"},",
          "",
          "[Removed Lines]",
          "80: #if ENABLE_BGP_VNC",
          "",
          "[Added Lines]",
          "80: #if ENABLE_BGP_VNC_ATTR",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2490:   case BGP_ATTR_EXT_COMMUNITIES:",
          "2491:    ret = bgp_attr_ext_communities(&attr_args);",
          "2492:    break;",
          "2494:   case BGP_ATTR_VNC:",
          "2495: #endif",
          "2496:   case BGP_ATTR_ENCAP:",
          "",
          "[Removed Lines]",
          "2493: #if ENABLE_BGP_VNC",
          "",
          "[Added Lines]",
          "2493: #if ENABLE_BGP_VNC_ATTR",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "2841:   break;",
          "2844:  case BGP_ATTR_VNC:",
          "2845:   attrname = \"VNC\";",
          "2846:   subtlvs = attr->vnc_subtlvs;",
          "",
          "[Removed Lines]",
          "2843: #if ENABLE_BGP_VNC",
          "",
          "[Added Lines]",
          "2843: #if ENABLE_BGP_VNC_ATTR",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "3328:   bgp_packet_mpattr_tea(bgp, peer, s, attr, BGP_ATTR_ENCAP);",
          "3332:   bgp_packet_mpattr_tea(bgp, peer, s, attr, BGP_ATTR_VNC);",
          "3333: #endif",
          "",
          "[Removed Lines]",
          "3330: #if ENABLE_BGP_VNC",
          "",
          "[Added Lines]",
          "3330: #if ENABLE_BGP_VNC_ATTR",
          "",
          "---------------"
        ],
        "bgpd/bgpd.h||bgpd/bgpd.h": [
          "File: bgpd/bgpd.h -> bgpd/bgpd.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "1269: #define BGP_ATTR_ENCAP                          23",
          "1270: #define BGP_ATTR_LARGE_COMMUNITIES              32",
          "1271: #define BGP_ATTR_PREFIX_SID                     40",
          "1273: #define BGP_ATTR_VNC                           255",
          "1274: #endif",
          "",
          "[Removed Lines]",
          "1272: #if ENABLE_BGP_VNC",
          "",
          "[Added Lines]",
          "1272: #if ENABLE_BGP_VNC_ATTR",
          "",
          "---------------"
        ]
      }
    }
  ]
}