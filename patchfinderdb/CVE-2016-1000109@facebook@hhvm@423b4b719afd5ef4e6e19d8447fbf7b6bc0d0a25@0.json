{
  "cve_id": "CVE-2016-1000109",
  "cve_desc": "HHVM does not attempt to address RFC 3875 section 4.1.18 namespace conflicts and therefore does not protect CGI applications from the presence of untrusted client data in the HTTP_PROXY environment variable, which might allow remote attackers to redirect a CGI application's outbound HTTP traffic to an arbitrary proxy server via a crafted Proxy header in an HTTP request, aka an \"httpoxy\" issue. This issue affects HHVM versions prior to 3.9.6, all versions between 3.10.0 and 3.12.4 (inclusive), and all versions between 3.13.0 and 3.14.2 (inclusive).",
  "repo": "facebook/hhvm",
  "patch_hash": "423b4b719afd5ef4e6e19d8447fbf7b6bc0d0a25",
  "patch_info": {
    "commit_hash": "423b4b719afd5ef4e6e19d8447fbf7b6bc0d0a25",
    "repo": "facebook/hhvm",
    "commit_url": "https://github.com/facebook/hhvm/commit/423b4b719afd5ef4e6e19d8447fbf7b6bc0d0a25",
    "files": [
      "hphp/runtime/server/fastcgi/fastcgi-transport.cpp"
    ],
    "message": "CVE-2016-1000109: Ignore Proxy HTTP header from fastcgi requests\n\nSummary:\nThe default PHP behavior is to transform a Proxy header from requests\ninto the HTTP_PROXY environment variable in the PHP environment running the\nrequest. Some scripts may use this env var to decide which HTTP proxy to\nconnect to, and we don't want requests to have that kind of control over\nscripts' behavior.\n\nReviewed By: alexmalyshev, Orvid\n\nDifferential Revision: D3579221\n\nfbshipit-source-id: 18a405fd73aee65283aea99ff995f8082b3fc3b5",
    "before_after_code_files": [
      "hphp/runtime/server/fastcgi/fastcgi-transport.cpp||hphp/runtime/server/fastcgi/fastcgi-transport.cpp"
    ]
  },
  "patch_diff": {
    "hphp/runtime/server/fastcgi/fastcgi-transport.cpp||hphp/runtime/server/fastcgi/fastcgi-transport.cpp": [
      "File: hphp/runtime/server/fastcgi/fastcgi-transport.cpp -> hphp/runtime/server/fastcgi/fastcgi-transport.cpp",
      "--- Hunk 1 ---",
      "[Context before]",
      "212:   Cursor keyCur(key_chain.get());",
      "213:   auto key = keyCur.readFixedString(key_chain->computeChainDataLength());",
      "215:   Cursor valCur(value_chain.get());",
      "216:   auto value = valCur.readFixedString(value_chain->computeChainDataLength());",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "217:   if (strcasecmp(key.c_str(), \"HTTP_PROXY\") == 0) return;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "ee6da9009728f73caa517bb8effddbed4a65f180",
      "candidate_info": {
        "commit_hash": "ee6da9009728f73caa517bb8effddbed4a65f180",
        "repo": "facebook/hhvm",
        "commit_url": "https://github.com/facebook/hhvm/commit/ee6da9009728f73caa517bb8effddbed4a65f180",
        "files": [
          "hphp/runtime/server/fastcgi/fastcgi-transport.cpp"
        ],
        "message": "CVE-2016-1000109: Ignore Proxy HTTP header from fastcgi requests\n\nThe default PHP behavior is to transform a Proxy header from requests\ninto the HTTP_PROXY environment variable in the PHP environment running the\nrequest. Some scripts may use this env var to decide which HTTP proxy to\nconnect to, and we don't want requests to have that kind of control over\nscripts' behavior.",
        "before_after_code_files": [
          "hphp/runtime/server/fastcgi/fastcgi-transport.cpp||hphp/runtime/server/fastcgi/fastcgi-transport.cpp"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_olp_changes": 1,
        "olp_code_files": {
          "patch": [
            "hphp/runtime/server/fastcgi/fastcgi-transport.cpp||hphp/runtime/server/fastcgi/fastcgi-transport.cpp"
          ],
          "candidate": [
            "hphp/runtime/server/fastcgi/fastcgi-transport.cpp||hphp/runtime/server/fastcgi/fastcgi-transport.cpp"
          ]
        }
      },
      "candidate_diff": {
        "hphp/runtime/server/fastcgi/fastcgi-transport.cpp||hphp/runtime/server/fastcgi/fastcgi-transport.cpp": [
          "File: hphp/runtime/server/fastcgi/fastcgi-transport.cpp -> hphp/runtime/server/fastcgi/fastcgi-transport.cpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "212:   Cursor keyCur(key_chain.get());",
          "213:   auto key = keyCur.readFixedString(key_chain->computeChainDataLength());",
          "215:   Cursor valCur(value_chain.get());",
          "216:   auto value = valCur.readFixedString(value_chain->computeChainDataLength());",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "217:   if (strcasecmp(key.c_str(), \"HTTP_PROXY\") == 0) return;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "5fc9794d4f8582653c6c5ba87ded87646a5ff740",
      "candidate_info": {
        "commit_hash": "5fc9794d4f8582653c6c5ba87ded87646a5ff740",
        "repo": "facebook/hhvm",
        "commit_url": "https://github.com/facebook/hhvm/commit/5fc9794d4f8582653c6c5ba87ded87646a5ff740",
        "files": [
          "hphp/runtime/server/fastcgi/fastcgi-transport.cpp"
        ],
        "message": "CVE-2016-1000109: Ignore Proxy HTTP header from fastcgi requests\n\nThe default PHP behavior is to transform a Proxy header from requests\ninto the HTTP_PROXY environment variable in the PHP environment running the\nrequest. Some scripts may use this env var to decide which HTTP proxy to\nconnect to, and we don't want requests to have that kind of control over\nscripts' behavior.",
        "before_after_code_files": [
          "hphp/runtime/server/fastcgi/fastcgi-transport.cpp||hphp/runtime/server/fastcgi/fastcgi-transport.cpp"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_olp_changes": 1,
        "olp_code_files": {
          "patch": [
            "hphp/runtime/server/fastcgi/fastcgi-transport.cpp||hphp/runtime/server/fastcgi/fastcgi-transport.cpp"
          ],
          "candidate": [
            "hphp/runtime/server/fastcgi/fastcgi-transport.cpp||hphp/runtime/server/fastcgi/fastcgi-transport.cpp"
          ]
        }
      },
      "candidate_diff": {
        "hphp/runtime/server/fastcgi/fastcgi-transport.cpp||hphp/runtime/server/fastcgi/fastcgi-transport.cpp": [
          "File: hphp/runtime/server/fastcgi/fastcgi-transport.cpp -> hphp/runtime/server/fastcgi/fastcgi-transport.cpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "212:   Cursor keyCur(key_chain.get());",
          "213:   auto key = keyCur.readFixedString(key_chain->computeChainDataLength());",
          "215:   Cursor valCur(value_chain.get());",
          "216:   auto value = valCur.readFixedString(value_chain->computeChainDataLength());",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "217:   if (strcasecmp(key.c_str(), \"HTTP_PROXY\") == 0) return;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "b87e8ca46555c8532b820e91b256259cd4ff157d",
      "candidate_info": {
        "commit_hash": "b87e8ca46555c8532b820e91b256259cd4ff157d",
        "repo": "facebook/hhvm",
        "commit_url": "https://github.com/facebook/hhvm/commit/b87e8ca46555c8532b820e91b256259cd4ff157d",
        "files": [
          "hphp/runtime/server/fastcgi/fastcgi-transport.cpp"
        ],
        "message": "CVE-2016-1000109: Ignore Proxy HTTP header from fastcgi requests\n\nThe default PHP behavior is to transform a Proxy header from requests\ninto the HTTP_PROXY environment variable in the PHP environment running the\nrequest. Some scripts may use this env var to decide which HTTP proxy to\nconnect to, and we don't want requests to have that kind of control over\nscripts' behavior.",
        "before_after_code_files": [
          "hphp/runtime/server/fastcgi/fastcgi-transport.cpp||hphp/runtime/server/fastcgi/fastcgi-transport.cpp"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_olp_changes": 1,
        "olp_code_files": {
          "patch": [
            "hphp/runtime/server/fastcgi/fastcgi-transport.cpp||hphp/runtime/server/fastcgi/fastcgi-transport.cpp"
          ],
          "candidate": [
            "hphp/runtime/server/fastcgi/fastcgi-transport.cpp||hphp/runtime/server/fastcgi/fastcgi-transport.cpp"
          ]
        }
      },
      "candidate_diff": {
        "hphp/runtime/server/fastcgi/fastcgi-transport.cpp||hphp/runtime/server/fastcgi/fastcgi-transport.cpp": [
          "File: hphp/runtime/server/fastcgi/fastcgi-transport.cpp -> hphp/runtime/server/fastcgi/fastcgi-transport.cpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "212:   Cursor keyCur(key_chain.get());",
          "213:   auto key = keyCur.readFixedString(key_chain->computeChainDataLength());",
          "215:   Cursor valCur(value_chain.get());",
          "216:   auto value = valCur.readFixedString(value_chain->computeChainDataLength());",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "217:   if (strcasecmp(key.c_str(), \"HTTP_PROXY\") == 0) return;",
          "",
          "---------------"
        ]
      }
    }
  ]
}