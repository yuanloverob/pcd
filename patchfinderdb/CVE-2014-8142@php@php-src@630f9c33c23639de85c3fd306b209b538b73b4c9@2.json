{
  "cve_id": "CVE-2014-8142",
  "cve_desc": "Use-after-free vulnerability in the process_nested_data function in ext/standard/var_unserializer.re in PHP before 5.4.36, 5.5.x before 5.5.20, and 5.6.x before 5.6.4 allows remote attackers to execute arbitrary code via a crafted unserialize call that leverages improper handling of duplicate keys within the serialized properties of an object, a different vulnerability than CVE-2004-1019.",
  "repo": "php/php-src",
  "patch_hash": "630f9c33c23639de85c3fd306b209b538b73b4c9",
  "patch_info": {
    "commit_hash": "630f9c33c23639de85c3fd306b209b538b73b4c9",
    "repo": "php/php-src",
    "commit_url": "https://github.com/php/php-src/commit/630f9c33c23639de85c3fd306b209b538b73b4c9",
    "files": [
      "NEWS",
      "ext/standard/tests/serialize/bug68594.phpt",
      "ext/standard/var_unserializer.c",
      "ext/standard/var_unserializer.re"
    ],
    "message": "Fix bug #68594 - Use after free vulnerability in unserialize()",
    "before_after_code_files": [
      "ext/standard/tests/serialize/bug68594.phpt||ext/standard/tests/serialize/bug68594.phpt",
      "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
      "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
    ]
  },
  "patch_diff": {
    "ext/standard/tests/serialize/bug68594.phpt||ext/standard/tests/serialize/bug68594.phpt": [
      "File: ext/standard/tests/serialize/bug68594.phpt -> ext/standard/tests/serialize/bug68594.phpt",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: --TEST--",
      "2: Bug #68545 Use after free vulnerability in unserialize()",
      "3: --FILE--",
      "4: <?php",
      "5: for ($i=4; $i<100; $i++) {",
      "6:  $m = new StdClass();",
      "8:  $u = array(1);",
      "10:  $m->aaa = array(1,2,&$u,4,5);",
      "11:  $m->bbb = 1;",
      "12:  $m->ccc = &$u;",
      "13:  $m->ddd = str_repeat(\"A\", $i);",
      "15:  $z = serialize($m);",
      "16:  $z = str_replace(\"bbb\", \"aaa\", $z);",
      "17:  $y = unserialize($z);",
      "18:  $z = serialize($y);",
      "19: }",
      "20: ?>",
      "21: ===DONE===",
      "22: --EXPECTF--",
      "23: ===DONE===",
      "",
      "---------------"
    ],
    "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
      "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "343:   } else {",
      "345:    convert_to_string(key);",
      "346:    zend_hash_update(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, &data,",
      "347:      sizeof data, NULL);",
      "348:   }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "346:    if (zend_symtable_find(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, (void **)&old_data)==SUCCESS) {",
      "347:     var_push_dtor(var_hash, old_data);",
      "348:    }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "484: {",
      "485:  YYCTYPE yych;",
      "486:  static const unsigned char yybm[] = {",
      "",
      "[Removed Lines]",
      "483: #line 484 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "486: #line 487 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "540:  yych = *(YYMARKER = ++YYCURSOR);",
      "541:  if (yych == ':') goto yy95;",
      "542: yy3:",
      "544:  { return 0; }",
      "546: yy4:",
      "547:  yych = *(YYMARKER = ++YYCURSOR);",
      "548:  if (yych == ':') goto yy89;",
      "",
      "[Removed Lines]",
      "543: #line 835 \"ext/standard/var_unserializer.re\"",
      "545: #line 546 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "546: #line 838 \"ext/standard/var_unserializer.re\"",
      "548: #line 549 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "585:  goto yy3;",
      "586: yy14:",
      "587:  ++YYCURSOR;",
      "589:  {",
      "591:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
      "593: }",
      "595: yy16:",
      "596:  yych = *++YYCURSOR;",
      "597:  goto yy3;",
      "",
      "[Removed Lines]",
      "588: #line 829 \"ext/standard/var_unserializer.re\"",
      "594: #line 595 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "591: #line 832 \"ext/standard/var_unserializer.re\"",
      "597: #line 598 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "617:  if (yybm[0+yych] & 128) {",
      "618:   goto yy20;",
      "619:  }",
      "621:  yych = *++YYCURSOR;",
      "622:  if (yych != '\"') goto yy18;",
      "623:  ++YYCURSOR;",
      "625:  {",
      "626:  size_t len, len2, len3, maxlen;",
      "627:  long elements;",
      "",
      "[Removed Lines]",
      "620:  if (yych != ':') goto yy18;",
      "624: #line 683 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "623:  if (yych <= '/') goto yy18;",
      "624:  if (yych >= ';') goto yy18;",
      "628: #line 686 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "768:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
      "769: }",
      "771: yy25:",
      "772:  yych = *++YYCURSOR;",
      "773:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "770: #line 771 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "774: #line 775 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "792:  yych = *++YYCURSOR;",
      "793:  if (yych != '\"') goto yy18;",
      "794:  ++YYCURSOR;",
      "796:  {",
      "798:  INIT_PZVAL(*rval);",
      "",
      "[Removed Lines]",
      "795: #line 675 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "799: #line 678 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 8 ---",
      "[Context before]",
      "800:  return object_common2(UNSERIALIZE_PASSTHRU,",
      "801:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
      "802: }",
      "804: yy32:",
      "805:  yych = *++YYCURSOR;",
      "806:  if (yych == '+') goto yy33;",
      "",
      "[Removed Lines]",
      "803: #line 804 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "807: #line 808 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 9 ---",
      "[Context before]",
      "821:  yych = *++YYCURSOR;",
      "822:  if (yych != '{') goto yy18;",
      "823:  ++YYCURSOR;",
      "825:  {",
      "826:  long elements = parse_iv(start + 2);",
      "",
      "[Removed Lines]",
      "824: #line 655 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "828: #line 658 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 10 ---",
      "[Context before]",
      "842:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
      "843: }",
      "845: yy39:",
      "846:  yych = *++YYCURSOR;",
      "847:  if (yych == '+') goto yy40;",
      "",
      "[Removed Lines]",
      "844: #line 845 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "848: #line 849 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 11 ---",
      "[Context before]",
      "862:  yych = *++YYCURSOR;",
      "863:  if (yych != '\"') goto yy18;",
      "864:  ++YYCURSOR;",
      "866:  {",
      "867:  size_t len, maxlen;",
      "868:  char *str;",
      "",
      "[Removed Lines]",
      "865: #line 626 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "869: #line 629 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 12 ---",
      "[Context before]",
      "891:  ZVAL_STRINGL(*rval, str, len, 0);",
      "892:  return 1;",
      "893: }",
      "895: yy46:",
      "896:  yych = *++YYCURSOR;",
      "897:  if (yych == '+') goto yy47;",
      "",
      "[Removed Lines]",
      "894: #line 895 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "898: #line 899 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 13 ---",
      "[Context before]",
      "912:  yych = *++YYCURSOR;",
      "913:  if (yych != '\"') goto yy18;",
      "914:  ++YYCURSOR;",
      "916:  {",
      "917:  size_t len, maxlen;",
      "918:  char *str;",
      "",
      "[Removed Lines]",
      "915: #line 598 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "919: #line 601 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 14 ---",
      "[Context before]",
      "940:  ZVAL_STRINGL(*rval, str, len, 1);",
      "941:  return 1;",
      "942: }",
      "944: yy53:",
      "945:  yych = *++YYCURSOR;",
      "946:  if (yych <= '/') {",
      "",
      "[Removed Lines]",
      "943: #line 944 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "947: #line 948 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 15 ---",
      "[Context before]",
      "1028:  }",
      "1029: yy63:",
      "1030:  ++YYCURSOR;",
      "1032:  {",
      "1033: #if SIZEOF_LONG == 4",
      "1034: use_double:",
      "",
      "[Removed Lines]",
      "1031: #line 588 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1035: #line 591 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 16 ---",
      "[Context before]",
      "1038:  ZVAL_DOUBLE(*rval, zend_strtod((const char *)start + 2, NULL));",
      "1039:  return 1;",
      "1040: }",
      "1042: yy65:",
      "1043:  yych = *++YYCURSOR;",
      "1044:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1041: #line 1042 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1045: #line 1046 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 17 ---",
      "[Context before]",
      "1097:  yych = *++YYCURSOR;",
      "1098:  if (yych != ';') goto yy18;",
      "1099:  ++YYCURSOR;",
      "1101:  {",
      "1103:  INIT_PZVAL(*rval);",
      "",
      "[Removed Lines]",
      "1100: #line 573 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1104: #line 576 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 18 ---",
      "[Context before]",
      "1113:  return 1;",
      "1114: }",
      "1116: yy76:",
      "1117:  yych = *++YYCURSOR;",
      "1118:  if (yych == 'N') goto yy73;",
      "",
      "[Removed Lines]",
      "1115: #line 1116 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1119: #line 1120 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 19 ---",
      "[Context before]",
      "1139:  if (yych <= '9') goto yy79;",
      "1140:  if (yych != ';') goto yy18;",
      "1141:  ++YYCURSOR;",
      "1143:  {",
      "1144: #if SIZEOF_LONG == 4",
      "1145:  int digits = YYCURSOR - start - 3;",
      "",
      "[Removed Lines]",
      "1142: #line 546 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1146: #line 549 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 20 ---",
      "[Context before]",
      "1166:  ZVAL_LONG(*rval, parse_iv(start + 2));",
      "1167:  return 1;",
      "1168: }",
      "1170: yy83:",
      "1171:  yych = *++YYCURSOR;",
      "1172:  if (yych <= '/') goto yy18;",
      "",
      "[Removed Lines]",
      "1169: #line 1170 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1173: #line 1174 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 21 ---",
      "[Context before]",
      "1174:  yych = *++YYCURSOR;",
      "1175:  if (yych != ';') goto yy18;",
      "1176:  ++YYCURSOR;",
      "1178:  {",
      "1180:  INIT_PZVAL(*rval);",
      "1181:  ZVAL_BOOL(*rval, parse_iv(start + 2));",
      "1182:  return 1;",
      "1183: }",
      "1185: yy87:",
      "1186:  ++YYCURSOR;",
      "1188:  {",
      "1190:  INIT_PZVAL(*rval);",
      "1191:  ZVAL_NULL(*rval);",
      "1192:  return 1;",
      "1193: }",
      "1195: yy89:",
      "1196:  yych = *++YYCURSOR;",
      "1197:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1177: #line 539 \"ext/standard/var_unserializer.re\"",
      "1184: #line 1185 \"ext/standard/var_unserializer.c\"",
      "1187: #line 532 \"ext/standard/var_unserializer.re\"",
      "1194: #line 1195 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1181: #line 542 \"ext/standard/var_unserializer.re\"",
      "1188: #line 1189 \"ext/standard/var_unserializer.c\"",
      "1191: #line 535 \"ext/standard/var_unserializer.re\"",
      "1198: #line 1199 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 22 ---",
      "[Context before]",
      "1214:  if (yych <= '9') goto yy91;",
      "1215:  if (yych != ';') goto yy18;",
      "1216:  ++YYCURSOR;",
      "1218:  {",
      "1219:  long id;",
      "",
      "[Removed Lines]",
      "1217: #line 509 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1221: #line 512 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 23 ---",
      "[Context before]",
      "1238:  return 1;",
      "1239: }",
      "1241: yy95:",
      "1242:  yych = *++YYCURSOR;",
      "1243:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1240: #line 1241 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1244: #line 1245 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 24 ---",
      "[Context before]",
      "1260:  if (yych <= '9') goto yy97;",
      "1261:  if (yych != ';') goto yy18;",
      "1262:  ++YYCURSOR;",
      "1264:  {",
      "1265:  long id;",
      "",
      "[Removed Lines]",
      "1263: #line 488 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1267: #line 491 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 25 ---",
      "[Context before]",
      "1282:  return 1;",
      "1283: }",
      "1285: }",
      "1289:  return 0;",
      "",
      "[Removed Lines]",
      "1284: #line 1285 \"ext/standard/var_unserializer.c\"",
      "1286: #line 837 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1288: #line 1289 \"ext/standard/var_unserializer.c\"",
      "1290: #line 840 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------"
    ],
    "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
      "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
      "--- Hunk 1 ---",
      "[Context before]",
      "347:   } else {",
      "349:    convert_to_string(key);",
      "350:    zend_hash_update(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, &data,",
      "351:      sizeof data, NULL);",
      "352:   }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "350:    if (zend_symtable_find(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, (void **)&old_data)==SUCCESS) {",
      "351:     var_push_dtor(var_hash, old_data);",
      "352:    }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "4a82cdce6633ec8d7bb5ffdbe726e14e9d70e512",
      "candidate_info": {
        "commit_hash": "4a82cdce6633ec8d7bb5ffdbe726e14e9d70e512",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/4a82cdce6633ec8d7bb5ffdbe726e14e9d70e512",
        "files": [
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re",
          "standard/tests/serialize/bug68545.phpt"
        ],
        "message": "Merge branch 'PHP-5.5' into PHP-5.6\n\n* PHP-5.5:\n  Fixed bug #68545 NULL pointer dereference in unserialize.c\n\nConflicts:\n\text/standard/var_unserializer.c",
        "before_after_code_files": [
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re",
          "standard/tests/serialize/bug68545.phpt||standard/tests/serialize/bug68545.phpt"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "61: PHPAPI void var_push_dtor(php_unserialize_data_t *var_hashx, zval **rval)",
          "62: {",
          "64: #if VAR_ENTRIES_DBG",
          "65:  fprintf(stderr, \"var_push_dtor(%ld): %d\\n\", var_hash?var_hash->used_slots:-1L, Z_TYPE_PP(rval));",
          "66: #endif",
          "",
          "[Removed Lines]",
          "63:  var_entries *var_hash = (*var_hashx)->last_dtor;",
          "",
          "[Added Lines]",
          "63:  var_entries *var_hash;",
          "65:  if (!var_hashx || !*var_hashx) {",
          "66:   return;",
          "67:  }",
          "69:  var_hash = (*var_hashx)->last_dtor;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "226: #define YYMARKER marker",
          "",
          "[Removed Lines]",
          "229: #line 234 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "235: #line 240 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "473: {",
          "474:  YYCTYPE yych;",
          "475:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "472: #line 473 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "478: #line 479 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "529:  yych = *(YYMARKER = ++YYCURSOR);",
          "530:  if (yych == ':') goto yy95;",
          "531: yy3:",
          "533:  { return 0; }",
          "535: yy4:",
          "536:  yych = *(YYMARKER = ++YYCURSOR);",
          "537:  if (yych == ':') goto yy89;",
          "",
          "[Removed Lines]",
          "532: #line 824 \"ext/standard/var_unserializer.re\"",
          "534: #line 535 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "538: #line 830 \"ext/standard/var_unserializer.re\"",
          "540: #line 541 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "574:  goto yy3;",
          "575: yy14:",
          "576:  ++YYCURSOR;",
          "578:  {",
          "580:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
          "582: }",
          "584: yy16:",
          "585:  yych = *++YYCURSOR;",
          "586:  goto yy3;",
          "",
          "[Removed Lines]",
          "577: #line 818 \"ext/standard/var_unserializer.re\"",
          "583: #line 584 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "583: #line 824 \"ext/standard/var_unserializer.re\"",
          "589: #line 590 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "610:  yych = *++YYCURSOR;",
          "611:  if (yych != '\"') goto yy18;",
          "612:  ++YYCURSOR;",
          "614:  {",
          "615:  size_t len, len2, len3, maxlen;",
          "616:  long elements;",
          "",
          "[Removed Lines]",
          "613: #line 672 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "619: #line 678 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "757:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "758: }",
          "760: yy25:",
          "761:  yych = *++YYCURSOR;",
          "762:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "759: #line 760 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "765: #line 766 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "781:  yych = *++YYCURSOR;",
          "782:  if (yych != '\"') goto yy18;",
          "783:  ++YYCURSOR;",
          "785:  {",
          "787:  INIT_PZVAL(*rval);",
          "",
          "[Removed Lines]",
          "784: #line 664 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "790: #line 670 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "789:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "790:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "791: }",
          "793: yy32:",
          "794:  yych = *++YYCURSOR;",
          "795:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "792: #line 793 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "798: #line 799 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "810:  yych = *++YYCURSOR;",
          "811:  if (yych != '{') goto yy18;",
          "812:  ++YYCURSOR;",
          "814:  {",
          "815:  long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "813: #line 644 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "819: #line 650 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "831:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "832: }",
          "834: yy39:",
          "835:  yych = *++YYCURSOR;",
          "836:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "833: #line 834 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "839: #line 840 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "851:  yych = *++YYCURSOR;",
          "852:  if (yych != '\"') goto yy18;",
          "853:  ++YYCURSOR;",
          "855:  {",
          "856:  size_t len, maxlen;",
          "857:  char *str;",
          "",
          "[Removed Lines]",
          "854: #line 615 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "860: #line 621 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "880:  ZVAL_STRINGL(*rval, str, len, 0);",
          "881:  return 1;",
          "882: }",
          "884: yy46:",
          "885:  yych = *++YYCURSOR;",
          "886:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "883: #line 884 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "889: #line 890 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "901:  yych = *++YYCURSOR;",
          "902:  if (yych != '\"') goto yy18;",
          "903:  ++YYCURSOR;",
          "905:  {",
          "906:  size_t len, maxlen;",
          "907:  char *str;",
          "",
          "[Removed Lines]",
          "904: #line 587 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "910: #line 593 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "929:  ZVAL_STRINGL(*rval, str, len, 1);",
          "930:  return 1;",
          "931: }",
          "933: yy53:",
          "934:  yych = *++YYCURSOR;",
          "935:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "932: #line 933 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "938: #line 939 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1017:  }",
          "1018: yy63:",
          "1019:  ++YYCURSOR;",
          "1021:  {",
          "1022: #if SIZEOF_LONG == 4",
          "1023: use_double:",
          "",
          "[Removed Lines]",
          "1020: #line 577 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1026: #line 583 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1027:  ZVAL_DOUBLE(*rval, zend_strtod((const char *)start + 2, NULL));",
          "1028:  return 1;",
          "1029: }",
          "1031: yy65:",
          "1032:  yych = *++YYCURSOR;",
          "1033:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1030: #line 1031 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1036: #line 1037 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "1086:  yych = *++YYCURSOR;",
          "1087:  if (yych != ';') goto yy18;",
          "1088:  ++YYCURSOR;",
          "1090:  {",
          "1092:  INIT_PZVAL(*rval);",
          "",
          "[Removed Lines]",
          "1089: #line 562 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1095: #line 568 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1102:  return 1;",
          "1103: }",
          "1105: yy76:",
          "1106:  yych = *++YYCURSOR;",
          "1107:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1104: #line 1105 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1110: #line 1111 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1128:  if (yych <= '9') goto yy79;",
          "1129:  if (yych != ';') goto yy18;",
          "1130:  ++YYCURSOR;",
          "1132:  {",
          "1133: #if SIZEOF_LONG == 4",
          "1134:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1131: #line 535 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1137: #line 541 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "1155:  ZVAL_LONG(*rval, parse_iv(start + 2));",
          "1156:  return 1;",
          "1157: }",
          "1159: yy83:",
          "1160:  yych = *++YYCURSOR;",
          "1161:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1158: #line 1159 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1164: #line 1165 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "1163:  yych = *++YYCURSOR;",
          "1164:  if (yych != ';') goto yy18;",
          "1165:  ++YYCURSOR;",
          "1167:  {",
          "1169:  INIT_PZVAL(*rval);",
          "1170:  ZVAL_BOOL(*rval, parse_iv(start + 2));",
          "1171:  return 1;",
          "1172: }",
          "1174: yy87:",
          "1175:  ++YYCURSOR;",
          "1177:  {",
          "1179:  INIT_PZVAL(*rval);",
          "1180:  ZVAL_NULL(*rval);",
          "1181:  return 1;",
          "1182: }",
          "1184: yy89:",
          "1185:  yych = *++YYCURSOR;",
          "1186:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1166: #line 528 \"ext/standard/var_unserializer.re\"",
          "1173: #line 1174 \"ext/standard/var_unserializer.c\"",
          "1176: #line 521 \"ext/standard/var_unserializer.re\"",
          "1183: #line 1184 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1172: #line 534 \"ext/standard/var_unserializer.re\"",
          "1179: #line 1180 \"ext/standard/var_unserializer.c\"",
          "1182: #line 527 \"ext/standard/var_unserializer.re\"",
          "1189: #line 1190 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "1203:  if (yych <= '9') goto yy91;",
          "1204:  if (yych != ';') goto yy18;",
          "1205:  ++YYCURSOR;",
          "1207:  {",
          "1208:  long id;",
          "",
          "[Removed Lines]",
          "1206: #line 498 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1212: #line 504 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "1227:  return 1;",
          "1228: }",
          "1230: yy95:",
          "1231:  yych = *++YYCURSOR;",
          "1232:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1229: #line 1230 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1235: #line 1236 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 25 ---",
          "[Context before]",
          "1249:  if (yych <= '9') goto yy97;",
          "1250:  if (yych != ';') goto yy18;",
          "1251:  ++YYCURSOR;",
          "1253:  {",
          "1254:  long id;",
          "",
          "[Removed Lines]",
          "1252: #line 477 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1258: #line 483 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 26 ---",
          "[Context before]",
          "1271:  return 1;",
          "1272: }",
          "1274: }",
          "1278:  return 0;",
          "",
          "[Removed Lines]",
          "1273: #line 1274 \"ext/standard/var_unserializer.c\"",
          "1275: #line 826 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1279: #line 1280 \"ext/standard/var_unserializer.c\"",
          "1281: #line 832 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "59: PHPAPI void var_push_dtor(php_unserialize_data_t *var_hashx, zval **rval)",
          "60: {",
          "62: #if VAR_ENTRIES_DBG",
          "63:  fprintf(stderr, \"var_push_dtor(%ld): %d\\n\", var_hash?var_hash->used_slots:-1L, Z_TYPE_PP(rval));",
          "64: #endif",
          "",
          "[Removed Lines]",
          "61:  var_entries *var_hash = (*var_hashx)->last_dtor;",
          "",
          "[Added Lines]",
          "61:  var_entries *var_hash;",
          "63:  if (!var_hashx || !*var_hashx) {",
          "64:   return;",
          "65:  }",
          "67:  var_hash = (*var_hashx)->last_dtor;",
          "",
          "---------------"
        ],
        "standard/tests/serialize/bug68545.phpt||standard/tests/serialize/bug68545.phpt": [
          "File: standard/tests/serialize/bug68545.phpt -> standard/tests/serialize/bug68545.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #68545 NULL pointer dereference in unserialize.c:var_push_dtor",
          "3: --FILE--",
          "4: <?php",
          "5: var_dump(unserialize('a:6:{a:6:{s:3:\"322\";s:3:\"bar\";s:3:\"bar\";s:3:\"foo\";a:6:{a:6:{s:3:\"322\";s:3:\"bar\";s:3:\"bar\";s:3:\"foo\";s:3:\"bar\";a:6:{a:6:{s:3:\"322\";s:3:\"bar\";s:3:\"bar\";s:3:\"foo\";a:6:{a:6:{s:3:\"322\";s:3:\"bar\";s:3:\"b22\";s:3:\"bar\";s:3:\"bar\";s:3:\"foo\";s:3:\"bar\";a:6:{a:6:{s:3:\"322\";s:3:\"bar\";s:3:\"bar\";s:3:\"foo\";s:3:\"bar\";s:3:\"bar\";'));",
          "6: ?>",
          "7: ===DONE===",
          "8: --EXPECTF--",
          "9: Notice: unserialize(): Error at offset %d of %d bytes in %sbug68545.php on line %d",
          "10: bool(false)",
          "11: ===DONE===",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "6a6cdecbdbe0846451eaee38f7bc55a81c651d80",
      "candidate_info": {
        "commit_hash": "6a6cdecbdbe0846451eaee38f7bc55a81c651d80",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/6a6cdecbdbe0846451eaee38f7bc55a81c651d80",
        "files": [
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Improved unserialize()",
        "before_after_code_files": [
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "322: #define UNSERIALIZE_PARAMETER zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash, HashTable *classes",
          "323: #define UNSERIALIZE_PASSTHRU rval, p, max, var_hash, classes",
          "326: {",
          "327:  while (elements-- > 0) {",
          "328:   zval key, *data, d, *old_data;",
          "330:   ZVAL_UNDEF(&key);",
          "",
          "[Removed Lines]",
          "325: static inline int process_nested_data(UNSERIALIZE_PARAMETER, HashTable *ht, zend_long elements, int objprops)",
          "",
          "[Added Lines]",
          "325: static zend_always_inline int process_nested_data(UNSERIALIZE_PARAMETER, HashTable *ht, zend_long elements, int objprops)",
          "329:   zend_ulong idx;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "334:    return 0;",
          "335:   }",
          "342:   data = NULL;",
          "343:   ZVAL_UNDEF(&d);",
          "345:   if (!objprops) {",
          "350:      var_push_dtor(var_hash, old_data);",
          "351:     }",
          "357:      var_push_dtor(var_hash, old_data);",
          "358:     }",
          "361:    }",
          "362:   } else {",
          "368:     }",
          "372:   }",
          "374:   zval_dtor(&key);",
          "",
          "[Removed Lines]",
          "337:   if (Z_TYPE(key) != IS_LONG && Z_TYPE(key) != IS_STRING) {",
          "338:    zval_dtor(&key);",
          "339:    return 0;",
          "340:   }",
          "346:    switch (Z_TYPE(key)) {",
          "347:    case IS_LONG:",
          "348:     if ((old_data = zend_hash_index_find(ht, Z_LVAL(key))) != NULL) {",
          "352:     data = zend_hash_index_update(ht, Z_LVAL(key), &d);",
          "353:     break;",
          "354:    case IS_STRING:",
          "355:     if ((old_data = zend_symtable_find(ht, Z_STR(key))) != NULL) {",
          "359:     data = zend_symtable_update(ht, Z_STR(key), &d);",
          "360:     break;",
          "364:    convert_to_string(&key);",
          "365:    if ((old_data = zend_hash_find(ht, Z_STR(key))) != NULL) {",
          "366:     if (Z_TYPE_P(old_data) == IS_INDIRECT) {",
          "367:      old_data = Z_INDIRECT_P(old_data);",
          "369:     var_push_dtor(var_hash, old_data);",
          "370:    }",
          "371:    data = zend_hash_update_ind(ht, Z_STR(key), &d);",
          "",
          "[Added Lines]",
          "342:    if (Z_TYPE(key) == IS_LONG) {",
          "343:     idx = Z_LVAL(key);",
          "344: numeric_key:",
          "345:     if (UNEXPECTED((old_data = zend_hash_index_find(ht, idx)) != NULL)) {",
          "348:      data = zend_hash_index_update(ht, idx, &d);",
          "349:     } else {",
          "350:      data = zend_hash_index_add_new(ht, idx, &d);",
          "351:     }",
          "352:    } else if (Z_TYPE(key) == IS_STRING) {",
          "353:     if (UNEXPECTED(ZEND_HANDLE_NUMERIC(Z_STR(key), idx))) {",
          "354:      goto numeric_key;",
          "356:     if (UNEXPECTED((old_data = zend_hash_find(ht, Z_STR(key))) != NULL)) {",
          "359:      data = zend_hash_update(ht, Z_STR(key), &d);",
          "360:     } else {",
          "361:      data = zend_hash_add_new(ht, Z_STR(key), &d);",
          "363:    } else {",
          "364:     zval_dtor(&key);",
          "365:     return 0;",
          "368:    if (EXPECTED(Z_TYPE(key) == IS_STRING)) {",
          "369: string_key:",
          "370:     if ((old_data = zend_hash_find(ht, Z_STR(key))) != NULL) {",
          "371:      if (Z_TYPE_P(old_data) == IS_INDIRECT) {",
          "372:       old_data = Z_INDIRECT_P(old_data);",
          "373:      }",
          "374:      var_push_dtor(var_hash, old_data);",
          "375:      data = zend_hash_update_ind(ht, Z_STR(key), &d);",
          "376:     } else {",
          "377:      data = zend_hash_add_new(ht, Z_STR(key), &d);",
          "379:    } else if (Z_TYPE(key) == IS_LONG) {",
          "381:     convert_to_string(&key);",
          "382:     goto string_key;",
          "383:    } else {",
          "384:     zval_dtor(&key);",
          "385:     return 0;",
          "386:    }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "507:  start = cursor;",
          "511: {",
          "512:  YYCTYPE yych;",
          "513:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "510: #line 511 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "525: #line 526 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "567:  yych = *(YYMARKER = ++YYCURSOR);",
          "568:  if (yych == ':') goto yy95;",
          "569: yy3:",
          "571:  { return 0; }",
          "573: yy4:",
          "574:  yych = *(YYMARKER = ++YYCURSOR);",
          "575:  if (yych == ':') goto yy89;",
          "",
          "[Removed Lines]",
          "570: #line 858 \"ext/standard/var_unserializer.re\"",
          "572: #line 573 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "585: #line 873 \"ext/standard/var_unserializer.re\"",
          "587: #line 588 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "612:  goto yy3;",
          "613: yy14:",
          "614:  ++YYCURSOR;",
          "616:  {",
          "618:  php_error_docref(NULL, E_NOTICE, \"Unexpected end of serialized data\");",
          "620: }",
          "622: yy16:",
          "623:  yych = *++YYCURSOR;",
          "624:  goto yy3;",
          "",
          "[Removed Lines]",
          "615: #line 852 \"ext/standard/var_unserializer.re\"",
          "621: #line 622 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "630: #line 867 \"ext/standard/var_unserializer.re\"",
          "636: #line 637 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "644:  if (yybm[0+yych] & 128) {",
          "645:   goto yy20;",
          "646:  }",
          "649:  yych = *++YYCURSOR;",
          "650:  if (yych != '\"') goto yy18;",
          "651:  ++YYCURSOR;",
          "653:  {",
          "654:  size_t len, len2, len3, maxlen;",
          "655:  zend_long elements;",
          "",
          "[Removed Lines]",
          "647:  if (yych <= '/') goto yy18;",
          "648:  if (yych >= ';') goto yy18;",
          "652: #line 707 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "662:  if (yych != ':') goto yy18;",
          "666: #line 722 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "795:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "796: }",
          "798: yy25:",
          "799:  yych = *++YYCURSOR;",
          "800:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "797: #line 798 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "811: #line 812 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "819:  yych = *++YYCURSOR;",
          "820:  if (yych != '\"') goto yy18;",
          "821:  ++YYCURSOR;",
          "823:  {",
          "",
          "[Removed Lines]",
          "822: #line 699 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "836: #line 714 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "827:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "828:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "829: }",
          "831: yy32:",
          "832:  yych = *++YYCURSOR;",
          "833:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "830: #line 831 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "844: #line 845 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "848:  yych = *++YYCURSOR;",
          "849:  if (yych != '{') goto yy18;",
          "850:  ++YYCURSOR;",
          "852:  {",
          "853:  zend_long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "851: #line 678 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "865: #line 693 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "870:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "871: }",
          "873: yy39:",
          "874:  yych = *++YYCURSOR;",
          "875:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "872: #line 873 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "886: #line 887 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "890:  yych = *++YYCURSOR;",
          "891:  if (yych != '\"') goto yy18;",
          "892:  ++YYCURSOR;",
          "894:  {",
          "895:  size_t len, maxlen;",
          "896:  zend_string *str;",
          "",
          "[Removed Lines]",
          "893: #line 650 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "907: #line 665 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "918:  ZVAL_STR(rval, str);",
          "919:  return 1;",
          "920: }",
          "922: yy46:",
          "923:  yych = *++YYCURSOR;",
          "924:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "921: #line 922 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "935: #line 936 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "939:  yych = *++YYCURSOR;",
          "940:  if (yych != '\"') goto yy18;",
          "941:  ++YYCURSOR;",
          "943:  {",
          "944:  size_t len, maxlen;",
          "945:  char *str;",
          "",
          "[Removed Lines]",
          "942: #line 623 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "956: #line 638 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "966:  ZVAL_STRINGL(rval, str, len);",
          "967:  return 1;",
          "968: }",
          "970: yy53:",
          "971:  yych = *++YYCURSOR;",
          "972:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "969: #line 970 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "983: #line 984 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1054:  }",
          "1055: yy63:",
          "1056:  ++YYCURSOR;",
          "1058:  {",
          "1059: #if SIZEOF_ZEND_LONG == 4",
          "1060: use_double:",
          "",
          "[Removed Lines]",
          "1057: #line 614 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1071: #line 629 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1063:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1064:  return 1;",
          "1065: }",
          "1067: yy65:",
          "1068:  yych = *++YYCURSOR;",
          "1069:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1066: #line 1067 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1080: #line 1081 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "1122:  yych = *++YYCURSOR;",
          "1123:  if (yych != ';') goto yy18;",
          "1124:  ++YYCURSOR;",
          "1126:  {",
          "",
          "[Removed Lines]",
          "1125: #line 598 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1139: #line 613 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1139:  return 1;",
          "1140: }",
          "1142: yy76:",
          "1143:  yych = *++YYCURSOR;",
          "1144:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1141: #line 1142 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1155: #line 1156 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1165:  if (yych <= '9') goto yy79;",
          "1166:  if (yych != ';') goto yy18;",
          "1167:  ++YYCURSOR;",
          "1169:  {",
          "1170: #if SIZEOF_ZEND_LONG == 4",
          "1171:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1168: #line 572 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1182: #line 587 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "1191:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1192:  return 1;",
          "1193: }",
          "1195: yy83:",
          "1196:  yych = *++YYCURSOR;",
          "1197:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1194: #line 1195 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1208: #line 1209 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "1199:  yych = *++YYCURSOR;",
          "1200:  if (yych != ';') goto yy18;",
          "1201:  ++YYCURSOR;",
          "1203:  {",
          "1205:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1206:  return 1;",
          "1207: }",
          "1209: yy87:",
          "1210:  ++YYCURSOR;",
          "1212:  {",
          "1214:  ZVAL_NULL(rval);",
          "1215:  return 1;",
          "1216: }",
          "1218: yy89:",
          "1219:  yych = *++YYCURSOR;",
          "1220:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1202: #line 566 \"ext/standard/var_unserializer.re\"",
          "1208: #line 1209 \"ext/standard/var_unserializer.c\"",
          "1211: #line 560 \"ext/standard/var_unserializer.re\"",
          "1217: #line 1218 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1216: #line 581 \"ext/standard/var_unserializer.re\"",
          "1222: #line 1223 \"ext/standard/var_unserializer.c\"",
          "1225: #line 575 \"ext/standard/var_unserializer.re\"",
          "1231: #line 1232 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "1237:  if (yych <= '9') goto yy91;",
          "1238:  if (yych != ';') goto yy18;",
          "1239:  ++YYCURSOR;",
          "1241:  {",
          "1242:  zend_long id;",
          "",
          "[Removed Lines]",
          "1240: #line 537 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1254: #line 552 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "1261:  return 1;",
          "1262: }",
          "1264: yy95:",
          "1265:  yych = *++YYCURSOR;",
          "1266:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1263: #line 1264 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1277: #line 1278 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 25 ---",
          "[Context before]",
          "1283:  if (yych <= '9') goto yy97;",
          "1284:  if (yych != ';') goto yy18;",
          "1285:  ++YYCURSOR;",
          "1287:  {",
          "1288:  zend_long id;",
          "",
          "[Removed Lines]",
          "1286: #line 515 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1300: #line 530 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 26 ---",
          "[Context before]",
          "1306:  return 1;",
          "1307: }",
          "1309: }",
          "1313:  return 0;",
          "",
          "[Removed Lines]",
          "1308: #line 1309 \"ext/standard/var_unserializer.c\"",
          "1310: #line 860 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1322: #line 1323 \"ext/standard/var_unserializer.c\"",
          "1324: #line 875 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "326: #define UNSERIALIZE_PARAMETER zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash, HashTable *classes",
          "327: #define UNSERIALIZE_PASSTHRU rval, p, max, var_hash, classes",
          "330: {",
          "331:  while (elements-- > 0) {",
          "332:   zval key, *data, d, *old_data;",
          "334:   ZVAL_UNDEF(&key);",
          "",
          "[Removed Lines]",
          "329: static inline int process_nested_data(UNSERIALIZE_PARAMETER, HashTable *ht, zend_long elements, int objprops)",
          "",
          "[Added Lines]",
          "329: static zend_always_inline int process_nested_data(UNSERIALIZE_PARAMETER, HashTable *ht, zend_long elements, int objprops)",
          "333:   zend_ulong idx;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "338:    return 0;",
          "339:   }",
          "346:   data = NULL;",
          "347:   ZVAL_UNDEF(&d);",
          "349:   if (!objprops) {",
          "354:      var_push_dtor(var_hash, old_data);",
          "355:     }",
          "361:      var_push_dtor(var_hash, old_data);",
          "362:     }",
          "365:    }",
          "366:   } else {",
          "372:     }",
          "376:   }",
          "378:   zval_dtor(&key);",
          "",
          "[Removed Lines]",
          "341:   if (Z_TYPE(key) != IS_LONG && Z_TYPE(key) != IS_STRING) {",
          "342:    zval_dtor(&key);",
          "343:    return 0;",
          "344:   }",
          "350:    switch (Z_TYPE(key)) {",
          "351:    case IS_LONG:",
          "352:     if ((old_data = zend_hash_index_find(ht, Z_LVAL(key))) != NULL) {",
          "356:     data = zend_hash_index_update(ht, Z_LVAL(key), &d);",
          "357:     break;",
          "358:    case IS_STRING:",
          "359:     if ((old_data = zend_symtable_find(ht, Z_STR(key))) != NULL) {",
          "363:     data = zend_symtable_update(ht, Z_STR(key), &d);",
          "364:     break;",
          "368:    convert_to_string(&key);",
          "369:    if ((old_data = zend_hash_find(ht, Z_STR(key))) != NULL) {",
          "370:     if (Z_TYPE_P(old_data) == IS_INDIRECT) {",
          "371:      old_data = Z_INDIRECT_P(old_data);",
          "373:     var_push_dtor(var_hash, old_data);",
          "374:    }",
          "375:    data = zend_hash_update_ind(ht, Z_STR(key), &d);",
          "",
          "[Added Lines]",
          "346:    if (Z_TYPE(key) == IS_LONG) {",
          "347:     idx = Z_LVAL(key);",
          "348: numeric_key:",
          "349:     if (UNEXPECTED((old_data = zend_hash_index_find(ht, idx)) != NULL)) {",
          "352:      data = zend_hash_index_update(ht, idx, &d);",
          "353:     } else {",
          "354:      data = zend_hash_index_add_new(ht, idx, &d);",
          "356:    } else if (Z_TYPE(key) == IS_STRING) {",
          "357:     if (UNEXPECTED(ZEND_HANDLE_NUMERIC(Z_STR(key), idx))) {",
          "358:      goto numeric_key;",
          "359:     }",
          "360:     if (UNEXPECTED((old_data = zend_hash_find(ht, Z_STR(key))) != NULL)) {",
          "363:      data = zend_hash_update(ht, Z_STR(key), &d);",
          "364:     } else {",
          "365:      data = zend_hash_add_new(ht, Z_STR(key), &d);",
          "367:    } else {",
          "368:     zval_dtor(&key);",
          "369:     return 0;",
          "372:    if (EXPECTED(Z_TYPE(key) == IS_STRING)) {",
          "373: string_key:",
          "374:     if ((old_data = zend_hash_find(ht, Z_STR(key))) != NULL) {",
          "375:      if (Z_TYPE_P(old_data) == IS_INDIRECT) {",
          "376:       old_data = Z_INDIRECT_P(old_data);",
          "377:      }",
          "378:      var_push_dtor(var_hash, old_data);",
          "379:      data = zend_hash_update_ind(ht, Z_STR(key), &d);",
          "380:     } else {",
          "381:      data = zend_hash_add_new(ht, Z_STR(key), &d);",
          "383:    } else if (Z_TYPE(key) == IS_LONG) {",
          "385:     convert_to_string(&key);",
          "386:     goto string_key;",
          "387:    } else {",
          "388:     zval_dtor(&key);",
          "389:     return 0;",
          "390:    }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "9152214c1e20723f73b5f7b6c77b1183327bcf69",
      "candidate_info": {
        "commit_hash": "9152214c1e20723f73b5f7b6c77b1183327bcf69",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/9152214c1e20723f73b5f7b6c77b1183327bcf69",
        "files": [
          "ext/standard/tests/serialize/bug68594.phpt",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Merge branch 'PHP-5.6'\n\n* PHP-5.6:\n  update news\n  add CVE\n  add missing test file\n  Fix bug #68594 - Use after free vulnerability in unserialize()\n\nConflicts:\n\text/standard/var_unserializer.c\n\text/standard/var_unserializer.re",
        "before_after_code_files": [
          "ext/standard/tests/serialize/bug68594.phpt||ext/standard/tests/serialize/bug68594.phpt",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/tests/serialize/bug68594.phpt||ext/standard/tests/serialize/bug68594.phpt",
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/tests/serialize/bug68594.phpt||ext/standard/tests/serialize/bug68594.phpt",
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/tests/serialize/bug68594.phpt||ext/standard/tests/serialize/bug68594.phpt": [
          "File: ext/standard/tests/serialize/bug68594.phpt -> ext/standard/tests/serialize/bug68594.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #68545 Use after free vulnerability in unserialize()",
          "3: --FILE--",
          "4: <?php",
          "5: for ($i=4; $i<100; $i++) {",
          "6:  $m = new StdClass();",
          "8:  $u = array(1);",
          "10:  $m->aaa = array(1,2,&$u,4,5);",
          "11:  $m->bbb = 1;",
          "12:  $m->ccc = &$u;",
          "13:  $m->ddd = str_repeat(\"A\", $i);",
          "15:  $z = serialize($m);",
          "16:  $z = str_replace(\"bbb\", \"aaa\", $z);",
          "17:  $y = unserialize($z);",
          "18:  $z = serialize($y);",
          "19: }",
          "20: ?>",
          "21: ===DONE===",
          "22: --EXPECTF--",
          "23: ===DONE===",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "362:   } else {",
          "364:    convert_to_string(&key);",
          "372:     }",
          "380:   }",
          "382:   zval_dtor(&key);",
          "",
          "[Removed Lines]",
          "366: #if 1",
          "367:    data = zend_hash_update_ind(ht, Z_STR(key), &d);",
          "368: #else",
          "369:    if ((data = zend_hash_find(ht, Z_STR(key))) != NULL) {",
          "370:     if (Z_TYPE_P(data) == IS_INDIRECT) {",
          "371:      data = Z_INDIRECT_P(data);",
          "373:     zval_ptr_dtor(data);",
          "375:     ZVAL_UNDEF(data);",
          "376:    } else {",
          "377:     data = zend_hash_update(ht, Z_STR(key), &d);",
          "378:    }",
          "379: #endif",
          "",
          "[Added Lines]",
          "365:    if ((old_data = zend_hash_find(ht, Z_STR(key))) != NULL) {",
          "366:     if (Z_TYPE_P(old_data) == IS_INDIRECT) {",
          "367:      old_data = Z_INDIRECT_P(old_data);",
          "369:     zval_ptr_dtor(old_data);",
          "370:     var_push_dtor(var_hash, old_data);",
          "371:     ZVAL_UNDEF(old_data);",
          "372:    }",
          "373:    data = zend_hash_update(ht, Z_STR(key), &d);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "515:  start = cursor;",
          "519: {",
          "520:  YYCTYPE yych;",
          "521:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "518: #line 519 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "512: #line 513 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "575:  yych = *(YYMARKER = ++YYCURSOR);",
          "576:  if (yych == ':') goto yy95;",
          "577: yy3:",
          "579:  { return 0; }",
          "581: yy4:",
          "582:  yych = *(YYMARKER = ++YYCURSOR);",
          "583:  if (yych == ':') goto yy89;",
          "",
          "[Removed Lines]",
          "578: #line 866 \"ext/standard/var_unserializer.re\"",
          "580: #line 581 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "572: #line 860 \"ext/standard/var_unserializer.re\"",
          "574: #line 575 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "620:  goto yy3;",
          "621: yy14:",
          "622:  ++YYCURSOR;",
          "624:  {",
          "626:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
          "628: }",
          "630: yy16:",
          "631:  yych = *++YYCURSOR;",
          "632:  goto yy3;",
          "",
          "[Removed Lines]",
          "623: #line 860 \"ext/standard/var_unserializer.re\"",
          "629: #line 630 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "617: #line 854 \"ext/standard/var_unserializer.re\"",
          "623: #line 624 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "652:  if (yybm[0+yych] & 128) {",
          "653:   goto yy20;",
          "654:  }",
          "656:  yych = *++YYCURSOR;",
          "657:  if (yych != '\"') goto yy18;",
          "658:  ++YYCURSOR;",
          "660:  {",
          "661:  size_t len, len2, len3, maxlen;",
          "662:  zend_long elements;",
          "",
          "[Removed Lines]",
          "655:  if (yych != ':') goto yy18;",
          "659: #line 715 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "649:  if (yych <= '/') goto yy18;",
          "650:  if (yych >= ';') goto yy18;",
          "654: #line 709 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "802:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "803: }",
          "805: yy25:",
          "806:  yych = *++YYCURSOR;",
          "807:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "804: #line 805 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "799: #line 800 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "826:  yych = *++YYCURSOR;",
          "827:  if (yych != '\"') goto yy18;",
          "828:  ++YYCURSOR;",
          "830:  {",
          "",
          "[Removed Lines]",
          "829: #line 707 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "824: #line 701 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "834:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "835:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "836: }",
          "838: yy32:",
          "839:  yych = *++YYCURSOR;",
          "840:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "837: #line 838 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "832: #line 833 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "855:  yych = *++YYCURSOR;",
          "856:  if (yych != '{') goto yy18;",
          "857:  ++YYCURSOR;",
          "859:  {",
          "860:  zend_long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "858: #line 686 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "853: #line 680 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "877:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "878: }",
          "880: yy39:",
          "881:  yych = *++YYCURSOR;",
          "882:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "879: #line 880 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "874: #line 875 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "897:  yych = *++YYCURSOR;",
          "898:  if (yych != '\"') goto yy18;",
          "899:  ++YYCURSOR;",
          "901:  {",
          "902:  size_t len, maxlen;",
          "903:  zend_string *str;",
          "",
          "[Removed Lines]",
          "900: #line 658 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "895: #line 652 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "925:  ZVAL_STR(rval, str);",
          "926:  return 1;",
          "927: }",
          "929: yy46:",
          "930:  yych = *++YYCURSOR;",
          "931:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "928: #line 929 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "923: #line 924 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "946:  yych = *++YYCURSOR;",
          "947:  if (yych != '\"') goto yy18;",
          "948:  ++YYCURSOR;",
          "950:  {",
          "951:  size_t len, maxlen;",
          "952:  char *str;",
          "",
          "[Removed Lines]",
          "949: #line 631 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "944: #line 625 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "973:  ZVAL_STRINGL(rval, str, len);",
          "974:  return 1;",
          "975: }",
          "977: yy53:",
          "978:  yych = *++YYCURSOR;",
          "979:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "976: #line 977 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "971: #line 972 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1061:  }",
          "1062: yy63:",
          "1063:  ++YYCURSOR;",
          "1065:  {",
          "1066: #if SIZEOF_ZEND_LONG == 4",
          "1067: use_double:",
          "",
          "[Removed Lines]",
          "1064: #line 622 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1059: #line 616 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1070:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1071:  return 1;",
          "1072: }",
          "1074: yy65:",
          "1075:  yych = *++YYCURSOR;",
          "1076:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1073: #line 1074 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1068: #line 1069 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1129:  yych = *++YYCURSOR;",
          "1130:  if (yych != ';') goto yy18;",
          "1131:  ++YYCURSOR;",
          "1133:  {",
          "",
          "[Removed Lines]",
          "1132: #line 606 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1127: #line 600 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "1146:  return 1;",
          "1147: }",
          "1149: yy76:",
          "1150:  yych = *++YYCURSOR;",
          "1151:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1148: #line 1149 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1143: #line 1144 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1172:  if (yych <= '9') goto yy79;",
          "1173:  if (yych != ';') goto yy18;",
          "1174:  ++YYCURSOR;",
          "1176:  {",
          "1177: #if SIZEOF_ZEND_LONG == 4",
          "1178:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1175: #line 580 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1170: #line 574 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1198:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1199:  return 1;",
          "1200: }",
          "1202: yy83:",
          "1203:  yych = *++YYCURSOR;",
          "1204:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1201: #line 1202 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1196: #line 1197 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "1206:  yych = *++YYCURSOR;",
          "1207:  if (yych != ';') goto yy18;",
          "1208:  ++YYCURSOR;",
          "1210:  {",
          "1212:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1213:  return 1;",
          "1214: }",
          "1216: yy87:",
          "1217:  ++YYCURSOR;",
          "1219:  {",
          "1221:  ZVAL_NULL(rval);",
          "1222:  return 1;",
          "1223: }",
          "1225: yy89:",
          "1226:  yych = *++YYCURSOR;",
          "1227:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1209: #line 574 \"ext/standard/var_unserializer.re\"",
          "1215: #line 1216 \"ext/standard/var_unserializer.c\"",
          "1218: #line 568 \"ext/standard/var_unserializer.re\"",
          "1224: #line 1225 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1204: #line 568 \"ext/standard/var_unserializer.re\"",
          "1210: #line 1211 \"ext/standard/var_unserializer.c\"",
          "1213: #line 562 \"ext/standard/var_unserializer.re\"",
          "1219: #line 1220 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "1244:  if (yych <= '9') goto yy91;",
          "1245:  if (yych != ';') goto yy18;",
          "1246:  ++YYCURSOR;",
          "1248:  {",
          "1249:  zend_long id;",
          "",
          "[Removed Lines]",
          "1247: #line 545 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1242: #line 539 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "1268:  return 1;",
          "1269: }",
          "1271: yy95:",
          "1272:  yych = *++YYCURSOR;",
          "1273:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1270: #line 1271 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1265: #line 1266 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "1290:  if (yych <= '9') goto yy97;",
          "1291:  if (yych != ';') goto yy18;",
          "1292:  ++YYCURSOR;",
          "1294:  {",
          "1295:  zend_long id;",
          "",
          "[Removed Lines]",
          "1293: #line 523 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1288: #line 517 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 25 ---",
          "[Context before]",
          "1313:  return 1;",
          "1314: }",
          "1316: }",
          "1320:  return 0;",
          "",
          "[Removed Lines]",
          "1315: #line 1316 \"ext/standard/var_unserializer.c\"",
          "1317: #line 868 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1310: #line 1311 \"ext/standard/var_unserializer.c\"",
          "1312: #line 862 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "366:   } else {",
          "368:    convert_to_string(&key);",
          "376:     }",
          "384:   }",
          "386:   zval_dtor(&key);",
          "",
          "[Removed Lines]",
          "370: #if 1",
          "371:    data = zend_hash_update_ind(ht, Z_STR(key), &d);",
          "372: #else",
          "373:    if ((data = zend_hash_find(ht, Z_STR(key))) != NULL) {",
          "374:     if (Z_TYPE_P(data) == IS_INDIRECT) {",
          "375:      data = Z_INDIRECT_P(data);",
          "377:     zval_ptr_dtor(data);",
          "379:     ZVAL_UNDEF(data);",
          "380:    } else {",
          "381:     data = zend_hash_update(ht, Z_STR(key), &d);",
          "382:    }",
          "383: #endif",
          "",
          "[Added Lines]",
          "369:    if ((old_data = zend_hash_find(ht, Z_STR(key))) != NULL) {",
          "370:     if (Z_TYPE_P(old_data) == IS_INDIRECT) {",
          "371:      old_data = Z_INDIRECT_P(old_data);",
          "373:     zval_ptr_dtor(old_data);",
          "374:     var_push_dtor(var_hash, old_data);",
          "375:     ZVAL_UNDEF(old_data);",
          "376:    }",
          "377:    data = zend_hash_update(ht, Z_STR(key), &d);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "e2e99f16e1cea47cc363483d26acfd41f5d2e814",
      "candidate_info": {
        "commit_hash": "e2e99f16e1cea47cc363483d26acfd41f5d2e814",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/e2e99f16e1cea47cc363483d26acfd41f5d2e814",
        "files": [
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Cleanup: removed deprecated commented code",
        "before_after_code_files": [
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "99:     return &var_hash->data[var_hash->used_slots++];",
          "100: }",
          "136: PHPAPI void var_replace(php_unserialize_data_t *var_hashx, zval *ozval, zval *nzval)",
          "137: {",
          "138:  zend_long i;",
          "",
          "[Removed Lines]",
          "103: #if 0",
          "104: PHPAPI void var_push_dtor_no_addref(php_unserialize_data_t *var_hashx, zval *rval)",
          "105: {",
          "106:  var_entries *var_hash;",
          "108:     if (!var_hashx || !*var_hashx) {",
          "109:         return;",
          "110:     }",
          "112:     var_hash = (*var_hashx)->last_dtor;",
          "113: #if VAR_ENTRIES_DBG",
          "114:  fprintf(stderr, \"var_push_dtor_no_addref(%p, %ld): %d (%d)\\n\", *rval, var_hash?var_hash->used_slots:-1L, Z_TYPE_PP(rval), Z_REFCOUNT_PP(rval));",
          "115: #endif",
          "117:  if (!var_hash || var_hash->used_slots == VAR_ENTRIES_MAX) {",
          "118:   var_hash = emalloc(sizeof(var_dtor_entries));",
          "119:   var_hash->used_slots = 0;",
          "120:   var_hash->next = 0;",
          "122:   if (!(*var_hashx)->first_dtor) {",
          "123:    (*var_hashx)->first_dtor = var_hash;",
          "124:   } else {",
          "125:    ((var_entries *) (*var_hashx)->last_dtor)->next = var_hash;",
          "126:   }",
          "128:   (*var_hashx)->last_dtor = var_hash;",
          "129:  }",
          "131:  ZVAL_COPY_VALUE(&var_hash->data[var_hash->used_slots], rval);",
          "132:  var_hash->used_slots++;",
          "133: }",
          "134: #endif",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "272: #define YYMARKER marker",
          "",
          "[Removed Lines]",
          "275: #line 280 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "241: #line 246 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "539:  start = cursor;",
          "543: {",
          "544:  YYCTYPE yych;",
          "545:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "542: #line 543 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "508: #line 509 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "599:  yych = *(YYMARKER = ++YYCURSOR);",
          "600:  if (yych == ':') goto yy95;",
          "601: yy3:",
          "603:  { return 0; }",
          "605: yy4:",
          "606:  yych = *(YYMARKER = ++YYCURSOR);",
          "607:  if (yych == ':') goto yy89;",
          "",
          "[Removed Lines]",
          "602: #line 895 \"ext/standard/var_unserializer.re\"",
          "604: #line 605 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "568: #line 851 \"ext/standard/var_unserializer.re\"",
          "570: #line 571 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "644:  goto yy3;",
          "645: yy14:",
          "646:  ++YYCURSOR;",
          "648:  {",
          "650:  php_error_docref(NULL, E_NOTICE, \"Unexpected end of serialized data\");",
          "652: }",
          "654: yy16:",
          "655:  yych = *++YYCURSOR;",
          "656:  goto yy3;",
          "",
          "[Removed Lines]",
          "647: #line 889 \"ext/standard/var_unserializer.re\"",
          "653: #line 654 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "613: #line 845 \"ext/standard/var_unserializer.re\"",
          "619: #line 620 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "680:  yych = *++YYCURSOR;",
          "681:  if (yych != '\"') goto yy18;",
          "682:  ++YYCURSOR;",
          "684:  {",
          "685:  size_t len, len2, len3, maxlen;",
          "686:  zend_long elements;",
          "",
          "[Removed Lines]",
          "683: #line 743 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "649: #line 700 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "827:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "828: }",
          "830: yy25:",
          "831:  yych = *++YYCURSOR;",
          "832:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "829: #line 830 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "794: #line 795 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "851:  yych = *++YYCURSOR;",
          "852:  if (yych != '\"') goto yy18;",
          "853:  ++YYCURSOR;",
          "855:  {",
          "856:     if (!var_hash) return 0;",
          "860:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "861:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "862: }",
          "864: yy32:",
          "865:  yych = *++YYCURSOR;",
          "866:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "854: #line 734 \"ext/standard/var_unserializer.re\"",
          "863: #line 864 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "819: #line 693 \"ext/standard/var_unserializer.re\"",
          "826: #line 827 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "881:  yych = *++YYCURSOR;",
          "882:  if (yych != '{') goto yy18;",
          "883:  ++YYCURSOR;",
          "885:  {",
          "886:  zend_long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "884: #line 710 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "847: #line 669 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "906:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "907: }",
          "909: yy39:",
          "910:  yych = *++YYCURSOR;",
          "911:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "908: #line 909 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "871: #line 872 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "926:  yych = *++YYCURSOR;",
          "927:  if (yych != '\"') goto yy18;",
          "928:  ++YYCURSOR;",
          "930:  {",
          "931:  size_t len, maxlen;",
          "932:  zend_string *str;",
          "",
          "[Removed Lines]",
          "929: #line 682 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "892: #line 641 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "954:  ZVAL_STR(rval, str);",
          "955:  return 1;",
          "956: }",
          "958: yy46:",
          "959:  yych = *++YYCURSOR;",
          "960:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "957: #line 958 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "920: #line 921 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "975:  yych = *++YYCURSOR;",
          "976:  if (yych != '\"') goto yy18;",
          "977:  ++YYCURSOR;",
          "979:  {",
          "980:  size_t len, maxlen;",
          "981:  char *str;",
          "",
          "[Removed Lines]",
          "978: #line 655 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "941: #line 614 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "1002:  ZVAL_STRINGL(rval, str, len);",
          "1003:  return 1;",
          "1004: }",
          "1006: yy53:",
          "1007:  yych = *++YYCURSOR;",
          "1008:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "1005: #line 1006 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "968: #line 969 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1090:  }",
          "1091: yy63:",
          "1092:  ++YYCURSOR;",
          "1094:  {",
          "1095: #if SIZEOF_ZEND_LONG == 4",
          "1096: use_double:",
          "",
          "[Removed Lines]",
          "1093: #line 646 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1056: #line 605 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1099:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1100:  return 1;",
          "1101: }",
          "1103: yy65:",
          "1104:  yych = *++YYCURSOR;",
          "1105:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1102: #line 1103 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1065: #line 1066 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1158:  yych = *++YYCURSOR;",
          "1159:  if (yych != ';') goto yy18;",
          "1160:  ++YYCURSOR;",
          "1162:  {",
          "",
          "[Removed Lines]",
          "1161: #line 630 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1124: #line 589 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "1175:  return 1;",
          "1176: }",
          "1178: yy76:",
          "1179:  yych = *++YYCURSOR;",
          "1180:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1177: #line 1178 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1140: #line 1141 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1201:  if (yych <= '9') goto yy79;",
          "1202:  if (yych != ';') goto yy18;",
          "1203:  ++YYCURSOR;",
          "1205:  {",
          "1206: #if SIZEOF_ZEND_LONG == 4",
          "1207:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1204: #line 604 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1167: #line 563 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1227:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1228:  return 1;",
          "1229: }",
          "1231: yy83:",
          "1232:  yych = *++YYCURSOR;",
          "1233:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1230: #line 1231 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1193: #line 1194 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "1235:  yych = *++YYCURSOR;",
          "1236:  if (yych != ';') goto yy18;",
          "1237:  ++YYCURSOR;",
          "1239:  {",
          "1241:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1242:  return 1;",
          "1243: }",
          "1245: yy87:",
          "1246:  ++YYCURSOR;",
          "1248:  {",
          "1250:  ZVAL_NULL(rval);",
          "1251:  return 1;",
          "1252: }",
          "1254: yy89:",
          "1255:  yych = *++YYCURSOR;",
          "1256:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1238: #line 598 \"ext/standard/var_unserializer.re\"",
          "1244: #line 1245 \"ext/standard/var_unserializer.c\"",
          "1247: #line 592 \"ext/standard/var_unserializer.re\"",
          "1253: #line 1254 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1201: #line 557 \"ext/standard/var_unserializer.re\"",
          "1207: #line 1208 \"ext/standard/var_unserializer.c\"",
          "1210: #line 551 \"ext/standard/var_unserializer.re\"",
          "1216: #line 1217 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "1273:  if (yych <= '9') goto yy91;",
          "1274:  if (yych != ';') goto yy18;",
          "1275:  ++YYCURSOR;",
          "1277:  {",
          "1278:  zend_long id;",
          "",
          "[Removed Lines]",
          "1276: #line 569 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1239: #line 535 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "1285:   return 0;",
          "1286:  }",
          "1294:  ZVAL_COPY(rval, rval_ref);",
          "1297:  return 1;",
          "1298: }",
          "1300: yy95:",
          "1301:  yych = *++YYCURSOR;",
          "1302:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1299: #line 1300 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1255: #line 1256 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "1319:  if (yych <= '9') goto yy97;",
          "1320:  if (yych != ';') goto yy18;",
          "1321:  ++YYCURSOR;",
          "1323:  {",
          "1324:  zend_long id;",
          "",
          "[Removed Lines]",
          "1322: #line 547 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1278: #line 513 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 25 ---",
          "[Context before]",
          "1342:  return 1;",
          "1343: }",
          "1345: }",
          "1349:  return 0;",
          "",
          "[Removed Lines]",
          "1344: #line 1345 \"ext/standard/var_unserializer.c\"",
          "1346: #line 897 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1300: #line 1301 \"ext/standard/var_unserializer.c\"",
          "1302: #line 853 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "97:     return &var_hash->data[var_hash->used_slots++];",
          "98: }",
          "134: PHPAPI void var_replace(php_unserialize_data_t *var_hashx, zval *ozval, zval *nzval)",
          "135: {",
          "136:  zend_long i;",
          "",
          "[Removed Lines]",
          "101: #if 0",
          "102: PHPAPI void var_push_dtor_no_addref(php_unserialize_data_t *var_hashx, zval *rval)",
          "103: {",
          "104:  var_entries *var_hash;",
          "106:     if (!var_hashx || !*var_hashx) {",
          "107:         return;",
          "108:     }",
          "110:     var_hash = (*var_hashx)->last_dtor;",
          "111: #if VAR_ENTRIES_DBG",
          "112:  fprintf(stderr, \"var_push_dtor_no_addref(%p, %ld): %d (%d)\\n\", *rval, var_hash?var_hash->used_slots:-1L, Z_TYPE_PP(rval), Z_REFCOUNT_PP(rval));",
          "113: #endif",
          "115:  if (!var_hash || var_hash->used_slots == VAR_ENTRIES_MAX) {",
          "116:   var_hash = emalloc(sizeof(var_dtor_entries));",
          "117:   var_hash->used_slots = 0;",
          "118:   var_hash->next = 0;",
          "120:   if (!(*var_hashx)->first_dtor) {",
          "121:    (*var_hashx)->first_dtor = var_hash;",
          "122:   } else {",
          "123:    ((var_entries *) (*var_hashx)->last_dtor)->next = var_hash;",
          "124:   }",
          "126:   (*var_hashx)->last_dtor = var_hash;",
          "127:  }",
          "129:  ZVAL_COPY_VALUE(&var_hash->data[var_hash->used_slots], rval);",
          "130:  var_hash->used_slots++;",
          "131: }",
          "132: #endif",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "33a5532b66712884ca25897e7ffebfb890fba2f0",
      "candidate_info": {
        "commit_hash": "33a5532b66712884ca25897e7ffebfb890fba2f0",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/33a5532b66712884ca25897e7ffebfb890fba2f0",
        "files": [
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Merge branch 'PHP-5.5' into PHP-5.6\n\n* PHP-5.5:\n  Fixed bug #68976 - Use After Free Vulnerability in unserialize()\n\nConflicts:\n\text/standard/var_unserializer.c",
        "before_after_code_files": [
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "347:    zend_hash_update(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, &data,",
          "348:      sizeof data, NULL);",
          "349:   }",
          "351:   zval_dtor(key);",
          "352:   FREE_ZVAL(key);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "350:   var_push_dtor(var_hash, &data);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "481: {",
          "482:  YYCTYPE yych;",
          "483:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "480: #line 481 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "481: #line 482 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "537:  yych = *(YYMARKER = ++YYCURSOR);",
          "538:  if (yych == ':') goto yy95;",
          "539: yy3:",
          "541:  { return 0; }",
          "543: yy4:",
          "544:  yych = *(YYMARKER = ++YYCURSOR);",
          "545:  if (yych == ':') goto yy89;",
          "",
          "[Removed Lines]",
          "540: #line 832 \"ext/standard/var_unserializer.re\"",
          "542: #line 543 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "541: #line 833 \"ext/standard/var_unserializer.re\"",
          "543: #line 544 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "582:  goto yy3;",
          "583: yy14:",
          "584:  ++YYCURSOR;",
          "586:  {",
          "588:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
          "590: }",
          "592: yy16:",
          "593:  yych = *++YYCURSOR;",
          "594:  goto yy3;",
          "",
          "[Removed Lines]",
          "585: #line 826 \"ext/standard/var_unserializer.re\"",
          "591: #line 592 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "586: #line 827 \"ext/standard/var_unserializer.re\"",
          "592: #line 593 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "614:  if (yybm[0+yych] & 128) {",
          "615:   goto yy20;",
          "616:  }",
          "618:  yych = *++YYCURSOR;",
          "619:  if (yych != '\"') goto yy18;",
          "620:  ++YYCURSOR;",
          "622:  {",
          "623:  size_t len, len2, len3, maxlen;",
          "624:  long elements;",
          "",
          "[Removed Lines]",
          "617:  if (yych != ':') goto yy18;",
          "621: #line 680 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "618:  if (yych <= '/') goto yy18;",
          "619:  if (yych >= ';') goto yy18;",
          "623: #line 681 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "765:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "766: }",
          "768: yy25:",
          "769:  yych = *++YYCURSOR;",
          "770:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "767: #line 768 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "769: #line 770 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "789:  yych = *++YYCURSOR;",
          "790:  if (yych != '\"') goto yy18;",
          "791:  ++YYCURSOR;",
          "793:  {",
          "795:  INIT_PZVAL(*rval);",
          "",
          "[Removed Lines]",
          "792: #line 672 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "794: #line 673 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "797:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "798:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "799: }",
          "801: yy32:",
          "802:  yych = *++YYCURSOR;",
          "803:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "800: #line 801 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "802: #line 803 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "818:  yych = *++YYCURSOR;",
          "819:  if (yych != '{') goto yy18;",
          "820:  ++YYCURSOR;",
          "822:  {",
          "823:  long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "821: #line 652 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "823: #line 653 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "839:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "840: }",
          "842: yy39:",
          "843:  yych = *++YYCURSOR;",
          "844:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "841: #line 842 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "843: #line 844 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "859:  yych = *++YYCURSOR;",
          "860:  if (yych != '\"') goto yy18;",
          "861:  ++YYCURSOR;",
          "863:  {",
          "864:  size_t len, maxlen;",
          "865:  char *str;",
          "",
          "[Removed Lines]",
          "862: #line 623 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "864: #line 624 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "888:  ZVAL_STRINGL(*rval, str, len, 0);",
          "889:  return 1;",
          "890: }",
          "892: yy46:",
          "893:  yych = *++YYCURSOR;",
          "894:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "891: #line 892 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "893: #line 894 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "909:  yych = *++YYCURSOR;",
          "910:  if (yych != '\"') goto yy18;",
          "911:  ++YYCURSOR;",
          "913:  {",
          "914:  size_t len, maxlen;",
          "915:  char *str;",
          "",
          "[Removed Lines]",
          "912: #line 595 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "914: #line 596 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "937:  ZVAL_STRINGL(*rval, str, len, 1);",
          "938:  return 1;",
          "939: }",
          "941: yy53:",
          "942:  yych = *++YYCURSOR;",
          "943:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "940: #line 941 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "942: #line 943 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1025:  }",
          "1026: yy63:",
          "1027:  ++YYCURSOR;",
          "1029:  {",
          "1030: #if SIZEOF_LONG == 4",
          "1031: use_double:",
          "",
          "[Removed Lines]",
          "1028: #line 585 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1030: #line 586 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1035:  ZVAL_DOUBLE(*rval, zend_strtod((const char *)start + 2, NULL));",
          "1036:  return 1;",
          "1037: }",
          "1039: yy65:",
          "1040:  yych = *++YYCURSOR;",
          "1041:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1038: #line 1039 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1040: #line 1041 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1094:  yych = *++YYCURSOR;",
          "1095:  if (yych != ';') goto yy18;",
          "1096:  ++YYCURSOR;",
          "1098:  {",
          "1100:  INIT_PZVAL(*rval);",
          "",
          "[Removed Lines]",
          "1097: #line 570 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1099: #line 571 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "1110:  return 1;",
          "1111: }",
          "1113: yy76:",
          "1114:  yych = *++YYCURSOR;",
          "1115:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1112: #line 1113 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1114: #line 1115 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1136:  if (yych <= '9') goto yy79;",
          "1137:  if (yych != ';') goto yy18;",
          "1138:  ++YYCURSOR;",
          "1140:  {",
          "1141: #if SIZEOF_LONG == 4",
          "1142:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1139: #line 543 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1141: #line 544 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1163:  ZVAL_LONG(*rval, parse_iv(start + 2));",
          "1164:  return 1;",
          "1165: }",
          "1167: yy83:",
          "1168:  yych = *++YYCURSOR;",
          "1169:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1166: #line 1167 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1168: #line 1169 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "1171:  yych = *++YYCURSOR;",
          "1172:  if (yych != ';') goto yy18;",
          "1173:  ++YYCURSOR;",
          "1175:  {",
          "1177:  INIT_PZVAL(*rval);",
          "1178:  ZVAL_BOOL(*rval, parse_iv(start + 2));",
          "1179:  return 1;",
          "1180: }",
          "1182: yy87:",
          "1183:  ++YYCURSOR;",
          "1185:  {",
          "1187:  INIT_PZVAL(*rval);",
          "1188:  ZVAL_NULL(*rval);",
          "1189:  return 1;",
          "1190: }",
          "1192: yy89:",
          "1193:  yych = *++YYCURSOR;",
          "1194:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1174: #line 536 \"ext/standard/var_unserializer.re\"",
          "1181: #line 1182 \"ext/standard/var_unserializer.c\"",
          "1184: #line 529 \"ext/standard/var_unserializer.re\"",
          "1191: #line 1192 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1176: #line 537 \"ext/standard/var_unserializer.re\"",
          "1183: #line 1184 \"ext/standard/var_unserializer.c\"",
          "1186: #line 530 \"ext/standard/var_unserializer.re\"",
          "1193: #line 1194 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "1211:  if (yych <= '9') goto yy91;",
          "1212:  if (yych != ';') goto yy18;",
          "1213:  ++YYCURSOR;",
          "1215:  {",
          "1216:  long id;",
          "",
          "[Removed Lines]",
          "1214: #line 506 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1216: #line 507 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "1235:  return 1;",
          "1236: }",
          "1238: yy95:",
          "1239:  yych = *++YYCURSOR;",
          "1240:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1237: #line 1238 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1239: #line 1240 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "1257:  if (yych <= '9') goto yy97;",
          "1258:  if (yych != ';') goto yy18;",
          "1259:  ++YYCURSOR;",
          "1261:  {",
          "1262:  long id;",
          "",
          "[Removed Lines]",
          "1260: #line 485 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1262: #line 486 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 25 ---",
          "[Context before]",
          "1279:  return 1;",
          "1280: }",
          "1282: }",
          "1286:  return 0;",
          "",
          "[Removed Lines]",
          "1281: #line 1282 \"ext/standard/var_unserializer.c\"",
          "1283: #line 834 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1283: #line 1284 \"ext/standard/var_unserializer.c\"",
          "1285: #line 835 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "351:    zend_hash_update(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, &data,",
          "352:      sizeof data, NULL);",
          "353:   }",
          "355:   zval_dtor(key);",
          "356:   FREE_ZVAL(key);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "354:   var_push_dtor(var_hash, &data);",
          "",
          "---------------"
        ]
      }
    }
  ]
}