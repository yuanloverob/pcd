{
  "cve_id": "CVE-2014-3542",
  "cve_desc": "mod/lti/service.php in Moodle through 2.3.11, 2.4.x before 2.4.11, 2.5.x before 2.5.7, 2.6.x before 2.6.4, and 2.7.x before 2.7.1 allows remote attackers to read arbitrary files via an XML external entity declaration in conjunction with an entity reference, related to an XML External Entity (XXE) issue.",
  "repo": "moodle/moodle",
  "patch_hash": "78ed99ec7e5e75b283e844adb058140d6ba0ff14",
  "patch_info": {
    "commit_hash": "78ed99ec7e5e75b283e844adb058140d6ba0ff14",
    "repo": "moodle/moodle",
    "commit_url": "https://github.com/moodle/moodle/commit/78ed99ec7e5e75b283e844adb058140d6ba0ff14",
    "files": [
      "mod/lti/service.php"
    ],
    "message": "MDL-45463 mod_lti: Prevent XML entity injections from provider",
    "before_after_code_files": [
      "mod/lti/service.php||mod/lti/service.php"
    ]
  },
  "patch_diff": {
    "mod/lti/service.php||mod/lti/service.php": [
      "File: mod/lti/service.php -> mod/lti/service.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "58:     throw new Exception('Message signature not valid');",
      "59: }",
      "63: $body = $xml->imsx_POXBody;",
      "64: foreach ($body->children() as $child) {",
      "",
      "[Removed Lines]",
      "61: $xml = new SimpleXMLElement($rawbody);",
      "",
      "[Added Lines]",
      "62: $origentity = libxml_disable_entity_loader(true);",
      "63: $xml = simplexml_load_string($rawbody);",
      "64: if (!$xml) {",
      "65:     libxml_disable_entity_loader($origentity);",
      "66:     throw new Exception('Invalid XML content');",
      "67: }",
      "68: libxml_disable_entity_loader($origentity);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "cadfc081976564e90fccf692f0b954ae36ed87dc",
      "candidate_info": {
        "commit_hash": "cadfc081976564e90fccf692f0b954ae36ed87dc",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/cadfc081976564e90fccf692f0b954ae36ed87dc",
        "files": [
          "mod/lti/service.php"
        ],
        "message": "MDL-45463 mod_lti: Prevent XML entity injections from provider",
        "before_after_code_files": [
          "mod/lti/service.php||mod/lti/service.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "mod/lti/service.php||mod/lti/service.php"
          ],
          "candidate": [
            "mod/lti/service.php||mod/lti/service.php"
          ]
        }
      },
      "candidate_diff": {
        "mod/lti/service.php||mod/lti/service.php": [
          "File: mod/lti/service.php -> mod/lti/service.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "53:     throw new Exception('Message signature not valid');",
          "54: }",
          "58: $body = $xml->imsx_POXBody;",
          "59: foreach ($body->children() as $child) {",
          "",
          "[Removed Lines]",
          "56: $xml = new SimpleXMLElement($rawbody);",
          "",
          "[Added Lines]",
          "57: $origentity = libxml_disable_entity_loader(true);",
          "58: $xml = simplexml_load_string($rawbody);",
          "59: if (!$xml) {",
          "60:     libxml_disable_entity_loader($origentity);",
          "61:     throw new Exception('Invalid XML content');",
          "62: }",
          "63: libxml_disable_entity_loader($origentity);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "4637ad6f7e4db9f5fc75ea634132538986a0a401",
      "candidate_info": {
        "commit_hash": "4637ad6f7e4db9f5fc75ea634132538986a0a401",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/4637ad6f7e4db9f5fc75ea634132538986a0a401",
        "files": [
          "mod/lti/service.php"
        ],
        "message": "MDL-45463 mod_lti: Prevent XML entity injections from provider",
        "before_after_code_files": [
          "mod/lti/service.php||mod/lti/service.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "mod/lti/service.php||mod/lti/service.php"
          ],
          "candidate": [
            "mod/lti/service.php||mod/lti/service.php"
          ]
        }
      },
      "candidate_diff": {
        "mod/lti/service.php||mod/lti/service.php": [
          "File: mod/lti/service.php -> mod/lti/service.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "55:     throw new Exception('Message signature not valid');",
          "56: }",
          "60: $body = $xml->imsx_POXBody;",
          "61: foreach ($body->children() as $child) {",
          "",
          "[Removed Lines]",
          "58: $xml = new SimpleXMLElement($rawbody);",
          "",
          "[Added Lines]",
          "59: $origentity = libxml_disable_entity_loader(true);",
          "60: $xml = simplexml_load_string($rawbody);",
          "61: if (!$xml) {",
          "62:     libxml_disable_entity_loader($origentity);",
          "63:     throw new Exception('Invalid XML content');",
          "64: }",
          "65: libxml_disable_entity_loader($origentity);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "3b68d1b23a57325126125176634aeaa54a99de53",
      "candidate_info": {
        "commit_hash": "3b68d1b23a57325126125176634aeaa54a99de53",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/3b68d1b23a57325126125176634aeaa54a99de53",
        "files": [
          "mod/lti/service.php"
        ],
        "message": "MDL-45463 mod_lti: Prevent XML entity injections from provider",
        "before_after_code_files": [
          "mod/lti/service.php||mod/lti/service.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "mod/lti/service.php||mod/lti/service.php"
          ],
          "candidate": [
            "mod/lti/service.php||mod/lti/service.php"
          ]
        }
      },
      "candidate_diff": {
        "mod/lti/service.php||mod/lti/service.php": [
          "File: mod/lti/service.php -> mod/lti/service.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "53:     throw new Exception('Message signature not valid');",
          "54: }",
          "58: $body = $xml->imsx_POXBody;",
          "59: foreach ($body->children() as $child) {",
          "",
          "[Removed Lines]",
          "56: $xml = new SimpleXMLElement($rawbody);",
          "",
          "[Added Lines]",
          "57: $origentity = libxml_disable_entity_loader(true);",
          "58: $xml = simplexml_load_string($rawbody);",
          "59: if (!$xml) {",
          "60:     libxml_disable_entity_loader($origentity);",
          "61:     throw new Exception('Invalid XML content');",
          "62: }",
          "63: libxml_disable_entity_loader($origentity);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "2d121036ccb811ff3314e2eb12e469e895bfb95d",
      "candidate_info": {
        "commit_hash": "2d121036ccb811ff3314e2eb12e469e895bfb95d",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/2d121036ccb811ff3314e2eb12e469e895bfb95d",
        "files": [
          "mod/lti/service.php"
        ],
        "message": "MDL-45463 mod_lti: Prevent XML entity injections from provider",
        "before_after_code_files": [
          "mod/lti/service.php||mod/lti/service.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "mod/lti/service.php||mod/lti/service.php"
          ],
          "candidate": [
            "mod/lti/service.php||mod/lti/service.php"
          ]
        }
      },
      "candidate_diff": {
        "mod/lti/service.php||mod/lti/service.php": [
          "File: mod/lti/service.php -> mod/lti/service.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "54:     throw new Exception('Message signature not valid');",
          "55: }",
          "59: $body = $xml->imsx_POXBody;",
          "60: foreach ($body->children() as $child) {",
          "",
          "[Removed Lines]",
          "57: $xml = new SimpleXMLElement($rawbody);",
          "",
          "[Added Lines]",
          "58: $origentity = libxml_disable_entity_loader(true);",
          "59: $xml = simplexml_load_string($rawbody);",
          "60: if (!$xml) {",
          "61:     libxml_disable_entity_loader($origentity);",
          "62:     throw new Exception('Invalid XML content');",
          "63: }",
          "64: libxml_disable_entity_loader($origentity);",
          "",
          "---------------"
        ]
      }
    }
  ]
}