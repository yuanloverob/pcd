{
  "cve_id": "CVE-2013-4526",
  "cve_desc": "Buffer overflow in hw/ide/ahci.c in QEMU before 1.7.2 allows remote attackers to cause a denial of service and possibly execute arbitrary code via vectors related to migrating ports.",
  "repo": "qemu/qemu",
  "patch_hash": "ae2158ad6ce0845b2fae2a22aa7f19c0d7a71ce5",
  "patch_info": {
    "commit_hash": "ae2158ad6ce0845b2fae2a22aa7f19c0d7a71ce5",
    "repo": "qemu/qemu",
    "commit_url": "https://github.com/qemu/qemu/commit/ae2158ad6ce0845b2fae2a22aa7f19c0d7a71ce5",
    "files": [
      "hw/ide/ahci.c"
    ],
    "message": "ahci: fix buffer overrun on invalid state load\n\nCVE-2013-4526\n\nWithin hw/ide/ahci.c, VARRAY refers to ports which is also loaded.  So\nwe use the old version of ports to read the array but then allow any\nvalue for ports.  This can cause the code to overflow.\n\nThere's no reason to migrate ports - it never changes.\nSo just make sure it matches.\n\nReported-by: Anthony Liguori <anthony@codemonkey.ws>\nSigned-off-by: Michael S. Tsirkin <mst@redhat.com>\nReviewed-by: Peter Maydell <peter.maydell@linaro.org>\nSigned-off-by: Juan Quintela <quintela@redhat.com>",
    "before_after_code_files": [
      "hw/ide/ahci.c||hw/ide/ahci.c"
    ]
  },
  "patch_diff": {
    "hw/ide/ahci.c||hw/ide/ahci.c": [
      "File: hw/ide/ahci.c -> hw/ide/ahci.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1293:         VMSTATE_UINT32(control_regs.impl, AHCIState),",
      "1294:         VMSTATE_UINT32(control_regs.version, AHCIState),",
      "1295:         VMSTATE_UINT32(idp_index, AHCIState),",
      "1297:         VMSTATE_END_OF_LIST()",
      "1298:     },",
      "1299: };",
      "",
      "[Removed Lines]",
      "1296:         VMSTATE_INT32(ports, AHCIState),",
      "",
      "[Added Lines]",
      "1296:         VMSTATE_INT32_EQUAL(ports, AHCIState),",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "d4c90959004633c16279f06afba43f3a330108ba",
      "candidate_info": {
        "commit_hash": "d4c90959004633c16279f06afba43f3a330108ba",
        "repo": "qemu/qemu",
        "commit_url": "https://github.com/qemu/qemu/commit/d4c90959004633c16279f06afba43f3a330108ba",
        "files": [
          "hw/ide/ahci.c"
        ],
        "message": "ahci: fix buffer overrun on invalid state load\n\nCVE-2013-4526\n\nWithin hw/ide/ahci.c, VARRAY refers to ports which is also loaded.  So\nwe use the old version of ports to read the array but then allow any\nvalue for ports.  This can cause the code to overflow.\n\nThere's no reason to migrate ports - it never changes.\nSo just make sure it matches.\n\nReported-by: Anthony Liguori <anthony@codemonkey.ws>\nSigned-off-by: Michael S. Tsirkin <mst@redhat.com>\nReviewed-by: Peter Maydell <peter.maydell@linaro.org>\nSigned-off-by: Juan Quintela <quintela@redhat.com>\n(cherry picked from commit ae2158ad6ce0845b2fae2a22aa7f19c0d7a71ce5)\nSigned-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>",
        "before_after_code_files": [
          "hw/ide/ahci.c||hw/ide/ahci.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "hw/ide/ahci.c||hw/ide/ahci.c"
          ],
          "candidate": [
            "hw/ide/ahci.c||hw/ide/ahci.c"
          ]
        }
      },
      "candidate_diff": {
        "hw/ide/ahci.c||hw/ide/ahci.c": [
          "File: hw/ide/ahci.c -> hw/ide/ahci.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1293:         VMSTATE_UINT32(control_regs.impl, AHCIState),",
          "1294:         VMSTATE_UINT32(control_regs.version, AHCIState),",
          "1295:         VMSTATE_UINT32(idp_index, AHCIState),",
          "1297:         VMSTATE_END_OF_LIST()",
          "1298:     },",
          "1299: };",
          "",
          "[Removed Lines]",
          "1296:         VMSTATE_INT32(ports, AHCIState),",
          "",
          "[Added Lines]",
          "1296:         VMSTATE_INT32_EQUAL(ports, AHCIState),",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "d34e6f796097bd46d1bf8b26916df757d54aba03",
      "candidate_info": {
        "commit_hash": "d34e6f796097bd46d1bf8b26916df757d54aba03",
        "repo": "qemu/qemu",
        "commit_url": "https://github.com/qemu/qemu/commit/d34e6f796097bd46d1bf8b26916df757d54aba03",
        "files": [
          "hw/ide/ahci.c"
        ],
        "message": "ahci: fix buffer overrun on invalid state load\n\nCVE-2013-4526\n\nWithin hw/ide/ahci.c, VARRAY refers to ports which is also loaded.  So\nwe use the old version of ports to read the array but then allow any\nvalue for ports.  This can cause the code to overflow.\n\nThere's no reason to migrate ports - it never changes.\nSo just make sure it matches.\n\nReported-by: Anthony Liguori <anthony@codemonkey.ws>\nSigned-off-by: Michael S. Tsirkin <mst@redhat.com>\nReviewed-by: Peter Maydell <peter.maydell@linaro.org>\nSigned-off-by: Juan Quintela <quintela@redhat.com>\n(cherry picked from commit ae2158ad6ce0845b2fae2a22aa7f19c0d7a71ce5)\nSigned-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>",
        "before_after_code_files": [
          "hw/ide/ahci.c||hw/ide/ahci.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "hw/ide/ahci.c||hw/ide/ahci.c"
          ],
          "candidate": [
            "hw/ide/ahci.c||hw/ide/ahci.c"
          ]
        }
      },
      "candidate_diff": {
        "hw/ide/ahci.c||hw/ide/ahci.c": [
          "File: hw/ide/ahci.c -> hw/ide/ahci.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1290:         VMSTATE_UINT32(control_regs.impl, AHCIState),",
          "1291:         VMSTATE_UINT32(control_regs.version, AHCIState),",
          "1292:         VMSTATE_UINT32(idp_index, AHCIState),",
          "1294:         VMSTATE_END_OF_LIST()",
          "1295:     },",
          "1296: };",
          "",
          "[Removed Lines]",
          "1293:         VMSTATE_INT32(ports, AHCIState),",
          "",
          "[Added Lines]",
          "1293:         VMSTATE_INT32_EQUAL(ports, AHCIState),",
          "",
          "---------------"
        ]
      }
    }
  ]
}