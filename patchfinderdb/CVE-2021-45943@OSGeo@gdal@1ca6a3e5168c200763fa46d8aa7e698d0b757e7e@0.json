{
  "cve_id": "CVE-2021-45943",
  "cve_desc": "GDAL 3.3.0 through 3.4.0 has a heap-based buffer overflow in PCIDSK::CPCIDSKFile::ReadFromFile (called from PCIDSK::CPCIDSKSegment::ReadFromFile and PCIDSK::CPCIDSKBinarySegment::CPCIDSKBinarySegment).",
  "repo": "OSGeo/gdal",
  "patch_hash": "1ca6a3e5168c200763fa46d8aa7e698d0b757e7e",
  "patch_info": {
    "commit_hash": "1ca6a3e5168c200763fa46d8aa7e698d0b757e7e",
    "repo": "OSGeo/gdal",
    "commit_url": "https://github.com/OSGeo/gdal/commit/1ca6a3e5168c200763fa46d8aa7e698d0b757e7e",
    "files": [
      "frmts/pcidsk/sdk/segment/cpcidskbinarysegment.cpp",
      "autotest/ogr/data/topojson/topojson1.topojson",
      "autotest/ogr/data/topojson/topojson2.topojson",
      "autotest/ogr/ogr_topojson.py",
      "ogr/ogrsf_frmts/geojson/directedacyclicgraph.hpp",
      "ogr/ogrsf_frmts/geojson/ogrtopojsonreader.cpp"
    ],
    "message": "Merge pull request #4944 from rouault/fix_ossfuzz_41993\n\nPCIDSK: fix write heap-buffer-overflow. Fixes https://bugs.chromium.org/p/oss-fuzz/issues/detail?id=41993",
    "before_after_code_files": [
      "frmts/pcidsk/sdk/segment/cpcidskbinarysegment.cpp||frmts/pcidsk/sdk/segment/cpcidskbinarysegment.cpp"
    ]
  },
  "patch_diff": {
    "frmts/pcidsk/sdk/segment/cpcidskbinarysegment.cpp||frmts/pcidsk/sdk/segment/cpcidskbinarysegment.cpp": [
      "File: frmts/pcidsk/sdk/segment/cpcidskbinarysegment.cpp -> frmts/pcidsk/sdk/segment/cpcidskbinarysegment.cpp",
      "--- Hunk 1 ---",
      "[Context before]",
      "31: #include \"pcidsk_exception.h\"",
      "32: #include \"core/pcidsk_utils.h\"",
      "34: #include <vector>",
      "35: #include <string>",
      "36: #include <cassert>",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "34: #include <limits>",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "73:     if (loaded_) {",
      "74:         return;",
      "75:     }",
      "79:     ReadFromFile(seg_data.buffer, 0, data_size - 1024);",
      "",
      "[Removed Lines]",
      "77:     seg_data.SetSize((int)data_size - 1024);",
      "",
      "[Added Lines]",
      "77:     if( data_size - 1024 > static_cast<uint64_t>(std::numeric_limits<int>::max()) )",
      "78:     {",
      "79:         return ThrowPCIDSKException(\"too large data_size\");",
      "80:     }",
      "82:     seg_data.SetSize((int)(data_size - 1024));",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "93913a849dc1d217a40dbf9d6e6a3a23c42b61a6",
      "candidate_info": {
        "commit_hash": "93913a849dc1d217a40dbf9d6e6a3a23c42b61a6",
        "repo": "OSGeo/gdal",
        "commit_url": "https://github.com/OSGeo/gdal/commit/93913a849dc1d217a40dbf9d6e6a3a23c42b61a6",
        "files": [
          "frmts/pcidsk/sdk/segment/cpcidskbinarysegment.cpp"
        ],
        "message": "PCIDSK: fix write heap-buffer-overflow. Fixes https://bugs.chromium.org/p/oss-fuzz/issues/detail?id=41993",
        "before_after_code_files": [
          "frmts/pcidsk/sdk/segment/cpcidskbinarysegment.cpp||frmts/pcidsk/sdk/segment/cpcidskbinarysegment.cpp"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/OSGeo/gdal/pull/4944"
        ],
        "olp_code_files": {
          "patch": [
            "frmts/pcidsk/sdk/segment/cpcidskbinarysegment.cpp||frmts/pcidsk/sdk/segment/cpcidskbinarysegment.cpp"
          ],
          "candidate": [
            "frmts/pcidsk/sdk/segment/cpcidskbinarysegment.cpp||frmts/pcidsk/sdk/segment/cpcidskbinarysegment.cpp"
          ]
        }
      },
      "candidate_diff": {
        "frmts/pcidsk/sdk/segment/cpcidskbinarysegment.cpp||frmts/pcidsk/sdk/segment/cpcidskbinarysegment.cpp": [
          "File: frmts/pcidsk/sdk/segment/cpcidskbinarysegment.cpp -> frmts/pcidsk/sdk/segment/cpcidskbinarysegment.cpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "31: #include \"pcidsk_exception.h\"",
          "32: #include \"core/pcidsk_utils.h\"",
          "34: #include <vector>",
          "35: #include <string>",
          "36: #include <cassert>",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "34: #include <limits>",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "73:     if (loaded_) {",
          "74:         return;",
          "75:     }",
          "79:     ReadFromFile(seg_data.buffer, 0, data_size - 1024);",
          "",
          "[Removed Lines]",
          "77:     seg_data.SetSize((int)data_size - 1024);",
          "",
          "[Added Lines]",
          "77:     if( data_size - 1024 > static_cast<uint64_t>(std::numeric_limits<int>::max()) )",
          "78:     {",
          "79:         return ThrowPCIDSKException(\"too large data_size\");",
          "80:     }",
          "82:     seg_data.SetSize((int)(data_size - 1024));",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "9b2bcbc47d1649adc0ab65b801f96f56156cf017",
      "candidate_info": {
        "commit_hash": "9b2bcbc47d1649adc0ab65b801f96f56156cf017",
        "repo": "OSGeo/gdal",
        "commit_url": "https://github.com/OSGeo/gdal/commit/9b2bcbc47d1649adc0ab65b801f96f56156cf017",
        "files": [
          "gdal/frmts/pcidsk/sdk/segment/cpcidskbinarysegment.cpp"
        ],
        "message": "Merge pull request #4944 from rouault/fix_ossfuzz_41993\n\nPCIDSK: fix write heap-buffer-overflow. Fixes https://bugs.chromium.org/p/oss-fuzz/issues/detail?id=41993",
        "before_after_code_files": [
          "gdal/frmts/pcidsk/sdk/segment/cpcidskbinarysegment.cpp||gdal/frmts/pcidsk/sdk/segment/cpcidskbinarysegment.cpp"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "gdal/frmts/pcidsk/sdk/segment/cpcidskbinarysegment.cpp||gdal/frmts/pcidsk/sdk/segment/cpcidskbinarysegment.cpp": [
          "File: gdal/frmts/pcidsk/sdk/segment/cpcidskbinarysegment.cpp -> gdal/frmts/pcidsk/sdk/segment/cpcidskbinarysegment.cpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "31: #include \"pcidsk_exception.h\"",
          "32: #include \"core/pcidsk_utils.h\"",
          "34: #include <vector>",
          "35: #include <string>",
          "36: #include <cassert>",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "34: #include <limits>",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "73:     if (loaded_) {",
          "74:         return;",
          "75:     }",
          "79:     ReadFromFile(seg_data.buffer, 0, data_size - 1024);",
          "",
          "[Removed Lines]",
          "77:     seg_data.SetSize((int)data_size - 1024);",
          "",
          "[Added Lines]",
          "77:     if( data_size - 1024 > static_cast<uint64_t>(std::numeric_limits<int>::max()) )",
          "78:     {",
          "79:         return ThrowPCIDSKException(\"too large data_size\");",
          "80:     }",
          "82:     seg_data.SetSize((int)(data_size - 1024));",
          "",
          "---------------"
        ]
      }
    }
  ]
}