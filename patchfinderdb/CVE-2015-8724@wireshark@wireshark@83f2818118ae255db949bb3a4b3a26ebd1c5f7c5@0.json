{
  "cve_id": "CVE-2015-8724",
  "cve_desc": "The AirPDcapDecryptWPABroadcastKey function in epan/crypt/airpdcap.c in the 802.11 dissector in Wireshark 1.12.x before 1.12.9 and 2.0.x before 2.0.1 does not verify the WPA broadcast key length, which allows remote attackers to cause a denial of service (out-of-bounds read and application crash) via a crafted packet.",
  "repo": "wireshark/wireshark",
  "patch_hash": "83f2818118ae255db949bb3a4b3a26ebd1c5f7c5",
  "patch_info": {
    "commit_hash": "83f2818118ae255db949bb3a4b3a26ebd1c5f7c5",
    "repo": "wireshark/wireshark",
    "commit_url": "https://github.com/wireshark/wireshark/commit/83f2818118ae255db949bb3a4b3a26ebd1c5f7c5",
    "files": [
      "epan/crypt/airpdcap.c"
    ],
    "message": "[airpdcap] check the length of the WPA broadcast key we calculated\n\nreturn an error if our key is shorter than the key type required for the\nencryption method we detected\n\nthis check prevents an out-of-bounds memory access when the key is copied\n\nBug: 11826\nChange-Id: Ic779b5d87aa97a3b2d2b2c92ce12d0fff4a85adc\nReviewed-on: https://code.wireshark.org/review/12743\nPetri-Dish: Michael Mann <mmann78@netscape.net>\nTested-by: Petri Dish Buildbot <buildbot-no-reply@wireshark.org>\nReviewed-by: Michael Mann <mmann78@netscape.net>",
    "before_after_code_files": [
      "epan/crypt/airpdcap.c||epan/crypt/airpdcap.c"
    ]
  },
  "patch_diff": {
    "epan/crypt/airpdcap.c||epan/crypt/airpdcap.c": [
      "File: epan/crypt/airpdcap.c -> epan/crypt/airpdcap.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "440:     }",
      "442:     key_len = (sa->wpa.key_ver==AIRPDCAP_WPA_KEY_VER_NOT_CCMP)?TKIP_GROUP_KEY_LEN:CCMP_GROUP_KEY_LEN;",
      "445:     DEBUG_DUMP(\"Broadcast key:\", szEncryptedKey, key_len);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "443:     if (key_len > key_bytes_len) {",
      "445:         return AIRPDCAP_RET_NO_VALID_HANDSHAKE;",
      "446:     }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "fc3b6a5f27dbaa559bbaea79e427cadf8df6dc18",
      "candidate_info": {
        "commit_hash": "fc3b6a5f27dbaa559bbaea79e427cadf8df6dc18",
        "repo": "wireshark/wireshark",
        "commit_url": "https://github.com/wireshark/wireshark/commit/fc3b6a5f27dbaa559bbaea79e427cadf8df6dc18",
        "files": [
          "epan/crypt/airpdcap.c"
        ],
        "message": "[airpdcap] check the length of the WPA broadcast key we calculated\n\nreturn an error if our key is shorter than the key type required for the\nencryption method we detected\n\nthis check prevents an out-of-bounds memory access when the key is copied\n\nBug: 11826\nChange-Id: Ic779b5d87aa97a3b2d2b2c92ce12d0fff4a85adc\nReviewed-on: https://code.wireshark.org/review/12743\nPetri-Dish: Michael Mann <mmann78@netscape.net>\nTested-by: Petri Dish Buildbot <buildbot-no-reply@wireshark.org>\nReviewed-by: Michael Mann <mmann78@netscape.net>\nReviewed-on: https://code.wireshark.org/review/12769\nReviewed-by: Alexis La Goutte <alexis.lagoutte@gmail.com>",
        "before_after_code_files": [
          "epan/crypt/airpdcap.c||epan/crypt/airpdcap.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "epan/crypt/airpdcap.c||epan/crypt/airpdcap.c"
          ],
          "candidate": [
            "epan/crypt/airpdcap.c||epan/crypt/airpdcap.c"
          ]
        }
      },
      "candidate_diff": {
        "epan/crypt/airpdcap.c||epan/crypt/airpdcap.c": [
          "File: epan/crypt/airpdcap.c -> epan/crypt/airpdcap.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "433:     }",
          "435:     key_len = (sa->wpa.key_ver==AIRPDCAP_WPA_KEY_VER_NOT_CCMP)?TKIP_GROUP_KEY_LEN:CCMP_GROUP_KEY_LEN;",
          "438:     DEBUG_DUMP(\"Broadcast key:\", szEncryptedKey, key_len);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "436:     if (key_len > key_bytes_len) {",
          "438:         return AIRPDCAP_RET_NO_VALID_HANDSHAKE;",
          "439:     }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "8110a703cc1f17222b3010b3993bbf8be21436d4",
      "candidate_info": {
        "commit_hash": "8110a703cc1f17222b3010b3993bbf8be21436d4",
        "repo": "wireshark/wireshark",
        "commit_url": "https://github.com/wireshark/wireshark/commit/8110a703cc1f17222b3010b3993bbf8be21436d4",
        "files": [
          "epan/crypt/airpdcap.c"
        ],
        "message": "[airpdcap] check the length of the WPA broadcast key we calculated\n\nreturn an error if our key is shorter than the key type required for the\nencryption method we detected\n\nthis check prevents an out-of-bounds memory access when the key is copied\n\nBug: 11826\nChange-Id: Ic779b5d87aa97a3b2d2b2c92ce12d0fff4a85adc\nReviewed-on: https://code.wireshark.org/review/12743\nPetri-Dish: Michael Mann <mmann78@netscape.net>\nTested-by: Petri Dish Buildbot <buildbot-no-reply@wireshark.org>\nReviewed-by: Michael Mann <mmann78@netscape.net>\nReviewed-on: https://code.wireshark.org/review/12771\nReviewed-by: Alexis La Goutte <alexis.lagoutte@gmail.com>",
        "before_after_code_files": [
          "epan/crypt/airpdcap.c||epan/crypt/airpdcap.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "epan/crypt/airpdcap.c||epan/crypt/airpdcap.c"
          ],
          "candidate": [
            "epan/crypt/airpdcap.c||epan/crypt/airpdcap.c"
          ]
        }
      },
      "candidate_diff": {
        "epan/crypt/airpdcap.c||epan/crypt/airpdcap.c": [
          "File: epan/crypt/airpdcap.c -> epan/crypt/airpdcap.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "461:     }",
          "463:     key_len = (sa->wpa.key_ver==AIRPDCAP_WPA_KEY_VER_NOT_CCMP)?TKIP_GROUP_KEY_LEN:CCMP_GROUP_KEY_LEN;",
          "466:     DEBUG_DUMP(\"Broadcast key:\", szEncryptedKey, key_len);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "464:     if (key_len > key_bytes_len) {",
          "466:         return AIRPDCAP_RET_NO_VALID_HANDSHAKE;",
          "467:     }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "476a5da22f0ccf31a3f832ac4154a4c390d553bb",
      "candidate_info": {
        "commit_hash": "476a5da22f0ccf31a3f832ac4154a4c390d553bb",
        "repo": "wireshark/wireshark",
        "commit_url": "https://github.com/wireshark/wireshark/commit/476a5da22f0ccf31a3f832ac4154a4c390d553bb",
        "files": [
          "epan/crypt/airpdcap.c"
        ],
        "message": "[airpdcap] check the length of the WPA broadcast key we calculated\n\nreturn an error if our key is shorter than the key type required for the\nencryption method we detected\n\nthis check prevents an out-of-bounds memory access when the key is copied\n\nBug: 11826\nChange-Id: Ic779b5d87aa97a3b2d2b2c92ce12d0fff4a85adc\nReviewed-on: https://code.wireshark.org/review/12743\nPetri-Dish: Michael Mann <mmann78@netscape.net>\nTested-by: Petri Dish Buildbot <buildbot-no-reply@wireshark.org>\nReviewed-by: Michael Mann <mmann78@netscape.net>\nReviewed-on: https://code.wireshark.org/review/12771\nReviewed-by: Alexis La Goutte <alexis.lagoutte@gmail.com>\n(cherry picked from commit 8110a703cc1f17222b3010b3993bbf8be21436d4)\nReviewed-on: https://code.wireshark.org/review/13762\nReviewed-by: Balint Reczey <balint@balintreczey.hu>",
        "before_after_code_files": [
          "epan/crypt/airpdcap.c||epan/crypt/airpdcap.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "epan/crypt/airpdcap.c||epan/crypt/airpdcap.c"
          ],
          "candidate": [
            "epan/crypt/airpdcap.c||epan/crypt/airpdcap.c"
          ]
        }
      },
      "candidate_diff": {
        "epan/crypt/airpdcap.c||epan/crypt/airpdcap.c": [
          "File: epan/crypt/airpdcap.c -> epan/crypt/airpdcap.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "456:     }",
          "458:     key_len = (sa->wpa.key_ver==AIRPDCAP_WPA_KEY_VER_NOT_CCMP)?TKIP_GROUP_KEY_LEN:CCMP_GROUP_KEY_LEN;",
          "461:     DEBUG_DUMP(\"Broadcast key:\", szEncryptedKey, key_len);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "459:     if (key_len > key_bytes_len) {",
          "461:         return AIRPDCAP_RET_NO_VALID_HANDSHAKE;",
          "462:     }",
          "",
          "---------------"
        ]
      }
    }
  ]
}