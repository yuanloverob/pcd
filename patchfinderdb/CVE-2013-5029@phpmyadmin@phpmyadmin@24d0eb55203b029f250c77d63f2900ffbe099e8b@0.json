{
  "cve_id": "CVE-2013-5029",
  "cve_desc": "phpMyAdmin 3.5.x and 4.0.x before 4.0.5 allows remote attackers to bypass the clickjacking protection mechanism via certain vectors related to Header.class.php.",
  "repo": "phpmyadmin/phpmyadmin",
  "patch_hash": "24d0eb55203b029f250c77d63f2900ffbe099e8b",
  "patch_info": {
    "commit_hash": "24d0eb55203b029f250c77d63f2900ffbe099e8b",
    "repo": "phpmyadmin/phpmyadmin",
    "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/24d0eb55203b029f250c77d63f2900ffbe099e8b",
    "files": [
      "js/cross_framing_protection.js",
      "libraries/Header.class.php"
    ],
    "message": "Improved protection against cross framing\n\nWe now include CSS to hide the page and display it conditionally after\nchecking we're in top frame. This adds extra protection for clients who\ndo not support X-Frame-Options.\n\nSee also http://en.wikipedia.org/wiki/Framekiller and\nhttps://www.owasp.org/index.php/Clickjacking_Defense_Cheat_Sheet",
    "before_after_code_files": [
      "js/cross_framing_protection.js||js/cross_framing_protection.js",
      "libraries/Header.class.php||libraries/Header.class.php"
    ]
  },
  "patch_diff": {
    "js/cross_framing_protection.js||js/cross_framing_protection.js": [
      "File: js/cross_framing_protection.js -> js/cross_framing_protection.js",
      "--- Hunk 1 ---",
      "[Context before]",
      "14: }",
      "",
      "[Removed Lines]",
      "7: try {",
      "8:     if (top != self) {",
      "9:         top.location.href = self.location.href;",
      "10:     }",
      "11: } catch(e) {",
      "12:     alert(\"Redirecting... (error: \" + e);",
      "13:     top.location.href = self.location.href;",
      "",
      "[Added Lines]",
      "5: if(self == top) {",
      "6:     document.documentElement.style.display = 'block' ;",
      "7: } else {",
      "8:     top.location = self.location ;",
      "",
      "---------------"
    ],
    "libraries/Header.class.php||libraries/Header.class.php": [
      "File: libraries/Header.class.php -> libraries/Header.class.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "531:         $retval  = '<meta charset=\"utf-8\" />';",
      "532:         $retval .= '<meta name=\"robots\" content=\"noindex,nofollow\" />';",
      "533:         $retval .= '<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\">';",
      "534:         return $retval;",
      "535:     }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "534:         $retval .= '<style>html{display: none;}</style>';",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "240b8332db53dedc27baeec5306dabad3bdece3b",
      "candidate_info": {
        "commit_hash": "240b8332db53dedc27baeec5306dabad3bdece3b",
        "repo": "phpmyadmin/phpmyadmin",
        "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/240b8332db53dedc27baeec5306dabad3bdece3b",
        "files": [
          "doc/config.rst",
          "js/cross_framing_protection.js",
          "libraries/Header.class.php",
          "libraries/Scripts.class.php",
          "libraries/config.default.php",
          "libraries/config/messages.inc.php",
          "libraries/config/setup.forms.php"
        ],
        "message": "Readd AllowThirdPartyFraming option\n\nWe want by default no framing of phpMyAdmin, but still some sites might\nneed to embed it, so configuration option (with appropriate security\nwarning) is there.\n\nThis basically reverts d7e0bed28443e6cf8f41965cc2f27be19c667fa6.",
        "before_after_code_files": [
          "js/cross_framing_protection.js||js/cross_framing_protection.js",
          "libraries/Header.class.php||libraries/Header.class.php",
          "libraries/Scripts.class.php||libraries/Scripts.class.php",
          "libraries/config.default.php||libraries/config.default.php",
          "libraries/config/messages.inc.php||libraries/config/messages.inc.php",
          "libraries/config/setup.forms.php||libraries/config/setup.forms.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "js/cross_framing_protection.js||js/cross_framing_protection.js",
            "libraries/Header.class.php||libraries/Header.class.php"
          ],
          "candidate": [
            "js/cross_framing_protection.js||js/cross_framing_protection.js",
            "libraries/Header.class.php||libraries/Header.class.php"
          ]
        }
      },
      "candidate_diff": {
        "js/cross_framing_protection.js||js/cross_framing_protection.js": [
          "File: js/cross_framing_protection.js -> js/cross_framing_protection.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "7: try {",
          "8:     if (top != self) {",
          "9:         top.location.href = self.location.href;",
          "10:     }",
          "11: } catch(e) {",
          "12:     alert(\"Redirecting... (error: \" + e);",
          "13:     top.location.href = self.location.href;",
          "14: }",
          "",
          "---------------"
        ],
        "libraries/Header.class.php||libraries/Header.class.php": [
          "File: libraries/Header.class.php -> libraries/Header.class.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "158:         $this->_scripts->addFile('jquery/jquery.ba-hashchange-1.3.js');",
          "159:         $this->_scripts->addFile('jquery/jquery.debounce-1.0.5.js');",
          "160:         $this->_scripts->addFile('jquery/jquery.menuResizer-1.0.js');",
          "161:         $this->_scripts->addFile('rte.js');",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "163:         if ($GLOBALS['cfg']['AllowThirdPartyFraming'] === false) {",
          "164:             $this->_scripts->addFile('cross_framing_protection.js');",
          "165:         }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "450:         $GLOBALS['now'] = gmdate('D, d M Y H:i:s') . ' GMT';",
          "451:         if (! defined('TESTSUITE')) {",
          "452:             header(",
          "453:                 \"X-Content-Security-Policy: default-src 'self' \"",
          "454:                 . $GLOBALS['cfg']['CSPAllow'] . ';'",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "459:             if (! $GLOBALS['cfg']['AllowThirdPartyFraming']) {",
          "460:                 header(",
          "461:                     'X-Frame-Options: DENY'",
          "462:                 );",
          "463:             }",
          "",
          "---------------"
        ],
        "libraries/Scripts.class.php||libraries/Scripts.class.php": [
          "File: libraries/Scripts.class.php -> libraries/Scripts.class.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "129:             || strpos($filename, 'ajax.js') !== false",
          "130:             || strpos($filename, 'navigation.js') !== false",
          "131:             || strpos($filename, 'get_image.js.php') !== false",
          "132:         ) {",
          "133:             return 0;",
          "134:         } else {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "132:             || strpos($filename, 'cross_framing_protection.js') !== false",
          "",
          "---------------"
        ],
        "libraries/config.default.php||libraries/config.default.php": [
          "File: libraries/config.default.php -> libraries/config.default.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "84: $cfg['TranslationWarningThreshold'] = 80;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "92: $cfg['AllowThirdPartyFraming'] = false;",
          "",
          "---------------"
        ],
        "libraries/config/messages.inc.php||libraries/config/messages.inc.php": [
          "File: libraries/config/messages.inc.php -> libraries/config/messages.inc.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "17: $strConfigAllowArbitraryServer_desc = __('If enabled user can enter any MySQL server in login form for cookie auth');",
          "18: $strConfigAllowArbitraryServer_name = __('Allow login to any MySQL server');",
          "19: $strConfigAllowUserDropDatabase_name = __('Show &quot;Drop database&quot; link to normal users');",
          "20: $strConfigblowfish_secret_desc = __('Secret passphrase used for encrypting cookies in [kbd]cookie[/kbd] authentication');",
          "21: $strConfigblowfish_secret_name = __('Blowfish secret');",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "19: $strConfigAllowThirdPartyFraming_desc = __('Enabling this allows a page located on a different domain to call phpMyAdmin inside a frame, and is a potential [strong]security hole[/strong] allowing cross-frame scripting attacks');",
          "20: $strConfigAllowThirdPartyFraming_name = __('Allow third party framing');",
          "",
          "---------------"
        ],
        "libraries/config/setup.forms.php||libraries/config/setup.forms.php": [
          "File: libraries/config/setup.forms.php -> libraries/config/setup.forms.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "136:     'MemoryLimit',",
          "137:     'SkipLockedTables',",
          "138:     'DisableMultiTableMaintenance',",
          "140: $forms['Sql_queries']['Sql_queries'] = array(",
          "141:     'ShowSQL',",
          "142:     'Confirm',",
          "",
          "[Removed Lines]",
          "139:     'UseDbSearch');",
          "",
          "[Added Lines]",
          "139:     'UseDbSearch',",
          "140:     'AllowThirdPartyFraming');",
          "",
          "---------------"
        ]
      }
    }
  ]
}