{
  "cve_id": "CVE-2018-16645",
  "cve_desc": "There is an excessive memory allocation issue in the functions ReadBMPImage of coders/bmp.c and ReadDIBImage of coders/dib.c in ImageMagick 7.0.8-11, which allows remote attackers to cause a denial of service via a crafted image file.",
  "repo": "ImageMagick/ImageMagick",
  "patch_hash": "ecb31dbad39ccdc65868d5d2a37f0f0521250832",
  "patch_info": {
    "commit_hash": "ecb31dbad39ccdc65868d5d2a37f0f0521250832",
    "repo": "ImageMagick/ImageMagick",
    "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/ecb31dbad39ccdc65868d5d2a37f0f0521250832",
    "files": [
      "coders/bmp.c"
    ],
    "message": "https://github.com/ImageMagick/ImageMagick/issues/1268",
    "before_after_code_files": [
      "coders/bmp.c||coders/bmp.c"
    ]
  },
  "patch_diff": {
    "coders/bmp.c||coders/bmp.c": [
      "File: coders/bmp.c -> coders/bmp.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "661:         if (bmp_info.size < 40)",
      "662:           ThrowReaderException(CorruptImageError,\"NonOS2HeaderSizeError\");",
      "663:         bmp_info.width=(ssize_t) ReadBlobLSBSignedLong(image);",
      "664:         bmp_info.height=(ssize_t) ReadBlobLSBSignedLong(image);",
      "665:         bmp_info.planes=ReadBlobLSBShort(image);",
      "666:         bmp_info.bits_per_pixel=ReadBlobLSBShort(image);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "664:         bmp_info.height=(ssize_t) ReadBlobLSBSignedLong(image);",
      "665:         bmp_info.planes=ReadBlobLSBShort(image);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "db0add932fb850d762b02604ca3053b7d7ab6deb",
      "candidate_info": {
        "commit_hash": "db0add932fb850d762b02604ca3053b7d7ab6deb",
        "repo": "ImageMagick/ImageMagick",
        "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/db0add932fb850d762b02604ca3053b7d7ab6deb",
        "files": [
          "coders/bmp.c"
        ],
        "message": "Prevent infinite loop",
        "before_after_code_files": [
          "coders/bmp.c||coders/bmp.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "coders/bmp.c||coders/bmp.c"
          ],
          "candidate": [
            "coders/bmp.c||coders/bmp.c"
          ]
        }
      },
      "candidate_diff": {
        "coders/bmp.c||coders/bmp.c": [
          "File: coders/bmp.c -> coders/bmp.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "660:         if (bmp_info.size < 40)",
          "661:           ThrowReaderException(CorruptImageError,\"NonOS2HeaderSizeError\");",
          "662:         bmp_info.width=(ssize_t) ReadBlobLSBSignedLong(image);",
          "664:         bmp_info.planes=ReadBlobLSBShort(image);",
          "665:         bmp_info.bits_per_pixel=ReadBlobLSBShort(image);",
          "666:         bmp_info.compression=ReadBlobLSBLong(image);",
          "",
          "[Removed Lines]",
          "663:         bmp_info.height=(ssize_t) ReadBlobLSBSignedLong(image);",
          "",
          "[Added Lines]",
          "663:         bmp_info.height=(ssize_t) ReadBlobLSBSignedLong(image);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1444:             DuplicateBlob(flipped_image,image);",
          "1445:             ReplaceImageInList(&image, flipped_image);",
          "1446:             image=flipped_image;",
          "1447:           }",
          "1454:         break;",
          "1456:     if (bmp_info.ba_offset != 0)",
          "",
          "[Removed Lines]",
          "1448:       }",
          "1450:       Proceed to next image.",
          "1452:     if (image_info->number_scenes != 0)",
          "1453:       if (image->scene >= (image_info->scene+image_info->number_scenes-1))",
          "",
          "[Added Lines]",
          "1447:           }",
          "1448:       }",
          "1450:       Proceed to next image.",
          "",
          "---------------"
        ]
      }
    }
  ]
}