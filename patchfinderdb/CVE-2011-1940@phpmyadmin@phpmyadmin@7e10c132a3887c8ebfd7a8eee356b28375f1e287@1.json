{
  "cve_id": "CVE-2011-1940",
  "cve_desc": "Multiple cross-site scripting (XSS) vulnerabilities in phpMyAdmin 3.3.x before 3.3.10.1 and 3.4.x before 3.4.1 allow remote attackers to inject arbitrary web script or HTML via a crafted table name that triggers improper HTML rendering on a Tracking page, related to (1) libraries/tbl_links.inc.php and (2) tbl_tracking.php.",
  "repo": "phpmyadmin/phpmyadmin",
  "patch_hash": "7e10c132a3887c8ebfd7a8eee356b28375f1e287",
  "patch_info": {
    "commit_hash": "7e10c132a3887c8ebfd7a8eee356b28375f1e287",
    "repo": "phpmyadmin/phpmyadmin",
    "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/7e10c132a3887c8ebfd7a8eee356b28375f1e287",
    "files": [
      "libraries/tbl_links.inc.php",
      "tbl_tracking.php"
    ],
    "message": "XSS in Tracking page, more",
    "before_after_code_files": [
      "libraries/tbl_links.inc.php||libraries/tbl_links.inc.php",
      "tbl_tracking.php||tbl_tracking.php"
    ]
  },
  "patch_diff": {
    "libraries/tbl_links.inc.php||libraries/tbl_links.inc.php": [
      "File: libraries/tbl_links.inc.php -> libraries/tbl_links.inc.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "113: if(PMA_Tracker::isActive() and PMA_Tracker::isTracked($GLOBALS[\"db\"], $GLOBALS[\"table\"]))",
      "114: {",
      "116:     $msg->display();",
      "117: }",
      "",
      "[Removed Lines]",
      "115:     $msg = PMA_Message::notice('<a href=\"tbl_tracking.php?'.$url_query.'\">'.sprintf(__('Tracking of %s.%s is activated.'), $GLOBALS[\"db\"], $GLOBALS[\"table\"]).'</a>');",
      "",
      "[Added Lines]",
      "115:     $msg = PMA_Message::notice('<a href=\"tbl_tracking.php?'.$url_query.'\">'.sprintf(__('Tracking of %s.%s is activated.'), htmlspecialchars($GLOBALS[\"db\"]), htmlspecialchars($GLOBALS[\"table\"])).'</a>');",
      "",
      "---------------"
    ],
    "tbl_tracking.php||tbl_tracking.php": [
      "File: tbl_tracking.php -> tbl_tracking.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "179:     $tracking_set = rtrim($tracking_set, ',');",
      "181:     if (PMA_Tracker::createVersion($GLOBALS['db'], $GLOBALS['table'], $_REQUEST['version'], $tracking_set )) {",
      "183:         $msg->display();",
      "184:     }",
      "185: }",
      "",
      "[Removed Lines]",
      "182:         $msg = PMA_Message::success(sprintf(__('Version %s is created, tracking for %s.%s is activated.'), $_REQUEST['version'], $GLOBALS['db'], $GLOBALS['table']));",
      "",
      "[Added Lines]",
      "182:         $msg = PMA_Message::success(sprintf(__('Version %s is created, tracking for %s.%s is activated.'), $_REQUEST['version'], htmlspecialchars($GLOBALS['db']), htmlspecialchars($GLOBALS['table'])));",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "188: if (isset($_REQUEST['submit_deactivate_now'])) {",
      "189:     if (PMA_Tracker::deactivateTracking($GLOBALS['db'], $GLOBALS['table'], $_REQUEST['version'])) {",
      "191:         $msg->display();",
      "192:     }",
      "193: }",
      "",
      "[Removed Lines]",
      "190:         $msg = PMA_Message::success(sprintf(__('Tracking for %s.%s , version %s is deactivated.'), $GLOBALS['db'], $GLOBALS['table'], $_REQUEST['version']));",
      "",
      "[Added Lines]",
      "190:         $msg = PMA_Message::success(sprintf(__('Tracking for %s.%s , version %s is deactivated.'), htmlspecialchars($GLOBALS['db']), htmlspecialchars($GLOBALS['table']), $_REQUEST['version']));",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "196: if (isset($_REQUEST['submit_activate_now'])) {",
      "197:     if (PMA_Tracker::activateTracking($GLOBALS['db'], $GLOBALS['table'], $_REQUEST['version'])) {",
      "199:         $msg->display();",
      "200:     }",
      "201: }",
      "",
      "[Removed Lines]",
      "198:         $msg = PMA_Message::success(sprintf(__('Tracking for %s.%s , version %s is activated.'), $GLOBALS['db'], $GLOBALS['table'], $_REQUEST['version']));",
      "",
      "[Added Lines]",
      "198:         $msg = PMA_Message::success(sprintf(__('Tracking for %s.%s , version %s is activated.'), htmlspecialchars($GLOBALS['db']), htmlspecialchars($GLOBALS['table']), $_REQUEST['version']));",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "e84fe978d23df1949cf4ea7d640a4a30677b40ab",
      "candidate_info": {
        "commit_hash": "e84fe978d23df1949cf4ea7d640a4a30677b40ab",
        "repo": "phpmyadmin/phpmyadmin",
        "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/e84fe978d23df1949cf4ea7d640a4a30677b40ab",
        "files": [
          "libraries/tbl_links.inc.php",
          "tbl_tracking.php"
        ],
        "message": "Always use single format string for db.table, this prevents errors in translations",
        "before_after_code_files": [
          "libraries/tbl_links.inc.php||libraries/tbl_links.inc.php",
          "tbl_tracking.php||tbl_tracking.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "libraries/tbl_links.inc.php||libraries/tbl_links.inc.php",
            "tbl_tracking.php||tbl_tracking.php"
          ],
          "candidate": [
            "libraries/tbl_links.inc.php||libraries/tbl_links.inc.php",
            "tbl_tracking.php||tbl_tracking.php"
          ]
        }
      },
      "candidate_diff": {
        "libraries/tbl_links.inc.php||libraries/tbl_links.inc.php": [
          "File: libraries/tbl_links.inc.php -> libraries/tbl_links.inc.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "123: unset($tabs);",
          "125: if (PMA_Tracker::isActive() and PMA_Tracker::isTracked($GLOBALS[\"db\"], $GLOBALS[\"table\"])) {",
          "127:     $msg->display();",
          "128: }",
          "",
          "[Removed Lines]",
          "126:     $msg = PMA_Message::notice('<a href=\"tbl_tracking.php?'.$url_query.'\">'.sprintf(__('Tracking of %s.%s is activated.'), htmlspecialchars($GLOBALS[\"db\"]), htmlspecialchars($GLOBALS[\"table\"])).'</a>');",
          "",
          "[Added Lines]",
          "126:     $msg = PMA_Message::notice('<a href=\"tbl_tracking.php?'.$url_query.'\">'.sprintf(__('Tracking of %s is activated.'), htmlspecialchars($GLOBALS[\"db\"] . '.' . $GLOBALS[\"table\"])).'</a>');",
          "",
          "---------------"
        ],
        "tbl_tracking.php||tbl_tracking.php": [
          "File: tbl_tracking.php -> tbl_tracking.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "170:     $tracking_set = rtrim($tracking_set, ',');",
          "172:     if (PMA_Tracker::createVersion($GLOBALS['db'], $GLOBALS['table'], $_REQUEST['version'], $tracking_set )) {",
          "174:         $msg->display();",
          "175:     }",
          "176: }",
          "",
          "[Removed Lines]",
          "173:         $msg = PMA_Message::success(sprintf(__('Version %s is created, tracking for %s.%s is activated.'), $_REQUEST['version'], htmlspecialchars($GLOBALS['db']), htmlspecialchars($GLOBALS['table'])));",
          "",
          "[Added Lines]",
          "173:         $msg = PMA_Message::success(sprintf(__('Version %1$s is created, tracking for %2$s is activated.'), $_REQUEST['version'], htmlspecialchars($GLOBALS['db'] . '.' . $GLOBALS['table'])));",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "179: if (isset($_REQUEST['submit_deactivate_now'])) {",
          "180:     if (PMA_Tracker::deactivateTracking($GLOBALS['db'], $GLOBALS['table'], $_REQUEST['version'])) {",
          "182:         $msg->display();",
          "183:     }",
          "184: }",
          "",
          "[Removed Lines]",
          "181:         $msg = PMA_Message::success(sprintf(__('Tracking for %s.%s , version %s is deactivated.'), htmlspecialchars($GLOBALS['db']), htmlspecialchars($GLOBALS['table']), $_REQUEST['version']));",
          "",
          "[Added Lines]",
          "181:         $msg = PMA_Message::success(sprintf(__('Tracking for %1$s, version %2$s is deactivated.'), htmlspecialchars($GLOBALS['db'] . '.' . $GLOBALS['table']), $_REQUEST['version']));",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "187: if (isset($_REQUEST['submit_activate_now'])) {",
          "188:     if (PMA_Tracker::activateTracking($GLOBALS['db'], $GLOBALS['table'], $_REQUEST['version'])) {",
          "190:         $msg->display();",
          "191:     }",
          "192: }",
          "",
          "[Removed Lines]",
          "189:         $msg = PMA_Message::success(sprintf(__('Tracking for %s.%s , version %s is activated.'), htmlspecialchars($GLOBALS['db']), htmlspecialchars($GLOBALS['table']), $_REQUEST['version']));",
          "",
          "[Added Lines]",
          "189:         $msg = PMA_Message::success(sprintf(__('Tracking for %1$s, version %2$s is activated.'), htmlspecialchars($GLOBALS['db'] . '.' . $GLOBALS['table']), $_REQUEST['version']));",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "699:         <div id=\"div_deactivate_tracking\">",
          "700:         <form method=\"post\" action=\"tbl_tracking.php?<?php echo $url_query; ?>\">",
          "701:         <fieldset>",
          "703:             <input type=\"hidden\" name=\"version\" value=\"<?php echo $last_version; ?>\" />",
          "704:             <input type=\"submit\" name=\"submit_deactivate_now\" value=\"<?php echo __('Deactivate now'); ?>\" />",
          "705:         </fieldset>",
          "",
          "[Removed Lines]",
          "702:             <legend><?php printf(__('Deactivate tracking for %s.%s'), htmlspecialchars($GLOBALS['db']), htmlspecialchars($GLOBALS['table'])); ?></legend>",
          "",
          "[Added Lines]",
          "702:             <legend><?php printf(__('Deactivate tracking for %s'), htmlspecialchars($GLOBALS['db'] . '.' . $GLOBALS['table'])); ?></legend>",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "712:         <div id=\"div_activate_tracking\">",
          "713:         <form method=\"post\" action=\"tbl_tracking.php?<?php echo $url_query; ?>\">",
          "714:         <fieldset>",
          "716:             <input type=\"hidden\" name=\"version\" value=\"<?php echo $last_version; ?>\" />",
          "717:             <input type=\"submit\" name=\"submit_activate_now\" value=\"<?php echo __('Activate now'); ?>\" />",
          "718:         </fieldset>",
          "",
          "[Removed Lines]",
          "715:             <legend><?php printf(__('Activate tracking for %s.%s'), htmlspecialchars($GLOBALS['db']), htmlspecialchars($GLOBALS['table'])); ?></legend>",
          "",
          "[Added Lines]",
          "715:             <legend><?php printf(__('Activate tracking for %s'), htmlspecialchars($GLOBALS['db'] . '.' . $GLOBALS['table'])); ?></legend>",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "727: <form method=\"post\" action=\"tbl_tracking.php?<?php echo $url_query; ?>\">",
          "728: <?php echo PMA_generate_common_hidden_inputs($GLOBALS['db'], $GLOBALS['table']); ?>",
          "729: <fieldset>",
          "732:     <input type=\"hidden\" name=\"version\" value=\"<?php echo ($last_version + 1); ?>\" />",
          "",
          "[Removed Lines]",
          "730:     <legend><?php printf(__('Create version %1$s of %2$s.%3$s'), ($last_version + 1), htmlspecialchars($GLOBALS['db']), htmlspecialchars($GLOBALS['table'])); ?></legend>",
          "",
          "[Added Lines]",
          "730:     <legend><?php printf(__('Create version %1$s of %2$s'), ($last_version + 1), htmlspecialchars($GLOBALS['db'] . '.' . $GLOBALS['table'])); ?></legend>",
          "",
          "---------------"
        ]
      }
    }
  ]
}