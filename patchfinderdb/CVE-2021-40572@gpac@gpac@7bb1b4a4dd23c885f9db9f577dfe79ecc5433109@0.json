{
  "cve_id": "CVE-2021-40572",
  "cve_desc": "The binary MP4Box in Gpac 1.0.1 has a double-free bug in the av1dmx_finalize function in reframe_av1.c, which allows attackers to cause a denial of service.",
  "repo": "gpac/gpac",
  "patch_hash": "7bb1b4a4dd23c885f9db9f577dfe79ecc5433109",
  "patch_info": {
    "commit_hash": "7bb1b4a4dd23c885f9db9f577dfe79ecc5433109",
    "repo": "gpac/gpac",
    "commit_url": "https://github.com/gpac/gpac/commit/7bb1b4a4dd23c885f9db9f577dfe79ecc5433109",
    "files": [
      "src/media_tools/av_parsers.c"
    ],
    "message": "fixed #1893",
    "before_after_code_files": [
      "src/media_tools/av_parsers.c||src/media_tools/av_parsers.c"
    ]
  },
  "patch_diff": {
    "src/media_tools/av_parsers.c||src/media_tools/av_parsers.c": [
      "File: src/media_tools/av_parsers.c -> src/media_tools/av_parsers.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "3980:   gf_list_del(l1);",
      "3981:   gf_list_del(l2);",
      "3982:   if (state->bs) {",
      "3987:    gf_bs_del(state->bs);",
      "3988:   }",
      "3989:   state->bs = NULL;",
      "",
      "[Removed Lines]",
      "3983:    if (gf_bs_get_position(state->bs)) {",
      "3984:     u32 size;",
      "3985:     gf_bs_get_content_no_truncate(state->bs, &state->frame_obus, &size, &state->frame_obus_alloc);",
      "3986:    }",
      "",
      "[Added Lines]",
      "3983:    u32 size;",
      "3984:    gf_bs_get_content_no_truncate(state->bs, &state->frame_obus, &size, &state->frame_obus_alloc);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "b28f50fad39c4df9d15374ba1a4551bb5480f342",
      "candidate_info": {
        "commit_hash": "b28f50fad39c4df9d15374ba1a4551bb5480f342",
        "repo": "gpac/gpac",
        "commit_url": "https://github.com/gpac/gpac/commit/b28f50fad39c4df9d15374ba1a4551bb5480f342",
        "files": [
          "src/media_tools/av_parsers.c"
        ],
        "message": "further fixes for #1893",
        "before_after_code_files": [
          "src/media_tools/av_parsers.c||src/media_tools/av_parsers.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/media_tools/av_parsers.c||src/media_tools/av_parsers.c"
          ],
          "candidate": [
            "src/media_tools/av_parsers.c||src/media_tools/av_parsers.c"
          ]
        }
      },
      "candidate_diff": {
        "src/media_tools/av_parsers.c||src/media_tools/av_parsers.c": [
          "File: src/media_tools/av_parsers.c -> src/media_tools/av_parsers.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "3980:   gf_list_del(l1);",
          "3981:   gf_list_del(l2);",
          "3982:   if (state->bs) {",
          "3985:     gf_free(state->frame_obus);",
          "3986:     state->frame_obus = NULL;",
          "3987:     state->frame_obus_alloc = 0;",
          "3988:    }",
          "3990:    gf_bs_del(state->bs);",
          "3991:   }",
          "3992:   state->bs = NULL;",
          "",
          "[Removed Lines]",
          "3983:    u32 size;",
          "3984:    if (!gf_bs_get_position(state->bs) && state->frame_obus) {",
          "3989:    gf_bs_get_content_no_truncate(state->bs, &state->frame_obus, &size, &state->frame_obus_alloc);",
          "",
          "[Added Lines]",
          "3983:    u32 size, asize=0;",
          "3984:    u8 *ptr=NULL;",
          "3986:    gf_bs_get_content_no_truncate(state->bs, &ptr, &size, &asize);",
          "3988:    if (ptr != state->frame_obus) {",
          "3989:     gf_free(ptr);",
          "3990:    }",
          "3991:    if (state->frame_obus) {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "d003a572d57940460eb0bffbdbb824b59d4ddac9",
      "candidate_info": {
        "commit_hash": "d003a572d57940460eb0bffbdbb824b59d4ddac9",
        "repo": "gpac/gpac",
        "commit_url": "https://github.com/gpac/gpac/commit/d003a572d57940460eb0bffbdbb824b59d4ddac9",
        "files": [
          "src/media_tools/av_parsers.c"
        ],
        "message": "fixed mem leak introduced by 7bb1b4a4",
        "before_after_code_files": [
          "src/media_tools/av_parsers.c||src/media_tools/av_parsers.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/media_tools/av_parsers.c||src/media_tools/av_parsers.c"
          ],
          "candidate": [
            "src/media_tools/av_parsers.c||src/media_tools/av_parsers.c"
          ]
        }
      },
      "candidate_diff": {
        "src/media_tools/av_parsers.c||src/media_tools/av_parsers.c": [
          "File: src/media_tools/av_parsers.c -> src/media_tools/av_parsers.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "3981:   gf_list_del(l2);",
          "3982:   if (state->bs) {",
          "3983:    u32 size;",
          "3984:    gf_bs_get_content_no_truncate(state->bs, &state->frame_obus, &size, &state->frame_obus_alloc);",
          "3985:    gf_bs_del(state->bs);",
          "3986:   }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3984:    if (!gf_bs_get_position(state->bs) && state->frame_obus) {",
          "3985:     gf_free(state->frame_obus);",
          "3986:     state->frame_obus = NULL;",
          "3987:     state->frame_obus_alloc = 0;",
          "3988:    }",
          "",
          "---------------"
        ]
      }
    }
  ]
}