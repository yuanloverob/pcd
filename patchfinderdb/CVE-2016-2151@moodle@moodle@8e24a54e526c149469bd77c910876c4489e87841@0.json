{
  "cve_id": "CVE-2016-2151",
  "cve_desc": "user/index.php in Moodle through 2.6.11, 2.7.x before 2.7.13, 2.8.x before 2.8.11, 2.9.x before 2.9.5, and 3.0.x before 3.0.3 grants excessive authorization on the basis of the moodle/course:viewhiddenuserfields capability, which allows remote authenticated users to discover student e-mail addresses by leveraging the teacher role and reading a Participants list.",
  "repo": "moodle/moodle",
  "patch_hash": "8e24a54e526c149469bd77c910876c4489e87841",
  "patch_info": {
    "commit_hash": "8e24a54e526c149469bd77c910876c4489e87841",
    "repo": "moodle/moodle",
    "commit_url": "https://github.com/moodle/moodle/commit/8e24a54e526c149469bd77c910876c4489e87841",
    "files": [
      "user/index.php"
    ],
    "message": "MDL-52433 user: Remove unnecessary capability check",
    "before_after_code_files": [
      "user/index.php||user/index.php"
    ]
  },
  "patch_diff": {
    "user/index.php||user/index.php": [
      "File: user/index.php -> user/index.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "649:                     $row->cells[1]->text .= get_string('role').get_string('labelsep', 'langconfig').$user->role.'<br />';",
      "650:                 }",
      "651:                 if ($user->maildisplay == 1 or ($user->maildisplay == 2 and ($course->id != SITEID) and !isguestuser()) or",
      "653:                             in_array('email', $extrafields) or ($user->id == $USER->id)) {",
      "654:                     $row->cells[1]->text .= get_string('email').get_string('labelsep', 'langconfig').html_writer::link(\"mailto:$user->email\", $user->email) . '<br />';",
      "655:                 }",
      "",
      "[Removed Lines]",
      "652:                             has_capability('moodle/course:viewhiddenuserfields', $context) or",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "094fddd00f2e8e832e21e80f417c7b88b33a1f27",
      "candidate_info": {
        "commit_hash": "094fddd00f2e8e832e21e80f417c7b88b33a1f27",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/094fddd00f2e8e832e21e80f417c7b88b33a1f27",
        "files": [
          "user/index.php"
        ],
        "message": "MDL-52433 user: Remove unnecessary capability check",
        "before_after_code_files": [
          "user/index.php||user/index.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "user/index.php||user/index.php"
          ],
          "candidate": [
            "user/index.php||user/index.php"
          ]
        }
      },
      "candidate_diff": {
        "user/index.php||user/index.php": [
          "File: user/index.php -> user/index.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "649:                     $row->cells[1]->text .= get_string('role').get_string('labelsep', 'langconfig').$user->role.'<br />';",
          "650:                 }",
          "651:                 if ($user->maildisplay == 1 or ($user->maildisplay == 2 and ($course->id != SITEID) and !isguestuser()) or",
          "653:                             in_array('email', $extrafields) or ($user->id == $USER->id)) {",
          "654:                     $row->cells[1]->text .= get_string('email').get_string('labelsep', 'langconfig').html_writer::link(\"mailto:$user->email\", $user->email) . '<br />';",
          "655:                 }",
          "",
          "[Removed Lines]",
          "652:                             has_capability('moodle/course:viewhiddenuserfields', $context) or",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "a0034bb01773e36dffed2a665646f9cc31d68d5b",
      "candidate_info": {
        "commit_hash": "a0034bb01773e36dffed2a665646f9cc31d68d5b",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/a0034bb01773e36dffed2a665646f9cc31d68d5b",
        "files": [
          "user/index.php"
        ],
        "message": "MDL-52433 user: Remove unnecessary capability check",
        "before_after_code_files": [
          "user/index.php||user/index.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "user/index.php||user/index.php"
          ],
          "candidate": [
            "user/index.php||user/index.php"
          ]
        }
      },
      "candidate_diff": {
        "user/index.php||user/index.php": [
          "File: user/index.php -> user/index.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "652:                     $row->cells[1]->text .= get_string('role').get_string('labelsep', 'langconfig').$user->role.'<br />';",
          "653:                 }",
          "654:                 if ($user->maildisplay == 1 or ($user->maildisplay == 2 and ($course->id != SITEID) and !isguestuser()) or",
          "656:                             in_array('email', $extrafields) or ($user->id == $USER->id)) {",
          "657:                     $row->cells[1]->text .= get_string('email').get_string('labelsep', 'langconfig').html_writer::link(\"mailto:$user->email\", $user->email) . '<br />';",
          "658:                 }",
          "",
          "[Removed Lines]",
          "655:                             has_capability('moodle/course:viewhiddenuserfields', $context) or",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "85380c6b616e82e31115fbb585d37f0e15f8b0b2",
      "candidate_info": {
        "commit_hash": "85380c6b616e82e31115fbb585d37f0e15f8b0b2",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/85380c6b616e82e31115fbb585d37f0e15f8b0b2",
        "files": [
          "user/index.php"
        ],
        "message": "MDL-52433 user: Remove unnecessary capability check",
        "before_after_code_files": [
          "user/index.php||user/index.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "user/index.php||user/index.php"
          ],
          "candidate": [
            "user/index.php||user/index.php"
          ]
        }
      },
      "candidate_diff": {
        "user/index.php||user/index.php": [
          "File: user/index.php -> user/index.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "649:                     $row->cells[1]->text .= get_string('role').get_string('labelsep', 'langconfig').$user->role.'<br />';",
          "650:                 }",
          "651:                 if ($user->maildisplay == 1 or ($user->maildisplay == 2 and ($course->id != SITEID) and !isguestuser()) or",
          "653:                             in_array('email', $extrafields) or ($user->id == $USER->id)) {",
          "654:                     $row->cells[1]->text .= get_string('email').get_string('labelsep', 'langconfig').html_writer::link(\"mailto:$user->email\", $user->email) . '<br />';",
          "655:                 }",
          "",
          "[Removed Lines]",
          "652:                             has_capability('moodle/course:viewhiddenuserfields', $context) or",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "089ab60017cd3207990658fbd37f7f31948539fa",
      "candidate_info": {
        "commit_hash": "089ab60017cd3207990658fbd37f7f31948539fa",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/089ab60017cd3207990658fbd37f7f31948539fa",
        "files": [
          "user/index.php"
        ],
        "message": "MDL-52433 user: Remove unnecessary capability check",
        "before_after_code_files": [
          "user/index.php||user/index.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "user/index.php||user/index.php"
          ],
          "candidate": [
            "user/index.php||user/index.php"
          ]
        }
      },
      "candidate_diff": {
        "user/index.php||user/index.php": [
          "File: user/index.php -> user/index.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "652:                     $row->cells[1]->text .= get_string('role').get_string('labelsep', 'langconfig').$user->role.'<br />';",
          "653:                 }",
          "654:                 if ($user->maildisplay == 1 or ($user->maildisplay == 2 and ($course->id != SITEID) and !isguestuser()) or",
          "656:                             in_array('email', $extrafields) or ($user->id == $USER->id)) {",
          "657:                     $row->cells[1]->text .= get_string('email').get_string('labelsep', 'langconfig').html_writer::link(\"mailto:$user->email\", $user->email) . '<br />';",
          "658:                 }",
          "",
          "[Removed Lines]",
          "655:                             has_capability('moodle/course:viewhiddenuserfields', $context) or",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    }
  ]
}