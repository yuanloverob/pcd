{
  "cve_id": "CVE-2022-29194",
  "cve_desc": "TensorFlow is an open source platform for machine learning. Prior to versions 2.9.0, 2.8.1, 2.7.2, and 2.6.4, the implementation of `tf.raw_ops.DeleteSessionTensor` does not fully validate the input arguments. This results in a `CHECK`-failure which can be used to trigger a denial of service attack. Versions 2.9.0, 2.8.1, 2.7.2, and 2.6.4 contain a patch for this issue.",
  "repo": "tensorflow/tensorflow",
  "patch_hash": "cff267650c6a1b266e4b4500f69fbc49cdd773c5",
  "patch_info": {
    "commit_hash": "cff267650c6a1b266e4b4500f69fbc49cdd773c5",
    "repo": "tensorflow/tensorflow",
    "commit_url": "https://github.com/tensorflow/tensorflow/commit/cff267650c6a1b266e4b4500f69fbc49cdd773c5",
    "files": [
      "tensorflow/core/kernels/session_ops.cc"
    ],
    "message": "Fix tf.raw_ops.DeleteSessionTensor vulnerability with invalid `handle`.\n\nCheck that `handle` input is actually a scalar before treating it as such.\n\nPiperOrigin-RevId: 445228994",
    "before_after_code_files": [
      "tensorflow/core/kernels/session_ops.cc||tensorflow/core/kernels/session_ops.cc"
    ]
  },
  "patch_diff": {
    "tensorflow/core/kernels/session_ops.cc||tensorflow/core/kernels/session_ops.cc": [
      "File: tensorflow/core/kernels/session_ops.cc -> tensorflow/core/kernels/session_ops.cc",
      "--- Hunk 1 ---",
      "[Context before]",
      "135:   void Compute(OpKernelContext* ctx) override {",
      "136:     const Tensor& handle = ctx->input(0);",
      "137:     const string& name = handle.scalar<tstring>()();",
      "138:     auto session_state = ctx->session_state();",
      "139:     OP_REQUIRES(ctx, session_state != nullptr,",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "137:     OP_REQUIRES(ctx, TensorShapeUtils::IsScalar(handle.shape()),",
      "138:                 errors::InvalidArgument(\"`handle` must be scalar\"));",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "c38adb3be77c7c0a812728c3602f880e5cba71ff",
      "candidate_info": {
        "commit_hash": "c38adb3be77c7c0a812728c3602f880e5cba71ff",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/c38adb3be77c7c0a812728c3602f880e5cba71ff",
        "files": [
          "tensorflow/core/kernels/session_ops.cc"
        ],
        "message": "Fix tf.raw_ops.DeleteSessionTensor vulnerability with invalid `handle`.\n\nCheck that `handle` input is actually a scalar before treating it as such.\n\nPiperOrigin-RevId: 445228994",
        "before_after_code_files": [
          "tensorflow/core/kernels/session_ops.cc||tensorflow/core/kernels/session_ops.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/core/kernels/session_ops.cc||tensorflow/core/kernels/session_ops.cc"
          ],
          "candidate": [
            "tensorflow/core/kernels/session_ops.cc||tensorflow/core/kernels/session_ops.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/core/kernels/session_ops.cc||tensorflow/core/kernels/session_ops.cc": [
          "File: tensorflow/core/kernels/session_ops.cc -> tensorflow/core/kernels/session_ops.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "133:   void Compute(OpKernelContext* ctx) override {",
          "134:     const Tensor& handle = ctx->input(0);",
          "135:     const string& name = handle.scalar<tstring>()();",
          "136:     auto session_state = ctx->session_state();",
          "137:     OP_REQUIRES(ctx, session_state != nullptr,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "135:     OP_REQUIRES(ctx, TensorShapeUtils::IsScalar(handle.shape()),",
          "136:                 errors::InvalidArgument(\"`handle` must be scalar\"));",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "9ed60fb1fb20e1b84db5766ba794d42bcce4ccfe",
      "candidate_info": {
        "commit_hash": "9ed60fb1fb20e1b84db5766ba794d42bcce4ccfe",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/9ed60fb1fb20e1b84db5766ba794d42bcce4ccfe",
        "files": [
          "tensorflow/core/kernels/session_ops.cc"
        ],
        "message": "Fix tf.raw_ops.DeleteSessionTensor vulnerability with invalid `handle`.\n\nCheck that `handle` input is actually a scalar before treating it as such.\n\nPiperOrigin-RevId: 445228994",
        "before_after_code_files": [
          "tensorflow/core/kernels/session_ops.cc||tensorflow/core/kernels/session_ops.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/core/kernels/session_ops.cc||tensorflow/core/kernels/session_ops.cc"
          ],
          "candidate": [
            "tensorflow/core/kernels/session_ops.cc||tensorflow/core/kernels/session_ops.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/core/kernels/session_ops.cc||tensorflow/core/kernels/session_ops.cc": [
          "File: tensorflow/core/kernels/session_ops.cc -> tensorflow/core/kernels/session_ops.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "133:   void Compute(OpKernelContext* ctx) override {",
          "134:     const Tensor& handle = ctx->input(0);",
          "135:     const string& name = handle.scalar<tstring>()();",
          "136:     auto session_state = ctx->session_state();",
          "137:     OP_REQUIRES(ctx, session_state != nullptr,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "135:     OP_REQUIRES(ctx, TensorShapeUtils::IsScalar(handle.shape()),",
          "136:                 errors::InvalidArgument(\"`handle` must be scalar\"));",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "58aef18fb90fe507bc7b78a64c4d21b3057e274d",
      "candidate_info": {
        "commit_hash": "58aef18fb90fe507bc7b78a64c4d21b3057e274d",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/58aef18fb90fe507bc7b78a64c4d21b3057e274d",
        "files": [
          "tensorflow/core/kernels/session_ops.cc"
        ],
        "message": "Fix tf.raw_ops.DeleteSessionTensor vulnerability with invalid `handle`.\n\nCheck that `handle` input is actually a scalar before treating it as such.\n\nPiperOrigin-RevId: 445228994",
        "before_after_code_files": [
          "tensorflow/core/kernels/session_ops.cc||tensorflow/core/kernels/session_ops.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/core/kernels/session_ops.cc||tensorflow/core/kernels/session_ops.cc"
          ],
          "candidate": [
            "tensorflow/core/kernels/session_ops.cc||tensorflow/core/kernels/session_ops.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/core/kernels/session_ops.cc||tensorflow/core/kernels/session_ops.cc": [
          "File: tensorflow/core/kernels/session_ops.cc -> tensorflow/core/kernels/session_ops.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "133:   void Compute(OpKernelContext* ctx) override {",
          "134:     const Tensor& handle = ctx->input(0);",
          "135:     const string& name = handle.scalar<tstring>()();",
          "136:     auto session_state = ctx->session_state();",
          "137:     OP_REQUIRES(ctx, session_state != nullptr,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "135:     OP_REQUIRES(ctx, TensorShapeUtils::IsScalar(handle.shape()),",
          "136:                 errors::InvalidArgument(\"`handle` must be scalar\"));",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "d44eb2c1d31d658212815d2357bcf2a6320046bc",
      "candidate_info": {
        "commit_hash": "d44eb2c1d31d658212815d2357bcf2a6320046bc",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/d44eb2c1d31d658212815d2357bcf2a6320046bc",
        "files": [
          "tensorflow/core/kernels/session_ops.cc"
        ],
        "message": "Fix tf.raw_ops.DeleteSessionTensor vulnerability with invalid `handle`.\n\nCheck that `handle` input is actually a scalar before treating it as such.\n\nPiperOrigin-RevId: 445228994",
        "before_after_code_files": [
          "tensorflow/core/kernels/session_ops.cc||tensorflow/core/kernels/session_ops.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/core/kernels/session_ops.cc||tensorflow/core/kernels/session_ops.cc"
          ],
          "candidate": [
            "tensorflow/core/kernels/session_ops.cc||tensorflow/core/kernels/session_ops.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/core/kernels/session_ops.cc||tensorflow/core/kernels/session_ops.cc": [
          "File: tensorflow/core/kernels/session_ops.cc -> tensorflow/core/kernels/session_ops.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "133:   void Compute(OpKernelContext* ctx) override {",
          "134:     const Tensor& handle = ctx->input(0);",
          "135:     const string& name = handle.scalar<tstring>()();",
          "136:     auto session_state = ctx->session_state();",
          "137:     OP_REQUIRES(ctx, session_state != nullptr,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "135:     OP_REQUIRES(ctx, TensorShapeUtils::IsScalar(handle.shape()),",
          "136:                 errors::InvalidArgument(\"`handle` must be scalar\"));",
          "",
          "---------------"
        ]
      }
    }
  ]
}