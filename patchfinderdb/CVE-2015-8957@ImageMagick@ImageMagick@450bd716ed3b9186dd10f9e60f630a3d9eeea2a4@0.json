{
  "cve_id": "CVE-2015-8957",
  "cve_desc": "Buffer overflow in ImageMagick before 6.9.0-4 Beta allows remote attackers to cause a denial of service (application crash) via a crafted SUN file.",
  "repo": "ImageMagick/ImageMagick",
  "patch_hash": "450bd716ed3b9186dd10f9e60f630a3d9eeea2a4",
  "patch_info": {
    "commit_hash": "450bd716ed3b9186dd10f9e60f630a3d9eeea2a4",
    "repo": "ImageMagick/ImageMagick",
    "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/450bd716ed3b9186dd10f9e60f630a3d9eeea2a4",
    "files": [
      "MagickCore/composite.c",
      "MagickCore/pixel-accessor.h",
      "MagickCore/threshold.c",
      "coders/sun.c"
    ],
    "message": "",
    "before_after_code_files": [
      "MagickCore/composite.c||MagickCore/composite.c",
      "MagickCore/pixel-accessor.h||MagickCore/pixel-accessor.h",
      "MagickCore/threshold.c||MagickCore/threshold.c",
      "coders/sun.c||coders/sun.c"
    ]
  },
  "patch_diff": {
    "MagickCore/composite.c||MagickCore/composite.c": [
      "File: MagickCore/composite.c -> MagickCore/composite.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "2305:           {",
      "2306:             pixel=Sc;",
      "2307:             break;",
      "2309:         }",
      "2310:         q[i]=ClampToQuantum(pixel);",
      "2311:       }",
      "",
      "[Removed Lines]",
      "2308:           }",
      "",
      "[Added Lines]",
      "2308:           }",
      "",
      "---------------"
    ],
    "MagickCore/pixel-accessor.h||MagickCore/pixel-accessor.h": [
      "File: MagickCore/pixel-accessor.h -> MagickCore/pixel-accessor.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "32: #undef index",
      "34: static inline Quantum GetPixela(const Image *restrict image,",
      "35:   const Quantum *restrict pixel)",
      "36: {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "34: static inline Quantum ClampPixel(const MagickRealType value)",
      "35: {",
      "36: #if !defined(MAGICKCORE_HDRI_SUPPORT)",
      "37:   return((Quantum) value);",
      "38: #else",
      "39:   if (value < 0.0)",
      "40:     return((Quantum) 0.0);",
      "41:   if (value >= (MagickRealType) QuantumRange)",
      "42:     return((Quantum) QuantumRange);",
      "43:   return((Quantum) value);",
      "44: #endif",
      "45: }",
      "",
      "---------------"
    ],
    "MagickCore/threshold.c||MagickCore/threshold.c": [
      "File: MagickCore/threshold.c -> MagickCore/threshold.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "685: %  The format of the ClampImage method is:",
      "686: %",
      "687: %      MagickBooleanType ClampImage(Image *image,ExceptionInfo *exception)",
      "701: #else",
      "702:   if (value < 0.0f)",
      "703:     return(0.0);",
      "",
      "[Removed Lines]",
      "688: %",
      "689: %  A description of each parameter follows:",
      "690: %",
      "691: %    o image: the image.",
      "692: %",
      "693: %    o exception: return any errors or warnings in this structure.",
      "694: %",
      "697: static inline Quantum ClampPixel(const MagickRealType value)",
      "698: {",
      "699: #if !defined(MAGICKCORE_HDRI_SUPPORT)",
      "700:   return((Quantum) value);",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ],
    "coders/sun.c||coders/sun.c": [
      "File: coders/sun.c -> coders/sun.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "337:           image->colors=one << sun_info.depth;",
      "338:         if (sun_info.maptype == RMT_EQUAL_RGB)",
      "339:           image->colors=sun_info.maplength/3;",
      "340:         if (AcquireImageColormap(image,image->colors,exception) == MagickFalse)",
      "341:           ThrowReaderException(ResourceLimitError,\"MemoryAllocationFailed\");",
      "342:       }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "340:         if (AcquireImageColormap(image,image->colors,exception) == MagickFalse)",
      "341:           ThrowReaderException(ResourceLimitError,\"MemoryAllocationFailed\");",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "47c61c996128275174b8a120ab6a88a5c1bec3d3",
      "candidate_info": {
        "commit_hash": "47c61c996128275174b8a120ab6a88a5c1bec3d3",
        "repo": "ImageMagick/ImageMagick",
        "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/47c61c996128275174b8a120ab6a88a5c1bec3d3",
        "files": [
          "MagickCore/composite.c"
        ],
        "message": "",
        "before_after_code_files": [
          "MagickCore/composite.c||MagickCore/composite.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "MagickCore/composite.c||MagickCore/composite.c"
          ],
          "candidate": [
            "MagickCore/composite.c||MagickCore/composite.c"
          ]
        }
      },
      "candidate_diff": {
        "MagickCore/composite.c||MagickCore/composite.c": [
          "File: MagickCore/composite.c -> MagickCore/composite.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "295:   CacheView",
          "299:   MagickBooleanType",
          "300:     status;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "299:   const char",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "309:     Composite image.",
          "311:   status=MagickTrue;",
          "312:   progress=0;",
          "313:   source_view=AcquireVirtualCacheView(source_image,exception);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "315:   status=MagickTrue;",
          "316:   progress=0;",
          "317:   clamp=MagickTrue;",
          "318:   value=GetImageArtifact(image,\"compose:clamp\");",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "457:         if (channel == AlphaPixelChannel)",
          "458:           {",
          "462:             q[i]=ClampPixel(QuantumRange*(Sa+Da-Sa*Da));",
          "463:             continue;",
          "",
          "[Removed Lines]",
          "460:               Set alpha channel.",
          "",
          "[Added Lines]",
          "468:               Set alpha channel.",
          "470:             q[i]=clamp != MagickFalse ?",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "469:         Sc=(MagickRealType) GetPixelChannel(source_image,channel,p);",
          "470:         Dc=(MagickRealType) q[i];",
          "472:         Dca=QuantumScale*Da*Dc;",
          "473:         q[i]=ClampPixel(QuantumRange*(Sca+Dca*(1.0-Sa)));",
          "474:       }",
          "",
          "[Removed Lines]",
          "471:         Sca=QuantumScale*Sa*Sc;",
          "",
          "[Added Lines]",
          "481:         Sca=QuantumScale*Sa*Sc;",
          "482:         Dca=QuantumScale*Da*Dc;",
          "483:         q[i]=clamp != MagickFalse ?",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "509:   CacheView",
          "513:   GeometryInfo",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "525:   const char",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "516:   Image",
          "520:   MagickBooleanType",
          "521:     status;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "560:       status=CompositeOverImage(image,source_image,clip_to_self,x_offset,",
          "561:         y_offset,exception);",
          "562:       source_image=DestroyImage(source_image);",
          "564:     }",
          "565:   canvas_image=(Image *) NULL;",
          "566:   amount=0.5;",
          "567:   canvas_dissolve=1.0;",
          "568:   percent_luma=100.0;",
          "",
          "[Removed Lines]",
          "563:       return(status);",
          "",
          "[Added Lines]",
          "580:     }",
          "582:   canvas_image=(Image *) NULL;",
          "583:   canvas_dissolve=1.0;",
          "584:   clamp=MagickTrue;",
          "585:   value=GetImageArtifact(image,\"compose:clamp\");",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "704:             {",
          "705:               p+=GetPixelChannels(source_image);",
          "706:               q+=GetPixelChannels(image);",
          "708:             }",
          "709:           SetPixelAlpha(image,ClampPixel(GetPixelIntensity(source_image,p)),q);",
          "710:           p+=GetPixelChannels(source_image);",
          "",
          "[Removed Lines]",
          "707:               continue;",
          "",
          "[Added Lines]",
          "727:               continue;",
          "728:             }",
          "729:           SetPixelAlpha(image,clamp != MagickFalse ?",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "1378:               {",
          "1379:                 pixel=(MagickRealType) source[channel];",
          "1380:                 break;",
          "1382:             }",
          "1383:             q[i]=ClampPixel(pixel);",
          "1384:           }",
          "",
          "[Removed Lines]",
          "1381:               }",
          "",
          "[Added Lines]",
          "1403:               }",
          "1404:             }",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "1527:         if ((traits & CopyPixelTrait) != 0)",
          "1528:           {",
          "1532:             q[i]=ClampPixel(Sc);",
          "1533:             continue;",
          "",
          "[Removed Lines]",
          "1530:               Copy channel.",
          "",
          "[Added Lines]",
          "1553:               Copy channel.",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "1648:               {",
          "1649:                 pixel=QuantumRange*alpha;",
          "1650:                 break;",
          "1652:             }",
          "1653:             q[i]=ClampPixel(pixel);",
          "1654:             continue;",
          "",
          "[Removed Lines]",
          "1651:               }",
          "",
          "[Added Lines]",
          "1674:               }",
          "1675:             }",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "2303:           {",
          "2304:             pixel=Sc;",
          "2305:             break;",
          "2307:         }",
          "2308:         q[i]=ClampPixel(pixel);",
          "2309:       }",
          "",
          "[Removed Lines]",
          "2306:           }",
          "",
          "[Added Lines]",
          "2330:           }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "f76eb4af9cd94863ecdf3412497e22b4c2e9180a",
      "candidate_info": {
        "commit_hash": "f76eb4af9cd94863ecdf3412497e22b4c2e9180a",
        "repo": "ImageMagick/ImageMagick",
        "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/f76eb4af9cd94863ecdf3412497e22b4c2e9180a",
        "files": [
          "MagickCore/composite.c"
        ],
        "message": "",
        "before_after_code_files": [
          "MagickCore/composite.c||MagickCore/composite.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "MagickCore/composite.c||MagickCore/composite.c"
          ],
          "candidate": [
            "MagickCore/composite.c||MagickCore/composite.c"
          ]
        }
      },
      "candidate_diff": {
        "MagickCore/composite.c||MagickCore/composite.c": [
          "File: MagickCore/composite.c -> MagickCore/composite.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "457:         if (channel == AlphaPixelChannel)",
          "458:           {",
          "462:             q[i]=ClampToQuantum(QuantumRange*(Sa+Da-Sa*Da));",
          "463:             continue;",
          "",
          "[Removed Lines]",
          "460:               Set alpha channel.",
          "",
          "[Added Lines]",
          "460:               Set alpha channel.",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "469:         Sc=(MagickRealType) GetPixelChannel(source_image,channel,p);",
          "470:         Dc=(MagickRealType) q[i];",
          "472:         Dca=QuantumScale*Da*Dc;",
          "473:         q[i]=ClampToQuantum(QuantumRange*(Sca+Dca*(1.0-Sa)));",
          "474:       }",
          "",
          "[Removed Lines]",
          "471:         Sca=QuantumScale*Sa*Sc;",
          "",
          "[Added Lines]",
          "471:         Sca=QuantumScale*Sa*Sc;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "705:             {",
          "706:               p+=GetPixelChannels(source_image);",
          "707:               q+=GetPixelChannels(image);",
          "710:           SetPixelAlpha(image,ClampToQuantum(GetPixelIntensity(source_image,",
          "711:             p)),q);",
          "712:           p+=GetPixelChannels(source_image);",
          "",
          "[Removed Lines]",
          "708:               continue;",
          "709:             }",
          "",
          "[Added Lines]",
          "708:               continue;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1380:               {",
          "1381:                 pixel=(MagickRealType) source[channel];",
          "1382:                 break;",
          "1384:             }",
          "1385:             q[i]=ClampToQuantum(pixel);",
          "1386:           }",
          "",
          "[Removed Lines]",
          "1383:               }",
          "",
          "[Added Lines]",
          "1382:               }",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1530:         if ((traits & CopyPixelTrait) != 0)",
          "1531:           {",
          "1535:             q[i]=ClampToQuantum(Sc);",
          "1536:             continue;",
          "",
          "[Removed Lines]",
          "1533:               Copy channel.",
          "",
          "[Added Lines]",
          "1532:               Copy channel.",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "1651:               {",
          "1652:                 pixel=QuantumRange*alpha;",
          "1653:                 break;",
          "1655:             }",
          "1656:             q[i]=ClampToQuantum(pixel);",
          "1657:             continue;",
          "",
          "[Removed Lines]",
          "1654:               }",
          "",
          "[Added Lines]",
          "1653:               }",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "2306:           {",
          "2307:             pixel=Sc;",
          "2308:             break;",
          "2310:         }",
          "2311:         q[i]=ClampToQuantum(pixel);",
          "2312:       }",
          "",
          "[Removed Lines]",
          "2309:           }",
          "",
          "[Added Lines]",
          "2308:           }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "b20bac4702eacfb5e42698733656d0d1aee9ab86",
      "candidate_info": {
        "commit_hash": "b20bac4702eacfb5e42698733656d0d1aee9ab86",
        "repo": "ImageMagick/ImageMagick",
        "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/b20bac4702eacfb5e42698733656d0d1aee9ab86",
        "files": [
          "MagickCore/composite.c"
        ],
        "message": "",
        "before_after_code_files": [
          "MagickCore/composite.c||MagickCore/composite.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "MagickCore/composite.c||MagickCore/composite.c"
          ],
          "candidate": [
            "MagickCore/composite.c||MagickCore/composite.c"
          ]
        }
      },
      "candidate_diff": {
        "MagickCore/composite.c||MagickCore/composite.c": [
          "File: MagickCore/composite.c -> MagickCore/composite.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2306:           {",
          "2307:             pixel=Sc;",
          "2308:             break;",
          "2310:         }",
          "2311:         q[i]=ClampPixel(pixel);",
          "2312:       }",
          "",
          "[Removed Lines]",
          "2309:           }",
          "",
          "[Added Lines]",
          "2309:           }",
          "",
          "---------------"
        ]
      }
    }
  ]
}