{
  "cve_id": "CVE-2017-12904",
  "cve_desc": "Improper Neutralization of Special Elements used in an OS Command in bookmarking function of Newsbeuter versions 0.7 through 2.9 allows remote attackers to perform user-assisted code execution by crafting an RSS item that includes shell code in its title and/or URL.",
  "repo": "akrennmair/newsbeuter",
  "patch_hash": "96e9506ae9e252c548665152d1b8968297128307",
  "patch_info": {
    "commit_hash": "96e9506ae9e252c548665152d1b8968297128307",
    "repo": "akrennmair/newsbeuter",
    "commit_url": "https://github.com/akrennmair/newsbeuter/commit/96e9506ae9e252c548665152d1b8968297128307",
    "files": [
      "src/controller.cpp"
    ],
    "message": "Sanitize inputs to bookmark-cmd (#591)\n\nNewsbeuter didn't properly shell-escape the arguments passed to\nbookmarking command, which allows a remote attacker to perform remote\ncode execution by crafting an RSS item whose title and/or URL contain\nsomething interpretable by the shell (most notably subshell\ninvocations.)\n\nThis has been reported by Jeriko One <jeriko.one@gmx.us>, complete with\nPoC and a patch.\n\nThis vulnerability was assigned CVE-2017-12904.",
    "before_after_code_files": [
      "src/controller.cpp||src/controller.cpp"
    ]
  },
  "patch_diff": {
    "src/controller.cpp||src/controller.cpp": [
      "File: src/controller.cpp -> src/controller.cpp",
      "--- Hunk 1 ---",
      "[Context before]",
      "1344:  std::string bookmark_cmd = cfg.get_configvalue(\"bookmark-cmd\");",
      "1345:  bool is_interactive = cfg.get_configvalue_as_bool(\"bookmark-interactive\");",
      "1346:  if (bookmark_cmd.length() > 0) {",
      "1348:                                          bookmark_cmd,",
      "1349:                                          utils::replace_all(url,\"'\", \"%27\"),",
      "1354:   LOG(level::DEBUG, \"controller::bookmark: cmd = %s\", cmdline);",
      "",
      "[Removed Lines]",
      "1347:   std::string cmdline = strprintf::fmt(\"%s '%s' %s %s %s\",",
      "1350:                                          quote_empty(stfl::quote(title)),",
      "1351:                                          quote_empty(stfl::quote(description)),",
      "1352:                                          quote_empty(stfl::quote(feed_title)));",
      "",
      "[Added Lines]",
      "1347:   std::string cmdline = strprintf::fmt(\"%s '%s' '%s' '%s' '%s'\",",
      "1350:                                          utils::replace_all(title,\"'\", \"%27\"),",
      "1351:                                          utils::replace_all(description,\"'\", \"%27\"),",
      "1352:                                          utils::replace_all(feed_title,\"'\", \"%27\"));",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "d1460189f6f810ca9a3687af7bc43feb7f2af2d9",
      "candidate_info": {
        "commit_hash": "d1460189f6f810ca9a3687af7bc43feb7f2af2d9",
        "repo": "akrennmair/newsbeuter",
        "commit_url": "https://github.com/akrennmair/newsbeuter/commit/d1460189f6f810ca9a3687af7bc43feb7f2af2d9",
        "files": [
          "src/controller.cpp"
        ],
        "message": "Sanitize inputs to bookmark-cmd (#591)\n\nNewsbeuter didn't properly shell-escape the arguments passed to\nbookmarking command, which allows a remote attacker to perform remote\ncode execution by crafting an RSS item whose title and/or URL contain\nsomething interpretable by the shell (most notably subshell\ninvocations.)\n\nThis has been reported by Jeriko One <jeriko.one@gmx.us>, complete with\nPoC and a patch.\n\nThis vulnerability was assigned CVE-2017-12904.",
        "before_after_code_files": [
          "src/controller.cpp||src/controller.cpp"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_message": 1,
        "olp_code_files": {
          "patch": [
            "src/controller.cpp||src/controller.cpp"
          ],
          "candidate": [
            "src/controller.cpp||src/controller.cpp"
          ]
        }
      },
      "candidate_diff": {
        "src/controller.cpp||src/controller.cpp": [
          "File: src/controller.cpp -> src/controller.cpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "1275:  std::string bookmark_cmd = cfg.get_configvalue(\"bookmark-cmd\");",
          "1276:  bool is_interactive = cfg.get_configvalue_as_bool(\"bookmark-interactive\");",
          "1277:  if (bookmark_cmd.length() > 0) {",
          "1279:                                          bookmark_cmd.c_str(), utils::replace_all(url,\"'\", \"%27\").c_str(),",
          "1282:   LOG(LOG_DEBUG, \"controller::bookmark: cmd = %s\", cmdline.c_str());",
          "",
          "[Removed Lines]",
          "1278:   std::string cmdline = utils::strprintf(\"%s '%s' %s %s\",",
          "1280:                                          stfl::quote(title).c_str(), stfl::quote(description).c_str());",
          "",
          "[Added Lines]",
          "1278:   std::string cmdline = utils::strprintf(\"%s '%s' '%s' '%s'\",",
          "1280:                                          utils::replace_all(title,\"'\", \"%27\").c_str(),",
          "1281:                                          utils::replace_all(description,\"'\", \"%27\").c_str());",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "3b84203448f077dff6f83ba986f916884184852c",
      "candidate_info": {
        "commit_hash": "3b84203448f077dff6f83ba986f916884184852c",
        "repo": "akrennmair/newsbeuter",
        "commit_url": "https://github.com/akrennmair/newsbeuter/commit/3b84203448f077dff6f83ba986f916884184852c",
        "files": [
          "src/controller.cpp"
        ],
        "message": "Sanitize inputs to bookmark-cmd (#591)\n\nNewsbeuter didn't properly shell-escape the arguments passed to\nbookmarking command, which allows a remote attacker to perform remote\ncode execution by crafting an RSS item whose title and/or URL contain\nsomething interpretable by the shell (most notably subshell\ninvocations.)\n\nThis has been reported by Jeriko One <jeriko.one@gmx.us>, complete with\nPoC and a patch.\n\nThis vulnerability was assigned CVE-2017-12904.",
        "before_after_code_files": [
          "src/controller.cpp||src/controller.cpp"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_message": 1,
        "olp_code_files": {
          "patch": [
            "src/controller.cpp||src/controller.cpp"
          ],
          "candidate": [
            "src/controller.cpp||src/controller.cpp"
          ]
        }
      },
      "candidate_diff": {
        "src/controller.cpp||src/controller.cpp": [
          "File: src/controller.cpp -> src/controller.cpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "1280:  std::string bookmark_cmd = cfg.get_configvalue(\"bookmark-cmd\");",
          "1281:  bool is_interactive = cfg.get_configvalue_as_bool(\"bookmark-interactive\");",
          "1282:  if (bookmark_cmd.length() > 0) {",
          "1287:   LOG(LOG_DEBUG, \"controller::bookmark: cmd = %s\", cmdline.c_str());",
          "",
          "[Removed Lines]",
          "1283:   std::string cmdline = utils::strprintf(\"%s '%s' %s %s\",",
          "1284:    bookmark_cmd.c_str(), utils::replace_all(url,\"'\", \"%27\").c_str(),",
          "1285:    stfl::quote(title).c_str(), stfl::quote(description).c_str());",
          "",
          "[Added Lines]",
          "1283:   std::string cmdline = utils::strprintf(\"%s '%s' '%s' '%s'\",",
          "1284:    bookmark_cmd.c_str(), utils::replace_all(url,\"'\", \"%27\").c_str(),",
          "1285:    utils::replace_all(title,\"'\", \"%27\").c_str(),",
          "1286:    utils::replace_all(description,\"'\", \"%27\").c_str());",
          "",
          "---------------"
        ]
      }
    }
  ]
}