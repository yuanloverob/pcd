{
  "cve_id": "CVE-2014-9422",
  "cve_desc": "The check_rpcsec_auth function in kadmin/server/kadm_rpc_svc.c in kadmind in MIT Kerberos 5 (aka krb5) through 1.11.5, 1.12.x through 1.12.2, and 1.13.x before 1.13.1 allows remote authenticated users to bypass a kadmin/* authorization check and obtain administrative access by leveraging access to a two-component principal with an initial \"kadmind\" substring, as demonstrated by a \"ka/x\" principal.",
  "repo": "krb5/krb5",
  "patch_hash": "6609658db0799053fbef0d7d0aa2f1fd68ef32d8",
  "patch_info": {
    "commit_hash": "6609658db0799053fbef0d7d0aa2f1fd68ef32d8",
    "repo": "krb5/krb5",
    "commit_url": "https://github.com/krb5/krb5/commit/6609658db0799053fbef0d7d0aa2f1fd68ef32d8",
    "files": [
      "src/kadmin/server/kadm_rpc_svc.c"
    ],
    "message": "Fix kadmind server validation [CVE-2014-9422]\n\n[MITKRB5-SA-2015-001] In kadmind's check_rpcsec_auth(), use\ndata_eq_string() instead of strncmp() to check components of the\nserver principal, so that we don't erroneously match left substrings\nof \"kadmin\", \"history\", or the realm.\n\nticket: 8057 (new)\ntarget_version: 1.13.1\ntags: pullup",
    "before_after_code_files": [
      "src/kadmin/server/kadm_rpc_svc.c||src/kadmin/server/kadm_rpc_svc.c"
    ]
  },
  "patch_diff": {
    "src/kadmin/server/kadm_rpc_svc.c||src/kadmin/server/kadm_rpc_svc.c": [
      "File: src/kadmin/server/kadm_rpc_svc.c -> src/kadmin/server/kadm_rpc_svc.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "8: #include <gssrpc/rpc.h>",
      "10: #include <syslog.h>",
      "",
      "[Removed Lines]",
      "7: #include <k5-platform.h>",
      "",
      "[Added Lines]",
      "7: #include <k5-int.h>",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "296:      c1 = krb5_princ_component(kctx, princ, 0);",
      "297:      c2 = krb5_princ_component(kctx, princ, 1);",
      "298:      realm = krb5_princ_realm(kctx, princ);",
      "308: fail_princ:",
      "309:      if (!success) {",
      "",
      "[Removed Lines]",
      "299:      if (strncmp(handle->params.realm, realm->data, realm->length) == 0",
      "300:   && strncmp(\"kadmin\", c1->data, c1->length) == 0) {",
      "302:    if (strncmp(\"history\", c2->data, c2->length) == 0)",
      "303:         goto fail_princ;",
      "304:    else",
      "305:         success = 1;",
      "306:      }",
      "",
      "[Added Lines]",
      "299:      success = data_eq_string(*realm, handle->params.realm) &&",
      "300:       data_eq_string(*c1, \"kadmin\") && !data_eq_string(*c2, \"history\");",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "5c78bb806338b0feb90f46459834310adf5be00f",
      "candidate_info": {
        "commit_hash": "5c78bb806338b0feb90f46459834310adf5be00f",
        "repo": "krb5/krb5",
        "commit_url": "https://github.com/krb5/krb5/commit/5c78bb806338b0feb90f46459834310adf5be00f",
        "files": [
          "src/kadmin/server/kadm_rpc_svc.c"
        ],
        "message": "Fix kadmind server validation [CVE-2014-9422]\n\n[MITKRB5-SA-2015-001] In kadmind's check_rpcsec_auth(), use\ndata_eq_string() instead of strncmp() to check components of the\nserver principal, so that we don't erroneously match left substrings\nof \"kadmin\", \"history\", or the realm.\n\n(cherry picked from commit 6609658db0799053fbef0d7d0aa2f1fd68ef32d8)\n\nticket: 8069 (new)\nversion_fixed: 1.12.3\nstatus: resolved",
        "before_after_code_files": [
          "src/kadmin/server/kadm_rpc_svc.c||src/kadmin/server/kadm_rpc_svc.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "src/kadmin/server/kadm_rpc_svc.c||src/kadmin/server/kadm_rpc_svc.c"
          ],
          "candidate": [
            "src/kadmin/server/kadm_rpc_svc.c||src/kadmin/server/kadm_rpc_svc.c"
          ]
        }
      },
      "candidate_diff": {
        "src/kadmin/server/kadm_rpc_svc.c||src/kadmin/server/kadm_rpc_svc.c": [
          "File: src/kadmin/server/kadm_rpc_svc.c -> src/kadmin/server/kadm_rpc_svc.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "8: #include <gssrpc/rpc.h>",
          "10: #include <syslog.h>",
          "",
          "[Removed Lines]",
          "7: #include <k5-platform.h>",
          "",
          "[Added Lines]",
          "7: #include <k5-int.h>",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "296:      c1 = krb5_princ_component(kctx, princ, 0);",
          "297:      c2 = krb5_princ_component(kctx, princ, 1);",
          "298:      realm = krb5_princ_realm(kctx, princ);",
          "308: fail_princ:",
          "309:      if (!success) {",
          "",
          "[Removed Lines]",
          "299:      if (strncmp(handle->params.realm, realm->data, realm->length) == 0",
          "300:   && strncmp(\"kadmin\", c1->data, c1->length) == 0) {",
          "302:    if (strncmp(\"history\", c2->data, c2->length) == 0)",
          "303:         goto fail_princ;",
          "304:    else",
          "305:         success = 1;",
          "306:      }",
          "",
          "[Added Lines]",
          "299:      success = data_eq_string(*realm, handle->params.realm) &&",
          "300:       data_eq_string(*c1, \"kadmin\") && !data_eq_string(*c2, \"history\");",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "9f6758ce9d1462ca94882e0e85e2a1d48cd32b0e",
      "candidate_info": {
        "commit_hash": "9f6758ce9d1462ca94882e0e85e2a1d48cd32b0e",
        "repo": "krb5/krb5",
        "commit_url": "https://github.com/krb5/krb5/commit/9f6758ce9d1462ca94882e0e85e2a1d48cd32b0e",
        "files": [
          "src/kadmin/server/kadm_rpc_svc.c"
        ],
        "message": "Fix kadmind server validation [CVE-2014-9422]\n\n[MITKRB5-SA-2015-001] In kadmind's check_rpcsec_auth(), use\ndata_eq_string() instead of strncmp() to check components of the\nserver principal, so that we don't erroneously match left substrings\nof \"kadmin\", \"history\", or the realm.\n\n(cherry picked from commit 6609658db0799053fbef0d7d0aa2f1fd68ef32d8)\n\nticket: 8075 (new)\nversion_fixed: 1.11.6\nstatus: resolved",
        "before_after_code_files": [
          "src/kadmin/server/kadm_rpc_svc.c||src/kadmin/server/kadm_rpc_svc.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "src/kadmin/server/kadm_rpc_svc.c||src/kadmin/server/kadm_rpc_svc.c"
          ],
          "candidate": [
            "src/kadmin/server/kadm_rpc_svc.c||src/kadmin/server/kadm_rpc_svc.c"
          ]
        }
      },
      "candidate_diff": {
        "src/kadmin/server/kadm_rpc_svc.c||src/kadmin/server/kadm_rpc_svc.c": [
          "File: src/kadmin/server/kadm_rpc_svc.c -> src/kadmin/server/kadm_rpc_svc.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "8: #include <gssrpc/rpc.h>",
          "10: #include <syslog.h>",
          "",
          "[Removed Lines]",
          "7: #include <k5-platform.h>",
          "",
          "[Added Lines]",
          "7: #include <k5-int.h>",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "301:      c1 = krb5_princ_component(kctx, princ, 0);",
          "302:      c2 = krb5_princ_component(kctx, princ, 1);",
          "303:      realm = krb5_princ_realm(kctx, princ);",
          "313: fail_princ:",
          "314:      if (!success) {",
          "",
          "[Removed Lines]",
          "304:      if (strncmp(handle->params.realm, realm->data, realm->length) == 0",
          "305:   && strncmp(\"kadmin\", c1->data, c1->length) == 0) {",
          "307:    if (strncmp(\"history\", c2->data, c2->length) == 0)",
          "308:         goto fail_princ;",
          "309:    else",
          "310:         success = 1;",
          "311:      }",
          "",
          "[Added Lines]",
          "304:      success = data_eq_string(*realm, handle->params.realm) &&",
          "305:       data_eq_string(*c1, \"kadmin\") && !data_eq_string(*c2, \"history\");",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "2bc4bb02a70d7537baf1c3f6ebc126ded42ea133",
      "candidate_info": {
        "commit_hash": "2bc4bb02a70d7537baf1c3f6ebc126ded42ea133",
        "repo": "krb5/krb5",
        "commit_url": "https://github.com/krb5/krb5/commit/2bc4bb02a70d7537baf1c3f6ebc126ded42ea133",
        "files": [
          "src/kadmin/server/kadm_rpc_svc.c"
        ],
        "message": "Fix kadmind server validation [CVE-2014-9422]\n\n[MITKRB5-SA-2015-001] In kadmind's check_rpcsec_auth(), use\ndata_eq_string() instead of strncmp() to check components of the\nserver principal, so that we don't erroneously match left substrings\nof \"kadmin\", \"history\", or the realm.\n\n(cherry picked from commit 6609658db0799053fbef0d7d0aa2f1fd68ef32d8)\n\nticket: 8057\nversion_fixed: 1.13.1\nstatus: resolved",
        "before_after_code_files": [
          "src/kadmin/server/kadm_rpc_svc.c||src/kadmin/server/kadm_rpc_svc.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "src/kadmin/server/kadm_rpc_svc.c||src/kadmin/server/kadm_rpc_svc.c"
          ],
          "candidate": [
            "src/kadmin/server/kadm_rpc_svc.c||src/kadmin/server/kadm_rpc_svc.c"
          ]
        }
      },
      "candidate_diff": {
        "src/kadmin/server/kadm_rpc_svc.c||src/kadmin/server/kadm_rpc_svc.c": [
          "File: src/kadmin/server/kadm_rpc_svc.c -> src/kadmin/server/kadm_rpc_svc.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "8: #include <gssrpc/rpc.h>",
          "10: #include <syslog.h>",
          "",
          "[Removed Lines]",
          "7: #include <k5-platform.h>",
          "",
          "[Added Lines]",
          "7: #include <k5-int.h>",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "296:      c1 = krb5_princ_component(kctx, princ, 0);",
          "297:      c2 = krb5_princ_component(kctx, princ, 1);",
          "298:      realm = krb5_princ_realm(kctx, princ);",
          "308: fail_princ:",
          "309:      if (!success) {",
          "",
          "[Removed Lines]",
          "299:      if (strncmp(handle->params.realm, realm->data, realm->length) == 0",
          "300:   && strncmp(\"kadmin\", c1->data, c1->length) == 0) {",
          "302:    if (strncmp(\"history\", c2->data, c2->length) == 0)",
          "303:         goto fail_princ;",
          "304:    else",
          "305:         success = 1;",
          "306:      }",
          "",
          "[Added Lines]",
          "299:      success = data_eq_string(*realm, handle->params.realm) &&",
          "300:       data_eq_string(*c1, \"kadmin\") && !data_eq_string(*c2, \"history\");",
          "",
          "---------------"
        ]
      }
    }
  ]
}