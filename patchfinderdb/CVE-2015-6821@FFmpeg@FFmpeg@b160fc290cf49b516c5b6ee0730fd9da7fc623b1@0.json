{
  "cve_id": "CVE-2015-6821",
  "cve_desc": "The ff_mpv_common_init function in libavcodec/mpegvideo.c in FFmpeg before 2.7.2 does not properly maintain the encoding context, which allows remote attackers to cause a denial of service (invalid pointer access) or possibly have unspecified other impact via crafted MPEG data.",
  "repo": "FFmpeg/FFmpeg",
  "patch_hash": "b160fc290cf49b516c5b6ee0730fd9da7fc623b1",
  "patch_info": {
    "commit_hash": "b160fc290cf49b516c5b6ee0730fd9da7fc623b1",
    "repo": "FFmpeg/FFmpeg",
    "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/b160fc290cf49b516c5b6ee0730fd9da7fc623b1",
    "files": [
      "libavcodec/mpegvideo.c"
    ],
    "message": "avcodec/mpegvideo: Clear pointers in ff_mpv_common_init()\n\nThis ensures that no stale pointers leak through on any path\n\nFixes: signal_sigsegv_c3097a_991_xtrem_e2_m64q15_a32sxx.3gp\n\nFound-by: Samuel Gro\u00df, Mateusz \"j00ru\" Jurczyk and Gynvael Coldwind\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>",
    "before_after_code_files": [
      "libavcodec/mpegvideo.c||libavcodec/mpegvideo.c"
    ]
  },
  "patch_diff": {
    "libavcodec/mpegvideo.c||libavcodec/mpegvideo.c": [
      "File: libavcodec/mpegvideo.c -> libavcodec/mpegvideo.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "785:     return AVERROR(ENOMEM);",
      "786: }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "788: static void clear_context(MpegEncContext *s)",
      "789: {",
      "790:     int i, j, k;",
      "792:     memset(&s->next_picture, 0, sizeof(s->next_picture));",
      "793:     memset(&s->last_picture, 0, sizeof(s->last_picture));",
      "794:     memset(&s->current_picture, 0, sizeof(s->current_picture));",
      "795:     memset(&s->new_picture, 0, sizeof(s->new_picture));",
      "797:     memset(s->thread_context, 0, sizeof(s->thread_context));",
      "799:     s->me.map = NULL;",
      "800:     s->me.score_map = NULL;",
      "801:     s->dct_error_sum = NULL;",
      "802:     s->block = NULL;",
      "803:     s->blocks = NULL;",
      "804:     memset(s->pblocks, 0, sizeof(s->pblocks));",
      "805:     s->ac_val_base = NULL;",
      "806:     s->ac_val[0] =",
      "807:     s->ac_val[1] =",
      "808:     s->ac_val[2] =NULL;",
      "809:     s->sc.edge_emu_buffer = NULL;",
      "810:     s->me.scratchpad = NULL;",
      "811:     s->me.temp =",
      "812:     s->sc.rd_scratchpad =",
      "813:     s->sc.b_scratchpad =",
      "814:     s->sc.obmc_scratchpad = NULL;",
      "816:     s->parse_context.buffer = NULL;",
      "817:     s->parse_context.buffer_size = 0;",
      "818:     s->bitstream_buffer = NULL;",
      "819:     s->allocated_bitstream_buffer_size = 0;",
      "820:     s->picture          = NULL;",
      "821:     s->mb_type          = NULL;",
      "822:     s->p_mv_table_base  = NULL;",
      "823:     s->b_forw_mv_table_base = NULL;",
      "824:     s->b_back_mv_table_base = NULL;",
      "825:     s->b_bidir_forw_mv_table_base = NULL;",
      "826:     s->b_bidir_back_mv_table_base = NULL;",
      "827:     s->b_direct_mv_table_base = NULL;",
      "828:     s->p_mv_table            = NULL;",
      "829:     s->b_forw_mv_table       = NULL;",
      "830:     s->b_back_mv_table       = NULL;",
      "831:     s->b_bidir_forw_mv_table = NULL;",
      "832:     s->b_bidir_back_mv_table = NULL;",
      "833:     s->b_direct_mv_table     = NULL;",
      "834:     for (i = 0; i < 2; i++) {",
      "835:         for (j = 0; j < 2; j++) {",
      "836:             for (k = 0; k < 2; k++) {",
      "837:                 s->b_field_mv_table_base[i][j][k] = NULL;",
      "838:                 s->b_field_mv_table[i][j][k] = NULL;",
      "839:             }",
      "840:             s->b_field_select_table[i][j] = NULL;",
      "841:             s->p_field_mv_table_base[i][j] = NULL;",
      "842:             s->p_field_mv_table[i][j] = NULL;",
      "843:         }",
      "844:         s->p_field_select_table[i] = NULL;",
      "845:     }",
      "847:     s->dc_val_base = NULL;",
      "848:     s->coded_block_base = NULL;",
      "849:     s->mbintra_table = NULL;",
      "850:     s->cbp_table = NULL;",
      "851:     s->pred_dir_table = NULL;",
      "853:     s->mbskip_table = NULL;",
      "855:     s->er.error_status_table = NULL;",
      "856:     s->er.er_temp_buffer = NULL;",
      "857:     s->mb_index2xy = NULL;",
      "858:     s->lambda_table = NULL;",
      "860:     s->cplx_tab = NULL;",
      "861:     s->bits_tab = NULL;",
      "862: }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "796:                      s->avctx->active_thread_type & FF_THREAD_SLICE) ?",
      "797:                     s->avctx->thread_count : 1;",
      "799:     if (s->encoding && s->avctx->slices)",
      "800:         nb_slices = s->avctx->slices;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "875:     clear_context(s);",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "840:         if (!s->picture[i].f)",
      "841:             goto fail;",
      "842:     }",
      "847:     s->next_picture.f = av_frame_alloc();",
      "848:     if (!s->next_picture.f)",
      "849:         goto fail;",
      "",
      "[Removed Lines]",
      "843:     memset(&s->next_picture, 0, sizeof(s->next_picture));",
      "844:     memset(&s->last_picture, 0, sizeof(s->last_picture));",
      "845:     memset(&s->current_picture, 0, sizeof(s->current_picture));",
      "846:     memset(&s->new_picture, 0, sizeof(s->new_picture));",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "d137bb92b29895207d0d2fccb34c235451771671",
      "candidate_info": {
        "commit_hash": "d137bb92b29895207d0d2fccb34c235451771671",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/d137bb92b29895207d0d2fccb34c235451771671",
        "files": [
          "libavcodec/mpegvideo.c"
        ],
        "message": "avcodec/mpegvideo: Clear pointers in ff_mpv_common_init()\n\nThis ensures that no stale pointers leak through on any path\n\nFixes: signal_sigsegv_c3097a_991_xtrem_e2_m64q15_a32sxx.3gp\n\nFound-by: Samuel Gro\u00df, Mateusz \"j00ru\" Jurczyk and Gynvael Coldwind\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>\n(cherry picked from commit b160fc290cf49b516c5b6ee0730fd9da7fc623b1)\n\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>",
        "before_after_code_files": [
          "libavcodec/mpegvideo.c||libavcodec/mpegvideo.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavcodec/mpegvideo.c||libavcodec/mpegvideo.c"
          ],
          "candidate": [
            "libavcodec/mpegvideo.c||libavcodec/mpegvideo.c"
          ]
        }
      },
      "candidate_diff": {
        "libavcodec/mpegvideo.c||libavcodec/mpegvideo.c": [
          "File: libavcodec/mpegvideo.c -> libavcodec/mpegvideo.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1286:     return AVERROR(ENOMEM);",
          "1287: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1289: static void clear_context(MpegEncContext *s)",
          "1290: {",
          "1291:     int i, j, k;",
          "1293:     memset(&s->next_picture, 0, sizeof(s->next_picture));",
          "1294:     memset(&s->last_picture, 0, sizeof(s->last_picture));",
          "1295:     memset(&s->current_picture, 0, sizeof(s->current_picture));",
          "1296:     memset(&s->new_picture, 0, sizeof(s->new_picture));",
          "1298:     memset(s->thread_context, 0, sizeof(s->thread_context));",
          "1300:     s->me.map = NULL;",
          "1301:     s->me.score_map = NULL;",
          "1302:     s->dct_error_sum = NULL;",
          "1303:     s->block = NULL;",
          "1304:     s->blocks = NULL;",
          "1305:     memset(s->pblocks, 0, sizeof(s->pblocks));",
          "1306:     s->ac_val_base = NULL;",
          "1307:     s->ac_val[0] =",
          "1308:     s->ac_val[1] =",
          "1309:     s->ac_val[2] =NULL;",
          "1310:     s->edge_emu_buffer = NULL;",
          "1311:     s->me.scratchpad = NULL;",
          "1312:     s->me.temp =",
          "1313:     s->rd_scratchpad =",
          "1314:     s->b_scratchpad =",
          "1315:     s->obmc_scratchpad = NULL;",
          "1317:     s->parse_context.buffer = NULL;",
          "1318:     s->parse_context.buffer_size = 0;",
          "1319:     s->bitstream_buffer = NULL;",
          "1320:     s->allocated_bitstream_buffer_size = 0;",
          "1321:     s->picture          = NULL;",
          "1322:     s->mb_type          = NULL;",
          "1323:     s->p_mv_table_base  = NULL;",
          "1324:     s->b_forw_mv_table_base = NULL;",
          "1325:     s->b_back_mv_table_base = NULL;",
          "1326:     s->b_bidir_forw_mv_table_base = NULL;",
          "1327:     s->b_bidir_back_mv_table_base = NULL;",
          "1328:     s->b_direct_mv_table_base = NULL;",
          "1329:     s->p_mv_table            = NULL;",
          "1330:     s->b_forw_mv_table       = NULL;",
          "1331:     s->b_back_mv_table       = NULL;",
          "1332:     s->b_bidir_forw_mv_table = NULL;",
          "1333:     s->b_bidir_back_mv_table = NULL;",
          "1334:     s->b_direct_mv_table     = NULL;",
          "1335:     for (i = 0; i < 2; i++) {",
          "1336:         for (j = 0; j < 2; j++) {",
          "1337:             for (k = 0; k < 2; k++) {",
          "1338:                 s->b_field_mv_table_base[i][j][k] = NULL;",
          "1339:                 s->b_field_mv_table[i][j][k] = NULL;",
          "1340:             }",
          "1341:             s->b_field_select_table[i][j] = NULL;",
          "1342:             s->p_field_mv_table_base[i][j] = NULL;",
          "1343:             s->p_field_mv_table[i][j] = NULL;",
          "1344:         }",
          "1345:         s->p_field_select_table[i] = NULL;",
          "1346:     }",
          "1348:     s->dc_val_base = NULL;",
          "1349:     s->coded_block_base = NULL;",
          "1350:     s->mbintra_table = NULL;",
          "1351:     s->cbp_table = NULL;",
          "1352:     s->pred_dir_table = NULL;",
          "1354:     s->mbskip_table = NULL;",
          "1356:     s->er.error_status_table = NULL;",
          "1357:     s->er.er_temp_buffer = NULL;",
          "1358:     s->mb_index2xy = NULL;",
          "1359:     s->lambda_table = NULL;",
          "1361:     s->cplx_tab = NULL;",
          "1362:     s->bits_tab = NULL;",
          "1363: }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1297:                      s->avctx->active_thread_type & FF_THREAD_SLICE) ?",
          "1298:                     s->avctx->thread_count : 1;",
          "1300:     if (s->encoding && s->avctx->slices)",
          "1301:         nb_slices = s->avctx->slices;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1376:     clear_context(s);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1344:         if (!s->picture[i].f)",
          "1345:             goto fail;",
          "1346:     }",
          "1351:     s->next_picture.f = av_frame_alloc();",
          "1352:     if (!s->next_picture.f)",
          "1353:         goto fail;",
          "",
          "[Removed Lines]",
          "1347:     memset(&s->next_picture, 0, sizeof(s->next_picture));",
          "1348:     memset(&s->last_picture, 0, sizeof(s->last_picture));",
          "1349:     memset(&s->current_picture, 0, sizeof(s->current_picture));",
          "1350:     memset(&s->new_picture, 0, sizeof(s->new_picture));",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "27a88f9d45d6fbd08796d8edc274a6758b3d170f",
      "candidate_info": {
        "commit_hash": "27a88f9d45d6fbd08796d8edc274a6758b3d170f",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/27a88f9d45d6fbd08796d8edc274a6758b3d170f",
        "files": [
          "libavcodec/mpegvideo.c"
        ],
        "message": "avcodec/mpegvideo: Clear pointers in ff_mpv_common_init()\n\nThis ensures that no stale pointers leak through on any path\n\nFixes: signal_sigsegv_c3097a_991_xtrem_e2_m64q15_a32sxx.3gp\n\nFound-by: Samuel Gro\u00df, Mateusz \"j00ru\" Jurczyk and Gynvael Coldwind\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>\n(cherry picked from commit b160fc290cf49b516c5b6ee0730fd9da7fc623b1)\n\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>",
        "before_after_code_files": [
          "libavcodec/mpegvideo.c||libavcodec/mpegvideo.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavcodec/mpegvideo.c||libavcodec/mpegvideo.c"
          ],
          "candidate": [
            "libavcodec/mpegvideo.c||libavcodec/mpegvideo.c"
          ]
        }
      },
      "candidate_diff": {
        "libavcodec/mpegvideo.c||libavcodec/mpegvideo.c": [
          "File: libavcodec/mpegvideo.c -> libavcodec/mpegvideo.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1288:     return AVERROR(ENOMEM);",
          "1289: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1291: static void clear_context(MpegEncContext *s)",
          "1292: {",
          "1293:     int i, j, k;",
          "1295:     memset(&s->next_picture, 0, sizeof(s->next_picture));",
          "1296:     memset(&s->last_picture, 0, sizeof(s->last_picture));",
          "1297:     memset(&s->current_picture, 0, sizeof(s->current_picture));",
          "1298:     memset(&s->new_picture, 0, sizeof(s->new_picture));",
          "1300:     memset(s->thread_context, 0, sizeof(s->thread_context));",
          "1302:     s->me.map = NULL;",
          "1303:     s->me.score_map = NULL;",
          "1304:     s->dct_error_sum = NULL;",
          "1305:     s->block = NULL;",
          "1306:     s->blocks = NULL;",
          "1307:     memset(s->pblocks, 0, sizeof(s->pblocks));",
          "1308:     s->ac_val_base = NULL;",
          "1309:     s->ac_val[0] =",
          "1310:     s->ac_val[1] =",
          "1311:     s->ac_val[2] =NULL;",
          "1312:     s->edge_emu_buffer = NULL;",
          "1313:     s->me.scratchpad = NULL;",
          "1314:     s->me.temp =",
          "1315:     s->rd_scratchpad =",
          "1316:     s->b_scratchpad =",
          "1317:     s->obmc_scratchpad = NULL;",
          "1319:     s->parse_context.buffer = NULL;",
          "1320:     s->parse_context.buffer_size = 0;",
          "1321:     s->bitstream_buffer = NULL;",
          "1322:     s->allocated_bitstream_buffer_size = 0;",
          "1323:     s->picture          = NULL;",
          "1324:     s->mb_type          = NULL;",
          "1325:     s->p_mv_table_base  = NULL;",
          "1326:     s->b_forw_mv_table_base = NULL;",
          "1327:     s->b_back_mv_table_base = NULL;",
          "1328:     s->b_bidir_forw_mv_table_base = NULL;",
          "1329:     s->b_bidir_back_mv_table_base = NULL;",
          "1330:     s->b_direct_mv_table_base = NULL;",
          "1331:     s->p_mv_table            = NULL;",
          "1332:     s->b_forw_mv_table       = NULL;",
          "1333:     s->b_back_mv_table       = NULL;",
          "1334:     s->b_bidir_forw_mv_table = NULL;",
          "1335:     s->b_bidir_back_mv_table = NULL;",
          "1336:     s->b_direct_mv_table     = NULL;",
          "1337:     for (i = 0; i < 2; i++) {",
          "1338:         for (j = 0; j < 2; j++) {",
          "1339:             for (k = 0; k < 2; k++) {",
          "1340:                 s->b_field_mv_table_base[i][j][k] = NULL;",
          "1341:                 s->b_field_mv_table[i][j][k] = NULL;",
          "1342:             }",
          "1343:             s->b_field_select_table[i][j] = NULL;",
          "1344:             s->p_field_mv_table_base[i][j] = NULL;",
          "1345:             s->p_field_mv_table[i][j] = NULL;",
          "1346:         }",
          "1347:         s->p_field_select_table[i] = NULL;",
          "1348:     }",
          "1350:     s->dc_val_base = NULL;",
          "1351:     s->coded_block_base = NULL;",
          "1352:     s->mbintra_table = NULL;",
          "1353:     s->cbp_table = NULL;",
          "1354:     s->pred_dir_table = NULL;",
          "1356:     s->mbskip_table = NULL;",
          "1358:     s->er.error_status_table = NULL;",
          "1359:     s->er.er_temp_buffer = NULL;",
          "1360:     s->mb_index2xy = NULL;",
          "1361:     s->lambda_table = NULL;",
          "1363:     s->cplx_tab = NULL;",
          "1364:     s->bits_tab = NULL;",
          "1365: }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1299:                      s->avctx->active_thread_type & FF_THREAD_SLICE) ?",
          "1300:                     s->avctx->thread_count : 1;",
          "1302:     if (s->encoding && s->avctx->slices)",
          "1303:         nb_slices = s->avctx->slices;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1378:     clear_context(s);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1346:         if (!s->picture[i].f)",
          "1347:             goto fail;",
          "1348:     }",
          "1353:     s->next_picture.f = av_frame_alloc();",
          "1354:     if (!s->next_picture.f)",
          "1355:         goto fail;",
          "",
          "[Removed Lines]",
          "1349:     memset(&s->next_picture, 0, sizeof(s->next_picture));",
          "1350:     memset(&s->last_picture, 0, sizeof(s->last_picture));",
          "1351:     memset(&s->current_picture, 0, sizeof(s->current_picture));",
          "1352:     memset(&s->new_picture, 0, sizeof(s->new_picture));",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "88fa3243ddf320ce1d6691c6098e87263bd6d0ca",
      "candidate_info": {
        "commit_hash": "88fa3243ddf320ce1d6691c6098e87263bd6d0ca",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/88fa3243ddf320ce1d6691c6098e87263bd6d0ca",
        "files": [
          "libavcodec/mpegvideo.c"
        ],
        "message": "avcodec/mpegvideo: Clear pointers in ff_mpv_common_init()\n\nThis ensures that no stale pointers leak through on any path\n\nFixes: signal_sigsegv_c3097a_991_xtrem_e2_m64q15_a32sxx.3gp\n\nFound-by: Samuel Gro\u00df, Mateusz \"j00ru\" Jurczyk and Gynvael Coldwind\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>\n(cherry picked from commit b160fc290cf49b516c5b6ee0730fd9da7fc623b1)\n\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>",
        "before_after_code_files": [
          "libavcodec/mpegvideo.c||libavcodec/mpegvideo.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavcodec/mpegvideo.c||libavcodec/mpegvideo.c"
          ],
          "candidate": [
            "libavcodec/mpegvideo.c||libavcodec/mpegvideo.c"
          ]
        }
      },
      "candidate_diff": {
        "libavcodec/mpegvideo.c||libavcodec/mpegvideo.c": [
          "File: libavcodec/mpegvideo.c -> libavcodec/mpegvideo.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1227:     return AVERROR(ENOMEM);",
          "1228: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1230: static void clear_context(MpegEncContext *s)",
          "1231: {",
          "1232:     int i, j, k;",
          "1234:     memset(&s->next_picture, 0, sizeof(s->next_picture));",
          "1235:     memset(&s->last_picture, 0, sizeof(s->last_picture));",
          "1236:     memset(&s->current_picture, 0, sizeof(s->current_picture));",
          "1237:     memset(&s->new_picture, 0, sizeof(s->new_picture));",
          "1239:     memset(s->thread_context, 0, sizeof(s->thread_context));",
          "1241:     s->me.map = NULL;",
          "1242:     s->me.score_map = NULL;",
          "1243:     s->dct_error_sum = NULL;",
          "1244:     s->block = NULL;",
          "1245:     s->blocks = NULL;",
          "1246:     memset(s->pblocks, 0, sizeof(s->pblocks));",
          "1247:     s->ac_val_base = NULL;",
          "1248:     s->ac_val[0] =",
          "1249:     s->ac_val[1] =",
          "1250:     s->ac_val[2] =NULL;",
          "1251:     s->sc.edge_emu_buffer = NULL;",
          "1252:     s->me.scratchpad = NULL;",
          "1253:     s->me.temp =",
          "1254:     s->sc.rd_scratchpad =",
          "1255:     s->sc.b_scratchpad =",
          "1256:     s->sc.obmc_scratchpad = NULL;",
          "1258:     s->parse_context.buffer = NULL;",
          "1259:     s->parse_context.buffer_size = 0;",
          "1260:     s->bitstream_buffer = NULL;",
          "1261:     s->allocated_bitstream_buffer_size = 0;",
          "1262:     s->picture          = NULL;",
          "1263:     s->mb_type          = NULL;",
          "1264:     s->p_mv_table_base  = NULL;",
          "1265:     s->b_forw_mv_table_base = NULL;",
          "1266:     s->b_back_mv_table_base = NULL;",
          "1267:     s->b_bidir_forw_mv_table_base = NULL;",
          "1268:     s->b_bidir_back_mv_table_base = NULL;",
          "1269:     s->b_direct_mv_table_base = NULL;",
          "1270:     s->p_mv_table            = NULL;",
          "1271:     s->b_forw_mv_table       = NULL;",
          "1272:     s->b_back_mv_table       = NULL;",
          "1273:     s->b_bidir_forw_mv_table = NULL;",
          "1274:     s->b_bidir_back_mv_table = NULL;",
          "1275:     s->b_direct_mv_table     = NULL;",
          "1276:     for (i = 0; i < 2; i++) {",
          "1277:         for (j = 0; j < 2; j++) {",
          "1278:             for (k = 0; k < 2; k++) {",
          "1279:                 s->b_field_mv_table_base[i][j][k] = NULL;",
          "1280:                 s->b_field_mv_table[i][j][k] = NULL;",
          "1281:             }",
          "1282:             s->b_field_select_table[i][j] = NULL;",
          "1283:             s->p_field_mv_table_base[i][j] = NULL;",
          "1284:             s->p_field_mv_table[i][j] = NULL;",
          "1285:         }",
          "1286:         s->p_field_select_table[i] = NULL;",
          "1287:     }",
          "1289:     s->dc_val_base = NULL;",
          "1290:     s->coded_block_base = NULL;",
          "1291:     s->mbintra_table = NULL;",
          "1292:     s->cbp_table = NULL;",
          "1293:     s->pred_dir_table = NULL;",
          "1295:     s->mbskip_table = NULL;",
          "1297:     s->er.error_status_table = NULL;",
          "1298:     s->er.er_temp_buffer = NULL;",
          "1299:     s->mb_index2xy = NULL;",
          "1300:     s->lambda_table = NULL;",
          "1302:     s->cplx_tab = NULL;",
          "1303:     s->bits_tab = NULL;",
          "1304: }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1238:                      s->avctx->active_thread_type & FF_THREAD_SLICE) ?",
          "1239:                     s->avctx->thread_count : 1;",
          "1241:     if (s->encoding && s->avctx->slices)",
          "1242:         nb_slices = s->avctx->slices;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1317:     clear_context(s);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1282:         if (!s->picture[i].f)",
          "1283:             goto fail;",
          "1284:     }",
          "1289:     s->next_picture.f = av_frame_alloc();",
          "1290:     if (!s->next_picture.f)",
          "1291:         goto fail;",
          "",
          "[Removed Lines]",
          "1285:     memset(&s->next_picture, 0, sizeof(s->next_picture));",
          "1286:     memset(&s->last_picture, 0, sizeof(s->last_picture));",
          "1287:     memset(&s->current_picture, 0, sizeof(s->current_picture));",
          "1288:     memset(&s->new_picture, 0, sizeof(s->new_picture));",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "c58b0d981ea7537507c79c29f5d4337d616da377",
      "candidate_info": {
        "commit_hash": "c58b0d981ea7537507c79c29f5d4337d616da377",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/c58b0d981ea7537507c79c29f5d4337d616da377",
        "files": [
          "libavcodec/mpegvideo.c"
        ],
        "message": "avcodec/mpegvideo: Clear pointers in ff_mpv_common_init()\n\nThis ensures that no stale pointers leak through on any path\n\nFixes: signal_sigsegv_c3097a_991_xtrem_e2_m64q15_a32sxx.3gp\n\nFound-by: Samuel Gro\u00df, Mateusz \"j00ru\" Jurczyk and Gynvael Coldwind\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>\n(cherry picked from commit b160fc290cf49b516c5b6ee0730fd9da7fc623b1)\n\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>",
        "before_after_code_files": [
          "libavcodec/mpegvideo.c||libavcodec/mpegvideo.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavcodec/mpegvideo.c||libavcodec/mpegvideo.c"
          ],
          "candidate": [
            "libavcodec/mpegvideo.c||libavcodec/mpegvideo.c"
          ]
        }
      },
      "candidate_diff": {
        "libavcodec/mpegvideo.c||libavcodec/mpegvideo.c": [
          "File: libavcodec/mpegvideo.c -> libavcodec/mpegvideo.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1285:     return AVERROR(ENOMEM);",
          "1286: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1288: static void clear_context(MpegEncContext *s)",
          "1289: {",
          "1290:     int i, j, k;",
          "1292:     memset(&s->next_picture, 0, sizeof(s->next_picture));",
          "1293:     memset(&s->last_picture, 0, sizeof(s->last_picture));",
          "1294:     memset(&s->current_picture, 0, sizeof(s->current_picture));",
          "1295:     memset(&s->new_picture, 0, sizeof(s->new_picture));",
          "1297:     memset(s->thread_context, 0, sizeof(s->thread_context));",
          "1299:     s->me.map = NULL;",
          "1300:     s->me.score_map = NULL;",
          "1301:     s->dct_error_sum = NULL;",
          "1302:     s->block = NULL;",
          "1303:     s->blocks = NULL;",
          "1304:     memset(s->pblocks, 0, sizeof(s->pblocks));",
          "1305:     s->ac_val_base = NULL;",
          "1306:     s->ac_val[0] =",
          "1307:     s->ac_val[1] =",
          "1308:     s->ac_val[2] =NULL;",
          "1309:     s->edge_emu_buffer = NULL;",
          "1310:     s->me.scratchpad = NULL;",
          "1311:     s->me.temp =",
          "1312:     s->rd_scratchpad =",
          "1313:     s->b_scratchpad =",
          "1314:     s->obmc_scratchpad = NULL;",
          "1316:     s->parse_context.buffer = NULL;",
          "1317:     s->parse_context.buffer_size = 0;",
          "1318:     s->bitstream_buffer = NULL;",
          "1319:     s->allocated_bitstream_buffer_size = 0;",
          "1320:     s->picture          = NULL;",
          "1321:     s->mb_type          = NULL;",
          "1322:     s->p_mv_table_base  = NULL;",
          "1323:     s->b_forw_mv_table_base = NULL;",
          "1324:     s->b_back_mv_table_base = NULL;",
          "1325:     s->b_bidir_forw_mv_table_base = NULL;",
          "1326:     s->b_bidir_back_mv_table_base = NULL;",
          "1327:     s->b_direct_mv_table_base = NULL;",
          "1328:     s->p_mv_table            = NULL;",
          "1329:     s->b_forw_mv_table       = NULL;",
          "1330:     s->b_back_mv_table       = NULL;",
          "1331:     s->b_bidir_forw_mv_table = NULL;",
          "1332:     s->b_bidir_back_mv_table = NULL;",
          "1333:     s->b_direct_mv_table     = NULL;",
          "1334:     for (i = 0; i < 2; i++) {",
          "1335:         for (j = 0; j < 2; j++) {",
          "1336:             for (k = 0; k < 2; k++) {",
          "1337:                 s->b_field_mv_table_base[i][j][k] = NULL;",
          "1338:                 s->b_field_mv_table[i][j][k] = NULL;",
          "1339:             }",
          "1340:             s->b_field_select_table[i][j] = NULL;",
          "1341:             s->p_field_mv_table_base[i][j] = NULL;",
          "1342:             s->p_field_mv_table[i][j] = NULL;",
          "1343:         }",
          "1344:         s->p_field_select_table[i] = NULL;",
          "1345:     }",
          "1347:     s->dc_val_base = NULL;",
          "1348:     s->coded_block_base = NULL;",
          "1349:     s->mbintra_table = NULL;",
          "1350:     s->cbp_table = NULL;",
          "1351:     s->pred_dir_table = NULL;",
          "1353:     s->mbskip_table = NULL;",
          "1355:     s->er.error_status_table = NULL;",
          "1356:     s->er.er_temp_buffer = NULL;",
          "1357:     s->mb_index2xy = NULL;",
          "1358:     s->lambda_table = NULL;",
          "1360:     s->cplx_tab = NULL;",
          "1361:     s->bits_tab = NULL;",
          "1362: }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1296:                      s->avctx->active_thread_type & FF_THREAD_SLICE) ?",
          "1297:                     s->avctx->thread_count : 1;",
          "1299:     if (s->encoding && s->avctx->slices)",
          "1300:         nb_slices = s->avctx->slices;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1375:     clear_context(s);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1343:         if (!s->picture[i].f)",
          "1344:             goto fail;",
          "1345:     }",
          "1350:     s->next_picture.f = av_frame_alloc();",
          "1351:     if (!s->next_picture.f)",
          "1352:         goto fail;",
          "",
          "[Removed Lines]",
          "1346:     memset(&s->next_picture, 0, sizeof(s->next_picture));",
          "1347:     memset(&s->last_picture, 0, sizeof(s->last_picture));",
          "1348:     memset(&s->current_picture, 0, sizeof(s->current_picture));",
          "1349:     memset(&s->new_picture, 0, sizeof(s->new_picture));",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    }
  ]
}