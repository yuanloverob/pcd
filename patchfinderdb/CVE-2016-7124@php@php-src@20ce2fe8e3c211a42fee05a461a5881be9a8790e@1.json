{
  "cve_id": "CVE-2016-7124",
  "cve_desc": "ext/standard/var_unserializer.c in PHP before 5.6.25 and 7.x before 7.0.10 mishandles certain invalid objects, which allows remote attackers to cause a denial of service or possibly have unspecified other impact via crafted serialized data that leads to a (1) __destruct call or (2) magic method call.",
  "repo": "php/php-src",
  "patch_hash": "20ce2fe8e3c211a42fee05a461a5881be9a8790e",
  "patch_info": {
    "commit_hash": "20ce2fe8e3c211a42fee05a461a5881be9a8790e",
    "repo": "php/php-src",
    "commit_url": "https://github.com/php/php-src/commit/20ce2fe8e3c211a42fee05a461a5881be9a8790e",
    "files": [
      "ext/standard/tests/strings/bug72663.phpt",
      "ext/standard/tests/strings/bug72663_2.phpt",
      "ext/standard/var_unserializer.c"
    ],
    "message": "Fix bug #72663 - destroy broken object when unserializing\n\n(cherry picked from commit 448c9be157f4147e121f1a2a524536c75c9c6059)",
    "before_after_code_files": [
      "ext/standard/tests/strings/bug72663.phpt||ext/standard/tests/strings/bug72663.phpt",
      "ext/standard/tests/strings/bug72663_2.phpt||ext/standard/tests/strings/bug72663_2.phpt",
      "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c"
    ]
  },
  "patch_diff": {
    "ext/standard/tests/strings/bug72663.phpt||ext/standard/tests/strings/bug72663.phpt": [
      "File: ext/standard/tests/strings/bug72663.phpt -> ext/standard/tests/strings/bug72663.phpt",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: --TEST--",
      "2: Bug #72663: Create an Unexpected Object and Don't Invoke __wakeup() in Deserialization",
      "3: --FILE--",
      "4: <?php",
      "5: class obj implements Serializable {",
      "6:     var $data;",
      "7:     function serialize() {",
      "8:         return serialize($this->data);",
      "9:     }",
      "10:     function unserialize($data) {",
      "11:         $this->data = unserialize($data);",
      "12:     }",
      "13: }",
      "15: $inner = 'a:1:{i:0;O:9:\"Exception\":2:{s:7:\"'.\"\\0\".'*'.\"\\0\".'file\";R:4;}';",
      "16: $exploit = 'a:2:{i:0;C:3:\"obj\":'.strlen($inner).':{'.$inner.'}i:1;R:4;}';",
      "18: $data = unserialize($exploit);",
      "19: echo $data[1];",
      "20: ?>",
      "21: DONE",
      "22: --EXPECTF--",
      "23: Notice: unserialize(): Unexpected end of serialized data in %sbug72663.php on line %d",
      "25: Notice: unserialize(): Error at offset 46 of 47 bytes in %sbug72663.php on line %d",
      "26: DONE",
      "",
      "---------------"
    ],
    "ext/standard/tests/strings/bug72663_2.phpt||ext/standard/tests/strings/bug72663_2.phpt": [
      "File: ext/standard/tests/strings/bug72663_2.phpt -> ext/standard/tests/strings/bug72663_2.phpt",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: --TEST--",
      "2: Bug #72663: Create an Unexpected Object and Don't Invoke __wakeup() in Deserialization",
      "3: --FILE--",
      "4: <?php",
      "6: ini_set('session.serialize_handler', 'php_serialize');",
      "7: session_start();",
      "8: $sess = 'O:9:\"Exception\":2:{s:7:\"'.\"\\0\".'*'.\"\\0\".'file\";R:1;}';",
      "9: session_decode($sess);",
      "10: var_dump($_SESSION);",
      "11: ?>",
      "12: DONE",
      "13: --EXPECTF--",
      "14: Notice: session_decode(): Unexpected end of serialized data in %sbug72663_2.php on line %d",
      "15: array(0) {",
      "16: }",
      "17: DONE",
      "",
      "---------------"
    ],
    "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
      "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "687:  if (yybm[0+yych] & 128) {",
      "688:   goto yy20;",
      "689:  }",
      "691:  yych = *++YYCURSOR;",
      "692:  if (yych != '\"') goto yy18;",
      "693:  ++YYCURSOR;",
      "",
      "[Removed Lines]",
      "690:  if (yych != ':') goto yy18;",
      "",
      "[Added Lines]",
      "690:  if (yych <= '/') goto yy18;",
      "691:  if (yych >= ';') goto yy18;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "837:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
      "838: }",
      "840: yy25:",
      "841:  yych = *++YYCURSOR;",
      "842:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "839: #line 804 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "840: #line 805 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "868:  return object_common2(UNSERIALIZE_PASSTHRU,",
      "869:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
      "870: }",
      "872: yy32:",
      "873:  yych = *++YYCURSOR;",
      "874:  if (yych == '+') goto yy33;",
      "",
      "[Removed Lines]",
      "871: #line 836 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "872: #line 837 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "914:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
      "915: }",
      "917: yy39:",
      "918:  yych = *++YYCURSOR;",
      "919:  if (yych == '+') goto yy40;",
      "",
      "[Removed Lines]",
      "916: #line 881 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "917: #line 882 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "968:  ZVAL_STR(rval, str);",
      "969:  return 1;",
      "970: }",
      "972: yy46:",
      "973:  yych = *++YYCURSOR;",
      "974:  if (yych == '+') goto yy47;",
      "",
      "[Removed Lines]",
      "971: #line 936 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "972: #line 937 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "1021:  ZVAL_STRINGL(rval, str, len);",
      "1022:  return 1;",
      "1023: }",
      "1025: yy53:",
      "1026:  yych = *++YYCURSOR;",
      "1027:  if (yych <= '/') {",
      "",
      "[Removed Lines]",
      "1024: #line 989 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1025: #line 990 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "1118:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
      "1119:  return 1;",
      "1120: }",
      "1122: yy65:",
      "1123:  yych = *++YYCURSOR;",
      "1124:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1121: #line 1086 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1122: #line 1087 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 8 ---",
      "[Context before]",
      "1194:  return 1;",
      "1195: }",
      "1197: yy76:",
      "1198:  yych = *++YYCURSOR;",
      "1199:  if (yych == 'N') goto yy73;",
      "",
      "[Removed Lines]",
      "1196: #line 1161 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1197: #line 1162 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 9 ---",
      "[Context before]",
      "1246:  ZVAL_LONG(rval, parse_iv(start + 2));",
      "1247:  return 1;",
      "1248: }",
      "1250: yy83:",
      "1251:  yych = *++YYCURSOR;",
      "1252:  if (yych <= '/') goto yy18;",
      "",
      "[Removed Lines]",
      "1249: #line 1214 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1250: #line 1215 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 10 ---",
      "[Context before]",
      "1260:  ZVAL_BOOL(rval, parse_iv(start + 2));",
      "1261:  return 1;",
      "1262: }",
      "1264: yy87:",
      "1265:  ++YYCURSOR;",
      "1266: #line 573 \"ext/standard/var_unserializer.re\"",
      "",
      "[Removed Lines]",
      "1263: #line 1228 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1264: #line 1229 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 11 ---",
      "[Context before]",
      "1269:  ZVAL_NULL(rval);",
      "1270:  return 1;",
      "1271: }",
      "1273: yy89:",
      "1274:  yych = *++YYCURSOR;",
      "1275:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1272: #line 1237 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1273: #line 1238 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 12 ---",
      "[Context before]",
      "1318:  return 1;",
      "1319: }",
      "1321: yy95:",
      "1322:  yych = *++YYCURSOR;",
      "1323:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1320: #line 1285 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1321: #line 1286 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 13 ---",
      "[Context before]",
      "1367:  return 1;",
      "1368: }",
      "1370: }",
      "1371: #line 886 \"ext/standard/var_unserializer.re\"",
      "",
      "[Removed Lines]",
      "1369: #line 1334 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1370: #line 1335 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "bcd64a9bdd8afcf7f91a12e700d12d12eedc136b",
      "candidate_info": {
        "commit_hash": "bcd64a9bdd8afcf7f91a12e700d12d12eedc136b",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/bcd64a9bdd8afcf7f91a12e700d12d12eedc136b",
        "files": [
          "ext/spl/spl_array.c",
          "ext/standard/tests/serialize/bug71311.phpt",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Fixed bug #71311: Use-after-free vulnerability in SPL(ArrayObject, unserialize)",
        "before_after_code_files": [
          "ext/spl/spl_array.c||ext/spl/spl_array.c",
          "ext/standard/tests/serialize/bug71311.phpt||ext/standard/tests/serialize/bug71311.phpt",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c"
          ]
        }
      },
      "candidate_diff": {
        "ext/spl/spl_array.c||ext/spl/spl_array.c": [
          "File: ext/spl/spl_array.c -> ext/spl/spl_array.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1778:   intern->ar_flags &= ~SPL_ARRAY_CLONE_MASK;",
          "1779:   intern->ar_flags |= flags & SPL_ARRAY_CLONE_MASK;",
          "1780:   zval_ptr_dtor(&intern->array);",
          "1781:   if (!php_var_unserialize(&intern->array, &p, s + buf_len, &var_hash)) {",
          "1782:    goto outexcept;",
          "1783:   }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1781:   ZVAL_UNDEF(&intern->array);",
          "",
          "---------------"
        ],
        "ext/standard/tests/serialize/bug71311.phpt||ext/standard/tests/serialize/bug71311.phpt": [
          "File: ext/standard/tests/serialize/bug71311.phpt -> ext/standard/tests/serialize/bug71311.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #71311 Use-after-free vulnerability in SPL(ArrayObject, unserialize)",
          "3: --FILE--",
          "4: <?php",
          "5: $data = unserialize(\"C:11:\\\"ArrayObject\\\":11:{x:i:0;r:3;XX\");",
          "6: var_dump($data);",
          "7: ?>",
          "8: --EXPECTF--",
          "9: Fatal error: Uncaught UnexpectedValueException: Error at offset 10 of 11 bytes in %s/bug71311.php:2",
          "10: Stack trace:",
          "11: #0 [internal function]: ArrayObject->unserialize('x:i:0;r:3;X')",
          "12: #1 %s/bug71311.php(2): unserialize('%s')",
          "13: #2 {main}",
          "14:   thrown in %s/bug71311.php on line 2",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "574:  yych = *(YYMARKER = ++YYCURSOR);",
          "575:  if (yych == ':') goto yy95;",
          "576: yy3:",
          "578:  { return 0; }",
          "579: #line 580 \"ext/standard/var_unserializer.c\"",
          "580: yy4:",
          "",
          "[Removed Lines]",
          "577: #line 869 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "577: #line 873 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "619:  goto yy3;",
          "620: yy14:",
          "621:  ++YYCURSOR;",
          "623:  {",
          "625:  php_error_docref(NULL, E_NOTICE, \"Unexpected end of serialized data\");",
          "",
          "[Removed Lines]",
          "622: #line 863 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "622: #line 867 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "651:  if (yybm[0+yych] & 128) {",
          "652:   goto yy20;",
          "653:  }",
          "655:  yych = *++YYCURSOR;",
          "656:  if (yych != '\"') goto yy18;",
          "657:  ++YYCURSOR;",
          "659:  {",
          "660:  size_t len, len2, len3, maxlen;",
          "661:  zend_long elements;",
          "",
          "[Removed Lines]",
          "654:  if (yych != ':') goto yy18;",
          "658: #line 718 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "654:  if (yych <= '/') goto yy18;",
          "655:  if (yych >= ';') goto yy18;",
          "659: #line 722 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "801:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "802: }",
          "804: yy25:",
          "805:  yych = *++YYCURSOR;",
          "806:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "803: #line 804 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "804: #line 805 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "825:  yych = *++YYCURSOR;",
          "826:  if (yych != '\"') goto yy18;",
          "827:  ++YYCURSOR;",
          "829:  {",
          "830:     if (!var_hash) return 0;",
          "832:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "833:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "834: }",
          "836: yy32:",
          "837:  yych = *++YYCURSOR;",
          "838:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "828: #line 711 \"ext/standard/var_unserializer.re\"",
          "835: #line 836 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "829: #line 715 \"ext/standard/var_unserializer.re\"",
          "836: #line 837 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "853:  yych = *++YYCURSOR;",
          "854:  if (yych != '{') goto yy18;",
          "855:  ++YYCURSOR;",
          "857:  {",
          "858:  zend_long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "856: #line 687 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "857: #line 691 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "878:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "879: }",
          "881: yy39:",
          "882:  yych = *++YYCURSOR;",
          "883:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "880: #line 881 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "881: #line 882 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "898:  yych = *++YYCURSOR;",
          "899:  if (yych != '\"') goto yy18;",
          "900:  ++YYCURSOR;",
          "902:  {",
          "903:  size_t len, maxlen;",
          "904:  zend_string *str;",
          "",
          "[Removed Lines]",
          "901: #line 659 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "902: #line 663 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "926:  ZVAL_STR(rval, str);",
          "927:  return 1;",
          "928: }",
          "930: yy46:",
          "931:  yych = *++YYCURSOR;",
          "932:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "929: #line 930 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "930: #line 931 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "947:  yych = *++YYCURSOR;",
          "948:  if (yych != '\"') goto yy18;",
          "949:  ++YYCURSOR;",
          "951:  {",
          "952:  size_t len, maxlen;",
          "953:  char *str;",
          "",
          "[Removed Lines]",
          "950: #line 632 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "951: #line 636 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "974:  ZVAL_STRINGL(rval, str, len);",
          "975:  return 1;",
          "976: }",
          "978: yy53:",
          "979:  yych = *++YYCURSOR;",
          "980:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "977: #line 978 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "978: #line 979 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "1062:  }",
          "1063: yy63:",
          "1064:  ++YYCURSOR;",
          "1066:  {",
          "1067: #if SIZEOF_ZEND_LONG == 4",
          "1068: use_double:",
          "",
          "[Removed Lines]",
          "1065: #line 623 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1066: #line 627 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "1071:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1072:  return 1;",
          "1073: }",
          "1075: yy65:",
          "1076:  yych = *++YYCURSOR;",
          "1077:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1074: #line 1075 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1075: #line 1076 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "1130:  yych = *++YYCURSOR;",
          "1131:  if (yych != ';') goto yy18;",
          "1132:  ++YYCURSOR;",
          "1134:  {",
          "",
          "[Removed Lines]",
          "1133: #line 607 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1134: #line 611 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1147:  return 1;",
          "1148: }",
          "1150: yy76:",
          "1151:  yych = *++YYCURSOR;",
          "1152:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1149: #line 1150 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1150: #line 1151 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1173:  if (yych <= '9') goto yy79;",
          "1174:  if (yych != ';') goto yy18;",
          "1175:  ++YYCURSOR;",
          "1177:  {",
          "1178: #if SIZEOF_ZEND_LONG == 4",
          "1179:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1176: #line 581 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1177: #line 585 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1199:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1200:  return 1;",
          "1201: }",
          "1203: yy83:",
          "1204:  yych = *++YYCURSOR;",
          "1205:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1202: #line 1203 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1203: #line 1204 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "1207:  yych = *++YYCURSOR;",
          "1208:  if (yych != ';') goto yy18;",
          "1209:  ++YYCURSOR;",
          "1211:  {",
          "1213:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1214:  return 1;",
          "1215: }",
          "1217: yy87:",
          "1218:  ++YYCURSOR;",
          "1220:  {",
          "1222:  ZVAL_NULL(rval);",
          "1223:  return 1;",
          "1224: }",
          "1226: yy89:",
          "1227:  yych = *++YYCURSOR;",
          "1228:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1210: #line 575 \"ext/standard/var_unserializer.re\"",
          "1216: #line 1217 \"ext/standard/var_unserializer.c\"",
          "1219: #line 569 \"ext/standard/var_unserializer.re\"",
          "1225: #line 1226 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1211: #line 579 \"ext/standard/var_unserializer.re\"",
          "1217: #line 1218 \"ext/standard/var_unserializer.c\"",
          "1220: #line 573 \"ext/standard/var_unserializer.re\"",
          "1226: #line 1227 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1257:   return 0;",
          "1258:  }",
          "1260:  if (Z_ISUNDEF_P(rval_ref) || (Z_ISREF_P(rval_ref) && Z_ISUNDEF_P(Z_REFVAL_P(rval_ref)))) {",
          "1261:   ZVAL_UNDEF(rval);",
          "1262:   return 1;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1261:  if (rval_ref == rval) {",
          "1262:   return 0;",
          "1263:  }",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1267:  return 1;",
          "1268: }",
          "1270: yy95:",
          "1271:  yych = *++YYCURSOR;",
          "1272:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1269: #line 1270 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1274: #line 1275 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "1316:  return 1;",
          "1317: }",
          "1319: }",
          "1323:  return 0;",
          "",
          "[Removed Lines]",
          "1318: #line 1319 \"ext/standard/var_unserializer.c\"",
          "1320: #line 871 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1323: #line 1324 \"ext/standard/var_unserializer.c\"",
          "1325: #line 875 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "556:   return 0;",
          "557:  }",
          "559:  if (Z_ISUNDEF_P(rval_ref) || (Z_ISREF_P(rval_ref) && Z_ISUNDEF_P(Z_REFVAL_P(rval_ref)))) {",
          "560:   ZVAL_UNDEF(rval);",
          "561:   return 1;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "559:  if (rval_ref == rval) {",
          "560:   return 0;",
          "561:  }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "5602f6421372848a6fbb23fbe6bbca47d94dd49a",
      "candidate_info": {
        "commit_hash": "5602f6421372848a6fbb23fbe6bbca47d94dd49a",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/5602f6421372848a6fbb23fbe6bbca47d94dd49a",
        "files": [
          "ext/dba/php_dba.h",
          "ext/exif/exif.c",
          "ext/mysqlnd/mysqlnd_priv.h",
          "ext/readline/readline.c",
          "ext/soap/php_http.c",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re",
          "main/php_streams.h",
          "sapi/phpdbg/phpdbg_wait.c"
        ],
        "message": "Eliminate usages of _PP macros\n\nThese are either in debug code (fix them), commented out (drop\nthem) or in dead compatibility macros (drop them).\n\nOne usage was in php_stream_get_from_zval(), which we have not used\nsince at least PHP 5.2 and, judging from the fact that nobody\ncomplained about it causing compile errors in PHP 7, nobody else\nuses it either, so drop it.\n\nThere are still remaining uses in mysqli embedded and odbc birdstep.\nThese probably need to be dropped outright.",
        "before_after_code_files": [
          "ext/dbphp_dba.h||ext/dba/php_dba.h",
          "ext/exif/exif.c||ext/exif/exif.c",
          "ext/mysqlnd/mysqlnd_priv.h||ext/mysqlnd/mysqlnd_priv.h",
          "ext/readline/readline.c||ext/readline/readline.c",
          "ext/soap/php_http.c||ext/soap/php_http.c",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re",
          "main/php_streams.h||main/php_streams.h",
          "sapi/phpdbg/phpdbg_wait.c||sapi/phpdbg/phpdbg_wait.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c"
          ]
        }
      },
      "candidate_diff": {
        "ext/dbphp_dba.h||ext/dba/php_dba.h": [
          "File: ext/dbphp_dba.h -> ext/dba/php_dba.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "ext/exif/exif.c||ext/exif/exif.c": [
          "File: ext/exif/exif.c -> ext/exif/exif.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "4074:  exif_discard_imageinfo(&ImageInfo);",
          "4076: #ifdef EXIF_DEBUG",
          "4078: #endif",
          "4079: }",
          "",
          "[Removed Lines]",
          "4077:  php_error_docref1(NULL, Z_STRVAL_PP(p_name), E_NOTICE, \"done\");",
          "",
          "[Added Lines]",
          "4077:  php_error_docref1(NULL, p_name, E_NOTICE, \"done\");",
          "",
          "---------------"
        ],
        "ext/mysqlnd/mysqlnd_priv.h||ext/mysqlnd/mysqlnd_priv.h": [
          "File: ext/mysqlnd/mysqlnd_priv.h -> ext/mysqlnd/mysqlnd_priv.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "23: #ifndef MYSQLND_PRIV_H",
          "24: #define MYSQLND_PRIV_H",
          "36: #ifdef ZTS",
          "37: #include \"TSRM.h\"",
          "38: #endif",
          "44: #define MYSQLND_STR_W_LEN(str)  str, (sizeof(str) - 1)",
          "46: #define MYSQLND_DEBUG_DUMP_TIME    1",
          "",
          "[Removed Lines]",
          "26: #ifndef Z_ADDREF_P",
          "28: #define Z_ADDREF_P(pz)    (++(pz)->refcount)",
          "29: #define Z_DELREF_P(pz)    (--(pz)->refcount)",
          "30: #define Z_REFCOUNT_P(pz)   ((pz)->refcount)",
          "31: #define Z_SET_REFCOUNT_P(pz, rc) ((pz)->refcount = rc)",
          "32: #define Z_REFCOUNT_PP(ppz)   Z_REFCOUNT_P(*(ppz))",
          "33: #define Z_DELREF_PP(ppz)   Z_DELREF_P(*(ppz))",
          "34: #endif",
          "40: #ifndef pestrndup",
          "41: #define pestrndup(s, length, persistent) ((persistent)?zend_strndup((s),(length)):estrndup((s),(length)))",
          "42: #endif",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "ext/readline/readline.c||ext/readline/readline.c": [
          "File: ext/readline/readline.c -> ext/readline/readline.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "305:    oldval = rl_erase_empty_line;",
          "306:    if (value) {",
          "307:     convert_to_long_ex(value);",
          "309:    }",
          "310:    RETVAL_LONG(oldval);",
          "311: #endif",
          "",
          "[Removed Lines]",
          "308:     rl_erase_empty_line = Z_LVAL_PP(value);",
          "",
          "[Added Lines]",
          "308:     rl_erase_empty_line = Z_LVAL_P(value);",
          "",
          "---------------"
        ],
        "ext/soap/php_http.c||ext/soap/php_http.c": [
          "File: ext/soap/php_http.c -> ext/soap/php_http.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "700:       PHP_MD5Update(&md5ctx, (unsigned char*)phpurl->query, strlen(phpurl->query));",
          "701:      }",
          "713:      PHP_MD5Final(hash, &md5ctx);",
          "714:      make_digest(HA2, hash);",
          "",
          "[Removed Lines]",
          "705:      if (zend_hash_find(Z_ARRVAL_PP(digest), \"qop\", sizeof(\"qop\"), (void **)&tmp) == SUCCESS &&",
          "706:          Z_TYPE_PP(tmp) == IS_STRING &&",
          "707:          Z_STRLEN_PP(tmp) == sizeof(\"auth-int\")-1 &&",
          "708:          stricmp(Z_STRVAL_PP(tmp), \"auth-int\") == 0) {",
          "709:       PHP_MD5Update(&md5ctx, \":\", 1);",
          "710:       PHP_MD5Update(&md5ctx, HEntity, HASHHEXLEN);",
          "711:      }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "44: {",
          "45:  var_entries *var_hash = (*var_hashx)->last;",
          "46: #if VAR_ENTRIES_DBG",
          "48: #endif",
          "50:  if (!var_hash || var_hash->used_slots == VAR_ENTRIES_MAX) {",
          "",
          "[Removed Lines]",
          "47:  fprintf(stderr, \"var_push(%ld): %d\\n\", var_hash?var_hash->used_slots:-1L, Z_TYPE_PP(rval));",
          "",
          "[Added Lines]",
          "47:  fprintf(stderr, \"var_push(%ld): %d\\n\", var_hash?var_hash->used_slots:-1L, Z_TYPE_P(rval));",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "104:  zend_long i;",
          "105:  var_entries *var_hash = (*var_hashx)->first;",
          "106: #if VAR_ENTRIES_DBG",
          "108: #endif",
          "110:  while (var_hash) {",
          "",
          "[Removed Lines]",
          "107:  fprintf(stderr, \"var_replace(%ld): %d\\n\", var_hash?var_hash->used_slots:-1L, Z_TYPE_PP(nzval));",
          "",
          "[Added Lines]",
          "107:  fprintf(stderr, \"var_replace(%ld): %d\\n\", var_hash?var_hash->used_slots:-1L, Z_TYPE_P(nzval));",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "651:  if (yybm[0+yych] & 128) {",
          "652:   goto yy20;",
          "653:  }",
          "656:  yych = *++YYCURSOR;",
          "657:  if (yych != '\"') goto yy18;",
          "658:  ++YYCURSOR;",
          "",
          "[Removed Lines]",
          "654:  if (yych <= '/') goto yy18;",
          "655:  if (yych >= ';') goto yy18;",
          "",
          "[Added Lines]",
          "654:  if (yych != ':') goto yy18;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "802:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "803: }",
          "805: yy25:",
          "806:  yych = *++YYCURSOR;",
          "807:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "804: #line 805 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "803: #line 804 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "833:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "834:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "835: }",
          "837: yy32:",
          "838:  yych = *++YYCURSOR;",
          "839:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "836: #line 837 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "835: #line 836 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "879:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "880: }",
          "882: yy39:",
          "883:  yych = *++YYCURSOR;",
          "884:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "881: #line 882 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "880: #line 881 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "927:  ZVAL_STR(rval, str);",
          "928:  return 1;",
          "929: }",
          "931: yy46:",
          "932:  yych = *++YYCURSOR;",
          "933:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "930: #line 931 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "929: #line 930 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "975:  ZVAL_STRINGL(rval, str, len);",
          "976:  return 1;",
          "977: }",
          "979: yy53:",
          "980:  yych = *++YYCURSOR;",
          "981:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "978: #line 979 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "977: #line 978 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "1072:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1073:  return 1;",
          "1074: }",
          "1076: yy65:",
          "1077:  yych = *++YYCURSOR;",
          "1078:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1075: #line 1076 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1074: #line 1075 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "1148:  return 1;",
          "1149: }",
          "1151: yy76:",
          "1152:  yych = *++YYCURSOR;",
          "1153:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1150: #line 1151 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1149: #line 1150 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "1200:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1201:  return 1;",
          "1202: }",
          "1204: yy83:",
          "1205:  yych = *++YYCURSOR;",
          "1206:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1203: #line 1204 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1202: #line 1203 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "1214:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1215:  return 1;",
          "1216: }",
          "1218: yy87:",
          "1219:  ++YYCURSOR;",
          "1220: #line 573 \"ext/standard/var_unserializer.re\"",
          "",
          "[Removed Lines]",
          "1217: #line 1218 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1216: #line 1217 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "1223:  ZVAL_NULL(rval);",
          "1224:  return 1;",
          "1225: }",
          "1227: yy89:",
          "1228:  yych = *++YYCURSOR;",
          "1229:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1226: #line 1227 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1225: #line 1226 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "1272:  return 1;",
          "1273: }",
          "1275: yy95:",
          "1276:  yych = *++YYCURSOR;",
          "1277:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1274: #line 1275 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1273: #line 1274 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1321:  return 1;",
          "1322: }",
          "1324: }",
          "1325: #line 875 \"ext/standard/var_unserializer.re\"",
          "",
          "[Removed Lines]",
          "1323: #line 1324 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1322: #line 1323 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "42: {",
          "43:  var_entries *var_hash = (*var_hashx)->last;",
          "44: #if VAR_ENTRIES_DBG",
          "46: #endif",
          "48:  if (!var_hash || var_hash->used_slots == VAR_ENTRIES_MAX) {",
          "",
          "[Removed Lines]",
          "45:  fprintf(stderr, \"var_push(%ld): %d\\n\", var_hash?var_hash->used_slots:-1L, Z_TYPE_PP(rval));",
          "",
          "[Added Lines]",
          "45:  fprintf(stderr, \"var_push(%ld): %d\\n\", var_hash?var_hash->used_slots:-1L, Z_TYPE_P(rval));",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "102:  zend_long i;",
          "103:  var_entries *var_hash = (*var_hashx)->first;",
          "104: #if VAR_ENTRIES_DBG",
          "106: #endif",
          "108:  while (var_hash) {",
          "",
          "[Removed Lines]",
          "105:  fprintf(stderr, \"var_replace(%ld): %d\\n\", var_hash?var_hash->used_slots:-1L, Z_TYPE_PP(nzval));",
          "",
          "[Added Lines]",
          "105:  fprintf(stderr, \"var_replace(%ld): %d\\n\", var_hash?var_hash->used_slots:-1L, Z_TYPE_P(nzval));",
          "",
          "---------------"
        ],
        "main/php_streams.h||main/php_streams.h": [
          "File: main/php_streams.h -> main/php_streams.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "568: #define php_stream_open_wrapper(path, mode, options, opened) _php_stream_open_wrapper_ex((path), (mode), (options), (opened), NULL STREAMS_CC)",
          "569: #define php_stream_open_wrapper_ex(path, mode, options, opened, context) _php_stream_open_wrapper_ex((path), (mode), (options), (opened), (context) STREAMS_CC)",
          "578: PHPAPI void php_stream_wrapper_log_error(php_stream_wrapper *wrapper, int options, const char *fmt, ...) PHP_ATTRIBUTE_FORMAT(printf, 3, 4);",
          "",
          "[Removed Lines]",
          "571: #define php_stream_get_from_zval(stream, zstream, mode, options, opened, context) \\",
          "572:   if (Z_TYPE_PP((zstream)) == IS_RESOURCE) { \\",
          "573:    php_stream_from_zval((stream), (zstream)); \\",
          "574:   } else (stream) = Z_TYPE_PP((zstream)) == IS_STRING ?  \\",
          "575:    php_stream_open_wrapper_ex(Z_STRVAL_PP((zstream)), (mode), (options), (opened), (context)) : NULL",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "sapi/phpdbg/phpdbg_wait.c||sapi/phpdbg/phpdbg_wait.c": [
          "File: sapi/phpdbg/phpdbg_wait.c -> sapi/phpdbg/phpdbg_wait.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "281:     pefree(elm, zend_extensions.persistent);",
          "282:     zend_extensions.count--;",
          "283:    } else {",
          "289:     zend_hash_del(Z_ARRVAL_P(zvp), strkey);",
          "290:    }",
          "291:   }",
          "",
          "[Removed Lines]",
          "285:     if (Z_TYPE(key) == IS_LONG) {",
          "286:      zend_hash_index_del(Z_ARRVAL_PP(zvpp), Z_LVAL(key));",
          "287:     }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "c1cfd6a9fe23765191ea2f654790c7b127d4b797",
      "candidate_info": {
        "commit_hash": "c1cfd6a9fe23765191ea2f654790c7b127d4b797",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/c1cfd6a9fe23765191ea2f654790c7b127d4b797",
        "files": [
          "ext/standard/tests/strings/bug72663.phpt",
          "ext/standard/tests/strings/bug72663_2.phpt",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Fix bug #72663 - destroy broken object when unserializing",
        "before_after_code_files": [
          "ext/standard/tests/strings/bug72663.phpt||ext/standard/tests/strings/bug72663.phpt",
          "ext/standard/tests/strings/bug72663_2.phpt||ext/standard/tests/strings/bug72663_2.phpt",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/tests/strings/bug72663.phpt||ext/standard/tests/strings/bug72663.phpt",
            "ext/standard/tests/strings/bug72663_2.phpt||ext/standard/tests/strings/bug72663_2.phpt",
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c"
          ],
          "candidate": [
            "ext/standard/tests/strings/bug72663.phpt||ext/standard/tests/strings/bug72663.phpt",
            "ext/standard/tests/strings/bug72663_2.phpt||ext/standard/tests/strings/bug72663_2.phpt",
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/tests/strings/bug72663.phpt||ext/standard/tests/strings/bug72663.phpt": [
          "File: ext/standard/tests/strings/bug72663.phpt -> ext/standard/tests/strings/bug72663.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #72663: Create an Unexpected Object and Don't Invoke __wakeup() in Deserialization",
          "3: --FILE--",
          "4: <?php",
          "5: class obj implements Serializable {",
          "6:     var $data;",
          "7:     function serialize() {",
          "8:         return serialize($this->data);",
          "9:     }",
          "10:     function unserialize($data) {",
          "11:         $this->data = unserialize($data);",
          "12:     }",
          "13: }",
          "15: $inner = 'a:1:{i:0;O:9:\"Exception\":2:{s:7:\"'.\"\\0\".'*'.\"\\0\".'file\";R:4;}';",
          "16: $exploit = 'a:2:{i:0;C:3:\"obj\":'.strlen($inner).':{'.$inner.'}i:1;R:4;}';",
          "18: $data = unserialize($exploit);",
          "19: echo $data[1];",
          "20: ?>",
          "21: DONE",
          "22: --EXPECTF--",
          "23: Notice: unserialize(): Unexpected end of serialized data in %sbug72663.php on line %d",
          "25: Notice: unserialize(): Error at offset 46 of 47 bytes in %sbug72663.php on line %d",
          "26: DONE",
          "",
          "---------------"
        ],
        "ext/standard/tests/strings/bug72663_2.phpt||ext/standard/tests/strings/bug72663_2.phpt": [
          "File: ext/standard/tests/strings/bug72663_2.phpt -> ext/standard/tests/strings/bug72663_2.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #72663: Create an Unexpected Object and Don't Invoke __wakeup() in Deserialization",
          "3: --FILE--",
          "4: <?php",
          "6: ini_set('session.serialize_handler', 'php_serialize');",
          "7: session_start();",
          "8: $sess = 'O:9:\"Exception\":2:{s:7:\"'.\"\\0\".'*'.\"\\0\".'file\";R:1;}';",
          "9: session_decode($sess);",
          "10: var_dump($_SESSION);",
          "11: ?>",
          "12: DONE",
          "13: --EXPECTF--",
          "14: Notice: session_decode(): Unexpected end of serialized data in %sbug72663_2.php on line %d",
          "15: array(0) {",
          "16: }",
          "17: DONE",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "434:  }",
          "436:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_OBJPROP_PP(rval), elements, 1)) {",
          "437:   return 0;",
          "438:  }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "438:      zend_hash_clean(Z_OBJPROP_PP(rval));",
          "439:      ZVAL_NULL(*rval);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "486: {",
          "487:  YYCTYPE yych;",
          "488:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "485: #line 486 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "488: #line 489 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "542:  yych = *(YYMARKER = ++YYCURSOR);",
          "543:  if (yych == ':') goto yy95;",
          "544: yy3:",
          "546:  { return 0; }",
          "548: yy4:",
          "549:  yych = *(YYMARKER = ++YYCURSOR);",
          "550:  if (yych == ':') goto yy89;",
          "",
          "[Removed Lines]",
          "545: #line 851 \"ext/standard/var_unserializer.re\"",
          "547: #line 548 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "548: #line 854 \"ext/standard/var_unserializer.re\"",
          "550: #line 551 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "587:  goto yy3;",
          "588: yy14:",
          "589:  ++YYCURSOR;",
          "591:  {",
          "593:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
          "595: }",
          "597: yy16:",
          "598:  yych = *++YYCURSOR;",
          "599:  goto yy3;",
          "",
          "[Removed Lines]",
          "590: #line 845 \"ext/standard/var_unserializer.re\"",
          "596: #line 597 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "593: #line 848 \"ext/standard/var_unserializer.re\"",
          "599: #line 600 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "619:  if (yybm[0+yych] & 128) {",
          "620:   goto yy20;",
          "621:  }",
          "623:  yych = *++YYCURSOR;",
          "624:  if (yych != '\"') goto yy18;",
          "625:  ++YYCURSOR;",
          "627:  {",
          "628:  size_t len, len2, len3, maxlen;",
          "629:  long elements;",
          "",
          "[Removed Lines]",
          "622:  if (yych != ':') goto yy18;",
          "626: #line 698 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "625:  if (yych <= '/') goto yy18;",
          "626:  if (yych >= ';') goto yy18;",
          "630: #line 701 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "771:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "772: }",
          "774: yy25:",
          "775:  yych = *++YYCURSOR;",
          "776:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "773: #line 774 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "777: #line 778 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "795:  yych = *++YYCURSOR;",
          "796:  if (yych != '\"') goto yy18;",
          "797:  ++YYCURSOR;",
          "799:  {",
          "800:     if (!var_hash) return 0;",
          "",
          "[Removed Lines]",
          "798: #line 689 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "802: #line 692 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "804:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "805:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "806: }",
          "808: yy32:",
          "809:  yych = *++YYCURSOR;",
          "810:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "807: #line 808 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "811: #line 812 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "825:  yych = *++YYCURSOR;",
          "826:  if (yych != '{') goto yy18;",
          "827:  ++YYCURSOR;",
          "829:  {",
          "830:  long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "828: #line 668 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "832: #line 671 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "847:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "848: }",
          "850: yy39:",
          "851:  yych = *++YYCURSOR;",
          "852:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "849: #line 850 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "853: #line 854 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "867:  yych = *++YYCURSOR;",
          "868:  if (yych != '\"') goto yy18;",
          "869:  ++YYCURSOR;",
          "871:  {",
          "872:  size_t len, maxlen;",
          "873:  char *str;",
          "",
          "[Removed Lines]",
          "870: #line 633 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "874: #line 636 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "902:  ZVAL_STRINGL(*rval, str, len, 0);",
          "903:  return 1;",
          "904: }",
          "906: yy46:",
          "907:  yych = *++YYCURSOR;",
          "908:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "905: #line 906 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "909: #line 910 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "923:  yych = *++YYCURSOR;",
          "924:  if (yych != '\"') goto yy18;",
          "925:  ++YYCURSOR;",
          "927:  {",
          "928:  size_t len, maxlen;",
          "929:  char *str;",
          "",
          "[Removed Lines]",
          "926: #line 600 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "930: #line 603 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "956:  ZVAL_STRINGL(*rval, str, len, 1);",
          "957:  return 1;",
          "958: }",
          "960: yy53:",
          "961:  yych = *++YYCURSOR;",
          "962:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "959: #line 960 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "963: #line 964 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1044:  }",
          "1045: yy63:",
          "1046:  ++YYCURSOR;",
          "1048:  {",
          "1049: #if SIZEOF_LONG == 4",
          "1050: use_double:",
          "",
          "[Removed Lines]",
          "1047: #line 590 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1051: #line 593 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1054:  ZVAL_DOUBLE(*rval, zend_strtod((const char *)start + 2, NULL));",
          "1055:  return 1;",
          "1056: }",
          "1058: yy65:",
          "1059:  yych = *++YYCURSOR;",
          "1060:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1057: #line 1058 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1061: #line 1062 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1113:  yych = *++YYCURSOR;",
          "1114:  if (yych != ';') goto yy18;",
          "1115:  ++YYCURSOR;",
          "1117:  {",
          "1119:  INIT_PZVAL(*rval);",
          "",
          "[Removed Lines]",
          "1116: #line 575 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1120: #line 578 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "1129:  return 1;",
          "1130: }",
          "1132: yy76:",
          "1133:  yych = *++YYCURSOR;",
          "1134:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1131: #line 1132 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1135: #line 1136 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1155:  if (yych <= '9') goto yy79;",
          "1156:  if (yych != ';') goto yy18;",
          "1157:  ++YYCURSOR;",
          "1159:  {",
          "1160: #if SIZEOF_LONG == 4",
          "1161:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1158: #line 548 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1162: #line 551 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1182:  ZVAL_LONG(*rval, parse_iv(start + 2));",
          "1183:  return 1;",
          "1184: }",
          "1186: yy83:",
          "1187:  yych = *++YYCURSOR;",
          "1188:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1185: #line 1186 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1189: #line 1190 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "1190:  yych = *++YYCURSOR;",
          "1191:  if (yych != ';') goto yy18;",
          "1192:  ++YYCURSOR;",
          "1194:  {",
          "1196:  INIT_PZVAL(*rval);",
          "1197:  ZVAL_BOOL(*rval, parse_iv(start + 2));",
          "1198:  return 1;",
          "1199: }",
          "1201: yy87:",
          "1202:  ++YYCURSOR;",
          "1204:  {",
          "1206:  INIT_PZVAL(*rval);",
          "1207:  ZVAL_NULL(*rval);",
          "1208:  return 1;",
          "1209: }",
          "1211: yy89:",
          "1212:  yych = *++YYCURSOR;",
          "1213:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1193: #line 541 \"ext/standard/var_unserializer.re\"",
          "1200: #line 1201 \"ext/standard/var_unserializer.c\"",
          "1203: #line 534 \"ext/standard/var_unserializer.re\"",
          "1210: #line 1211 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1197: #line 544 \"ext/standard/var_unserializer.re\"",
          "1204: #line 1205 \"ext/standard/var_unserializer.c\"",
          "1207: #line 537 \"ext/standard/var_unserializer.re\"",
          "1214: #line 1215 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "1230:  if (yych <= '9') goto yy91;",
          "1231:  if (yych != ';') goto yy18;",
          "1232:  ++YYCURSOR;",
          "1234:  {",
          "1235:  long id;",
          "",
          "[Removed Lines]",
          "1233: #line 511 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1237: #line 514 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "1254:  return 1;",
          "1255: }",
          "1257: yy95:",
          "1258:  yych = *++YYCURSOR;",
          "1259:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1256: #line 1257 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1260: #line 1261 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "1276:  if (yych <= '9') goto yy97;",
          "1277:  if (yych != ';') goto yy18;",
          "1278:  ++YYCURSOR;",
          "1280:  {",
          "1281:  long id;",
          "",
          "[Removed Lines]",
          "1279: #line 490 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1283: #line 493 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 25 ---",
          "[Context before]",
          "1298:  return 1;",
          "1299: }",
          "1301: }",
          "1305:  return 0;",
          "",
          "[Removed Lines]",
          "1300: #line 1301 \"ext/standard/var_unserializer.c\"",
          "1302: #line 853 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1304: #line 1305 \"ext/standard/var_unserializer.c\"",
          "1306: #line 856 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "438:  }",
          "440:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_OBJPROP_PP(rval), elements, 1)) {",
          "441:   return 0;",
          "442:  }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "442:      zend_hash_clean(Z_OBJPROP_PP(rval));",
          "443:      ZVAL_NULL(*rval);",
          "",
          "---------------"
        ]
      }
    }
  ]
}