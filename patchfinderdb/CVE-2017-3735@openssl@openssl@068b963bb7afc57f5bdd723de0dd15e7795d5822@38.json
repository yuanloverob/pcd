{
  "cve_id": "CVE-2017-3735",
  "cve_desc": "While parsing an IPAddressFamily extension in an X.509 certificate, it is possible to do a one-byte overread. This would result in an incorrect text display of the certificate. This bug has been present since 2006 and is present in all versions of OpenSSL before 1.0.2m and 1.1.0g.",
  "repo": "openssl/openssl",
  "patch_hash": "068b963bb7afc57f5bdd723de0dd15e7795d5822",
  "patch_info": {
    "commit_hash": "068b963bb7afc57f5bdd723de0dd15e7795d5822",
    "repo": "openssl/openssl",
    "commit_url": "https://github.com/openssl/openssl/commit/068b963bb7afc57f5bdd723de0dd15e7795d5822",
    "files": [
      "crypto/x509v3/v3_addr.c"
    ],
    "message": "Avoid out-of-bounds read\n\nFixes CVE 2017-3735\n\nReviewed-by: Kurt Roeckx <kurt@roeckx.be>\n(Merged from https://github.com/openssl/openssl/pull/4276)\n\n(cherry picked from commit b23171744b01e473ebbfd6edad70c1c3825ffbcd)",
    "before_after_code_files": [
      "crypto/x509v3/v3_addr.c||crypto/x509v3/v3_addr.c"
    ]
  },
  "patch_diff": {
    "crypto/x509v3/v3_addr.c||crypto/x509v3/v3_addr.c": [
      "File: crypto/x509v3/v3_addr.c -> crypto/x509v3/v3_addr.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "85: unsigned int X509v3_addr_get_afi(const IPAddressFamily *f)",
      "86: {",
      "91: }",
      "",
      "[Removed Lines]",
      "87:     return ((f != NULL &&",
      "88:              f->addressFamily != NULL && f->addressFamily->data != NULL)",
      "89:             ? ((f->addressFamily->data[0] << 8) | (f->addressFamily->data[1]))",
      "90:             : 0);",
      "",
      "[Added Lines]",
      "87:     if (f == NULL",
      "88:             || f->addressFamily == NULL",
      "89:             || f->addressFamily->data == NULL",
      "90:             || f->addressFamily->length < 2)",
      "91:         return 0;",
      "92:     return (f->addressFamily->data[0] << 8) | f->addressFamily->data[1];",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "51ab051ba62a1ceabb2724d69b2d4c954c697f89",
      "candidate_info": {
        "commit_hash": "51ab051ba62a1ceabb2724d69b2d4c954c697f89",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/51ab051ba62a1ceabb2724d69b2d4c954c697f89",
        "files": [
          "crypto/ct/ct_x509v3.c"
        ],
        "message": "[1.1.0 backport] set entry type on SCTs from X.509 and OCSP extensions\n\nReviewed-by: Matt Caswell <matt@openssl.org>\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/3519)",
        "before_after_code_files": [
          "crypto/ct/ct_x509v3.c||crypto/ct/ct_x509v3.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "crypto/ct/ct_x509v3.c||crypto/ct/ct_x509v3.c": [
          "File: crypto/ct/ct_x509v3.c -> crypto/ct/ct_x509v3.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "30:     return 1;",
          "31: }",
          "34: const X509V3_EXT_METHOD v3_ct_scts[3] = {",
          "36:     { NID_ct_precert_scts, 0, NULL,",
          "37:     NULL, (X509V3_EXT_FREE)SCT_LIST_free,",
          "39:     NULL, NULL,",
          "40:     NULL, NULL,",
          "41:     (X509V3_EXT_I2R)i2r_SCT_LIST, NULL,",
          "",
          "[Removed Lines]",
          "38:     (X509V3_EXT_D2I)d2i_SCT_LIST, (X509V3_EXT_I2D)i2d_SCT_LIST,",
          "",
          "[Added Lines]",
          "33: static int set_sct_list_source(STACK_OF(SCT) *s, sct_source_t source)",
          "34: {",
          "35:     if (s != NULL) {",
          "36:         int i;",
          "38:         for (i = 0; i < sk_SCT_num(s); i++) {",
          "39:             int res = SCT_set_source(sk_SCT_value(s, i), source);",
          "41:             if (res != 1) {",
          "42:                 return 0;",
          "43:             }",
          "44:         }",
          "45:     }",
          "46:     return 1;",
          "47: }",
          "49: static STACK_OF(SCT) *x509_ext_d2i_SCT_LIST(STACK_OF(SCT) **a,",
          "50:                                             const unsigned char **pp,",
          "51:                                             long len)",
          "52: {",
          "53:      STACK_OF(SCT) *s = d2i_SCT_LIST(a, pp, len);",
          "55:      if (set_sct_list_source(s, SCT_SOURCE_X509V3_EXTENSION) != 1) {",
          "56:          SCT_LIST_free(s);",
          "58:          return NULL;",
          "59:      }",
          "60:      return s;",
          "61: }",
          "63: static STACK_OF(SCT) *ocsp_ext_d2i_SCT_LIST(STACK_OF(SCT) **a,",
          "64:                                             const unsigned char **pp,",
          "65:                                             long len)",
          "66: {",
          "67:     STACK_OF(SCT) *s = d2i_SCT_LIST(a, pp, len);",
          "69:     if (set_sct_list_source(s, SCT_SOURCE_OCSP_STAPLED_RESPONSE) != 1) {",
          "70:         SCT_LIST_free(s);",
          "72:         return NULL;",
          "73:     }",
          "74:     return s;",
          "75: }",
          "82:     (X509V3_EXT_D2I)x509_ext_d2i_SCT_LIST, (X509V3_EXT_I2D)i2d_SCT_LIST,",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "53:     { NID_ct_cert_scts, 0, NULL,",
          "54:     0, (X509V3_EXT_FREE)SCT_LIST_free,",
          "56:     NULL, NULL,",
          "57:     NULL, NULL,",
          "58:     (X509V3_EXT_I2R)i2r_SCT_LIST, NULL,",
          "",
          "[Removed Lines]",
          "55:     (X509V3_EXT_D2I)d2i_SCT_LIST, (X509V3_EXT_I2D)i2d_SCT_LIST,",
          "",
          "[Added Lines]",
          "99:     (X509V3_EXT_D2I)ocsp_ext_d2i_SCT_LIST, (X509V3_EXT_I2D)i2d_SCT_LIST,",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "f389bb691130c5e393d9b35fa5961cceda00093f",
      "candidate_info": {
        "commit_hash": "f389bb691130c5e393d9b35fa5961cceda00093f",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/f389bb691130c5e393d9b35fa5961cceda00093f",
        "files": [
          "Configurations/windows-makefile.tmpl"
        ],
        "message": "Windows: rearrange programs cleanup\n\nThe list of programs hit nmake's maximum line length, so we split up the\nline in smaller chunks.\n\nFixes #3634\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/3636)\n(cherry picked from commit edef840f23b31066df4333995f544ae0f32d3e09)",
        "before_after_code_files": [
          "Configurations/windows-makefile.tmpl||Configurations/windows-makefile.tmpl"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "Configurations/windows-makefile.tmpl||Configurations/windows-makefile.tmpl": [
          "File: Configurations/windows-makefile.tmpl -> Configurations/windows-makefile.tmpl",
          "--- Hunk 1 ---",
          "[Context before]",
          "72: SHLIBPDBS={- join(\" \", map { local $shlibext = \".pdb\"; shlib($_) } @{$unified_info{libraries}}) -}",
          "73: ENGINES={- join(\" \", map { dso($_) } @{$unified_info{engines}}) -}",
          "74: ENGINEPDBS={- join(\" \", map { local $dsoext = \".pdb\"; dso($_) } @{$unified_info{engines}}) -}",
          "76: PROGRAMPDBS={- join(\" \", map { $_.\".pdb\" } @{$unified_info{programs}}) -}",
          "77: SCRIPTS={- join(\" \", @{$unified_info{scripts}}) -}",
          "78: {- output_off() if $disabled{makedepend}; \"\" -}",
          "",
          "[Removed Lines]",
          "75: PROGRAMS={- join(\" \", map { $_.$exeext } @{$unified_info{programs}}) -}",
          "",
          "[Added Lines]",
          "75: PROGRAMS={- our @PROGRAMS = map { $_.$exeext } @{$unified_info{programs}}; join(\" \", @PROGRAMS) -}",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "229:  -del /Q ossl_static.pdb",
          "231: clean: libclean",
          "233:  -del /Q /F $(GENERATED)",
          "234:  -del /Q /S /F *.d",
          "235:  -del /Q /S /F *.obj",
          "",
          "[Removed Lines]",
          "232:  -del /Q /F $(PROGRAMS) $(ENGINES) $(SCRIPTS)",
          "",
          "[Added Lines]",
          "232:  {- join(\"\\n\\t\", map { \"-del /Q /F $_\" } @PROGRAMS) -}",
          "233:  -del /Q /F $(ENGINES)",
          "234:  -del /Q /F $(SCRIPTS)",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "738a9dd53cacce593cd7d67e18e1273549640a79",
      "candidate_info": {
        "commit_hash": "738a9dd53cacce593cd7d67e18e1273549640a79",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/738a9dd53cacce593cd7d67e18e1273549640a79",
        "files": [
          "crypto/x86_64cpuid.pl"
        ],
        "message": "x86_64 assembly pack: \"optimize\" for Knights Landing.\n\n\"Optimize\" is in quotes because it's rather a \"salvage operation\"\nfor now. Idea is to identify processor capability flags that\ndrive Knights Landing to suboptimial code paths and mask them.\nTwo flags were identified, XSAVE and ADCX/ADOX. Former affects\nchoice of AES-NI code path specific for Silvermont (Knights Landing\nis of Silvermont \"ancestry\"). And 64-bit ADCX/ADOX instructions are\neffectively mishandled at decode time. In both cases we are looking\nat ~2x improvement.\n\nHardware used for benchmarking courtesy of Atos, experiments run by\nRomain Dolbeau <romain.dolbeau@atos.net>. Kudos!\n\nThis is minimalistic backpoint of 64d92d74985ebb3d0be58a9718f9e080a14a8e7f\n\nThanks to David Benjamin for spotting typo in Knights Landing detection!\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/4006)",
        "before_after_code_files": [
          "crypto/x86_64cpuid.pl||crypto/x86_64cpuid.pl"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "crypto/x86_64cpuid.pl||crypto/x86_64cpuid.pl": [
          "File: crypto/x86_64cpuid.pl -> crypto/x86_64cpuid.pl",
          "--- Hunk 1 ---",
          "[Context before]",
          "143:  or \\$0x40000000,%edx # set reserved bit#30 on Intel CPUs",
          "144:  and \\$15,%ah",
          "145:  cmp \\$15,%ah  # examine Family ID",
          "147:  or \\$0x00100000,%edx # set reserved bit#20 to engage RC4_CHAR",
          "148: .Lnotintel:",
          "149:  bt \\$28,%edx  # test hyper-threading bit",
          "150:  jnc .Lgeneric",
          "",
          "[Removed Lines]",
          "146:  jne .Lnotintel",
          "",
          "[Added Lines]",
          "146:  jne .LnotP4",
          "148: .LnotP4:",
          "149:  cmp \\$6,%ah",
          "150:  jne .Lnotintel",
          "151:  and \\$0x0fff0ff0,%eax",
          "152:  cmp \\$0x00050670,%eax # Knights Landing",
          "153:  je .Lknights",
          "154:  cmp \\$0x00080650,%eax # Knights Mill (according to sde)",
          "155:  jne .Lnotintel",
          "156: .Lknights:",
          "157:  and \\$0xfbffffff,%ecx # clear XSAVE flag to mimic Silvermont",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "169:  mov \\$7,%eax",
          "170:  xor %ecx,%ecx",
          "171:  cpuid",
          "172:  mov %ebx,8(%rdi)  # save extended feature flags",
          "173: .Lno_extended_info:",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "183:  bt \\$26,%r9d  # check XSAVE bit, cleared on Knights",
          "184:  jc .Lnotknights",
          "185:  and \\$0xfff7ffff,%ebx # clear ADCX/ADOX flag",
          "186: .Lnotknights:",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "ae386c988c79119f7ae24740e3d388858c73da3f",
      "candidate_info": {
        "commit_hash": "ae386c988c79119f7ae24740e3d388858c73da3f",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/ae386c988c79119f7ae24740e3d388858c73da3f",
        "files": [
          "apps/s_server.c"
        ],
        "message": "Reenable s_server -dhparam option\n\nThis option was lost when converting to a table-driven option parser\nin commit 7e1b7485706c2b11091b5fa897fe496a2faa56cc.\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/4398)\n\n(cherry picked from commit 51ac82702dc91cabd3dbf890d8f65b285282c0ce)",
        "before_after_code_files": [
          "apps/s_server.c||apps/s_server.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "apps/s_server.c||apps/s_server.c": [
          "File: apps/s_server.c -> apps/s_server.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "711:     {\"pass\", OPT_PASS, 's', \"Private key file pass phrase source\"},",
          "712:     {\"dcert\", OPT_DCERT, '<',",
          "713:      \"Second certificate file to use (usually for DSA)\"},",
          "714:     {\"dcertform\", OPT_DCERTFORM, 'F',",
          "715:      \"Second certificate format (PEM or DER) PEM default\"},",
          "716:     {\"dkey\", OPT_DKEY, '<',",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "714:     {\"dhparam\", OPT_DHPARAM, '<', \"DH parameters file to use\"},",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "baa5d0ed2c907ceb3890f055e73f01ef2b2353ee",
      "candidate_info": {
        "commit_hash": "baa5d0ed2c907ceb3890f055e73f01ef2b2353ee",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/baa5d0ed2c907ceb3890f055e73f01ef2b2353ee",
        "files": [
          "util/perl/TLSProxy/Proxy.pm"
        ],
        "message": "Extend timeout for TLSProxy\n\nI received this error from a TLSProxy test:\n\nFailed to start up server (localhost,4443): Transport endpoint is not\nconnected\n\nSo, extend the timeout before we give up trying to connect to the server.\n\nReviewed-by: Richard Levitte <levitte@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/5088)\n\n(cherry picked from commit 82992a4130e668c14ff66fca26170629b23c4556)",
        "before_after_code_files": [
          "util/perl/TLSProxy/Proxy.pm||util/perl/TLSProxy/Proxy.pm"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "util/perl/TLSProxy/Proxy.pm||util/perl/TLSProxy/Proxy.pm": [
          "File: util/perl/TLSProxy/Proxy.pm -> util/perl/TLSProxy/Proxy.pm",
          "--- Hunk 1 ---",
          "[Context before]",
          "241:     print \"Connection opened\\n\";",
          "243:     # Now connect to the server",
          "245:     my $server_sock;",
          "246:     #We loop over this a few times because sometimes s_server can take a while",
          "247:     #to start up",
          "",
          "[Removed Lines]",
          "244:     my $retry = 10;",
          "",
          "[Added Lines]",
          "244:     my $retry = 50;",
          "",
          "---------------"
        ]
      }
    }
  ]
}