{
  "cve_id": "CVE-2013-1415",
  "cve_desc": "The pkinit_check_kdc_pkid function in plugins/preauth/pkinit/pkinit_crypto_openssl.c in the PKINIT implementation in the Key Distribution Center (KDC) in MIT Kerberos 5 (aka krb5) before 1.10.4 and 1.11.x before 1.11.1 does not properly handle errors during extraction of fields from an X.509 certificate, which allows remote attackers to cause a denial of service (NULL pointer dereference and daemon crash) via a malformed KRB5_PADATA_PK_AS_REQ AS-REQ request.",
  "repo": "krb5/krb5",
  "patch_hash": "f249555301940c6df3a2cdda13b56b5674eebc2e",
  "patch_info": {
    "commit_hash": "f249555301940c6df3a2cdda13b56b5674eebc2e",
    "repo": "krb5/krb5",
    "commit_url": "https://github.com/krb5/krb5/commit/f249555301940c6df3a2cdda13b56b5674eebc2e",
    "files": [
      "src/plugins/preauth/pkinit/pkinit_crypto_openssl.c"
    ],
    "message": "PKINIT null pointer deref [CVE-2013-1415]\n\nDon't dereference a null pointer when cleaning up.\n\nThe KDC plugin for PKINIT can dereference a null pointer when a\nmalformed packet causes processing to terminate early, leading to\na crash of the KDC process.  An attacker would need to have a valid\nPKINIT certificate or have observed a successful PKINIT authentication,\nor an unauthenticated attacker could execute the attack if anonymous\nPKINIT is enabled.\n\nCVSSv2 vector: AV:N/AC:M/Au:N/C:N/I:N/A:C/E:P/RL:O/RC:C\n\nThis is a minimal commit for pullup; style fixes in a followup.\n[kaduk@mit.edu: reformat and edit commit message]\n\n(cherry picked from commit c773d3c775e9b2d88bcdff5f8a8ba88d7ec4e8ed)\n\nticket: 7570\nversion_fixed: 1.11.1\nstatus: resolved",
    "before_after_code_files": [
      "src/plugins/preauth/pkinit/pkinit_crypto_openssl.c||src/plugins/preauth/pkinit/pkinit_crypto_openssl.c"
    ]
  },
  "patch_diff": {
    "src/plugins/preauth/pkinit/pkinit_crypto_openssl.c||src/plugins/preauth/pkinit/pkinit_crypto_openssl.c": [
      "File: src/plugins/preauth/pkinit/pkinit_crypto_openssl.c -> src/plugins/preauth/pkinit/pkinit_crypto_openssl.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "3253:     pkiDebug(\"found kdcPkId in AS REQ\\n\");",
      "3254:     is = d2i_PKCS7_ISSUER_AND_SERIAL(NULL, &p, (int)pkid_len);",
      "3255:     if (is == NULL)",
      "3258:     status = X509_NAME_cmp(X509_get_issuer_name(kdc_cert), is->issuer);",
      "3259:     if (!status) {",
      "",
      "[Removed Lines]",
      "3256:         goto cleanup;",
      "",
      "[Added Lines]",
      "3256:         return retval;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "3263:     }",
      "3265:     retval = 0;",
      "3267:     X509_NAME_free(is->issuer);",
      "3268:     ASN1_INTEGER_free(is->serial);",
      "3269:     free(is);",
      "",
      "[Removed Lines]",
      "3266: cleanup:",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "dfa3dbb2f5c6d7d32d97c179f6c34e0dbb554111",
      "candidate_info": {
        "commit_hash": "dfa3dbb2f5c6d7d32d97c179f6c34e0dbb554111",
        "repo": "krb5/krb5",
        "commit_url": "https://github.com/krb5/krb5/commit/dfa3dbb2f5c6d7d32d97c179f6c34e0dbb554111",
        "files": [
          "src/plugins/preauth/pkinit/pkinit_crypto_openssl.c"
        ],
        "message": "PKINIT null pointer deref [CVE-2013-1415]\n\nDon't dereference a null pointer when cleaning up.\n\nThe KDC plugin for PKINIT can dereference a null pointer when a\nmalformed packet causes processing to terminate early, leading to\na crash of the KDC process.  An attacker would need to have a valid\nPKINIT certificate or have observed a successful PKINIT authentication,\nor an unauthenticated attacker could execute the attack if anonymous\nPKINIT is enabled.\n\nCVSSv2 vector: AV:N/AC:M/Au:N/C:N/I:N/A:C/E:P/RL:O/RC:C\n\nThis is a minimal commit for pullup; style fixes in a followup.\n[kaduk@mit.edu: reformat and edit commit message]\n\n(cherry picked from commit c773d3c775e9b2d88bcdff5f8a8ba88d7ec4e8ed)\n\nticket: 7577 (new)\nversion_fixed: 1.10.4\nstatus: resolved",
        "before_after_code_files": [
          "src/plugins/preauth/pkinit/pkinit_crypto_openssl.c||src/plugins/preauth/pkinit/pkinit_crypto_openssl.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "src/plugins/preauth/pkinit/pkinit_crypto_openssl.c||src/plugins/preauth/pkinit/pkinit_crypto_openssl.c"
          ],
          "candidate": [
            "src/plugins/preauth/pkinit/pkinit_crypto_openssl.c||src/plugins/preauth/pkinit/pkinit_crypto_openssl.c"
          ]
        }
      },
      "candidate_diff": {
        "src/plugins/preauth/pkinit/pkinit_crypto_openssl.c||src/plugins/preauth/pkinit/pkinit_crypto_openssl.c": [
          "File: src/plugins/preauth/pkinit/pkinit_crypto_openssl.c -> src/plugins/preauth/pkinit/pkinit_crypto_openssl.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "3249:     pkiDebug(\"found kdcPkId in AS REQ\\n\");",
          "3250:     is = d2i_PKCS7_ISSUER_AND_SERIAL(NULL, &p, (int)pkid_len);",
          "3251:     if (is == NULL)",
          "3254:     status = X509_NAME_cmp(X509_get_issuer_name(kdc_cert), is->issuer);",
          "3255:     if (!status) {",
          "",
          "[Removed Lines]",
          "3252:         goto cleanup;",
          "",
          "[Added Lines]",
          "3252:         return retval;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "3259:     }",
          "3261:     retval = 0;",
          "3263:     X509_NAME_free(is->issuer);",
          "3264:     ASN1_INTEGER_free(is->serial);",
          "3265:     free(is);",
          "",
          "[Removed Lines]",
          "3262: cleanup:",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "6b415d1471adc157eea319592a5fcc1c577876ce",
      "candidate_info": {
        "commit_hash": "6b415d1471adc157eea319592a5fcc1c577876ce",
        "repo": "krb5/krb5",
        "commit_url": "https://github.com/krb5/krb5/commit/6b415d1471adc157eea319592a5fcc1c577876ce",
        "files": [
          "src/plugins/preauth/pkinit/pkinit_crypto_openssl.c"
        ],
        "message": "PKINIT null pointer deref [CVE-2013-1415]\n\nDon't dereference a null pointer when cleaning up.\n\nThe KDC plugin for PKINIT can dereference a null pointer when a\nmalformed packet causes processing to terminate early, leading to\na crash of the KDC process.  An attacker would need to have a valid\nPKINIT certificate or have observed a successful PKINIT authentication,\nor an unauthenticated attacker could execute the attack if anonymous\nPKINIT is enabled.\n\nCVSSv2 vector: AV:N/AC:M/Au:N/C:N/I:N/A:C/E:P/RL:O/RC:C\n\nThis is a minimal commit for pullup; style fixes in a followup.\n[kaduk@mit.edu: reformat and edit commit message]\n\n(cherry picked from commit c773d3c775e9b2d88bcdff5f8a8ba88d7ec4e8ed)\n\nticket: 7619 (new)\nversion_fixed: 1.9.5\nstatus: resolved",
        "before_after_code_files": [
          "src/plugins/preauth/pkinit/pkinit_crypto_openssl.c||src/plugins/preauth/pkinit/pkinit_crypto_openssl.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "src/plugins/preauth/pkinit/pkinit_crypto_openssl.c||src/plugins/preauth/pkinit/pkinit_crypto_openssl.c"
          ],
          "candidate": [
            "src/plugins/preauth/pkinit/pkinit_crypto_openssl.c||src/plugins/preauth/pkinit/pkinit_crypto_openssl.c"
          ]
        }
      },
      "candidate_diff": {
        "src/plugins/preauth/pkinit/pkinit_crypto_openssl.c||src/plugins/preauth/pkinit/pkinit_crypto_openssl.c": [
          "File: src/plugins/preauth/pkinit/pkinit_crypto_openssl.c -> src/plugins/preauth/pkinit/pkinit_crypto_openssl.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2883:     pkiDebug(\"found kdcPkId in AS REQ\\n\");",
          "2884:     is = d2i_PKCS7_ISSUER_AND_SERIAL(NULL, &p, (int)pkid_len);",
          "2885:     if (is == NULL)",
          "2888:     status = X509_NAME_cmp(X509_get_issuer_name(kdc_cert), is->issuer);",
          "2889:     if (!status) {",
          "",
          "[Removed Lines]",
          "2886:         goto cleanup;",
          "",
          "[Added Lines]",
          "2886:         return retval;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2893:     }",
          "2895:     retval = 0;",
          "2897:     X509_NAME_free(is->issuer);",
          "2898:     ASN1_INTEGER_free(is->serial);",
          "2899:     free(is);",
          "",
          "[Removed Lines]",
          "2896: cleanup:",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "c773d3c775e9b2d88bcdff5f8a8ba88d7ec4e8ed",
      "candidate_info": {
        "commit_hash": "c773d3c775e9b2d88bcdff5f8a8ba88d7ec4e8ed",
        "repo": "krb5/krb5",
        "commit_url": "https://github.com/krb5/krb5/commit/c773d3c775e9b2d88bcdff5f8a8ba88d7ec4e8ed",
        "files": [
          "src/plugins/preauth/pkinit/pkinit_crypto_openssl.c"
        ],
        "message": "PKINIT null pointer deref [CVE-2013-1415]\n\nDon't dereference a null pointer when cleaning up.\n\nThe KDC plugin for PKINIT can dereference a null pointer when a\nmalformed packet causes processing to terminate early, leading to\na crash of the KDC process.  An attacker would need to have a valid\nPKINIT certificate or have observed a successful PKINIT authentication,\nor an unauthenticated attacker could execute the attack if anonymous\nPKINIT is enabled.\n\nCVSSv2 vector: AV:N/AC:M/Au:N/C:N/I:N/A:C/E:P/RL:O/RC:C\n\nThis is a minimal commit for pullup; style fixes in a followup.\n[kaduk@mit.edu: reformat and edit commit message]\n\nticket: 7570 (new)\ntarget_version: 1.11.1\ntags: pullup",
        "before_after_code_files": [
          "src/plugins/preauth/pkinit/pkinit_crypto_openssl.c||src/plugins/preauth/pkinit/pkinit_crypto_openssl.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "src/plugins/preauth/pkinit/pkinit_crypto_openssl.c||src/plugins/preauth/pkinit/pkinit_crypto_openssl.c"
          ],
          "candidate": [
            "src/plugins/preauth/pkinit/pkinit_crypto_openssl.c||src/plugins/preauth/pkinit/pkinit_crypto_openssl.c"
          ]
        }
      },
      "candidate_diff": {
        "src/plugins/preauth/pkinit/pkinit_crypto_openssl.c||src/plugins/preauth/pkinit/pkinit_crypto_openssl.c": [
          "File: src/plugins/preauth/pkinit/pkinit_crypto_openssl.c -> src/plugins/preauth/pkinit/pkinit_crypto_openssl.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "3253:     pkiDebug(\"found kdcPkId in AS REQ\\n\");",
          "3254:     is = d2i_PKCS7_ISSUER_AND_SERIAL(NULL, &p, (int)pkid_len);",
          "3255:     if (is == NULL)",
          "3258:     status = X509_NAME_cmp(X509_get_issuer_name(kdc_cert), is->issuer);",
          "3259:     if (!status) {",
          "",
          "[Removed Lines]",
          "3256:         goto cleanup;",
          "",
          "[Added Lines]",
          "3256:         return retval;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "3263:     }",
          "3265:     retval = 0;",
          "3267:     X509_NAME_free(is->issuer);",
          "3268:     ASN1_INTEGER_free(is->serial);",
          "3269:     free(is);",
          "",
          "[Removed Lines]",
          "3266: cleanup:",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    }
  ]
}