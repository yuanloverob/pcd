{
  "cve_id": "CVE-2012-2330",
  "cve_desc": "The Update method in src/node_http_parser.cc in Node.js before 0.6.17 and 0.7 before 0.7.8 does not properly check the length of a string, which allows remote attackers to obtain sensitive information (request header contents) and possibly spoof HTTP headers via a zero length string.",
  "repo": "joyent/node",
  "patch_hash": "c9a231db0e59658be419d926b1dfa17b939ba158",
  "patch_info": {
    "commit_hash": "c9a231db0e59658be419d926b1dfa17b939ba158",
    "repo": "joyent/node",
    "commit_url": "https://github.com/joyent/node/commit/c9a231d",
    "files": [
      "src/node_http_parser.cc"
    ],
    "message": "typo in node_http_parser",
    "before_after_code_files": [
      "src/node_http_parser.cc||src/node_http_parser.cc"
    ]
  },
  "patch_diff": {
    "src/node_http_parser.cc||src/node_http_parser.cc": [
      "File: src/node_http_parser.cc -> src/node_http_parser.cc",
      "--- Hunk 1 ---",
      "[Context before]",
      "191:   void Update(const char* str, size_t size) {",
      "192:     if (str_ == NULL)",
      "193:       str_ = str;",
      "197:       char* s = new char[size_ + size];",
      "",
      "[Removed Lines]",
      "194:     else if (on_heap_ || str_ + size != str) {",
      "",
      "[Added Lines]",
      "194:     else if (on_heap_ || str_ + size_ != str) {",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "70884875c9cc40ef1318d7a929f2de37546c4134",
      "candidate_info": {
        "commit_hash": "70884875c9cc40ef1318d7a929f2de37546c4134",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/70884875c9cc40ef1318d7a929f2de37546c4134",
        "files": [
          "doc/api/child_processes.markdown",
          "lib/child_process.js"
        ],
        "message": "Allow calling fork() without args or options\n\nCloses GH-2424",
        "before_after_code_files": [
          "lib/child_process.js||lichild_process.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "lib/child_process.js||lichild_process.js": [
          "File: lib/child_process.js -> lichild_process.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "161: function nop() { }",
          "168:   args.unshift(modulePath);",
          "170:   if (options.stdinStream) {",
          "171:     throw new Error('stdinStream not allowed for fork()');",
          "172:   }",
          "",
          "[Removed Lines]",
          "164: exports.fork = function(modulePath, args, options) {",
          "165:   if (!options) options = {};",
          "167:   args = args ? args.slice(0) : [];",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "3d1b67064085ef486a69c2fc69d195dc35f4f50c",
      "candidate_info": {
        "commit_hash": "3d1b67064085ef486a69c2fc69d195dc35f4f50c",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/3d1b67064085ef486a69c2fc69d195dc35f4f50c",
        "files": [
          "configure",
          "node.gyp"
        ],
        "message": "build: support shared V8 properly\n\n-don't pull in bundled v8 as a dependency when node_shared_v8==true\n-use node_shared_v8_includes for v8.h and v8-debug.h",
        "before_after_code_files": [
          "node.gyp||node.gyp"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "node.gyp||node.gyp": [
          "File: node.gyp -> node.gyp",
          "--- Hunk 1 ---",
          "[Context before]",
          "55:       'dependencies': [",
          "56:         'deps/http_parser/http_parser.gyp:http_parser',",
          "58:         'deps/uv/uv.gyp:uv',",
          "59:         'deps/zlib/zlib.gyp:zlib',",
          "60:         'node_js2c#host',",
          "",
          "[Removed Lines]",
          "57:         'deps/v8/tools/gyp/v8.gyp:v8',",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "110:         'src/stream_wrap.h',",
          "111:         'src/v8_typed_array.h',",
          "112:         'deps/http_parser/http_parser.h',",
          "115:         '<(SHARED_INTERMEDIATE_DIR)/node_natives.h',",
          "116:         # javascript files to make for an even more pleasant IDE experience",
          "117:         '<@(library_files)',",
          "",
          "[Removed Lines]",
          "113:         'deps/v8/include/v8.h',",
          "114:         'deps/v8/include/v8-debug.h',",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "147:           ],",
          "148:         }],",
          "150:         [ 'OS==\"win\"', {",
          "151:           'sources': [",
          "152:             'tools/msvs/res/node.rc',",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "147:         [ 'node_shared_v8==\"true\"', {",
          "148:           'sources': [",
          "149:             '<(node_shared_v8_includes)/v8.h',",
          "150:             '<(node_shared_v8_includes)/v8-debug.h',",
          "151:           ],",
          "152:         }],",
          "154:         [ 'node_shared_v8==\"false\"', {",
          "155:           'sources': [",
          "156:             'deps/v8/include/v8.h',",
          "157:             'deps/v8/include/v8-debug.h',",
          "158:           ],",
          "159:           'dependencies': [ 'deps/v8/tools/gyp/v8.gyp:v8' ],",
          "160:         }],",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "72cbb7492cb5956c8265b415bd6ff473b7b89f35",
      "candidate_info": {
        "commit_hash": "72cbb7492cb5956c8265b415bd6ff473b7b89f35",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/72cbb7492cb5956c8265b415bd6ff473b7b89f35",
        "files": [
          "src/node_version.h"
        ],
        "message": "Now working on v0.7.1-pre",
        "before_after_code_files": [
          "src/node_version.h||src/node_version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/node_version.h||src/node_version.h": [
          "File: src/node_version.h -> src/node_version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "29: #define NODE_MAJOR_VERSION 0",
          "30: #define NODE_MINOR_VERSION 7",
          "31: #define NODE_PATCH_VERSION 0",
          "34: #ifndef NODE_STRINGIFY",
          "35: #define NODE_STRINGIFY(n) NODE_STRINGIFY_HELPER(n)",
          "",
          "[Removed Lines]",
          "32: #define NODE_VERSION_IS_RELEASE 1",
          "",
          "[Added Lines]",
          "32: #define NODE_VERSION_IS_RELEASE 0",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "b221fe9b29f7dd834af9716e077bc05a05156d64",
      "candidate_info": {
        "commit_hash": "b221fe9b29f7dd834af9716e077bc05a05156d64",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/b221fe9b29f7dd834af9716e077bc05a05156d64",
        "files": [
          "lib/timers.js",
          "test/simple/test-timers-uncaught-exception.js"
        ],
        "message": "timers: add v0.4 compatibility hack\n\nIf a timer callback throws and the user's uncaughtException handler ignores the\nexception, other timers that expire on the current tick should still run.\n\nIf #2582 goes through, this hack should be removed.\n\nFixes #2631.",
        "before_after_code_files": [
          "lib/timers.js||litimers.js",
          "test/simple/test-timers-uncaught-exception.js||test/simple/test-timers-uncaught-exception.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "lib/timers.js||litimers.js": [
          "File: lib/timers.js -> litimers.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "81:         } else {",
          "82:           L.remove(first);",
          "83:           assert(first !== L.peek(list));",
          "85:         }",
          "86:       }",
          "",
          "[Removed Lines]",
          "84:           if (first._onTimeout) first._onTimeout();",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "test/simple/test-timers-uncaught-exception.js||test/simple/test-timers-uncaught-exception.js": [
          "File: test/simple/test-timers-uncaught-exception.js -> test/simple/test-timers-uncaught-exception.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "22: var common = require('../common');",
          "23: var assert = require('assert');",
          "25: var exceptions = 0;",
          "26: var timer1 = 0;",
          "27: var timer2 = 0;",
          "30: setTimeout(function() {",
          "31:   timer1++;",
          "32:   throw new Error('BAM!');",
          "33: }, 100);",
          "36: setTimeout(function() {",
          "37:   assert.equal(timer1, 1);",
          "38:   timer2++;",
          "39: }, 100);",
          "41: function uncaughtException(err) {",
          "42:   assert.equal(err.message, 'BAM!');",
          "43:   exceptions++;",
          "44: }",
          "45: process.on('uncaughtException', uncaughtException);",
          "47: process.on('exit', function() {",
          "48:   process.removeListener('uncaughtException', uncaughtException);",
          "49:   assert.equal(exceptions, 1);",
          "50:   assert.equal(timer1, 1);",
          "51:   assert.equal(timer2, 1);",
          "52: });",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "a58659cd4a6aa8a24b7f5f1062c15aa627b386e5",
      "candidate_info": {
        "commit_hash": "a58659cd4a6aa8a24b7f5f1062c15aa627b386e5",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/a58659cd4a6aa8a24b7f5f1062c15aa627b386e5",
        "files": [
          "src/node_internals.h"
        ],
        "message": "core: add ROUND_UP() macro",
        "before_after_code_files": [
          "src/node_internals.h||src/node_internals.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/node_internals.h||src/node_internals.h": [
          "File: src/node_internals.h -> src/node_internals.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "29: #ifndef offset_of",
          "33:   ((intptr_t) ((char *) &(((type *) 8)->member) - 8))",
          "34: #endif",
          "36: #ifndef container_of",
          "38:   ((type *) ((char *) (ptr) - offset_of(type, member)))",
          "39: #endif",
          "41: #ifndef ARRAY_SIZE",
          "43: #endif",
          "",
          "[Removed Lines]",
          "32: #define offset_of(type, member) \\",
          "37: #define container_of(ptr, type, member) \\",
          "42: #define ARRAY_SIZE(a) (sizeof((a)) / sizeof((a)[0]))",
          "",
          "[Added Lines]",
          "32: # define offset_of(type, member) \\",
          "37: # define container_of(ptr, type, member) \\",
          "42: # define ARRAY_SIZE(a) (sizeof((a)) / sizeof((a)[0]))",
          "43: #endif",
          "45: #ifndef ROUND_UP",
          "46: # define ROUND_UP(a, b) ((a) % (b) ? ((a) + (b)) - ((a) % (b)) : (a))",
          "",
          "---------------"
        ]
      }
    }
  ]
}