{
  "cve_id": "CVE-2016-5361",
  "cve_desc": "programs/pluto/ikev1.c in libreswan before 3.17 retransmits in initial-responder states, which allows remote attackers to cause a denial of service (traffic amplification) via a spoofed UDP packet. NOTE: the original behavior complies with the IKEv1 protocol, but has a required security update from the libreswan vendor; as of 2016-06-10, it is expected that several other IKEv1 implementations will have vendor-required security updates, with separate CVE IDs assigned to each.",
  "repo": "libreswan/libreswan",
  "patch_hash": "152d6d95632d8b9477c170f1de99bcd86d7fb1d6",
  "patch_info": {
    "commit_hash": "152d6d95632d8b9477c170f1de99bcd86d7fb1d6",
    "repo": "libreswan/libreswan",
    "commit_url": "https://github.com/libreswan/libreswan/commit/152d6d95632d8b9477c170f1de99bcd86d7fb1d6",
    "files": [
      "programs/pluto/ikev1.c"
    ],
    "message": "IKEv1: packet retransmit fixes for Main/Aggr/Xauth modes\n\n- Do not schedule retransmits for inI1outR1 packets (prevent DDOS)\n- Do schedule retransmits for XAUTH packets",
    "before_after_code_files": [
      "programs/pluto/ikev1.c||programs/pluto/ikev1.c"
    ]
  },
  "patch_diff": {
    "programs/pluto/ikev1.c||programs/pluto/ikev1.c": [
      "File: programs/pluto/ikev1.c -> programs/pluto/ikev1.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "245:  { STATE_MAIN_R0, STATE_MAIN_R1,",
      "246:    SMF_ALL_AUTH | SMF_REPLY,",
      "247:    P(SA), P(VID) | P(CR), PT(NONE),",
      "",
      "[Removed Lines]",
      "248:    EVENT_v1_RETRANSMIT, main_inI1_outR1 },",
      "",
      "[Added Lines]",
      "248:    EVENT_NULL, main_inI1_outR1 },",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "394:  { STATE_AGGR_R0, STATE_AGGR_R1,",
      "395:    SMF_PSK_AUTH | SMF_DS_AUTH | SMF_REPLY,",
      "396:    P(SA) | P(KE) | P(NONCE) | P(ID), P(VID) | P(NATD_RFC), PT(NONE),",
      "",
      "[Removed Lines]",
      "397:    EVENT_v1_RETRANSMIT, aggr_inI1_outR1 },",
      "",
      "[Added Lines]",
      "397:    EVENT_NULL, aggr_inI1_outR1 },",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "571:  { STATE_XAUTH_I0, STATE_XAUTH_I1,",
      "572:    SMF_ALL_AUTH | SMF_ENCRYPTED | SMF_REPLY | SMF_RELEASE_PENDING_P2,",
      "573:    P(MCFG_ATTR) | P(HASH), P(VID), PT(HASH),",
      "576:  { STATE_XAUTH_I1, STATE_MAIN_I4,",
      "577:    SMF_ALL_AUTH | SMF_ENCRYPTED | SMF_REPLY | SMF_RELEASE_PENDING_P2,",
      "578:    P(MCFG_ATTR) | P(HASH), P(VID), PT(HASH),",
      "581: #undef P",
      "582: #undef PT",
      "",
      "[Removed Lines]",
      "574:    EVENT_SA_REPLACE, xauth_inI0 },",
      "579:    EVENT_SA_REPLACE, xauth_inI1 },",
      "",
      "[Added Lines]",
      "574:    EVENT_v1_RETRANSMIT, xauth_inI0 },",
      "579:    EVENT_v1_RETRANSMIT, xauth_inI1 },",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "7d7d0ea7b40dd3e1bb01732f5be16876a0304208",
      "candidate_info": {
        "commit_hash": "7d7d0ea7b40dd3e1bb01732f5be16876a0304208",
        "repo": "libreswan/libreswan",
        "commit_url": "https://github.com/libreswan/libreswan/commit/7d7d0ea7b40dd3e1bb01732f5be16876a0304208",
        "files": [
          "programs/pluto/ikev1.c"
        ],
        "message": "IKEv1: use EVENT_SA_REPLACE and not EVENT_NULL\n\nThis fixes commit 152d6d95632d hitting an assertion.",
        "before_after_code_files": [
          "programs/pluto/ikev1.c||programs/pluto/ikev1.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "programs/pluto/ikev1.c||programs/pluto/ikev1.c"
          ],
          "candidate": [
            "programs/pluto/ikev1.c||programs/pluto/ikev1.c"
          ]
        }
      },
      "candidate_diff": {
        "programs/pluto/ikev1.c||programs/pluto/ikev1.c": [
          "File: programs/pluto/ikev1.c -> programs/pluto/ikev1.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "245:  { STATE_MAIN_R0, STATE_MAIN_R1,",
          "246:    SMF_ALL_AUTH | SMF_REPLY,",
          "247:    P(SA), P(VID) | P(CR), PT(NONE),",
          "",
          "[Removed Lines]",
          "248:    EVENT_NULL, main_inI1_outR1 },",
          "",
          "[Added Lines]",
          "248:    EVENT_SA_REPLACE, main_inI1_outR1 },",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "394:  { STATE_AGGR_R0, STATE_AGGR_R1,",
          "395:    SMF_PSK_AUTH | SMF_DS_AUTH | SMF_REPLY,",
          "396:    P(SA) | P(KE) | P(NONCE) | P(ID), P(VID) | P(NATD_RFC), PT(NONE),",
          "",
          "[Removed Lines]",
          "397:    EVENT_NULL, aggr_inI1_outR1 },",
          "",
          "[Added Lines]",
          "397:    EVENT_SA_REPLACE, aggr_inI1_outR1 },",
          "",
          "---------------"
        ]
      }
    }
  ]
}