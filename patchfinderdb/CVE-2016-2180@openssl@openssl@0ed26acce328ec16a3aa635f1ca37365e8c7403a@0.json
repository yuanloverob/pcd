{
  "cve_id": "CVE-2016-2180",
  "cve_desc": "The TS_OBJ_print_bio function in crypto/ts/ts_lib.c in the X.509 Public Key Infrastructure Time-Stamp Protocol (TSP) implementation in OpenSSL through 1.0.2h allows remote attackers to cause a denial of service (out-of-bounds read and application crash) via a crafted time-stamp file that is mishandled by the \"openssl ts\" command.",
  "repo": "openssl/openssl",
  "patch_hash": "0ed26acce328ec16a3aa635f1ca37365e8c7403a",
  "patch_info": {
    "commit_hash": "0ed26acce328ec16a3aa635f1ca37365e8c7403a",
    "repo": "openssl/openssl",
    "commit_url": "https://github.com/openssl/openssl/commit/0ed26acce328ec16a3aa635f1ca37365e8c7403a",
    "files": [
      "crypto/ts/ts_lib.c"
    ],
    "message": "Fix OOB read in TS_OBJ_print_bio().\n\nTS_OBJ_print_bio() misuses OBJ_txt2obj: it should print the result\nas a null terminated buffer. The length value returned is the total\nlength the complete text reprsentation would need not the amount of\ndata written.\n\nCVE-2016-2180\n\nThanks to Shi Lei for reporting this bug.\n\nReviewed-by: Matt Caswell <matt@openssl.org>",
    "before_after_code_files": [
      "crypto/ts/ts_lib.c||crypto/ts/ts_lib.c"
    ]
  },
  "patch_diff": {
    "crypto/ts/ts_lib.c||crypto/ts/ts_lib.c": [
      "File: crypto/ts/ts_lib.c -> crypto/ts/ts_lib.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "40: {",
      "41:     char obj_txt[128];",
      "47:     return 1;",
      "48: }",
      "",
      "[Removed Lines]",
      "43:     int len = OBJ_obj2txt(obj_txt, sizeof(obj_txt), obj, 0);",
      "44:     BIO_write(bio, obj_txt, len);",
      "45:     BIO_write(bio, \"\\n\", 1);",
      "",
      "[Added Lines]",
      "43:     OBJ_obj2txt(obj_txt, sizeof(obj_txt), obj, 0);",
      "44:     BIO_printf(bio, \"%s\\n\", obj_txt);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "6adf409c7432b90c06d9890787fe56c48f2a16e7",
      "candidate_info": {
        "commit_hash": "6adf409c7432b90c06d9890787fe56c48f2a16e7",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/6adf409c7432b90c06d9890787fe56c48f2a16e7",
        "files": [
          "crypto/ts/ts_lib.c"
        ],
        "message": "Fix OOB read in TS_OBJ_print_bio().\n\nTS_OBJ_print_bio() misuses OBJ_txt2obj: it should print the result\nas a null terminated buffer. The length value returned is the total\nlength the complete text reprsentation would need not the amount of\ndata written.\n\nCVE-2016-2180\n\nThanks to Shi Lei for reporting this bug.\n\nReviewed-by: Matt Caswell <matt@openssl.org>\n(cherry picked from commit 0ed26acce328ec16a3aa635f1ca37365e8c7403a)",
        "before_after_code_files": [
          "crypto/ts/ts_lib.c||crypto/ts/ts_lib.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "diff_branch_olp_changes": 1,
        "olp_code_files": {
          "patch": [
            "crypto/ts/ts_lib.c||crypto/ts/ts_lib.c"
          ],
          "candidate": [
            "crypto/ts/ts_lib.c||crypto/ts/ts_lib.c"
          ]
        }
      },
      "candidate_diff": {
        "crypto/ts/ts_lib.c||crypto/ts/ts_lib.c": [
          "File: crypto/ts/ts_lib.c -> crypto/ts/ts_lib.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "90: {",
          "91:     char obj_txt[128];",
          "97:     return 1;",
          "98: }",
          "",
          "[Removed Lines]",
          "93:     int len = OBJ_obj2txt(obj_txt, sizeof(obj_txt), obj, 0);",
          "94:     BIO_write(bio, obj_txt, len);",
          "95:     BIO_write(bio, \"\\n\", 1);",
          "",
          "[Added Lines]",
          "93:     OBJ_obj2txt(obj_txt, sizeof(obj_txt), obj, 0);",
          "94:     BIO_printf(bio, \"%s\\n\", obj_txt);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "b746aa3fe05b5b5f7126df247ac3eceeb995e2a0",
      "candidate_info": {
        "commit_hash": "b746aa3fe05b5b5f7126df247ac3eceeb995e2a0",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/b746aa3fe05b5b5f7126df247ac3eceeb995e2a0",
        "files": [
          "crypto/ts/ts_lib.c"
        ],
        "message": "Fix OOB read in TS_OBJ_print_bio().\n\nTS_OBJ_print_bio() misuses OBJ_txt2obj: it should print the result\nas a null terminated buffer. The length value returned is the total\nlength the complete text reprsentation would need not the amount of\ndata written.\n\nCVE-2016-2180\n\nThanks to Shi Lei for reporting this bug.\n\nReviewed-by: Matt Caswell <matt@openssl.org>\n(cherry picked from commit 0ed26acce328ec16a3aa635f1ca37365e8c7403a)",
        "before_after_code_files": [
          "crypto/ts/ts_lib.c||crypto/ts/ts_lib.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "diff_branch_olp_changes": 1,
        "olp_code_files": {
          "patch": [
            "crypto/ts/ts_lib.c||crypto/ts/ts_lib.c"
          ],
          "candidate": [
            "crypto/ts/ts_lib.c||crypto/ts/ts_lib.c"
          ]
        }
      },
      "candidate_diff": {
        "crypto/ts/ts_lib.c||crypto/ts/ts_lib.c": [
          "File: crypto/ts/ts_lib.c -> crypto/ts/ts_lib.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "90: {",
          "91:     char obj_txt[128];",
          "97:     return 1;",
          "98: }",
          "",
          "[Removed Lines]",
          "93:     int len = OBJ_obj2txt(obj_txt, sizeof(obj_txt), obj, 0);",
          "94:     BIO_write(bio, obj_txt, len);",
          "95:     BIO_write(bio, \"\\n\", 1);",
          "",
          "[Added Lines]",
          "93:     OBJ_obj2txt(obj_txt, sizeof(obj_txt), obj, 0);",
          "94:     BIO_printf(bio, \"%s\\n\", obj_txt);",
          "",
          "---------------"
        ]
      }
    }
  ]
}