{
  "cve_id": "CVE-2019-3851",
  "cve_desc": "A vulnerability was found in moodle before versions 3.6.3 and 3.5.5. There was a link to site home within the the Boost theme's secure layout, meaning students could navigate out of the page.",
  "repo": "moodle/moodle",
  "patch_hash": "c430bed525c4c7e6e5a1c0f7222bc323cf9b6245",
  "patch_info": {
    "commit_hash": "c430bed525c4c7e6e5a1c0f7222bc323cf9b6245",
    "repo": "moodle/moodle",
    "commit_url": "https://github.com/moodle/moodle/commit/c430bed525c4c7e6e5a1c0f7222bc323cf9b6245",
    "files": [
      "lib/tests/behat/securelayout.feature",
      "lib/tests/fixtures/securetestpage.php",
      "theme/boost/templates/navbar-secure.mustache"
    ],
    "message": "MDL-64706 theme_boost: Remove logo link in secure template",
    "before_after_code_files": [
      "lib/tests/behat/securelayout.feature||lib/tests/behat/securelayout.feature",
      "lib/tests/fixtures/securetestpage.php||lib/tests/fixtures/securetestpage.php",
      "theme/boost/templates/navbar-secure.mustache||theme/boost/templates/navbar-secure.mustache"
    ]
  },
  "patch_diff": {
    "lib/tests/behat/securelayout.feature||lib/tests/behat/securelayout.feature": [
      "File: lib/tests/behat/securelayout.feature -> lib/tests/behat/securelayout.feature",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: @core",
      "2: Feature: Page displaying with secure layout",
      "3:   In order to securely perform tasks",
      "4:   As a student",
      "5:   I need not to be able to exit the page using the header logo",
      "7:   Background:",
      "8:     # Get to the fixture page.",
      "9:     Given the following \"courses\" exist:",
      "10:       | fullname | shortname | format |",
      "11:       | Course 1 | C1        | topics |",
      "12:     And the following \"activities\" exist:",
      "13:       | activity   | name | intro                                                               | course | idnumber |",
      "14:       | label      | L1   | <a href=\"../lib/tests/fixtures/securetestpage.php\">Fixture link</a> | C1     | label1   |",
      "16:   Scenario: Confirm that there is no header link",
      "17:     Given I log in as \"admin\"",
      "18:     And I am on \"Course 1\" course homepage",
      "19:     When I follow \"Fixture link\"",
      "20:     Then I should see \"Acceptance test site\" in the \"nav\" \"css_element\"",
      "21:     But \"Acceptance test site\" \"link\" should not exist",
      "",
      "---------------"
    ],
    "lib/tests/fixtures/securetestpage.php||lib/tests/fixtures/securetestpage.php": [
      "File: lib/tests/fixtures/securetestpage.php -> lib/tests/fixtures/securetestpage.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: <?php",
      "25: require_once(__DIR__ . '/../../../config.php');",
      "27: defined('BEHAT_SITE_RUNNING') || die('Only available on Behat test server');",
      "29: $PAGE->set_pagelayout('secure');",
      "30: $PAGE->set_url('/lib/tests/fixtures/securetestpage.php');",
      "31: $PAGE->set_context(context_system::instance());",
      "33: echo $OUTPUT->header();",
      "35: echo $OUTPUT->heading('Hello world');",
      "37: echo $OUTPUT->footer();",
      "",
      "---------------"
    ],
    "theme/boost/templates/navbar-secure.mustache||theme/boost/templates/navbar-secure.mustache": [
      "File: theme/boost/templates/navbar-secure.mustache -> theme/boost/templates/navbar-secure.mustache",
      "--- Hunk 1 ---",
      "[Context before]",
      "19: }}",
      "20: <nav class=\"fixed-top navbar navbar-light bg-white navbar-expand moodle-has-zindex\" aria-label=\"{{#str}}navigation{{/str}}\">",
      "35:         <ul class=\"nav navbar-nav ml-auto\">",
      "36:             <li class=\"nav-item\">",
      "",
      "[Removed Lines]",
      "22:         <a href=\"{{{ config.wwwroot }}}\" class=\"navbar-brand {{# output.should_display_navbar_logo }}has-logo{{/ output.should_display_navbar_logo }}",
      "23:             {{^ output.should_display_navbar_logo }}",
      "24:                 d-none d-sm-inline",
      "25:             {{/ output.should_display_navbar_logo }}",
      "26:                 \">",
      "27:             {{# output.should_display_navbar_logo }}",
      "28:                 <span class=\"logo d-none d-sm-inline\">",
      "29:                     <img src=\"{{output.get_compact_logo_url}}\" alt=\"{{sitename}}\">",
      "30:                 </span>",
      "31:             {{/ output.should_display_navbar_logo }}",
      "32:             <span class=\"site-name d-none d-md-inline\">{{{ sitename }}}</span>",
      "33:         </a>",
      "",
      "[Added Lines]",
      "22:         {{# output.should_display_navbar_logo }}",
      "23:             <span class=\"logo d-none d-sm-inline\">",
      "24:                 <img src=\"{{output.get_compact_logo_url}}\" alt=\"{{sitename}}\">",
      "25:             </span>",
      "26:         {{/ output.should_display_navbar_logo }}",
      "27:         <span class=\"site-name d-none d-md-inline\">{{{ sitename }}}</span>",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "7f22b14efb3408645cede026ad11126f17e3f59a",
      "candidate_info": {
        "commit_hash": "7f22b14efb3408645cede026ad11126f17e3f59a",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/7f22b14efb3408645cede026ad11126f17e3f59a",
        "files": [
          "lib/tests/behat/securelayout.feature",
          "lib/tests/fixtures/securetestpage.php",
          "theme/boost/templates/navbar-secure.mustache"
        ],
        "message": "MDL-64706 theme_boost: Remove logo link in secure template",
        "before_after_code_files": [
          "lib/tests/behat/securelayout.feature||lib/tests/behat/securelayout.feature",
          "lib/tests/fixtures/securetestpage.php||lib/tests/fixtures/securetestpage.php",
          "theme/boost/templates/navbar-secure.mustache||theme/boost/templates/navbar-secure.mustache"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "lib/tests/behat/securelayout.feature||lib/tests/behat/securelayout.feature",
            "lib/tests/fixtures/securetestpage.php||lib/tests/fixtures/securetestpage.php",
            "theme/boost/templates/navbar-secure.mustache||theme/boost/templates/navbar-secure.mustache"
          ],
          "candidate": [
            "lib/tests/behat/securelayout.feature||lib/tests/behat/securelayout.feature",
            "lib/tests/fixtures/securetestpage.php||lib/tests/fixtures/securetestpage.php",
            "theme/boost/templates/navbar-secure.mustache||theme/boost/templates/navbar-secure.mustache"
          ]
        }
      },
      "candidate_diff": {
        "lib/tests/behat/securelayout.feature||lib/tests/behat/securelayout.feature": [
          "File: lib/tests/behat/securelayout.feature -> lib/tests/behat/securelayout.feature",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: @core",
          "2: Feature: Page displaying with secure layout",
          "3:   In order to securely perform tasks",
          "4:   As a student",
          "5:   I need not to be able to exit the page using the header logo",
          "7:   Background:",
          "8:     # Get to the fixture page.",
          "9:     Given the following \"courses\" exist:",
          "10:       | fullname | shortname | format |",
          "11:       | Course 1 | C1        | topics |",
          "12:     And the following \"activities\" exist:",
          "13:       | activity   | name | intro                                                               | course | idnumber |",
          "14:       | label      | L1   | <a href=\"../lib/tests/fixtures/securetestpage.php\">Fixture link</a> | C1     | label1   |",
          "16:   Scenario: Confirm that there is no header link",
          "17:     Given I log in as \"admin\"",
          "18:     And I am on \"Course 1\" course homepage",
          "19:     When I follow \"Fixture link\"",
          "20:     Then I should see \"Acceptance test site\" in the \"nav\" \"css_element\"",
          "21:     But \"Acceptance test site\" \"link\" should not exist",
          "",
          "---------------"
        ],
        "lib/tests/fixtures/securetestpage.php||lib/tests/fixtures/securetestpage.php": [
          "File: lib/tests/fixtures/securetestpage.php -> lib/tests/fixtures/securetestpage.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: <?php",
          "25: require_once(__DIR__ . '/../../../config.php');",
          "27: defined('BEHAT_SITE_RUNNING') || die('Only available on Behat test server');",
          "29: $PAGE->set_pagelayout('secure');",
          "30: $PAGE->set_url('/lib/tests/fixtures/securetestpage.php');",
          "31: $PAGE->set_context(context_system::instance());",
          "33: echo $OUTPUT->header();",
          "35: echo $OUTPUT->heading('Hello world');",
          "37: echo $OUTPUT->footer();",
          "",
          "---------------"
        ],
        "theme/boost/templates/navbar-secure.mustache||theme/boost/templates/navbar-secure.mustache": [
          "File: theme/boost/templates/navbar-secure.mustache -> theme/boost/templates/navbar-secure.mustache",
          "--- Hunk 1 ---",
          "[Context before]",
          "19: }}",
          "20: <nav class=\"fixed-top navbar navbar-light bg-white navbar-expand moodle-has-zindex\">",
          "35:         <ul class=\"nav navbar-nav ml-auto\">",
          "36:             <li class=\"nav-item\">",
          "",
          "[Removed Lines]",
          "22:         <a href=\"{{{ config.wwwroot }}}\" class=\"navbar-brand {{# output.should_display_navbar_logo }}has-logo{{/ output.should_display_navbar_logo }}",
          "23:             {{^ output.should_display_navbar_logo }}",
          "24:                 d-none d-sm-inline",
          "25:             {{/ output.should_display_navbar_logo }}",
          "26:                 \">",
          "27:             {{# output.should_display_navbar_logo }}",
          "28:                 <span class=\"logo d-none d-sm-inline\">",
          "29:                     <img src=\"{{output.get_compact_logo_url}}\" alt=\"{{sitename}}\">",
          "30:                 </span>",
          "31:             {{/ output.should_display_navbar_logo }}",
          "32:             <span class=\"site-name d-none d-md-inline\">{{{ sitename }}}</span>",
          "33:         </a>",
          "",
          "[Added Lines]",
          "22:         {{# output.should_display_navbar_logo }}",
          "23:             <span class=\"logo d-none d-sm-inline\">",
          "24:                 <img src=\"{{output.get_compact_logo_url}}\" alt=\"{{sitename}}\">",
          "25:             </span>",
          "26:         {{/ output.should_display_navbar_logo }}",
          "27:         <span class=\"site-name d-none d-md-inline\">{{{ sitename }}}</span>",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "911f7488068a56b05b0ad87be8f9e132075ab0a6",
      "candidate_info": {
        "commit_hash": "911f7488068a56b05b0ad87be8f9e132075ab0a6",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/911f7488068a56b05b0ad87be8f9e132075ab0a6",
        "files": [
          "lib/tests/behat/securelayout.feature",
          "lib/tests/fixtures/securetestpage.php",
          "theme/boost/templates/navbar-secure.mustache"
        ],
        "message": "MDL-64706 theme_boost: Remove logo link in secure template",
        "before_after_code_files": [
          "lib/tests/behat/securelayout.feature||lib/tests/behat/securelayout.feature",
          "lib/tests/fixtures/securetestpage.php||lib/tests/fixtures/securetestpage.php",
          "theme/boost/templates/navbar-secure.mustache||theme/boost/templates/navbar-secure.mustache"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "lib/tests/behat/securelayout.feature||lib/tests/behat/securelayout.feature",
            "lib/tests/fixtures/securetestpage.php||lib/tests/fixtures/securetestpage.php",
            "theme/boost/templates/navbar-secure.mustache||theme/boost/templates/navbar-secure.mustache"
          ],
          "candidate": [
            "lib/tests/behat/securelayout.feature||lib/tests/behat/securelayout.feature",
            "lib/tests/fixtures/securetestpage.php||lib/tests/fixtures/securetestpage.php",
            "theme/boost/templates/navbar-secure.mustache||theme/boost/templates/navbar-secure.mustache"
          ]
        }
      },
      "candidate_diff": {
        "lib/tests/behat/securelayout.feature||lib/tests/behat/securelayout.feature": [
          "File: lib/tests/behat/securelayout.feature -> lib/tests/behat/securelayout.feature",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: @core",
          "2: Feature: Page displaying with secure layout",
          "3:   In order to securely perform tasks",
          "4:   As a student",
          "5:   I need not to be able to exit the page using the header logo",
          "7:   Background:",
          "8:     # Get to the fixture page.",
          "9:     Given the following \"courses\" exist:",
          "10:       | fullname | shortname | format |",
          "11:       | Course 1 | C1        | topics |",
          "12:     And the following \"activities\" exist:",
          "13:       | activity   | name | intro                                                               | course | idnumber |",
          "14:       | label      | L1   | <a href=\"../lib/tests/fixtures/securetestpage.php\">Fixture link</a> | C1     | label1   |",
          "16:   Scenario: Confirm that there is no header link",
          "17:     Given I log in as \"admin\"",
          "18:     And I am on \"Course 1\" course homepage",
          "19:     When I follow \"Fixture link\"",
          "20:     Then I should see \"Acceptance test site\" in the \"nav\" \"css_element\"",
          "21:     But \"Acceptance test site\" \"link\" should not exist",
          "",
          "---------------"
        ],
        "lib/tests/fixtures/securetestpage.php||lib/tests/fixtures/securetestpage.php": [
          "File: lib/tests/fixtures/securetestpage.php -> lib/tests/fixtures/securetestpage.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: <?php",
          "25: require_once(__DIR__ . '/../../../config.php');",
          "27: defined('BEHAT_SITE_RUNNING') || die('Only available on Behat test server');",
          "29: $PAGE->set_pagelayout('secure');",
          "30: $PAGE->set_url('/lib/tests/fixtures/securetestpage.php');",
          "31: $PAGE->set_context(context_system::instance());",
          "33: echo $OUTPUT->header();",
          "35: echo $OUTPUT->heading('Hello world');",
          "37: echo $OUTPUT->footer();",
          "",
          "---------------"
        ],
        "theme/boost/templates/navbar-secure.mustache||theme/boost/templates/navbar-secure.mustache": [
          "File: theme/boost/templates/navbar-secure.mustache -> theme/boost/templates/navbar-secure.mustache",
          "--- Hunk 1 ---",
          "[Context before]",
          "19: }}",
          "20: <nav class=\"fixed-top navbar navbar-light bg-white navbar-expand moodle-has-zindex\">",
          "35:         <ul class=\"nav navbar-nav ml-auto\">",
          "36:             <li class=\"nav-item\">",
          "",
          "[Removed Lines]",
          "22:         <a href=\"{{{ config.wwwroot }}}\" class=\"navbar-brand {{# output.should_display_navbar_logo }}has-logo{{/ output.should_display_navbar_logo }}",
          "23:             {{^ output.should_display_navbar_logo }}",
          "24:                 d-none d-sm-inline",
          "25:             {{/ output.should_display_navbar_logo }}",
          "26:                 \">",
          "27:             {{# output.should_display_navbar_logo }}",
          "28:                 <span class=\"logo d-none d-sm-inline\">",
          "29:                     <img src=\"{{output.get_compact_logo_url}}\" alt=\"{{sitename}}\">",
          "30:                 </span>",
          "31:             {{/ output.should_display_navbar_logo }}",
          "32:             <span class=\"site-name d-none d-md-inline\">{{{ sitename }}}</span>",
          "33:         </a>",
          "",
          "[Added Lines]",
          "22:         {{# output.should_display_navbar_logo }}",
          "23:             <span class=\"logo d-none d-sm-inline\">",
          "24:                 <img src=\"{{output.get_compact_logo_url}}\" alt=\"{{sitename}}\">",
          "25:             </span>",
          "26:         {{/ output.should_display_navbar_logo }}",
          "27:         <span class=\"site-name d-none d-md-inline\">{{{ sitename }}}</span>",
          "",
          "---------------"
        ]
      }
    }
  ]
}