{
  "cve_id": "CVE-2015-7551",
  "cve_desc": "The Fiddle::Handle implementation in ext/fiddle/handle.c in Ruby before 2.0.0-p648, 2.1 before 2.1.8, and 2.2 before 2.2.4, as distributed in Apple OS X before 10.11.4 and other products, mishandles tainting, which allows context-dependent attackers to execute arbitrary code or cause a denial of service (application crash) via a crafted string, related to the DL module and the libffi library.  NOTE: this vulnerability exists because of a CVE-2009-5147 regression.",
  "repo": "ruby/ruby",
  "patch_hash": "339e11a7f178312d937b7c95dd3115ce7236597a",
  "patch_info": {
    "commit_hash": "339e11a7f178312d937b7c95dd3115ce7236597a",
    "repo": "ruby/ruby",
    "commit_url": "https://github.com/ruby/ruby/commit/339e11a7f178312d937b7c95dd3115ce7236597a",
    "files": [
      "ChangeLog",
      "ext/fiddle/handle.c",
      "test/fiddle/test_handle.rb",
      "version.h"
    ],
    "message": "merge revision(s): 53153 and 23405@ruby_1_9_1\n\n\t* ext/fiddle/handle.c: check tainted string arguments.\n\t  Patch provided by tenderlove and nobu.\n\n\t* test/fiddle/test_handle.rb (class TestHandle): add test for above.\n\n\t* ext/dl/handle.c (rb_dlhandle_initialize): prohibits DL::dlopen\n\t  with a tainted name of library.\n\t  Patch by sheepman <sheepman AT sheepman.sakura.ne.jp>.\n\n\t* ext/dl/handle.c (rb_dlhandle_sym): ditto\n\n\n\ngit-svn-id: svn+ssh://ci.ruby-lang.org/ruby/branches/ruby_2_1@53156 b2dd03c8-39d4-4d8f-98ff-823fe69b080e",
    "before_after_code_files": [
      "ext/fiddle/handle.c||ext/fiddle/handle.c",
      "test/fiddle/test_handle.rb||test/fiddle/test_handle.rb",
      "version.h||version.h"
    ]
  },
  "patch_diff": {
    "ext/fiddle/handle.c||ext/fiddle/handle.c": [
      "File: ext/fiddle/handle.c -> ext/fiddle/handle.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1: #include <ruby.h>",
      "2: #include <fiddle.h>",
      "4: VALUE rb_cHandle;",
      "6: struct dl_handle {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "4: #define SafeStringValueCStr(v) (rb_check_safe_obj(rb_string_value(&v)), StringValueCStr(v))",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "143:  cflag = RTLD_LAZY | RTLD_GLOBAL;",
      "144:  break;",
      "145:       case 1:",
      "147:  cflag = RTLD_LAZY | RTLD_GLOBAL;",
      "148:  break;",
      "149:       case 2:",
      "151:  cflag = NUM2INT(flag);",
      "152:  break;",
      "153:       default:",
      "",
      "[Removed Lines]",
      "146:  clib = NIL_P(lib) ? NULL : StringValuePtr(lib);",
      "150:  clib = NIL_P(lib) ? NULL : StringValuePtr(lib);",
      "",
      "[Added Lines]",
      "148:  clib = NIL_P(lib) ? NULL : SafeStringValueCStr(lib);",
      "152:  clib = NIL_P(lib) ? NULL : SafeStringValueCStr(lib);",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "263:     return PTR2NUM(fiddle_handle);",
      "264: }",
      "",
      "[Removed Lines]",
      "266: static VALUE fiddle_handle_sym(void *handle, const char *symbol);",
      "",
      "[Added Lines]",
      "268: static VALUE fiddle_handle_sym(void *handle, VALUE symbol);",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "282:  rb_raise(rb_eFiddleError, \"closed handle\");",
      "283:     }",
      "286: }",
      "288: #ifndef RTLD_NEXT",
      "",
      "[Removed Lines]",
      "285:     return fiddle_handle_sym(fiddle_handle->ptr, StringValueCStr(sym));",
      "",
      "[Added Lines]",
      "287:     return fiddle_handle_sym(fiddle_handle->ptr, sym);",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "305: static VALUE",
      "306: rb_fiddle_handle_s_sym(VALUE self, VALUE sym)",
      "307: {",
      "309: }",
      "311: static VALUE",
      "313: {",
      "314: #if defined(HAVE_DLERROR)",
      "315:     const char *err;",
      "",
      "[Removed Lines]",
      "308:     return fiddle_handle_sym(RTLD_NEXT, StringValueCStr(sym));",
      "312: fiddle_handle_sym(void *handle, const char *name)",
      "",
      "[Added Lines]",
      "310:     return fiddle_handle_sym(RTLD_NEXT, sym);",
      "314: fiddle_handle_sym(void *handle, VALUE symbol)",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "318: # define CHECK_DLERROR",
      "319: #endif",
      "320:     void (*func)();",
      "322:     rb_secure(2);",
      "323: #ifdef HAVE_DLERROR",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "323:     const char *name = SafeStringValueCStr(symbol);",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "367:     }",
      "368: #endif",
      "369:     if( !func ){",
      "371:     }",
      "373:     return PTR2NUM(func);",
      "",
      "[Removed Lines]",
      "370:  rb_raise(rb_eFiddleError, \"unknown symbol \\\"%s\\\"\", name);",
      "",
      "[Added Lines]",
      "373:  rb_raise(rb_eFiddleError, \"unknown symbol \\\"%\"PRIsVALUE\"\\\"\", symbol);",
      "",
      "---------------"
    ],
    "test/fiddle/test_handle.rb||test/fiddle/test_handle.rb": [
      "File: test/fiddle/test_handle.rb -> test/fiddle/test_handle.rb",
      "--- Hunk 1 ---",
      "[Context before]",
      "11:     include Test::Unit::Assertions",
      "13:     def test_to_i",
      "14:       handle = Fiddle::Handle.new(LIBC_SO)",
      "15:       assert_kind_of Integer, handle.to_i",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "13:     def test_safe_handle_open",
      "14:       t = Thread.new do",
      "15:         $SAFE = 1",
      "16:         Fiddle::Handle.new(LIBC_SO.taint)",
      "17:       end",
      "18:       assert_raise(SecurityError) { t.value }",
      "19:     end",
      "21:     def test_safe_function_lookup",
      "22:       t = Thread.new do",
      "23:         h = Fiddle::Handle.new(LIBC_SO)",
      "24:         $SAFE = 1",
      "25:         h[\"qsort\".taint]",
      "26:       end",
      "27:       assert_raise(SecurityError) { t.value }",
      "28:     end",
      "",
      "---------------"
    ],
    "version.h||version.h": [
      "File: version.h -> version.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "1: #define RUBY_VERSION \"2.1.8\"",
      "2: #define RUBY_RELEASE_DATE \"2015-12-16\"",
      "5: #define RUBY_RELEASE_YEAR 2015",
      "6: #define RUBY_RELEASE_MONTH 12",
      "",
      "[Removed Lines]",
      "3: #define RUBY_PATCHLEVEL 438",
      "",
      "[Added Lines]",
      "3: #define RUBY_PATCHLEVEL 439",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "1386c9fd3e9f4b10534be6ba23b3d7a43c129588",
      "candidate_info": {
        "commit_hash": "1386c9fd3e9f4b10534be6ba23b3d7a43c129588",
        "repo": "ruby/ruby",
        "commit_url": "https://github.com/ruby/ruby/commit/1386c9fd3e9f4b10534be6ba23b3d7a43c129588",
        "files": [
          "ChangeLog",
          "ext/tk/lib/tkextlib/tcllib/plotchart.rb",
          "version.h"
        ],
        "message": "merge revision(s) r49034: [Backport #10662]\n\n\t* ext/tk/lib/tkextlib/tcllib/plotchart.rb: fix to invoke correct function\n\t  of tcllib. Patch by @zalt50 [fix GH-787]\n\n\ngit-svn-id: svn+ssh://ci.ruby-lang.org/ruby/branches/ruby_2_1@49651 b2dd03c8-39d4-4d8f-98ff-823fe69b080e",
        "before_after_code_files": [
          "ext/tk/lib/tkextlib/tcllib/plotchart.rb||ext/tk/lib/tkextlib/tcllib/plotchart.rb",
          "version.h||version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.h||version.h"
          ],
          "candidate": [
            "version.h||version.h"
          ]
        }
      },
      "candidate_diff": {
        "ext/tk/lib/tkextlib/tcllib/plotchart.rb||ext/tk/lib/tkextlib/tcllib/plotchart.rb": [
          "File: ext/tk/lib/tkextlib/tcllib/plotchart.rb -> ext/tk/lib/tkextlib/tcllib/plotchart.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "142:   end",
          "144:   def self.pixel_to_coords(w, x, y)",
          "146:   end",
          "148:   def self.determine_scale(*args) # (xmin, xmax, inverted=false)",
          "",
          "[Removed Lines]",
          "145:     list(tk_call_without_enc('::Plotchart::coordsToPixel', w.path, x, y))",
          "",
          "[Added Lines]",
          "145:     list(tk_call_without_enc('::Plotchart::pixelToCoords', w.path, x, y))",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "311:     end",
          "313:     def pixel_to_coords(x, y)",
          "315:     end",
          "317:     def determine_scale(xmax, ymax)",
          "",
          "[Removed Lines]",
          "314:       list(tk_call_without_enc('::Plotchart::coordsToPixel', @path, x, y))",
          "",
          "[Added Lines]",
          "314:       list(tk_call_without_enc('::Plotchart::pixelToCoords', @path, x, y))",
          "",
          "---------------"
        ],
        "version.h||version.h": [
          "File: version.h -> version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: #define RUBY_VERSION \"2.1.5\"",
          "5: #define RUBY_RELEASE_YEAR 2015",
          "6: #define RUBY_RELEASE_MONTH 2",
          "9: #include \"ruby/version.h\"",
          "",
          "[Removed Lines]",
          "2: #define RUBY_RELEASE_DATE \"2015-02-18\"",
          "3: #define RUBY_PATCHLEVEL 297",
          "7: #define RUBY_RELEASE_DAY 18",
          "",
          "[Added Lines]",
          "2: #define RUBY_RELEASE_DATE \"2015-02-19\"",
          "3: #define RUBY_PATCHLEVEL 298",
          "7: #define RUBY_RELEASE_DAY 19",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "4c2b74cb53a566a5e3d6e0f3a751ceb60eb0549b",
      "candidate_info": {
        "commit_hash": "4c2b74cb53a566a5e3d6e0f3a751ceb60eb0549b",
        "repo": "ruby/ruby",
        "commit_url": "https://github.com/ruby/ruby/commit/4c2b74cb53a566a5e3d6e0f3a751ceb60eb0549b",
        "files": [
          "ChangeLog",
          "lib/resolv.rb",
          "test/resolv/test_resource.rb",
          "version.h"
        ],
        "message": "merge revision(s) r49620: [Backport #10857]\n\n\t* lib/resolv.rb (Resolv::DNS::Resource#==, #hash): elements\n\t  returned by Kernel#instance_variables are Symbols now.\n\t  [ruby-core:68128] [Bug #10857]\n\n\ngit-svn-id: svn+ssh://ci.ruby-lang.org/ruby/branches/ruby_2_1@49628 b2dd03c8-39d4-4d8f-98ff-823fe69b080e",
        "before_after_code_files": [
          "lib/resolv.rb||lib/resolv.rb",
          "test/resolv/test_resource.rb||test/resolv/test_resource.rb",
          "version.h||version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.h||version.h"
          ],
          "candidate": [
            "version.h||version.h"
          ]
        }
      },
      "candidate_diff": {
        "lib/resolv.rb||lib/resolv.rb": [
          "File: lib/resolv.rb -> lib/resolv.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "1666:         return false unless self.class == other.class",
          "1667:         s_ivars = self.instance_variables",
          "1668:         s_ivars.sort!",
          "1670:         o_ivars = other.instance_variables",
          "1671:         o_ivars.sort!",
          "1673:         return s_ivars == o_ivars &&",
          "1674:           s_ivars.collect {|name| self.instance_variable_get name} ==",
          "1675:             o_ivars.collect {|name| other.instance_variable_get name}",
          "",
          "[Removed Lines]",
          "1669:         s_ivars.delete \"@ttl\"",
          "1672:         o_ivars.delete \"@ttl\"",
          "",
          "[Added Lines]",
          "1669:         s_ivars.delete :@ttl",
          "1672:         o_ivars.delete :@ttl",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1682:       def hash # :nodoc:",
          "1683:         h = 0",
          "1684:         vars = self.instance_variables",
          "1686:         vars.each {|name|",
          "1687:           h ^= self.instance_variable_get(name).hash",
          "1688:         }",
          "",
          "[Removed Lines]",
          "1685:         vars.delete \"@ttl\"",
          "",
          "[Added Lines]",
          "1685:         vars.delete :@ttl",
          "",
          "---------------"
        ],
        "test/resolv/test_resource.rb||test/resolv/test_resource.rb": [
          "File: test/resolv/test_resource.rb -> test/resolv/test_resource.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: require 'test/unit'",
          "2: require 'resolv'",
          "4: class TestResolvResource < Test::Unit::TestCase",
          "5:   def setup",
          "6:     address = \"192.168.0.1\"",
          "7:     @name1 = Resolv::DNS::Resource::IN::A.new(address)",
          "8:     @name1.instance_variable_set(:@ttl, 100)",
          "9:     @name2 = Resolv::DNS::Resource::IN::A.new(address)",
          "10:   end",
          "12:   def test_equality",
          "13:     bug10857 = '[ruby-core:68128] [Bug #10857]'",
          "14:     assert_equal(@name1, @name2, bug10857)",
          "15:   end",
          "17:   def test_hash",
          "18:     bug10857 = '[ruby-core:68128] [Bug #10857]'",
          "19:     assert_equal(@name1.hash, @name2.hash, bug10857)",
          "20:   end",
          "21: end",
          "",
          "---------------"
        ],
        "version.h||version.h": [
          "File: version.h -> version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: #define RUBY_VERSION \"2.1.5\"",
          "5: #define RUBY_RELEASE_YEAR 2015",
          "6: #define RUBY_RELEASE_MONTH 2",
          "9: #include \"ruby/version.h\"",
          "",
          "[Removed Lines]",
          "2: #define RUBY_RELEASE_DATE \"2015-02-15\"",
          "3: #define RUBY_PATCHLEVEL 293",
          "7: #define RUBY_RELEASE_DAY 15",
          "",
          "[Added Lines]",
          "2: #define RUBY_RELEASE_DATE \"2015-02-17\"",
          "3: #define RUBY_PATCHLEVEL 294",
          "7: #define RUBY_RELEASE_DAY 17",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "99bcf86ec38aee035706a0dce1990dc4b1aba31f",
      "candidate_info": {
        "commit_hash": "99bcf86ec38aee035706a0dce1990dc4b1aba31f",
        "repo": "ruby/ruby",
        "commit_url": "https://github.com/ruby/ruby/commit/99bcf86ec38aee035706a0dce1990dc4b1aba31f",
        "files": [
          "ChangeLog",
          "insns.def",
          "test/ruby/test_defined.rb",
          "version.h"
        ],
        "message": "merge revision(s) 50737: [Backport #11211]\n\n\t* insns.def (defined): skip respond_to_missing? when\n\t  a method is available.\n\t  [Bug #11211]\n\n\t* test/ruby/test_defined.rb: add a test for this fix.\n\n\n\ngit-svn-id: svn+ssh://ci.ruby-lang.org/ruby/branches/ruby_2_1@52802 b2dd03c8-39d4-4d8f-98ff-823fe69b080e",
        "before_after_code_files": [
          "insns.def||insns.def",
          "test/ruby/test_defined.rb||test/ruby/test_defined.rb",
          "version.h||version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.h||version.h"
          ],
          "candidate": [
            "version.h||version.h"
          ]
        }
      },
      "candidate_diff": {
        "insns.def||insns.def": [
          "File: insns.def -> insns.def",
          "--- Hunk 1 ---",
          "[Context before]",
          "738:  const rb_method_entry_t *me = rb_method_entry(klass, SYM2ID(obj), 0);",
          "740:  if (me) {",
          "747:      }",
          "748:  }",
          "750:      VALUE args[2];",
          "751:      VALUE r;",
          "",
          "[Removed Lines]",
          "741:      if (!(me->flag & NOEX_PRIVATE)) {",
          "742:   if (!((me->flag & NOEX_PROTECTED) &&",
          "743:         !rb_obj_is_kind_of(GET_SELF(),",
          "744:       rb_class_real(klass)))) {",
          "745:       expr_type = DEFINED_METHOD;",
          "746:   }",
          "749:  {",
          "",
          "[Added Lines]",
          "741:      if (!(me->flag & NOEX_PRIVATE) &&",
          "742:   !((me->flag & NOEX_PROTECTED) && !rb_obj_is_kind_of(GET_SELF(), rb_class_real(klass)))) {",
          "743:   expr_type = DEFINED_METHOD;",
          "746:  else {",
          "",
          "---------------"
        ],
        "test/ruby/test_defined.rb||test/ruby/test_defined.rb": [
          "File: test/ruby/test_defined.rb -> test/ruby/test_defined.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "209:   def test_super_toplevel",
          "210:     assert_separately([], \"assert_nil(defined?(super))\")",
          "211:   end",
          "212: end",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "213:   class ExampleRespondToMissing",
          "214:     attr_reader :called",
          "216:     def initialize",
          "217:       @called = false",
          "218:     end",
          "220:     def respond_to_missing? *args",
          "221:       @called = true",
          "222:       false",
          "223:     end",
          "225:     def existing_method",
          "226:     end",
          "227:   end",
          "229:   def test_method_by_respond_to_missing",
          "230:     bug_11211 = '[Bug #11211]'",
          "231:     obj = ExampleRespondToMissing.new",
          "232:     assert_equal(\"method\", defined?(obj.existing_method), bug_11211)",
          "233:     assert_equal(false, obj.called, bug_11211)",
          "234:     assert_equal(nil, defined?(obj.non_existing_method), bug_11211)",
          "235:     assert_equal(true, obj.called, bug_11211)",
          "236:   end",
          "",
          "---------------"
        ],
        "version.h||version.h": [
          "File: version.h -> version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: #define RUBY_VERSION \"2.1.8\"",
          "2: #define RUBY_RELEASE_DATE \"2015-11-30\"",
          "5: #define RUBY_RELEASE_YEAR 2015",
          "6: #define RUBY_RELEASE_MONTH 11",
          "",
          "[Removed Lines]",
          "3: #define RUBY_PATCHLEVEL 427",
          "",
          "[Added Lines]",
          "3: #define RUBY_PATCHLEVEL 428",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "d69ae6f985c5d94652fefc379b04bf352ee6200f",
      "candidate_info": {
        "commit_hash": "d69ae6f985c5d94652fefc379b04bf352ee6200f",
        "repo": "ruby/ruby",
        "commit_url": "https://github.com/ruby/ruby/commit/d69ae6f985c5d94652fefc379b04bf352ee6200f",
        "files": [
          "ChangeLog",
          "re.c",
          "test/ruby/test_m17n.rb",
          "version.h"
        ],
        "message": "merge revision(s) 51685: [Backport #11488]\n\n\t* re.c (rb_memsearch_wchar, rb_memsearch_qchar): test matching\n\t  till the end of string.  [ruby-core:70592] [Bug #11488]\n\n\t* test/ruby/test_m17n.rb (test_include?, tet_index): add tests by\n\t  Tom Stuart.\n\n\ngit-svn-id: svn+ssh://ci.ruby-lang.org/ruby/branches/ruby_2_1@51976 b2dd03c8-39d4-4d8f-98ff-823fe69b080e",
        "before_after_code_files": [
          "re.c||re.c",
          "test/ruby/test_m17n.rb||test/ruby/test_m17n.rb",
          "version.h||version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.h||version.h"
          ],
          "candidate": [
            "version.h||version.h"
          ]
        }
      },
      "candidate_diff": {
        "re.c||re.c": [
          "File: re.c -> re.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "229:     const unsigned char *x = xs, x0 = *xs, *y = ys;",
          "230:     enum {char_size = 2};",
          "233:  if (x0 == *y && memcmp(x+1, y+1, m-1) == 0)",
          "234:      return y - ys;",
          "235:     }",
          "",
          "[Removed Lines]",
          "232:     for (n -= m; n > 0; n -= char_size, y += char_size) {",
          "",
          "[Added Lines]",
          "232:     for (n -= m; n >= 0; n -= char_size, y += char_size) {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "242:     const unsigned char *x = xs, x0 = *xs, *y = ys;",
          "243:     enum {char_size = 4};",
          "246:  if (x0 == *y && memcmp(x+1, y+1, m-1) == 0)",
          "247:      return y - ys;",
          "248:     }",
          "",
          "[Removed Lines]",
          "245:     for (n -= m; n > 0; n -= char_size, y += char_size) {",
          "",
          "[Added Lines]",
          "245:     for (n -= m; n >= 0; n -= char_size, y += char_size) {",
          "",
          "---------------"
        ],
        "test/ruby/test_m17n.rb||test/ruby/test_m17n.rb": [
          "File: test/ruby/test_m17n.rb -> test/ruby/test_m17n.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "1056:     assert_equal(false, e(\"\\xa1\\xa2\\xa3\\xa4\").include?(e(\"\\xa3\")))",
          "1057:     s = e(\"\\xa3\\xb0\\xa3\\xb1\\xa3\\xb2\\xa3\\xb3\\xa3\\xb4\")",
          "1058:     assert_equal(false, s.include?(e(\"\\xb0\\xa3\")))",
          "1059:   end",
          "1061:   def test_index",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1059:     bug11488 = '[ruby-core:70592] [Bug #11488]'",
          "1060:     each_encoding(\"abcdef\", \"def\") do |str, substr|",
          "1061:       assert_equal(true, str.include?(substr), bug11488)",
          "1062:     end",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1065:     assert_nil(e(\"\\xa1\\xa2\\xa3\\xa4\").rindex(e(\"\\xa3\")))",
          "1066:     s = e(\"\\xa3\\xb0\\xa3\\xb1\\xa3\\xb2\\xa3\\xb3\\xa3\\xb4\")",
          "1067:     assert_raise(Encoding::CompatibilityError){s.rindex(a(\"\\xb1\\xa3\"))}",
          "1068:   end",
          "1070:   def test_next",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1072:     bug11488 = '[ruby-core:70592] [Bug #11488]'",
          "1073:     each_encoding(\"abcdef\", \"def\") do |str, substr|",
          "1074:       assert_equal(3, str.index(substr), bug11488)",
          "1075:     end",
          "",
          "---------------"
        ],
        "version.h||version.h": [
          "File: version.h -> version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: #define RUBY_VERSION \"2.1.8\"",
          "2: #define RUBY_RELEASE_DATE \"2015-09-29\"",
          "5: #define RUBY_RELEASE_YEAR 2015",
          "6: #define RUBY_RELEASE_MONTH 9",
          "",
          "[Removed Lines]",
          "3: #define RUBY_PATCHLEVEL 402",
          "",
          "[Added Lines]",
          "3: #define RUBY_PATCHLEVEL 403",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "759d12889d3f8b15c414a3a2b9f914729b9afe0e",
      "candidate_info": {
        "commit_hash": "759d12889d3f8b15c414a3a2b9f914729b9afe0e",
        "repo": "ruby/ruby",
        "commit_url": "https://github.com/ruby/ruby/commit/759d12889d3f8b15c414a3a2b9f914729b9afe0e",
        "files": [
          "numeric.c",
          "version.h"
        ],
        "message": "merge revision(s) 49235: [Backport #10711]\n\n\tnumeric.c: fix message\n\n\t* numeric.c (coerce_failed): fix the error message on non-flonum\n  platforms.\n\ngit-svn-id: svn+ssh://ci.ruby-lang.org/ruby/branches/ruby_2_1@51124 b2dd03c8-39d4-4d8f-98ff-823fe69b080e",
        "before_after_code_files": [
          "numeric.c||numeric.c",
          "version.h||version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.h||version.h"
          ],
          "candidate": [
            "version.h||version.h"
          ]
        }
      },
      "candidate_diff": {
        "numeric.c||numeric.c": [
          "File: numeric.c -> numeric.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "236: static void",
          "237: coerce_failed(VALUE x, VALUE y)",
          "238: {",
          "239:     rb_raise(rb_eTypeError, \"%\"PRIsVALUE\" can't be coerced into %\"PRIsVALUE,",
          "242: }",
          "244: static VALUE",
          "",
          "[Removed Lines]",
          "240:       (rb_special_const_p(y)? rb_inspect(y) : rb_obj_class(y)),",
          "241:       rb_obj_class(x));",
          "",
          "[Added Lines]",
          "239:     if (SPECIAL_CONST_P(y) || BUILTIN_TYPE(y) == T_FLOAT) {",
          "240:  y = rb_inspect(y);",
          "241:     }",
          "242:     else {",
          "243:  y = rb_obj_class(y);",
          "244:     }",
          "246:       y, rb_obj_class(x));",
          "",
          "---------------"
        ],
        "version.h||version.h": [
          "File: version.h -> version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: #define RUBY_VERSION \"2.1.7\"",
          "2: #define RUBY_RELEASE_DATE \"2015-07-03\"",
          "5: #define RUBY_RELEASE_YEAR 2015",
          "6: #define RUBY_RELEASE_MONTH 7",
          "",
          "[Removed Lines]",
          "3: #define RUBY_PATCHLEVEL 374",
          "",
          "[Added Lines]",
          "3: #define RUBY_PATCHLEVEL 375",
          "",
          "---------------"
        ]
      }
    }
  ]
}