{
  "cve_id": "CVE-2019-19603",
  "cve_desc": "SQLite 3.30.1 mishandles certain SELECT statements with a nonexistent VIEW, leading to an application crash.",
  "repo": "sqlite/sqlite",
  "patch_hash": "527cbd4a104cb93bf3994b3dd3619a6299a78b13",
  "patch_info": {
    "commit_hash": "527cbd4a104cb93bf3994b3dd3619a6299a78b13",
    "repo": "sqlite/sqlite",
    "commit_url": "https://github.com/sqlite/sqlite/commit/527cbd4a104cb93bf3994b3dd3619a6299a78b13",
    "files": [
      "manifest",
      "manifest.uuid",
      "src/build.c",
      "src/sqliteInt.h",
      "test/altertab.test"
    ],
    "message": "Do not allow CREATE TABLE or CREATE VIEW of an object with a name that looks like a shadow table name.\n\nFossilOrigin-Name: 6aef58b629d89955f85f65191ba2be67b2adfac4f0327fe9a7141cb2705dbc00",
    "before_after_code_files": [
      "manifest.uuid||manifest.uuid",
      "src/build.c||src/build.c",
      "src/sqliteInt.h||src/sqliteInt.h",
      "test/altertab.test||test/altertab.test"
    ]
  },
  "patch_diff": {
    "manifest.uuid||manifest.uuid": [
      "File: manifest.uuid -> manifest.uuid",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "1: 8ad34d36a141fa8f5d9bd784dfeb892c983897a6dc6b867607cc668508acf944",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ],
    "src/build.c||src/build.c": [
      "File: src/build.c -> src/build.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "856:       }",
      "857:     }",
      "858:   }else{",
      "861:     ){",
      "862:       sqlite3ErrorMsg(pParse, \"object name reserved for internal use: %s\",",
      "863:                       zName);",
      "864:       return SQLITE_ERROR;",
      "865:     }",
      "866:   }",
      "867:   return SQLITE_OK;",
      "868: }",
      "",
      "[Removed Lines]",
      "859:     if( pParse->nested==0",
      "860:      && 0==sqlite3StrNICmp(zName, \"sqlite_\", 7)",
      "",
      "[Added Lines]",
      "859:     if( (pParse->nested==0 && 0==sqlite3StrNICmp(zName, \"sqlite_\", 7))",
      "860:      || (sqlite3ReadOnlyShadowTables(db) && sqlite3ShadowTableName(db, zName))",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "2132: static int isShadowTableName(sqlite3 *db, char *zName){",
      "",
      "[Added Lines]",
      "2133: int sqlite3ShadowTableName(sqlite3 *db, const char *zName){",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "2147:   if( pMod->pModule->xShadowName==0 ) return 0;",
      "2148:   return pMod->pModule->xShadowName(zTail+1);",
      "2149: }",
      "",
      "[Removed Lines]",
      "2150: #else",
      "2151: # define isShadowTableName(x,y) 0",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "2190:   p = pParse->pNewTable;",
      "2191:   if( p==0 ) return;",
      "2194:     p->tabFlags |= TF_Shadow;",
      "2195:   }",
      "",
      "[Removed Lines]",
      "2193:   if( pSelect==0 && isShadowTableName(db, p->zName) ){",
      "",
      "[Added Lines]",
      "2192:   if( pSelect==0 && sqlite3ShadowTableName(db, p->zName) ){",
      "",
      "---------------"
    ],
    "src/sqliteInt.h||src/sqliteInt.h": [
      "File: src/sqliteInt.h -> src/sqliteInt.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "4548: #  define sqlite3VtabInSync(db) ((db)->nVTrans>0 && (db)->aVTrans==0)",
      "4549: #endif",
      "4550: int sqlite3ReadOnlyShadowTables(sqlite3 *db);",
      "4551: int sqlite3VtabEponymousTableInit(Parse*,Module*);",
      "4552: void sqlite3VtabEponymousTableClear(sqlite3*,Module*);",
      "4553: void sqlite3VtabMakeWritable(Parse*,Table*);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "4551: #ifndef SQLITE_OMIT_VIRTUALTABLE",
      "4552:   int sqlite3ShadowTableName(sqlite3 *db, const char *zName);",
      "4553: #else",
      "4554: # define sqlite3ShadowTableName(A,B) 0",
      "4555: #endif",
      "",
      "---------------"
    ],
    "test/altertab.test||test/altertab.test": [
      "File: test/altertab.test -> test/altertab.test",
      "--- Hunk 1 ---",
      "[Context before]",
      "547:   } {1 {table y1_segments may not be modified}}",
      "549:   do_catchsql_test 16.20 {",
      "554:     DROP TABLE y1_segments;",
      "555:   } {1 {table y1_segments may not be dropped}}",
      "557:   do_execsql_test 16.30 {",
      "558:     ALTER TABLE y1 RENAME TO z1;",
      "559:   }",
      "",
      "[Removed Lines]",
      "550:     ALTER TABLE y1_segments RENAME TO abc;",
      "551:   } {1 {table y1_segments may not be altered}}",
      "553:   do_catchsql_test 16.21 {",
      "",
      "[Added Lines]",
      "553:   do_catchsql_test 16.20 {",
      "554:     ALTER TABLE y1_segments RENAME TO abc;",
      "555:   } {1 {table y1_segments may not be altered}}",
      "556:   sqlite3_db_config db DEFENSIVE 0",
      "557:   do_catchsql_test 16.22 {",
      "558:     ALTER TABLE y1_segments RENAME TO abc;",
      "559:   } {0 {}}",
      "560:   sqlite3_db_config db DEFENSIVE 1",
      "561:   do_catchsql_test 16.23 {",
      "562:     CREATE TABLE y1_segments AS SELECT * FROM abc;",
      "563:   } {1 {object name reserved for internal use: y1_segments}}",
      "564:   do_catchsql_test 16.24 {",
      "565:     CREATE VIEW y1_segments AS SELECT * FROM abc;",
      "566:   } {1 {object name reserved for internal use: y1_segments}}",
      "567:   sqlite3_db_config db DEFENSIVE 0",
      "568:   do_catchsql_test 16.25 {",
      "569:     ALTER TABLE abc RENAME TO y1_segments;",
      "570:   } {0 {}}",
      "571:   sqlite3_db_config db DEFENSIVE 1",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "af94adf049218f9d3675fd796663aa3e021f7d88",
      "candidate_info": {
        "commit_hash": "af94adf049218f9d3675fd796663aa3e021f7d88",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/af94adf049218f9d3675fd796663aa3e021f7d88",
        "files": [
          "autoconf/Makefile.msc",
          "manifest",
          "manifest.uuid"
        ],
        "message": "Update the autoconf makefile for MSVC.\n\nFossilOrigin-Name: 9455643eecb74c8ac93ad3b3566f30e380dd912cdce3de993da5af42973ac59c",
        "before_after_code_files": [
          "autoconf/Makefile.msc||autoconf/Makefile.msc",
          "manifest.uuid||manifest.uuid"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "autoconf/Makefile.msc||autoconf/Makefile.msc": [
          "File: autoconf/Makefile.msc -> autoconf/Makefile.msc",
          "--- Hunk 1 ---",
          "[Context before]",
          "282: OPT_FEATURE_FLAGS = $(OPT_FEATURE_FLAGS) -DSQLITE_ENABLE_STMTVTAB=1",
          "283: OPT_FEATURE_FLAGS = $(OPT_FEATURE_FLAGS) -DSQLITE_ENABLE_DBPAGE_VTAB=1",
          "284: OPT_FEATURE_FLAGS = $(OPT_FEATURE_FLAGS) -DSQLITE_ENABLE_DBSTAT_VTAB=1",
          "286: OPT_FEATURE_FLAGS = $(OPT_FEATURE_FLAGS) -DSQLITE_ENABLE_DESERIALIZE=1",
          "287: !ENDIF",
          "288: OPT_FEATURE_FLAGS = $(OPT_FEATURE_FLAGS) -DSQLITE_ENABLE_COLUMN_METADATA=1",
          "",
          "[Removed Lines]",
          "285: OPT_FEATURE_FLAGS = $(OPT_FEATURE_FLAGS) -DSQLITE_INTROSPECTION_PRAGMAS=1",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: 73a82114733af2a316f20eb8578badef307d14286c6ec03197744a6793425161",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "30ad79aeb4cc1243817fdb3c1b0b51a61bbb5f97",
      "candidate_info": {
        "commit_hash": "30ad79aeb4cc1243817fdb3c1b0b51a61bbb5f97",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/30ad79aeb4cc1243817fdb3c1b0b51a61bbb5f97",
        "files": [
          "manifest",
          "manifest.uuid",
          "src/select.c"
        ],
        "message": "Improvements to the view-self-join optimization so that it works on all VIEWs, not just on Common Table Expressions.\n\nFossilOrigin-Name: d2fe370cafa9b11f6c3eb4e1c3be48d9d2610b9d2f9d9ebf9e50267f9079dfc0",
        "before_after_code_files": [
          "manifest.uuid||manifest.uuid",
          "src/select.c||src/select.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: cb1d06521de5918a2324a41e207b48c5e5149c23b927b9e3e1f3c3b38b82658e",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/select.c||src/select.c": [
          "File: src/select.c -> src/select.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "5481:     if( pItem->pSelect==0 ) continue;",
          "5482:     if( pItem->fg.viaCoroutine ) continue;",
          "5483:     if( pItem->zName==0 ) continue;",
          "5485:     if( sqlite3_stricmp(pItem->zName, pThis->zName)!=0 ) continue;",
          "5486:     pS1 = pItem->pSelect;",
          "5490:       continue;",
          "",
          "[Removed Lines]",
          "5484:     if( sqlite3_stricmp(pItem->zDatabase, pThis->zDatabase)!=0 ) continue;",
          "5487:     if( pThis->pSelect->selId!=pS1->selId ){",
          "",
          "[Added Lines]",
          "5484:     assert( pItem->pTab!=0 );",
          "5485:     assert( pThis->pTab!=0 );",
          "5486:     if( pItem->pTab->pSchema!=pThis->pTab->pSchema ) continue;",
          "5489:     if( pItem->pTab->pSchema==0 && pThis->pSelect->selId!=pS1->selId ){",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "76fd7be3a31d466202bc6ee9026d02150fcc12da",
      "candidate_info": {
        "commit_hash": "76fd7be3a31d466202bc6ee9026d02150fcc12da",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/76fd7be3a31d466202bc6ee9026d02150fcc12da",
        "files": [
          "manifest",
          "manifest.uuid",
          "src/vdbe.c"
        ],
        "message": "Improved comments and extra testcase() macros on the serial-type computation logic in the OP_MakeRecord opcode.\n\nFossilOrigin-Name: 18bfb2179ce2c60cec8f5859a84b737731a5e53b28e35072cbb249f18b94262b",
        "before_after_code_files": [
          "manifest.uuid||manifest.uuid",
          "src/vdbe.c||src/vdbe.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: 2578e3c64b0a92ab92143f18d107a1a180bd6fa87243661930771c4c080f8098",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/vdbe.c||src/vdbe.c": [
          "File: src/vdbe.c -> src/vdbe.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2943:         assert( pOp->p5==OPFLAG_NOCHNG_MAGIC || CORRUPT_DB );",
          "2944:         pRec->uTemp = 10;",
          "2945:       }else{",
          "2947:       }",
          "2948:       nHdr++;",
          "2949:     }else if( pRec->flags & (MEM_Int|MEM_IntReal) ){",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2969:         pRec->uTemp = 0;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2958:         u = i;",
          "2959:       }",
          "2960:       nHdr++;",
          "2961:       if( u<=127 ){",
          "2962:         if( (i&1)==i && file_format>=4 ){",
          "2963:           pRec->uTemp = 8+(u32)u;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2984:       testcase( u==127 );               testcase( u==128 );",
          "2985:       testcase( u==32767 );             testcase( u==32768 );",
          "2986:       testcase( u==8388607 );           testcase( u==8388608 );",
          "2987:       testcase( u==2147483647 );        testcase( u==2147483648 );",
          "2988:       testcase( u==140737488355327LL ); testcase( u==140737488355328LL );",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "3a07548b0d40b1f08574914aa3a2af07fbbc9596",
      "candidate_info": {
        "commit_hash": "3a07548b0d40b1f08574914aa3a2af07fbbc9596",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/3a07548b0d40b1f08574914aa3a2af07fbbc9596",
        "files": [
          "ext/fts5/test/fts5vocab.test",
          "ext/fts5/test/fts5vocab2.test",
          "manifest",
          "manifest.uuid",
          "test/e_select.test",
          "test/triggerF.test",
          "test/unionvtab.test",
          "test/window1.test"
        ],
        "message": "Remove unnecessary whitespace from testcase result strings.\n\nFossilOrigin-Name: ad70f03ceda74163903d247a975666b35fae722a27c48dd3efd31c1164b5627e",
        "before_after_code_files": [
          "ext/fts5/test/fts5vocab.test||ext/fts5/test/fts5vocab.test",
          "ext/fts5/test/fts5vocab2.test||ext/fts5/test/fts5vocab2.test",
          "manifest.uuid||manifest.uuid",
          "test/e_select.test||test/e_select.test",
          "test/triggerF.test||test/triggerF.test",
          "test/unionvtab.test||test/unionvtab.test",
          "test/window1.test||test/window1.test"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "ext/fts5/test/fts5vocab.test||ext/fts5/test/fts5vocab.test": [
          "File: ext/fts5/test/fts5vocab.test -> ext/fts5/test/fts5vocab.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "79:   3 cnt {} 0 {} 0",
          "80: }",
          "85: do_execsql_test 1.3 {",
          "86:   INSERT INTO t1 VALUES('x y z');",
          "",
          "[Removed Lines]",
          "82: do_execsql_test 1.2.1 { SELECT * FROM v1 } { }",
          "83: do_execsql_test 1.2.2 { SELECT * FROM v2 } { }",
          "",
          "[Added Lines]",
          "82: do_execsql_test 1.2.1 { SELECT * FROM v1 } {}",
          "83: do_execsql_test 1.2.2 { SELECT * FROM v2 } {}",
          "",
          "---------------"
        ],
        "ext/fts5/test/fts5vocab2.test||ext/fts5/test/fts5vocab2.test": [
          "File: ext/fts5/test/fts5vocab2.test -> ext/fts5/test/fts5vocab2.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "80: do_execsql_test 1.5 {",
          "81:   DELETE FROM t1;",
          "82:   SELECT * FROM v1;",
          "86: #-------------------------------------------------------------------------",
          "87: #",
          "",
          "[Removed Lines]",
          "83: } {",
          "84: }",
          "",
          "[Added Lines]",
          "83: } {}",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "143: do_execsql_test 2.5 {",
          "144:   DELETE FROM t1;",
          "145:   SELECT * FROM v1;",
          "149: #-------------------------------------------------------------------------",
          "150: #",
          "",
          "[Removed Lines]",
          "146: } {",
          "147: }",
          "",
          "[Added Lines]",
          "145: } {}",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "202: do_execsql_test 3.5 {",
          "203:   DELETE FROM t1;",
          "204:   SELECT * FROM v1;",
          "208: finish_test",
          "",
          "[Removed Lines]",
          "205: } {",
          "206: }",
          "",
          "[Added Lines]",
          "203: } {}",
          "",
          "---------------"
        ],
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: 83935b950619855fb3bf05486091804ac2a61fb993c6ec826c89f943264fabc3",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "test/e_select.test||test/e_select.test": [
          "File: test/e_select.test -> test/e_select.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "167:   0102.1  \"SELECT count(*), max(a) FROM t1 GROUP BY b HAVING count(*)=1\" {",
          "168:     1 a 1 c 1 b",
          "169:   }",
          "172:   1101.1  \"SELECT DISTINCT count(*), max(a) FROM t1 GROUP BY b\" {1 a 1 c 1 b}",
          "173:   1102.1  \"SELECT DISTINCT count(*), max(a) FROM t1",
          "",
          "[Removed Lines]",
          "170:   0102.2  \"SELECT count(*), max(a) FROM t1 GROUP BY b HAVING count(*)=2\" { }",
          "",
          "[Added Lines]",
          "170:   0102.2  \"SELECT count(*), max(a) FROM t1 GROUP BY b HAVING count(*)=2\" {}",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "175:     1 a 1 c 1 b",
          "176:   }",
          "177:   1102.2  \"SELECT DISTINCT count(*), max(a) FROM t1",
          "181:   2101.1  \"SELECT ALL count(*), max(a) FROM t1 GROUP BY b\" {1 a 1 c 1 b}",
          "182:   2102.1  \"SELECT ALL count(*), max(a) FROM t1",
          "",
          "[Removed Lines]",
          "178:            GROUP BY b HAVING count(*)=2\" {",
          "179:   }",
          "",
          "[Added Lines]",
          "178:            GROUP BY b HAVING count(*)=2\" {}",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "184:     1 a 1 c 1 b",
          "185:   }",
          "186:   2102.2  \"SELECT ALL count(*), max(a) FROM t1",
          "190:   0011.1  \"SELECT 1, 2, 3 WHERE 1 GROUP BY 2\" {1 2 3}",
          "191:   0012.1  \"SELECT 1, 2, 3 WHERE 0 GROUP BY 2 HAVING count(*)=1\" {}",
          "",
          "[Removed Lines]",
          "187:            GROUP BY b HAVING count(*)=2\" {",
          "188:   }",
          "",
          "[Added Lines]",
          "186:            GROUP BY b HAVING count(*)=2\" {}",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "204:   0112.1  \"SELECT count(*), max(a) FROM t1",
          "205:            WHERE a='c' GROUP BY b HAVING count(*)=1\" {1 c}",
          "206:   0112.2  \"SELECT count(*), max(a) FROM t1",
          "208:   1111.1  \"SELECT DISTINCT count(*), max(a) FROM t1 WHERE a<'c' GROUP BY b\"",
          "209:           {1 a 1 b}",
          "210:   1112.1  \"SELECT DISTINCT count(*), max(a) FROM t1 WHERE a>'a'",
          "",
          "[Removed Lines]",
          "207:            WHERE 0 GROUP BY b HAVING count(*)=2\" { }",
          "",
          "[Added Lines]",
          "205:            WHERE 0 GROUP BY b HAVING count(*)=2\" {}",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "212:     1 c 1 b",
          "213:   }",
          "214:   1112.2  \"SELECT DISTINCT count(*), max(a) FROM t1 WHERE 0",
          "218:   2111.1  \"SELECT ALL count(*), max(a) FROM t1 WHERE b>'one' GROUP BY b\"",
          "219:           {1 c 1 b}",
          "",
          "[Removed Lines]",
          "215:            GROUP BY b HAVING count(*)=2\" {",
          "216:   }",
          "",
          "[Added Lines]",
          "213:            GROUP BY b HAVING count(*)=2\" {}",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "222:     1 a 1 c",
          "223:   }",
          "224:   2112.2  \"SELECT ALL count(*), max(a) FROM t1",
          "226: }",
          "",
          "[Removed Lines]",
          "225:            WHERE 0 GROUP BY b HAVING count(*)=2\" { }",
          "",
          "[Added Lines]",
          "222:            WHERE 0 GROUP BY b HAVING count(*)=2\" {}",
          "",
          "---------------"
        ],
        "test/triggerF.test||test/triggerF.test": [
          "File: test/triggerF.test -> test/triggerF.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "22: foreach {tn sql log} {",
          "25:   2 {",
          "26:     CREATE TRIGGER trd AFTER DELETE ON t1 BEGIN",
          "",
          "[Removed Lines]",
          "23:   1 { } { }",
          "",
          "[Added Lines]",
          "23:   1 {} {}",
          "",
          "---------------"
        ],
        "test/unionvtab.test||test/unionvtab.test": [
          "File: test/unionvtab.test -> test/unionvtab.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "373: }",
          "374: do_execsql_test 4.3.4 {",
          "375:   SELECT * FROM sl WHERE rowid<-9223372036854775808",
          "378: do_execsql_test 4.4.1 {",
          "379:   SELECT * FROM sl WHERE rowid<9223372036854775807",
          "",
          "[Removed Lines]",
          "376: } { }",
          "",
          "[Added Lines]",
          "376: } {}",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "394: }",
          "395: do_execsql_test 4.4.4 {",
          "396:   SELECT * FROM sl WHERE rowid>9223372036854775807",
          "399: #-------------------------------------------------------------------------",
          "400: # More than 8 source tables.",
          "",
          "[Removed Lines]",
          "397: } { }",
          "",
          "[Added Lines]",
          "397: } {}",
          "",
          "---------------"
        ],
        "test/window1.test||test/window1.test": [
          "File: test/window1.test -> test/window1.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "591:   SELECT a, rank() OVER(ORDER BY b) FROM t1",
          "592:     INTERSECT",
          "593:   SELECT a, rank() OVER(ORDER BY b DESC) FROM t1;",
          "597: # 2018-12-06",
          "598: # https://www.sqlite.org/src/info/f09fcd17810f65f7",
          "",
          "[Removed Lines]",
          "594: } {",
          "595: }",
          "",
          "[Added Lines]",
          "594: } {}",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "5df84280692df828b2c76d5a3a7ebf4c877f3900",
      "candidate_info": {
        "commit_hash": "5df84280692df828b2c76d5a3a7ebf4c877f3900",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/5df84280692df828b2c76d5a3a7ebf4c877f3900",
        "files": [
          "manifest",
          "manifest.uuid",
          "src/shell.c.in",
          "src/sqlite.h.in",
          "src/test1.c",
          "src/vtab.c"
        ],
        "message": "The experimental sqlite3_drop_modules_except() interface.\n\nFossilOrigin-Name: 0851db4d337a87f8b2d3ce2ae9f9c928b9483591ca41a9e39cc01548059b1888",
        "before_after_code_files": [
          "manifest.uuid||manifest.uuid",
          "src/shell.c.in||src/shell.c.in",
          "src/sqlite.h.in||src/sqlite.h.in",
          "src/test1.c||src/test1.c",
          "src/vtab.c||src/vtab.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: 5d6f4dfeea75c7dcd8c511545accb9eb4b405a02db034332249ba54794e313d2",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/shell.c.in||src/shell.c.in": [
          "File: src/shell.c.in -> src/shell.c.in",
          "--- Hunk 1 ---",
          "[Context before]",
          "3652: #ifdef SQLITE_DEBUG",
          "3653:   \".unmodule NAME ...       Unregister virtual table modules\",",
          "3654: #endif",
          "3655:   \".vfsinfo ?AUX?           Information about the top-level VFS\",",
          "3656:   \".vfslist                 List all available VFSes\",",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3654:   \"    --allexcept             Unregister everything except those named\",",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "6892:   int nArg = 0;",
          "6893:   int n, c;",
          "6894:   int rc = 0;",
          "6897: #ifndef SQLITE_OMIT_VIRTUALTABLE",
          "6898:   if( p->expert.pExpert ){",
          "",
          "[Removed Lines]",
          "6895:   char *azArg[50];",
          "",
          "[Added Lines]",
          "6896:   char *azArg[52];",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "6906:     while( IsSpace(zLine[h]) ){ h++; }",
          "6907:     if( zLine[h]==0 ) break;",
          "6908:     if( zLine[h]=='\\'' || zLine[h]=='\"' ){",
          "",
          "[Removed Lines]",
          "6905:   while( zLine[h] && nArg<ArraySize(azArg) ){",
          "",
          "[Added Lines]",
          "6906:   while( zLine[h] && nArg<ArraySize(azArg)-1 ){",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "6923:       resolve_backslashes(azArg[nArg-1]);",
          "6924:     }",
          "6925:   }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "6927:   azArg[nArg] = 0;",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "9407: #ifdef SQLITE_DEBUG",
          "9408:   if( c=='u' && strncmp(azArg[0], \"unmodule\", n)==0 ){",
          "9409:     int ii;",
          "9410:     if( nArg<2 ){",
          "9412:       rc = 1;",
          "9413:       goto meta_command_exit;",
          "9414:     }",
          "9415:     open_db(p, 0);",
          "9418:     }",
          "9419:   }else",
          "9420: #endif",
          "",
          "[Removed Lines]",
          "9411:       raw_printf(stderr, \"Usage: .unmodule NAME ...\\n\");",
          "9416:     for(ii=1; ii<nArg; ii++){",
          "9417:       sqlite3_create_module(p->db, azArg[ii], 0, 0);",
          "",
          "[Added Lines]",
          "9412:     char *zOpt;",
          "9414:       raw_printf(stderr, \"Usage: .unmodule [--allexcept] NAME ...\\n\");",
          "9419:     zOpt = azArg[1];",
          "9420:     if( zOpt[0]=='-' && zOpt[1]=='-' && zOpt[2]!=0 ) zOpt++;",
          "9421:     if( strcmp(zOpt, \"-allexcept\")==0 ){",
          "9422:       assert( azArg[nArg]==0 );",
          "9423:       sqlite3_drop_modules_except(p->db, nArg>2 ? (const char**)(azArg+2) : 0);",
          "9424:     }else{",
          "9425:       for(ii=1; ii<nArg; ii++){",
          "9426:         sqlite3_create_module(p->db, azArg[ii], 0, 0);",
          "9427:       }",
          "",
          "---------------"
        ],
        "src/sqlite.h.in||src/sqlite.h.in": [
          "File: src/sqlite.h.in -> src/sqlite.h.in",
          "--- Hunk 1 ---",
          "[Context before]",
          "6655: );",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "6667: int sqlite3_drop_modules_except(",
          "6670: );",
          "",
          "---------------"
        ],
        "src/test1.c||src/test1.c": [
          "File: src/test1.c -> src/test1.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1110:   return TCL_OK;",
          "1111: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1120: static int SQLITE_TCLAPI test_drop_except(",
          "1121:   void *NotUsed,",
          "1125: ){",
          "1126:   int rc;",
          "1127:   sqlite3 *db;",
          "1129:   if( argc!=2 ){",
          "1130:     Tcl_AppendResult(interp, \"wrong # args: should be \\\"\", argv[0],",
          "1131:        \" DB\\\"\", 0);",
          "1132:     return TCL_ERROR;",
          "1133:   }",
          "1134:   if( getDbPointer(interp, argv[1], &db) ) return TCL_ERROR;",
          "1135:   sqlite3_drop_modules_except(db, argc>2 ? (const char**)(argv+2) : 0);",
          "1136:   return TCL_OK;",
          "1137: }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "7860:      { \"sqlite3_close_v2\",              (Tcl_CmdProc*)sqlite_test_close_v2  },",
          "7861:      { \"sqlite3_create_function\",       (Tcl_CmdProc*)test_create_function  },",
          "7862:      { \"sqlite3_create_aggregate\",      (Tcl_CmdProc*)test_create_aggregate },",
          "7863:      { \"sqlite_register_test_function\", (Tcl_CmdProc*)test_register_func    },",
          "7864:      { \"sqlite_abort\",                  (Tcl_CmdProc*)sqlite_abort          },",
          "7865:      { \"sqlite_bind\",                   (Tcl_CmdProc*)test_bind             },",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "7889:      { \"sqlite3_drop_modules_except\",   (Tcl_CmdProc*)test_drop_except      },",
          "",
          "---------------"
        ],
        "src/vtab.c||src/vtab.c": [
          "File: src/vtab.c -> src/vtab.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "133:   return createModule(db, zName, pModule, pAux, xDestroy);",
          "134: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "140: int sqlite3_drop_modules_except(sqlite3 *db, const char** azNames){",
          "141:   HashElem *pThis, *pNext;",
          "142: #ifdef SQLITE_ENABLE_API_ARMOR",
          "143:   if( !sqlite3SafetyCheckOk(db) || zName==0 ) return SQLITE_MISUSE_BKPT;",
          "144: #endif",
          "145:   for(pThis=sqliteHashFirst(&db->aModule); pThis; pThis=pNext){",
          "146:     Module *pMod = (Module*)sqliteHashData(pThis);",
          "147:     pNext = sqliteHashNext(pThis);",
          "148:     if( azNames ){",
          "149:       int ii;",
          "150:       for(ii=0; azNames[ii]!=0 && strcmp(azNames[ii],pMod->zName)!=0; ii++){}",
          "151:       if( azNames[ii]!=0 ) continue;",
          "152:     }",
          "153:     createModule(db, pMod->zName, 0, 0, 0);",
          "154:   }",
          "155:   return SQLITE_OK;",
          "156: }",
          "",
          "---------------"
        ]
      }
    }
  ]
}