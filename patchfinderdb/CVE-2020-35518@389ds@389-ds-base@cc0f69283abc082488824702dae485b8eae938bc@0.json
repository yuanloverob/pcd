{
  "cve_id": "CVE-2020-35518",
  "cve_desc": "When binding against a DN during authentication, the reply from 389-ds-base will be different whether the DN exists or not. This can be used by an unauthenticated attacker to check the existence of an entry in the LDAP database.",
  "repo": "389ds/389-ds-base",
  "patch_hash": "cc0f69283abc082488824702dae485b8eae938bc",
  "patch_info": {
    "commit_hash": "cc0f69283abc082488824702dae485b8eae938bc",
    "repo": "389ds/389-ds-base",
    "commit_url": "https://github.com/389ds/389-ds-base/commit/cc0f69283abc082488824702dae485b8eae938bc",
    "files": [
      "dirsrvtests/tests/suites/basic/basic_test.py",
      "ldap/servers/slapd/back-ldbm/ldbm_config.c",
      "ldap/servers/slapd/result.c"
    ],
    "message": "Issue 4480 - Unexpected info returned to ldap request (#4491)\n\nBug description:\n\tIf the bind entry does not exist, the bind result info\n        reports that 'No such entry'. It should not give any\n        information if the target entry exists or not\n\nFix description:\n\tDoes not return any additional information during a bind\n\nrelates: https://github.com/389ds/389-ds-base/issues/4480\n\nReviewed by: William Brown, Viktor Ashirov, Mark Reynolds (thank you all)\n\nPlatforms tested:  F31",
    "before_after_code_files": [
      "dirsrvtests/tests/suites/basic/basic_test.py||dirsrvtests/tests/suites/basic/basic_test.py",
      "ldap/servers/slapd/back-ldbm/ldbm_config.c||ldap/servers/slapd/back-ldbm/ldbm_config.c",
      "ldap/servers/slapd/result.c||ldap/servers/slapd/result.c"
    ]
  },
  "patch_diff": {
    "dirsrvtests/tests/suites/basic/basic_test.py||dirsrvtests/tests/suites/basic/basic_test.py": [
      "File: dirsrvtests/tests/suites/basic/basic_test.py -> dirsrvtests/tests/suites/basic/basic_test.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "1477:         else:",
      "1478:             assert True",
      "1481: if __name__ == '__main__':",
      "1482:     # Run isolated",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1480: def test_bind_invalid_entry(topology_st):",
      "1481:     \"\"\"Test the failing bind does not return information about the entry",
      "1483:     :id: 5cd9b083-eea6-426b-84ca-83c26fc49a6f",
      "1485:     :setup: Standalone instance",
      "1487:     :steps:",
      "1488:     1: bind as non existing entry",
      "1489:     2: check that bind info does not report 'No such entry'",
      "1491:     :expectedresults:",
      "1492:     1: pass",
      "1493:     2: pass",
      "1494:     \"\"\"",
      "1496:     topology_st.standalone.restart()",
      "1497:     INVALID_ENTRY=\"cn=foooo,%s\" % DEFAULT_SUFFIX",
      "1498:     try:",
      "1499:         topology_st.standalone.simple_bind_s(INVALID_ENTRY, PASSWORD)",
      "1500:     except ldap.LDAPError as e:",
      "1501:         log.info('test_bind_invalid_entry: Failed to bind as %s (expected)' % INVALID_ENTRY)",
      "1502:         log.info('exception description: ' + e.args[0]['desc'])",
      "1503:         if 'info' in e.args[0]:",
      "1504:             log.info('exception info: ' + e.args[0]['info'])",
      "1505:         assert e.args[0]['desc'] == 'Invalid credentials'",
      "1506:         assert 'info' not in e.args[0]",
      "1507:         pass",
      "1509:     log.info('test_bind_invalid_entry: PASSED')",
      "",
      "---------------"
    ],
    "ldap/servers/slapd/back-ldbm/ldbm_config.c||ldap/servers/slapd/back-ldbm/ldbm_config.c": [
      "File: ldap/servers/slapd/back-ldbm/ldbm_config.c -> ldap/servers/slapd/back-ldbm/ldbm_config.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1243:             if (attrs) {",
      "1244:                 for (size_t i = 0; attrs[i]; i++) {",
      "1245:                     if (ldbm_config_moved_attr(attrs[i])) {",
      "1247:                         break;",
      "1248:                     }",
      "1249:                 }",
      "",
      "[Removed Lines]",
      "1246:                         slapi_pblock_set(pb, SLAPI_PB_RESULT_TEXT, \"at least one required attribute has been moved to the BDB scecific configuration entry\");",
      "",
      "[Added Lines]",
      "1246:                         slapi_pblock_set(pb, SLAPI_RESULT_TEXT, \"at least one required attribute has been moved to the BDB scecific configuration entry\");",
      "",
      "---------------"
    ],
    "ldap/servers/slapd/result.c||ldap/servers/slapd/result.c": [
      "File: ldap/servers/slapd/result.c -> ldap/servers/slapd/result.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "355:     if (text) {",
      "356:         pbtext = text;",
      "357:     } else {",
      "359:     }",
      "361:     if (operation == NULL) {",
      "",
      "[Removed Lines]",
      "358:         slapi_pblock_get(pb, SLAPI_PB_RESULT_TEXT, &pbtext);",
      "",
      "[Added Lines]",
      "358:         slapi_pblock_get(pb, SLAPI_RESULT_TEXT, &pbtext);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "38b97faef8a6421a7a638ecdbf0b341e2b3f9ab3",
      "candidate_info": {
        "commit_hash": "38b97faef8a6421a7a638ecdbf0b341e2b3f9ab3",
        "repo": "389ds/389-ds-base",
        "commit_url": "https://github.com/389ds/389-ds-base/commit/38b97faef8a6421a7a638ecdbf0b341e2b3f9ab3",
        "files": [
          "dirsrvtests/tests/suites/basic/basic_test.py",
          "ldap/servers/slapd/back-ldbm/ldbm_config.c",
          "ldap/servers/slapd/result.c"
        ],
        "message": "Issue 4480 - Unexpected info returned to ldap request (#4491)\n\nBug description:\n\tIf the bind entry does not exist, the bind result info\n        reports that 'No such entry'. It should not give any\n        information if the target entry exists or not\n\nFix description:\n\tDoes not return any additional information during a bind\n\nrelates: https://github.com/389ds/389-ds-base/issues/4480\n\nReviewed by: William Brown, Viktor Ashirov, Mark Reynolds (thank you all)\n\nPlatforms tested:  F31",
        "before_after_code_files": [
          "dirsrvtests/tests/suites/basic/basic_test.py||dirsrvtests/tests/suites/basic/basic_test.py",
          "ldap/servers/slapd/back-ldbm/ldbm_config.c||ldap/servers/slapd/back-ldbm/ldbm_config.c",
          "ldap/servers/slapd/result.c||ldap/servers/slapd/result.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "dirsrvtests/tests/suites/basic/basic_test.py||dirsrvtests/tests/suites/basic/basic_test.py",
            "ldap/servers/slapd/back-ldbm/ldbm_config.c||ldap/servers/slapd/back-ldbm/ldbm_config.c",
            "ldap/servers/slapd/result.c||ldap/servers/slapd/result.c"
          ],
          "candidate": [
            "dirsrvtests/tests/suites/basic/basic_test.py||dirsrvtests/tests/suites/basic/basic_test.py",
            "ldap/servers/slapd/back-ldbm/ldbm_config.c||ldap/servers/slapd/back-ldbm/ldbm_config.c",
            "ldap/servers/slapd/result.c||ldap/servers/slapd/result.c"
          ]
        }
      },
      "candidate_diff": {
        "dirsrvtests/tests/suites/basic/basic_test.py||dirsrvtests/tests/suites/basic/basic_test.py": [
          "File: dirsrvtests/tests/suites/basic/basic_test.py -> dirsrvtests/tests/suites/basic/basic_test.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "1477:         else:",
          "1478:             assert True",
          "1481: if __name__ == '__main__':",
          "1482:     # Run isolated",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1480: def test_bind_invalid_entry(topology_st):",
          "1481:     \"\"\"Test the failing bind does not return information about the entry",
          "1483:     :id: 5cd9b083-eea6-426b-84ca-83c26fc49a6f",
          "1485:     :setup: Standalone instance",
          "1487:     :steps:",
          "1488:     1: bind as non existing entry",
          "1489:     2: check that bind info does not report 'No such entry'",
          "1491:     :expectedresults:",
          "1492:     1: pass",
          "1493:     2: pass",
          "1494:     \"\"\"",
          "1496:     topology_st.standalone.restart()",
          "1497:     INVALID_ENTRY=\"cn=foooo,%s\" % DEFAULT_SUFFIX",
          "1498:     try:",
          "1499:         topology_st.standalone.simple_bind_s(INVALID_ENTRY, PASSWORD)",
          "1500:     except ldap.LDAPError as e:",
          "1501:         log.info('test_bind_invalid_entry: Failed to bind as %s (expected)' % INVALID_ENTRY)",
          "1502:         log.info('exception description: ' + e.args[0]['desc'])",
          "1503:         if 'info' in e.args[0]:",
          "1504:             log.info('exception info: ' + e.args[0]['info'])",
          "1505:         assert e.args[0]['desc'] == 'Invalid credentials'",
          "1506:         assert 'info' not in e.args[0]",
          "1507:         pass",
          "1509:     log.info('test_bind_invalid_entry: PASSED')",
          "",
          "---------------"
        ],
        "ldap/servers/slapd/back-ldbm/ldbm_config.c||ldap/servers/slapd/back-ldbm/ldbm_config.c": [
          "File: ldap/servers/slapd/back-ldbm/ldbm_config.c -> ldap/servers/slapd/back-ldbm/ldbm_config.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1243:             if (attrs) {",
          "1244:                 for (size_t i = 0; attrs[i]; i++) {",
          "1245:                     if (ldbm_config_moved_attr(attrs[i])) {",
          "1247:                         break;",
          "1248:                     }",
          "1249:                 }",
          "",
          "[Removed Lines]",
          "1246:                         slapi_pblock_set(pb, SLAPI_PB_RESULT_TEXT, \"at least one required attribute has been moved to the BDB scecific configuration entry\");",
          "",
          "[Added Lines]",
          "1246:                         slapi_pblock_set(pb, SLAPI_RESULT_TEXT, \"at least one required attribute has been moved to the BDB scecific configuration entry\");",
          "",
          "---------------"
        ],
        "ldap/servers/slapd/result.c||ldap/servers/slapd/result.c": [
          "File: ldap/servers/slapd/result.c -> ldap/servers/slapd/result.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "355:     if (text) {",
          "356:         pbtext = text;",
          "357:     } else {",
          "359:     }",
          "361:     if (operation == NULL) {",
          "",
          "[Removed Lines]",
          "358:         slapi_pblock_get(pb, SLAPI_PB_RESULT_TEXT, &pbtext);",
          "",
          "[Added Lines]",
          "358:         slapi_pblock_get(pb, SLAPI_RESULT_TEXT, &pbtext);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "16d9020a8ae1bd5ed1fd7ca1ad8041c889a88c1f",
      "candidate_info": {
        "commit_hash": "16d9020a8ae1bd5ed1fd7ca1ad8041c889a88c1f",
        "repo": "389ds/389-ds-base",
        "commit_url": "https://github.com/389ds/389-ds-base/commit/16d9020a8ae1bd5ed1fd7ca1ad8041c889a88c1f",
        "files": [
          "ldap/servers/slapd/back-ldbm/ldbm_config.c",
          "ldap/servers/slapd/result.c"
        ],
        "message": "Issue 4480 - Unexpected info returned to ldap request (#4491)\n\nBug description:\n\tIf the bind entry does not exist, the bind result info\n        reports that 'No such entry'. It should not give any\n        information if the target entry exists or not\n\nFix description:\n\tDoes not return any additional information during a bind\n\nrelates: https://github.com/389ds/389-ds-base/issues/4480\n\nReviewed by: William Brown, Viktor Ashirov, Mark Reynolds (thank you all)\n\nPlatforms tested:  F31",
        "before_after_code_files": [
          "ldap/servers/slapd/back-ldbm/ldbm_config.c||ldap/servers/slapd/back-ldbm/ldbm_config.c",
          "ldap/servers/slapd/result.c||ldap/servers/slapd/result.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "ldap/servers/slapd/back-ldbm/ldbm_config.c||ldap/servers/slapd/back-ldbm/ldbm_config.c",
            "ldap/servers/slapd/result.c||ldap/servers/slapd/result.c"
          ],
          "candidate": [
            "ldap/servers/slapd/back-ldbm/ldbm_config.c||ldap/servers/slapd/back-ldbm/ldbm_config.c",
            "ldap/servers/slapd/result.c||ldap/servers/slapd/result.c"
          ]
        }
      },
      "candidate_diff": {
        "ldap/servers/slapd/back-ldbm/ldbm_config.c||ldap/servers/slapd/back-ldbm/ldbm_config.c": [
          "File: ldap/servers/slapd/back-ldbm/ldbm_config.c -> ldap/servers/slapd/back-ldbm/ldbm_config.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1234:             if (attrs) {",
          "1235:                 for (size_t i = 0; attrs[i]; i++) {",
          "1236:                     if (ldbm_config_moved_attr(attrs[i])) {",
          "1238:                         break;",
          "1239:                     }",
          "1240:                 }",
          "",
          "[Removed Lines]",
          "1237:                         slapi_pblock_set(pb, SLAPI_PB_RESULT_TEXT, \"at least one required attribute has been moved to the BDB scecific configuration entry\");",
          "",
          "[Added Lines]",
          "1237:                         slapi_pblock_set(pb, SLAPI_RESULT_TEXT, \"at least one required attribute has been moved to the BDB scecific configuration entry\");",
          "",
          "---------------"
        ],
        "ldap/servers/slapd/result.c||ldap/servers/slapd/result.c": [
          "File: ldap/servers/slapd/result.c -> ldap/servers/slapd/result.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "355:     if (text) {",
          "356:         pbtext = text;",
          "357:     } else {",
          "359:     }",
          "361:     if (operation == NULL) {",
          "",
          "[Removed Lines]",
          "358:         slapi_pblock_get(pb, SLAPI_PB_RESULT_TEXT, &pbtext);",
          "",
          "[Added Lines]",
          "358:         slapi_pblock_get(pb, SLAPI_RESULT_TEXT, &pbtext);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "c8e77b811b2f07a71c9cd0058a83e77e47edcd72",
      "candidate_info": {
        "commit_hash": "c8e77b811b2f07a71c9cd0058a83e77e47edcd72",
        "repo": "389ds/389-ds-base",
        "commit_url": "https://github.com/389ds/389-ds-base/commit/c8e77b811b2f07a71c9cd0058a83e77e47edcd72",
        "files": [
          "dirsrvtests/tests/suites/basic/basic_test.py",
          "ldap/servers/slapd/back-ldbm/ldbm_config.c",
          "ldap/servers/slapd/result.c"
        ],
        "message": "Issue 4480 - Unexpected info returned to ldap request (#4491)\n\nBug description:\n\tIf the bind entry does not exist, the bind result info\n        reports that 'No such entry'. It should not give any\n        information if the target entry exists or not\n\nFix description:\n\tDoes not return any additional information during a bind\n\nrelates: https://github.com/389ds/389-ds-base/issues/4480\n\nReviewed by: William Brown, Viktor Ashirov, Mark Reynolds (thank you all)\n\nPlatforms tested:  F31",
        "before_after_code_files": [
          "dirsrvtests/tests/suites/basic/basic_test.py||dirsrvtests/tests/suites/basic/basic_test.py",
          "ldap/servers/slapd/back-ldbm/ldbm_config.c||ldap/servers/slapd/back-ldbm/ldbm_config.c",
          "ldap/servers/slapd/result.c||ldap/servers/slapd/result.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "dirsrvtests/tests/suites/basic/basic_test.py||dirsrvtests/tests/suites/basic/basic_test.py",
            "ldap/servers/slapd/back-ldbm/ldbm_config.c||ldap/servers/slapd/back-ldbm/ldbm_config.c",
            "ldap/servers/slapd/result.c||ldap/servers/slapd/result.c"
          ],
          "candidate": [
            "dirsrvtests/tests/suites/basic/basic_test.py||dirsrvtests/tests/suites/basic/basic_test.py",
            "ldap/servers/slapd/back-ldbm/ldbm_config.c||ldap/servers/slapd/back-ldbm/ldbm_config.c",
            "ldap/servers/slapd/result.c||ldap/servers/slapd/result.c"
          ]
        }
      },
      "candidate_diff": {
        "dirsrvtests/tests/suites/basic/basic_test.py||dirsrvtests/tests/suites/basic/basic_test.py": [
          "File: dirsrvtests/tests/suites/basic/basic_test.py -> dirsrvtests/tests/suites/basic/basic_test.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "1477:         else:",
          "1478:             assert True",
          "1481: if __name__ == '__main__':",
          "1482:     # Run isolated",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1480: def test_bind_invalid_entry(topology_st):",
          "1481:     \"\"\"Test the failing bind does not return information about the entry",
          "1483:     :id: 5cd9b083-eea6-426b-84ca-83c26fc49a6f",
          "1485:     :setup: Standalone instance",
          "1487:     :steps:",
          "1488:     1: bind as non existing entry",
          "1489:     2: check that bind info does not report 'No such entry'",
          "1491:     :expectedresults:",
          "1492:     1: pass",
          "1493:     2: pass",
          "1494:     \"\"\"",
          "1496:     topology_st.standalone.restart()",
          "1497:     INVALID_ENTRY=\"cn=foooo,%s\" % DEFAULT_SUFFIX",
          "1498:     try:",
          "1499:         topology_st.standalone.simple_bind_s(INVALID_ENTRY, PASSWORD)",
          "1500:     except ldap.LDAPError as e:",
          "1501:         log.info('test_bind_invalid_entry: Failed to bind as %s (expected)' % INVALID_ENTRY)",
          "1502:         log.info('exception description: ' + e.args[0]['desc'])",
          "1503:         if 'info' in e.args[0]:",
          "1504:             log.info('exception info: ' + e.args[0]['info'])",
          "1505:         assert e.args[0]['desc'] == 'Invalid credentials'",
          "1506:         assert 'info' not in e.args[0]",
          "1507:         pass",
          "1509:     log.info('test_bind_invalid_entry: PASSED')",
          "",
          "---------------"
        ],
        "ldap/servers/slapd/back-ldbm/ldbm_config.c||ldap/servers/slapd/back-ldbm/ldbm_config.c": [
          "File: ldap/servers/slapd/back-ldbm/ldbm_config.c -> ldap/servers/slapd/back-ldbm/ldbm_config.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1234:             if (attrs) {",
          "1235:                 for (size_t i = 0; attrs[i]; i++) {",
          "1236:                     if (ldbm_config_moved_attr(attrs[i])) {",
          "1238:                         break;",
          "1239:                     }",
          "1240:                 }",
          "",
          "[Removed Lines]",
          "1237:                         slapi_pblock_set(pb, SLAPI_PB_RESULT_TEXT, \"at least one required attribute has been moved to the BDB scecific configuration entry\");",
          "",
          "[Added Lines]",
          "1237:                         slapi_pblock_set(pb, SLAPI_RESULT_TEXT, \"at least one required attribute has been moved to the BDB scecific configuration entry\");",
          "",
          "---------------"
        ],
        "ldap/servers/slapd/result.c||ldap/servers/slapd/result.c": [
          "File: ldap/servers/slapd/result.c -> ldap/servers/slapd/result.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "355:     if (text) {",
          "356:         pbtext = text;",
          "357:     } else {",
          "359:     }",
          "361:     if (operation == NULL) {",
          "",
          "[Removed Lines]",
          "358:         slapi_pblock_get(pb, SLAPI_PB_RESULT_TEXT, &pbtext);",
          "",
          "[Added Lines]",
          "358:         slapi_pblock_get(pb, SLAPI_RESULT_TEXT, &pbtext);",
          "",
          "---------------"
        ]
      }
    }
  ]
}