{
  "cve_id": "CVE-2016-2385",
  "cve_desc": "Heap-based buffer overflow in the encode_msg function in encode_msg.c in the SEAS module in Kamailio (formerly OpenSER and SER) before 4.3.5 allows remote attackers to cause a denial of service (memory corruption and process crash) or possibly execute arbitrary code via a large SIP packet.",
  "repo": "kamailio/kamailio",
  "patch_hash": "f50c9c853e7809810099c970780c30b0765b0643",
  "patch_info": {
    "commit_hash": "f50c9c853e7809810099c970780c30b0765b0643",
    "repo": "kamailio/kamailio",
    "commit_url": "https://github.com/kamailio/kamailio/commit/f50c9c853e7809810099c970780c30b0765b0643",
    "files": [
      "modules/seas/encode_msg.c"
    ],
    "message": "seas: safety check for target buffer size before copying message in encode_msg()\n\n- avoid buffer overflow for large SIP messages\n- reported by Stelios Tsampas",
    "before_after_code_files": [
      "modules/seas/encode_msg.c||modules/seas/encode_msg.c"
    ]
  },
  "patch_diff": {
    "modules/seas/encode_msg.c||modules/seas/encode_msg.c": [
      "File: modules/seas/encode_msg.c -> modules/seas/encode_msg.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "269:    memcpy(&payload[j],msg->buf,msg->len);",
      "270:    LM_DBG(\"msglen = %d,msg starts at %d\\n\",msg->len,j);",
      "271:    j=htons(j);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "271:  if(len < j + msg->len + 1) {",
      "272:        LM_ERR(\"not enough space to encode sip message\\n\");",
      "273:        return -1;",
      "274:  }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "bc4a545aa050dd36c982bf102464edbc14a88753",
      "candidate_info": {
        "commit_hash": "bc4a545aa050dd36c982bf102464edbc14a88753",
        "repo": "kamailio/kamailio",
        "commit_url": "https://github.com/kamailio/kamailio/commit/bc4a545aa050dd36c982bf102464edbc14a88753",
        "files": [
          "modules/seas/encode_msg.c"
        ],
        "message": "seas: safety check for target buffer size before copying message in encode_msg()\n\n- avoid buffer overflow for large SIP messages\n- reported by Stelios Tsampas\n\n(cherry picked from commit f50c9c853e7809810099c970780c30b0765b0643)\n(cherry picked from commit 18cd34781d2bdda9c19314c0494f6a655dbe6089)",
        "before_after_code_files": [
          "modules/seas/encode_msg.c||modules/seas/encode_msg.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "modules/seas/encode_msg.c||modules/seas/encode_msg.c"
          ],
          "candidate": [
            "modules/seas/encode_msg.c||modules/seas/encode_msg.c"
          ]
        }
      },
      "candidate_diff": {
        "modules/seas/encode_msg.c||modules/seas/encode_msg.c": [
          "File: modules/seas/encode_msg.c -> modules/seas/encode_msg.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "269:    memcpy(&payload[j],msg->buf,msg->len);",
          "270:    LM_DBG(\"msglen = %d,msg starts at %d\\n\",msg->len,j);",
          "271:    j=htons(j);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "271:  if(len < j + msg->len + 1) {",
          "272:        LM_ERR(\"not enough space to encode sip message\\n\");",
          "273:        return -1;",
          "274:  }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "18cd34781d2bdda9c19314c0494f6a655dbe6089",
      "candidate_info": {
        "commit_hash": "18cd34781d2bdda9c19314c0494f6a655dbe6089",
        "repo": "kamailio/kamailio",
        "commit_url": "https://github.com/kamailio/kamailio/commit/18cd34781d2bdda9c19314c0494f6a655dbe6089",
        "files": [
          "modules/seas/encode_msg.c"
        ],
        "message": "seas: safety check for target buffer size before copying message in encode_msg()\n\n- avoid buffer overflow for large SIP messages\n- reported by Stelios Tsampas\n\n(cherry picked from commit f50c9c853e7809810099c970780c30b0765b0643)",
        "before_after_code_files": [
          "modules/seas/encode_msg.c||modules/seas/encode_msg.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "modules/seas/encode_msg.c||modules/seas/encode_msg.c"
          ],
          "candidate": [
            "modules/seas/encode_msg.c||modules/seas/encode_msg.c"
          ]
        }
      },
      "candidate_diff": {
        "modules/seas/encode_msg.c||modules/seas/encode_msg.c": [
          "File: modules/seas/encode_msg.c -> modules/seas/encode_msg.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "269:    memcpy(&payload[j],msg->buf,msg->len);",
          "270:    LM_DBG(\"msglen = %d,msg starts at %d\\n\",msg->len,j);",
          "271:    j=htons(j);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "271:  if(len < j + msg->len + 1) {",
          "272:        LM_ERR(\"not enough space to encode sip message\\n\");",
          "273:        return -1;",
          "274:  }",
          "",
          "---------------"
        ]
      }
    }
  ]
}