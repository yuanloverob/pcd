{
  "cve_id": "CVE-2018-6392",
  "cve_desc": "The filter_slice function in libavfilter/vf_transpose.c in FFmpeg through 3.4.1 allows remote attackers to cause a denial of service (out-of-array access) via a crafted MP4 file.",
  "repo": "FFmpeg/FFmpeg",
  "patch_hash": "3f621455d62e46745453568d915badd5b1e5bcd5",
  "patch_info": {
    "commit_hash": "3f621455d62e46745453568d915badd5b1e5bcd5",
    "repo": "FFmpeg/FFmpeg",
    "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/3f621455d62e46745453568d915badd5b1e5bcd5",
    "files": [
      "libavfilter/vf_transpose.c"
    ],
    "message": "avfilter/vf_transpose: Fix regression with packed pixel formats\n\nRegression since: c6939f65a116b1ffed345d29d8621ee4ffb32235\nFound-by: Paul B Mahol <onemda@gmail.com>\nReviewed-by: Paul B Mahol <onemda@gmail.com>\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
    "before_after_code_files": [
      "libavfilter/vf_transpose.c||libavfilter/vf_transpose.c"
    ]
  },
  "patch_diff": {
    "libavfilter/vf_transpose.c||libavfilter/vf_transpose.c": [
      "File: libavfilter/vf_transpose.c -> libavfilter/vf_transpose.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "218:     s->hsub = desc_in->log2_chroma_w;",
      "219:     s->vsub = desc_in->log2_chroma_h;",
      "222:     av_assert0(desc_in->nb_components == desc_out->nb_components);",
      "",
      "[Removed Lines]",
      "220:     s->planes = desc_in->nb_components;",
      "",
      "[Added Lines]",
      "220:     s->planes = av_pix_fmt_count_planes(outlink->format);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "2980b95fafb39148cfade120eab5c75b46bfffc6",
      "candidate_info": {
        "commit_hash": "2980b95fafb39148cfade120eab5c75b46bfffc6",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/2980b95fafb39148cfade120eab5c75b46bfffc6",
        "files": [
          "libavfilter/vf_transpose.c"
        ],
        "message": "avfilter/vf_transpose: Fix used plane count.\n\nFixes out of array access\nFixes: poc.mp4\n\nFound-by: GwanYeong Kim <gy741.kim@gmail.com>\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>\n(cherry picked from commit c6939f65a116b1ffed345d29d8621ee4ffb32235)\n(cherry picked from commit 3f621455d62e46745453568d915badd5b1e5bcd5)\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
        "before_after_code_files": [
          "libavfilter/vf_transpose.c||libavfilter/vf_transpose.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "olp_code_files": {
          "patch": [
            "libavfilter/vf_transpose.c||libavfilter/vf_transpose.c"
          ],
          "candidate": [
            "libavfilter/vf_transpose.c||libavfilter/vf_transpose.c"
          ]
        }
      },
      "candidate_diff": {
        "libavfilter/vf_transpose.c||libavfilter/vf_transpose.c": [
          "File: libavfilter/vf_transpose.c -> libavfilter/vf_transpose.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "28: #include <stdio.h>",
          "30: #include \"libavutil/imgutils.h\"",
          "31: #include \"libavutil/internal.h\"",
          "32: #include \"libavutil/intreadwrite.h\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "30: #include \"libavutil/avassert.h\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "54: typedef struct TransContext {",
          "55:     const AVClass *class;",
          "56:     int hsub, vsub;",
          "57:     int pixsteps[4];",
          "59:     int passthrough;    ///< PassthroughType, landscape passthrough mode enabled",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "58:     int planes;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "216:     s->hsub = desc_in->log2_chroma_w;",
          "217:     s->vsub = desc_in->log2_chroma_h;",
          "219:     av_image_fill_max_pixsteps(s->pixsteps, NULL, desc_out);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "220:     s->planes = av_pix_fmt_count_planes(outlink->format);",
          "222:     av_assert0(desc_in->nb_components == desc_out->nb_components);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "272:     AVFrame *in = td->in;",
          "273:     int plane;",
          "276:         int hsub    = plane == 1 || plane == 2 ? s->hsub : 0;",
          "277:         int vsub    = plane == 1 || plane == 2 ? s->vsub : 0;",
          "278:         int pixstep = s->pixsteps[plane];",
          "",
          "[Removed Lines]",
          "275:     for (plane = 0; out->data[plane]; plane++) {",
          "",
          "[Added Lines]",
          "281:     for (plane = 0; plane < s->planes; plane++) {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "d74839d793ebf8c6c7c4a2a8a22ae2bd695d2c41",
      "candidate_info": {
        "commit_hash": "d74839d793ebf8c6c7c4a2a8a22ae2bd695d2c41",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/d74839d793ebf8c6c7c4a2a8a22ae2bd695d2c41",
        "files": [
          "libavfilter/vf_transpose.c"
        ],
        "message": "avfilter/vf_transpose: Fix used plane count.\n\nFixes out of array access\nFixes: poc.mp4\n\nFound-by: GwanYeong Kim <gy741.kim@gmail.com>\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>\n(cherry picked from commit c6939f65a116b1ffed345d29d8621ee4ffb32235)\n(cherry picked from commit 3f621455d62e46745453568d915badd5b1e5bcd5)\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
        "before_after_code_files": [
          "libavfilter/vf_transpose.c||libavfilter/vf_transpose.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "olp_code_files": {
          "patch": [
            "libavfilter/vf_transpose.c||libavfilter/vf_transpose.c"
          ],
          "candidate": [
            "libavfilter/vf_transpose.c||libavfilter/vf_transpose.c"
          ]
        }
      },
      "candidate_diff": {
        "libavfilter/vf_transpose.c||libavfilter/vf_transpose.c": [
          "File: libavfilter/vf_transpose.c -> libavfilter/vf_transpose.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "28: #include <stdio.h>",
          "30: #include \"libavutil/imgutils.h\"",
          "31: #include \"libavutil/internal.h\"",
          "32: #include \"libavutil/intreadwrite.h\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "30: #include \"libavutil/avassert.h\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "54: typedef struct TransContext {",
          "55:     const AVClass *class;",
          "56:     int hsub, vsub;",
          "57:     int pixsteps[4];",
          "59:     int passthrough;    ///< PassthroughType, landscape passthrough mode enabled",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "58:     int planes;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "107:     s->hsub = desc_in->log2_chroma_w;",
          "108:     s->vsub = desc_in->log2_chroma_h;",
          "110:     av_image_fill_max_pixsteps(s->pixsteps, NULL, desc_out);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "111:     s->planes = av_pix_fmt_count_planes(outlink->format);",
          "113:     av_assert0(desc_in->nb_components == desc_out->nb_components);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "148:     AVFrame *in = td->in;",
          "149:     int plane;",
          "152:         int hsub    = plane == 1 || plane == 2 ? s->hsub : 0;",
          "153:         int vsub    = plane == 1 || plane == 2 ? s->vsub : 0;",
          "154:         int pixstep = s->pixsteps[plane];",
          "",
          "[Removed Lines]",
          "151:     for (plane = 0; out->data[plane]; plane++) {",
          "",
          "[Added Lines]",
          "157:     for (plane = 0; plane < s->planes; plane++) {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "c4ba170cad2ccdd896ea6fd3a890980008606541",
      "candidate_info": {
        "commit_hash": "c4ba170cad2ccdd896ea6fd3a890980008606541",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/c4ba170cad2ccdd896ea6fd3a890980008606541",
        "files": [
          "libavfilter/vf_transpose.c"
        ],
        "message": "avfilter/vf_transpose: Fix used plane count.\n\nFixes out of array access\nFixes: poc.mp4\n\nFound-by: GwanYeong Kim <gy741.kim@gmail.com>\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>\n(cherry picked from commit c6939f65a116b1ffed345d29d8621ee4ffb32235)\n(cherry picked from commit 3f621455d62e46745453568d915badd5b1e5bcd5)\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
        "before_after_code_files": [
          "libavfilter/vf_transpose.c||libavfilter/vf_transpose.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "olp_code_files": {
          "patch": [
            "libavfilter/vf_transpose.c||libavfilter/vf_transpose.c"
          ],
          "candidate": [
            "libavfilter/vf_transpose.c||libavfilter/vf_transpose.c"
          ]
        }
      },
      "candidate_diff": {
        "libavfilter/vf_transpose.c||libavfilter/vf_transpose.c": [
          "File: libavfilter/vf_transpose.c -> libavfilter/vf_transpose.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "28: #include <stdio.h>",
          "30: #include \"libavutil/imgutils.h\"",
          "31: #include \"libavutil/internal.h\"",
          "32: #include \"libavutil/intreadwrite.h\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "30: #include \"libavutil/avassert.h\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "54: typedef struct TransContext {",
          "55:     const AVClass *class;",
          "56:     int hsub, vsub;",
          "57:     int pixsteps[4];",
          "59:     int passthrough;    ///< PassthroughType, landscape passthrough mode enabled",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "58:     int planes;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "107:     s->hsub = desc_in->log2_chroma_w;",
          "108:     s->vsub = desc_in->log2_chroma_h;",
          "110:     av_image_fill_max_pixsteps(s->pixsteps, NULL, desc_out);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "111:     s->planes = av_pix_fmt_count_planes(outlink->format);",
          "113:     av_assert0(desc_in->nb_components == desc_out->nb_components);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "148:     AVFrame *in = td->in;",
          "149:     int plane;",
          "152:         int hsub    = plane == 1 || plane == 2 ? s->hsub : 0;",
          "153:         int vsub    = plane == 1 || plane == 2 ? s->vsub : 0;",
          "154:         int pixstep = s->pixsteps[plane];",
          "",
          "[Removed Lines]",
          "151:     for (plane = 0; out->data[plane]; plane++) {",
          "",
          "[Added Lines]",
          "157:     for (plane = 0; plane < s->planes; plane++) {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "5d06804b313677c149f106a8dba97988ad064385",
      "candidate_info": {
        "commit_hash": "5d06804b313677c149f106a8dba97988ad064385",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/5d06804b313677c149f106a8dba97988ad064385",
        "files": [
          "libavfilter/vf_transpose.c"
        ],
        "message": "avfilter/vf_transpose: Fix used plane count.\n\nFixes out of array access\nFixes: poc.mp4\n\nFound-by: GwanYeong Kim <gy741.kim@gmail.com>\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>\n(cherry picked from commit c6939f65a116b1ffed345d29d8621ee4ffb32235)\n(cherry picked from commit 3f621455d62e46745453568d915badd5b1e5bcd5)\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
        "before_after_code_files": [
          "libavfilter/vf_transpose.c||libavfilter/vf_transpose.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "olp_code_files": {
          "patch": [
            "libavfilter/vf_transpose.c||libavfilter/vf_transpose.c"
          ],
          "candidate": [
            "libavfilter/vf_transpose.c||libavfilter/vf_transpose.c"
          ]
        }
      },
      "candidate_diff": {
        "libavfilter/vf_transpose.c||libavfilter/vf_transpose.c": [
          "File: libavfilter/vf_transpose.c -> libavfilter/vf_transpose.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "28: #include <stdio.h>",
          "30: #include \"libavutil/imgutils.h\"",
          "31: #include \"libavutil/internal.h\"",
          "32: #include \"libavutil/intreadwrite.h\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "30: #include \"libavutil/avassert.h\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "54: typedef struct TransContext {",
          "55:     const AVClass *class;",
          "56:     int hsub, vsub;",
          "57:     int pixsteps[4];",
          "59:     int passthrough;    ///< PassthroughType, landscape passthrough mode enabled",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "58:     int planes;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "107:     s->hsub = desc_in->log2_chroma_w;",
          "108:     s->vsub = desc_in->log2_chroma_h;",
          "110:     av_image_fill_max_pixsteps(s->pixsteps, NULL, desc_out);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "111:     s->planes = av_pix_fmt_count_planes(outlink->format);",
          "113:     av_assert0(desc_in->nb_components == desc_out->nb_components);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "148:     AVFrame *in = td->in;",
          "149:     int plane;",
          "152:         int hsub    = plane == 1 || plane == 2 ? s->hsub : 0;",
          "153:         int vsub    = plane == 1 || plane == 2 ? s->vsub : 0;",
          "154:         int pixstep = s->pixsteps[plane];",
          "",
          "[Removed Lines]",
          "151:     for (plane = 0; out->data[plane]; plane++) {",
          "",
          "[Added Lines]",
          "157:     for (plane = 0; plane < s->planes; plane++) {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "ed06873b7b2dcace1dd421d92c3aaee2a4d6b26d",
      "candidate_info": {
        "commit_hash": "ed06873b7b2dcace1dd421d92c3aaee2a4d6b26d",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/ed06873b7b2dcace1dd421d92c3aaee2a4d6b26d",
        "files": [
          "libavfilter/vf_transpose.c"
        ],
        "message": "avfilter/vf_transpose: Fix used plane count.\n\nFixes out of array access\nFixes: poc.mp4\n\nFound-by: GwanYeong Kim <gy741.kim@gmail.com>\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>\n(cherry picked from commit c6939f65a116b1ffed345d29d8621ee4ffb32235)\n(cherry picked from commit 3f621455d62e46745453568d915badd5b1e5bcd5)\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
        "before_after_code_files": [
          "libavfilter/vf_transpose.c||libavfilter/vf_transpose.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "olp_code_files": {
          "patch": [
            "libavfilter/vf_transpose.c||libavfilter/vf_transpose.c"
          ],
          "candidate": [
            "libavfilter/vf_transpose.c||libavfilter/vf_transpose.c"
          ]
        }
      },
      "candidate_diff": {
        "libavfilter/vf_transpose.c||libavfilter/vf_transpose.c": [
          "File: libavfilter/vf_transpose.c -> libavfilter/vf_transpose.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "28: #include <stdio.h>",
          "30: #include \"libavutil/imgutils.h\"",
          "31: #include \"libavutil/internal.h\"",
          "32: #include \"libavutil/intreadwrite.h\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "30: #include \"libavutil/avassert.h\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "54: typedef struct TransContext {",
          "55:     const AVClass *class;",
          "56:     int hsub, vsub;",
          "57:     int pixsteps[4];",
          "59:     int passthrough;    ///< PassthroughType, landscape passthrough mode enabled",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "58:     int planes;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "106:     trans->hsub = desc_in->log2_chroma_w;",
          "107:     trans->vsub = desc_in->log2_chroma_h;",
          "109:     av_image_fill_max_pixsteps(trans->pixsteps, NULL, desc_out);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "110:     trans->planes = av_pix_fmt_count_planes(outlink->format);",
          "112:     av_assert0(desc_in->nb_components == desc_out->nb_components);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "147:     AVFrame *in = td->in;",
          "148:     int plane;",
          "151:         int hsub    = plane == 1 || plane == 2 ? trans->hsub : 0;",
          "152:         int vsub    = plane == 1 || plane == 2 ? trans->vsub : 0;",
          "153:         int pixstep = trans->pixsteps[plane];",
          "",
          "[Removed Lines]",
          "150:     for (plane = 0; out->data[plane]; plane++) {",
          "",
          "[Added Lines]",
          "156:     for (plane = 0; plane < trans->planes; plane++) {",
          "",
          "---------------"
        ]
      }
    }
  ]
}